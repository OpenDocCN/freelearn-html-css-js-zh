- en: Chapter 5. Chart Downloader
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章 图表下载器
- en: In this chapter we are going to develop an Ext JS plugin, which will help us
    to download a chart as an image. This plugin will generate a button and when the
    button is clicked, it will perform the required functionality, such that the plugin
    container's chart item will be downloaded as an image.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将开发一个Ext JS插件，该插件将帮助我们下载图表作为图片。此插件将生成一个按钮，当按钮被点击时，它将执行所需的功能，使得插件容器中的图表项将被下载为图片。
- en: 'In this chapter we will cover:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖：
- en: Functional requirements
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 功能需求
- en: Planning and coding the chart downloader
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 规划并编写图表下载器
- en: Functional requirements
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 功能需求
- en: We want to develop a plugin that will facilitate downloading a chart as an image.
    The plugin will generate a button at the container's bottom toolbar. If the container
    does not contain any toolbar at the bottom, this plugin should create a bottom
    toolbar for the container and then it will generate the button within the toolbar.
    When this button is clicked, the plugin will search for a chart item within the
    container and will download the chart as an image.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 我们希望开发一个插件，该插件将简化将图表作为图片下载的功能。该插件将在容器的底部工具栏中生成一个按钮。如果容器底部没有工具栏，则此插件将为容器创建一个底部工具栏，然后在该工具栏中生成按钮。当此按钮被点击时，插件将在容器内搜索图表项，并将图表作为图片下载。
- en: Planning and coding the chart downloader
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规划并编写图表下载器
- en: The plugin's container may or may not have the bottom bar, so we need to search
    for the bottom bar within the container. If found, we will use that, otherwise
    we need to create the bottom bar, and then we can add the download button to that
    bottom bar.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 插件的容器可能包含或不包含底部栏，因此我们需要在容器内搜索底部栏。如果找到，我们将使用它，否则我们需要创建底部栏，然后我们可以将下载按钮添加到该底部栏。
- en: Now let us start coding for the plugin.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们开始编写插件代码。
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Here we are providing a configuration option `chartXtype` so that we can configure
    this plugin with a proper xtype of the chart, which we are targeting to download
    as an image. Now let us define the required `init` function for this plugin:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里提供了一个配置选项`chartXtype`，这样我们就可以使用我们想要下载为图片的图表的正确xtype来配置此插件。现在让我们定义此插件所需的`init`函数：
- en: '[PRE1]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'And now let us define the `handleAfterRender` function:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们定义`handleAfterRender`函数：
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'In this function, we are trying to get the chart component, and if the chart
    component isn''t found, we will show an error message. And if the chart component
    is found, we will call the `addDownloadButton` function, which will create and
    add the download button. Now let us define the `addDownloadButton` function:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在此函数中，我们试图获取图表组件，如果找不到图表组件，我们将显示错误消息。如果找到图表组件，我们将调用`addDownloadButton`函数，该函数将创建并添加下载按钮。现在让我们定义`addDownloadButton`函数：
- en: '[PRE3]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'In this function, first we are trying to get the bottom toolbar by calling
    the `getToolbar` function and then adding the download button to that toolbar.
    Now let us define the `getToolbar` function:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在此函数中，首先我们试图通过调用`getToolbar`函数获取底部工具栏，然后将下载按钮添加到该工具栏中。现在让我们定义`getToolbar`函数：
- en: '[PRE4]'
  id: totrans-18
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You can see that in this function we are trying to get the container''s bottom
    toolbar and if the toolbar is found, we are using that, and if not found, we are
    creating a new bottom toolbar. Now let us define the `saveChart` function, which
    will be called by clicking on the **Download** button:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在此函数中，我们试图获取容器的底部工具栏，如果找到工具栏，我们使用它，如果没有找到，我们创建一个新的底部工具栏。现在让我们定义`saveChart`函数，该函数将在点击**下载**按钮时被调用：
- en: '[PRE5]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here we use the plugin within a window:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们在一个窗口中使用此插件：
- en: '[PRE6]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'And the following screenshot is the output where we used our chart downloader
    plugin:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图是使用我们的图表下载器插件生成的输出：
- en: '![Planning and coding the chart downloader](img/3725OS_05_01.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![规划并编写图表下载器](img/3725OS_05_01.jpg)'
- en: You can see that the **Download as image** button is generated at the window's
    bottom bar, and users can download the image by clicking on this button.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到“下载为图片”按钮生成在窗口的底部栏中，用户可以通过点击此按钮下载图片。
- en: 'Now let us test this with another container that has no bottom bar defined:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们使用没有定义底部栏的另一个容器进行测试：
- en: '[PRE7]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'And the following screenshot is the output:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图是输出结果：
- en: '![Planning and coding the chart downloader](img/3725OS_05_02.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![规划并编写图表下载器](img/3725OS_05_02.jpg)'
- en: You can see that the download button is now generated within the nested panel's
    bottom bar.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到，下载按钮现在生成在嵌套面板的底部栏中。
- en: Summary
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概述
- en: In this chapter we've developed an Ext JS plugin that can download a chart as
    an image. Through this chapter we've learned the way we can create the Ext JS
    plugins and how easily we can inject functionality through the Ext JS plugins.
    In the next chapter, we will go through a very popular plugin for grid searching,
    where users can select or deselect the grid columns on which they want to apply
    the search.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们开发了一个可以下载图表为图片的 Ext JS 插件。通过本章，我们学习了如何创建 Ext JS 插件以及如何通过 Ext JS 插件轻松注入功能。在下一章，我们将介绍一个非常流行的用于网格搜索的插件，用户可以选择或取消选择他们想要应用搜索的网格列。
