- en: Chapter 2. Adding Raster Layers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 2 章：添加栅格图层
- en: 'In this chapter we will cover the following:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍以下内容：
- en: Using Google Maps imagery
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Google Maps 图像
- en: Using Bing imagery
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 Bing 图像
- en: Adding WMS layer
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加 WMS 图层
- en: Wrapping the date line options
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包装日期线选项
- en: Changing the zoom effect
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 改变缩放效果
- en: Changing the layer opacity
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 改变图层不透明度
- en: Using WMS with single tile mode
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用单瓦片模式的 WMS
- en: Buffering the layer data to improve the map navigation
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 缓存图层数据以改善地图导航
- en: Creating an image layer
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建图像图层
- en: Setting the tile size in WMS layers
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 WMS 图层中设置瓦片大小
- en: Introduction
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: This chapter is all about working with raster layers. We have tried to summarize,
    with a set of recipes, the most common and important use cases you can find day-to-day
    when working with OpenLayers.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 本章主要介绍如何处理栅格图层。我们试图通过一系列的食谱，总结出在日常工作使用 OpenLayers 时最常见和重要的用例。
- en: Imagery is one of the most important kinds of data to work with in a GIS system.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 图像是在 GIS 系统中处理的最重要类型的数据之一。
- en: OpenLayers offers several classes to integrate with different imagery providers,
    from proprietary providers such as Google Maps and Bing Maps, to Open Source ones
    such as OpenStreetMap or even any WMS service provider.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: OpenLayers 提供了几个类来与不同的图像提供商集成，从专有提供商如 Google Maps 和 Bing Maps，到开源的如 OpenStreetMap，甚至是任何
    WMS 服务提供商。
- en: The base class for any layer type is the `OpenLayers.Layer` class, which offers
    a set of common properties and defines the common behavior for any other classes.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 任何图层类型的基类是 `OpenLayers.Layer` 类，它提供了一套通用属性并定义了其他任何类的通用行为。
- en: In addition, many layers inherit from the `OpenLayers.Layer.Grid` class, which
    divides the layer into zoom levels. This way each zoom level covers the same area
    but uses a greater set of tiles. For example, at level zero a grid with one tile
    covers the whole world, at level one a grid with four tiles covers the whole world,
    and so on. As we can see, on each level, the number of tiles and their resolution
    increases.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，许多图层继承自 `OpenLayers.Layer.Grid` 类，它将图层划分为不同的缩放级别。这样，每个缩放级别覆盖相同的区域，但使用更大的瓦片集。例如，在零级，一个瓦片覆盖整个世界；在一级，四个瓦片覆盖整个世界，以此类推。正如我们所看到的，在每个级别上，瓦片的数量和它们的分辨率都会增加。
- en: This chapter introduces you to the use of raster layers, with special attention
    to the WMS layers, and how to manage the most common properties.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了如何使用栅格图层，特别关注 WMS 图层，以及如何管理最常用的属性。
- en: Using Google Maps imagery
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Google Maps 图像
- en: Google Maps is probably the most known web map application around the world.
    Their imageries, in the way of tiled layers, are well known by people; they are
    accustomed to their layer style and because of this you may be interested in using
    them in your own web mapping project.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: Google Maps 可能是全球最知名的网页地图应用。他们的瓦片层图像方式为人们所熟知；他们习惯了其图层风格，因此你可能对在自己的网络地图项目中使用它们感兴趣。
- en: '![Using Google Maps imagery](img/7843_02_01.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![使用 Google Maps 图像](img/7843_02_01.jpg)'
- en: OpenLayers counts with the `OpenLayers.Layer.Google` class, which is in fact
    a wrapper code around the Google Maps API, that allows us to use the Google Maps
    tiles in a homogeneous way within the OpenLayers API.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: OpenLayers 使用 `OpenLayers.Layer.Google` 类，实际上是在 Google Maps API 上的包装代码，允许我们在
    OpenLayers API 中以统一的方式使用 Google Maps 瓦片。
- en: Note
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Do not confuse Google Maps API with the Google Maps imagery. Google Maps API
    is a bunch of JavaScript code, which is free to use, while the access to the Google
    Maps imagery has some usage restrictions and, depending on the number of hits,
    will be subject to some payments.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 不要混淆 Google Maps API 和 Google Maps 图像。Google Maps API 是一组 JavaScript 代码，可免费使用，而访问
    Google Maps 图像则有一些使用限制，并且根据访问次数，可能需要支付一定的费用。
- en: How to do it...
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到...
- en: 'To use Google Maps imagery, perform the following steps:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 Google Maps 图像，请执行以下步骤：
- en: Create an HTML file and add the OpenLayers dependencies.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个 HTML 文件并添加 OpenLayers 依赖项。
- en: 'Include the Google Maps API as follows:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按如下方式包含 Google Maps API：
- en: '[PRE0]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Add a `div` element to hold the map, as follows:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个 `div` 元素来包含地图，如下所示：
- en: '[PRE1]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Within a `script` element, add the code to create the map instance and add
    a layer switcher control, as follows:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 `script` 元素内，添加创建地图实例并添加图层切换控件的相关代码，如下所示：
- en: '[PRE2]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Create some Google based maps and add to the map, as follows:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一些基于 Google 的地图，并添加如下：
- en: '[PRE3]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Finally, center the map on a desired location, as follows:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，将地图中心定位在所需位置，如下所示：
- en: '[PRE4]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: How it works...
  id: totrans-38
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'As you can see, the code has three main sections. First we have placed a `div`
    element, which will be used for the map, as follows:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，代码有三个主要部分。首先我们放置了一个`div`元素，它将被用作地图，如下所示：
- en: '[PRE5]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Next, we have included the Google Maps API code, as follows:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们包含了Google Maps API代码，如下所示：
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Note
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Remember that OpenLayers simply acts as a wrapper, so we need the real Google
    Maps API code in our application.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，OpenLayers仅仅是一个包装器，因此我们需要在我们的应用程序中使用真实的Google Maps API代码。
- en: 'Within a`<script type="text/javascript"> </script>` element, we have added
    the code necessary to initialize the map and add a layer switcher control, as
    follows:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在`<script type="text/javascript"> </script>`元素中，我们添加了初始化地图和添加图层切换控件所需的代码，如下所示：
- en: '[PRE7]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Finally, we have added some well known Google Maps layers and centered the
    map''s viewport, as follows:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们添加了一些知名的Google Maps图层，并居中地图的视口，如下所示：
- en: '[PRE8]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The type of the layers are defined by the Google Maps API class `google.maps.MapTypeId`,
    which you can find at [http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId](http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId).
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图层的类型由Google Maps API类`google.maps.MapTypeId`定义，你可以在[http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId](http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId)找到。
- en: Note
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Note that we are working with two APIs, OpenLayers and Google Maps API, so it
    would be good to take a look at the Google Maps API to better understand its capabilities.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们正在使用两个API，OpenLayers和Google Maps API，因此查看Google Maps API以更好地了解其功能会是个不错的选择。
- en: Documentation can be found at [https://developers.google.com/maps/documentation/javascript/tutorial](http://https://developers.google.com/maps/documentation/javascript/tutorial).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 文档可以在[https://developers.google.com/maps/documentation/javascript/tutorial](http://https://developers.google.com/maps/documentation/javascript/tutorial)找到。
- en: There's more...
  id: totrans-53
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 还有更多...
- en: In this recipe, we have shown you how to use the Google Maps API Version 3 to
    add the Google imagery to your OpenLayers projects.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们展示了如何使用Google Maps API版本3将Google影像添加到你的OpenLayers项目中。
- en: For the previous version 2, Google requires you to register as a user and obtain
    an API key that you need to use to initialize the `OpenLayers.Layer.Google` instance.
    The key is later used on every tile request to identify you, so Google can know
    about your usage.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 对于之前的版本2，Google要求你注册为用户并获取一个API密钥，你需要使用这个密钥来初始化`OpenLayers.Layer.Google`实例。这个密钥随后在每次瓦片请求中都会使用，以识别你，这样Google就能了解你的使用情况。
- en: As you have seen, version 3 is much more simple to use within OpenLayers.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，版本3在OpenLayers中使用起来要简单得多。
- en: See also
  id: totrans-57
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding WMS layer* recipe
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加WMS图层*配方'
- en: The *Using Bing imagery* recipe
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用Bing影像*配方'
- en: The *Understanding base and non-base layers* recipe in [Chapter 1](ch01.html
    "Chapter 1. Web Mapping Basics"), *Web Mapping Basics*
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*在[第1章](ch01.html "第1章。网络制图基础")的*“理解基本和非基本图层”配方中，*网络制图基础*'
- en: Using Bing imagery
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Bing影像
- en: Bing Maps, previously known as Virtual Earth, is the mapping service provided
    by Microsoft.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: Bing Maps，之前被称为Virtual Earth，是由微软提供的地图服务。
- en: In the same way as Google Maps, OpenLayers offers an `OpenLayers.Layer.Bing`
    class, which brings us the possibility to add Bing imagery in our projects.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 与Google Maps一样，OpenLayers提供了一个`OpenLayers.Layer.Bing`类，这为我们带来了在项目中添加Bing影像的可能性。
- en: '![Using Bing imagery](img/7843_02_02.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![使用Bing影像](img/7843_02_02.jpg)'
- en: Getting ready
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Bing Maps requires you to register as a consumer user. Once registered, you
    will get an API key needed to initialize the `OpenLayers.Layer.Bing` layer and
    that will be used with every request to authenticate you against the Bing Maps
    service.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: Bing Maps要求你注册为消费者用户。一旦注册，你将获得一个API密钥，用于初始化`OpenLayers.Layer.Bing`图层，并且这个密钥将在每次请求中使用以验证你的Bing
    Maps服务身份。
- en: Opposite to Google Maps, Bing does not require any JavaScript code and the `OpenLayers.Layer.Bing`
    class does not act as a wrapper. Bing Maps offer a REST service to directly access
    tiles using your API key.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 与Google Maps相反，Bing不需要任何JavaScript代码，`OpenLayers.Layer.Bing`类也不作为包装器。Bing Maps提供了一个REST服务，可以直接使用你的API密钥访问瓦片。
- en: Note
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can find out how to register as a user at [http://msdn.microsoft.com/en-us/library/ff428642.aspx](http://msdn.microsoft.com/en-us/library/ff428642.aspx).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[http://msdn.microsoft.com/en-us/library/ff428642.aspx](http://msdn.microsoft.com/en-us/library/ff428642.aspx)了解如何注册为用户。
- en: In addition you can learn about Bing Maps REST Services at [http://msdn.microsoft.com/en-us/library/ff701713.aspx](http://msdn.microsoft.com/en-us/library/ff701713.aspx).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你还可以在[http://msdn.microsoft.com/en-us/library/ff701713.aspx](http://msdn.microsoft.com/en-us/library/ff701713.aspx)了解Bing
    Maps REST服务。
- en: At this point, it is assumed that you have an API key to be used in the next
    code.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，假设您有一个API密钥，将在下一部分代码中使用。
- en: How to do it...
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'In this section we will see how to use Bing imagery. To use Bing imagery, perform
    the following steps:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将看到如何使用Bing影像。要使用Bing影像，请执行以下步骤：
- en: Create an HTML file and add the OpenLayers dependencies.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并添加OpenLayers依赖项。
- en: 'Add a `DOM` element to place the map, as follows:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个`DOM`元素来放置地图，如下所示：
- en: '[PRE9]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Within a `script` element create the map instance and add a layer switcher
    control, as follows:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在一个`script`元素中创建地图实例并添加一个图层切换器控件，如下所示：
- en: '[PRE10]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Create some Bing layers, add to the map and center the map''s viewport, as
    follows:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一些Bing图层，添加到地图中并居中地图的视口，如下所示：
- en: '[PRE11]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: How it works...
  id: totrans-81
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The main point to take into account in this recipe is that we are using Microsoft
    services. We request an URL using our API key and get a tile. Because of this,
    every Bing layer must include a `key` parameter while instantiating, as follows:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个食谱中，我们需要考虑的主要点是我们在使用Microsoft服务。我们使用我们的API密钥请求一个URL并获取一个瓦片。因此，每个Bing图层在实例化时都必须包含一个`key`参数，如下所示：
- en: '[PRE12]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: We know about the `name` parameter as it is common in all layers. The `name`
    parameter is used to put a descriptive name for the layer and it will be used
    by switcher control.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 我们知道`name`参数在所有图层中都是通用的。`name`参数用于为图层添加一个描述性名称，它将被切换器控件使用。
- en: As previously mentioned, the `key` parameter is used on every tile request and
    identifies us as registered Bing consumer users.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，`key`参数在每次瓦片请求中使用，并标识我们为注册的Bing消费者用户。
- en: The `type` parameter is necessary to specify the kind of tile we want to get
    from Bing Maps. Bing offers Road, Aerial, or AerialWithLabels among other types.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`type`参数是必要的，用于指定我们想要从Bing Maps获取的瓦片类型。Bing提供了道路、航空或带有标签的航空等多种类型。'
- en: Note
  id: totrans-87
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can find more information about Bing Maps layer types at [http://msdn.microsoft.com/en-us/library/ff701716.aspx](http://msdn.microsoft.com/en-us/library/ff701716.aspx).
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[http://msdn.microsoft.com/en-us/library/ff701716.aspx](http://msdn.microsoft.com/en-us/library/ff701716.aspx)找到有关Bing
    Maps图层类型的更多信息。
- en: See also
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Using Google Maps imagery* recipe
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**使用Google Maps影像**的食谱'
- en: The *Adding WMS layer* recipe
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**添加WMS图层**的食谱'
- en: The *Understanding base and non-base layers* recipe in [Chapter 1](ch01.html
    "Chapter 1. Web Mapping Basics"), *Web Mapping Basics*
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[第1章](ch01.html "第1章。网络制图基础")的*理解基本图层和非基本图层*食谱中，*网络制图基础*
- en: Adding WMS layer
  id: totrans-93
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加WMS图层
- en: '**Web Map Service (WMS)** ,is a standard developed by the **Open Geospatial
    Consortium (OGC)** implemented by many geospatial servers, among which we can
    find the free and open source projects GeoServer ([http://geoserver.org](http://geoserver.org))
    and MapServer ([http://mapserver.org](http://mapserver.org)). More information
    on WMS can be found at [http://en.wikipedia.org/wiki/Web_Map_Service](http://en.wikipedia.org/wiki/Web_Map_Service).'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**Web Map Service (WMS**) 是由**开放地理空间联盟 (OGC**) 开发的一个标准，由许多地理空间服务器实现，其中我们可以找到免费和开源项目GeoServer
    ([http://geoserver.org](http://geoserver.org)) 和MapServer ([http://mapserver.org](http://mapserver.org))。有关WMS的更多信息，可以在[http://en.wikipedia.org/wiki/Web_Map_Service](http://en.wikipedia.org/wiki/Web_Map_Service)找到。'
- en: 'As a very basic summary, you can understand a WMS server as a normal HTTP web
    server that accepts request with some GIS-related parameters (such as projection,
    bounding box, and so on) and returns a map similar to the following screenshot:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个非常基本的总结，您可以将WMS服务器理解为一个正常的HTTP网络服务器，它接受带有一些GIS相关参数（如投影、边界框等）的请求，并返回类似于以下截图的地图。
- en: '![Adding WMS layer](img/7843_02_03.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![添加WMS图层](img/7843_02_03.jpg)'
- en: Note
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We are going to work with remote WMS servers, so it is not necessary you have
    one installed. As an advise, note that we are not responsible for these servers
    and that they may have problems, or are not available when you read this section.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用远程WMS服务器，因此您不需要安装一个。作为建议，请注意，我们不对这些服务器负责，它们可能存在问题，或者您阅读本节时可能不可用。
- en: Any other WMS server can be used, but the URL and layer name must be known.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用任何其他WMS服务器，但必须知道URL和图层名称。
- en: How to do it...
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'To add a WMS layer, perform the following steps:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 要添加WMS图层，请执行以下步骤：
- en: Create an HTML file and add the OpenLayers dependencies.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并添加OpenLayers依赖项。
- en: 'Add a `div` element to hold the map, as follows:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个`div`元素来容纳地图，如下所示：
- en: '[PRE13]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Create the map instance as follows:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按以下方式创建地图实例：
- en: '[PRE14]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Now, add two WMS layers. The first will be the base layer and the second will
    be an overlay, as follows:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，添加两个WMS图层。第一个将是基本图层，第二个将是叠加图层，如下所示：
- en: '[PRE15]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Finally, we add a layer switcher control and center the view, as follows:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们添加了一个图层切换控件并居中视图，如下所示：
- en: '[PRE16]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: How it works...
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The `OpenLayers.Layer.WMS` class constructor requires four arguments to be
    instantiated (actually the fourth is optional), which are:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer.WMS`类构造函数需要四个参数来实例化（实际上第四个是可选的），它们是：'
- en: '[PRE17]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'The parameters are as follows:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 参数如下：
- en: The `name` is common to all layers and is used as a user-friendly description
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`name`对所有层都是通用的，并用作用户友好的描述'
- en: The `url` is a string that must point to the WMS server
  id: totrans-116
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`url`是一个字符串，必须指向WMS服务器'
- en: 'The `params` parameter is an object and can contain any parameters used in
    a WMS request: layers, format, styles, and so on'
  id: totrans-117
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`params`参数是一个对象，可以包含WMS请求中使用的任何参数：层、格式、样式等'
- en: Note
  id: totrans-118
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Check the WMS standard to know which parameters you can use within the `params`.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 检查WMS标准以了解你可以在`params`中使用哪些参数。
- en: The use of layers is mandatory, so you always need to specify this value. In
    addition, if using the SRS WMS request parameter, take into account that it is
    always ignored, because it is taken from the projection of the base layer or the
    map's projection.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 层的使用是强制性的，所以你总是需要指定这个值。此外，如果你使用SRS WMS请求参数，请注意它总是被忽略，因为它来自基础层的投影或地图的投影。
- en: 'The `options` parameter is an optional object that contains specific properties
    for the layer object: `opacity, isBaseLayer`, among others'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`options`参数是一个可选的对象，它包含用于图层对象的特定属性：`opacity`、`isBaseLayer`等'
- en: 'In this recipe, we have added one base layer as follows:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们添加了一个基础层，如下所示：
- en: '[PRE18]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: It makes use of the `name, url`, and `params` parameters, indicating the `basic`
    is the only layer to be requested.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 它使用了`name`、`url`和`params`参数，表明`basic`是唯一需要请求的图层。
- en: 'Later, we have added a second overlay layer with weather radar information
    from NEXRAD ([http://en.wikipedia.org/wiki/NEXRAD](http://en.wikipedia.org/wiki/NEXRAD)),
    at the Iowa State University servers (you can find more information at [http://mesonet.agron.iastate.edu/ogc)](http://mesonet.agron.iastate.edu/ogc))
    as follows:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，我们在爱荷华州立大学的服务器上添加了一个带有NEXRAD（[http://en.wikipedia.org/wiki/NEXRAD](http://en.wikipedia.org/wiki/NEXRAD)）气象雷达信息的第二层叠加（你可以在[http://mesonet.agron.iastate.edu/ogc)](http://mesonet.agron.iastate.edu/ogc)找到更多信息），如下所示：
- en: '[PRE19]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: In this case, in addition to the `layers` parameter, we have used the `transparent`
    and `format` parameters.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，除了`layers`参数外，我们还使用了`transparent`和`format`参数。
- en: The `format` parameter is used in a WMS request to specify what image format
    we want to receive the images in.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '`format`参数用于WMS请求中，以指定我们希望以什么图像格式接收图像。'
- en: 'The `transparent` property is set to `true`. If it were not set, we would get
    white tiles with some colored radar data that will hide the base layer. Make the
    test using `transparent: "false"`.'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`transparent`属性设置为`true`。如果没有设置，我们会得到带有一些彩色雷达数据的白色瓦片，这将隐藏底层。使用`transparent:
    "false"`进行测试。'
- en: For this layer, we have also set the layer parameter `isBaseLayer` to `false`,
    to indicate we want it to act as an overlay.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个图层，我们还设置了图层参数`isBaseLayer`为`false`，以表示我们希望它作为叠加层使用。
- en: There's more...
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 还有更多...
- en: WMS servers returns images no matter whether there is information in the bounding
    box we are requesting or not.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: WMS服务器无论我们请求的边界框中是否有信息都会返回图像。
- en: The previously mentioned Nexrad WMS layer, showing the tile images with a white
    background was not desirable, so we used the `transparent` parameter to fix the
    issue.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 之前提到的Nexrad WMS层，显示带有白色背景的瓦片图像并不理想，因此我们使用了`transparent`参数来解决这个问题。
- en: When you set the `transparent` parameter to `true`, no matter which format you
    specify, internally the WMS class ensures the requests are made using the `format
    image/png` or `image/gif` to guarantee the transparency of those pixels that have
    no data.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 当你将`transparent`参数设置为`true`时，无论你指定什么格式，WMS类都会确保使用`format image/png`或`image/gif`进行请求，以保证那些没有数据的像素的透明度。
- en: Finally, remember we can pass any parameter defined by WMS standard in the requests,
    by just specifying them in the `params` parameter.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，请记住我们可以在请求中传递任何由WMS标准定义的参数，只需在`params`参数中指定它们即可。
- en: See also
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Using Google Maps imagery* recipe
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用谷歌地图影像*配方'
- en: The *Using WMS with single tile mode* recipe
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用单瓦片模式的WMS*配方'
- en: The *Changing the layer opacity* recipe
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*更改图层不透明度*配方'
- en: The *Buffering the layer data to improve the map navigation* recipe
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*缓冲层数据以改善地图导航*配方'
- en: Wrapping the date line options
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 包装日期线选项
- en: 'There might be situations where you do not want your map ends at -180 or +180
    longitude degrees as you are working in that area and need a continuous map. For
    example, imagine a map where on the left you can see the end of Russia and at
    the right Alaska, as shown in the following screenshot:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 可能会有这样的情况，你不希望你的地图在-180或+180经度度结束，因为你正在该区域工作，需要一个连续的地图。例如，想象一个地图，在左边你可以看到俄罗斯的尽头，在右边是阿拉斯加，如下面的截图所示：
- en: '![Wrapping the date line options](img/7843_02_05.jpg)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![包裹日期线选项](img/7843_02_05.jpg)'
- en: This property is a common attribute from base class `OpenLayers.Layer` and is
    called the `wrapDateLine`.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 这个属性是基类`OpenLayers.Layer`的一个常见属性，称为`wrapDateLine`。
- en: How to do it...
  id: totrans-145
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'To wrap the date line options, perform the following steps:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 要包裹日期线选项，执行以下步骤：
- en: Create an HTML file and add the OpenLayers dependency.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并添加OpenLayers依赖项。
- en: 'In the beginning, we have put a checkbox to activate/deactivate the wrap data
    line feature, as follows:'
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在开始时，我们放置了一个复选框来激活/停用包裹数据线功能，如下所示：
- en: Note
  id: totrans-149
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Do not worry about the `dojoType="dijit.form.CheckBox"` attribute, it is because
    the Dojo Toolkit ([http://dojotoolkit.org](http://dojotoolkit.org)) is used in
    the sample.
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 不要担心`dojoType="dijit.form.CheckBox"`属性，因为它是因为在示例中使用了Dojo Toolkit ([http://dojotoolkit.org](http://dojotoolkit.org))。
- en: Think of it as a normal HTML input element.
  id: totrans-151
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 想象它就像一个普通的HTML输入元素。
- en: 'Next, we have added the `DOM` element used to render the map, as follows:'
  id: totrans-152
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，我们添加了用于渲染地图的`DOM`元素，如下所示：
- en: '[PRE20]'
  id: totrans-153
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Within a `script` element, create the map instance, as follows:'
  id: totrans-154
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`script`元素内创建地图实例，如下所示：
- en: '[PRE21]'
  id: totrans-155
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Now, create a WMS layer specifying the `wrapDateLine` property, as follows:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，创建一个指定`wrapDateLine`属性的WMS图层，如下所示：
- en: '[PRE22]'
  id: totrans-157
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Finally, implement the function that will change the `wrapDateLine` property
    value, as follows:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，实现一个将更改`wrapDateLine`属性值的函数，如下所示：
- en: '[PRE23]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: How it works...
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: All the magic of this recipe is in the `wrapDateLine` property in the `OpenLayers.Layer`
    class. You need to set it to `true` to wrap and create a continuous layer on their
    longitudinal axes.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 这个菜谱的所有魔法都藏在`OpenLayers.Layer`类中的`wrapDateLine`属性里。你需要将其设置为`true`，以便在它们的经度轴上包裹并创建一个连续的图层。
- en: 'In addition, we have created a function that reacts to changes in the checkbox
    to activate/deactivate the `wrapDateLine` property, as in the following code:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们创建了一个函数，它会根据复选框的变化来激活/停用`wrapDateLine`属性，如下面的代码所示：
- en: '[PRE24]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Note that after changing the property value we need to redraw the layer so that
    it takes effect. This is done using the `redraw()` method inherited from the `OpenLayers.Layer`
    base class.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，在更改属性值后，我们需要重新绘制图层，以便它生效。这是通过从`OpenLayers.Layer`基类继承的`redraw()`方法完成的。
- en: The `wrapDateLine` property is not a property of the map but a property of every
    layer; so if you want the whole map to have the same behavior, you need to set
    it to `true` in all layers.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '`wrapDateLine`属性不是地图的属性，而是每个图层的属性；所以如果你想整个地图都有相同的行为，你需要在所有图层中将其设置为`true`。'
- en: See also
  id: totrans-166
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding WMS layer* recipe
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加WMS图层*菜谱'
- en: The *Using WMS with single tile mode* recipe
  id: totrans-168
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用单瓦片模式的WMS*菜谱'
- en: Changing the zoom effect
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 改变缩放效果
- en: The panning and zoom effects are very important actions related to the user
    navigation experience.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 平移和缩放效果是与用户导航体验非常相关的关键动作。
- en: In [Chapter 1](ch01.html "Chapter 1. Web Mapping Basics"), *Web Mapping Basics*,
    the recipe *Moving around the map view* shows how you can control and create the
    way the map can be panned.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第1章](ch01.html "第1章。网络制图基础")，*网络制图基础*中，菜谱*在地图视图中移动*展示了如何控制并创建地图平移的方式。
- en: In the same way you can control the transition effect between two zoom levels
    on the layers.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 以同样的方式，你可以控制图层之间两个缩放级别之间的过渡效果。
- en: 'The `OpenLayers.Layer` class has a `transitionEffect` property, which determines
    the effect applied to the layer when the zoom level is changed. For the moment
    only two values are allowed: `null` and `resize`.'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer`类有一个`transitionEffect`属性，它决定了在缩放级别改变时应用于图层的效果。目前只允许两个值：`null`和`resize`。'
- en: The `null` value means no transition effect will be applied, because when you
    change the zoom level you probably see how the layer disappears until the tiles
    at the new zoom level are loaded.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`null`值表示不会应用过渡效果，因为当你更改缩放级别时，你可能会看到图层消失，直到新缩放级别的瓦片加载完成。'
- en: With the `resize` value when we zoom into a level, the current tiles are resized,
    adapting to the new zoom, until the tiles at the new level are loaded in background.
    This way images are always visible and we avoid the ugly effect of seeing a blank
    map for a few seconds.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们放大到某个级别时，`resize`值会使当前瓦片调整大小，以适应新的缩放，直到新级别的瓦片在后台加载。这样图像总是可见的，我们避免了看到空白地图几秒钟的丑陋效果。
- en: How to do it...
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'To change the zoom level, perform the following steps:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 要更改缩放级别，执行以下步骤：
- en: Create an HTML file and include the required OpenLayers dependencies.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并包含所需的OpenLayers依赖项。
- en: 'For this recipe, we are going to add a checkbox button that allows us to change
    between the transition effects on a single layer, as follows:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于这个菜谱，我们将添加一个复选框按钮，允许我们在单个图层之间切换过渡效果，如下所示：
- en: '[PRE25]'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Next, add the `div` element, which holds the map as follows:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，添加`div`元素，如下所示，它包含地图：
- en: '[PRE26]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Add the JavaScript that initializes the map and creates one WMS layer, as follows:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加初始化地图并创建一个WMS图层的JavaScript代码，如下所示：
- en: '[PRE27]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Finally, put the function that will toggle the `transitionEffect` property
    value, as follows:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，放置一个切换`transitionEffect`属性值的函数，如下所示：
- en: '[PRE28]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: How it works...
  id: totrans-187
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: As explained at the beginning of the recipe, all the magic is in the `transitionEffect`
    property.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 如菜谱开头所述，所有魔法都集中在`transitionEffect`属性上。
- en: As the property is specific to a layer and not an `OpenLayers.Map` property,
    if you want to apply the same effect to the whole map, you need to set it on all
    its contained layers.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 由于该属性是针对图层而不是`OpenLayers.Map`属性，如果你想将相同的效果应用于整个地图，你需要将其设置在其所有包含的图层上。
- en: There's more...
  id: totrans-190
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更多...
- en: One or more `OpenLayers.Tile.Image` forms a raster layer, so when it is rendered
    the real work to draw the tiles is made easy by the tiles themselves.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 一个或多个`OpenLayers.Tile.Image` 形成一个栅格图层，因此当它被渲染时，绘制瓦片的实际工作由瓦片本身简化。
- en: Although the `transitionEffect` is defined in the `OpenLayers.Layer` class (or
    subclasses), each individual tile is responsible for drawing the transition effect.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`transitionEffect`是在`OpenLayers.Layer`类（或其子类）中定义的，但每个单独的瓦片负责绘制过渡效果。
- en: If you plan to create a new zoom transition effect, you will need to take a
    look at the `OpenLayers.Tile.Image` code as well.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你计划创建一个新的缩放过渡效果，你还需要查看`OpenLayers.Tile.Image`的代码。
- en: See also
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding WMS layer* recipe
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加WMS图层* 菜谱'
- en: The *Changing the layer opacity* recipe
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*更改图层不透明度* 菜谱'
- en: The *Using WMS with single tile mode* recipe
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用单瓦片模式WMS* 菜谱'
- en: Changing the layer opacity
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更改图层不透明度
- en: 'When you are working with many layers—both raster and vector layers—you will
    probably find situations where a layer that is on top of another layer hides the
    one below it. This is more common when working with raster WMS layers without
    the `transparent` property set to `true` or tiled layers such as, OpenStreetMaps,
    Google, and Bing. The layer opacity is set to **50%** in the following screenshot:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 当你与许多图层（包括栅格和矢量图层）一起工作时，你可能会遇到一个图层在另一个图层之上，从而隐藏了下面的图层的情况。这在没有将`transparent`属性设置为`true`的栅格WMS图层（如OpenStreetMaps、Google和Bing）或瓦片图层时更为常见。以下截图中的图层不透明度设置为**50%**：
- en: '![Changing the layer opacity](img/7843_02_07.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![更改图层不透明度](img/7843_02_07.jpg)'
- en: The `OpenLayers.Layer` base class has an `opacity` property, implemented by
    concrete subclasses, that allows us to modify the opacity of the layers. It is
    a float value that can range from `0.0` (completely transparent) to `1.0` (completely
    opaque).
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer` 基类有一个`opacity`属性，由具体的子类实现，允许我们修改图层的透明度。它是一个浮点值，范围从`0.0`（完全透明）到`1.0`（完全不透明）。'
- en: How to do it...
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The opacity of the layers can be changed. To change the opacity of the layer,
    perform the following steps:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 可以更改图层的不透明度。要更改图层的不透明度，请执行以下步骤：
- en: Create an HTML file adding the required OpenLayers dependencies.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并添加所需的OpenLayers依赖项。
- en: Note
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We have intentionally omitted the HTML code required for the slider control.
    Here, we have focused on the code for OpenLayers. If interested in knowing more
    about the code for the slider, it can be found in the recipe's source code.
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 我们有意省略了用于滑块控制的HTML代码。在这里，我们专注于OpenLayers的代码。如果你对滑块的代码感兴趣，可以在菜谱的源代码中找到。
- en: 'Add a `div` element to hold the map, as follows:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个`div`元素来包含地图，如下所示：
- en: '[PRE29]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Next, create a map instance and add two layers, as follows:'
  id: totrans-209
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，创建一个地图实例并添加两个图层，如下所示：
- en: '[PRE30]'
  id: totrans-210
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Add a layer switcher control and center the map''s viewport, as follows:'
  id: totrans-211
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个图层切换控件并居中地图的视口，如下所示：
- en: '[PRE31]'
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Finally, implement the function that receives the changes on the slider control
    and changes the layer opacity, as follows:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，实现一个函数，该函数接收滑动控制器的更改并更改图层的不透明度，如下所示：
- en: '[PRE32]'
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: How it works...
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: As we have commented that the `opacity` property is the key in this recipe,
    the way to modify it is not by changing the attribute value directly but by using
    the `setOpacity()` method.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们评论的那样，`opacity` 属性是这个菜谱的关键，修改它的方式不是直接更改属性值，而是使用 `setOpacity()` 方法。
- en: The `setOpacity()` method is responsible for modifying the `opacity` property
    in addition to modifying any `DOM` element (for example, the images of the tiles)
    and emitting a `changelayer` event, which notifies any listener interested in
    knowing about any layer changes.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '`setOpacity()` 方法负责修改 `opacity` 属性，除了修改任何 `DOM` 元素（例如，瓦片的图像）外，还会发出一个 `changelayer`
    事件，通知任何感兴趣的监听器有关图层更改的通知。'
- en: See also
  id: totrans-218
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Wrapping the date line options* recipe
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*包裹日期线选项*菜谱'
- en: The *Understanding base and non-base layers* recipe in [Chapter 1](ch01.html
    "Chapter 1. Web Mapping Basics"), *Web Mapping Basics*
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[第 1 章](ch01.html "第 1 章。网络制图基础")的*理解基本和非基本图层*菜谱中，*网络制图基础*
- en: The *Adding WMS layer* recipe
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加 WMS 图层*菜谱'
- en: The *Buffering the layer data to improve the map navigation* recipe
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*缓冲图层数据以改善地图导航*菜谱'
- en: Using WMS with single tile mode
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用单瓦片模式的 WMS
- en: '**Web Map Service (WMS)** is a protocol to serve georeferenced map images.'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '**Web Map Service (WMS)** 是一个用于提供地理参考地图图像的协议。'
- en: The basic idea is that, given a bounding box and some other parameters, such
    as a layer name, the client makes an HTTP request to the WMS server, which computes
    and returns an image with all the data for the specified layers and within the
    specified bounding box.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 基本思想是，给定一个边界框和一些其他参数，例如图层名称，客户端向 WMS 服务器发送一个 HTTP 请求，服务器计算并返回一个包含指定图层和指定边界框内所有数据的图像。
- en: In OpenLayers, when you add a WMS layer to your map, the `OpenLayers.Layer.WMS`
    instance is provided with some parameters, such as resolutions and tile size.
    The WMS server computes the right number of tiles for each zoom level and divides
    the layer in that number of tiles.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在 OpenLayers 中，当你将 WMS 图层添加到地图中时，`OpenLayers.Layer.WMS` 实例会提供一些参数，例如分辨率和瓦片大小。WMS
    服务器会计算每个缩放级别的正确瓦片数量，并将图层分成这么多瓦片。
- en: This way, when you add a WMS layer to the map, there is not only one request
    to the server, but one by each tile that forms the current zoom level.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 这样，当你将 WMS 图层添加到地图中时，不仅只有一个请求发送到服务器，而且每个瓦片都会发送一个请求，以形成当前缩放级别的瓦片。
- en: Note
  id: totrans-228
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Dividing the WMS layer in tiles can be better from the server-side point of
    view when it is configured with a cache system. This way tiles are generated once
    and served many times.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 当配置了缓存系统时，从服务器端的角度来看，将 WMS 图层分成瓦片可能更好。这样瓦片只生成一次，然后多次提供服务。
- en: If you have more than one web mapping application using WMS layers that point
    to the same WMS server, all the tiles can be served from the cache and the load
    on the server would drastically reduce.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有多于一个使用指向同一 WMS 服务器的 WMS 图层的网络制图应用程序，所有瓦片都可以从缓存中提供，这将大大减少服务器的负载。
- en: Dividing the layer in tiles isn't the only way you can work with WMS layers;
    if you need to, you can work in the so-called single tile mode.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 将图层分成瓦片不是唯一与 WMS 图层一起工作的方式；如果需要，你可以使用所谓的单瓦片模式。
- en: In this mode, only one image is used to cover the whole view—the map's bounding
    box, instead of using a bunch of tiles required for the tiled mode.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种模式下，只使用一张图像来覆盖整个视图——地图的边界框，而不是使用瓦片模式所需的多个瓦片。
- en: Every time the layer must be refreshed (as you move the map or change the zoom
    level) one request is made to the WMS server requesting data for the new map's
    bounding box.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 每次图层必须刷新（当你移动地图或更改缩放级别时），就会向 WMS 服务器发送一个请求，请求新地图边界框的数据。
- en: As you can see, in single tile mode, the number of requests to the server are
    much less than those in tiled mode. In contrast, working in tiled mode, each tile
    request is easy to cache as the tile's bounding boxes are fixed for each zoom
    level; while in single tile mode each request is usually slightly different than
    the other (as little changes in the bounding box) and will result in a request
    to the WMS server, with the consequent computation time.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，在单瓦片模式下，对服务器的请求次数远少于瓦片模式。相比之下，在瓦片模式下，每个瓦片请求很容易缓存，因为每个缩放级别的瓦片边界框是固定的；而在单瓦片模式下，每个请求通常与其他请求略有不同（因为边界框有细微的变化）并且会导致对
    WMS 服务器的请求，从而产生相应的计算时间。
- en: How to do it...
  id: totrans-235
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何实现...
- en: 'Follow through the steps to use WMS in single tile mode:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 按照以下步骤使用WMS的单瓦片模式：
- en: Create an HTML file and add the OpenLayers dependencies.
  id: totrans-237
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并添加OpenLayers依赖项。
- en: 'Now, we are going to create two maps side by side, each one with a WMS layer,
    as follows:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们将创建两个并排的地图，每个地图都包含一个WMS图层，如下所示：
- en: '[PRE33]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Next, write the required JavaScript code to initialize both maps. The first
    one will contain a normal WMS layer, as follows :'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，编写所需的JavaScript代码以初始化两个地图。第一个将包含一个正常的WMS图层，如下所示：
- en: '[PRE34]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'The second map will contain a WMS layer pointing to the same server but working
    in single tile mode, as follows:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二个地图将包含一个指向同一服务器但在单瓦片模式下工作的WMS图层，如下所示：
- en: '[PRE35]'
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: How it works...
  id: totrans-244
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The recipe code is pretty easy. The long explanation at the beginning, on how
    WMS layers can work in single tile mode, is simply achieved in practice using
    the `singleTile` property of the `OpenLayers.Layer` class. Pan or zoom the maps
    to see how differently it works.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 菜单代码相当简单。开头冗长的解释，即WMS图层如何在单瓦片模式下工作，实际上只需使用`OpenLayers.Layer`类的`singleTile`属性即可实现。拖动或缩放地图以查看其工作方式的不同。
- en: See also
  id: totrans-246
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Buffering the layer data to improve the map navigation* recipe
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*缓存图层数据以改善地图导航*菜谱'
- en: The *Adding WMS layer* recipe
  id: totrans-248
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加WMS图层*菜谱'
- en: The *Changing the layer opacity* recipe
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*更改图层不透明度*菜谱'
- en: Buffering the layer data to improve the map navigation
  id: totrans-250
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 缓存图层数据以改善地图导航
- en: Map navigation is an important factor to take into account to make the user
    experience better.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 地图导航是改善用户体验的重要因素。
- en: When we pan the map, many times we get to see blank areas (meaning that the
    content is loading) and after a few seconds the image appears.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们平移地图时，很多时候我们会看到空白区域（表示内容正在加载），几秒钟后图像出现。
- en: On gridded layers and WMS layers working in single tile mode, we can improve
    this at the cost of increasing the requests number or increasing the computation
    time at the server side.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 在栅格图层和在单瓦片模式下工作的WMS图层上，我们可以通过增加请求次数或增加服务器端的计算时间来改善这一点。
- en: Note
  id: totrans-254
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Most of the raster layers inherit from the base class `OpenLayers.Layer.Grid`,
    which is responsible for dividing each zoom level into tiles.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数栅格图层都继承自基类`OpenLayers.Layer.Grid`，该类负责将每个缩放级别划分为瓦片。
- en: For WMS layers working in single tile mode, the grid is formed only by one tile,
    which fills the whole map view.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 对于在单瓦片模式下工作的WMS图层，网格仅由一个瓦片组成，该瓦片填充整个地图视图。
- en: The idea behind improving map navigation is simple; load the tiles outside the
    map view so that they are loaded before the user pans the map view in that direction.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 改善地图导航背后的想法很简单；在用户在地图视图中平移之前加载瓦片，以便它们在用户平移地图视图之前加载。
- en: This recipe shows you how to preload content outside the map view, both for
    gridded layers and also for WMS layers working in single tile mode, so that you
    can improve the navigation experience of the users.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 本菜谱向您展示了如何为栅格图层和在单瓦片模式下工作的WMS图层预加载内容，以便您可以改善用户的导航体验。
- en: How to do it...
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Create an HTML file and include the OpenLayers dependencies.
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个HTML文件并包含OpenLayers依赖项。
- en: 'We are going to create two maps side by side and on top of each one we are
    going to add a spinner control, from the Dojo Toolkit framework ([http://dojotoolkit.org](http://dojotoolkit.org)),
    to control the properties `buffer` and `singleTile` values:'
  id: totrans-261
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将创建两个并排的地图，并在每个地图上方添加一个旋转控件，该控件来自Dojo Toolkit框架（[http://dojotoolkit.org](http://dojotoolkit.org)），用于控制`buffer`和`singleTile`属性值：
- en: '[PRE36]'
  id: totrans-262
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The left-hand side panel will show how to control the number of tiles that
    can be loaded outside the map view:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 左侧面板将展示如何控制可以加载到地图视图之外瓦片数量：
- en: '[PRE37]'
  id: totrans-264
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The right-hand side panel shows how to control the amount of data you can preload
    in a WMS layer working in single tile mode.
  id: totrans-265
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右侧面板显示了如何控制在单瓦片模式下工作的WMS图层中可以预加载的数据量。
- en: '[PRE38]'
  id: totrans-266
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Finally, there is the code responsible for changes on the spinner controls,
    shown as follows:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，以下是负责在旋转控件上更改代码的代码，如下所示：
- en: '[PRE39]'
  id: totrans-268
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: How it works...
  id: totrans-269
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The left-hand side map contains a WMS layer working in the default tiled mode.
    In this mode, the `buffer` property from the base class `OpenLayers.Layer.Grid`
    specifies how many tiles must be loaded outside the map view.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧地图包含一个在默认瓦片模式下工作的WMS图层。在此模式下，基类`OpenLayers.Layer.Grid`中的`buffer`属性指定了必须加载到地图视图之外的瓦片数量。
- en: 'When a user changes the spinner value for the `buffer` property, we simply
    update it with the following line of code:'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户更改`buffer`属性的旋转控件值时，我们只需使用以下代码行更新它：
- en: '[PRE40]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The right-hand side map, on the other hand, has a WMS layer working in single
    tile mode (see the `singleTile` property set to `true)`. In this mode, only one
    request is made to get an image, which fills the whole map view.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 右侧的地图另一方面有一个在单瓦片模式下工作的WMS图层（见 `singleTile` 属性设置为 `true`）。在这种模式下，只发出一个请求来获取图像，该图像填充整个地图视图。
- en: We can control the size of the image with the `ratio` property, which belongs
    to the `OpenLayers.Layer.WMS` class. A ratio of value 1.0 means an image with
    exact dimensions of the map view. By default the ratio value is 1.5, which means
    we are requesting an image with the map view dimensions plus a half.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过 `ratio` 属性来控制图像的大小，该属性属于 `OpenLayers.Layer.WMS` 类。值为 1.0 的比率意味着图像具有与地图视图精确尺寸相同的尺寸。默认的比率值是
    1.5，这意味着我们请求的图像尺寸是地图视图尺寸加上一半。
- en: 'In this case, the ratio value is set once while creating the layer and to update
    it we need to delete the previous layer and create a new one with the new value.
    This is done as follows:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，比率值在创建图层时设置一次，要更新它，我们需要删除之前的图层并使用新值创建一个新的图层。这如下所示：
- en: '[PRE41]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Note
  id: totrans-277
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We first remove the layer from the map and later invoke the `destroy()` method
    to free internal resources used by the layer and avoid memory leaks.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先从地图中删除图层，然后调用 `destroy()` 方法来释放图层使用的内部资源，避免内存泄漏。
- en: There's more...
  id: totrans-279
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更多...
- en: Remember, the more tiles we load the more requests to the server. The same goes
    for a WMS layer in single tile mode; the greater the bounding box you request,
    the greater the computation time on the server results.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，我们加载的瓦片越多，对服务器的请求就越多。对于单瓦片模式的WMS图层也是如此；你请求的边界框越大，服务器上的计算时间就越长。
- en: Because of this, increasing the `buffer` or `ratio` values too much is not always
    the best solution.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，过多地增加 `buffer` 或 `ratio` 值并不总是最佳解决方案。
- en: Think about your data and how the user will explore it. If your data is probably
    better to explore in its extension—a great area in the same zoom level—then a
    buffer of one or two can be a good idea. If your data is mainly zoomed but the
    user is not interested in exploring large areas, then the default values are fine.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑你的数据和用户如何探索它。如果你的数据更适合在扩展中探索——在同一缩放级别的一个大区域——那么一个一或两个像素的缓冲区可能是个好主意。如果你的数据主要被缩放，但用户对探索大区域不感兴趣，那么默认值就足够了。
- en: See also
  id: totrans-283
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Using WMS with single tile mode* recipe
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用单瓦片模式的WMS* 菜单'
- en: The *Setting the tile size in WMS layers* recipe
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*设置WMS图层中的瓦片大小* 菜单'
- en: The *Adding WMS layer* recipe
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*添加WMS图层* 菜单'
- en: Creating an image layer
  id: totrans-287
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建图像图层
- en: Sometimes a tiled layer, such as Google Maps, OpenStreetMap, or WMS, is not
    what you need. It is quite possible that you have a georeferenced image, knowing
    its projection and bounding box, and want to render it on the map.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候，像Google Maps、OpenStreetMap或WMS这样的瓦片图层并不是你需要的。完全有可能你有一个地理参考图像，知道它的投影和边界框，并想在地图上渲染它。
- en: 'In these cases, OpenLayers offers the `OpenLayers.Layer.Image` class that allows
    us to create a layer based on a simple image. A georeferenced image is shown in
    the following screenshot:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些情况下，OpenLayers提供了 `OpenLayers.Layer.Image` 类，允许我们基于简单图像创建图层。地理参考图像如下截图所示：
- en: '![Creating an image layer](img/7843_02_08.jpg)'
  id: totrans-290
  prefs: []
  type: TYPE_IMG
  zh: '![创建图像图层](img/7843_02_08.jpg)'
- en: How to do it...
  id: totrans-291
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'To create an image layer, perform the following steps:'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建图像图层，执行以下步骤：
- en: Let's go and create an HTML file with the OpenLayers dependencies.
  id: totrans-293
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们创建一个包含OpenLayers依赖项的HTML文件。
- en: 'First, add the `div` element that will hold the map, as follows:'
  id: totrans-294
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，添加将包含地图的 `div` 元素，如下所示：
- en: '[PRE42]'
  id: totrans-295
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Next, initialize the map and add a WMS base layer, as follows:'
  id: totrans-296
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，初始化地图并添加一个WMS基本图层，如下所示：
- en: '[PRE43]'
  id: totrans-297
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Now, define the image URL, its extent and size, and create an image layer as
    follows:'
  id: totrans-298
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，定义图像URL、其范围和大小，并按如下方式创建图像图层：
- en: '[PRE44]'
  id: totrans-299
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: How it works...
  id: totrans-300
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'The `OpenLayers.Layer.Image` class constructor needs five parameters, as follows:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer.Image` 类的构造函数需要五个参数，如下所示：'
- en: '**name:** This is the desired descriptive name for the layer'
  id: totrans-302
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**name:** 这是图层的期望描述性名称'
- en: '**url:** This is the URL for the image'
  id: totrans-303
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**url:** 这是图像的URL'
- en: '**extent:** This is an instance of the `OpenLayers.Bounds` class with the bounding
    box of the image'
  id: totrans-304
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**extent:** 这是一个 `OpenLayers.Bounds` 类的实例，包含图像的边界框'
- en: '**size:** This is an instance of the `OpenLayers.Size` with the image dimensions
    in pixels'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**size:** 这是一个 `OpenLayers.Size` 的实例，包含图像的像素尺寸'
- en: '**options:** This indicates a JavaScript object with different options for
    the layer'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**options:** 这表示一个包含图层不同选项的 JavaScript 对象'
- en: 'The image used in this recipe was previously obtained from NEXRAD (see [http://mesonet.agron.iastate.edu/current/mcview.phtml)](http://mesonet.agron.iastate.edu/current/mcview.phtml))
    so we know the exact coordinates of their bounding box. They are:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中使用的图像之前是从 NEXRAD 获得的（见 [http://mesonet.agron.iastate.edu/current/mcview.phtml](http://mesonet.agron.iastate.edu/current/mcview.phtml)），因此我们知道它们的边界框的确切坐标。它们是：
- en: '[PRE45]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Note
  id: totrans-309
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: It is important to note that the bounds must be expressed in the same projection
    as the map, in this case EPSG:4326.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示：边界必须以与地图相同的投影表示，在这种情况下为 EPSG:4326。
- en: 'We also know the image size in pixels:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还知道图像的大小（以像素为单位）：
- en: '[PRE46]'
  id: totrans-312
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Given the image extent and size, OpenLayers computes the appropriate resolutions
    (think of it as zoom levels) where the image must be shown.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 给定图像范围和大小，OpenLayers 计算适当的分辨率（将其视为缩放级别），在这些分辨率下必须显示图像。
- en: In this case, we always want to show the image on the map, no matter at which
    zoom level we are, and because of this we have used the `alwaysInRange` property
    set to `true`.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们始终希望在地图上显示图像，无论我们处于哪个缩放级别，因此我们已将 `alwaysInRange` 属性设置为 `true`。
- en: See also
  id: totrans-315
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Adding WMS layer* recipe
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Adding WMS layer* 菜谱'
- en: The *Using WMS with single tile mode* recipe
  id: totrans-317
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用单瓦片模式的 *Using WMS with single tile mode* 菜谱
- en: The *Buffering the layer data to improve the map navigation* recipe
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*Buffering the layer data to improve the map navigation* 菜谱'
- en: Setting the tile size in WMS layers
  id: totrans-319
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 WMS 图层中设置瓦片大小
- en: The `OpenLayers.Layer.Grid` class is a special kind of layer, which divides
    the layer in different zoom levels composed of a grid of tiles.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer.Grid` 类是一种特殊的图层，它将图层划分为由瓦片网格组成的不同缩放级别的图层。'
- en: The `OpenLayers.Layer.WMS` class is a subclass of the preceding one and, in
    addition to working in single tile mode, it can work in tiled mode as well.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '`OpenLayers.Layer.WMS` 类是前面类的子类，除了在单瓦片模式下工作外，它还可以在瓦片模式下工作。'
- en: Of course, controlling the size of the tiles of the WMS request can affect the
    performance. By default, the tile size is 256 x 256 pixels, but we can set this
    to any desired value. Bigger tile sizes means less request to the server but more
    computation time to generate a bigger image. On the contrary, smaller tile sizes
    means more server requests and less time to compute smaller images.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，控制 WMS 请求的瓦片大小可以影响性能。默认情况下，瓦片大小为 256 x 256 像素，但我们可以将此设置为任何所需的值。更大的瓦片大小意味着对服务器的请求更少，但生成更大图像的计算时间更长。相反，较小的瓦片大小意味着对服务器的请求更多，计算较小图像的时间更少。
- en: How to do it...
  id: totrans-323
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'To set the tile size, perform the following steps:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置瓦片大小，请执行以下步骤：
- en: Create an HTML file with OpenLayers library dependency.
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含 OpenLayers 库依赖关系的 HTML 文件。
- en: 'Add a `div` element that will hold the map, as follows:'
  id: totrans-326
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个 `div` 元素，该元素将包含地图，如下所示：
- en: '[PRE47]'
  id: totrans-327
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Next, initialize the map and add two layers, as follows:'
  id: totrans-328
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，初始化地图并添加两个图层，如下所示：
- en: '[PRE48]'
  id: totrans-329
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'For the second layer, specify the size of the tiles as follows:'
  id: totrans-330
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于第二层，指定瓦片大小如下：
- en: '[PRE49]'
  id: totrans-331
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: How it works...
  id: totrans-332
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: There is not much mystery in this recipe. The `tileSize` property is available
    both for `OpenLayers.Map` and `OpenLayers.Layer.Grid` subclasses.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中没有什么神秘之处。`tileSize` 属性对于 `OpenLayers.Map` 和 `OpenLayers.Layer.Grid` 子类都是可用的。
- en: The `tileSize` must be an instance of `OpenLayers.Size` class, indicating the
    width and height in pixels.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: '`tileSize` 必须是 `OpenLayers.Size` 类的实例，表示像素宽度和高度。'
- en: When the tile size is set in the map instance all layers use this value unless
    you specify another value for each individual layer.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 当在地图实例中设置瓦片大小时，所有图层都使用此值，除非您为每个单独的图层指定另一个值。
- en: By default, the OpenLayers.Map instance is configured to use 256 x 256 size
    tiles. Because of this, the first layer makes requests to the WMS server using
    a tile size of 256 x 256 pixels.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，OpenLayers.Map 实例配置为使用 256 x 256 大小的瓦片。因此，第一层使用 256 x 256 像素的瓦片大小向 WMS
    服务器发出请求。
- en: On the other hand, we have specified a 512 x 512 tile size value for the second
    layer, so the requests against the WMS are made waiting for tiles with 512 x 512
    size.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，我们已为第二层指定了 512 x 512 的瓦片大小值，因此对 WMS 的请求是在等待 512 x 512 大小的瓦片。
- en: There's more...
  id: totrans-338
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 还有更多...
- en: For tiled services, such as Google Maps or OpenStreetMap, the `tileSize` property
    is simply ignored because these services have precomputed the images in a fixed
    256 x 256 size.
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 对于瓦片服务，如 Google Maps 或 OpenStreetMap，`tileSize` 属性被简单地忽略，因为这些服务已经预先计算了固定 256
    x 256 大小的图像。
- en: The reason for the tile size value being 256 x 256 pixels is because the size
    (in bytes) of each image file is optimum for bandwidth use.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 瓦片大小值为 256 x 256 像素的原因是每个图像文件的大小（以字节为单位）对于带宽使用是最优的。
- en: See also
  id: totrans-341
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 参见
- en: The *Using WMS with single tile mode* recipe
  id: totrans-342
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*使用单瓦片模式的WMS* 菜单'
- en: The *Buffering the layer data to improve the map navigation* recipe
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*缓冲层数据以改善地图导航* 菜单'
