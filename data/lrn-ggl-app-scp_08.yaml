- en: Chapter 8. Building a Workflow Application
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章. 构建工作流应用程序
- en: In the previous chapter, you learned to create interactive web pages using `ContentService`,
    `HtmlService`, `doGet`, and `doPost` functions. You also built RSS feed and timesheet
    applications.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，您学习了如何使用`ContentService`、`HtmlService`、`doGet`和`doPost`函数创建交互式网页。您还构建了RSS源和考勤应用程序。
- en: 'In this chapter, you will learn:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习：
- en: To create a workflow application
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建工作流应用程序
- en: The workflow involved in an order processing system
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订单处理系统涉及的工作流程
- en: A Google Sheet holds all data, needed to create a workflow application, on various
    steps. It acts as the backbone of the order processing system.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: Google表格包含了创建工作流应用程序所需的所有数据，涉及各个步骤。它作为订单处理系统的骨架。
- en: Tip
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'While working on published web applications, keep in mind that the following
    script code versions are independent of each other:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在处理已发布的Web应用程序时，请注意以下脚本代码版本是相互独立的：
- en: The already saved versions
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 已保存的版本
- en: The published version
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发布版本
- en: The last saved codes
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最后保存的代码
- en: So remember to publish the App every time you make updates to the code.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，请记住每次对代码进行更新时都要发布应用程序。
- en: Order processing workflow – steps explained
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 订单处理工作流 - 步骤说明
- en: 'The following are the steps involved in the order processing workflow:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在订单处理工作流程中涉及的步骤：
- en: The user opens an online form and sends an order by mentioning the item, quantity,
    delivery address, and mode of payment.
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用户打开在线表格，通过提及项目、数量、送达地址和支付方式来发送订单。
- en: The Google Sheet sends a confirmation e-mail to both the **User** and **Accounts**
    section.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Google表格向**用户**和**账户**部门发送确认电子邮件。
- en: The **Accounts** section verifies the payment and forwards it to the **Order
    Processing** section.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**账户**部分验证支付并将支付信息转发到**订单处理**部分。'
- en: The **Order Processing** section dispatches the order to the delivery address
    and updates shipment details.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**订单处理**部门将订单发送到送达地址并更新发货详情。'
- en: The user confirms the delivery.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 用户确认交付。
- en: 'You can also refer to the pictorial representation of these steps in the following
    image:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以参考以下图像中这些步骤的图示表示：
- en: '![Order processing workflow – steps explained](img/B05010_08_01.jpg)'
  id: totrans-20
  prefs: []
  type: TYPE_IMG
  zh: '![订单处理工作流 - 步骤说明](img/B05010_08_01.jpg)'
- en: Configuring Google Sheets
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置Google表格
- en: 'Various forms, e-mails, and their components are explained here:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 以下解释了各种表格、电子邮件及其组成部分：
- en: 'User form:'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户表格：
- en: Item
  id: totrans-24
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 项目
- en: Unit price
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单价
- en: Quantity
  id: totrans-26
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数量
- en: Total price (calculated)
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总价（计算得出）
- en: Delivery address
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 送达地址
- en: Phone
  id: totrans-29
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电话
- en: E-mail
  id: totrans-30
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电子邮件
- en: Payment details
  id: totrans-31
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支付详情
- en: Note
  id: totrans-32
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: Upon the order submission, the script sends confirmation e-mails to both the
    **User** and **Accounts** section.
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在订单提交后，脚本向**用户**和**账户**部门发送确认电子邮件。
- en: 'Confirmation e-mail to the user:'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送给用户的确认电子邮件：
- en: Order number
  id: totrans-35
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订单号
- en: Item
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 项目
- en: Unit price
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 单价
- en: Quantity
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数量
- en: Total price
  id: totrans-39
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 总价
- en: Delivery address
  id: totrans-40
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 送达地址
- en: Phone number
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电话号码
- en: Payment details
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支付详情
- en: 'E-mail to the **Accounts** section:'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送给**账户**部门的电子邮件：
- en: It is same as the user confirmation e-mail; however, an additional link to the
    dispatch form is included.
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 它与用户确认电子邮件相同；然而，还包括一个到发货表格的链接。
- en: Note
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: On receiving order e-mails, the **Accounts** section verifies if the payment
    details are okay, and then forwards that e-mail to the **Order Processing** section.
    The **Order Processing**/**Dispatch** section clicks on the link to open the dispatch
    form, fills in shipment details, and submits the form.
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在收到订单电子邮件后，**账户**部分会验证支付详情是否正确，然后将该电子邮件转发到**订单处理**部分。**订单处理**/**发货**部分会点击链接打开发货表格，填写发货详情，并提交表格。
- en: 'The dispatch form:'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发货表格：
- en: Order number
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订单号
- en: Item
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 项目
- en: Quantity
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数量
- en: Delivery address
  id: totrans-51
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 送达地址
- en: Shipment details
  id: totrans-52
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发货详情
- en: Note
  id: totrans-53
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: On the dispatch form submission, the script updates shipment details in the
    spreadsheet and sends a dispatch notification e-mail to the user.
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在提交发货表格时，脚本会在表格中更新发货详情，并向用户发送发货通知电子邮件。
- en: 'Post-dispatch e-mail to the user:'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发货后发送给用户的电子邮件：
- en: Order number
  id: totrans-56
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 订单号
- en: Delivery address
  id: totrans-57
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 送达地址
- en: Shipment details
  id: totrans-58
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发货详情
- en: Acknowledge the delivery (link)
  id: totrans-59
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确认交付（链接）
- en: Note
  id: totrans-60
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: The user clicks on the acknowledgement link, and then the script updates the
    delivery date corresponding to the order number row in the spreadsheet.
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 用户点击确认链接，然后脚本会更新表格中对应订单号行的交付日期。
- en: 'Now, create a new Google Sheet with two Sheets/tabs named `Orders` and `Stock`.
    Format the `Orders` Sheet column headers as shown in the following screenshot:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，创建一个新的Google表格，包含两个名为`订单`和`库存`的工作表/标签。按以下截图所示格式化`订单`表头：
- en: '![Configuring Google Sheets](img/B05010_08_03.jpg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
  zh: '![配置Google表格](img/B05010_08_03.jpg)'
- en: 'Format the `Stock` Sheet columns and populate the test data in it as shown
    here:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 格式化`库存`表列并按如下所示填充测试数据：
- en: '![Configuring Google Sheets](img/B05010_08_04.jpg)'
  id: totrans-65
  prefs: []
  type: TYPE_IMG
  zh: '![配置Google表格](img/B05010_08_04.jpg)'
- en: The items and corresponding unit prices will be populated in the `Orders` form.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 项目和相应的单价将在`订单`表中填充。
- en: Creating the Order form
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建订单表单
- en: 'In the `Code.gs` file, define the following global variables:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在`Code.gs`文件中，定义以下全局变量：
- en: '[PRE0]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Create the `doGet` function:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 创建`doGet`函数：
- en: '[PRE1]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The preceding function returns the `Order` form from the `Order.html` template.
    Create a new HTML file named `Order` and enter the following code in it:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的函数从`Order.html`模板返回`订单`表单。创建一个名为`Order`的新HTML文件，并在其中输入以下代码：
- en: '[PRE2]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Publish the script using the following settings:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下设置发布脚本：
- en: 'Execute the app as:'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以以下方式执行应用：
- en: '**Me** (your e-mail ID)'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**我**（你的电子邮件ID）'
- en: 'Who has access to the app:'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哪些人可以访问该应用：
- en: '**Anyone, even anonymous**'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '**任何人，即使是匿名用户**'
- en: 'Click on the **Deploy** button, authorize if asked. The rendered application
    will be similar to the following screenshot:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**部署**按钮，如果需要则进行授权。渲染的应用程序将类似于以下截图：
- en: '![Creating the Order form](img/B05010_08_05.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![创建订单表单](img/B05010_08_05.jpg)'
- en: This form is a basic one and not fancy. The item's selections are hard coded;
    only five fixed items. The user may not know the items which are currently available
    with the supplier, any new items that have been added to the list, or the current
    unit price for each item. Above all, we did not add any functionality to the **Submit**
    button.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 此表单是一个基本的，不是花哨的。项目的选择是硬编码的；只有五个固定项目。用户可能不知道供应商目前有哪些项目，列表中添加了哪些新项目，或者每个项目的当前单价。更重要的是，我们没有为**提交**按钮添加任何功能。
- en: Enhancing the Order form
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 增强订单表单
- en: 'To enhance the `Order` form, update the `doGet` function as follows:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 为了增强`订单`表单，更新`doGet`函数如下：
- en: '[PRE3]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The price list is assigned to the template as a 2-dimensional array and is
    returned by the function shown here:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 价格列表被分配给模板作为二维数组，并由以下函数返回：
- en: '[PRE4]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'In the `Order.html` file, update the `select` tag markup as shown in this code
    snippet:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在`Order.html`文件中，更新`select`标签标记，如以下代码片段所示：
- en: '[PRE5]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The drop-down items will reflect whatever is included or updated in the `Stock`
    Sheet. The default item will be the top-most or the first item in the list. So
    we have to put a default unit price for that item. Hence, update the **Unit price**
    input field as shown here:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 下拉菜单将反映`库存`表中包含或更新的内容。默认项将是列表中最上面的或第一项。因此，我们必须为该项设置一个默认单价。因此，更新如此处所示的**单价**输入字段：
- en: '[PRE6]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The `Order` form users are not going to enter the unit price, so it can be read
    only. We set default value for `quantity` as `1` and the default value for the
    total price as the unit price.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 用户不会在`订单`表单中输入单价，因此它应该是只读的。我们将`数量`的默认值设置为`1`，将总价的默认值设置为单价。
- en: 'Update the `body` tag as follows:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 更新`body`标签如下：
- en: '[PRE7]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'For the `select` element, we need an `onchange` event handler so that, if the
    user selects any item, the corresponding unit price should be retrieved from the
    spreadsheet and displayed in the **Unit price** input field. At the same time,
    the total price should be calculated as per quantity and unit price. Add script
    handlers along with the CSS style sheet in the `head` element. Update the code
    for the `head` tag as shown here:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 对于`select`元素，我们需要一个`onchange`事件处理器，以便如果用户选择任何项目，相应的单价应从电子表格中检索并显示在**单价**输入字段中。同时，根据数量和单价计算总价。在`head`元素中添加脚本处理器以及CSS样式表。更新`head`标签的代码如下：
- en: '[PRE8]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The `getPrice` server function needs to recognize the selected item index as
    an argument, so we will update it as shown here:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '`getPrice`服务器函数需要识别所选项目索引作为参数，因此我们将更新如下所示：'
- en: '[PRE9]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Now, this function works when called from the `doGet` function as well as from
    the preceding HTML client code. When called from the `doGet` function, it returns
    the complete price list, otherwise just the unit price of a selected item.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，这个函数在从`doGet`函数调用以及从前面的HTML客户端代码调用时都起作用。当从`doGet`函数调用时，它返回完整的价格列表，否则只返回所选项目的单价。
- en: 'This helper function validates an e-mail. Returns `true` if valid otherwise
    `false`:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 此辅助函数验证电子邮件。如果有效则返回`true`，否则返回`false`：
- en: '[PRE10]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Next, add a form submission handler function (`postOrder`). If the order is
    placed, then this handler should update the spreadsheet and send an e-mail confirmation
    to the user as well as to the **Accounts** department:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，添加一个表单提交处理函数（`postOrder`）。如果订单已下，则此处理程序应更新电子表格并发送电子邮件确认给用户以及**会计部门**：
- en: '[PRE11]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Remember to publish the script again with a new version. Now, the form should
    look like this:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 记得再次发布脚本，使用新版本。现在，表单应如下所示：
- en: '![Enhancing the Order form](img/B05010_08_06.jpg)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![增强订单表单](img/B05010_08_06.jpg)'
- en: 'The sample submitted data in the spreadsheet looks as follows:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 电子表格中提交的样本数据如下：
- en: '![Enhancing the Order form](img/B05010_08_07.jpg)'
  id: totrans-106
  prefs: []
  type: TYPE_IMG
  zh: '![增强订单表单](img/B05010_08_07.jpg)'
- en: 'The sample content of the user e-mail looks as follows:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 用户电子邮件样本内容如下：
- en: '![Enhancing the Order form](img/B05010_08_08.jpg)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![增强订单表单](img/B05010_08_08.jpg)'
- en: The only difference of the e-mail content to the **Accounts** section is an
    additional link (which you can see in the sample e-mail content screenshot as
    follows) of the dispatch form (we will create this form next).
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 电子邮件内容与**会计部门**部分的不同之处在于附加了一个分发表单的链接（你可以在样本电子邮件内容截图如下看到）。（我们将在下一部分创建此表单）。
- en: '![Enhancing the Order form](img/B05010_08_09.jpg)'
  id: totrans-110
  prefs: []
  type: TYPE_IMG
  zh: '![增强订单表单](img/B05010_08_09.jpg)'
- en: 'Up to this point, what we have set up is:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经设置如下：
- en: The user can submit the `Order` form
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户可以提交`Order`表单
- en: Script appends the submitted data to the spreadsheet
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 脚本将提交的数据附加到电子表格中
- en: Script sends confirmation e-mails both to the user and the **Accounts** department
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 脚本向用户和**会计部门**发送确认电子邮件
- en: Creating the dispatch form
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建分发表单
- en: 'As mentioned earlier, we will create the dispatch form now. Create a new HTML
    file named as `Dispatch` and enter the following code in it:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，我们现在将创建分发表单。创建一个名为`Dispatch`的新HTML文件，并在其中输入以下代码：
- en: '[PRE12]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The script handlers are a subset of the `Order` form handlers, and most of
    the HTML elements are read-only, except the shipment details. The dispatch form
    looks like:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本处理程序是`Order`表单处理程序的子集，并且大多数HTML元素都是只读的，除了运输详情。分发表单如下所示：
- en: '![Creating the dispatch form](img/B05010_08_10.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![创建分发表单](img/B05010_08_10.jpg)'
- en: We can use only one `doGet` function in a script project or web application,
    but we have to use two forms with the same published URL. How can we open two
    different forms with the same published URL?
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在脚本项目或Web应用程序中，我们只能使用一个`doGet`函数，但我们必须使用两个具有相同发布URL的表单。我们如何使用相同的发布URL打开两个不同的表单？
- en: 'You remember that we appended the order number to the published URL in the
    `postOrder` handler. An example of the dispatch URL with the order number as a
    query string will look as follows:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 你记得我们在`postOrder`处理程序中向发布URL附加了订单号。带有订单号作为查询字符串的分发URL示例如下：
- en: '[PRE13]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The preceding URL is nothing but the published URL with the order number appended
    as a query string.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的URL只是带有订单号附加为查询字符串的发布URL。
- en: 'We will update the `doGet` function to parse this query string. If the order
    number is present, then return the dispatch form; otherwise, return the `Order`
    form:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将更新`doGet`函数以解析此查询字符串。如果存在订单号，则返回分发表单；否则，返回`Order`表单：
- en: '[PRE14]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Now, the `doGet` function can handle both situations.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，`doGet`函数可以处理这两种情况。
- en: Dispatching the articles
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 分发文章
- en: 'As soon as the dispatch person enters the shipment details in the dispatch
    form and submits it, the script should update the shipment details in the spreadsheet
    and should send a notification e-mail to the user. So, we will add the `dispatchOrder`
    server function to handle these tasks:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦分发人员将运输详情输入到分发表单并提交，脚本应更新电子表格中的运输详情，并向用户发送通知电子邮件。因此，我们将添加`dispatchOrder`服务器函数来处理这些任务：
- en: '[PRE15]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'A sample dispatch notification e-mail content is shown here:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这里显示了分发通知电子邮件的样本内容：
- en: '![Dispatching the articles](img/B05010_08_11.jpg)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![分发文章](img/B05010_08_11.jpg)'
- en: Enabling the user to acknowledge the article delivery
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启用用户确认文章交付
- en: If the user receives the items, then he/she clicks on the link to acknowledge.
    The same published URL is used this time too with an additional delivered query
    string.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户收到物品，则他/她点击链接以确认。这次也使用相同的发布URL，并附加一个交付查询字符串。
- en: 'For example:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE16]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'To handle this query, the `doGet` function should be updated again as follows:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 为了处理此查询，`doGet`函数应再次更新如下：
- en: '[PRE17]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Another handler, the `updateDelivery` function, should be added as follows:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 应添加另一个处理程序，即`updateDelivery`函数，如下所示：
- en: '[PRE18]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'This function updates the current date as the delivered date. A sample spreadsheet
    with the `Delivered on` column updated is shown as follows:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 此函数将当前日期更新为交付日期。以下是一个已更新“交付日期”列的示例电子表格：
- en: '![Enabling the user to acknowledge the article delivery](img/B05010_08_12.jpg)'
  id: totrans-141
  prefs: []
  type: TYPE_IMG
  zh: '![启用用户确认文章交付](img/B05010_08_12.jpg)'
- en: Congratulations! You have created a full-blown, real-world order processing
    workflow application.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜！您已创建了一个完整的、真实的订单处理工作流应用程序。
- en: Summary
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned and created a useful real-world order processing
    application. In the next chapter, you will learn to overcome script in maximum
    execution time and learn to use script code from other script files or libraries
    including OAuth library. You will also learn to create add-ons.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您学习了并创建了一个有用的真实世界订单处理应用程序。在下一章中，您将学习如何克服最大执行时间限制，并学习如何使用来自其他脚本文件或库的脚本代码，包括OAuth库。您还将学习如何创建附加组件。
