# 前言

**JavaScript 疲劳症**曾是 2016 年的一个流行术语，那时新的库和框架每天都在涌现。这促进了多样性，但也让开发者因为选择过多而感到疲惫。即使今天，开发者也被期望拥有使用**构建工具**、**代码检查器**、**测试框架**、**断言库**、**包管理器**、**模块加载器**、**模块打包器**、**路由器**、**Web 服务器**、**编译器**、**转译器**、**静态类型检查器**、**虚拟 DOM 库**、**状态管理工具**、**CSS 预处理器**和**UI 框架**（我可能遗漏了一些）的经验。

没有 wonder 人们发现很难开始，甚至跟上 JavaScript。许多人花费了数天时间学习十几种不同的工具，只是为了设置他们的项目。而且这还是在他们写下一行代码之前！

尽管如此，这种多样性激增确实带来了**实际**的好处——它使我们远离了有偏见的框架，并允许我们将应用程序定制为许多较小模块的复合体。因此，我们不应该哀叹生态系统的情况，而应该花时间学习每个工具。

如果这听起来像是一项艰巨的任务，那么这本书将为您节省大量时间。

虽然今天的大多数编程书籍都详细探讨了单个框架、库或语言，但本书为您提供了在企业环境中广泛使用的各种工具和实践的坚实基础。每一个都为构建一个可靠、生产就绪的应用程序做出了贡献。换句话说，我们关注的是**广度**而非**深度**。

我们也重视结构胜过混乱；因此，我们非常强调建立**最佳实践**、遵循**流程**、**测试**、**基础设施**和**自动化**。如果这些词汇激起了您的兴趣，那么这本书非常适合您。

# 这本书面向的对象

传统上，大多数科技公司遵循水平结构，其中开发、测试和运营被划分为不同的部门。由于它们相互依赖，每个团队只能以最慢的团队的速度工作。

然而，近年来，我们看到了向**垂直****团队**的转变。垂直团队是根据项目需求组建的，每个团队负责整个流程的所有阶段——从收集需求到部署。这使得团队能够完全拥有整个功能，因为他们变得自给自足，可以按自己的节奏前进。因此，许多公司要求他们的开发者掌握广泛的技能集。

因此，这本书不仅是为那些渴望学习新工具的 JavaScript 开发者而写的，也是为所有希望保持当今就业市场相关性的开发者而写的。

# 本书涵盖的内容

与在线博客和网站不同，实体书有页数限制。因此，我们必须在包含的工具选择上非常严谨。最终，我们根据两个标准精选了工具和框架：

+   它必须在企业环境中普遍存在。

+   它必须有很大的可能性在很长时间内保持相关性（没有炒作驱动的发展！）。

这将工具列表缩小到这些工具——Git、npm、yarn、Babel、ESLint、Cucumber、Mocha、Istanbul/NYC、Selenium、OpenAPI/Swagger、Express、Elasticsearch、React、Redux、Webpack、Travis、Jenkins、NGINX、Linux、PM2、Docker 和 Kubernetes。我们将利用这些工具构建一个简单但健壮的用户目录应用程序，该应用程序由后端 API 和前端 Web 用户界面（UI）组成。

本书分为五个部分：

+   第一章至第三章 – 提供本书其余部分背景的理论和实践概述

+   第四章至第十三章 – 开发后端 API

+   第十四章至第十六章 – 开发与 API 相连的前端 Web 应用程序

+   第十七章至第十八章 – 使用 Docker 和 Kubernetes 在可扩展的基础设施上部署我们的服务

+   第十九章至第二十章 – 解释重要的 JavaScript 概念和语法

# 第一部分 – 理论与实践

第一章，*良好代码的重要性*，解释了**技术债务**的负面影响，以及如何通过实施**测试驱动开发**（**TDD**）来减轻这种影响。

第二章，*JavaScript 的现状*，概述了从遵循**客户端-服务器模型**到**单页应用（SPA**）的演变过程，以及 JavaScript 和 Node.js 在这次转型中所扮演的角色。

第三章，*使用 Git 管理版本历史*，介绍了**版本控制**（**VC**）的概念。具体来说，我们将学习如何与**Git**、**Git Flow**和**GitHub**一起工作。

# 第二部分 – 开发我们的后端 API

第四章，*设置开发工具*，解释了 JavaScript 中的不同**模块格式**，包括**CommonJS**和**ES6 模块**。我们还将使用`nvm`、`yarn`、`Babel`、`nodemon`和`ESLint`等工具设置我们的本地环境。

第五章，*编写端到端测试*，通过教授你如何使用**Cucumber**和**Gherkin**编写**端到端**（**E2E**）测试来练习 TDD。我们还将作为重构步骤的一部分将我们的 API 迁移到**Express**。

第六章，*在 Elasticsearch 中存储数据*，在我们将应用程序数据持久化到**Elasticsearch**，一个**NoSQL** **文档存储**和**搜索引擎**的过程中继续我们的 TDD 之旅。在章节的末尾，我们还将编写一些**Bash**脚本来简化我们的测试过程。

第七章，*模块化我们的代码*，将我们的应用程序分解成更小的模块。我们还将把**JSON Schema**和**Ajv**集成到我们的验证模块实现中。

第八章，*编写单元/集成测试*，将教你如何使用**Mocha**编写**单元**和**集成**测试。为了将我们的单元测试与外部依赖项隔离，我们将重构我们的代码以遵循**依赖注入**（**DI**）模式，并使用**Sinon**的**间谍**和**存根**来模拟这些依赖项。最后，我们将使用**Istanbul**/`nyc`提供**测试覆盖率**报告，这将帮助我们识别错误并提高代码质量。

第九章，*设计我们的 API*，从对**表示状态转移**（**REST**）的讨论开始——它是什么，以及它不是什么。然后，我们将检查不同类型的致性——**通用**、**本地**、**横跨**、**领域**和**永久**——并了解它们如何有助于提供直观的开发者体验。

第十章，*在 VPS 上部署您的应用程序*，提供了如何将我们的 API 部署到**虚拟专用服务器**（**VPS**）的逐步说明。你将学习如何购买**域名**、配置**域名系统**（**DNS**）记录、设置**NGINX**作为**反向代理**，以及使用**PM2**保持 Node.js 进程的活跃。

第十一章，*持续集成*，将**持续集成**（**CI**）管道集成到我们的开发过程中。我们首先使用一个名为**Travis**的托管平台，然后部署我们自己的自托管**Jenkins** CI 服务器。

第十二章，*安全：身份验证和授权*，介绍了支撑**授权**以及基于**密码**、**会话**和**令牌**的身份验证的概念。这些包括**加密散列**、**盐**和**JSON Web Tokens**（**JWTs**）。

第十三章，*记录我们的 API*，通过使用**Swagger**记录我们的 API 来完成 API 的开发。你将学习如何使用**YAML**编写**OpenAPI**兼容的规范，并使用**Swagger UI**可视化它们。

# 第三部分 - 开发我们的前端 UI

第十四章，*使用 React 创建 UI*，从基本原理开始讲解**React**，讨论诸如**虚拟 DOM**、**纯组件**和**JSX**等概念。在章节末尾，我们还将比较不同的**模块打包器**和**加载器**，例如**Webpack**、**Rollup**和**SystemJS**。

第十五章，*React 中的端到端测试*，利用你在上一章中学到的 React 知识来实现一个涉及 Cucumber 和**Selenium**以及使用**无头浏览器**的 TDD 工作流程。我们将遵循此流程将**客户端路由**集成到我们的应用程序中。

第十六章，*使用 Redux 管理状态*，解释了如何使用 **Redux** 保持应用程序状态的一致性。

# 第四部分 – 基础设施和自动化

第十七章，*迁移到 Docker*，将我们的应用程序迁移到在 **Docker** **容器**内运行。最初，你将学习关于 **控制组** 和 **命名空间** 以及它们如何使容器工作。然后，你将编写自己的 **Dockerfile** 并构建和优化你的 Docker **镜像**。

第十八章，*使用 Kubernetes 构建健壮的基础设施*，使用 **Kubernetes** 将我们的应用程序部署到集群中，**Kubernetes** 是一个结合了 **发现服务**、**全局配置存储**、**调度器**和**负载均衡器**的 **集群管理工具**。这确保了我们的应用程序是**高可用性**、**可靠性**、**可扩展性**和**性能**的。

# 第五部分 – 重要 JavaScript 概念和语法

这些是针对想要更深入理解 JavaScript 的读者提供的在线附加章节。

第十九章，*JavaScript 的重要概念*，提供了关于 JavaScript 最基本（也是最被忽视）原则的全面入门，包括 **数据类型**、**原型**、**原型继承链**、ES6 **类**、`this`、**上下文**和**执行上下文**。

[`www.packtpub.com/sites/default/files/downloads/ImportantConceptsinJavaScript.pdf`](https://www.packtpub.com/sites/default/files/downloads/ImportantConceptsinJavaScript.pdf)

第二十章，*在 ECMAScript 2015+ 中编写*，指导你了解 JavaScript 的新特性，如 `let`/`const`、**默认值**、**解构赋值**、**剩余**和**扩展**操作符、**模板字符串**和**承诺**。

[`www.packtpub.com/sites/default/files/downloads/WritinginECMAScript2015.pdf`](https://www.packtpub.com/sites/default/files/downloads/WritinginECMAScript2015.pdf)

# 未涵盖的内容

如你所知，由于这本书涵盖了所有这些工具，因此不可能对任何一项进行深入探讨。因此，我们选择了最基本的概念来涵盖，将更详细的内容留给更高级的书籍。

也有一些我们想要包含但篇幅有限的主题。值得注意的是，以下重要概念并未涵盖：

+   使用 TypeScript 或 Flow 进行静态类型检查

+   使用 Puppet/Ansible 进行配置管理

+   使用 Prometheus 和 Grafana 监控和可视化指标

+   使用 Logstash/Kafka 进行分布式日志记录

+   使用 Zipkin 进行跟踪

+   使用 Artillery 进行压力/负载测试

+   备份和灾难恢复

# 要充分利用这本书

我们将这本书的结构设计得如此，每一章都是基于前一章的。因此，这本书旨在按顺序阅读。

本书重点介绍 JavaScript 生态系统中的工具和框架，而不是 JavaScript 语言本身。因此，我期望本书的读者对 JavaScript 语法有一个基本的了解。

在我们介绍每个工具之前，我们将尝试回答以下问题：

+   它试图解决什么问题？

+   它在底层是如何工作的？

+   为什么我们选择这个工具而不是它的替代品？

您应该将这本书视为一个学习练习，而不是参考手册。我们希望您理解为什么需要一个工具，而不仅仅是将示例代码复制粘贴到您的终端或编辑器中。因此，在未来的某个时候，我们可能会以次优的方式实现一个功能，只是为了稍后改进它。

我们还期望您亲自动手编写大量代码。在本书的许多部分，我们将向您介绍所需的概念，引导您通过几个示例，然后让您自己实现其余部分。我们强烈鼓励您利用这个机会来练习您所学到的知识；然而，如果您遇到困难，或者渴望进入下一章，您始终可以参考书中附带的代码包。

由于生态系统快速变化的特点，许多工具在本书出版后不可避免地会引入破坏性更改。因此，一些说明可能无法按描述工作。在这种情况下，您应该阅读工具作者发布的发布说明或迁移指南；或者，您也可以在网上和问答网站上寻求帮助。在我们的方面，我们将努力保持我们托管在 GitHub 上的代码包中的包版本和说明的更新。

本书中的说明旨在在运行 GNU/Linux 的机器上运行，特别是 Ubuntu 18.04。使用其他操作系统的读者仍然可以跟随，但在设置和调试时可能需要更多努力。使用 Windows 机器的读者应将他们的计算机设置为双启动 Ubuntu 和 Windows；您可以在[help.ubuntu.com/community/WindowsDualBoot](https://help.ubuntu.com/community/WindowsDualBoot)找到详细说明。或者，如果您使用的是 Windows 10，您可以安装**Windows Subsystem for Linux**（**WSL**），这允许您在 GNU/Linux 上本地运行您通常期望在 GNU/Linux 中看到的命令行工具和应用程序。您可以在[docs.microsoft.com/en-us/windows/wsl/](https://docs.microsoft.com/en-us/windows/wsl/)找到详细说明。

最后，本书是 16 个月旅程的结晶。我在旅途中学到了很多，也增添了几缕白发。我希望您阅读这本书时能像我写作时一样享受乐趣！

# 下载示例代码文件

您可以从 [www.packtpub.com](http://www.packtpub.com) 的账户下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问 [www.packtpub.com/support](http://www.packtpub.com/support) 并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在 [www.packt.com](http://www.packt.com) 登录或注册。

1.  选择“支持”选项卡。

1.  点击“代码下载与勘误”。

1.  在搜索框中输入书籍名称，并遵循屏幕上的说明。

一旦文件下载完成，请确保使用最新版本的软件解压或提取文件夹：

+   WinRAR/7-Zip for Windows

+   Zipeg/iZip/UnRarX for Mac

+   7-Zip/PeaZip for Linux

本书代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Building-Enterprise-JavaScript-Applications`](https://github.com/PacktPublishing/Building-Enterprise-JavaScript-Applications)。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还有其他来自我们丰富图书和视频目录的代码包可供选择，请访问**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**。查看它们！

# 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“将下载的`WebStorm-10*.dmg`磁盘映像文件挂载为系统中的另一个磁盘。”

代码块设置如下：

```js
{
  "files": ["*.test.js"],
  "env": {
      "mocha": true
  },
  "rules": {
      "func-names": "off",
      "prefer-arrow-callback": "off"
  }
}
```

任何命令行输入或输出都应如下编写：

```js
$ npx mocha
$ npx mocha "src/**/*.test.js"
```

**粗体** 或 *斜体*：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中如下显示。以下是一个示例：“从管理面板中选择系统信息。”

警告或重要提示看起来像这样。

小贴士和技巧看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书籍标题，并通过以下电子邮件地址**`customercare@packtpub.com`**联系我们。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现错误，我们将不胜感激，如果您能向我们报告，请访问 [www.packt.com/submit-errata](http://www.packt.com/submit-errata)，选择您的书籍，点击勘误提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过以下电子邮件地址**`copyright@packtpub.com`**与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问 [authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用过这本书，为何不在购买该书的网站上留下评论呢？潜在读者可以查看并使用您的客观意见来做出购买决定，我们 Packt 可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

如需了解 Packt 的更多信息，请访问 [packt.com](http://packt.com)。
