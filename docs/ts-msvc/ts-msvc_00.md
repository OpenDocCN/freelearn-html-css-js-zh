# 前言

在过去的几年中，微服务已经成为摇滚明星，并且现在是企业中最切实可行的解决方案之一，用于快速、有效和可扩展的应用程序。微服务包括一种架构风格和模式，其中一个庞大的系统被分解为更小的服务，这些服务是自给自足的、自治的、自包含的，并且可以单独部署。

TypeScript 的明显崛起和从 ES5 到 ES6 的长期演变已经看到许多大公司转向 ES6 堆栈。由于其支持类和模块、静态类型检查和与 JavaScript 类似的语法等巨大优势，TypeScript 已成为许多企业的事实解决方案。由于其异步、非阻塞、轻量级的特性，Node.js 已被许多公司广泛任命。用 TypeScript 编写的 Node.js 为各种机会打开了大门。

然而，微服务也有自己的困难需要解决，比如监控、扩展、分发和服务发现。最大的挑战是规模化部署，因为我们不希望最终出现系统故障。在不了解或解决这些问题的情况下采用微服务将导致重大问题。本书最重要的部分涉及采用实用的技术独立方法来处理微服务，以便充分利用一切。

这本书分为三个部分，解释了这些服务是如何工作的，以及构建任何应用程序的微服务方式的过程。您将遇到基于设计的架构方法，以及实施各种微服务元素的指导。您将获得一组配方和实践，以满足实际、组织和文化挑战。这本书的目标是让用户了解一种实用的、逐步的方法，以实现规模化的反应式微服务。本书将带领读者深入了解 Node.js、TypeScript、Docker、Netflix OSS 等内容。本书的读者将了解如何使用 Node.js 和 TypeScript 部署可以独立运行的服务。用户将了解无服务器计算的不断发展趋势，以及不同的 Node.js 功能，实现 Docker 进行容器化的用途。用户将学习如何使用 Kubernetes 和 AWS 对系统进行自动扩展。

我相信读者会喜欢本书的每一部分。此外，我相信这本书不仅对 Node.js 开发人员有价值，对于其他想要尝试微服务并成功在业务中实施它们的人也有帮助。在整本书中，我采取了实用的方法，提供了许多例子，包括来自电子商务领域的案例研究。在本书结束时，您将学会如何使用 Node.js、TypeScript 框架和其他实用工具实现微服务架构。这些是经过实战考验的、强大的工具，用于开发任何微服务，并按照 Node.js 的最新规范编写。

# 这本书适合谁？

这本书适合寻求利用他们的 Node.js 和 TypeScript 技能构建微服务并摆脱单片式架构风格的 JavaScript 开发人员。假定读者具有 TypeScript 和 Node.js 的先验知识。本书将帮助回答一些关于微服务解决了什么问题以及组织如何结构化采用微服务的重要问题。

# 本书涵盖的内容

第一章《揭秘微服务》为您介绍了微服务的世界。它从单块到微服务架构的转变开始。本章使您熟悉了微服务世界的演变；回答了关于微服务经常被问到的问题，并让您熟悉了各种微服务设计方面、微服务的十二要素应用；以及微服务实现的各种设计模式，以及它们的优缺点，何时使用以及何时不使用它们。

第二章《为旅程做准备》介绍了 Node.js 和 TypeScript 中必要的概念。它从准备我们的开发环境开始。然后讨论了基本的 TypeScript 要点，比如类型、tsconfig.json、为任何节点模块编写自定义类型以及 Definitely Typed 存储库。然后，我们转向 Node.js，在那里我们用 TypeScript 编写我们的应用程序。我们将学习一些基本要点，比如 Node 集群、事件循环、多线程和 async/await。然后，我们转向编写我们的第一个 hello world TypeScript 微服务。

第三章《探索响应式编程》进入了响应式编程的世界。它探讨了响应式编程的概念以及其方法和优势。它解释了响应式编程与传统方法的不同之处，然后转向使用 Highland.js、Bacon.js 和 RxJS 的实际示例。最后，它比较了这三个库以及它们的优缺点。

第四章《开始您的微服务之旅》开始了我们的微服务案例研究——购物车微服务。它从系统的功能需求开始，然后是整体业务能力。我们从架构方面、设计方面和生态系统中的整体组件开始这一章，然后转向微服务的数据层，我们将深入讨论数据类型以及数据库层应该是什么样的。然后，我们以关注点分离的方式开发微服务，并学习一些微服务的最佳实践。

第五章《理解 API 网关》探讨了 API 网关涉及的设计。它解释了为什么需要 API 网关以及它的功能是什么。我们将探讨各种 API 网关设计以及其中的各种选项。我们将看看断路器以及它为何在客户端弹性模式中扮演重要角色。

第六章《服务注册表和发现》讨论了在您的微服务生态系统中引入服务注册表。服务的数量和/或位置可能会根据负载和流量而变化。固定的位置会扰乱微服务的原则。本章涉及解决方案，并深入讨论了服务发现和注册表模式。本章进一步解释了各种可用选项，并详细讨论了 Consul 和 Eureka。

第七章《服务状态和服务间通信》着重于服务间通信。微服务需要相互合作以实现业务能力。本章探讨了各种通信模式。然后讨论了包括 RPC 和 HTTP 2.0 协议在内的下一代通信样式。我们了解了服务状态以及状态可以持久化的位置。我们将介绍各种数据库系统以及它们的用例。本章探讨了缓存世界、在依赖项之间共享代码以及版本控制策略，并详细介绍了如何使用客户端弹性模式来处理故障。

第八章，《测试、调试和文档编制》，概述了开发之后的生活。我们学习如何编写测试用例，并通过一些著名的工具集深入了解 BDD 和 TDD 的世界。我们看到了微服务的合同测试——一种确保没有重大变化的方法。然后我们看到了调试以及如何对我们的服务进行性能分析以及我们可以使用的所有选项。我们继续进行文档编制，并了解文档编制的需求以及围绕 Swagger 的所有工具集，这是我们将使用的工具。

第九章，《部署、日志记录和监控》，涵盖了部署和其中涉及的各种选项。我们看到了一个构建流水线，并熟悉了持续集成和持续交付。我们详细了解了 Docker，并通过在微服务前面添加 Nginx 来将我们的应用程序 docker 化。我们继续进行日志记录，并了解了定制的、集中的日志记录解决方案的需求。最后，我们转向监控，并了解了各种可用的选项，如 keymetrics、Prometheus 和 Grafana。

第十章，《加固您的应用》，着眼于加固应用，解决安全性和可扩展性问题。它讨论了应该在部署时采取的安全最佳实践，以避免任何意外事件。它提供了一个详细的安全检查表，可在部署时使用。然后我们将学习如何使用 AWS 和 Kubernetes 实现可扩展性。我们将看到如何通过自动添加或删除 EC2 实例来解决 AWS 的扩展问题。本章以 Kubernetes 及其示例结束。

附录，《Node.js 10.x 和 NPM 6.x 有什么新内容？》，涵盖了 Node.js v10.x 和 NPM v6.x 的新更新。附录不在书中，但可以通过以下链接下载：[`www.packtpub.com/sites/default/files/downloads/Whats_New_in_Node.js_10.x_and_NPM_6.x.pdf`](https://www.packtpub.com/sites/default/files/downloads/Whats_New_in_Node.js_10.x_and_NPM_6.x.pdf)

我写这本书的目的是让这本书的主题与职业和业务用例相关、有用，并且最重要的是，专注于实用示例。我希望您阅读这本书时能像我写这本书时一样享受，这肯定会让您乐在其中！

# 为了充分利用本书

这本书需要在 Unix 机器上安装先决条件。在继续阅读本书之前，需要对 Node.js 和 TypeScript 有基本的了解。大部分代码在 Windows 上也可以运行，但安装方式不同；因此，建议使用 Linux（带有 Ubuntu 的 Oracle VM Box 也是一个完美的选择）。为了充分利用本书，尽快尝试练习示例并将概念应用到自己的示例中。这些程序或案例研究中的大多数都使用可以轻松安装或设置的开源软件。然而，有些情况确实需要设置一些付费设置。

在第九章，《部署、日志记录和监控》，我们需要在 logz.io 上拥有一个账户，以便准备完整的 ELK 设置，而不是单独管理它。试用版可用 30 天，但您可以延长一些计划。需要一个关键指标的账户来发掘其全部潜力。

在第十章，《加固您的应用》，您需要获取 AWS 账户以进行扩展和部署。您还需要获取 Google Cloud Platform，以独立测试 Kubernetes，而不是通过手动设置过程。这两个账户都有免费套餐，但您需要使用信用/借记卡进行注册。

# 下载示例代码文件

您可以从您在[www.packtpub.com](http://www.packtpub.com)的账户中下载本书的示例代码文件。如果您在其他地方购买了这本书，您可以访问[www.packtpub.com/support](http://www.packtpub.com/support)并注册，文件将直接发送到您的邮箱。

您可以按照以下步骤下载代码文件：

1.  登录或注册[www.packtpub.com](http://www.packtpub.com/support)。

1.  选择“支持”选项卡。

1.  点击“代码下载和勘误”。

1.  在搜索框中输入书名并按照屏幕上的说明操作。

下载文件后，请确保使用以下最新版本的软件解压缩文件夹：

+   WinRAR/7-Zip for Windows

+   Zipeg/iZip/UnRarX for Mac

+   7-Zip/PeaZip for Linux

本书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/TypeScript-Microservices`](https://github.com/PacktPublishing/TypeScript-Microservices)。如果代码有更新，将在现有的 GitHub 存储库中更新。

我们还有来自我们丰富书籍和视频目录的其他代码包，可在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**上找到。去看看吧！

# 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图片。您可以在这里下载：[`www.packtpub.com/sites/default/files/downloads/TypeScriptMicroservices_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/TypeScriptMicroservices_ColorImages.pdf)。

# 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。以下是一个例子：“在前面的表中可以找到所有运算符的示例，位于`rx_combinations.ts`、`rx_error_handing.ts`和`rx_filtering.ts`。”

代码块设置如下：

```ts
let asyncReq1=await axios.get('https://jsonplaceholder.typicode.com/posts/1');
console.log(asyncReq1.data);
let asyncReq2=await axios.get('https://jsonplaceholder.typicode.com/posts/1');
console.log(asyncReq2.data);
```

任何命令行输入或输出都将按照以下方式书写：

```ts
sudo dpkg -i <file>.deb
sudo apt-get install -f # Install dependencies
```

**粗体**：表示新术语、重要词或屏幕上看到的词。例如，菜单或对话框中的单词会在文本中以这种方式出现。以下是一个例子：“打开您的实例，然后转到负载均衡|负载均衡器选项卡。”

警告或重要提示会以这种方式出现。

提示和技巧会以这种方式出现。
