# 前言

CasperJS 是一款出色的命令行实用工具，提供广泛的 JavaScript API，用于脚本化和测试任何网页。与 Selenium 不同，CasperJS 并不自动化本地安装的网页浏览器；它表现得像一个真正的独立网页浏览器。

要自动化本地安装的网页浏览器，CasperJS 使用 PhantomJS，这是一个无头 WebKit 引擎。好吧，“无头 WebKit 引擎”可能听起来相当野蛮，但只需想象这是一个没有图形用户界面的 WebKit 引擎（Chrome 和 Safari 著名的网页引擎）。

因此，它基本上是一个网页浏览器。它可以加载网页，应用它们的 CSS，运行它们的 JavaScript，与它们的内容交互等；但当我们从命令行启动它时，我们不会在屏幕上看到任何东西。

与标准的图形用户界面不同，PhantomJS 提供了一个 JavaScript API，我们可以通过它来控制浏览器正在做什么。通过运行自己的网页引擎而不是自动化外部网页浏览器，PhantomJS 比 Selenium 快得多，轻得多。

不幸的是，PhantomJS 的 JavaScript API 非常底层。因此，通过快速编写一个简单的交互场景，你可能会得到一个相当庞大和冗长的脚本代码。

这正是 CasperJS 发挥作用的地方。它带来了两个宝贵的资产。首先，它有一个大型的高级 API，可以执行点击链接、填写表单和查找元素等操作；其次，它能够按顺序执行这些操作，而无需一个无尽的 JavaScript 回调链。

正因如此，我们的 CasperJS 脚本将与我们期望的简洁和可读性一样，这在处理测试时是无价的。

CasperJS 由 Nicolas Perriault 在 2011 年创建，并且他仍在积极维护它。所有的 CasperJS 用户都非常感激它。感谢 Nicolas！

# **本书涵盖的内容**

*安装 CasperJS（简单）* 解释了如何正确安装 PhantomJS 和 CasperJS 以及它们在机器上所需的系统依赖项，步骤详尽。

*CasperJS 入门（简单）* 涵盖了如何编写基本的 CasperJS 测试。从简单的脚本开始，我们将逐步熟悉 CasperJS 方法，发现可以使用 CasperJS 执行哪些断言，学习如何设置适当的时机以获得准确的测试，以及如何将网页会话记录为 CasperJS 脚本。

*编写高级测试（中级）* 详细介绍了如何使用 CasperJS 模拟丰富的网页交互，以实现更复杂的测试，例如处理文件、管理身份验证或高效地模拟键盘和鼠标事件。

*最佳实践（中级）* 专注于使我们的测试更加准确和健壮，并解释了如何使用持续集成（CI）工具，如 Jenkins 或 Travis CI，来运行它们。

*超越测试（高级）* 讨论了其他有趣的 CasperJS 用法，例如网页脚本化和自动截图或服务器端打印。

# 你需要这本书的内容

要执行本书中的示例，您需要一个与 Windows、Mac OS X 或 Linux 兼容的计算机，并且有足够的权限安装新软件。

# 本书面向对象

本书假设您熟悉 Web 开发，并且对 JavaScript 有良好的了解。

# 约定

在本书中，您将找到多种文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释。

文本中的代码单词如下所示：“我们可以使用`log`方法打印日志消息。”

代码块设置如下：

```js
casper.start('http://en.wikipedia.org/', function() {
    this.echo(this.getCurrentUrl());
});
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```js
casper.start('http://en.wikipedia.org/', function() {
 this.echo(this.getCurrentUrl());
});
```

任何命令行输入或输出都如下所示：

```js
~ casperjs test.js

```

**新术语**和**重要词汇**以粗体显示。屏幕上显示的单词，例如在菜单或对话框中，在文本中如下所示：“它显示一个**点击我**按钮，如果我们点击它，其标签将更改为**完成**。”

### 注意

警告或重要注意事项以如下框的形式出现。

### 小贴士

小技巧和技巧如下所示。

# 读者反馈

读者反馈始终欢迎。请告诉我们您对这本书的看法——您喜欢什么或可能不喜欢什么。读者反馈对我们开发您真正从中受益的标题非常重要。

要发送给我们一般反馈，只需发送电子邮件至`<feedback@packtpub.com>`，并在邮件主题中提及书名即可。

如果您需要一本书，并希望我们出版，请通过[www.packtpub.com](http://www.packtpub.com)上的**建议标题**表单或发送电子邮件至`<suggest@packtpub.com>`给我们留言。

如果您在某个主题上具有专业知识，并且对撰写或为书籍做出贡献感兴趣，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在，您已经成为 Packt 书籍的骄傲拥有者，我们有一些事情可以帮助您从购买中获得最大收益。

## 下载示例代码

您可以从[`www.PacktPub.com`](http://www.PacktPub.com)的账户下载您购买的所有 Packt 书籍的示例代码文件。如果您在其他地方购买了这本书，您可以访问[`www.PacktPub.com/support`](http://www.PacktPub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

## 错误清单

尽管我们已经尽一切努力确保我们内容的准确性，但错误仍然可能发生。如果您在我们的某本书中发现错误——可能是文本或代码中的错误——如果您能向我们报告这一点，我们将不胜感激。通过这样做，您可以避免其他读者的挫败感，并帮助我们改进本书的后续版本。如果您发现任何勘误，请通过访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，选择您的书籍，点击**勘误提交表单**链接，并输入您的勘误详情来报告它们。一旦您的勘误得到验证，您的提交将被接受，勘误将被上传到我们的网站，或添加到该标题的勘误部分下的现有勘误列表中。您可以通过从[`www.packtpub.com/support`](http://www.packtpub.com/support)选择您的标题来查看任何现有的勘误。

## 盗版

互联网上版权材料的盗版是一个跨所有媒体的持续问题。在 Packt，我们非常重视我们版权和许可证的保护。如果您在互联网上发现我们作品的任何非法副本，无论形式如何，请立即提供位置地址或网站名称，以便我们可以寻求补救措施。

请通过 `<copyright@packtpub.com>` 与我们联系，并提供疑似盗版材料的链接。

我们感谢您在保护我们作者以及为我们带来有价值内容方面的帮助。

## 问题

如果您在本书的任何方面遇到问题，可以通过 `<questions@packtpub.com>` 联系我们，我们将尽力解决。
