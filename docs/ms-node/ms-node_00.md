# 前言

互联网不再是被动消费的静态网站的集合。浏览器（和移动设备）用户希望获得更丰富和互动的体验。在过去的十年左右，网络应用程序已经开始类似于桌面应用程序。此外，对信息的社交特性的认识已经激发了新型界面和可视化的发展，这些界面和可视化模拟了动态网络状态，用户可以实时查看变化，而不是被困在过去的静态快照中。

尽管我们对软件的期望已经改变，但作为软件开发人员可用的工具并没有改变太多。计算机速度更快，多核芯片架构很常见。数据存储更便宜，带宽也更便宜。然而，我们仍然继续使用在十亿用户网站和云端虚拟机群的一键式管理之前设计的工具进行开发。

由于这个原因，网络应用程序的开发仍然是一个过于昂贵和缓慢的过程。开发人员使用不同的语言、编程风格，使代码维护、调试等变得复杂。非常经常，扩展问题出现得太早，超出了通常是一个小而经验不足的团队的能力。流行的现代软件功能，如实时数据、多人游戏和协作编辑空间，需要能够承载数千个同时连接而不弯曲的系统。然而，我们仍然局限于旨在帮助我们构建 CRUD 应用程序的框架，将单个关系数据库绑定到单个服务器上的单个用户，在桌面计算机上的浏览器上运行多页网站。

Node 帮助开发人员构建更具规模的网络应用程序。Node 基于 C++构建，并捆绑了 Google 的 V8 引擎，速度快，并且理解 JavaScript。Node 将世界上最流行的编程语言和最快的 JavaScript 编译器结合在一起，并通过 C++绑定轻松访问操作系统。Node 代表了网络软件设计和构建方式的变革。

# 本书内容

第一章 *理解 Node 环境*，简要描述了 Node 试图解决的特定问题，它们在 Unix 设计哲学中的历史和根源，以及 Node 作为系统语言的强大之处。我们还将学习如何在 V8（Node 的引擎）上编写优化的现代 JavaScript，包括对语言最新特性的简要介绍，这将帮助您升级您的代码。

第二章 *理解异步事件驱动编程*，深入探讨了 Node 设计的基本特征：事件驱动、异步编程。通过本章的学习，您将了解事件、回调和定时器在 Node 中的使用，以及事件循环如何实现跨文件系统、网络和进程的高速 I/O。我们还将了解现代并发建模构造，从默认的 Node 回调模式到 Promises、Generators、async/await 和其他流程控制技术。

第三章 *在节点和客户端之间传输数据*，描述了 I/O 数据流如何通过大多数网络软件编织在一起，由文件服务器发出或者作为对 HTTP GET 请求的响应进行广播。在这里，您将学习 Node 如何通过 HTTP 服务器、可读和可写文件流以及其他 I/O 集中的 Node 模块和模式的示例来促进网络软件的设计、实现和组合。您将深入了解流的实现，掌握 Node 堆栈的这一基本部分。

第四章 *使用 Node 访问文件系统*，介绍了在 Node 中访问文件系统时需要了解的内容，如何创建文件流进行读写，以及处理文件上传和其他网络文件操作的技术。您还将使用 Electron 实现一个简单的文件浏览应用程序。

第五章 *管理许多同时的客户端连接*，向您展示了 Node 如何帮助解决当代协作 Web 应用程序所需的高容量和高并发环境所伴随的问题。通过示例，学习如何高效地跟踪用户状态，路由 HTTP 请求，处理会话，并使用 Redis 数据库和 Express Web 应用程序框架对请求进行身份验证。

第六章 *创建实时应用程序*，探讨了 AJAX、服务器发送事件和 WebSocket 协议，在构建实时系统时讨论它们的优缺点，以及如何使用 Node 实现每个协议。我们通过构建一个协作文档编辑应用程序来结束本章。

第七章 *使用多个进程*，教授如何在多核处理器上分发 Node 进程集群，以及其他扩展 Node 应用程序的技术。对单线程和多线程环境编程的差异进行调查，讨论如何在 Node 中生成、分叉和与子进程通信，包括使用 PM2 进程管理器的部分。我们还构建了一个记录和显示多个同时连接的客户端通过一组 Web 套接字的鼠标操作的分析工具。

第八章 *扩展您的应用程序*，概述了一些检测何时扩展、如何扩展以及如何在多个服务器和云服务上扩展 Node 应用程序的技术，包括如何使用 RabbitMQ 作为消息队列，使用 NGINX 代理 Node 服务器，以及在应用程序中使用亚马逊网络服务的示例。本章以我们构建一个部署在 Heroku 上的强大的客户服务应用程序结束，您将学习如何使用 Twilio SMS 网关与 Node 配合使用。

第九章 *微服务*，介绍了微服务的概念——小型、独立的服务——以及我们是如何从单片和 3 层堆栈发展到大型独立服务的动态协作模式的。我们将学习如何使用 Seneca 和 Node 创建自动发现服务网格，使用 AWS Lambda 在云中创建无限可扩展的无服务器应用程序，最后，如何创建 Docker 容器并使用 Kubernetes 编排它们的部署。

第十章 *测试您的应用程序*，解释了如何使用 Node 实现单元测试、功能测试和集成测试。我们将深入探讨如何使用本机调试和测试模块、堆转储和 CPU 分析，最终使用 Mocha 和 Chai 构建测试套件。我们将涵盖使用 Sinon 进行模拟、存根和间谍，使用 Chrome DevTools 实时调试运行中的 Node 进程，以及如何使用 Puppeteer 实现 UI 代码的无头测试。

附录 A，*将您的工作组织成模块*，提供了使用 npm 包管理系统的技巧。在这里，您将学习如何创建、发布和管理包。

附录 B，*创建自己的 C++附加组件*，简要介绍了如何构建自己的 C++附加组件以及如何在 Node 中使用它们。我们还介绍了新的**NAN（Node 的本机抽象）**工具以及它如何帮助您编写跨平台、未来证明的附加组件。

# 本书所需内容

您需要对 JavaScript 有一定的了解，并在您的开发机器或服务器上安装 Node 的副本，版本为 9.0 或更高。您应该知道如何在这台机器上安装程序，因为您需要安装 Redis，以及其他类似 Docker 的库。安装 Git，并学习如何克隆 GitHub 存储库，将极大地改善您的体验。

您应该安装 RabbitMQ，以便您可以跟随使用消息队列的示例。当然，使用 NGINX 代理 Node 服务器的部分将需要您安装和使用该 Web 服务器。要构建 C++附加组件，您需要在系统上安装适当的编译器。

本书中的示例是在基于 UNIX 的环境（包括 Mac OS X）中构建和测试的，但您也应该能够在基于 Windows 的操作系统上运行所有 Node 示例。您可以从[`www.nodejs.org`](http://www.nodejs.org)获取适用于您系统的安装程序和二进制文件。

# 本书适用对象

本书适用于希望构建高容量网络应用程序的开发人员，例如社交网络、协作文档编辑环境、实时数据驱动的网络界面、网络游戏和其他 I/O 密集型软件。如果您是客户端 JavaScript 开发人员，阅读本书将教会您如何使用您已经了解的语言成为服务器端程序员。如果您是 C++黑客，Node 是使用该语言构建的开源项目，为您提供了一个绝佳的机会，在一个庞大且不断增长的社区中产生真正的影响，甚至通过帮助开发这一激动人心的新技术而获得名声。

本书还适用于技术经理和其他寻求了解 Node 的能力和设计理念的人。本书充满了 Node 如何解决现代软件公司在高并发、实时应用程序和通过不断增长的网络传输大量数据方面面临的问题的示例。Node 已经被企业所接受，您应该考虑将其用于您的下一个项目。

我们正在使用 Node 的最新版本（写作时为 9.x）。这是您需要准备好的唯一一本书，以便在未来几年中随着 Node 在企业中的持续发展。

# 约定

在本书中，您将找到一些区分不同信息类型的文本样式。以下是这些样式的一些示例及其含义的解释。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄显示如下：“如果我们查看我们的`find-byte.c`文件，我们会看到我们的`render`方法返回包装在`View`组件中的内容”。

代码块设置如下：

```js
const s1 = "first string";
const s2 = "second string";
let s3 = s1 + s2;
```

任何命令行输入或输出都以以下方式编写：

```js
$ node --version
```

当我们希望引起您对代码块的特定部分的注意时，相关行或项目将以粗体显示：

```js
const char *s1 = "first string";
const char *s2 = "second string";
int size = strlen(s1) + strlen(s2);
char *buffer = (char *)malloc(size + 1);
strcpy(buffer, s1);
strcat(buffer, s2);
free(buffer);
```

**新术语**和**重要单词**以粗体显示。屏幕上显示的单词，例如菜单或对话框中的单词，会以这种方式出现在文本中：“单击“下一步”按钮会将您移至下一个屏幕。”

警告或重要说明会以这样的方式出现在框中。

提示和技巧会以这样的方式出现。
