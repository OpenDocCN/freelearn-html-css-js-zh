

# 第九章：使用 Node.js 在微服务中进行数据库操作

当与微服务架构和 Node.js 一起工作时，数据库在为每个服务存储和检索数据方面发挥着关键作用。

我们将从这个章节开始，了解如何使用 Node.js 在微服务中与数据库协同工作。这涉及到许多概念和工具，例如数据库类型、数据库连接、特定服务的数据库、数据模型和架构、API 端点、错误处理、事务和原子性、缓存、安全、测试、监控和日志。在微服务中操作数据还涉及到在数据库或数据存储系统中执行 **创建、读取、更新和删除**（**CRUD**）操作。请记住，根据您的微服务需求和合规性标准，遵循数据安全最佳实践，例如输入验证、数据加密和保护敏感数据。

到本章结束时，您将学会如何在微服务中操作数据库，并为每个特定服务选择合适的数据库。

在本章中，我们将涵盖以下主要主题：

+   选择合适的数据库和数据库连接

+   数据模型、架构和 CRUD 操作

+   事务和数据验证

+   错误处理和优化

+   测试

# 选择合适的数据库和数据库连接

在本节中，我们将向您展示如何选择与您的微服务需求相匹配的数据库或数据存储系统，并从您的 Node.js 微服务中建立与所选数据库的连接。

## 选择合适的数据库

**为您的应用程序选择合适的数据库**是一个重要的决定，它可能影响您系统的性能、可扩展性和可维护性。在选择数据库时，需要考虑许多因素，例如数据的类型、大小和结构，应用程序预期的负载和并发性，系统的可用性和一致性要求，项目的预算和资源，以及您使用的编程语言和框架。

选择合适的数据库的关键步骤如下：

1.  **数据模型复杂性**：对于复杂关系和结构化数据，选择关系型数据库，如 **MySQL** 或 **PostgreSQL**。对于灵活的、半结构化或非结构化数据，选择 NoSQL 数据库，如 **MongoDB** 或 **Cassandra**。NoSQL 数据库适合**处理具有** **不同结构** **的大量数据**。

1.  **可扩展性要求**：如果您需要水平扩展（跨多个服务器或容器）您的微服务，请考虑如 MongoDB、Cassandra 或 **Amazon DynamoDB** 这样的 NoSQL 数据库，它们旨在实现无缝的水平扩展。对于只需要垂直扩展（向单个服务器添加更多资源）的应用程序，SQL 数据库可以处理相当大的负载。

1.  **一致性要求**：考虑您的应用程序是否需要强数据一致性。ACID 事务是确保数据库操作可靠性和一致性的方法。它们有四个关键属性：原子性、一致性、隔离性和持久性。或者，您可以选择 SQL 数据库。NoSQL 数据库通常提供最终一致性，这对于可以接受轻微数据不一致且需要低延迟的应用程序是合适的。

1.  **查询复杂性**：虽然 SQL 数据库旨在处理涉及多个表和连接的复杂查询，但如 MongoDB 这样的 NoSQL 数据库在简单查询和快速数据聚合方面表现出色。

1.  **社区和支持**：考虑所选数据库可用的社区支持和文档。一个强大的社区可以确保及时的帮助和丰富的资源以解决问题。

1.  **运营开销**：评估管理数据库所需的运营开销。一些数据库，尤其是云中的托管服务，如**AWS RDS**和**Azure Cosmos DB**，处理许多运营任务，从而减轻了您团队的压力。

1.  **合规性和安全性**：确保数据库符合适用于您行业的必要法规和安全标准。考虑数据加密、访问控制和审计跟踪等功能。评估数据库的安全功能（加密、授权和身份验证），并确保数据库满足您应用程序的安全要求。

1.  **数据库恢复方法**：确保数据库在数据丢失的情况下支持数据恢复。了解数据库的灾难恢复过程以及如何与应用程序良好地处理。

在微服务架构中，选择正确的数据库和管理数据库连接是关键决策。

*图 9*.*1*说明了选择正确数据库的过程：

![图 9.1：选择正确数据库的过程（图片由 Freepik 上的 fullvector 提供）](img/B14980_09_01.jpg)

图 9.1：选择正确数据库的过程（图片由 Freepik 上的 fullvector 提供）

在这些概念被覆盖之后，我们可以继续讨论数据库连接。

## 微服务中的数据库连接

**微服务中的数据库连接**是一个涉及许多设计决策和权衡的话题。其中一个主要挑战是如何组织和管理工作每个微服务需要操作的数据。

下面是微服务中数据库连接的关键概念：

+   **连接池**：使用连接池技术来有效地管理数据库连接。连接池重用现有连接，减少了为每个请求建立新连接的开销。

+   **连接详情**：连接详情包括连接限制和基于合约的通信。这些是微服务架构的重要方面，有助于确保系统内不同服务之间的高效和可靠通信。**连接限制**指的是服务在任何给定时间可以处理的连接的最大数量。在微服务架构中，每个服务通常都有连接限制来管理与其他服务、数据库或外部系统的传入和传出通信。设置和管理这些连接限制对于防止服务过载和引起性能问题至关重要。

+   另一方面，**基于合约的通信**指的是在服务之间定义和遵守一组明确的通信协议和数据格式的实践。这包括建立明确的合约或接口，以指定服务之间应该如何相互通信，包括要使用的消息类型、数据结构和协议。通过遵守这些合约，服务可以确保其通信的可靠性和可预测性，无论每个服务内部使用的具体技术或实现细节如何。

    在微服务的背景下，适当管理连接限制并遵守基于合约的通信原则可以帮助维护系统的稳定性和可扩展性。这允许服务高效且可靠地进行通信，同时还能在不影响整体系统的情况下对单个服务进行更改和更新。最终，这种方法有助于提高微服务架构的整体健壮性和可维护性。

+   **重试策略**：实现重试策略以处理暂时的数据库连接失败。重试失败的数据库操作可以提高微服务的整体健壮性。

+   **超时**：设置连接超时以防止请求无限期地等待响应。超时确保如果数据库操作耗时过长，系统可以恢复并优雅地处理这种情况。

+   **连接字符串管理**：安全地管理连接字符串。避免将敏感信息如密码硬编码。利用环境变量或安全保险库来存储敏感配置数据。

+   **优雅地处理失败**：实现数据库失败的优雅处理。当数据库连接失败时，微服务应该优雅地响应，向客户端提供有意义的错误消息，并尝试使用退避策略重新连接。

+   **数据库连接监控**：实现数据库连接的监控。跟踪连接使用情况、错误和延迟。监控有助于识别微服务架构中的瓶颈和性能问题。

记住，确保数据库连接的安全性非常重要，以确保具有微服务的软件无错误且安全。

总结来说，通过仔细考虑您应用程序的需求，选择合适的数据库技术，并实施稳健的数据库连接管理实践，您可以确保基于微服务的应用程序的可靠性、可扩展性和安全性。

接下来，我们将更深入地了解数据模型和模式以及 CRUD 操作。

# 数据模型和模式以及 CRUD 操作

在微服务架构中，定义清晰的数据模型和模式，以及实施 CRUD 操作，是有效管理数据的基本任务。

## 数据模型和模式

**数据模型和模式**是数据库设计和开发中的两个重要概念。数据模型是表示数据库中数据结构、关系和约束的一种方式。模式是数据模型的具体实现，通常用如 SQL 这样的形式化语言表达。模式定义了构成数据库的表、列、键、索引、视图和其他对象。根据抽象级别和设计目的的不同，存在不同类型的数据模型和模式。

这是您在微服务中处理数据模型和模式的方法：

+   **定义清晰的数据模型**：为您的微服务创建定义良好的数据模型。了解您的服务将处理的实体，并将它们表示为 JavaScript 对象。定义属性及其数据类型。

+   **使用模式进行验证**：使用如 **Joi** 这样的验证库或 ORM/ODM 功能实现模式。ORM/ODM 模式是数据在对象模型和数据库之间映射的定义。ORM 模式指定关系数据库中的表、列、键和关系如何对应于面向对象编程语言中的类、属性、方法和关联。ODM 模式定义文档数据库中的文档、字段、索引和引用如何与基于对象的编程语言中的对象、属性、函数和链接相匹配。模式强制数据一致性，并验证传入数据是否符合预定义的规则。它们确保数据符合预期的结构和格式。

+   **处理关系**：如果您的微服务处理具有关系的实体（例如，一对一、多对多等），请在您的数据模型中定义这些关系。使用外键或引用来建立这些关系，确保数据完整性。

+   **版本化您的模式**：考虑对您的模式进行版本控制，尤其是在可能独立发展的微服务环境中。版本化的模式有助于保持与现有消费者的兼容性，同时允许添加新功能。

在本节中，我们学习了如何定义表示存储在数据库中的数据结构和属性的数据模型或模式。

在了解了这些概念之后，让我们进一步学习 CRUD 操作。

## CRUD 操作

**CRUD 操作**是计算机编程中持久存储的四个基本功能：创建、读取、更新和删除。这些操作可以应用于各种类型的数据，如关系型、文档型或基于对象的数据。当与 Web 应用程序一起工作时，CRUD 操作也映射到标准 HTTP 方法，如 POST、GET、PUT 和 DELETE。

这是您如何在微服务中处理 CRUD 操作的方法：

+   **创建（POST）操作**：实现创建操作以向数据库添加新记录。在将其插入数据库之前，使用定义的架构验证传入的数据。然后，返回带有成功状态码的创建实体。

+   **读取（GET）操作**：实现读取操作以从数据库中检索数据。如有必要，使用查询参数进行筛选、排序和分页。处理不同端点或查询参数以满足特定的数据检索需求。

+   **更新（PUT/PATCH）操作**：实现更新操作以修改现有记录。验证传入数据与架构的一致性。使用**PUT**来更新整个资源，使用**PATCH**来更新特定字段。返回带有成功状态码的更新实体。

+   **删除（DELETE）操作**：实现删除操作以从数据库中删除记录。使用唯一标识符（例如，ID）来识别要删除的实体。如有必要，处理级联删除以关联数据。

CRUD 操作帮助我们高效地操作数据库，在日常工作中非常有用。

*图 9**.2*展示了数据库和 CRUD 操作的过程：

![图 9.2：数据库和 CRUD 操作（图片由 Freepik 提供）](img/B14980_09_02.jpg)

图 9.2：数据库和 CRUD 操作（图片由 Freepik 提供）

总结来说，通过遵循这些最佳实践，您可以确保您的微服务有效地处理数据，保持数据完整性，并向消费者提供可靠的 CRUD 操作。

现在，我们可以继续到下一节，我们将讨论事务和数据验证。

# 事务和数据验证

在微服务架构中，当需要原子性地执行多个操作以保持数据一致性时，事务至关重要。数据验证和清理对于防止常见的安全漏洞至关重要。

## 微服务中的事务

微服务中的**事务**是一个需要仔细设计和权衡的挑战。事务是确保跨多个系统数据一致性和可靠性的操作。然而，在微服务架构中，每个服务都有自己的数据存储，通信是异步且不可靠的，实现事务变得更加复杂和昂贵。根据系统的需求和限制，有不同方法和模式来处理微服务中的事务。

这是您如何使用 Node.js 在微服务中处理事务的方法：

+   **数据库支持**：选择支持事务的数据库。大多数关系型数据库，如 MySQL 和 PostgreSQL，提供事务支持。一些 NoSQL 数据库，如 MongoDB，提供多文档事务的支持。支持原生事务的 NoSQL 数据库，如 MongoDB、CouchDB 和 RethinkDB，在单个文档或集合内提供 ACID 事务保证，其中一些还支持多文档或跨集合事务。然而，这些事务可能会在性能和可扩展性方面有所权衡，并且可能不适合复杂或跨服务事务。通过外部库或框架支持事务的 NoSQL 数据库，如 OrientDB、ArangoDB 和 Cassandra，没有内置的事务支持，但可以与提供事务能力的第三方工具或模块集成，例如两阶段提交、SAGA 模式或事件溯源。然而，这些工具或模块可能存在限制或依赖，可能需要额外的编码或配置。

    NoSQL 可能支持不同的一致性模型，并且可能不会在所有情况下保证 ACID 事务，例如当涉及键值对或面向文档编程时。虽然一些 NoSQL 数据库提供事务能力，但其他数据库可能更优先考虑其他方面，如高可用性和可扩展性，而不是强事务一致性。

    此外，图数据库如 Neo4j 可以与微服务一起使用来处理事务数据。在微服务架构中，每个服务可以有一个图数据库实例来管理其特定的数据。Neo4j 支持符合 ACID 的事务，其灵活的数据模型使其适合在分布式和可扩展的环境中处理复杂的关系和图数据。

+   `BEGIN TRANSACTION`、`COMMIT`和`ROLLBACK`用于错误处理。在 NoSQL 数据库中，事务可能涉及一系列原子执行的运算。我们必须在每次使用后关闭数据库连接。未能关闭这些连接可能导致内存泄漏。每个打开的连接都会消耗内存资源，如果连接没有正确关闭，与这些连接关联的内存可能不会被释放，从而导致随着时间的推移内存使用量增加。

+   **错误处理和回滚**：在事务中实现错误处理。如果事务中的任何操作失败，则回滚整个事务。这确保了事务中的所有操作要么全部成功，要么数据库保持其初始状态（回滚）。

+   **并发控制**：考虑实现并发控制机制，如悲观或乐观并发控制。悲观并发控制涉及锁定资源以防止冲突，而乐观并发控制使用版本号或时间戳来检测冲突并优雅地处理它们。

+   **嵌套事务**：一些数据库支持嵌套事务。使用嵌套事务时要小心，因为它们可能导致复杂的行为。嵌套事务可能会独立于其父事务提交，导致意外结果。

+   **测试事务**：彻底测试您的交易逻辑，包括涉及多个服务的场景。在测试期间模拟外部服务调用以模拟不同的结果，并确保您的交易能够正确处理错误和回滚。

+   **监控连接使用情况**：这将帮助您跟踪数据库连接的使用情况，从而有助于识别潜在问题，例如连接泄漏、过度使用连接或性能瓶颈。我们可以使用 Datadog 仪表板来监控它们。

通过事务，我们可以更快地创建数据库并确保其质量。

接下来，我们将探讨数据验证和清理。

## 数据验证和清理

**数据验证和清理**是确保网络应用程序中数据质量和安全性的两种重要技术。数据验证是在我们处理或存储之前检查用户输入是否符合某些标准的过程，例如格式、长度、类型或范围。数据清理是从用户输入中删除或转义可能有害的字符或脚本的过程，以防止诸如**跨站脚本攻击**（XSS）或 SQL 注入等攻击。通过应用数据验证和清理，开发者可以防止各种安全漏洞并确保接收和处理的数据是准确和可靠的。

这是您如何使用 Node.js 在微服务中处理数据验证和清理的示例：

+   **使用验证库**：利用验证库，如 Joi，来验证传入数据是否符合预定义的模式。Joi 允许您定义数据的预期结构并进行验证，确保在处理之前它符合指定的格式。以下是一个在 Node.js 路由处理程序中使用 Joi 的示例：

    ```js
    //Firstly, we need to import the required library
    ```

    ```js
    const Joi = require('joi');
    ```

    ```js
    // We define the schema using Joi library with its parameters
    ```

    ```js
    const schema = Joi.object({
    ```

    ```js
      username: Joi.string().alphanum().min(3).max(30).required(),
    ```

    ```js
      email: Joi.string().email().required(),
    ```

    ```js
    });
    ```

    ```js
    // Validate request data
    ```

    ```js
    const { error, value } = schema.validate(req.body);
    ```

    ```js
    if (error) {
    ```

    ```js
      // Handle validation error
    ```

    ```js
    }
    ```

+   **清理用户输入**：清理用户输入以防止 XSS 攻击和 SQL 注入。如 **DOMPurify** 这样的清理库可以帮助清理 HTML 输入以删除可能有害的脚本。对于 SQL 清理，使用参数化查询以避免 SQL 注入攻击。以下是一个使用 DOMPurify 清理 HTML 输入的示例：

    ```js
    const DOMPurify = require('dompurify');
    ```

    ```js
    const sanitizedHTML = DOMPurify.sanitize(req.body.htmlInput);
    ```

+   **正则表达式**：使用正则表达式来验证特定模式，例如电子邮件地址、URL 或信用卡号。正则表达式可以是复杂数据验证的有力工具。以下是一个使用正则表达式验证电子邮件地址的示例：

    ```js
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    ```

    ```js
    if (!emailRegex.test(req.body.email)) {
    ```

    ```js
      // Handle invalid email address
    ```

    ```js
    }
    ```

+   `eval()`和其他可以执行任意代码的不安全函数。这些函数可以通过允许攻击者在您的应用程序中执行恶意脚本来引入严重的安全漏洞。

+   **输出编码**：在将用户生成的内容渲染到浏览器之前，应用适当的输出编码技术来转义潜在的恶意字符。使用如 HTML 实体编码、JavaScript 转义和 URL 编码等方法来防止恶意脚本注入到输出中。

+   **安全策略**：强制执行严格的内容安全策略（**CSP**）来定义受信任的内容来源并减轻加载外部资源和执行内联脚本相关的风险。实施适当的 HTTP 安全头，如 X-XSS-Protection，以启用浏览器 XSS 过滤机制并阻止潜在的攻击向量。

采取这些预防措施可以显著降低跨站脚本攻击的可能性，并增强应用程序的整体安全态势。此外，了解最新的安全最佳实践和漏洞对于持续改进您的 XSS 防范策略至关重要。

数据验证和清理在验证模型中的用户输入并防止黑客修改我们的数据库方面帮我们很大忙。

*图 9**.3* 展示了数据验证和清理：

![图 9.3：数据验证和清理（图片由 storyset 在 Freepik 提供）](img/B14980_09_03.jpg)

图 9.3：数据验证和清理（图片由 storyset 在 Freepik 提供）

总结来说，通过实施强大的事务管理和全面的数据验证和清理实践，您可以显著提高基于微服务的应用程序的安全性和可靠性。

在下一节中，我们将学习关于错误处理和优化的内容。

# 错误处理和优化

在微服务架构中，适当的错误处理对于确保可靠性和向客户提供有意义的反馈至关重要。另一方面，优化您的微服务确保它们运行高效，快速处理请求，从而提升整体用户体验。

## 微服务中的错误处理

**微服务中的错误处理**是构建可靠和弹性分布式系统的关键方面。错误可能由于各种原因发生，例如网络故障、服务中断、数据不一致或应用程序错误。因此，在各个微服务中拥有一致和有效的错误处理策略非常重要。

以下是如何在您的 Node.js 微服务中有效处理错误的示例：

+   **使用 HTTP 状态码**：在响应中利用适当的 HTTP 状态码。例如，对于客户端错误（例如验证失败），使用 **400 Bad Request**；对于不存在的资源，使用 **404 Not Found**；对于服务器端错误，使用 **500 Internal Server Error**（服务器端错误是在服务器无法处理来自客户端（如网页浏览器）的请求时发生的错误。一个常见的服务器端错误示例是 500 内部服务器错误，这表明服务器遇到了阻止其满足请求的意外条件）。例如，当服务器遇到无法处理请求时，会显示 500 内部服务器错误。

+   **集中式错误处理**：实现集中式错误处理中间件。此中间件捕获未处理的错误，记录它们，并向客户端发送适当的错误响应。它确保你的微服务中错误格式的一致性。以下是一个使用 **Express.js** 中间件进行集中式错误处理的示例：

    ```js
    app.use((err, req, res, next) => {
    ```

    ```js
      console.error(err.stack);
    ```

    ```js
      res.status(500).send('Something went wrong!');
    ```

    ```js
    });
    ```

+   **自定义错误类**：使用自定义错误类来表示不同类型的错误。自定义错误可以包含附加信息，并有助于更有效地处理特定的错误场景。以下是在 Node.js 中创建自定义错误类的示例：

    ```js
    class CustomError extends Error {
    ```

    ```js
      constructor(message, statusCode) {
    ```

    ```js
        super(message);
    ```

    ```js
        this.statusCode = statusCode;
    ```

    ```js
      }
    ```

    ```js
    }
    ```

    ```js
    // Usage
    ```

    ```js
    throw new CustomError('Custom error message', 400);
    ```

+   **日志记录**：记录包含错误消息、堆栈跟踪和相关上下文的详细错误信息。集中式日志记录有助于诊断问题和监控微服务的健康状况。

+   **错误代码和消息**：在响应中包含错误代码和用户友好的错误消息。错误代码可以帮助客户端和开发者识别特定问题，而用户友好的消息可以改善用户体验。

在微服务中处理错误可以帮助你在使用 Node.js 开发微服务时避免后续的头痛，它有助于开发者更快地调试。

在下一节中，我们将讨论微服务的优化。

## 微服务的优化

**微服务的优化**是旨在提高基于微服务应用程序的性能、可扩展性和可靠性的技术和实践。

这里有一些针对 Node.js 微服务的特定优化技术：

+   **代码优化**：

    +   **最小化依赖**：仅使用必要的库以减少应用程序的大小

    +   **避免同步操作**：优先使用异步操作以防止阻塞事件循环

    +   **使用高效算法**：选择合适的数据结构和算法以优化处理时间

+   **数据库优化**：

    +   **使用索引**：对查询中频繁使用的数据库字段进行索引以加快搜索操作

    +   **批量数据库操作**：将多个数据库操作组合成批次，以减少对数据库的往返次数

    +   **连接池**：使用连接池库重用数据库连接以最小化开销

+   **缓存**：实现缓存机制（内存缓存或外部缓存，如**Redis**），用于频繁访问的数据。缓存减少了从数据库重复获取数据的需要。

+   **负载均衡**：使用负载均衡器将传入流量分配到您的微服务的多个实例。负载均衡确保没有单个实例过载，优化资源利用率。

+   **错误处理和监控**：使用**Prometheus**、**Grafana**或**New Relic**等工具监控您的微服务。跟踪性能指标、错误和资源使用情况，以识别瓶颈和优化区域。

+   **网络优化**：

    +   **最小化外部 API 调用**：减少对外部服务或 API 的调用次数，因为网络延迟会显著影响响应时间

    +   **压缩**：使用响应压缩来减少通过网络发送的数据大小，特别是对于 JSON 响应

+   **微服务通信**：

    +   **优化服务间通信**：选择高效的协议，如**gRPC**和**Protocol Buffers**，用于微服务之间的通信。

    +   **实现断路器**：微服务中的断路器是一种技术，通过停止与失败或无响应服务的通信来防止分布式系统中的级联故障。断路器是一个监控服务健康和性能的组件，并作为请求的代理。当服务正常运行时，断路器允许请求通过。使用断路器模式来防止依赖服务缓慢或无响应时的级联故障。

总结来说，通过结合有效的错误处理实践和战略优化，您可以确保您的 Node.js 微服务既健壮又高效，为用户和客户提供无缝体验。

在最后一节，我们将讨论测试。

# 测试

**测试**是软件开发的一个关键方面，因为它确保您的微服务是可靠、安全和按预期工作的。

这里是各种 Node.js 微服务的测试技术和最佳实践的示例：

+   **单元测试**：

    +   *目的*：在隔离状态下测试您的微服务中的单个单元或组件

    +   *工具*：使用测试框架，如**Mocha**、**Jest**或**Jasmine**，以及断言库，如**Chai**或 Jest 内置的断言。

    +   *技术*：为函数、类和模块编写测试，模拟依赖项以隔离正在测试的单元

+   **集成测试**：

    +   *目的*：验证不同组件或微服务之间的交互。

    +   *工具*：使用类似于单元测试的测试框架和库，但专注于多个单元交互的场景。

    +   *技术*：测试 API 端点、数据流以及与数据库或外部服务的集成。使用真实或内存数据库进行更真实的测试。

+   **端到端测试**：

    +   *目的*: 测试微服务的整个流程，包括与外部依赖的交互

    +   *工具*: **Selenium**, **Puppeteer**, 和 **Cypress**

    +   *技术*: 自动化浏览器交互，模拟用户行为，并验证应用程序在其整个堆栈中的行为

+   **契约测试**:

    +   *目的*: 确保通过 API 交互的服务遵守其定义的契约

    +   *工具*: **Pact** 和 **Spring Cloud Contract**

    +   *技术*: 定义服务之间的契约（期望），然后验证 API 的生产者和消费者是否满足这些期望

+   **负载和性能测试**:

    +   *目的*: 评估系统在各种负载下的行为，并识别性能瓶颈

    +   *工具*: **Apache JMeter**, **Loader.io**, 和 **Artillery**

    +   *技术*: 模拟对微服务的大量请求，监控响应时间和服务器资源使用情况

+   **安全测试**:

    +   *目的*: 识别微服务中的漏洞和弱点

    +   *工具*: **OWASP ZAP**, **Burp Suite**, 和 **SonarQube**

    +   *技术*: 进行安全扫描、代码分析和渗透测试，以发现安全漏洞并在部署前解决它们

+   **突变测试**:

    +   *目的*: 通过引入小的代码突变并检查测试是否捕获它们来评估单元测试的质量

    +   *工具*: **Stryker** 和 **PITest**

    +   *技术*: 突变你的代码库（更改代码的一小部分），重新运行测试，并查看测试是否因突变而失败

正如我们所学的，这些概念可以帮助我们更好地测试软件，并交付经过良好测试的软件。

*图 9**.4* 展示了测试过程：

![图 9.4：测试（由 Freepik 上的 storyset 提供图片）](img/B14980_09_04.jpg)

图 9.4：测试（由 Freepik 上的 storyset 提供图片）

总结来说，通过遵循这些测试技术和最佳实践，你可以确保你的 Node.js 微服务得到彻底的测试，可靠，并且准备好部署。

# 总结

在本章中，我们学习了关于微服务的大量知识，包括如何操作数据库以及如何全面测试我们的软件应用程序。我们在开发过程中走过了数据库操作和测试的每一步，以确保我们的软件应用程序无错误。

在微服务中操作数据涉及在数据库或数据存储系统中执行 CRUD 操作。请记住，根据你的微服务需求和合规标准，遵循数据安全最佳实践，如输入验证、数据加密和保护敏感数据。通过实施这些步骤，你可以在 Node.js 微服务中有效地操作数据，并确保与底层数据库或数据存储系统的正确交互。

在 Node.js 微服务架构中有效地管理数据库涉及仔细考虑数据模型、CRUD 操作、事务和优化。

通过遵循这些实践，微服务可以有效地管理数据库，确保在微服务生态系统中数据的完整性、安全性和最佳性能。

在下一章中，我们将学习微服务中的 API 通信和数据合约。

# 测验时间

+   选择正确数据库的关键步骤有哪些？

+   你如何处理微服务中的数据模型和模式？

+   CRUD 操作是什么？

+   事务是什么？
