# 前言

欢迎来到 *JavaScript 云原生开发烹饪书*。这本烹饪书充满了帮助你沿着云原生之旅的食谱。它旨在成为我的另一本书 *云原生开发模式和最佳实践* 的伴侣。我个人发现交付云原生解决方案是迄今为止最有乐趣和满足的开发实践。这是因为云原生不仅仅是优化云。它是一种完全不同的思考软件系统的方式和推理方式。

简而言之，云原生是精简且自主的。由可丢弃的基础设施提供动力，利用全面管理的云服务，并采用可丢弃的架构，云原生赋予日常自给自足的全栈团队快速且持续实验创新的能力，同时以比以往任何时候都少的努力构建全球规模的系统。遵循这种无服务器优先的方法允许团队快速行动，但这种快速步伐也打开了诚实的错误在系统中造成破坏的机会。为了防止这种情况，云原生系统由自主服务组成，这为服务之间创建了防波堤，以减少在中断期间的影响范围。

在这本烹饪书中，你将学习如何通过消除所有同步服务间通信来构建自主服务。你将把数据库内外翻转，最终通过实现事件源和 CQRS 模式，利用事件流和物化视图将云转变为数据库。你的团队将对其交付能力充满信心，因为异步服务间通信和数据复制消除了使系统脆弱的上下游依赖。你还将学习如何在多个区域持续部署、测试、观察、优化和保障你的自主服务。

为了充分利用本书，请准备好以开放的心态去发现为什么云原生与众不同。云原生迫使我们重新思考我们对系统的思考方式。它考验了我们所有先入为主的软件架构观念。因此，请准备好在构建云原生系统时有很多乐趣。

# 本书面向的对象

本书旨在帮助创建自给自足、全栈、云原生开发团队。一些云经验是有帮助的，但不是必需的。假设读者具备 JavaScript 语言的基本知识。本书可作为经验丰富的云原生开发者的参考，并为入门级云原生开发者提供快速入门。最重要的是，本书是为那些准备好重新配置他们的工程大脑以进行云原生开发的人而写的。

# 本书涵盖的内容

第一章，*开始使用云原生*，展示了定义和部署无服务器、云原生资源（如函数、流和数据库）的简便性，这使自给自足的全栈团队能够有信心地持续交付。

第二章，*应用事件源和 CQRS 模式*，展示了如何通过使用事件流和物化视图来消除服务间的同步通信，从而创建完全自主的服务。

第三章，*实现自主服务*，探讨了创建自主服务的边界和控制模式，例如前端后端、外部服务网关和事件编排。

第四章，*利用云边缘*，提供了使用云提供商的内容分发网络来提高自主服务性能和安全的具体示例。

第五章，*保护云原生系统*，探讨了利用云原生安全中的共享责任模型，以便您可以将精力集中在保护云原生系统的特定领域层。

第六章，*构建持续部署管道*，展示了诸如任务分支工作流、传递式端到端测试和功能标志等技术，这些技术帮助团队通过将部署和测试左移、控制批量大小以及解耦部署与发布，有信心地将更改持续部署到生产环境中。

第七章，*优化可观察性*，展示了如何通过在生产环境中持续测试以断言云原生系统的健康状态，并关注恢复平均时间来增强团队信心。

第八章，*设计故障处理*，讨论了诸如背压、幂等性和流电路断器模式等技术，用于提高自主服务的鲁棒性和弹性。

第九章，*优化性能*，探讨了诸如异步非阻塞 IO、会话一致性和函数调优等技术，以提升自主服务的响应速度。

第十章，*部署到多个区域*，展示了如何通过在区域间创建完全复制、活动-活动部署并实施区域故障转移来部署全球自主服务，以最大化可用性并最小化延迟。

第十一章，*欢迎使用 Polycloud*，探讨了每次选择正确的云服务提供商所提供的自由度，同时保持一致的开发管道体验。

# 要充分利用本书

要跟随本书中的食谱，您需要根据以下步骤配置您的开发环境：

1.  安装 Node Version Manager([`github.com/creationix/nvm`](https://github.com/creationix/nvm)或[`github.com/coreybutler/nvm-windows`](https://github.com/coreybutler/nvm-windows))。

1.  使用`nvm install 8`安装 Node.js。

1.  使用`npm install serverless -g`安装 Serverless Framework。

1.  使用`export MY_STAGE=<your-name>`创建`MY_STAGE`环境变量。

1.  创建 AWS 账户([`aws.amazon.com/free`](https://aws.amazon.com/free))并为 Serverless Framework([`serverless.com/framework/docs/providers/aws/guide/credentials`](https://serverless.com/framework/docs/providers/aws/guide/credentials))配置您的凭据。

# 下载示例代码文件

您可以从[`www.packt.com`](http://www.packt.com/)的账户下载本书的示例代码文件。如果您在其他地方购买了此书，您可以访问[www.packt.com/support](http://www.packt.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在[www.packt.com](http://www.packt.com/)登录或注册。

1.  选择“支持”选项卡。

1.  点击“代码下载与勘误”。

1.  在搜索框中输入书名，并遵循屏幕上的说明。

下载文件后，请确保使用最新版本的以下工具解压或提取文件夹：

+   Windows 上的 WinRAR/7-Zip

+   Mac 上的 Zipeg/iZip/UnRarX

+   Linux 上的 7-Zip/PeaZip

本书代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/JavaScript-Cloud-Native-Development-Cookbook`](https://github.com/PacktPublishing/JavaScript-Cloud-Native-Development-Cookbook)。我们还有其他来自我们丰富图书和视频目录的代码包，可在**[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)**找到。查看它们！

# 下载彩色图像

我们还提供了一个包含本书中使用的截图/图表彩色图像的 PDF 文件。您可以从这里下载：[`www.packtpub.com/sites/default/files/downloads/9781788470414_ColorImages.pdf`](https://www.packtpub.com/sites/default/files/downloads/9781788470414_ColorImages.pdf)。

# 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“首先要注意的是，我们必须在`serverless.yml`文件中定义`runtime: nodejs8.10`。”

代码块设置如下：

```js
module.exports.hello = (event, context, callback) => {
  console.log('event: %j', event);
  console.log('env: %j', process.env);

  callback(null, 'success');
};
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```js
service: cncb-create-function
...
functions:
  hello:
    handler: handler.hello
```

任何命令行输入或输出都应如下编写：

```js
$ npm run dp:lcl -- -s $MY_STAGE
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。例如，菜单或对话框中的单词在文本中显示如下。以下是一个示例：“选择监视器 | 新监视器 | 事件”

警告或重要提示看起来像这样。

技巧和窍门看起来像这样。

# 章节

在本书中，您将找到一些频繁出现的标题（*准备工作*，*如何操作…*，*它是如何工作的…*，*更多内容…*，和*参见*）。

要清楚地说明如何完成食谱，请按以下方式使用这些部分：

# 准备工作

本节告诉您在食谱中可以期待什么，并描述了如何设置任何软件或任何为食谱所需的初步设置。

# 如何操作…

本节包含遵循食谱所需的步骤。

# 它是如何工作的…

本节通常包含对上一节发生情况的详细说明。

# 更多内容…

本节包含有关食谱的附加信息，以便您对食谱有更深入的了解。

# 参见

本节提供了指向其他有用信息的链接，这些信息对食谱很有帮助。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过电子邮件联系我们 `customercare@packtpub.com`。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在本书中发现错误，我们将不胜感激，如果您能向我们报告，我们将不胜感激。请访问[www.packt.com/submit-errata](http://www.packt.com/submit-errata)，选择您的书籍，点击勘误表提交表单链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，我们将不胜感激，如果您能提供位置地址或网站名称，我们将不胜感激。请通过电子邮件联系 `copyright@packt.com` 并附上材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com/)。

# 评论

请留下评论。一旦您阅读并使用过本书，为什么不在您购买书籍的网站上留下评论？潜在的读者可以查看并使用您的客观意见来做出购买决定，Packt 公司可以了解您对我们产品的看法，我们的作者可以查看他们对书籍的反馈。谢谢！

如需了解有关 Packt 的更多信息，请访问[packt.com](https://www.packt.com/).
