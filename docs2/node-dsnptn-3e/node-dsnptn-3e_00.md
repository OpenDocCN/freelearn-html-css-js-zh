# 前言

Node.js 被许多人视为变革者——可能是本世纪网络开发领域最大的创新。它不仅因其技术能力而受到喜爱，还因为它在 Web 开发以及整个软件开发生态系统中引入的范式转变。

首先，Node.js 应用程序是用 JavaScript 编写的，这是网络上最广泛使用的语言，也是每个网络浏览器原生支持的唯一编程语言。这一特性使得单语言应用程序堆栈和服务器与客户端之间的代码共享成为可能。使用单一语言也有助于缩小前端和后端工程师之间的差距，使得后端编程对前端开发者来说极其易于接近和直观。一旦你熟悉了 Node.js 和 JavaScript，你就可以轻松地为各种平台和环境构建软件。

Node.js 本身正推动 JavaScript 语言的崛起和演变。人们意识到在服务器上使用 JavaScript 带来了很多价值，他们喜欢它的实用主义、灵活性、事件驱动的方法以及它介于面向对象和函数式编程之间的混合特性。

第二个革命性因素是 Node.js 的单线程编程模型和其异步架构。从性能和可扩展性的角度来看，这一特性带来了明显的优势，同时也改变了开发者处理并发和并行的方式。互斥锁被队列取代，线程被回调函数取代，同步被因果关系取代。这些抽象通常比它们的传统对应物更容易采用，但它们仍然非常强大，允许开发者解决日常挑战时非常高效。

Node.js 的最后一个也是最重要的方面在于其生态系统：npm 包管理器，其不断增长的模块数据库，其热情和乐于助人的社区，最重要的是，其基于简单性、实用性和极端模块化的独特文化。

然而，由于这些特殊性，Node.js 开发与其他服务器端平台相比给您的感觉非常不同，任何新接触这种范式的新手都经常会感到不确定如何有效地解决甚至最常见的设计和编码问题。常见问题包括：*我该如何组织我的代码？最好的设计方式是什么？我如何使我的应用程序更模块化？我如何有效地处理一系列异步调用？我如何确保我的应用程序在增长过程中不会崩溃？* 或者更简单地说，*正确的实现方式是什么？* 幸运的是，Node.js 已经成为一个足够成熟的平台，现在大多数这些问题都可以通过设计模式、经过验证的编码技术或推荐的最佳实践轻松回答。本书的目的是引导您进入这个正在出现的模式、技术和实践的世界，向您展示最常见问题的验证解决方案，并教会您如何将它们作为构建特定问题解决方案的起点。

通过阅读本书，您将学习以下内容：

+   **“Node 方式”**：

    如何在接近 Node.js 开发时使用正确的视角。例如，您将学习不同的传统设计模式在 Node.js 中的样子，或者如何设计只做一件事的模块。

+   **一套解决常见 Node.js 设计和编码问题的模式**：

    您将获得一套“瑞士军刀”般的模式，这些模式可以随时使用，以高效解决您日常的开发和设计问题。

+   **如何编写可扩展和高效的 Node.js 应用程序**：

    您将了解编写大型且组织良好的 Node.js 应用程序的基本构建块和原则，这些应用程序可以扩展。您将能够将这些原则应用于现有模式范围之外的全新问题。

+   **使用“现代 JavaScript”编写代码**：

    JavaScript 自 1995 年以来一直存在，但自从其首次推出以来，已经发生了许多变化，尤其是在最近几年。本书将利用最现代的 JavaScript 功能，如类语法、Promise、生成器函数和 async/await，为您提供最新的体验。

在整本书中，您将遇到真实的库和技术，如 LevelDB、Redis、RabbitMQ、ZeroMQ、Express 等。它们将被用来展示模式或技术，除了使示例更有用之外，这些还将使您深入了解 Node.js 生态系统及其解决方案集。

无论您是使用 Node.js 进行工作、个人项目还是开源项目，识别和使用已知模式和技巧都将使您在分享代码和设计时使用共同的语言，而且更重要的是，它将帮助您更好地理解 Node.js 的未来以及如何使您自己的贡献成为其中的一部分。

# 您需要为本书准备的内容

要实验代码，您需要一个可工作的 Node.js 版本 14（或更高版本）和 npm 版本 6（或更高版本）的安装。如果某些示例需要您使用额外的工具，这些工具将相应地在本处描述。您还需要熟悉命令行，知道如何安装 npm 包，以及如何运行 Node.js 应用程序。最后，您需要一个文本编辑器来处理代码和一个现代网络浏览器。

# 本书面向的对象

本书面向已经接触过 Node.js 并希望从生产效率、设计质量和可扩展性方面最大限度地利用它的开发者。您只需通过一些基本示例对技术有所了解，并对 JavaScript 语言有一定程度的熟悉即可，因为本书还将涵盖一些基本概念。具有 Node.js 中级经验的开发者也会发现本书中介绍的技术有益。

对软件设计理论的一些了解也有助于理解本书中提出的一些概念。

本书假设您已经具备一定的网络应用程序开发、网络服务、数据库和数据结构的工作知识。

# 本书涵盖的内容

*第一章*，*Node.js 平台*，通过展示平台本身的核心模式，为 Node.js 应用程序设计的世界提供了一个介绍。它涵盖了 Node.js 生态系统及其哲学，并提供了对 Node.js 内部和反应器模式的快速介绍。

*第二章*，*模块系统*，深入探讨了 Node.js 中可用的模块系统，强调了 CommonJS 与 ECMAScript 2015 规范中更现代的 ES 模块之间的区别。

*第三章*，*回调和事件*，介绍了学习异步编程及其模式的第一步，讨论并比较了回调和事件发射器（观察者模式）。

*第四章*，*使用回调的异步控制流模式*，介绍了一组在 Node.js 中使用回调高效处理异步控制流的模式和技巧。本章教您一些使用纯 JavaScript 减轻“回调地狱”问题的传统方法。

*第五章*，*使用 Promise 和 Async/Await 的异步控制流模式*，继续探索更复杂和现代的异步控制流技术。

*第六章*，*使用流进行编码*，深入探讨了 Node.js 中最重要工具之一：流。它展示了如何使用转换流处理数据以及如何将它们组合成不同的模式。

*第七章*，*创建型设计模式*，开始探索 Node.js 中的传统设计模式。在本章中，您将了解一些最受欢迎的创建型设计模式，即*工厂*模式、*揭示构造函数*模式、*构建者*模式和*单例*模式。

*第八章*，*结构设计模式*，继续探索 Node.js 中的传统设计模式，涵盖了诸如*代理*、*装饰器*和*适配器*等结构设计模式。

*第九章*，*行为设计模式*，通过介绍诸如*策略*、*状态*、*模板*、*中间件*、*命令*和*迭代器*等行为设计模式，结束了围绕 Node.js 中传统设计模式的对话。

*第十章*，*Web 应用程序的通用 JavaScript*，探讨了现代 JavaScript Web 应用程序最有趣的功能之一：能够在前端和后端之间共享代码。在本章中，您将通过使用现代工具和库构建一个简单的 Web 应用程序来学习通用 JavaScript 的基本原理。

*第十一章*，*高级食谱*，采用问题-解决方案的方法向您展示如何使用现成的解决方案来处理一些常见的编码和设计复杂性。

*第十二章*，*可扩展性和架构模式*，教您扩展 Node.js 应用程序的基本技术和模式。

*第十三章*，*消息和集成模式*，介绍了最重要的消息模式，教您如何使用 Node.js 及其生态系统构建和集成复杂的分布式系统。

# 要充分利用本书

要充分利用本书，您可以按照以下说明下载示例代码文件和彩色图像。

## 下载示例代码文件

您可以从[www.packt.com/](http://www.packt.com/)上的账户下载本书的示例代码文件。如果您在其他地方购买了此书，您可以访问[www.packtpub.com/support](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  在[`www.packt.com`](http://www.packt.com)登录或注册。

1.  选择**支持**选项卡。

1.  点击**代码下载**。

1.  在**搜索**框中输入书籍名称，并遵循屏幕上的说明。

文件下载完成后，请确保您使用最新版本的以下软件解压缩或提取文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for macOS

+   7-Zip / PeaZip for Linux

本书代码包也托管在 GitHub 上，地址为[nodejsdp.link/repo](http://nodejsdp.link/repo)。如果代码有更新，它将在现有的 GitHub 仓库中更新。

我们还有其他来自我们丰富的图书和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

## 下载彩色图像

我们还提供了一份包含本书中使用的截图/图表的彩色图像的 PDF 文件。您可以从这里下载：[`static.packt-cdn.com/downloads/9781839214110_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781839214110_ColorImages.pdf)。

## 使用的约定

在这本书中，您将找到许多文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义的解释：

+   **文本中的代码词**：`server.listen(handle)`

+   **路径名**：`src/app.js`

+   **虚拟 URL**：`http://localhost:8080`

代码块通常使用 StandardJS 约定格式化([nodejsdp.link/standard](http://nodejsdp.link/standard))，并设置如下：

```js
import zmq from 'zeromq'
async function main () {
  const sink = new zmq.Pull()
  await sink.bind('tcp://*:5017')
  for await (const rawMessage of sink) {
    console.log('Message from worker: ', rawMessage.toString())
  }
} 
```

当我们希望引起您对代码块中特定部分的注意时，相关的行或项目将以粗体突出显示：

```js
const wss = new ws.Server({ server })
wss.on('connection', client => {
  console.log('Client connected')
  client.on('message', msg => {
    console.log(`Message: ${msg}`)
    **redisPub.publish(****'chat_messages'****, msg)**
  })
}) 
```

任何命令行输入或输出都应如下编写：

```js
node replier.js
node requestor.js 
```

**新术语**和**重要词汇**以粗体显示。屏幕上看到的单词，例如在菜单或对话框中，在文本中如下所示：“为了解释问题，我们将创建一个小型**网络蜘蛛**，这是一个命令行应用程序，它接受网页 URL 作为输入，并将其内容下载到本地文件中。”

警告或重要注意事项如下所示。

技巧和窍门如下所示。

大多数 URL 都通过我们自己的短网址系统链接，以便读者通过印刷版更容易访问。这些链接的形式为[nodejsdp.link/some-descriptive-id](http://nodejsdp.link/some-descriptive-id)。

# 联系我们

我们欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请在邮件主题中提及书名，并将邮件发送至`customercare@packtpub.com`。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，如果您能向我们报告这一点，我们将不胜感激。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)，选择您的书籍，点击**勘误提交表单**链接，并输入详细信息。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过`copyright@packt.com`与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

## 评论

请留下评论。一旦您阅读并使用过这本书，为何不在您购买它的网站上留下评论呢？潜在读者可以查看并使用您的客观意见来做出购买决定，Packt 公司可以了解您对我们产品的看法，我们的作者也可以看到他们对书籍的反馈。谢谢！

关于 Packt 的更多信息，请访问[packt.com](http://packt.com)。
