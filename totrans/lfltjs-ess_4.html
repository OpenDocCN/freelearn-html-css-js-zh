<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 4. Creating Custom Markers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating Custom Markers</h1></div></div></div><p>In <a class="link" href="ch03.html" title="Chapter 3. Creating Heatmaps and Choropleth Maps">Chapter 3</a>, <span class="emphasis"><em>Creating Heatmaps and Choropleth Maps</em></span>, you learned how to style your maps to create a heatmap and a choropleth map. Leaflet allows you to further customize the style of your map by modifying the default markers. In this chapter, you will learn how to style markers by creating custom marker icons. You will also learn about the available marker plugins for styles and effects.</p><div class="section" title="Creating a custom marker"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Creating a custom marker</h1></div></div></div><p>In Leaflet, a marker is made from two images: an image that represents the marker and a second image<a id="id235" class="indexterm"/> that serves as the shadow to create depth. When you download Leaflet, there is an <code class="literal">images</code> folder. This folder contains the default marker: the blue pin that you have seen in your maps and a small shadow image. The images are named <code class="literal">marker-icon.png</code> and <code class="literal">marker-shadow.png</code>. The default marker and shadow are shown in the following screenshots:</p><div class="mediaobject"><img src="images/4812OS_04_01.jpg" alt="Creating a custom marker"/></div><div class="mediaobject"><img src="images/4812OS_04_02.jpg" alt="Creating a custom marker"/></div><div class="section" title="Preparing your workspace in GIMP"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec36"/>Preparing your workspace in GIMP</h2></div></div></div><p>To create <a id="id236" class="indexterm"/>your own custom marker, you will need to draw an image in a painting application. In this example, you will use the free <span class="strong"><strong>GNU Image Manipulation Program</strong></span> (<span class="strong"><strong>GIMP</strong></span>). GIMP is a powerful imaging program that is similar to Adobe Photoshop which runs on most operating <a id="id237" class="indexterm"/>systems and is completely free. To download GIMP, go to <a class="ulink" href="http://www.gimp.org/downloads/">http://www.gimp.org/downloads/</a> and click on <span class="strong"><strong>Download GIMP 2.8.10</strong></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>You do not need to select a 32- or 64-bit version. GIMP includes both and will determine the appropriate version when the installer runs.</p></div></div><p>Once <a id="id238" class="indexterm"/>GIMP is installed, launch the application. The application contains three windows: two panels on the left- and right-hand <a id="id239" class="indexterm"/>side of the screen and the main window in the center. You can combine the three windows into a standard single window application by navigating to <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Single-Window Mode</strong></span>. To create a new image file, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New...</strong></span>. You will be prompted with a new image dialog box. Enter a width and height for the icon image. If the advanced options are not expanded, click on the menu to expand the window. You can enter a resolution or accept the default. The <span class="strong"><strong>Fill with</strong></span> option is the most important. You must select <span class="strong"><strong>Transparency</strong></span> from the dropdown. If you do not select <span class="strong"><strong>Transparency</strong></span>, your icon will be a square or rectangle with a background color. This will not look flattering on your map. The dialog box should now look like the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_03.jpg" alt="Preparing your workspace in GIMP"/></div></div><div class="section" title="Drawing and saving your image"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec37"/>Drawing and saving your image</h2></div></div></div><p>Now that<a id="id240" class="indexterm"/> the canvas is set up, you can draw your image. How <a id="id241" class="indexterm"/>we draw the image is beyond the scope of this book.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>If you would like to learn about GIMP, check out <span class="emphasis"><em>Gimp 2.6 Cookbook</em></span>, <span class="emphasis"><em>Juan Manuel Ferreyra</em></span>, <span class="emphasis"><em>Packt Publishing</em></span>, available at <a class="ulink" href="http://www.packtpub.com/gimp-2-6-cookbook/book">http://www.packtpub.com/gimp-2-6-cookbook/book</a>.</p></div></div><p>If you are comfortable drawing in GIMP, create an image that can be used as your icon. Once you have created the image, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Export As...</strong></span>. If you try to use the <span class="strong"><strong>Save</strong></span> or <span class="strong"><strong>Save As…</strong></span> options, you will not get the options for PNG. The <span class="strong"><strong>Export Image</strong></span> dialog box allows you to choose the filename and where you would like to save the file. On the bottom-left corner of the dialog, expand the menu labeled <span class="strong"><strong>Select File Type (By Extension)</strong></span>. Scroll down to <span class="strong"><strong>PNG image</strong></span> and click on <span class="strong"><strong>Export</strong></span>. You will be prompted with the <span class="strong"><strong>Export Image as PNG</strong></span> dialog box. You must check the <span class="strong"><strong>Save color values from transparent pixels</strong></span> option. The options form should look like the one shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_04.jpg" alt="Drawing and saving your image"/></div><p>Click on the <span class="strong"><strong>Export</strong></span> button to save the image. The following screenshot is the finished icon:</p><div class="mediaobject"><img src="images/4812OS_04_05.jpg" alt="Drawing and saving your image"/></div></div><div class="section" title="Drawing the marker shadow"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec38"/>Drawing the marker shadow</h2></div></div></div><p>Create <a id="id242" class="indexterm"/>another new image in GIMP, but select a larger width and smaller height: 60 x 40. The shadow will need to start at the same point as the tip of the marker and extend at approximately 45 degrees to the right. In GIMP, you can move the cursor over the image and see the pixel coordinates of the cursor. The shadow image is drawn horizontally at 20 pixels. The image in the following screenshot shows you the cursor at the tip of the icon and the coordinates in the lower-left corner of the window:</p><div class="mediaobject"><img src="images/4812OS_04_06.jpg" alt="Drawing the marker shadow"/></div><p>On the shadow image, start shading from pixel 20 towards the upper-right corner of the image. The<a id="id243" class="indexterm"/> finished shadow image will look something like what is shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_07.jpg" alt="Drawing the marker shadow"/></div></div><div class="section" title="Using an image as an icon"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec39"/>Using an image as an icon</h2></div></div></div><p>You can <a id="id244" class="indexterm"/>also use an image as an icon. The image need not be PNG or have a transparent background. You can correct all of these things in GIMP. In GIMP, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open</strong></span> and select your image. The image in this example is JPG with a white background.</p><p>In the <span class="strong"><strong>Layers</strong></span> panel, you should see a single layer with a picture of your image on it. Right-click on the layer and select <span class="strong"><strong>Add Alpha Channel</strong></span>.</p><div class="mediaobject"><img src="images/4812OS_04_08.jpg" alt="Using an image as an icon"/></div><p>You can <a id="id245" class="indexterm"/>now select the erase tool or the magic wand and remove the background color. Export the image as instructed in the previous section. You will still need to draw a shadow for your marker icon. Follow the same steps as the shadow in the previous example and save the image.</p><p>Now that you have two images—the icon and the shadow—it is time to use them in your Leaflet map.</p></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Using a custom marker in Leaflet"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Using a custom marker in Leaflet</h1></div></div></div><p>To <a id="id246" class="indexterm"/>create a marker icon in Leaflet, you need to create <a id="id247" class="indexterm"/>an instance of the <code class="literal">L.icon</code> class. The <code class="literal">L.icon</code> class<a id="id248" class="indexterm"/> takes 10 options, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">iconUrl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">iconRetinaUrl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">iconSize</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">iconAnchor</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">shadowUrl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">shadowRetinaUrl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">shadowSize</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">shadowAnchor</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">popupAnchor</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">className</code></li></ul></div><p>The <a id="id249" class="indexterm"/>only<a id="id250" class="indexterm"/> required <a id="id251" class="indexterm"/>option <a id="id252" class="indexterm"/>is<a id="id253" class="indexterm"/> <code class="literal">iconUrl</code>. In<a id="id254" class="indexterm"/> this<a id="id255" class="indexterm"/> example, you <a id="id256" class="indexterm"/>will<a id="id257" class="indexterm"/> ignore<a id="id258" class="indexterm"/> the retina images and the class name. Open <code class="literal">LeafletEssentials.html</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">var myIcon = L.icon({
    iconUrl: 'mymarker.png',
    shadowUrl: 'shadow.png',
    iconSize:     [40, 60], 
    shadowSize:   [60, 40], 
    iconAnchor:   [20, 60], 
    shadowAnchor: [20, 40],  
    popupAnchor:  [0, -53] 
});</pre></div><p>The preceding code sets the options. The <code class="literal">iconUrl</code> option directs the URL to the icon image and the <code class="literal">shadowUrl</code> option directs the URL to the shadow image. The <code class="literal">iconSize</code> and <code class="literal">shadowSize</code> options require the dimensions of the images in the format of width by height.</p><p>The <code class="literal">iconAnchor</code> options set the point at which the marker and icon touch the map and where the pop up touches the icon. The marker had a point at the horizontal pixel 20, so this will be the anchor plus the height of the image in pixels. The shadow was drawn at the point of the marker, so its anchor will be at 20 and its height will be 40 pixels. You want the pop up to be drawn at the top in the center of the marker, so you must set its anchor accordingly.</p><p>The <code class="literal">popupAnchor</code> option is set relative to the <code class="literal">iconAnchor</code> option. The icon point is centered horizontally, so the pop-up anchor will be 0 pixels, making it anchored at 20. To place the anchor at the top of the marker, you subtract pixels. Choosing a value of -53 for the <a id="id259" class="indexterm"/>pop-up anchor opens the pop up just above<a id="id260" class="indexterm"/> the icon.</p><div class="mediaobject"><img src="images/4812OS_04_21.jpg" alt="Using a custom marker in Leaflet"/></div><p>Next, you need to create a marker and tell it to use your new icon. The following code will do just that:</p><div class="informalexample"><pre class="programlisting">var marker = L.marker([35.10418, -106.62987],{icon: myIcon}).addTo(map).bindPopup("I am a custom marker.");</pre></div><p>In <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <span class="emphasis"><em>Creating Maps with Leaflet</em></span>, you created markers with several options—one being <code class="literal">draggable:true</code>. The marker class also takes an icon as an option. In the preceding code, the <code class="literal">icon</code> option takes the name of an <code class="literal">L.Icon</code> object.</p><p>Save <code class="literal">LeafletEssentials.html</code> and open it in your browser. You should see a map similar to the one shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_09.jpg" alt="Using a custom marker in Leaflet"/></div><div class="section" title="Defining an L.Icon class"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec40"/>Defining an L.Icon class</h2></div></div></div><p>You can also extend the <code class="literal">L.Icon</code> class to create your own marker class. This allows you to <a id="id261" class="indexterm"/>create markers in a variety of colors and only <a id="id262" class="indexterm"/>specify the size and anchor options once. This example will look very similar to the previous example. Add the following code to your <code class="literal">LeafletEssentials.html</code> file:</p><div class="informalexample"><pre class="programlisting">var MyIcon = L.Icon.extend({
    options:{
    shadowUrl: 'shadow.png',
    iconSize:     [40, 60], 
    shadowSize:   [60, 40], 
    iconAnchor:   [20, 60], 
    shadowAnchor: [20, 40],  
    popupAnchor:  [0, -53] }
});</pre></div><p>The preceding code looks almost identical to the code in the previous example, except for the following differences:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first line, which instead of creating a new <code class="literal">L.icon</code> class, extends it</li><li class="listitem" style="list-style-type: disc">The options are wrapped in an object in line two</li><li class="listitem" style="list-style-type: disc">There is no <code class="literal">iconUrl</code> option</li></ul></div><p>By wrapping the options in an object, you can pass additional options when you create the marker. Add the following code to the <code class="literal">LeafletEssentials.html</code> file:</p><div class="informalexample"><pre class="programlisting">var redIcon= new myIcon({iconUrl: 'mymarker.png'});
var blueIcon=new myIcon({iconUrl: 'mybluemarker.png'});</pre></div><p>The <a id="id263" class="indexterm"/>preceding code sets the <code class="literal">iconUrl</code> option <a id="id264" class="indexterm"/>for each new <code class="literal">icon</code> object. Now, in one line of code, you have a red and blue icon. You can now assign the icon to a marker, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var marker = L.marker([35.10418, -106.62987],{icon: redIcon}).addTo(map).bindPopup("I am a custom marker.");
var marker = L.marker([35, -106],{icon: blueIcon}).addTo(map).bindPopup("I am a custom marker.");</pre></div><p>In the preceding code, each marker is assigned a different color icon. The result is shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_10.jpg" alt="Defining an L.Icon class"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Using predefined markers with plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Using predefined markers with plugins</h1></div></div></div><p>In the<a id="id265" class="indexterm"/> first three chapters, you used the default Leaflet marker. In this chapter, you have just learned how to draw your own or use a pre-existing image. Rolling your own is not always practical, especially if you are not proficient in drawing. In this section, you will learn about two plugins that have stylish markers that you can customize and use in your Leaflet map: Maki markers and Bootstrap/Awesome markers.</p><div class="section" title="Using Mapbox Maki markers"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec41"/>Using Mapbox Maki markers</h2></div></div></div><p>Mapbox<a id="id266" class="indexterm"/> is a company that provides a mapping <a id="id267" class="indexterm"/>platform and tools. Its icons have been made available<a id="id268" class="indexterm"/> through the <code class="literal">Leaflet.Makimarkers</code> plugin. You can download the plugin at <a class="ulink" href="https://github.com/jseppi/Leaflet.MakiMarkers">https://github.com/jseppi/Leaflet.MakiMarkers</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>You can learn about Mapbox by visiting their website at <a class="ulink" href="http://mapbox.com">http://mapbox.com</a>.</p></div></div><p>Maki markers is an open source icon library with over 100 available markers. You can find a full list of their names in the <code class="literal">Leaflet.MakiMarkers.js</code> file or go to the website at <a class="ulink" href="https://www.mapbox.com/maki/">https://www.mapbox.com/maki/</a>. The following screenshot shows you all of the icons:</p><div class="mediaobject"><img src="images/4812OS_04_11.jpg" alt="Using Mapbox Maki markers"/></div><p>The icons in the preceding screenshot are placed on a colored marker symbol. Using the markers in your map requires only two lines of code and three options. The following steps will help you create a Maki marker and place it on your map:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the JavaScript file. No CSS file is required with this plugin:<div class="informalexample"><pre class="programlisting">&lt;script src="Leaflet.MakiMarkers.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create an icon. You have to choose three options: the icon image you want to use, the hex color value of the marker, and the size (<code class="literal">s</code>, <code class="literal">m</code>, <code class="literal">l</code>):<div class="informalexample"><pre class="programlisting">var icon = L.MakiMarkers.icon({icon: "rocket", color: "#0a0", size: "l"});</pre></div></li><li class="listitem">Add the<a id="id269" class="indexterm"/> icon to a marker and add <a id="id270" class="indexterm"/>the marker to the map:<div class="informalexample"><pre class="programlisting">L.marker([35.10418, -106.62987], {icon: icon}).addTo(map);</pre></div></li></ol></div><p>When you select a color, there will be an outline in a lighter shade of the same color. The following screenshot shows you the results of the preceding code:</p><div class="mediaobject"><img src="images/4812OS_04_12.jpg" alt="Using Mapbox Maki markers"/></div></div><div class="section" title="Using Bootstrap and Font Awesome markers"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec42"/>Using Bootstrap and Font Awesome markers</h2></div></div></div><p>Another plugin for Leaflet that allows you to use predefined markers is <code class="literal">Leaflet.awesome.markers</code>. This plugin allows you to choose the Twitter Bootstrap markers<a id="id271" class="indexterm"/> or the Font Awesome<a id="id272" class="indexterm"/> markers. If you can't <a id="id273" class="indexterm"/>choose, you can always use both. The different <a id="id274" class="indexterm"/>libraries provide different icons to your markers and slightly different functionalities. Which one you use is a personal preference. You <a id="id275" class="indexterm"/>can download the plugin at <a class="ulink" href="https://github.com/lvoogdt/Leaflet.awesome-markers">https://github.com/lvoogdt/Leaflet.awesome-markers</a>.</p><p>Using <code class="literal">Leaflet.awesome.markers</code> is almost the same procedure as you used in the Maki marker example. You can perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to Twitter Bootstrap or Font Awesome or both. Also, add a reference to the CSS and JavaScript for <code class="literal">Leaflet.awesome.markers</code>:<div class="informalexample"><pre class="programlisting">&lt;link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"&gt;
&lt;link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"&gt;
&lt;link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"&gt;
&lt;link rel="stylesheet" href="Leaflet.awesome-markers.css"&gt;
&lt;script src="http://netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"&gt;&lt;/script&gt;
&lt;script src="Leaflet.awesome-markers.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create <a id="id276" class="indexterm"/>a Twitter <a id="id277" class="indexterm"/>Bootstrap marker<a id="id278" class="indexterm"/> and add it to the map. The Bootstrap <a id="id279" class="indexterm"/>marker is the default. You only need to set the icon image and color options. Create the marker and add it to the map:<div class="informalexample"><pre class="programlisting">var redMarker = L.AwesomeMarkers.icon({
    icon: 'tint',
    markerColor: 'red'
  });
  L.marker([35.10418, -106.62987], {icon: redMarker}).addTo(map);</pre></div></li><li class="listitem">Create a Font Awesome marker and add it to the map. Since Bootstrap is the default, you need to use the <code class="literal">prefix</code> option with the value of <code class="literal">fa</code> for Font Awesome. This example also uses the <code class="literal">spin:true</code> option to create an animated spinning marker. Create the marker and add it to the map:<div class="informalexample"><pre class="programlisting">var blueMarker = L.AwesomeMarkers.icon({
    prefix:'fa',
    spin:true,
    icon: 'spinner',
    markerColor: 'blue'
  });
  L.marker([35, -106], {icon: blueMarker}).addTo(map);</pre></div></li></ol></div><p>The preceding code will produce the map shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_13.jpg" alt="Using Bootstrap and Font Awesome markers"/></div><p>You<a id="id280" class="indexterm"/> might not always have the <a id="id281" class="indexterm"/>time to create your own markers, and <a id="id282" class="indexterm"/>when you have the option to use icons by <a id="id283" class="indexterm"/>Mapbox, Twitter, or Font Awesome, why reinvent the wheel? Take advantage of what has already been done, and do it extremely well.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Clustering markers with Leaflet.markercluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Clustering markers with Leaflet.markercluster</h1></div></div></div><p>As you<a id="id284" class="indexterm"/> create more maps, you will <a id="id285" class="indexterm"/>eventually run in to a dataset that is <a id="id286" class="indexterm"/>thousands of points. Displaying 10,000 points on a map results in a slow load time, lagging animation on zooming and panning, and makes it hard for the user to select a single marker or to make sense of the data. Clustering allows you to group markers into clusters—single points that expand as the zoom level increases. This way, you can get a sense of the magnitude of data without being visually overwhelmed by the sheer number of points. If you need to see a single point, you can zoom in to the region or point of interest. <code class="literal">Leaflet.markercluster</code> is a fast and powerful cluster implementation that is also visually<a id="id287" class="indexterm"/> appealing.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>You <a id="id288" class="indexterm"/>can <a id="id289" class="indexterm"/>download this plugin<a id="id290" class="indexterm"/> at <a class="ulink" href="https://github.com/Leaflet/Leaflet.markercluster">https://github.com/Leaflet/Leaflet.markercluster</a>.</p></div></div><div class="section" title="Coding your first cluster map"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec43"/>Coding your first cluster map</h2></div></div></div><p>A marker<a id="id291" class="indexterm"/> cluster is just another example of a layer in Leaflet. So, creating<a id="id292" class="indexterm"/> one should look very familiar to you. You need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Using <code class="literal">LeafletEssentials.html</code>, add a reference to the <code class="literal">Leaflet.markercluster</code> CSS files and the JS file, as shown in the following code:<div class="informalexample"><pre class="programlisting">&lt;link rel="stylesheet" href="MarkerCluster.Default.css" /&gt;
&lt;script src="Leaflet.markercluster.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">You can add a series of markers to the layer, but since you will be loading 723 points, you will use a JS file with the data inside. The data can have additional attributes. In this example, there is a link to an image file. Add a reference to the JS file that contains the data:<div class="informalexample"><pre class="programlisting">&lt;script src="art.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Since you now know how to create custom marker icons, the following code creates an icon class and an icon that can be used when the clusters expand:<div class="informalexample"><pre class="programlisting">var abqIcon = L.Icon.extend({
        options: {
            shadowUrl: 'vase-shadow.png',
            iconSize:     [50, 64],
            shadowSize:   [50, 64],
            iconAnchor:   [25, 64],
            shadowAnchor: [0, 64],
            popupAnchor:  [-3, -64]
        }
    });

var vase = new abqIcon({iconUrl: 'vase.png'});</pre></div></li><li class="listitem">Now, create a <code class="literal">markercluster</code> layer by creating an instance of the <code class="literal">MarkerClusterGroup</code> class. Set the <code class="literal">showCoverageOnHover</code> option to <code class="literal">false</code>:<div class="informalexample"><pre class="programlisting">var markers = new L.MarkerClusterGroup({showCoverageOnHover:false});</pre></div></li><li class="listitem">To add<a id="id293" class="indexterm"/> markers to the group, you need a function <a id="id294" class="indexterm"/>that uses the array from the data file to loop through each data point and add the latitude, longitude, and any other attributes you want to use in the pop up to a marker. The loop creates a marker, binds a pop up, and adds the marker as a layer to the <code class="literal">markercluster</code> group. Then, call the function to start loading the data:<div class="informalexample"><pre class="programlisting">function populate() {
  for (var i = 0; i &lt; artPoints.length; i++) {
      var a = artPoints[i];
      var title = a[2];
var marker = new L.Marker(new L.LatLng(a[0], a[1]), { icon: vase , title: title });
      marker.bindPopup(title);
      markers.addLayer(marker);
      
          }
      }

populate();</pre></div></li><li class="listitem">Lastly, add the <code class="literal">markercluster</code> group layer to the map using the following code:<div class="informalexample"><pre class="programlisting">map.addLayer(markers);</pre></div></li></ol></div><p>Your map should look like the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_14.jpg" alt="Coding your first cluster map"/></div><p>When you <a id="id295" class="indexterm"/>zoom in to the map, the clusters should expand and<a id="id296" class="indexterm"/> the groupings become smaller. They will then expand to reveal individual markers, as shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_15.jpg" alt="Coding your first cluster map"/></div></div><div class="section" title="Methods and events available to markercluster layers"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec44"/>Methods and events available to markercluster layers</h2></div></div></div><p>The <code class="literal">markercluster</code> layer<a id="id297" class="indexterm"/> has several options and methods that can be used to create and interact<a id="id298" class="indexterm"/> with your layer.</p><div class="section" title="Options that default to true"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec11"/>Options that default to true</h3></div></div></div><p>There <a id="id299" class="indexterm"/>are four default options<a id="id300" class="indexterm"/> that are all set to <code class="literal">true</code>, as <a id="id301" class="indexterm"/>follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">showCoverageOnHover</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">zoomToBoundsOnClick</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">spiderfyOnMaxZoom</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">removeOutsideVisibleBounds</code></li></ul></div><p>The <a id="id302" class="indexterm"/>first option shows you a polygon that represents the coverage area of the markers in the cluster. This can be confusing as a colored polygon appears on the map. In the previous example, you set this option to <code class="literal">false</code>.</p><p>When you<a id="id303" class="indexterm"/> click on a cluster, the second option zooms to the polygon that represents the coverage area of the cluster you clicked on. When you zoom all the way into the map or use the defined <code class="literal">maxZoom</code> option, the cluster will expand to reveal the markers within it.</p><p>The last option improves performance by not displaying clusters that are not within a close proximity of the current map view. You do not need to see a cluster in New York if you are looking at Los Angeles.</p></div><div class="section" title="Other options and events"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec12"/>Other options and events</h3></div></div></div><p>The <a id="id304" class="indexterm"/>other options you might want to <a id="id305" class="indexterm"/>set are <code class="literal">animateAddingMarkers</code> and <code class="literal">maxClusterRadius</code>. Animated markers create a visually interesting map, but if you are using a large set of data points, it can slow the performance of your map. It is an effect that should be used sparingly and under the right conditions. Adjusting the radius of the cluster can create larger or smaller clusters. The default is 80 pixels. If you are displaying tightly grouped data, you will need a smaller number, and if you are displaying data that is dispersed, you might need a larger radius. In the previous example, if the radius is set to <code class="literal">5</code>, the markers take over the map because they are not getting clustered due to the small radius. The following screenshot shows you the map when the radius is set to <code class="literal">5</code>:</p><div class="mediaobject"><img src="images/4812OS_04_16.jpg" alt="Other options and events"/></div><p>The<a id="id306" class="indexterm"/> preceding screenshot is cluttered <a id="id307" class="indexterm"/>with markers, making the map almost unreadable. The <code class="literal">markercluster</code> layer has events that you can subscribe to. Usually, you subscribe to an event on the map using <code class="literal">map.on(click, function)</code>. With the <code class="literal">markercluster</code> layer, you add a cluster to the available layer events so that they will apply to the <code class="literal">markercluster</code> layer, such as <code class="literal">markers.on(clusterclick,function)</code>.</p></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Animating markers with plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Animating markers with plugins</h1></div></div></div><p>In the <a id="id308" class="indexterm"/>next two sections, you will learn how to animate markers using the <code class="literal">Leaflet.BounceMarker</code> and <code class="literal">Leaflet.AnimatedMarker</code> plugins. Animation adds a wow factor to your map, but if overdone, it can make your map appear amateurish.</p><div class="section" title="Bouncing your markers"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec45"/>Bouncing your markers</h2></div></div></div><p>The <a id="id309" class="indexterm"/>
<code class="literal">Leaflet.BounceMarker</code> plugin does not have a large number of options to customize the <a id="id310" class="indexterm"/>markers or their behavior, but it provides a simple animation that is useful when you add markers to the map or on the<a id="id311" class="indexterm"/> hover event. You can download and learn more about the plugin at <a class="ulink" href="https://github.com/maximeh/leaflet.bouncemarker">https://github.com/maximeh/leaflet.bouncemarker</a>.</p><p>The <a id="id312" class="indexterm"/>following steps will show you <a id="id313" class="indexterm"/>how to add a bounce marker to your map:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the JavaScript file. There is no CSS file required for this plugin:<div class="informalexample"><pre class="programlisting">&lt;script src="bouncemarker.js"&gt;&lt;/script&gt;	</pre></div></li><li class="listitem">Creating a bounce marker is exactly the same as creating a standard Leaflet marker; the plugin adds an additional option to the <code class="literal">L.Marker</code> class. Because of this, the bounce marker has a <code class="literal">bounceOnAdd</code> option, and it defaults to <code class="literal">false</code>. Every marker you create will bounce unless you specify otherwise. Set this option to <code class="literal">true</code> for any markers you would like to bounce. Add the marker to the map.<div class="informalexample"><pre class="programlisting">marker = new L.Marker([35.10418, -106.62987], {bounceOnAdd: true,}).addTo(map);</pre></div></li></ol></div><p>The only other options you can specify on a bounce marker are the height, duration, and a callback function when finished. You set them as shown in the following code:</p><div class="informalexample"><pre class="programlisting">marker.bounce({duration: 1000, height: 200}, function(){alert("Finished")});</pre></div><p>Height is in pixels and duration is in milliseconds. Animation takes resources to run, so make sure that you do not create animations that run too quickly, or you will find that your marker disappears and only the shadow is visible. Also, remember that if you intend for your map to be consumed on mobile devices, the performance might be slower than on your desktop.</p><p>The <code class="literal">bounce()</code> method works well with the hover event. When there are many markers and they are tightly grouped, making the one you are hovering over bounce helps make sure that you click on the correct one.</p><p>To make a marker bounce on a hover event, subscribe to the event and call a function when the mouse hovers over the marker:</p><div class="informalexample"><pre class="programlisting">marker.on('mouseover',function(){marker.bounce({duration: 500, height: 100});});</pre></div><p>The preceding code subscribes to the <code class="literal">mouseover</code> event and executes an anonymous function when the mouse hovers over the marker. The anonymous function calls the <code class="literal">bounce()</code> method, making the marker do just that when you move the mouse over it.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>The <code class="literal">Leaflet.BounceMarker</code> plugin is an excellent plugin; however, you might <a id="id314" class="indexterm"/>experience some hiccups in your animations. This is not to be blamed on the plugin, but<a id="id315" class="indexterm"/> rather on the nature of animations and the large number of resources they require.</p></div></div></div><div class="section" title="Making your markers move"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec46"/>Making your markers move</h2></div></div></div><p>With the <code class="literal">Leaflet.AnimatedMarker</code> plugin, you can make your markers move along a polyline. This<a id="id316" class="indexterm"/> comes in handy <a id="id317" class="indexterm"/>when you want to draw attention to a route. A marker moving along the route attracts the eye more than a line on<a id="id318" class="indexterm"/> the map. For more information and to download the plugin, go to <a class="ulink" href="https://github.com/openplans/Leaflet.AnimatedMarker">https://github.com/openplans/Leaflet.AnimatedMarker</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>One caveat is that if the user zooms in on the map while the animation is running, the marker will move from its path and then try to return. It might be a good idea to disable the map zoom until the animation has finished.</p></div></div><p>To animate your markers, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the JavaScript file. No CSS file is required for this plugin:<div class="informalexample"><pre class="programlisting">&lt;script src="AnimatedMarker.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create a polyline to represent the path that the marker will be animated along:<div class="informalexample"><pre class="programlisting">var line = L.polyline([[35.10306, -106.58695],[35.1046, -106.60137],[35.10727, -106.61734],[35.1046, -106.63794],[35.10601, -106.69287]]);</pre></div></li><li class="listitem">Create an <code class="literal">animatedMarker</code> variable. The marker takes an array of latitudes and longitudes. To get it, use the <code class="literal">getLatLngs()</code> method of the line you created:<div class="informalexample"><pre class="programlisting">var animatedMarker = L.animatedMarker(line.getLatLngs());</pre></div></li><li class="listitem">Add the animated marker layer to the map. In this example, you will also add the line so that you can see it as a reference:<div class="informalexample"><pre class="programlisting">map.addLayer(line);
map.addLayer(animatedMarker);</pre></div></li></ol></div><p>When you open your map, it should look like the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_17.jpg" alt="Making your markers move"/></div><p>Because <a id="id319" class="indexterm"/>you did not pass<a id="id320" class="indexterm"/> any options to the marker, it will take a minute to start moving and will move fairly slowly across the blue line. The<a id="id321" class="indexterm"/> plugin has the following<a id="id322" class="indexterm"/> options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">distance</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">interval</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">autoStart</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">onEnd</code></li></ul></div><p>The <a id="id323" class="indexterm"/>
<code class="literal">distance</code> and <code class="literal">interval</code> options <a id="id324" class="indexterm"/>set the rate at which the marker will travel along the line. Distance is measured in meters, and interval is measured in milliseconds. Since it is a rate, an option of <code class="literal">{distance:100, interval 1000}</code> would be slower than an option of <code class="literal">{distance:300, interval:1000}</code>. In the first setting, the marker covers 100 meters in one second, and in the second setting, it would cover three times the distance in the same time.</p><p>The <code class="literal">autoStart</code> option is set to <code class="literal">true</code> by default. If you set it to <code class="literal">false</code>, you can call a <code class="literal">start()</code> method on the marker when you are ready. In the code used in the following steps, you will make a map with two buttons: <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>Stop</strong></span>. Using <code class="literal">autoStart:false</code>, you will allow the user to determine when to start the marker and when to stop it along its path:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Building on the previous example using the same line and marker, add an option<a id="id325" class="indexterm"/> to the <a id="id326" class="indexterm"/>marker for <code class="literal">distance</code> and <code class="literal">interval</code> and set <code class="literal">autoStart</code> to <code class="literal">false</code>:<div class="informalexample"><pre class="programlisting">var line = L.polyline([[35.10306, -106.58695],[35.1046, -106.60137],[35.10727, -106.61734],[35.1046, -106.63794],[35.10601, -106.69287]]);
var animatedMarker = L.animatedMarker(line.getLatLngs(),{autoStart: false, distance: 600, interval: 900});</pre></div></li><li class="listitem">Write a <code class="literal">start()</code> and <code class="literal">stop()</code>function to control the animation. Call the <code class="literal">start()</code> and <code class="literal">stop()</code> methods on the marker in the corresponding function:<div class="informalexample"><pre class="programlisting">function start(){animatedMarker.start();}
function stop(){animatedMarker.stop();}</pre></div></li><li class="listitem">In the HTML, before the <code class="literal">&lt;/body&gt;</code> tag, add two buttons and set their <code class="literal">onClick</code> event equal to the corresponding function:<div class="informalexample"><pre class="programlisting">&lt;button onclick="start()"&gt;Start&lt;/button&gt;
&lt;button onclick="stop()"&gt;Stop&lt;/button&gt;</pre></div></li></ol></div><p>Your map should look like the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_18.jpg" alt="Making your markers move"/></div><p>The marker will not move until the user clicks on the <span class="strong"><strong>Start</strong></span> button. When the user clicks on the <span class="strong"><strong>Stop</strong></span> button, the marker will not stop immediately. Animation occurs in segments along <a id="id327" class="indexterm"/>each segment of the<a id="id328" class="indexterm"/> polyline. When the marker reaches the endpoint of a segment, it will stop and not resume until the user clicks on <span class="strong"><strong>Start</strong></span> again.</p><p>The last setting was <code class="literal">onEnd</code>. This option allows you to specify a callback function that will run when the marker gets to the end of the line. In the code in the following steps, you will use the bounce marker plugin you learned about earlier in this chapter to make the marker bounce and then disappear when it finishes. Follow the next set of steps to create your map:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Building on the previous example, add a reference to the bounce marker plugin:<div class="informalexample"><pre class="programlisting">&lt;script src="bouncemarker.js"&gt;&lt;/script&gt;	</pre></div></li><li class="listitem">Create the bounce marker at the last point of the line:<div class="informalexample"><pre class="programlisting">b = new L.Marker([35.10601, -106.69287], {bounceOnAdd: true});</pre></div></li><li class="listitem">Edit the animated marker to include the <code class="literal">onEnd</code> option with an anonymous function. The anonymous function will add the bounce marker to the map, make<a id="id329" class="indexterm"/> it bounce, remove the animated marker, and then wait 900 milliseconds and call <a id="id330" class="indexterm"/>a <code class="literal">bye()</code>function, which will remove the bounce marker. The waiting will allow the marker to disappear after the bouncing is finished. This slows the process down so that the animation is not so abrupt. You could also use the callback function available to the bounce marker instead of the <code class="literal">bye()</code> function:<div class="informalexample"><pre class="programlisting">var animatedMarker = L.animatedMarker(line.getLatLngs(),{autoStart: false, distance: 600, interval: 900, onEnd: function() {b.addTo(map);b.bounce({duration: 100, height: 50});map.removeLayer(animatedMarker);setTimeout('bye()',900);}});50});map.removeLayer(animatedMarker);setTimeout('bye()',900);}});</pre></div></li></ol></div><p>Your map will look exactly the same as the previous example. When the marker reaches the end of the line, it will appear to bounce and disappear from the map. A fun project using custom and animated markers would be to recreate the Boston Marathon using a custom marker for each of the finishers and setting its rate to their actual race rate. When you click on the <span class="strong"><strong>Start</strong></span> button, you could replay the race.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Using markers for data visualization"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Using markers for data visualization</h1></div></div></div><p>You have learned about several different marker types that still look like your typical marker. In this section, you will learn how to add markers that create a pie and bar chart—not exactly your standard marker.</p><div class="section" title="Using the Leaflet Data Visualization Framework plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec47"/>Using the Leaflet Data Visualization Framework plugin</h2></div></div></div><p>The<a id="id331" class="indexterm"/> Leaflet Data Visualization Framework<a id="id332" class="indexterm"/> plugin allows you to create markers that are just shapes: a standard pin style marker with a shape cutout, a star marker, and a polygon marker. It also allows you to add pie chart and bar chart markers to your map.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>The Leaflet Data Visualization Framework plugin also has markers for radial bar charts, coxcomb charts, stacked and radial meter markers, as well as a data layer, choropleth layer, and a legend control. This is a plugin worth exploring. You<a id="id333" class="indexterm"/> can download it at <a class="ulink" href="http://humangeo.github.io/leaflet-dvf/">http://humangeo.github.io/leaflet-dvf/</a>.</p></div></div><div class="section" title="Creating basic markers"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec13"/>Creating basic markers</h3></div></div></div><p>Creating<a id="id334" class="indexterm"/> basic markers is straightforward. The code used in the following steps will walk you through making a marker, a polygon marker, and a star marker:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, create a reference to the CSS and two JavaScript files:<div class="informalexample"><pre class="programlisting">&lt;link rel="stylesheet" href="dvf.css" /&gt;
&lt;script src="Leaflet-dvf.js"&gt;&lt;/script&gt;
&lt;script src="Leaflet-dvf.markers.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Next, create the markers. What really makes this plugin stand out with regards to the standard markers is that you can use any of the options in the <code class="literal">L.Path</code> class. This allows you to fully customize your markers. Creating the markers <a id="id335" class="indexterm"/>requires <a id="id336" class="indexterm"/>you to<a id="id337" class="indexterm"/> select the marker type— <code class="literal">MapMarker</code>, <code class="literal">RegularPolygonMarker</code>, or <code class="literal">StarMarker</code>—and then select the options:<div class="informalexample"><pre class="programlisting">var marker = new L.MapMarker([35.10418, -106.62987], {
    radius: 30,
fillOpacity:0.5,
fillColor:'orange',
color:'purple',
innerRadius:7,
numberOfSides:4,
rotation:10
    });
map.addLayer(marker);

var polygonmarker = new L.RegularPolygonMarker([35,-106], {
    numberOfSides: 3,
    rotation: 10,
    radius: 10,
fillColor:'green',
fillOpacity:1,
opacity:1,
weight:1,
radius:30
});
map.addLayer(polygonmarker);
var star = new L.StarMarker([35,-107], {numberOfPoints:8, opacity:1, weight:2, fillOpacity:0,radius:30});
map.addLayer(star); </pre></div></li></ol></div><p>When you open your map, it will look like the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_04_19.jpg" alt="Creating basic markers"/></div><p>There are<a id="id338" class="indexterm"/> too many options to list here, but to see them, go to the documentation for the plugin at <a class="ulink" href="https://github.com/humangeo/Leaflet-dvf/wiki/6.-Markers">https://github.com/humangeo/Leaflet-dvf/wiki/6.-Markers</a> and the documentation for the Leaflet <code class="literal">path</code> class at <a class="ulink" href="http://Leafletjs.com/reference.html#path">http://Leafletjs.com/reference.html#path</a>. The plugin options you will use the most for each marker are explained in the following sections.</p><div class="section" title="MapMarker options"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec01"/>MapMarker options</h4></div></div></div><p>The <a id="id339" class="indexterm"/>
<code class="literal">MapMarker</code> options used are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">numberOfSides</code>: The<a id="id340" class="indexterm"/> inner hole is determined by the number of sides: three for a triangle, four for a square. The larger the number, the closer to a circle it will be. If you leave this option blank, it will default to a circle.</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotation</code>: This<a id="id341" class="indexterm"/> helps you rotate the hole in the middle. This, of course, only works on shapes that are not a circle.</li><li class="listitem" style="list-style-type: disc"><code class="literal">radius</code>: This<a id="id342" class="indexterm"/> is the size of the marker.</li><li class="listitem" style="list-style-type: disc"><code class="literal">innerRadius</code>: This <a id="id343" class="indexterm"/>is the size of the hole in the middle.</li></ul></div></div><div class="section" title="RegularPolygonMarker options"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec02"/>RegularPolygonMarker options</h4></div></div></div><p>The <a id="id344" class="indexterm"/>
<code class="literal">RegularPolygonMarker</code> options used are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">numberOfSides</code>: This<a id="id345" class="indexterm"/> is the shape of the marker.</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotation</code>: This is the orientation of the marker. If you create a four-sided polygon <a id="id346" class="indexterm"/>and leave this blank, it will be a square. If you add rotation, you can make the corners point in any direction.</li><li class="listitem" style="list-style-type: disc"><code class="literal">radius</code>: This<a id="id347" class="indexterm"/> is the size of the marker.</li><li class="listitem" style="list-style-type: disc"><code class="literal">innerRadius</code>: This<a id="id348" class="indexterm"/> is the size of the hole in the middle.</li></ul></div></div><div class="section" title="StarMarker options"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec03"/>StarMarker options</h4></div></div></div><p>The <a id="id349" class="indexterm"/>
<code class="literal">StarMarker</code> options used are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">numberOfPoints</code>: This <a id="id350" class="indexterm"/>defines how many points the start should have</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotation</code>: This<a id="id351" class="indexterm"/> is the orientation of the marker</li><li class="listitem" style="list-style-type: disc"><code class="literal">radius</code>: This<a id="id352" class="indexterm"/> is the size of the marker</li><li class="listitem" style="list-style-type: disc"><code class="literal">innerRadius</code>: This <a id="id353" class="indexterm"/>is the size of the hole in the middle</li></ul></div></div></div></div><div class="section" title="Bar and pie chart markers"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Bar and pie chart markers</h2></div></div></div><p>Adding <a id="id354" class="indexterm"/>chart <a id="id355" class="indexterm"/>markers<a id="id356" class="indexterm"/> to <a id="id357" class="indexterm"/>your map allows you to show multiple pieces of data for a single point or polygon. For example, you could map all of the census blocks in your state and, using the center point of each block, you could place a chart showing the age distributions. This allows you to present a lot of data quickly and visually.</p><p>Making a bar or pie chart with the Leaflet Data Visualization Framework plugin only requires you to create an <code class="literal">options</code> object and pass it to the marker. The following steps will show you how to do both:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an <code class="literal">options</code> object with data and chart options. The data needs the name <a id="id358" class="indexterm"/>of the data category and the value. In the chart options object, you<a id="id359" class="indexterm"/> pass all of the options to style your chart. Three important options <a id="id360" class="indexterm"/>are <code class="literal">minValue</code>, <code class="literal">maxValue</code>, and <code class="literal">maxHeight</code>. These should, under<a id="id361" class="indexterm"/> most circumstances, be the same for all the categories. If you allow one category to have <code class="literal">maxHeight</code> higher than the rest, it can be displayed as a larger bar than another category with a higher value. Think of this as setting the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> axis scales in Excel. All the data should be within the same scale of the lowest value to the highest value. Changing the <code class="literal">maxHeight</code> option will also make your chart larger or smaller. The options outside of the chart options are for the stroke or outline of the chart.<p>When creating a pie chart, the <code class="literal">radius</code> option allows you to adjust the size of the marker:</p><div class="informalexample"><pre class="programlisting">var options = {
    data: {
        'data1': 20,
        'data2': 50,
        'data3': 10,
        'data4': 20
    },
    chartOptions: {
        'data1': {
            fillColor: 'blue',
            minValue: 0,
            maxValue: 50,
            maxHeight: 30,
               },
        'data2': {
            fillColor: 'red',
            minValue: 0,
            maxValue: 50,
            maxHeight: 30,
             },
        'data3': {
            fillColor: 'green',
            minValue: 0,
            maxValue: 50,
            maxHeight: 30,
                  },
        'data4': {
            fillColor: 'yellow',
            minValue: 0,
            maxValue: 50,
            maxHeight: 30,
             }
    },
    weight: 1,
    color: '#000000',
radius:30,
fillOpacity:1
};</pre></div></li><li class="listitem">Next, create the markers, pass the options, and add them to the map:<div class="informalexample"><pre class="programlisting">var bar = new L.BarChartMarker([35.10418, -106.62987], options);
map.addLayer(bar);

var pie= new L.PieChartMarker([35,-107],options);
map.addLayer(pie);</pre></div></li></ol></div><p>When <a id="id362" class="indexterm"/>you <a id="id363" class="indexterm"/>open <a id="id364" class="indexterm"/>your<a id="id365" class="indexterm"/> map, it should look like the following screenshot. When you hover over one of the data categories, you will see the color, category name, and value.</p><div class="mediaobject"><img src="images/4812OS_04_20.jpg" alt="Bar and pie chart markers"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Summary</h1></div></div></div><p>In this chapter, you learned how to add custom markers to your Leaflet map. You can now draw your own markers or use pre-existing images. You can also use plugins to load markers from Twitter, Font Awesome, and Mapbox. Lastly, you now know how to create bar chart and pie chart markers to visualize data in the form of a marker. At this point, you have acquired enough knowledge of Leaflet to build almost any style of map you can think of.</p><p>In the next chapter, you will learn how to use <span class="strong"><strong>Economic and Social Research Institute</strong></span> (<span class="strong"><strong>ESRI</strong></span>) data in your Leaflet map. As the most widely used GIS platform, you will most certainly run in to its data formats.</p></div></div>
</body></html>