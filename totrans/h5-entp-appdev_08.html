<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;The App: Selection UI via Drag-and-Drop"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. The App: Selection UI via Drag-and-Drop</h1></div></div></div><p>Even though drag-and-drop functionality has existed since 1999 when Microsoft implemented it in Internet Explorer 5.0, HTML5 brings it to the fore in a more standard way. The specification defines a set of APIs, event handlers, and markup for adding drag-and-drop functionality<a id="id487" class="indexterm"/> (DnD) to your enterprise application. To demonstrate this, we will implement the ability to drag-and-drop movie showtimes into a staging area in our MovieNow enterprise application to indicate movies the user is interested in seeing.</p><p>The main topics covered in this chapter are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding showtimes</li><li class="listitem" style="list-style-type: disc">Styling showtimes</li><li class="listitem" style="list-style-type: disc">What a drag</li><li class="listitem" style="list-style-type: disc">Drop it</li></ul></div><div class="section" title="Adding showtimes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec65"/>Adding showtimes</h1></div></div></div><a id="id488" class="indexterm"/><a id="id489" class="indexterm"/><p>We temporarily removed the showtimes from <a class="link" href="ch04.html" title="Chapter 4. The App: Getting Movies Via Geolocation">Chapter 4</a>, <span class="emphasis"><em>The App: Getting Movies via Geoloaction</em></span> to make room for movie data, synopses, trailers, and ratings. We will now put showtimes back. To do this, we will modify the <code class="literal">displayShowtimes</code> method in <code class="literal">movienow.geolocation.js</code> by inserting a <code class="literal">div</code> tag for showtimes and looping through the array of showtimes contained in the <code class="literal">movie</code> object we previously constructed. Notice how we include a <code class="literal">data-movie</code> attribute containing the theater ID, the movie ID, and the showtime. We do this in order to save some data about the showtime for later use when we want to know to which movie and which theater the showtime belongs.</p><p>We will insert the following code snippet into the <a id="id490" class="indexterm"/>
<code class="literal">displayShowtimes</code> method:</p><div class="informalexample"><pre class="programlisting">movieHTML+='&lt;div class="showtimes"&gt;';
if (typeof movie.showtime == 'string') movie.showtime = Array(movie.showtime);
for(var i=0; i&lt;movie.showtime.length; i++) {
if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" draggable="true" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie= "'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+that.formatTime(movie.showtime[i])+'&lt;/div&gt; ';
}
movieHTML+='&lt;/div&gt;';</pre></div><a id="id491" class="indexterm"/><a id="id492" class="indexterm"/><p>The complete method should look like this:</p><div class="informalexample"><pre class="programlisting">this.displayShowtimes = function(movies) {
  var movie = null;
  var html = '&lt;ul&gt;';
  for (var item in movies.items) {
    movie = movies.items[item];
    var movieDesc='';
    if (movie.synopsis) movieDesc=(movie.synopsis.length&gt;200)?movie.synopsis.substr(0,200)+"...": movie.synopsis;
    var movieHTML='&lt;li itemscope itemtype="http://schema.org/Movie"&gt;';
    movieHTML+='&lt;img src="'+movie.poster+'" alt="'+movie.title+'" width="120" /&gt;';
    movieHTML+='&lt;section class="main-info"&gt;';
    movieHTML+='&lt;input type="button" class="charting-button" /&gt;';
    movieHTML+='&lt;input type="button" class="details-button" /&gt;';
    movieHTML+='&lt;h3 itemprop="name"&gt;'+movie.title+'&lt;/h3&gt;';
    movieHTML+='&lt;p class="details genre" itemprop="genre"&gt;'+Array(movie.genre).join(', ')+'&lt;/p&gt;';
    movieHTML+='&lt;p class="details"&gt;'+movie.mpaaRating+'&lt;/p&gt;';
    movieHTML+='&lt;p class="theater"&gt;'+movie.theater.title+" "+movie.theater.address+'&lt;/p&gt;';
    movieHTML+='&lt;p class="actors"&gt;'+Array(movie.selectedStar).join(', ')+'&lt;/p&gt;';
    <span class="strong"><strong>movieHTML+='&lt;div class="showtimes"&gt;';</strong></span>
<span class="strong"><strong>    if (typeof movie.showtime == 'string') movie.showtime = Array(movie.showtime);</strong></span>
<span class="strong"><strong>    for(var i=0; i&lt;movie.showtime.length; i++) {</strong></span>
<span class="strong"><strong>      if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" draggable="true" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie="'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+movie.showtime[i]+'&lt;/div&gt; ';</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>    movieHTML+='&lt;/div&gt;';</strong></span>
    movieHTML+='&lt;/section&gt;';
    movieHTML+='&lt;section class="description"&gt;';
    movieHTML+='&lt;h3 itemprop="name"&gt;'+movie.title+'&lt;/h3&gt;';
    movieHTML+='&lt;p&gt;'+movieDesc+'&lt;/p&gt;';
    movieHTML+='&lt;/section&gt;';  
    movieHTML+='&lt;section class="charting"&gt;';
    movieHTML+='&lt;h3 itemprop="name"&gt;'+movie.title+'&lt;/h3&gt;';
    movieHTML+='&lt;p&gt;&lt;canvas data-feed= "MetaCritic:'+movie.avgMetaCriticRating+",EditorBoost:"+movie.editorBoost+",User Rating:"+movie.avgUserRating+'"&gt;&lt;/canvas&gt;&lt;/p&gt;';
    movieHTML+='&lt;/section&gt;';                     
    movieHTML+='&lt;/li&gt;';
    html+=movieHTML;
  }
  html+= '&lt;/ul&gt;';
  $('#movies-near-me').html(html);
  $("#movies-near-me li .details-button").click(that.showDetails);
  $("#movies-near-me li .description, #movies-near-me li .charting").click(function(){$(this).parent().removeClass("open")});
  $("#movies-near-me li .charting-button").click(that.showCharts);
  init();
};</pre></div><a id="id493" class="indexterm"/><a id="id494" class="indexterm"/><p>If you preview this change in a web browser, you should see something akin to the following:</p><div class="mediaobject"><img src="graphics/5689_08_01.jpg" alt="Adding showtimes"/></div></div></div>
<div class="section" title="Styling showtimes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec66"/>Styling showtimes</h1></div></div></div><a id="id495" class="indexterm"/><p>Of course, the raw showtime data does not look quite the way we traditionally look at time. We are going to need to format the time to make sure our users understand the data appropriately.</p><p>To accomplish this, we will modify the following line in <code class="literal">displayShowtimes</code>:</p><div class="informalexample"><pre class="programlisting">if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie= "'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+movie.showtime[i]+'&lt;/div&gt; ';</pre></div><p>We will wrap the display of the showtime with a call to a<a id="id496" class="indexterm"/> <code class="literal">formatTime</code> method, which we will write momentarily. Change the previous line so that it looks similar to the following line:</p><div class="informalexample"><pre class="programlisting">if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie= "'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+<span class="strong"><strong>that.formatTime(movie.showtime[i])</strong></span>+'&lt;/div&gt; ';</pre></div><a id="id497" class="indexterm"/><p>We can then add the following method to format the time. This method takes the string passed into it, gets the first two characters for the hour, the adjacent two characters for the minute, and then interprets and modifies the hour data to change it from a 24-hour clock to a 12-hour clock.</p><div class="informalexample"><pre class="programlisting">this.formatTime = function(time) {
  var hh = time.substr(0,2);
  var mm = time.substr(2,2);
  var period = 'AM';
  hh = parseInt(hh, 10);
  if (hh &gt;= 12) period = 'PM';
  if (hh &gt; 12) hh -= 12;
  return hh+':'+mm+period;
};</pre></div><p>The preview for this change should look like the following screenshot:</p><div class="mediaobject"><img src="graphics/5689_08_02.jpg" alt="Styling showtimes"/></div><p>To make the showtimes a little more presentable, we add the following styles to <code class="literal">styles.css</code>:</p><div class="informalexample"><pre class="programlisting">.showtimes {
  float:left;
  margin-left:10px;
}
.showtimes .showtime {
  float:left;
  padding:3px;
  margin:0 2px;
  border:1px solid #666;
  -moz-border-radius:5px;
  border-radius:5px;
  cursor:move;
}</pre></div><a id="id498" class="indexterm"/><p>We are floating the showtimes to the left-hand side so that they are arranged horizontally, and adding a border around them to discern them from the other content. Lastly, we set the cursor to move so that when you hover the mouse over them, the mouse pointer changes to the move icon for your operating system to indicate that the showtime is a movable object.</p><p>Refreshing the preview should show something like the following:</p><div class="mediaobject"><img src="graphics/5689_08_03.jpg" alt="Styling showtimes"/></div></div>
<div class="section" title="What a drag"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec67"/>What a drag</h1></div></div></div><a id="id499" class="indexterm"/><p>The first thing to do to make something draggable in HTML5 is to append the <code class="literal">draggable</code> attribute to the element. This signals to the web browser to create a ghost image of the element that will appear and follow the mouse pointer when the user triggers a mouse down event, effectively "dragging" the element, and disappearing when the mouse button is released.</p><p>Change this line in <code class="literal">displayShowtimes</code> where we are displaying the showtime:</p><div class="informalexample"><pre class="programlisting">if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie= "'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+that.formatTime(movie.showtime[i])+'&lt;/div&gt; ';</pre></div><p>It should now include the <code class="literal">draggable="true"</code> attribute:</p><div class="informalexample"><pre class="programlisting">if (movie.showtime[i]) movieHTML+='&lt;div class="showtime" draggable="true" title="'+movie.title+' @ '+movie.theater.title+' ('+movie.theater.address+')" data-movie= "'+movie.theater.id+':'+movie.id+':'+movie.showtime[i]+'"&gt;'+that.formatTime(movie.showtime[i])+'&lt;/div&gt; ';</pre></div><a id="id500" class="indexterm"/><p>Next, add the following CSS style to <code class="literal">styles.css</code>.</p><div class="informalexample"><pre class="programlisting">[draggable=true] {
  -moz-user-select:none;
  -khtml-user-select:none;
  -webkit-user-select:none;
  user-select:none;
  -khtml-user-drag:element;
  -webkit-user-drag:element;
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>The prefix <code class="literal">-khtml</code> is for old versions of Safari. </p></div></div><p>Because the default behavior on browsers when a user clicks and drags is selection of text highlighting we need to override this behavior. The styles given previously are shorthands for different browsers to prevent this behavior.  </p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>For Internet Explorer, we will need a JavaScript solution to override the default selection behavior for dragging since there is no equivalent. We will cover this when implementing the JavaScript for the drag-and-drop behavior.</p></div></div><p>Finally, we will need some JavaScript to handle the events triggered when dragging. To get started, we will need to create a new JavaScript file. We will call it <code class="literal">movienow.draganddrop.js</code> and place it in the <code class="literal">js</code> folder. We will also need to add a reference to this new file in <code class="literal">index.html</code>. Add the following above the closing <code class="literal">body</code> tag:</p><div class="informalexample"><pre class="programlisting">&lt;script src="js/movienow.draganddrop.js"&gt;&lt;/script&gt;</pre></div><p>The script tags in <code class="literal">index.html</code> should look similar to the following code snippet:</p><div class="informalexample"><pre class="programlisting">	&lt;script src="js/ios-orientationchange-fix.js"&gt;&lt;/script&gt;
	&lt;script src="js/jquery-1.8.0.min.js"&gt;&lt;/script&gt;
	&lt;script src="js/jquery.xdomainajax.js"&gt;&lt;/script&gt;
	&lt;script src="js/three.js"&gt;&lt;/script&gt;
	<span class="strong"><strong>&lt;script src="js/movienow.draganddrop.js"&gt;&lt;/script&gt;</strong></span>
	&lt;script src="js/movienow.charts.js"&gt;&lt;/script&gt;
	&lt;script src="js/movienow.geolocation.js"&gt;&lt;/script&gt;
	&lt;script src="js/movienow.js"&gt;&lt;/script&gt;
&lt;/body&gt;</pre></div><div class="section" title="Handling drag with JavaScript"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec71"/>Handling drag with JavaScript</h2></div></div></div><a id="id501" class="indexterm"/><a id="id502" class="indexterm"/><p>In <code class="literal">movienow.draganddrop.js</code>, we will start by creating a simple object:</p><div class="informalexample"><pre class="programlisting">var movienow = movienow || {};
movienow.draganddrop = (function(){
    var that = this;
})();</pre></div><p>Within that object, we will add an <code class="literal">init</code> method to execute when the showtimes are loaded onto the page. Take a look at the following code:</p><div class="informalexample"><pre class="programlisting">this.init = function() {
  var dragItems = $('[draggable=true]');
  for (var i=0; i&lt;dragItems.length; i++) {
    $(dragItems[i])[0].addEventListener('dragstart', function(event){
      return false;
    });
    $(dragItems[i])[0].addEventListener('dragend', function(event) {
      return false;
    });
  }
}</pre></div><p>The <code class="literal">init</code> method uses <code class="literal">jQuery</code> to find all draggable elements, that is, elements with the <code class="literal">draggable="true</code>" attribute and value. It then loops the collection of draggable elements and adds an event listener for the <code class="literal">dragstart</code> and <code class="literal">dragend</code> events. When a draggable element is dragged, the dragstart event is triggered. All event listeners in turn are invoked. In this case, we are simply doing nothing and returning <code class="literal">false</code>, but later on, we will do something a little bit more interesting.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>
<span class="strong"><strong>Drag events</strong></span>
</p><p>
<code class="literal">dragstart</code> –<a id="id503" class="indexterm"/> fires when a draggable element begins to be dragged<a id="id504" class="indexterm"/>
</p><p>
<code class="literal">drag</code> – <a id="id505" class="indexterm"/>fires when the mouse is moved while a draggable element is being dragged</p><p>
<code class="literal">dragend</code>
<a id="id506" class="indexterm"/> <a id="id507" class="indexterm"/>– fires when a draggable element is dropped (when the user releases the mouse button)<a id="id508" class="indexterm"/>
</p><p>
<code class="literal">dragenter</code>
<a id="id509" class="indexterm"/> – fires whenever a target element has a dragging element dragged into it<a id="id510" class="indexterm"/>
</p><p>
<code class="literal">dragover</code> <a id="id511" class="indexterm"/>– fires for a target element whenever the mouse moves while a dragging element is inside it<a id="id512" class="indexterm"/>
</p><p>
<code class="literal">dragleave</code>
<a id="id513" class="indexterm"/> – fires whenever a target element has a dragging element dragged from it<a id="id514" class="indexterm"/>
</p><p>
<code class="literal">drop</code>
<a id="id515" class="indexterm"/> – fires whenever a target element has a dragging element released while inside it</p></div></div><a id="id516" class="indexterm"/><a id="id517" class="indexterm"/><p>Finally, we need to invoke the <code class="literal">init</code> method when the movie data loads. In the <code class="literal">displayShowtimes</code> method in <code class="literal">movienow.geolocation.js</code>, we will need to end the following line as the last line of the method:</p><div class="informalexample"><pre class="programlisting">init();</pre></div><p>Before we continue, we need to add the following for the sake of Internet Explorer. Since Internet Explorer does not have a way of using CSS to override the default selection behavior on drag, we need to use a JavaScript implementation. In this case, we handle the <code class="literal">selectstart</code> event and indicate to the browser that we are dragging and dropping when it is triggered:</p><div class="informalexample"><pre class="programlisting">$(dragItems).bind('selectstart', function() {
	this.dragDrop(); return false;
});</pre></div><p>Our <a id="id518" class="indexterm"/>
<code class="literal">init</code> method should now look like the following:</p><div class="informalexample"><pre class="programlisting">this.init = function() {
  var dragItems = $('[draggable=true]');
  for (var i=0; i&lt;dragItems.length; i++) {
    $(dragItems[i])[0].addEventListener('dragstart', function(event){
      return false;
    });
    $(dragItems[i])[0].addEventListener('dragend', function(event) {
      return false;
    });
  }
  $(dragItems).bind('selectstart', function() {
    this.dragDrop(); return false;
  });
}</pre></div></div></div>
<div class="section" title="Drop it"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec68"/>Drop it</h1></div></div></div><a id="id519" class="indexterm"/><p>Now that we can drag stuff around, let us look at how we drop them and do something useful when they are dropped. First of all, we will need a place to drop elements. For showtimes, we will create an area on the right-hand side of the page for dropping elements. Once elements are dropped there, they will be displayed above the <span class="strong"><strong>Top 5 Box Office</strong></span> section.</p><p>Let us add a couple of <code class="literal">div</code> tags within the <code class="literal">aside</code> tag in <code class="literal">index.html</code>. We will call them <code class="literal">dropzone</code> and <code class="literal">dropstage</code>. Add the following lines to the beginning of the <code class="literal">aside</code> tag:</p><div class="informalexample"><pre class="programlisting">&lt;div id="dropzone"&gt;Drop Here&lt;/div&gt;
&lt;div id="dropstage"&gt;
  &lt;h2&gt;Selected Times&lt;/h2&gt;
&lt;/div&gt;</pre></div><p>The beginning of the <code class="literal">aside</code> tag should look similar to the following code:</p><div class="informalexample"><pre class="programlisting">&lt;aside&gt;
  <span class="strong"><strong>&lt;div id="dropzone"&gt;Drop Here&lt;/div&gt;</strong></span>
<span class="strong"><strong>  &lt;div id="dropstage"&gt;</strong></span>
<span class="strong"><strong>    &lt;h2&gt;Selected Times&lt;/h2&gt;</strong></span>
<span class="strong"><strong>  &lt;/div&gt;</strong></span>
  &lt;h2&gt;Top 5 Box Office&lt;/h2&gt;</pre></div><p>Now that we have a place to drop elements and a place to stage elements once they have been dropped, let us focus on <code class="literal">dropzone</code>. This is the area in which we will drop elements. Add the following style to <code class="literal">styles.css</code>:</p><div class="informalexample"><pre class="programlisting">#dropzone {
  border:1px solid #ffb73d;
  width:198px;
  height:auto;
  min-height:100%;
  text-align:center;
  z-index:2;
  position:absolute;
  margin-top:-28px;
  padding-top:200px;
  background: rgb(215, 215, 0);
  background: rgba(255, 215, 0, 0.5);
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#80FFD700, endColorstr=#80FFD700);
  -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#80FFD700, endColorstr=#80FFD700)";
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip46"/>Tip</h3><p>Notice that <code class="literal">filter:progid</code> and <code class="literal">progid</code> are Internet Explorer specific.</p></div></div><a id="id520" class="indexterm"/><p>This should add a yellow box that overlays the right-hand side. Your preview should look something like the following screenshot:</p><div class="mediaobject"><img src="graphics/5689_08_04.jpg" alt="Drop it"/></div><div class="section" title="Toggling the drop zone"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec72"/>Toggling the drop zone</h2></div></div></div><a id="id521" class="indexterm"/><a id="id522" class="indexterm"/><p>Let us now revisit <code class="literal">movienow.draganddrop.js</code>. Remember that we added event listeners for when a drag is started and when a drag is ended. Let us use this to hide and show the drop zone when dragging.  </p><p>Add the following to the <code class="literal">dragstart</code> event listener:</p><div class="informalexample"><pre class="programlisting">$('#dropzone').show();</pre></div><p>Add the following to the <code class="literal">dragend</code> event listener:</p><div class="informalexample"><pre class="programlisting">$('#dropzone').hide();</pre></div><p>The event listeners should look similar to the following code snippet:</p><div class="informalexample"><pre class="programlisting">$(dragItems[i])[0].addEventListener('dragstart', function(event){
  $('#dropzone').show();
  return false;
});
$(dragItems[i])[0].addEventListener('dragend', function(event) {
  $('#dropzone').hide();
  return false;
});</pre></div><p>Set the drop zone to be hidden by default, adding the following line to the <code class="literal">#dropzone</code> style:</p><div class="informalexample"><pre class="programlisting">display:none;</pre></div><p>At this point, when you preview, the drop zone should only appear when you are dragging a showtime.</p></div><div class="section" title="Transferring some data"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec73"/>Transferring some data</h2></div></div></div><a id="id523" class="indexterm"/><p>We are starting to understand the mechanics of dragging-and-dropping. However, in order to make our dragging functionality more interesting, we will need to attach some data to our draggable elements so that once dropped, we have something interesting to show. For the sake of simplicity, let us transfer the element itself. To do this, we set the<a id="id524" class="indexterm"/> <code class="literal">dataTransfer</code> property of the <code class="literal">event</code> object. The <code class="literal">event</code> object allows us to track events on the page and manage data about them. It is an argument for all event listeners.</p><p>Add the following line to the <code class="literal">dragstart</code> event listener:</p><div class="informalexample"><pre class="programlisting">event.dataTransfer.setData('Text', this.outerHTML);</pre></div><p>The <code class="literal">dragstart</code> event<a id="id525" class="indexterm"/> listener should look similar to the following code:</p><div class="informalexample"><pre class="programlisting">$(dragItems[i])[0].addEventListener('dragstart', function(event){
  $('#dropzone').show();
  <span class="strong"><strong>event.dataTransfer.setData('Text', this.outerHTML);</strong></span>
  return false;
});</pre></div><p>We will then need to add some event listeners to the drop zone so that when an element is dropped upon it, we can have it do something interesting. In this case, we will display it on the drop stage.</p><a id="id526" class="indexterm"/><p>Add the following to the <code class="literal">init</code> method in <code class="literal">movienow.draganddrop.js</code>:</p><div class="informalexample"><pre class="programlisting">$('#dropzone')[0].addEventListener('drop', function(event) {0event.stopPropagation();
  if (event.preventDefault) event.preventDefault();
  $('#dropstage').append(event.dataTransfer.getData('Text')).show();
  return false;
});
$('#dropzone')[0].addEventListener('dragover', function(event) {
  if (event.preventDefault) event.preventDefault();
  return false;
});
$('#dropzone')[0].addEventListener('dragenter', function(event) {
  if (event.preventDefault) event.preventDefault();
  return false;
});</pre></div><p>The <a id="id527" class="indexterm"/>
<code class="literal">drop</code> event is central. This is where we handle what happens when an element is dropped. Notice that we take the data stored on <code class="literal">dragstart</code> and append it to the <code class="literal">div</code> tag of <code class="literal">dropstage</code>. We must also stop propagation, prevent default behavior, and return <code class="literal">false</code> on the <code class="literal">drop</code>, <code class="literal">dragover</code>, and <code class="literal">dragenter</code> events to prevent the browser from browsing to the element. </p></div><div class="section" title="Displaying the results"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec74"/>Displaying the results</h2></div></div></div><a id="id528" class="indexterm"/><p>Now that we have the scaffolding for dragging worked out, we will want to display the movie data along with the showtime and style everything for better presentation. We will do this first of all by adding some more data to the <code class="literal">event</code> object.  </p><p>Add the following lines to the dragstart event listener so that we can capture the movie title and theater title as well as the time data as separate datapoints:</p><div class="informalexample"><pre class="programlisting">event.dataTransfer.setData('Title', $(this)[0].title);
event.dataTransfer.setData('Time', $(this).html());</pre></div><a id="id529" class="indexterm"/><p>The event listener should look similar to the following code snippet:</p><div class="informalexample"><pre class="programlisting">$(dragItems[i])[0].addEventListener('dragstart', function(event){
  $('#dropzone').show();
  event.dataTransfer.setData('Text', this.outerHTML);
  event.dataTransfer.setData('Title', $(this)[0].title);
  event.dataTransfer.setData('Time', $(this).html());
  return false;
});</pre></div><p>In the <code class="literal">drop</code> event listener for the drop zone, modify the following line:</p><div class="informalexample"><pre class="programlisting">$('#dropstage').append(event.dataTransfer.getData('Text')).show();</pre></div><p>We will need to build some HTML to insert into the DOM object. Take the <code class="literal">Title</code> and <code class="literal">Time</code> datapoints and display them accordingly:</p><div class="informalexample"><pre class="programlisting">var html='&lt;div class="selected-time"&gt;';
html+='&lt;div class="title"&gt;'+event.dataTransfer.getData('Title')+'&lt;/div&gt;';
html+='&lt;div class="time"&gt;'+event.dataTransfer.getData('Time')+'&lt;/div&gt;';
html+='&lt;/div&gt;';
$('#dropstage').append(html).show();</pre></div><p>The entire drop event listener should look similar to the following code snippet:</p><div class="informalexample"><pre class="programlisting">$('#dropzone')[0].addEventListener('drop', function(event) {
  if (event.stopPropagation) event.stopPropagation();
  if (event.preventDefault) event.preventDefault();
  var html='&lt;div class="selected-time"&gt;';
  html+='&lt;div class="title"&gt;'+event.dataTransfer.getData('Title')+'&lt;/div&gt;';
  html+='&lt;div class="time"&gt;'+event.dataTransfer.getData('Time')+'&lt;/div&gt;';
  html+='&lt;/div&gt;';
  $('#dropstage').append(html).show();
  return false;
});</pre></div><p>Lastly, we will need to style the drop stage so as showtimes are dropped onto it, they look presentable. Add the following to <code class="literal">styles.css</code> to display the selected time's data and the drop stage appropriately:</p><div class="informalexample"><pre class="programlisting">.selected-time {
  float:left;
  margin-bottom:10px;
}
.selected-time .title {
  font-size:.8em;
  padding:0 10px;
}
.selected-time .time {
  font-size:.9em;
  clear:both;
  float:right;
  padding-right:10px;
}
#dropstage {
  display:none;
  float:left;
  width:100%;
  padding-bottom: 5px;
  margin-bottom: 5px;
}
#dropstage h2 {
  border:0;
}</pre></div><a id="id530" class="indexterm"/><p>Notice that <code class="literal">display</code> is set to <code class="literal">none</code> on <code class="literal">#dropstage</code>. The <code class="literal">drop</code> event listener actually shows this section so that it only displays when there are dropped items. We will also need to tweak the style for <code class="literal">aside h2</code> so that the <span class="strong"><strong>Top 5 Box Office</strong></span> text does not wrap. To do this, simply add the following code:</p><div class="informalexample"><pre class="programlisting">clear:both;</pre></div><p>Now that the drop stage is styled, we should see our showtimes displayed appropriately when we drop them on the drop zone. Try it out.</p><div class="mediaobject"><img src="graphics/5689_08_05.jpg" alt="Displaying the results"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec69"/>Summary</h1></div></div></div><p>In this chapter, we walked through how to set items as draggable by marking them as such. We walked through the mechanics of dragging-and-dropping and the events that go with this orchestration. Furthermore, we walked through how to put all of this together to achieve some interesting functionality for your HTML5 enterprise application.  </p><p>In the next chapter, we will talk about HTML5 forms. We will use them to submit tweets about specific showtimes to Twitter. </p></div></body></html>