<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Utilizing Vector Masks"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Utilizing Vector Masks</h1></div></div></div><p>In this chapter, we will talk about utilizing vector masks in CreateJS and how to develop animation or drawings using vector masks. First off, we should know what a vector mask is and what it does. With vector masks, we can control which parts of the parent layer are hidden or revealed. We can even add a special effect to the vector mask to make that part of the parent layer different from the rest.</p><p>In this chapter we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learning about vector masks</li><li class="listitem" style="list-style-type: disc">Adding a vector mask to an existing <code class="literal">DisplayObject</code> object</li><li class="listitem" style="list-style-type: disc">Applying vector masks to pictures</li><li class="listitem" style="list-style-type: disc">Animating the mask layer</li></ul></div><div class="section" title="Learning about vector masks"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec44"/>Learning about vector masks</h1></div></div></div><p>Vector masking<a id="id150" class="indexterm"/> is a useful feature in EaselJS that enables developers<a id="id151" class="indexterm"/> to create awesome animations or drawings easily. There is a <code class="literal">mask</code> property for every <code class="literal">DisplayObject</code> object<a id="id152" class="indexterm"/>, with which you can apply a mask layer, or in other words; create a layer over an existing shape or picture. After applying the mask layer and updating the <code class="literal">stage</code> event, you will see that a new layer masks the existing layer. In other words, you can control what part of the parent layer is hidden or revealed with vector masks.</p><div class="mediaobject"><img src="graphics/0260OS_08_01.jpg" alt="Learning about vector masks"/></div><p>Furthermore, <a id="id153" class="indexterm"/>mask layers are also shapes, so you can change the mask layer properties continuously to create animations.</p><p>Here is an <a id="id154" class="indexterm"/>example of using a vector mask in EaselJS:</p><div class="informalexample"><pre class="programlisting">/* Declare stage in usual way */
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

/* Create the mask */
var mask = new createjs.Shape();
mask.graphics.drawCircle(0, 0, 30);
mask.x = 100;
mask.y = 100;

var bg; /* Create a red background */
var bg = new createjs.Shape();
bg.graphics.clear().beginFill("red").rect(0, 0, 400, 200);

/* Add mask to background */
bg.mask = mask;

/* Add to stage */
stage.addChild(bg);

/* update stage in usual way */
stage.update();</pre></div><p>As with other examples in this book, we first get the <code class="literal">canvas</code> element from the page and then create the <code class="literal">Stage</code> object. Then,<a id="id155" class="indexterm"/> we create a simple circle using the <code class="literal">Shape</code> class and the <code class="literal">drawCircle</code> function. For the default position, we set both <code class="literal">x</code> and <code class="literal">y</code> to <code class="literal">100</code>. This circle is our vector mask layer.</p><p>Then, we create a <code class="literal">bg</code> variable that contains a rectangle filled with the color red. After that, we assign the first shape—that is, the circle—to the <code class="literal">mask</code> property of the <code class="literal">bg</code> variable. Finally, we add the <code class="literal">bg</code> variable to stage.</p><p>Here is the output of the preceding source code:</p><div class="mediaobject"><img src="graphics/0260OS_08_02.jpg" alt="Learning about vector masks"/></div><p>For you to understand the example better, look at the following screenshot. It is what the output will be after removing the mask layer.</p><div class="mediaobject"><img src="graphics/0260OS_08_03.jpg" alt="Learning about vector masks"/></div><p>As you can see in<a id="id156" class="indexterm"/> the first example, our mask layer is seen only in the circular shape, but in the next example, the whole rectangle is seen because there is no mask layer anymore.</p><p>The following screenshot shows the mask layer independently:</p><div class="mediaobject"><img src="graphics/0260OS_08_04.jpg" alt="Learning about vector masks"/></div><p>After assigning the mask layer to the parent layer (the red rectangle), the only visible part of the rectangle will be the visible part of the mask layer.</p><p>In the next section, we will look at a drag-and-drop example with mask layers.</p></div></div>
<div class="section" title="Using a vector mask with Bitmap images"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec45"/>Using a vector mask with Bitmap images</h1></div></div></div><p>In this<a id="id157" class="indexterm"/> section, you will learn to use the vector mask, filters, and a <code class="literal">Bitmap</code> class with an example. The <code class="literal">Bitmap</code> class is a subset of <code class="literal">DisplayObject</code>; thus, <a id="id158" class="indexterm"/>it has almost all the properties of the <code class="literal">Shape</code> class, such as <code class="literal">filters</code>, <code class="literal">mask</code>, and so on.</p><p>Here is an example of using a vector mask with a <code class="literal">Bitmap</code> class:</p><div class="informalexample"><pre class="programlisting">//query the canvas element
var canvas = document.getElementById("canvas");

//create the Stage class
var stage = new createjs.Stage(canvas);

//create the mask layer
var mask = new createjs.Shape();
mask.x = img.width / 2;
mask.y = img.height / 2;
mask.graphics.drawCircle(0, 0, 100);

var bg = new createjs.Bitmap(img);
//add blur filter
bg.filters = [new createjs.BlurFilter(50,50,10)];
bg.cache(0,0,img.width,img.height);
bg.mask = mask;
stage.addChild(bg);

stage.update();</pre></div><p>In the first line, we created the <code class="literal">canvas</code> variable that refers to our <code class="literal">canvas</code> element on the page. Then, we initiated the <code class="literal">stage</code> variable with the <code class="literal">Stage</code> class.</p><p>In the next line, we initiated a <code class="literal">mask</code> variable using the <code class="literal">Shape</code> class. This shape is our mask layer, and it's a circle. For the mask layer coordinates, we used <code class="literal">img.width / 2</code> and <code class="literal">img.height / 2</code> to place the mask layer in the center of the picture. Then, we created the circle using the <code class="literal">drawCircle</code> method.</p><p>Then we created the <code class="literal">bg</code> variable, which refers to our image. We initiated this variable using the <code class="literal">Bitmap</code> class; the first parameter of the <code class="literal">Bitmap</code> class is the <code class="literal">Image</code> class. We already loaded the image using the <code class="literal">Image</code> class.</p><p>Here is an<a id="id159" class="indexterm"/> example of loading an image and using an <code class="literal">onload</code> event:</p><div class="informalexample"><pre class="programlisting">var img = new Image();
img.src = "easlejs.png";

img.onload = function(evt) {
    //logic
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>You can use the same approach to load images and pass them to the <code class="literal">Bitmap</code> class in EaselJS.</p></div></div><p>Then, we added a blur filter to the picture filters and cached the shape using the <code class="literal">cache</code> method.We <a id="id160" class="indexterm"/>used the original image dimensions for the <code class="literal">cache</code> method. Then we assigned the mask layer to the <code class="literal">bg</code> variable using the <code class="literal">mask</code> property.</p><p>Finally, we added the <code class="literal">bg</code> variable to the <code class="literal">stage</code> event and updated this event to apply the changes.</p><p>In order to understand the differences better, look at the following output screenshot of the <code class="literal">bg</code> variable without the <code class="literal">mask</code> property. This is the <code class="literal">Bitmap</code> class without the mask layer.</p><div class="mediaobject"><img src="graphics/0260OS_08_05.jpg" alt="Using a vector mask with Bitmap images"/></div><p>The following image shows the vector mask separately:</p><div class="mediaobject"><img src="graphics/0260OS_08_06.jpg" alt="Using a vector mask with Bitmap images"/></div><p>The following screenshot illustrates the final result of our example with the mask layer:</p><div class="mediaobject"><img src="graphics/0260OS_08_07.jpg" alt="Using a vector mask with Bitmap images"/></div><p>As you<a id="id161" class="indexterm"/> can see, the whole image is visible in the<a id="id162" class="indexterm"/> first screenshot. However, the only visible part in the third image is our mask layer, that is the circle. That's the way vector masks work with pictures and shapes. You can create any shape and mask an existing layer, such as a picture with this shape.</p><p>In the next example, we will create a drag-and-drop interaction using vector masks.</p></div>
<div class="section" title="Playing with vector masks"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec46"/>Playing with vector masks</h1></div></div></div><p>Now, we will <a id="id163" class="indexterm"/>complete our previous example to create a simple drag-and-drop example using vector masks. The idea is to change the x and y coordinates of the mask layer on the <code class="literal">mousemove</code> event of the parent layer so that we can only see the masked layer over the existing shape. It will seem that only a circular shape is being dragged, but what's actually happening is that our mask layer is changing continuously. The source code of our example is as follows:</p><div class="informalexample"><pre class="programlisting">var stage = new createjs.Stage("canvas");
var mask = new createjs.Shape();

mask.graphics.drawCircle(0, 0, 30);
mask.x = 100;
mask.y = 100;

var bg = new createjs.Shape();
bg.graphics.clear().beginFill("red").rect(0, 0, 400, 400);

bg.mask = mask;

function handlePress(event) {
    event.addEventListener("mousemove", handleMove);
}

function handleMove(event) {
    mask.x = stage.mouseX;
    mask.y = stage.mouseY;
    stage.update();
}

bg.addEventListener("mousedown", handlePress);

stage.addChild(bg);
stage.update();</pre></div><p>As in the previous example, we created a mask layer in the shape of a circle in the first line. We specified the default coordinates for the mask layer with <code class="literal">x=100</code> and <code class="literal">y=100</code>. Then, we created a <code class="literal">bg</code> variable that contains the background or parent layer.</p><p>Because we need the coordinates of the mask layer to change continuously as we move the mouse cursor,<a id="id164" class="indexterm"/> we bound a callback function to both <code class="literal">mousedown</code> and <code class="literal">mousemove</code> events. Then, inside the <code class="literal">mousemove</code> callback function, we changed the co-ordination of the mask layer and updated the stage.</p><p>The result will look like a drag-and-drop ball over the stage, but actually, it's our mask layer that keeps changing with every mouse move.</p><div class="mediaobject"><img src="graphics/0260OS_08_08.jpg" alt="Playing with vector masks"/></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec47"/>Summary</h1></div></div></div><p>The vector mask feature is one of the most useful features for drawing and developing animations, not only in CreateJS but in all other tools. In this chapter, we learned how to create vector mask layers in EaselJS and also how to enhance them to create animations. This feature also comes handy when you need to apply a different filter to a specific part of an existing shape or picture.</p><p>In the next chapter, we will wrap up everything to create a complete UI from scratch using all the CreateJS features that we have already talked about.</p></div></body></html>