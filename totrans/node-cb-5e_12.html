<html><head></head><body>
  <div id="_idContainer103">
   <h1 class="chapter-number" id="_idParaDest-376">
    <a id="_idTextAnchor388">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     12
    </span>
   </h1>
   <h1 id="_idParaDest-377">
    <a id="_idTextAnchor389">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Debugging Node.js
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     The asynchronous nature of JavaScript and Node.js can make the debugging process non-trivial.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Unlike traditional synchronous code execution, the asynchronous behavior of Node.js introduces complexities that can challenge even experienced developers.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     However, over the past decade, Node.js has matured significantly as a technology.
    </span>
    <span class="koboSpan" id="kobo.3.4">
     Along with this maturation, the debugging capabilities and facilities have improved in tandem, providing developers with more robust tools and methodologies to troubleshoot
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      their applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we will explore the various steps we can take to make our applications easier to debug.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     By implementing best practices and adopting a structured approach to coding, we can mitigate some of the inherent difficulties associated with asynchronous programming.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     We will also delve into the modern tools available for debugging Node.js applications, such as the built-in debugger, various third-party debugging tools, and advanced
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      logging techniques.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     Additionally, we will cover how to leverage Node.js’s diagnostic reports feature, a powerful utility introduced in the latest versions of Node.js.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     This feature provides in-depth insights into the state of your application at the time of failure, making it easier to pinpoint the root causes of issues.
    </span>
    <span class="koboSpan" id="kobo.7.3">
     By the end of this chapter, you will have a comprehensive understanding of the strategies and tools necessary to effectively debug Node.js applications, ensuring smoother development and more stable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      production environments.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.9.1">
     This chapter will cover
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Diagnosing issues with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       Chrome DevTools
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Logging
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       with Node.js
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Enabling
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       debug logs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Enabling Node.js core
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       debug logs
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.19.1">
      Increasing stack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       trace size
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.21.1">
      Creating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.22.1">
       diagnostic reports
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-378">
    <a id="_idTextAnchor390">
    </a>
    <span class="koboSpan" id="kobo.23.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.24.1">
     For this chapter, you will require Node.js 22 to be installed and available in your terminal path.
    </span>
    <span class="koboSpan" id="kobo.24.2">
     You can test which version of Node.js is installed and available in your path with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.26.1">
$ node --version
v22.9.0</span></pre>
   <p>
    <span class="koboSpan" id="kobo.27.1">
     You’ll also need access to an editor and browser.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     For the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.28.1">
      Diagnosing issues with Chrome DevTools
     </span>
    </em>
    <span class="koboSpan" id="kobo.29.1">
     recipe, you will need to have Google Chrome installed, which you can download
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.30.1">
      from
     </span>
    </span>
    <a href="https://www.google.com/chrome/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.31.1">
       https://www.google.com/chrome/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.32.1">
      .
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-379">
    <a id="_idTextAnchor391">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     Diagnosing issues with Chrome DevTools
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     Node.js offers a powerful debugging utility through the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.35.1">
      --inspect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.36.1">
     process flag, enabling us to debug and profile our Node.js processes using the Chrome DevTools interface.
    </span>
    <span class="koboSpan" id="kobo.36.2">
     This integration
    </span>
    <a id="_idIndexMarker929">
    </a>
    <span class="koboSpan" id="kobo.37.1">
     is made possible by the Chrome DevTools Protocol, which facilitates communication between Node.js and Chrome DevTools.
    </span>
    <span class="koboSpan" id="kobo.37.2">
     The
    </span>
    <a id="_idIndexMarker930">
    </a>
    <span class="koboSpan" id="kobo.38.1">
     existence of this protocol allows for the creation of tools that seamlessly integrate with Chrome DevTools, providing a unified debugging experience across
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      different environments.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.40.1">
     In this recipe, we will learn how to utilize Chrome DevTools to diagnose and resolve issues within a web application.
    </span>
    <span class="koboSpan" id="kobo.40.2">
     We’ll cover how to set up the debugging environment, connect to a Node.js process, and navigate the various features of Chrome DevTools.
    </span>
    <span class="koboSpan" id="kobo.40.3">
     This includes inspecting variables, setting breakpoints, and stepping through
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.41.1">
      our code.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.42.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.43.1">
      node --debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.45.1">
      node --debug-brk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.46.1">
     are legacy Node.js flags that have been deprecated since Node.js v6.3.0.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.47.1">
      node --inspect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.48.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.49.1">
      node --inspect-brk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.50.1">
     are the modern equivalents that should be used in place of these
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.51.1">
      legacy flags.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-380">
    <a id="_idTextAnchor392">
    </a>
    <span class="koboSpan" id="kobo.52.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.53.1">
     In this recipe, we will debug a minimal web server built with Express.
    </span>
    <span class="koboSpan" id="kobo.53.2">
     Let’s prepare this before we start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.54.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker931">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.55.1">
      recipe:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.56.1">
      First, let’s set up a directory and the files required for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.57.1">
       this recipe:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.58.1">$ mkdir debugging-with-chrome</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.59.1">$ cd debugging-with-chrome</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.60.1">$ npm init --yes</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.61.1">$ npm install express</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.62.1">$ touch server.js random.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.63.1">
      Add the following
     </span>
     <a id="_idIndexMarker932">
     </a>
     <span class="koboSpan" id="kobo.64.1">
      source code to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.65.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.66.1">
      to create our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.67.1">
       web server:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.68.1">
const express = require('express');
const app = express();
const random = require('./random');
app.get('/:number', (req, res) =&gt; {
  const number = req.params.number;
  res.send(random(number).toString());
});
app.listen(3000, () =&gt; {
  console.log('Server listening on port 3000');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.69.1">
      Add the following source code to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.70.1">
       random.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.71.1">
      .
     </span>
     <span class="koboSpan" id="kobo.71.2">
      This will be a local module we interact with via
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.72.1">
       our server:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.73.1">
module.exports = (n) =&gt; {
  const randomNumber = Math.floor(Math.random() * n) + '1';
  return randomNumber;
};</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.74.1">
     Now that we have an
    </span>
    <a id="_idIndexMarker933">
    </a>
    <span class="koboSpan" id="kobo.75.1">
     application ready to debug, we can move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.76.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-381">
    <a id="_idTextAnchor393">
    </a>
    <span class="koboSpan" id="kobo.77.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.78.1">
     In this recipe, we’re going to
    </span>
    <a id="_idIndexMarker934">
    </a>
    <span class="koboSpan" id="kobo.79.1">
     use Chrome DevTools (
    </span>
    <a href="https://developer.chrome.com/docs/devtools">
     <span class="koboSpan" id="kobo.80.1">
      https://developer.chrome.com/docs/devtools
     </span>
    </a>
    <span class="koboSpan" id="kobo.81.1">
     ) to debug a route in our application.
    </span>
    <span class="koboSpan" id="kobo.81.2">
     We expect the application to respond with a random number between
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.82.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.83.1">
     and the number we specify in the route.
    </span>
    <span class="koboSpan" id="kobo.83.2">
     For example,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.84.1">
      http://localhost:3000/10
     </span>
    </strong>
    <span class="koboSpan" id="kobo.85.1">
     should return a random number between
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.86.1">
      1
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.88.1">
       10
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.89.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.90.1">
     Start the program with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.91.1">
      $ node server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.92.1">
     and navigate to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.93.1">
      http://localhost:3000/10
     </span>
    </strong>
    <span class="koboSpan" id="kobo.94.1">
     .
    </span>
    <span class="koboSpan" id="kobo.94.2">
     Refresh the endpoint a few times and you should notice that the program will often respond with a number greater than
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.95.1">
      10
     </span>
    </strong>
    <span class="koboSpan" id="kobo.96.1">
     .
    </span>
    <span class="koboSpan" id="kobo.96.2">
     This indicates that we have a bug in our program; so, let’s debug to try and understand why this error
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.97.1">
      is occurring:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.98.1">
      First, we need to start our program with the debugger enabled.
     </span>
     <span class="koboSpan" id="kobo.98.2">
      To do this, we need to pass the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.99.1">
       --inspect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.100.1">
      argument to our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.101.1">
       Node.js process:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.102.1">$ node --inspect server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.103.1">Debugger listening on ws://127.0.0.1:9229/35fa7c65-62a5-48b4-8428-9a414ec28afe</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.104.1">For help, see: https://nodejs.org/en/docs/inspector</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.105.1">Server listening on port 3000</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.106.1">
      Instead of going directly to the link specified in the output, navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.107.1">
       chrome://inspect/#devices
      </span>
     </strong>
     <span class="koboSpan" id="kobo.108.1">
      in Google Chrome.
     </span>
     <span class="koboSpan" id="kobo.108.2">
      Expect to see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.109.1">
       following output:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer091">
     <span class="koboSpan" id="kobo.110.1">
      <img alt="Figure 12.1 – Screenshot of the Google Chrome inspector Devices interface" src="image/Figure_12.1_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.111.1">
     Figure 12.1 – Screenshot of the Google Chrome inspector Devices interface
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.112.1">
      Observe that
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.113.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.114.1">
      is showing
     </span>
     <a id="_idIndexMarker935">
     </a>
     <span class="koboSpan" id="kobo.115.1">
      up as
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.116.1">
       Remote Target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.117.1">
      .
     </span>
     <span class="koboSpan" id="kobo.117.2">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.118.1">
       inspect
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      link and the
     </span>
     <a id="_idIndexMarker936">
     </a>
     <span class="koboSpan" id="kobo.120.1">
      Chrome DevTools window should open, as shown in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.121.1">
       following figure:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer092">
     <span class="koboSpan" id="kobo.122.1">
      <img alt="Figure 12.2 – Screenshot of the Chrome DevTools interface" src="image/Figure_12.2_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.123.1">
     Figure 12.2 – Screenshot of the Chrome DevTools interface
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.124.1">
      Click on
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.125.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.126.1">
      in the
     </span>
     <a id="_idIndexMarker937">
     </a>
     <span class="koboSpan" id="kobo.127.1">
      bottom-right corner of the
     </span>
     <a id="_idIndexMarker938">
     </a>
     <span class="koboSpan" id="kobo.128.1">
      window.
     </span>
     <span class="koboSpan" id="kobo.128.2">
      This should ensure our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.129.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.130.1">
      file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.131.1">
       is open:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer093">
     <span class="koboSpan" id="kobo.132.1">
      <img alt="Figure 12.3 – Screenshot of the Chrome DevTools interface depicting the server.js file" src="image/Figure_12.3_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.133.1">
     Figure 12.3 – Screenshot of the Chrome DevTools interface depicting the server.js file
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.134.1">
      Now, we can add
     </span>
     <a id="_idIndexMarker939">
     </a>
     <span class="koboSpan" id="kobo.135.1">
      a breakpoint.
     </span>
     <span class="koboSpan" id="kobo.135.2">
      Click the number
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.136.1">
       7
      </span>
     </strong>
     <span class="koboSpan" id="kobo.137.1">
      in the line-of-code column to the left of our code.
     </span>
     <span class="koboSpan" id="kobo.137.2">
      A small red circle should appear next to the
     </span>
     <a id="_idIndexMarker940">
     </a>
     <span class="koboSpan" id="kobo.138.1">
      number.
     </span>
     <span class="koboSpan" id="kobo.138.2">
      If you click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.139.1">
       Show Debugger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.140.1">
      in the top-right corner, you should see the breakpoint listed in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.141.1">
       Breakpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.142.1">
      pane.
     </span>
     <span class="koboSpan" id="kobo.142.2">
      The Chrome DevTools interface should look like
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.143.1">
       the following:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer094">
     <span class="koboSpan" id="kobo.144.1">
      <img alt="Figure 12.4 – Screenshot of Chrome DevTools showing a breakpoint registered in the server.js file" src="image/Figure_12.4_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.145.1">
     Figure 12.4 – Screenshot of Chrome DevTools showing a breakpoint registered in the server.js file
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.146.1">
      Now, let’s open
     </span>
     <a id="_idIndexMarker941">
     </a>
     <span class="koboSpan" id="kobo.147.1">
      a new regular browser window and navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.148.1">
       http://localhost:3000/10
      </span>
     </strong>
     <span class="koboSpan" id="kobo.149.1">
      .
     </span>
     <span class="koboSpan" id="kobo.149.2">
      The request will hang because it has hit the breakpoint we registered on
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.150.1">
        line 7
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.151.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.152.1">
      Go back to Chrome
     </span>
     <a id="_idIndexMarker942">
     </a>
     <span class="koboSpan" id="kobo.153.1">
      DevTools.
     </span>
     <span class="koboSpan" id="kobo.153.2">
      You should notice that there is a tooltip stating
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.154.1">
       Paused on breakpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.155.1">
      in the top-right corner of the interface.
     </span>
     <span class="koboSpan" id="kobo.155.2">
      Also, to the right of the interface, you should see a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.156.1">
       Call Stack
      </span>
     </strong>
     <span class="koboSpan" id="kobo.157.1">
      panel, which details the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.158.1">
       call frames:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer095">
     <span class="koboSpan" id="kobo.159.1">
      <img alt="Figure 12.5 – Screenshot of the Chrome DevTools interface showing as Paused on breakpoint" src="image/Figure_12.5_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.160.1">
     Figure 12.5 – Screenshot of the Chrome DevTools interface showing as Paused on breakpoint
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.161.1">
      The debugger is waiting for us to act.
     </span>
     <span class="koboSpan" id="kobo.161.2">
      We can choose to step in or out of the next instruction.
     </span>
     <span class="koboSpan" id="kobo.161.3">
      Let’s step into
     </span>
     <a id="_idIndexMarker943">
     </a>
     <span class="koboSpan" id="kobo.162.1">
      the function.
     </span>
     <span class="koboSpan" id="kobo.162.2">
      To do this, click the icon of an arrow pointing down to
     </span>
     <a id="_idIndexMarker944">
     </a>
     <span class="koboSpan" id="kobo.163.1">
      a circle (these icons are right above the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.164.1">
       Paused on breakpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.165.1">
      message).
     </span>
     <span class="koboSpan" id="kobo.165.2">
      When you hover over each icon, a tooltip will appear describing the icon’s behavior.
     </span>
     <span class="koboSpan" id="kobo.165.3">
      Once you have stepped in, you will see that we have moved into our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.166.1">
        random.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.167.1">
       file:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer096">
     <span class="koboSpan" id="kobo.168.1">
      <img alt="Figure 12.6 – Screenshot of the Chrome DevTools interface showing the random.js file" src="image/Figure_12.6_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.169.1">
     Figure 12.6 – Screenshot of the Chrome DevTools interface showing the random.js file
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.170.1">
      While we’re in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.171.1">
       random.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.172.1">
      , we can hover over the values to check whether they are what we
     </span>
     <a id="_idIndexMarker945">
     </a>
     <span class="koboSpan" id="kobo.173.1">
      expect them to be.
     </span>
     <span class="koboSpan" id="kobo.173.2">
      We can see that
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.174.1">
       n = 10
      </span>
     </strong>
     <span class="koboSpan" id="kobo.175.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.176.1">
       as expected.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.177.1">
      Step over the
     </span>
     <a id="_idIndexMarker946">
     </a>
     <span class="koboSpan" id="kobo.178.1">
      function (by clicking the semi-circular arrow with a dot underneath) and then inspect the value of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.179.1">
       randomNumber
      </span>
     </strong>
     <span class="koboSpan" id="kobo.180.1">
      .
     </span>
     <span class="koboSpan" id="kobo.180.2">
      In the screenshot, the random number generated is
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.181.1">
       11
      </span>
     </strong>
     <span class="koboSpan" id="kobo.182.1">
      , which is greater than
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.183.1">
       10
      </span>
     </strong>
     <span class="koboSpan" id="kobo.184.1">
      .
     </span>
     <span class="koboSpan" id="kobo.184.2">
      This helps us determine that the error is in our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.185.1">
       randomNumber
      </span>
     </strong>
     <span class="koboSpan" id="kobo.186.1">
      logic of the previous line.
     </span>
     <span class="koboSpan" id="kobo.186.2">
      Now that we have identified the line the error is on, it is easier to locate the error.
     </span>
     <span class="koboSpan" id="kobo.186.3">
      Observe that we are adding the string
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.187.1">
       '1'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.188.1">
      rather than the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.189.1">
       number
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.190.1">
        1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.191.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer097">
     <span class="koboSpan" id="kobo.192.1">
      <img alt="Figure 12.7 – Screenshot of the Chrome DevTools interface showing variable values on hover" src="image/Figure_12.7_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.193.1">
     Figure 12.7 – Screenshot of the Chrome DevTools interface showing variable values on hover
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.194.1">
     We have learned how to
    </span>
    <a id="_idIndexMarker947">
    </a>
    <span class="koboSpan" id="kobo.195.1">
     pause and step through code using
    </span>
    <a id="_idIndexMarker948">
    </a>
    <span class="koboSpan" id="kobo.196.1">
     Chrome DevTools.
    </span>
    <span class="koboSpan" id="kobo.196.2">
     We have also learned that we can inspect
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.197.1">
      variable values.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-382">
    <a id="_idTextAnchor394">
    </a>
    <span class="koboSpan" id="kobo.198.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.199.1">
     The ability to debug Node.js applications is provided by the V8 JavaScript engine.
    </span>
    <span class="koboSpan" id="kobo.199.2">
     When we pass the node process
    </span>
    <a id="_idIndexMarker949">
    </a>
    <span class="koboSpan" id="kobo.200.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.201.1">
      --inspect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     argument, the Node.js process starts to listen for a debugging
    </span>
    <a id="_idIndexMarker950">
    </a>
    <span class="koboSpan" id="kobo.203.1">
     client.
    </span>
    <span class="koboSpan" id="kobo.203.2">
     Specifically, it is the V8 inspector that opens a port that accepts WebSocket connections.
    </span>
    <span class="koboSpan" id="kobo.203.3">
     The WebSocket connection allows the client and the V8 inspector
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.204.1">
      to interact.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.205.1">
     At the top of the Chrome DevTools window, you will see a URI that starts with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.206.1">
      devtools://
     </span>
    </strong>
    <span class="koboSpan" id="kobo.207.1">
     .
    </span>
    <span class="koboSpan" id="kobo.207.2">
     This is a protocol that is recognized by the Google Chrome browser and instructs Google Chrome to open the Chrome DevTools
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.208.1">
      user interface.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.209.1">
     In the recipe, we set a breakpoint in the Chrome DevTools window.
    </span>
    <span class="koboSpan" id="kobo.209.2">
     When the line of code the breakpoint is registered on is encountered, the event loop (JavaScript thread) will be paused.
    </span>
    <span class="koboSpan" id="kobo.209.3">
     The V8 inspector will then send a message to the client over the WebSocket connection.
    </span>
    <span class="koboSpan" id="kobo.209.4">
     The message from the V8 inspector details the position and state of the program.
    </span>
    <span class="koboSpan" id="kobo.209.5">
     The client can update its state based on the information
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.210.1">
      it receives.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.211.1">
     Similarly, if the user chooses to step into a function, a command is sent to the V8 inspector to instruct it to temporarily resume the execution of the script, pausing it again afterward.
    </span>
    <span class="koboSpan" id="kobo.211.2">
     As before, the V8 inspector sends a message back to the client detailing the new position
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.212.1">
      and state.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.213.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.214.1">
     Node.js also provides a flag that we can use to pause an application on start.
    </span>
    <span class="koboSpan" id="kobo.214.2">
     This feature enables us to set up breakpoints before anything executes.
    </span>
    <span class="koboSpan" id="kobo.214.3">
     It can also help when debugging an error that occurs during the setup phase of your application.
    </span>
    <span class="koboSpan" id="kobo.214.4">
     This feature can be enabled with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.215.1">
      --inspect-brk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     flag.
    </span>
    <span class="koboSpan" id="kobo.216.2">
     The following is how we’d start
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.217.1">
      server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.219.1">
      --inspect-brk
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     flag:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.221.1">
      $ node --
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.222.1">
       inspect-brk server.js
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.223.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-383">
    <a id="_idTextAnchor395">
    </a>
    <span class="koboSpan" id="kobo.224.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.225.1">
     Node.js provides a command-line inspector, which can be valuable when we do not have access to a graphical
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.226.1">
      user interface.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.227.1">
     Debugging with the command-line inspector
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.228.1">
     We can run the
    </span>
    <a id="_idIndexMarker951">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     application from the recipe using the command-line-based debugger with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.230.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.231.1">
$ node inspect server.js</span></pre>
   <p>
    <span class="koboSpan" id="kobo.232.1">
     This command will enter us into debug mode and output the first three lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.233.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.234.1">
       server.js
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.235.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer098">
     <span class="koboSpan" id="kobo.236.1">
      <img alt="Figure 12.8 – The terminal window depicting the Node.js inspector utility" src="image/Figure_12.8_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.237.1">
     Figure 12.8 – The terminal window depicting the Node.js inspector utility
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.238.1">
     When using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.239.1">
      node inspect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.240.1">
     , the program pauses at the first line to allow you to set breakpoints and configure the debugger before any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.241.1">
      code executes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.242.1">
     Debug mode provides a series of commands and functions that we can use to step through and debug our program.
    </span>
    <span class="koboSpan" id="kobo.242.2">
     You can output the complete list of these commands by typing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.243.1">
      help
     </span>
    </strong>
    <span class="koboSpan" id="kobo.244.1">
     and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.245.1">
      hitting
     </span>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.246.1">
       Enter
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.247.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.248.1">
     One of the functions is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.249.1">
      list()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.250.1">
     function, which will list a specified number of the following lines.
    </span>
    <span class="koboSpan" id="kobo.250.2">
     For example, we can type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.251.1">
      list(11)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.252.1">
     to output all twelve lines of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.253.1">
      our program:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.254.1">
debug&gt; list(11)
&gt; 1 const express = require('express');
  2 const app = express();
  3 const random = require('./random');
  4
  5 app.get('/:number', (req, res) =&gt; {
  6   const number = req.params.number;
  7   res.send(random(number).toString());
  8 });
  9
10 app.listen(3000, () =&gt; {
11   console.log('Server listening on port 3000');
12 });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.255.1">
     We can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.256.1">
      setBreakpoint()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.257.1">
     function to set a breakpoint.
    </span>
    <span class="koboSpan" id="kobo.257.2">
     We must supply this function with the line number on which we wish to set the breakpoint.
    </span>
    <span class="koboSpan" id="kobo.257.3">
     There’s also a shorthand for this
    </span>
    <a id="_idIndexMarker952">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.258.1">
      function:
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.259.1">
       sb()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.260.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.261.1">
     Let’s set a breakpoint on
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.262.1">
      line 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.263.1">
     by typing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.264.1">
      setBreakpoint(7)
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.265.1">
      or
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.266.1">
       sb(7)
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.267.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.268.1">
debug&gt; setBreakpoint(7)
  2 const app = express();
  3 const random = require('./random');
  4
  5 app.get('/:number', (req, res) =&gt; {
  6   const number = req.params.number;
&gt; 7   res.send(random(number).toString());
  8 });
  9
10 app.listen(3000, () =&gt; {
11   console.log('Server listening on port 3000');
12 });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.269.1">
     The caret (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.270.1">
      &gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.271.1">
     ) indicates that a breakpoint has been set on
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.272.1">
       line 7
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.274.1">
     The program is
    </span>
    <a id="_idIndexMarker953">
    </a>
    <span class="koboSpan" id="kobo.275.1">
     still paused.
    </span>
    <span class="koboSpan" id="kobo.275.2">
     We can instruct the process to begin running by typing the continue command,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      cont
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     .
    </span>
    <span class="koboSpan" id="kobo.277.2">
     This also has a shorthand
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.278.1">
      command,
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.279.1">
       c
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.280.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.281.1">
debug&gt; cont
&lt; Server listening on port 3000
&lt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.282.1">
     After entering the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.283.1">
      cont
     </span>
    </strong>
    <span class="koboSpan" id="kobo.284.1">
     command, our program will start to run.
    </span>
    <span class="koboSpan" id="kobo.284.2">
     Our breakpoint is within our request handler function.
    </span>
    <span class="koboSpan" id="kobo.284.3">
     Let’s send a request using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.285.1">
      cURL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.286.1">
     in a new
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.287.1">
      terminal window:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.288.1">
$ curl http://localhost:3000/10</span></pre>
   <p>
    <span class="koboSpan" id="kobo.289.1">
     The command will hang, as it has hit our breakpoint on
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.290.1">
      line 7
     </span>
    </em>
    <span class="koboSpan" id="kobo.291.1">
     of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.292.1">
      server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.293.1">
     .
    </span>
    <span class="koboSpan" id="kobo.293.2">
     If we go back to the debug session, we will see the debugger has detected that a breakpoint has
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.294.1">
      been reached:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.295.1">
break in server.js:7
  5 app.get('/:number', (req, res) =&gt; {
  6   const number = req.params.number;
&gt; 7   res.send(random(number).toString());
  8 });
  9</span></pre>
   <p>
    <span class="koboSpan" id="kobo.296.1">
     Now, to step into the function, we type the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.297.1">
       step
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.298.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.299.1">
debug&gt; step
break in random.js:2
  1 module.exports = (n) =&gt; {
&gt; 2   const randomNumber = Math.floor(Math.random() * n) + '1';
  3   return randomNumber;
  4 };</span></pre>
   <p>
    <span class="koboSpan" id="kobo.300.1">
     This goes into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.301.1">
      random.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.302.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.302.2">
     Note that the command-line debug utility provides an interface similar to Chrome DevTools, just without a graphical
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.303.1">
      user interface.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.304.1">
     We can print out references
    </span>
    <a id="_idIndexMarker954">
    </a>
    <span class="koboSpan" id="kobo.305.1">
     in the current scope using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.306.1">
      exec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.307.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.307.2">
     Type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.308.1">
      exec n
     </span>
    </strong>
    <span class="koboSpan" id="kobo.309.1">
     to output the value
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.310.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.311.1">
       n
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.312.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.313.1">
debug&gt; exec n
'10'</span></pre>
   <p>
    <span class="koboSpan" id="kobo.314.1">
     Now, we can progress to the next line using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.315.1">
       next
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.316.1">
      command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.317.1">
debug&gt; next
break in random.js:3
  1 module.exports = (n) =&gt; {
  2   const randomNumber = Math.floor(Math.random() * n) + '1';
&gt; 3   return randomNumber;
  4 };
  5</span></pre>
   <p>
    <span class="koboSpan" id="kobo.318.1">
     We can output the value of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.319.1">
      randomNumber
     </span>
    </strong>
    <span class="koboSpan" id="kobo.320.1">
     , which will help us identify where the faulty
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.321.1">
      logic is:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.322.1">
debug&gt; exec randomNumber
'71'</span></pre>
   <p>
    <span class="koboSpan" id="kobo.323.1">
     Now, step out using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      out
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.325.2">
     This will take us back to our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     file, but now paused on the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.328.1">
       toString()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.329.1">
      method:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.330.1">
debug&gt; out
break in server.js:7
  5 app.get('/:number', (req, res) =&gt; {
  6   const number = req.params.number;
&gt; 7   res.send(random(number).toString());
  8 });
  9</span></pre>
   <p>
    <span class="koboSpan" id="kobo.331.1">
     When you reach a breakpoint or pause execution in a function and wish to skip the remainder of the function’s execution to return to the caller, you can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.332.1">
      out
     </span>
    </strong>
    <span class="koboSpan" id="kobo.333.1">
     command.
    </span>
    <span class="koboSpan" id="kobo.333.2">
     To exit the debugger, you can type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.334.1">
      .exit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.335.1">
     or enter
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.336.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.337.1">
     +
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.338.1">
       C
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.339.1">
      twice.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.340.1">
     We’ve now learned
    </span>
    <a id="_idIndexMarker955">
    </a>
    <span class="koboSpan" id="kobo.341.1">
     how to step through our code and output reference values using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.342.1">
      command-line debugger.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.343.1">
     Debugging TypeScript
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     With TypeScript, the code that runs in the browser is compiled JavaScript, which can make debugging
    </span>
    <a id="_idIndexMarker956">
    </a>
    <span class="koboSpan" id="kobo.345.1">
     difficult.
    </span>
    <span class="koboSpan" id="kobo.345.2">
     Source maps solve this problem by mapping the compiled code back to your original TypeScript code, allowing you to debug more effectively with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.346.1">
      Chrome DevTools.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.347.1">
     Source maps are files that map your compiled JavaScript code back to the original TypeScript code.
    </span>
    <span class="koboSpan" id="kobo.347.2">
     This allows you to debug the original TypeScript code directly in Chrome DevTools, making it easier to set breakpoints and understand errors.
    </span>
    <span class="koboSpan" id="kobo.347.3">
     To enable source maps in TypeScript, you need to enable them in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.348.1">
       tsconfig.json
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.349.1">
      file:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.350.1">
  "compilerOptions": {
    "sourceMap": true,
    ...
</span><span class="koboSpan" id="kobo.350.2">  }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.351.1">
     Setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.352.1">
      sourceMap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     instructs the TypeScript compiler to generate source maps for your compiled
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.356.1">
      JavaScript files.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.357.1">
     Once you have enabled source maps and compiled your TypeScript code, you can use Chrome DevTools to take advantage of them.
    </span>
    <span class="koboSpan" id="kobo.357.2">
     With source maps enabled, your original TypeScript files will be listed, and you can open these files and set breakpoints directly in the TypeScript code.
    </span>
    <span class="koboSpan" id="kobo.357.3">
     When you hit a breakpoint or encounter an error, Chrome DevTools will show the corresponding line in your original
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.358.1">
      TypeScript code.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-384">
    <a id="_idTextAnchor396">
    </a>
    <span class="koboSpan" id="kobo.359.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.360.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.361.1">
       Logging with Node.js
      </span>
     </em>
     <span class="koboSpan" id="kobo.362.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.363.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.364.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.365.1">
       Enabling debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.366.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.367.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-385">
    <a id="_idTextAnchor397">
    </a>
    <span class="koboSpan" id="kobo.368.1">
     Logging with Node.js
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.369.1">
      Logging
     </span>
    </strong>
    <span class="koboSpan" id="kobo.370.1">
     is a crucial tool for understanding the
    </span>
    <a id="_idIndexMarker957">
    </a>
    <span class="koboSpan" id="kobo.371.1">
     inner workings of an application.
    </span>
    <span class="koboSpan" id="kobo.371.2">
     By strategically placing log statements throughout your code, you can gain valuable insights into the behavior and state of your application at various points in its execution.
    </span>
    <span class="koboSpan" id="kobo.371.3">
     This is particularly useful when
    </span>
    <a id="_idIndexMarker958">
    </a>
    <span class="koboSpan" id="kobo.372.1">
     diagnosing issues, as logs can provide a retrospective view of what was happening just before a crash or failure – helping you identify the root cause
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.373.1">
      more efficiently.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     Beyond troubleshooting, logging serves multiple purposes.
    </span>
    <span class="koboSpan" id="kobo.374.2">
     For instance, you can use logs to collect and analyze data about your application’s usage patterns.
    </span>
    <span class="koboSpan" id="kobo.374.3">
     By logging every access to the endpoints of your web application, you can aggregate these logs to identify the most frequently visited endpoints.
    </span>
    <span class="koboSpan" id="kobo.374.4">
     This information can help you optimize performance, improve user experience, and make informed decisions about future
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.375.1">
      development priorities.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.376.1">
     In this recipe, we will delve into logging with
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.377.1">
      Pino
     </span>
    </strong>
    <span class="koboSpan" id="kobo.378.1">
     (
    </span>
    <a href="https://www.npmjs.com/package/pino">
     <span class="koboSpan" id="kobo.379.1">
      https://www.npmjs.com/package/pino
     </span>
    </a>
    <span class="koboSpan" id="kobo.380.1">
     ), a high-performance JSON-based logger that is both fast and lightweight.
    </span>
    <span class="koboSpan" id="kobo.380.2">
     Pino is particularly well
    </span>
    <a id="_idIndexMarker959">
    </a>
    <span class="koboSpan" id="kobo.381.1">
     suited for Node.js applications, offering a streamlined way to produce structured logs that are easy to parse and analyze.
    </span>
    <span class="koboSpan" id="kobo.381.2">
     We will cover how to set up Pino, integrate it into your application, and use it to generate
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.382.1">
      meaningful logs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-386">
    <a id="_idTextAnchor398">
    </a>
    <span class="koboSpan" id="kobo.383.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.384.1">
     To demonstrate logging
    </span>
    <a id="_idIndexMarker960">
    </a>
    <span class="koboSpan" id="kobo.385.1">
     with Pino, we’ll create a server
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      with Express.js:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.387.1">
      First, create a new directory named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.388.1">
       logging-with-pino
      </span>
     </strong>
     <span class="koboSpan" id="kobo.389.1">
      , initialize our project, and then install the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.390.1">
        express
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.391.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.392.1">$ mkdir logging-with-pino</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.393.1">$ cd logging-with-pino</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.394.1">$ npm init --yes</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.395.1">
      We’ll create a few files that we’ll use to demonstrate some basic Pino
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.396.1">
       logging features:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.397.1">$ touch log.js logToFile.js redactLog.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.398.1">
     We will look at how we can add Pino logging to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.399.1">
      Express.js server.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-387">
    <a id="_idTextAnchor399">
    </a>
    <span class="koboSpan" id="kobo.400.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.401.1">
     In this recipe, we will make
    </span>
    <a id="_idIndexMarker961">
    </a>
    <span class="koboSpan" id="kobo.402.1">
     use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.403.1">
      logging-with-pino
     </span>
    </strong>
    <span class="koboSpan" id="kobo.404.1">
     module to
    </span>
    <a id="_idIndexMarker962">
    </a>
    <span class="koboSpan" id="kobo.405.1">
     demonstrate logging
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.406.1">
      with Pino:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.407.1">
      First, start by installing the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.408.1">
        pino
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.409.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.410.1">$ npm install pino</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.411.1">
      To start, we will add some basic logging to our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.412.1">
       log.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.413.1">
      file to demonstrate the usage of Pino.
     </span>
     <span class="koboSpan" id="kobo.413.2">
      In
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.414.1">
       log.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.415.1">
      , first import Pino and initialize
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.416.1">
       the logger:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.417.1">
const pino = require('pino');
const logger = pino();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.418.1">
      With Pino initialized, we can start logging messages.
     </span>
     <span class="koboSpan" id="kobo.418.2">
      Pino supports many different log levels, including
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.419.1">
       info
      </span>
     </strong>
     <span class="koboSpan" id="kobo.420.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.421.1">
       warn
      </span>
     </strong>
     <span class="koboSpan" id="kobo.422.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.423.1">
       error
      </span>
     </strong>
     <span class="koboSpan" id="kobo.424.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.425.1">
       debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.426.1">
      .
     </span>
     <span class="koboSpan" id="kobo.426.2">
      Let’s add one of each of these
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.427.1">
       log messages:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.428.1">
logger.info('This is an info message');
logger.warn('This is a warning message');
logger.error('This is an error message');
logger.debug('This is a debug message');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.429.1">
      Run this in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.430.1">
       your terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.431.1">$ node log.js</span></strong><span class="koboSpan" id="kobo.432.1">
{"level":30,"time":1715650619079,"pid":11107,"hostname":"bgriggs-mac","msg":"This is an info message"}
{"level":40,"time":1715650619079,"pid":11107,"hostname":"bgriggs-mac","msg":"This is a warning message"}
{"level":50,"time":1715650619079,"pid":11107,"hostname":"bgriggs-mac","msg":"This is an error message"}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.433.1">
       Observe that we only
      </span>
      <a id="_idIndexMarker963">
      </a>
      <span class="koboSpan" id="kobo.434.1">
       see three of the four messages.
      </span>
      <span class="koboSpan" id="kobo.434.2">
       This is
      </span>
      <a id="_idIndexMarker964">
      </a>
      <span class="koboSpan" id="kobo.435.1">
       because Pino’s default log level is
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.436.1">
        info
       </span>
      </strong>
      <span class="koboSpan" id="kobo.437.1">
       .
      </span>
      <span class="koboSpan" id="kobo.437.2">
       This means that messages logged with debug will not appear unless you change the log level to
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.438.1">
        debug
       </span>
      </strong>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.439.1">
        or
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.440.1">
         lower
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.441.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.442.1">
      Let’s adjust the configuration of our Pino logger.
     </span>
     <span class="koboSpan" id="kobo.442.2">
      We’ll set the log level to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.443.1">
       debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.444.1">
      so that we can see
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.445.1">
       all messages:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.446.1">
const logger = pino({
  level: 'debug'
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.447.1">
      Back in your terminal, rerun the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.448.1">
        log.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.449.1">
       program:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.450.1">$ node log.js</span></strong><span class="koboSpan" id="kobo.451.1">
{"level":30,"time":1715650992560,"pid":11344,"hostname":"bgriggs-mac","msg":"This is an info message"}
{"level":40,"time":1715650992561,"pid":11344,"hostname":"bgriggs-mac","msg":"This is a warning message"}
{"level":50,"time":1715650992561,"pid":11344,"hostname":"bgriggs-mac","msg":"This is an error message"}
{"level":20,"time":1715650992561,"pid":11344,"hostname":"bgriggs-mac","msg":"This is a debug message"}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.452.1">
      Let’s make the output look more readable.
     </span>
     <span class="koboSpan" id="kobo.452.2">
      To do this, we can
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.453.1">
       use
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.454.1">
        pino-pretty
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.455.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.456.1">$ node log.js | npx pino-pretty</span></strong><span class="koboSpan" id="kobo.457.1">
npm WARN exec The following package was not found and will be installed: pino-pretty@11.0.0
[02:57:10.042] INFO (11785): This is an info message
[02:57:10.042] WARN (11785): This is a warning message
[02:57:10.042] ERROR (11785): This is an error message
[02:57:10.042] DEBUG (11785): This is a debug message</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.458.1">
      Next, let’s learn how to log to
     </span>
     <a id="_idIndexMarker965">
     </a>
     <span class="koboSpan" id="kobo.459.1">
      a file with Pino.
     </span>
     <span class="koboSpan" id="kobo.459.2">
      For this, we’ll work within
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.460.1">
       logToFile.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.461.1">
      .
     </span>
     <span class="koboSpan" id="kobo.461.2">
      Add the
     </span>
     <a id="_idIndexMarker966">
     </a>
     <span class="koboSpan" id="kobo.462.1">
      following to configure Pino to use a stream to write to a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.463.1">
       app.log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.464.1">
      .
     </span>
     <span class="koboSpan" id="kobo.464.2">
      We’ll also add a single message so we can see the file is being
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.465.1">
       written to:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.466.1">
const fs = require('node:fs');
const pino = require('pino');
const stream = fs.createWriteStream('app.log');
const logger = pino(stream);
logger.info('This is an info message');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.467.1">
      Back in your terminal, run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.468.1">
       logToFile.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.469.1">
      program, and once completed, you should be able to see the message that has been written to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.470.1">
       the file:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.471.1">$ node logToFile.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.472.1">$ cat app.log</span></strong><span class="koboSpan" id="kobo.473.1">
{"level":30,"time":1715651351046,"pid":11554,"hostname":"bgriggs-mac","msg":"This is an info message"}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.474.1">
      Finally, let’s demonstrate Pino’s log redaction: Pino allows you to redact sensitive information from
     </span>
     <a id="_idIndexMarker967">
     </a>
     <span class="koboSpan" id="kobo.475.1">
      your logs to protect sensitive data.
     </span>
     <span class="koboSpan" id="kobo.475.2">
      You can specify the paths of the properties to redact.
     </span>
     <span class="koboSpan" id="kobo.475.3">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.476.1">
       to
      </span>
     </span>
     <span class="No-Break">
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.477.1">
        r
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.478.1">
        edactLog.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.479.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.480.1">
const pino = require('pino');
const logger = pino({
    redact: ['user.password', 'user.ip']
  });
  logger.info({
    user: {
        name: 'Jane Doe',
        password: 'secret',
        ip: '192.168.1.1'
    }
}, 'User login');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.481.1">
      Run the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.482.1">
       redactLog.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.483.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.483.2">
      We
     </span>
     <a id="_idIndexMarker968">
     </a>
     <span class="koboSpan" id="kobo.484.1">
      expect to see the password and IP values we
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.485.1">
       specified redacted:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.486.1">$ node redactLog.js</span></strong><span class="koboSpan" id="kobo.487.1">
{"level":30,"time":1715658998631,"pid":4583,"hostname":"Bethanys-MacBook-Pro.local","user":{"name":"Jane Doe","password":"[Redacted]","ip":"[Redacted]"},"msg":"User login"}</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.488.1">
     We’ve now demonstrated some key features of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.489.1">
      Pino logging.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-388">
    <a id="_idTextAnchor400">
    </a>
    <span class="koboSpan" id="kobo.490.1">
     How it works…
    </span>
   </h2>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.491.1">
      Pino
     </span>
    </strong>
    <span class="koboSpan" id="kobo.492.1">
     is a highly performant and
    </span>
    <a id="_idIndexMarker969">
    </a>
    <span class="koboSpan" id="kobo.493.1">
     low-overhead logging library for Node.js, designed to be minimalistic and fast, making it suitable for high-throughput applications.
    </span>
    <span class="koboSpan" id="kobo.493.2">
     It outputs logs in a JSON format by default, which facilitates easy parsing and compatibility with log processing systems.
    </span>
    <span class="koboSpan" id="kobo.493.3">
     This structured format includes essential details, such as timestamps, log levels, and the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.494.1">
      message content.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.495.1">
     In the recipe, we began with the integration of the Pino module, which is accomplished by installing and then importing it into the application.
    </span>
    <span class="koboSpan" id="kobo.495.2">
     Once Pino is integrated, a logger instance is instantiated.
    </span>
    <span class="koboSpan" id="kobo.495.3">
     This instance serves as the central mechanism through which all logging activities are conducted.
    </span>
    <span class="koboSpan" id="kobo.495.4">
     Using this logger, developers can generate logs at various severity levels.
    </span>
    <span class="koboSpan" id="kobo.495.5">
     Each level allows the logger to categorize messages by their importance, aiding in the
    </span>
    <a id="_idIndexMarker970">
    </a>
    <span class="koboSpan" id="kobo.496.1">
     quick identification and troubleshooting of issues based on their severity.
    </span>
    <span class="koboSpan" id="kobo.496.2">
     The possible log levels are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.497.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.498.1">
        fatal
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.499.1">
        error
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.500.1">
        warn
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.501.1">
        info
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.502.1">
        debug
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.503.1">
        trace
       </span>
      </strong>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-389">
    <a id="_idTextAnchor401">
    </a>
    <span class="koboSpan" id="kobo.504.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.505.1">
     Pino can be integrated into various web frameworks using middleware, enhancing logging capabilities with minimal effort.
    </span>
    <span class="koboSpan" id="kobo.505.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.506.1">
      express-pino-logger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.507.1">
     middleware, for example, adds a log object to every incoming request in an Express.js application.
    </span>
    <span class="koboSpan" id="kobo.507.2">
     This log object is accessible via a property named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.508.1">
      log
     </span>
    </strong>
    <span class="koboSpan" id="kobo.509.1">
     on the request object (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.510.1">
      req.log
     </span>
    </strong>
    <span class="koboSpan" id="kobo.511.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.511.2">
     Each log object is unique per request and contains data about the request, including a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.512.1">
      unique identifier.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.513.1">
     The following example
    </span>
    <a id="_idIndexMarker971">
    </a>
    <span class="koboSpan" id="kobo.514.1">
     demonstrates how Pino can be integrated into an Express.js application to provide
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.515.1">
      JSON logging:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.516.1">
const express = require('express');
const pino = require('pino');
</span><strong class="bold"><span class="koboSpan" id="kobo.517.1">const expressPino = require('express-pino-logger');</span></strong><span class="koboSpan" id="kobo.518.1">
const logger = pino();
const app = express();
</span><strong class="bold"><span class="koboSpan" id="kobo.519.1">app.use(expressPino({ logger }));</span></strong><span class="koboSpan" id="kobo.520.1">
app.get('/', (req, res) =&gt; {
</span><strong class="bold"><span class="koboSpan" id="kobo.521.1">  req.log.info('Handling request');</span></strong><span class="koboSpan" id="kobo.522.1">
  res.send('Hello World');
});
app.listen(3000, () =&gt; {
  logger.info('Server is running on port 3000');
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.523.1">
     In addition to Express.js, Pino can be integrated with other popular web frameworks through various middlewares
    </span>
    <a id="_idIndexMarker972">
    </a>
    <span class="koboSpan" id="kobo.524.1">
     and plugins provided by the Pino
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.525.1">
      GitHub organization:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.526.1">
       express-pino-logger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.527.1">
      : Express.js middleware for Pino, as used in the prior
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.528.1">
       example (
      </span>
     </span>
     <a href="https://github.com/pinojs/express-pino-logger">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.529.1">
        https://github.com/pinojs/express-pino-logger
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.530.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.531.1">
       hapi-pino
      </span>
     </strong>
     <span class="koboSpan" id="kobo.532.1">
      : A Hapi plugin for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.533.1">
       Pino (
      </span>
     </span>
     <a href="https://github.com/pinojs/hapi-pino">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.534.1">
        https://github.com/pinojs/hapi-pino
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.535.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.536.1">
       koa-pino
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      : A Koa.js middleware for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.538.1">
       Pino (
      </span>
     </span>
     <a href="https://github.com/pinojs/koa-pino-logger">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.539.1">
        https://github.com/pinojs/koa-pino-logger
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.540.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.541.1">
       restify
      </span>
     </strong>
     <span class="koboSpan" id="kobo.542.1">
      : A Restify middleware for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.543.1">
       Pino (
      </span>
     </span>
     <a href="https://github.com/pinojs/restify-pino-logger">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.544.1">
        https://github.com/pinojs/restify-pino-logger
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.545.1">
       )
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.546.1">
     Furthermore, Pino’s logging capability is
    </span>
    <a id="_idIndexMarker973">
    </a>
    <span class="koboSpan" id="kobo.547.1">
     built into the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.548.1">
      Fastify
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     web framework, requiring only that logging be enabled with a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.550.1">
      simple configuration:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.551.1">
 const fastify = require('fastify')({
  logger: true,
});</span></pre>
   <h2 id="_idParaDest-390">
    <a id="_idTextAnchor402">
    </a>
    <span class="koboSpan" id="kobo.552.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.553.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.554.1">
       Consuming Node.js modules
      </span>
     </em>
     <span class="koboSpan" id="kobo.555.1">
      recipe in
     </span>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.556.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <a href="B19212_06.xhtml#_idTextAnchor178">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.557.1">
         Chapter 6
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <span class="koboSpan" id="kobo.558.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.559.1">
       Enabling debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.560.1">
      recipe
     </span>
     <a id="_idIndexMarker974">
     </a>
     <span class="koboSpan" id="kobo.561.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.562.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-391">
    <a id="_idTextAnchor403">
    </a>
    <span class="koboSpan" id="kobo.563.1">
     Enabling debug logs
    </span>
   </h1>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.564.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.565.1">
     is a popular library, used by many popular frameworks, including the Express.js web framework and the Mocha test framework.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.566.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.567.1">
     is a small JavaScript debugging utility based on the debugging
    </span>
    <a id="_idIndexMarker975">
    </a>
    <span class="koboSpan" id="kobo.568.1">
     technique used in Node.js runtime itself.
    </span>
    <span class="koboSpan" id="kobo.568.2">
     It offers a straightforward and flexible way to manage debug logs, allowing you to enable or disable debugging dynamically, without altering your application code.
    </span>
    <span class="koboSpan" id="kobo.568.3">
     By using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.569.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.570.1">
     , you can selectively control logging for different parts of your application, making it easier to diagnose issues and understand
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.571.1">
      application flow.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.572.1">
     In the recipe, we’ll discover how to enable debug logs on an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.573.1">
      Express.js application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-392">
    <a id="_idTextAnchor404">
    </a>
    <span class="koboSpan" id="kobo.574.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.575.1">
     We’ll create an Express.js web application that we can enable debug
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.576.1">
      logs on:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.577.1">
      Create a new directory and initialize
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.578.1">
       our project:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.579.1">$ mkdir express-debug-app</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.580.1">$ cd express-debug-app</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.581.1">$ npm init --yes</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.582.1">$ npm install express</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.583.1">
      Now, we’ll create a single file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.584.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.585.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.586.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.587.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.588.1">
      Add the following code
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.589.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.590.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.591.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.592.1">
const express = require('express');
const app = express();
app.get('/', (req, res) =&gt; res.send('Hello World!'));
app.listen(3000, () =&gt; {
  console.log('Server listening on port 3000');
});</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.593.1">
     Now that we have an
    </span>
    <a id="_idIndexMarker976">
    </a>
    <span class="koboSpan" id="kobo.594.1">
     application, we’re ready to enable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.595.1">
      debug logs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-393">
    <a id="_idTextAnchor405">
    </a>
    <span class="koboSpan" id="kobo.596.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.597.1">
     In this recipe, we will be enabling debug logs on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.598.1">
      our application:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.599.1">
      To turn on debug logging, start your server with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.600.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.601.1">$ DEBUG=* node server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.602.1">
      Expect to see the following color-coded output in your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.603.1">
       terminal window:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer099">
     <span class="koboSpan" id="kobo.604.1">
      <img alt="Figure 12.9 – Screenshot of a terminal window depicting debug logs for the web server" src="image/Figure_12.9_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.605.1">
     Figure 12.9 – Screenshot of a terminal window depicting debug logs for the web server
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.606.1">
      Navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.607.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.608.1">
      in your browser to send a request to our server.
     </span>
     <span class="koboSpan" id="kobo.608.2">
      You
     </span>
     <a id="_idIndexMarker977">
     </a>
     <span class="koboSpan" id="kobo.609.1">
      should see that the log messages describing your request have
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.610.1">
       been output:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.611.1">  express:router dispatching GET / +1s</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.612.1">  express:router query  : / +1ms</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.613.1">  express:router expressInit  : / +0ms</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.614.1">
      Stop your server using
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.615.1">
       Ctrl
      </span>
     </em>
     <span class="koboSpan" id="kobo.616.1">
      +
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.617.1">
        C
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.618.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.619.1">
      Now, we can also filter which debug logs are output.
     </span>
     <span class="koboSpan" id="kobo.619.2">
      We’ll filter it to just see the Express.js router actions.
     </span>
     <span class="koboSpan" id="kobo.619.3">
      To do this, restart your server with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.620.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.621.1">$ DEBUG=express:router* node server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.622.1">
      Expect to see the following output in your terminal window.
     </span>
     <span class="koboSpan" id="kobo.622.2">
      Observe that only Express.js router actions
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.623.1">
       are output:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer100">
     <span class="koboSpan" id="kobo.624.1">
      <img alt="Figure 12.10 – Screenshot of a terminal window depicting filtered debug logs for the web server" src="image/Figure_12.10_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.625.1">
     Figure 12.10 – Screenshot of a terminal window depicting filtered debug logs for the web server
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.626.1">
      It’s possible to
     </span>
     <a id="_idIndexMarker978">
     </a>
     <span class="koboSpan" id="kobo.627.1">
      instrument your code with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.628.1">
       debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.629.1">
      module.
     </span>
     <span class="koboSpan" id="kobo.629.2">
      We can do that by extending our program.
     </span>
     <span class="koboSpan" id="kobo.629.3">
      Start by copying the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.630.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.631.1">
      file used in the recipe to a new file and install the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.632.1">
        debug
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.633.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.634.1">$ cp server.js debug-server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.635.1">$ npm install debug</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.636.1">
      Change
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.637.1">
       debug-server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.638.1">
      to the following.
     </span>
     <span class="koboSpan" id="kobo.638.2">
      We have imported the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.639.1">
       debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.640.1">
      module on
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.641.1">
       line 3
      </span>
     </em>
     <span class="koboSpan" id="kobo.642.1">
      , and added a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.643.1">
       debug
      </span>
     </strong>
     <span class="koboSpan" id="kobo.644.1">
      call on
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.645.1">
        line 6
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.646.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.647.1">
const express = require('express');
const app = express();
const debug = require('debug')('my-server');
app.get('/', (req, res) =&gt; {
  debug('HTTP GET request to /');
  res.send('Hello World!');
});
app.listen(3000, () =&gt; {
  console.log('Server listening on port 3000');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.648.1">
      Start your
     </span>
     <a id="_idIndexMarker979">
     </a>
     <span class="koboSpan" id="kobo.649.1">
      application with the following command, and then navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.650.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.651.1">
      .
     </span>
     <span class="koboSpan" id="kobo.651.2">
      Expect to see our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.652.1">
       HTTP GET request to /
      </span>
     </strong>
     <span class="koboSpan" id="kobo.653.1">
      log message in your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.654.1">
       terminal window:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.655.1">$ DEBUG=my-server node debug-server.js</span></strong><span class="koboSpan" id="kobo.656.1">
Server listening on port 3000
 my-server HTTP GET request to / +0ms</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.657.1">
       Note that our log message has
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.658.1">
        my-server
       </span>
      </strong>
      <span class="koboSpan" id="kobo.659.1">
       prepended to it.
      </span>
      <span class="koboSpan" id="kobo.659.2">
       This is the namespace for our log messages, which we declared when we created our debug
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.660.1">
        logging function.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.661.1">
     We’ve now learned how to enable debug logs on our application.
    </span>
    <span class="koboSpan" id="kobo.661.2">
     We’ve also learned how to filter
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.662.1">
      the logs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-394">
    <a id="_idTextAnchor406">
    </a>
    <span class="koboSpan" id="kobo.663.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.664.1">
     We first prepend
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.665.1">
      DEBUG=*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.666.1">
     to our start command.
    </span>
    <span class="koboSpan" id="kobo.666.2">
     This syntax passes an environment variable named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.667.1">
      DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.668.1">
     to our Node.js process, which can be accessed from within the application
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.669.1">
      via
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.670.1">
       process.env.DEBUG
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.671.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.672.1">
     We set the value to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.673.1">
      *
     </span>
    </strong>
    <span class="koboSpan" id="kobo.674.1">
     , which enables all logs.
    </span>
    <span class="koboSpan" id="kobo.674.2">
     Later, we filter out logs by setting
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.675.1">
      DEBUG=express:router*
     </span>
    </strong>
    <span class="koboSpan" id="kobo.676.1">
     .
    </span>
    <span class="koboSpan" id="kobo.676.2">
     Internally, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.677.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.678.1">
     module converts the values we set to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.679.1">
      regular expressions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.680.1">
     Express.js uses the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.681.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.682.1">
     module internally to instrument
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.683.1">
      its code.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.684.1">
     The default debug configuration is not suitable for logging in production.
    </span>
    <span class="koboSpan" id="kobo.684.2">
     The default debug logs are intended to be human-readable, hence the color coding.
    </span>
    <span class="koboSpan" id="kobo.684.3">
     When in production, you should pass your process the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.685.1">
      DEBUG_COLORS=no
     </span>
    </strong>
    <span class="koboSpan" id="kobo.686.1">
     value to remove the ANSI codes that
    </span>
    <a id="_idIndexMarker980">
    </a>
    <span class="koboSpan" id="kobo.687.1">
     implement the color coding.
    </span>
    <span class="koboSpan" id="kobo.687.2">
     This will make the output more
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.688.1">
      easily machine-readable.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-395">
    <a id="_idTextAnchor407">
    </a>
    <span class="koboSpan" id="kobo.689.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.690.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.691.1">
       Consuming Node.js modules
      </span>
     </em>
     <span class="koboSpan" id="kobo.692.1">
      recipe in
     </span>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.693.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <span class="koboSpan" id="kobo.694.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.695.1">
       Logging with Node.js
      </span>
     </em>
     <span class="koboSpan" id="kobo.696.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.697.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.698.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.699.1">
       Enabling Node.js core debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.700.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.701.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-396">
    <a id="_idTextAnchor408">
    </a>
    <span class="koboSpan" id="kobo.702.1">
     Enabling Node.js core debug logs
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.703.1">
     When debugging
    </span>
    <a id="_idIndexMarker981">
    </a>
    <span class="koboSpan" id="kobo.704.1">
     some problems in your applications, it can be useful to have insight into the internals of Node.js and how it handles the execution of your program.
    </span>
    <span class="koboSpan" id="kobo.704.2">
     Node.js provides debug logs that we can enable to help us understand what is happening internally
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.705.1">
      in Node.js.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.706.1">
     These core debug logs can be enabled via an environment variable named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.707.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.708.1">
     .
    </span>
    <span class="koboSpan" id="kobo.708.2">
     In the recipe, we’re going to set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.709.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.710.1">
     environment variable to allow us to log internal
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.711.1">
      Node.js behaviors.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-397">
    <a id="_idTextAnchor409">
    </a>
    <span class="koboSpan" id="kobo.712.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.713.1">
     We’ll need to create an application on which we can enable Node.js core
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.714.1">
      debug logs:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.715.1">
      We’ll create a simple Express.js-based server with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.716.1">
       one route:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.717.1">$ mkdir core-debug-logs</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.718.1">$ cd core-debug-logs</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.719.1">$ npm init --yes</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.720.1">$ npm install express</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.721.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.722.1">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.723.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.724.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.725.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.726.1">
const express = require('express');
const app = express();
app.get('/', (req, res) =&gt; {
  res.send('Hello World!');
});
app.listen(3000, () =&gt; {
  console.log('Server listening on port 3000');
  setInterval(() =&gt; {
    console.log('Server listening...');
  }, 3000);
});</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.727.1">
     Now that we have an application ready, we can enable the core debug logs to allow us to see what is happening
    </span>
    <a id="_idIndexMarker982">
    </a>
    <span class="koboSpan" id="kobo.728.1">
     at the Node.js
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.729.1">
      runtime level.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-398">
    <a id="_idTextAnchor410">
    </a>
    <span class="koboSpan" id="kobo.730.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.731.1">
     In this recipe, we will be enabling Node.js core debug logs on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.732.1">
      an application:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.733.1">
      We just need to set the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.734.1">
       NODE_DEBUG
      </span>
     </strong>
     <span class="koboSpan" id="kobo.735.1">
      variable to the internal flag we wish to log.
     </span>
     <span class="koboSpan" id="kobo.735.2">
      The internal flags align with specific subsystems of Node.js, such as timers or HTTP.
     </span>
     <span class="koboSpan" id="kobo.735.3">
      To enable the “timer” core debug logs, start your server with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.736.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.737.1">$ NODE_DEBUG=timer node server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.738.1">
      Observe the additional log output from our program.
     </span>
     <span class="koboSpan" id="kobo.738.2">
      We can see additional information about our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.739.1">
       setInterval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.740.1">
      function, which is executed every
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.741.1">
       3,000 ms:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer101">
     <span class="koboSpan" id="kobo.742.1">
      <img alt="Figure 12.11 – Screenshot of a terminal window depicting Node.js core timer debug messages" src="image/Figure_12.11_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.743.1">
     Figure 12.11 – Screenshot of a terminal window depicting Node.js core timer debug messages
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.744.1">
     The preceding
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.745.1">
      TIMER
     </span>
    </strong>
    <span class="koboSpan" id="kobo.746.1">
     log statements are additional debug information that derives from
    </span>
    <a id="_idIndexMarker983">
    </a>
    <span class="koboSpan" id="kobo.747.1">
     the internal implementation of timers in Node.js core, which can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.748.1">
      at
     </span>
    </span>
    <a href="https://github.com/nodejs/node/blob/master/lib/internal/timers.js">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.749.1">
       https://github.com/nodejs/node/blob/master/lib/internal/timers.js
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.750.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.751.1">
      We will now enable core debug logs for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.752.1">
       http
      </span>
     </strong>
     <span class="koboSpan" id="kobo.753.1">
      module.
     </span>
     <span class="koboSpan" id="kobo.753.2">
      Restart your server with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.754.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.755.1">$ NODE_DEBUG=http node server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.756.1">
      Navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.757.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.758.1">
      in a browser.
     </span>
     <span class="koboSpan" id="kobo.758.2">
      You should expect to see internal logs about your HTTP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.759.1">
       request output:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer102">
     <span class="koboSpan" id="kobo.760.1">
      <img alt="Figure 12.12 – Screenshot of a terminal window depicting Node.js core HTTP debug messages" src="image/Figure_12.12_B19212.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.761.1">
     Figure 12.12 – Screenshot of a terminal window depicting Node.js core HTTP debug messages
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.762.1">
     We’ve now learned
    </span>
    <a id="_idIndexMarker984">
    </a>
    <span class="koboSpan" id="kobo.763.1">
     how to use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.764.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.765.1">
     environment variable to enable the logging of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.766.1">
      Node.js internals.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-399">
    <a id="_idTextAnchor411">
    </a>
    <span class="koboSpan" id="kobo.767.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.768.1">
     In the recipe, we set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.769.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.770.1">
     environment variable to both the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.771.1">
      timer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.772.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.773.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     subsystems.
    </span>
    <span class="koboSpan" id="kobo.774.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     environment variable can be set to the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.777.1">
      Node.js subsystems:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.778.1">
        child_process
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.779.1">
        cluster
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.780.1">
        esm
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.781.1">
        fs
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.782.1">
        http
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.783.1">
        https
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.784.1">
        http2
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.785.1">
        module
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.786.1">
        net
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.787.1">
        repl
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.788.1">
        source_map
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.789.1">
        stream
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.790.1">
        test_runner
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.791.1">
        timer
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.792.1">
        tls
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.793.1">
        worker
       </span>
      </strong>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.794.1">
     It is also possible to enable debug logs on multiple subsystems via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.795.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.796.1">
     environment variable.
    </span>
    <span class="koboSpan" id="kobo.796.2">
     To enable multiple subsystem logs, you can pass them as a comma-separated list.
    </span>
    <span class="koboSpan" id="kobo.796.3">
     For
    </span>
    <a id="_idIndexMarker985">
    </a>
    <span class="koboSpan" id="kobo.797.1">
     example, to enable both the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.798.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.799.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.800.1">
      timer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.801.1">
     subsystems, you’d supply the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.802.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.803.1">
$ NODE_DEBUG=http,timer node server.js</span></pre>
   <p>
    <span class="koboSpan" id="kobo.804.1">
     The output of each log message includes the subsystem/namespace, followed by the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.805.1">
      process identifier
     </span>
    </strong>
    <span class="koboSpan" id="kobo.806.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.807.1">
      PID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     ), and then the
    </span>
    <a id="_idIndexMarker986">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.809.1">
      log message.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.810.1">
     In the recipe, we first enabled the “timer” core debug logs.
    </span>
    <span class="koboSpan" id="kobo.810.2">
     In our program, we have a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.811.1">
      setInterval()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.812.1">
     function that prints the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.813.1">
      Server listening...
     </span>
    </strong>
    <span class="koboSpan" id="kobo.814.1">
     message to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.815.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.816.1">
     every 3,000 ms.
    </span>
    <span class="koboSpan" id="kobo.816.2">
     The core debug logs provided insight into how our interval timer was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.817.1">
      created internally.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.818.1">
     Similarly, when we enabled the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.819.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.820.1">
     core module debug logs, we could follow what was happening internally during HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.820.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.821.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.822.1">
     debug logs are fairly self-explanatory and human-readable in terms of how they describe the actions that are happening when our server
    </span>
    <a id="_idIndexMarker987">
    </a>
    <span class="koboSpan" id="kobo.823.1">
     receives and responds to an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.824.1">
      HTTP request.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.825.1">
     Extending NODE_DEBUG
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.826.1">
     It is possible to make use of the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.827.1">
      util.debuglog()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.828.1">
     method to instrument your own debug logs that you can enable via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.829.1">
      NODE_DEBUG
     </span>
    </strong>
    <span class="koboSpan" id="kobo.830.1">
     environment variable.
    </span>
    <span class="koboSpan" id="kobo.830.2">
     However, this is
    </span>
    <a id="_idIndexMarker988">
    </a>
    <span class="koboSpan" id="kobo.831.1">
     not generally recommended.
    </span>
    <span class="koboSpan" id="kobo.831.2">
     It is preferable to use the third-party
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.832.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.833.1">
     module, which is covered in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.834.1">
      Enabling debug logs
     </span>
    </em>
    <span class="koboSpan" id="kobo.835.1">
     recipe in this chapter.
    </span>
    <span class="koboSpan" id="kobo.835.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.836.1">
      debug
     </span>
    </strong>
    <span class="koboSpan" id="kobo.837.1">
     module provides additional logging features, including timestamps and color-coding, with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.838.1">
      minimal overhead.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-400">
    <a id="_idTextAnchor412">
    </a>
    <span class="koboSpan" id="kobo.839.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.840.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.841.1">
       Debugging Node.js with Chrome DevTools
      </span>
     </em>
     <span class="koboSpan" id="kobo.842.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.843.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.844.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.845.1">
       Logging with Node.js
      </span>
     </em>
     <span class="koboSpan" id="kobo.846.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.847.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.848.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.849.1">
       Enabling debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.850.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.851.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-401">
    <a id="_idTextAnchor413">
    </a>
    <span class="koboSpan" id="kobo.852.1">
     Increasing stack trace size
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.853.1">
     A
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.854.1">
      stack trace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.855.1">
     , sometimes referred to as a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.856.1">
      stack backtrace
     </span>
    </strong>
    <span class="koboSpan" id="kobo.857.1">
     , is defined as a list of stack frames.
    </span>
    <span class="koboSpan" id="kobo.857.2">
     When your Node.js process hits an error, a
    </span>
    <a id="_idIndexMarker989">
    </a>
    <span class="koboSpan" id="kobo.858.1">
     stack trace is shown detailing the function that experienced
    </span>
    <a id="_idIndexMarker990">
    </a>
    <span class="koboSpan" id="kobo.859.1">
     the error, and the functions that it was called by.
    </span>
    <span class="koboSpan" id="kobo.859.2">
     By default, Node.js’s V8 engine will return 10
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.860.1">
      stack frames.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.861.1">
     When debugging some errors, it can be useful to have more than 10 stack frames.
    </span>
    <span class="koboSpan" id="kobo.861.2">
     However, increasing the number of stack frames stored can come with a performance cost.
    </span>
    <span class="koboSpan" id="kobo.861.3">
     Keeping track of additional stack frames will result in our applications consuming more memory.
    </span>
    <span class="koboSpan" id="kobo.861.4">
     For more details, you can refer to this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.862.1">
      link:
     </span>
    </span>
    <a href="https://v8.dev/docs/stack-trace-api">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.863.1">
       https://v8.dev/docs/stack-trace-api
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.864.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.865.1">
     In the recipe, we’re going to increase the size of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.866.1">
      stack trace.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-402">
    <a id="_idTextAnchor414">
    </a>
    <span class="koboSpan" id="kobo.867.1">
     Getting ready
    </span>
   </h2>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.868.1">
      First, we should create a directory for our application.
     </span>
     <span class="koboSpan" id="kobo.868.2">
      We’ll be using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.869.1">
       express
      </span>
     </strong>
     <span class="koboSpan" id="kobo.870.1">
      module for our program, so we’ll also need to initialize our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.871.1">
       project directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.872.1">$ mkdir stack-trace-app</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.873.1">$ cd stack-trace-app</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.874.1">$ npm init --yes</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.875.1">$ npm install express</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.876.1">
      We’ll need a few files for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.877.1">
       this recipe:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.878.1">$ touch server.js routes.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.879.1">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.880.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.881.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.882.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.883.1">
const express = require('express');
const routes = require('./routes');
const app = express();
app.use(routes);
app.listen(3000, () =&gt; {
  console.log('Server listening on port 3000');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.884.1">
      Then, add the
     </span>
     <a id="_idIndexMarker991">
     </a>
     <span class="koboSpan" id="kobo.885.1">
      following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.886.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.887.1">
        routes.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.888.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.889.1">
const express = require('express');
const router = new express.Router();
router.get('/', (req, res) =&gt; {
  res.send(recursiveContent());
});
function recursiveContent (content, i = 10) {
  --i;
  if (i !== 0) {
    return recursiveContent(content, i);
  } else {
    return content.undefined_property;
  }
}
module.exports = router;</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.890.1">
     The purpose of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.891.1">
      recursiveContent()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.892.1">
     function is to force the creation of function calls, but in larger, more complex applications, it’s possible to exceed the stack frame
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.893.1">
      limit naturally.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.894.1">
     Now that we have an
    </span>
    <a id="_idIndexMarker992">
    </a>
    <span class="koboSpan" id="kobo.895.1">
     application that will exceed the default call stack limit, we can move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.896.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-403">
    <a id="_idTextAnchor415">
    </a>
    <span class="koboSpan" id="kobo.897.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.898.1">
     In this recipe, we will learn how to enable additional stack frames using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.899.1">
      --stack-trace-limit
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.900.1">
      process flag:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.901.1">
      Start by running
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.902.1">
       the server:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.903.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.904.1">Server listening on port 3000</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.905.1">
      Now, in a browser, navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.906.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.907.1">
      .
     </span>
     <span class="koboSpan" id="kobo.907.2">
      Alternatively, you could use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.908.1">
       cURL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.909.1">
      to send a request to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.910.1">
       the endpoint.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.911.1">
      Observe that we see the following stack trace
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.912.1">
       output returned:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.913.1">
TypeError: Cannot read properties of undefined (reading 'undefined_property')
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:13:20)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.914.1">
      We can now restart our application with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.915.1">
       --stack-trace-limit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.916.1">
      flag.
     </span>
     <span class="koboSpan" id="kobo.916.2">
      We’ll set this
     </span>
     <a id="_idIndexMarker993">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.917.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.918.1">
        20
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.919.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.920.1">$ node --stack-trace-limit=20 server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.921.1">Server listening on port 3000</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.922.1">
      Now, navigate or send a request to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.923.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.924.1">
      again.
     </span>
     <span class="koboSpan" id="kobo.924.2">
      Observe that we have more frames from the stack
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.925.1">
       trace now:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.926.1">
...
</span><span class="koboSpan" id="kobo.926.2">    at recursiveContent (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:11:12)
    at /Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/routes.js:5:12
    at Layer.handle [as handle_request] (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/layer.js:95:5)
    at /Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/index.js:175:3)
    at router (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/node_modules/express/lib/router/index.js:47:12)</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.927.1">
      By extending how many stack frames are returned, we can see that the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.928.1">
       recursiveContent()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.929.1">
      function is called in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.930.1">
       routes.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.931.1">
      on
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.932.1">
       line 5
      </span>
     </em>
     <span class="koboSpan" id="kobo.933.1">
      .
     </span>
     <span class="koboSpan" id="kobo.933.2">
      This helps us realize that the reason our program is failing is because we did not define the content and pass it to our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.934.1">
        recursiveContent()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.935.1">
       function.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.936.1">
     We’ve learned how to
    </span>
    <a id="_idIndexMarker994">
    </a>
    <span class="koboSpan" id="kobo.937.1">
     return additional stack traces, and how these can help us to debug
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.938.1">
      our applications.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-404">
    <a id="_idTextAnchor416">
    </a>
    <span class="koboSpan" id="kobo.939.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.940.1">
     In the recipe, we make use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.941.1">
      --stack-trace-limit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.942.1">
     flag.
    </span>
    <span class="koboSpan" id="kobo.942.2">
     This flag instructs the V8 JavaScript engine to retain more stacks.
    </span>
    <span class="koboSpan" id="kobo.942.3">
     When an error occurs, the stack trace will show the preceding function calls up to the limit set with the flag.
    </span>
    <span class="koboSpan" id="kobo.942.4">
     In the recipe, we extended this to 20
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.943.1">
      stack frames.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.944.1">
     Note that it is also possible to set this limit from within your application code.
    </span>
    <span class="koboSpan" id="kobo.944.2">
     The following line would set the stack trace limit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.945.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.946.1">
       20
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.947.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.948.1">
Error.stackTraceLimit = 20;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.949.1">
     It is also possible to set the stack trace limit to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.950.1">
      Infinity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.951.1">
     ,  meaning all preceding function calls will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.952.1">
      be retained:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.953.1">
Error.stackTraceLimit = Infinity</span></pre>
   <p>
    <span class="koboSpan" id="kobo.954.1">
     Storing additional stack traces comes with a performance cost in terms of CPU and memory usage.
    </span>
    <span class="koboSpan" id="kobo.954.2">
     You should consider the impact this may have on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.955.1">
      your application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-405">
    <a id="_idTextAnchor417">
    </a>
    <span class="koboSpan" id="kobo.956.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.957.1">
     Asynchronous stack traces were added to Node.js 12 via the V8 JavaScript engine update; these can help us debug our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.958.1">
      asynchronous functions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.959.1">
     Asynchronous stack traces help us to debug asynchronous functions in our programs.
    </span>
    <span class="koboSpan" id="kobo.959.2">
     Let’s take a look at an asynchronous
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.960.1">
      stack trace:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.961.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.962.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.963.1">
        async-stack-trace.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.964.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.965.1">$ touch async-stack-trace.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.966.1">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.967.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.968.1">
        async-stack-trace.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.969.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.970.1">
foo().then(
  () =&gt; console.log('success'),
  (error) =&gt; console.error(error.stack)
);
async function foo () {
  await bar();
}
async function bar () {
  await Promise.resolve();
  throw new Error('Fail');
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.971.1">
       This program contains an asynchronous function,
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.972.1">
        foo()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.973.1">
       , that awaits a function named
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.974.1">
        bar()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.975.1">
       .
      </span>
      <span class="koboSpan" id="kobo.975.2">
       The
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.976.1">
        bar()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.977.1">
       function automatically resolves
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.978.1">
        Promise
       </span>
      </strong>
      <span class="koboSpan" id="kobo.979.1">
       and then throws
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.980.1">
        an error.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.981.1">
      In versions of Node.js before Node.js 12, the following stack trace would be returned from
     </span>
     <a id="_idIndexMarker995">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.982.1">
       the program:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.983.1">$ node async-stack-trace.js</span></strong><span class="koboSpan" id="kobo.984.1">
Error: Fail
    at bar (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/async-stack-trace.js:15:9)
    at process.runNextTicks [as _tickCallback] (internal/process/task_queues.js:52:5)
    at Function.Module.runMain (internal/modules/cjs/loader.js:880:11)
    at internal/main/run_main_module.js:21:11
(internal/bootstrap/node.js:623:3)</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.985.1">
       Observe that the trace just tells us the error is in the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.986.1">
        bar()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.987.1">
       function, followed by some internal function calls, such as
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.988.1">
        process._tickCallback()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.989.1">
       .
      </span>
      <span class="koboSpan" id="kobo.989.2">
       Prior to Node.js 12, stack traces were unable to effectively report the asynchronous function calls.
      </span>
      <span class="koboSpan" id="kobo.989.3">
       Note that the stack frames do not show that the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.990.1">
        bar()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.991.1">
       function was called
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.992.1">
        by
       </span>
      </span>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.993.1">
         foo()
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.994.1">
        .
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.995.1">
      However, thanks to an updated V8 engine, Node.js 12 and greater enable asynchronous
     </span>
     <a id="_idIndexMarker996">
     </a>
     <span class="koboSpan" id="kobo.996.1">
      stack traces.
     </span>
     <span class="koboSpan" id="kobo.996.2">
      We will now get the following stack output when we run the same program with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.997.1">
       Node.js 22:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.998.1">$ node async-stack-trace.js</span></strong><span class="koboSpan" id="kobo.999.1">
Error: Fail
    at bar (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/async-stack-trace.js:15:9)
    at async foo (/Users/bgriggs/Node.js-Cookbook/Chapter12/stack-trace-app/async-stack-trace.js:9:3)</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1000.1">
     The stack traces in newer versions of Node.js can show us that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1001.1">
      bar()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1002.1">
     function was called by an asynchronous function
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1003.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1004.1">
       foo()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1005.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-406">
    <a id="_idTextAnchor418">
    </a>
    <span class="koboSpan" id="kobo.1006.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1007.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1008.1">
       Logging with Node.js
      </span>
     </em>
     <span class="koboSpan" id="kobo.1009.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1010.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1011.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1012.1">
       Enabling Node.js core debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.1013.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1014.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1015.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1016.1">
       Creating diagnostic reports
      </span>
     </em>
     <span class="koboSpan" id="kobo.1017.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1018.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-407">
    <a id="_idTextAnchor419">
    </a>
    <span class="koboSpan" id="kobo.1019.1">
     Creating diagnostic reports
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1020.1">
     The diagnostic report utility has been available behind a process flag since Node.js v11.8.0.
    </span>
    <span class="koboSpan" id="kobo.1020.2">
     The diagnostic report utility allows you to generate a report containing diagnostic data on demand or when certain events occur.
    </span>
    <span class="koboSpan" id="kobo.1020.3">
     The situations where a report could be generated include when your application crashes, or when your application is experiencing slow performance or high
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1021.1">
      CPU usage.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1022.1">
     A diagnostic report fulfills
    </span>
    <a id="_idIndexMarker997">
    </a>
    <span class="koboSpan" id="kobo.1023.1">
     a similar purpose to the Java Core file.
    </span>
    <span class="koboSpan" id="kobo.1023.2">
     The diagnostic report contains data and information that can aid with diagnosing problems in applications.
    </span>
    <span class="koboSpan" id="kobo.1023.3">
     The information reported includes the Node.js version, the event that triggered the report, stack traces,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1024.1">
      and more.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1025.1">
     Historically, the diagnostic report utility was available as a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1026.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1027.1">
     module named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1028.1">
      node-report
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1029.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1029.2">
     But, to improve adoption and enhance the core diagnostic features, it was merged into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1030.1">
      Node.js core.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1031.1">
     In this recipe, we’ll learn how to enable and configure the diagnostic report utility and generate a report when an uncaught exception happens in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1032.1">
      our application.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-408">
    <a id="_idTextAnchor420">
    </a>
    <span class="koboSpan" id="kobo.1033.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1034.1">
     To get started, we need to prepare our directory and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1035.1">
      some files.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1036.1">
      First, let’s create a directory
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1037.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1038.1">
        diagnostic-report
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1039.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1040.1">$ mkdir diagnostic-report</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1041.1">$ cd diagnostic-report</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1042.1">
      Now, let’s create a file to hold our server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1043.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1044.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1045.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1046.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1047.1">
      Let’s also create a directory to store
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1048.1">
       the reports:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1049.1">$ mkdir reports</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1050.1">
     Now, we are ready to move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1051.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-409">
    <a id="_idTextAnchor421">
    </a>
    <span class="koboSpan" id="kobo.1052.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1053.1">
     In this recipe, we’re going to use the diagnostic report utility to create a report on unhandled errors.
    </span>
    <span class="koboSpan" id="kobo.1053.2">
     We’ll set a custom directory and filename for the report.
    </span>
    <span class="koboSpan" id="kobo.1053.3">
     We’ll also inspect the generated
    </span>
    <a id="_idIndexMarker998">
    </a>
    <span class="koboSpan" id="kobo.1054.1">
     report for information about the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1055.1">
      unhandled errors:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1056.1">
      First, let’s import the core Node.js modules we need for the recipe
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1057.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1058.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1059.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1060.1">
const http = require('node:http');
const path = require('node:path');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1061.1">
      Now, let’s set the directory for our diagnostic report to be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1062.1">
       captured in:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1063.1">
process.report.directory = path.join(__dirname, 'reports');
process.report.filename = 'my-diagnostic-report.json';</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1064.1">
      Now, we’ll send a request to a web server, but we’ll intentionally specify an invalid protocol.
     </span>
     <span class="koboSpan" id="kobo.1064.2">
      Add the following line
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1065.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1066.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1067.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1068.1">
http.get('hello://localhost:3000', (response) =&gt; {});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1069.1">
      Now, if we run the application, we should expect to see the following uncaught
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1070.1">
        ERR_INVALID_PROTOCOL
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1071.1">
       error:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1072.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1073.1">node:_http_client:183</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1074.1">    throw new ERR_INVALID_PROTOCOL(protocol, expectedProtocol);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1075.1">    ^</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1076.1">TypeError [ERR_INVALID_PROTOCOL]: Protocol "hello:" not supported. </span><span class="koboSpan" id="kobo.1076.2">Expected "http:"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1077.1">    at new ClientRequest (node:_http_client:183:11)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1078.1">    at request (node:http:103:10)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1079.1">    at Object.get (node:http:114:15)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1080.1">    at Object.&lt;anonymous&gt; (/Users/bgriggs/Node.js-Cookbook/Chapter12/diagnostic-report/server.js:7:6)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1081.1">    at Module._compile (node:internal/modules/cjs/loader:1358:14)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1082.1">    at Module._extensions..js (node:internal/modules/cjs/loader:1416:10)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1083.1">    at Module.load (node:internal/modules/cjs/loader:1208:32)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1084.1">    at Module._load (node:internal/modules/cjs/loader:1024:12)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1085.1">    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:174:12)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1086.1">    at node:internal/main/run_main_module:28:49 {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1087.1">  code: 'ERR_INVALID_PROTOCOL'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1088.1">}</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1089.1">Node.js v22.9.0</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1090.1">
      To enable the diagnostic
     </span>
     <a id="_idIndexMarker999">
     </a>
     <span class="koboSpan" id="kobo.1091.1">
      report feature, we need to start the Node.js process with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1092.1">
       --report-uncaught-exception
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1093.1">
      flag.
     </span>
     <span class="koboSpan" id="kobo.1093.2">
      Expect to see the following snippet included in the output, showing that a report has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1094.1">
       been created:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1095.1">$ node --report-uncaught-exception server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1096.1">...</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1097.1">Writing Node.js report to file: my-diagnostic-report.json</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1098.1">Node.js report completed</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1099.1">Node.js v22.9.0</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1100.1">
      Now, we can take a look at the report.
     </span>
     <span class="koboSpan" id="kobo.1100.2">
      It should have been created in the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1101.1">
       reports
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1102.1">
      directory with the name
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1103.1">
       my-diagnostic-report.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1104.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1104.2">
      Open the file in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1105.1">
       your editor.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1106.1">
      Identify the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1107.1">
       event
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1108.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1109.1">
       trigger
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1110.1">
      property toward the top of the file and observe that it provides details about the event that triggered
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1111.1">
       the error:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1112.1">    "event": "Exception",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1113.1">    "trigger": "Exception",</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1114.1">
      Further down in the
     </span>
     <a id="_idIndexMarker1000">
     </a>
     <span class="koboSpan" id="kobo.1115.1">
      file, identify the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1116.1">
       javascriptStack
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1117.1">
      property.
     </span>
     <span class="koboSpan" id="kobo.1117.2">
      It should provide the stack trace of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1118.1">
       the error:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1119.1">"javascriptStack": {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1120.1">    "message": "TypeError [ERR_INVALID_PROTOCOL]: Protocol \"hello:\" not supported. </span><span class="koboSpan" id="kobo.1120.2">Expected \"http:\"",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1121.1">    "stack": [</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1122.1">      "at new ClientRequest (node:_http_client:183:11)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1123.1">      "at request (node:http:103:10)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1124.1">      "at Object.get (node:http:114:15)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1125.1">      "at Object.&lt;anonymous&gt; (/Users/bgriggs/Node.js-Cookbook/Chapter12/diagnostic-report/server.js:7:6)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1126.1">      "at Module._compile (node:internal/modules/cjs/loader:1358:14)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1127.1">      "at Module._extensions..js (node:internal/modules/cjs/loader:1416:10)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1128.1">      "at Module.load (node:internal/modules/cjs/loader:1208:32)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1129.1">      "at Module._load (node:internal/modules/cjs/loader:1024:12)",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1130.1">      "at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:174:12)"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1131.1">    ],</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1132.1">    "errorProperties": {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1133.1">      "code": "ERR_INVALID_PROTOCOL"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1134.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1135.1">  }</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1136.1">
     Now, we’ve learned how to enable the diagnostic report utility on uncaught exceptions and how to inspect the report for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1137.1">
      diagnostic information.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-410">
    <a id="_idTextAnchor422">
    </a>
    <span class="koboSpan" id="kobo.1138.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1139.1">
     The diagnostic report
    </span>
    <a id="_idIndexMarker1001">
    </a>
    <span class="koboSpan" id="kobo.1140.1">
     utility enables a diagnostic summary to be written in a file on certain conditions.
    </span>
    <span class="koboSpan" id="kobo.1140.2">
     The utility is built into the Node.js core and is enabled by passing one of the following command-line flags to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1141.1">
      Node.js process:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1142.1">
       --report-uncaught-exception
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1143.1">
      : As used in the recipe, it triggers a crash on an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1144.1">
       uncaught exception.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1145.1">
       --report-on-signal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1146.1">
      : This is used to configure which signal a report is triggered upon, such as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1147.1">
       SIGUSR1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1148.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1149.1">
       SIGUSR2
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1150.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1151.1">
       SIGINT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1152.1">
      , or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1153.1">
       SIGTERM
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1154.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1154.2">
      The default
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1155.1">
       is
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1156.1">
        SIGUSR2
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1157.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1158.1">
       --report-on-fatalerror
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1159.1">
      : A report is triggered on a fatal error, such as an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1160.1">
       out-of-memory error.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1161.1">
     Note that it is also possible to trigger the generation of the report from within your application using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1162.1">
      following line:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1163.1">
process.report.writeReport();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1164.1">
     In the recipe, we first set up a custom directory by assigning the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1165.1">
      process.report.directory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1166.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1167.1">
      process.report.filename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1168.1">
     variables in the program.
    </span>
    <span class="koboSpan" id="kobo.1168.2">
     These can also be set via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1169.1">
      --report-directory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1170.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1171.1">
      --report-filename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1172.1">
     command-line arguments.
    </span>
    <span class="koboSpan" id="kobo.1172.2">
     Note that you may wish to append a timestamp to the filename – otherwise, the reports may
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1173.1">
      get overwritten.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1174.1">
     Neither the directory nor the filename are required to be set.
    </span>
    <span class="koboSpan" id="kobo.1174.2">
     When the directory is omitted, the report will be generated in the directory from which we start the Node.js process.
    </span>
    <span class="koboSpan" id="kobo.1174.3">
     When omitting
    </span>
    <a id="_idIndexMarker1002">
    </a>
    <span class="koboSpan" id="kobo.1175.1">
     a specified filename, the utility will default to creating one with the following naming
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1176.1">
      convention:
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1177.1">
       report.20181126.091102.8480.0.001.json
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1178.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-411">
    <a id="_idTextAnchor423">
    </a>
    <span class="koboSpan" id="kobo.1179.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1180.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1181.1">
       Enabling Node.js core debug logs
      </span>
     </em>
     <span class="koboSpan" id="kobo.1182.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1183.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1184.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1185.1">
       Increasing stack trace output
      </span>
     </em>
     <span class="koboSpan" id="kobo.1186.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1187.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
  </div>
 </body></html>