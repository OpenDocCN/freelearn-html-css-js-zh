<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Planning Application Design</h1></div></div></div><p>In this chapter, we will set up the development environment of the project while introducing Sencha Cmd.</p><p>In this chapter, you will learn to:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Design a simple application</li><li class="listitem" style="list-style-type: disc">Optimize Ajax requests to use Ext Direct and <code class="literal">Ext.util.History</code> to control the screen with URL</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Setting up Sencha Cmd and a local development environment</h1></div></div></div><p>By setting up <a id="id38" class="indexterm"/>the local development environment with Sencha Cmd, when finally deploying the application, Sencha Cmd will only pick up the components being used. This will therefore optimize the final application.</p><p>With Sencha Cmd, you can run a native package for Sencha Touch, including scaffolding and building themes. Let's begin generating your project using Sencha Cmd.</p><div><ol class="orderedlist arabic"><li class="listitem">Install the latest JAVA Runtime Environment that is available on <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a> or JRE.</li><li class="listitem">Install Compass available at <a class="ulink" href="http://compass-style.org/">http://compass-style.org/</a>.</li><li class="listitem">Install Sencha Cmd available at <a class="ulink" href="http://www.sencha.com/products/sencha-cmd/download">http://www.sencha.com/products/sencha-cmd/download</a>.</li><li class="listitem">Download Ext JS SDK available at <a class="ulink" href="http://www.sencha.com/products/extjs/download/">http://www.sencha.com/products/extjs/download/</a>.</li><li class="listitem">Extract Ext JS SDK and locate it in a local directory of your choice. For example, you can create a top-level directory called <code class="literal">ext</code>.</li></ol></div><p>A directory structure<a id="id39" class="indexterm"/> will be created as shown in the following screenshot. This time, we will use Ext JS 4.2.2 GPL.</p><div><img src="img/5446OS_02_01.jpg" alt="Setting up Sencha Cmd and a local development environment"/></div><p>The example is in Mac OS X. After installation, Sencha Cmd is located in the following path, <code class="literal">~/bin/Sencha/Cmd/4.0.0.203/</code>.</p><p>For Windows, Sencha Cmd is located at the following path, <code class="literal">C:/Users/(your username)/bin</code>.</p><p>If the path is<a id="id40" class="indexterm"/> set correctly, you should be able to execute the following command under Sencha and the following list of options, categories, and commands should appear on your screen.</p><div><pre class="programlisting">
<strong># sencha</strong>
<strong>Sencha Cmd v4.0.0.203</strong>
</pre></div><p>By using a combination of the following definitions within Sencha Cmd, we can use Sencha Cmd.</p><p>For example, to create a project, using the options and categories we can enter, <code class="literal">sencha -sdk [/sdk/path] generate app App [/project/path]</code>.</p><p>To build a project, we can use categories and commands to enter: <code class="literal">sencha app build</code>.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Options</h2></div></div></div><p>Here are some options<a id="id41" class="indexterm"/> you can use:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">* --debug, -d - </code>: This sets the log level to higher verbosity</li><li class="listitem" style="list-style-type: disc"><code class="literal">* --plain, -p - </code>: This enables plain logging output (no highlighting)</li><li class="listitem" style="list-style-type: disc"><code class="literal">* --quiet, -q - </code>: This sets the log level to warnings and errors only</li><li class="listitem" style="list-style-type: disc"><code class="literal">* --sdk-path, -s - </code>: This sets the path to the target framework</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Categories</h2></div></div></div><p>Here are some categories<a id="id42" class="indexterm"/> you can use:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">*app - </code>: Using this, we can performs various application build processes</li><li class="listitem" style="list-style-type: disc"><code class="literal">*compile - </code>: This allows us to compile sources to produce concatenated output and metadata</li><li class="listitem" style="list-style-type: disc"><code class="literal">*fs - </code>: This is a set of useful utility actions to work with files</li><li class="listitem" style="list-style-type: disc"><code class="literal">*generate - </code>: This generates models, controllers, and so on, or an entire application</li><li class="listitem" style="list-style-type: disc"><code class="literal">*manifest - </code>: This extracts class metadata</li><li class="listitem" style="list-style-type: disc"><code class="literal">*package - </code>: This packages a Sencha Touch application for native app stores</li><li class="listitem" style="list-style-type: disc"><code class="literal">*theme - </code>: This builds a set of theme images from a given html page</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Commands</h2></div></div></div><p>Here are some commands<a id="id43" class="indexterm"/> you can use:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">* ant - </code>: This invokes Ant with helpful properties back to Sencha Command</li><li class="listitem" style="list-style-type: disc"><code class="literal">* build - </code>: This builds a project from a JSB3 file.</li><li class="listitem" style="list-style-type: disc"><code class="literal">* config - </code>: This loads a config file or sets a configuration property</li><li class="listitem" style="list-style-type: disc"><code class="literal">* help - </code>: This displays help for commands</li><li class="listitem" style="list-style-type: disc"><code class="literal">* js - </code>: This executes arbitrary JavaScript file(s)</li><li class="listitem" style="list-style-type: disc"><code class="literal">* which - </code>: This displays the path to the current version of Sencha Cmd</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Creating a project with Sencha Cmd</h2></div></div></div><p>To begin<a id="id44" class="indexterm"/> with, let's generate a project using Sencha Cmd. At first, move the current directory into the project directory and execute the following command:</p><div><pre class="programlisting">
<strong># sencha -sdk ./ext generate app MyApp ./</strong>
</pre></div><p>The following log should present itself. It's very long, so this is an abridged version, that is, the start and the end of the log:</p><div><pre class="programlisting">[INF]    init-properties:
[INF]    init-sencha-command:
[INF]    init:
.
.
.
[INF]    app-refresh:
[INF]    -after-generate-app:
[INF]    generate-app:</pre></div><p>Then, a directory is generated as follows:</p><div><img src="img/5446OS_02_02.jpg" alt="Creating a project with Sencha Cmd"/></div><p>Let's look at it with a browser; it should be displayed as follows. By all means display it via a web server.</p><div><img src="img/5446OS_02_03.jpg" alt="Creating a project with Sencha Cmd"/></div><p>By executing <a id="id45" class="indexterm"/>the command, Sencha Cmd creates a temporary view and controller to get the whole project up and running quickly. We can make changes or additions to this to suit our own applications.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Creating a component test</h2></div></div></div><p>The <a id="id46" class="indexterm"/>temporary application was generated in Sencha Cmd. However, you should not customize this immediately. Before you do, let's make a <strong>component test</strong> (<strong>CT</strong>) to facilitate development. Generally speaking, it tests the source code and the relationships between the components. The CT shows the source code being tested in the viewport and in separate test views, without moving the whole source code. By using a CT, a team of developers can smoothly build an application at the same time and detect problems early in the development process.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Check how it's working</h2></div></div></div><p>First, <a id="id47" class="indexterm"/>you can check how the automatically generated application works and look at the details of <code class="literal">index.html</code> (source file: <code class="literal">01_check_how_its_working/index.html</code>).</p><p>The only CSS file that can be read is <code class="literal">ext/packages/ext-theme-neptune/build/resources/ext-theme-neptune-all-debug.css</code>. As for the JS file, the following three are read.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ext/ext-dev.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">bootstrap.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app/app.js</code></li></ul></div><p>To run <code class="literal">app.js</code>, you need <code class="literal">ext-dev.js</code> and <code class="literal">bootstrap.js</code>. These are necessary for your application, and other Ext JS files are read dynamically in the Ext Loader. As shown in the following screenshot, many files are read dynamically in the <strong>Network</strong> tab under developer tools in the Google Chrome browser:</p><div><img src="img/5446OS_02_041.jpg" alt="Check how it's working"/></div><p>This time we will use the Ext JS Neptune theme to build the application.</p><p>When you make a new application, the default theme <code class="literal">ext-theme-classic</code> is used. Let's change that to <code class="literal">ext-theme-neptune</code>.</p><p>The target file to modify is as follows:</p><p><code class="literal">.sencha/app/sencha.cfg – L32</code></p><div><pre class="programlisting">
<strong># The name of the package containing the theme scss for the app</strong>
<strong>app.theme=ext-theme-classic</strong>
</pre></div><p>Change the previous line to the following:</p><div><pre class="programlisting">
<strong># The name of the package containing the theme scss for the app</strong>
<strong>app.theme=ext-theme-neptune</strong>
</pre></div><p>When you <a id="id48" class="indexterm"/>proceed to the next section after making this change, the theme should be changed. The theme will look like the following screenshot:</p><div><img src="img/5446OS_02_05.jpg" alt="Check how it's working"/></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Making production build</h2></div></div></div><p>When you use Ext Loader, <a id="id49" class="indexterm"/>it takes a lot of time before a screen is displayed. It becomes slower as the scale of the application grows and the number of files increases. This might be too slow for the product.</p><p>But have no fear, you already have the solution at hand—build with Sencha Cmd. First, move the current project into the project directory and execute the following command:</p><div><pre class="programlisting">
<strong># sencha app build</strong>
</pre></div><p>The following directory is made when you execute the command:</p><div><img src="img/5446OS_02_06.jpg" alt="Making production build"/></div><p>The <code class="literal">app.js</code> file generated here is a minified JavaScript file that combines the code that you write with the Ext JS SDK. Enabling <code class="literal">app.js</code> is effective because the code has already been read and the Ext Loader does not need to read the code again, improving speed. This <code class="literal">app.js</code> file is generated in a compressed state that removes unnecessary new lines.</p><p>The <code class="literal">./build/production/MyApp/</code> directory was generated and stored. Let's check the generated production application with a browser.</p><p>If you want to debug, it's a very bad idea to compress <code class="literal">app.js</code>. Instead, you should execute the following command for testing:</p><div><pre class="programlisting">
<strong># sencha app build testing</strong>
</pre></div><p>The <code class="literal">testing</code> directory is then made in the same directory as <code class="literal">production</code> as shown in the following screenshot. The <code class="literal">app.js</code> file made under this directory is not compressed.</p><div><img src="img/5446OS_02_07.jpg" alt="Making production build"/></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec29"/>CT in individual views</h2></div></div></div><p>If you <a id="id50" class="indexterm"/>conduct a CT in the normal way, you will have to test all the components at the same time. However, if we split the CT into individual views, we can test each component individually in its own HTML.</p><p>First, we create a directory called <code class="literal">ct</code> and write HTML for the components lists. It is simply the <code class="literal">index.html</code> code in the source file: <code class="literal">03_ct_in_individual_views/ct/index.html</code>.</p><p>Here, you will make a header component. First let's create its appearance. You can make a <code class="literal">ct</code> directory for the <code class="literal">header</code> components as in the following screenshot:</p><div><img src="img/5446OS_02_08.jpg" alt="CT in individual views"/></div><p>Create <code class="literal">view.html</code> and <code class="literal">view.js</code> in the <code class="literal">header</code> file. The code is given as follows:</p><div><pre class="programlisting">view.html
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;title&gt;[View]Header - Component Test&lt;/title&gt;
&lt;link rel="stylesheet" href="../../bootstrap.css" type="text/css"&gt;
&lt;script language="JavaScript" type="text/javascript" src="img/ext-all.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script type="text/javascript" src="img/view.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

view.js
Ext.Loader.setConfig({
    enabled: true,
    paths: {
        MyApp: '../../app/'
    }
});

Ext.onReady(function() {
    Ext.create('MyApp.view.Header', {
        renderTo: Ext.getBody()
    });
});</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>View component</h2></div></div></div><p>Let's make <a id="id51" class="indexterm"/>the header component <code class="literal">MyApp.view.Header</code>. You should make the <code class="literal">Header.js</code> under the <code class="literal">app/view</code> directory and create the <code class="literal">Header</code> component (source file: <code class="literal">04_view_component/app/view/Header.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.view.Header', {
    extend: 'MyApp.toolbar.Toolbar',
    alias: 'widget.myapp-header',
    height: 35,
    items: [{
        text: 'MyApp',
        action: 'dashboard'
    }, '-&gt;', {
        text: 'MyAccount',
        action: 'myaccount'
    }, {
        text: 'Log Out',
        action: 'logout'
    }]
});</pre></div><p>When you create the <code class="literal">MyApp.toolbar.Toolbar</code> class, the panel component in <code class="literal">MyApp</code> will work. Therefore, make a panel directory under the <code class="literal">app</code> directory (source file: <code class="literal">04_view_component/app/toolbar/Toolbar.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.toolbar.Toolbar', {
    extend: 'Ext.toolbar.Toolbar'
});</pre></div><p>When you display it with a browser, the following screenshot will appear:</p><div><img src="img/5446OS_02_09.jpg" alt="View component"/></div><p>At this point, even if you click on the buttons, nothing will happen because you still need to implement the event handler; but don't worry, we'll get to that.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Adding controllers</h2></div></div></div><p>The <a id="id52" class="indexterm"/>appearance has been made. So now, let's add a controller. To do this, make <code class="literal">Abstract.js</code> under the <code class="literal">app/controller</code> directory, followed by the <code class="literal">MyApp.controller.Abstract</code> class (source file: <code class="literal">05_adding_controller/app/controller/Abstract.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.Abstract', {
    extend: 'Ext.app.Controller'
});</pre></div><p>Adding controllers is very simple, it merely extends to <code class="literal">Ext.app.Controller</code>. This class will implement all the common features for the controllers, which we will create from now on. So, let's make a controller for the header. Make <code class="literal">Header.js</code> in the same directory and define it as <code class="literal">MyApp.controller.Header</code>. In the following code, from the <code class="literal">MyApp.controller.Abstract</code> class, which we made some time ago, the <code class="literal">init</code> method is implemented (source file: <code class="literal">05_adding_controller/app/controller/Header.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.Header', {
    extend: 'MyApp.controller.Abstract',
    init: function() {
        var me = this;
        me.control({
            'myapp-header [action=dashboard]': {
                click: function() {
                    console.log('dashboard');
                }
            },
            'myapp-header [action=myaccount]': {
                click: function () {
                    console.log('myaccount');
                }
            },
            'myapp-header [action=logout]': {
                click: function() {
                    console.log('logout');
                }
            }
        });
    }
});</pre></div><p>The following <a id="id53" class="indexterm"/>are the component queries from the previous code. These acquire buttons located in header. With this, you have now finished making the controller.</p><div><pre class="programlisting">'myapp-header [action=dashboard]'
'myapp-header [action=myaccount]'
'myapp-header [action=logout]'</pre></div><p>A file should be created as shown in the following screenshot:</p><div><img src="img/5446OS_02_10.jpg" alt="Adding controllers"/></div><p>Let's make the CT operate the controller that you made successfully. In the directory, where you created <code class="literal">view.html</code> and <code class="literal">view.js</code>, you should now create <code class="literal">app.html</code> and <code class="literal">app.js</code>. The <code class="literal">app.html</code> CT is mostly the same as for <code class="literal">view.html</code>. You can see the source code here: <code class="literal">06_app_test/ct/header/app.html</code>.</p><p>For <code class="literal">app.js</code>, please see the following code (source file: <code class="literal">06_app_test/ct/header/app.js</code>).</p><div><pre class="programlisting">Ext.application({
    autoCreateViewport: false,
    name: 'MyApp',
    appFolder: '../../app',
    controllers: [
        'Header'
    ],
    launch: function() {
        var panel = Ext.create('MyApp.view.Header', {
            renderTo: Ext.getBody()
        });
        Ext.util.Observable.capture(panel, function() {
            console.log(arguments);
        });
    }
});</pre></div><p>You should add a link for <code class="literal">app.html</code> to <code class="literal">index.html</code> in the <code class="literal">ct</code> directory. In <code class="literal">app.js</code>, call <code class="literal">Ext.application</code> and<a id="id54" class="indexterm"/> start the application only for headers. Because the <code class="literal">autoCreateViewport</code> default value is set to <code class="literal">true</code>, you should set it to <code class="literal">false</code>. This is because <code class="literal">Viewport</code> is unnecessary for this test.</p><p>Second, set header to read <code class="literal">MyApp.controller.Header</code> in controllers. You should set the function to launch to create a view. The <code class="literal">Ext.util.Observable.capture</code> call captures the event that is fired in an object set in the first argument.</p><p>We can confirm visually that an event reacts when you click on the buttons.</p><div><img src="img/5446OS_02_11.jpg" alt="Adding controllers"/></div><p>We just made a view without a controller. The reason is if we create a relationship between the controller and the view at this stage, it would make it very difficult to test the view.</p><p>We made <code class="literal">app.html</code> that includes the controller logic. We need the <code class="literal">app.html</code> to be able to test the view and the controller at the same time.</p><p>In addition, to avoid incorrect code referring to a direct object, divide each component and each screen that you can put together in the CT and develop it in the viewport later.</p><p>Now, let's learn to create a component and a CT in sequence.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Creating views</h2></div></div></div><p>We need<a id="id55" class="indexterm"/> to create the appearance of the application. You already made the header. Let's put the navigation menu for the application on the left of the screen. Locate the header you made previously on the top of the screen. Name the screen that is in the center region but to the right. Put the screen in this center region.</p><p>The screen is divided into four sections:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Dashboard</li><li class="listitem" style="list-style-type: disc">MyAccount</li><li class="listitem" style="list-style-type: disc">Quotation</li><li class="listitem" style="list-style-type: disc">Bill</li></ul></div><p>Connect these four and make a rough view structure as shown in the following diagram:</p><div><img src="img/5446OS_02_12.jpg" alt="Creating views"/></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Navigation</h2></div></div></div><p>Let's make the <a id="id56" class="indexterm"/>navigation section. This component extends a tree panel. By using a tree panel, the procedure to display the menu options can be handled by the server, rather than inputting menu options manually. The process of dividing the menu options into groups can be made simpler.</p><p>A tree store is necessary for a tree panel. So let's make it now (source file: <code class="literal">07_creating_views/app/store/Navigation.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.store.Navigation', {
    extend: 'Ext.data.TreeStore',
    storeId: 'Navigation',
    root: {
        expanded: true,
        children: [{
            text: 'Dashboard',
            leaf: true
        }, {
            text: 'Quotation',
            leaf: true
        }, {
            text: 'Bill',
            leaf: true
        }, {
            text: 'MyAccount',
            leaf: true
        }]
    }
});</pre></div><p>Now that a <a id="id57" class="indexterm"/>store has been made, you can define the tree panel (source file: <code class="literal">07_creating_views/app/view/Navigation.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.view.Navigation', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.myapp-navigation',
    title: 'Navigation',
    store: 'Navigation',
    rootVisible: false,
    animate: false
});</pre></div><p>Now, let's create a CT to check what we made. The code for <code class="literal">07_creating_views/ct/navigation/view.html</code> is very similar to the previous <code class="literal">view.html</code> code, so please refer to the source file if you want to see this. The following code is for <code class="literal">view.js</code> (source file: <code class="literal">07_creating_views/ct/navigation/view.js</code>):</p><div><pre class="programlisting">Ext.onReady(function() {
    Ext.create('MyApp.store.Navigation', {
        storeId: 'Navigation'
    });
    Ext.create('MyApp.view.Navigation', {
    
    });
});</pre></div><p>We previously created <a id="id58" class="indexterm"/>a store because it is necessary to display the navigation view. The <strong>Navigation</strong> view is displayed like in the following screenshot when we see it in a browser:</p><div><img src="img/5446OS_02_13.jpg" alt="Navigation"/></div><p>Let's make the remaining components in the same way as follows.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec02"/>Dashboard</h3></div></div></div><p>We want to make a panel for dashboards (we will make many similar panels from now on). Therefore, the application will be made in the <code class="literal">MyApp.panel.Screen</code> abstract class. The <code class="literal">MyApp.panel.Screen</code> abstract class is the fundamental mold for the whole application (source file: <code class="literal">07_creating_views/app/panel/Screen.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.panel.Screen', {
    extend: 'Ext.panel.Panel',
    initComponent: function() {
        var me = this;
        me.callParent(arguments);
    }
});</pre></div><p>We were able to create the abstract class. Now, let's create a dashboard class that inherits from this abstract class (source file: <code class="literal">07_creating_views/app/view/DashBoard.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.view.DashBoard', {
    extend: 'MyApp.panel.Screen',
    alias: 'widget.myapp-dashboard'
});</pre></div><p>Now, prepare the CT to check the appearance. Both <code class="literal">07_creating_views/ct/dashboard/view.html</code> and <code class="literal">07_creating_views/ct/dashboard/view.js</code> are similar to <code class="literal">ct/header</code>, so please refer to the source files for the code.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec03"/>MyAccount</h3></div></div></div><p>Let's make the user's personal account page. Let's call this "MyAccount" and create it in the same way as we created the dashboard. Apart from the alias property and the title property, it's exactly the same as the dashboard. For the code, please see the source file: <code class="literal">07_creating_views/app/view/MyAcco</code>
<code class="literal">unt.js</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Quotation and bill</h3></div></div></div><p>Continue to make the quotation and bill in the same way. Again, besides the alias property and the title property, it's the same as the dashboard. Please see the source files for the code:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">07_creating_views/app/view/Quotation.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">07_creating_views/app/view/</code><code class="literal">Bill.js</code></li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Viewport</h2></div></div></div><p>Let's <a id="id59" class="indexterm"/>compose the component that we made so far in the viewport. Revise the file, which was already generated automatically by Sencha Cmd. Although we can make a CT by all means, with the viewport, the CT is unnecessary. HTML in itself is the same as the CT index.</p><p>First, it is necessary to revise <code class="literal">app/Application.js</code> to use the navigation store (source file: <code class="literal">08_create_viewport/app/Application.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.Application', {
    
    stores: [
        'Navigation'
    ]
});</pre></div><p>For the <code class="literal">xtype</code> classes that are set in the viewport, it is necessary for the reading of the source code to have been completed in advance. So we have added the class names to the <code class="literal">application.js</code> file.</p><p>To reflect the CSS of the newly added component, we'll build the application once with Sencha Cmd. This will make sure that the CSS of any new components are included in <code class="literal">sencha app build</code>.</p><p>With this, the component style that is being allotted to the <code class="literal">bootstrap.css</code> will be renewed. It is displayed as shown in the following screenshot when we access <code class="literal">index.html</code>, which<a id="id60" class="indexterm"/> is under a document route. The files that we made are read dynamically in the Ext Loader.</p><div><img src="img/5446OS_02_14.jpg" alt="Viewport"/></div><p>Now the views are complete!</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Creating controllers</h1></div></div></div><p>Now, we <a id="id61" class="indexterm"/>will create controllers for our data.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Main</h2></div></div></div><p>Usually,<a id="id62" class="indexterm"/> each <a id="id63" class="indexterm"/>view component has a corresponding controller class with the same prefix.</p><p>But the first controller we have to deal with is the controller called Main. This controller has already been produced automatically in Sencha Cmd. If we need more processing or logic for the whole application, we should implement this class. Usually, the <code class="literal">view</code> class and controller class names match, but this is a special case where they do not because Sencha Cmd generates the Main class. So, it is best to leave it as is and not change the name.</p><p>For the <code class="literal">app/controller/Main.js</code> code, please see the source file: <code class="literal">09_create_controller\app\controller</code>.</p><p>Although we've talked a lot about Main, we are not going to use it for the time being.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Navigation</h2></div></div></div><p>Now, <a id="id64" class="indexterm"/>let's <a id="id65" class="indexterm"/>add <code class="literal">hrefTarget</code> to the data in the navigation store (source file: <code class="literal">09_create_controller/app/store/Navigation.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.store.Navigation', {
    …
    root: {
        children: [{
            text: 'Dashboard',
            hrefTarget: '#!/dashboard',
            leaf: true
        }, {
            text: 'Quotation',
            hrefTarget: '#!/quotation',
            leaf: true
        }, {
            text: 'Bill',
            hrefTarget: '#!/bill',
            leaf: true
        }, {
            text: 'MyAccount',
            hrefTarget: '#!/myaccount',
            leaf: true
        }]
    }
});</pre></div><p>Now, make a<a id="id66" class="indexterm"/> navigation controller<a id="id67" class="indexterm"/> and describe the <code class="literal">itemclick</code> event handler and catch an event when a menu is chosen (source file: <code class="literal">09_create_controller/app/controller/Navigation.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.Navigation', {
    extend: 'MyApp.controller.Abstract',
    init: function() {
        var me = this;
        me.control({
            'myapp-navigation': {
                itemclick: function(row, model) {
                    if (!model.isLeaf()) {
                        if (model.isExpanded()) {
                            model.collapse();
                        } else {
                            model.expand();
                        }
                    } else {
                        if (model.data.hrefTarget) {
                            console.log('select:' + model.data.
                            hrefTarget);
                        }
                    }
                }
            }
        });
    }
});</pre></div><p>Add this to <code class="literal">app/Application.js</code> so that it is used when we display it in the viewport.</p><div><pre class="programlisting">Ext.define('MyApp.Application', {
    
    controllers: [
        'Main',
        'Header',
        'Navigation',
        'DashBoard',
        'MyAccount',
        'Quotation',
        'Bill'
    ],
    
});</pre></div><p>Furthermore, remember that the CT prepares to operate from the controller on its own. The following code <a id="id68" class="indexterm"/>will execute the CT for navigation (source code: <code class="literal">09_create_controller/ct/navigation/app.js</code>).</p><div><pre class="programlisting">Ext.application({
    ...
    stores: [
        'Navigation'
    ],
    controllers: [
        'Navigation'
    ],
    launch: function() {
        var panel = Ext.create('MyApp.view.Navigation', {
            width: 300,
            height: 600,
            renderTo: Ext.getBody()
        });
        Ext.util.Observable.capture(panel, function() {
            console.log(arguments);
        });
    }
});</pre></div><p>When we perform <a id="id69" class="indexterm"/>this, a message is displayed by the console when we select any option from the menu.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Dashboard</h2></div></div></div><p>Let's <a id="id70" class="indexterm"/>continue <a id="id71" class="indexterm"/>now and create the controller for dashboard. We do not describe any special process here, it is just preparation. Just implement the following code (source file: <code class="literal">09_create_controller/app/controller/DashBoard.js</code>):</p><div><pre class="programlisting">Ext.define('MyApp.controller.DashBoard', {
    extend: 'MyApp.controller.Abstract',
    init: function() {
        var me = this;
        me.control({
        });
    }
});</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec38"/>MyAccount</h2></div></div></div><p>MyAccount<a id="id72" class="indexterm"/> is <a id="id73" class="indexterm"/>the same as dashboard, just replace <code class="literal">Dashboard</code> with <code class="literal">MyAccount</code>. For the code, please see the source file: <code class="literal">09_create_controller/app/controller/M</code>
<code class="literal">yAccount.js</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Quotation and bill</h2></div></div></div><p>It's the same for the <a id="id74" class="indexterm"/>quotation and bill<a id="id75" class="indexterm"/>. No special processing, just preparation, whichare also the same as the dashboard. For the code, please see the source file at the following locations:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">09_create_controller/app/controller/Quotation.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">09_create_controller/app/cont</code><code class="literal">roller/Bill.js</code></li></ul></div><p>At this point, you have made many files. As we created them, they filled the directory as shown in the following screenshot:</p><div><img src="img/5446OS_02_15.jpg" alt="Quotation and bill"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Using Ext.util.History for directly accessing a screen</h1></div></div></div><p><code class="literal">Ext.util.History</code><a id="id76" class="indexterm"/> manages the history. When a page changes, the <a id="id77" class="indexterm"/>application catches this change and then the <code class="literal">Ext.util.History</code> fires an event. Using this feature, we can control actions in our application.. For example, by using <code class="literal">Ext.util.History</code>, every time the application is accessed the dashboard URL is displayed.</p><p>Sometimes, when the user inputs an incorrect hash in the URL, the application will have trouble finding the page. However, with <code class="literal">Ext.util.History</code>, it goes to screens specified by the developer. For example, when we implement <code class="literal">Ext.util.History</code>, the user can access the quotation page directly without abnormal screen behavior. With <code class="literal">Ext.util.History</code>, it also allows us to attach the URL to an e-mail to access documents directly.</p><p>To begin with, you need to make the <code class="literal">MyApp.util.History</code> class<a id="id78" class="indexterm"/>. You might think it is an abstract class when you set eyes on it, actually, it is different. <code class="literal">MyApp.util.History</code> is a class used to incorporate URL control in our application using <code class="literal">Ext.util.History</code>. Be careful to not make a mistake here or <code class="literal">MyApp.util.History</code> will not work. The <code class="literal">Ext.util.History</code> class is a singleton class and <code class="literal">MyApp.util.History</code> will make a singleton class too. First, let's make the <code class="literal">MyApp.util.History</code> class. It is very simple (source file: <code class="literal">10_util_history/app/util/History.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.util.History', {
    singleton: true,
    uses: ['Ext.util.History'],
    controllers: {},
    init: ... (implement)
    initNavigate: ... (implement)
    navigate: ... (implement)
    parseToken: ... (implement)
    push ... (implement)
    cleanUrl ... (implement)
    back: ... (implement)
    location: ... (implement)
});</pre></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p><strong>Downloading the example code</strong></p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>Let's implement the methods by implementing the following list:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">init</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">initNavigate</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">navigate</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">parseToken</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">push</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">cleanUrl</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">back</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">location</code></li></ul></div><p>Please implement them as a method of the <code class="literal">MyApp.util.History</code> class (source file: <code class="literal">10_util_history/app/util/History.js</code>). The code for the implementation of this list is too long to include in this text, so please refer to the source file for the code.</p><p>When we<a id="id79" class="indexterm"/> use <code class="literal">MyApp.util.History</code>, we have to call the <code class="literal">init</code> method. I will describe the usage of the <code class="literal">init</code> method later. We do not need too much explanation about these methods, as this will take too long. The important thing to know is that these methods are important for browser navigation.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Adding logic to the controller</h2></div></div></div><p>Add <code class="literal">MyApp.util.History</code> and<a id="id80" class="indexterm"/> a constructor to <code class="literal">MyApp.controller.Abstract</code> (source file: <code class="literal">11_adding_controller/app/controller/Abstract.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.Abstract', {
    extend: 'Ext.app.Controller',
    uses: ['MyApp.util.History'],
    aliasPrefix: 'myapp-',
    constructor: function() {
        var me = this,
            screenName = me.screenName;

        Ext.apply(me, {
            history: MyApp.util.History
        });
        if (screenName) {
            me.history.controllers[screenName] = me;
            me.baseUrl = '#!/' + screenName;
            me.aliasName = me.aliasPrefix + screenName;
        }
        me.callParent(arguments);
    },
    loadIndex: function(url) {
        var me = this, url = url || me.baseUrl;
        if (url.substr(0, 2) !== '#!') {
            url = me.baseUrl + '/' + url;
        }
        me.history.push(url, {
            navigate: true,
            callback: function() {
                var self = Ext.ComponentQuery.query(me.aliasName)[0];
                self.fireEvent('myapp-show', self);
            }
        });
    },
    init: function() {
        var me = this, o = {};
        o[me.aliasName] = {
            'myapp-show': me.onShow,
            'myapp-hide': me.onHide
        };
        me.control(o);
    },
    onShow: function() {
        // Nothing todo
    },
    onHide: function() {
        // Nothing todo
    }
});</pre></div><p>Set an <a id="id81" class="indexterm"/>anonymity function called <code class="literal">MyApp.util.History.init</code>, which we made previously, and initialize it to launch. Specify the screen to use with the sequence in an argument (source file: <code class="literal">11_adding_controller/app/Application.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.Application', {
    
    stores: [
        'Navigation'
    ],

    screens: [
        'dashboard',
        'myaccount',
        'quotation',
        'bill'
    ],
    launch: function() {
        MyApp.util.History.init({
            screens: this.screens
        });
    }
});</pre></div><p>Afterwards, add the <code class="literal">screenName</code> property to each class (source file: <code class="literal">11_adding_controller/app/controller/DashBoard.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.DashBoard', {
    extend: 'MyApp.controller.Abstract',
    screenName: 'dashboard',
    
});</pre></div><p>In the same<a id="id82" class="indexterm"/> way as with the dashboard, we'll add a <code class="literal">screenName</code> property to MyAccount, Quotation, and Bill. Check the source file for the code:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/controller/MyAccount.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/controller/Quotation.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/controller/Bill.js</code></li></ul></div><p>Fix the navigation controller. We should change the locale by removing the console and changing the call to the location method in <code class="literal">MyApp.util.History</code> (source file: <code class="literal">11_adding_controller/app/controller/Navigation.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.controller.Navigation', {
    extend: 'MyApp.controller.Abstract',
    init: function() {
        var me = this;
        me.control({
            'myapp-navigation': {
                itemclick: function(row, model) {
                    …
                        if (model.data.hrefTarget) {
                            console.log('select:' + model.data.                 
                            hrefTarget);
                            me.history.location(model.data.
                            hrefTarget);
                        }
    
});</pre></div><p>Finally, if we make a distinction between each view, it becomes easier to acquire that view. So let's add <code class="literal">itemId</code> to each view. First, let's add it to the dashboard (source file: <code class="literal">11_adding_controller/app/view/DashBoard.js</code>).</p><div><pre class="programlisting">Ext.define('MyApp.view.DashBoard', {
    …
    itemId: 'screen-dashboard',
    title: 'DashBoard'
});</pre></div><p>Again, let's add<a id="id83" class="indexterm"/> the <code class="literal">itemId</code> in the same way for MyAccount, Quotation, and Bill. Check the following source files for the code:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/view/MyAccount.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/view/Quotation.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">11_adding_controller/app/view/Bill.js</code></li></ul></div><p>So to confirm, we should see the URL with the added hash when we click on the navigation menu after we have set it up with <code class="literal">init</code>.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">#!/dashboard</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">#!/quotation</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">#!/bill</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">#!/myaccount</code></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Setting up Ext Direct</h1></div></div></div><p>This is the <a id="id84" class="indexterm"/>last in the long list of preparations. Most Sencha Ext JS applications communicate with a server and acquire data and transmit a message. In that case, it is very simple and easy to communicate with the <code class="literal">Ext.Ajax</code> class.</p><p>However, let's use Ext Direct this time. Ext Direct performs by wrapping Ajax communications, polling, and performing a <a id="id85" class="indexterm"/>
<strong>Remote Procedure Call</strong> (<strong>RPC</strong>).</p><p>RPC is the main feature of Ext Direct. However, I will not discuss it in detail here because of lack of space. If you wish to know the specifics, please visit the Sencha homepage at <a class="ulink" href="http://www.sencha.com/products/extjs/extdirect">http://www.sencha.com/products/extjs/extdirect</a>.</p><p>Ext Direct simplifies the communication with the server. As a result, JavaScript code decreases. Also, in addition to the reading and burden on browsers being reduced, communication is optimized automatically by a combined request function.</p><p>When we simultaneously perform Ajax communication with an initial value via Ext Direct in an interval of 10 milliseconds, we can combine the requests to the router into one communication. But for us, it is the same as us communicating each request separately.</p><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>This is still not common knowledge among a lot of developers, especially those who do not know about the benefits of Ext Direct. It is a shame because this is such a convenient feature to have in your application.</p><p>It does take a lot of preparation in the beginning. However, the development of future Sencha Ext JS will become simpler if we learn it here and keep it prepared and available, like a template.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Creating the Ext Direct router</h2></div></div></div><p>First we need<a id="id86" class="indexterm"/> to make the router and implement it in PHP from here. In fact, the router is implemented in a sample. We only locate it and use it for it to start. To begin, copy the PHP from the sample page. You can find the sample page in your Ext SDK path followed by <code class="literal">/examples/direct/</code>. In other words. it's <code class="literal">(Ext SDK path)/examples/direct/</code>.</p><div><img src="img/5446OS_02_16.jpg" alt="Creating the Ext Direct router"/></div><p>Create a folder called <code class="literal">php</code> in the document route and copy the four files shown in the previous screenshot. After we have copied the files, it is acceptable to delete them from this path.</p><p>Edit <code class="literal">config.php</code> and define the method as the class shown on the server side. There are so many interfaces in the original, but this time, we will use only one. So let's delete the others to keep things manageable (source file: <code class="literal">12_setup_ext_direct/php/config.php</code>).</p><div><pre class="programlisting">&lt;?php
$API = array(
    'TestAction' =&gt; array(
        'methods' =&gt; array(
            'doEcho' =&gt; array(
                'len' =&gt; 1
            )
        )
    )
);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Creating the Ext Direct module</h2></div></div></div><p>In the<a id="id87" class="indexterm"/> same way as we did previously, we'll only use the <code class="literal">doEcho</code> method in the <code class="literal">TestAction</code> class. So, let's delete the other methods to keep everything manageable (source file: <code class="literal">12_setup_ext_direct/php/classes/TestAction.php</code>).</p><div><pre class="programlisting">&lt;?php
class TestAction {
    function doEcho($data) {
        return $data;
    }
}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Applying Ext Direct to the client application</h2></div></div></div><p>Now, set<a id="id88" class="indexterm"/> the client application to immediately call <code class="literal">TestAction.doEcho</code> from the client side by adding the following source code in <code class="literal">index.html</code> (source file: <code class="literal">12_setup_ext_direct/index.html</code>).</p><div><pre class="programlisting">    ...
&lt;!-- &lt;/x-compile&gt; --&gt;
&lt;script src="img/api.php"&gt;&lt;/script&gt;
&lt;/head&gt;</pre></div><p>Next, call <code class="literal">addProvider</code> and set it to use a member shown in the server side in <code class="literal">Application.js</code> (source file: <code class="literal">12_setup_ext_direct/app/Application.js</code>).</p><div><pre class="programlisting">Ext.require([
    'Ext.direct.*',
    'Ext.data.proxy.Direct',
    'Ext.form.action.DirectSubmit'
]);

Ext.onReady(function() {
    Ext.direct.Manager.addProvider(Ext.app.REMOTING_API);
});

Ext.define('MyApp.Application', {</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Testing Ext Direct</h2></div></div></div><p>Now <a id="id89" class="indexterm"/>we can test it. When a logout button is clicked, call <code class="literal">doEcho</code> and confirm whether it works normally. Then, add the processing to the header controller.</p><p>Check the performance with a browser. When we click on the logout button, the character string <code class="literal">message</code> already in the code will be sent to the server side. We can then check to see if <code class="literal">message</code> comes back to the client side. If it comes back successfully, everything is good! For reference, please check the source file: <code class="literal">12_setup_ext_direct/app/controller/Header.js</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Summary</h1></div></div></div><p>Good work! We are now ready to develop the application. It was very long, but remember, it only takes a long time to complete the initial preparations.</p><p>From now on, you can use what you did here in the future. If you go over what we have just done and understand it for yourself, you can use this as a template for future projects and it will make the preparation stage go a lot faster and smoother.</p><p>When you're ready, continue to the next chapter in which we'll begin to input data into our database.</p></div></body></html>