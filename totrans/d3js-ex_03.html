<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Creating Visuals with SVG"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Creating Visuals with SVG</h1></div></div></div><p>In this chapter, we will learn about <span class="strong"><strong>Scalable Vector Graphics</strong></span>, commonly referred to as <span class="strong"><strong>SVG</strong></span>. SVG is a <a id="id128" class="indexterm"/>web standard for creating vector-based graphics within the browser. We will begin the chapter with several basic examples of directly coding SVG within the browser, and in the end, examine how to use D3 to create SVG elements based on data.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A brief introduction to SVG, coordinates, and attributes</li><li class="listitem" style="list-style-type: disc">A simple example of SVG that draws circles</li><li class="listitem" style="list-style-type: disc">Working with fundamental shapes: ellipses, rectangles, lines, and paths</li><li class="listitem" style="list-style-type: disc">The relationship of CSS with SVG and D3.js</li><li class="listitem" style="list-style-type: disc">Using strokes, line caps, and dashes</li><li class="listitem" style="list-style-type: disc">Fundamental transformations: rotate, translate, and scale</li><li class="listitem" style="list-style-type: disc">Grouping SVG elements and uniformly applying transforms</li><li class="listitem" style="list-style-type: disc">Transparency and layering of SVG elements</li></ul></div><div class="section" title="Introducing SVG"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec17"/>Introducing SVG</h1></div></div></div><p>Up to this point, we have used D3 to create new DIV elements in the DOM. While many great visualizations can be created using D3 and DIVs, the true expressive power of D3 lies in using it to create and manipulate SVG elements.</p><p>SVG is an XML markup language that has been designed to express very rich 2D visualizations. SVG can take advantage of the computer's graphics processor to accelerate rendering, and is also optimized for user interaction and animation.</p><p>Instead of directly manipulating the pixels on the screen, SVG uses vectors for building a model of the presentation, and then transforms this representation into pixels on your behalf. This makes coding of visualizations much simpler as compared to other web technologies such as HTML5 Canvas.</p><p>Since the image is<a id="id129" class="indexterm"/> stored as a vector-based representation, the visualization of the model can be scalable. This is because all the visual elements can be easily scaled (both larger and smaller) without resulting in visual artifacts as a result of the scaling.</p><p>SVG has a convenience in that its language can be used directly within HTML on browsers that support SVG. D3 provides direct support and manipulation of SVG with D3, which feels exactly like manipulating the DOM with D3.</p><div class="section" title="The SVG coordinate system"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>The SVG coordinate system</h2></div></div></div><p>The coordinate <a id="id130" class="indexterm"/>system of SVG has an origin in the upper-left corner of the SVG element, which is (<span class="strong"><strong>0,0</strong></span>); the value of <span class="emphasis"><em>x</em></span> increases towards the right, while those of <span class="emphasis"><em>y</em></span> increase towards the bottom. This is common in computer graphics systems, but can occasionally be confusing for those used to mathematical graphs where the origin is in the lower-left or dead center.</p><div class="mediaobject"><img src="graphics/B04230_03_01.jpg" alt="The SVG coordinate system"/></div></div><div class="section" title="SVG attributes"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>SVG attributes</h2></div></div></div><p>SVG, while being able to seamlessly integrate with HTML, is not HTML. Specifically, properties and <a id="id131" class="indexterm"/>styles may operate differently. An example of this is that where most HTML elements have width and height elements, but not all SVG elements use these properties.</p><p>A second important point about SVG is that the position of an element is set through attributes. Due to this, it is not possible to set the position of the SVG elements using a style. Additionally, to change the position of an SVG element, such as within an animation, it is necessary to have code which sets the properties for positioning the element.</p></div><div class="section" title="Drawing circles with SVG"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>Drawing circles with SVG</h2></div></div></div><p>We work with <a id="id132" class="indexterm"/>SVG within HTML by using an SVG tag, and placing<a id="id133" class="indexterm"/> the SVG elements within that tag. A very simple example is the following, which creates three circles:</p><div class="informalexample"><pre class="programlisting">&lt;svg width="720" height="120"&gt;
    &lt;circle cx="40" cy="20" r="10"&gt;&lt;/circle&gt;
    &lt;circle cx="80" cy="40" r="15"&gt;&lt;/circle&gt;
    &lt;circle cx="120" cy="60" r="20"&gt;&lt;/circle&gt;
&lt;/svg&gt;</pre></div><p>This results in the following image within the browser:</p><div class="mediaobject"><img src="graphics/B04230_03_02.jpg" alt="Drawing circles with SVG"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note31"/>Note</h3><p>bl.ock (3.1): <a class="ulink" href="http://goo.gl/UMCLtl">http://goo.gl/UMCLtl</a>
</p></div></div><p>The SVG element itself is not visible on the page, and only provides a holder for the child tags. In this book, we will always explicitly set the width and heights of the SVG tag. In this example, it is set to be <code class="literal">720</code> pixels wide by <code class="literal">120</code> pixels tall.</p><p>The positioning of a circle within an SVG element is performed by specifying the center <code class="literal">x</code> and <code class="literal">y</code> values of the circle. This location is relative to the upper-left corner of the SVG element, with positive <code class="literal">x</code> values moving to the right from the origin, and positive <code class="literal">y</code> values moving downwards. The size of the circle is specified by the <code class="literal">r</code> attribute, which indicates the radius of the circle.</p><p>The example did not specify a color for these circles, so the default color of the circles is black. Most SVG elements specify the color by using the CSS style attribute, and then by setting the <code class="literal">fill</code> attribute of the style.</p><p>For example, the following code gives different colors (red, green and blue) to the three circles:</p><div class="informalexample"><pre class="programlisting">&lt;svg width="720" height="120"&gt;
  &lt;circle cx="40" cy="20" r="10" style="fill:red"&gt;&lt;/circle&gt;
  &lt;circle cx="80" cy="40" r="15" style="fill:green"&gt;&lt;/circle&gt;
  &lt;circle cx="120" cy="60" r="20" style="fill:blue"&gt;&lt;/circle&gt;
&lt;/svg&gt;</pre></div><p>This results in the following output:</p><div class="mediaobject"><img src="graphics/B04230_03_03.jpg" alt="Drawing circles with SVG"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>bl.ock (3.2): <a class="ulink" href="http://goo.gl/2k1ZIm">http://goo.gl/2k1ZIm</a>
</p></div></div><p>D3 selections<a id="id134" class="indexterm"/> work identically with SVG elements as they do with the <a id="id135" class="indexterm"/>DOM elements. As a quick example, the following selects all the circles within the selected <code class="literal">svg</code> tag, and sets their colors to a uniform <code class="literal">teal</code> color.</p><div class="informalexample"><pre class="programlisting">&lt;svg width="720" height="120"&gt;
  &lt;circle cx="40" cy="20" r="10" style="fill:red"&gt;&lt;/circle&gt;
  &lt;circle cx="80" cy="40" r="15" style="fill:green"&gt;&lt;/circle&gt;
  &lt;circle cx="120" cy="60" r="20" style="fill:blue"&gt;&lt;/circle&gt;
&lt;/svg&gt;
&lt;script&gt;
  d3.selectAll('circle').style('fill', 'teal');
&lt;/script&gt;</pre></div><p>This results in the following output within the browser:</p><div class="mediaobject"><img src="graphics/B04230_03_04.jpg" alt="Drawing circles with SVG"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>bl.ock (3.3): <a class="ulink" href="http://goo.gl/bszmEf">http://goo.gl/bszmEf</a>
</p></div></div></div></div></div>
<div class="section" title="The basic shapes provided by SVG"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec18"/>The basic shapes provided by SVG</h1></div></div></div><p>Having some<a id="id136" class="indexterm"/> preliminaries out of the way, let's now examine the various SVG shapes that we will commonly use through the book. We have already seen how to create a <a id="id137" class="indexterm"/>circle; now let's look at some other shapes.</p><div class="section" title="Ellipse"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec20"/>Ellipse</h2></div></div></div><p>A circle is<a id="id138" class="indexterm"/> a special case of an ellipse that has an identical <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> radii. Ellipses <a id="id139" class="indexterm"/>can and often have different size radii. An ellipse is specified in SVG using the <code class="literal">&lt;ellipse&gt;</code> tag. We still use <code class="literal">cx</code> and <code class="literal">cy</code> attributes to position the ellipse, but instead of using <code class="literal">r</code> for radius, we use two attributes <code class="literal">rx</code> and <code class="literal">ry</code> to specify the radius in the x and y directions:</p><div class="informalexample"><pre class="programlisting">&lt;ellipse cx="50" cy="30" rx="40" ry="20" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_05.jpg" alt="Ellipse"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>bl.ock (3.4): <a class="ulink" href="http://goo.gl/05QCnG">http://goo.gl/05QCnG</a>
</p></div></div></div><div class="section" title="Rectangle"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>Rectangle</h2></div></div></div><p>Rectangles<a id="id140" class="indexterm"/> are specified using the <code class="literal">&lt;rect&gt;</code> tag. The upper-left corner<a id="id141" class="indexterm"/> is specified using the <code class="literal">x</code> and <code class="literal">y</code> attributes. The <code class="literal">width</code> and <code class="literal">height</code> attributes specify those respective sizes for the rectangle:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="10" y="10" width="150" height="100"&gt;&lt;/rect&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_06.jpg" alt="Rectangle"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>bl.ock (3.5): <a class="ulink" href="http://goo.gl/b3w1Rq">http://goo.gl/b3w1Rq</a>
</p></div></div></div><div class="section" title="Lines"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>Lines</h2></div></div></div><p>It is possible to draw <a id="id142" class="indexterm"/>lines with SVG using the <code class="literal">&lt;line&gt;</code> tag. A line requires at least<a id="id143" class="indexterm"/> four attributes to be specified, and normally uses five. The first two, <code class="literal">x1</code> and <code class="literal">y1</code>, specify the starting position of the line. Two more attributes, <code class="literal">x2</code> and <code class="literal">y2</code>, specify the end point for the line. The last property, albeit not required, is <code class="literal">stroke</code>, which specifies the color to be used to draw the line. Usually, we must specify the stroke to actually see the line. Here we set it to <code class="literal">black</code>.</p><div class="informalexample"><pre class="programlisting">&lt;line x1="10" y1="10" x2="100" y2="100" stroke="black" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_07.jpg" alt="Lines"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>bl.ock (3.6): <a class="ulink" href="http://goo.gl/4qZejC">http://goo.gl/4qZejC</a>
</p></div></div></div><div class="section" title="Paths"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>Paths</h2></div></div></div><p>Paths are <a id="id144" class="indexterm"/>one of the most powerful drawing constructs in SVG. They provide a<a id="id145" class="indexterm"/> symbolic notion that can be used to create many geometries. A path can be shapes such as circles and rectangles. Paths also provide the user the ability to create curves using control points.</p><p>The drawing of the path is controlled by specifying one attribute, <code class="literal">d</code>, which is passed a string that specifies drawing commands that will be executed.</p><p>The basic concept of a path is that you can draw a series of either straight or curved lines, and then have the option of filling the space inside if the shape is closed. For example, the following command creates a triangle filled with black color:</p><div class="informalexample"><pre class="programlisting">&lt;path d="M 10 10 L 310 20 L 160 110 Z"/&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_08.jpg" alt="Paths"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>bl.ock (3.7): <a class="ulink" href="http://goo.gl/kCTbv7">http://goo.gl/kCTbv7</a>
</p></div></div><p>A path usually <a id="id146" class="indexterm"/>starts with an <code class="literal">M</code> command, which starts drawing at that <a id="id147" class="indexterm"/>specific location, in this case (<code class="literal">10, 10</code>). The next command, <code class="literal">L 310 10</code>, draws a from the previous point to (<code class="literal">310, 10</code>). The next command, <code class="literal">L 160 10</code>, then draws a line from (<code class="literal">310, 10</code>) to (<code class="literal">160, 10</code>). The final command is <code class="literal">Z</code>, which tells SVG that the shape is closed. Essentially, this informs SVG that there is an implicit line to the first position in the string of commands, in this case (<code class="literal">10, 10</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>Note that we did not specify a fill or stroke color. These default to black in a path.</p></div></div><p>The mini-language for paths is quite robust, and therefore, also complex. The following table lists several<a id="id148" class="indexterm"/> other common path commands:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Command</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">M</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Move-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">L</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Line-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">H</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Horizontal line-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">V</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Veritcal line-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">C</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Curve-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Q</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Quadractic Bezier curve-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">T</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Smooth quadratic Bezier curve-to</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">A</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Elliptical arc</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Z</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Close path</p>
</td></tr></tbody></table></div><p>D3 provides a number of tools to facilitate the use of paths that make them much simpler to use <a id="id149" class="indexterm"/>compared to manually specifying them with string literals. We will <a id="id150" class="indexterm"/>examine a few of those later in the chapter.</p></div><div class="section" title="Text"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec24"/>Text</h2></div></div></div><p>The <code class="literal">&lt;text&gt;</code> SVG tag<a id="id151" class="indexterm"/> allows us to place text within the SVG element. The <a id="id152" class="indexterm"/>placing of text within an SVG is different than the way it is done in HTML. The SVG text items are drawn with vector graphics instead of being rasterized. Hence, text rendered in SVG is more flexible than the rasterized text rendered with HTML. Curves in letters rendered with SVG remain smooth instead of becoming pixelated when zoom levels are applied to the entire graphic.</p><p>Text is positioned using the <code class="literal">x</code> and <code class="literal">y</code> attributes, which specify the <span class="strong"><strong>baseline</strong></span> of the text be located at <code class="literal">y</code> and the text to be left-justified to <code class="literal">x</code>, the bottom baseline of the text (the portion at the bottom of the main part of the letters, excluding the descenders) left of the text being the anchor of the positioning.</p><p>This is demonstrated by the following, which also sets the font family, size and fill color. The actual text to be displayed is set with the inner text content of the tag:</p><div class="informalexample"><pre class="programlisting">&lt;text x="10" y="20" 
      fill="Red" font-family="arial" font-size="16"&gt;
  Content of the SVG text
&lt;/text&gt;</pre></div><p>Which renders the following in the upper-left side of the SVG element:</p><div class="mediaobject"><img src="graphics/B04230_03_09.jpg" alt="Text"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>bl.ock (3.8): <a class="ulink" href="http://goo.gl/f89tZX">http://goo.gl/f89tZX</a>
</p></div></div></div></div>
<div class="section" title="Applying CSS styles to SVG elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Applying CSS styles to SVG elements</h1></div></div></div><p>SVG elements<a id="id153" class="indexterm"/> can be styled identically to the way HTML<a id="id154" class="indexterm"/> elements are styled. The same CSS with ID and class attributes can be used to direct styles to the SVG elements, or you can just use the style attribute directly and specify CSS as its content. However, many of the actual styles in HTML differ in SVG. For example, SVG uses <code class="literal">fill</code> for a rectangle, whereas HTML would use background for a <code class="literal">div</code> tag that represents a rectangle.</p><p>In this book, we will generally try to avoid using CSS, and explicitly code the style attributes using the functions provided by D3.js. But many examples on the web do use CSS combined with SVG, so it is worth a quick mention.</p><p>The following <a id="id155" class="indexterm"/>example demonstrates styling SVG<a id="id156" class="indexterm"/> with CSS. The example uses two styles to set the fills of several rectangles. The first style will make all the rectangles red by default. The second one defines a style that makes all the rectangles with ID <code class="literal">willBeGreen</code> filled with green color. The example then creates three rectangles: the first two using the CSS styles, and the third using CSS within the style <code class="literal">attributeset</code> as fill to <code class="literal">blue</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>bl.ock (3.9): <a class="ulink" href="http://goo.gl/KAnc6j">http://goo.gl/KAnc6j</a>
</p></div></div><p>The styles defined in the sample are the following:</p><div class="informalexample"><pre class="programlisting">&lt;style&gt;
    svg rect { fill: red; }
    svg rect#willBeGreen { fill: green; }
&lt;/style&gt;</pre></div><p>And the rectangles are created as follows:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="10" y="10" width="50" height="50" /&gt;
&lt;rect x="70" y="10" width="50" height="50" id="willBeGreen" /&gt;
&lt;rect x="130" y="10" width="50" height="50" style="fill:blue" /&gt;</pre></div><p>The resulting output will be as shown in the following image:</p><div class="mediaobject"><img src="graphics/B04230_03_10.jpg" alt="Applying CSS styles to SVG elements"/></div></div>
<div class="section" title="Strokes, caps, and dashes"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Strokes, caps, and dashes</h1></div></div></div><p>SVG shapes<a id="id157" class="indexterm"/> have an attribute known as <code class="literal">stroke</code>. The attribute <code class="literal">stroke</code> specifies the <a id="id158" class="indexterm"/>color of a line that outlines an SVG shape. We saw the use of stroke <a id="id159" class="indexterm"/>with a line, but it can be used with most of the SVG elements.</p><p>Whenever we specify <code class="literal">stroke</code>, we usually also specify a stroke width using the <code class="literal">stroke-width</code> attribute. This informs SVG about the thickness (in pixels) of the outline that will be rendered.</p><p>To demonstrate <a id="id160" class="indexterm"/>
<code class="literal">stroke</code> and <code class="literal">stroke-width</code> attributes, the following example recreates<a id="id161" class="indexterm"/> the path from the path example, and sets a stroke to be <code class="literal">10</code> pixels <a id="id162" class="indexterm"/>thick, using <code class="literal">red</code> as its color. Additionally, we set the <code class="literal">fill</code> of the path to <code class="literal">blue</code>. We set all the attributes using the <code class="literal">style</code> property of <code class="literal">stroke</code>:</p><div class="informalexample"><pre class="programlisting">&lt;path d="M 10 10 L 210 10 L 110 120 z"
      style="fill:blue;stroke:red;stroke-width:5" /&gt;</pre></div><p>The preceding example results in the following rendering:</p><div class="mediaobject"><img src="graphics/B04230_03_11.jpg" alt="Strokes, caps, and dashes"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>bl.ock (3.10): <a class="ulink" href="http://goo.gl/dMjdUX">http://goo.gl/dMjdUX</a>
</p></div></div><p>As we saw earlier, we can set stroke on a line. It can also have its <code class="literal">stroke-width</code> set. Let's examine this by changing our line example to set the thickness of the line to <code class="literal">20</code> and the color to <code class="literal">green</code>:</p><div class="informalexample"><pre class="programlisting">&lt;line x1="10" y1="10" x2="110" y2="110" 
      stroke="green" stroke-width="20" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_12.jpg" alt="Strokes, caps, and dashes"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>bl.ock (3.11): <a class="ulink" href="http://goo.gl/p880dC">http://goo.gl/p880dC</a>
</p></div></div><p>Notice how this line actually looks like a rectangle. This is because lines have an attribute named <code class="literal">stroke-linecap</code> which describes the shape of the end of the line, known as the line cap.</p><p>The default for this<a id="id163" class="indexterm"/> value is <code class="literal">butt</code>, which gives us the 90 degree sharp corners. The<a id="id164" class="indexterm"/> other values that can be used are <code class="literal">square</code> or <code class="literal">round</code>. The following<a id="id165" class="indexterm"/> example demonstrates the same line with all these different <code class="literal">stroke-linecap</code> values:</p><div class="informalexample"><pre class="programlisting">&lt;line x1="10" y1="20" x2="110" y2="100"
        stroke="red" stroke-width="20" stroke-linecap="butt" /&gt;
&lt;line x1="60" y1="20" x2="160" y2="100"
      stroke="green" stroke-width="20" stroke-linecap="square" /&gt;
&lt;line x1="110" y1="20" x2="210" y2="100"
      stroke="blue" stroke-width="20" stroke-linecap="round" /&gt;
&lt;path d="M 10 20 L 110 100 M 60 20 L 160 100 M 110 20 L 210 100"
        stroke="white" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_13.jpg" alt="Strokes, caps, and dashes"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>bl.ock (3.12): <a class="ulink" href="http://goo.gl/Xcaz41">http://goo.gl/Xcaz41</a>
</p></div></div><p>Note that for each of the three lines, we drew a line with a <code class="literal">stroke-width</code> of <code class="literal">20</code>, and then within each line, we drew a white line using a single path with three move and line commands. The white line helps in distinguishing the effect of the end caps on the lines.</p><p>First examine the red line. The ends are flush with the end of the white line. Contrast it with the green line. In this line, the line-cap, still square, extends past the white line by the width of the stroke. The blue line, with a round line-cap, is drawn using a half circle of radius of one half of the <code class="literal">stroke-width</code>.</p><p>By default, the SVG lines are solid, but they can also be created with dashes, specified by using the <code class="literal">stroke-dasharray</code> attribute. This attribute is given a list of integer values which specify a<a id="id166" class="indexterm"/> repeating pattern of line segment widths, the first starting <a id="id167" class="indexterm"/>with <a id="id168" class="indexterm"/>the <code class="literal">stroke</code> color and alternating with empty space:</p><div class="informalexample"><pre class="programlisting">&lt;line x1="10" y1="20" x2="110" y2="120"
        stroke="red" stroke-width="5"
        stroke-dasharray="5,5" /&gt;
&lt;line x1="60" y1="20" x2="160" y2="120"
        stroke="green" stroke-width="5"
        stroke-dasharray="10,10" /&gt;
&lt;line x1="110" y1="20" x2="210" y2="120"
        stroke="blue" stroke-width="5"
        stroke-dasharray="20,10,5,5,5" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_14.jpg" alt="Strokes, caps, and dashes"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note44"/>Note</h3><p>bl.ock (3.13): <a class="ulink" href="http://goo.gl/VyBBwy">http://goo.gl/VyBBwy</a>
</p></div></div></div>
<div class="section" title="Applying SVG transforms"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Applying SVG transforms</h1></div></div></div><p>The <span class="strong"><strong>S</strong></span> in SVG stands for <span class="strong"><strong>Scalable</strong></span>, while <span class="strong"><strong>V</strong></span> stands for <span class="strong"><strong>Vector</strong></span>. These are the two important parts of the name. This allows us to be able to apply a variety of transforms prior to the <a id="id169" class="indexterm"/>rendering of SVG shapes.</p><p>Each SVG shape is represented by one or more vectors, where a vector in SVG is a tuple (<span class="emphasis"><em>x, y</em></span>) distance from an origin in the coordinate system. As an example, a rectangle will be represented by four 2D vectors, one for each corner of the rectangle.</p><p>When creating graphical visualizations, this modeling of data with vectors has several benefits. One of those is that we can define a shape around a coordinate system for just that shape. Modeling this way allows us to make copies of the shape, but position them in different places in a larger image, rotate them, scale them, and perform many other operations beyond the scope of this text.</p><p>Secondly, these transformations are applied on the model before being rendered into pixels on the screen. Because of this, SVG can ensure that irrespective of the level of scale applied to the image, it does not get pixelated.</p><p>Another important concept in transformations is that they can be applied in a chain and in any sequence. This<a id="id170" class="indexterm"/> is an extremely powerful concept in linear algebra for creating composite models of visuals.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note45"/>Note</h3><p>There are many ramifications of the transformations and their sequencing that can take effect on the result of the rendering in SVG. Unfortunately, an explanation of these is beyond the scope of the book, but when they have an effect on examples, we will examine them in light of that particular example.</p></div></div><p>In this section, and in other examples in this book, we will use three general types of transformations provided by SVG: <code class="literal">translate</code>, <code class="literal">rotate</code>, and <code class="literal">scale</code>. Transformations can be applied to an SVG element by using the <code class="literal">transform</code> attribute.</p><p>To demonstrate transforms, we will look at several examples that apply each transform to a rectangle to see how they affect the resulting rendering of the rectangle.</p><div class="section" title="Rotate"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>Rotate</h2></div></div></div><p>The first transformation that we will examine is rotation. We can rotate an SVG object by a specified <a id="id171" class="indexterm"/>number of degrees using <code class="literal">.rotate(x)</code>, where <code class="literal">x</code> specifies the number of degrees to rotate the element.</p><p>To demonstrate<a id="id172" class="indexterm"/> this, the following example rotates our rectangle by 45 degrees. A simple axis with two lines is rendered to give a frame of reference for the translation. This will be included in this code snippet, but excluded in the rest for brevity:</p><div class="informalexample"><pre class="programlisting">&lt;line x1="0" y1="150" x2="0" y2="0" stroke="black" /&gt;
&lt;line x1="0" y1="0" x2="150" y2="0" stroke="black" /&gt;
&lt;rect x="0" y="0 " width="100" height="100" fill="red"
      transform="rotate(45)" /&gt;</pre></div><p>The preceding snippet gives us the folllowing result:</p><div class="mediaobject"><img src="graphics/B04230_03_15.jpg" alt="Rotate"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note46"/>Note</h3><p>bl.ock (3.14): <a class="ulink" href="http://goo.gl/vLCeHD">http://goo.gl/vLCeHD</a>
</p></div></div><p>This is not <a id="id173" class="indexterm"/>quite the effect that we may have wanted. This is because the<a id="id174" class="indexterm"/> rotation of a rectangle is performed around its upper-left corner. To make this appear to have rotated around its center, we need to use an alternate form of <code class="literal">rotate()</code> which takes three parameters: the angle to rotate followed by an offset from the upper-left corner of the rectangle to a point that represents the center of the rectangle:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="0" y="0" width="100" height="100" fill="red"
      transform="rotate(45,50,50)" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_16.jpg" alt="Rotate"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note47"/>Note</h3><p>bl.ock (3.15): <a class="ulink" href="http://goo.gl/ujF3iY">http://goo.gl/ujF3iY</a>
</p></div></div><p>The rectangle has now been rotated about its center, but there is an issue of several of the corners being clipped outside the bounds of the containing SVG element. We will fix this when we look at translations in the next section.</p></div><div class="section" title="Translate"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>Translate</h2></div></div></div><p>An SVG <a id="id175" class="indexterm"/>element can be repositioned within its containing element by<a id="id176" class="indexterm"/> using a <span class="strong"><strong>transformation</strong></span>. A transform is performed <a id="id177" class="indexterm"/>using the <code class="literal">translate()</code> function. <code class="literal">translate()</code> takes two values: the distance in <code class="literal">x</code> and <code class="literal">y</code> and the distance to reposition the element within its parent.</p><p>The following example will draw our rectangle, and translate it 30 pixels to the right and 30 pixels down:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="0" y="0 " width="100" height="100" fill="red"
      transform="translate(30,30)" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_17.jpg" alt="Translate"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note48"/>Note</h3><p>bl.ock (3.16): <a class="ulink" href="http://goo.gl/jANiXU">http://goo.gl/jANiXU</a>
</p></div></div><p>Now let's look back at the last rotation example, where two of the corners of the rectangle were clipped. We can fix this to see those corners by specifying a translation on the rectangle to move it right and down 30 pixels prior to the rotation:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="0" y="0" width="100" height="100" fill="red"
        transform="translate(30,30) rotate(45,50,50)" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_18.jpg" alt="Translate"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note49"/>Note</h3><p>bl.ock (3.17): <a class="ulink" href="http://goo.gl/W6MeSc">http://goo.gl/W6MeSc</a>
</p></div></div><p>This also<a id="id178" class="indexterm"/> demonstrates applying multiple transformations <a id="id179" class="indexterm"/>within a single string supplied to transform. You can sequentially apply many transforms in this manner to handle complex modeling scenarios.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note50"/>Note</h3><p>A common question about translate transform is why not just change the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> attributes to position the elements instead of using the transform?</p><p>The answer to this can be very complicated and has many reasons. The first is that not all SVG elements are positioned with <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> attributes, for example, a circle, which is positioned using its <span class="emphasis"><em>cx</em></span> and <span class="emphasis"><em>cy</em></span> attributes. Hence, there is no consistent set of attributes for positioning. Using a translate transform therefore allows us to have a uniform means of positioning the SVG elements no matter what type they are.</p><p>Another reason is that when applying multiple transforms, it is not easy (or possible) to access the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> attributes. Moreover, through various transforms, the actual location of an SVG element may not match directly with the pixels or points specified in another coordinate system which using <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> attributes be included.</p></div></div></div><div class="section" title="Scale"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>Scale</h2></div></div></div><p>Scaling an<a id="id180" class="indexterm"/> object changes its apparent visual size by a given percentage<a id="id181" class="indexterm"/> along both the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> axes. Scaling is performed using the <code class="literal">scale()</code> function. It can be uniformly applied to each axis, or you can also specify a different scale value for each.</p><p>The following example demonstrates scaling. We will draw two rectangles, one atop the other. The rectangle at the bottom will be blue, and the one on top, red. The red will then be scaled to 50 percent of its size:</p><div class="informalexample"><pre class="programlisting">&lt;rect x="0" y="0" width="100" height="100" fill="blue"/&gt;
&lt;rect x="0" y="0" width="100" height="100" fill="red"
      transform="scale(0.5)" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_19.jpg" alt="Scale"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note51"/>Note</h3><p>bl.ock (3.18): <a class="ulink" href="http://goo.gl/fCAhg7">http://goo.gl/fCAhg7</a>
</p></div></div></div></div>
<div class="section" title="Groups"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Groups</h1></div></div></div><p>SVG elements can be grouped together using the <code class="literal">&lt;g&gt;</code> tag. Any transformations applied to the group will be <a id="id182" class="indexterm"/>applied to each of the elements in the group. This is<a id="id183" class="indexterm"/> convenient for applying an overall transform to a particular group of items only.</p><p>The following example demonstrates both the translation of a group of items (the blue rectangle with text) and the way the transform on the group affects both the items. Note that the <code class="literal">green</code> rectangle is not affected because it is not part of the transform:</p><div class="informalexample"><pre class="programlisting">&lt;g transform="translate(100,30) rotate(45 50 50)"&gt;
  &lt;rect x="0" y="0" width="100" height="100" style="fill:blue" /&gt;
  &lt;text x="15" y="58" fill="White" font-family="arial" 
        font-size="16"&gt;
        In the box
    &lt;/text&gt;
&lt;/g&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_20.jpg" alt="Groups"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note52"/>Note</h3><p>bl.ock (3.19): <a class="ulink" href="http://goo.gl/FY6q4D">http://goo.gl/FY6q4D</a>
</p></div></div><p>Also notice<a id="id184" class="indexterm"/> that the placement of the text on top of the rectangle is<a id="id185" class="indexterm"/> relative to the top-left corner of the group, not the SVG element. This is important for ensuring that the text rotates properly relative to the blue rectangle.</p></div>
<div class="section" title="Transparency"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Transparency</h1></div></div></div><p>SVG supports <a id="id186" class="indexterm"/>drawing of transparent elements. This<a id="id187" class="indexterm"/> can be done by either setting the <code class="literal">opacity</code> attribute or by using the <code class="literal">rgba (red-green-blue-alpha)</code> value when specifying a color.</p><p>The following example renders three circles of different colors, all of which are 50 percent transparent. The first two use the opacity attribute, and the third uses a transparent color specification for the fill.</p><div class="informalexample"><pre class="programlisting">&lt;circle cx="150" cy="150" r="100" 
        style="fill:red" opacity="0.5" /&gt;
&lt;circle cx="250" cy="150" r="100" 
        style="fill:green" opacity="0.5" /&gt;
&lt;circle cx="200" cy="250" r="100" 
        style="fill:rgba(0, 0, 255, 0.5)" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_21.jpg" alt="Transparency"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note53"/>Note</h3><p>bl.ock (3.20): <a class="ulink" href="http://goo.gl/xRzArg">http://goo.gl/xRzArg</a>
</p></div></div></div>
<div class="section" title="Layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Layers</h1></div></div></div><p>You may have noticed that the SVG elements overlay each other in a particular order, with certain <a id="id188" class="indexterm"/>elements appearing to be closer and obscuring those that are<a id="id189" class="indexterm"/> behind. Let's examine this using an example that overlays three circles on top of each other:</p><div class="informalexample"><pre class="programlisting">&lt;circle cx="150" cy="150" r="100" style="fill:red" /&gt;
&lt;circle cx="250" cy="150" r="100" style="fill:green" /&gt;
&lt;circle cx="200" cy="250" r="100" style="fill:blue" /&gt;</pre></div><div class="mediaobject"><img src="graphics/B04230_03_22.jpg" alt="Layers"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note54"/>Note</h3><p>bl.ock (3.21): <a class="ulink" href="http://goo.gl/hO4xmc">http://goo.gl/hO4xmc</a>
</p></div></div><p>The blue circle is drawn in front of the green circle, which is drawn in front of the red circle. This order is defined by the sequence that is specified in the SVG markup, with each successive element being rendered atop the previous elements.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note55"/>Note</h3><p>If you have used other graphics packages or UI tools, you would know that they often provide a concept known as a Z-order, with <span class="emphasis"><em>Z</em></span> being a pseudo-dimension where the drawing order of the elements is from the lowest to the highest Z-order. SVG<a id="id190" class="indexterm"/> does not offer this ability, but we will see in later <a id="id191" class="indexterm"/>chapters that we can address this by sorting the selections before laying them out.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Summary</h1></div></div></div><p>In this chapter, you learned how to use SVG to create various shapes, how to lay out the SVG elements using the SVG coordinates, and how layers affect the rendering. You also learned to perform transformation on SVG elements, which will be used frequently in examples throughout this book and form an essential part of creating visuals using D3.</p><p>In the next chapter, we move back to a focus on D3.js, and in particular we will take what we have learned in this chapter with SVG and use D3 to create a data-driven bar graph using D3.js selections and SVG elements.</p></div></body></html>