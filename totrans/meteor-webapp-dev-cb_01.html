<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Optimizing Your Workflow</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Installing Meteor</li><li class="listitem">Finding documentation for Meteor</li><li class="listitem">Getting help with questions</li><li class="listitem">Setting up your project file structure</li><li class="listitem">Setting up your development environment</li><li class="listitem">Using the web console</li><li class="listitem">Deploying a test app to Meteor</li><li class="listitem">Deploying to Meteor using a CNAME redirect</li><li class="listitem">Deploying to a custom hosted environment</li><li class="listitem">Deploying with Meteor Up (MUP)</li><li class="listitem">Using CoffeeScript</li><li class="listitem">Using CSS compilers</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Introduction</h1></div></div></div><p>Welcome to the wonderful world of Meteor! This chapter will walk you through some of the best practices for optimizing your Meteor workflow. From installing Meteor to deploying your finished application on your own custom server, the recipes found here will get you up and running and provide a great reference as you start working with Meteor on a daily basis.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Installing Meteor</h1></div></div></div><p>The folks at<a id="id0" class="indexterm"/> Meteor have made installation a breeze. As long as the system you're working on (Linux or Mac OS X) is reasonably up to date, installing Meteor should be very simple. We have included it as a recipe so that when you're installing Meteor on a new machine, you have it handy. We will also include installation instructions directly from GitHub, just in case you want to use a development branch.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Getting ready</h2></div></div></div><p>You must have <code class="literal">curl</code> installed <a id="id1" class="indexterm"/>in order to install Meteor. If you are on Mac OS X, <code class="literal">curl</code> is already installed. If you are on Linux, <code class="literal">curl</code> is usually installed. To check for <code class="literal">curl</code>, open a terminal window and execute the following command:</p><div><pre class="programlisting">
<strong>$ curl</strong>
</pre></div><p>If <code class="literal">curl</code> is installed, you will receive the following message:</p><div><pre class="programlisting">
<strong>curl: try 'curl --help' or 'curl --manual' for more information</strong>
</pre></div><p>If <code class="literal">curl</code> isn't installed, you will receive a message similar to the following:</p><div><pre class="programlisting">
<strong>-bash: /usr/bin/curl: No such file or directory</strong>
</pre></div><p>To install <code class="literal">curl</code>, use <code class="literal">apt-get</code> or <code class="literal">yum</code> (depending on your Linux version). The following is the command to install <code class="literal">curl</code> on Ubuntu. Simply replace <code class="literal">apt-get</code> with <code class="literal">yum</code> in the command to install it on Fedora, Debian, or CentOS:</p><div><pre class="programlisting">
<strong>$ sudo apt-get install curl</strong>
</pre></div><p>You should see an installation message, with perhaps a prompt to install. Complete the installation process; you will then be ready to install Meteor.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How to do it...</h2></div></div></div><p>Open a terminal window and execute the following command:</p><div><pre class="programlisting">
<strong>$ curl https://install.meteor.com/ | sh</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How it works...</h2></div></div></div><p>The <code class="literal">curl https://install.meteor.com/</code> command is used to retrieve an installation script directly from Meteor. Once the script is downloaded, the <code class="literal">| sh</code> argument tells your system to execute the script, which installs Meteor at <code class="literal">/usr/local/bin/meteor</code> (which should be in your path). Once the entire script is executed, you will be able to run the <code class="literal">meteor</code> command from any location.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>There's more...</h2></div></div></div><p>The preceding recipe covers the default/stable Meteor installation. If you'd like to install Meteor directly from the source code or if you'd like to install a development branch (for example, the current nightly), you can do so using <code class="literal">git</code>.</p><p>The<a id="id2" class="indexterm"/> Meteor repository is located at <a class="ulink" href="https://github.com/meteor/meteor">https://github.com/meteor/meteor</a>. You can find various development branches at this location, in addition to the main Meteor repository.</p><p>Assuming you have <a id="id3" class="indexterm"/>
<code class="literal">git</code> installed and would like to install the main Meteor build, open a terminal window and execute the following command:</p><div><pre class="programlisting">
<strong>$ git clone git://github.com/meteor/meteor.git</strong>
</pre></div><p>This will clone the latest Meteor build into a subfolder named <code class="literal">meteor</code>. Note that this does not install Meteor globally on your machine. This means that in order to run the <code class="literal">meteor</code> command, you will need to navigate to (or reference) the <code class="literal">meteor</code> folder where you just cloned the Meteor repository.</p><div><h3 class="title"><a id="tip02"/>Tip</h3><p>Various other installation arguments and customizations can be used, depending on your situation. To see more comprehensive instructions, visit<a id="id4" class="indexterm"/> the Meteor GitHub main <code class="literal">README.md</code> page at <a class="ulink" href="https://github.com/meteor/meteor">https://github.com/meteor/meteor</a>.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Finding documentation for Meteor</h1></div></div></div><p>Meteor has <a id="id5" class="indexterm"/>finally reached version 1.0, and as such, it's <a id="id6" class="indexterm"/>various libraries and features are beginning to stabilize. However, there are still some parts of Meteor that are in flux. It is therefore important to have the latest documentation handy. This recipe will show you where you can find the official Meteor documentation when you need it.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it…</h2></div></div></div><p>Simply<a id="id7" class="indexterm"/> navigate to <a class="ulink" href="http://docs.meteor.com/">http://docs.meteor.com/</a> in a browser and bookmark the page.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works…</h2></div></div></div><p>That's all there is to it. The Meteor folks keep the documentation up to date, and you can be sure to find all production-ready features, along with a lot of great advice, at that location.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>There's more…</h2></div></div></div><p>If you would like to have an offline copy of the documentation and still make sure you have the latest and greatest version of documentation, you can use Meteor's GitHub repository to serve up a local copy of the latest documentation.</p><p>To get the initial copy of the documentation, navigate to where you would like to store the documentation (for example, your <code class="literal">Documents</code> directory) and clone the latest Meteor repository with the following command:</p><div><pre class="programlisting">
<strong>$ git clone git://github.com/meteor/meteor.git</strong>
</pre></div><p>If you've already done <a id="id8" class="indexterm"/>this, and would like to make sure you have the latest and greatest, navigate to the <code class="literal">meteor</code> subfolder (created when you did the initial Git clone) and run the following command:</p><div><pre class="programlisting">
<strong>$ git pull origin master</strong>
</pre></div><p>This will update the Meteor repository with the latest and greatest.</p><p>Once you've got the latest documentation, you can access it via a web browser by navigating to the <code class="literal">docs</code> directory:</p><div><pre class="programlisting">
<strong>$ cd docs/</strong>
</pre></div><p>Then, run the <code class="literal">meteor</code> command:</p><div><pre class="programlisting">
<strong>$ meteor</strong>
</pre></div><p>Once the packages <a id="id9" class="indexterm"/>are updated, the Meteor documentation project will start and you will see the following in the command line:</p><div><pre class="programlisting">
<strong>=&gt; Meteor server running on: http://localhost:3000/</strong>
</pre></div><p>You can now use a browser to navigate to <code class="literal">http://localhost:3000/</code> and read the latest documentation.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Getting help with questions</h1></div></div></div><p>The<a id="id10" class="indexterm"/> more you use Meteor, the more familiar the major packages will become. However, you may also want to start branching out and doing more advanced things with some of the lesser-known packages. You may also come up with an idea for a new application of Meteor. In any case, you will eventually run into a situation where you need more information than what is contained in the documentation. Here are some quick tips on where to go when you need your questions answered.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How to do it…</h2></div></div></div><p>There are three major sources<a id="id11" class="indexterm"/> for getting your questions answered:</p><div><ol class="orderedlist arabic"><li class="listitem">For specific technical questions or problems, head over to <a class="ulink" href="http://stackoverflow.com/questions/tagged/meteor">http://stackoverflow.com/questions/tagged/meteor</a>. Search for questions others have already asked; if you can't find an answer, go ahead and submit a question of your own.</li><li class="listitem">For general <a id="id12" class="indexterm"/>questions and comments, visit the Meteor forums at <a class="ulink" href="https://forums.meteor.com/">https://forums.meteor.com/</a>.</li><li class="listitem">To work in real time with multiple Meteor developers (including members of the core team), you can visit the IRC #meteor chat room on <code class="literal">irc.freenode.net</code>.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How it works…</h2></div></div></div><p>Let's look at some tips on using each of the previously mentioned resources.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Stack Overflow</h3></div></div></div><p>Stack Overflow is<a id="id13" class="indexterm"/> a very active community of developers, many <a id="id14" class="indexterm"/>of whom are eager to help others with their technical questions. For Meteor-specific help, once you've navigated to <a class="ulink" href="http://stackoverflow.com/questions/tagged/meteor">http://stackoverflow.com/questions/tagged/meteor</a>, you can perform a search using the keywords that best describe your question, for example, if you are interested in getting Meteor to work inside a PhoneGap application, you may want to search all the tagged <strong>[meteor]</strong> questions for <code class="literal">cordova</code>, as follows:</p><div><img src="img/image00311.jpeg" alt="Stack Overflow"/></div><p style="clear:both; height: 1em;"> </p><p>This will search all the previously submitted questions tagged with the keyword <strong>[meteor]</strong>, which also contain the word <code class="literal">cordova</code> somewhere in the question. You will want to look through the results to see whether your question has already been asked. If one of the questions (and the answer to that question) satisfies your needs, great! If your question hasn't been answered already, you can ask your own question.</p><p>Click on the button labeled <strong>Ask Question</strong>:</p><div><img src="img/image00312.jpeg" alt="Stack Overflow"/></div><p style="clear:both; height: 1em;"> </p><p>Fill out the details of your question. Don't forget to include tags to more easily identify and categorize <a id="id15" class="indexterm"/>your question. Submit your question and the Stack Overflow community will most likely have an answer for you very quickly.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Meteor forums</h3></div></div></div><p>Meteor forums<a id="id16" class="indexterm"/> are also very active, with lots of enthusiastic Meteor developers visiting the site daily. You can ask questions, view discussions, and leave comments on a lot of different Meteor-related topics. Most of the time, if you have a technical question or problem, it's best to use Stack Overflow. However, forums are also a great resource for more abstract or specific questions about Meteor.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec03"/>The #meteor on IRC</h3></div></div></div><p>The #meteor IRC channel<a id="id17" class="indexterm"/> is a great channel to join in and listen to. You'll be able to interact with all kinds of brilliant developers, many of whom are willing to answer your questions immediately. Do keep in mind that most questions or problems you're having (especially when you're new to Meteor) have already been addressed on Stack Overflow or the Meteor forums, and it is courteous to first check and make sure your question hasn't been answered there before asking in the IRC chat.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec22"/>There's more…</h2></div></div></div><p>Keep in mind that since Meteor is still new, there are many who are struggling with questions that you may be able to answer. Also, when you find the answer to your own question, it may be worth putting it up on Stack Overflow. This will help you save time for other people who may run into the same problem.</p><p>Answering other people's questions on Stack Overflow, the Meteor forums, and even on #meteor IRC is a great way to contribute to the community.</p><div><h3 class="title"><a id="tip03"/>Tip</h3><p>Don't forget to answer your own questions on Stack Overflow, if you happen to find the answers yourself!</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Setting up your project file structure</h1></div></div></div><p>When you spin up<a id="id18" class="indexterm"/> a new project in Meteor, the default file configuration is built to get you up and running immediately. That's great, but if you're looking to keep your code optimized and easily understood, you'll need to tweak the file structure a bit. The following recipe maps out the file structure that you can use for the majority of your projects.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Getting ready</h2></div></div></div><p>You'll want to create a new base Meteor project, which we will then modify to suit our needs. In a terminal window, navigate to the folder where you would like to create the project and enter the following command to create a project called <code class="literal">FileTemplate</code>:</p><div><pre class="programlisting">
<strong>$ meteor create FileTemplate</strong>
</pre></div><div><h3 class="title"><a id="tip04"/>Tip</h3><p><strong>Downloading the example code</strong></p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you. Optionally, the code samples can also be downloaded from <a class="ulink" href="https://github.com/strack/PacktMeteorRecipes">https://github.com/strack/PacktMeteorRecipes</a>.</p></div><p>This will create the base<a id="id19" class="indexterm"/> file structure. Now, navigate to the folder in the File Explorer window of your choice. For this exercise, we'll use a Mac OS X Finder window so that we can visualize the folder structure:</p><div><img src="img/image00313.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="tip05"/>Tip</h3><p>Always start with a fresh Meteor project (don't try to create your folder structure manually). Even though the file structure looks simple, there are hidden files and folders created by the <code class="literal">meteor create</code> command that you can't live without!</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How to do it…</h2></div></div></div><p>To set up your project file structure, proceed with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In your root folder, delete the default <code class="literal">.css</code>, <code class="literal">.js</code>, and <code class="literal">.html</code> files. <strong>FileTemplate</strong> should now appear empty, similar to the following screenshot:<div><img src="img/image00314.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="tip06"/>Tip</h3><p>Instead of deleting the base <code class="literal">.html</code>, <code class="literal">.css</code>, and <code class="literal">.js</code> files, you could break them apart using the code/file entries discussed in the following steps.</p></div></li><li class="listitem">Create the following subfolders in your root folder:<div><ul class="itemizedlist"><li class="listitem"><code class="literal">client</code></li><li class="listitem"><code class="literal">server</code></li><li class="listitem"><code class="literal">both</code></li><li class="listitem"><code class="literal">private</code></li><li class="listitem"><code class="literal">public</code></li></ul></div></li><li class="listitem">Navigate<a id="id20" class="indexterm"/> to the <code class="literal">client</code> subfolder. Create a new file named <code class="literal">main.html</code>. Edit this file and add the following code (taken from <code class="literal">FileTemplate.html</code>):<div><pre class="programlisting">&lt;head&gt;
  &lt;title&gt;FileTemplate&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;h1&gt;Welcome to Meteor!&lt;/h1&gt;

  {{&gt; hello}}
&lt;/body&gt;

&lt;template name="hello"&gt;
  &lt;button&gt;Click Me&lt;/button&gt;
  &lt;p&gt;You've pressed the button {{counter}} times.&lt;/p&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">Create a new subfolder in the <code class="literal">client</code> folder named <code class="literal">scripts</code>.</li><li class="listitem">Inside <code class="literal">scripts</code>, create a new file called <code class="literal">main.js</code>. Edit this file, adding the following code (taken from the <code class="literal">Meteor.isClient</code> section of <code class="literal">FileTemplate.js</code>):<div><pre class="programlisting">   // counter starts at 0
  Session.setDefault('counter', 0);

  Template.hello.helpers({ counter: function () { return Session.get('counter');
    }
  });

  Template.hello.events({ 'click button': function () { // increment the counter when button is clicked
      Session.set('counter', Session.get('counter') + 1);
    }
  });</pre></div></li><li class="listitem">Create a <a id="id21" class="indexterm"/>new subfolder in the <code class="literal">client</code> folder named <code class="literal">lib</code>. Create two subfolders named <code class="literal">scripts</code> and <code class="literal">styles</code>.</li><li class="listitem">Inside <code class="literal">styles</code>, create a new file called <code class="literal">style.css</code>.</li><li class="listitem">Navigate to the <code class="literal">server</code> subfolder. Create a new file named <code class="literal">server.js</code>. Add the following code to the <code class="literal">server.js</code> file and save the changes:<div><pre class="programlisting">Meteor.startup(function () {
  // code to run on server at startup
});</pre></div><p>Your completed file structure should now look like the following screenshot:</p><div><img src="img/image00315.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How it works…</h2></div></div></div><p>We'll break down this <a id="id22" class="indexterm"/>file structure in pairs for the most part. This is because for almost every folder, there is another folder that serves the opposite purpose.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec04"/>client/server</h3></div></div></div><p>The <code class="literal">client</code> folder<a id="id23" class="indexterm"/> is interpreted by Meteor as code that belongs exclusively to the client. The <code class="literal">server</code> folder<a id="id24" class="indexterm"/> is the exact opposite and tells Meteor that any files contained inside should only apply to server-side processing.</p><p>Having separate <code class="literal">client</code> and <code class="literal">server</code> folders logically separates your code (making it easier to visualize), saves unnecessary processing, and prevents errors (client templates and rendering code will throw errors if processed by the server).</p><p>Inside of the <code class="literal">client</code> folder, we've placed a <code class="literal">scripts</code> subfolder and two files, both with the main prefix (<code class="literal">main.html</code> and <code class="literal">main.js</code>). The <code class="literal">scripts</code> subfolder is for our benefit, separating out HTML and JavaScript so that when we go back and review our code, it will be easy to read and segment.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec05"/>main/lib</h3></div></div></div><p>The<a id="id25" class="indexterm"/> <code class="literal">main</code> prefix is used to tell Meteor: <em>run this code last</em>. When Meteor goes about processing and compiling files, it waits to process anything named <code class="literal">main</code> until the very end. This helps in situations where libraries or scripts need to be initialized before you can take advantage of them.</p><p>Conversely, the <code class="literal">lib</code> folder<a id="id26" class="indexterm"/> tells Meteor: <em>run this code first</em>. Anything placed inside, or as a child of, the <code class="literal">lib</code> folder will be run first by Meteor at runtime. This is a great place to put global variables, common libraries not already included as packages (see <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em>), and of course any style sheets. This is why we've included a <code class="literal">scripts</code> and <code class="literal">styles</code> subfolder and have created an initial generic <code class="literal">style.css</code> file.</p><p>Using the <code class="literal">main</code> prefix and the <code class="literal">lib</code> folder together helps us maintain proper sequences and ensures that our styles load as quickly as possible.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec06"/>public/private</h3></div></div></div><p>The <code class="literal">public</code> folder<a id="id27" class="indexterm"/> is a repository for assets that need to be accessed globally. It's a very good place to store non-sensitive information, such as images and text files. It's also easy to remember. If you need something to be shown publicly, put it in the <code class="literal">public</code> folder.</p><p>The <code class="literal">private</code> folder<a id="id28" class="indexterm"/> is the opposite. It's a place to store assets that can only be seen by the server. This is a good place to put moderately sensitive information (you'll want additional security, such as a database, for the information you want to keep more secure). Any files placed in the <code class="literal">private</code> folder can be referenced by the server with no special path or navigation arguments.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec07"/>both</h3></div></div></div><p>The <code class="literal">both</code> folder<a id="id29" class="indexterm"/> stands all by itself as the folder accessible by both the client and the server. When you are creating models and collections (see <a class="link" title="Chapter 4. Creating Models" href="part0046.xhtml#aid-1BRPS1">Chapter 4</a>, <em>Creating Models</em>) you'll want to put the declarations in a file inside of the <code class="literal">both</code> folder. The main reason for doing this is so that you don't duplicate code, and you can ensure that both the client and the server are working from the same model declarations.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec26"/>There's more…</h2></div></div></div><p>Obviously, you don't need to create this file structure from scratch every time. You can use your favorite script engine (Grunt, Gulp, Shell Script, and so on) and create a script that can make the necessary changes with a single command. Alternatively, you can create the template once, copy the entire folder to a new location, and then use it as if it were a new project.</p><p>If you do decide to use this recipe rather than an automated script, make sure you update your base template to the latest Meteor build periodically and each time you make a copy. This can be done very easily in a terminal window. Navigate to the root folder (for example <code class="literal">~/Documents/Meteor/FileTemplate</code>) and run the following command:</p><div><pre class="programlisting">
<strong>$ meteor update</strong>
</pre></div><p>You will either receive a message letting you know that the folder is already up to date, or Meteor will update the project to the latest version.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec27"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem"><a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Setting up your development environment</h1></div></div></div><p>While you're <a id="id30" class="indexterm"/>developing your project, there are several default packages and settings that make your debugging and development work much easier. This recipe will give you suggestions to help create an ideal development environment.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec28"/>Getting ready </h2></div></div></div><p>You'll want to make sure you have Meteor installed (of course), and you will need a default project file structure set up. You can either use the <em>Setting up your project file structure</em> recipe from earlier in this chapter, or create a brand new Meteor project using the <code class="literal">meteor create [...]</code> command.</p><p>This recipe <a id="id31" class="indexterm"/>assumes that you have some Mongo collections and/or some kinds of user accounts set up. If you don't have a collection added, you may want to add one just for testing purposes. To do so, create a file named <code class="literal">[project root]/both/model.js</code> and enter the following line of code:</p><div><pre class="programlisting">testCollection = new Mongo.Collection('testCollection');</pre></div><p>With a project in place and at least one Mongo collection to monitor, we're ready to start developing and debugging!</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How to do it…</h2></div></div></div><p>First, we want to make sure that the <code class="literal">insecure</code> and <code class="literal">autopublish</code> packages are installed, which is usually the case with a default Meteor project.</p><div><ol class="orderedlist arabic"><li class="listitem">In a terminal window, navigate to the root folder of your project and enter the following command:<div><pre class="programlisting">
<strong>$ meteor list</strong>
</pre></div><p>This will list all the packages used by your project. You should receive something similar to the following:</p><div><pre class="programlisting">
<strong>autopublish      1.0.2</strong>
<strong>insecure         1.0.2</strong>
<strong>meteor-platform  1.2.1</strong>
<strong>…</strong>
</pre></div></li><li class="listitem">If the <code class="literal">autopublish</code> or <code class="literal">insecure</code> packages are missing, you can add them manually by entering the following commands:<div><pre class="programlisting">
<strong>$ meteor add autopublish</strong>
<strong>$ meteor add insecure</strong>
</pre></div></li><li class="listitem">Next, install the <code class="literal">msavin:mongol</code> smart package. In the terminal window, enter the following command:<div><pre class="programlisting">
<strong>$ meteor add msavin:mongol</strong>
</pre></div><p>After a short installation process, you should receive a message indicating that the <code class="literal">msavin:mongol</code> package was installed correctly.</p></li><li class="listitem">Start your <code class="literal">meteor</code> project by entering the following command in your terminal window:<div><pre class="programlisting">
<strong>$ meteor</strong>
</pre></div></li><li class="listitem">Open your <a id="id32" class="indexterm"/>app in a browser by navigating to <code class="literal">http://localhost:3000</code>. Once there, press <em>Ctrl</em> + <em>M</em> and look towards the bottom-left of the screen. You will see a small expandable dashboard, similar to the following screenshot:<div><img src="img/image00316.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Clicking on any of the collection names or the <strong>Account</strong> tab will let you view, update, delete, and insert records, as shown in the following screenshot:</p><div><img src="img/image00317.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>This comes in very handy when you're building your app, as you have instant access to your collections and user account profiles.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec30"/>How it works…</h2></div></div></div><p>The following <a id="id33" class="indexterm"/>line is all that's needed to install a package:</p><div><pre class="programlisting">
<strong>$ meteor add msavin:mongol</strong>
</pre></div><p>This tells Meteor to go and find the<a id="id34" class="indexterm"/> <code class="literal">msavin:mongol</code> package, with all of its dependencies, and add the package to your project. This is a third-party package, and more details on the package can be found at <a class="ulink" href="https://atmospherejs.com/msavin/mongol">https://atmospherejs.com/msavin/mongol</a>.</p><p>Once installed, you can access it on your browser page by the <em>Ctrl</em> + <em>M</em> shortcut. Under the hood, the <code class="literal">mongol</code> package is monitoring for any collections, specifically filtering user-account-related collections into the <strong>Account</strong> tab. Other than that, all collections are treated the same, and this interface just simplifies your debugging/development process when you need to see what's going on inside your collections.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec31"/>There's more…</h2></div></div></div><p>Mongol is very new but it is getting better all the time. You can read about all it's current features and preview upcoming features by visiting <a class="ulink" href="https://github.com/msavin/Mongol">https://github.com/msavin/Mongol</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec32"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Adding Meteor packages</em>, <em>Removing Meteor packages</em>, and <em>Using npm modules</em> recipes in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li><li class="listitem">The <em>Basic safety – turning off autopublish</em> and <em>Basic safety – removing insecure</em> recipes in <a class="link" title="Chapter 9. Securing Your Application" href="part0073.xhtml#aid-25JP21">Chapter 9</a>, <em>Securing Your Application</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Using the web console</h1></div></div></div><p>Sometimes <a id="id35" class="indexterm"/>modifying your code while debugging is just too slow. This recipe will introduce you to the web console and give you some pointers on using it.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec33"/>Getting ready</h2></div></div></div><p>We will need a sandbox to play in. For the purpose of this recipe, we'll use one of the default examples built into Meteor.</p><p>In a terminal window, enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor create --example leaderboard</strong>
</pre></div><p>Once created, navigate to the <code class="literal">leaderboard</code> folder and start Meteor:</p><div><pre class="programlisting">
<strong>$ cd leaderboard</strong>
<strong>$ meteor</strong>
</pre></div><p>We can now<a id="id36" class="indexterm"/> navigate to our leaderboard example page (<code class="literal">http://localhost:3000</code>) using the web browser of our choice.</p><p>We need to enable the web console in various browsers. In no particular order, here's how to get to the web console on the browsers you're likely to be working with:</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Safari</h3></div></div></div><p>Enable <a id="id37" class="indexterm"/>the <a id="id38" class="indexterm"/>
<strong>Develop</strong> menu by going to <strong>Safari</strong> | <strong>Preferences</strong> | <strong>Advanced</strong> (<em>CMD+</em>, shortcut if you prefer) and making sure the <strong>Show Development Menu in menu bar</strong> option is enabled:</p><div><img src="img/image00318.jpeg" alt="Safari"/></div><p style="clear:both; height: 1em;"> </p><p>Now, on any web page, click on <strong>Show Error Console</strong> under <strong>Develop</strong> (or use the <em>CMD</em> + <em>Alt</em> + <em>C</em> shortcut):</p><div><img src="img/image00319.jpeg" alt="Safari"/></div><p style="clear:both; height: 1em;"> </p><p>This will bring up the web console, as shown in the following screenshot:</p><div><img src="img/image00320.jpeg" alt="Safari"/></div><p style="clear:both; height: 1em;"> </p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Firefox</h3></div></div></div><p>On<a id="id39" class="indexterm"/> any<a id="id40" class="indexterm"/> web page, click on the <strong>Web Console</strong> menu option (<em>CMD</em> + <em>Alt</em> + <em>K</em> shortcut) under <strong>Tools</strong> | <strong>Web Developer</strong>:</p><div><img src="img/image00321.jpeg" alt="Firefox"/></div><p style="clear:both; height: 1em;"> </p><p>The web console now appears as shown in the following screenshot:</p><div><img src="img/image00322.jpeg" alt="Firefox"/></div><p style="clear:both; height: 1em;"> </p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Chrome</h3></div></div></div><p>On <a id="id41" class="indexterm"/>any web page, click <a id="id42" class="indexterm"/>on the <strong>Developer Tools</strong> menu item (<em>CMD</em> + <em>Alt</em> + <em>I</em> shortcut) under <strong>View</strong> | <strong>Developer</strong>:</p><div><img src="img/image00323.jpeg" alt="Chrome"/></div><p style="clear:both; height: 1em;"> </p><p>This will bring up the web console, as shown in the following screenshot:</p><div><img src="img/image00324.jpeg" alt="Chrome"/></div><p style="clear:both; height: 1em;"> </p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec34"/>How to do it…</h2></div></div></div><p>To show what's possible with a web console, let's create a new scientist, and add some points to Tesla. Because, Imma let you finish, but Nikola Tesla was the greatest scientist of all time. Of. All. Time.</p><div><ol class="orderedlist arabic"><li class="listitem">If you haven't done so already, navigate to <code class="literal">http://localhost:3000/</code>.</li><li class="listitem">Now, open the web console if it's not already open.</li><li class="listitem">In the console, run the following command:<div><pre class="programlisting">
<strong>&gt; Players.insert({name:"Stephen Hawking"})</strong>
</pre></div></li><li class="listitem">The name <strong>Stephen Hawking</strong> will now be in the list. You can select his name and add some points:<div><img src="img/image00325.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now, let's give Tesla the love he deserves. First, let's find the <code class="literal">_id</code> value for the Tesla record. Run the following command in the console:<div><pre class="programlisting">
<strong>&gt; Players.findOne({name:"Nikola Tesla"})</strong>
</pre></div></li><li class="listitem">Harvest <a id="id43" class="indexterm"/>the <code class="literal">_id</code> valuefrom the result and modify the score, similar to the following:<div><pre class="programlisting">
<strong>&gt; Players.update({_id:"bPDpqp7hgEx4d6Eui"}, {$set:{score:334823}})</strong>
</pre></div><p>Tesla will now be placed at the top of the leaderboard:</p><div><img src="img/image00326.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">One last <a id="id44" class="indexterm"/>manipulation, let's deselect any of the scientists mentioned in the preceding screenshot. Enter the following command in the console:<div><pre class="programlisting">
<strong>&gt; Session.set("selectedPlayer",null)</strong>
</pre></div><p>You will notice that, now no scientist is selected.</p></li></ol><div></div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>You can run through the previous commands in the web console by pressing the up or down arrow keys.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec35"/>How it works…</h2></div></div></div><p>The web console <a id="id45" class="indexterm"/>acts as an extension of your code. You are able to receive log messages, call exposed methods and events, or change and instantiate global variables. You are able to do this dynamically in real time, which can have a lot of advantages as you're testing or debugging.</p><p>With a few well-composed lines of code, we were able to replicate the behavior found in the event handlers and methods that belong to the app. In other words, we were able to manually test things, rather than having to modify, save, and retest the code. This kind of impromptu testing can really save us time.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec36"/>There's more…</h2></div></div></div><p>The web console <a id="id46" class="indexterm"/>and the associated development tools can perform all kinds of client-side debugging and testing tasks. You can run prewritten scripts, pause code during execution, monitor variables and the call stack, and even create your own methods and variables dynamically.</p><div><h3 class="title"><a id="tip08"/>Tip</h3><p>The web console varies a little bit from browser to browser, but you can find instructions that apply to<a id="id47" class="indexterm"/> nearly every web console at <a class="ulink" href="https://developers.google.com/chrome-developer-tools/docs/console">https://developers.google.com/chrome-developer-tools/docs/console</a>.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Deploying a test app to Meteor</h1></div></div></div><p>As you've <a id="id48" class="indexterm"/>come to expect, Meteor makes just about everything easier to do. Testing your application on a server is no exception. This recipe will show you how to deploy your application to Meteor servers, where you can test (and show off!) your new application.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec37"/>Getting ready</h2></div></div></div><p>The only requirement for this recipe is that you have a working application.</p><p>Your app doesn't need to be fancy or complete, but it should at least render something on the screen so that you can verify it is running on Meteor servers.</p><p>For this recipe, we will use the default <code class="literal">leaderboard</code> example, which is created using the following command in a terminal window:</p><div><pre class="programlisting">
<strong>$ meteor create --example leaderboard</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec38"/>How to do it…</h2></div></div></div><p>To deploy a test app to Meteor, proceed with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, you<a id="id49" class="indexterm"/> need to pick an application name.<p>The application name will appear on Meteor servers as a subdomain of the URL where your app is being served, such as <code class="literal">http://myproject.meteor.com</code>.</p><p>However, there are a lot of people testing applications on Meteor servers. Chances are pretty good that a generic name, such as "myproject" or "leaderboard", is already taken. So, we need to pick something unique.</p><p>For this recipe, I will use this application name <code class="literal">packtrecipe</code>. You will obviously need to pick something else. I got here first!</p><div><h3 class="title"><a id="tip09"/>Tip</h3><p>Your project and application name do <em>not</em> need to match. The application name is only an identifier so that Meteor servers know how to route to your application.</p></div></li><li class="listitem">Now that we've selected an application name, we will open a terminal window and navigate to the root directory of our project:<div><pre class="programlisting">
<strong>$ cd leaderboard</strong>
</pre></div></li><li class="listitem">Once we're in the correct folder, we will issue the <code class="literal">deploy</code> command as follows:<div><pre class="programlisting">
<strong>$ meteor deploy packtrecipe</strong>
</pre></div></li><li class="listitem">Meteor will bundle and deploy your application. Upon completion, you should see something similar to the following in the terminal window:<div><pre class="programlisting">
<strong>Deploying to packtrecipe.meteor.com.  Bundling...</strong>
<strong>Uploading...</strong>
<strong>Now serving at packtrecipe.meteor.com</strong>
</pre></div></li><li class="listitem">Navigate to the URL Meteor gave you (in this case, <code class="literal">http://packtrecipe.meteor.com</code>) in a browser and you will see your newly deployed application, as follows:<div><img src="img/image00327.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec39"/>How it works…</h2></div></div></div><p>It's magic! The<a id="id50" class="indexterm"/> folks at Meteor are sorcerers!</p><p>Actually, the core development team has worked very hard to make deployment as easy as possible. Under the hood, your local Meteor installation is packaging the correct files, compiling package lists and dependencies, and then sending a request to the Meteor servers. Once the Meteor servers receive the request, all the necessary error checking is done, and the packages, database, and application are created and initialized. A virtual host address is added, and voila! Your app is up and running.</p><p>There's a lot more detail (and code) involved, but this should give you a general idea of what goes into deploying to the Meteor test servers. Aren't you glad you didn't have to write all of that code?</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec40"/>There's more…</h2></div></div></div><p>You probably noticed that you had to create a Meteor developer account in order to deploy. This is as it should be, because if there were no login/security details, someone could come along and override your deployment with one of their own.</p><p>This requirement, however, is quite flexible, allowing you to add other users or even organizations so that multiple people can deploy or update your app.</p><p>To set up an <a id="id51" class="indexterm"/>organization, navigate to <a class="ulink" href="https://www.meteor.com/account-settings/organizations">https://www.meteor.com/account-settings/organizations</a> and click on the button labeled <strong>NEW ORGANIZATION</strong> at the bottom of the screen. You can then add individual users to the organization, similar to the following screenshot:</p><div><img src="img/image00328.jpeg" alt="There's more…"/></div><p style="clear:both; height: 1em;"> </p><p>Once you've deployed your application, you can authorize the changes made by an individual or an organization through the <code class="literal">meteor authorized</code> command. Use the following syntax to add authorized accounts:</p><div><pre class="programlisting">
<strong>$ meteor authorized [your-url.meteor.com] --add [user/organization]</strong>
</pre></div><p>So, for example, we would use the following to add the <code class="literal">packtmeteor</code> organization to our deployed app:</p><div><pre class="programlisting">
<strong>$ meteor authorized packt.meteor.com --add packtmeteor</strong>
</pre></div><p>Likewise, if we wanted to remove authorization (for example, let's remove the <code class="literal">strack2</code> account), we would enter something like this:</p><div><pre class="programlisting">
<strong>$ meteor authorized packt.meteor.com --remove strack2</strong>
</pre></div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>Meteor developer accounts have other useful functions as well. To explore what you can do with your<a id="id52" class="indexterm"/> account, please visit <a class="ulink" href="https://www.meteor.com/account-settings">https://www.meteor.com/account-settings</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec41"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Building a custom package</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Deploying to Meteor using a CNAME redirect</h1></div></div></div><p>Deploying to<a id="id53" class="indexterm"/> Meteor test servers is all well and good, but what if you want to use your own custom domain name? The folks at Meteor have created a simple way for you to do just that. This recipe will show you how to take advantage of this simple, yet powerful feature.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec42"/>Getting ready</h2></div></div></div><p>You will need to <a id="id54" class="indexterm"/>create a <strong>CNAME</strong> redirect to <code class="literal">origin.meteor.com</code> on the hosting service where your domain is registered. How to do this varies pretty widely, so consult your hosting service's knowledge base on the exact steps. For this recipe, we'll use the cPanel interface of a hosting service for the <code class="literal">packtpub.com</code> domain.</p><p>Enter the subdomain you wish to use in your <strong>CNAME</strong> redirect (for example, <code class="literal">meteor.packtpub.com</code>) and set the redirect location to <code class="literal">origin.meteor.com</code>. Click on <strong>Add CNAME Record</strong> to submit the record:</p><div><img src="img/image00329.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec43"/>How to do it…</h2></div></div></div><p>Let's assume the subdomain we're going to use is <code class="literal">meteor.packtpub.com</code>. In order to deploy to the Meteor environment, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Once you have your <strong>CNAME</strong> redirect properly set, open a terminal window, navigate to the root directory of your project, and enter the following:<div><pre class="programlisting">
<strong>$ meteor deploy meteor.packtpub.com</strong>
</pre></div></li><li class="listitem">Meteor will deploy your app and provide feedback as the bundling, uploading, and serving steps are completed:<div><pre class="programlisting">
<strong>Deploying to meteor.packtpub.com.  Bundling...</strong>
<strong>Uploading...</strong>
<strong>Now serving at meteor.packtpub.com</strong>
</pre></div></li><li class="listitem">To verify the application, navigate to your application's URL (for example, <code class="literal">http://meteor.packtpub.com</code>) in a browser. If everything was deployed correctly, you will see your application up and running.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec44"/>How it works…</h2></div></div></div><p>This <a id="id55" class="indexterm"/>Meteor<a id="id56" class="indexterm"/> deployment feature is nearly identical to the default deployment, with just a little bit of extra code built in to interpret the origin of <strong>CNAME</strong> redirect.</p><p>When a request comes in to <code class="literal">origin.meteor.com</code> via a <strong>CNAME</strong> redirect, Meteor takes the <strong>CNAME</strong> redirect's original destination and uses it as the unique identifier for the application deployment. Meteor also uses future requests to <code class="literal">origin.meteor.com</code> from this <strong>CNAME</strong> redirect to serve the application.</p><p>In this particular case, the original <strong>CNAME</strong> destination was <code class="literal">meteor.packtpub.com</code>. When the request is redirected to <code class="literal">origin.meteor.com</code>, Meteor recognizes the <strong>CNAME</strong> redirect and uses it to direct traffic to the deployed application.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec45"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Deploying a test app to Meteor</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Deploying to a custom hosted environment</h1></div></div></div><p>When <a id="id57" class="indexterm"/>you are ready to actually deploy your app to a production environment, you will need to convert your Meteor application to a straight up Node application. There are multiple methods to do this, all of which are (currently) manual processes and not for the beginner. A lot can go wrong. This recipe will show you how to manually deploy your Meteor application to a production server as a Node application.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec46"/>Getting ready</h2></div></div></div><p>As mentioned, there are multiple methods and server configurations that can successfully host a Node application. There are, however, some commonalities, all of which you will need for this recipe.</p><p>First, you will need a hosted <a id="id58" class="indexterm"/>
<strong>MongoDB</strong> database.</p><p>Your MongoDB database can be hosted remotely or on the same machine from where you will deploy your Node application. For this recipe, we have deployed a default MongoDB database to the same machine where we will host the app. Our <code class="literal">MONGO_URL</code> value will therefore be:</p><div><pre class="programlisting">
<strong>MONGO_URL=mongodb://localhost:27017</strong>
</pre></div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>Installation instructions (and tutorials) for <a id="id59" class="indexterm"/>MongoDB can be found at <a class="ulink" href="http://docs.mongodb.org/manual/installation/">http://docs.mongodb.org/manual/installation/</a>.</p></div><p>Free or cheap but dedicated MongoDB service hosting also exists. Run a quick Internet search for <em>MongoDB hosting</em> or<a id="id60" class="indexterm"/> visit <a class="ulink" href="http://www.mongodb.com/partners/cloud">http://www.mongodb.com/partners/cloud</a> for a list of providers.</p><p>Next, your hosting environment will need the latest stable Node and npm modules.</p><p>Installation instructions for each of these programs are beyond the scope of this book. For installation<a id="id61" class="indexterm"/> instructions<a id="id62" class="indexterm"/> and advice on how to get started, visit the following:</p><div><ul class="itemizedlist"><li class="listitem">Node (<a class="ulink" href="http://nodejs.org">http://nodejs.org</a>)</li><li class="listitem">npm (<a class="ulink" href="https://www.npmjs.com/">https://www.npmjs.com/</a>)</li></ul></div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>The latest or nightly builds of these programs will likely cause you problems in a production environment. Be sure to use the stable versions, unless you have thoroughly tested a different version.</p></div><p>Lastly, you <a id="id63" class="indexterm"/>will need the <code class="literal">forever</code> npm module installed in your hosting environment. From a terminal window on your hosted environment, run the following command:</p><div><pre class="programlisting">
<strong>$ npm install –g forever</strong>
</pre></div><p>Note that you may need to use the <code class="literal">sudo</code> command to install the package globally. This will depend on how npm was installed on your server. The preceding command will install <code class="literal">forever</code> on your machine, and you are now ready to prepare and deploy your application to production.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec47"/>How to do it…</h2></div></div></div><p>To deploy to a custom hosted environment, proceed with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open a terminal window in your development environment and navigate to the root folder of your Meteor project. In this root folder, execute the following command:<div><pre class="programlisting">
<strong>$ meteor build [your-build-location] --architecture [x]</strong>
</pre></div><p>Replace the placeholders in the preceding line of code with your build location (for example: <code class="literal">~/Documents/builds/mybuild</code>) and an architecture (the options are <code class="literal">os.osx.x86_64</code>, <code class="literal">os.linux.x86_64</code>, and <code class="literal">os.linux.x86_32</code>). The <code class="literal">--architecture</code> option is optional if you are building this on the same server where you will deploy your app.</p></li><li class="listitem">Meteor will bundle, extract, and repackage a clean production copy of your Meteor project, preparing it to be used in your hosting environment. While it is being built, Meteor will update you with the status in the terminal window.</li><li class="listitem">Once the build is finished, navigate to the build folder you specified, for example, if you specified <code class="literal">~/Documents/builds/mybuild</code> as your build location, you would need to enter the following command:<div><pre class="programlisting">
<strong>$ cd ~/Documents/builds/mybuild</strong>
</pre></div></li><li class="listitem">In the build folder, you will see a <code class="literal">tarball</code> file with a name similar to <code class="literal">[your-project-name].tar.gz</code>.<p>So, for example, if the name of my project was <code class="literal">leaderboard</code>, the name of the <code class="literal">tarball</code> file would be <code class="literal">leaderboard.tar.gz</code>.</p></li><li class="listitem">Make a note of the name and location because you'll need it when you copy and extract the build to your server.</li><li class="listitem">For this recipe, let's assume you're using a Linux server to host your production application. Let's create a <code class="literal">meteorapps</code> folder using the following terminal command:<div><pre class="programlisting">
<strong>$ mkdir /home/meteorapps</strong>
</pre></div></li><li class="listitem">Next, copy the <code class="literal">tarball</code> file from your development environment to the <code class="literal">/home/meteorapps/</code> folder in your production-hosted environment.<p>If you build  your application on a different machine, you can transfer it via SCP, FTP, a common file server, a Git repository, and so on. It really doesn't matter how you copy it over, as long as a copy of the <code class="literal">tarball</code> file is now in your hosted environment.</p></li><li class="listitem">Once <a id="id64" class="indexterm"/>it's copied over, run the following command on the <code class="literal">tarball</code> file:<div><pre class="programlisting">
<strong>$ tar –xf  [your-tarball-name].tar.gz</strong>
</pre></div><p>This will extract  the file to a folder named <code class="literal">bundle</code>. If you navigate to the <code class="literal">bundle</code> folder, you will find a <code class="literal">README</code> file. The next steps in this recipe are taken from this <code class="literal">README</code> file, so feel free to check them out for a more concise set of instructions. If you check the contents of the folder, you should see something similar to the following:</p><div><pre class="programlisting">README   main.js   programs   server   star.json</pre></div></li><li class="listitem">We will now install the npm packages needed to run our application. Navigate to <code class="literal">bundle/programs/server</code> and execute the following command:<div><pre class="programlisting">
<strong>$ npm install</strong>
</pre></div><div><h3 class="title"><a id="note02"/>Note</h3><p>Note that we did not use the <code class="literal">–g</code> argument, as we are only installing the local npm packages specified in the bundled folder.</p></div></li><li class="listitem">Next, we will need to set the <code class="literal">PORT</code> and <code class="literal">MONGO_URL</code> export arguments so that Node knows how to host our application. Enter the following commands in the terminal window:<div><pre class="programlisting">
<strong>$ export PORT=8080</strong>
<strong>$ export MONGO_URL=mongodb://localhost:27017</strong>
</pre></div><p>These two export commands tell your Node server what port to listen on, and where to find the <code class="literal">mongodb</code> hosted instance (we're using a local instance in this example).</p><p>You will also want to configure the <code class="literal">ROOT_URL</code> and <code class="literal">MAIL_URL</code> environment variables. The syntax to enter them is similar to the following export commands:</p><div><pre class="programlisting">
<strong>$ export ROOT_URL='http://[your-hostname.com]'</strong>
<strong>$ export MAIL_URL='smtp://user:password@mailhost:port/'</strong>
</pre></div></li></ol><div></div><p>Now, we<a id="id65" class="indexterm"/> can run our application. Instead of using the default <code class="literal">node</code> command, remember that we installed the npm <code class="literal">forever</code> package. The <code class="literal">forever</code> package allows us to run our Node application and will automatically restart it if we encounter an error. Run the following command in the terminal window:</p><div><pre class="programlisting">
<strong>$ forever start main.js</strong>
</pre></div><p>This command instructs Node to start <code class="literal">main.js</code> as a node application, and to restart it if there are any issues.</p><div><h3 class="title"><a id="tip13"/>Tip</h3><p>You can stop the application later on by issuing the following command from the <code class="literal">bundle/</code> directory:</p><div><pre class="programlisting">
<strong>$ forever stop main.js</strong>
</pre></div></div><p>Now it's time to test whether your application is successfully running by opening a browser and pointing it to your host environment, on the port you specified, for example, if our production environment was hosting the <code class="literal">meteorapp.packtpub.com</code> subdomain, and we specify <code class="literal">port 8080</code>, as shown in the preceding example, we would navigate to <code class="literal">http://meteorapp.packtpub.com:8080</code> in a browser.</p><p>Your app should be up and serving pages.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec48"/>How it works…</h2></div></div></div><p>Node is built to run as quickly as possible. To do so, it will run a little differently on different hardware and software configurations. This means that the Node and npm packages you use in your development environment (for example, on MAC OS X) are slightly different than the corresponding Node and npm packages in your production environment (for example, Linux Ubuntu 12.4 LTS Precise). This is especially true for foundational packages, such as the npm fibers package.</p><p>Also, although Meteor is built on top of Node, it isn't a native Node application. There are some additional layers of abstraction and processing that make your life easier as a developer, but they don't make for the prettiest native Node production environment.</p><p>The <code class="literal">meteor build</code> command takes care of this for us and creates a build without the npm packages installed. Instead, it lists any of the npm packages as dependencies. Because the specific npm packages aren't included (Meteor listed them in a package manifest file instead), there are no compatibility issues. We simply tell Node to find and install the packages specific to the current environment, using the package manifest file as a sort of a laundry list. We did this when we issued the <code class="literal">npm install</code> command.</p><p>Once npm has read the manifest file, retrieved and installed all the needed packages, and informed us that the installation was completed correctly, we can run our new native Node application.</p><p>We then set <a id="id66" class="indexterm"/>some export variables (<code class="literal">PORT</code>, <code class="literal">MONGO_URL</code>, <code class="literal">ROOT_URL</code>, and <code class="literal">MAIL_URL</code>) and ran our application using the <code class="literal">forever</code> npm package, rather than the normal node command. Using <code class="literal">forever</code> helps us with not having to go back to the server every time it crashes. Ideally, we would never have an application crash, but we live in the real world, and <code class="literal">forever</code> is a huge time saver when an app restart is needed.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec49"/>There's more…</h2></div></div></div><p>If our application is truly production-ready, we also want it to start automatically whenever the server reboots. There are various ways to do this, depending on the operating system your production server is running on, and we won't cover all of them.</p><p>We will give an example script and instructions on how to do this on Ubuntu and let you modify the script as needed for other environments.</p><p>Whenever an Ubuntu server restarts, it runs any <code class="literal">*.conf scripts</code> script found in the <code class="literal">/etc/init/</code> folder. We'll assume that our application is located at <code class="literal">/home/meteorapps/prodapp/bundle/</code>, that we are going to listen on <code class="literal">port 8080</code>, and that we are using the local MongoDB service (feel free to adjust these settings as appropriate).</p><p>Using a terminal window with <code class="literal">sudo</code> privileges, add the following <code class="literal">meteorapp.conf</code> script to <code class="literal">/etc/init/</code> to your production server:</p><div><pre class="programlisting">#  prodapp configuration file
#  /etc/init/meteorapp.conf

start on (local-filesystems)
stop on shutdown
script
    cd /home/meteorapps/prodapp/bundle/
    export MONGO_URL=mongodb://localhost:27107 PORT=8080
    export ROOT_URL='http://example.com'
    export MAIL_URL='smtp://user:password@mailhost:port/'
    exec forever start main.js
end script</pre></div><p>Let's break down what this script does.</p><p>The first two lines (<code class="literal">start on</code> and <code class="literal">stop on</code>) tell the OS when to run this script. In this case, we run it as soon as the local file systems are ready, and we stop it as soon as a shutdown request comes in.</p><p>We then have our script that will be run. We navigate to our application folder using <code class="literal">cd /home/meteorapps/prodapp/bundle</code>.</p><p>Then, we declare the location of our MongoDB service and the port we would like the Node to listen on.</p><p>Finally, we execute the <code class="literal">forever</code> command, asking it to start <code class="literal">main.js</code> as a Node application.</p><p>The Meteor Group<a id="id67" class="indexterm"/> is currently working on a project called <a id="id68" class="indexterm"/>
<strong>Galaxy</strong>, which will make deployment to custom servers as easy as deployment to their test servers. Once Galaxy is available, it will make this recipe obsolete, but that's a good thing! As mentioned, this recipe covers only one way of deploying to production. You<a id="id69" class="indexterm"/> may find another, easier method just by browsing <a class="ulink" href="https://forums.meteor.com">https://forums.meteor.com</a> or visiting other sources for Meteor information.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec50"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Getting help with questions</em> recipe in this chapter</li><li class="listitem">The <em>Deploying with Meteor Up (MUP)</em> recipe in this chapter</li><li class="listitem">The <em>Deploying apps to mobile devices</em> recipe in <a class="link" title="Chapter 12. Creating Useful Projects" href="part0088.xhtml#aid-2JTHG1">Chapter 12</a>, <em>Creating Useful Projects</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Deploying with Meteor Up (MUP)</h1></div></div></div><a id="id70" class="indexterm"/><p>We would be remiss if we didn't add one final method of deploying Meteor apps to a production server. This method is called <a id="id71" class="indexterm"/>
<strong>Meteor Up</strong> (<strong>MUP</strong>). Using a fairly simple configuration file, MUP vastly simplifies the server deployment process. And until we get to see what Galaxy (Meteor's deployment platform) looks like, MUP is the easiest way to deploy to a custom environment. This recipe will show you how to deploy your app to a custom server using Meteor Up.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec51"/>Getting ready</h2></div></div></div><p>To complete this recipe, you will need a working Meteor application. It doesn't need to be fancy, but it does need to be functional so you can see whether it was installed properly on your server at a glance.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec52"/>How to do it…</h2></div></div></div><p>MUP is installed <a id="id72" class="indexterm"/>via npm. It needs to be installed globally, so we will use the <code class="literal">-g</code> argument. To deploy your app to a custom server using MUP, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">To install MUP, open a terminal window and execute the following command:<div><pre class="programlisting">$ npm install -g mup</pre></div><p>This will take a bit to install, but once complete, you'll be ready to configure and use MUP to deploy your application.</p></li><li class="listitem">To run <code class="literal">mup init</code>, navigate to the root folder of your project in a terminal window and enter the following command:<div><pre class="programlisting">
<strong>$ mup init</strong>
</pre></div><p>You will receive a message similar to the following:</p><div><pre class="programlisting">
<strong>Empty Project Initialized!</strong>
</pre></div><p>This process will create two files in your project's root folder. We don't need to worry about the first file (<code class="literal">settings.json</code>). We will configure our app using the second file, named <code class="literal">mup.json</code>.</p></li><li class="listitem">Now, we'll configure <code class="literal">mup.json</code>. Open the <code class="literal">[project root]/mup.json</code> file in an editor. The top part of the file will have our remote server information. It should look similar to the following lines of code:<div><pre class="programlisting">"servers": [
    {
      "host": "hostname",
      "username": "root",
      "password": "password"
      // or pem file (ssh based authentication)
      //"pem": "~/.ssh/id_rsa"
    }
  ],</pre></div><p>The <code class="literal">host</code> property will be the name of the server you will be accessing via SSH/SCP. If our server name was <code class="literal">my-production-server.com</code>, the host property would look similar to the following:</p><div><pre class="programlisting">"host": "my-production-server.com",</pre></div><p>The <code class="literal">username</code> and <code class="literal">password</code> properties are the user/pass combination you would use if you were to <code class="literal">ssh</code> into the remote server.</p><p>The next four properties help us to configure our server. If we want MUP to install Mongo, Node, or PhantomJS (all necessary to deploy via MUP), we can specify the code as follows:</p><div><pre class="programlisting">  "setupMongo": true,
  "setupNode": true,
  "nodeVersion": "0.10.33",
  "setupPhantom": true,</pre></div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>As of the printing of this book, the latest stable Node version is <code class="literal">0.10.33</code>. You may want to check this and modify the <code class="literal">nodeVersion</code> property as appropriate.</p></div><p>If Mongo/Node/PhantomJS is already installed, you can change the preceding properties to <code class="literal">false</code> (which will speed up your deployment).</p><p>Next, we <a id="id73" class="indexterm"/>specify specify what we want our app to be called. This is done by modifying the <code class="literal">appName</code> property:</p><div><pre class="programlisting">"appName": "[your-app-name-here]",</pre></div><p>We need to specify the folder on our local machine where our to-be-deployed app is located. This is determined in the <code class="literal">app</code> property:</p><div><pre class="programlisting">"app": "/path/to/the/app",</pre></div><p>The last property we need to set is <code class="literal">env</code>. This instructs Node which <code class="literal">ROOT_URL</code> and <code class="literal">PORT</code> to run our Meteor application from. If, for example, we were redirecting incoming HTTP traffic to a localhost, on <code class="literal">port 1337</code> (which is done using a reverse-proxy, such as <code class="literal">nginx</code>, or a virtual host, such as <code class="literal">apache</code>), our <code class="literal">env</code> configuration would look like the following code:</p><div><pre class="programlisting">"env": {
  "ROOT_URL": "http://localhost",
  "PORT": 1337
},</pre></div></li><li class="listitem">Now let's configure our remote server with <code class="literal">mup setup</code>. In the terminal window, navigate to your project's root folder and enter the following command:<div><pre class="programlisting">
<strong>$ mup setup</strong>
</pre></div><p>This will install MongoDB, Node, and PhantomJS on the remote server. It will also configure our remote server environment and install some helper npm packages, such as <code class="literal">upstart</code>.</p></li><li class="listitem">Let's deploy our app with <code class="literal">mup deploy</code>. Once the <code class="literal">mup setup</code> command is complete, we'll be ready to deploy our app. Execute the following command in the terminal window:<div><pre class="programlisting">
<strong>$ mup deploy</strong>
</pre></div></li></ol><div></div><p>MUP will <a id="id74" class="indexterm"/>bundle your app locally, upload the build, configure the requisite npm packages on the remote server, and then serve up your app. As it runs through this process, MUP will give you status updates in the terminal.</p><p>Once complete, your app should be up and running. Test it out by either visiting your external URL (for example, <code class="literal">http://my-custom-server.com</code>) or by logging in to a remote server via <code class="literal">SSH</code>, and testing the build with a <code class="literal">curl</code> command on the localhost (for example, <code class="literal">curl http://localhost:3000</code>).</p><p>You may have a bit of troubleshooting to do to make sure your virtual host or reverse-proxy is configured properly, but after some small adjustments, you'll find that, at present, MUP is definitely the best way to deploy to a custom server.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec53"/>How it works…</h2></div></div></div><p>MUP takes all the steps we <a id="id75" class="indexterm"/>would normally have to implement manually (as in the <em>Deploying to a custom hosted environment</em> recipe in this chapter) and implements them automatically. There are three main parts to pulling this off successfully.</p><p>First, MUP creates a default configuration file when we execute the <code class="literal">mup init</code> command. We edit the newly created file with all the settings to install the right software on the remote server, configure environment variables, and upload our production build.</p><p>Second, we use <code class="literal">mup install</code> to install all the needed software on the remote server, as specified in the <code class="literal">mup.json</code> configuration file.</p><p>Lastly, our application is bundled, uploaded, extracted, initialized with environment variables, and set to run on the remote server. This is all accomplished with the <code class="literal">mup deploy</code> command.</p><p>MUP performs these<a id="id76" class="indexterm"/> tasks based on the configuration file we edited.</p><div><h3 class="title"><a id="tip15"/>Tip</h3><p>There are many additional settings we can configure and some great features of MUP that we can explore by <a id="id77" class="indexterm"/>visiting the MUP repo, which is found at <a class="ulink" href="https://github.com/arunoda/meteor-up">https://github.com/arunoda/meteor-up</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec54"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Deploying to a custom hosted environment</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec20"/>Using CoffeeScript</h1></div></div></div><p>Many<a id="id78" class="indexterm"/> people prefer CoffeeScript to the standard JavaScript syntax. If you are one of those people with a preference, Meteor has you covered. This recipe will show you how to quickly enable CoffeeScript in your development environment.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec55"/>Getting ready</h2></div></div></div><p>Nothing is needed to prepare for this recipe, other than having Meteor installed, and a project created so that you can begin using CoffeeScript.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec56"/>How to do it…</h2></div></div></div><p>To use CoffeeScript, proceed with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open a terminal window and navigate to the root folder of your project.</li><li class="listitem">Enter the following command:<div><pre class="programlisting">
<strong>$ meteor add coffeescript</strong>
</pre></div><p>You should see the following response in the terminal window:</p><div><pre class="programlisting">
<strong>coffeescript  added, version 1.0.</strong>
</pre></div><p>CoffeeScript is now installed and ready to go!</p></li></ol><div></div><p>You can test the installation by creating a <code class="literal">.coffee</code> file and adding a script (for example, add <code class="literal">test.coffee</code> to your <code class="literal">client</code> folder). When you start your Meteor application with the <code class="literal">meteor</code> command, the script should execute as designed.</p><div><h3 class="title"><a id="tip16"/>Tip</h3><p>You can uninstall CoffeeScript easily. Simply execute the following terminal command:</p><div><pre class="programlisting">
<strong>$ meteor remove coffeescript</strong>
</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec57"/>How it works…</h2></div></div></div><p>Behind<a id="id79" class="indexterm"/> the scenes, the CoffeeScript package you just installed looks for any and all <code class="literal">*.coffee</code> and <code class="literal">*.litcoffee</code> files, compiles them into native JavaScript, and then bundles them for use in your running Meteor application.</p><div><h3 class="title"><a id="note03"/>Note</h3><p>As with all other files in a running Meteor application, changes to your CoffeeScript are immediately processed.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec58"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Adding Meteor packages</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec21"/>Using CSS compilers</h1></div></div></div><p>As any <a id="id80" class="indexterm"/>CSS junkie already knows, using standard CSS to create style sheets can be tedious, redundant work. Many designers and developers prefer to use a dynamic style sheet language or preprocessors, such as Less, Stylus, and SCSS/SASS.</p><p>Meteor not only enables the use of preprocessors, but also treats them just like any other file so that changes are reflected immediately.</p><p>This recipe will show you how to enable some of the more popular CSS compilers in your Meteor application.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec59"/>Getting ready</h2></div></div></div><p>Nothing is needed to prepare for this recipe, other than having Meteor installed, and a project created so that you can begin using CSS compilers.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec60"/>How to do it…</h2></div></div></div><p>We're going to cover three different preprocessors, as they all work in a similar way.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Using Stylus</h3></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open a<a id="id81" class="indexterm"/> terminal window and navigate to the root folder of your project.</li><li class="listitem">Enter the following command:<div><pre class="programlisting">
<strong>$ meteor add stylus</strong>
</pre></div><p>You should see a response similar to the following in the terminal window:</p><div><pre class="programlisting">
<strong>stylus  added, version 1.0.7</strong>
</pre></div><p>Stylus is now installed and ready to be used. You can test this by creating a <code class="literal">.styl</code> file and adding a script (for example, add <code class="literal">test.styl</code> to your <code class="literal">client/styles</code> folder).</p></li></ol><div></div><p>When you start your Meteor application with the <code class="literal">meteor</code> command, Stylus files will be processed and proper CSS will be rendered.</p><div><h3 class="title"><a id="tip17"/>Tip</h3><p>You can use the <code class="literal">nib</code> code in Meteor as well. Just add <code class="literal">@import 'nib'</code> to your <code class="literal">.styl</code> files, and Meteor takes care of the rest.</p></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Using Less</h3></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open <a id="id82" class="indexterm"/>a terminal window and navigate to the root folder of your project.</li><li class="listitem">Enter the following command:<div><pre class="programlisting">
<strong>$ meteor add less</strong>
</pre></div><p>You should see the following response in the terminal window:</p><div><pre class="programlisting">
<strong>less  added, version 1.0.14</strong>
</pre></div><p>Now the Less package is installed, and you can use the Less stylesheet syntax to create your CSS.</p></li></ol><div></div><p>As with Stylus, you can test this by creating a <code class="literal">.less</code> file and adding some style declarations (for example, add <code class="literal">test.less</code> to your <code class="literal">client/styles</code> folder).</p><p>When you start your Meteor application with the <code class="literal">meteor</code> command, the Less files will be compiled by Meteor into standard CSS and rendered as usual.</p><div><h3 class="title"><a id="tip18"/>Tip</h3><p>If you're fond of using <code class="literal">@import</code> statements in your Less stylesheets, make sure you use the <code class="literal">.lessimport</code> extension. Otherwise, Meteor will automatically import and compile any and all <code class="literal">.less</code> files it can find.</p></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Using SCSS / SASS</h3></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Open <a id="id83" class="indexterm"/>a terminal window and navigate to the root folder of your project.</li><li class="listitem">Enter the following command:<div><pre class="programlisting">
<strong>$ meteor add fourseven:scss</strong>
</pre></div><p>You should see a response similar to the following in the terminal window:</p><div><pre class="programlisting">
<strong>fourseven:scss  added, version 2.1.1</strong>
</pre></div></li></ol><div></div><p>SCSS and SASS files can <a id="id84" class="indexterm"/>now be used to style your CSS. Just as before, you can test this by creating a <code class="literal">.scss</code> or <code class="literal">.sass</code> file and adding some style declarations (for example, add <code class="literal">test.sass</code> to your <code class="literal">client/styles</code> folder).</p><p>When you start your Meteor application with the <code class="literal">meteor</code> command, the SCSS or SASS files will be compiled by Meteor into standard CSS and rendered.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec61"/>How it works…</h2></div></div></div><p>When you installed any of the preprocessors with the <code class="literal">meteor add</code> command, it installed the corresponding npm packages tailored to work inside of Meteor.</p><p>As with other files, Meteor will monitor changes to any <code class="literal">*.styl</code>, <code class="literal">.less</code>, <code class="literal">.scss</code>, and <code class="literal">.sass</code> files, compile the changes into CSS, and render the changes immediately.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec62"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Adding Meteor packages</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li></ul></div></div></div></body></html>