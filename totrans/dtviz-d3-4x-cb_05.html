<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 5. Playing with Axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/><span class="koboSpan" id="kobo.1.1">Chapter 5. Playing with Axes</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Working with basic axes</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Customizing ticks</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Drawing grid lines</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Dynamic rescaling of axes</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/><span class="koboSpan" id="kobo.7.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.8.1">D3 was initially released without the built-in support of the Axis component. </span><span class="koboSpan" id="kobo.8.2">This situation did not last long since axes are the universal building blocks in many Cartesian coordinate system-based visualization projects and one of the most tedious tasks to build from scratch by hand. </span><span class="koboSpan" id="kobo.8.3">It quickly became clear that D3 needs to provide built-in support for axes. </span><span class="koboSpan" id="kobo.8.4">Therefore, it was introduced quite early on and is continuously being enhanced ever since it was released. </span><span class="koboSpan" id="kobo.8.5">In this chapter, we will explore the usage of the Axis component and some related techniques.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Working with basic axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec36"/><span class="koboSpan" id="kobo.1.1">Working with basic axes</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this recipe, we will focus on introducing the basic concepts and supports of the Axis component in D3 while we cover different types and features of Axis as well as their </span><code class="literal"><span class="koboSpan" id="kobo.3.1">SVG</span></code><span class="koboSpan" id="kobo.4.1"> structures.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec93"/><span class="koboSpan" id="kobo.5.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/basic-axes.html"><span class="koboSpan" id="kobo.7.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/basic-axes.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec94"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">Let's first take a look at the following code sample:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;div class="control-group"&gt; 
    &lt;button onclick="renderAll(d3.axisBottom)"&gt; 
        horizontal bottom 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisTop)"&gt; 
        horizontal top 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisLeft)"&gt; 
        vertical left 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisRight)"&gt; 
        vertical right 
    &lt;/button&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        offset = 50, 
        axisWidth = width - 2 * margin, 
        svg; 
     
    function createSvg(){ // &lt;-A 
         svg = d3.select("body").append("svg") // &lt;-B 
            .attr("class", "axis") // &lt;-C 
            .attr("width", width) 
            .attr("height", height); 
    } 
     
    function renderAxis(fn, scale, i){ 
        var axis = fn() // &lt;-D 
            .scale(scale) // &lt;-E 
            .ticks(5); // &lt;-G 
         
        svg.append("g")         
            .attr("transform", function(){ // &lt;-H 
                if([d3.axisTop, d3.axisBottom].indexOf(fn) &gt;= 0) 
                    return "translate(" + margin + "," +  
                                              i * offset + ")"; 
                else 
                    return "translate(" + i * offset + ", " +  
                                              margin + ")"; 
            }) 
            .call(axis); // &lt;-I 
    } 
     
    function renderAll(fn){ 
        if(svg) svg.remove(); 
         
        createSvg(); 
         
        renderAxis(fn, d3.scaleLinear() 
                    .domain([0, 1000]) 
                    .range([0, axisWidth]), 1); 
        renderAxis(fn, d3.scalePow() 
                    .exponent(2) 
                    .domain([0, 1000]) 
                    .range([0, axisWidth]), 2); 
        renderAxis(fn, d3.scaleTime() 
                    .domain([new Date(2016, 0, 1),  
                             new Date(2017, 0, 1)]) 
                    .range([0, axisWidth]), 3); 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">The preceding code produces a visual output with only the four buttons shown in the following screenshot; when you click on </span><span class="strong"><strong><span class="koboSpan" id="kobo.12.1">horizontal bottom</span></strong></span><span class="koboSpan" id="kobo.13.1">, it will show you the following:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_05_001.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Horizontal axis</span></p><p><span class="koboSpan" id="kobo.16.1">The following screenshot shows what it looks like when you click the </span><span class="strong"><strong><span class="koboSpan" id="kobo.17.1">vertical right</span></strong></span><span class="koboSpan" id="kobo.18.1"> button:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.19.1"><img src="graphics/image_05_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.20.1">Vertical axis</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec95"/><span class="koboSpan" id="kobo.21.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.22.1">The first step in this recipe is to create the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">svg</span></code><span class="koboSpan" id="kobo.24.1"> element, which will be used to render our axes. </span><span class="koboSpan" id="kobo.24.2">This is done using the </span><code class="literal"><span class="koboSpan" id="kobo.25.1">createSvg</span></code><span class="koboSpan" id="kobo.26.1"> function, which is defined on line </span><code class="literal"><span class="koboSpan" id="kobo.27.1">A</span></code><span class="koboSpan" id="kobo.28.1">, and the D3 </span><code class="literal"><span class="koboSpan" id="kobo.29.1">append</span></code><span class="koboSpan" id="kobo.30.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.31.1">attr</span></code><span class="koboSpan" id="kobo.32.1"> modifier functions, shown on lines </span><code class="literal"><span class="koboSpan" id="kobo.33.1">B</span></code><span class="koboSpan" id="kobo.34.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.35.1">C</span></code><span class="koboSpan" id="kobo.36.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note53"/><span class="koboSpan" id="kobo.37.1">Note</span></h3><p><span class="koboSpan" id="kobo.38.1">This is the first recipe in this book that uses SVG instead of HTML element since D3 Axis component supports only SVG. </span><span class="koboSpan" id="kobo.38.2">If you are not familiar with SVG standard, don't worry, we will cover it in detail in </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.39.1">Chapter 7</span></a><span class="koboSpan" id="kobo.40.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.41.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">Although, for the purpose of this chapter, some of the basic and limited SVG concepts will be introduced when used by the D3 Axis component.</span></p></div></div><p><span class="koboSpan" id="kobo.43.1">Let's take a look at how we created the SVG canvas in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.44.1">var height = 500,  
  width = 500,  
  margin = 25, 
  offset = 50, 
  axisWidth = width - 2 * margin, 
  svg; 
     
function createSvg(){ // &lt;-A 
     svg = d3.select("body").append("svg") // &lt;-B 
        .attr("class", "axis") // &lt;-C 
        .attr("width", width) 
        .attr("height", height); 
}  
</span></pre><p><span class="koboSpan" id="kobo.45.1">Now, we are ready to render the axes on this </span><code class="literal"><span class="koboSpan" id="kobo.46.1">svg</span></code><span class="koboSpan" id="kobo.47.1"> canvas. </span><span class="koboSpan" id="kobo.47.2">The </span><code class="literal"><span class="koboSpan" id="kobo.48.1">renderAxis</span></code><span class="koboSpan" id="kobo.49.1"> function is designed to do exactly just that. </span><span class="koboSpan" id="kobo.49.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.50.1">D</span></code><span class="koboSpan" id="kobo.51.1">, we first create an Axis component using the given D3 axis generator function. </span><span class="koboSpan" id="kobo.51.2">D3 version 4.x is shipped with four built-in axis generators for different orientations. </span><span class="koboSpan" id="kobo.51.3">Orientation tells D3 how a given axis will be placed, and therefore, how it should be rendered; for example, whether horizontally or vertically. </span><span class="koboSpan" id="kobo.51.4">The four axis orientations that D3 supports out of box are as follows:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.52.1">d3.axisTop</span></code><span class="koboSpan" id="kobo.53.1">: A horizontal axis with labels placed on top of the axis</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.54.1">d3.axisBottom</span></code><span class="koboSpan" id="kobo.55.1">: A horizontal axis with labels placed at the bottom of the axis</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.56.1">d3.axisLeft</span></code><span class="koboSpan" id="kobo.57.1">: A vertical axis with labels placed on the left-hand side of the axis</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.58.1">d3.axisRight</span></code><span class="koboSpan" id="kobo.59.1">: A vertical axis with labels placed on the right-hand side of the axis</span></li></ul></div><p><span class="koboSpan" id="kobo.60.1">You can see in the following code snippet that these are indeed the functions that get passed to the </span><code class="literal"><span class="koboSpan" id="kobo.61.1">renderAll</span></code><span class="koboSpan" id="kobo.62.1"> function when you click on the specified buttons:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.63.1">&lt;div class="control-group"&gt; 
    &lt;button onclick="renderAll(d3.axisBottom)"&gt; 
        horizontal bottom 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisTop)"&gt; 
        horizontal top 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisLeft)"&gt; 
        vertical left 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisRight)"&gt; 
        vertical right 
    &lt;/button&gt; 
&lt;/div&gt; 
... 
</span><span class="koboSpan" id="kobo.63.2">function renderAxis(fn, scale, i){ 
        var axis = fn() // &lt;-D 
            .scale(scale) // &lt;-E 
            .ticks(5); // &lt;-G 
... 
</span></pre><p><span class="koboSpan" id="kobo.64.1">D3 Axis is designed to work out of the box with D3 scales. </span><span class="koboSpan" id="kobo.64.2">The axis scale is provided using the </span><code class="literal"><span class="koboSpan" id="kobo.65.1">scale()</span></code><span class="koboSpan" id="kobo.66.1"> function (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.67.1">E</span></code><span class="koboSpan" id="kobo.68.1">). </span><span class="koboSpan" id="kobo.68.2">In this example, we render three different axes with the following scales:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.69.1">d3.scaleLinear().domain([0, 1000]).range([0, axisWidth]) 
d3.scalePow().exponent(2).domain([0, 1000]).range([0, axisWidth]) 
d3.scaleTime() 
  .domain([new Date(2016, 0, 1), new Date()]) 
  .range([0, axisWidth]) 
</span></pre><p><span class="koboSpan" id="kobo.70.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.71.1">G</span></code><span class="koboSpan" id="kobo.72.1">, we set the number of ticks, the small marks on the axes, to </span><code class="literal"><span class="koboSpan" id="kobo.73.1">5</span></code><span class="koboSpan" id="kobo.74.1">. </span><span class="koboSpan" id="kobo.74.2">This tells D3 ideally how many ticks we want to render for this axis; however, D3 might choose to render slightly more or less ticks based on the available space and its own calculation. </span><span class="koboSpan" id="kobo.74.3">We will explore the Axis ticks' configuration in detail in the next recipe.</span></p><p><span class="koboSpan" id="kobo.75.1">Once the axis is defined, the final step in this creation process is to create an </span><code class="literal"><span class="koboSpan" id="kobo.76.1">svg:g</span></code><span class="koboSpan" id="kobo.77.1"> container element, which will then be used to host all SVG structures that are required to render an axis:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.78.1">svg.append("g")         
  .attr("transform", function(){ // &lt;-H 
    if(["top", "bottom"].indexOf(orient) &gt;= 0) 
      return "translate(" + margin + ","+ i * offset + ")"; 
    else 
      return "translate(" + i * offset + ", " + margin + ")"; 
    }) 
    .call(axis); // &lt;-I 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note54"/><span class="koboSpan" id="kobo.79.1">Note</span></h3><p><span class="koboSpan" id="kobo.80.1">Having a </span><code class="literal"><span class="koboSpan" id="kobo.81.1">g</span></code><span class="koboSpan" id="kobo.82.1"> container group element to contain all SVG elements related to an axis is not only a good practice but also a requirement of the D3 axis component.</span></p></div></div><p><span class="koboSpan" id="kobo.83.1">Most of the logic in this code snippet is related to the calculation of where to draw the axis on the </span><code class="literal"><span class="koboSpan" id="kobo.84.1">svg</span></code><span class="koboSpan" id="kobo.85.1"> canvas using the </span><code class="literal"><span class="koboSpan" id="kobo.86.1">transform</span></code><span class="koboSpan" id="kobo.87.1"> attribute (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.88.1">H</span></code><span class="koboSpan" id="kobo.89.1">). </span><span class="koboSpan" id="kobo.89.2">In the preceding code example, to shift the axis using offsets, we used the </span><code class="literal"><span class="koboSpan" id="kobo.90.1">translate</span></code><span class="koboSpan" id="kobo.91.1"> SVG transformation, which allows us to shift an element using a distance parameter that is defined with the coordinates in </span><span class="emphasis"><em><span class="koboSpan" id="kobo.92.1">x</span></em></span><span class="koboSpan" id="kobo.93.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.94.1">y</span></em></span><span class="koboSpan" id="kobo.95.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note55"/><span class="koboSpan" id="kobo.96.1">Note</span></h3><p><span class="koboSpan" id="kobo.97.1">SVG transformation will be discussed in detail in </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.98.1">Chapter 7</span></a><span class="koboSpan" id="kobo.99.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.100.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.101.1">, or you can refer to the following URL for more information on this topic:
</span><a class="ulink" href="https://www.w3.org/TR/SVG/coords.html#TranslationDefined"><span class="koboSpan" id="kobo.102.1">https://www.w3.org/TR/SVG/coords.html#TranslationDefined
</span></a>
</p></div></div><p><span class="koboSpan" id="kobo.103.1">The more relevant part of this code is on line </span><code class="literal"><span class="koboSpan" id="kobo.104.1">I</span></code><span class="koboSpan" id="kobo.105.1">, where the </span><code class="literal"><span class="koboSpan" id="kobo.106.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.107.1"> function is used with the </span><code class="literal"><span class="koboSpan" id="kobo.108.1">axis</span></code><span class="koboSpan" id="kobo.109.1"> object being passed in as the parameter. </span><span class="koboSpan" id="kobo.109.2">The </span><code class="literal"><span class="koboSpan" id="kobo.110.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.111.1"> function invokes the given function (in our case, the </span><code class="literal"><span class="koboSpan" id="kobo.112.1">axis</span></code><span class="koboSpan" id="kobo.113.1"> object) with the current selection passed in as an argument. </span><span class="koboSpan" id="kobo.113.2">In other words, the function being passed into the </span><code class="literal"><span class="koboSpan" id="kobo.114.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.115.1"> function should have the following form:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.116.1">function foo(selection) { 
  ... 
</span><span class="koboSpan" id="kobo.116.2">} 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note56"/><span class="koboSpan" id="kobo.117.1">Note</span></h3><p><span class="koboSpan" id="kobo.118.1">The </span><code class="literal"><span class="koboSpan" id="kobo.119.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.120.1"> function also allows you to pass in additional arguments to the invoking function. </span><span class="koboSpan" id="kobo.120.2">For more information, visit the following link:
</span><a class="ulink" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_call"><span class="koboSpan" id="kobo.121.1">https://github.com/d3/d3-selection/blob/master/README.md#selection_call
</span></a>
</p></div></div><p><span class="koboSpan" id="kobo.122.1">Once the D3 Axis component is called, it will take care of the rest and automatically create all necessary SVG elements for an axis (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.123.1">I</span></code><span class="koboSpan" id="kobo.124.1">). </span><span class="koboSpan" id="kobo.124.2">For example, the horizontal-bottom time axis in the example shown in this recipe has the following complicated SVG structure automatically generated, which we don't really need to know much about:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.125.1"><img src="graphics/image_05_003.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.126.1">Horizontal bottom time Axis SVG structure</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Customizing ticks"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/><span class="koboSpan" id="kobo.1.1">Customizing ticks</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">We already saw how to use the </span><code class="literal"><span class="koboSpan" id="kobo.3.1">ticks</span></code><span class="koboSpan" id="kobo.4.1"> function in the previous recipe. </span><span class="koboSpan" id="kobo.4.2">This is the simplest ticks-related customization you can do on a D3 axis. </span><span class="koboSpan" id="kobo.4.3">In this recipe, we will cover some of the most common and useful ticks-related customizations with D3 axis.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec96"/><span class="koboSpan" id="kobo.5.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/ticks.html"><span class="koboSpan" id="kobo.7.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/ticks.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec97"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">In the following code example, we will customize the ticks, padding, and formatting of its label. </span><span class="koboSpan" id="kobo.9.2">Let's take a look at the code snippet first:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        axisWidth = width - 2 * margin; 
     
    var svg = d3.select("body").append("svg") 
            .attr("class", "axis") 
            .attr("width", width) 
            .attr("height", height); 
     
    var scale = d3.scaleLinear() 
            .domain([0, 1]).range([0, axisWidth]); 
     
    var axis = d3.axisBottom() 
            .scale(scale) 
            .ticks(10) 
            .tickSize(12) // &lt;-A 
            .tickPadding(10) // &lt;-B 
            .tickFormat(d3.format(".0%")); // &lt;-C 
 
    svg.append("g")         
        .attr("transform", function(){ 
            return "translate(" + margin + 
                    "," + margin + ")"; 
        }) 
        .call(axis); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">The preceding code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.12.1"><img src="graphics/image_05_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.13.1">Customized axis ticks</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec98"/><span class="koboSpan" id="kobo.14.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">The focus of this recipe is the highlighted lines after the </span><code class="literal"><span class="koboSpan" id="kobo.16.1">ticks</span></code><span class="koboSpan" id="kobo.17.1"> function. </span><span class="koboSpan" id="kobo.17.2">As we have mentioned before, the </span><code class="literal"><span class="koboSpan" id="kobo.18.1">ticks</span></code><span class="koboSpan" id="kobo.19.1"> function provides D3 a hint on how many ticks an axis should contain. </span><span class="koboSpan" id="kobo.19.2">After setting the number of ticks, in this recipe, we continue to customize the ticks through further function calls. </span><span class="koboSpan" id="kobo.19.3">On line </span><code class="literal"><span class="koboSpan" id="kobo.20.1">A</span></code><span class="koboSpan" id="kobo.21.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">tickSize</span></code><span class="koboSpan" id="kobo.23.1"> function is used to customize the size of the ticks. </span><span class="koboSpan" id="kobo.23.2">The default tick size provided by D3 is </span><code class="literal"><span class="koboSpan" id="kobo.24.1">6px</span></code><span class="koboSpan" id="kobo.25.1">, whereas we set it to </span><code class="literal"><span class="koboSpan" id="kobo.26.1">12px</span></code><span class="koboSpan" id="kobo.27.1"> in this example. </span><span class="koboSpan" id="kobo.27.2">Then, on line </span><code class="literal"><span class="koboSpan" id="kobo.28.1">B</span></code><span class="koboSpan" id="kobo.29.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.30.1">tickPadding</span></code><span class="koboSpan" id="kobo.31.1"> function was used to specify the amount of space (in pixels) between tick labels and the axis.</span></p><p><span class="koboSpan" id="kobo.32.1">Finally, a custom format was used with the </span><code class="literal"><span class="koboSpan" id="kobo.33.1">tickFormat</span></code><span class="koboSpan" id="kobo.34.1"> function on line </span><code class="literal"><span class="koboSpan" id="kobo.35.1">C</span></code><span class="koboSpan" id="kobo.36.1"> to convert the tick value into percentage. </span><span class="koboSpan" id="kobo.36.2">D3 axis' </span><code class="literal"><span class="koboSpan" id="kobo.37.1">tickFormat</span></code><span class="koboSpan" id="kobo.38.1"> function can also take a function as a formatter for more customization, and therefore, the formatter used in this recipe is the same as passing, in the following custom format function:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.39.1">.tickFormat(function(v){ // &lt;-C 
    return Math.floor(v * 100) + "%"; 
}); 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note57"/><span class="koboSpan" id="kobo.40.1">Note</span></h3><p><span class="koboSpan" id="kobo.41.1">For more information on the aforementioned functions and other ticks-related customizations, visit the D3 Wiki at the following URL:
</span><a class="ulink" href="https://github.com/d3/d3-axis/blob/master/README.md#_axis"><span class="koboSpan" id="kobo.42.1">https://github.com/d3/d3-axis/blob/master/README.md#_axis
</span></a>
</p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Drawing grid lines"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/><span class="koboSpan" id="kobo.1.1">Drawing grid lines</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Quite often, we will need horizontal and vertical grid lines to be drawn in consistency with the ticks on both </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">x</span></em></span><span class="koboSpan" id="kobo.4.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">y</span></em></span><span class="koboSpan" id="kobo.6.1"> axes. </span><span class="koboSpan" id="kobo.6.2">As we have shown in the previous recipe, typically, we don't have, or don't want to have, precise control of how ticks are rendered on D3 axes. </span><span class="koboSpan" id="kobo.6.3">Therefore, we might not know how many ticks are present and their values, before they are rendered. </span><span class="koboSpan" id="kobo.6.4">This is especially true if you are building a reusable visualization library, where it is impossible to know the tick configuration ahead of its time. </span><span class="koboSpan" id="kobo.6.5">In this recipe, we will explore some useful techniques for drawing consistent grid lines on Axis without actually needing to know the tick values.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec99"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/grid-line.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/grid-line.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec100"/><span class="koboSpan" id="kobo.10.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.11.1">First, let's take a look at how we draw grid lines in the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.12.1">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25;        
     
    var svg = d3.select("body").append("svg") 
            .attr("class", "axis") 
            .attr("width", width) 
            .attr("height", height); 
     
    function renderXAxis(){ 
        var axisLength = width - 2 * margin; 
     
        var scale = d3.scaleLinear() 
                        .domain([0, 100]) 
                        .range([0, axisLength]); 
         
        var xAxis = d3.axisBottom() 
                .scale(scale); 
                 
        svg.append("g")        
            .attr("class", "x-axis") 
            .attr("transform", function(){ // &lt;-A 
                return "translate(" + margin + "," +  
                                 (height - margin) + ")"; 
            }) 
            .call(xAxis); 
             
        d3.selectAll("g.x-axis g.tick") // &lt;-B 
            .append("line") // &lt;-C 
                .classed("grid-line", true) 
                .attr("x1", 0) // &lt;-D 
                .attr("y1", 0) 
                .attr("x2", 0) 
                .attr("y2", - (height - 2 * margin));  // &lt;-E 
    } 
     
    function renderYAxis(){         
        var axisLength = height - 2 * margin; 
     
        var scale = d3.scaleLinear() 
                        .domain([100, 0]) 
                        .range([0, axisLength]); 
     
        var yAxis = d3.axisLeft() 
                .scale(scale); 
 
        svg.append("g")        
            .attr("class", "y-axis") 
            .attr("transform", function(){ 
                return "translate(" + margin + "," +  
                                              margin + ")"; 
            }) 
            .call(yAxis); 
             
        d3.selectAll("g.y-axis g.tick") 
            .append("line") 
                .classed("grid-line", true) 
                .attr("x1", 0) 
                .attr("y1", 0) 
                .attr("x2", axisLength) // &lt;-F 
                .attr("y2", 0); 
    }    
     
    renderYAxis(); 
    renderXAxis(); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.13.1">The previous code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_05_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Axes and grid lines</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec101"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">In this recipe, two axes-</span><span class="emphasis"><em><span class="koboSpan" id="kobo.18.1">x</span></em></span><span class="koboSpan" id="kobo.19.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.20.1">y-</span></em></span><span class="koboSpan" id="kobo.21.1">were created in the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">renderXAxis</span></code><span class="koboSpan" id="kobo.23.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.24.1">renderYAxis</span></code><span class="koboSpan" id="kobo.25.1"> functions, respectively. </span><span class="koboSpan" id="kobo.25.2">Let's take a look at how the x axis was rendered.</span></p><p><span class="koboSpan" id="kobo.26.1">Once you understand how to render the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.27.1">x</span></em></span><span class="koboSpan" id="kobo.28.1"> axis and its grid lines, the logic used to render the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.29.1">y</span></em></span><span class="koboSpan" id="kobo.30.1"> axis can be easily understood since the logic used is almost identical. </span><span class="koboSpan" id="kobo.30.2">The </span><span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">x</span></em></span><span class="koboSpan" id="kobo.32.1"> axis and its scale were defined without complications, as we have already demonstrated them a number of times throughout this chapter. </span><span class="koboSpan" id="kobo.32.2">An </span><code class="literal"><span class="koboSpan" id="kobo.33.1">svg:g</span></code><span class="koboSpan" id="kobo.34.1"> element was created to contain the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.35.1">x</span></em></span><span class="koboSpan" id="kobo.36.1"> axis structures. </span><span class="koboSpan" id="kobo.36.2">This </span><code class="literal"><span class="koboSpan" id="kobo.37.1">svg:g</span></code><span class="koboSpan" id="kobo.38.1"> element was placed at the bottom of the chart using a translate transformation, as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.39.1">A</span></code><span class="koboSpan" id="kobo.40.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.41.1">.attr("transform", function(){ // &lt;-A 
  return "translate(" + margin + "," + (height - margin) + ")"; 
}) 
</span></pre><p><span class="koboSpan" id="kobo.42.1">It is important to remember that the translate transformation changes the frame of reference for coordinates when it comes to any of its subelements. </span><span class="koboSpan" id="kobo.42.2">For example, within this </span><code class="literal"><span class="koboSpan" id="kobo.43.1">svg:g</span></code><span class="koboSpan" id="kobo.44.1"> element, if we create a point with its coordinates set as </span><code class="literal"><span class="koboSpan" id="kobo.45.1">(0, 0)</span></code><span class="koboSpan" id="kobo.46.1">, then when we draw this point on the SVG canvas, it will be actually placed as </span><code class="literal"><span class="koboSpan" id="kobo.47.1">(margin, height - margin)</span></code><span class="koboSpan" id="kobo.48.1">. </span><span class="koboSpan" id="kobo.48.2">This is because all subelements within the </span><code class="literal"><span class="koboSpan" id="kobo.49.1">svg:g</span></code><span class="koboSpan" id="kobo.50.1"> element are automatically transformed to this base coordinate, and hence leading to the shift of the frame of reference. </span><span class="koboSpan" id="kobo.50.2">Equipped with this understanding, let's take a look at how dynamic grid lines can be generated after the axis is rendered through the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.51.1">d3.selectAll("g.x-axis g.tick") // &lt;-B 
            .append("line") // &lt;-C 
                .classed("grid-line", true) 
                .attr("x1", 0) // &lt;-D 
                .attr("y1", 0) 
                .attr("x2", 0) 
                .attr("y2", - (height - 2 * margin));  // &lt;-E 
</span></pre><p><span class="koboSpan" id="kobo.52.1">Once the axis is rendered, we can select all the ticks elements on an axis by selecting the </span><code class="literal"><span class="koboSpan" id="kobo.53.1">g.tick</span></code><span class="koboSpan" id="kobo.54.1">, since each of them is grouped by its own </span><code class="literal"><span class="koboSpan" id="kobo.55.1">svg:g</span></code><span class="koboSpan" id="kobo.56.1"> element (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.57.1">B</span></code><span class="koboSpan" id="kobo.58.1">). </span><span class="koboSpan" id="kobo.58.2">Then, on line </span><code class="literal"><span class="koboSpan" id="kobo.59.1">C</span></code><span class="koboSpan" id="kobo.60.1">, we append a new </span><code class="literal"><span class="koboSpan" id="kobo.61.1">svg:line</span></code><span class="koboSpan" id="kobo.62.1"> element to each of the </span><code class="literal"><span class="koboSpan" id="kobo.63.1">svg:g</span></code><span class="koboSpan" id="kobo.64.1"> tick element. </span><span class="koboSpan" id="kobo.64.2">SVG line element is the simplest shape provided by the SVG standard. </span><span class="koboSpan" id="kobo.64.3">It has the following four main attributes:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.65.1">x1</span></code><span class="koboSpan" id="kobo.66.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.67.1">y1</span></code><span class="koboSpan" id="kobo.68.1"> attributes define the point of origin of this line</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.69.1">x2</span></code><span class="koboSpan" id="kobo.70.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.71.1">y2</span></code><span class="koboSpan" id="kobo.72.1"> attributes define the point of destination</span></li></ul></div><p><span class="koboSpan" id="kobo.73.1">In our case, we simply will need to set </span><code class="literal"><span class="koboSpan" id="kobo.74.1">x1</span></code><span class="koboSpan" id="kobo.75.1">, </span><code class="literal"><span class="koboSpan" id="kobo.76.1">y1</span></code><span class="koboSpan" id="kobo.77.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.78.1">x2</span></code><span class="koboSpan" id="kobo.79.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.80.1">0</span></code><span class="koboSpan" id="kobo.81.1"> since each </span><code class="literal"><span class="koboSpan" id="kobo.82.1">g.tick</span></code><span class="koboSpan" id="kobo.83.1"> element is already translated to its position on the axis, and therefore, we only need to change the </span><code class="literal"><span class="koboSpan" id="kobo.84.1">y2</span></code><span class="koboSpan" id="kobo.85.1"> attribute in order to draw a vertical grid line. </span><span class="koboSpan" id="kobo.85.2">The </span><code class="literal"><span class="koboSpan" id="kobo.86.1">y2</span></code><span class="koboSpan" id="kobo.87.1"> attribute is set to </span><code class="literal"><span class="koboSpan" id="kobo.88.1">-(height - 2 * margin)</span></code><span class="koboSpan" id="kobo.89.1">. </span><span class="koboSpan" id="kobo.89.2">The reason why the coordinate is negative was because the entire </span><code class="literal"><span class="koboSpan" id="kobo.90.1">g.x-axis</span></code><span class="koboSpan" id="kobo.91.1"> has been shifted down to </span><code class="literal"><span class="koboSpan" id="kobo.92.1">(height - margin)</span></code><span class="koboSpan" id="kobo.93.1">, as mentioned in the previous code. </span><span class="koboSpan" id="kobo.93.2">Therefore, in absolute coordinate terms, </span><code class="literal"><span class="koboSpan" id="kobo.94.1">y2 =</span></code>
<code class="literal"><span class="koboSpan" id="kobo.95.1">(height - margin)</span></code>
<code class="literal"><span class="koboSpan" id="kobo.96.1">- (height - 2 * margin) = margin</span></code><span class="koboSpan" id="kobo.97.1">, which is the top of the vertical grid line we want to draw from the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.98.1">x</span></em></span><span class="koboSpan" id="kobo.99.1"> axis.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note58"/><span class="koboSpan" id="kobo.100.1">Note</span></h3><p><span class="koboSpan" id="kobo.101.1">In SVG coordinates, </span><code class="literal"><span class="koboSpan" id="kobo.102.1">(0, 0)</span></code><span class="koboSpan" id="kobo.103.1"> denotes the top-left corner of the SVG canvas.</span></p></div></div><p><span class="koboSpan" id="kobo.104.1">This is what the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.105.1">x</span></em></span><span class="koboSpan" id="kobo.106.1"> axis in the SVG structure with an associated grid line looks like:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.107.1"><img src="graphics/image_05_006.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.108.1">X-axis with grid lines SVG structure</span></p><p><span class="koboSpan" id="kobo.109.1">As we can see in the preceding screenshot, an </span><code class="literal"><span class="koboSpan" id="kobo.110.1">svg:line</span></code><span class="koboSpan" id="kobo.111.1"> element representing the grid line was added into the </span><code class="literal"><span class="koboSpan" id="kobo.112.1">g.ticksvg:g</span></code><span class="koboSpan" id="kobo.113.1"> container element as discussed earlier in this section.</span></p><p><span class="koboSpan" id="kobo.114.1">The </span><span class="emphasis"><em><span class="koboSpan" id="kobo.115.1">y</span></em></span><span class="koboSpan" id="kobo.116.1"> axis grid lines are generated using the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.117.1">identical technique</span></em></span><span class="koboSpan" id="kobo.118.1">; the only difference is that instead of setting the </span><code class="literal"><span class="koboSpan" id="kobo.119.1">y2</span></code><span class="koboSpan" id="kobo.120.1"> attribute on the grid lines, as we did for the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.121.1">x</span></em></span><span class="koboSpan" id="kobo.122.1"> axis, we change the </span><code class="literal"><span class="koboSpan" id="kobo.123.1">x2</span></code><span class="koboSpan" id="kobo.124.1"> attribute since the lines are horizontal (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.125.1">F</span></code><span class="koboSpan" id="kobo.126.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.127.1">d3.selectAll("g.y-axis g.tick") 
            .append("line") 
                .classed("grid-line", true) 
                .attr("x1", 0) 
                .attr("y1", 0) 
                .attr("x2", axisLength) // &lt;-F 
                .attr("y2", 0); 
</span></pre></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Dynamic rescaling of axes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/><span class="koboSpan" id="kobo.1.1">Dynamic rescaling of axes</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In some cases, the scale used by axes might change when triggered by user interaction or changes from data feeds. </span><span class="koboSpan" id="kobo.2.2">For example, a user may change the time range for the visualization. </span><span class="koboSpan" id="kobo.2.3">This kind of change also needs to be reflected by rescaling the axes. </span><span class="koboSpan" id="kobo.2.4">In this recipe, we will explore how this can be achieved dynamically while also redrawing the grid lines associated with each tick.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec102"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/rescaling.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/rescaling.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec103"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">The following is the code that shows how to perform dynamic rescaling:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        xAxis, yAxis, xAxisLength, yAxisLength; 
     
    var svg = d3.select("body").append("svg")      
            .attr("class", "axis")     
            .attr("width", width) 
            .attr("height", height); 
     
    function renderXAxis(){ 
        xAxisLength = width - 2 * margin; 
            var scale = d3.scaleLinear() 
                        .domain([0, 100]) 
                        .range([0, xAxisLength]); 
        
        xAxis = d3.axisBottom() 
                .scale(scale); 
                 
        svg.append("g")        
            .attr("class", "x-axis") 
            .attr("transform", function(){  
                return "translate(" + margin + "," +  
                                  (height - margin) + ")"; 
            }) 
            .call(xAxis); 
    } 
     
    ... 
             
    </span><span class="koboSpan" id="kobo.8.2">function rescale(){ // &lt;-A 
        var max = Math.round(Math.random() * 100); 
         
        xAxis.scale().domain([0, max]); // &lt;-B 
        svg.select("g.x-axis") 
            .transition() 
            .call(xAxis); // &lt;-C 
             
        yAxis.scale().domain([max, 0]); 
        svg.select("g.y-axis") 
            .transition() 
            .call(yAxis); 
         
        renderXGridlines(); 
        renderYGridlines(); 
    }        
     
    function renderXGridlines(){ 
        d3.selectAll("g.x-axis g.tick") 
                .select("line.grid-line") 
                .remove(); // &lt;-D 
                 
        d3.selectAll("g.x-axis g.tick") 
                .append("line") 
                    .classed("grid-line", true) 
                    .attr("x1", 0) 
                    .attr("y1", 0) 
                    .attr("x2", 0) 
                    .attr("y2", - yAxisLength); 
    } 
     
    ... 
     
    </span><span class="koboSpan" id="kobo.8.3">renderXAxis(); 
renderXGridlines(); 
... 
</span><span class="koboSpan" id="kobo.8.4">&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code generates the following effects:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_05_007.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Dynamic axes rescaling</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note59"/><span class="koboSpan" id="kobo.12.1">Note</span></h3><p><span class="koboSpan" id="kobo.13.1">Due to the limited space in this book, the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.14.1">y</span></em></span><span class="koboSpan" id="kobo.15.1"> axis-related code is omitted from the code example in this recipe. </span><span class="koboSpan" id="kobo.15.2">Refer to the code example available online for a complete reference.</span></p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec104"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">As soon as you click on the </span><span class="strong"><strong><span class="koboSpan" id="kobo.18.1">ReScale</span></strong></span><span class="koboSpan" id="kobo.19.1"> button on the screen, you will notice both the axes rescale while all the ticks and grid lines get redrawn accompanied by a smooth transition effect. </span><span class="koboSpan" id="kobo.19.2">In this section, we will focus on how this rescaling works and leave the transition effect for the next chapter, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.20.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.21.1">. </span><span class="koboSpan" id="kobo.21.2">Most of the heavy lifting in this recipe is done by the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">rescale</span></code><span class="koboSpan" id="kobo.23.1"> function defined on line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">function rescale(){ // &lt;-A 
  var max = Math.round(Math.random() * 100); 
         
  xAxis.scale().domain([0, max]); // &lt;-B 
  svg.select("g.x-axis") 
    .transition() 
    .call(xAxis); // &lt;-C 
         
  renderXGridlines(); 
}    
</span></pre><p><span class="koboSpan" id="kobo.27.1">To rescale an axis, we simply will change its domain (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.28.1">B</span></code><span class="koboSpan" id="kobo.29.1">). </span><span class="koboSpan" id="kobo.29.2">If you recall, the scale domain represents the data domain, whereas its range corresponds to visual domain. </span><span class="koboSpan" id="kobo.29.3">Therefore, visual range should remain constant since we are not resizing the SVG canvas. </span><span class="koboSpan" id="kobo.29.4">Once this is updated, we call the axis function </span><code class="literal"><span class="koboSpan" id="kobo.30.1">xAxis</span></code><span class="koboSpan" id="kobo.31.1"> again by passing in the </span><code class="literal"><span class="koboSpan" id="kobo.32.1">svg:g</span></code><span class="koboSpan" id="kobo.33.1"> element for the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.34.1">x</span></em></span><span class="koboSpan" id="kobo.35.1"> axis (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.36.1">C</span></code><span class="koboSpan" id="kobo.37.1">); this simple call will take care of the axis updating, and hence, our job with the axis is done. </span><span class="koboSpan" id="kobo.37.2">In the next step, we will also need to update and redraw all the grid lines since the domain change will also change all the ticks:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.38.1">function renderXGridlines(){ 
        d3.selectAll("g.x-axis g.tick") 
                .select("line.grid-line") 
                .remove(); // &lt;-D 
                 
        d3.selectAll("g.x-axis g.tick") 
                .append("line") 
                    .classed("grid-line", true) 
                    .attr("x1", 0) 
                    .attr("y1", 0) 
                    .attr("x2", 0) 
                    .attr("y2", - yAxisLength); 
} 
</span></pre><p><span class="koboSpan" id="kobo.39.1">This is achieved by removing every grid line by calling the </span><code class="literal"><span class="koboSpan" id="kobo.40.1">remove()</span></code><span class="koboSpan" id="kobo.41.1"> function, as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.42.1">D</span></code><span class="koboSpan" id="kobo.43.1">, and then recreating the grid lines for all the new ticks on the rescaled axes. </span><span class="koboSpan" id="kobo.43.2">This approach effectively keeps all grid lines consistent with the ticks during rescaling.</span></p></div></div></div></div></body></html>