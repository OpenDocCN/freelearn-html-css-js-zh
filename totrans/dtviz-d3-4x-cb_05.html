<html><head></head><body><div><div><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Playing with Axes</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Working with basic axes</li><li class="listitem" style="list-style-type: disc">Customizing ticks</li><li class="listitem" style="list-style-type: disc">Drawing grid lines</li><li class="listitem" style="list-style-type: disc">Dynamic rescaling of axes</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Introduction</h1></div></div></div><p>D3 was initially released without the built-in support of the Axis component. This situation did not last long since axes are the universal building blocks in many Cartesian coordinate system-based visualization projects and one of the most tedious tasks to build from scratch by hand. It quickly became clear that D3 needs to provide built-in support for axes. Therefore, it was introduced quite early on and is continuously being enhanced ever since it was released. In this chapter, we will explore the usage of the Axis component and some related techniques.</p></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Working with basic axes</h1></div></div></div><p>In this recipe, we will focus on introducing the basic concepts and supports of the Axis component in D3 while we cover different types and features of Axis as well as their <code class="literal">SVG</code> structures.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec93"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/basic-axes.html">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/basic-axes.html
</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec94"/>How to do it...</h2></div></div></div><p>Let's first take a look at the following code sample:</p><pre class="programlisting">&lt;div class="control-group"&gt; 
    &lt;button onclick="renderAll(d3.axisBottom)"&gt; 
        horizontal bottom 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisTop)"&gt; 
        horizontal top 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisLeft)"&gt; 
        vertical left 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisRight)"&gt; 
        vertical right 
    &lt;/button&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        offset = 50, 
        axisWidth = width - 2 * margin, 
        svg; 
     
    function createSvg(){ // &lt;-A 
         svg = d3.select("body").append("svg") // &lt;-B 
            .attr("class", "axis") // &lt;-C 
            .attr("width", width) 
            .attr("height", height); 
    } 
     
    function renderAxis(fn, scale, i){ 
        var axis = fn() // &lt;-D 
            .scale(scale) // &lt;-E 
            .ticks(5); // &lt;-G 
         
        svg.append("g")         
            .attr("transform", function(){ // &lt;-H 
                if([d3.axisTop, d3.axisBottom].indexOf(fn) &gt;= 0) 
                    return "translate(" + margin + "," +  
                                              i * offset + ")"; 
                else 
                    return "translate(" + i * offset + ", " +  
                                              margin + ")"; 
            }) 
            .call(axis); // &lt;-I 
    } 
     
    function renderAll(fn){ 
        if(svg) svg.remove(); 
         
        createSvg(); 
         
        renderAxis(fn, d3.scaleLinear() 
                    .domain([0, 1000]) 
                    .range([0, axisWidth]), 1); 
        renderAxis(fn, d3.scalePow() 
                    .exponent(2) 
                    .domain([0, 1000]) 
                    .range([0, axisWidth]), 2); 
        renderAxis(fn, d3.scaleTime() 
                    .domain([new Date(2016, 0, 1),  
                             new Date(2017, 0, 1)]) 
                    .range([0, axisWidth]), 3); 
    } 
&lt;/script&gt; 
</pre><p>The preceding code produces a visual output with only the four buttons shown in the following screenshot; when you click on <strong>horizontal bottom</strong>, it will show you the following:</p><p>
</p><div><img src="img/image_05_001.jpg" alt="How to do it..."/></div><p>
</p><p>Horizontal axis</p><p>The following screenshot shows what it looks like when you click the <strong>vertical right</strong> button:</p><p>
</p><div><img src="img/image_05_002.jpg" alt="How to do it..."/></div><p>
</p><p>Vertical axis</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec95"/>How it works...</h2></div></div></div><p>The first step in this recipe is to create the <code class="literal">svg</code> element, which will be used to render our axes. This is done using the <code class="literal">createSvg</code> function, which is defined on line <code class="literal">A</code>, and the D3 <code class="literal">append</code> and <code class="literal">attr</code> modifier functions, shown on lines <code class="literal">B</code> and <code class="literal">C</code>.</p><div><div><h3 class="title"><a id="note53"/>Note</h3><p>This is the first recipe in this book that uses SVG instead of HTML element since D3 Axis component supports only SVG. If you are not familiar with SVG standard, don't worry, we will cover it in detail in <a class="link" href="ch07.html" title="Chapter 7. Getting into Shape">Chapter 7</a>, <em>Getting into Shape</em>. Although, for the purpose of this chapter, some of the basic and limited SVG concepts will be introduced when used by the D3 Axis component.</p></div></div><p>Let's take a look at how we created the SVG canvas in the following code snippet:</p><pre class="programlisting">var height = 500,  
  width = 500,  
  margin = 25, 
  offset = 50, 
  axisWidth = width - 2 * margin, 
  svg; 
     
function createSvg(){ // &lt;-A 
     svg = d3.select("body").append("svg") // &lt;-B 
        .attr("class", "axis") // &lt;-C 
        .attr("width", width) 
        .attr("height", height); 
}  
</pre><p>Now, we are ready to render the axes on this <code class="literal">svg</code> canvas. The <code class="literal">renderAxis</code> function is designed to do exactly just that. On line <code class="literal">D</code>, we first create an Axis component using the given D3 axis generator function. D3 version 4.x is shipped with four built-in axis generators for different orientations. Orientation tells D3 how a given axis will be placed, and therefore, how it should be rendered; for example, whether horizontally or vertically. The four axis orientations that D3 supports out of box are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">d3.axisTop</code>: A horizontal axis with labels placed on top of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">d3.axisBottom</code>: A horizontal axis with labels placed at the bottom of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">d3.axisLeft</code>: A vertical axis with labels placed on the left-hand side of the axis</li><li class="listitem" style="list-style-type: disc"><code class="literal">d3.axisRight</code>: A vertical axis with labels placed on the right-hand side of the axis</li></ul></div><p>You can see in the following code snippet that these are indeed the functions that get passed to the <code class="literal">renderAll</code> function when you click on the specified buttons:</p><pre class="programlisting">&lt;div class="control-group"&gt; 
    &lt;button onclick="renderAll(d3.axisBottom)"&gt; 
        horizontal bottom 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisTop)"&gt; 
        horizontal top 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisLeft)"&gt; 
        vertical left 
    &lt;/button&gt; 
    &lt;button onclick="renderAll(d3.axisRight)"&gt; 
        vertical right 
    &lt;/button&gt; 
&lt;/div&gt; 
... 
function renderAxis(fn, scale, i){ 
        var axis = fn() // &lt;-D 
            .scale(scale) // &lt;-E 
            .ticks(5); // &lt;-G 
... 
</pre><p>D3 Axis is designed to work out of the box with D3 scales. The axis scale is provided using the <code class="literal">scale()</code> function (refer to line <code class="literal">E</code>). In this example, we render three different axes with the following scales:</p><pre class="programlisting">d3.scaleLinear().domain([0, 1000]).range([0, axisWidth]) 
d3.scalePow().exponent(2).domain([0, 1000]).range([0, axisWidth]) 
d3.scaleTime() 
  .domain([new Date(2016, 0, 1), new Date()]) 
  .range([0, axisWidth]) 
</pre><p>On line <code class="literal">G</code>, we set the number of ticks, the small marks on the axes, to <code class="literal">5</code>. This tells D3 ideally how many ticks we want to render for this axis; however, D3 might choose to render slightly more or less ticks based on the available space and its own calculation. We will explore the Axis ticks' configuration in detail in the next recipe.</p><p>Once the axis is defined, the final step in this creation process is to create an <code class="literal">svg:g</code> container element, which will then be used to host all SVG structures that are required to render an axis:</p><pre class="programlisting">svg.append("g")         
  .attr("transform", function(){ // &lt;-H 
    if(["top", "bottom"].indexOf(orient) &gt;= 0) 
      return "translate(" + margin + ","+ i * offset + ")"; 
    else 
      return "translate(" + i * offset + ", " + margin + ")"; 
    }) 
    .call(axis); // &lt;-I 
</pre><div><div><h3 class="title"><a id="note54"/>Note</h3><p>Having a <code class="literal">g</code> container group element to contain all SVG elements related to an axis is not only a good practice but also a requirement of the D3 axis component.</p></div></div><p>Most of the logic in this code snippet is related to the calculation of where to draw the axis on the <code class="literal">svg</code> canvas using the <code class="literal">transform</code> attribute (refer to line <code class="literal">H</code>). In the preceding code example, to shift the axis using offsets, we used the <code class="literal">translate</code> SVG transformation, which allows us to shift an element using a distance parameter that is defined with the coordinates in <em>x</em> and <em>y</em>.</p><div><div><h3 class="title"><a id="note55"/>Note</h3><p>SVG transformation will be discussed in detail in <a class="link" href="ch07.html" title="Chapter 7. Getting into Shape">Chapter 7</a>, <em>Getting into Shape</em>, or you can refer to the following URL for more information on this topic:
<a class="ulink" href="https://www.w3.org/TR/SVG/coords.html#TranslationDefined">https://www.w3.org/TR/SVG/coords.html#TranslationDefined
</a>
</p></div></div><p>The more relevant part of this code is on line <code class="literal">I</code>, where the <code class="literal">d3.selection.call</code> function is used with the <code class="literal">axis</code> object being passed in as the parameter. The <code class="literal">d3.selection.call</code> function invokes the given function (in our case, the <code class="literal">axis</code> object) with the current selection passed in as an argument. In other words, the function being passed into the <code class="literal">d3.selection.call</code> function should have the following form:</p><pre class="programlisting">function foo(selection) { 
  ... 
} 
</pre><div><div><h3 class="title"><a id="note56"/>Note</h3><p>The <code class="literal">d3.selection.call</code> function also allows you to pass in additional arguments to the invoking function. For more information, visit the following link:
<a class="ulink" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_call">https://github.com/d3/d3-selection/blob/master/README.md#selection_call
</a>
</p></div></div><p>Once the D3 Axis component is called, it will take care of the rest and automatically create all necessary SVG elements for an axis (refer to line <code class="literal">I</code>). For example, the horizontal-bottom time axis in the example shown in this recipe has the following complicated SVG structure automatically generated, which we don't really need to know much about:</p><p>
</p><div><img src="img/image_05_003.jpg" alt="How it works..."/></div><p>
</p><p>Horizontal bottom time Axis SVG structure</p></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Customizing ticks</h1></div></div></div><p>We already saw how to use the <code class="literal">ticks</code> function in the previous recipe. This is the simplest ticks-related customization you can do on a D3 axis. In this recipe, we will cover some of the most common and useful ticks-related customizations with D3 axis.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec96"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/ticks.html">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/ticks.html
</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec97"/>How to do it...</h2></div></div></div><p>In the following code example, we will customize the ticks, padding, and formatting of its label. Let's take a look at the code snippet first:</p><pre class="programlisting">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        axisWidth = width - 2 * margin; 
     
    var svg = d3.select("body").append("svg") 
            .attr("class", "axis") 
            .attr("width", width) 
            .attr("height", height); 
     
    var scale = d3.scaleLinear() 
            .domain([0, 1]).range([0, axisWidth]); 
     
    var axis = d3.axisBottom() 
            .scale(scale) 
            .ticks(10) 
            .tickSize(12) // &lt;-A 
            .tickPadding(10) // &lt;-B 
            .tickFormat(d3.format(".0%")); // &lt;-C 
 
    svg.append("g")         
        .attr("transform", function(){ 
            return "translate(" + margin + 
                    "," + margin + ")"; 
        }) 
        .call(axis); 
&lt;/script&gt; 
</pre><p>The preceding code generates the following visual output:</p><p>
</p><div><img src="img/image_05_004.jpg" alt="How to do it..."/></div><p>
</p><p>Customized axis ticks</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec98"/>How it works...</h2></div></div></div><p>The focus of this recipe is the highlighted lines after the <code class="literal">ticks</code> function. As we have mentioned before, the <code class="literal">ticks</code> function provides D3 a hint on how many ticks an axis should contain. After setting the number of ticks, in this recipe, we continue to customize the ticks through further function calls. On line <code class="literal">A</code>, the <code class="literal">tickSize</code> function is used to customize the size of the ticks. The default tick size provided by D3 is <code class="literal">6px</code>, whereas we set it to <code class="literal">12px</code> in this example. Then, on line <code class="literal">B</code>, the <code class="literal">tickPadding</code> function was used to specify the amount of space (in pixels) between tick labels and the axis.</p><p>Finally, a custom format was used with the <code class="literal">tickFormat</code> function on line <code class="literal">C</code> to convert the tick value into percentage. D3 axis' <code class="literal">tickFormat</code> function can also take a function as a formatter for more customization, and therefore, the formatter used in this recipe is the same as passing, in the following custom format function:</p><pre class="programlisting">.tickFormat(function(v){ // &lt;-C 
    return Math.floor(v * 100) + "%"; 
}); 
</pre><div><div><h3 class="title"><a id="note57"/>Note</h3><p>For more information on the aforementioned functions and other ticks-related customizations, visit the D3 Wiki at the following URL:
<a class="ulink" href="https://github.com/d3/d3-axis/blob/master/README.md#_axis">https://github.com/d3/d3-axis/blob/master/README.md#_axis
</a>
</p></div></div></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Drawing grid lines</h1></div></div></div><p>Quite often, we will need horizontal and vertical grid lines to be drawn in consistency with the ticks on both <em>x</em> and <em>y</em> axes. As we have shown in the previous recipe, typically, we don't have, or don't want to have, precise control of how ticks are rendered on D3 axes. Therefore, we might not know how many ticks are present and their values, before they are rendered. This is especially true if you are building a reusable visualization library, where it is impossible to know the tick configuration ahead of its time. In this recipe, we will explore some useful techniques for drawing consistent grid lines on Axis without actually needing to know the tick values.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec99"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/grid-line.html">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/grid-line.html
</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec100"/>How to do it...</h2></div></div></div><p>First, let's take a look at how we draw grid lines in the following code:</p><pre class="programlisting">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25;        
     
    var svg = d3.select("body").append("svg") 
            .attr("class", "axis") 
            .attr("width", width) 
            .attr("height", height); 
     
    function renderXAxis(){ 
        var axisLength = width - 2 * margin; 
     
        var scale = d3.scaleLinear() 
                        .domain([0, 100]) 
                        .range([0, axisLength]); 
         
        var xAxis = d3.axisBottom() 
                .scale(scale); 
                 
        svg.append("g")        
            .attr("class", "x-axis") 
            .attr("transform", function(){ // &lt;-A 
                return "translate(" + margin + "," +  
                                 (height - margin) + ")"; 
            }) 
            .call(xAxis); 
             
        d3.selectAll("g.x-axis g.tick") // &lt;-B 
            .append("line") // &lt;-C 
                .classed("grid-line", true) 
                .attr("x1", 0) // &lt;-D 
                .attr("y1", 0) 
                .attr("x2", 0) 
                .attr("y2", - (height - 2 * margin));  // &lt;-E 
    } 
     
    function renderYAxis(){         
        var axisLength = height - 2 * margin; 
     
        var scale = d3.scaleLinear() 
                        .domain([100, 0]) 
                        .range([0, axisLength]); 
     
        var yAxis = d3.axisLeft() 
                .scale(scale); 
 
        svg.append("g")        
            .attr("class", "y-axis") 
            .attr("transform", function(){ 
                return "translate(" + margin + "," +  
                                              margin + ")"; 
            }) 
            .call(yAxis); 
             
        d3.selectAll("g.y-axis g.tick") 
            .append("line") 
                .classed("grid-line", true) 
                .attr("x1", 0) 
                .attr("y1", 0) 
                .attr("x2", axisLength) // &lt;-F 
                .attr("y2", 0); 
    }    
     
    renderYAxis(); 
    renderXAxis(); 
&lt;/script&gt; 
</pre><p>The previous code generates the following visual output:</p><p>
</p><div><img src="img/image_05_005.jpg" alt="How to do it..."/></div><p>
</p><p>Axes and grid lines</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec101"/>How it works...</h2></div></div></div><p>In this recipe, two axes-<em>x</em> and <em>y-</em>were created in the <code class="literal">renderXAxis</code> and <code class="literal">renderYAxis</code> functions, respectively. Let's take a look at how the x axis was rendered.</p><p>Once you understand how to render the <em>x</em> axis and its grid lines, the logic used to render the <em>y</em> axis can be easily understood since the logic used is almost identical. The <em>x</em> axis and its scale were defined without complications, as we have already demonstrated them a number of times throughout this chapter. An <code class="literal">svg:g</code> element was created to contain the <em>x</em> axis structures. This <code class="literal">svg:g</code> element was placed at the bottom of the chart using a translate transformation, as shown on line <code class="literal">A</code>:</p><pre class="programlisting">.attr("transform", function(){ // &lt;-A 
  return "translate(" + margin + "," + (height - margin) + ")"; 
}) 
</pre><p>It is important to remember that the translate transformation changes the frame of reference for coordinates when it comes to any of its subelements. For example, within this <code class="literal">svg:g</code> element, if we create a point with its coordinates set as <code class="literal">(0, 0)</code>, then when we draw this point on the SVG canvas, it will be actually placed as <code class="literal">(margin, height - margin)</code>. This is because all subelements within the <code class="literal">svg:g</code> element are automatically transformed to this base coordinate, and hence leading to the shift of the frame of reference. Equipped with this understanding, let's take a look at how dynamic grid lines can be generated after the axis is rendered through the following code snippet:</p><pre class="programlisting">d3.selectAll("g.x-axis g.tick") // &lt;-B 
            .append("line") // &lt;-C 
                .classed("grid-line", true) 
                .attr("x1", 0) // &lt;-D 
                .attr("y1", 0) 
                .attr("x2", 0) 
                .attr("y2", - (height - 2 * margin));  // &lt;-E 
</pre><p>Once the axis is rendered, we can select all the ticks elements on an axis by selecting the <code class="literal">g.tick</code>, since each of them is grouped by its own <code class="literal">svg:g</code> element (refer to line <code class="literal">B</code>). Then, on line <code class="literal">C</code>, we append a new <code class="literal">svg:line</code> element to each of the <code class="literal">svg:g</code> tick element. SVG line element is the simplest shape provided by the SVG standard. It has the following four main attributes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">x1</code> and <code class="literal">y1</code> attributes define the point of origin of this line</li><li class="listitem" style="list-style-type: disc"><code class="literal">x2</code> and <code class="literal">y2</code> attributes define the point of destination</li></ul></div><p>In our case, we simply will need to set <code class="literal">x1</code>, <code class="literal">y1</code>, and <code class="literal">x2</code> to <code class="literal">0</code> since each <code class="literal">g.tick</code> element is already translated to its position on the axis, and therefore, we only need to change the <code class="literal">y2</code> attribute in order to draw a vertical grid line. The <code class="literal">y2</code> attribute is set to <code class="literal">-(height - 2 * margin)</code>. The reason why the coordinate is negative was because the entire <code class="literal">g.x-axis</code> has been shifted down to <code class="literal">(height - margin)</code>, as mentioned in the previous code. Therefore, in absolute coordinate terms, <code class="literal">y2 =</code>
<code class="literal">(height - margin)</code>
<code class="literal">- (height - 2 * margin) = margin</code>, which is the top of the vertical grid line we want to draw from the <em>x</em> axis.</p><div><div><h3 class="title"><a id="note58"/>Note</h3><p>In SVG coordinates, <code class="literal">(0, 0)</code> denotes the top-left corner of the SVG canvas.</p></div></div><p>This is what the <em>x</em> axis in the SVG structure with an associated grid line looks like:</p><p>
</p><div><img src="img/image_05_006.jpg" alt="How it works..."/></div><p>
</p><p>X-axis with grid lines SVG structure</p><p>As we can see in the preceding screenshot, an <code class="literal">svg:line</code> element representing the grid line was added into the <code class="literal">g.ticksvg:g</code> container element as discussed earlier in this section.</p><p>The <em>y</em> axis grid lines are generated using the <em>identical technique</em>; the only difference is that instead of setting the <code class="literal">y2</code> attribute on the grid lines, as we did for the <em>x</em> axis, we change the <code class="literal">x2</code> attribute since the lines are horizontal (refer to line <code class="literal">F</code>):</p><pre class="programlisting">d3.selectAll("g.y-axis g.tick") 
            .append("line") 
                .classed("grid-line", true) 
                .attr("x1", 0) 
                .attr("y1", 0) 
                .attr("x2", axisLength) // &lt;-F 
                .attr("y2", 0); 
</pre></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Dynamic rescaling of axes</h1></div></div></div><p>In some cases, the scale used by axes might change when triggered by user interaction or changes from data feeds. For example, a user may change the time range for the visualization. This kind of change also needs to be reflected by rescaling the axes. In this recipe, we will explore how this can be achieved dynamically while also redrawing the grid lines associated with each tick.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec102"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/rescaling.html">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter5/rescaling.html
</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec103"/>How to do it...</h2></div></div></div><p>The following is the code that shows how to perform dynamic rescaling:</p><pre class="programlisting">&lt;script type="text/javascript"&gt; 
    var height = 500,  
        width = 500,  
        margin = 25, 
        xAxis, yAxis, xAxisLength, yAxisLength; 
     
    var svg = d3.select("body").append("svg")      
            .attr("class", "axis")     
            .attr("width", width) 
            .attr("height", height); 
     
    function renderXAxis(){ 
        xAxisLength = width - 2 * margin; 
            var scale = d3.scaleLinear() 
                        .domain([0, 100]) 
                        .range([0, xAxisLength]); 
        
        xAxis = d3.axisBottom() 
                .scale(scale); 
                 
        svg.append("g")        
            .attr("class", "x-axis") 
            .attr("transform", function(){  
                return "translate(" + margin + "," +  
                                  (height - margin) + ")"; 
            }) 
            .call(xAxis); 
    } 
     
    ... 
             
    function rescale(){ // &lt;-A 
        var max = Math.round(Math.random() * 100); 
         
        xAxis.scale().domain([0, max]); // &lt;-B 
        svg.select("g.x-axis") 
            .transition() 
            .call(xAxis); // &lt;-C 
             
        yAxis.scale().domain([max, 0]); 
        svg.select("g.y-axis") 
            .transition() 
            .call(yAxis); 
         
        renderXGridlines(); 
        renderYGridlines(); 
    }        
     
    function renderXGridlines(){ 
        d3.selectAll("g.x-axis g.tick") 
                .select("line.grid-line") 
                .remove(); // &lt;-D 
                 
        d3.selectAll("g.x-axis g.tick") 
                .append("line") 
                    .classed("grid-line", true) 
                    .attr("x1", 0) 
                    .attr("y1", 0) 
                    .attr("x2", 0) 
                    .attr("y2", - yAxisLength); 
    } 
     
    ... 
     
    renderXAxis(); 
renderXGridlines(); 
... 
&lt;/script&gt; 
</pre><p>The preceding code generates the following effects:</p><p>
</p><div><img src="img/image_05_007.jpg" alt="How to do it..."/></div><p>
</p><p>Dynamic axes rescaling</p><div><div><h3 class="title"><a id="note59"/>Note</h3><p>Due to the limited space in this book, the <em>y</em> axis-related code is omitted from the code example in this recipe. Refer to the code example available online for a complete reference.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec104"/>How it works...</h2></div></div></div><p>As soon as you click on the <strong>ReScale</strong> button on the screen, you will notice both the axes rescale while all the ticks and grid lines get redrawn accompanied by a smooth transition effect. In this section, we will focus on how this rescaling works and leave the transition effect for the next chapter, <em>Transition with Style</em>. Most of the heavy lifting in this recipe is done by the <code class="literal">rescale</code> function defined on line <code class="literal">A</code>:</p><pre class="programlisting">function rescale(){ // &lt;-A 
  var max = Math.round(Math.random() * 100); 
         
  xAxis.scale().domain([0, max]); // &lt;-B 
  svg.select("g.x-axis") 
    .transition() 
    .call(xAxis); // &lt;-C 
         
  renderXGridlines(); 
}    
</pre><p>To rescale an axis, we simply will change its domain (refer to line <code class="literal">B</code>). If you recall, the scale domain represents the data domain, whereas its range corresponds to visual domain. Therefore, visual range should remain constant since we are not resizing the SVG canvas. Once this is updated, we call the axis function <code class="literal">xAxis</code> again by passing in the <code class="literal">svg:g</code> element for the <em>x</em> axis (refer to line <code class="literal">C</code>); this simple call will take care of the axis updating, and hence, our job with the axis is done. In the next step, we will also need to update and redraw all the grid lines since the domain change will also change all the ticks:</p><pre class="programlisting">function renderXGridlines(){ 
        d3.selectAll("g.x-axis g.tick") 
                .select("line.grid-line") 
                .remove(); // &lt;-D 
                 
        d3.selectAll("g.x-axis g.tick") 
                .append("line") 
                    .classed("grid-line", true) 
                    .attr("x1", 0) 
                    .attr("y1", 0) 
                    .attr("x2", 0) 
                    .attr("y2", - yAxisLength); 
} 
</pre><p>This is achieved by removing every grid line by calling the <code class="literal">remove()</code> function, as shown on line <code class="literal">D</code>, and then recreating the grid lines for all the new ticks on the rescaled axes. This approach effectively keeps all grid lines consistent with the ticks during rescaling.</p></div></div></div></div></body></html>