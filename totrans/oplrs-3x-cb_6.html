<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Theming</h1></div></div></div><p>In this chapter we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding how themes work using the<code class="literal"> img</code> folder</li><li class="listitem" style="list-style-type: disc">Understanding how themes work using the<code class="literal"> theme</code> folder</li><li class="listitem" style="list-style-type: disc">Delimiting tiles in a raster layer</li><li class="listitem" style="list-style-type: disc">Creating a new OpenLayers theme</li><li class="listitem" style="list-style-type: disc">Starting actions outside the controls</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Introduction</h1></div></div></div><p>It is worth mentioning that in software applications, the first impressions are the most important things, and they are given by two factors: the look and feel.</p><p>This chapter is all oriented to show how we can improve the look and feel of our web mapping application by theming OpenLayers.<a class="indexterm" id="id253"/>
</p><p>As many other web applications, the look and feel of the OpenLayers library is controlled using images and CSS classes, which define the position, dimensions, and visual aspects of any OpenLayers component.</p><p>At this moment, with the Version 2.11, we can find the<code class="literal"> img</code> and<code class="literal"> theme</code> folders within the bundle distribution, and both are used to control the look of the OpenLayers applications.</p><div><h3 class="title"><a id="tip05"/>Tip</h3><p>Remember to place these folders in your project when using OpenLayers as mentioned in the<em> Different ways to include OpenLayers</em> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <em> Web Mapping Basics.</em>
</p></div><div><img alt="Introduction" src="img/7843_06_01.jpg"/></div><p>The<code class="literal"> theme</code> folder contains CSS files, as well as some images used within the CSS, while the<code class="literal"> img</code> folder contains only images, used by some controls in a more hardcoded (and not recommended) way.</p><p>We can say, the use of the<code class="literal"> theme</code> folder with CSS styles is the preferred way to implement controls, while the use of the<code class="literal"> img</code> folder remains for those controls that are not updated to work with CSS styles.</p><p>Becoming a<em> great</em> web designer is out of the scope of this book, but it is true that if we want to tune up the OpenLayers appearance a bit, we need to have some knowledge of HTML and how CSS works.</p><div><h3 class="title"><a id="note53"/>Note</h3><p>We can find a description of the CSS standard at<a class="ulink" href="http://en.wikipedia.org/wiki/Cascading_Style_Sheets"> http://en.wikipedia.org/wiki/Cascading_Style_Sheets</a> but we can find tons of great tutorials looking on the Net, such as<a class="ulink" href="http://www.csstutorial.net"> http://www.csstutorial.net</a>.</p></div><p>The browsers work with three main technologies: HTML, CSS, and JavaScript. Summarized in really short sentences, we can say:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">HTML defines the content of a web page using paragraphs, titles, sections, and so on.</li><li class="listitem" style="list-style-type: disc">CSS defines the visual aspects of the HTML elements, that is, which text color a paragraph must use, the text size of a title, and so on.</li><li class="listitem" style="list-style-type: disc">Finally, JavaScript is a programming language processed by the browser that can be used to manipulate dynamically any aspect of the page. For example, we can add new HTML elements, change CSS, and check if the fields in a form are valid before sending it to the server.</li></ul></div><div><h3 class="title"><a id="note54"/>Note</h3><p>The<strong> Document Object Model (DOM)</strong>  is a standard for accessing and manipulating HTML documents. We can think it decomposes an HTML document like a tree of elements and attributes.</p><p>See:<a class="ulink" href="http://www.w3schools.com/htmldom/default.asp"> http://www.w3schools.com/htmldom/default.asp</a>
</p></div><p>OpenLayers belongs to the third category. It is a JavaScript library that allows us to create web mapping applications using concepts such as maps, layers, or features, but abstracting us from the HTML DOM elements and the CSS aspects required to render them.<a class="indexterm" id="id254"/>
</p><p>When we create an OpenLayers component, such as a map, a layer, or a control instance, it also creates the required HTML elements to render them and puts them at the right place of the DOM structure of our HTML page.</p><p>The goal of this chapter is to show how to theme the most important OpenLayers components. So, using many of the next recipes, we will be able to create a fresh web-mapping application with a customized look.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Understanding how themes work using the img folder</h1></div></div></div><div><img alt="Understanding how themes work using the img folder" src="img/7843_06_02.jpg"/></div><p>As explained in the<em> Introduction</em> section of this chapter, there are controls that are themed simply using the images stored in the<code class="literal"> img</code> folder.<a class="indexterm" id="id255"/>
</p><p>This way is the oldest way to theme a control, and for newer implementations, the preferred way of theming is using CSS, that is, using the<code class="literal"> theme</code> folder.</p><p>Until its update, we could make use of controls that work with any of the two forms of theming, so it is important to know how to theme both.</p><p>In this recipe, we are going to describe how to theme the<code class="literal"> PanZoomBar</code> control that uses the old way based on the images in the<code class="literal"> img</code> folder.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec01"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file with OpenLayers dependencies and start adding in the body element of the document, the<code class="literal"> div</code> element to hold the map:<div><pre class="programlisting">&lt;div id="ch06_theming_img" style="width: 100%; height: 90%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Now, add the following JavaScript code to initialize the map and add a base layer:<a class="indexterm" id="id256"/><div><pre class="programlisting">    var map = new OpenLayers.Map("ch06_theming_img ");    
    var osm = new OpenLayers.Layer.OSM();        
    map.addLayer(osm);
    map.setCenter(new OpenLayers.LonLat(0, 0), 2);
</pre></div></li><li class="listitem">Finally, simply create an<code class="literal"> OpenLayers.Control.PanZoomBar</code> control instance and add to the map:<div><pre class="programlisting">var panZoomBar = new OpenLayers.Control.PanZoomBar();
map.addControl(panZoomBar);
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec02"/>How it works...</h3></div></div></div><p>When we create the control, what really happens is OpenLayers automatically creates a set of HTML elements and places them in the page's DOM structure.<a class="indexterm" id="id257"/>
</p><p>From the OpenLayers' JavaScript API perspective, it is simply adding a control component to the map but from the HTML code point of view, it means that a complex set of elements is created on the page to represent all the buttons and images required to look like a nice pan and zoom control:</p><div><pre class="programlisting">&lt;div id="OpenLayers.Control.PanZoomBar_71" style="... left: 4px; top: 4px; ..." class="olControlPanZoomBar olControlNoSelect" ...&gt; 
    &lt;div id="OpenLayers.Control.PanZoomBar_71_panup" ...&gt; 
        &lt;img id="OpenLayers.Control.PanZoomBar_71_panup_innerImage" ... src="img/north-mini.png"&gt; 
    &lt;/div&gt; 
    &lt;div id="OpenLayers.Control.PanZoomBar_71_panleft" ...&gt; 
        &lt;img id="OpenLayers.Control.PanZoomBar_71_panleft_innerImage" ... src="img/west-mini.png"&gt; 
    &lt;/div&gt; 
     &lt;div id="OpenLayers.Control.PanZoomBar_71_panright" ...&gt; 
        &lt;img id="OpenLayers.Control.PanZoomBar_71_panright_innerImage" ... src="img/east-mini.png"&gt; 
    &lt;/div&gt; 
     &lt;div id="OpenLayers.Control.PanZoomBar_71_pandown" ...&gt; 
        &lt;img id="OpenLayers.Control.PanZoomBar_71_pandown_innerImage" ... src="img/south-mini.png"&gt; 
    &lt;/div&gt; 
    &lt;div id="OpenLayers.Control.PanZoomBar_71_zoomin" ...&gt; 
        &lt;img id="OpenLayers.Control.PanZoomBar_71_zoomin_innerImage" ... src="img/zoom-plus-mini.png"&gt; 
    &lt;/div&gt; 
&lt;/div&gt;
</pre></div><p>Looking at the generated code we can say that:<a class="indexterm" id="id258"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The main control element uses a CSS class named<code class="literal"> olControlPanZoomBar</code><a class="indexterm" id="id259"/></li><li class="listitem" style="list-style-type: disc">All the images used are loaded from the OpenLayers<code class="literal"> img</code> folder, such as<code class="literal"> img/north-mini.png, img/east-mini.png</code> and<code class="literal"> img/zoom-minus-mini.png</code></li><li class="listitem" style="list-style-type: disc">The position of the control, and its buttons, are set in the<code class="literal"> style</code> attribute instead of using a CSS class</li></ul></div><p>The conclusion is trivial: a change in the look of this control can only be done by changing the images in the<code class="literal"> img</code> folder.</p><p>In addition, if we want to place the control at a different position, we need to play with the<code class="literal"> OpenLayers.Control.PanZoom.X</code> and<code class="literal"> OpenLayers.Control.PanZoom.Y</code> properties, which are used to set the value of the<code class="literal"> top</code> and<code class="literal"> left</code> properties in the<code class="literal"> style</code> attribute of the main control HTML element. For example, setting:</p><div><pre class="programlisting">OpenLayers.Control.PanZoom.X = 50;
</pre></div><p>Produces an HTML code as follows:</p><div><pre class="programlisting">&lt;div id="OpenLayers.Control.PanZoomBar_71" style="position: absolute; left: 50px; top: 4px; ...
</pre></div><p>This means, although you redefine the properties<code class="literal"> top</code> and<code class="literal"> left</code> in the<code class="literal"> olControlPanZoomBar</code> class, they will not take effect because the properties specified in the<code class="literal"> style</code> attribute take precedence:</p><div><pre class="programlisting">.olControlPanZoomBar { 
    top: 50px; 
    left: 50px; 
}
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec03"/>There's more...</h3></div></div></div><p>There are a couple of important things to note.<a class="indexterm" id="id260"/>
</p><p>First, every OpenLayers instance has an ID property. We can set it manually when creating the instance or leave OpenLayers to compute one for us, but take into account that the ID must be unique.</p><p>In this case, the ID for the<code class="literal"> PanZoomBar</code> control is the string<code class="literal"> OpenLayers.Control.PanZoomBar_71</code> and it is also used to identify the HTML elements.</p><p>Second, if a control makes use of a CSS class, by convention, the name of the class will be<code class="literal"> olControl</code> followed by the name of the control, such as:<code class="literal"> olControlPanZoomBar</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec04"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding how themes work using the theme folder</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Adding and removing controls</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec03"/>Understanding how themes work using the theme folder</h1></div></div></div><p>As we have explained in the chapter's introduction, there are some OpenLayers controls strongly based on CSS classes to be the theme.<a class="indexterm" id="id261"/>
</p><p>In this group, we can find the<code class="literal"> PanPanel</code> control, a small control formed by a set of four buttons that allows the user to pan the map in four directions:</p><div><img alt="Understanding how themes work using the theme folder" src="img/7843_06_03.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec05"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML page and add the OpenLayers library dependencies:<a class="indexterm" id="id262"/><div><pre class="programlisting">&lt;script type="text/javascript" src="img/OpenLayers.js"&gt;&lt;/script&gt;
</pre></div></li><li class="listitem">After this, we need to include the CSS file with the theme to be used. Here we are using the default theme:<div><pre class="programlisting">&lt;link rel="stylesheet" href="./js/OpenLayers-2.11/theme/default/style.css" type="text/css"&gt;
</pre></div></li><li class="listitem">Within the<code class="literal"> body</code> element of the document, add the<code class="literal"> div</code> element to hold the map:<div><pre class="programlisting">&lt;div id="ch06_theming_theme" style="width: 100%; height: 90%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Within a<code class="literal"> script</code> element, add the code to create the map with a base layer:<div><pre class="programlisting">    var map = new OpenLayers.Map("ch06_theming_img ");    
    var osm = new OpenLayers.Layer.OSM();        
    map.addLayer(osm);
    map.setCenter(new OpenLayers.LonLat(0, 0), 2);
</pre></div></li><li class="listitem">Finally, create an<code class="literal"> OpenLayers.Control.PanPanel</code> instance and add it to the map:<div><pre class="programlisting">var panControl = new OpenLayers.Control.PanPanel(); 
map.addControl(panControl);
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec06"/>How it works...</h3></div></div></div><p>When the<code class="literal"> OpenLayers.Control.PanPanel</code> instance is added to the map, what really happens is a set of new HTML elements are added to the DOM page structure:<a class="indexterm" id="id263"/>
</p><div><pre class="programlisting">&lt;div id="OpenLayers.Control.PanPanel_71" style="position: absolute; z-index: 1006; " class="olControlPanPanel olControlNoSelect" unselectable="on"&gt; 
    &lt;div class="olControlPanNorthItemInactive"&gt;&lt;/div&gt; 
    &lt;div class="olControlPanSouthItemInactive"&gt;&lt;/div&gt; 
    &lt;div class="olControlPanEastItemInactive"&gt;&lt;/div&gt; 
    &lt;div class="olControlPanWestItemInactive"&gt;&lt;/div&gt; 
&lt;/div&gt;
</pre></div><p>There is one main element for the control that contains other elements representing the four buttons.</p><p>The main HTML element has an attached CSS class with the name<code class="literal"> olControlPanPanel</code>. This class name is automatically created by OpenLayers and follows this convention:<code class="literal"> olControl</code> plus the control name.<a class="indexterm" id="id264"/>
</p><p>All the CSS classes used in the previous HTML code can be found in the source code in the<code class="literal"> theme/default/style.css</code> theme file.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec07"/>There's more...</h3></div></div></div><p>Looking at the CSS classes used by the control, we can understand a bit better how it works.</p><p>First, we change the position of the control by modifying the properties of the CSS class:</p><div><pre class="programlisting">.olControlPanPanel {
    top: 10px;
    left: 5px;
}  
</pre></div><p>Next, CSS code sets the image to be used and the size of the buttons:</p><div><pre class="programlisting">.olControlPanPanel div {
    background-image: url(img/pan-panel.png);
    height: 18px;
    width: 18px;
    cursor: pointer;
    position: absolute;
}
</pre></div><p>We can see how the image sprite is taken from the file<code class="literal"> theme/default/img/pan-panel.png:</code>
</p><div><img alt="There's more..." src="img/7843_06_04.jpg"/></div><div><h3 class="title"><a id="note55"/>Note</h3><p>An<strong> image sprite</strong> is a collection of images put into the same file. Later, using the CSS properties we can get once piece of this image sprite to be used on an element.</p><p>Image sprites reduce the number of requests to the server when a page loads.</p></div><p>Next, each button defines the required properties to extract the piece of image to be used as the button:<a class="indexterm" id="id265"/>
</p><div><pre class="programlisting">.olControlPanPanel .olControlPanSouthItemInactive { 
    top: 36px; 
    left: 9px; 
    background-position: 18px 0; 
}
</pre></div><p>We can see how with little CSS knowledge we can modify almost any desired thing of the control.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec08"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding how themes work using the img folder</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Adding and removing controls</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li><li class="listitem" style="list-style-type: disc">The<em> Creating a simple full screen map</em> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <em> Web Mapping Basics</em></li><li class="listitem" style="list-style-type: disc">The<em> Different ways for including OpenLayers</em> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <em> Web Mapping Basics</em></li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec04"/>Delimiting tiles in a raster layer</h1></div></div></div><p>To show how easy it is to change the appearance of an element using CSS, in this recipe we are going to add a border to all the tiles from any raster layer to show where the limits of each tile are:<a class="indexterm" id="id266"/>
</p><div><img alt="Delimiting tiles in a raster layer" src="img/7843_06_05.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec09"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file with OpenLayers dependencies and add within the<code class="literal"> head</code> section a<code class="literal"> style</code> element with the following CSS code:<a class="indexterm" id="id267"/><div><pre class="programlisting">&lt;style&gt;
    .olTileImage {
        border: 1px solid #999;
    }
&lt;/style&gt;
</pre></div></li><li class="listitem">Next, in the<code class="literal"> body</code> element of the document, add the<code class="literal"> div</code> element to hold the map:<div><pre class="programlisting">&lt;div id="ch06_tile_borders" style="width: 100%; height: 90%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Now, add the following JavaScript code to initialize the map and add a base layer:<div><pre class="programlisting">    var map = new OpenLayers.Map("ch06_tile_borders");    
    var osm = new OpenLayers.Layer.OSM();        
    map.addLayer(osm);
    map.setCenter(new OpenLayers.LonLat(0, 0), 2);
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec10"/>How it works...</h3></div></div></div><p>The code to create the map instance and layer is pretty simple, we have simply created an instance of both and added the layer to the map. Finally, we have centered the map's viewport.<a class="indexterm" id="id268"/>
</p><p>Even though it seems incredible, all the magic of this recipe is in the CSS code at the top:</p><div><pre class="programlisting">    .olTileImage {
        border: 1px solid #999;
    }
</pre></div><p>Every raster layer class uses images to render the tiles of data. To do so, the layer creates some HTML elements and adds them to the DOM structure as follows:</p><div><pre class="programlisting">&lt;div id="OpenLayers.Layer.OSM_315" ... class="olLayerDiv"&gt; 
     &lt;div ...&gt; 
        &lt;img id="OpenLayersDiv335" style="position: relative; width: 256px; height: 256px; " class="olTileImage" ...&gt; 
    &lt;/div&gt; 
    &lt;div ...&gt; 
        &lt;img id="OpenLayersDiv337" style="position: relative; width: 256px; height: 256px; " class="olTileImage" ...&gt; 
    &lt;/div&gt; 
&lt;/div&gt;
</pre></div><p>Every OpenLayers component is transformed in one or more HTML elements that use the CSS classes to define the way they are visualized.</p><p>As you can see, a<code class="literal"> div</code> element is created for the whole layer identified by<code class="literal"> OpenLayers.Layer.OSM_315</code>, which has the class parameter set to<code class="literal"> olLayerDiv</code> CSS. Within it we can find<code class="literal"> img</code> elements that point to the tiles to be rendered. These elements have applied the<code class="literal"> olTileImage</code> class.</p><p>Thanks to the CSS classes in this recipe, we have set a border on each tile by simply specifying the appropriate property.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec11"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding how themes work using the theme folder</em> recipe<a class="indexterm" id="id269"/></li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Creating a new OpenLayers theme</h1></div></div></div><p>There can be situations where we desire a completely different look for the OpenLayers theme.<a class="indexterm" id="id270"/>
</p><p>As we mentioned in the chapter's introduction and other recipes (Understanding<em> how themes work using the img folder</em> and<em> Understanding how themes work using the theme folder)</em>, OpenLayers theming is based on images and CSS files:</p><div><img alt="Creating a new OpenLayers theme" src="img/7843_06_06.jpg"/></div><p>In this recipe we are going to see how we can create a new OpenLayers theme based on the default theme we can find in the<code class="literal"> theme/default</code> folder. We are going to change some aspects of the most common controls, such as scale or scale line, overview map, or layer switcher.<a class="indexterm" id="id271"/>
</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec12"/>Getting ready</h2></div></div></div><p>To create a new theme, we need to create a replica for the content of the<code class="literal"> img</code> and<code class="literal"> theme</code> folders of the OpenLayers distribution. Both folders contain images to be used in controls, so it is easy to see why a good graphic design is important to create a good theme.<a class="indexterm" id="id272"/>
</p><p>The theme called<strong> green theme</strong>, used in this chapter, is divided into folders<code class="literal"> recipes/data/green_img</code> and<code class="literal"> recipes/data/green_theme</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec13"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file. In the<code class="literal"> head</code> section we need to attach, in addition to the dependencies to the OpenLayers library, the CSS stylesheets for our custom theme:<div><pre class="programlisting">    &lt;head&gt; 
        &lt;title&gt;Creating a new OpenLayers theme&lt;/title&gt; 
        &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt; 

        &lt;!-- Include OpenLayers library --&gt; 
        &lt;script type="text/javascript" src="img/OpenLayers.js"&gt;&lt;/script&gt; 
        
        &lt;!-- OpenLayers Theme --&gt; 
        &lt;link rel="stylesheet" href="../../js/OpenLayers-2.11/theme/default/style.css" type="text/css"&gt; 
        
        &lt;!-- Out customer Green Theme --&gt; 
        &lt;link rel="stylesheet" href="../data/green_theme/style.css" type="text/css"&gt; 
</pre></div></li><li class="listitem">Before continuing to see the code at the<code class="literal"> head</code> section, let's write the following code within the<code class="literal"> body</code> section that will hold the map instance and the navigation history tool:<a class="indexterm" id="id273"/><div><pre class="programlisting">    &lt;body onload="init()"&gt; 
        &lt;div id="ch06_theme" style="width: 100%; height: 100%;"&gt;&lt;/div&gt; 
        &lt;div id="history" class="historyClass"&gt;&lt;/div&gt; 
    &lt;/body&gt; 
</pre></div></li><li class="listitem">Again, within the head section, add the following piece of styling code necessary for the previous<code class="literal"> div</code> element used to hold the navigation history tool:<div><pre class="programlisting">        &lt;style&gt; 
            .historyClass { 
                position: absolute; 
                top: 5px; 
                right: 125px; 
                z-index: 9999; 
            } 
        &lt;/style&gt; 
</pre></div></li><li class="listitem">Within the<code class="literal"> script</code> section, add the following JavaScript code that specifies where OpenLayers can find the folder<code class="literal"> img:</code><a class="indexterm" id="id274"/><div><pre class="programlisting">            OpenLayers.ImgPath = "http://localhost:8080/openlayers-cookbook/recipes/data/green_img/"; 
</pre></div></li><li class="listitem">Implement the<code class="literal"> init</code> function, which is executed when the<code class="literal"> body</code> is loaded. It creates the map instance, and adds a base layer and a set of most common controls:<a class="indexterm" id="id275"/><div><pre class="programlisting">            function init() { 
                // Create map 
                var map = new OpenLayers.Map("ch06_theme", { 
                    controls: [] 
                });    
                var osm = new OpenLayers.Layer.OSM();        
                map.addLayer(osm); 
                map.setCenter(new OpenLayers.LonLat(0, 0), 2); 
    
                var vectorLayer = new OpenLayers.Layer.Vector("Vector Layer"); 
                map.addLayer(vectorLayer); 
    
                // Add controls 
                map.addControl(new OpenLayers.Control.Navigation()); 
                map.addControl(new OpenLayers.Control.LayerSwitcher({roundedCorner: false})); 
                map.addControl(new OpenLayers.Control.PanZoomBar({zoomWorldIcon: true})); 
                map.addControl(new OpenLayers.Control.MousePosition()); 
                map.addControl(new OpenLayers.Control.OverviewMap()); 
                map.addControl(new OpenLayers.Control.Scale()); 
                map.addControl(new OpenLayers.Control.ScaleLine()); 
                map.addControl(new OpenLayers.Control.Permalink()); 
                map.addControl(new OpenLayers.Control.EditingToolbar(vectorLayer)); 
    
                var history = new OpenLayers.Control.NavigationHistory(); 
                var panel = new OpenLayers.Control.Panel({ 
                    div: document.getElementById('history') 
                }); 
                panel.addControls([history.next, history.previous]); 
                map.addControls([history, panel]); 
            } 
<a class="indexterm" id="id276"/>
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec14"/>How it works...</h3></div></div></div><p>Let's start briefly by describing the JavaScript code. We have created a map, added a base layer, and finally added a set of controls.<a class="indexterm" id="id277"/>
</p><p>Specially take a look at how we have added the NavigationHistory control, because this is the first themed point of the application:</p><div><pre class="programlisting">        var history = new OpenLayers.Control.NavigationHistory(); 
        var panel = new OpenLayers.Control.Panel({ 
            div: document.getElementById('history') 
        }); 
        panel.addControls([history.next, history.previous]); 
        map.addControls([history, panel]); 

        ...
        ...
        &lt;div id="history" class="historyClass"&gt;&lt;/div&gt; 
        ...
        ...
</pre></div><p>We have instantiated the control and placed its buttons on a<code class="literal"> Panel</code> control. In addition to rendering the<code class="literal"> Panel</code> control in a specific<code class="literal"> div</code> element of the web page, we have set its<code class="literal"> div</code> property pointing to the desired element.</p><p>The CSS<code class="literal"> historyClass</code> is a class that allows us to place the control that is floating on the right-hand side (close to the editing toolbar control):<a class="indexterm" id="id278"/>
</p><div><pre class="programlisting">.historyClass { 
    position: absolute; 
    top: 5px; 
    right: 125px; 
    z-index: 9999; 
}
</pre></div><p>The output will be as shown in the following screenshot:</p><div><img alt="How it works..." src="img/7843_06_12.jpg"/></div><p>The rest of the theme is based on two important folders.</p><p>Because some controls are based on the images contained in the<code class="literal"> img</code> folder, we have set the path to this folder at the beginning of the JavaScript code. Controls such as<code class="literal"> PanZoomBar</code> or the<code class="literal"> LayerSwitcher</code> require the following folder to get their icons:<a class="indexterm" id="id279"/>
</p><div><pre class="programlisting">OpenLayers.ImgPath = "http://localhost:8080/openlayers-cookbook/recipes/data/green_img/";
</pre></div><p>The following screenshot shows the<code class="literal"> PanZoomBar</code> control's icon:</p><div><img alt="How it works..." src="img/7843_06_11.jpg"/></div><p>On the other hand, controls such as the<code class="literal"> Scale</code> or<code class="literal"> ScaleLine</code>, the<code class="literal"> MousePosition</code>, or also many aspects of the<code class="literal"> LayerSwitcher</code> control are defined via CSS through the<code class="literal"> theme</code> folder, by its<code class="literal"> style.css</code> file and their images. This is included with a<code class="literal"> link</code> tag in the document's header:<a class="indexterm" id="id280"/>
</p><div><pre class="programlisting">&lt;!-- OpenLayers Theme --&gt; 
&lt;link rel="stylesheet" href="../../js/OpenLayers-2.11/theme/default/style.css" type="text/css"&gt; 

&lt;!-- Out customer Green Theme --&gt; 
&lt;link rel="stylesheet" href="../data/green_theme/style.css" type="text/css"&gt;
</pre></div><p>The<code class="literal"> green_theme/style.css</code> file does not contain a complete redefinition of the classes we found in the default theme of OpenLayers. We have simply redefined some classes that affect the color or position of some controls. For this, first we have included the<code class="literal"> default/style.css</code> file and later our custom<code class="literal"> green_theme/style.css</code> file, which only redefines some classes by adding or changing the styles.</p><p>There is no magic recipe on how to theme CSS-based controls. We need to check the generated HTML code for the controls and see which CSS classes they use and which other we can apply. Let's see some themed controls.<a class="indexterm" id="id281"/>
</p><p>On the<code class="literal"> LayerSwitcher</code> control, we have changed the font size, the background and border color, added a border radius (only valid for CSS3 compatible browsers), and changed the title for the base and overlay sections to use italics:<a class="indexterm" id="id282"/>
</p><div><pre class="programlisting">.olControlLayerSwitcher {
    font-size: x-small;
    font-weight: normal;
}
.olControlLayerSwitcher .layersDiv {
    background-color: #38535c;
    border-radius: 1em;
    border-width: 3px 0 3px 3px;
    border-style: solid;
    border-color: #b6c6ce;
}
.olControlLayerSwitcher .layersDiv .baseLbl,
.olControlLayerSwitcher .layersDiv .dataLbl {
    font-style: italic;
    font-weight: bolder;
}
</pre></div><p>The following screenshot shows the<code class="literal"> LayerSwitcher</code> control with the changes done using the previous code:</p><div><img alt="How it works..." src="img/7843_06_07.jpg"/></div><p>For the<code class="literal"> OverviewMap</code> control, we have added a background and border color, a border radius, and moved it a bit to the top to leave space for the following controls:<a class="indexterm" id="id283"/>
</p><div><pre class="programlisting">.olControlOverviewMapContainer {
    bottom: 20px;
}
.olControlOverviewMapElement {
    background-color: #38535c;
    border-radius: 1em 0 0 1em;
    border-width: 3px 0 3px 3px;
    border-style: solid;
    border-color: #b6c6ce;
}
</pre></div><p>The following screenshot shows the<code class="literal"> OverviewMap</code> control with the changes done using the previous code:<a class="indexterm" id="id284"/>
</p><div><img alt="How it works..." src="img/7843_06_08.jpg"/></div><p>The<code class="literal"> Scale</code> and<code class="literal"> ScaleLine</code> controls have been moved to the left-hand side and the color has been changed to follow the green theme:</p><div><pre class="programlisting">.olControlScaleLine {
    bottom: 10px;
    font-size: x-small;
}
.olControlScaleLineTop {
    border: solid 2px #38535c;
    border-top: none;
}
.olControlScaleLineBottom {
    border: solid 2px #38535c;
    border-bottom: none;
}
.olControlScale {
    left: 10px;
    bottom: 40px;
    font-size: x-small;
}
</pre></div><p>The following screenshot shows the<code class="literal"> Scale</code> and<code class="literal"> ScaleLine</code> controls with the changes done using the previous code:<a class="indexterm" id="id285"/>
</p><div><img alt="How it works..." src="img/7843_06_10.jpg"/></div><p>For the<code class="literal"> MousePosition</code> and<code class="literal"> Permalink</code> controls, we have slightly moved them and changed the text color:<a class="indexterm" id="id286"/>
</p><div><pre class="programlisting">div.olControlMousePosition {
    bottom: 5px;
    right: 60px;
    font-size: small;
}

.olControlPermalink {
    bottom: 5px;
    font-size: x-small;
}
.olControlPermalink a {
    color: #38535c;
    text-decoration: none;
}
</pre></div><p>The following screenshot shows the<code class="literal"> MousePosition</code> and<code class="literal"> Permalink</code> controls with the changes done using the previous code:</p><div><img alt="How it works..." src="img/7843_06_09.jpg"/></div><p>Finally, for the<code class="literal"> NavigationHistory</code> control, we need to redefine a CSS class so the buttons are ordered horizontally, instead of vertically, which is the default mode:</p><div><pre class="programlisting">.olControlNavigationHistory {
    float: right;
}
</pre></div><div><img alt="How it works..." src="img/7843_06_12.jpg"/></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec15"/>There's more...</h3></div></div></div><p>As we mentioned, there is no easy way to theme a component. We need to take into account the HTML code that will render the component, the images it uses, and the possible CSS styles applied.<a class="indexterm" id="id287"/>
</p><p>The simplest solution to change the look of your mapping applications is to play with the icons and CSS as we did here. More drastic improvements include creating your own controls or placing the controls on external buttons, offered by an external framework such as Dojo (<a class="ulink" href="http://dojotoolkit.org">http://dojotoolkit.org</a>), jQueryUI (<a class="ulink" href="http://jqueryui.com">http://jqueryui.com</a>), or ExtJS (<a class="ulink" href="http://www.sencha.com/products/extjs">http://www.sencha.com/products/extjs</a>), and writing the required code to activate or deactivate the controls. A good sample of this is the GeoExt project (<a class="ulink" href="http://geoext.org">http://geoext.org</a>) that offers rich components based on the previous ExtJS project.<a class="indexterm" id="id288"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec16"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding how themes work using the img folder</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Understanding how themes work using the theme folder</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Adding a navigation history control</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li><li class="listitem" style="list-style-type: disc">The<em> Place controls outside the map</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec06"/>Starting actions outside the controls</h1></div></div></div><p>Another different and drastic way to change the look of our applications is to place the controls outside the map and attach them to our own components.<a class="indexterm" id="id289"/>
</p><p>Most of the OpenLayers controls have two features:<a class="indexterm" id="id290"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">They realize some action (edit features, create a line, and so on)</li><li class="listitem" style="list-style-type: disc">They know how to render themselves on top of the map</li></ul></div><p>To achieve the goal of this recipe, the idea is to separate the visualization from the action that the control does. This way, we can create some buttons and activate or deactivate a control depending on the button that is pressed:</p><div><img alt="Starting actions outside the controls" src="img/7843_06_13.jpg"/></div><p>As we can see in the screenshot, we are going to create a toolbar and place:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The same set of controls we can find in<code class="literal"> OpenLayers.Control.EditingToolbar</code>, which will allow us to draw points, lines, and polygons<a class="indexterm" id="id291"/></li><li class="listitem" style="list-style-type: disc">A dropdown button that will allow us to start the<code class="literal"> OpenLayers.Control.Measure</code> action</li></ul></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec17"/>Getting ready</h2></div></div></div><p>We are going to use the Dojo Toolkit framework (<a class="ulink" href="http://dojotoolkit.org/">http://dojotoolkit.org/</a>) which we have used along with the source code of this book, but you can make do with plain HTML buttons or<code class="literal"> div</code> elements if preferred.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec18"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependencies, both JavaScript and CSS. Add the following CSS classes within the<code class="literal"> style</code> element that will be used to style our custom buttons:<div><pre class="programlisting">&lt;style&gt;
    .pointer { background-image: url(./recipes/data/gis_icons/pointer.png); }
    .point { background-image: url(./recipes/data/gis_icons/point.png); }
    .line { background-image: url(./recipes/data/gis_icons/line.png); }
    .polygon { background-image: url(./recipes/data/gis_icons/polygon.png); }
    .area { background-image: url(./recipes/data/gis_icons/area-measure.png); }
    .length { background-image: url(./recipes/data/gis_icons/length-measure.png); }
&lt;/style&gt;
</pre></div></li><li class="listitem">Now, let's go to create the toolbar. It will consist of four toggle buttons to select the editing action:<a class="indexterm" id="id292"/><div><pre class="programlisting">&lt;div data-dojo-type="dijit.Toolbar"&gt;
    Editor:
    &lt;div data-dojo-type="dijit.form.ToggleButton" 
         data-dojo-props="iconClass:'dijitEditorIcon pointer', showLabel:false, onClick:pointerAction, checked:true"&gt;Pan&lt;/div&gt;
    &lt;div data-dojo-type="dijit.form.ToggleButton" 
         data-dojo-props="iconClass:'dijitEditorIcon point', showLabel:false, onClick:pointAction"&gt;Point&lt;/div&gt;
    &lt;div data-dojo-type="dijit.form.ToggleButton" 
         data-dojo-props="iconClass:'dijitEditorIcon line', showLabel:false, onClick:lineAction"&gt;Line&lt;/div&gt;
    &lt;div data-dojo-type="dijit.form.ToggleButton" 
         data-dojo-props="iconClass:'dijitEditorIcon polygon', showLabel:false, onClick:polygonAction"&gt;Polygon&lt;/div&gt;
</pre></div></li><li class="listitem">And one drop-down button to choose the kind of measure to do:<div><pre class="programlisting">    &lt;span data-dojo-type="dijit.ToolbarSeparator"&gt;&lt;/span&gt;

    &lt;div data-dojo-type="dijit.form.DropDownButton"&gt;
        &lt;span&gt;Measure&lt;/span&gt;
        &lt;div data-dojo-type="dijit.DropDownMenu"&gt;
            &lt;div data-dojo-type="dijit.MenuItem" data-dojo-props="iconClass:'dijitEditorIcon length', onClick:measureLengthAction"&gt;Distance&lt;/div&gt;
            &lt;div data-dojo-type="dijit.MenuItem" data-dojo-props="iconClass:'dijitEditorIcon area', onClick:measureAreaAction"&gt;Area&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</pre></div><p>The following screenshot shows the drop-down button created:
</p><div><img alt="How to do it..." src="img/7843_06_14.jpg"/></div></li><li class="listitem">In addition, the toolbar will hold a span element to show the measured values:<div><pre class="programlisting">    &lt;span id="value"&gt;&lt;/span&gt;
&lt;/div&gt;
</pre></div></li><li class="listitem">Now, we can place the<code class="literal"> div</code> element that will hold the map:<div><pre class="programlisting">&lt;div id="ch06_external" style="width: 100%; height: 90%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Now, add the required JavaScript code to initialize the map, and add a base layer and a vector layer to add features to the map:<a class="indexterm" id="id293"/><div><pre class="programlisting">&lt;script type="text/javascript"&gt;
    // Create map
    var map = new OpenLayers.Map("ch06_external");    
    var osm = new OpenLayers.Layer.OSM();        
    map.addLayer(osm);
    
    map.setCenter(new OpenLayers.LonLat(0, 0), 2);
    
    var vectorLayer = new OpenLayers.Layer.Vector("VectorLayer");
    map.addLayer(vectorLayer);
</pre></div></li><li class="listitem">Next, add the controls to the map. First, add the controls related to the<code class="literal"> DrawFeature</code> control:<div><pre class="programlisting">    // Add controls
    var pointControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Point);
    var lineControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Path);
    var polygonControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Polygon);
</pre></div></li><li class="listitem">Then add the<code class="literal"> Measure</code> control, that allows us to measure distances and areas:<div><pre class="programlisting">    var measureControl = new OpenLayers.Control.Measure(OpenLayers.Handler.Path, {
        persist: true,
        immediate: true,
        eventListeners: {
            'measure': updateMeasure,
            'measurepartial': updateMeasure
        }
    }); 
    map.addControls([pointControl, lineControl, polygonControl, measureControl]);
</pre></div></li><li class="listitem">Implement the functions to handle the buttons that represent the actions of the<code class="literal"> EditingToolbar</code> (hand, draw point, draw path, and draw polygon):<a class="indexterm" id="id294"/><div><pre class="programlisting">    // Functions to control button actions
    var currentControl = null;
    function pointerAction() {
        _unselectButtons(this);
        _selectControl(null);
    }
    function pointAction(){
        _unselectButtons(this);
        _selectControl(pointControl);
    }
    function lineAction(){
        _unselectButtons(this);
        _selectControl(lineControl);
    }
    function polygonAction(){
        _unselectButtons(this);
        _selectControl(polygonControl);
    }
Implement the actions for the measure control:
    function measureLengthAction(){
        _unselectButtons(this);
        measureControl.updateHandler(OpenLayers.Handler.Path, {persist: true});
        _selectControl(measureControl);
    }
    function measureAreaAction(){
        _unselectButtons(this);
        measureControl.updateHandler(OpenLayers.Handler.Polygon, {persist: true});
        _selectControl(measureControl);
    }
</pre></div></li><li class="listitem">And finally, add the code for the two helper functions:<a class="indexterm" id="id295"/><div><pre class="programlisting">    function _selectControl(control) {
        if(currentControl) {
            currentControl.deactivate();
        }
        if(control) {
            currentControl = control;
            currentControl.activate();
        }
    }
    function _unselectButtons(context) {
        dijit.registry.byClass('dijit.form.ToggleButton').forEach(function(button){
            if(context==button) return;
            button.set('checked', false);
        });
    }
    function updateMeasure(event) {
        var message = event.measure + " " + event.units;
        if(event.order&gt;1) {
            message += "2";
        }
        dojo.byId('value').innerHTML = message;
    }
&lt;/script&gt;
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec19"/>How it works...</h3></div></div></div><p>Every control must be attached to the map, but like in this recipe, it is not necessary for the control to have a visible representation.<a class="indexterm" id="id296"/>
</p><p>In the same way, we can invoke methods on the<code class="literal"> OpenLayers.Map</code> instance to zoom in or zoom out. We can programmatically activate or deactivate a control without the need for a panel or an icon to interact with it.</p><p>For the three buttons that allow us to create new features (points, lines, and polygons), we have created three controls based on the<code class="literal"> OpenLayers.Control.DrawFeature</code> control.</p><p>This control requires two arguments: the vector layer (to add the new feature to) and a handler (used to interact with the map while we are creating the feature):</p><div><pre class="programlisting">    var pointControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Point);
    var lineControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Path);
    var polygonControl = new OpenLayers.Control.DrawFeature(vectorLayer, OpenLayers.Handler.Polygon);
</pre></div><div><h3 class="title"><a id="note56"/>Note</h3><p>Before these three controls (represented as buttons) in the toolbar, there is a pointer button that allows us to deactivate the current control and pan the map. It does not require any control associated with it. When the button is clicked, we simply deactivate the current control allowing the map to be panned again.</p></div><p>Although visually there are two options in the drop-down button, internally, both correspond to the same control, the<code class="literal"> OpenLayers.Control.Measure</code> control. When one of the measure options is clicked, we set the handler to be used by the control:<a class="indexterm" id="id297"/>
</p><div><pre class="programlisting">    function measureLengthAction(){
        _unselectButtons(this);
        measureControl.updateHandler(OpenLayers.Handler.Path, {persist: true});
        _selectControl(measureControl);
    }
    function measureAreaAction(){
        _unselectButtons(this);
        measureControl.updateHandler(OpenLayers.Handler.Polygon, {persist: true});
        _selectControl(measureControl);
    }
</pre></div><p>We have specified the control property<code class="literal"> persist</code> of<code class="literal"> Measure</code> to<code class="literal"> true</code>. This makes the line or polygon that is rendered, to show the measure and stay visible on the map when the measure ends.</p><p>The<code class="literal"> immediate</code> property allows the measure process to trigger an event every time the mouse moves.</p><p>Finally, we have specified to the event listeners, the<code class="literal"> measure</code> event that is triggered when the measure finishes, and the<code class="literal"> measurepartial</code> event that is triggered on every mouse movement.<a class="indexterm" id="id298"/>
</p><p>Both events execute the<code class="literal"> updateMeasure</code> function, which is responsible to update the measure value shown in the toolbar:</p><div><pre class="programlisting">    function updateMeasure(event) {
        var message = event.measure + " " + event.units;
        if(event.order&gt;1) {
            message += "2";
        }
        dojo.byId('value').innerHTML = message;
    }
</pre></div><p>The code responsible for handling the logic to hold only one button or a control active at a time is implemented in the<code class="literal"> pointAction</code> function and makes use of the<code class="literal"> currentControl</code> variable.</p><p>The goal is simple, each time a button is pressed, the current selected button is toggled and the related control is deactivated before activating the new selected control.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec20"/>There's more...</h3></div></div></div><p>The<strong> GeoExt</strong> project (<a class="ulink" href="http://geoext.org">http://geoext.org</a>), is a toolkit based on ExtJS (<a class="ulink" href="http://www.sencha.com/products/extjs/">http://www.sencha.com/products/extjs/</a>) with a rich set of user interface components to simplify the creation of rich web applications.</p><p>Creating a layer tree or a grid to edit a feature's attributes is pretty simple with GeoExt.</p><div><h3 class="title"><a id="note57"/>Note</h3><p>The ESRI's JavaScript API used to build web applications is based on the Dojo Toolkit framework.</p></div><p>Anyway, both are great frameworks.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl2sec21"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Placing controls outside the map</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li><li class="listitem" style="list-style-type: disc">The<em> Adding and removing controls</em> recipe in<a class="link" href="ch05.html" title="Chapter 5. Adding Controls"> Chapter 5</a>, <em> Adding Controls</em></li></ul></div></div></div></div></body></html>