<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-32"><a id="_idTextAnchor032"/>2</h1>
<h1 id="_idParaDest-33"><a id="_idTextAnchor033"/>Configurations and Options</h1>
<p>In my opinion, there are few things more frustrating than working diligently on a project for weeks, only for a bug to manifest itself upon the project launch in the production environment because of a seemingly obscure configuration option. That is why this chapter will make efforts to teach you about the various options available to you before you dig in. I know you’re ready to learn about SvelteKit already. I promise that I’m just as excited to get into “actually building stuff” as you are, but I assure you that there is value in learning these concepts early on. If you’re hoping to rapidly develop a high-performance web application, then I believe it is in your best interest to learn these concepts before you start on your specific app.</p>
<p>To begin this chapter, we’ll start by taking a look at how you can manage your project configuration with options available in your <code>svelte.config.js</code> file. We’ll then take a brief look at some configurations with basic adapters so that you can get started. We’ll also look at the options available to you in your <code>vite.config.js</code> file. It may seem strange to discuss Vite so much in a book about SvelteKit, but SvelteKit wouldn’t be the tool it is without Vite.</p>
<p>In this chapter, we’ll cover these topics:</p>
<ul>
<li>Configuring SvelteKit</li>
<li>Configuring Vite</li>
</ul>
<p>After we have discussed the configurations and how they’ll affect your tools, you should feel more comfortable making appropriate changes to suit the needs of your next SvelteKit project.</p>
<h1 id="_idParaDest-34"><a id="_idTextAnchor034"/>Technical requirements</h1>
<p>The complete code for this chapter is available on GitHub at: <a href="https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter02">https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter02</a></p>
<h1 id="_idParaDest-35"><a id="_idTextAnchor035"/>Configuring SvelteKit</h1>
<p>The <a id="_idIndexMarker018"/>essential configuration for a SvelteKit project lives inside<a id="_idIndexMarker019"/> the <code>svelte.config.js</code> file. Understanding the various options available to you will empower you to make the most of SvelteKit. While we cannot cover all available options in such a brief section, the aim of it is to cover options that you are likely to find useful. For <a id="_idIndexMarker020"/>more configuration options, see the <em class="italic">Further Reading</em> section at the end of this chapter for more resources.</p>
<p>To get started, go ahead and <a id="_idIndexMarker021"/>open the <code>svelte.config.js</code> file from the skeleton project in your editor. Note that it’s quite simple at this point. Essentially, it imports the <code>adapter</code> function from the <code>@sveltejs/adapter-auto</code> package, specifies that function in the <code>kit</code> property of the <code>config</code> constant, and finally, exports the <code>config</code> object. We’re also given a type annotation via <code>config.kit</code> property is where we will add various other properties to customize our configuration. It should look similar to this:</p>
<pre class="source-code">
import adapter from '@sveltejs/adapter-auto';
/** @type {import('@sveltejs/kit').Config} */
const config = {
      kit: {
           adapter: adapter()
       }
};
export default config;</pre>
<p>The <code>adapter-auto</code> package is included by default when installing with <code>npm create svelte@latest</code>. It will automatically adapt your project during build time so that it can be effortlessly deployed to Vercel, Cloudflare Pages, Netlify, or Azure Static Web Apps. Because of this, <code>adapter-auto</code> is <a id="_idIndexMarker022"/>considered a <code>devDependencies</code>. Doing so will allow you to customize options specific to that environment, since <code>adapter-auto</code> does not accept any options.</p>
<p>We’ll discuss adapters at length in a later chapter; we’ll cover how you can use the <code>adapter-static</code> package to generate a static site and how you can run SvelteKit applications on Node.js servers using <code>adapter-node</code>. For now, let’s look at some other potential configuration options you may find yourself needing in the following sections.</p>
<h2 id="_idParaDest-36"><a id="_idTextAnchor036"/>alias</h2>
<p>While it is <a id="_idIndexMarker023"/>very useful to have access to the <code>src/lib/</code> path via the <code>$lib/</code> alias, there may come a time where you want to access something outside of that. To do so, you can add the <code>alias</code> property to <code>config.kit</code>. For instance, if your project had a specific file for connecting to and managing a database, you could create an alias to make imports simpler. Alternatively, you may want to easily access an image from a commonly used folder. See the following code snippets demonstrating these concepts:</p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/db.js</p>
<pre class="source-code">
const db = {
     connection: 'DB connection successful!',
     // database logic goes here…
};
export default db;</pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">svelte.config.js</p>
<pre class="source-code">
import adapter from '@sveltejs/adapter-auto';
/** @type {import('@sveltejs/kit').Config} */
const config = {
      kit: {
           adapter: adapter(),
           alias: {
                 db: '/src/db.js',
                 img: '/src/images'
                 }
       },
};
export default config;</pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">src/routes/+page.svelte</p>
<pre class="source-code">
&lt;script&gt;
      import db from 'db';
      import url from 'img/demo.png';
      let status = db.connection;
&lt;/script&gt;
&lt;p&gt;{status}&lt;/p&gt;
&lt;img src={url}&gt;</pre>
<p>In this<a id="_idIndexMarker024"/> example, I’ve created a mock database object with a property called <code>connection</code>. In the <code>svelte.config.js</code> file, I’ve added two aliases – one for the mock database object and another that points to a folder of images. Then, in the <code>+page.svelte</code> file, an import is made from both of these aliases to illustrate how you might use aliases to import a single file, as well as make an import of one particular file from a directory.</p>
<p>This example fails to take into consideration any asynchronous code that would usually be required for database operations. It is also not considered best practice to make calls to a database directly from routes, but we’ll come back to how to do that in a later chapter. While this example is quite rudimentary, it is intended to showcase the usefulness of being able to add your own aliases for specific files and directories.</p>
<h2 id="_idParaDest-37"><a id="_idTextAnchor037"/>appDir</h2>
<p>This <a id="_idIndexMarker025"/>property defaults to the <code>_app</code> value and is used to determine where imported assets such as CSS and JS will be served from the built application.</p>
<h2 id="_idParaDest-38"><a id="_idTextAnchor038"/>csp</h2>
<p>To aid in defending <a id="_idIndexMarker026"/>your application and its users from<a id="_idIndexMarker027"/> malicious <code>config.kit.csp</code> are as follows:</p>
<ul>
<li><code>mode: 'hash' | 'nonce' | 'auto'</code>: This specifies whether hashes or nonces should be used to enforce CSP. Using <code>auto</code> will use nonces for dynamically rendered pages and hashes for prerendered pages.</li>
<li><code>directives</code>: Directives specified here will be added to the <code>Content-Security-Policy</code> headers. See the official SvelteKit documentation for a full list of available options.</li>
<li><code>reportOnly</code>: This is used to report errors but still allows scripts to be loaded. Directives specified here will be added to the <code>Content-Security-Policy-Report-Only</code> headers. See the official SvelteKit documentation for a full list of available options.</li>
</ul>
<p>While this can be helpful to prevent scripts from being loaded from external sources, you may have deliberately included scripts <a id="_idIndexMarker029"/>from a <code>%sveltekit.nonce%</code> to the <code>nonce</code> property of the included script, like so:</p>
<pre class="source-code">
&lt;script src='YOUR_EXT_URL/script.js' nonce='%sveltekit.nonce%'&gt;</pre>
<h2 id="_idParaDest-39"><a id="_idTextAnchor039"/>csrf</h2>
<p>To help <a id="_idIndexMarker030"/>protect your <a id="_idIndexMarker031"/>application from <code>POST</code> requests to your application from another origin. If you need to disable it, you can do so by setting <code>config.kit.csrf.checkOrigin</code> to <code>false</code>, like <a id="_idIndexMarker032"/>so:</p>
<pre class="source-code">
const config = {
  kit: {
    adapter: adapter(),
    csrf: {
      checkOrigin: false
    }
  },
};</pre>
<h2 id="_idParaDest-40"><a id="_idTextAnchor040"/>env</h2>
<p>If you have<a id="_idIndexMarker033"/> included <code>.env</code> files in your project, you can further specify which ones can be public and which directory they are stored in with the following options:</p>
<ul>
<li><code>dir</code>: A string value that defaults to “<code>.</code>” (the project <code>root</code> directory).</li>
<li><code>publicPrefix</code>: A string value that defaults to <code>PUBLIC_</code>. This prefix denotes whether environment variables located in <code>.env</code> files are safe to be exposed to client-side code. Those environment variables are then accessible by importing from the <code>$env/static/public</code> module throughout the rest of the application. For example, assume we’re working with an <code>.env</code> file in the <code>base</code> directory of our project. Adding the <code>PUBLIC_EXTERNAL_API=https://api.nasa.gov/planetary/apod</code> value will be importable in client-side code, whereas the <code>INTERNAL_API=AN_INTERNAL_IP_ADDRESS</code> value will only be importable in server code.</li>
</ul>
<h2 id="_idParaDest-41"><a id="_idTextAnchor041"/>prerender</h2>
<p>It’s<a id="_idIndexMarker034"/> very likely that at least some content in your application will be prerenderable – that is, it will show the exact same HTML, CSS, and JS for each and every user that visits it. A common example of this is an “About” page. Whether or not you would like for a specific page to be prerendered will be addressed in a later chapter, but to further customize prerendering, consider the following options that can be added to <code>config.kit.prerender</code>:</p>
<ul>
<li><code>entries</code>: An array of strings for each route that should be prerendered. The default value is the <code>*</code> special character and will include all non-dynamic routes.</li>
<li><code>concurrency</code>: The number of pages that can be prerendered simultaneously. Because JS is single-threaded, this will only take effect if your project needs to make network requests during the prerendering process.</li>
<li><code>crawl</code>: This option defaults to <code>true</code>. It tells SvelteKit whether or not it should prerender pages found in the <code>entries</code> array.</li>
<li><code>handleHttpError</code>: This option defaults to <code>fail</code>. Other options include <code>ignore</code>, <code>warn</code>, or a <code>details</code> object specific to SvelteKit that implements <code>PrerenderHttpErrorHandler</code>. If the prerendering process fails at any point, this option determines how to manage it.</li>
<li><code>handleMissingId</code>: This is the same as <code>handleHttpError</code> except that the <code>details</code> object it accepts is implemented from <code>PrerenderMissingIdHandler</code>. Linking to a specific point on another page is done using a hash in the URL – a <code>#</code> character followed by the ID of an element on the destination page. If an element with the specified ID is not found on the destination page, then this option will determine how the build process should behave.</li>
<li><code>origin</code>: This defaults to <a href="https://kit.svelte.dev/docs/page-options">https://kit.svelte.dev/docs/page-options</a>. If you want to use the application URL in the rendered content, it can be helpful to specify it here.</li>
</ul>
<p>Hopefully, this list of options was not too overwhelming and gave some insight as to how you can customize SvelteKit to your needs. SvelteKit will continue to evolve, so it is always recommended to check the official documentation, as features may be added or removed in <a id="_idIndexMarker035"/>future releases.</p>
<p>Now that we’ve looked at a few options available for customizing SvelteKit, let’s look at how we can modify the behavior of Vite. Like SvelteKit, Vite comes with opinions on how projects should be configured. These opinions are useful for a wide range of use cases, but there will always be instances where they’ll need to be adjusted.</p>
<h1 id="_idParaDest-42"><a id="_idTextAnchor042"/>Configuring Vite</h1>
<p>As previously <a id="_idIndexMarker036"/>mentioned, Vite is the build tool that makes SvelteKit possible, so it’s just as important to know how to configure Vite as it is SvelteKit. That being said, Vite is highly configurable, and so for the sake of brevity (and your attention span), we’ll keep it limited to only a high-level view of available options. This section is not intended to be an exhaustive list but rather a quick glance at the options available to you. For further reading, consult the resources located at the end of this chapter.</p>
<p>At its heart, SvelteKit is just a Vite plugin. Obviously, there is more to it than that, but when you open <code>vite.config.js</code> in a newly created SvelteKit project, you’ll see what I mean. Similar to <code>svelte.config.js</code>, this configuration exports a <code>config</code> constant, with a couple of properties set – the SvelteKit plugin that is imported and the tests to include. If you answered “no” to tests during the <code>create@svelte</code> prompts, you may not see the <code>test</code> property. The configuration from the skeleton application is shown in the following code snippet:</p>
<pre class="source-code">
import { sveltekit } from '@sveltejs/kit/vite';
const config = {
      plugins: [sveltekit()],
      test: {
           include: ['src/**/*.{test,spec}.{js,ts}']
     }
};
export default config;</pre>
<h2 id="_idParaDest-43"><a id="_idTextAnchor043"/>plugins</h2>
<p>It seems <a id="_idIndexMarker037"/>logical to start with the <code>plugins</code> property of our Vite configuration, as this book’s entire premise is based around one plugin in particular. With Vite becoming more popular and seeing a rise in adoption, its ecosystem is expanding, and with that comes more plugins. Many of those plugins are developed by the community to solve common problems. And because Vite extends Rollup, many Rollup plugins also work with Vite out of the box, although not all. The Vite development team maintains several official Vite plugins, including one that enables legacy browser support. Many features and functionality can be added to your application via these plugins. Once you have found a plugin that satisfies your requirements and installed it, you will need to import and include it in the <code>config.plugins</code> array, just as SvelteKit was previously shown. Configurations for plugins vary, but typically, options are passed via the parameters of the imported function call. To find more plugins available for Vite, check out the Awesome Vite project at <a href="https://github.com/vitejs/awesome-vite">https://github.com/vitejs/awesome-vite</a>.</p>
<h2 id="_idParaDest-44"><a id="_idTextAnchor044"/>server</h2>
<p>Since Vite is <a id="_idIndexMarker038"/>running the development server you’ll be working on with SvelteKit, you may need to make some changes to how that server operates. For instance, you may need to change the default port, proxy it through another server elsewhere, add support for HTTPS, or even disable HMR for testing with older browsers. In these instances and more, you will want to adjust <code>config.server</code> accordingly.</p>
<h2 id="_idParaDest-45"><a id="_idTextAnchor045"/>build</h2>
<p>When building<a id="_idIndexMarker039"/> your application for your production environment, you’ll likely need to make some adjustments. Whether you need to ensure the application has met specific browser compatibility or you’d like to customize Rollup’s options, these settings can be found under <code>config.build</code>.</p>
<h2 id="_idParaDest-46"><a id="_idTextAnchor046"/>preview</h2>
<p>Once you <a id="_idIndexMarker040"/>have built your application for your production environment, you should test it with Vite’s preview functionality. Changing your preview server’s options can be done by managing <code>config.preview</code>.</p>
<h2 id="_idParaDest-47"><a id="_idTextAnchor047"/>optimizeDeps</h2>
<p>Occasionally, you<a id="_idIndexMarker041"/> may want to test multiple dependencies or versions of dependencies with your code to see how well they work for your project. To include or exclude dependencies from pre-bundling, or to further modify options used by <code>esbuild</code>, begin configuring <code>config.optimizeDeps</code>.</p>
<h2 id="_idParaDest-48"><a id="_idTextAnchor048"/>ssr</h2>
<p>If you <a id="_idIndexMarker042"/>need to prevent dependencies from running in your server environment, you may need to manage the options available to you under <code>config.ssr</code>.</p>
<h1 id="_idParaDest-49"><a id="_idTextAnchor049"/>Summary</h1>
<p>In this chapter, we covered many configuration options available for SvelteKit. We went over an example of how <code>config.kit.alias</code> might be useful for importing frequently accessed files. While we did not cover all options, we did briefly look at the <code>appDir</code>, <code>csp</code>, <code>csrf</code>, <code>env</code>, and <code>prerender</code> options and how they can affect our application.</p>
<p>We also glanced at some configuration options available in <code>vite.config.js</code>. For the most part, SvelteKit sets up a configuration that works for us according to the choices made in the installation prompt, but for further tweaks and plugins, we now know where to start looking in the official Vite documentation.</p>
<p>In the next chapter, we’ll go over some existing web standards and how SvelteKit’s design keeps them in mind. Existing standards present in web browsers are quickly becoming supported in other environments, including Node-based environments or even Deno and Cloudflare Workers. By leveraging these standards instead of building new ones on top of them, SvelteKit is accessible to more developers.</p>
<h1 id="_idParaDest-50"><a id="_idTextAnchor050"/>Further Reading</h1>
<ul>
<li><strong class="bold">SvelteKit documentation</strong> – The first stop on your troubleshooting journey should always be the official SvelteKit documentation: <a href="https://kit.svelte.dev/docs">https://kit.svelte.dev/docs</a></li>
<li><strong class="bold">Awesome Vite</strong> – A collection of official and community-maintained resources or plugins that make development with Vite delightful: <a href="https://github.com/vitejs/awesome-vite">https://github.com/vitejs/awesome-vite</a></li>
<li><strong class="bold">Vite documentation </strong>– Need to modify your development server or build process? Check here for official recommendations: <a href="https://vitejs.dev/config/">https://vitejs.dev/config/</a></li>
</ul>
</div>
</body></html>