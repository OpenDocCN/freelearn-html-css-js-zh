<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Adding Vector Layers</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding markers to maps</li><li class="listitem" style="list-style-type: disc">Adding popups to markers or maps</li><li class="listitem" style="list-style-type: disc">Adding lines to maps</li><li class="listitem" style="list-style-type: disc">Adding polygons to maps</li><li class="listitem" style="list-style-type: disc">Adding circles/rectangles to maps</li><li class="listitem" style="list-style-type: disc">Adding animated lines to maps</li><li class="listitem" style="list-style-type: disc">Adding the KML/GeoRSS layer</li><li class="listitem" style="list-style-type: disc">Adding GeoJSON to the Google Maps JavaScript API</li><li class="listitem" style="list-style-type: disc">Adding WKT to the Google Maps JavaScript API</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Introduction</h1></div></div></div><p>This chapter is about vector layers,<a id="id132" class="indexterm"/> which are completely different from <a id="id133" class="indexterm"/>raster layers. This chapter gives you the most common and important recipes that you may need while working with <a id="id134" class="indexterm"/>the Google Maps JavaScript API.</p><p>In the GIS world, both the vector and raster layers are used in different cases. Vectors are used for representing the Earth's features in most cases. For example, <a id="id135" class="indexterm"/>
<strong>Points of Interest</strong> (<strong>POI</strong>), such as coffee shops or restaurants, are shown with points; rivers or roads are shown with polylines; and parks or buildings are shown with polygons. As it is seen here, there are three different vector types: point, polyline, and polygon. Remember that all vectors consist of points, which are the building blocks of vectors.</p><p>In the Google Maps JavaScript API, all types of vectors are called<a id="id136" class="indexterm"/> <strong>overlays</strong>. In addition to vectors, popups and symbols are also included in overlays. All the recipes related to them are included in this chapter.</p><p>Maps <a id="id137" class="indexterm"/>are mostly used for visualization, so static maps are not enough in some cases. Some animations added to polylines make a difference. For example, showing the flow direction with rivers is remarkable for scientists. The Google Maps JavaScript API also supports animated polylines, which is one of the recipes in this chapter.</p><p>The Google Maps JavaScript API is a great API with support for KML and GeoRSS, but some of the industry de facto standards are not supported out of the box, such as GeoJSON and WKT. GeoJSON<a id="id138" class="indexterm"/> and WKT<a id="id139" class="indexterm"/> are the most used vector publishing formats in the industry, especially in open source libraries. These formats will be supported by additional libraries, which are also included in this chapter.</p><p>Let's start to explore the recipes.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Adding markers to maps</h1></div></div></div><p>Maps <a id="id140" class="indexterm"/>are used for many cases in websites, but the most used one shows the location of a company or business. The location of a company or business can be called a POI in the LBS or GIS sector and this is a point type of the vector layer. In the Google Maps JavaScript API, POIs or points are shown as <a id="id141" class="indexterm"/>
<strong>markers</strong>.</p><p>This recipe shows how to add markers to maps using the <code class="literal">google.maps.LatLng</code> and <code class="literal">google.maps.Marker</code> classes.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec69"/>Getting ready</h2></div></div></div><p>In Chapter 1, Google Maps JavaScript API Basics, you learned how to create a map. So, only the additional code lines that will add markers are covered in this recipe.</p><p>You <a id="id142" class="indexterm"/>can<a id="id143" class="indexterm"/> find the <a id="id144" class="indexterm"/>source <a id="id145" class="indexterm"/>code at <code class="literal">Chapter 3/ch03_adding_markers.html.</code>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec70"/>How to do it…</h2></div></div></div><p>The following are the steps we need to add both standard and icon markers to maps:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's add the minimum and maximum values of latitudes and longitudes of <strong>bounding box </strong>(<strong>BBOX</strong>)<a id="id146" class="indexterm"/> to limit our random markers' area. This bounding box almost defines the area that <strong>Turkey</strong> covers. Also <code class="literal">markerId</code> is defined to name the random markers. All variables must be defined outside the function:<div><pre class="programlisting">var minLat = 36,
    maxLat = 42,
    minLng = 25,
    maxLng = 44,
    markerId = 1;</pre></div></li><li class="listitem">Add the following function after the <code class="literal">initMap()</code> function. This function starts listening to the click events of the buttons:<div><pre class="programlisting">function startButtonEvents() {document.getElementById('addStandardMarker').addEventListener('click', function(){
      addStandardMarker();
  });

  document.getElementById('addIconMarker' ).addEventListener('click', function(){
      addIconMarker();
  });
}</pre></div></li><li class="listitem">Add the following function after the<a id="id147" class="indexterm"/> <code class="literal">startButtonEvents()</code> function. This <a id="id148" class="indexterm"/>function<a id="id149" class="indexterm"/> creates a random latitude and <a id="id150" class="indexterm"/>longitude according to the values given at the beginning<a id="id151" class="indexterm"/> of this section and returns the <code class="literal">google.maps.LatLng</code> object.<div><pre class="programlisting">function createRandomLatLng() {
  var deltaLat = maxLat - minLat;
  var deltaLng = maxLng - minLng;
  var rndNumLat = Math.random();
  var newLat = minLat + rndNumLat * deltaLat;
  var rndNumLng = Math.random();
  var newLng = minLng + rndNumLng * deltaLng;
  return new google.maps.LatLng(newLat, newLng);
}</pre></div></li><li class="listitem">Then, the <code class="literal">addStandardMarker()</code> function<a id="id152" class="indexterm"/> is added. This function creates the standard Google Maps red marker. It gets the random <code class="literal">LatLng</code> object value from the function created in the preceding step. There is a commented line in the code block that will be explained later:<div><pre class="programlisting">function addStandardMarker() {
  var coordinate = createRandomLatLng();
  var marker = new google.maps.Marker({
    position: coordinate,
    map: map,
    title: 'Random Marker - ' + markerId
  });
// If you don't specify a Map during the initialization //of the Marker you can add it later using the line //below
//marker.setMap(map);
  markerId++;
}</pre></div></li><li class="listitem">There is also another <a id="id153" class="indexterm"/>function named <code class="literal">addIconMarker()</code> described in <a id="id154" class="indexterm"/>this step. This <a id="id155" class="indexterm"/>is used <a id="id156" class="indexterm"/>for adding random markers with <a id="id157" class="indexterm"/>random images:<div><pre class="programlisting">function addIconMarker() {
  var markerIcons = ['coffee', 'restaurant_fish', 'walkingtour', 'postal', 'airport'];
  var rndMarkerId = Math.floor(Math.random() * markerIcons.length);
  var coordinate = createRandomLatLng();
  var marker = new google.maps.Marker({
    position: coordinate,
    map: map,
    icon: 'img/' + markerIcons[rndMarkerId] + '.png',
    title: 'Random Marker - ' + markerId
  });
  markerId++;
}</pre></div></li><li class="listitem">Finally, we will add HTML tags to finish the code. These links will help to trigger the functions defined in event listeners:<div><pre class="programlisting">&lt;a id="addStandardMarker" href="#"&gt;Add Standard Marker&lt;/a&gt;
&lt;a id="addIconMarker" href="#"&gt;Add Icon Marker&lt;/a&gt;</pre></div></li><li class="listitem">Go to your local URL where your HTML file is stored in your favorite browser and see the result. Initially, you will see an empty map. Then click on the links on the map to add random markers. The final map can be seen as shown in the following screenshot:<div><img src="img/8825OT_03_01.jpg" alt="How to do it…"/></div></li></ol></div><p>As seen in the <a id="id158" class="indexterm"/>preceding<a id="id159" class="indexterm"/> screenshot, <a id="id160" class="indexterm"/>we created a map with both the standard and<a id="id161" class="indexterm"/> icon markers.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec71"/>How it works...</h2></div></div></div><p>Google Maps uses the Web Mercator projection system for its tile system, but the coordinates are still in GPS coordinates based on WGS 84 Datum. Coordinates are based on latitudes and longitudes that are between -90 to 90 and -180 to 180 degrees respectively. The combination of a latitude and longitude defines a point on Earth. The Google Maps JavaScript API uses the <code class="literal">google.maps.LatLng</code> class to create a point. This class is also used in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, to set the center of a map. The following line defines the coordinates of <strong>Istanbul</strong>, <strong>Turkey</strong>:</p><div><pre class="programlisting">var istanbul = new google.maps.LatLng(41.038627, 28.986933);</pre></div><p>The <code class="literal">google.maps.Marker</code> class creates the marker with one required parameter, <code class="literal">google.maps.MarkerOptions</code>. The <code class="literal">MarkerOptions</code> class also has one required parameter that is named as <code class="literal">position</code>. This parameter gets the <code class="literal">google.maps.LatLng</code> object to define the coordinates of the marker. In the code, there are also the <code class="literal">map</code> and <code class="literal">title</code> parameters that are not required, but they are needed to show the marker on the map and set the title of the marker respectively. If you want to show the marker immediately after the creation of the marker, you should use the <code class="literal">map</code> parameter. But in some cases, you want to create markers and show them on the map later. In such a case, you should use the <code class="literal">setMap</code> method of <code class="literal">marker</code> with your map reference.</p><div><pre class="programlisting">var marker = new google.maps.Marker({
  position: new google.maps.LatLng(41.038627, 28.986933)
});
marker.setMap(map);</pre></div><p>If you want to<a id="id162" class="indexterm"/> remove the marker <a id="id163" class="indexterm"/>from the map, you must set <a id="id164" class="indexterm"/>the map value to null. Do not forget to keep a reference of your<a id="id165" class="indexterm"/> markers in order to remove them from the map:</p><div><pre class="programlisting">marker.setMap(null);</pre></div><p>Default markers with red icons are not suitable for all cases. The Google Maps JavaScript API lets you customize the icon of a marker. Basically, you should add the <code class="literal">icon</code> parameter to <code class="literal">google.maps.MarkerOptions</code> to customize the marker icon. This parameter accepts three different types: <code class="literal">String</code>, the <code class="literal">google.maps.Icon</code> object, or the <code class="literal">google.maps.Symbol</code> object. If you have a simple icon image, you will use the string type with a path to the image. Otherwise, you will create the icon or symbol objects to set a complex visualization for the marker. Showing an icon via a <code class="literal">String</code> parameter can be done as follows:</p><div><pre class="programlisting">var marker = new google.maps.Marker({
  position: coordinate,
  icon: 'img/coffeeshop.png',
  title: 'My Coffee Shop'
});</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec72"/>There's more...</h2></div></div></div><p>In this recipe, random coordinates are used to show markers. If you have a data source that includes coordinates, you could easily add them to the map with JavaScript techniques without changing anything while creating the marker. Please be sure about the JavaScript asynchronous behavior while adding markers to the map from external sources because your data will not be available when you need it due to asynchronous behavior.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec73"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Adding popups to markers or maps</h1></div></div></div><p>Almost every mapping application has an ability to display information related to the features shown on it. Showing all the related information on the map at the same time is an impossible mission for a developer and it is also useless for users. Instead of showing all the information on the map, developers add interaction to points, polylines, or polygons that show the related information with different techniques such as popups or info windows.</p><p>Popups or<a id="id166" class="indexterm"/> info<a id="id167" class="indexterm"/> windows can hold anything <a id="id168" class="indexterm"/>that can<a id="id169" class="indexterm"/> be written in HTML tags, such as pictures, videos, or standard text.</p><p>You will see something like the following screenshot, if you get through to the end of the recipe:</p><div><img src="img/8825OT_03_02.jpg" alt="Adding popups to markers or maps"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec74"/>Getting ready</h2></div></div></div><p>This recipe is the modified version of the previous recipe named <em>Adding markers to maps</em>.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_adding_popups.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec75"/>How to do it…</h2></div></div></div><p>You can <a id="id170" class="indexterm"/>easily <a id="id171" class="indexterm"/>add <a id="id172" class="indexterm"/>popups to<a id="id173" class="indexterm"/> markers or maps by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, the <code class="literal">initMap()</code> function is modified by adding the following code lines after creating the <code class="literal">map</code> object. This will open an info window or popup at the center of the map when the map first initializes:<div><pre class="programlisting">var infowindow = new google.maps.InfoWindow({
  content: '&lt;div style="width:200px; height:100px; "&gt;&lt;b&gt;Popup Content :&lt;/b&gt;&lt;br&gt;&lt;br&gt;This popups show the center of map, which is Ankara, Turkiye&lt;/div&gt;',
  position: new google.maps.LatLng(39.9078, 32.8252)
});

infowindow.open(map);</pre></div></li><li class="listitem">Next, add the following function to listen to the click events of the button defined in the HTML:<div><pre class="programlisting">function startButtonEvents() {document.getElementById('addStandardMarker').addEventListener('click', function(){
      addStandardMarker();
  });
}</pre></div></li><li class="listitem">The <code class="literal">startButtonEvents()</code> function must be called on initializing the map, so the following line is added to the <code class="literal">initMap()</code> function after <code class="literal">map</code> is initialized:<div><pre class="programlisting">startButtonEvents();</pre></div></li><li class="listitem">Then, the <code class="literal">addStandardMarker()</code> function is modified by adding the following code lines after the creation of the marker:<div><pre class="programlisting">var infowindow = new google.maps.InfoWindow({
  content: 'Marker Info Window – ID : ' + markerId
});

google.maps.event.addListener(marker, 'click', function() {
  infowindow.open(map, marker);
});</pre></div></li><li class="listitem">Go to your local URL where your HTML file is stored in your favorite browser and take a look at the result. You will see an info window at the beginning of the map. You will also click on the link on the map to add random markers, but these markers are different from the ones before because they will open a popup when the user clicks on them.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec76"/>How it works...</h2></div></div></div><p>The Google Maps <a id="id174" class="indexterm"/>JavaScript<a id="id175" class="indexterm"/> API has a<a id="id176" class="indexterm"/> default <code class="literal">InfoWindow</code> class to create info windows or popups. This <a id="id177" class="indexterm"/>class can be initialized in two ways. One way is to give a location at info windows options with the <code class="literal">LatLng</code> object. By using this, you can open a popup on the map wherever you want. This can be attached to a function or an event. For example, you can attach the <code class="literal">click</code> event to the map to query something from the server and show the result in the popup. This is common for the Google Maps JavaScript API. The following code creates an info window at the location of 39.9078 (latitude) and 32.8252 (longitude) with the HTML content. Its <code class="literal">open</code> method with the <code class="literal">map</code> input shows the info window attached to the given map reference:</p><div><pre class="programlisting">var infowindow = new google.maps.InfoWindow({
content: '&lt;div style="width:200px; height:100px; "&gt;&lt;b&gt;Popup Content :&lt;/b&gt;&lt;br&gt;&lt;br&gt;This popups show the center of map, which is Ankara, Turkiye&lt;/div&gt;',
  position: new google.maps.LatLng(39.9078, 32.8252)
});
infowindow.open(map);</pre></div><p>Another way to use popups is by binding them to markers. Instead of giving a location, info windows will be anchored to a <code class="literal">marker</code> object. The <code class="literal">infoWindow</code> object given in the following code does not have a <code class="literal">position</code> property, which means it will be anchored to a <code class="literal">marker</code> object. Remember that <code class="literal">marker</code> objects are subclasses of the <code class="literal">MVCObject</code> class in Google Maps JavaScript API. They are a type of anchor parameter of the <code class="literal">open</code> method of the <code class="literal">InfoWindow</code> class:</p><div><pre class="programlisting">var infowindow = new google.maps.InfoWindow({
  content: 'Marker Info Window – ID : ' + markerId
});
google.maps.event.addListener(marker, 'click', function() {
  infowindow.open(map, marker);
});</pre></div><p>There is an event attached to <code class="literal">marker</code> in the preceding code, which is the subject of <a class="link" href="ch05.html" title="Chapter 5. Understanding Google Maps JavaScript API Events">Chapter 5</a>, <em>Understanding Google Maps JavaScript API Events</em>. So use the code as it is written; this will be explained in detail later, but basically this code snippet listens to the <code class="literal">marker</code> object and opens the created <code class="literal">infowindow</code> object on the <code class="literal">click</code> event.</p><p>As it is seen in this recipe, you can use both simple strings and complex HTML content within the info windows. This means you can <a id="id178" class="indexterm"/>even add YouTube videos or Flash content <a id="id179" class="indexterm"/>inside <a id="id180" class="indexterm"/>info<a id="id181" class="indexterm"/> windows.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec77"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding markers to maps</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Adding lines to maps</h1></div></div></div><p>Lines or polylines in <a id="id182" class="indexterm"/>GIS are an array of points connected to each other to show features on Earth<a id="id183" class="indexterm"/> such as roads, paths, or rivers. The properties of polylines on maps are similar to the properties of features represented on Earth. For example, a road is differentiated on Earth by its color and width. The same properties are also defined in the Google Maps JavaScript API to exactly represent the road on the map.</p><p>This recipe is focused on showing lines/polylines on a map to show a route from <strong>Istanbul</strong> to <strong>Ankara</strong>.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec78"/>Getting ready</h2></div></div></div><p>This recipe uses the same map creation process defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, but there are some minor changes in the <code class="literal">zoom</code> level and center coordinates to show the route in detail.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_adding_lines.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How to do it…</h2></div></div></div><p>If you want to add line-type geometries to your map, you should perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's open our first recipe's source code mentioned in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, and save it as <code class="literal">adding_lines.html</code>.</li><li class="listitem">Then, add the following lines of code after defining the <code class="literal">map</code> object at the beginning of the JavaScript part of the code. The array defined in this step is the route coordinates in latitudes and longitudes from <strong>Istanbul</strong> to <strong>Ankara</strong>:<div><pre class="programlisting">var lineCoordinates = [
  [41.01306,29.14672],[40.8096,29.4818],
  [40.7971,29.9761],[40.7181,30.4980],
  [40.8429,31.0253],[40.7430,31.6241],
  [40.7472,32.1899],[39.9097,32.8216]
];</pre></div></li><li class="listitem">Then, create the <code class="literal">addPolyline</code> function:<div><pre class="programlisting">function addPolyline () {

}</pre></div></li><li class="listitem">We need to<a id="id184" class="indexterm"/> create a new array composed of <code class="literal">LatLng</code> objects<a id="id185" class="indexterm"/> from the array defined at the beginning in the function:<div><pre class="programlisting">//First we iterate over the coordinates array to create a 
// new array which includes objects of LatLng class.
var pointCount = lineCoordinates.length;
var linePath = [];
for (var i=0; i &lt; pointCount; i++) {
  var tempLatLng = new google.maps.LatLng( lineCoordinates[i][0] , lineCoordinates[i][1]
  );
  linePath.push(tempLatLng);
}</pre></div></li><li class="listitem">Then, we need to create the <code class="literal">polyline</code> object as follows:<div><pre class="programlisting">//Polyline properties are defined below
var lineOptions = {
  path: linePath,
  strokeWeight: 7,
  strokeColor: '#FF0000',
  strokeOpacity: 0.8
}
var polyline = new google.maps.Polyline(lineOptions);</pre></div></li><li class="listitem">Let's add the <code class="literal">polyline</code> object to <code class="literal">map</code>:<div><pre class="programlisting">//Polyline is set to current map.
polyline.setMap(map);</pre></div></li><li class="listitem">Now, call the <code class="literal">addPolyline()</code> function at the end of the <code class="literal">initMap()</code> function as follows:<div><pre class="programlisting">addPolyline();</pre></div></li><li class="listitem">Go to your local URL where your HTML file is stored in your favorite browser and see the result. You will see a red route from <strong>Istanbul</strong> to <strong>Ankara</strong> on the map, as shown in the following screenshot:<div><img src="img/8825OT_03_03.jpg" alt="How to do it…"/></div></li></ol></div><p>Thus, we have successfully <a id="id186" class="indexterm"/>created a map with a line-type geometry on it, which is the <a id="id187" class="indexterm"/>route from one place to another in this case.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec80"/>How it works...</h2></div></div></div><p>As stated before, polylines consist of points. Points are defined by the <code class="literal">LatLng</code> class in the Google Maps JavaScript API, so an array of latitudes and longitudes should be converted to the <code class="literal">LatLng</code> array. The following code block creates a new array composed of <code class="literal">LatLng</code> objects. To do this, a classic approach of iterating an array via a loop is used as follows:</p><div><pre class="programlisting">var pointCount = lineCoordinates.length;
var linePath = [];
for (var i=0; i &lt; pointCount; i++) {
  var tempLatLng = new google.maps.LatLng(lineCoordinates[i][0], lineCoordinates[i][1]);
  linePath.push(tempLatLng);
}</pre></div><p>A route will be created by the <code class="literal">Polyline</code> class that takes the instance of the <code class="literal">PolylineOptions</code> class as a parameter. There are many properties of the <code class="literal">PolylineOptions</code> class, but we only added the most used ones.</p><p>The <code class="literal">path</code> property that defines the route feature contains an array of <code class="literal">LatLng</code> objects. The <code class="literal">strokeWeight</code> property is used in order to define the width of the line in pixels. The <code class="literal">strokeColor</code> property defines the color of the line in the <code class="literal">String</code> type as a <code class="literal">HEX</code> format with a leading <code class="literal">#</code> symbol.</p><p>The <code class="literal">strokeOpacity</code> property<a id="id188" class="indexterm"/> usage can be optional, but it can be useful while showing multiple layers. This parameter gets a value from 0.0 to 1.0. 0.0 means your line is invisible and 1.0 means your line is not transparent. If you have multiple layers, you should define the opacity of your lines to show other features or layers.</p><p>This recipe shows<a id="id189" class="indexterm"/> the static route defined in the HTML; but in some cases, you can load data from a remote source. In this case, you should change the path array via the method of the <code class="literal">Polyline</code> class <code class="literal">setPath()</code>. This method gets the same array defined in the <code class="literal">PolylineOptions</code> class. For example, you create a new path array named <code class="literal">newRoute</code>. To change the coordinates to the new route, you should call the following:</p><div><pre class="programlisting">polyline.setPath(newRoute);</pre></div><p>If you want to remove <code class="literal">polyline</code> completely from the map, then you should set the <code class="literal">map</code> property to null or call the <code class="literal">setMap(null)</code> method of the <code class="literal">Polyline</code> class.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec81"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding polygons to maps</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Adding polygons to maps</h1></div></div></div><p>Polygons are similar to polylines that are an array of points connected to each other. However, polygons are closed loops to show Earth features such as parks, parcels, or regions. In addition to the properties of polylines, polygons have a fill region inside.</p><p>This recipe is focused on <a id="id190" class="indexterm"/>showing<a id="id191" class="indexterm"/> polygons on a map to show a region around <strong>Ankara</strong>.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec82"/>Getting ready</h2></div></div></div><p>This recipe uses the same map-creation process defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, but there are some minor changes in the <code class="literal">zoom</code> level and center coordinates to show the region in detail.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_adding_polygons.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How to do it…</h2></div></div></div><p>If you perform the following steps, you can add polygon-type geometries to your map:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's open our first recipe's source code mentioned in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, and save it as <code class="literal">adding_polygons.html</code>.</li><li class="listitem">Then, add the following lines of code after defining the map object at the beginning of the JavaScript part. The array defined in this step is the area coordinates of a random region in latitudes and longitudes around <strong>Ankara</strong>:<div><pre class="programlisting">var areaCoordinates = [
  [40.0192,32.6953],[39.9434,32.5854],
  [39.7536,32.6898],[39.8465,32.8106],
  [39.9139,33.0084],[40.0318,32.9260],
  [40.0402,32.7832],[40.0192,32.6953]
];</pre></div></li><li class="listitem">Then create the <code class="literal">addPolygon</code> function:<div><pre class="programlisting">function addPolygon () {

}</pre></div></li><li class="listitem">We need to create a new array composed of <code class="literal">LatLng</code> objects from the array defined at the beginning in the function:<div><pre class="programlisting">//First we iterate over the coordinates array to create a 
// new array which includes objects of LatLng class.
var pointCount = areaCoordinates.length;
var areaPath = [];
for (var i=0; i &lt; pointCount; i++) {
  var tempLatLng = new google.maps.LatLng(areaCoordinates[i][0] , areaCoordinates[i][1]);
  areaPath.push(tempLatLng);
}</pre></div></li><li class="listitem">Then, we need to create the <code class="literal">polygon</code> object as follows:<div><pre class="programlisting">//Polygon properties are defined below
var polygonOptions = {
  paths: areaPath,
  strokeColor: '#FF0000 ,
  strokeOpacity: 0.9,
  strokeWeight: 3,
  fillColor: '#FFFF00',
  fillOpacity: 0.25
}
var polygon = new google.maps.Polygon(polygonOptions);</pre></div></li><li class="listitem">Let's add the <code class="literal">polygon</code> object to <code class="literal">map</code>:<div><pre class="programlisting">//Polygon is set to current map.
polygon.setMap(map);</pre></div></li><li class="listitem">Now, call the <code class="literal">addPolygon()</code> function at end of the <code class="literal">initMap()</code> function as follows:<div><pre class="programlisting">addPolygon();</pre></div></li><li class="listitem">Go to <a id="id192" class="indexterm"/>your local URL where your HTML file is stored in your <a id="id193" class="indexterm"/>favorite browser and see the result. You will see a yellow region surrounded by a red boundary around <strong>Ankara</strong>, as shown in the following screenshot:<div><img src="img/8825OT_03_04.jpg" alt="How to do it…"/></div></li><li class="listitem">This is how we add polygon-type geometry to our map.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec84"/>How it works...</h2></div></div></div><p>The <code class="literal">Polygon</code> class is <a id="id194" class="indexterm"/>much like the <code class="literal">Polyline</code> class in the Google Maps JavaScript API. There <a id="id195" class="indexterm"/>are minor differences between the <code class="literal">Polyline</code> and <code class="literal">Polygon</code> classes, so we will get into the details of these differences only in this recipe. Please refer to the previous recipe for more details.</p><p>As stated in the previous recipe, the <code class="literal">Polygon</code> class creates objects with the help of the <code class="literal">PolygonOptions</code> class that includes many parameters for polygons. There are <code class="literal">path</code>, <code class="literal">strokeWeight</code>, <code class="literal">strokeColor</code>, and <code class="literal">strokeOpacity</code> parameters shared with the <code class="literal">PolylineOptions</code> class. The usage and purpose of these parameters are the same for both polygons and polylines. The main difference is that polygons fill an area. There must be some new parameters to define the polygon fill.</p><p>The <code class="literal">fillColor</code> property defines the color of the fill area in the  <code class="literal">String</code> type as a <code class="literal">HEX</code> format with a leading <code class="literal">#</code> symbol. The <code class="literal">fillOpacity</code> property usage can be optional, but it can also be useful while showing multiple layers at the same time. This parameter gets a value from 0.0 to 1.0. 0.0 means your polygon is invisible and 1.0 means your polygon is not transparent. This parameter is more important in polygons than in polylines because polygons fill areas, which can be an obstacle for some markers or polylines.</p><p>Adding or removing the polygons has the same API usage as polylines, so there is no need to talk about it here.</p><p>One last thing to mention is that polygons are a closed version of polylines, so we add the same coordinates both at the start and end. This is a good usage but not necessary. Even if you do not add the end coordinates, which are the same as the start coordinates, the Google Maps JavaScript API will close the polygon without any errors.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec85"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding lines to maps</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Adding circles/rectangles to maps</h1></div></div></div><p>Circles<a id="id196" class="indexterm"/> and<a id="id197" class="indexterm"/> rectangles <a id="id198" class="indexterm"/>are similar<a id="id199" class="indexterm"/> to polygons in that they have stroke and fill colors, weights, and opacities. The main difference between them and polygons is in defining the geometry. As seen in the previous recipes, the <code class="literal">PolygonOptions</code> class has a <code class="literal">path</code> parameter that consists of an array of <code class="literal">LatLng</code> objects. On the other side, the <code class="literal">CircleOptions</code> class has the <code class="literal">center</code> and <code class="literal">radius</code> parameters, and the <code class="literal">RectangleOptions</code> class has bounds parameters for defining the geometry of the <code class="literal">Circle</code> and <code class="literal">Rectangle</code> classes respectively.</p><p>In this recipe, we will go through adding circles according to the population of cities and a rectangle to map bounding to <strong>Turkey</strong>. The result map will show the bounding box of <strong>Turkey</strong> and major cities' population in a graph.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec86"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the first recipe defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as a template in order to skip map creation.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_circle_rectangle.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec87"/>How to do it…</h2></div></div></div><p>Adding circles or<a id="id200" class="indexterm"/> rectangles<a id="id201" class="indexterm"/> to your map is quite easy<a id="id202" class="indexterm"/> if <a id="id203" class="indexterm"/>you perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's start by creating a new empty file named <code class="literal">circles_rectangles.html</code>. Then, copy all the code in the HTML file that was introduced in the <em>Creating a simple map in a custom DIV element</em> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, and paste it into a new file.</li><li class="listitem">Add the following lines for defining the global variables used in the functions:<div><pre class="programlisting">// Defining coordinates and populations of major cities in // Turkey as Ankara, Istanbul and Izmir
var cities = [{
  center: new google.maps.LatLng(39.926588, 32.854614), 
  population : 4630000
},
{
  center: new google.maps.LatLng(41.013066, 28.976440), 
  population : 13710000
},
{
  center: new google.maps.LatLng(38.427774, 27.130737),  
  population : 3401000
}
];

// Defining the corner coordinates for bounding box of 
// Turkey
var bboxSouthWest = new google.maps.LatLng(35.817813, 26.047461);
var bboxNorthEast = new google.maps.LatLng(42.149293, 44.774902);</pre></div></li><li class="listitem">Then, add the <code class="literal">addCircle()</code> and <code class="literal">addRectangle()</code> functions before the <code class="literal">initMap()</code> function:<div><pre class="programlisting">function addCircle() {

}

function addRectangle() {

}</pre></div></li><li class="listitem">Now, <a id="id204" class="indexterm"/>add the <a id="id205" class="indexterm"/>following<a id="id206" class="indexterm"/> code block into the <code class="literal">addCircle()</code> function <a id="id207" class="indexterm"/>to initialize the circles:<div><pre class="programlisting">// Iterating over the cities array to add each of them to // map
for (var i=0; i &lt; cities.length; i++) {
  var circleOptions = {
    fillColor: '#FFFF00',
    fillOpacity: 0.55,
    strokeColor: '#FF0000',          
    strokeOpacity: 0.7,
    strokeWeight: 1,
    center: cities[i].center,
    radius: cities[i].population / 100
  };
  cityCircle = new google.maps.Circle(circleOptions);
  cityCircle.setMap(map);
}</pre></div></li><li class="listitem">Next, add the following lines to the <code class="literal">addRectangle()</code> function to initialize the rectangle:<div><pre class="programlisting">var bounds = new google.maps.LatLngBounds(bboxSouthWest, bboxNorthEast);
var rectOptions = {
  fillColor: '#A19E98',
  fillOpacity: 0.45,
  strokeColor: '#FF0000',
  strokeOpacity: 0.0,
  strokeWeight: 1,
  map: map,
  bounds: bounds
};

var rectangle = new google.maps.Rectangle(rectOptions);</pre></div></li><li class="listitem">Then, change the <code class="literal">zoom</code> <a id="id208" class="indexterm"/>level and <code class="literal">center</code> of the map according to <a id="id209" class="indexterm"/>your needs<a id="id210" class="indexterm"/> in the <code class="literal">initMap()</code> function. This example uses the following parameters:<div><pre class="programlisting">var mapOptions = {
  center: new google.maps.LatLng(39.9046, 32.75926),
  zoom: 5,
  mapTypeId: google.maps.MapTypeId.ROADMAP
};</pre></div></li><li class="listitem">Finally, add the <code class="literal">addRectangle()</code> and <code class="literal">addCircle()</code> functions at the end of the <code class="literal">initMap()</code> function as follows:<div><pre class="programlisting">addRectangle();
addCircle();</pre></div></li><li class="listitem">Go to <a id="id211" class="indexterm"/>your local URL where your <code class="literal">circles_rectangles.html</code> file is stored in your favorite browser and take a look at the result. You will see the map with three circles and a grey rectangle behind them, as shown in the following screenshot:<div><img src="img/8825OT_03_05.jpg" alt="How to do it…"/></div></li></ol></div><p>This is the result of the recipe that shows both the circles and rectangles at the same time on the map. This can be a good example to visualize your tabular data on maps.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec88"/>How it works...</h2></div></div></div><p>First, let's talk about the<a id="id212" class="indexterm"/> circles. Circles are types of polygons, except they are defined<a id="id213" class="indexterm"/> by a center in the <code class="literal">LatLng</code> object with a radius in<a id="id214" class="indexterm"/> meters instead of paths. Other parameters are the<a id="id215" class="indexterm"/> same as the <code class="literal">PolygonOptions</code> class.</p><p>In this recipe, first three cities of <strong>Ankara</strong>, <strong>Istanbul</strong>, and <strong>Izmir</strong>, are selected. The center and the population of these cities are defined using JSON objects in the array. The centers of cities are defined in <code class="literal">LatLng</code> objects, so there is no need for extra conversion. The following code block iterates over the cities' array and creates a circle with a <code class="literal">center</code> parameter defined in the JSON object:</p><div><pre class="programlisting">  var citiesLen = cities.length;
  for (var i=0; i &lt; citiesLen; i++) {
      var circleOptions = {
        fillColor: '#FFFF00',
        fillOpacity: 0.55,
        strokeColor: '#FF0000',
        strokeOpacity: 0.7,
        strokeWeight: 1,
        center: cities[i].center,
        radius: cities[i].population / 100
      };
      cityCircle = new google.maps.Circle(circleOptions);
      cityCircle.setMap(map);
    }</pre></div><p>The <code class="literal">radius</code> parameter is defined as a parameter of population, that is, population divided by <code class="literal">100</code>; it shows the magnitude of a population. As seen on the map, the higher the population, the larger the circle. This can be used as a visualization of the population distribution without knowing the exact numbers. As seen, the other parameters, such as <code class="literal">fillColor</code>, <code class="literal">fillOpacity</code>, <code class="literal">strokeColor</code>, <code class="literal">strokeOpacity</code>, and <code class="literal">strokeWeight</code>, are used in the same way as in the <code class="literal">PolygonOptions</code> class. The <code class="literal">setMap()</code> function is also used as it is used in the polygon or polyline recipes.</p><p>The other element, the rectangle, is also a type of polygon, except that its geometry is defined by the <code class="literal">LatLngBounds</code> object. In theory, the <code class="literal">LatLngBounds</code> object is composed of two <code class="literal">LatLng</code> objects<a id="id216" class="indexterm"/> that are defined as the southwest and northeast coordinates <a id="id217" class="indexterm"/>of a rectangle. These coordinates can also be <a id="id218" class="indexterm"/>defined as the minimum and maximum points of latitudes and longitudes. In this recipe, the rectangle defined shows the bounding box of <strong>Turkey</strong>. BBOX can be used for simple geometric calculations such as "point in polygon" or "intersection". Using BBOX in calculations gives fast results because of the simple geometry, but there is always an error in this calculation. As seen in the preceding screenshot, some areas are not on the border of <strong>Turkey</strong>, but they are in the bounding box. If you want to get the geometries to intersect with <strong>Turkey</strong> using <a id="id219" class="indexterm"/>the BBOX method, you can easily get other geometries that are outside the real geometry object of <strong>Turkey</strong>. As you can see, using the BBOX approach gets some geometries at the intersection of BBOX that can be outside the real area. The usage of the <code class="literal">Rectangle</code> class is as follows:</p><div><pre class="programlisting">var bounds = new google.maps.LatLngBounds(bboxSouthWest, bboxNorthEast);

var rectOptions = {
  fillColor: '#A19E98',
  fillOpacity: 0.45,
  strokeColor: '#FF0000',
  strokeOpacity: 0.0,
  strokeWeight: 1,
  map: map,
  bounds: bounds
};
var rectangle = new google.maps.Rectangle(rectOptions);</pre></div><p>The Google Maps<a id="id220" class="indexterm"/> JavaScript<a id="id221" class="indexterm"/> API gives many <a id="id222" class="indexterm"/>opportunities to developers that can make their life easier. Circles and <a id="id223" class="indexterm"/>rectangles can both be used for geometries or other visualization techniques in your applications.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec89"/>There's more...</h2></div></div></div><p>In this recipe, we add circles and rectangles without any order. The most recently added one is shown in the preceding map. In this example, a rectangle is added first in order to show the circles better. If you want to change the display order of markers, info windows, polylines, polygons, circles, or rectangles, you should change the <code class="literal">zIndex</code> parameter of the option classes or change them via the <code class="literal">setZIndex(3)</code> or <code class="literal">setOptions({ zIndex: 3 })</code> methods.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec90"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding lines to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding polygons to maps</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Adding animated lines to maps</h1></div></div></div><p>Polylines are the <a id="id224" class="indexterm"/>representations of Earth's features on the Earth, but sometimes, <a id="id225" class="indexterm"/>they are not enough to show the mobility of Earth features. For example, a river can be shown with the help of polylines, but the flow direction of the river can't be demonstrated by the polylines alone. Animating polylines can be a solution to show the mobility of Earth features. The flow direction of a river can be shown with the help of animated polylines.</p><p>The Google Maps JavaScript API has a symbol feature that can add vector-based images to a polyline in the form of a symbol. You can create your own symbol with the help of the <code class="literal">Symbol</code> class, or you can also use the predefined symbols that are accessed from the <code class="literal">SymbolPath</code> class.</p><p>In this recipe, we will create an animated polyline from the previous recipe. This animation shows that a car is moving from <strong>Istanbul</strong> to <strong>Ankara</strong>.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec91"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the fourth recipe of this chapter as a template.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_animating_line.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec92"/>How to do it…</h2></div></div></div><p>The following are the steps that are needed to add animated line-type geometries to your map:</p><div><ol class="orderedlist arabic"><li class="listitem">First, start by copying the contents of <code class="literal">ch03_adding_lines.html</code> to your new HTML file.</li><li class="listitem">Then, add the following line after the <code class="literal">map</code> object to make it global. This is used while animating the line:<div><pre class="programlisting">var polyline;</pre></div></li><li class="listitem">Change the<a id="id226" class="indexterm"/> function name from <code class="literal">addPolyline()</code> to <code class="literal">addAnimatedPolyline()</code> and <a id="id227" class="indexterm"/>add the following code block to define your symbol:<div><pre class="programlisting">// Defining arrow symbol
var arrowSymbol = {
  strokeColor: '#000',
  scale: 3,
  path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
};</pre></div></li><li class="listitem">Next, change the polyline options as follows:<div><pre class="programlisting">var lineOptions = {
  path: linePath,
  icons: [{
    icon: arrowSymbol,
    offset: '100%'
  }],
  strokeWeight: 3,
  strokeColor: '#FF0000',
  strokeOpacity: 0.8
}</pre></div></li><li class="listitem">Now, add the following function call to start the animation that will be defined right after the following step:<div><pre class="programlisting">// Calling the arrow animation function
animateArrow();</pre></div></li><li class="listitem">Add the following function block before the <code class="literal">initMap()</code> function:<div><pre class="programlisting">function animateArrow() {
  var counter = 0;
  var accessVar = window.setInterval(function() {
    counter = (counter + 1) % 200;
    var arrows = polyline.get('icons');
    arrows[0].offset = (counter / 2) + '%';
    polyline.set('icons', arrows);
  }, 50);
}</pre></div></li><li class="listitem">Finally, change the function call from <code class="literal">addPolyline()</code> to <code class="literal">addAnimatedPolyline()</code> in the <code class="literal">initMap()</code> function to add the new animated polyline:<div><pre class="programlisting">addAnimatedPolyline();</pre></div></li><li class="listitem">Go to <a id="id228" class="indexterm"/>your local URL where your HTML file is stored in your<a id="id229" class="indexterm"/> favorite browser and take a look at the result. You will see an arrow animating animating the route from <strong>Istanbul</strong> to <strong>Ankara</strong> on the map, as shown in the following screenshot:<div><img src="img/8825OT_03_06.jpg" alt="How to do it…"/></div></li></ol></div><p>As a result of this recipe, we can add the animated line-type geometry to our map, which shows the movement of a vehicle on a route.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec93"/>How it works...</h2></div></div></div><p>Animating polylines<a id="id230" class="indexterm"/> includes a trick with the JavaScript <code class="literal">setInterval</code> method and the<a id="id231" class="indexterm"/> Google Maps JavaScript API's icons property of the <code class="literal">PolylineOptions</code> class. As stated, you can create your own symbol or use the predefined ones.</p><p>Predefined symbols can be accessible via the <code class="literal">SymbolPath</code> class, which is shown in the following screenshot, as it is in the Google Maps JavaScript API document:</p><div><img src="img/8825OT_03_07.jpg" alt="How it works..."/></div><p>In this recipe, we will use the <code class="literal">FORWARD_CLOSED_ARROW</code> type. This symbol is defined as follows:</p><div><pre class="programlisting">  var arrowSymbol = {              
    strokeColor: '#000',
    scale: 3,
    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
  };</pre></div><p>The <code class="literal">strokeColor</code> property is used to define the color of the symbol. The <code class="literal">path</code> property is used for defining the symbol type and the <code class="literal">scale</code> property is used for the size of the symbol. You can also change the <code class="literal">fillColor</code> and <code class="literal">fillOpacity</code> properties of predefined symbols like in polygons.</p><p>As seen in the preceding screenshot, the predefined symbols are limited. If you need more types of symbols, you should define them yourself in the <code class="literal">Symbol</code> class. You need to define custom symbols via the <code class="literal">path</code> property of the <code class="literal">Symbol</code> class with the<a id="id232" class="indexterm"/> <strong>SVG path notation</strong>.</p><p>The SVG path notation is the definition of the shape in SVG commands such as <code class="literal">moveto</code> (<code class="literal">M</code>), <code class="literal">lineto</code> (<code class="literal">L</code>), or <code class="literal">closepath</code> (<code class="literal">Z</code>). For example, the following path notation defines a triangle:</p><div><pre class="programlisting">var triangle = 'M 100 100 L 300 100 L 200 300 Z';               </pre></div><p>The explanation <a id="id233" class="indexterm"/>of the path notation is as follows: move to point (<code class="literal">100</code>,<code class="literal">100</code>), draw<a id="id234" class="indexterm"/> a horizontal line from <code class="literal">100</code>,<code class="literal">100</code> to <code class="literal">300</code>, <code class="literal">100</code>, and draw a second line from (<code class="literal">300</code>,<code class="literal">100</code>) to (<code class="literal">200</code>, <code class="literal">300</code>). This shape appears as a triangle. Finally, the <code class="literal">Z</code> command is used to close the path. You can draw any shape with this notation, but you should be aware of the area that will be available for the map use. The Google Maps JavaScript API allows a 22 x 22 px square area to show a defined shape. If the shape is larger than this area, you should use the <code class="literal">scale</code> parameter to fit the shape into the area. The following code block will change the predefined arrow shape to a yellow triangle moving on the same route:</p><div><pre class="programlisting">  var arrowSymbol = {                
    path : 'M 100 100 L 300 100 L 200 300 Z',
    anchor: new google.maps.Point(175,175),
    scale: 0.15,
    fillColor: '#FFFF00',
    fillOpacity: 0.8,
    strokeColor: '#000000',
    strokeWeight: 3
  };</pre></div><div><img src="img/8825OT_03_08.jpg" alt="How it works..."/></div><p>If you noticed, there is an <a id="id235" class="indexterm"/>additional parameter named <code class="literal">anchor</code>. This parameter is <a id="id236" class="indexterm"/>used to define the position of the symbol relative to the polyline. If you do not add this parameter, your symbol will be pinned to the polyline from the (0,0) point as a default. In general, using the center of the symbol as an <code class="literal">anchor</code> point gives the best result. The <code class="literal">anchor</code> parameter accepts the <code class="literal">Point</code> class. It also gets its x and y parameters in pixels.</p><p>The trickiest part of this recipe is the animation. In the <code class="literal">animateArrow()</code> function, we define a trigger that animates the symbol defined before via the <code class="literal">window.setInterval</code> method at every 50 milliseconds. An anonymous function is defined in this trigger as follows:</p><div><pre class="programlisting">  function() {
    counter = (counter + 1) % 200;
    var arrows = polyline.get('icons');
    arrows[0].offset = (counter / 2) + '%';
    polyline.set('icons', arrows);
  }</pre></div><p>This function gets the first object of the icons array and changes the <code class="literal">offset</code> parameter of the defined icon with the changing parameter according to the <code class="literal">counter</code> variable. Running this function every 50 milliseconds moves the symbol over the polyline.</p><p>In the anonymous<a id="id237" class="indexterm"/> function, you may have noticed that the polyline object<a id="id238" class="indexterm"/> has the <code class="literal">get()</code> and <code class="literal">set()</code> methods, which are not defined in the documentation. Since the <code class="literal">Polyline</code> class extends the <code class="literal">MVCObject</code> class, we can also use the methods of the <code class="literal">MVCObject</code> class. So, we can use the <code class="literal">get()</code> and <code class="literal">set()</code> methods of the parent class.</p><p>Using symbols and timers can make different visualizations on the map without the need of an extra library in addition to the Google Maps JavaScript API.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec94"/>There's more...</h2></div></div></div><p>
<strong>SVG</strong>
<a id="id239" class="indexterm"/> is the abbreviation of <strong>Scalable Vector Graphics</strong>. It is an XML-based vector image format for two-dimensional graphics that support interactivity and animation. SVG is supported by all modern browsers. It can be a good solution for mapping platforms in some cases, like this one. SVG is a completely different subject, which is out of the scope of this book.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>
<strong>More about SVG path notation</strong>
</p><p>More details can be found on the W3C site (<a class="ulink" href="http://www.w3.org/TR/SVG/paths.html#PathData">http://www.w3.org/TR/SVG/paths.html#PathData</a>). There is also some editing software to get path notations without learning the language. The following address can be used for creating SVG and getting the path notation: <a class="ulink" href="http://svg-edit.googlecode.com/svn/branches/2.6/editor/svg-editor.html">http://svg-edit.googlecode.com/svn/branches/2.6/editor/svg-editor.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec95"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding lines to maps</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Adding KML/GeoRSS layers</h1></div></div></div><p>
<strong>Keyhole Markup Language</strong> (<strong>KML</strong>) has been <a id="id240" class="indexterm"/>introduced in Google Earth, which was originally named Keyhole Earth Viewer before Google bought it. KML became an OGC standard in 2008. It is an XML notation for showing features in geo-enabled viewers. <strong>GeoRSS</strong> <a id="id241" class="indexterm"/>is also an emerging standard for sharing Earth features to show in geo-enabled viewers mostly used by web feeds or services. Both these standards can be consumable with the Google Maps JavaScript API.</p><p>In this recipe, dynamic services will be consumed via the Google Maps JavaScript API. We will use the <strong>U.S. Geological Survey</strong> (<strong>USGS</strong>)<a id="id242" class="indexterm"/> web services to show recent earthquakes on maps. These services are updated regularly to reflect recent events.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec96"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the simple map recipe introduced in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as a template.</p><p>The source code of this recipe is at <code class="literal">Chapter 3/ch03_kml_georss.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec97"/>How to do it…</h2></div></div></div><p>You can add <a id="id243" class="indexterm"/>your <a id="id244" class="indexterm"/>KML/GeoRSS files <a id="id245" class="indexterm"/>to your <a id="id246" class="indexterm"/>map if you perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, start by copying the contents of <code class="literal">ch01_simple_map.html</code> to our new HTML file.</li><li class="listitem">Next, define the following variables as global variables:<div><pre class="programlisting">var georssLayer, kmlLayer;</pre></div></li><li class="listitem">Add the following function after defining the global variables. This function triggers the adding of the GeoRSS feed to the map:<div><pre class="programlisting">function addGeoRSSLayer() {
  georssLayer = new google.maps.KmlLayer( 'http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_month.atom');
  georssLayer.setMap(map);
}</pre></div></li><li class="listitem">Then, add the other function after the previous one. This function also triggers adding the KML feed to the map:<div><pre class="programlisting">function addKMLLayer() {
  kmlLayer = new google.maps.KmlLayer(' http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_month_depth.kml');
  kmlLayer.setMap(map);
}</pre></div></li><li class="listitem">Now, add the <a id="id247" class="indexterm"/>following<a id="id248" class="indexterm"/> function, <code class="literal">clearMap(),</code> before the <code class="literal">initMap()</code> function:<div><pre class="programlisting">function clearMap() {
  if (georssLayer != undefined) {
    georssLayer.setMap(null);
    georssLayer = null;
  }

  if (kmlLayer != undefined) {
    kmlLayer.setMap(null);
    kmlLayer = null;
  }
}</pre></div></li><li class="listitem">Next, add the following <a id="id249" class="indexterm"/>function to listen to the click events of the <a id="id250" class="indexterm"/>buttons defined in the HTML in step 8:<div><pre class="programlisting">function startButtonEvents () {
  document.getElementById('linkGeoRSS' ).addEventListener('click', function(){
        addGeoRSSLayer();
  });
  document.getElementById('linkKML' ).addEventListener('click', function(){
        addKMLLayer();
  });
  document.getElementById('linkClearMap' ).addEventListener('click', function(){
        clearMap();
  });
}</pre></div></li><li class="listitem">The <code class="literal">startButtonEvents</code> function must be called on initializing the map, so the following line is added to the HTML file after the map gets initialized:<div><pre class="programlisting">startButtonEvents();</pre></div></li><li class="listitem">Finally, add the following lines to the HTML body tag to trigger functions on clicking the links:<div><pre class="programlisting">&lt;a id="linkGeoRSS" href="#"&gt;Add GeoRSS Layer&lt;/a&gt;
&lt;a id="linkKML" href="#"&gt;Add KML Layer&lt;/a&gt;
&lt;a id="linkClearMap" href="#"&gt;Clear Map&lt;/a&gt;</pre></div></li><li class="listitem">Go to your <a id="id251" class="indexterm"/>local URL where your HTML file is stored in your<a id="id252" class="indexterm"/> favorite browser and take a look at the result. You<a id="id253" class="indexterm"/> will see an empty map at the beginning. When you click on the links on the map, you will see two different<a id="id254" class="indexterm"/> layers on the map as follows:<div><img src="img/8825OT_03_09.jpg" alt="How to do it…"/></div></li></ol></div><p>As seen in the preceding screenshot, you can easily add your GeoRSS files or services to the map with the Google Maps JavaScript API.</p><div><img src="img/8825OT_03_10.jpg" alt="How to do it…"/></div><p>This is the <a id="id255" class="indexterm"/>result of adding the KML layer to your map. With <a id="id256" class="indexterm"/>Google Maps JavaScript API, you can<a id="id257" class="indexterm"/> easily <a id="id258" class="indexterm"/>add your KML files or services to the map.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec98"/>How it works...</h2></div></div></div><p>Adding the KML/GeoRSS layer is the simplest one. There is only one class for adding both the layers, named <code class="literal">KmlLayer</code>. This class reads the KML or GeoRSS feed from local or remote locations and decides what to render. The usage of the class is very simple:</p><div><pre class="programlisting">var vectorLayer = new google.maps.KmlLayer('URL_TO_FEED');</pre></div><p>After creating the layer, you must set the map with the <code class="literal">setMap(map)</code> method to show the layer on the map. If you want to remove the layer from the map, you must use the <code class="literal">setMap(null)</code> method as described earlier in the chapter.</p><p>Remember that Google Maps JavaScript API v3 does not have any function to clear all layers or overlays like in v2. All the responsibility to handle the layer states is on your shoulders. In practice, the Google Maps JavaScript API documentation suggests you hold all layers in an array and manage your own add/remove functions via the <code class="literal">setMap()</code> method. As we did in the <code class="literal">clearMap()</code> function, we check if a layer is defined. If it is, we remove it; otherwise we do nothing, so that we do not get an error.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec99"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Adding GeoJSON to the Google Maps JavaScript API</h1></div></div></div><p>XML<a id="id259" class="indexterm"/> is the first hero of services in the Web 2.0 zone. With the help of XML, services or machines can easily communicate between them. XML can also be readable by humans. But after browser evolution, JSON has become much more popular due to its native readability for JavaScript and its lightweight compared to XML. GeoJSON is a form of JSON that <a id="id260" class="indexterm"/>includes collections of simple <a id="id261" class="indexterm"/>features such as points, polylines, or polygons. GeoJSON is not a standard of OGC, but it is a new de facto standard used by most GIS software or services.</p><p>The Google Maps JavaScript API does not support GeoJSON natively, but GeoJSON support will be added with a few lines of coding or with some additional libraries. With coding, we will go through the JSON format and read the coordinates one by one. Then, we will show the feature on the map according to its type, which can be point, polyline, or polygon.</p><p>In this recipe, we will read GeoJSON from a local file via the jQuery functions and show them on the map. This GeoJSON file is composed of a simplified version of the <strong>Ankara</strong> province border, a sample river, and some POIs.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec100"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the simple map recipe introduced in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as a template.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_adding_geojson.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec101"/>How to do it…</h2></div></div></div><p>If you perform the following steps, you can add your GeoJSON files to your map:</p><div><ol class="orderedlist arabic"><li class="listitem">First, start by copying the contents of <code class="literal">ch01_simple_map.html</code> to our new HTML file.</li><li class="listitem">Next, we will add a jQuery JavaScript library to make it easy to access local or remote GeoJSON files. In this recipe, we will add the library from Google CDN. This block will be added in the <code class="literal">&lt;head&gt;</code> section before the Google Maps JavaScript API.<div><pre class="programlisting">&lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Then, add the following <code class="literal">drawGeometry()</code> function after defining the global <code class="literal">map</code> variable. This <a id="id262" class="indexterm"/>function draws each geometry read from the GeoJSON file. We have three types of geometries, so we will switch blocks for each type:<div><pre class="programlisting">function drawGeometry(geom) {
  
}</pre></div></li><li class="listitem">Now, add the<a id="id263" class="indexterm"/> following <code class="literal">if</code> block in the new function. This block will add geometry if its type is <code class="literal">Point</code>:<div><pre class="programlisting">if (geom.type == 'Point') {
  var coordinate = new google.maps.LatLng(geom.coordinates[1], geom.coordinates[0]);
  var marker = new google.maps.Marker({
    position: coordinate,
    map: map,
    title: 'Marker'
  });
}</pre></div></li><li class="listitem">Next, the <code class="literal">if</code> block is for <code class="literal">LineString</code> that shows polylines on the map:<div><pre class="programlisting">else if (geom.type == 'LineString') {
  var pointCount = geom.coordinates.length;
  var linePath = [];
  for (var i=0; i &lt; pointCount; i++) {
    var tempLatLng = new google.maps.LatLng(geom.coordinates[i][1], geom.coordinates[i][0]);
    linePath.push(tempLatLng);
  }
  
  var lineOptions = {
    path: linePath,
    strokeWeight: 7,
    strokeColor: '#19A3FF',
    strokeOpacity: 0.8,
    map: map
  };
  var polyline = new google.maps.Polyline(lineOptions);
}</pre></div></li><li class="listitem">Finally, the <code class="literal">if</code> block is used for<a id="id264" class="indexterm"/> showing the polygons as follows:<div><pre class="programlisting">else if (geom.type == 'Polygon') {
  var pointCount = geom.coordinates[0].length;
  var areaPath = [];
  for (var i=0; i &lt; pointCount; i++) {
    var tempLatLng = new google.maps.LatLng( geom.coordinates[0][i][1], geom.coordinates[0][i][0]);
    areaPath.push(tempLatLng);
  }

  var polygonOptions = {
    paths: areaPath,
    strokeColor: '#FF0000',
    strokeOpacity: 0.9,
    strokeWeight: 3,
    fillColor: '#FFFF00',
    fillOpacity: 0.25,
    map: map
  };

  var polygon = new google.maps.Polygon(polygonOptions);
}</pre></div></li><li class="listitem">Then, add the <a id="id265" class="indexterm"/>following function to read the GeoJSON file and iterate over the geometries:<div><pre class="programlisting">function parseGeoJSON() {
  $.getJSON('geojson.js', function(data) {
    $.each(data.features, function(key, val) {
      drawGeometry(val.geometry);
    });
  });
}</pre></div></li><li class="listitem">Finally, call the <code class="literal">parseGeoJSON()</code> function at the end of the <code class="literal">initMap()</code> function:<div><pre class="programlisting">parseGeoJSON();</pre></div></li><li class="listitem">Go to your local URL where your HTML file is stored in your favorite browser and see the result. You will see three different types of geometries on the map with their styles as follows:<div><img src="img/8825OT_03_11.jpg" alt="How to do it…"/></div></li></ol></div><p>Thus, we have <a id="id266" class="indexterm"/>successfully added <a id="id267" class="indexterm"/>our GeoJSON files to the map with multiple types of geometries.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec102"/>How it works...</h2></div></div></div><p>GeoJSON is a vector format that we described earlier. It is a form of JSON. The GeoJSON format can consist of different types of the same file as follows:</p><div><pre class="programlisting">{ "type": "FeatureCollection",
  "features": [
    { "type": "Feature",
      "geometry": {"type": "Point", "coordinates": [102.0, 0.5]},
      "properties": {"prop0": "value0"}
    },
    { "type": "Feature",
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [102.0, 0.0], [103.0, 1.0], [104.0, 0.0], [105.0, 1.0]
        ]
      },
      "properties": {
        "prop0": "value0",
        "prop1": 0.0
      }
    },
    { "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0],
            [100.0, 1.0], [100.0, 0.0] ]
          ]
      },
      "properties": {
        "prop0": "value0",
        "prop1": {"this": "that"}
      }
    }
  ]
}</pre></div><p>The sample <a id="id268" class="indexterm"/>GeoJSON is taken from the <a class="ulink" href="http://www.geojson.org">www.geojson.org</a> site. As seen from the code, it is composed of point, polyline, and polygons <a id="id269" class="indexterm"/>in the same file separated by the <code class="literal">feature</code> keywords. Each <code class="literal">feature</code> has JavaScript objects named <code class="literal">geometry</code> and <code class="literal">properties</code>. The <code class="literal">geometry</code> part stores the geometry of the object and the <code class="literal">properties</code> part stores the related information. The <code class="literal">geometry</code> part is based on the geographic coordinate reference system using WGS84 Datum as default, and the coordinates are in longitudes and latitudes of decimal degrees until it is defined in the <code class="literal">crs</code> object. The <code class="literal">type</code> object stores the type of geometry such as <code class="literal">Point</code>, <code class="literal">Polyline</code>, or <code class="literal">Polygon</code>. The <code class="literal">coordinates</code> array is the actual part that stores the array of point coordinates. The order of coordinates in GeoJSON is different from the Google Maps JavaScript API in terms of its longitudes and latitudes.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>
<strong>More about GeoJSON</strong>
</p><p>More details can be obtained from GeoJSON's unofficial site (<a class="ulink" href="http://www.geojson.org">http://www.geojson.org</a>). There are also some tools to view or edit the GeoJSON without any coding. GitHub (<a class="ulink" href="http://www.github.com">http://www.github.com</a>) can easily display your GeoJSON files on the map. The <a class="ulink" href="http://www.geojson.io">http://www.geojson.io</a> site is also a tool from MapBox that displays and edits your GeoJSON files on browsers without the need for any software or coding. Please check these sites to understand GeoJSON in detail.</p></div></div><p>In this recipe, we will read the local GeoJSON file with the help of the jQuery method, <code class="literal">getJSON()</code>. jQuery is used in order to focus on coding for the Google Maps JavaScript API. Otherwise, we will have to deal with remote file reading on multiple browser platforms.</p><p>This method gets the contents of the <code class="literal">geojson.js</code> local file and puts them in the <code class="literal">data</code> variable. Then, we will iterate over the GeoJSON features with the jQuery method, <code class="literal">each()</code>. Finally, we get each feature's <code class="literal">geometry</code> part and send it to the <code class="literal">drawGeometry()</code> function, which will be examined later:</p><div><pre class="programlisting">$.getJSON('geojson.js', function(data) {
  $.each(data.features, function(key, val) {
    drawGeometry(val.geometry);
  });
});</pre></div><p>The <a id="id270" class="indexterm"/>code written in the <code class="literal">drawGeometry()</code> function <a id="id271" class="indexterm"/>may seem complex, but it is not because we will use all the code written for adding markers, lines, and polygons in this chapter. This function first checks for the type of geometry, then prepares the appropriate options and coordinate(s) for the point, polyline, or polygon.</p><p>In polylines or polygons, there is a need to iterate over the <code class="literal">coordinates</code> array of the <code class="literal">geometry</code> field to create a path or paths for the <code class="literal">PolylineOptions</code> or <code class="literal">PolygonOptions</code> classes.</p><div><pre class="programlisting">var pointCount = geom.coordinates.length;
var linePath = [];
for (var i=0; i &lt; pointCount; i++) {
  var tempLatLng = new google.maps.LatLng( geom.coordinates[i][1], geom.coordinates[i][0]);
  linePath.push(tempLatLng);
}</pre></div><p>In this recipe, we will process GeoJSON with our functions and these functions can't draw all kinds of GeoJSON geometries. We are only dealing with the simple ones to show you how to deal with GeoJSON on your own. If you need to do a more complex GeoJSON process, there are two ways. One way is to read the full specification of GeoJSON and add it to your functions. The other way, which is also easy, is to use a library that is dedicated to this job. There is a library named <strong>GeoJSON to Google Maps</strong> written by <em>Jason Sanford</em> on GitHub (<a class="ulink" href="https://github.com/JasonSanford/geojson-google-maps">https://github.com/JasonSanford/geojson-google-maps</a>). With the help of this library, you do not need to deal with GeoJSON specs. You can just add geometries with your own styles.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec103"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding markers to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding lines to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding polygons to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding WKT to the Google Maps JavaScript API</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Adding WKT to the Google Maps JavaScript API</h1></div></div></div><p>
<strong>Well-known Text</strong> (<strong>WKT</strong>) is <a id="id272" class="indexterm"/>a text markup language for representing vector geometry objects on the map according to Wikipedia. This format was originally defined by the <a id="id273" class="indexterm"/>
<strong>Open Geospatial Consortium</strong> (<strong>OGC</strong>), which is also a standard.</p><p>Apart from XML or<a id="id274" class="indexterm"/> JSON, WKT is a defined text format <a id="id275" class="indexterm"/>that only defines geometries without properties compared to GeoJSON. It was an old and outdated format, but there are still software or services supporting this format. There are 18 distinct geometric objects that represent Earth features, but simple ones are observed in this recipe.</p><p>The Google Maps JavaScript API does not support WKT natively, but WKT support will be added with a few lines of coding or with some additional libraries. With coding, we will go through the WKT format, split them into arrays, and read the coordinates one by one. Then, we will show the feature on the map according to its type, which can be point, polyline, or polygon.</p><p>In this recipe, we will read a WKT from a local file via jQuery functions and show them on the map. The WKT geometries are within JSON attributes to make iteration easy. This WKT file is composed of a simplified version of the <strong>Ankara</strong> province border, a sample river, and some POIs.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec104"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the simple map recipe introduced in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as a template.</p><p>You can find the source code at <code class="literal">Chapter 3/ch03_adding_wkt.html</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec105"/>How to do it…</h2></div></div></div><p>You can easily add your WKT geometries to the map after performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, start by<a id="id276" class="indexterm"/> copying the contents of <code class="literal">ch01_simple_map.html</code> to our new HTML file.</li><li class="listitem">Next, we will add a <a id="id277" class="indexterm"/>jQuery JavaScript library to make it easy to access local or remote JSON files with WKT geometries. In this recipe, we will add the library from Google CDN. This block will be added in the <code class="literal">&lt;head&gt;</code> section before the Google Maps JavaScript API:<div><pre class="programlisting">&lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Then, add the following <code class="literal">drawGeometry()</code> function after defining the global <code class="literal">map</code> variable. This function draws each WKT geometry read from the JSON file. We have three types of geometries, so we will switch blocks for each type:<div><pre class="programlisting">function drawGeometry(geom) {
  var slices = geom.split('(');
  var geomType = slices[0];
}</pre></div></li><li class="listitem">Now, add the following <code class="literal">if</code> block in the new function. This block will add the geometry if its type is <code class="literal">POINT</code>:<div><pre class="programlisting">if (geomType == 'POINT') {
  var coords = slices[1].split(')')[0].split(',');
  var finalCoords = coords[0].split(' ');
  var coordinate = new google.maps.LatLng(finalCoords[1], finalCoords[0]);
  var marker = new google.maps.Marker({
    position: coordinate,
    map: map,
    title: 'Marker'
  });
}</pre></div></li><li class="listitem">Next, add the <code class="literal">if</code> block for <code class="literal">LINESTRING</code> that shows polylines on the map:<div><pre class="programlisting">else if (geomType == 'LINESTRING') {
  var coords = slices[1].split(')')[0].split(',');
  var pointCount = coords.length;
  var linePath = [];
  for (var i=0; i &lt; pointCount; i++) {
    if (coords[i].substring(0,1) == ' ') {
      coords[i] = coords[i].substring(1);
    }
    var finalCoords = coords[i].split(' ');
    var tempLatLng = new google.maps.LatLng(finalCoords[1], finalCoords[0]);
    linePath.push(tempLatLng);
  }
  
  var lineOptions = {
    path: linePath,
    strokeWeight: 7,
    strokeColor: '#19A3FF',
    strokeOpacity: 0.8,
    map: map
  }
  var polyline = new google.maps.Polyline(lineOptions);
}</pre></div></li><li class="listitem">Finally, the <code class="literal">if</code> <a id="id278" class="indexterm"/>block is used for showing the <a id="id279" class="indexterm"/>polygons as follows:<div><pre class="programlisting">else if (geomType == 'POLYGON') {
  var coords = slices[2].split(')')[0].split(',');
  var pointCount = coords.length;
  for (var i=0; i &lt; pointCount; i++) {
    if (coords[i].substring(0,1) == ' ') {
      coords[i] = coords[i].substring(1);
    }
    var finalCoords = coords[i].split(' ');
    var tempLatLng = new google.maps.LatLng(finalCoords[1], finalCoords[0]);
    areaPath.push(tempLatLng);
  }

  var polygonOptions = {
    paths: areaPath,
    strokeColor: '#FF0000',
    strokeOpacity: 0.9,
    strokeWeight: 3,
    fillColor: '#FFFF00',
    fillOpacity: 0.25,
    map: map
  }

  var polygon = new google.maps.Polygon(polygonOptions);
}</pre></div></li><li class="listitem">Then, add the following function to read the JSON file and iterate over the WKT geometries:<div><pre class="programlisting">function parseWKT() {
  $.getJSON('wkt.js', function(data) {
    $.each(data.objects, function(key, val) {
      drawGeometry(val.geom);
    });
  });
}</pre></div></li><li class="listitem">Finally, call the <code class="literal">parseWKT()</code> function at the end of the <code class="literal">initMap()</code> function:<div><pre class="programlisting">parseWKT();</pre></div></li><li class="listitem">Go to your local<a id="id280" class="indexterm"/> URL where your HTML file is<a id="id281" class="indexterm"/> stored in your favorite browser and see the result. You will see three different types of geometries on the map with their styles, as shown in the following screenshot:<div><img src="img/8825OT_03_12.jpg" alt="How to do it…"/></div></li></ol></div><p>This is how we add WKT geometries to the map with multiple types of geometries.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec106"/>How it works...</h2></div></div></div><p>WKT is a vector format that we defined earlier, which is different from GeoJSON. GeoJSON defines both the geometry and properties of Earth features, but WKT is only used for defining the geometry. Simple types of WKT examples are shown in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Geometry type</p>
</th><th style="text-align: left" valign="bottom">
<p>WKT example</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>POINT</p>
</td><td style="text-align: left" valign="top">
<p>POINT(31.541742 40.730608)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>POLYLINE</p>
</td><td style="text-align: left" valign="top">
<p>LINESTRING(35.24414 41.742627, 34.859619 41.586688, 34.7717285 41.508577, 34.832153 41.364441)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>POLYGON</p>
</td><td style="text-align: left" valign="top">
<p>POLYGON((33.759299 38.779907, 33.73552 38.758208, 33.73187 38.748987, 33.703537 38.723535, 33.677514 33.800384 38.876017, 33.783532 38.842548, 33.759299 38.779907))</p>
</td></tr></tbody></table></div><p>WKT geometries<a id="id282" class="indexterm"/> are exactly the same as used in the <em>Adding GeoJSON to Google Maps JavaScript API</em> recipe, but they are formatted in WKT <a id="id283" class="indexterm"/>geometries. WKT geometries are not alone due to their text format. So we put them in a JSON file with the <code class="literal">geom</code> attribute. This is used for easy parsing. If you have different types of formats that include WKT geometries, you should parse them with JavaScript.</p><p>First, we will read the JSON file to get the WKT geometries. We will read the local JSON file with the help of the jQuery method, <code class="literal">getJSON()</code>. jQuery is used for focusing on the Google Maps JavaScript API instead of writing and fixing JavaScript code for each browser. Otherwise, we will have to deal with a remote file reading on multiple browser platforms. This method gets the contents of the <code class="literal">wkt.js</code> local file and puts them in the <code class="literal">data</code> variable. Then, we will iterate over the JSON objects with a jQuery method, <code class="literal">each()</code>. Finally, we get each object's <code class="literal">geom</code> part and send it to the <code class="literal">drawGeometry()</code> function, which will be examined later:</p><div><pre class="programlisting">$.getJSON('wkt.js', function(data) {
  $.each(data.objects, function(key, val) {
    drawGeometry(val.geom);
  });
});</pre></div><p>Parsing of WKT is much harder than GeoJSON because we need to deal with text parsing. With the <code class="literal">drawGeometry()</code> function, we will split the WKT text into smaller arrays and make them significant. Before parsing each type, we need to get the type of their geometry. Since they have no separate attribute for defining the type, we need to extract the type from the WKT text. As seen from the examples, the type is separated with the <code class="literal">(</code> character from the coordinates. If we slice string from the <code class="literal">(</code> character, the first array element is the type of geometry. This is done as follows:</p><div><pre class="programlisting">var slices = geom.split('(');
var geomType = slices[0]; </pre></div><p>The contents of <code class="literal">geomType</code> can be <code class="literal">POINT</code>, <code class="literal">LINESTRING</code>, or <code class="literal">POLYGON</code>. Then, we will check each type of geometry in different blocks. Let's go through each geometry type starting with point.</p><p>Point is the simplest <a id="id284" class="indexterm"/>WKT geometry to parse with JavaScript. First, we get the second element of the <code class="literal">slice</code> array and slice it from the <code class="literal">)</code> character to only get the coordinates separated by a comma. Then, we will split the result text by a comma into an array. This array has only one element, so we will easily access the coordinates. To access the coordinates, we must slice the final text with the space character. This final array contains the latitude and longitude. The Google Maps JavaScript API uses latitude <a id="id285" class="indexterm"/>and longitude in order to define a point, but WKT uses longitude and latitude order to define a point. As described in the <em>Adding GeoJSON to Google Maps JavaScript API</em> recipe, the order of coordinates is also the same for WKT, which is in the reverse order of the Google Maps JavaScript API as longitudes and latitudes: </p><div><pre class="programlisting">var coords = slices[1].split(')')[0].split(',');
var finalCoords = coords[0].split(' ');
var coordinate = new google.maps.LatLng(finalCoords[1], finalCoords[0]);</pre></div><p>The second type is the polyline that is defined as <code class="literal">LINESTRING</code> in WKT. Parsing polylines is much more complex than points. First, we get the arrays of coordinates by splitting <code class="literal">)</code> and comma as described earlier. Then, we will iterate in this array to get each coordinate. Before splitting the text with a space, we must check if there is a space at the beginning of the text. If there is a space, we will get the rest of the text to get only numbers for valid latitudes and longitudes.</p><div><pre class="programlisting">var coords = slices[1].split(')')[0].split(',');
var pointCount = coords.length;
var linePath = [];
for (var i=0; i &lt; pointCount; i++) {
  if (coords[i].substring(0,1) == ' ') {
    coords[i] = coords[i].substring(1);
  }
  var finalCoords = coords[i].split(' ');
  var tempLatLng = new google.maps.LatLng(finalCoords[1], finalCoords[0]);
  linePath.push(tempLatLng);
}</pre></div><p>The last, simple type is polygon that is also defined as <code class="literal">POLYGON</code> in WKT. Parsing polygon is very similar to parsing polylines, except that the polygon definition has two parentheses, which is one more than polylines. We will get the third element of the array instead of the second, because WKT can contain multiple polygon geometries so in this case we have only one. If you have multiple geometries then you should iterate over the geometries. The only difference is written as follows:</p><div><pre class="programlisting">var coords = slices[2].split(')')[0].split(',');</pre></div><p>The code blocks written in the <code class="literal">drawGeometry()</code> function may seem complex, but they are not because we will use all the codes written for adding markers, lines, and polygons in this chapter. The result of this recipe is exactly the same as the <em>Adding GeoJSON to </em>the <em>Google Maps JavaScript API</em> recipe, which is the expected result. We do not imagine we will get different outputs<a id="id286" class="indexterm"/> on changing the vector formats.</p><p>In this recipe, we will <a id="id287" class="indexterm"/>process WKT with our own functions, and these functions can't draw all kinds of WKT geometries defined in its standard. We are only dealing with the simple ones to show you how to deal with WKT on your own. If you need to do more complex WKT geometries, then there are two ways. One way is to read the full specification of WKT and add them to your functions. The other, easier way is to use a library that is dedicated for this job. There is a library named <strong>Wicket</strong> written by <em>K. Arthur Endsley</em> on GitHub (<a class="ulink" href="https://github.com/arthur-e/Wicket">https://github.com/arthur-e/Wicket</a>). With the help of this library, you do not need to deal with WKT specs. You can just add geometries with your own styles.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec107"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding markers to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding lines to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding polygons to maps</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding GeoJSON to </em>the <em>Google Maps JavaScript API</em> recipe</li></ul></div></div></div></body></html>