<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating a Bar Graph</h1></div></div></div><p>Now that we have examined binding data and generating SVG visuals with D3, we will turn our attention to creating a bar graph using SVG in this chapter. The examples in this chapter will utilize an array static of integers, and use that data to calculate the height of bars, their positions, add labels to the bars, and add margins and axes to the graph to assist the user in understanding the relationships in the data.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a series of bars that are bound to data</li><li class="listitem" style="list-style-type: disc">Calculating the position and height of the bars</li><li class="listitem" style="list-style-type: disc">Using a group to uniformly position multiple elements representing a bar</li><li class="listitem" style="list-style-type: disc">Adding margins to the graph</li><li class="listitem" style="list-style-type: disc">Creating and manipulating the style and labels in an axis</li><li class="listitem" style="list-style-type: disc">Adding an axis to the graph</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec26"/>The basic bar graph</h1></div></div></div><p>We have<a id="id192" class="indexterm"/> explored everything that we need to draw a series of bars based upon data in the first three chapters. The first example in this chapter will leverage using SVG rectangles for drawing the bars. What we need to do now is calculate the size and position of the bars based upon the data.</p><p>The code for our<a id="id193" class="indexterm"/> bar graph is available at the following location. Open this link in your browser, and we will walk through how the code creates the visual that follows.</p><div><div><h3 class="title"><a id="note56"/>Note</h3><p>bl.ock (4.1): <a class="ulink" href="http://goo.gl/TQo2sX">http://goo.gl/TQo2sX</a>
</p></div></div><div><img src="img/B04230_04_01.jpg" alt="The basic bar graph"/></div><p>The code starts <a id="id194" class="indexterm"/>with a declaration of the data that is to be represented as a graph. This example uses a hard-coded array of integers. We will look at more complex data types later in the book; for now, we simply start with this to get used to the process of binding and that of creating the bars:</p><div><pre class="programlisting">var data = [55, 44, 30, 23, 17, 14, 16, 25, 41, 61, 85,
            101, 95, 105, 114, 150, 180, 210, 125, 100, 71,
            75, 72, 67];</pre></div><p>Now we define two variables that define the width of each bar and the amount of spacing between each bar:</p><div><pre class="programlisting">var barWidth = 15, barPadding = 3;</pre></div><p>We need to scale the height of each bar relative to the maximum value in the data. This is determined by using the <code class="literal">d3.max()</code> function.</p><div><pre class="programlisting">var maxValue = d3.max(data);</pre></div><p>Now we create the main SVG element by placing it inside the body of the document, and assign a width and height that we know will hold our visual. Finally, and as a matter of practice that will be used throughout this book, we will append a top-level group element in the SVG tag. We will then place our bars within this group instead of placing them directly in the SVG element:</p><div><pre class="programlisting">var graphGroup = d3.select('body')
    .append('svg')
    .attr({ width: 1000, height: 250 })
    .append('g');</pre></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>I find this practice of using a top-level group useful as it facilitates placing multiple complex visuals in the same SVG, such as in the case of creating a dashboard.</p></div></div><p>In this example, we are not going to scale the data, and use an assumption that the container is the proper size to hold the graph. We will look at better ways of doing this, as also for calculating the positions of the bars, in <a class="link" href="ch05.html" title="Chapter 5. Using Data and Scales">Chapter 5</a>, <em>Using Data and Scales</em>. We simply strive to keep it simple for the moment.</p><p>We need to <a id="id195" class="indexterm"/>perform two pieces of math to be able to calculate the <em>x</em> and <em>y</em> location of the bars. We are positioning these bars at pixel locations starting at the bottom and the left of <code class="literal">graphGroup</code>. We need two functions to calculate these. The first one calculates the <em>x</em> location of the left side of the bar:</p><div><pre class="programlisting">function xloc(d, i) { return i * (barWidth + barPadding); }</pre></div><p>During binding, this will be passed the current datum and its position within the <code class="literal">data</code> array. We do not actually need the value for this calculation. We simply calculate a multiple of the sum of the width and padding for the bar based upon the array position.</p><p>Since SVG uses an upper-left origin, we need to calculate the distance from the top of the graph as the location from where we start drawing the bar down towards the bottom of the visual:</p><div><pre class="programlisting">function yloc(d) { return maxValue - d; }</pre></div><p>When we position each bar, we will use a translate transform that takes advantage of each of these functions. We can facilitate this by declaring a function which, given the current data item and its array position, returns the calculated string for the transform property based upon this data and the functions:</p><div><pre class="programlisting">function translator(d, i) {
    return "translate(" + xloc(d, i) + "," + yloc(d) + ")";
   }</pre></div><p>All we need to do now is generate the SVG visuals from the data:</p><div><pre class="programlisting">barGroup.selectAll("rect")
    .data(data)
    .enter()
    .append('rect')
    .attr({
        fill: 'steelblue',
        transform: translator,
        width: barWidth,
        height: function (d) { return d; }
    });</pre></div><p>Pretty good for just a few lines of code. But all we can tell from the graph is the relative sizes of the data. We need more information than this to get an effective data visualization.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec28"/>Adding labels to the bars</h2></div></div></div><p>Now we will <a id="id196" class="indexterm"/>add a label holding the value of the datum right at the top of each bar. The code for this example is available at the following link:</p><div><div><h3 class="title"><a id="note57"/>Note</h3><p>bl.ock (4.2): <a class="ulink" href="http://goo.gl/3ltkHT">http://goo.gl/3ltkHT</a>
</p></div></div><p>The following image demonstrates the resulting visual:</p><div><img src="img/B04230_04_02.jpg" alt="Adding labels to the bars"/></div><p>To accomplish this, we will modify our SVG generation such that:</p><div><ol class="orderedlist arabic"><li class="listitem">Each bar is represented by an SVG group instead of a <code class="literal">rect</code>.</li><li class="listitem">Inside each group that represents a bar, we add an SVG and a text element.</li><li class="listitem">The group is then positioned, hence positioning the child elements as well.</li><li class="listitem">The size of the <code class="literal">rect</code> is set as before, causing the containing group to expand to the same size.</li><li class="listitem">The text is positioned relative to the upper-left corner of its containing group.</li></ol></div><p>By grouping these elements in this manner, we can reuse the previous code for positioning, and utilize the benefit of the group for locating all the child visuals for a bar. Moreover, we only need to size and position those child elements relative to their own group, making that math very simple. The code for this is identical to the previous example through the declaration of the positioning functions.</p><p>The first change is in the creation of the selector that represents the bars:</p><div><pre class="programlisting">var barGroups = g.selectAll('g')
    .data(data)
    .enter()
    .append('g')
    .attr('transform', translator);</pre></div><p>Instead of creating a <code class="literal">rect</code>, the code now creates a group element. The group is initially empty, and it is assigned the transform that moves it into the appropriate position.</p><p>Using the <a id="id197" class="indexterm"/>selector referred to by <code class="literal">barGroups</code>, the code now appends a <code class="literal">rect</code> into each group while also setting the appropriate attributes.</p><div><pre class="programlisting">barGroups.append('rect')
    .attr({
        fill: 'steelblue',
        width: barWidth,
        height: function(d) { return d; }
    });</pre></div><p>The next step is to add a <code class="literal">text</code> element to show the value of the datum. We are going to position this text such that it is right at the top of the bar, and centered in the bar.</p><p>To accomplish this, we need a translate transform that represents an offset halfway into the bar and at the top. This is common for each bar, so we can define a variable that is reused for each:</p><div><pre class="programlisting">var textTranslator = "translate(" + barWidth / 2 + ",0)";</pre></div><p>Next, the we append a text element into each group, setting its text (the string value of the datum), the appropriate attributes for the text, and finally, the style for the font.</p><div><pre class="programlisting">barGroups.append('text')
    .text(function(d) { return d; })
    .attr({
        fill: 'white',
        'alignment-baseline': 'before-edge',
        'text-anchor': 'middle',
        transform: textTranslator
    })
    .style('font', '10px sans-serif');</pre></div><p>That was pretty easy, and it is nice to have the labels on the bars, but our graph could still really use axes. We will look at adding those next.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Margins and axes</h1></div></div></div><p>Adding axes to<a id="id198" class="indexterm"/> the graph will give the reader a much better understanding of the <a id="id199" class="indexterm"/>scope of the graph and the relationship between the values in the data. D3.js has very powerful constructs built in for allowing us to create axes.</p><p>Axes in D3.js are based upon another concept known as scales. While scales are by themselves very useful (we will cover scales in more detail in <a class="link" href="ch05.html" title="Chapter 5. Using Data and Scales">Chapter 5</a>, <em>Using Data and Scales</em>), for the remainder of this chapter, we will examine using them to create basic axes in our bar chart.</p><p>However, before <a id="id200" class="indexterm"/>we get to axes, we will first take a short but important <a id="id201" class="indexterm"/>diversion into the concept of margins, and that of adding a margin to our bar chart to make room for the axes.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec29"/>Creating margins in the bar graph</h2></div></div></div><p>Margins have several practical uses in a graph. They can be used to provide spacing between the <a id="id202" class="indexterm"/>graph and other content on the page, giving the <a id="id203" class="indexterm"/>reader clean sightlines between their visualization and the other content. However, the real practical use of margins is to provide space on one or more sides of the visualization for providing axes.</p><p>The following image demonstrates what we want to accomplish with margins:</p><div><img src="img/B04230_04_03.jpg" alt="Creating margins in the bar graph"/></div><p>The grey portion is where we will place our existing graph. Then, depending upon the axes that we decide to use (left, top, right, bottom), we need to provide space in our visualization for rendering those axes just outside the graph. Note that a single graph could use any or all of the margins for different axes, so it is a good practice to build code that plans for all of them.</p><p>In D3.js applications, this is generally performed using a concept referred to as <strong>margin convention</strong>. We <a id="id204" class="indexterm"/>will step through an example of using this concept to add margins to our graph. Additionally, instead of using a static size for our layout, we will compute the height and width of the graph based upon the number of data points in this example.</p><p>To get started, load the example from the following information box.</p><div><div><h3 class="title"><a id="note58"/>Note</h3><p>bl.ock (4.3): <a class="ulink" href="http://goo.gl/HTZ2NG">http://goo.gl/HTZ2NG</a>
</p></div></div><p>The <a id="id205" class="indexterm"/>resulting visualization for the code is seen in the <a id="id206" class="indexterm"/>following graph:</p><div><img src="img/B04230_04_04.jpg" alt="Creating margins in the bar graph"/></div><p>Besides the margins, this example adds a grey background to the area behind the chart. This highlights the area used for the chart, and emphasizes it relative to the margins that are added. It also puts a rectangle around the main SVG element to highlight its boundaries, as it helps us see the extent of the margins added to the graph.</p><p>Let's step through this example and examine how it differs from the previous example. We start with calculating the actual width of the area of the bars:</p><div><pre class="programlisting">var graphWidth = data.length * (barWidth + barPadding)
                 - barPadding;</pre></div><p>Now we declare a JavaScript object that will represent the size of our margins:</p><div><pre class="programlisting">var margin = { top: 10, right: 10, bottom: 10, left: 50 };</pre></div><p>Using these values, we can calculate the total size of the entire visualization:</p><div><pre class="programlisting">var totalWidth = graphWidth + margin.left + margin.right;
var totalHeight = maxValue + margin.top + margin.bottom;</pre></div><p>Now we can create the main SVG element, and set it to the exact size that it needs to be:</p><div><pre class="programlisting">    var svg = d3.select('body')
        .append('svg')
        .attr({ width: totalWidth, height: totalHeight });</pre></div><p>For the visual<a id="id207" class="indexterm"/> effect, the following adds a rectangle that<a id="id208" class="indexterm"/> shows us the boundaries of the main SVG element:</p><div><pre class="programlisting">svg.append('rect').attr({
    width: totalWidth,
    height: totalHeight,
    fill: 'white',
    stroke: 'black',
    'stroke-width': 1
});</pre></div><p>Now we add a group to hold the main part of the graph:</p><div><pre class="programlisting">var graphGroup = svg
    .append('g')
    .attr('transform', 'translate(' + margin.left + ',' +
                                      margin.top + ")");</pre></div><p>To emphasize the area of the actual graph, a grey <code class="literal">rect</code> is added to the group:</p><div><pre class="programlisting">graphGroup.append('rect').attr({
    fill: 'rgba(0,0,0,0.1)', 
    width: totalWidth – (margin.left + margin.right),
    height: totalHeight - (margin.bottom + margin.top)
});</pre></div><p>The remainder of the code remains the same.</p><p>At this point, we have added margins around the graph, and made room on the left side for an axis to be drawn. Before we put that in the visualization, let's first take a look at an example of creating an axis to learn some of the concepts involved.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec30"/>Creating an axis</h2></div></div></div><p>To demonstrate<a id="id209" class="indexterm"/> the creation of an axis, we will start with creating an axis appropriate for placement at the bottom of the graph, referred to as a <strong>bottom</strong> axis. This is the default type <a id="id210" class="indexterm"/>of axis created with D3.js. So we will start with it, and then examine changing the orientation after looking at a few concepts related to axes.</p><p>The following is the code for the example that we will walk through, and which results in the generation of the subsequent axis:</p><div><div><h3 class="title"><a id="note59"/>Note</h3><p>bl.ock (4.4): <a class="ulink" href="http://goo.gl/TyDAH6">http://goo.gl/TyDAH6</a>
</p></div></div><div><img src="img/B04230_04_05.jpg" alt="Creating an axis"/></div><p>In our example, we create the scale and axis with the following lines of code:</p><div><pre class="programlisting">var scale = d3.scale
    .linear()
    .domain([0, maxValue])
    .range([0, width]);

var axis = d3.svg.axis().scale(scale);
svg.call(axis);</pre></div><p>To create an <a id="id211" class="indexterm"/>axis, we first<a id="id212" class="indexterm"/> need to create a <strong>scale</strong> object using <code class="literal">d3.scale()</code>. A scale informs the axis about the range of values it will represent (known as the <strong>domain</strong>), and the overall size for which the axis should be rendered in the visual (referred to as the <strong>range</strong>). In this example, we are using a <strong>linear</strong> scale. A linear scale<a id="id213" class="indexterm"/> informs the axis that the values will be linearly interpolated from the lower to the higher value, in this case, 0 to 210.</p><div><div><h3 class="title"><a id="note60"/>Note</h3><p>D3.js scales have uses for things other than axes. We will examine these uses in <a class="link" href="ch05.html" title="Chapter 5. Using Data and Scales">Chapter 5</a>, <em>Using Data and Scales</em>.</p></div></div><p>The axis is then created using the <code class="literal">d3.svg.axis()</code> function, and by passing it the scale by chaining a call to <code class="literal">.scale()</code>.</p><p>The axis scale then needs to be associated with a selection, which is performed using the <code class="literal">.call()</code> function. This informs D3.js that when it renders the visual that it should call the axis function to render itself.</p><p>This feels a little different than the way we have created visual elements so far.  This technique is used by D3.js because an axis is a complex set of SVG elements that need to be generated. The use of <code class="literal">.call()</code> allows us to separate complex rendering logic into a function call during the rendering pipeline, and the design of D3.js was made to render axes in this manner.</p><p>The labels on the axis are automatically generated by D3.js, and are based upon the values of the domain. The visualized size of the axis is specified by the range. In this case, since this is a bottom axis, the labelling starts at the minimum value of 0, and D3.js uses intervals of 20 for the labels. The last label that fits is 200, so D3.js does not actually create a label for the maximum value of 210.</p><div><div><h3 class="title"><a id="note61"/>Note</h3><p>In the output, the label 0 is clipped. This is because the axis is positioned flush to the left of the SVG element. This orientation is such that the line in the axis is flush. Since the text for the first label is center-justified on the tick, its left half gets clipped. This can be fixed easily with a translation, which we will examine when we place the axis next to our graph.</p></div></div><p>Inspecting the<a id="id214" class="indexterm"/> rendered axis using Developer tools, you will see the effort that D3.js has made to generate the axis:</p><div><img src="img/B04230_04_06.jpg" alt="Creating an axis"/></div><p>What D3.js has done is generate a group for each tick on the axis and a single path that renders the line of the axis. Each tick group itself consists of a line that represents the tick on the axis and the label on the tick.</p><p>Examining the output, you will notice that we do not actually see any ticks along the axis.  This makes it difficult to realize the actual point on the axis that is associated with the label. This is due to the default styling that is used. We will make this axis look better in the next section.</p><p>The reason we could not see the ticks on our axis is due to the default thickness of the path representing the axis. We can change this by simply modifying the style of the path representing the axis as well as the style of the ticks.</p><p>Open the following example in your browser to learn how to accomplish this:</p><div><div><h3 class="title"><a id="note62"/>Note</h3><p>bl.ock (4.5): <a class="ulink" href="http://goo.gl/xmSf2g">http://goo.gl/xmSf2g</a>
</p></div></div><div><img src="img/B04230_04_07.jpg" alt="Creating an axis"/></div><p>This code <a id="id215" class="indexterm"/>makes a few small modifications to be able to change the style as shown in the following section of code:</p><div><pre class="programlisting">var axisGroup = svg.append('g');
var axis = d3.svg.axis().scale(scale);

var axis = d3.svg.axis().scale(scale);
var axisNodes = axisGroup.call(axis);
var domain = axisNodes.selectAll('.domain');
domain.attr({
    fill: 'none',
    'stroke-width': 1,
    stroke: 'black'
});
var ticks = axisNodes.selectAll('.tick line');
ticks.attr({
    fill: 'none',
    'stroke-width': 1,
    stroke: 'black'
});</pre></div><p>The first change is that we create a group, represented by the variable <code class="literal">axisGroup</code>, to hold the axis that is generated. This will be used so that we can select the SVG elements in the axis representing the ticks and the axis line, and change their styles.</p><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>It's good practice to always put the axes in a group. This facilitates style changes like the one we are performing in this example. Moreover, it is almost always the case that the axis needs to be translated into a specific position in the visualization. An axis itself cannot be translated, so placing it in a group element and then transforming the group accomplishes this task.</p></div></div><p>Secondly, the code captures the nodes that result from the generation of the axis in the <code class="literal">axisNodes</code> variable. Using <code class="literal">axisNode</code>, we can then perform two more selections to find specific elements in the axis: one for the element with the <code class="literal">domain</code> class, and the other for the line elements with the <code class="literal">line</code> class. Using the results of each of these two selections, the code then sets the <code class="literal">fill</code>, <code class="literal">stroke</code>, and <code class="literal">stroke-width</code> properties to make them all one pixel thick black lines.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec05"/>Changing the axis orientation</h3></div></div></div><p>D3.js axes <a id="id216" class="indexterm"/>can be rendered into four different orientations using the <code class="literal">.orient()</code> function on the axis, passing it the name of the orientation that is desired. The following table shows the orientation names that can be used:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">'top'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Horizontal axis, with ticks and labels above the axis line.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">'bottom'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Horizontal axis, with ticks and labels below the axis line (default)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">'left'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Vertical axis, with ticks and labels to the left of the axis line</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">'right'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Vertical axis, with ticks and labels to the right of the axis line</p>
</td></tr></tbody></table></div><p>Essentially, each of these relate to one of the four sides of a graph, such as the margins that were covered earlier. There is no effect of this function on the location of the axis in the visual (we have to do that ourselves). Instead, it decides whether the axis line is horizontal or vertical, and also if the labels are on the top or bottom of a horizontal axis or to the left or right of a vertical axis.</p><p>To demonstrate this, we will quickly inspect the top, right, and left orientations. Open the following link for an example of a top axis:</p><div><div><h3 class="title"><a id="note63"/>Note</h3><p>bl.ock (4.6): <a class="ulink" href="http://bl.ocks.org/d3byex/8791783ee37ab76a8517">http://bl.ocks.org/d3byex/8791783ee37ab76a8517</a>
</p></div></div><p>There are two small modifications from the previous example. The primary change is that when we create the axis, we make a call to <code class="literal">.orient('top')</code>:</p><div><pre class="programlisting">var axis = d3.svg.axis()
    .orient('top')
    .scale(scale);</pre></div><p>The second change is that we need to translate the axis down the <em>Y</em> axis. We do this using the following statement:</p><div><pre class="programlisting">axisGroup.attr('transform', 'translate(0,50)');</pre></div><p>The result of the preceding example is as follows:</p><div><img src="img/B04230_04_08.jpg" alt="Changing the axis orientation"/></div><p>The orientation has moved the label and ticks to the top of the axis line instead of below.</p><p>The need for a transform is perhaps a little more subtle. If the axis was not transformed, all that we would see in the result is a single black line at the top of the rendering. This is because the positioning of an axis is relative to the path rendering the axis line. In this case, the line would be at <em>y = 0</em>, and the ticks and text would be clipped as they are above the line and not visible.</p><p>Now open the <a id="id217" class="indexterm"/>code for the following example, which renders a right-oriented axis. We will not examine the code, as it is a single simple change of calling <code class="literal">.orient('right')</code>.</p><div><div><h3 class="title"><a id="note64"/>Note</h3><p>bl.ock (4.7): <a class="ulink" href="http://goo.gl/H16kEo">http://goo.gl/H16kEo</a>
</p></div></div><p>The result of the preceding code is the following:</p><div><img src="img/B04230_04_09.jpg" alt="Changing the axis orientation"/></div><p>The following example demonstrates a left-oriented axis. This is again a simple change of the parameter to <code class="literal">.orient()</code>. Additionally, the code also translates the axis to the right a bit, as the the ticks and labels would be clipped off the left.</p><div><div><h3 class="title"><a id="note65"/>Note</h3><p>bl.ock (4.8): <a class="ulink" href="http://goo.gl/CNEFyV">http://goo.gl/CNEFyV</a>
</p></div></div><p>And the results are as follows:</p><div><img src="img/B04230_04_10.jpg" alt="Changing the axis orientation"/></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec31"/>Inverting the labels on an axis</h2></div></div></div><p>We want<a id="id218" class="indexterm"/> to place a left axis on our bar chart, essentially the output of example <em>4.8</em>. But if you examine the axis. you will notice that the labels are increasing from the top to the bottom. Our graph represents <strong>0</strong> at the bottom with values increasing upwards. This axis will not be appropriate for our graph.</p><p>This inversion of labels is a very simple change to the code. Open the following example:</p><div><div><h3 class="title"><a id="note66"/>Note</h3><p>bl.ock (4.9): <a class="ulink" href="http://goo.gl/wsm9Ab">http://goo.gl/wsm9Ab</a>
</p></div></div><p>The code is identical to example <em>4.8</em> except for one change.</p><div><pre class="programlisting">var scale = d3.scale
    .linear()
    .domain([maxValue, 0])
    .range([0, maxValue]);</pre></div><p>We change the order of the values passed to the domain, which will essentially reverse the order of the labels. This gives us the following result:</p><div><img src="img/B04230_04_11.jpg" alt="Inverting the labels on an axis"/></div><p>The labels have been reversed into the order that we desire. Note now that the label 0   is clipped at the bottom. We will fix this in our next example when we combine the axis with the bar graph.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec32"/>Adding the axis to the graph</h2></div></div></div><p>We now have <a id="id219" class="indexterm"/>everything that we need to create a bar graph with an<a id="id220" class="indexterm"/> axis. Essentially, we only need to combine the code from example <em>4.3</em> with the axis code from example <em>4.9</em>. The following example does exactly this:</p><div><div><h3 class="title"><a id="note67"/>Note</h3><p>bl.ock (4.10): <a class="ulink" href="http://goo.gl/MsKhUk">http://goo.gl/MsKhUk</a>
</p></div></div><p>And the result is the following graph, which is exactly what we wanted:</p><div><img src="img/B04230_04_12.jpg" alt="Adding the axis to the graph"/></div><p>The code<a id="id221" class="indexterm"/> in this example is identical to the one in example <em>4.3</em> up<a id="id222" class="indexterm"/> to the point where we create the group to contain the axis:</p><div><pre class="programlisting">var leftAxisGroup = svg.append('g');
var axisPadding = 3;
leftAxisGroup.attr({ 
    transform: 'translate(' + (margin.left - axisPadding) + ',' 
                            + margin.top + ')' });</pre></div><p>The change here is the translation of the axis along the <em>X</em> axis by the width of the left margin, and down the <em>Y</em> axis by the size of the top margin. For aesthetics, the code simply renders the axis with three pixels of padding.</p><div><div><h3 class="title"><a id="note68"/>Note</h3><p>Also note that since we have margin space at the bottom, the <strong>0</strong> label is no longer truncated.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec28"/>Summary</h1></div></div></div><p>In this chapter, you extended your knowledge of using D3 to create a bar graph from a collection of integers. You learned how to position and size each element of the graph according to its data, and how to position groups of data that contain multiple visuals representing a single bar—specifically, how to add a label that represents the value of the underlying datum at the top of a bar.</p><p>We then examined the facilities in D3.js for creating axes. We introduced the concept of a scale, which is an important facet of implementing axes. We further examined the different orientations available for an axis, and how to invert the order of the labels on an axis. Finally, we combined the axis and the bar graph together into an effective visualization of the data.</p><p>As great as our bar chart looks in this example, we will still have several issues. The overall size of the graph was related to the actual values of the data. This was convenient for demonstrating the construction of a bar graph visualization, but what if the values are not integers, or if the values are extremely small or large? We might not see the bars at all, or the bars may be so large as to exceed the size of the main SVG element.</p><p>In the next chapter, we will address these issues by learning more about scales. Scales will provide an exceptionally easy means of mapping data into the physical dimensions of a visualization. You will also learn about loading data from external sources, and about working with data that is more complex in structure than simple integers. </p></div></body></html>