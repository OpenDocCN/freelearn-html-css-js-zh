<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Using Arrays, Nesting, and Grids"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Using Arrays, Nesting, and Grids</h1></div></div></div><p>Now we've had a taste of KnockoutJS, we are now ready to learn new coding skills. In this chapter, we will see how to extend our MVVM skills to make a lot more sweet data interaction experiences. This chapter will focus on:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Conditional binding</li><li class="listitem" style="list-style-type: disc">Simpler nested binding</li><li class="listitem" style="list-style-type: disc">Observable arrays</li><li class="listitem" style="list-style-type: disc">Paged grids</li><li class="listitem" style="list-style-type: disc">Sorting data collections</li></ul></div><div class="section" title="Conditional binding"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Conditional binding</h1></div></div></div><p>Data binding is<a id="id55" class="indexterm"/> the essence of many new libraries that interact with the HTML markup as it gets converted to the DOM. We saw binding in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with KnockoutJS">Chapter 1</a>, <span class="emphasis"><em>Getting Started with KnockoutJS</em></span>, using <a id="id56" class="indexterm"/>the <code class="literal">data-bind ="..."</code> bindings. Here we will be looking at conditional binding.</p><p>The first thing we will do is understand the concept of conditional binding. Our example is meant to be conceptual. We will show a more practical example shortly in this chapter.</p><p>The <code class="literal">if</code> binding plays a very similar role to the visible property in the DOM. The difference is that the <code class="literal">if</code> binding actually adds and removes the content from the DOM whereas visible swaps the CSS display style between visible and none.</p><p>Create a new file by copying the <code class="literal">_base.htm</code> file, located in the <code class="literal">ko_2/do</code> folder, and naming it <code class="literal">condition.htm</code> within the <code class="literal">do</code> folder. If you get stuck, there is a completed copy inside the <code class="literal">done</code> folder. To make things look better, we will now be using the larger Bootstrap template base as it will give us better presentation. You will see the following area in the markup code, which is where you will place the code for the rest of the book:</p><div class="informalexample"><pre class="programlisting">&lt;!-- 
markup code here 
--&gt;</pre></div><p>You will place the <a id="id57" class="indexterm"/>rest of the code in the same place as explained in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with KnockoutJS">Chapter 1</a>, <span class="emphasis"><em>Getting Started with KnockoutJS</em></span>. Again, this is just to make our work look better as we go through the rest of the book. Now, enter the following code in the markup section of the <code class="literal">htm</code> file:</p><div class="informalexample"><pre class="programlisting">                &lt;label&gt;&lt;input type="checkbox" data-bind="checked: showDetails" /&gt;&amp;nbsp;Include Condition&lt;/label&gt;
                &amp;nbsp;
                &lt;span data-bind="if:showDetails"&gt;
                    ( This section shows when the condition is selected. )
                &lt;/span&gt;</pre></div><p>This will give us a checkbox to toggle our content. We will create a variable called <code class="literal">showDetails</code> to bind our content toggle in the <code class="literal">script</code> section of the page. When the checkbox is checked, the content will be added, and when the checkbox is unchecked, the content will be removed. Here is the content for the <code class="literal">script</code> section of the <code class="literal">.htm</code> file:</p><div class="informalexample"><pre class="programlisting">myVM = {
    showDetails: ko.observable(false)
}
ko.applyBindings(myVM);</pre></div><p>There is nothing complex here. We just have a variable that will hold our true or false state. When the variable is true, the content will be added, and when the variable is false, it will be removed from the page. Here is what it will look like when the value is true:</p><div class="mediaobject"><img src="graphics/1028OS_02_01.jpg" alt="Conditional binding"/></div><p>Go ahead and run the code in the browser and toggle the content by setting the checkbox as checked and not checked a few times to make sure your code is working.</p></div></div>
<div class="section" title="Introduction to arrays in Knockout"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Introduction to arrays in Knockout</h1></div></div></div><p>We will start by <a id="id58" class="indexterm"/>working with an unbound array. You will see that Knockout is smart enough to still work with the array and display the contents correctly. In fact, the array we will start out with will be an array with nested data. Add the highlighted data to the <code class="literal">script</code> section of our page:</p><div class="informalexample"><pre class="programlisting">myVM = {
showDetails: ko.observable(false),
<span class="strong"><strong>employee: [</strong></span>
<span class="strong"><strong>{name:"John Jones", spouse: { name: "Mary Jones"}},</strong></span>
<span class="strong"><strong>{name:"Bill Williams", spouse: null},</strong></span>
<span class="strong"><strong>{name:"Sandy Rivers", spouse: { name: "Mark Rivers"}},</strong></span>
<span class="strong"><strong>]</strong></span>
}</pre></div><p>The employee array data will automatically bind to the MVVM system when we run our <code class="literal">applyBindings</code> function on the page. We will need some markup to tell us that it has actually worked. I suggest separating the section of content on the page using the <code class="literal">&lt;hr/&gt;</code> tag just for clarity. Now add the following code to the markup section:</p><div class="informalexample"><pre class="programlisting">&lt;ul data-bind="foreach: employee"&gt;
    &lt;li&gt;Employee: &lt;strong data-bind="text:name"&gt;&lt;/strong&gt;
        &lt;div data-bind="if: spouse"&gt;( Spouse: &lt;strong data- bind="text: spouse.name"&gt;&lt;/strong&gt; )&lt;/div&gt;
        &lt;div data-bind="ifnot: spouse"&gt;( AVAILABLE )&lt;/div&gt;
    &lt;/li&gt;
&lt;/ul&gt;</pre></div><p>We learn a few new commands now with Knockout. The first is the <code class="literal">foreach</code> command. If we have an array, which I refer to as a collection, this will look through each item. We tell the <code class="literal">foreach</code> loop to loop through the employee array collection.</p><p>The next thing you will notice is that the elements of the collection are addressed at the item level. In other words, we do not need to use <code class="literal">myVM.employee.name</code>; instead, we simply use <code class="literal">name</code>. This makes for much cleaner code.</p><p>You will also see we are using the <code class="literal">if</code> command again. We have also thrown in the opposite logic command, <code class="literal">ifnot</code>. If a null result is returned, then it is understood to be the same<a id="id59" class="indexterm"/> thing functionally as a false value. This means if a person does not have a spouse, they will be marked as available. Hint: this would likely cause social waves if you ran a page in your company declaring who was available, so this is definitely not suggested as the best practice for a company web page.</p><div class="mediaobject"><img src="graphics/1028OS_02_02.jpg" alt="Introduction to arrays in Knockout"/></div><p>When we run the code, we get the result as shown in the preceding screenshot. We see that Bill is not married as expected. Since we know it would not be a good idea to post that someone is available there is a simpler way to display this same information while skipping the risky classification. We will copy the code section and repeat it using the <code class="literal">with</code> command in place of the <code class="literal">if</code> command as follows:</p><div class="informalexample"><pre class="programlisting">&lt;ul data-bind="foreach: employee"&gt;
    &lt;li&gt;Employee: &lt;strong data-bind="text:name"&gt;&lt;/strong&gt;
        &lt;div data-bind="with: spouse"&gt;( Spouse: &lt;strong data- bind="text:name"&gt;&lt;/strong&gt; )&lt;/div&gt;
    &lt;/li&gt;
&lt;/ul&gt;</pre></div><p>Here is what the page looks like when we run the <code class="literal">with</code> command:</p><div class="mediaobject"><img src="graphics/1028OS_02_03.jpg" alt="Introduction to arrays in Knockout"/></div><p>Now I am not saying that <code class="literal">with</code> is safer than <code class="literal">if</code> from a technical perspective. You will need to think through your business logic smartly just like you would think about the social issues in this example. Take a few moments and think about the business requirements as the issues that are there are not always technical issues. We need to make sure the technical code is taking care of any business issues that we should know about as we do our work.</p><div class="section" title="Working with array collections"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Working with array collections</h2></div></div></div><p>Let's copy our <code class="literal">_base.htm</code> file to <code class="literal">arrays.htm</code> in the <code class="literal">do</code> folder to continue our study of array collections<a id="id60" class="indexterm"/> in Knockout. First, add our core markup to the new page as follows:</p><div class="informalexample"><pre class="programlisting">&lt;ul data-bind="foreach: employee"&gt;
    &lt;li&gt;Employee: &lt;strong data-bind="text:name"&gt;&lt;/strong&gt;
        &lt;div data-bind="if: spouse"&gt;( Spouse: &lt;strong data- bind="text: spouse.name"&gt;&lt;/strong&gt; )&lt;/div&gt;
    &lt;/li&gt;
&lt;/ul&gt;</pre></div><p>We will again need to create a data model in the <code class="literal">script</code> section for this to work. The following is the code for the data section. Here is where we will start using an observable array. Knockout uses additional logic to handle arrays than it does for simple variable types. These arrays can be a collection of simple variables or nested rows of complex structure:</p><div class="informalexample"><pre class="programlisting">myVM = {
    showDetails: ko.observable(false),
    employee: ko.observableArray([
          {name:'John Jones', spouse: { name: "Mary Jones"}},
          {name:'Bill Williams', spouse: null},
          {name:'Sandy Rivers', spouse: { name: "Mark Rivers"}}
    ]),
    alt: ko.observableArray()
}
ko.applyBindings(myVM);</pre></div><p>Run the page and make sure you get the following result. Of course, if you modified the data, you get bonus points for exploring and enjoying the work. In that case, your results will look slightly different.</p><div class="mediaobject"><img src="graphics/1028OS_02_04.jpg" alt="Working with array collections"/></div><p>We will be adding four different buttons to experience working with array collections <a id="id61" class="indexterm"/>using observable arrays in Knockout. Before we do that, here are the functions we can perform on array methods:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">push()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Adds item <a id="id62" class="indexterm"/>to the end of the collection</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pop()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Removes the<a id="id63" class="indexterm"/> last item from the collection</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">unshift()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Inserts<a id="id64" class="indexterm"/> a new item at the start of the collection</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shift()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Removes<a id="id65" class="indexterm"/> the first item from the collection and returns it</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reverse()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Swaps <a id="id66" class="indexterm"/>the order of items in the collection</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">sort()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Sorts the order<a id="id67" class="indexterm"/> of the collection (requires a sorting function)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">splice()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Removes a given number of elements from the collection beginning at a declared <a id="id68" class="indexterm"/>starting point</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">remove()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Removes all values <a id="id69" class="indexterm"/>that equal something and returns them as an array; this can also be run as a function for identifying items</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">removeAll()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Removes<a id="id70" class="indexterm"/> all items from an array list or removes everything and returns removed items as an array</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">destroy()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id71" class="indexterm"/> the <span class="strong"><strong>Ruby on Rails</strong></span> (<span class="strong"><strong>RoR</strong></span>) version <a id="id72" class="indexterm"/>of <code class="literal">remove()</code> to make things more familiar to RoR developers</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">destroyAll()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id73" class="indexterm"/>RoR version of <code class="literal">removeAll()</code> to make things more familiar to RoR developers</p>
</td></tr></tbody></table></div><p>We will start by adding a button to the page to work with reversing the array collection order. On this page, we will be practicing interacting with the data model by using functions outside the MVVM binding of Knockout. We will still be interacting with the binding results. This will help build inside and outside coding skills to use Knockout in different scenarios. Use the following code to make a button:</p><div class="informalexample"><pre class="programlisting">&lt;button onclick="myVM.employee.reverse()"&gt;Reverse Sort Staff&lt;/button&gt;</pre></div><p>You see here that we are running the JavaScript directly from the button using the <code class="literal">reverse</code> method of the array collection. Add this button and run the page again. After clicking on the button, you will see that all of the items in the array collection are now in reverse order. Click on it again and again and you will see it will reverse the items each time you click. If you compare the previous screenshot with the following screenshot, you can see the items in the array collection are reversed:</p><div class="mediaobject"><img src="graphics/1028OS_02_05.jpg" alt="Working with array collections"/></div><p>While this is<a id="id74" class="indexterm"/> all nice, dynamic websites are sites that need to have data added and removed. We will get started learning about this right now in this chapter. The first thing we will do is create a button to add staff. Add the highlighted code here to the markup section of the page:</p><div class="informalexample"><pre class="programlisting">&lt;button onclick="myVM.employee.reverse()"&gt;Reverse Sort Staff&lt;/button&gt;
<span class="strong"><strong>&amp;nbsp;</strong></span>
<span class="strong"><strong>&lt;button onclick="addStaff()"&gt;Add Staff&lt;/button&gt;</strong></span>
</pre></div><div class="mediaobject"><img src="graphics/1028OS_02_06.jpg" alt="Working with array collections"/></div><p>You see the <code class="literal">addStaff</code> function that we need to add staff to our page attached to the <code class="literal">onClick</code> event handler of the button. We will need to use the <code class="literal">push</code> method of our bound array collection to add this in. Add the following function to the <code class="literal">script</code> section of the code:</p><div class="informalexample"><pre class="programlisting">function addStaff(){
    myVM.employee.push({name:"Charlie Targus", spouse: {name:"Patti Targus"}});
}</pre></div><p>Now, when we run the code, it should add the new employee as expected. The <code class="literal">push</code> method will always add the item to the end of the collection, as seen in the following screenshot:</p><div class="mediaobject"><img src="graphics/1028OS_02_07.jpg" alt="Working with array collections"/></div><p>Let's refresh<a id="id75" class="indexterm"/> the page and follow these steps in order to verify that assumption:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Refresh the page.</li><li class="listitem">Click on the <span class="strong"><strong>Reverse Sort Staff</strong></span> button.</li><li class="listitem">Click on the <span class="strong"><strong>Add Staff</strong></span> button.</li><li class="listitem">Click on the <span class="strong"><strong>Reverse Sort Staff</strong></span> button one more time.</li></ol></div><p>And here is the output image you get:</p><div class="mediaobject"><img src="graphics/1028OS_02_08.jpg" alt="Working with array collections"/></div><p>If all we wanted to do was put the item at the top of the list, it would have been too much work. This will become especially true as we begin to work with larger and larger sets of data. To insert an item at the start of the array collection, we will use the <code class="literal">unshift</code> method in place of the <code class="literal">push</code> method.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Now is there anyone besides me who thinks the term <code class="literal">unshift()</code> is just strange? Perhaps that will help us remember it easier!</p></div></div></div><div class="section" title="Removing the last item"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Removing the last item</h2></div></div></div><p>We saw how <code class="literal">push</code> added the item to the end of the data; now we can take a look at pulling the last item off the array collection. If you use the <code class="literal">pop</code> method, it will not be the last item <a id="id76" class="indexterm"/>added to the end of the data, but the last item on the collection. This will be the last item showing on the page at the bottom of the list of employees; in our case, we will use the following lines code:</p><div class="informalexample"><pre class="programlisting">&lt;br/&gt;
&lt;button onclick="myVM.employee.pop()"&gt;Remove Staff&lt;/button&gt;</pre></div><p>Now add a staff member using the <span class="strong"><strong>Add Staff</strong></span> button and you will get the following result:</p><div class="mediaobject"><img src="graphics/1028OS_02_09.jpg" alt="Removing the last item"/></div><p>We see things working just like before. Now there are four staff members. We are now going to remove the last item using the inline JavaScript code within our button's <code class="literal">onClick</code> method. This has the opposite effect of the <code class="literal">push</code> function that adds an item to the end of the array collection. It removes the very last item of the array collection.</p><p>Here is the view you should have after clicking on the <span class="strong"><strong>Remove Staff</strong></span> button:</p><div class="mediaobject"><img src="graphics/1028OS_02_10.jpg" alt="Removing the last item"/></div><p>Try clicking on the <span class="strong"><strong>Reverse Sort Staff</strong></span> button followed by the <span class="strong"><strong>Remove Staff</strong></span> button. This time, <a id="id77" class="indexterm"/>you should see <span class="strong"><strong>John Jones</strong></span> gone from the bottom of the list, and the list should look like this:</p><div class="mediaobject"><img src="graphics/1028OS_02_11.jpg" alt="Removing the last item"/></div></div></div>
<div class="section" title="Sorting time"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Sorting time</h1></div></div></div><p>Displaying <a id="id78" class="indexterm"/>data is a very common use case for web pages. Perhaps the most common function people <a id="id79" class="indexterm"/>perform on data besides searching is sorting. We are going to look at how to sort data based on particular data fields. This time, we will create the logic first. Enter the following code into the <code class="literal">script</code> tag:</p><div class="informalexample"><pre class="programlisting">function doSort() {
    myVM.employee.sort(function (left, right) {
        return left.name == right.name ? 0 : (left.name &lt; right.name ? -1 : 1);
    });
}</pre></div><p>We will break down the logic for those unfamiliar with this level of JavaScript:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The <code class="literal">sort</code> function passes in two structures. Each structure matches the items being sorted. The variable name could be anything; we choose <code class="literal">left</code> and <code class="literal">right</code> because it helps the programmer remember which variable is which. You can use, of course, any variable naming you choose. Each variable contains the whole structure of the item being passed in.</li><li class="listitem">The basic return value for <code class="literal">sort</code> needs to be true or false. This tells the program whether the two items should be swapped. This is why they return a value using the ternary symbols. It is likely that these are not symbols you used in high school math, so they will be foreign to most of us. Here is an explanation:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First, there is a logical comparison followed by the <code class="literal">?</code> symbol; symbolizing the value before <code class="literal">?</code> tells us whether the results should be based on true or on false.</li><li class="listitem" style="list-style-type: disc">The first value is what should be returned if the results are true.</li><li class="listitem" style="list-style-type: disc">Then there is a colon to represent the results that should be returned if the logic evaluation is false.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>You should see here that the logic can be stacked to perform a second logical evaluation if desired. This could be in either the true or false position.</p></div></div></li><li class="listitem">The second <a id="id80" class="indexterm"/>value will be what is returned if the value is false. Again, in this example, we observe <a id="id81" class="indexterm"/>a nested logic that is run when the results are false.<p>Here is the same logic in an <code class="literal">if</code> statement for the sake of comparison:</p><div class="informalexample"><pre class="programlisting">function doSort() {
    myVM.employee.sort(function (left, right) {
        if (left.name == right.name) {
            return 0;
        } else {
            if (left.name &lt; right.name) {
                return -1;
            } else {
                return 1;
            }
        }
    });
}</pre></div></li><li class="listitem">One of the things you should notice is that there is definitely less code using the ternary operator approach. This doesn't mean using the <code class="literal">if</code> approach is wrong; it's just more code to get right, and the more code we type, of course, the more time we are likely to spend debugging. If you don't have a standard where you work and prefer to use the <code class="literal">if</code> logic, feel free to go that way. My main goal was to show you what many experienced developers do so you could understand the code.</li><li class="listitem">Now, let's add the button to call the code in the markup:<div class="informalexample"><pre class="programlisting">&lt;br/&gt;
&lt;button onclick="myVM.employee.pop()"&gt;Remove Staff&lt;/button&gt;
<span class="strong"><strong>&amp;nbsp;</strong></span>
<span class="strong"><strong>&lt;button onclick="doSort()"&gt;Sort Staff&lt;/button&gt;</strong></span>
</pre></div><p>This is what you should see before the sort button is clicked on:</p><div class="mediaobject"><img src="graphics/1028OS_02_12.jpg" alt="Sorting time"/></div><p>Notice that<a id="id82" class="indexterm"/> it sorts alphabetically based on the first name because the whole name is stored as a <a id="id83" class="indexterm"/>single field. This is what we expected, and it is working correctly if it looks the same as in the following image:</p><div class="mediaobject"><img src="graphics/1028OS_02_13.jpg" alt="Sorting time"/></div></li><li class="listitem">Now, let's add a staff member to see whether it will sort properly with the added item:<div class="mediaobject"><img src="graphics/1028OS_02_14.jpg" alt="Sorting time"/></div></li><li class="listitem">Press the <span class="strong"><strong>Sort Staff</strong></span> button <a id="id84" class="indexterm"/>to see whether our added item appears properly in the employee<a id="id85" class="indexterm"/> list:<div class="mediaobject"><img src="graphics/1028OS_02_15.jpg" alt="Sorting time"/></div></li></ol></div></div>
<div class="section" title="The simpleGrid plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>The simpleGrid plugin</h1></div></div></div><p>Just like jQuery allows for custom plugins, it is possible to use plugins with Knockout as well. Here, we <a id="id86" class="indexterm"/>are going to use a simple plugin to add grid functionality to our page. This plugin also smartly adds paging to the page. We will also do some simple CSS to set our grid so it loosens up the space between the cells in the table.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>The reason we code with jQuery, KnockoutJS, Bootstrap, and other <span class="strong"><strong>Don't Repeat Yourself</strong></span> (<span class="strong"><strong>DRY)</strong></span> libraries is that they package our work. We don't have to <a id="id87" class="indexterm"/>rethink, recode, or repeat our work when this is done. Using solutions such as jQuery and KnockoutJS, we can DRY out our code by adding our own library extensions. The simple grid plugin is an example of this.</p><p>Note that we will cover enough detail in this book that by the end you should be able to modify this plugin or build your own. However, you will have to understand JavaScript, CSS, HTML, and other topics enough to get the job you are seeking to DRY out. Regarding KnockoutJS, you will get the knowledge you need from this book. (The <code class="literal">simpleGrid</code> code was acquired from the KnockoutJS main site. It is not part of the core but great learning code just the same.)</p></div></div><p>Use the <code class="literal">_base.htm</code> copy and create a new page in the <code class="literal">do</code> folder of <code class="literal">ko_2</code>, named <code class="literal">paged.htm</code> for this exercise. The first modification we will make is adding the highlighted line after the <code class="literal">include</code> tag for Knockout.js near the bottom of the code:</p><div class="informalexample"><pre class="programlisting">&lt;script src="/share/js/knockout.js"&gt;&lt;/script&gt;
<span class="strong"><strong>&lt;script src="/share/js/simplegrid.js"&gt;&lt;/script&gt;</strong></span>
&lt;script&gt;
&lt;/script&gt;</pre></div><p>This adds in the logic we need for the simple grid plugin for Knockout. Now we can create the markup for our exercise. In the markup section, add the following markup:</p><div class="informalexample"><pre class="programlisting">&lt;div data-bind="simpleGrid: orderVM"&gt;&lt;/div&gt;
&lt;button data-bind="click: addOrder"&gt;Add Order&lt;/button&gt;
&lt;button data-bind="click: orderPageOne, enable: orderVM.currentPageIndex"&gt;First Page&lt;/button&gt;</pre></div><p>Look closely at <a id="id88" class="indexterm"/>the <code class="literal">data-bind</code> attribute of the <code class="literal">div</code> tag. You should notice a new command attribute called <code class="literal">simpleGrid</code>. This is not part of Knockout by default. It has been added by our plugin. The <code class="literal">orderVM</code> attribute that follows is a root structure in our ViewModel. This elegant code teaches you how to package your code. It is so much simpler and easier to reuse your work or even take advantage of the work of others.</p><p>Let's go through this code. First, we will add in some data for the grid within the <code class="literal">script</code> tag section. This code will be a standard array collection. Take a look at the following code:</p><div class="informalexample"><pre class="programlisting">var initOrders = [
    { name: "John Jones", item: "Apples", qty: 12 },
    { name: "Bill Williams", item: "Pears", qty: 24 },
    { name: "Sandy Rivers", item: "Bananas", qty: 44 },
    { name: "Patti Targus", item: "Peaches", qty: 12 }
];</pre></div><p>Next, we will add our ViewModel to bind using Knockout. Add the following code to the page in the <code class="literal">script</code> section:</p><div class="informalexample"><pre class="programlisting">var PagedOrderModel = function (orders) {
    this.orders = ko.observableArray(orders);
    this.orderVM = new ko.simpleGrid.viewModel({
        data: this.orders
    });
};
ko.applyBindings(new PagedOrderModel(initOrders));</pre></div><div class="section" title="Running the code"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Running the code</h2></div></div></div><p>This is a <a id="id89" class="indexterm"/>common manner in which you will see code for Knockout. Let's run the code and make some observations:</p><div class="mediaobject"><img src="graphics/1028OS_02_16.jpg" alt="Running the code"/></div><p>We see that our data displays as expected with the names of the collection item fields listed as the<a id="id90" class="indexterm"/> column names. It also added a paging item to the bottom automatically. This is the default configuration when running the code for the <code class="literal">simpleGrid</code> plugin. The default page size is 5 records per page. Notice that the columns are all squished together. Let's begin by adding the following line of code to the CSS styles on our page:</p><div class="informalexample"><pre class="programlisting">table { width: 400px;}</pre></div><div class="mediaobject"><img src="graphics/1028OS_02_17.jpg" alt="Running the code"/></div><p>This looks much better with this simple modification. If you are using this grid and actually need more control over the style, you can use the cascading logic in CSS and nest the table inside a second <code class="literal">div</code> tag to create an ID or class to manage tables contained within that class.</p><p>Next, we want to modify the columns and the default number of columns that show by setting the configuration. Add this highlighted code to our <code class="literal">script</code> section on the page:</p><div class="informalexample"><pre class="programlisting">this.orderVM = new ko.simpleGrid.viewModel({
      data: this.orders,
<span class="strong"><strong>      columns: [</strong></span>
<span class="strong"><strong>              { headerText: "Customer", rowText: "name"},</strong></span>
<span class="strong"><strong>              { headerText: "Item", rowText: "item"},</strong></span>
<span class="strong"><strong>              { headerText: "Count", rowText: "qty"}</strong></span>
<span class="strong"><strong>      ],</strong></span>
<span class="strong"><strong>      pageSize: 3</strong></span>
});</pre></div><p>With the columns detail declared and the page size set, we see the greater value of using DRY code. This has enabled us to manage the ViewModel from our scripted code. This is our result with our code at this point:</p><div class="mediaobject"><img src="graphics/1028OS_02_18.jpg" alt="Running the code"/></div><p>Now you <a id="id91" class="indexterm"/>can click through to page 2 to see how this grid is working. We also see that our columns look much better with custom column names.</p><p>It is time to consider the best practice approach to coding with Knockout. Open your browser developer tools and go to <span class="strong"><strong>Console</strong></span>. From the console, we want to interact with the ViewModel. Try typing the following in the command prompt:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; PagedOrderModel.orders()</strong></span>
</pre></div><p>You will get a response similar to the undefined response given by Chrome. The model is there and working but suddenly you cannot access the model. This one stumped me the first time my code had this issue. The biggest stump was that my code came from an online example, but there was a key point I was missing. The online example was not interacting with the code from the command prompt and it was not interacting with the code from JavaScript outside the ViewModel.</p><p>The problem is when we declare a <code class="literal">new</code> object within a JavaScript function, the object will not be available outside the call to the code. We can solve this by creating a variable to hold the object outside the method call and then passing in the object that was created outside the method argument. Let's change the <code class="literal">applyBindings</code> method by making the following changes. First add the line declaring the variable and then update the <code class="literal">applyBindings</code> method, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>pagedOrderModel = new PagedOrderModel(initOrders)</strong></span>;
ko.applyBindings(<span class="strong"><strong>pagedOrderModel</strong></span>);</pre></div><p>Now we can return to the browser developer tools and run the page again. Then type the new command in and notice that the first P is now in lowercase. JavaScript is case sensitive, so make sure you get your upper and lowercase right:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; pagedOrderModel.orders()</strong></span>
</pre></div><p>Now you should see an array of collection items. I expanded the first one so we could see the results from Chrome here:</p><div class="mediaobject"><img src="graphics/1028OS_02_19.jpg" alt="Running the code"/></div><p>If you are using JavaScript and it is not connecting to your ViewModel, then you might want to <a id="id92" class="indexterm"/>make sure you have not made the previously explained error in coding. This is only an issue if you need to connect to the ViewModel from outside the ViewModel.</p><p>Now it is time to add some buttons below our grid for even more custom control. We will be adding two buttons: <span class="strong"><strong>Add Order</strong></span> and <span class="strong"><strong>First Page</strong></span>. Let's add the <span class="strong"><strong>Add Order</strong></span> button first. It is code we should be familiar with as we have used it earlier in this chapter. We are going to use it again to show that even while working with a completely different <a id="id93" class="indexterm"/>
<span class="strong"><strong>user interface</strong></span> (<span class="strong"><strong>UI</strong></span>) presentation, when we update the data in the ViewModel, the View is automatically updated. Add the following code to our <code class="literal">script</code> section on the page:</p><div class="informalexample"><pre class="programlisting">this.addOrder = function(){
       this.orders.push({name:"Gerry Markus", item: "Plums", qty:20});
};</pre></div><p>We also, of course, need the markup for the button:</p><div class="informalexample"><pre class="programlisting">&lt;button data-bind="click: addOrder"&gt;Add Order&lt;/button&gt;</pre></div><p>After adding the button, refresh the browser. Add the order and click through to the second page of data, and this is what it should look like:</p><div class="mediaobject"><img src="graphics/1028OS_02_20.jpg" alt="Running the code"/></div><p>We see that the record for <span class="strong"><strong>Gerry Markus</strong></span> has been added. We could use any of the code we used in earlier examples to do things like reversing or removing records using the array methods listed in this chapter.</p><p>Now, we have one more button to add that will allow us to control the grid page from our ViewModel. First, add the following markup:</p><div class="informalexample"><pre class="programlisting">&lt;button data-bind="click: orderPageOne"&gt;First Page&lt;/button&gt;</pre></div><p>We see the <a id="id94" class="indexterm"/>click event is wired to the ViewModel method to move to page one. We also see a command to enable the page index. This will make sure our index is updated.</p><p>There are some other methods that can be called on <code class="literal">simpleGrid</code> that have been listed here. You will notice that some of the items are variables while others are method calls:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.columns</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.data()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.currentPageIndex()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.itemsOnCurrentPage()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.maxPageIndex()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">pagedOrderModel.orderVM.pageSize</code></li></ul></div><p>Remember, if you use these items bound to the Knockout <code class="literal">data-bind</code> attributes, you don't always need the parenthesis. This topic was covered in <a class="link" href="ch01.html" title="Chapter 1. Getting Started with KnockoutJS">Chapter 1</a>, <span class="emphasis"><em>Getting Started with KnockoutJS</em></span>.</p><p>The final <code class="literal">script</code> section should look like this:</p><div class="informalexample"><pre class="programlisting">var PagedOrderModel = function(orders) {
    this.orders = ko.observableArray(orders);
    this.addOrder = function(){
          this.orders.push({name:"Gerry Markus", item: "Plums", qty:20});
};
    this.orderPageOne = function(){
          this.orderVM.currentPageIndex(0);
};
    this.orderVM = new ko.simpleGrid.viewModel({
          data: this.orders,
          columns: [
                { headerText: "Customer", rowText: "name"},
                { headerText: "Item", rowText: "item"},
                { headerText: "Count", rowText: "qty"}
          ],
          pageSize: 3
    });
};</pre></div></div><div class="section" title="Final sort"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Final sort</h2></div></div></div><p>Congratulations on creating a fairly functional piece of code using Knockout! Yet, what would data interaction be without the ability to sort? We are going to see how to take the <a id="id95" class="indexterm"/>sorting we did earlier and modify it to make it more dynamic than our previous example with a few simple modifications. You can just continue to modify the current page or you could copy the page as <code class="literal">sorting.htm</code> as that is how we approached it. Note that this is completely a matter of choice as it will only serve to make your <code class="literal">do</code> folder match our <code class="literal">done</code> folder.</p><p>Add the following two buttons to your page:</p><div class="informalexample"><pre class="programlisting">&lt;button data-bind="click: sort('name')"&gt;Sort By Name&lt;/button&gt;
&lt;button data-bind="click: sort('item')"&gt;Sort By Item&lt;/button&gt;</pre></div><p>In our previous example for sorting, we did not pass in any values during the method call. Here, we are passing the name of a field in our data that tells us what we will be sorting with. This follows our theme of DRY coding as we are able to use the same command for either of these buttons or in any future code that matches. Here is the <code class="literal">script</code> code we need to add to actually do the sorting:</p><div class="informalexample"><pre class="programlisting">this.sort = function(by){
    this.orders.sort(function(left,right){
          return left[by] &lt; right[by] ? -1 : 1;
    });
};</pre></div><p>As simple as it seems, this is all the code it takes to create a reusable piece of code allowing us to sort when desired. Here is a screenshot showing name-based sorting:</p><div class="mediaobject"><img src="graphics/1028OS_02_21.jpg" alt="Final sort"/></div><p>Here is another screenshot based on item sorting:</p><div class="mediaobject"><img src="graphics/1028OS_02_22.jpg" alt="Final sort"/></div><p>Why don't you <a id="id96" class="indexterm"/>create one more button to sort based on quantity as an exercise to see whether you have it figured out. The following screenshot is what the table should look like if you get it right. We will do one more thing though. We need to make sure our sort is out of order, so click on the <span class="strong"><strong>Sort By Name</strong></span> button first. Then, clicking on the <span class="strong"><strong>Sort By Quantity</strong></span> button should give us this result:</p><div class="mediaobject"><img src="graphics/1028OS_02_23.jpg" alt="Final sort"/></div><p>Now, we should modify the table so that we can do reverse sorting. Basically, all that is needed is for us to flip our greater than sign in our code where we compare the left and right items passed from the sorting logic. We will, of course, also need another argument in our method because we want to reuse our code. Since the sort direction is not always passed in, we will also include a line to set ascending sort as the default choice if one is not declared. The <code class="literal">script</code> code should look like this with the changes highlighted:</p><div class="informalexample"><pre class="programlisting">this.sort = function (by, direction) {
<span class="strong"><strong>    direction = typeof direction === 'undefined' ?</strong></span>
<span class="strong"><strong>        'asc' : direction</strong></span>
<span class="strong"><strong>    if (direction === 'asc') {</strong></span>
        this.orders.sort(function (left, right) {
            return left[by] &lt; right[by] ? -1 : 1;
        });
<span class="strong"><strong>    } else {</strong></span>
<span class="strong"><strong>        this.orders.sort(function (left, right) {</strong></span>
<span class="strong"><strong>            return left[by] &gt; right[by] ? -1 : 1;</strong></span>
<span class="strong"><strong>        });</strong></span>
<span class="strong"><strong>    }</strong></span>
};</pre></div><p>We will, of <a id="id97" class="indexterm"/>course, need a new set of buttons for the reverse sort as well:</p><div class="informalexample"><pre class="programlisting">&lt;button data-bind="click: sort('name','desc')"&gt;Reverse By Name&lt;/button&gt;
&lt;button data-bind="click: sort('item','desc')"&gt;Reverse By Item&lt;/button&gt;
&lt;button data-bind="click: sort('qty','desc')"&gt;Reverse By Quantity&lt;/button&gt;</pre></div><p>Here is the view with the reverse sort on the quantity column labeled <span class="strong"><strong>Count</strong></span>:</p><div class="mediaobject"><img src="graphics/1028OS_02_24.jpg" alt="Final sort"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Summary</h1></div></div></div><p>If you have ever built any JavaScript pages with this much interaction with your data using JavaScript or even with jQuery, then you will know why the library deserves the title of Knockout. The amount of power we have gained using this library in just two chapters is compelling. Through this chapter you should have gained the ability to do conditional binding, nested binding, observable array collections, adding and deleting records in array style management, and sorting observable arrays. You even got a quick look at a Knockout plugin.</p><p>In the next chapter, we will learn to drive web forms with the power of Knockout. They think differently; and for a few, that is the first reaction. It is an interesting double take as the second reaction that nearly instantly follows is that it is better. Event binding is also a topic we will dig into in the next chapter with special focus on the over-the-top punch Knockout gives us when dealing with grid forms.</p></div></body></html>