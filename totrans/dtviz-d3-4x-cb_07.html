<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 7. Getting into Shape"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/><span class="koboSpan" id="kobo.1.1">Chapter 7. Getting into Shape</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Creating simple shapes</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Using a line generator</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Using line curve</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Changing line tension</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.7.1">Using an area generator</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.8.1">Using area curve</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.9.1">Using an arc generator</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.10.1">Implementing arc transition</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/><span class="koboSpan" id="kobo.11.1">Introduction</span></h1></div></div></div><p>
<span class="strong"><strong><span class="koboSpan" id="kobo.12.1">Scalable Vector Graphics</span></strong></span><span class="koboSpan" id="kobo.13.1"> (</span><span class="strong"><strong><span class="koboSpan" id="kobo.14.1">SVG</span></strong></span><span class="koboSpan" id="kobo.15.1">) is a mature </span><span class="strong"><strong><span class="koboSpan" id="kobo.16.1">World Wide Web Consortium</span></strong></span><span class="koboSpan" id="kobo.17.1"> (</span><span class="strong"><strong><span class="koboSpan" id="kobo.18.1">W3C</span></strong></span><span class="koboSpan" id="kobo.19.1">) standard designed for user-interactive graphics on the Web and Mobile platform. </span><span class="koboSpan" id="kobo.19.2">Similar to HTML, SVG can coexist happily with other technologies, such as CSS and JavaScript, in modern browsers and forms the backbone of many Web applications. </span><span class="koboSpan" id="kobo.19.3">In today's Web, you can see use cases of SVG everywhere, from digital map to data visualization. </span><span class="koboSpan" id="kobo.19.4">So far, in this book, we covered most of the recipes using HTML elements alone; however, in real-world projects, SVG is the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.20.1">de facto</span></em></span><span class="koboSpan" id="kobo.21.1"> standard for data visualization; it is also where D3's strength really shines. </span><span class="koboSpan" id="kobo.21.2">In this chapter, we will cover the basic concept of SVG and D3's support for SVG shape generation. </span><span class="koboSpan" id="kobo.21.3">SVG is a very rich topic. </span><span class="koboSpan" id="kobo.21.4">Volumes of books can be, and have been, devoted to this topic alone; hence, we will not plan or even try to cover all SVG-related topics, rather we'll focus on D3 and data visualization-related techniques and features.</span></p><div class="section" title="What is SVG?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec133"/><span class="koboSpan" id="kobo.22.1">What is SVG?</span></h2></div></div></div><p><span class="koboSpan" id="kobo.23.1">As its name suggests, SVG is about graphics. </span><span class="koboSpan" id="kobo.23.2">It is a way to describe graphical image with scalable vectors. </span><span class="koboSpan" id="kobo.23.3">Let's take a look at the following two of the main SVG advantages:</span></p><div class="section" title="Vector"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec10"/><span class="koboSpan" id="kobo.24.1">Vector</span></h3></div></div></div><p><span class="koboSpan" id="kobo.25.1">SVG image is based on vectors instead of pixels. </span><span class="koboSpan" id="kobo.25.2">With the pixel-based approach, an image is composed of a bitmap with </span><span class="emphasis"><em><span class="koboSpan" id="kobo.26.1">x</span></em></span><span class="koboSpan" id="kobo.27.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.28.1">y</span></em></span><span class="koboSpan" id="kobo.29.1"> as its coordinates filled with color pigmentations. </span><span class="koboSpan" id="kobo.29.2">Whereas, with the vector-based approach, each image consists of a set of geometric shapes described using simple and relative formulae filled with certain texture. </span><span class="koboSpan" id="kobo.29.3">As you can imagine, this latter approach fits naturally with our data visualization requirement. </span><span class="koboSpan" id="kobo.29.4">It is much simpler to visualize your data with lines, bar, and circles in SVG rather than trying to manipulate color pigmentations in a bitmap.</span></p></div><div class="section" title="Scalability"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec11"/><span class="koboSpan" id="kobo.30.1">Scalability</span></h3></div></div></div><p><span class="koboSpan" id="kobo.31.1">The second signature capability of SVG is scalability. </span><span class="koboSpan" id="kobo.31.2">Since SVG graphic is a group of geometric shapes described using relative formulas, it can be rendered and re-rendered</span></p><p><span class="koboSpan" id="kobo.32.1">with different sizes and zoom levels without losing precision. </span><span class="koboSpan" id="kobo.32.2">On the other hand, when</span></p><p><span class="koboSpan" id="kobo.33.1">bitmap-based images are resized to a large resolution, they suffer the effect of pixelation, which occurs when the individual pixels become visible, while SVG does not have this drawback. </span><span class="koboSpan" id="kobo.33.2">Refer to the following figure to get a better picture of what we just read:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.34.1"><img src="graphics/image_07_001.jpg" alt="Scalability"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.35.1">SVG versus bitmap pixelation</span></p><p><span class="koboSpan" id="kobo.36.1">As a data visualizer, using SVG gives you the benefit of being able to display your visualization on any resolution without losing the crispiness of your eye-catching creation. </span><span class="koboSpan" id="kobo.36.2">On top of that, SVG offers you some additional advantages such as the following:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.37.1">Readability</span></strong></span><span class="koboSpan" id="kobo.38.1">: SVG is based on XML, a human-readable markup language.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.39.1">Open standard</span></strong></span><span class="koboSpan" id="kobo.40.1">: SVG was created by W3C and is not a proprietary vendor standard.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.41.1">Adoption</span></strong></span><span class="koboSpan" id="kobo.42.1">: All modern browsers support SVG standard, even on mobile platform.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.43.1">Interoperability</span></strong></span><span class="koboSpan" id="kobo.44.1">: SVG works well with other Web technologies, such as CSS and JavaScript; D3 itself is a perfect demonstration of this capability.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.45.1">Lightweight</span></strong></span><span class="koboSpan" id="kobo.46.1">: Compared to bitmap-based images, SVG is a lot lighter and takes up much less space.</span></li></ul></div><p><span class="koboSpan" id="kobo.47.1">Because of all these capabilities we have mentioned so far, SVG has become the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.48.1">de facto</span></em></span><span class="koboSpan" id="kobo.49.1"> standard for data visualization on the Web. </span><span class="koboSpan" id="kobo.49.2">From this chapter onward, all recipes in this book will be illustrated using SVG as its most important part, with which the true power of D3 can be professed.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note67"/><span class="koboSpan" id="kobo.50.1">Note</span></h3><p><span class="koboSpan" id="kobo.51.1">Some older browsers do not support SVG natively. </span><span class="koboSpan" id="kobo.51.2">If your target users are using legacy browsers, please check the SVG compatibility before deciding whether SVG is the right choice for your visualization project. </span><span class="koboSpan" id="kobo.51.3">Here is a link that you can visit to check your browser's compatibility:
</span><a class="ulink" href="http://caniuse.com/#feat=svg"><span class="koboSpan" id="kobo.52.1">http://caniuse.com/#feat=svg
</span></a>
</p></div></div></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating simple shapes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/><span class="koboSpan" id="kobo.1.1">Creating simple shapes</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this recipe, we will explore a few simple built-in SVG shape formulas and their attributes. </span><span class="koboSpan" id="kobo.2.2">These simple shapes are quite easy to generate and are usually created manually using D3 when necessary. </span><span class="koboSpan" id="kobo.2.3">Though these simple shapes are not the most useful shape generator to know when working with D3, occasionally, they could be handy when drawing peripheral shapes in your visualization project.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec134"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/simple-shapes.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/simple-shapes.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec135"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will draw four different shapes in four different colors using native SVG shape elements:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
    var width = 600, 
        height = 500; 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width);     
 
    svg.append("line") // &lt;-A 
        .attr("x1", 0) 
        .attr("y1", 200) 
        .attr("x2", 100) 
        .attr("y2", 100); 
 
    svg.append("circle") // &lt;-B 
        .attr("cx", 200) 
        .attr("cy", 150) 
        .attr("r", 50); 
 
    svg.append("rect") 
        .attr("x", 300) // &lt;-C 
        .attr("y", 100) 
        .attr("width", 100) // &lt;-D 
        .attr("height", 100) 
        .attr("rx", 5); // &lt;-E 
 
    svg.append("polygon") 
        .attr("points", "450,200 500,100 550,200"); // &lt;-F 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_07_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Simple SVG shapes</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec136"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">We have drawn four different shapes-a line, a circle, a rectangle, and a triangle-in this example using SVG built-in shape elements, which can be described as follows:</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip68"/><span class="koboSpan" id="kobo.14.1">Tip</span></h3><p>
<span class="strong"><strong><span class="koboSpan" id="kobo.15.1">A little refresher on SVG coordinate system</span></strong></span><span class="koboSpan" id="kobo.16.1">
SVG </span><span class="emphasis"><em><span class="koboSpan" id="kobo.17.1">x</span></em></span><span class="koboSpan" id="kobo.18.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.19.1">y</span></em></span><span class="koboSpan" id="kobo.20.1"> coordinate system originates from the top-left corner </span><code class="literal"><span class="koboSpan" id="kobo.21.1">(0, 0)</span></code><span class="koboSpan" id="kobo.22.1"> of the canvas and ends on the lower-right corner </span><code class="literal"><span class="koboSpan" id="kobo.23.1">(&lt;width&gt;, &lt;height&gt;)</span></code><span class="koboSpan" id="kobo.24.1">.</span></p></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.25.1">line</span></code><span class="koboSpan" id="kobo.26.1">: A line element creates a simple straight line with coordinate attributes </span><code class="literal"><span class="koboSpan" id="kobo.27.1">x1</span></code><span class="koboSpan" id="kobo.28.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.29.1">y1</span></code><span class="koboSpan" id="kobo.30.1"> as its start point and </span><code class="literal"><span class="koboSpan" id="kobo.31.1">x2</span></code><span class="koboSpan" id="kobo.32.1">, </span><code class="literal"><span class="koboSpan" id="kobo.33.1">y2</span></code><span class="koboSpan" id="kobo.34.1"> as its endpoint (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.35.1">A</span></code><span class="koboSpan" id="kobo.36.1">).</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.37.1">circle</span></code><span class="koboSpan" id="kobo.38.1">: The </span><code class="literal"><span class="koboSpan" id="kobo.39.1">append()</span></code><span class="koboSpan" id="kobo.40.1"> function draws a circle with coordinate attributes </span><code class="literal"><span class="koboSpan" id="kobo.41.1">cx</span></code><span class="koboSpan" id="kobo.42.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.43.1">cy</span></code><span class="koboSpan" id="kobo.44.1"> defining the center of the circle, whereas the attribute </span><code class="literal"><span class="koboSpan" id="kobo.45.1">r</span></code><span class="koboSpan" id="kobo.46.1"> defines the radius of the circle (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.47.1">B</span></code><span class="koboSpan" id="kobo.48.1">).</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.49.1">rect</span></code><span class="koboSpan" id="kobo.50.1">: The </span><code class="literal"><span class="koboSpan" id="kobo.51.1">append()</span></code><span class="koboSpan" id="kobo.52.1"> function draws a rectangle with coordinate attributes </span><code class="literal"><span class="koboSpan" id="kobo.53.1">x</span></code><span class="koboSpan" id="kobo.54.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.55.1">y</span></code><span class="koboSpan" id="kobo.56.1"> that define the top-left corner of the rectangular (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.57.1">C</span></code><span class="koboSpan" id="kobo.58.1">), attributes </span><code class="literal"><span class="koboSpan" id="kobo.59.1">width</span></code><span class="koboSpan" id="kobo.60.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.61.1">height</span></code><span class="koboSpan" id="kobo.62.1"> that control the size of the rectangle, and the attributes </span><code class="literal"><span class="koboSpan" id="kobo.63.1">rx</span></code><span class="koboSpan" id="kobo.64.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.65.1">ry</span></code><span class="koboSpan" id="kobo.66.1"> that introduce rounded corners. </span><span class="koboSpan" id="kobo.66.2">The attributes </span><code class="literal"><span class="koboSpan" id="kobo.67.1">rx</span></code><span class="koboSpan" id="kobo.68.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.69.1">ry</span></code><span class="koboSpan" id="kobo.70.1"> control the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.71.1">x</span></em></span><span class="koboSpan" id="kobo.72.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.73.1">y</span></em></span><span class="koboSpan" id="kobo.74.1"> axes radius of the ellipse used to round off the corners of the rectangle (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.75.1">E</span></code><span class="koboSpan" id="kobo.76.1">).</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.77.1">polygon</span></code><span class="koboSpan" id="kobo.78.1">: To draw a polygon, a set of points that makes up the polygon need to be defined using a </span><code class="literal"><span class="koboSpan" id="kobo.79.1">points</span></code><span class="koboSpan" id="kobo.80.1"> attribute (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.81.1">F</span></code><span class="koboSpan" id="kobo.82.1">). </span><span class="koboSpan" id="kobo.82.2">The </span><code class="literal"><span class="koboSpan" id="kobo.83.1">points</span></code><span class="koboSpan" id="kobo.84.1"> attribute accepts a list of point coordinates that are separated by space, as shown in the following code snippet:</span></li></ul></div><pre class="programlisting"><span class="koboSpan" id="kobo.85.1">    svg.append("polygon") 
        .attr("points", "450,200 500,100 550,200"); // &lt;-F 
</span></pre><p><span class="koboSpan" id="kobo.86.1">All SVG shapes can be styled using style attributes directly or through CSS similar to HTML elements. </span><span class="koboSpan" id="kobo.86.2">Furthermore, they can be transformed and filtered using SVG transformation and filter support; however, due to the limited scope of this book, we will not cover these topics in detail. </span><span class="koboSpan" id="kobo.86.3">In the rest of this chapter, we will focus on D3-specific supports on SVG shape generation instead.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec137"/><span class="koboSpan" id="kobo.87.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.88.1">SVG also supports the </span><code class="literal"><span class="koboSpan" id="kobo.89.1">ellipse</span></code><span class="koboSpan" id="kobo.90.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.91.1">polyline</span></code><span class="koboSpan" id="kobo.92.1"> elements; however, due to their similarity to </span><code class="literal"><span class="koboSpan" id="kobo.93.1">circle</span></code><span class="koboSpan" id="kobo.94.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.95.1">polygon</span></code><span class="koboSpan" id="kobo.96.1">, we will not cover them in detail in this book. </span><span class="koboSpan" id="kobo.96.2">For more information on SVG shape elements, please visit </span><a class="ulink" href="https://www.w3.org/TR/SVG/shapes.html"><span class="koboSpan" id="kobo.97.1">https://www.w3.org/TR/SVG/shapes.html
</span></a><span class="koboSpan" id="kobo.98.1">.</span></p><div class="section" title="D3 SVG shape generators"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec12"/><span class="koboSpan" id="kobo.99.1">D3 SVG shape generators</span></h3></div></div></div><p><span class="koboSpan" id="kobo.100.1">The </span><span class="emphasis"><em><span class="koboSpan" id="kobo.101.1">swiss army knife</span></em></span><span class="koboSpan" id="kobo.102.1"> among SVG shape elements is </span><code class="literal"><span class="koboSpan" id="kobo.103.1">svg:path</span></code><span class="koboSpan" id="kobo.104.1">. </span><span class="koboSpan" id="kobo.104.2">A path defines the outline of any shape, which can then be filled, stroked, or clipped. </span><span class="koboSpan" id="kobo.104.3">Every shape we have discussed so far can be mathematically defined using </span><code class="literal"><span class="koboSpan" id="kobo.105.1">svg:path</span></code><span class="koboSpan" id="kobo.106.1"> alone. </span><span class="koboSpan" id="kobo.106.2">The SVG </span><code class="literal"><span class="koboSpan" id="kobo.107.1">path</span></code><span class="koboSpan" id="kobo.108.1"> is a very powerful construct and has its own mini-language and grammar. </span><span class="koboSpan" id="kobo.108.2">The </span><code class="literal"><span class="koboSpan" id="kobo.109.1">svg:path</span></code><span class="koboSpan" id="kobo.110.1"> mini-language is used to set the </span><code class="literal"><span class="koboSpan" id="kobo.111.1">d</span></code><span class="koboSpan" id="kobo.112.1"> attribute on an </span><code class="literal"><span class="koboSpan" id="kobo.113.1">svg:path</span></code><span class="koboSpan" id="kobo.114.1"> element, which consists of the following commands:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.115.1">moveto</span></strong></span><span class="koboSpan" id="kobo.116.1">: M (absolute)/m (relative) moveto (x y)+</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.117.1">closepath</span></strong></span><span class="koboSpan" id="kobo.118.1">: Z (absolute)/z (relative) closepath</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.119.1">lineto</span></strong></span><span class="koboSpan" id="kobo.120.1">: L (absolute)/l (relative) lineto (x y)+, H (absolute)/h (relative) horizontal lineto x+, V(absolute)/v(relative) vertical lineto y+</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.121.1">Cubic Bezier</span></strong></span><span class="koboSpan" id="kobo.122.1">: C(absolute)/c(relative) curve to (x1 y1 x2 y2 x y)+, S(absolute)/s(relative) shorthand curve to (x2 y2 x y)+</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.123.1">Quadratic Bezier curve</span></strong></span><span class="koboSpan" id="kobo.124.1">: Q (absolute)/q (relative) quadratic Bezier curve to (x1 y1 x y)+, T (absolute)/t (relative) shorthand Quadratic Bezier curve to (x y)+</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.125.1">Elliptical curve</span></strong></span><span class="koboSpan" id="kobo.126.1">: A (absolute)/a (relative) elliptical arc (rx ry x-axis-rotation large-arc-flag sweep-flag x y)+</span></li></ul></div><p><span class="koboSpan" id="kobo.127.1">As directly using paths is not a very pleasant method due to its cryptic language, in most cases, some kind of software, for example, Adobe Illustrator or Inkscape, is required to assist us in creating the SVG </span><code class="literal"><span class="koboSpan" id="kobo.128.1">path</span></code><span class="koboSpan" id="kobo.129.1"> element visually. </span><span class="koboSpan" id="kobo.129.2">Similarly, D3 ships with a set of SVG shape generator functions that can be used to generate data-driven path formulas; this is how D3 truly revolutionizes the field of data visualization by combining the power of SVG with intuitive data-driven approach. </span><span class="koboSpan" id="kobo.129.3">This will be our focus for the rest of this chapter.</span></p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec138"/><span class="koboSpan" id="kobo.130.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.131.1">Please refer to </span><a class="ulink" href="https://www.w3.org/TR/SVG/Overview.html"><span class="koboSpan" id="kobo.132.1">https://www.w3.org/TR/SVG/Overview.html
</span></a><span class="koboSpan" id="kobo.133.1"> for more information on SVG-related topics</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.134.1">For a complete reference on SVG path formula language and its grammar, please visit </span><a class="ulink" href="https://www.w3.org/TR/SVG/paths.html"><span class="koboSpan" id="kobo.135.1">https://www.w3.org/TR/SVG/paths.html
</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using a line generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/><span class="koboSpan" id="kobo.1.1">Using a line generator</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">D3 line generator is probably one of the most versatile generators. </span><span class="koboSpan" id="kobo.2.2">Although it is called a line generator, it has little to do with the </span><code class="literal"><span class="koboSpan" id="kobo.3.1">svg:line</span></code><span class="koboSpan" id="kobo.4.1"> element. </span><span class="koboSpan" id="kobo.4.2">In contrast, it is implemented using the </span><code class="literal"><span class="koboSpan" id="kobo.5.1">svg:path</span></code><span class="koboSpan" id="kobo.6.1"> element. </span><span class="koboSpan" id="kobo.6.2">Similar to </span><code class="literal"><span class="koboSpan" id="kobo.7.1">svg:path</span></code><span class="koboSpan" id="kobo.8.1">, D3 </span><code class="literal"><span class="koboSpan" id="kobo.9.1">line</span></code><span class="koboSpan" id="kobo.10.1"> generator is so flexible that you can effectively draw any shape using </span><code class="literal"><span class="koboSpan" id="kobo.11.1">line</span></code><span class="koboSpan" id="kobo.12.1"> alone; however, to make your life easier, D3 also provides other more specialized shape generators, which will be covered in later recipes in this chapter. </span><span class="koboSpan" id="kobo.12.2">In this recipe, we will draw multiple data-driven lines using the </span><code class="literal"><span class="koboSpan" id="kobo.13.1">d3.svg.line</span></code><span class="koboSpan" id="kobo.14.1"> generator.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec139"/><span class="koboSpan" id="kobo.15.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line.html"><span class="koboSpan" id="kobo.17.1">https://github.com/NickQiZhu/d3-cookbook/blob/master/src/chapter7/line.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec140"/><span class="koboSpan" id="kobo.18.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.19.1">Now, let's take a look at the following line generator in action:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.20.1">&lt;script type="text/javascript"&gt; 
    var width = 500, 
        height = 500, 
        margin = 50, 
        x = d3.scaleLinear() // &lt;-A 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() // &lt;-B 
            .domain([0, 10]) 
            .range([height - margin, margin]); 
 
    var data = [ // &lt;-C 
        [ 
            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7}, 
            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4}, 
            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2} 
        ], 
 
        d3.range(10).map(function(i){ 
            return {x: i, y: Math.sin(i) + 5}; 
        }) 
    ]; 
 
var line = d3.line() // &lt;-D 
            .x(function(d){return x(d.x);}) 
            .y(function(d){return y(d.y);}); 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width); 
 
     svg.selectAll("path.line") 
            .data(data) 
        .enter() 
            .append("path") // &lt;-E 
            .attr("class", "line")             
            .attr("d", function(d){return line(d);}); // &lt;-F 
 
    // Axes related code omitted 
    ...         
</span><span class="koboSpan" id="kobo.20.2">&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.21.1">The preceding code draws multiple lines along with the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.22.1">x</span></em></span><span class="koboSpan" id="kobo.23.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.24.1">y</span></em></span><span class="koboSpan" id="kobo.25.1"> axes:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.26.1"><img src="graphics/image_07_003.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.27.1">D3 line generator</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec141"/><span class="koboSpan" id="kobo.28.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.29.1">In this recipe, the data we used to draw the lines is defined in a two-dimensional array:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.30.1">var data = [ // &lt;-C 
        [ 
            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7}, 
            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4}, 
            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2} 
        ], 
 
        d3.range(10).map(function(i){ 
            return {x: i, y: Math.sin(i) + 5}; 
        }) 
]; 
</span></pre><p><span class="koboSpan" id="kobo.31.1">The first data series is defined manually and explicitly, whereas the second series is generated using a mathematical formula. </span><span class="koboSpan" id="kobo.31.2">Both of these cases are quite common in data visualization projects. </span><span class="koboSpan" id="kobo.31.3">Once the data is defined, in order to map data points to their visual representation, the following two scales were created for the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.32.1">x</span></em></span><span class="koboSpan" id="kobo.33.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.34.1">y</span></em></span><span class="koboSpan" id="kobo.35.1"> coordinates:</span></p><p><span class="koboSpan" id="kobo.36.1">x = d3.scaleLinear() // &lt;-A .domain([0, 10]) .range([margin, width - margin]), y = d3.scaleLinear() // &lt;-B .domain([0, 10]) .range([height - margin, margin]);</span></p><p><span class="koboSpan" id="kobo.37.1">Note that the domains for these scales were set to be large enough to include all data points in both the series, while the ranges were set to represent the canvas area without including the margins. </span><span class="koboSpan" id="kobo.37.2">The </span><span class="emphasis"><em><span class="koboSpan" id="kobo.38.1">y</span></em></span><span class="koboSpan" id="kobo.39.1"> axis range is inverted since we want our point of origin at the lower-left corner of the canvas instead of the SVG-standard upper-left corner. </span><span class="koboSpan" id="kobo.39.2">Once both data and scales are set, all we need to do is generate the lines to define our generator using the </span><code class="literal"><span class="koboSpan" id="kobo.40.1">d3.line</span></code><span class="koboSpan" id="kobo.41.1"> function:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.42.1">var line = d3.line() // &lt;-D 
            .x(function(d){return x(d.x);}) 
            .y(function(d){return y(d.y);}); 
</span></pre><p><span class="koboSpan" id="kobo.43.1">The </span><code class="literal"><span class="koboSpan" id="kobo.44.1">d3.line</span></code><span class="koboSpan" id="kobo.45.1"> function returns a D3 line generator function, which you can further customize. </span><span class="koboSpan" id="kobo.45.2">In our example, we simply stated for this particular line generator the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.46.1">x</span></em></span><span class="koboSpan" id="kobo.47.1"> coordinate, which will be calculated using the </span><code class="literal"><span class="koboSpan" id="kobo.48.1">x</span></code><span class="koboSpan" id="kobo.49.1"> scale mapping, while the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.50.1">y</span></em></span><span class="koboSpan" id="kobo.51.1"> coordinate will be mapped by the </span><code class="literal"><span class="koboSpan" id="kobo.52.1">y</span></code><span class="koboSpan" id="kobo.53.1"> scale. </span><span class="koboSpan" id="kobo.53.2">Using D3 scales, to map coordinates, is not only convenient but also a widely accepted best practice (separation of concerns). </span><span class="koboSpan" id="kobo.53.3">Though, technically, you can implement these functions using any approach you prefer. </span><span class="koboSpan" id="kobo.53.4">Now the only thing left for you to do is the actual creation of the </span><code class="literal"><span class="koboSpan" id="kobo.54.1">svg:path</span></code><span class="koboSpan" id="kobo.55.1"> elements as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.56.1">svg.selectAll("path.line") 
            .data(data) 
        .enter() 
            .append("path") // &lt;-E 
            .attr("class", "line")             
            .attr("d", function(d){return line(d);}); // &lt;-F 
</span></pre><p><span class="koboSpan" id="kobo.57.1">Path creation process in the preceding code was very straightforward. </span><span class="koboSpan" id="kobo.57.2">Two </span><code class="literal"><span class="koboSpan" id="kobo.58.1">svg:path</span></code><span class="koboSpan" id="kobo.59.1"> elements were created using the data array we defined (on line </span><code class="literal"><span class="koboSpan" id="kobo.60.1">E</span></code><span class="koboSpan" id="kobo.61.1">). </span><span class="koboSpan" id="kobo.61.2">Then, the </span><code class="literal"><span class="koboSpan" id="kobo.62.1">d</span></code><span class="koboSpan" id="kobo.63.1"> attribute for each path element was set using the </span><code class="literal"><span class="koboSpan" id="kobo.64.1">line</span></code><span class="koboSpan" id="kobo.65.1"> generator we created previously by passing in the data </span><code class="literal"><span class="koboSpan" id="kobo.66.1">d</span></code><span class="koboSpan" id="kobo.67.1"> as its input parameter. </span><span class="koboSpan" id="kobo.67.2">The following screenshot shows what the generated </span><code class="literal"><span class="koboSpan" id="kobo.68.1">svg:path</span></code><span class="koboSpan" id="kobo.69.1"> elements look like:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.70.1"><img src="graphics/image_07_004.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.71.1">Generated SVG path elements</span></p><p><span class="koboSpan" id="kobo.72.1">Finally, two axes were created using the same </span><span class="emphasis"><em><span class="koboSpan" id="kobo.73.1">x</span></em></span><span class="koboSpan" id="kobo.74.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.75.1">y</span></em></span><span class="koboSpan" id="kobo.76.1"> scales we defined earlier. </span><span class="koboSpan" id="kobo.76.2">Due to limited space in this book, we have omitted the axes-related code in this recipe and in the rest of this chapter since they don't really change and also are not the focus of this chapter.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec142"/><span class="koboSpan" id="kobo.77.1">See also</span></h2></div></div></div><p><span class="koboSpan" id="kobo.78.1">For detailed information on D3 axes support, please refer to </span><a class="link" href="ch05.html" title="Chapter 5. Playing with Axes"><span class="koboSpan" id="kobo.79.1">Chapter 5</span></a><span class="koboSpan" id="kobo.80.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.81.1">Playing with Axes</span></em></span><span class="koboSpan" id="kobo.82.1">.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using line curve"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/><span class="koboSpan" id="kobo.1.1">Using line curve</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">By default, the D3 line generator uses the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">linear curve</span></em></span><span class="koboSpan" id="kobo.4.1"> mode; however, D3 supports a number of different curve factories. </span><span class="koboSpan" id="kobo.4.2">The curve function determines how data points will be connected, for example, by a straight line (</span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">linear</span></em></span><span class="koboSpan" id="kobo.6.1">) or a curved line (</span><span class="strong"><strong><span class="koboSpan" id="kobo.7.1">B-spline</span></strong></span><span class="koboSpan" id="kobo.8.1">). </span><span class="koboSpan" id="kobo.8.2">In this recipe, we will show you how these curve modes can be set along with their effects.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec143"/><span class="koboSpan" id="kobo.9.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.10.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/line-curve.html"><span class="koboSpan" id="kobo.11.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/line-curve.html
</span></a>
</p><p><span class="koboSpan" id="kobo.12.1">This recipe is built on top of what we did in the previous recipe, so if you are not</span></p><p><span class="koboSpan" id="kobo.13.1">yet familiar with basic line generator functions, please refer to the previous recipe first</span></p><p><span class="koboSpan" id="kobo.14.1">before proceeding.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec144"/><span class="koboSpan" id="kobo.15.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">Now, let's take a look at how different line interpolation modes can be used:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.17.1">&lt;script type="text/javascript"&gt; 
var width = 500, 
        height = 500, 
        margin = 30, 
        x = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([height - margin, margin]); 
 
    var data = [ 
        [ 
            {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7}, 
            {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4}, 
            {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2} 
        ], 
        d3.range(10).map(function(i){ 
            return {x: i, y: Math.sin(i) + 5}; 
        }) 
    ]; 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width); 
 
    renderAxes(svg); 
 
    render(d3.curveLinear); 
 
    renderDots(svg); 
 
    function render(mode){ 
        var line = d3.line() 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}) 
                .curve(mode); // &lt;-A 
 
        svg.selectAll("path.line") 
                .data(data) 
            .enter() 
                .append("path") 
                .attr("class", "line"); 
 
        svg.selectAll("path.line") 
                .data(data) 
            .attr("d", function(d){return line(d);}); 
    } 
 
    function renderDots(svg){ // &lt;-B 
        data.forEach(function(list){ 
             svg.append("g").selectAll("circle") 
                .data(list) 
              .enter().append("circle") // &lt;-C 
                .attr("class", "dot") 
                .attr("cx", function(d) { return x(d.x); }) 
                .attr("cy", function(d) { return y(d.y); }) 
                .attr("r", 4.5); 
        }); 
    } 
// Axes related code omitted 
... 
</span><span class="koboSpan" id="kobo.17.2">&lt;/script&gt; 
 
&lt;h4&gt;Interpolation Mode:&lt;/h4&gt; 
&lt;div class="control-group"&gt; 
&lt;button onclick="render(d3.curveLinear)"&gt;linear&lt;/button&gt; 
&lt;button onclick="render(d3.curveLinearClosed)"&gt;linear closed&lt;/button&gt; 
&lt;button onclick="render(d3.curveStepBefore)"&gt;step before&lt;/button&gt; 
&lt;button onclick="render(d3.curveStepAfter)"&gt;step after&lt;/button&gt; 
&lt;button onclick="render(d3.curveBasis)"&gt;basis&lt;/button&gt; 
&lt;button onclick="render(d3.curveBasisOpen)"&gt;basis open&lt;/button&gt; 
&lt;/div&gt; 
... 
 
</span></pre><p><span class="koboSpan" id="kobo.18.1">The preceding code generates the following line chart in your browser with configurable interpolation modes:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.19.1"><img src="graphics/image_07_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.20.1">Line curve</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec145"/><span class="koboSpan" id="kobo.21.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.22.1">Overall, this recipe is similar to the previous one. </span><span class="koboSpan" id="kobo.22.2">Two lines are generated using predefined dataset. </span><span class="koboSpan" id="kobo.22.3">However, in this recipe, you will allow the user to select a specific line interpolation mode, which is then set using the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">interpolate</span></code><span class="koboSpan" id="kobo.24.1"> function on line generator (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.25.1">A</span></code><span class="koboSpan" id="kobo.26.1">) in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.27.1">var line = d3.line() 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}) 
                .curve(mode); // &lt;-A 
</span></pre><p><span class="koboSpan" id="kobo.28.1">The following interpolation modes are supported by D3:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.29.1">d3.curveLinear</span></code><span class="koboSpan" id="kobo.30.1">: Linear segments, that is, polyline</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.31.1">d3.curveLinearClosed</span></code><span class="koboSpan" id="kobo.32.1">: Closed linear segments, that is, polygon</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.33.1">d3.curveStepBefore</span></code><span class="koboSpan" id="kobo.34.1">: Alternated between the vertical and horizontal segments, as in a step function</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.35.1">d3.curveStepAfter</span></code><span class="koboSpan" id="kobo.36.1">: Alternated between the horizontal and vertical segments, as in a step function</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.37.1">d3.curveBasis</span></code><span class="koboSpan" id="kobo.38.1">: It is a B-spline, with control point duplication on the ends</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.39.1">d3.curveBasisOpen</span></code><span class="koboSpan" id="kobo.40.1">: An open B-spline; may not intersect the start or end</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.41.1">d3.curveBasisClosed</span></code><span class="koboSpan" id="kobo.42.1">: A closed B-spline, as in a loop</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.43.1">d3.curveBundle</span></code><span class="koboSpan" id="kobo.44.1">: Equivalent to basis, except the tension parameter is used to straighten the spline</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.45.1">d3.curveCardinal</span></code><span class="koboSpan" id="kobo.46.1">: A cardinal spline, with control point duplication on the ends.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.47.1">d3.curveCardinalOpen</span></code><span class="koboSpan" id="kobo.48.1">: An open cardinal spline; may not intersect the start or end, but will intersect other control points</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.49.1">d3.curveCardinalClosed</span></code><span class="koboSpan" id="kobo.50.1">: A closed cardinal spline, as in a loop</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.51.1">d3.curveMonotoneY</span></code><span class="koboSpan" id="kobo.52.1">: Cubic interpolation that preserves monotonicity in </span><span class="emphasis"><em><span class="koboSpan" id="kobo.53.1">y</span></em></span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.54.1">d3.curveCatmullRom</span></code><span class="koboSpan" id="kobo.55.1">: A cubic catmull-Rom spline.</span></li></ul></div><p><span class="koboSpan" id="kobo.56.1">Additionally, in the </span><code class="literal"><span class="koboSpan" id="kobo.57.1">renderDots</span></code><span class="koboSpan" id="kobo.58.1"> function (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.59.1">B</span></code><span class="koboSpan" id="kobo.60.1">), we have also created a small circle for each data point to serve as reference points. </span><span class="koboSpan" id="kobo.60.2">These dots are created using the </span><code class="literal"><span class="koboSpan" id="kobo.61.1">svg:circle</span></code><span class="koboSpan" id="kobo.62.1"> elements, as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.63.1">C</span></code><span class="koboSpan" id="kobo.64.1"> of the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.65.1">function renderDots(svg){ // &lt;-B 
        data.forEach(function(set){ 
             svg.append("g").selectAll("circle") 
                .data(set) 
              .enter().append("circle") // &lt;-C 
                .attr("class", "dot") 
                .attr("cx", function(d) { return x(d.x); }) 
                .attr("cy", function(d) { return y(d.y); }) 
                .attr("r", 4.5); 
        }); 
} 
</span></pre></div><div class="section" title="See Also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec146"/><span class="koboSpan" id="kobo.66.1">See Also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.67.1">For detailed listing and API document for all D3 curve factories, please refer to </span><a class="ulink" href="https://github.com/d3/d3-shape#curves"><span class="koboSpan" id="kobo.68.1">https://github.com/d3/d3-shape#curves
</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Changing line tension"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/><span class="koboSpan" id="kobo.1.1">Changing line tension</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">If Cardinal interpolation mode (cardinal, cardinal-open, or cardinal-closed) is used, then the line can be further modified using tension settings. </span><span class="koboSpan" id="kobo.2.2">In this recipe, you will see how tension can be modified and its effect on line interpolation.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec147"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/line-tension.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/line-tension.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec148"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">Now, let's take a look at how line tension can be changed and what effect it has on line generation:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
    var width = 500, 
        height = 500, 
        margin = 30, 
        duration = 500,     
        x = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() 
            .domain([0, 1]) 
            .range([height - margin, margin]); 
 
var data = d3.range(10).map(function(i){ 
            return {x: i, y: (Math.sin(i * 3) + 1) / 2}; 
        }); 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width); 
 
    renderAxes(svg); 
 
    render(1); 
 
    function render(tension){ 
        var line = d3.line() 
                .curve(d3.curveCardinal.tension(tension)) // &lt;-A 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}); 
 
        svg.selectAll("path.line") 
                .data([tension]) 
            .enter() 
                .append("path") 
                .attr("class", "line"); 
 
svg.selectAll("path.line") 
                .data([tension])  
            .transition().duration(duration) 
               .ease(d3.easeLinear) // &lt;-B 
            .attr("d", function(d){ 
                return line(data); // &lt;-C 
            }); 
 
        svg.selectAll("circle") 
            .data(data) 
          .enter().append("circle") 
            .attr("class", "dot") 
            .attr("cx", function(d) { return x(d.x); }) 
            .attr("cy", function(d) { return y(d.y); }) 
            .attr("r", 4.5); 
    } 
// Axes related code omitted 
    ... 
</span><span class="koboSpan" id="kobo.8.2">&lt;/script&gt; 
&lt;h4&gt;Line Tension:&lt;/h4&gt; 
&lt;div class="control-group"&gt; 
&lt;button onclick="render(0)"&gt;0&lt;/button&gt; 
&lt;button onclick="render(0.2)"&gt;0.2&lt;/button&gt; 
&lt;button onclick="render(0.4)"&gt;0.4&lt;/button&gt; 
&lt;button onclick="render(0.6)"&gt;0.6&lt;/button&gt; 
&lt;button onclick="render(0.8)"&gt;0.8&lt;/button&gt; 
&lt;button onclick="render(1)"&gt;1&lt;/button&gt; 
&lt;/div&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code generates a cardinal line chart with configurable tension:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_07_006.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Line Tension</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec149"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">Tension sets the Cardinal spline interpolation tension to a specific number in the range of </span><code class="literal"><span class="koboSpan" id="kobo.14.1">[0, 1]</span></code><span class="koboSpan" id="kobo.15.1">. </span><span class="koboSpan" id="kobo.15.2">Tension can be set using the </span><code class="literal"><span class="koboSpan" id="kobo.16.1">tension</span></code><span class="koboSpan" id="kobo.17.1"> function on line generator (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.18.1">C</span></code><span class="koboSpan" id="kobo.19.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.20.1">var line = d3.line() 
                .curve(d3.curveCardinal.tension(tension)) // &lt;-A  
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}); 
</span></pre><p><span class="koboSpan" id="kobo.21.1">Additionally, we also initiated a transition on line </span><code class="literal"><span class="koboSpan" id="kobo.22.1">B</span></code><span class="koboSpan" id="kobo.23.1"> to highlight the tension effect on line interpolation. </span><span class="koboSpan" id="kobo.23.2">The tension in cardinal curve essentially determines the length of the tangents. </span><span class="koboSpan" id="kobo.23.3">At tension one, it is the same as curve linear while at zero it produces uniform Catmull-Rom spline. </span><span class="koboSpan" id="kobo.23.4">If the tension is not set explicitly, Cardinal interpolation sets tension to </span><code class="literal"><span class="koboSpan" id="kobo.24.1">0</span></code><span class="koboSpan" id="kobo.25.1"> by default.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using an area generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/><span class="koboSpan" id="kobo.1.1">Using an area generator</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Using D3 line generator, we can technically generate an outline of any shape; however, even with a different curve support, directly drawing an area using line (as in an area chart) is not an easy task. </span><span class="koboSpan" id="kobo.2.2">This is why D3 also provides a separate shape generator function specifically designed for drawing area.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec150"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/area.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/area.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec151"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will add a filled area to a pseudo line chart, effectively turning it into an</span></p><p><span class="koboSpan" id="kobo.8.1">area chart:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.9.1">&lt;script type="text/javascript"&gt; 
    var width = 500, 
        height = 500, 
        margin = 30, 
        duration = 500, 
        x = d3.scaleLinear() // &lt;-A 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([height - margin, margin]); 
 
    var data = d3.range(11).map(function(i){ // &lt;-B 
            return {x: i, y: Math.sin(i)*3 + 5}; 
        }); 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width);         
 
    renderAxes(svg); 
 
    render();     
 
    renderDots(svg); 
 
    function render(){ 
        var line = d3.line() 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}); 
 
        svg.selectAll("path.line") 
                .data([data]) 
            .enter() 
                .append("path") 
                .attr("class", "line");                 
 
        svg.selectAll("path.line") 
                .data([data])        
            .attr("d", function(d){return line(d);});         
 
        var area = d3.area() // &lt;-C 
            .x(function(d) { return x(d.x); }) // &lt;-D 
            .y0(y(0)) // &lt;-E 
            .y1(function(d) { return y(d.y); }); // &lt;-F 
 
        svg.selectAll("path.area") // &lt;-G 
                .data([data]) 
            .enter() 
                .append("path") 
                .attr("class", "area") 
                .attr("d", function(d){return area(d);}); // &lt;-H 
    } 
 
    // Dots rendering code omitted 
 
    // Axes related code omitted 
    ... 
</span><span class="koboSpan" id="kobo.9.2">&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.10.1">The preceding code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.11.1"><img src="graphics/image_07_007.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.12.1">Area generator</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec152"/><span class="koboSpan" id="kobo.13.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.14.1">Similar to the earlier given </span><span class="emphasis"><em><span class="koboSpan" id="kobo.15.1">Using a line generator</span></em></span><span class="koboSpan" id="kobo.16.1"> recipe, we have two scales defined in this recipe to map data to visual domain on </span><span class="emphasis"><em><span class="koboSpan" id="kobo.17.1">x</span></em></span><span class="koboSpan" id="kobo.18.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.19.1">y</span></em></span><span class="koboSpan" id="kobo.20.1"> coordinates (refer to line A) as given in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.21.1">        x = d3.scaleLinear() // &lt;-A 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([height - margin, margin]); 
 
    var data = d3.range(11).map(function(i){ // &lt;-B 
            return {x: i, y: Math.sin(i)*3 + 5}; 
        }); 
</span></pre><p><span class="koboSpan" id="kobo.22.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.23.1">B</span></code><span class="koboSpan" id="kobo.24.1">, data is generated by a mathematical formula. </span><span class="koboSpan" id="kobo.24.2">Area generator is then created using the </span><code class="literal"><span class="koboSpan" id="kobo.25.1">d3.area</span></code><span class="koboSpan" id="kobo.26.1"> function (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.27.1">C</span></code><span class="koboSpan" id="kobo.28.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.29.1">var area = d3.area() // &lt;-C 
            .x(function(d) { return x(d.x); }) // &lt;-D 
            .y0(y(0)) // &lt;-E 
            .y1(function(d) { return y(d.y); }); // &lt;-F 
</span></pre><p><span class="koboSpan" id="kobo.30.1">As you can see, D3 area generator is-similar to the line generator-designed to work in a 2D Cartesian coordinate system. </span><span class="koboSpan" id="kobo.30.2">The </span><code class="literal"><span class="koboSpan" id="kobo.31.1">x</span></code><span class="koboSpan" id="kobo.32.1"> function defines an accessor function for the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.33.1">x</span></em></span><span class="koboSpan" id="kobo.34.1"> coordinate (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.35.1">D</span></code><span class="koboSpan" id="kobo.36.1">), which simply maps data to the visual coordinate using the </span><code class="literal"><span class="koboSpan" id="kobo.37.1">x</span></code><span class="koboSpan" id="kobo.38.1"> scale we defined earlier. </span><span class="koboSpan" id="kobo.38.2">For the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.39.1">y</span></em></span><span class="koboSpan" id="kobo.40.1"> coordinate, we provided the area generator with two different accessors: one for the lower bound (</span><code class="literal"><span class="koboSpan" id="kobo.41.1">y0</span></code><span class="koboSpan" id="kobo.42.1">) and the other for the higher bound (</span><code class="literal"><span class="koboSpan" id="kobo.43.1">y1</span></code><span class="koboSpan" id="kobo.44.1">) coordinates. </span><span class="koboSpan" id="kobo.44.2">This is the crucial difference between area and line generator. </span><span class="koboSpan" id="kobo.44.3">D3 area generator supports higher and lower bound on both </span><span class="emphasis"><em><span class="koboSpan" id="kobo.45.1">x</span></em></span><span class="koboSpan" id="kobo.46.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.47.1">y</span></em></span><span class="koboSpan" id="kobo.48.1"> axes (</span><code class="literal"><span class="koboSpan" id="kobo.49.1">x0</span></code><span class="koboSpan" id="kobo.50.1">, </span><code class="literal"><span class="koboSpan" id="kobo.51.1">x1</span></code><span class="koboSpan" id="kobo.52.1">, </span><code class="literal"><span class="koboSpan" id="kobo.53.1">y0</span></code><span class="koboSpan" id="kobo.54.1">, </span><code class="literal"><span class="koboSpan" id="kobo.55.1">y1</span></code><span class="koboSpan" id="kobo.56.1">) and supports the shorthand accessors (</span><code class="literal"><span class="koboSpan" id="kobo.57.1">x</span></code><span class="koboSpan" id="kobo.58.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.59.1">y</span></code><span class="koboSpan" id="kobo.60.1">) if the higher and lower bounds are the same. </span><span class="koboSpan" id="kobo.60.2">Once the area generator is defined, the method of creating an area is almost identical to the line generator:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.61.1">svg.selectAll("path.area") // &lt;-G 
                .data([data]) 
            .enter() 
                .append("path") 
                .attr("class", "area") 
                .attr("d", function(d){return area(d);}); // &lt;-H 
</span></pre><p><span class="koboSpan" id="kobo.62.1">Area is also implemented using the </span><code class="literal"><span class="koboSpan" id="kobo.63.1">svg:path</span></code><span class="koboSpan" id="kobo.64.1"> element (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.65.1">G</span></code><span class="koboSpan" id="kobo.66.1">). </span><span class="koboSpan" id="kobo.66.2">D3 area generator is used to generate the </span><code class="literal"><span class="koboSpan" id="kobo.67.1">d</span></code><span class="koboSpan" id="kobo.68.1"> formula for the </span><code class="literal"><span class="koboSpan" id="kobo.69.1">svg:path</span></code><span class="koboSpan" id="kobo.70.1"> element on line </span><code class="literal"><span class="koboSpan" id="kobo.71.1">H</span></code><span class="koboSpan" id="kobo.72.1"> with data </span><code class="literal"><span class="koboSpan" id="kobo.73.1">d</span></code><span class="koboSpan" id="kobo.74.1"> as its input parameter.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using area curve"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/><span class="koboSpan" id="kobo.1.1">Using area curve</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Similar to the D3 line generator, area generator also supports identical interpolation mode, and hence, it can be used in combination with the line generator in every mode.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec153"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/area-curve.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/area-curve.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec154"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will show how interpolation mode can be configured on an area generator. </span><span class="koboSpan" id="kobo.7.2">This way, the matching interpolated area can then be created with its corresponding line:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">var width = 500, 
        height = 500, 
        margin = 30, 
        x = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([margin, width - margin]), 
        y = d3.scaleLinear() 
            .domain([0, 10]) 
            .range([height - margin, margin]); 
 
    var data = d3.range(11).map(function(i){ 
        return {x: i, y: Math.sin(i)*3 + 5}; 
    }); 
 
    var svg = d3.select("body").append("svg"); 
 
    svg.attr("height", height) 
        .attr("width", width);         
 
    renderAxes(svg); 
 
    render(d3.curveLinear); 
 
    renderDots(svg); 
 
    function render(mode){ 
        var line = d3.line() 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}) 
                .curve(mode); // &lt;-A 
 
        svg.selectAll("path.line") 
                .data([data]) 
            .enter() 
                .append("path") 
                .attr("class", "line");                 
 
        svg.selectAll("path.line") 
                .data([data])        
            .attr("d", function(d){return line(d);});         
 
        var area = d3.area() 
            .x(function(d) { return x(d.x); }) 
            .y0(y(0)) 
            .y1(function(d) { return y(d.y); }) 
            .curve(mode); // &lt;-B 
 
        svg.selectAll("path.area") 
                .data([data]) 
            .enter() 
                .append("path") 
                .attr("class", "area") 
 
        svg.selectAll("path.area") 
            .data([data]) 
            .attr("d", function(d){return area(d);});         
    } 
// Dots and Axes related code omitted 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code generates the following pseudo area chart with configurable interpolation mode:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_07_008.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Area curve</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec155"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">This recipe is similar to the previous one, except that in this recipe the interpolation mode is passed in based on the user's selection:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.14.1">var line = d3.line() 
                .x(function(d){return x(d.x);}) 
                .y(function(d){return y(d.y);}) 
                .curve(mode); // &lt;-A 
 
var area = d3.area() 
            .x(function(d) { return x(d.x); }) 
            .y0(y(0)) 
            .y1(function(d) { return y(d.y); }) 
            .curve(mode); // &lt;-B 
</span></pre><p><span class="koboSpan" id="kobo.15.1">As you can see, the curve mode was configured on both lines along with the area generator through the </span><code class="literal"><span class="koboSpan" id="kobo.16.1">curve</span></code><span class="koboSpan" id="kobo.17.1"> function (refer to lines </span><code class="literal"><span class="koboSpan" id="kobo.18.1">A</span></code><span class="koboSpan" id="kobo.19.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.20.1">B</span></code><span class="koboSpan" id="kobo.21.1">). </span><span class="koboSpan" id="kobo.21.2">Since D3 line and area generator supports the same set of curve factories, they can always be counted on to generate matching line and area as seen in this recipe.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec156"/><span class="koboSpan" id="kobo.22.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.23.1">D3 area generator also supports the same tension configuration when using Cardinal mode; however, since it is identical to the line generator's tension support, and due to limited space in this book, we will not cover area tension here.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec157"/><span class="koboSpan" id="kobo.24.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.25.1">Please refer to </span><a class="ulink" href="https://github.com/d3/d3/blob/master/API.md#areas"><span class="koboSpan" id="kobo.26.1">https://github.com/d3/d3/blob/master/API.md#areas
</span></a><span class="koboSpan" id="kobo.27.1"> for more information on area generator functions</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using an arc generator"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/><span class="koboSpan" id="kobo.1.1">Using an arc generator</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Among the most common shape generators-besides the line and area generator-D3 also provides the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">arc generator</span></em></span><span class="koboSpan" id="kobo.4.1">. </span><span class="koboSpan" id="kobo.4.2">At this point, you might be wondering, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">Didn't SVG standard already include circle element? </span><span class="koboSpan" id="kobo.5.2">Isn't that enough?</span></em></span>
</p><p><span class="koboSpan" id="kobo.6.1">The simple answer to this is </span><span class="emphasis"><em><span class="koboSpan" id="kobo.7.1">no</span></em></span><span class="koboSpan" id="kobo.8.1">. </span><span class="koboSpan" id="kobo.8.2">The D3 arc generator is a lot more versatile than the simple </span><code class="literal"><span class="koboSpan" id="kobo.9.1">svg:circle</span></code><span class="koboSpan" id="kobo.10.1"> element. </span><span class="koboSpan" id="kobo.10.2">The D3 arc generator is capable of creating not only circles but also annulus (donut), circular sector, and annulus sector, all of which we will learn in this recipe. </span><span class="koboSpan" id="kobo.10.3">More importantly, an arc generator is designed to generate, as its name suggests, an arc (in others words, not a full circle or even a sector but rather arcs of arbitrary angle).</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec158"/><span class="koboSpan" id="kobo.11.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/arc.html"><span class="koboSpan" id="kobo.13.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/arc.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec159"/><span class="koboSpan" id="kobo.14.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">In this recipe, we will use arc generator to generate multi-slice circle, annulus (donut), circular sectors, and annulus sectors as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.16.1">&lt;script type="text/javascript"&gt; 
    var width = 400, 
        height = 400, 
        fullAngle = 2 * Math.PI, // &lt;-A 
        colors =  d3.scaleOrdinal(d3.schemeCategory20); 
 
    var svg = d3.select("body").append("svg") 
                .attr("class", "pie") 
                .attr("height", height) 
                .attr("width", width);     
 
    function render(innerRadius, endAngle){ 
        if(!endAngle) endAngle = fullAngle; 
 
        var data = [ // &lt;-B 
            {startAngle: 0, endAngle: 0.1 * endAngle}, 
            {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle}, 
            {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle}, 
            {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},   
            {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},   
            {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},   
            {startAngle: 0.9 * endAngle, endAngle: endAngle} 
        ]; 
 
        var arc = d3.arc().outerRadius(200) // &lt;-C 
                        .innerRadius(innerRadius); 
 
        svg.select("g").remove(); 
 
        svg.append("g") 
                .attr("transform", "translate(200,200)") 
        .selectAll("path.arc") 
                .data(data) 
            .enter() 
                .append("path") 
                    .attr("class", "arc") 
                    .attr("fill", function(d, i){ 
      return colors(i); 
        }) 
                    .attr("d", function(d, i){ 
                        return arc(d, i); // &lt;-D 
                    }); 
    } 
 
    render(0); 
&lt;/script&gt; 
 
&lt;div class="control-group"&gt; 
&lt;button onclick="render(0)"&gt;Circle&lt;/button&gt; 
&lt;button onclick="render(100)"&gt;Annulus(Donut)&lt;/button&gt; 
&lt;button onclick="render(0, Math.PI)"&gt;Circular Sector&lt;/button&gt; 
&lt;button onclick="render(100, Math.PI)"&gt;Annulus Sector&lt;/button&gt; 
&lt;/div&gt; 
</span></pre><p><span class="koboSpan" id="kobo.17.1">The preceding code produces the following circle, which you can change into an arc, a sector, or an arc sector by clicking on the buttons, for example, </span><span class="strong"><strong><span class="koboSpan" id="kobo.18.1">Annulus(Donut)</span></strong></span><span class="koboSpan" id="kobo.19.1"> generates the second shape:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.20.1"><img src="graphics/image_07_009.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.21.1">Arc generator</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec160"/><span class="koboSpan" id="kobo.22.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.23.1">The most important part of understanding the D3 arc generator is its data structure. </span><span class="koboSpan" id="kobo.23.2">D3 arc generator has very specific requirements when it comes to its data, as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">B</span></code><span class="koboSpan" id="kobo.25.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">var data = [ // &lt;-B 
        {startAngle: 0, endAngle: 0.1 * endAngle}, 
        {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle}, 
        {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle}, 
        {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},    
        {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},    
        {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},   
        {startAngle: 0.9 * endAngle, endAngle: endAngle} 
]; 
</span></pre><p><span class="koboSpan" id="kobo.27.1">Each row of the arc data has to contain two mandatory fields: </span><code class="literal"><span class="koboSpan" id="kobo.28.1">startAngle</span></code><span class="koboSpan" id="kobo.29.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.30.1">endAngle</span></code><span class="koboSpan" id="kobo.31.1">. </span><span class="koboSpan" id="kobo.31.2">The angles have to be in the range </span><code class="literal"><span class="koboSpan" id="kobo.32.1">[0, 2 * Math.PI]</span></code><span class="koboSpan" id="kobo.33.1"> (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.34.1">A</span></code><span class="koboSpan" id="kobo.35.1">). </span><span class="koboSpan" id="kobo.35.2">D3 arc generator will use these angles to generate corresponding slices, as shown earlier in this recipe.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note69"/><span class="koboSpan" id="kobo.36.1">Note</span></h3><p><span class="koboSpan" id="kobo.37.1">Along with the start and end angles, arc dataset can contain any number of additional fields, which can then be accessed in D3 functions to drive other visual representation.</span></p></div></div><p><span class="koboSpan" id="kobo.38.1">If you think that calculating these angles based on the data you have will be a big hassle, you are absolutely correct. </span><span class="koboSpan" id="kobo.38.2">This is why D3 provides specific layout manager to help you calculate these angles, and we will cover this in the next chapter. </span><span class="koboSpan" id="kobo.38.3">For now, let's focus on understanding the basic mechanism behind the scenes so that when it is time to introduce the layout manager or if you ever need to set the angles manually, you will be well equipped to do so. </span><span class="koboSpan" id="kobo.38.4">D3 arc generator is created using the following </span><code class="literal"><span class="koboSpan" id="kobo.39.1">d3.arc</span></code><span class="koboSpan" id="kobo.40.1"> function:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.41.1">var arc = d3.arc().outerRadius(200) // &lt;-C 
                    .innerRadius(innerRadius);  
</span></pre><p><span class="koboSpan" id="kobo.42.1">The</span><code class="literal"><span class="koboSpan" id="kobo.43.1"> d3.arc</span></code><span class="koboSpan" id="kobo.44.1"> function optionally has the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">outerRadius</span></code><span class="koboSpan" id="kobo.46.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.47.1">innerRadius</span></code><span class="koboSpan" id="kobo.48.1"> settings. </span><span class="koboSpan" id="kobo.48.2">When </span><code class="literal"><span class="koboSpan" id="kobo.49.1">innerRadius</span></code><span class="koboSpan" id="kobo.50.1"> is set, the arc generator will produce an image of annulus (donut) instead of a circle. </span><span class="koboSpan" id="kobo.50.2">Finally, the D3 arc is also implemented using the </span><code class="literal"><span class="koboSpan" id="kobo.51.1">svg:path</span></code><span class="koboSpan" id="kobo.52.1"> element, and thus similar to the line and area generator, the </span><code class="literal"><span class="koboSpan" id="kobo.53.1">d3.arc</span></code><span class="koboSpan" id="kobo.54.1"> generator function can be invoked (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.55.1">D</span></code><span class="koboSpan" id="kobo.56.1">) to generate the </span><code class="literal"><span class="koboSpan" id="kobo.57.1">d</span></code><span class="koboSpan" id="kobo.58.1"> formula for the </span><code class="literal"><span class="koboSpan" id="kobo.59.1">svg:path</span></code><span class="koboSpan" id="kobo.60.1"> element:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.61.1">svg.append("g") 
            .attr("transform", "translate(200,200)") 
    .selectAll("path.arc") 
            .data(data) 
        .enter() 
            .append("path") 
                .attr("class", "arc") 
                .attr("fill", function(d, i){return colors(i);}) 
                .attr("d", function(d, i){ 
                    return arc(d, i); // &lt;-D 
                }); 
</span></pre><p><span class="koboSpan" id="kobo.62.1">One additional element worth mentioning here is the </span><code class="literal"><span class="koboSpan" id="kobo.63.1">svg:g</span></code><span class="koboSpan" id="kobo.64.1"> element. </span><span class="koboSpan" id="kobo.64.2">This element does not define any shape itself but serves rather as a container element used to group other elements, in this case, the </span><code class="literal"><span class="koboSpan" id="kobo.65.1">path.arc</span></code><span class="koboSpan" id="kobo.66.1"> elements. </span><span class="koboSpan" id="kobo.66.2">Transformation applied to the </span><code class="literal"><span class="koboSpan" id="kobo.67.1">g</span></code><span class="koboSpan" id="kobo.68.1"> element is applied to all the child elements while its attributes are also inherited by its child elements.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec161"/><span class="koboSpan" id="kobo.69.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.70.1">Please refer to </span><a class="ulink" href="https://github.com/d3/d3/blob/master/API.md#arcs"><span class="koboSpan" id="kobo.71.1">https://github.com/d3/d3/blob/master/API.md#arcs
</span></a><span class="koboSpan" id="kobo.72.1"> for more information on arc generator function</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Implementing arc transition"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec57"/><span class="koboSpan" id="kobo.1.1">Implementing arc transition</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">One area where arc differs significantly from other shapes, such as line and area, is its transition. </span><span class="koboSpan" id="kobo.2.2">For most of the shapes that we covered so far, including simple SVG built-in shapes, you can rely on D3 transition and interpolation to handle their animation. </span><span class="koboSpan" id="kobo.2.3">However, this is not the case when dealing with arc. </span><span class="koboSpan" id="kobo.2.4">We will explore the arc transition technique in this recipe.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec162"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/arc-transition.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter7/arc-transition.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec163"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will animate a multi-slice annulus transitioning with each slice starting from angle </span><code class="literal"><span class="koboSpan" id="kobo.8.1">0</span></code><span class="koboSpan" id="kobo.9.1"> to its final desired angle and eventually reaching a full annulus:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;script type="text/javascript"&gt; 
    var width = 400, 
            height = 400, 
            endAngle = 2 * Math.PI, 
            colors = d3.scaleOrdinal(d3.schemeCategory20c); 
 
    var svg = d3.select("body").append("svg") 
            .attr("class", "pie") 
            .attr("height", height) 
            .attr("width", width); 
 
    function render(innerRadius) { 
 
        var data = [ 
            {startAngle: 0, endAngle: 0.1 * endAngle}, 
            {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle}, 
            {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle}, 
            {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle}, 
            {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle}, 
            {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle}, 
            {startAngle: 0.9 * endAngle, endAngle: endAngle} 
        ]; 
 
        var arc = d3.arc() 
                .outerRadius(200).innerRadius(innerRadius); 
 
        svg.select("g").remove(); 
 
        svg.append("g") 
            .attr("transform", "translate(200,200)") 
            .selectAll("path.arc") 
                .data(data) 
            .enter() 
                .append("path") 
                .attr("class", "arc") 
                .attr("fill", function (d, i) { 
                    return colors(i); 
                }) 
                .transition().duration(1000) 
                .attrTween("d", function (d) { 
                  var start = {startAngle: 0, endAngle: 0}; // &lt;-A 
                  var interpolate = d3.interpolate(start, d); // &lt;-B 
                  return function (t) { 
                      return arc(interpolate(t)); // &lt;-C 
                  }; 
                }); 
    } 
 
    render(100); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">The preceding code generates an arc that starts rotating and eventually becomes a complete annulus as follows:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.12.1"><img src="graphics/image_07_010.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.13.1">Arc transition with tweening</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec164"/><span class="koboSpan" id="kobo.14.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">When confronted with the requirement of such transition, your first thought might be using the vanilla D3 transition while relying on built-in interpolations to generate the animation. </span><span class="koboSpan" id="kobo.15.2">Here is the code snippet that will do just that:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.16.1">svg.append("g") 
        .attr("transform", "translate(200,200)") 
        .selectAll("path.arc") 
            .data(data) 
        .enter() 
            .append("path") 
            .attr("class", "arc") 
            .attr("fill", function (d, i) { 
                return colors(i); 
            }) 
            .attr("d", function(d){ 
               return arc({startAngle: 0, endAngle: 0}); 
             }) 
            .transition().duration(1000) 
            .attr("d", function(d){return arc(d);}); 
</span></pre><p><span class="koboSpan" id="kobo.17.1">As shown with highlighted lines in the preceding code snippet, with this approach, we initially created slice path with both </span><code class="literal"><span class="koboSpan" id="kobo.18.1">startAngle</span></code><span class="koboSpan" id="kobo.19.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.20.1">endAngle</span></code><span class="koboSpan" id="kobo.21.1"> set to zero. </span><span class="koboSpan" id="kobo.21.2">Then, through transition, we interpolated the path </span><code class="literal"><span class="koboSpan" id="kobo.22.1">d</span></code><span class="koboSpan" id="kobo.23.1"> attribute to its final angle using the arc generator function </span><code class="literal"><span class="koboSpan" id="kobo.24.1">arc(d)</span></code><span class="koboSpan" id="kobo.25.1">. </span><span class="koboSpan" id="kobo.25.2">This approach seems to make sense, however, what it generates is the transition shown in the following:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.26.1"><img src="graphics/5530_07_11.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.27.1">Arc transition without tweening</span></p><p><span class="koboSpan" id="kobo.28.1">This is obviously not the animation we want. </span><span class="koboSpan" id="kobo.28.2">The reason for this strange transition is that by directly creating a transition on the </span><code class="literal"><span class="koboSpan" id="kobo.29.1">svg:path</span></code><span class="koboSpan" id="kobo.30.1"> attribute </span><code class="literal"><span class="koboSpan" id="kobo.31.1">d</span></code><span class="koboSpan" id="kobo.32.1">, we are instructing D3 to interpolate this string:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.33.1">d="M1.2246063538223773e-14,-200A200,200 0 0,1 1.2246063538223773e- 
14,-200L6.123031769111886e-15,-100A100,100 0 0,0  
6.123031769111886e-15,-100Z" 
</span></pre><p><span class="koboSpan" id="kobo.34.1">Then, the preceding string will interpolate to this string linearly:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.35.1">d="M1.2246063538223773e-14,-200A200,200 0 0,1 117.55705045849463,- 
161.80339887498948L58.778525229247315,-80.90169943749474A100,100 0  
0,0 6.123031769111886e-15,-100Z" 
</span></pre><p><span class="koboSpan" id="kobo.36.1">Hence, it leads to this particular transition effect.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip70"/><span class="koboSpan" id="kobo.37.1">Tip</span></h3><p><span class="koboSpan" id="kobo.38.1">Though this transition effect is not what we desire in this example, this is still a good showcase of how flexible and powerful built-in D3 transition is.</span></p></div></div><p><span class="koboSpan" id="kobo.39.1">In order to achieve the transition effect we want, we will need to leverage the D3 attribute tweening (for detailed description on tweening, refer to the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.40.1">Using tweening</span></em></span><span class="koboSpan" id="kobo.41.1"> recipe of </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.42.1">Chapter 6</span></a><span class="koboSpan" id="kobo.43.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.44.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.45.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.46.1">svg.append("g") 
        .attr("transform", "translate(200,200)") 
        .selectAll("path.arc") 
            .data(data) 
        .enter() 
            .append("path") 
            .attr("class", "arc") 
            .attr("fill", function (d, i) { 
                return colors(i); 
            }) 
            .transition().duration(1000) 
            .attrTween("d", function (d) { // &lt;-A 
                var start = {startAngle: 0, endAngle: 0}; // &lt;-B 
                var interpolate = d3.interpolate(start, d); // &lt;-C 
                return function (t) { 
                    return arc(interpolate(t)); // &lt;-D 
                }; 
            }); 
</span></pre><p><span class="koboSpan" id="kobo.47.1">Here, instead of transitioning the </span><code class="literal"><span class="koboSpan" id="kobo.48.1">svg:path</span></code><span class="koboSpan" id="kobo.49.1"> attribute </span><code class="literal"><span class="koboSpan" id="kobo.50.1">d</span></code><span class="koboSpan" id="kobo.51.1"> directly, we created a tweening function on line </span><code class="literal"><span class="koboSpan" id="kobo.52.1">A</span></code><span class="koboSpan" id="kobo.53.1">. </span><span class="koboSpan" id="kobo.53.2">As you can recall, D3 </span><code class="literal"><span class="koboSpan" id="kobo.54.1">attrTween</span></code><span class="koboSpan" id="kobo.55.1"> expects a factory function for a tween function. </span><span class="koboSpan" id="kobo.55.2">In this case, we started our tweening from angle zero (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.56.1">B</span></code><span class="koboSpan" id="kobo.57.1">). </span><span class="koboSpan" id="kobo.57.2">Then, we created a compound object interpolator on line </span><code class="literal"><span class="koboSpan" id="kobo.58.1">C</span></code><span class="koboSpan" id="kobo.59.1">, which will interpolate both start and end angles for each slice. </span><span class="koboSpan" id="kobo.59.2">Finally, on line </span><code class="literal"><span class="koboSpan" id="kobo.60.1">D</span></code><span class="koboSpan" id="kobo.61.1">, the arc generator is used to generate a proper </span><code class="literal"><span class="koboSpan" id="kobo.62.1">svg:path</span></code><span class="koboSpan" id="kobo.63.1"> formula using the already interpolated angles. </span><span class="koboSpan" id="kobo.63.2">This is how a smooth transition of properly angled arcs can be created through custom attribute tweening.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec165"/><span class="koboSpan" id="kobo.64.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.65.1">D3 also provides support for other shape generators, for example, symbol, chord, and diagonal. </span><span class="koboSpan" id="kobo.65.2">However, due to their simplicity and the limited scope of this book, we will not cover them individually here, although we will cover them as parts of other more complex visual constructs in the following chapters. </span><span class="koboSpan" id="kobo.65.3">More importantly, with well-grounded understanding of these basic shape generators covered in this chapter, you should be able to pick up other D3 shape generators without much trouble.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec166"/><span class="koboSpan" id="kobo.66.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.67.1">For more information on transition and tweening, refer to the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.68.1">Using tweening recipe</span></em></span><span class="koboSpan" id="kobo.69.1"> in </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.70.1">Chapter 6</span></a><span class="koboSpan" id="kobo.71.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.72.1">Transition with Style</span></em></span></li></ul></div></div></div></div></div></body></html>