<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;File Management" id="aid-MSDG1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. File Management</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Copying files</li><li class="listitem">Compressing files</li><li class="listitem">Creating symbolic links</li><li class="listitem">Concatenating files</li><li class="listitem">Fetching a single URL</li><li class="listitem">Fetching multiple URLs</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Introduction</h1></div></div></div><p>In this chapter, we'll be focused on making use of Grunt for our every-day file management tasks. A day rarely passes without us copying, compressing, downloading, or concatenating files, and with the help of Grunt, we can automate even these simple tasks.</p></div></div>
<div class="section" title="Copying files" id="aid-NQU21"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Copying files</h1></div></div></div><p>In our quest for ultimate project automation, it won't be long before we'll want to automate the copying of files or directories from one part of our project to another. The <code class="literal">contrib-copy(0.5.0)</code> plugin provides us with this functionality, along with some other options that become especially useful in the process of copying files.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>How to do it...</h2></div></div></div><p>The following steps will take us through copying a single file from one directory to another.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-copy</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Let's also set up a sample file in our project, which we can try out with the copy operation. Create a file named <code class="literal">sample.txt</code> in the <code class="literal">src</code> directory with the following contents:<div class="informalexample"><pre class="programlisting">Some sample data.</pre></div></li><li class="listitem">Now, we can add the configuration for our <code class="literal">copy</code> task, which will instruct it to copy our sample file from the <code class="literal">src</code> directory to the <code class="literal">dest</code> directory:<div class="informalexample"><pre class="programlisting">copy: {
  sample: {
    src: 'src/sample.txt',
    dest: 'dest/sample.txt'
  }
}</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip23"/>Tip</h3><p>Note that the destination directory specified in the copy operation will be automatically created if it does not yet exist.</p></div></li><li class="listitem">Finally, we can run the <code class="literal">grunt copy</code> command, which should provide output informing us of the successful copy operation:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "copy:files" (copy) task</strong></span>
<span class="strong"><strong>Copied 1 files</strong></span>
</pre></div></li><li class="listitem">To confirm that the sample file was copied, we can now open the <code class="literal">dest/sample.txt</code> file using our favorite editor and confirm that its contents match the original file's contents.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>There's more...</h2></div></div></div><p>The <code class="literal">copy</code> task provides some useful configuration options that allow us to process the contents of the files that are being copied, copy the source file's permissions, and set the file permissions for destination files.</p><div class="section" title="Processing file contents"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec17"/>Processing file contents</h3></div></div></div><p>The <code class="literal">copy</code> task provides the option of altering the contents of files as they are being copied. There are a number of useful applications for this functionality, such as rendering a template or replacing parts of a file that are matched by a regular expression.</p><p>In the following example, we'll simply focus on prepending a string to a copied file. We'll build upon our work earlier in this recipe.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by providing a stub function for the <code class="literal">process</code> option that just passes through the content without altering anything. This will change the configuration of our <code class="literal">copy</code> task to the following:<div class="informalexample"><pre class="programlisting">copy: {
  sample: {
    options: {
      <span class="strong"><strong>process: function (content, path) {</strong></span>
<span class="strong"><strong>        return content;</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'src/sample.txt',
    dest: 'dest/sample.txt'
  }
}</pre></div></li><li class="listitem">Now, we can alter the function passed to the <code class="literal">process</code> option so that it prepends a string to the contents of the file being copied, making it look similar to the following:<div class="informalexample"><pre class="programlisting">process: function (content, path) {
  <span class="strong"><strong>return 'Prepended string!\n' + content;</strong></span>
}</pre></div></li><li class="listitem">If we now run the <code class="literal">grunt copy</code> command again, we will see a confirmation of the file being copied, and looking at the contents of the <code class="literal">dest/sample.txt</code> file, we should see the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Prepended content</strong></span>
<span class="strong"><strong>Sample content.</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Copying the source file's permissions"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec18"/>Copying the source file's permissions</h3></div></div></div><p>The permissions attached to a file are usually of great importance. By default, the copy task will ignore the file permissions of the source file, but if you'd like them to be applied to the destination file, then the <code class="literal">mode</code> option can be set to <code class="literal">true</code> as per the following example:</p><div class="informalexample"><pre class="programlisting">copy: {
  sample: {
    options: {
<span class="strong"><strong>      mode: true</strong></span>
    },
    src: 'src/sample.txt',
    dest: 'dest/sample.txt'
  }
}</pre></div></div><div class="section" title="Setting the permissions of the destination file"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec19"/>Setting the permissions of the destination file</h3></div></div></div><p>In case you'd like to specify the permissions that the destination files of a copy operation should get, you can do so by setting the <code class="literal">mode</code> option to the desired permission mode using the traditional Unix permissions in octal format.</p><div class="note" title="Note"><h3 class="title"><a id="tip24"/>Tip</h3><p>You can read more about the traditional Unix permissions convention at <a class="ulink" href="http://en.wikipedia.org/wiki/File_system_permissions">http://en.wikipedia.org/wiki/File_system_permissions</a>.</p><p>There's also a handy Unix file permissions calculator available at <a class="ulink" href="http://permissions-calculator.org/">http://permissions-calculator.org/</a>.</p></div><p>The following example configuration will make the destination file readable and writable, only for their owner:</p><div class="informalexample"><pre class="programlisting">copy: {
  files: {
    src: 'src/sample.txt',
    dest: 'www/sample.txt',
    options: {
      <span class="strong"><strong>mode: '0600'</strong></span>
    }
  }
}</pre></div></div></div></div>
<div class="section" title="Compressing files" id="aid-OPEK1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Compressing files</h1></div></div></div><p>The compression of files is quite a common practice within our local system, and across the World Wide Web. The most prominent use for file compression is to reduce the size of data that will be transferred across a network.</p><p>For our own purposes, we may at some point want to automate the compression of a file or folder that we'd like to make available for download or prepare for a transfer. The <code class="literal">contrib-compress (0.10.0)</code> plugin provides us with this functionality, along with options to specify the archive type and algorithms used in the process.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How to do it...</h2></div></div></div><p>The following steps will take us through compressing a single sample file using the default settings of the <code class="literal">compress</code> task.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-compress</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Then, we can create a sample file to demonstrate the compression functionality. Let's download a book in text format as an example and save it as <code class="literal">book.txt</code> in our project directory.<div class="note" title="Note"><h3 class="title"><a id="tip25"/>Tip</h3><p>The text version of Jane Austen's <span class="emphasis"><em>Pride and Prejudice</em></span> can be downloaded at the following URL:</p><p><a class="ulink" href="http://www.gutenberg.org/cache/epub/1342/pg1342.txt">http://www.gutenberg.org/cache/epub/1342/pg1342.txt</a></p></div></li><li class="listitem">Now, we can add the following configuration for the <code class="literal">compress</code> task, which will compress our sample file into the <code class="literal">book.txt.gz</code> archive file:<div class="informalexample"><pre class="programlisting">compress: {
  sample: {
    src: 'book.txt.gz',
    dest: 'book.txt'
  }
}</pre></div></li><li class="listitem">To try it out, we can run the <code class="literal">grunt compress</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "compress:sample" (compress) task</strong></span>
<span class="strong"><strong>Created book.txt.gz (314018 bytes)</strong></span>
</pre></div></li><li class="listitem">If we take a look at the <code class="literal">book.txt.gz</code> file, we'll see that it's about half the size of the <code class="literal">book.txt</code> file. We can also go as far as extracting this file using our favorite archive extractor to confirm that it contains the original file.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>There's more...</h2></div></div></div><p>The <code class="literal">compress</code> task provides us with several options that allow us to archive a collection of files, specify the compression mode, and specify the archive compression level.</p><div class="section" title="Archiving a collection of files"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec20"/>Archiving a collection of files</h3></div></div></div><p>In our main recipe, we compressed a single file on its own, but it's possibly more common to archive a collection of files into one single file. In order to do this, we alter our <code class="literal">src</code> configuration to specify the files that should be archived, remove the <code class="literal">dest</code> configuration, and then provide a filename for our archive file using the <code class="literal">archive</code> option.</p><p>The following steps continues from the work we did earlier in this recipe, through to archiving and compressing a collection of files into a single file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll add some more files that we'd like to have archived and compressed. Let's change the name of our previously downloaded book from <code class="literal">book.txt</code> to <code class="literal">austen.txt</code> and download a couple more, renaming them as <code class="literal">wells.txt</code> and <code class="literal">thoreau.txt</code>.<div class="note" title="Note"><h3 class="title"><a id="tip26"/>Tip</h3><p>The two sample books mentioned can be downloaded from the following URLs in the same order they were mentioned:</p><p><a class="ulink" href="http://www.gutenberg.org/cache/epub/36/pg36.txt">http://www.gutenberg.org/cache/epub/36/pg36.txt</a></p><p><a class="ulink" href="http://www.gutenberg.org/files/205/205-0.txt">http://www.gutenberg.org/files/205/205-0.txt</a></p></div></li><li class="listitem">Now, we can change our <code class="literal">compress</code> task's configuration from just compressing the file named <code class="literal">book.txt</code> to including all three downloaded books in an archive file named <code class="literal">books.zip</code>. We do this by changing its configuration to the following:<div class="informalexample"><pre class="programlisting">compress: {
  sample: {
    <span class="strong"><strong>options: {</strong></span>
<span class="strong"><strong>      archive: 'books.zip'</strong></span>
<span class="strong"><strong>    },</strong></span>
<span class="strong"><strong>    src: ['austen.txt', 'wells.txt', 'thoreau.txt']</strong></span>
  }
}</pre></div></li><li class="listitem">Let's try it out by running the <code class="literal">grunt compress</code> command, which should provide us with output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "compress:sample" (compress) task</strong></span>
<span class="strong"><strong>Created books.zip (786932 bytes)</strong></span>
</pre></div></li><li class="listitem">We should now see the <code class="literal">books.zip</code> archive in our project directory. To confirm that it contains all the files we specified, you can use your favorite archiving tool to explore or extract it.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Specifying the compression mode"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec21"/>Specifying the compression mode</h3></div></div></div><p>By default, the <code class="literal">compress</code> task will determine the compression mode to use in its operations by looking at the extension of the file name specified in <code class="literal">archive</code> option. This behavior can be altered by indicating the compression mode using the <code class="literal">mode</code> option.</p><p>The following example will make use of the <code class="literal">zip</code> mode despite the extension of the filename specified in the <code class="literal">archive</code> option being <code class="literal">tgz</code>:</p><div class="informalexample"><pre class="programlisting">compress: {
  sample: {
    options: {
      <span class="strong"><strong>mode: 'zip',</strong></span>
      archive: 'books.tgz'
    },
    files: {
      src: ['austen.txt', 'wells.txt', 'thoreau.txt']
    }
  }
}</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip27"/>Tip</h3><p>At the time of publication, the compression modes supported for the <code class="literal">mode</code> option were <code class="literal">gzip</code>, <code class="literal">deflate</code>, <code class="literal">deflateRaw</code>, <code class="literal">tar</code>, <code class="literal">tgz</code>, and <code class="literal">zip</code>.</p></div></div><div class="section" title="Specifying the archive compression level"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec22"/>Specifying the archive compression level</h3></div></div></div><p>In case we'd like to specify a compression rate when using either the <code class="literal">zip</code> or <code class="literal">gzip</code> compression modes, we can do so using the <code class="literal">level</code> option. This option is set to <code class="literal">1</code> by default, but can be set to any integer up to <code class="literal">9</code>, the latter indicating better compression at the cost of slower performance.</p><p>The following configuration will compress our books to level <code class="literal">9</code>, which takes a little longer, but decreases the size of the produced archive by about 10 percent:</p><div class="informalexample"><pre class="programlisting">compress: {
  sample: {
    options: {
      <span class="strong"><strong>level: 9,</strong></span>
      archive: 'books.zip'
    },
    src: ['austen.txt', 'wells.txt', 'thoreau.txt']
  }
}</pre></div></div></div></div>
<div class="section" title="Creating symbolic links" id="aid-PNV61"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Creating symbolic links</h1></div></div></div><p>Creating references to files and directories can be quite useful in various circumstances, most notably when we'd like to distribute duplicates of a file and keep them up to date without having to manually copy them after each change.</p><p>The functionality of creating symbolic links is provided to us by the <code class="literal">contrib-symlink</code> <code class="literal">(0.3.0)</code> plugin. It's a very simple plugin but provides all the standard Grunt configuration options.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>How to do it...</h2></div></div></div><p>The following steps will take us through creating a symbolic link to a file named <code class="literal">assets/img/logo.png</code> inside the <code class="literal">www/img</code> directory.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-symlink</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Then, we can add the following configuration, which will create the symbolic link in the <code class="literal">img/www</code> directory:<div class="informalexample"><pre class="programlisting">symlink: {
  sample: {
    files: {
      'www/img/logo.png': 'assets/img/logo.png'
    }
  }
}</pre></div></li><li class="listitem">To try it out, we can run the <code class="literal">grunt symlink</code> command, which should inform us of the creation of the symbolic link with output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "symlink:files" (symlink) task</strong></span>
<span class="strong"><strong>&gt;&gt; Created 1 symbolic links.</strong></span>
</pre></div></li><li class="listitem">If you now take a look inside the <code class="literal">www/img</code> directory, you should see a symbolic link called <code class="literal">logo.png</code>, which points to the <code class="literal">assets/img/logo.png</code> file. You can perhaps also try to change the contents of the image to see them reflected in the symbolic link.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Concatenating files" id="aid-QMFO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Concatenating files</h1></div></div></div><p>The practice of concatenating files is quite often found in the routines of all kinds of developers. Be it combining fragmented log files or many smaller source files into one big code base, joining files end-to-end comes in handy on a regular basis.</p><p>Concatenation functionality can be provided to us by the <code class="literal">contrib-concat</code> <code class="literal">(0.4.0)</code> plugin. Along with the standard Grunt configurations, it also provides a large set of options to tailor its behavior according to our unique requirements.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How to do it...</h2></div></div></div><p>The following steps will take us through concatenating three JavaScript source files into one combined source file, so that we only have to serve one source file along with our web application.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-concat</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">For our example, we'll also require three JavaScript source files. Let's call them <code class="literal">one.js</code>, <code class="literal">two.js</code>, and <code class="literal">three.js</code>, and provide them each with the following contents, only replacing <code class="literal">&lt;filename&gt;</code> with their names:<div class="informalexample"><pre class="programlisting">var sample = 'Sample code from &lt;filename&gt;.';
console.log(sample);</pre></div></li><li class="listitem">Now, we can add the following configuration for the <code class="literal">concat</code> task, which will combine our three sample files into the <code class="literal">all.js</code> file:<div class="informalexample"><pre class="programlisting">concat: {
  sample: {
    files: {
      'all.js': ['one.js', 'two.js', 'three.js']
    }
  }
}</pre></div></li><li class="listitem">To try out our task, we can run the <code class="literal">grunt concat</code> command, which will produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "concat:sample" (concat) task</strong></span>
<span class="strong"><strong>File all.js created</strong></span>
</pre></div></li><li class="listitem">We can now take a look at the <code class="literal">all.js</code> file that was created, which will contain the following code:<div class="informalexample"><pre class="programlisting">var sample = 'Sample code from one.js.';
console.log(sample);
var sample = 'Sample code from two.js.';
console.log(sample);
var sample = 'Sample code from three.js.';
console.log(sample);</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>There's more...</h2></div></div></div><p>The <code class="literal">concat</code> task provides us with several options that allow us to join the files with a custom separator, strip banners before concatenation, add a banner and footer to the concatenated result, and process the source file's contents before concatenation.</p><div class="section" title="Joining files with a custom separator"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec23"/>Joining files with a custom separator</h3></div></div></div><p>It's usually preferable to have a prominent separator between the joined files so that it's easier to distinguish between them, in case we need to review the contents of the concatenated result.</p><p>By default, the <code class="literal">concat</code> task will just separate joined files with a linefeed character, but a custom separator can be provided using the <code class="literal">separator</code> option as per the following example:</p><div class="informalexample"><pre class="programlisting">concat: {
  sample: {
    options: {
      <span class="strong"><strong>separator: '\n\n/* Next file */\n\n'</strong></span>
    },
    files: {
      'all.js': ['one.js', 'two.js', 'three.js']
    }
  }
}</pre></div><p>Running the task with the preceding example code should produce a <code class="literal">all.js</code> file with contents similar to the following:</p><div class="informalexample"><pre class="programlisting">var sample = 'Sample code from one.js.\n';
console.log(sample);

/* Next file */

var sample = 'Sample code from two.js.\n';
console.log(sample);

/* Next file */

var sample = 'Sample code from three.js.\n';
console.log(sample);</pre></div></div><div class="section" title="Stripping banners before concatenation"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec24"/>Stripping banners before concatenation</h3></div></div></div><p>The need to remove banners from JavaScript source files before joining them is quite common since they usually take up quite a bit of extra storage space, and as every web developer knows, every bit counts.</p><p>To automatically strip banners from JavaScript source files, we can make use of the <code class="literal">stripBanners</code> option as per the following example:</p><div class="informalexample"><pre class="programlisting">concat: {
  sample: {
    options: {
      <span class="strong"><strong>stripBanners: true</strong></span>
    },
    files: {
      'all.js': ['one.js', 'two.js', 'three.js']
    }
  }
}</pre></div></div><div class="section" title="Adding a banner and footer to the concatenated result"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec25"/>Adding a banner and footer to the concatenated result</h3></div></div></div><p>Once the concatenated result is generated, it can often be useful to add a banner or footer that provides some extra information. The following example does just that by making use of the <code class="literal">banner</code> and <code class="literal">footer</code> options:</p><div class="informalexample"><pre class="programlisting">concat: {
  sample: {
    options: {
      <span class="strong"><strong>banner: '/* The combination of three files */\n',</strong></span>
<span class="strong"><strong>      footer: '\n/* No more files to be combined */'</strong></span>
    },
    files: {
      'all.js': ['one.js', 'two.js', 'three.js']
    }
  }
}</pre></div><p>Running the task with the preceding example code should produce an <code class="literal">all.js</code> file with contents similar to the following:</p><div class="informalexample"><pre class="programlisting">/* The combination of three files */
var sample = 'Sample code from one.js.\n';
console.log(sample);
var sample = 'Sample code from two.js.\n';
console.log(sample);
var sample = 'Sample code from three.js.\n';
console.log(sample);
/* No more files to be combined */</pre></div></div><div class="section" title="Processing the source file's contents before concatenation"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec26"/>Processing the source file's contents before concatenation</h3></div></div></div><p>In case we'd like to alter the contents of the files we're joining, the <code class="literal">concat</code> task provides the option of doing so with code, before concatenating them. This can be done by providing a function to the <code class="literal">process</code> option, which receives the file content, modifies it, and returns it.</p><p>The following example makes use of this functionality to create a banner above each joined file that indicates its filename:</p><div class="informalexample"><pre class="programlisting">concat: {
  sample: {
    options: {
      <span class="strong"><strong>process: function (content, filename) {</strong></span>
<span class="strong"><strong>        var banner = '/* ' + filename + ' */\n';</strong></span>
<span class="strong"><strong>        return banner + content;</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    files: {
      'all.js': ['one.js', 'two.js', 'three.js']
    }
  }
}</pre></div><p>Running the task with the preceding example code should produce an <code class="literal">all.js</code> file with contents similar to the following:</p><div class="informalexample"><pre class="programlisting">/* one.js */
var sample = 'Sample code from one.js.\n';
console.log(sample);
/* two.js */
var sample = 'Sample code from two.js.\n';
console.log(sample);
/* three.js */
var sample = 'Sample code from three.js.\n';
console.log(sample);</pre></div></div></div></div>
<div class="section" title="Fetching a single URL" id="aid-RL0A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Fetching a single URL</h1></div></div></div><p>If you're working on web-based projects, you'll probably want to download something at some point. Downloading a file is quite a simple operation, but automating it can save you a significant amount of time in the long run.</p><p>We'll make use of the relatively popular <code class="literal">curl</code> <code class="literal">(2.0.2)</code> plugin to download a resource from the Internet. The <code class="literal">curl</code> task is provided by this plugin to download single files.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>How to do it...</h2></div></div></div><p>The following steps will take us through using the <span class="strong"><strong>OpenWeatherMap API</strong></span> to download the current weather for the city of London and saving it to the <code class="literal">london.json</code> file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">curl</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Now, we can add the following configuration to download London's current weather information to the <code class="literal">london.json</code> file:<div class="informalexample"><pre class="programlisting">curl: {
      london: {
        src: 'http://api.openweathermap.org/'
          + 'data/2.5/weather?q=London',
        dest: 'london.json'
      }
    }</pre></div></li><li class="listitem">To test our setup, we can run the <code class="literal">grunt curl</code> command, which should provide us with output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "curl:london" (curl) task</strong></span>
<span class="strong"><strong>File "london.json" created.</strong></span>
</pre></div></li><li class="listitem">If we now take a look at the project directory, we should see the downloaded weather information saved to the <code class="literal">london.json</code> file.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>There's more...</h2></div></div></div><p>If we need more flexibility in our requests to download content, the <code class="literal">curl</code> task allows us to do so using the <code class="literal">request</code> HTTP client utility provided by the <code class="literal">request</code> package. The same options that can be used for the <code class="literal">request</code> utility can be provided in the <code class="literal">src</code> configuration.</p><div class="note" title="Note"><h3 class="title"><a id="tip28"/>Tip</h3><p>You can read more about the <code class="literal">request</code> HTTP client utility at the following URL:</p><p><a class="ulink" href="https://github.com/mikeal/request">https://github.com/mikeal/request</a></p></div><p>The following example uses this functionality to provide an object for the query string of the request, instead of having it included in the URL string:</p><div class="informalexample"><pre class="programlisting">curl: {
  london: {
    src: {
      url: 'http://api.openweathermap.org/data/2.5/weather',
      qs: {q:'London'}
    },
    dest: 'london.json'
  }
}</pre></div></div></div>
<div class="section" title="Fetching multiple URLs" id="aid-SJGS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Fetching multiple URLs</h1></div></div></div><p>If you're automating resource downloads for your project, you'll probably want to download more than one resource to the same directory, and probably from the same site.</p><p>We'll make use of the relatively popular <code class="literal">curl</code> <code class="literal">(2.0.2)</code> plugin to download multiple resources from the Internet. It provides the <code class="literal">curl-dir</code> task specifically to download multiple resources.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>How to do it...</h2></div></div></div><p>The following steps take us through downloading both the Grunt and Node.js logos into the <code class="literal">logos</code> directory.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">curl</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Now, we can add the following <code class="literal">curl-dir</code> task configuration, which will download the two logos into the <code class="literal">logos</code> directory:<div class="informalexample"><pre class="programlisting">'curl-dir': {
  logos: {
    src: [
      'http://nodejs.org/images/logo.png',
      'http://www.gruntjs.com/img/grunt-logo.png'
    ],
    dest: 'logos'
  }
}</pre></div></li><li class="listitem">To test the task, we can run it using the <code class="literal">grunt curl-dir</code> command, which should provide output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "curl-dir:logo" (curl-dir) task</strong></span>
<span class="strong"><strong>Files "logos/logo.png", "logos/grunt-logo.png" created.</strong></span>
</pre></div></li><li class="listitem">We should now have a directory called <code class="literal">logos</code> in our project path that contains both the Grunt and Node.js logos.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>There's more...</h2></div></div></div><p>The <code class="literal">curl-dir</code> task provides us with several options that allow us to download similar URLs, save downloaded files to altered filenames, and download files using special request options.</p><div class="section" title="Downloading similar URLs"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec27"/>Downloading similar URLs</h3></div></div></div><p>It's also quite common that we might want to download multiple URLs that are very similar. In this case, we can make use of the brace expansion support provided by the <code class="literal">curl-dir</code> task.</p><p>The following configuration example illustrates how we would go about downloading the weather information for London, Paris, and Tokyo, without having to repeat the start of each URL:</p><div class="informalexample"><pre class="programlisting">'curl-dir': {
  weather: {
    src: 'http://api.openweathermap.org/'
      + 'data/2.5/weather?q={London,Paris,Tokyo}',
    dest: 'weather'
  }
}</pre></div></div><div class="section" title="Saving downloaded files to altered filenames"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec28"/>Saving downloaded files to altered filenames</h3></div></div></div><p>It is also quite common to save downloaded resources to filenames other than the ones contained in their URLs. The <code class="literal">router</code> configuration provided by the <code class="literal">curl-dir</code> task allows us to specify a function that receives the URL we downloaded and return the filename that the resource should be saved to.</p><p>The following configuration example illustrates how we can download weather information for three cities and save each of the results to a file with only the city name and the <code class="literal">.json</code> file extension:</p><div class="informalexample"><pre class="programlisting">'curl-dir': {
  weather: {
    <span class="strong"><strong>router: function (url) {</strong></span>
<span class="strong"><strong>      var city = url.slice(url.indexOf('=') + 1, url.length);</strong></span>
<span class="strong"><strong>      return city + '.json';</strong></span>
<span class="strong"><strong>    },</strong></span>
    src: 'http://api.openweathermap.org/'
      + 'data/2.5/weather?q={London,Paris,Tokyo}',
    dest: 'weather'
  }
}</pre></div></div><div class="section" title="Downloading files using special request options"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec29"/>Downloading files using special request options</h3></div></div></div><p>If we need more flexibility in our requests to download content, the <code class="literal">curl-dir</code> task allows us to do so using the <code class="literal">request</code> HTTP client utility provided by the <code class="literal">request</code> package. The same options that can be used for the <code class="literal">request</code> utility can be provided in the <code class="literal">src</code> configuration.</p><p>The following configuration example makes use of this functionality by providing the query parameters as objects rather than strings that are appended to the URLs, and also demonstrates using the <code class="literal">router</code> configuration discussed earlier for this type of setup:</p><div class="informalexample"><pre class="programlisting">'curl-dir': {
  weather: {
    router: function (src) {
      return src.qs.q + '.json';
    },
    src: [{
      url: 'http://api.openweathermap.org/data/2.5/weather',
      qs: {q:'London'}
    }, {
      url: 'http://api.openweathermap.org/data/2.5/weather',
      qs: {q:'Paris'}
    }],
    dest: 'weather'
  }
}</pre></div></div></div></div></body></html>