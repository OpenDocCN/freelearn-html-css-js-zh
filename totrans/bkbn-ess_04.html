<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Organizing Models with Collections" id="aid-1394Q1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Organizing Models with Collections</h1></div></div></div><p>In this chapter, we'll learn how to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Create new <code class="literal">Collection</code> subclasses</li><li class="listitem">Add and remove Models from a Collection</li><li class="listitem">Trigger other code in response to changes in the Collection</li><li class="listitem">Store and retrieve <code class="literal">Collections</code> of <code class="literal">Models</code> to and from a remote server</li><li class="listitem">Sand index the Models of a Collection</li><li class="listitem">Take advantage of the the convenience methods borrowed from Underscore</li></ul></div><div class="section" title="Working with Collections"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Working with Collections</h1></div></div></div><p>In Backbone, Models may <a id="id110" class="indexterm"/>form the core of all data interaction, but you'll soon find that you need to work with multiple Models to do any real work, which is where the <code class="literal">Collections</code> class comes in. Just as a Model wraps an object and provides additional functionality, <code class="literal">Collections</code> wraps an array and offers several advantages over using the array directly:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">Collections</code> uses Backbone's class system, making it easy to define methods, create subclasses, and so on</li><li class="listitem"><code class="literal">Collections</code> allows other code to listen for and respond when <code class="literal">Models</code> are added or removed from that <code class="literal">Collection</code> or when Models in a <code class="literal">Collection</code> are modified</li><li class="listitem"><code class="literal">Collections</code> simplifies and encapsulates the logic for communicating with the server</li></ul></div><p>We can create a new <code class="literal">Collection</code> subclass, as follows:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({
     // The properties and methods of Cats would go here
});</pre></div><p>Once we've created a <a id="id111" class="indexterm"/>subclass, we can instantiate new instances of it using JavaScript's <code class="literal">new</code> keyword, just as we did to create new <code class="literal">Model</code> instances. Like Models, Collections have two optional arguments. The first argument is an initial array of <code class="literal">Models</code> or <code class="literal">Model</code> attributes, and the second argument is the Collection's options. If you pass in an array of <code class="literal">Model</code> attributes, Backbone will convert them into Models for you, as follows:</p><div class="informalexample"><pre class="programlisting">var cartoonCats = new Cats([{id: 'cat1', name: 'Garfield'}]);
var garfield = cartoonCats.models[0]; // garfield is a  Model</pre></div><p>Once a <code class="literal">Collection</code> subclass has been created, it stores its Model in a hidden property called <code class="literal">models</code>. Similar to attributes, models should not be used directly, and you should instead rely on the methods of <code class="literal">Collection</code> to work with its Models. Backbone also provides a <code class="literal">length</code> property on each <code class="literal">Collection</code>, which is always set to the number of Models in the <code class="literal">Collection</code> subclass:</p><div class="informalexample"><pre class="programlisting">var cartoonCats = new Cats([{name: 'Garfield'}, {name: 'Heathcliff'}]);
cartoonCats.models.length; // 2, but instead you can do ...
cartoonCats.length; // also 2</pre></div></div></div>
<div class="section" title="Collections and Models" id="aid-147LC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Collections and Models</h1></div></div></div><p>Every <code class="literal">Collection</code> class has a <code class="literal">model</code> property, which<a id="id112" class="indexterm"/> defaults to <code class="literal">Backbone.Model</code>. You can<a id="id113" class="indexterm"/> set this property by providing it as an option when you use <code class="literal">extend</code> to create your <code class="literal">Collection</code> subclass:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({model: Cat});
var cats = new Cats(); // cats.model == Cat</pre></div><p>However, this <code class="literal">model</code> property doesn't actually limit the type of Model a <code class="literal">Collection</code> can hold, and in fact, any <code class="literal">Collection</code> can hold any type of <code class="literal">Model</code>:</p><div class="informalexample"><pre class="programlisting">var Cat = Backbone.Model.extend();
var Cats = Backbone.Collection.extend({model: Cat});
var Dog = Backbone.Model.extend();
var snoopy = new Dog({name: 'Snoopy'});
var cartoonCats = new Cats([snoopy]);
cartoonCats.models[0] instanceof Dog; // true</pre></div><p>This is because the <code class="literal">model</code> property of a <code class="literal">Collection</code> is only used when new Models are created through the <code class="literal">Collection</code>. One way in which this can happen is when the <code class="literal">Collection</code> is initialized with an array of attributes, as shown in the following example:</p><div class="informalexample"><pre class="programlisting">var snoopyAttributes = {id: 'dog1', name: 'Snoopy'};
var cartoonCats = new Cats([snoopyAttributes]);
cartoonCats.models[0] instanceof Cat; // true</pre></div><p>Another way in which a Collection's <code class="literal">model</code> property can be used is via the Collection's <code class="literal">create</code> method. Calling <code class="literal">create</code> on a <code class="literal">Collection</code> and passing it an <code class="literal">attributes</code> object is essentially the <a id="id114" class="indexterm"/>same as calling new <code class="literal">Collection.model(attributes)</code>, except that <a id="id115" class="indexterm"/>after the provided attributes are converted into a <code class="literal">Model</code>, Backbone will add this <code class="literal">Model</code> to the <code class="literal">Collection</code> and then save it:</p><div class="informalexample"><pre class="programlisting">var cartoonCats = new Cats();
var garfield = cats.create({name: 'Garfield'}); // equivalent to:
// var garfield = new Cat({name: 'Garfield'});// cats.models.push(garfield);
// garfield.save();</pre></div></div>
<div class="section" title="Adding to and resetting Collections" id="aid-1565U1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Adding to and resetting Collections</h1></div></div></div><p>In addition to <a id="id116" class="indexterm"/>passing in <code class="literal">Models</code> or <code class="literal">attributes</code> when we first create a <code class="literal">Collection</code>, we can also add individual <code class="literal">Models</code> or <code class="literal">attributes</code>, or arrays of <code class="literal">Models</code> or <code class="literal">attributes</code>, to a <code class="literal">Collection</code> via the <code class="literal">add</code> method:</p><div class="informalexample"><pre class="programlisting">var cats = new Backbone.Collection();
cats.add({name: 'Garfield'});
cats.models[0] instanceof Cat; // true</pre></div><p>Similar to <code class="literal">create</code>, the <code class="literal">add</code> method will use the Collection's <code class="literal">model</code> property to create the resulting <code class="literal">Models</code>. If instead you want to replace all the existing <code class="literal">Models</code> in a <code class="literal">Collection</code> rather than add more, you can use the <code class="literal">reset</code> method, as shown here:</p><div class="informalexample"><pre class="programlisting">var cats = new Backbone.Collection([{name: 'Garfield'}]);
cats.reset([{name: 'Heathcliff'}]);
cats.models[0].get('name'); // "Heathcliff"
cats.length; // 1, not 2, because we replaced Garfield with Heathcliff</pre></div></div>
<div class="section" title="Indexing" id="aid-164MG1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Indexing</h1></div></div></div><p>In order to get or remove<a id="id117" class="indexterm"/> specific <code class="literal">Models</code> from a <code class="literal">Collection</code>, Backbone needs to know how to index these <code class="literal">Models</code>. Backbone does this in two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Using the Model's <code class="literal">id</code> property, if any (which, as we discussed in the previous chapter, can either be set directly or indirectly by setting the Model's <code class="literal">idAttribute</code> property)</li><li class="listitem">Using the Model's <code class="literal">cid</code> property (which all Models have)</li></ul></div><p>When you add a <code class="literal">Model</code> or <code class="literal">attributes</code> to a <code class="literal">Collection</code>, Backbone uses both of the preceding forms of identification to register the <code class="literal">Model</code> in the Collection's <code class="literal">_byId</code> property. <code class="literal">_byId</code> is yet another one of Backbone's hidden properties, but it's a <code class="literal">private</code> property as well (because its name is prefixed by <code class="literal">_</code>). This means that, even more so than with other hidden properties, you should avoid using <code class="literal">_byId</code> directly and instead use it indirectly through methods such as <code class="literal">get</code>. The <code class="literal">get</code> method returns the <code class="literal">Model</code> with the provided ID (if any) by<a id="id118" class="indexterm"/> using <code class="literal">_byId</code>:</p><div class="informalexample"><pre class="programlisting">var garfield = new Cat({id: 'cat1', name: 'Garfield'});
var cats = new Backbone.Collection([garfield]);
cats.get('cat1'); // garfield
cats.get(garfield.cid); // also garfield
cats.get('cat2'); // returns undefined</pre></div><p>The <code class="literal">_byId</code> property can also be used indirectly in another <code class="literal">Collection</code> method, which is <code class="literal">remove</code>. As its name implies, <code class="literal">remove</code> takes out the <code class="literal">Model</code> with the provided ID from the <code class="literal">Collection</code>:</p><div class="informalexample"><pre class="programlisting">var cats = new Backbone.Collection([{
    id: 'cat1',    name: 'Garfield'
}]);
cats.remove('cat1');
cats.length; // 0</pre></div><p>You can also <code class="literal">get</code> and <code class="literal">remove</code> Models from a <code class="literal">Collection</code> using a set of methods you're already familiar with, because they also exist (and work the same way) on arrays in JavaScript. These are the methods that you can use:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">push</code></li><li class="listitem"><code class="literal">pop</code></li><li class="listitem"><code class="literal">unshift</code></li><li class="listitem"><code class="literal">shift</code></li><li class="listitem"><code class="literal">slice</code></li></ul></div><p>Finally, if you want to retrieve a <code class="literal">Model</code> from a <code class="literal">Collection</code> using its index, instead of its <code class="literal">id</code>, you can use <code class="literal">at</code>, a Collection's final Model accessing method. The <code class="literal">at</code> method takes a zero-based index and returns the <code class="literal">Model</code> at that index, if any:</p><div class="informalexample"><pre class="programlisting">var cats = new Backbone.Collection([
    {name: 'Garfield'},    {name: 'Heathcliff'}
]);
cats.at(1); // returns heathcliff</pre></div></div>
<div class="section" title="Sorting" id="aid-173721"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Sorting</h1></div></div></div><p>Backbone can automatically sort<a id="id119" class="indexterm"/> all <code class="literal">Models</code> added to a <code class="literal">Collection</code> if you tell it to by specifying a comparator. As with a model, a Collection's comparator can be provided as an option when the <code class="literal">Collection</code> class is created:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({comparator: 'name'});
var cartoonCats = new Cats();
cartoonCats.comparator; // 'name'</pre></div><p>While the provided comparator controls how the Collection sorts its models internally, you can also sort a Collection using alternate comparators by using one of Underscore's sorting methods, which we'll detail at the end of the chapter.</p><p>The comparator itself can come in three forms. The first and simplest form is the name of an attribute of the Models in the Collection. If this form is used, Backbone will sort the collection based on the values of the specified attribute:</p><div class="informalexample"><pre class="programlisting">var cartoonCats = new Backbone.Collection([
    {name: 'Heathcliff'},
    {name: 'Garfield'}
], {
    comparator: 'name'
});
cartoonCats.at(0);// garfield, because his name sorts first alphabetically</pre></div><p>The second form of <a id="id120" class="indexterm"/>comparator is a function that takes a single argument. If this form is used, Backbone will pass any Models it is trying to sort to this function one at a time and then use whatever value is returned to sort the Model. For instance, if you want to sort your Models alphabetically, except if that <code class="literal">Model</code> is <code class="literal">Heathcliff</code>, you can use a comparator of this form:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({
    comparator: function(cat) {
        if (cat.get('name') == 'Heathcliff') return '0';
        return cat.get('name');
    }
});
var cartoonCats = new Cats([ 
    {name: 'Heathcliff'},    {name: 'Garfield'}
]);
cartoonCats.at(0); // heathcliff, because "0" comes before "garfield" alphabetically</pre></div><p>The final form of <code class="literal">comparator</code> is a function that takes two <code class="literal">Model</code> arguments and returns a number, indicating whether the first argument should come before (<code class="literal">-1</code>) or after (<code class="literal">1</code>) the second. If there is no preference as to which Model should come first, the function will return <code class="literal">0</code>. We can implement our same first <code class="literal">Heathcliff</code> comparator using this style:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({
    comparator: function(leftCat, rightCat) {
        // Special case sorting for Heathcliff
        if (leftCat.get('name') == 'Heathcliff') return -1;
        // Sorting rules for all other cats
        if (leftCat.get('name') &gt; rightCat.get('name')) return 1;
        if (leftCat.get('name') &lt; rightCat.get('name')) return -1;
        if (leftCat.get('name') == rightCat.get('name')) return 0;
    }
});
var cartoonCats = new Cats([ 
    {name: 'Heathcliff'},    {name: 'Garfield'}
]);
cartoonCats.at(0);// heathcliff, because any comparison of his name will return -1</pre></div></div>
<div class="section" title="Events" id="aid-181NK1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Events</h1></div></div></div><p>Just as with Models, Collections have <code class="literal">on</code> and <code class="literal">off</code> methods, which can be used to trigger logic when certain events occur<a id="id121" class="indexterm"/> in their Collection. The following table shows the events that can occur:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Event name</p>
</th><th valign="bottom">
<p>Trigger</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>
<code class="literal">add</code>
</p>
</td><td valign="top">
<p>When a<a id="id122" class="indexterm"/> Model or Models is/are added to the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">remove</code>
</p>
</td><td valign="top">
<p>When a<a id="id123" class="indexterm"/> Model or Models is/are removed from the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">reset</code>
</p>
</td><td valign="top">
<p>When the <a id="id124" class="indexterm"/>Collection is reset</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sort</code>
</p>
</td><td valign="top">
<p>Whenever <a id="id125" class="indexterm"/>the Collection is sorted (typically after an add/remove)</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sync</code>
</p>
</td><td valign="top">
<p>When an <a id="id126" class="indexterm"/>AJAX method of the Collection has completed</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">error</code>
</p>
</td><td valign="top">
<p>When an <a id="id127" class="indexterm"/>AJAX method of the Collection returns an error</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">invalid</code>
</p>
</td><td valign="top">
<p>When<a id="id128" class="indexterm"/> validation triggered by a Model's <code class="literal">save</code>/<code class="literal">isValid</code> call fails</p>
</td></tr></tbody></table></div><p>Collections, such as Models, also have a special <code class="literal">all</code> event, which can be used to listen for any event occurring on the Collection. In addition, the <code class="literal">on</code> method of a Collection can also be used to listen for any Model events triggered by the Models in the Collection, as shown here:</p><div class="informalexample"><pre class="programlisting">var cartoonCats = new Cats([{name: 'Garfield'}]);
cartoonCats.on('change', function(changedModel) {
    alert( changedModel.get('name') + ' just changed!');
});
cartoonCats.at(0).set('weight', 'a whole lot'); // alerts "Garfield just changed!"</pre></div></div>
<div class="section" title="Server-side actions" id="aid-190861"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Server-side actions</h1></div></div></div><p>Just as with Models, Collections <a id="id129" class="indexterm"/>have a <code class="literal">fetch</code> method that retrieves data from the server and a <code class="literal">save</code> method to send data to the server. One minor difference, however, is that by default, a Collection's <code class="literal">fetch</code> will merge any new data from the server with any data it already has. If you prefer to replace your local data with server data entirely, you can pass a <code class="literal">{reset: true}</code> option when you fetch. Collections also have the <code class="literal">url</code>, <code class="literal">parse</code>, and <code class="literal">toJSON</code> methods that control how <code class="literal">fetch</code>/<code class="literal">save</code> work.</p><p>All these methods work in <a id="id130" class="indexterm"/>the same way as they do on Models. However, Collections do not have <code class="literal">urlRoot</code>; while the Models inside a Collection may have IDs, the Collections themselves don't, so Collections don't need to generate their URLs using a <code class="literal">.urlRoot</code>:</p><div class="informalexample"><pre class="programlisting">var Cats = Backbone.Collection.extend({
     url: '/cats'
});
var cats = new Cats({name: 'Garfield'});
cats.save(); // saves Garfield to the server
cats.fetch(); // retrieves cats from the server and adds them</pre></div></div>
<div class="section" title="Underscore methods" id="aid-19UOO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Underscore methods</h1></div></div></div><p>
<code class="literal">Collections</code>, such as <code class="literal">Models</code>, have a number of methods inherited from Underscore, but Collections actually have a<a id="id131" class="indexterm"/> lot more methods than Models...28 methods to be exact. We<a id="id132" class="indexterm"/> can't possibly cover all these methods in detail here, so I'll just provide a quick summary of what each method does and then explore a few of the more important ones in depth.</p><p>Note that just as with the Underscore methods on Model, some of these methods operate on the attributes of the <code class="literal">Models</code> inside the <code class="literal">Collection</code> rather than on the <code class="literal">Collection</code> or <code class="literal">Models</code> themselves. At the same time, however, all the methods that return multiple results return plain old JavaScript arrays, not new Collections. This is done for performance reasons and shouldn't be an issue because if you need those results as a Collection, you can simply create a new one and pass in the results array.</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>What it does</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>
<code class="literal">each</code>
</p>
</td><td valign="top">
<p>This iterates<a id="id133" class="indexterm"/> over every Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">map</code>
</p>
</td><td valign="top">
<p>This returns<a id="id134" class="indexterm"/> an array of values by transforming every Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">reduce</code>
</p>
</td><td valign="top">
<p>This returns a<a id="id135" class="indexterm"/> single value generated from all the Models in a Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">reduceRight</code>
</p>
</td><td valign="top">
<p>The same <a id="id136" class="indexterm"/>as <code class="literal">reduc</code>
<code class="literal">e</code>, except that it iterates backwards</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">find</code>
</p>
</td><td valign="top">
<p>This returns <a id="id137" class="indexterm"/>the first Model that matches a testing function</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">filter</code>
</p>
</td><td valign="top">
<p>This returns all <a id="id138" class="indexterm"/>the Models that match a testing function</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">reject</code>
</p>
</td><td valign="top">
<p>This returns <a id="id139" class="indexterm"/>all the Models that don't match a testing function</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">every</code>
</p>
</td><td valign="top">
<p>This returns<a id="id140" class="indexterm"/> <code class="literal">true</code> if every Model in the Collection matches a test function</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">some</code>
</p>
</td><td valign="top">
<p>This<a id="id141" class="indexterm"/> returns <code class="literal">true</code> if some (any) Model in the Collection matches a test function</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">contains</code>
</p>
</td><td valign="top">
<p>This returns<a id="id142" class="indexterm"/> <code class="literal">true</code> if the Collection includes the<a id="id143" class="indexterm"/> provided Model</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">invoke</code>
</p>
</td><td valign="top">
<p>This calls a <a id="id144" class="indexterm"/>specified function on every Model in the Collection and returns the result</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td valign="top">
<p>This <a id="id145" class="indexterm"/>applies a conversion function to every Model in the Collection and returns the maximum value returned</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td valign="top">
<p>This applies <a id="id146" class="indexterm"/>a conversion function to every Model in the Collection and returns the minimum value returned</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">sortBy</code>
</p>
</td><td valign="top">
<p>This<a id="id147" class="indexterm"/> returns the Collection's Models sorted based on an indicated attribute</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">groupBy</code>
</p>
</td><td valign="top">
<p>This <a id="id148" class="indexterm"/>returns the Collection's Models grouped by an indicated attribute</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">shuffle</code>
</p>
</td><td valign="top">
<p>This<a id="id149" class="indexterm"/> returns one or more randomly chosen Models from the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">toArray</code>
</p>
</td><td valign="top">
<p>This <a id="id150" class="indexterm"/>returns an array of the Collection's Models</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td valign="top">
<p>This <a id="id151" class="indexterm"/>returns a count of Models in the Collection, such as <code class="literal">Collection.length</code>
</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">first</code>
</p>
</td><td valign="top">
<p>This<a id="id152" class="indexterm"/> returns the first (or first N) Model(s) in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">initial</code>
</p>
</td><td valign="top">
<p>This <a id="id153" class="indexterm"/>returns all but the last Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">rest</code>
</p>
</td><td valign="top">
<p>This<a id="id154" class="indexterm"/> returns all the Models in the Collection after the first N</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">last</code>
</p>
</td><td valign="top">
<p>This<a id="id155" class="indexterm"/> returns the last (or last N) Model(s) in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">without</code>
</p>
</td><td valign="top">
<p>This <a id="id156" class="indexterm"/>returns all the Models in the Collection except the provided ones</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">indexOf</code>
</p>
</td><td valign="top">
<p>This<a id="id157" class="indexterm"/> returns the index of the first provided Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">lastIndexOf</code>
</p>
</td><td valign="top">
<p>This<a id="id158" class="indexterm"/> returns the index of the last provided Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">isEmpty</code>
</p>
</td><td valign="top">
<p>This<a id="id159" class="indexterm"/> returns <code class="literal">true</code> if the Collection contains no Models</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">chain</code>
</p>
</td><td valign="top">
<p>This <a id="id160" class="indexterm"/>returns a version of Collection that can have multiple <code class="literal">Underscore</code> methods called on it successively (chained); call the <code class="literal">value</code> method at the end of the chain to get the result of the calls</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pluck</code>
</p>
</td><td valign="top">
<p>This <a id="id161" class="indexterm"/>returns the provided attribute from each Model in the Collection</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">where</code>
</p>
</td><td valign="top">
<p>This <a id="id162" class="indexterm"/>returns all the Models in the Collection that match the provided attribute template</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">findWhere</code>
</p>
</td><td valign="top">
<p>This <a id="id163" class="indexterm"/>returns the first Model found in the Collection that matches the provided attribute template</p>
</td></tr></tbody></table></div></div>
<div class="section" title="Previously mentioned methods" id="aid-1AT9A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec39"/>Previously mentioned methods</h1></div></div></div><p>Several methods in<a id="id164" class="indexterm"/> the preceding list should already be familiar, as we have already explained the <code class="literal">each</code>, <code class="literal">map</code>, <code class="literal">invoke</code>, <code class="literal">pluck</code>, and <code class="literal">reduce</code> methods in <a class="link" title="Chapter 2. Object-Oriented JavaScript with Backbone Classes" href="part0021.xhtml#aid-K0RQ1">Chapter 2</a>, <span class="emphasis"><em>Object-Oriented JavaScript with Backbone Classes</em></span>. All these methods work the same if you call their Underscore version and then pass <code class="literal">Collection.models</code> to them, as shown here:</p><div class="informalexample"><pre class="programlisting">var cats = new Backbone.Collection([ 
    {name: 'Garfield'},    {name: 'Heathcliff'}
]);
cats.each(function(cat) {
    alert(cat.get('name'));
}); // will alert "Garfield", then "Heathcliff"</pre></div></div>
<div class="section" title="Testing methods" id="aid-1BRPS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Testing methods</h1></div></div></div><p>Several of the remaining methods<a id="id165" class="indexterm"/> focus on testing the Collection to see whether it passes a certain type of test. The <code class="literal">contains</code> and <code class="literal">isEmpty</code> methods allow you to check whether the <code class="literal">Collection</code> contains a specified <code class="literal">Model</code> or <code class="literal">Models</code> or whether it contains any models at all, respectively:</p><div class="informalexample"><pre class="programlisting">var warAndPeace = new Backbone.Model();
var books = new Backbone.Collection([warAndPeace]);
books.contains(warAndPeace); // true
books.isEmpty(); // false</pre></div><p>For more advanced testing, you can use the <code class="literal">every</code> and <code class="literal">some</code> methods, which allow you to specify your own test logic. For instance, if you want to know whether any of the books in a Collection <a id="id166" class="indexterm"/>have more than a hundred pages, you can use the <code class="literal">some</code> method, as follows:</p><div class="informalexample"><pre class="programlisting">var books = new Backbone.Collection([
    {pages: 120, title: "Backbone Essentials 4: The Reckoning"},
    {pages: 20, title: "Even More Ideas For Fake Book Titles"}
]);
books.some(function(book)  {
    return book.get('pages') &gt; 100;
}); // true
books.every(function(book)  {
    return book.get('pages') &gt; 100;
}); // false</pre></div></div>
<div class="section" title="Extraction methods" id="aid-1CQAE1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Extraction methods</h1></div></div></div><p>Another way in which<a id="id167" class="indexterm"/> several of the <code class="literal">Underscore</code> methods can be used is by extracting a specific <code class="literal">Model</code> or <code class="literal">Models</code> from a <code class="literal">Collection</code>. The simplest way to do this is with the <code class="literal">where</code> and <code class="literal">findWhere</code> methods, which return all the (or in the case of <code class="literal">findWhere</code>, the first) Models that match a provided attributes object. For example, if you want to extract all the books in a Collection, which have exactly one hundred pages, you can use the <code class="literal">where</code> method, as shown here:</p><div class="informalexample"><pre class="programlisting">var books = new Backbone.Collection([
    { 
        pages: 100,        title: "Backbone Essentials 5: The Essentials Return"
    }, {
        pages: 100,        title: "Backbone Essentials 6: We're Not Done Yet?"
    },{
        pages: 25,        title: "Completely Fake Title"
    } 
]);
var hundredPageBooks = books.where({pages: 100});
//  hundredPageBooks array of all of the books except Completely Fake Title
var firstHundredPageBook = books.findWhere({pages: 100});
firstHundredPageBook; // Backbone Essentials 5: The Essentials Return</pre></div><p>What if we need a more complicated selection? For instance, what if instead of extracting all the books with exactly a hundred pages, we wanted to extract any book with a hundred or more pages? For this sort of extraction, we can use the more powerful <code class="literal">filter</code> method, or its inverse, the <code class="literal">reject</code> method, instead:</p><div class="informalexample"><pre class="programlisting">var books = new Backbone.Collection([
    { 
        pages: 100,        title: "Backbone Essentials 5: The Essentials Return"
    }, {
        pages: 200,        title: "Backbone Essentials 7: How Are We Not Done Yet?"
    }, {
        pages: 25,        title: "Completely Fake Title"
    }
]);
var hundredPageOrMoreBooks = books.filter(function(book)  {
    return book.get('pages') &gt;= 100;
});
hundredPageOrMoreBooks; // again, this will be an array of all books but the last
var hundredPageOrMoreBooks = books.reject(function(book)  {
    return book.get('pages') &lt; 100;
});
hundredPageOrMoreBooks; // this will still be an array of all books but the last</pre></div></div>
<div class="section" title="Ordering methods" id="aid-1DOR01"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec42"/>Ordering methods</h1></div></div></div><p>Finally, we have <code class="literal">toArray</code>, <code class="literal">sortBy</code>, and <code class="literal">groupBy</code>, all of which allow you to get an array of all the <code class="literal">Models</code> stored in<a id="id168" class="indexterm"/> a <code class="literal">Collection</code>. However, while <code class="literal">toArray</code> simply returns all the Models in the Collection, <code class="literal">sortBy</code> returns Models sorted by a provided criteria, and <code class="literal">groupBy</code> returns Models grouped into a further level of arrays. For example, if you want to get all the books in a Collection sorted alphabetically, you can use <code class="literal">sortBy</code>:</p><div class="informalexample"><pre class="programlisting">var books = new Backbone.Collection([
    {title: "Zebras Are Cool"},
    {title: "Alligators Are Also Cool"},
    {title: "Aardvarks!!"}
]);
var notAlphabeticalBooks = books.toArray();
notAlphabeticalBooks;// will contain Zebras, then Alligators, then  Aardvarks
var alphabeticalBooks = books.sortBy('title');
alphabeticalBooks;// will contain Alligators, then Aardvarks, then Zebras</pre></div><p>If, instead, you want to organize them into groups based on the first letter of their title, you can use <code class="literal">groupBy</code>, as follows:</p><div class="informalexample"><pre class="programlisting">var firstLetterGroupedBooks = books.groupBy(function(book) {
    return book.get('title')[0];
});
// will be an array of [Alligators,  Aardvarks], [Zebras]</pre></div></div>
<div class="section" title="Summary" id="aid-1ENBI1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Summary</h1></div></div></div><p>In this chapter, we explored Backbone's <code class="literal">Collection</code> class. You learned how to add and remove Models and <code class="literal">Model</code> attributes, how to use the <code class="literal">on</code> and <code class="literal">off</code> methods to listen for events, how to control the sorting and indexing of Collections, and how to use <code class="literal">fetch</code> and <code class="literal">save</code> to exchange data with a remote server. We also examined the many <code class="literal">Underscore</code> methods of a Collection and how they can be used to realize the full power of a Collection.</p><p>In the next chapter, we'll take a look at Backbone's <code class="literal">View</code> class. Views allow you to render an HTML page, or a subset of one, using the data from the Models and Collections that we've already covered.</p></div></body></html>