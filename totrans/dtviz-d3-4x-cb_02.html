<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 2. Be Selective"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/><span class="koboSpan" id="kobo.1.1">Chapter 2. Be Selective</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Selecting a single element</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Selecting multiple elements</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Iterating through a selection</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Performing subselection</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.7.1">Function chaining</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.8.1">Manipulating raw selection</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec12"/><span class="koboSpan" id="kobo.9.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.10.1">One of the most fundamental tasks that you will need to perform with any data visualization project using D3 is selection. </span><span class="koboSpan" id="kobo.10.2">Selection helps you target certain visual elements on the page. </span><span class="koboSpan" id="kobo.10.3">If you are already familiar with the W3C-standardized CSS selector or other similar selector APIs provided by popular JavaScript libraries, such as jQuery and Zepto.js, then you will find yourself right at home with D3's selection API. </span><span class="koboSpan" id="kobo.10.4">Don't worry if you haven't used the selector API before; this chapter is designed to cover this topic in steps with the help of some very visual recipes. </span><span class="koboSpan" id="kobo.10.5">It will cover pretty much all common use cases for your data visualization needs.</span></p><div class="section" title="Introducing selection"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/><span class="koboSpan" id="kobo.11.1">Introducing selection</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Selector support is standardized by W3C, so all modern web browsers have built-in support for the selector API. </span><span class="koboSpan" id="kobo.12.2">However, the basic W3C selector API has limitations when it comes to Web development, especially in the data visualization realm. </span><span class="koboSpan" id="kobo.12.3">The standard W3C selector API provides only the selector, but not the selection. </span><span class="koboSpan" id="kobo.12.4">What this means is that the selector API helps you to select element(s) in your document; however, to manipulate the selected element(s), you still need to loop through each element. </span><span class="koboSpan" id="kobo.12.5">Consider the following code snippet using the standard selector API:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">var selector = document.querySelectorAll("p"); 
selector.forEach(function(p){ 
    // do something with each element selected 
    console.log(p); 
}); 
</span></pre><p><span class="koboSpan" id="kobo.14.1">The preceding code essentially selects all </span><code class="literal"><span class="koboSpan" id="kobo.15.1">&lt;p&gt;</span></code><span class="koboSpan" id="kobo.16.1"> elements in the document and then iterates through each element to perform some task. </span><span class="koboSpan" id="kobo.16.2">This can obviously get tedious quickly, especially when you have to manipulate many different elements on the page constantly, which is what we usually do in data visualization projects. </span><span class="koboSpan" id="kobo.16.3">This is why D3 introduced its own selection API, making development less of a chore. </span><span class="koboSpan" id="kobo.16.4">In the rest of this chapter, we will cover how D3's selection API works and some of its powerful features.</span></p></div><div class="section" title="CSS3 selector basics"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/><span class="koboSpan" id="kobo.17.1">CSS3 selector basics</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">Before we dive into D3's selection API, some basic introduction on the W3C level-3 selector API is required. </span><span class="koboSpan" id="kobo.18.2">If you are already comfortable with CSS3 selectors, feel free to skip this section. </span><span class="koboSpan" id="kobo.18.3">D3's selection API is built based on the level-3 selector or is more commonly known as CSS3 selector support. </span><span class="koboSpan" id="kobo.18.4">In this section, we plan to go through some of the most common CSS3 selector syntaxes that are required to understand the D3 selection API. </span><span class="koboSpan" id="kobo.18.5">The following list contains some of the most common CSS3 selector conventions you will typically encounter in a data visualization project:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.19.1">#foo</span></code><span class="koboSpan" id="kobo.20.1">: Selects elements with </span><code class="literal"><span class="koboSpan" id="kobo.21.1">foo</span></code><span class="koboSpan" id="kobo.22.1"> as the value of </span><code class="literal"><span class="koboSpan" id="kobo.23.1">id</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.24.1">     &lt;div id="foo"&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.25.1">foo</span></code><span class="koboSpan" id="kobo.26.1">: Selects element </span><code class="literal"><span class="koboSpan" id="kobo.27.1">foo</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.28.1">     &lt;foo&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.29.1">.foo</span></code><span class="koboSpan" id="kobo.30.1">: Selects elements with </span><code class="literal"><span class="koboSpan" id="kobo.31.1">foo</span></code><span class="koboSpan" id="kobo.32.1"> as the value of </span><code class="literal"><span class="koboSpan" id="kobo.33.1">class</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.34.1">     &lt;div class="foo"&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.35.1">[foo=goo]</span></code><span class="koboSpan" id="kobo.36.1">: Selects elements with the </span><code class="literal"><span class="koboSpan" id="kobo.37.1">foo</span></code><span class="koboSpan" id="kobo.38.1"> attribute value and sets it to </span><code class="literal"><span class="koboSpan" id="kobo.39.1">goo</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.40.1">     &lt;div foo="goo"&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.41.1">foo goo</span></code><span class="koboSpan" id="kobo.42.1">: Selects the </span><code class="literal"><span class="koboSpan" id="kobo.43.1">goo</span></code><span class="koboSpan" id="kobo.44.1"> element inside the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">foo</span></code><span class="koboSpan" id="kobo.46.1"> element</span><pre class="programlisting"><span class="koboSpan" id="kobo.47.1">     &lt;foo&gt;&lt;goo&gt;&lt;/foo&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.48.1">foo#goo</span></code><span class="koboSpan" id="kobo.49.1">: Selects the </span><code class="literal"><span class="koboSpan" id="kobo.50.1">foo</span></code><span class="koboSpan" id="kobo.51.1"> element with </span><code class="literal"><span class="koboSpan" id="kobo.52.1">goo</span></code><span class="koboSpan" id="kobo.53.1"> as the value of </span><code class="literal"><span class="koboSpan" id="kobo.54.1">id</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.55.1">     &lt;foo id="goo"&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.56.1">foo.goo</span></code><span class="koboSpan" id="kobo.57.1">: Selects the </span><code class="literal"><span class="koboSpan" id="kobo.58.1">foo</span></code><span class="koboSpan" id="kobo.59.1"> element with </span><code class="literal"><span class="koboSpan" id="kobo.60.1">goo</span></code><span class="koboSpan" id="kobo.61.1"> as the value of </span><code class="literal"><span class="koboSpan" id="kobo.62.1">class</span></code><pre class="programlisting"><span class="koboSpan" id="kobo.63.1">     &lt;foo class="goo"&gt; 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.64.1">foo:first-child</span></code><span class="koboSpan" id="kobo.65.1">: Selects the first child of the </span><code class="literal"><span class="koboSpan" id="kobo.66.1">foo</span></code><span class="koboSpan" id="kobo.67.1"> elements</span><pre class="programlisting"><span class="koboSpan" id="kobo.68.1">     &lt;foo&gt; // &lt;-- this one 
     &lt;foo&gt; 
     &lt;foo&gt;  
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.69.1">foo:nth-child(n)</span></code><span class="koboSpan" id="kobo.70.1">: Selects the </span><code class="literal"><span class="koboSpan" id="kobo.71.1">n</span></code><span class="koboSpan" id="kobo.72.1">th child of the </span><code class="literal"><span class="koboSpan" id="kobo.73.1">foo</span></code><span class="koboSpan" id="kobo.74.1"> elements (</span><code class="literal"><span class="koboSpan" id="kobo.75.1">n</span></code><span class="koboSpan" id="kobo.76.1"> is one-based, starting at 1 for the first child)</span><pre class="programlisting"><span class="koboSpan" id="kobo.77.1">     &lt;foo&gt; 
     &lt;foo&gt; // &lt;-- foo:nth-child(2) 
     &lt;foo&gt; // &lt;-- foo:nth-child(3) 
</span></pre></li></ul></div><p><span class="koboSpan" id="kobo.78.1">CSS3 selector is a pretty complex topic. </span><span class="koboSpan" id="kobo.78.2">Here, we have only listed some of the most common selectors that you will need to understand and that you need to be effective when working with D3. </span><span class="koboSpan" id="kobo.78.3">For more information on this topic, please visit the W3C level-3 selector API document at </span><a class="ulink" href="http://www.w3.org/TR/css3-selectors/"><span class="koboSpan" id="kobo.79.1">http://www.w3.org/TR/css3-selectors/
</span></a><span class="koboSpan" id="kobo.80.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/><span class="koboSpan" id="kobo.81.1">Note</span></h3><p><span class="koboSpan" id="kobo.82.1">If you are targeting an older browser that does not support selector natively, you can include Sizzle before D3 for backward compatibility. </span><span class="koboSpan" id="kobo.82.2">You can find Sizzle at </span><a class="ulink" href="http://sizzlejs.com/"><span class="koboSpan" id="kobo.83.1">http://sizzlejs.com/
</span></a><span class="koboSpan" id="kobo.84.1">.</span></p><p><span class="koboSpan" id="kobo.85.1">
Currently, the next-generation selector API level-4 is in the draft stage with W3C. </span><span class="koboSpan" id="kobo.85.2">You can have a peek at what it has to offer and its current draft at </span><a class="ulink" href="https://drafts.csswg.org/selectors-4/"><span class="koboSpan" id="kobo.86.1">https://drafts.csswg.org/selectors-4/
</span></a><span class="koboSpan" id="kobo.87.1">.</span></p><p><span class="koboSpan" id="kobo.88.1">Major browser vendors have already started implementing some of the level-4 selectors; if you are interested to find out the level of support in your browser, try out this handy website: 
</span><a class="ulink" href="http://css4-selectors.com/browser-selector-test/"><span class="koboSpan" id="kobo.89.1">http://css4-selectors.com/browser-selector-test/
</span></a><span class="koboSpan" id="kobo.90.1">.</span></p></div></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Selecting a single element"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/><span class="koboSpan" id="kobo.1.1">Selecting a single element</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">It is very common that at times you will need to select a single element on a page to perform some visual manipulation. </span><span class="koboSpan" id="kobo.2.2">This recipe will show you how to perform a targeted single element selection in D3 using a CSS selector.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/single-selection.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/single-selection.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Let's select something (a </span><code class="literal"><span class="koboSpan" id="kobo.9.1">paragraph</span></code><span class="koboSpan" id="kobo.10.1"> element perhaps) and produce the classic </span><span class="emphasis"><em><span class="koboSpan" id="kobo.11.1">hello world</span></em></span><span class="koboSpan" id="kobo.12.1"> on screen.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">&lt;p id="target"&gt;&lt;/p&gt; &lt;!-- A --&gt; 
 
&lt;script type="text/javascript"&gt; 
    d3.select("p#target") // &lt;-- B 
    .text("Hello world!"); // &lt;-- C 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.14.1">This recipe simply produces text </span><span class="strong"><strong><span class="koboSpan" id="kobo.15.1">Hello world!</span></strong></span><span class="koboSpan" id="kobo.16.1"> on your screen.</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/><span class="koboSpan" id="kobo.17.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">The </span><code class="literal"><span class="koboSpan" id="kobo.19.1">d3.select</span></code><span class="koboSpan" id="kobo.20.1"> command is used to perform a single-element selection in D3. </span><span class="koboSpan" id="kobo.20.2">This method accepts a string that represents a valid CSS3 selector or an element object if you already have a reference to the element you want to select. </span><span class="koboSpan" id="kobo.20.3">The </span><code class="literal"><span class="koboSpan" id="kobo.21.1">d3.select</span></code><span class="koboSpan" id="kobo.22.1"> command returns a D3 selection object on which you can chain modifier functions to manipulate the attribute, content, or inner HTML of this element.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/><span class="koboSpan" id="kobo.23.1">Note</span></h3><p><span class="koboSpan" id="kobo.24.1">More than one element can be selected using the selector, provided only the first element is returned in the selection.</span></p></div></div><p><span class="koboSpan" id="kobo.25.1">In this example, we simply select the paragraph element with </span><code class="literal"><span class="koboSpan" id="kobo.26.1">target</span></code><span class="koboSpan" id="kobo.27.1"> as the value of </span><code class="literal"><span class="koboSpan" id="kobo.28.1">id</span></code><span class="koboSpan" id="kobo.29.1"> at line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">B</span></code><span class="koboSpan" id="kobo.31.1">, and then set its textual content to </span><code class="literal"><span class="koboSpan" id="kobo.32.1">Hello world!</span></code><span class="koboSpan" id="kobo.33.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.34.1">C</span></code><span class="koboSpan" id="kobo.35.1">. </span><span class="koboSpan" id="kobo.35.2">All D3 selections support a set of standard modifier functions. </span><span class="koboSpan" id="kobo.35.3">The </span><code class="literal"><span class="koboSpan" id="kobo.36.1">text</span></code><span class="koboSpan" id="kobo.37.1"> function we have shown in this particular example is one of them. </span><span class="koboSpan" id="kobo.37.2">The following are some of the most common modifier functions you will encounter throughout this book:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.38.1">selection.attr</span></code><span class="koboSpan" id="kobo.39.1">: This function allows you to retrieve or modify a given attribute on the selected element(s):</span><pre class="programlisting"><span class="koboSpan" id="kobo.40.1">     // set foo attribute to goo on p element 
     d3.select("p").attr("foo", "goo");  
     // get foo attribute on p element 
     d3.select("p").attr("foo"); 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.41.1">selection.classed</span></code><span class="koboSpan" id="kobo.42.1">: This function allows you to add or remove CSS classes on the selected element(s):</span><pre class="programlisting"><span class="koboSpan" id="kobo.43.1">     // test to see if p element has CSS class goo 
     d3.select("p").classed("goo"); 
     // add CSS class goo to p element 
     d3.select("p").classed("goo", true); 
     // remove CSS class goo from p element. </span><span class="koboSpan" id="kobo.43.2">classed function 
     // also accepts a function as the value so the decision  
     // of adding and removing can be made dynamically 
     d3.select("p").classed("goo", function(){return false;}); 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.44.1">selection.style</span></code><span class="koboSpan" id="kobo.45.1">: This function lets you set the CSS style with a specific name to the specific value on the selected element(s):</span><pre class="programlisting"><span class="koboSpan" id="kobo.46.1">     // get p element's style for font-size 
     d3.select("p").style("font-size"); 
     // set font-size style for p to 10px 
     d3.select("p").style("font-size", "10px"); 
     // set font-size style for p to the result of some  
     // calculation. </span><span class="koboSpan" id="kobo.46.2">style function also accepts a function as  
     // the value can be produced dynamically 
     d3.select("p").style("font-size", function(){  
         return parseFloat(d3.select(this).style('font-size')) + 
             10 + 'px'; 
     }); 
</span></pre></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.47.1">Variable </span><code class="literal"><span class="koboSpan" id="kobo.48.1">this</span></code><span class="koboSpan" id="kobo.49.1"> in the preceding anonymous function is the DOM element object for the selected element </span><code class="literal"><span class="koboSpan" id="kobo.50.1">&lt;p&gt;</span></code><span class="koboSpan" id="kobo.51.1">; therefore, it needs to be wrapped in </span><code class="literal"><span class="koboSpan" id="kobo.52.1">d3.select</span></code><span class="koboSpan" id="kobo.53.1"> again in order to access its </span><code class="literal"><span class="koboSpan" id="kobo.54.1">style</span></code><span class="koboSpan" id="kobo.55.1"> attribute.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.56.1">selection.text</span></code><span class="koboSpan" id="kobo.57.1">: This function allows you to access and set the text content of the selected element(s) as follows:</span><pre class="programlisting"><span class="koboSpan" id="kobo.58.1">     // get p element's text content 
     d3.select("p").text(); 
     // set p element's text content to "Hello" 
     d3.select("p").text("Hello"); 
     // text function also accepts a function as the value,  
     // thus allowing setting text content to some dynamically  
     // produced content 
     d3.select("p").text(function(){ 
       return Date(); 
     }); 
</span></pre></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.59.1">selection.html</span></code><span class="koboSpan" id="kobo.60.1">: This function lets you modify the element's inner HTML content as shown in the following:</span><pre class="programlisting"><span class="koboSpan" id="kobo.61.1">     // get p element's inner html content 
     d3.select("p").html(); 
     // set p element's inner html content to "&lt;b&gt;Hello&lt;/b&gt;" 
     d3.select("p").html("&lt;b&gt;Hello&lt;/b&gt;"); 
     // html function also accepts a function as the value,  
     // thus allowing setting html content to some dynamically  
     // produced message 
     d3.select("p").html(function(){ 
       return d3.select(this).text() +  
         " &lt;span style='color: blue;'&gt;D3.js&lt;/span&gt;"; 
     }); 
</span></pre></li></ul></div><p><span class="koboSpan" id="kobo.62.1">These modifier functions work on both single-element and multi-element selection results. </span><span class="koboSpan" id="kobo.62.2">When applied to multi-element selections, these modifications will be applied to each and every selected element. </span><span class="koboSpan" id="kobo.62.3">We will see them in action in other, more complex  recipes that will be covered later in this chapter.</span></p><p><span class="koboSpan" id="kobo.63.1">When a function is used as a value in these modifier functions, there are actually some built-in parameters passed to these functions to enable data-driven calculation. </span><span class="koboSpan" id="kobo.63.2">This data-driven approach is what gives D3 its power and its name (</span><span class="strong"><strong><span class="koboSpan" id="kobo.64.1">Data-Driven Document</span></strong></span><span class="koboSpan" id="kobo.65.1">) and will be discussed in detail in the next chapter.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Selecting multiple elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/><span class="koboSpan" id="kobo.1.1">Selecting multiple elements</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Often selecting a single element is not good enough, but rather you want to apply a certain change to a set of elements on the page simultaneously. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will play with the D3 multi-element selector and its selection API.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/multiple-selection.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/multiple-selection.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">This is what the </span><code class="literal"><span class="koboSpan" id="kobo.9.1">d3.selectAll</span></code><span class="koboSpan" id="kobo.10.1"> function is designed for. </span><span class="koboSpan" id="kobo.10.2">In the following code snippet, we will select three different </span><code class="literal"><span class="koboSpan" id="kobo.11.1">div</span></code><span class="koboSpan" id="kobo.12.1"> elements and enhance them with some CSS classes:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">&lt;div&gt;&lt;/div&gt; 
&lt;div&gt;&lt;/div&gt; 
&lt;div&gt;&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    d3.selectAll("div") // &lt;-- A 
    .attr("class", "red box"); // &lt;-- B 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.14.1">This code snippet produces the following visual:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.15.1"><img src="graphics/image_02_001.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.16.1">Multi-element selection</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/><span class="koboSpan" id="kobo.17.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">First thing you probably will notice in this example is how similar the usage of D3 selection API is when compared to the single-element version. </span><span class="koboSpan" id="kobo.18.2">This is one of the powerful design choices of the D3 selection API. </span><span class="koboSpan" id="kobo.18.3">No matter how many elements you target and manipulate, whether one or many, the modifier functions are exactly the same. </span><span class="koboSpan" id="kobo.18.4">All the modifier functions we mentioned in the previous section can be applied directly to multi-element selection; in other words, D3 selection is set-based.</span></p><p><span class="koboSpan" id="kobo.19.1">Now, with that being said, let's take a closer look at the code example shown in this section, though it is generally pretty simple and self-descriptive. </span><span class="koboSpan" id="kobo.19.2">At line </span><code class="literal"><span class="koboSpan" id="kobo.20.1">A</span></code><span class="koboSpan" id="kobo.21.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">d3.selectAll</span></code><span class="koboSpan" id="kobo.23.1"> function is used to select all the </span><code class="literal"><span class="koboSpan" id="kobo.24.1">div</span></code><span class="koboSpan" id="kobo.25.1"> elements on the page. </span><span class="koboSpan" id="kobo.25.2">The return of this function call is a D3 selection object that contains all the three </span><code class="literal"><span class="koboSpan" id="kobo.26.1">div</span></code><span class="koboSpan" id="kobo.27.1"> elements. </span><span class="koboSpan" id="kobo.27.2">Immediately after that, on line </span><code class="literal"><span class="koboSpan" id="kobo.28.1">B</span></code><span class="koboSpan" id="kobo.29.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.30.1">attr</span></code><span class="koboSpan" id="kobo.31.1"> function was called on this selection to set the </span><code class="literal"><span class="koboSpan" id="kobo.32.1">class</span></code><span class="koboSpan" id="kobo.33.1"> attribute to </span><code class="literal"><span class="koboSpan" id="kobo.34.1">red box</span></code><span class="koboSpan" id="kobo.35.1"> for all three </span><code class="literal"><span class="koboSpan" id="kobo.36.1">div</span></code><span class="koboSpan" id="kobo.37.1"> elements. </span><span class="koboSpan" id="kobo.37.2">As shown in this example, the selection and manipulation code are very generic, and will not change even if now we have more than three </span><code class="literal"><span class="koboSpan" id="kobo.38.1">div</span></code><span class="koboSpan" id="kobo.39.1"> elements on the page. </span><span class="koboSpan" id="kobo.39.2">This seems to be an insignificant convenience for now, but in later chapters, we will show how this convenience can make your visualization code simpler and easier to maintain.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Iterating through a selection"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/><span class="koboSpan" id="kobo.1.1">Iterating through a selection</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Sometimes it is handy to be able to iterate through each element within a selection and modify each element differently according to their position. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will show you how this can be achieved using D3 selection iteration API.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/selection-iteration.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/selection-iteration.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">D3 selection object provides a simple iterator interface to perform iteration in a similar fashion to how you will iterate through a JavaScript array. </span><span class="koboSpan" id="kobo.8.2">In this example, we will iterate through the three selected </span><code class="literal"><span class="koboSpan" id="kobo.9.1">div</span></code><span class="koboSpan" id="kobo.10.1"> elements we worked with in the previous recipe and annotate them with an index number as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.11.1">&lt;div&gt;&lt;/div&gt; 
&lt;div&gt;&lt;/div&gt; 
&lt;div&gt;&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
d3.selectAll("div") // &lt;-- A 
            .attr("class", "red box") // &lt;-- B 
            .each(function (d, i) { // &lt;-- C 
                d3.select(this).append("h1").text(i); // &lt;-- D 
            }); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.12.1">The preceding code snippet produces the following visual:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.13.1"><img src="graphics/image_02_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.14.1">Selection iteration</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/><span class="koboSpan" id="kobo.15.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">This example is built on top of what we have already seen in the previous section. </span><span class="koboSpan" id="kobo.16.2">In addition to selecting all the </span><code class="literal"><span class="koboSpan" id="kobo.17.1">div</span></code><span class="koboSpan" id="kobo.18.1"> elements on the page at line </span><code class="literal"><span class="koboSpan" id="kobo.19.1">A</span></code><span class="koboSpan" id="kobo.20.1"> and setting their class attributes at line </span><code class="literal"><span class="koboSpan" id="kobo.21.1">B</span></code><span class="koboSpan" id="kobo.22.1">, in this example, we will call the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">each</span></code><span class="koboSpan" id="kobo.24.1"> function on the selection to demonstrate how we can iterate through a multi-element selection and process each element, respectively:</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/><span class="koboSpan" id="kobo.25.1">Note</span></h3><p><span class="koboSpan" id="kobo.26.1">This form of calling a function on another function's return is called </span><span class="strong"><strong><span class="koboSpan" id="kobo.27.1">Function Chaining</span></strong></span><span class="koboSpan" id="kobo.28.1">. </span><span class="koboSpan" id="kobo.28.2">If you are unfamiliar with this kind of invocation pattern, please refer to </span><a class="link" href="ch01.html" title="Chapter 1. Getting Started with D3.js"><span class="koboSpan" id="kobo.29.1">Chapter 1</span></a><span class="koboSpan" id="kobo.30.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">Getting Started with D3.js</span></em></span><span class="koboSpan" id="kobo.32.1">, where the topic was explained.</span></p></div></div><p><span class="koboSpan" id="kobo.33.1">The following list explains the </span><code class="literal"><span class="koboSpan" id="kobo.34.1">select</span></code>
<code class="literal"><span class="koboSpan" id="kobo.35.1">each</span></code><span class="koboSpan" id="kobo.36.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.37.1">append</span></code><span class="koboSpan" id="kobo.38.1"> functions:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.39.1">selection.each(function)</span></code><span class="koboSpan" id="kobo.40.1">: The </span><code class="literal"><span class="koboSpan" id="kobo.41.1">each</span></code><span class="koboSpan" id="kobo.42.1"> function takes an iterator function as its parameter. </span><span class="koboSpan" id="kobo.42.2">The given iterator function can receive two optional parameters </span><code class="literal"><span class="koboSpan" id="kobo.43.1">d</span></code><span class="koboSpan" id="kobo.44.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.45.1">i</span></code><span class="koboSpan" id="kobo.46.1"> with one more hidden parameter passed in as the </span><code class="literal"><span class="koboSpan" id="kobo.47.1">this</span></code><span class="koboSpan" id="kobo.48.1"> reference, which points to the current DOM element object. </span><span class="koboSpan" id="kobo.48.2">The first parameter </span><code class="literal"><span class="koboSpan" id="kobo.49.1">d</span></code><span class="koboSpan" id="kobo.50.1"> represents the datum bound to this particular element (if this sounds confusing to you, don't worry, we will cover data binding in depth in the next chapter). </span><span class="koboSpan" id="kobo.50.2">The second parameter </span><code class="literal"><span class="koboSpan" id="kobo.51.1">i</span></code><span class="koboSpan" id="kobo.52.1"> is the index number for the current element object being iterated through. </span><span class="koboSpan" id="kobo.52.2">This index is zero-based, meaning it starts from zero and increments each time a new element is encountered.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.53.1">selection.append(tagName)</span></code><span class="koboSpan" id="kobo.54.1">: Another new function introduced in this example is the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">append</span></code><span class="koboSpan" id="kobo.56.1"> function. </span><span class="koboSpan" id="kobo.56.2">This function creates a new element with the given element name and appends it as the last child of each element in the current selection. </span><span class="koboSpan" id="kobo.56.3">It returns a new selection containing the newly appended element. </span><span class="koboSpan" id="kobo.56.4">Now, with this knowledge, let's take a closer look at the code example in this recipe:</span></li></ul></div><pre class="programlisting"><span class="koboSpan" id="kobo.57.1">     d3.selectAll("div") // &lt;-- A 
         .attr("class", "red box") // &lt;-- B 
         .each(function (d, i) { // &lt;-- C 
             d3.select(this).append("h1").text(i); // &lt;-- D 
         }); 
</span></pre><p><span class="koboSpan" id="kobo.58.1">The iterator function is defined on line </span><code class="literal"><span class="koboSpan" id="kobo.59.1">C</span></code><span class="koboSpan" id="kobo.60.1"> with both </span><code class="literal"><span class="koboSpan" id="kobo.61.1">d</span></code><span class="koboSpan" id="kobo.62.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.63.1">i</span></code><span class="koboSpan" id="kobo.64.1"> parameters. </span><span class="koboSpan" id="kobo.64.2">Line </span><code class="literal"><span class="koboSpan" id="kobo.65.1">D</span></code><span class="koboSpan" id="kobo.66.1"> is a little bit more interesting. </span><span class="koboSpan" id="kobo.66.2">At the beginning of line </span><code class="literal"><span class="koboSpan" id="kobo.67.1">D</span></code><span class="koboSpan" id="kobo.68.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.69.1">this</span></code><span class="koboSpan" id="kobo.70.1"> reference is wrapped by the </span><code class="literal"><span class="koboSpan" id="kobo.71.1">d3.select</span></code><span class="koboSpan" id="kobo.72.1"> function. </span><span class="koboSpan" id="kobo.72.2">This wrapping essentially produces a single-element selection containing the current DOM element, which the </span><code class="literal"><span class="koboSpan" id="kobo.73.1">this</span></code><span class="koboSpan" id="kobo.74.1"> variable represents. </span><span class="koboSpan" id="kobo.74.2">Once wrapped, the standard D3 selection manipulation API becomes available on </span><code class="literal"><span class="koboSpan" id="kobo.75.1">d3.select(this)</span></code><span class="koboSpan" id="kobo.76.1">. </span><span class="koboSpan" id="kobo.76.2">After that, the </span><code class="literal"><span class="koboSpan" id="kobo.77.1">append("h1")</span></code><span class="koboSpan" id="kobo.78.1"> function is called on the current element selection appending a newly created </span><code class="literal"><span class="koboSpan" id="kobo.79.1">h1</span></code><span class="koboSpan" id="kobo.80.1"> element to the current element. </span><span class="koboSpan" id="kobo.80.2">Afterward, it simply sets the textual content of this newly created </span><code class="literal"><span class="koboSpan" id="kobo.81.1">h1</span></code><span class="koboSpan" id="kobo.82.1"> element to the index number of the current element. </span><span class="koboSpan" id="kobo.82.2">This produces the visual of numbered boxes as shown in this recipe as illustrated in the screen capture. </span><span class="koboSpan" id="kobo.82.3">Again, you should notice that the index starts from 0 and increments 1 for each element.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/><span class="koboSpan" id="kobo.83.1">Note</span></h3><p><span class="koboSpan" id="kobo.84.1">The DOM element object itself has a very rich interface. </span><span class="koboSpan" id="kobo.84.2">If you are interested to know more about what it can do in an iterator function, please refer to the DOM element API at </span><a class="ulink" href="https://developer.mozilla.org/en-US/docs/Web/API/element"><span class="koboSpan" id="kobo.85.1">https://developer.mozilla.org/en-US/docs/Web/API/element
</span></a><span class="koboSpan" id="kobo.86.1">.</span></p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Performing subselection"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/><span class="koboSpan" id="kobo.1.1">Performing subselection</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">It is quite common that you will need to perform scoped selection when working on visualization. </span><span class="koboSpan" id="kobo.2.2">For example, selecting all </span><code class="literal"><span class="koboSpan" id="kobo.3.1">div</span></code><span class="koboSpan" id="kobo.4.1"> elements within a particular </span><code class="literal"><span class="koboSpan" id="kobo.5.1">section</span></code><span class="koboSpan" id="kobo.6.1"> element is one such use case of scoped selection. </span><span class="koboSpan" id="kobo.6.2">In this recipe, we will demonstrate how this can be achieved with different approaches and their advantages and disadvantages.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/sub-selection.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/sub-selection.html
</span></a><span class="koboSpan" id="kobo.10.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/><span class="koboSpan" id="kobo.11.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">The following code example selects two different </span><code class="literal"><span class="koboSpan" id="kobo.13.1">div</span></code><span class="koboSpan" id="kobo.14.1"> elements using two different styles of subselection supported by D3:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.15.1">&lt;section id="section1"&gt; 
    &lt;div&gt; 
        &lt;p&gt;blue box&lt;/p&gt; 
    &lt;/div&gt; 
&lt;/section&gt; 
&lt;section id="section2"&gt; 
    &lt;div&gt; 
        &lt;p&gt;red box&lt;/p&gt; 
    &lt;/div&gt; 
&lt;/section&gt; 
 
&lt;script type="text/javascript"&gt; 
    d3.select("#section1 &gt; div") // &lt;-- A 
            .attr("class", "blue box"); 
 
    d3.select("#section2") // &lt;-- B 
            .select("div") // &lt;-- C 
            .attr("class", "red box");  
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.16.1">This code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.17.1"><img src="graphics/image_02_003.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.18.1">Subselection</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/><span class="koboSpan" id="kobo.19.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.20.1">Though it produces the same visual effect, this example demonstrates two very different subselection techniques. </span><span class="koboSpan" id="kobo.20.2">We will discuss them separately here so you can understand their pros and cons as well as when to use one versus the other:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.21.1">Selector level-3 combinators:</span></strong></span><span class="koboSpan" id="kobo.22.1"> On line </span><code class="literal"><span class="koboSpan" id="kobo.23.1">A</span></code><span class="koboSpan" id="kobo.24.1">, </span><code class="literal"><span class="koboSpan" id="kobo.25.1">d3.select</span></code><span class="koboSpan" id="kobo.26.1"> is used with a special-looking string, which consists of one tag name connected with another one using a greater-than sign (U+003E, &gt;). </span><span class="koboSpan" id="kobo.26.2">This syntax is called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.27.1">combinators</span></em></span><span class="koboSpan" id="kobo.28.1"> (the greater-than sign here indicates it is a child combinator). </span><span class="koboSpan" id="kobo.28.2">Level-3 selector supports a few different kinds of structural combinators. </span><span class="koboSpan" id="kobo.28.3">Here, we will give a quick introduction to the most common ones.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.29.1">The descendant combinator</span></strong></span><span class="koboSpan" id="kobo.30.1">: This combinator has the syntax just like </span><code class="literal"><span class="koboSpan" id="kobo.31.1">selector selector</span></code><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">The descendant combinator, as suggested by its name, is used to describe a loose parent-child relationship between two selections. </span><span class="koboSpan" id="kobo.32.3">The reason why it is called a loose parent-child relationship is that the descendant combinatory does not care if the second selection is a child or a grandchild or a great-grandchild of the parent selection. </span><span class="koboSpan" id="kobo.32.4">Let's take a look at some examples to illustrate this loose relationship concept:</span><pre class="programlisting"><span class="koboSpan" id="kobo.33.1">     &lt;div&gt; 
     &lt;span&gt; 
     The quick &lt;em&gt;red&lt;/em&gt; fox jumps over the lazy brown dog 
        &lt;/span&gt; 
     &lt;/div&gt; 
</span></pre><p><span class="koboSpan" id="kobo.34.1">If we use the following selector:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.35.1">        div em 
</span></pre><p><span class="koboSpan" id="kobo.36.1">It will select the </span><code class="literal"><span class="koboSpan" id="kobo.37.1">em</span></code><span class="koboSpan" id="kobo.38.1"> element since </span><code class="literal"><span class="koboSpan" id="kobo.39.1">div</span></code><span class="koboSpan" id="kobo.40.1"> is the ancestor of the </span><code class="literal"><span class="koboSpan" id="kobo.41.1">em</span></code><span class="koboSpan" id="kobo.42.1"> element and </span><code class="literal"><span class="koboSpan" id="kobo.43.1">em</span></code><span class="koboSpan" id="kobo.44.1"> is a descendent of the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">div</span></code><span class="koboSpan" id="kobo.46.1"> element.</span></p></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.47.1">Child combinator</span></strong></span><span class="koboSpan" id="kobo.48.1">: This combinator has the syntax such as </span><code class="literal"><span class="koboSpan" id="kobo.49.1">selector &gt; selector</span></code><span class="koboSpan" id="kobo.50.1">. </span><span class="koboSpan" id="kobo.50.2">The child combinator offers a more restrictive way to describe a parent-child relationship between two elements. </span><span class="koboSpan" id="kobo.50.3">A child combinator is defined using a greater-than sign (U+003E, &gt;) character separating the two selectors, as follows:</span><pre class="programlisting"><span class="koboSpan" id="kobo.51.1">         span &gt; em</span></pre><p><span class="koboSpan" id="kobo.52.1">It will select the </span><code class="literal"><span class="koboSpan" id="kobo.53.1">em</span></code><span class="koboSpan" id="kobo.54.1"> element since </span><code class="literal"><span class="koboSpan" id="kobo.55.1">em</span></code><span class="koboSpan" id="kobo.56.1"> is a direct child of the </span><code class="literal"><span class="koboSpan" id="kobo.57.1">span</span></code><span class="koboSpan" id="kobo.58.1"> element in our example. </span><span class="koboSpan" id="kobo.58.2">The selector </span><code class="literal"><span class="koboSpan" id="kobo.59.1">div &gt; em</span></code><span class="koboSpan" id="kobo.60.1"> will not produce any valid selection since </span><code class="literal"><span class="koboSpan" id="kobo.61.1">em</span></code><span class="koboSpan" id="kobo.62.1"> is not a direct child of the </span><code class="literal"><span class="koboSpan" id="kobo.63.1">div</span></code><span class="koboSpan" id="kobo.64.1"> element.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/><span class="koboSpan" id="kobo.65.1">Note</span></h3><p><span class="koboSpan" id="kobo.66.1">The level-3 selector also supports sibling combinators; however, since it is less common, we will not cover it here; interested readers can refer to W3C level-3 selector documentation at </span><a class="ulink" href="http://www.w3.org/TR/css3-selectors/#sibling-combinators"><span class="koboSpan" id="kobo.67.1">http://www.w3.org/TR/css3-selectors/#sibling-combinators
</span></a><span class="koboSpan" id="kobo.68.1">.
</span><span class="koboSpan" id="kobo.68.2">The W3C level-4 selector offers some interesting additional combinators, that is, following-sibling and reference combinators that can yield some very powerful target selection capability; refer to </span><a class="ulink" href="https://drafts.csswg.org/selectors-4/#combinators"><span class="koboSpan" id="kobo.69.1">https://drafts.csswg.org/selectors-4/#combinators
</span></a><span class="koboSpan" id="kobo.70.1"> for more details.</span></p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.71.1">The D3 nested subselection</span></strong></span><span class="koboSpan" id="kobo.72.1">: On lines </span><code class="literal"><span class="koboSpan" id="kobo.73.1">B</span></code><span class="koboSpan" id="kobo.74.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.75.1">C</span></code><span class="koboSpan" id="kobo.76.1">, a different kind of subselection technique was used. </span><span class="koboSpan" id="kobo.76.2">In this case, a simple D3 selection was made first on line </span><code class="literal"><span class="koboSpan" id="kobo.77.1">B</span></code><span class="koboSpan" id="kobo.78.1"> by selecting the </span><code class="literal"><span class="koboSpan" id="kobo.79.1">section #section2</span></code><span class="koboSpan" id="kobo.80.1"> element. </span><span class="koboSpan" id="kobo.80.2">Immediately afterward, another </span><code class="literal"><span class="koboSpan" id="kobo.81.1">select</span></code><span class="koboSpan" id="kobo.82.1"> was chained to select a </span><code class="literal"><span class="koboSpan" id="kobo.83.1">div</span></code><span class="koboSpan" id="kobo.84.1"> element on line </span><code class="literal"><span class="koboSpan" id="kobo.85.1">C</span></code><span class="koboSpan" id="kobo.86.1">. </span><span class="koboSpan" id="kobo.86.2">This kind of nested selection defines a scoped selection. </span><span class="koboSpan" id="kobo.86.3">In plain English, this basically means to select a </span><code class="literal"><span class="koboSpan" id="kobo.87.1">div</span></code><span class="koboSpan" id="kobo.88.1"> element that is nested under </span><code class="literal"><span class="koboSpan" id="kobo.89.1">#section2</span></code><span class="koboSpan" id="kobo.90.1">. </span><span class="koboSpan" id="kobo.90.2">In semantics, this is essentially the same as using a descendant combinator </span><code class="literal"><span class="koboSpan" id="kobo.91.1">#section2 div</span></code><span class="koboSpan" id="kobo.92.1">. </span><span class="koboSpan" id="kobo.92.2">However, the advantage of this form of subselection is that since the parent element is separately selected, it allows you to handle the parent element before selecting the child element. </span><span class="koboSpan" id="kobo.92.3">To demonstrate this, let's take a look at the following code snippet:</span><pre class="programlisting"><span class="koboSpan" id="kobo.93.1">     d3.select("#section2") // &lt;-- B 
         .style("font-size", "2em") // &lt;-- B-1 
         .select("div") // &lt;-- C 
         .attr("class", "red box"); 
</span></pre><p><span class="koboSpan" id="kobo.94.1">As shown in the preceding code snippet, you can see that before we select the </span><code class="literal"><span class="koboSpan" id="kobo.95.1">div</span></code><span class="koboSpan" id="kobo.96.1"> element, we can apply a modifier function to </span><code class="literal"><span class="koboSpan" id="kobo.97.1">#section2</span></code><span class="koboSpan" id="kobo.98.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.99.1">B-1</span></code><span class="koboSpan" id="kobo.100.1">. </span><span class="koboSpan" id="kobo.100.2">This flexibility will be further explored in the next section.</span></p></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Function chaining"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/><span class="koboSpan" id="kobo.1.1">Function chaining</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">As we have seen so far, the D3 API is completely designed around the idea of function chaining. </span><span class="koboSpan" id="kobo.2.2">Therefore, it forms a DSL for building HTML/SVG elements dynamically. </span><span class="koboSpan" id="kobo.2.3">In this code example, we will take a look at how the entire body structure of the previous example can be constructed using D3 alone.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/><span class="koboSpan" id="kobo.3.1">Note</span></h3><p><span class="koboSpan" id="kobo.4.1">If DSL is a new concept for you, I highly recommend checking out this excellent explanation on DSL by </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">Martin Fowler</span></em></span><span class="koboSpan" id="kobo.6.1"> in the form of an excerpt from his book </span><span class="emphasis"><em><span class="koboSpan" id="kobo.7.1">Domain-Specific Languages</span></em></span><span class="koboSpan" id="kobo.8.1">. </span><span class="koboSpan" id="kobo.8.2">The excerpt can be found at </span><a class="ulink" href="http://www.informit.com/articles/article.aspx?p=1592379"><span class="koboSpan" id="kobo.9.1">http://www.informit.com/articles/article.aspx?p=1592379
</span></a><span class="koboSpan" id="kobo.10.1">.</span></p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/><span class="koboSpan" id="kobo.11.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/function-chain.html"><span class="koboSpan" id="kobo.13.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/function-chain.html
</span></a><span class="koboSpan" id="kobo.14.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/><span class="koboSpan" id="kobo.15.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">Let's take a look at how a function chain can be used to produce concise and readable code that produces dynamic visual content:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.17.1">&lt;script type="text/javascript"&gt; 
  var body = d3.select("body"); // &lt;-- A 
 
  body.append("section") // &lt;-- B 
      .attr("id", "section1") // &lt;-- C 
    .append("div") // &lt;-- D 
      .attr("class", "blue box") // &lt;-- E 
    .append("p") // &lt;-- F 
      .text("dynamic blue box"); // &lt;-- G 
 
  body.append("section") 
      .attr("id", "section2") 
    .append("div") 
      .attr("class", "red box") 
    .append("p") 
      .text("dynamic red box"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.18.1">This code generates the following visual output (similar to what we saw in the previous chapter):</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.19.1"><img src="graphics/image_02_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.20.1">Function chain</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/><span class="koboSpan" id="kobo.21.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.22.1">Despite the visual similarity to the previous example, the construction process of the DOM elements is significantly different in this example. </span><span class="koboSpan" id="kobo.22.2">As demonstrated by the code example, there is no static HTML element on the page contrary to the previous recipe where both the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">section</span></code><span class="koboSpan" id="kobo.24.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.25.1">div</span></code><span class="koboSpan" id="kobo.26.1"> elements existed.</span></p><p><span class="koboSpan" id="kobo.27.1">Let's examine closely how these elements were dynamically created. </span><span class="koboSpan" id="kobo.27.2">On line A, a general selection was made to the top-level </span><code class="literal"><span class="koboSpan" id="kobo.28.1">body</span></code><span class="koboSpan" id="kobo.29.1"> element. </span><span class="koboSpan" id="kobo.29.2">The </span><code class="literal"><span class="koboSpan" id="kobo.30.1">body</span></code><span class="koboSpan" id="kobo.31.1"> selection result was cached using a local variable called </span><code class="literal"><span class="koboSpan" id="kobo.32.1">body</span></code><span class="koboSpan" id="kobo.33.1">. </span><span class="koboSpan" id="kobo.33.2">Then, at line </span><code class="literal"><span class="koboSpan" id="kobo.34.1">B</span></code><span class="koboSpan" id="kobo.35.1">, a new element </span><code class="literal"><span class="koboSpan" id="kobo.36.1">section</span></code><span class="koboSpan" id="kobo.37.1"> was appended to the body. </span><span class="koboSpan" id="kobo.37.2">Remember that the </span><code class="literal"><span class="koboSpan" id="kobo.38.1">append</span></code><span class="koboSpan" id="kobo.39.1"> function returns a new selection that contains the newly appended element; therefore, on line </span><code class="literal"><span class="koboSpan" id="kobo.40.1">C</span></code><span class="koboSpan" id="kobo.41.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.42.1">id</span></code><span class="koboSpan" id="kobo.43.1"> attribute can then be set on a newly created section element to </span><code class="literal"><span class="koboSpan" id="kobo.44.1">section1</span></code><span class="koboSpan" id="kobo.45.1">. </span><span class="koboSpan" id="kobo.45.2">Afterward, on line </span><code class="literal"><span class="koboSpan" id="kobo.46.1">D</span></code><span class="koboSpan" id="kobo.47.1">, a new </span><code class="literal"><span class="koboSpan" id="kobo.48.1">div</span></code><span class="koboSpan" id="kobo.49.1"> element was created and appended to </span><code class="literal"><span class="koboSpan" id="kobo.50.1">#section1</span></code><span class="koboSpan" id="kobo.51.1"> with its CSS class set to </span><code class="literal"><span class="koboSpan" id="kobo.52.1">blue box</span></code><span class="koboSpan" id="kobo.53.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.54.1">E</span></code><span class="koboSpan" id="kobo.55.1">. </span><span class="koboSpan" id="kobo.55.2">For the next step, similar to the previous line, on line </span><code class="literal"><span class="koboSpan" id="kobo.56.1">F</span></code><span class="koboSpan" id="kobo.57.1">, a </span><code class="literal"><span class="koboSpan" id="kobo.58.1">paragraph</span></code><span class="koboSpan" id="kobo.59.1"> element was appended to the </span><code class="literal"><span class="koboSpan" id="kobo.60.1">div</span></code><span class="koboSpan" id="kobo.61.1"> element with its textual content set to </span><code class="literal"><span class="koboSpan" id="kobo.62.1">dynamic blue box</span></code><span class="koboSpan" id="kobo.63.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.64.1">G</span></code><span class="koboSpan" id="kobo.65.1">.</span></p><p><span class="koboSpan" id="kobo.66.1">As illustrated by this example, this chaining process can continue to create any structure of arbitrary complexity. </span><span class="koboSpan" id="kobo.66.2">In fact this is how a typical D3-based data visualization structure is created. </span><span class="koboSpan" id="kobo.66.3">Many visualization projects simply contain only a HTML skeleton and rely on D3 to create the rest. </span><span class="koboSpan" id="kobo.66.4">Getting comfortable with this way of function chaining is critical if you want to become efficient with the D3 library.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/><span class="koboSpan" id="kobo.67.1">Note</span></h3><p><span class="koboSpan" id="kobo.68.1">Some of D3's modifier functions return a new selection, such as the </span><code class="literal"><span class="koboSpan" id="kobo.69.1">select</span></code><span class="koboSpan" id="kobo.70.1">, </span><code class="literal"><span class="koboSpan" id="kobo.71.1">append</span></code><span class="koboSpan" id="kobo.72.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.73.1">insert</span></code><span class="koboSpan" id="kobo.74.1"> functions. </span><span class="koboSpan" id="kobo.74.2">It is a good practice to use different levels of indentation to differentiate the selection your function chain is being applied on.</span></p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Manipulating the raw selection"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/><span class="koboSpan" id="kobo.1.1">Manipulating the raw selection</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Sometimes, having access to the D3 raw selection array might be beneficial in development whether it's for debugging purposes or for integrating with other JavaScript libraries, which require access to raw DOM elements; in this recipe, we will show you ways to do that. </span><span class="koboSpan" id="kobo.2.2">We will also see some, internal structure of a D3 selection object.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/raw-selection.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter2/raw-selection.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Of course, you can achieve this using the </span><code class="literal"><span class="koboSpan" id="kobo.9.1">nth-child</span></code><span class="koboSpan" id="kobo.10.1"> selector or the selection iterator function </span><code class="literal"><span class="koboSpan" id="kobo.11.1">each</span></code><span class="koboSpan" id="kobo.12.1">, but there are cases where these options are just too cumbersome and inconvenient. </span><span class="koboSpan" id="kobo.12.2">This is when you might find dealing with the raw selection array a more convenient approach. </span><span class="koboSpan" id="kobo.12.3">In this example, we will see how the raw selection array can be accessed and leveraged:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">&lt;table class="table"&gt; 
    &lt;thead&gt; 
    &lt;tr&gt; 
        &lt;th&gt;Time&lt;/th&gt; 
        &lt;th&gt;Type&lt;/th&gt; 
        &lt;th&gt;Amount&lt;/th&gt; 
    &lt;/tr&gt; 
    &lt;/thead&gt; 
    &lt;tbody&gt; 
    &lt;tr&gt; 
        &lt;td&gt;10:22&lt;/td&gt; 
        &lt;td&gt;Purchase&lt;/td&gt; 
        &lt;td&gt;$10.00&lt;/td&gt; 
    &lt;/tr&gt; 
    &lt;tr&gt; 
        &lt;td&gt;12:12&lt;/td&gt; 
        &lt;td&gt;Purchase&lt;/td&gt; 
        &lt;td&gt;$12.50&lt;/td&gt; 
    &lt;/tr&gt; 
    &lt;tr&gt; 
        &lt;td&gt;14:11&lt;/td&gt; 
        &lt;td&gt;Expense&lt;/td&gt; 
        &lt;td&gt;$9.70&lt;/td&gt; 
    &lt;/tr&gt; 
    &lt;/tbody&gt; 
&lt;/table&gt; 
 
&lt;script type="text/javascript"&gt; 
    var trSelection = d3.selectAll("tr"); // &lt;-- A 
    var headerElement = trSelection.nodes()[0]; // &lt;-- B 
    d3.select(headerElement).attr("class", "table-header"); // &lt;-     
    - C 
    var rows = trSelection.nodes(); 
    d3.select(rows[1]).attr("class", "table-row-odd"); // &lt;-- D 
    d3.select(rows[2]).attr("class", "table-row-even"); // &lt;-- E 
    d3.select(rows[3]).attr("class", "table-row-odd"); // &lt;-- F 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.14.1">This recipe generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.15.1"><img src="graphics/image_02_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.16.1">Raw selection manipulation</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/><span class="koboSpan" id="kobo.17.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">In this example, we went through an existing HTML table to color the table. </span><span class="koboSpan" id="kobo.18.2">This is not intended to be a good example of how you would color odd versus even rows in a table using D3. </span><span class="koboSpan" id="kobo.18.3">Instead, this example is designed to show how raw selection array can be accessed.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/><span class="koboSpan" id="kobo.19.1">Note</span></h3><p><span class="koboSpan" id="kobo.20.1">A much better way to color odd and even rows in a table would be using the </span><code class="literal"><span class="koboSpan" id="kobo.21.1">each</span></code><span class="koboSpan" id="kobo.22.1"> function and then relying on the index parameter </span><code class="literal"><span class="koboSpan" id="kobo.23.1">i</span></code><span class="koboSpan" id="kobo.24.1"> to do the job.</span></p></div></div><p><span class="koboSpan" id="kobo.25.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.26.1">A</span></code><span class="koboSpan" id="kobo.27.1">, we select all rows and store the selection in the </span><code class="literal"><span class="koboSpan" id="kobo.28.1">trSelection</span></code><span class="koboSpan" id="kobo.29.1"> variable. </span><span class="koboSpan" id="kobo.29.2">D3 selection has a convenient </span><code class="literal"><span class="koboSpan" id="kobo.30.1">node()</span></code><span class="koboSpan" id="kobo.31.1"> function that returns an array containing the selected element nodes. </span><span class="koboSpan" id="kobo.31.2">Thus, in order to access the first selected element, you will need to use </span><code class="literal"><span class="koboSpan" id="kobo.32.1">d3.selectAll("tr").nodes()[0]</span></code><span class="koboSpan" id="kobo.33.1">, the second element can be accessed with </span><code class="literal"><span class="koboSpan" id="kobo.34.1">d3.selectAll("tr").nodes()[1]</span></code><span class="koboSpan" id="kobo.35.1">, and so on. </span><span class="koboSpan" id="kobo.35.2">As we can see on line </span><code class="literal"><span class="koboSpan" id="kobo.36.1">B</span></code><span class="koboSpan" id="kobo.37.1">, the table header element can be accessed using </span><code class="literal"><span class="koboSpan" id="kobo.38.1">trSelection.nodes()[0]</span></code><span class="koboSpan" id="kobo.39.1"> and this will return a DOM element object. </span><span class="koboSpan" id="kobo.39.2">Again, as we have demonstrated in previous sections, any DOM element can then be selected directly using </span><code class="literal"><span class="koboSpan" id="kobo.40.1">d3.select</span></code><span class="koboSpan" id="kobo.41.1"> as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.42.1">C</span></code><span class="koboSpan" id="kobo.43.1">. </span><span class="koboSpan" id="kobo.43.2">Line </span><code class="literal"><span class="koboSpan" id="kobo.44.1">D</span></code><span class="koboSpan" id="kobo.45.1">, </span><code class="literal"><span class="koboSpan" id="kobo.46.1">E</span></code><span class="koboSpan" id="kobo.47.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.48.1">F</span></code><span class="koboSpan" id="kobo.49.1"> demonstrate how each element in selection can be directly indexed and accessed.</span></p><p><span class="koboSpan" id="kobo.50.1">Raw selection access could be handy in some cases especially when you need to use D3 in partnership with other JavaScript libraries since other libraries won't be able to work with D3 selection but only with raw DOM elements.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/><span class="koboSpan" id="kobo.51.1">Note</span></h3><p><span class="koboSpan" id="kobo.52.1">Additionally, this approach is typically very useful in a testing environment where knowing the absolute index for each element quickly and gaining a reference to them could be convenient. </span><span class="koboSpan" id="kobo.52.2">We will cover unit tests in a later chapter in more detail.</span></p></div></div><p><span class="koboSpan" id="kobo.53.1">In this chapter we covered many different ways of how HTML elements can be selected and manipulated using D3's selection API. </span><span class="koboSpan" id="kobo.53.2">In the next chapter, we will explore how data can be bound to such selection to dynamically drive the visual appearance of selected elements which is the fundamental step of data visualization.</span></p></div></div></div></div></body></html>