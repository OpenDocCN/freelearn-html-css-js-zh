<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;3D Charts"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. 3D Charts</h1></div></div></div><p>3D charts have been the most long awaited and the most desired feature in Highcharts. A feature that has been in the subject of heated debate within the users' community. There are users who agree, and those that disagree with the use of 3D charts. The pro camp argue for the use of 3D charts, for example in sales and marketing reports or infographics posters. The con party argue that 3D charts are misleading in terms of accuracy in data visualization and comparison, so the development resources should be focused elsewhere. As for Highcharts, it takes the pro-choice direction.</p><p>This chapter focuses on the basics of 3D configuration and shows a gallery of charts presented in 3D, as well as several specific options in each supported series. In this chapter, we will learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What a 3D chart in Highcharts is and isn't</li><li class="listitem" style="list-style-type: disc">Experimenting with 3D chart orientation: <code class="literal">alpha</code>, <code class="literal">beta</code>, <code class="literal">depth</code>, and <code class="literal">viewDistance</code></li><li class="listitem" style="list-style-type: disc">Configuring the 3D chart background</li><li class="listitem" style="list-style-type: disc">Plotting the column, pie, donut, and scatter series in 3D charts</li><li class="listitem" style="list-style-type: disc">Navigating with 3D charts</li></ul></div><div class="section" title="What a Highcharts 3D chart is and isn't"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec60"/>What a Highcharts 3D chart is and isn't</h1></div></div></div><p>At the time of writing, the <a id="id547" class="indexterm"/>3D chart feature is to display the 2D charts in a real 3D presentation, that is, we can rotate and tilt the charts in different dimensions and adjust the view distance. The 3D feature is currently only available for the column, pie, and scatter series.</p><p>What 3D charts cannot do is to construct a real three dimensional, <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, and <span class="emphasis"><em>z</em></span> axes chart, except for the scatter plot; we will even see some shortcomings in the scatter plot later. As this is the first major release of 3D charts, this limitation may be short lived.</p></div></div>
<div class="section" title="Experimenting with 3D chart orientation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec61"/>Experimenting with 3D chart orientation</h1></div></div></div><p>To enable the <a id="id548" class="indexterm"/>3D feature, we first need to include the extension as follows:</p><div class="informalexample"><pre class="programlisting">&lt;script 
 src="http://code.highcharts.com/highcharts-3d.js"&gt;&lt;/script&gt;</pre></div><p>In Highcharts, there are two levels of 3D options: chart and series. The chart level options are located in <code class="literal">chart.options3d</code>, which mainly deals with the orientation and the frame around the plotting area, whereas the 3D options for the series remain in the usual <code class="literal">plotOptions</code> area, such as <code class="literal">plotOptions.column.depth</code>.</p><p>Currently, Highcharts supports 2 axles of rotation: horizontal and vertical, which are the <code class="literal">alpha</code> and <code class="literal">beta</code> options in <code class="literal">chart.options3d</code> respectively. The values for these options are in degrees. The following diagram illustrates with arrows the direction of chart rotation as the degree value increases and decreases:</p><div class="mediaobject"><img src="graphics/7451OS_09_01.jpg" alt="Experimenting with 3D chart orientation"/></div><div class="section" title="Alpha and beta orientations"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec61"/>Alpha and beta orientations</h2></div></div></div><p>In the <a id="id549" class="indexterm"/>previous <a id="id550" class="indexterm"/>diagram, we <a id="id551" class="indexterm"/>showed <a id="id552" class="indexterm"/>the direction of orientation. Let's experiment with a column chart. We are going to use a chart from <a class="link" href="ch04.html" title="Chapter 4. Bar and Column Charts">Chapter 4</a>, <span class="emphasis"><em>Bar and Column Charts</em></span>, which looks as follows:</p><div class="mediaobject"><img src="graphics/7451OS_09_02.jpg" alt="Alpha and beta orientations"/></div><p>We then <a id="id553" class="indexterm"/>add the 3D <a id="id554" class="indexterm"/>options to the<a id="id555" class="indexterm"/> chart <a id="id556" class="indexterm"/>as follows:</p><div class="informalexample"><pre class="programlisting">             chart: {
                renderTo: 'container',
                type: 'column',
                borderWidth: 1,
                options3d: {
                    alpha: 0,
                    beta: 0,
                    enabled: true
                }
            },</pre></div><p>We switch the chart to 3D display mode with the enabled option and no rotation in both axles, which produces the following chart:</p><div class="mediaobject"><img src="graphics/7451OS_09_03.jpg" alt="Alpha and beta orientations"/></div><p>Notice that<a id="id557" class="indexterm"/> without <a id="id558" class="indexterm"/>any rotation, the chart<a id="id559" class="indexterm"/> looks<a id="id560" class="indexterm"/> almost the same as the original, as expected. When we look closer, the columns are actually constructed in 3D, with depth. Let's set the alpha axle to 30 degrees and the beta axle to remain at zero:</p><div class="mediaobject"><img src="graphics/7451OS_09_04.jpg" alt="Alpha and beta orientations"/></div><p>We can see <a id="id561" class="indexterm"/>the 3D<a id="id562" class="indexterm"/> structure more clearly as <a id="id563" class="indexterm"/>the alpha <a id="id564" class="indexterm"/>axle increases, as we are leaning towards a top-down view of the chart. Let's reset alpha back to zero and set the beta axle to 30 degrees:</p><div class="mediaobject"><img src="graphics/7451OS_09_05.jpg" alt="Alpha and beta orientations"/></div><p>The chart is<a id="id565" class="indexterm"/> rotated <a id="id566" class="indexterm"/>horizontally on a vertical <a id="id567" class="indexterm"/>principal axis. Note that once the chart is rotated on the<a id="id568" class="indexterm"/> beta axle, a large gap appears between the title and the <span class="emphasis"><em>y</em></span> axis. We can remove the gap by positioning the title with <code class="literal">x</code> and <code class="literal">y</code> options:</p><div class="informalexample"><pre class="programlisting">            yAxis: {
                title: {
                    text: 'No. of Patents',
                    x: 35,
                    y: -80
                }
            },</pre></div><p>Let's set both rotations together to 30:</p><div class="mediaobject"><img src="graphics/7451OS_09_06.jpg" alt="Alpha and beta orientations"/></div><p>Notice that<a id="id569" class="indexterm"/> when we<a id="id570" class="indexterm"/> rotate a 3D chart, the plot area<a id="id571" class="indexterm"/> can interfere with other components, such as chart title and <a id="id572" class="indexterm"/>spacing on each side. In this case, we need to use the margin settings to manually accommodate the chart properly, depending on the size and view angle. Here is an example:</p><div class="informalexample"><pre class="programlisting">        var chart = new Highcharts.Chart({
              chart: {
                    ....,
                    marginTop: 105,
                    marginLeft: 35,
                    spacingBottom: 25
              }
              ....</pre></div></div><div class="section" title="The depth and view distance"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec62"/>The depth and view distance</h2></div></div></div><p>Apart from <code class="literal">alpha</code> <a id="id573" class="indexterm"/>and <code class="literal">beta</code> options, we can use the <code class="literal">depth</code> option to control the distance between the data<a id="id574" class="indexterm"/> display<a id="id575" class="indexterm"/> and the<a id="id576" class="indexterm"/> 3D background. Let's set the <code class="literal">depth</code> option to be exactly the same as the default depth of the 3D columns, which is 25 pixels deep. We also specify the <code class="literal">viewDistance</code> option to the default value, <code class="literal">100</code> (at the time of writing, changing the depth value also changes the <code class="literal">viewDistance</code> value), as follows:</p><div class="informalexample"><pre class="programlisting">                options3d: {
                    alpha: 30,
                    beta: 30,
                    enabled: true,
                    viewDistance: 100,
                    depth: 25
                }</pre></div><p>As we can see, the <a id="id577" class="indexterm"/>columns <a id="id578" class="indexterm"/>are backed up <a id="id579" class="indexterm"/>against the<a id="id580" class="indexterm"/> background frame:</p><div class="mediaobject"><img src="graphics/7451OS_09_07.jpg" alt="The depth and view distance"/></div><p>Let's change the <code class="literal">viewDistance</code> option to 0 for a closer perspective:</p><div class="mediaobject"><img src="graphics/7451OS_09_08.jpg" alt="The depth and view distance"/></div></div></div>
<div class="section" title="Configuring the 3D chart background"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec62"/>Configuring the 3D chart background</h1></div></div></div><p>Instead of having a white<a id="id581" class="indexterm"/> background with dark labels, let's replace the side, bottom, and back frames around the plot area with different settings. In Highcharts, we can specify the color and thickness of these frames, as follows:</p><div class="informalexample"><pre class="programlisting">                   options3d: {
                       ....,
                       frame: {
                            back: {
                                color: '#A3A3C2',
                                size: 4
                            },
                            bottom: {
                                color: '#DBB8FF',
                                size: 10
                            },
                            side: {
                                color: '#8099E6',
                                size: 2
                            }
                       }
                   }</pre></div><p>Meanwhile, we also change the data label color to white which contrasts nicely with the new background color:</p><div class="mediaobject"><img src="graphics/7451OS_09_09.jpg" alt="Configuring the 3D chart background"/></div><p>Note that if we apply a <a id="id582" class="indexterm"/>background image to the 3D chart, Highcharts doesn't automatically angle the image along the background.</p></div>
<div class="section" title="Plotting the column, pie, donut, and scatter series in 3D charts"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec63"/>Plotting the column, pie, donut, and scatter series in 3D charts</h1></div></div></div><p>In this section, we will plot a <a id="id583" class="indexterm"/>gallery of column, pie, donut, and scatter series which are currently supported for 3D presentation. We will also examine the 3D options specific to each series. Some of the examples used here are taken from previous chapters.</p><div class="section" title="3D columns in stacked and multiple series"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec63"/>3D columns in stacked and multiple series</h2></div></div></div><p>Let's start with a multi-series stacked column chart<a id="id584" class="indexterm"/> embedded with the <code class="literal">options3d</code> setting:</p><div class="informalexample"><pre class="programlisting">                options3d: {
                    alpha: 10,
                    beta: 30,
                    enabled: true
                }</pre></div><p>Here is what a multi-series grouped and stacked 3D columns chart looks like:</p><div class="mediaobject"><img src="graphics/7451OS_09_10.jpg" alt="3D columns in stacked and multiple series"/></div><div class="section" title="Column depth and Z-padding"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec13"/>Column depth and Z-padding</h3></div></div></div><p>Notice from the preceding chart, the <a id="id585" class="indexterm"/>sides of the UK/Germany stacked columns are <a id="id586" class="indexterm"/>covered by the S. Korea/Japan columns. Suppose<a id="id587" class="indexterm"/> that we want to show part of the sides of the UK/Germany<a id="id588" class="indexterm"/> columns. In order to do that, we can reduce the thickness of the S. Korea/Japan columns with the <code class="literal">plotOptions.column.depth</code> option, such as:</p><div class="informalexample"><pre class="programlisting">            series: [{
                name: 'UK',
                data:  ....,
                stack: 'Europe'
            }, {
                name: 'Germany',
                data:  ....,
               stack: 'Europe'
            }, {
                name: 'S.Korea',
                data:  ....,
                stack: 'Asia',
                depth: 12
            }, {
                name: 'Japan',
                data: ....,
                stack: 'Asia',
                depth: 12
            }]</pre></div><p>Here, we reduce the<a id="id589" class="indexterm"/> thickness of the S. Korea/Japan columns to<a id="id590" class="indexterm"/> 12 pixels which is around half the depth of the<a id="id591" class="indexterm"/> default value. The following chart shows one group <a id="id592" class="indexterm"/>of columns thinner than the other:</p><div class="mediaobject"><img src="graphics/7451OS_09_11.jpg" alt="Column depth and Z-padding"/></div><p>Notice that even when we have reduced the depth of one group of columns, the sides of the UK/Germany columns are still blocked. This is because the surface of the 3D columns are by default aligned along each other in Highcharts. To change that behavior, we use the <code class="literal">groupZPadding</code> option. In order to understand the concept of the <code class="literal">groupZPadding</code> option, it is best to illustrate it with a top-down view of the 3D columns in multiple series:</p><div class="mediaobject"><img src="graphics/7451OS_09_12.jpg" alt="Column depth and Z-padding"/></div><p>The <code class="literal">groupZPadding</code> option is the<a id="id593" class="indexterm"/> distance between the front view and the face<a id="id594" class="indexterm"/> of the column. In order to have the back of<a id="id595" class="indexterm"/> both series columns in line with each other, we<a id="id596" class="indexterm"/> need to increase the <code class="literal">groupZPadding</code> value for series B which has reduced depth, that is:</p><p><span class="emphasis"><em>B column depth + B groupZPadding = A column depth + A groupZPadding</em></span></p><p>We add the <code class="literal">groupZPadding</code> option as follows (3D columns have a default depth of 25 pixels and default <code class="literal">groupZPadding</code> of 1 pixel):</p><div class="informalexample"><pre class="programlisting">           series: [{
                name: 'UK',
                data:  ....,
                stack: 'Europe',
            }, {
                name: 'Germany',
                data:  ....,
               stack: 'Europe',
            }, {
                name: 'S.Korea',
                data:  ....,
                stack: 'Asia',
                depth: 12,
                groupZPadding: 14
            }, {
                name: 'Japan',
                data: ....,
                stack: 'Asia',
                depth: 12,
                groupZPadding: 14
            }]</pre></div><p>As expected, the S. Korea/Japan <a id="id597" class="indexterm"/>columns <a id="id598" class="indexterm"/>are pushed <a id="id599" class="indexterm"/>back and show the column sides of the other<a id="id600" class="indexterm"/> series:</p><div class="mediaobject"><img src="graphics/7451OS_09_13.jpg" alt="Column depth and Z-padding"/></div></div></div><div class="section" title="Plotting the infographic 3D columns chart"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec64"/>Plotting the infographic 3D columns chart</h2></div></div></div><p>Let's see whether we can use <a id="id601" class="indexterm"/>Highcharts to plot an infographic style 3D chart. In this section, we will use the infographics designed by Arno Ghelfi and published in the Wired magazine, Geekiness<a id="id602" class="indexterm"/> at Any Price (See <a class="ulink" href="http://starno.com/client/wired/#geekiness-at-any-price-wired">http://starno.com/client/wired/#geekiness-at-any-price-wired</a>). Here is part of the infographics poster:</p><div class="mediaobject"><img src="graphics/7451OS_09_14.jpg" alt="Plotting the infographic 3D columns chart"/></div><p>Although the chart looks <a id="id603" class="indexterm"/>difficult to comprehend, we will focus on using Highcharts to reproduce one of these special 3D style columns here. From the previous exercise, we know that we can set up the columns with increasing depth, or with decreasing <code class="literal">groupZPadding</code> values to achieve the same effect. This is because the depth and <code class="literal">groupZPadding</code> options are from the <code class="literal">plotOptions.column</code> configuration which is designed on a per-series basis. Therefore, we need to put each item of data as a separate series, in order to have columns with various depths and <code class="literal">groupZPadding</code> values, like the following:</p><div class="informalexample"><pre class="programlisting">            series: [{
                data: [ 1500 ],
                depth: 5,
                groupZPadding: 95
            }, {
                data: [ 1300 ],
                depth: 10,
                groupZPadding: 90
            }, {
                data: [ 1100 ],
                depth: 15,
                groupZPadding: 85
            }, {</pre></div><p>Second, the columns in the example chart have no space between them. We can accomplish the same result by setting the padding spaces to zero with the <code class="literal">groupPadding</code> and <code class="literal">pointPadding</code> options. Then, we set all the columns to have the same color with the color option. Without space and with the same color for the columns will make them look indistinguishable. Fortunately, there is another specific option for 3D columns, <code class="literal">edgeColor</code>, which is for the color along the column edges. Here is the outcome of the configuration:</p><div class="informalexample"><pre class="programlisting">            plotOptions: {
                column: {
                    pointPadding: 0,
                    groupPadding: 0,
                    color: '#C5542D',
                    edgeColor: '#953A20'
                }
            },</pre></div><p>Here is our attempt to create an<a id="id604" class="indexterm"/> infographic style chart with Highcharts:</p><div class="mediaobject"><img src="graphics/7451OS_09_15.jpg" alt="Plotting the infographic 3D columns chart"/></div></div><div class="section" title="Plotting 3D pie and donut charts"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec65"/>Plotting 3D pie and donut charts</h2></div></div></div><p>Plotting 3D pie and donut charts follows <a id="id605" class="indexterm"/>the same principle as the column chart. Simply <a id="id606" class="indexterm"/>include the <code class="literal">options3d</code> configuration for the orientation. To control the thickness of the pie chart, we use <code class="literal">plotOptions.pie.depth</code> in a similar fashion.</p><p>Let's use some live data to plot a 3D pie<a id="id607" class="indexterm"/> and donut charts. First, we borrow some code from a Highcharts online demo (<a class="ulink" href="http://www.highcharts.com/demo/pie-gradient">http://www.highcharts.com/demo/pie-gradient</a>) which turns the Highcharts standard series colors into some gradient style colors. This automatically makes the chart more appealing with light shading:</p><div class="informalexample"><pre class="programlisting">Highcharts.getOptions().colors = 
   Highcharts.map(Highcharts.getOptions().colors, function(color)  
     {
          return {
            radialGradient: { cx: 0.5, cy: 0.3, r: 0.7 },
            stops: [
                [0, color],
                [1, Highcharts.Color(color).
                 brighten(-0.3).get('rgb')] // darken
            ]
        };
   });</pre></div><p>In this pie chart, we set the pie <code class="literal">depth</code> and <code class="literal">alpha</code> rotation options to 50 and 55 respectively:</p><div class="informalexample"><pre class="programlisting">chart: {
    ....,
    options3d: {
        alpha: 55,
        beta: 0,
        enabled: true
    }
   },
....,
plotOptions: {
     pie: {
         center: [ '50%', '45%' ],
         depth: 50,
         slicedOffset: 40,
         startAngle: 30,
         dataLabels: {
             ....
         },
         size: "120%"
     }
},
series: [{
    type: 'pie',
    data: [ { 
        name: 'Sleep', 
        y: 8.74, 
        sliced: true, 
    }, { 
        name: 'Working and work-related activities', 
        y: 3.46 
    }, {
        ....
    }]
}]</pre></div><p>As we can see, the <code class="literal">depth</code> option produces<a id="id608" class="indexterm"/> a rather thick 3D pie chart with nice color<a id="id609" class="indexterm"/> shading:</p><div class="mediaobject"><img src="graphics/7451OS_09_16.jpg" alt="Plotting 3D pie and donut charts"/></div><p>In the next donut chart, we set up all the sections to be separated with the <code class="literal">sliced</code> option set to <code class="literal">true,</code> and apply orientations:</p><div class="informalexample"><pre class="programlisting">     chart: {
         ....
         options3d: {
             alpha: 50,
             beta: 40,
             enabled: true
         }
     },
     ....,
     plotOptions: {
         pie: {
             depth: 40,
             center: [ '50%', '44%' ],
             slicedOffset: 15,
             innerSize: '50%',
             startAngle: 270,
             size: "110%",
             ....
         }
     },
     series: [{
         type: 'pie',
         data: [{ 
             name: 'Swiss &amp; UK', 
             y: 790,
             sliced: true, 
             // color, dataLabel decorations
             ....
         }, { 
             name: 'Australia, U.S &amp; South Africa', 
             y: 401,
             ....
            }, {
             ....
         }]
     }]</pre></div><p>Here is a 3D donut chart<a id="id610" class="indexterm"/> with all the <a id="id611" class="indexterm"/>slices separate from each other:</p><div class="mediaobject"><img src="graphics/7451OS_09_17.jpg" alt="Plotting 3D pie and donut charts"/></div></div><div class="section" title="The 3D scatter plot"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec66"/>The 3D scatter plot</h2></div></div></div><p>Highcharts supports real<a id="id612" class="indexterm"/> three-dimensional scatter series, although they are rather visually obscure. Despite this, we can use the <code class="literal">zAxis</code> option to define the third axis range. The chart doesn't display any details along the <span class="emphasis"><em>z</em></span> axis like others. Let's construct the chart with some 3D data. In order to plot a three-dimensional scatter series, apart from the <code class="literal">options3d</code> configuration, we need to define the data series in an array of triplets:</p><div class="informalexample"><pre class="programlisting">            series: [{
                name: 'China',
                data: [ [ 2000, 23.32, 20.91 ], 
                        [ 2001, 22.6, 20.48 ], 
                        [ 2002, 25.13, 22.56 ], 
                        ....,</pre></div><p>With a multiple three-dimensional scatter series, it looks like this:</p><div class="mediaobject"><img src="graphics/7451OS_09_18.jpg" alt="The 3D scatter plot"/></div><p>As we can see, it is difficult <a id="id613" class="indexterm"/>to make sense of the data points hanging in 3D space. Note that Highcharts currently doesn't show any intervals along the <span class="emphasis"><em>z</em></span> axis. Let's add some navigation to assist the data visualization:</p><div class="informalexample"><pre class="programlisting">  var orgColors = Highcharts.getOptions().colors;
  // Apply color shading to Highcharts.getOptions().colors
  ....
  chart: ....,
  ....,
  tooltip: {
   crosshairs: [ { width: 2, color: '#B84DDB' },
                 { width: 2, color: '#B84DDB' },
                 { width: 2, color: '#B84DDB' } ],
   formatter: function() {
       var color = orgColors[this.series.index];
       return '&lt;span style="color:' + color + '"&gt;\u25CF&lt;/span&gt; ' + 
              this.series.name + ' - In &lt;b&gt;' + this.point.x + 
              '&lt;/b&gt;: Exports: &lt;b&gt;' + this.point.y + 
              '%&lt;/b&gt;, Imports: &lt;b&gt;' + this.point.z + '%&lt;/b&gt;&lt;br/&gt;';
   },
   shape: 'square',
   positioner: function(width, height, point) {
       var x = chart.plotLeft + chart.plotWidth - width + 20;
       var y = 40;
       return { x: x, y: y };
   } 
  }</pre></div><p>We change the tooltip into crosshairs for all dimensions. In order to avoid the tooltip blocking the crosshair lines, we fix the tooltip position to the top-right of the chart with the <code class="literal">positioner</code> option. Next, we use <code class="literal">formatter</code> to style the tooltip content. We borrow the tooltip formatting code from a<a id="id614" class="indexterm"/> Highcharts online demo (<a class="ulink" href="http://www.highcharts.com/demo/3d-scatter-draggable">http://www.highcharts.com/demo/3d-scatter-draggable</a>); the <code class="literal">\u25CF</code> is a dot Unicode symbol which is used<a id="id615" class="indexterm"/> as a bullet point with the series color. Since the tooltip is away from the hovered point, it is less confusing to have the tooltip in a rectangular shape rather than the default speech balloon style (<code class="literal">callout</code> in Highcharts). The following screenshot shows the chart with a hovered over crosshair:</p><div class="mediaobject"><img src="graphics/7451OS_09_19.jpg" alt="The 3D scatter plot"/></div><p>As we can see, even if we specify the crosshair in the z dimension, there is no crosshair line projected along the axis.</p></div></div>
<div class="section" title="Navigating with 3D charts"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec64"/>Navigating with 3D charts</h1></div></div></div><p>In this section, we will<a id="id616" class="indexterm"/> investigate how you can interact with 3D charts. In <a class="link" href="ch02.html" title="Chapter 2. Highcharts Configurations">Chapter 2</a>, <span class="emphasis"><em>Highcharts Configurations</em></span>, we have already explored the drill down feature and we will revisit it briefly in 3D charts. Another interaction specific to 3D charts is the impressive click-and-drag feature.</p><div class="section" title="Drilldown 3D charts"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec67"/>Drilldown 3D charts</h2></div></div></div><p>Let's convert our previous drill <a id="id617" class="indexterm"/>down example into a 3D chart. First, we add the <code class="literal">options3d</code> option (and other positioning options):</p><div class="informalexample"><pre class="programlisting">              options3d: {
                  enabled: true,
                  alpha: 25,
                  beta: 30,
                  depth: 30,
                  viewDistance: 100
              },</pre></div><p>Here, we have our top level 3D chart:</p><div class="mediaobject"><img src="graphics/7451OS_09_20.jpg" alt="Drilldown 3D charts"/></div><p>The next step is to improve our drill down pie chart in 3D with different orientation. Since the top level column is already configured in 3D, the drill down pie chart (defined in the <code class="literal">drilldown.series</code> option with matching <code class="literal">id</code> value) will also follow suit. However, we won't notice the pie in 3D because the default depth is 0. So, we need to set the thickness of the pie chart with the <code class="literal">depth</code> option:</p><div class="informalexample"><pre class="programlisting">                plotOptions: {
                    pie: {
                       depth: 30,
                       ....,</pre></div><p>In order to set the drill down<a id="id618" class="indexterm"/> chart to a different rotation, we change the chart options in the <code class="literal">drilldown</code> event callback:</p><div class="informalexample"><pre class="programlisting">chart: {
    renderTo: 'container',
    ....,
    events: {
        drilldown: function(e) {
           .... 
           if (e.point.name == 'Internet Explorer') {
               // Create the '9%' string in the center of 
               // the donut chart
               pTxt = chart.renderer.text('9%', 
                  (chart.plotWidth / 2) + chart.plotLeft - 25, 
                     (chart.plotHeight / 2) + chart.plotTop + 25). 
               css({
                  // font size, color and family
                  ....,
                  '-webkit-transform': 
                        'perspective(600) rotateY(50deg)'
               }).add();
                                      
               chart.options.chart.options3d.alpha = 0;                          
               chart.options.chart.options3d.beta = 40;
           }
        },
        drillup: function() {
            // Revert to original orientation
            chart.options.chart.options3d.alpha = 25;
            chart.options.chart.options3d.beta = 30;
            ....
        }
    } </pre></div><p>When the <code class="literal">drilldown</code> event is triggered from the <code class="literal">Internet Explorer</code> column, which zooms down to a donut chart, we set the chart with new <code class="literal">alpha</code> and <code class="literal">beta</code> orientations to 0 and 40 respectively. We use the CSS3 <code class="literal">-webkit-transform</code> setting on the <code class="literal">9%</code> sign to make it appear to have the same rotation as the donut chart. Finally, we reset the chart to its original orientation in the <code class="literal">drillup</code> callback, which is triggered when the user clicks on the <span class="strong"><strong>Back to …</strong></span>. button. Here <a id="id619" class="indexterm"/>is the display of the zoom down donut chart:</p><div class="mediaobject"><img src="graphics/7451OS_09_21.jpg" alt="Drilldown 3D charts"/></div></div><div class="section" title="Click and drag 3D charts"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec68"/>Click and drag 3D charts</h2></div></div></div><p>Another impressive interaction with 3D charts is the click-and-drag function<a id="id620" class="indexterm"/> which we can <a id="id621" class="indexterm"/>use to drag the chart into any orientation. This interaction is actually from the Highcharts 3D scatter online demo<a id="id622" class="indexterm"/>, (<a class="ulink" href="http://www.highcharts.com/demo/3d-scatter-draggable">http://www.highcharts.com/demo/3d-scatter-draggable</a>). Here, we are going to explore how this is achieved. Before we do that, let's reuse our infographics example and copy the click-and-drag jQuery demo code into this exercise. The following is the click-and-drag code with minor modifications:</p><div class="informalexample"><pre class="programlisting">    $(function () {
        $(document).ready(function() {
            document.title = "Highcharts " + Highcharts.version;

            var chart = new Highcharts.Chart({
                ....
            });
            // Add mouse events for rotation
            $(chart.container).bind('mousedown.hc touchstart.hc', 
              function (e) {
                e = chart.pointer.normalize(e);

                var posX = e.pageX,
                    posY = e.pageY,
                    alpha = chart.options.chart.options3d.alpha,
                    beta = chart.options.chart.options3d.beta,
                    newAlpha,
                    newBeta,
                    sensitivity = 5; // lower is more sensitive

                $(document).bind({
                    'mousemove.hc touchdrag.hc': 
                       function (e) {
                          // Run beta
                          newBeta = 
                            beta + (posX - e.pageX) / sensitivity;
                          newBeta = 
                            Math.min(100, Math.max(-100,
                                     newBeta));
                          chart.options.chart.options3d.beta =              
                            newBeta;

                        // Run alpha
                        newAlpha = 
                           alpha + (e.pageY - posY) / sensitivity;
                        newAlpha = Math.min(100, Math.max(-100,
                                    newAlpha));
                        chart.options.chart.options3d.alpha =
                            newAlpha;

                        // Update the alpha, beta and viewDistance 
                        // value in subtitle continuously
                        var subtitle = "alpha: " + 
                            Highcharts.numberFormat(newAlpha, 1) + 
                            ", beta: " + 
                            Highcharts.numberFormat(newBeta, 1) + 
                            ", viewDistance: " +    
                            Highcharts.numberFormat(
                  chart.options.chart.options3d.viewDistance, 1);
                        chart.setTitle(null, 
                               { text: subtitle }, false);

                        chart.redraw(false);
                    },              
              
                    'mouseup touchend': function () { 
                        $(document).unbind('.hc');
                    }
                });
            });</pre></div><p>The chart<a id="id623" class="indexterm"/> container's element is bound with the <code class="literal">mousedown</code> and <code class="literal">touchstart</code> events. The event names suffixed by <code class="literal">'.hc'</code> mean that the event handlers are<a id="id624" class="indexterm"/> grouped into the same name space, <code class="literal">'.hc'</code>. This is later used to unbind the event handlers declared under the name space.</p><p>So when the user performs a <code class="literal">mousedown</code> or <code class="literal">touchstart</code> event in the chart container, it executes the handler. The function first normalizes the event object for cross-browser event compatibility. Then it records the current pointer position values (<code class="literal">pageX</code>, <code class="literal">pageY</code>) as well as <code class="literal">alpha</code> and <code class="literal">beta</code> values under the <code class="literal">mousedown</code> event. Further under the <code class="literal">mousedown</code> or <code class="literal">touchstart</code> events, we bind an additional handler with the <code class="literal">mousemove</code> and <code class="literal">touchdrag</code> events in the same <code class="literal">'.hc'</code> name space. In other words, this means that under the <code class="literal">mousedown</code> or <code class="literal">touchstart</code> action, moving the mouse and dragging via touch will bind the second handler to the container.</p><p>The second handler implementation is to calculate the movement in x and y directions by comparing the current movement coordinates to the initial position recorded in the <code class="literal">mousedown</code> handler. Then, it transforms the scroll distance into orientation and updates the new <code class="literal">alpha</code> and <code class="literal">beta</code> values. The <code class="literal">Math.max</code> and <code class="literal">Math.min</code> expressions are to limit the <code class="literal">alpha</code> and <code class="literal">beta</code> into a range between -100 and 100. Note that the code doesn't restrict us to only using <code class="literal">pageX/Y</code> from the event object. We can use other similar properties such as <code class="literal">screenX/Y</code> or <code class="literal">clientX/Y</code>, as long as both handlers are referring to the same.</p><p>Finally, we call <code class="literal">chart.draw(false)</code> to redraw the chart with the new orientation but without animation. The reason for a lack of animation is that the movement handler is being called frequently with scroll action and animation, which will require extra overhead, degrading the responsiveness of the display.</p><p>The following screenshot illustrates the chart after the click-and-drag action:</p><div class="mediaobject"><img src="graphics/7451OS_09_22.jpg" alt="Click and drag 3D charts"/></div></div><div class="section" title="Mousewheel scroll and view distance"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec69"/>Mousewheel scroll and view distance</h2></div></div></div><p>We can improve the<a id="id625" class="indexterm"/> experience by introducing another<a id="id626" class="indexterm"/> interaction, <code class="literal">mousewheel</code>, so that<a id="id627" class="indexterm"/> the view distance of <a id="id628" class="indexterm"/>the chart responds to the <code class="literal">mousewheel</code> actions. For the sake of a cross-browser compatibility solution, we use a jQuery mousewheel plugin<a id="id629" class="indexterm"/> by Brandon Aaron (<a class="ulink" href="http://github.com/brandonaaron/jquery-mousewheel/">http://github.com/brandonaaron/jquery-mousewheel/</a>).</p><p>The following is the handler code:</p><div class="informalexample"><pre class="programlisting">// Add mouse events for zooming in and out view distance
$(chart.container).bind('mousewheel', 
     function (e) {
         e = chart.pointer.normalize(e);
         var sensitivity = 10; // lower is more sensitive
         var distance = 
             chart.options.chart.options3d.viewDistance;

         distance += e.deltaY / sensitivity;
         distance = Math.min(100, Math.max(1, distance));

         chart.options.chart.options3d.viewDistance = distance;

         var subtitle = "alpha: " + 
              Highcharts.numberFormat(
              chart.options.chart.options3d.alpha, 1) +
                ", beta: " + 
              Highcharts.numberFormat(
             chart.options.chart.options3d.beta, 1) +
                ", viewDistance: " + 
              Highcharts.numberFormat(distance, 1);

            chart.setTitle(null, { text: subtitle }, false);

            chart.redraw(false);
     });</pre></div><p>In a similar <a id="id630" class="indexterm"/>fashion, <code class="literal">deltaY</code> is the <code class="literal">mousewheel</code> scroll value and we <a id="id631" class="indexterm"/>apply the <a id="id632" class="indexterm"/>change to the <code class="literal">viewDistance</code> option. Here is<a id="id633" class="indexterm"/> the result when we apply click-and-drag and mousewheel scroll actions:</p><div class="mediaobject"><img src="graphics/7451OS_09_23.jpg" alt="Mousewheel scroll and view distance"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec65"/>Summary</h1></div></div></div><p>In this chapter, we learned how to create 3D column, scatter, and pie charts, and how to manipulate the orientation and configurations specific to each series. We tested these options by producing a gallery of 3D charts. On top of that, we explored a number of user interactions for 3D charts in Highcharts.</p><p>In the next chapter, we will explore the Highcharts APIs, which are responsible for making a dynamic chart, such as using Ajax queries to update the chart content, accessing components in Highcharts objects, and exporting charts to SVG.</p></div></body></html>