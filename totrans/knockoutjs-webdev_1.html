<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Getting Started with KnockoutJS"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with KnockoutJS</h1></div></div></div><p>Welcome to the power and wonder of the world of KnockoutJS. In this chapter, we will start down the road to win with AJAX HTML applications AJAX HTML applications. This chapter will focus on:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing KnockoutJS</li><li class="listitem" style="list-style-type: disc">Understanding what MVVM means</li><li class="listitem" style="list-style-type: disc">Binding elements with the Knockout library</li><li class="listitem" style="list-style-type: disc">Accelerating and simplifying coding using developer tools in modern browsers</li><li class="listitem" style="list-style-type: disc">Creating functions for consumption with Knockout</li><li class="listitem" style="list-style-type: disc">Automating the computing of values directly with Knockout</li><li class="listitem" style="list-style-type: disc">Working with functions outside of Knockout</li></ul></div><div class="section" title="Installing KnockoutJS"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Installing KnockoutJS</h1></div></div></div><p>First, make <a id="id0" class="indexterm"/>sure you <a id="id1" class="indexterm"/>have a working website set up on a server. It can be as simple as plain old HTML if you only want to learn those features or any of the productive web platforms out there (ASP.NET, ColdFusion/Railo, NodeJS, PHP, Python, Ruby, and so on); just make sure the service is running before installing Knockout. However, there is one exception. If you are using Knockout for an HTML application like PhoneGap or something along those lines, then you do not need a web server for internal functionality.</p><p>There are a number of ways to install Knockout. You need to choose the one that works right for <a id="id2" class="indexterm"/>you. The book files have been packaged into a ZIP file at <a class="ulink" href="http://knockout.developers.zone/books/knockout-js-web-development/">http://knockout.developers.zone/books/knockout-js-web-development/</a>. Click on the link to download the current stable release of the product. We will keep it up to date with fixes if any are needed. We will also be creating a video on that page to show how to get things installed at least on Mac and Windows.</p><p>If you download the page directly from the Knockout site at <a class="ulink" href="http://knockoutjs.com">http://knockoutjs.com</a>, copy the text and paste it into a JS file within the folders for your website.</p><p>Now, there <a id="id3" class="indexterm"/>are others <a id="id4" class="indexterm"/>who may be using fancier tools in the future. There are several package installers that pull the files needed. If you are using one of those for this book then check that the version of KnockoutJS is 3.2 or later. I would suggest not using those at this time unless you are already familiar with them. They are worth getting to know but not needed to get running with Knockout.</p><p>My examples include the Bootstrap library as I wanted to improve the presentation and give a distinct personality on the pages of this book, which is another way of saying it made creating this resource for you more fun for me.</p><p>I have links to all the examples and exercises in this book linked from the root of the web folder. I would suggest learning to use Knockout there, and using this knowledge if you are moving to web-based app development.</p><p>With the files loaded, you should be able to click through a couple of the examples. One of my goals was to set the course up so you could use this as a quick reference document after completing the course when you need to look up how to do different things with Knockout.</p><p>Your work pages should go in the appropriate folder matching the chapter numbers of this book. I have created complete working examples in the <code class="literal">done</code> folder and yours should go into the <code class="literal">do</code> folder under the matching chapter number.</p></div></div>
<div class="section" title="Looking at MVVM"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Looking at MVVM</h1></div></div></div><p>MVVM is a design approach to building software. The name is a little confusing, and it makes you <a id="id5" class="indexterm"/>wonder if they were trying to be clear or if they just liked the symmetry that the letters created. The design pattern was used extensively in Microsoft and Apple development products.</p><p>
<span class="strong"><strong>MVVM</strong></span> stands for <span class="strong"><strong>Model View ViewModel</strong></span>.</p><p>Let's start with <a id="id6" class="indexterm"/>the <a id="id7" class="indexterm"/>
<span class="strong"><strong>View</strong></span>. It is where the HTML is converted to <span class="strong"><strong>Document Object Model</strong></span> (<span class="strong"><strong>DOM</strong></span>).</p><p>The View interacts with an object called a ViewModel. The <a id="id8" class="indexterm"/>
<span class="strong"><strong>ViewModel</strong></span> is where the presentation logic is stored. The <a id="id9" class="indexterm"/>
<span class="strong"><strong>Model</strong></span> is the part that stores the data and business logic. This is commonly passed to the browser as a JSON object.</p><p>Let's clear up a <a id="id10" class="indexterm"/>confusing point right now. When charted out, most people draw out the relationship as View-ViewModel-Model, which would be VVMM. Don't get caught up in the semantics; just take a look at the following diagram to understand what they mean by MVVM:</p><div class="mediaobject"><img src="graphics/1028OS_01_01.jpg" alt="Looking at MVVM"/></div><p>Your data gets stored in the Model, but you do not interact with the data directly. You use the ViewModel to interact with the data. You should also note that you don't need to be an expert with the MVVM pattern, as the concepts in practice are very simple. The evidence of this is the simplicity of binding elements to the ViewModel.</p></div>
<div class="section" title="Binding DOM elements using Knockout"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Binding DOM elements using Knockout</h1></div></div></div><p>There are two basic ways to bind your View elements to the ViewModel. You can either bind it <a id="id11" class="indexterm"/>through the element <code class="literal">data-bind</code> attribute or by using friendly code in JavaScript. Let's begin by creating a page in the <code class="literal">\ko\ko-1\do\</code> folder using the name <code class="literal">binding.htm</code>. The following is the basic standard code for your <code class="literal">do</code> pages throughout the book:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt; 
&lt;/head&gt;
&lt;body&gt;
&lt;script src="/share/js/knockout.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
var viewModel = {
}
ko.applyBindings(viewModel);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>The first part of using Knockout is to include the library JS file. Then we need to create the <a id="id12" class="indexterm"/>ViewModel. At this time, the ViewModel is similar to a class file as it does not do anything until we bind it using Knockout's <code class="literal">applyBindings</code> method. The name of the Model does not matter to Knockout as long, of course, as it does not conflict with JS or some other currently running library.</p><div class="section" title="Binding text"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Binding text</h2></div></div></div><p>To bind the <a id="id13" class="indexterm"/>text to the ViewModel, use the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to the ViewModel:<div class="informalexample"><pre class="programlisting">var viewModel = {
  <span class="strong"><strong>myVariable: ko.observable()</strong></span>}</pre></div></li><li class="listitem">We will use the <code class="literal">data-bind</code> attribute to tell Knockout how to bind our data through the ViewModel. We bind the text attribute of this DOM element to the ViewModel variable <code class="literal">myVariable</code>. After the <code class="literal">body</code> tag, add this code:<div class="informalexample"><pre class="programlisting">My first KnockoutJS uses text binding: &lt;span data-bind="text: myVariable"&gt;&lt;/span&gt;
&lt;hr&gt;</pre></div></li><li class="listitem">We are now ready to run the code. When you look at the code in the browser nothing appears to happen. That is because there is no value assigned to the ViewModel variable, so nothing gets injected into the View. It gives us the following text in the browser window:<div class="mediaobject"><img src="graphics/1028OS_01_02.jpg" alt="Binding text"/></div></li><li class="listitem">Let's add one more line below the line where we bind the ViewModel in our script:<div class="informalexample"><pre class="programlisting">ko.applyBindings(viewModel);
<span class="strong"><strong>viewModel.myVariable("Awesome simple!")</strong></span>;</pre></div></li></ol></div><p>The code gives us a value to be assigned, and when we run the page it shows the data bound to the DOM element. The following text is the output in the browser window:</p><div class="mediaobject"><img src="graphics/1028OS_01_03.jpg" alt="Binding text"/></div><p>Here, we see that the text attribute of the HTML DOM element updated when the variable <a id="id14" class="indexterm"/>was updated. There was no need to directly update the HTML DOM element as the ViewModel feature of Knockout automates this feature. In large and complex data sets, Knockout has been tested as the fastest data bound library. Of course, this consideration might change over time.</p></div><div class="section" title="Binding HTML"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Binding HTML</h2></div></div></div><p>To bind HTML to the <a id="id15" class="indexterm"/>ViewModel use the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the HTML code to the ViewModel:<div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable(),
  <span class="strong"><strong>myHTML: ko.observable()</strong></span>
}</pre></div></li><li class="listitem">Set the value of the <code class="literal">myHTML</code> variable after the binding of the ViewModel:<div class="informalexample"><pre class="programlisting">viewModel.myVariable("Awesome simple!");
<span class="strong"><strong>viewModel.myHTML("&lt;strong&gt;Awesome&lt;/strong&gt; simple!")</strong></span>;</pre></div></li><li class="listitem">Now, we need to bind the HTML attribute of the DOM element. As you can see, the syntax is very similar to the text binding we used in the last binding:<div class="informalexample"><pre class="programlisting">My second KO uses HTML binding:
&lt;div data-bind="html: myHTML"&gt;&lt;/div&gt;
&lt;hr&gt;</pre></div></li></ol></div><p>If we pass HTML through to the text element, it does not display correctly, and that is why DOM has a particular HTML attribute for appropriate tags. When we use the text approach, Knockout escapes the results and using HTML, places the results the way it would look in an editor. The HTML attribute does not exist every time the text attribute exists, but it is pretty safe to assume that the text does exist any time we find the HTML at this point. When we render again, Knockout renders the text as shown here:</p><div class="mediaobject"><img src="graphics/1028OS_01_04.jpg" alt="Binding HTML"/></div></div><div class="section" title="Binding CSS"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Binding CSS</h2></div></div></div><p>To bind CSS to<a id="id16" class="indexterm"/> the ViewModel go through the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the myLeft and myRight variables to the ViewModel:<div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable()
  ,myHTML: ko.observable()
  <span class="strong"><strong>,myLeft: ko.observable()</strong></span>
  <span class="strong"><strong>,myRight: ko.observable()</strong></span>
}</pre></div></li><li class="listitem">Set the values of the <code class="literal">myLeft</code> and <code class="literal">myRight</code> variables after the binding of the ViewModel:<div class="informalexample"><pre class="programlisting">viewModel.myVariable("Awesome simple!");
viewModel.myHTML("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");
<span class="strong"><strong>viewModel.myLeft("pullLeft");</strong></span>
<span class="strong"><strong>viewModel.myRight("pushRight");</strong></span>
</pre></div></li><li class="listitem">Use the CSS attribute to the <code class="literal">data-bind</code> setting to manage CSS dynamically through the ViewModel. This could be changed at any time, and the elements would reflect the CSS settings based on how, of course, the individual browser responds to those CSS settings.<div class="informalexample"><pre class="programlisting">&lt;div data-bind="css: myLeft"&gt;LEFT&amp;nbsp;&lt;/div&gt;
&lt;div data-bind="css: myRight"&gt;&amp;nbsp;RIGHT&lt;/div&gt;
My third KO uses CSS binding:
&lt;hr&gt;</pre></div></li></ol></div><p>When we render again, Knockout renders the text as shown here:</p><div class="mediaobject"><img src="graphics/1028OS_01_05.jpg" alt="Binding CSS"/></div></div><div class="section" title="Binding numbers"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Binding numbers</h2></div></div></div><p>The following <a id="id17" class="indexterm"/>steps will explain how to bind numbers to the ViewModel:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to the ViewModel:<div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable()
  ,myHTML: ko.observable()
  ,myLeft: ko.observable()
  ,myRight: ko.observable()
  <span class="strong"><strong>,myBalance: ko.observable()</strong></span>
}</pre></div></li><li class="listitem">Set the value of the <code class="literal">myBalance</code> variable after the binding of the ViewModel:<div class="informalexample"><pre class="programlisting">viewModel.myVariable("Awesome simple!"); 
viewModel.myHTML("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");
viewModel.myLeft("pullLeft");
viewModel.myRight("pushRight");
<span class="strong"><strong>viewModel.myBalance(-47.23);</strong></span>
</pre></div></li></ol></div><p>Here, we <a id="id18" class="indexterm"/>explore our first <code class="literal">data-bind</code> where we are binding to more than one setting at the same time via the HTML markup. Notice that we also wrapped the element with an additional outer element to allow us to set the color for the balance based on whether it is negative or not. When we are doing this, we can insert a bit of JavaScript into the setting. When using JavaScript, we refer to <code class="literal">myBalance</code> as a function and not as a variable because that is how we interact with it in JavaScript. Take a look at the following code:</p><div class="informalexample"><pre class="programlisting">My fourth KO uses Style binding:&lt;br&gt;
Balance = &lt;span data-bind="style: { color: myBalance() &lt; 0 ? 'red' : 'black' }"&gt;&lt;span data-bind="text:myBalance"&gt;&lt;/span&gt;&lt;/span&gt;
&lt;hr&gt;</pre></div><p>When we render again, Knockout renders the text as shown here:</p><div class="mediaobject"><img src="graphics/1028OS_01_06.jpg" alt="Binding numbers"/></div></div><div class="section" title="Managing visibility"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Managing visibility</h2></div></div></div><p>To manage <a id="id19" class="indexterm"/>visibility of the elements in the ViewModel, use the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to the ViewModel:<div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable()
  ,myHTML: ko.observable()
  ,myLeft: ko.observable()
  ,myRight: ko.observable()
  ,myBalance: ko.observable()
  <span class="strong"><strong>,isVisible: ko.observable()</strong></span>
}</pre></div></li><li class="listitem">Set the value of the <code class="literal">isVisible</code> variable after the binding of the ViewModel:<div class="informalexample"><pre class="programlisting">viewModel.myVariable("Awesome simple!"); 
viewModel.myHTML("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");
viewModel.myLeft("pullLeft");
viewModel.myRight("pushRight");
viewModel.myBalance(-47.23);
<span class="strong"><strong>viewModel.isVisible(true);</strong></span>
</pre></div></li><li class="listitem">Scripting <a id="id20" class="indexterm"/>can be a very powerful technique to use as your skills with Knockout advance. It can add a sense of automation and value to the user experience. Insert the following code after the <code class="literal">body</code> tag:<div class="informalexample"><pre class="programlisting">My fifth KO uses visible binding:
&lt;div data-bind="visible: isVisible"&gt;Warning, the visible property is set to true.&lt;/div&gt;
&lt;hr&gt;</pre></div></li></ol></div><p>When we render again, Knockout renders the text as shown here. Try, of course, changing the value to <code class="literal">false</code> and run it again to see that it is working correctly for you.</p><div class="mediaobject"><img src="graphics/1028OS_01_07.jpg" alt="Managing visibility"/></div></div><div class="section" title="Multibound control"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Multibound control</h2></div></div></div><p>The ViewModel does not need to be updated this time as the technique we are discussing is <a id="id21" class="indexterm"/>managed from the HTML DOM element side. We need to set the value of the <code class="literal">data-bind</code> variable for both color and text as follows:</p><div class="informalexample"><pre class="programlisting">viewModel.myVariable("Awesome simple!");
<span class="strong"><strong>viewModel.myHTML("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");</strong></span>
</pre></div><p>Here, we explore our first <code class="literal">data-bind</code> where we are binding to more than one setting at the same time via the HTML markup. Using the bracketed form, we nest a slight amount of JavaScript right into the markup. Again, keep in mind that when you are using the JavaScript functionality you have to deal with the ViewModel attribute as a function and not as a variable. It is good to watch out for this as it is a common thing for new Knockout developers to overlook. Here is the code to add after the <code class="literal">body</code> tag:</p><div class="informalexample"><pre class="programlisting">My sixth KO uses multi-binding:
Balance = &lt;span data-bind="style: { color: myBalance() &lt; 0 ? 'red' : 'black' },text:myBalance"&gt;&lt;/span&gt;</pre></div><p>When we render again, Knockout renders the text shown here:</p><div class="mediaobject"><img src="graphics/1028OS_01_08.jpg" alt="Multibound control"/></div><p>Try changing the <a id="id22" class="indexterm"/>number and running it to get the number to show both black and red depending, of course, on having the right number setting in the code. You could even change the logic if you choose to.</p></div></div>
<div class="section" title="Power development using browser developer tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Power development using browser developer tools</h1></div></div></div><p>I suggest using the tools in <a id="id23" class="indexterm"/>Google Chrome for this book. The first tool that did a real good job was the Firefox tool called <a id="id24" class="indexterm"/>
<span class="strong"><strong>Firebug</strong></span>. Firebug is still a great tool, and the built-in developer tools in Firebug have made tremendous advances. You should also enjoy <a id="id25" class="indexterm"/>using the tools in <a id="id26" class="indexterm"/>Safari if you are a Mac user. If you are a die-hard fan of Internet Explorer, they have done a good job with the developer tools there as well. My point is, it is better to use developer tools everywhere, so don't make excuses to not use the developer tools in whatever browser you are using.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>If you happen to be working on or wanting to learn to build Chrome extensions and apps then here's how to enable developer mode. In the Chrome browser, click on the menu button next to the address bar. It is an icon with three lines stacked on top of each other. Under the selections on the side, click on <span class="strong"><strong>Extensions</strong></span>, and you will see a checkbox at the top-right for <span class="strong"><strong>Developer mode</strong></span>. Search on Google for more details as this is just a tip to whet your appetite.</p></div></div><p>When in Chrome, all you need to do to load the developer tools is press <span class="emphasis"><em>F12</em></span> on a PC, and on a Mac use Command + <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>I</em></span>. You can also find them by looking under the Chrome menu. This button can be found on the right of the address bar as three stacked lines. Under <span class="strong"><strong>More tools</strong></span> you will see the option for developer tools.</p><p>You can see it there for Windows, Mac, and even for the browser on the Chrome OS. When you click on it, the following window appears at the bottom of the browser:</p><div class="mediaobject"><img src="graphics/1028OS_01_09.jpg" alt="Power development using browser developer tools"/></div><p>We will not get <a id="id27" class="indexterm"/>into all the features of this tool because that would demand an entire book. We are just going to focus on a few key features, making it easier to debug your code while learning Knockout. You may want to undock the tools from the bottom of the browser. To do so, click on the pair of stacked boxes right next to the close (<span class="strong"><strong>x</strong></span>) button at the upper right. This makes the tools appear in a separate window.</p><p>The console is the main thing we are interested in at the moment, so if you do not have it selected, click on it in the top bar of the developer tools. This gives you a prompt that looks very similar to a command-line prompt. When you start typing text, if there are variables or structures active in the browser DOM, it will bring it up with code hinting.</p><div class="mediaobject"><img src="graphics/1028OS_01_10.jpg" alt="Power development using browser developer tools"/></div><p>Select <span class="strong"><strong>viewModel</strong></span> and then press the period. Notice that in the hinting there are all the model properties you created, listed with a few other variable settings. Select <span class="strong"><strong>viewModel.myHtml</strong></span> and hit <span class="emphasis"><em>Enter</em></span>. What you see is a function. To get the results you need to add parentheses to the end of the variable—for example, <span class="strong"><strong>viewModel.myHtml()</strong></span>—and try again. You could retype it all, but you can also use the up and down arrows to cycle through recent command prompt entries if desired. This returns the value currently held in the ViewModel variable setting.</p><div class="mediaobject"><img src="graphics/1028OS_01_11.jpg" alt="Power development using browser developer tools"/></div><p>Now we take it to the next level and use the same variable to change the value right from the command prompt. What we need to do is to watch the screen closely as we press the <span class="emphasis"><em>Enter</em></span> key because we can see the power of having the data bound to the View through the ViewModel. Enter the following in the command prompt:</p><div class="informalexample"><pre class="programlisting">viewModel.myHTML("Knockout is &lt;strong&gt;Awesome&lt;/strong&gt;!")</pre></div><p>What you should<a id="id28" class="indexterm"/> see is the HTML of the second binding we entered updated automatically. That is a much easier way to work with the View than traditional JavaScript. For those who are wondering, it is also very compatible with jQuery. It can be used with all kinds of libraries though you should be careful to check them before considering them a match to make sure it is a good pair.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>You should also note that while we have been naming our ViewModel <code class="literal">viewModel</code>, it could be named any valid variable name. We are doing this just to help drive in the concept that this is our variable for the ViewModel.</p></div></div><p>Now let's use the balance in the calculation from the command console. Let's try entering the following: </p><div class="informalexample"><pre class="programlisting">viewModel.myBalance()*2 </pre></div><p>When we do, we should get -94.46 as the result, or another number if you entered in something different.</p><div class="section" title="The Knockout debugger"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>The Knockout debugger</h2></div></div></div><p>This is what the <a id="id29" class="indexterm"/>Knockout context shows when you are in the <span class="strong"><strong>Elements</strong></span> view:</p><div class="mediaobject"><img src="graphics/1028OS_01_12.jpg" alt="The Knockout debugger"/></div><p>The add-in is available at the Chrome Web Store. It is a great store, and lots of the items worth getting are free. One of these items is the <span class="strong"><strong>KnockoutJS context debugger</strong></span> which is <a id="id30" class="indexterm"/>released under an MIT license. The <a id="id31" class="indexterm"/>source code of this tool is on GitHub, which is very useful if you get large nested ViewModels. It has several features and provides great benefits when learning Knockout and building sites with it. To download<a id="id32" class="indexterm"/> this add-in use the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <a class="ulink" href="https://chrome.google.com/webstore/">https://chrome.google.com/webstore/</a>.</li><li class="listitem">Type <code class="literal">knockout</code> in the search box.</li><li class="listitem">Under <span class="strong"><strong>Extensions</strong></span> you should see <span class="strong"><strong>Knockoutjs context debugger</strong></span> by timstuyckens.</li></ol></div><p>Another thing that would help when working with Knockout or any data-binding library is the ability to trace what is going on. But this tool expands our reach beyond that ability. Select <span class="strong"><strong>KnockoutJS</strong></span> from the top of the developer tools and you will see a button that says <span class="strong"><strong>Enable Tracing</strong></span>. Click on it and go to the <span class="strong"><strong>Console</strong></span> tab. Now enter the following code, and you will see all the changes to your DOM being dumped in the console window:</p><div class="informalexample"><pre class="programlisting">for(i=0;i&lt;10;i++){viewModel.myBalance(1.1*i);}</pre></div><div class="mediaobject"><img src="graphics/1028OS_01_13.jpg" alt="The Knockout debugger"/></div></div><div class="section" title="Shortcuts"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Shortcuts</h2></div></div></div><p>While this may be a big gain for those who have never fired up the developer tools in a browser, let's look at a few things that could make working with the tools even better. One of those things is shortcuts. Right beside the button to open the tools in their own window or put them back in the footer section of the browser window, there is a <span class="strong"><strong>Settings</strong></span> button. Click <a id="id33" class="indexterm"/>on it and <a id="id34" class="indexterm"/>you will see three side menu items. The last one is <span class="strong"><strong>Shortcuts</strong></span>. Skim through this and it will help all shortcut lovers to do things even faster. You can also find a<a id="id35" class="indexterm"/> full list of the shortcuts at <a class="ulink" href="https://developer.chrome.com/devtools/docs/shortcuts">https://developer.chrome.com/devtools/docs/shortcuts</a>, which you could print out or perhaps just bookmark the page.</p><div class="section" title="The DOM inspection"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>The DOM inspection</h3></div></div></div><p>In the browser window where we have the "LEFT" content wrapped in our <code class="literal">div</code> tag, right-click on it and select <span class="strong"><strong>Inspect Element</strong></span>. (On a Mac, you can use double fingers to do the right-click.) This selects the element, and you will be able to see any <code class="literal">data-bind</code> attribute settings that <a id="id36" class="indexterm"/>might exist for that element as well as any other DOM features.</p><p>You can even play around with the DOM and double-click inside the elements panel to edit the DOM live. Live editing is one of my favorite features. What you need to understand is that the View binds to the ViewModel when you instantiate it via a script. You cannot change that by editing the DOM code in that panel. You can also edit the CSS and JavaScript on the page for testing and debugging in amazing ways and this, in my opinion, is a must-learn developer skill.</p></div><div class="section" title="The AJAX inspection"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>The AJAX inspection</h3></div></div></div><p>It is an indispensable tool for me, when working with AJAX, to see what goes out and back <a id="id37" class="indexterm"/>using the <span class="strong"><strong>Network</strong></span> Tab. You can see there is an XHR item in the listing, which allows you to view individual requests that arise while working on a page.</p></div><div class="section" title="The resource inspection"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>The resource inspection</h3></div></div></div><p>We at SOSensible, my <a id="id38" class="indexterm"/>company, have built all kinds of web applications. One kind of web application allows the user to go offline with a web app. We needed to store the data in a browser-based database store and this tool let us inspect all those resources under the <span class="strong"><strong>Resources</strong></span> tab.</p></div><div class="section" title="The device emulation"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>The device emulation</h3></div></div></div><p>In the bottom section of the developer tools, there is a section<a id="id39" class="indexterm"/> called drawer. If it is not showing, the <a id="id40" class="indexterm"/>menu buttons at the top-right have a button to hide or show the drawer. Once it is visible, you have a menu item for <span class="strong"><strong>Emulation</strong></span>. This lets you refresh the screen to show a close emulation of what the view would be like on a particular device size and rotation.</p><p>There are a couple of items on the sidebar that also help with other features. There is a setting called <span class="strong"><strong>Device</strong></span> to pick the device to emulate. There is a setting named <span class="strong"><strong>Screen</strong></span> to manage the rotation and many other features you may want to customize. There is also <span class="strong"><strong>User Agent</strong></span> to spoof the server into thinking it is a different device. Lastly, there is <span class="strong"><strong>Sensors</strong></span> that allows you to set geolocation and accelerometer values.</p></div></div></div>
<div class="section" title="Using internal functions with Knockout"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Using internal functions with Knockout</h1></div></div></div><p>The <code class="literal">applyBindings</code> method in the previously explained bindings section uses a common structure. We included that example in case you cross code written in that style. It will help you understand it <a id="id41" class="indexterm"/>if you see it someone else's code that is using that approach. Another style of coding is to declare the Model with a function declaration. The DOM markup or View code does not change for either scenario. Let's convert our binding example to a functional declaration. Copy the <code class="literal">binding.htm</code> file and create a new file called <code class="literal">functions.htm</code> in the same folder. Here is the original declaration:</p><div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable()
  ,myHTML: ko.observable()
  ,myLeft: ko.observable()
  ,myRight: ko.observable()
  ,myBalance: ko.observable()
  ,isVisible: ko.observable()
};</pre></div><p>Note that we could have set the values of the observables immediately along with the declaration. If we had done that it would have looked like this:</p><div class="informalexample"><pre class="programlisting">var viewModel = {
  myVariable: ko.observable("Awesome simple!")
  ,myHTML: ko.observable("&lt;strong&gt;Awesome&lt;/strong&gt; simple!")
  ,myLeft: ko.observable("pullLeft")
  ,myRight: ko.observable("pushRight")
  ,myBalance: ko.observable(-47.23)
  ,isVisible: ko.observable(true)
};</pre></div><p>We are doing this to tighten our code for the sake of the book. You should use good logic when choosing which way to do this in your code. There are times where using this style of coding is important, but often it is just a matter of the coder's style. Beware of letting your style keep you from considering which one is best as you write the code.</p><p>Now we will look at moving the code over to a functional declaration. We start, of course, with a different kind of declaration because it is a function as appears here:</p><div class="informalexample"><pre class="programlisting">function viewModel() {
// add declarations here}</pre></div><p>It would be equally valid to declare the ViewModel as follows. There is no significant difference:</p><div class="informalexample"><pre class="programlisting">viewModel = function() {
// add declarations here}</pre></div><p>Now, we will look at adding our ViewModel items back in. In the structured approach we just described, the items were entered as collection items with the classic comma separator. In this model, each item is a parameter and is terminated by a semi-colon:</p><div class="informalexample"><pre class="programlisting">viewModel = function() {
this.myVariable = ko.observable("Awesome simple!");
this.myHTML = ko.observable("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");
this.myLeft = ko.observable("pullLeft");
this.myRight = ko.observable("pushRight");
this.myBalance = ko.observable(-47.23);
this.isVisible = ko.observable(true);}</pre></div><p>Note that we<a id="id42" class="indexterm"/> declared each of these items with the <code class="literal">this</code> scope declaration, which refers to the ViewModel object. When programming in JavaScript, it is common practice to alias <code class="literal">this</code> to avoid scope confusion. We will rewrite the previous code one more time using <code class="literal">self</code> rather than <code class="literal">this</code> as the base scope:</p><div class="informalexample"><pre class="programlisting">viewModel = function() {
  var self = this;
self.myVariable = ko.observable("Awesome simple!");
self.myHTML = ko.observable("&lt;strong&gt;Awesome&lt;/strong&gt; simple!");
self.myLeft = ko.observable("pullLeft");
self.myRight = ko.observable("pushRight");
self.myBalance = ko.observable(-47.23);
self.isVisible = ko.observable(true);}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Note that we set the <code class="literal">self</code> variable using a var declaration. This prevents issues of external naming conflicts.</p></div></div><p>Now, if we run the page for <code class="literal">functions.htm</code> from our browser, it should run identical to our <code class="literal">binding.htm</code> file. Yet, there is a difference. This will help you understand why we introduced the developer tools where we did in the course. Open the tools and in the command prompt, enter <code class="literal">viewModel.isHTML()</code> to see what you get as a result:</p><div class="mediaobject"><img src="graphics/1028OS_01_14.jpg" alt="Using internal functions with Knockout"/></div><div class="section" title="Preventing hidden features"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Preventing hidden features </h2></div></div></div><p>In the previous screenshot we obtained the what you might think is an unexpected result  as the View is obviously bound to the <a id="id43" class="indexterm"/>ViewModel. The issue here is an issue of the <a id="id44" class="indexterm"/>concept of <span class="strong"><strong>closure</strong></span>. You are welcome to explore more about closure if you wish but just realize it means parts of an object or the item contents are there but hidden. When this type of declaration is made in this style, you cannot interact with it from JavaScript. The declaration should have been made with <code class="literal">new</code> to create an object from the function as follows:</p><div class="informalexample"><pre class="programlisting">ko.applyBindings(new viewModel());</pre></div><p>If you run the browser and try to connect to the ViewModel now, you will see that it is still having the same issue with closure. We found this is the best way to work around it at my company:</p><div class="informalexample"><pre class="programlisting">vm = new viewModel();
ko.applyBindings(viewModel);</pre></div><p>Now, we will reference the Model using <code class="literal">vm</code> rather than <code class="literal">viewModel</code> and this is the result we will get:</p><div class="mediaobject"><img src="graphics/1028OS_01_15.jpg" alt="Preventing hidden features"/></div><p>We see that by declaring the object outside the argument passed to our Knockout <code class="literal">applyBindings</code> method, we avoided the closure issue. This is not an issue when using the structured style of ViewModel declaration. Hopefully, this saves you from hours of wondering what is wrong with your code or if Knockout is broken. We will not answer how much time I burned on this the first time it occurred, but it was long after I started using Knockout. It says that even experts can make rookie mistakes. I humbled myself and asked the community for help, and the answer came pretty fast.</p></div></div>
<div class="section" title="Automating calculations with Knockout"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Automating calculations with Knockout</h1></div></div></div><p>In this section, we <a id="id45" class="indexterm"/>will take functions to a deeper level.</p><p>In the code bundle of chapter 1 <code class="literal">do</code> folder (<code class="literal">/ko_1/do/</code>), copy the <code class="literal">base.htm</code> file as <code class="literal">computed.htm</code> for this segment. After the leading <code class="literal">body</code> tag, put in the following View code:</p><div class="informalexample"><pre class="programlisting">&lt;table&gt;
    &lt;tr&gt;
        &lt;th style="width:20%;"&gt;
            Item
        &lt;/th&gt;
        &lt;th style="width:40%;"&gt;
            Qty
        &lt;/th&gt;
        &lt;th&gt;
            Price
        &lt;/th&gt;
        &lt;th&gt;
            Tally
        &lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td style="width:20%;"&gt;
            &lt;em data-bind="text:item_1"&gt;Item&lt;/em&gt;
        &lt;/td&gt;
        &lt;td style="width:40%;"&gt;
            &lt;input type="text" data-bind="value:qty_1" /&gt;
        &lt;/td&gt;
        &lt;td&gt;
            &lt;span data-bind="text:price_1"&gt;&lt;/span&gt;
        &lt;/td&gt;
        &lt;td&gt;
            &lt;span data-bind="text:tally_1"&gt;&lt;/span&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;</pre></div><p>Now we are <a id="id46" class="indexterm"/>ready to create the scripted side of the Knockout ViewModel code. Place this code inside the <code class="literal">script</code> tag after the KnockoutJS library is included:</p><div class="informalexample"><pre class="programlisting">calcModel = function(){
    var self = this;
    self.item_1 = ko.observable('Cell Phone');
    self.qty_1 =  ko.observable(0);
    self.price_1 = ko.observable(149.95);
    self.tally_1 = ko.computed(function(){
        var rslt = (+self.qty_1() * self.price_1()).toFixed(2);
        return rslt;
    },self);
}
vm = new calcModel();
ko.applyBindings(vm);</pre></div><p>Notice that the computed function is now doing live calculations. We also added a fixed decimal position of two places. Enter a quantity to test:</p><div class="mediaobject"><img src="graphics/1028OS_01_16.jpg" alt="Automating calculations with Knockout"/></div><p>Create a second <a id="id47" class="indexterm"/>row of the table and the ViewModel that matches the features of the first row. I want you to create this on your own to make sure you are getting the skills as you go along here. You could, of course, peek at the example in the <code class="literal">done</code> folder, but you should try it on your own first.</p><div class="section" title="Subtotal calculation"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Subtotal calculation</h2></div></div></div><p>Now add this <a id="id48" class="indexterm"/>row to the bottom of the table to create a row for the subtotal. You can also see we created a cell in the table to tally the number of items in <code class="literal">qty_1</code> and <code class="literal">qty_2</code>:</p><div class="informalexample"><pre class="programlisting">&lt;tr&gt;
    &lt;td style="width:20%;"&gt;
        &amp;nbsp;
    &lt;/td&gt;
    &lt;td style="width:40%;"&gt;
        &lt;span data-bind="text:t_qty"&gt;&lt;/span&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;em&gt;subTotal&lt;/em&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;span data-bind="text:subTotal"&gt;&lt;/span&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre></div><p>You also need to put the script code into the correct locations:</p><div class="informalexample"><pre class="programlisting">    self.item_2 = ko.observable('Cell Case');
    self.qty_2 = ko.observable(0);
    self.price_2 = ko.observable(19.45);
    self.tally_2 = ko.computed(function(){
        var rslt = (+self.qty_2() * self.price_2()).toFixed(2);
        return rslt;
    },self);
    self.t_qty = ko.computed(function(){
        return +(self.qty_1()) + +(self.qty_2());
    },self);
    self.subTotal = ko.computed(function(){
        var rslt = (+(self.tally_1()) + +(self.tally_2())).toFixed(2);
        return rslt;
    });</pre></div><p>You may have <a id="id49" class="indexterm"/>noticed that we placed an extra <code class="literal">+</code> before some of the variables. This is a standard JavaScript approach to making sure the number entered into the input box comes out as a number. In some browsers and some conditions the number is the string representation of the number. The addition of <code class="literal">+</code> solves this issue.</p><p>Now run the page and enter the quantity to ensure that all of your calculations are working:</p><div class="mediaobject"><img src="graphics/1028OS_01_17.jpg" alt="Subtotal calculation"/></div></div><div class="section" title="Tax time"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Tax time</h2></div></div></div><p>What fun would buying things be without paying taxes? Well, either way it is a function we all <a id="id50" class="indexterm"/>need to get right. Add the following code to the table to have a row for taxes:</p><div class="informalexample"><pre class="programlisting">    &lt;tr&gt;
        &lt;td style="width:20%;"&gt;
            &amp;nbsp;
        &lt;/td&gt;
        &lt;td style="width:40%;"&gt;
            ( rate  in decimal &lt;input data-bind="value: taxRate;" /&gt; )
        &lt;/td&gt;
        &lt;td&gt;
            &lt;em&gt;Tax&lt;/em&gt;
        &lt;/td&gt;
        &lt;td&gt;
            &lt;span data-bind="text:taxed"&gt;&lt;/span&gt;
        &lt;/td&gt;
    &lt;/tr&gt;</pre></div><p>Now add the code here to the <code class="literal">script</code> section of the page to make our ViewModel run smartly. Our goal is not to write the most efficient code in all of the world but rather to expose <a id="id51" class="indexterm"/>you to learning to think the Knockout way:</p><div class="informalexample"><pre class="programlisting">    self.tax = ko.observable(.05);
    self.taxed = ko.computed(function(){
        return +(self.subTotal()*self.tax()).toFixed(2);
    });
    self.taxRate = ko.computed({
        read: function(){
            return self.tax()*100 + '%';
        },
        write: function(value){
            value = parseFloat(value.replace(/[^\.\d]/g, ""));
            self.tax(+value/100);
        }
    });</pre></div><p>If we were coding the page with standard JavaScript or even with jQuery to get the amount of functionality we have achieved, it would take many multiples of the code we have on the page here. This approach is far more elegant and much smaller.</p><p>Notice how our <code class="literal">taxRate</code> is done just a little differently. Calculation functions in Knockout can read and write. You can also call other external resources because it is standard script code. Note that in our scripted code we have to place the values in parentheses to do the assignments as we did to the tax value.</p><p>You should also notice that we are converting the value in and out of decimal format and adding a percentage to the displayed value of the taxes in the input box. It also smartly strips the percent mark off if you enter it when updating the tax rate.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>Regular expressions like the one used in our <code class="literal">write</code> method are a way to supercharge your apps. Make it a point to learn at least basic regular expressions. If you do not know how to do the advanced stuff, you can often find what you need either in a Google search, or some "happy guru" will volunteer to assist you with a winning answer in some online forum.</p></div></div><p>Refresh the page with the updates, and you will see that even the actual tax amount has been calculated in the <span class="strong"><strong>Tally</strong></span> column:</p><div class="mediaobject"><img src="graphics/1028OS_01_18.jpg" alt="Tax time"/></div></div><div class="section" title="Final total"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Final total</h2></div></div></div><p>Here we have<a id="id52" class="indexterm"/> the final segment of the View code for our calculation example:</p><div class="informalexample"><pre class="programlisting">&lt;tr&gt;
    &lt;td style="width:20%;"&gt;
        &amp;nbsp;
    &lt;/td&gt;
    &lt;td style="width:40%;"&gt;
        &amp;nbsp;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;em&gt;Total&lt;/em&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;span data-bind="text:total"&gt;&lt;/span&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre></div><p>The last piece of script code should be added to the ViewModel. There is nothing fancy about this section of code other than its ability to complete our functionality. We add in the value of the taxed item here, and again, we wrap the numbers with a parentheses and use the <code class="literal">toFixed</code> function to set the answer to two decimal places.</p><div class="informalexample"><pre class="programlisting">    self.total = ko.computed(function(){
        var rslt = (+self.subTotal() + self.taxed()).toFixed(2);
        return rslt;
    });</pre></div><p>Now we can run the code and play with the entry boxes to see that everything is working as expected. For new developers, it may not surprise you to see how little code it takes to make a page like this work. It used to take so much code that hardly anyone anywhere would take the time to attempt building tools like this. It was compounded because things worked differently from one browser to the next. While this is still true, libraries like Knockout remove many of those pains and let us concentrate on the results instead of the platforms.</p><p>Running the<a id="id53" class="indexterm"/> code now should give us results similar to this screen capture:</p><div class="mediaobject"><img src="graphics/1028OS_01_19.jpg" alt="Final total"/></div></div></div>
<div class="section" title="Working with non-Knockout functions"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Working with non-Knockout functions</h1></div></div></div><p>Now, we will add <a id="id54" class="indexterm"/>an external function to show an alternate way to format values in the View. You are going to make one more pass at modifying the <code class="literal">computed.htm</code> example we just worked on. First at the top of the script, add a function with the following code:</p><div class="informalexample"><pre class="programlisting">dollarFormat = function(value){
    return "$ "+value;
}</pre></div><p>Now go into the View and change the final total as follows. Test it to make sure you got it right and then change all of them if you desire:</p><div class="informalexample"><pre class="programlisting">&lt;span data-bind="text:dollarFormat(total())"&gt;&lt;/span&gt;</pre></div><p>This is what the page looks like with the last item formatted as a dollar amount:</p><div class="mediaobject"><img src="graphics/1028OS_01_20.jpg" alt="Working with non-Knockout functions"/></div><p>We could have added an external function that is used inside a calculation to show its use inside the ViewModel. You are still left with some work to do as you will have to choose the best place to put things like that. Perhaps, in a couple of versions, these tools will just magically do it all for us. Well, even if they did, there will be new needs and we will still have a good opportunity to solve issues through code for those we serve.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Summary</h1></div></div></div><p>You now have a taste of the benefits of KnockoutJS. This is just the beginning of the power of KnockoutJS. The benefit of Knockout is that it solves problems that libraries like jQuery do not solve, and yet has the ability to work side by side if needed. Knockout provides both binding and functional intelligence that automate and simplify HTML and coding the same way jQuery simplifies JavaScript coding.</p><p>In the next chapter we will build on this knowledge by learning how to use conditional binding, observable arrays, simplifying nested items, and some keys on how to work with collections.</p></div></body></html>