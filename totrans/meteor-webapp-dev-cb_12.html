<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch12"/>Chapter 12. Creating Useful Projects</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Creating RESTful web services</li><li class="listitem">Creating a complete app with Iron Router</li><li class="listitem">Deploying apps to mobile devices</li><li class="listitem">Adding social sharing</li></ul></div><div><div><div><div><h1 class="title"><a id="ch12lvl1sec82"/>Introduction</h1></div></div></div><p>Somewhere along your journey towards learning Meteor, you'll reach a point where you will have mastered the fundamentals. At that point, you will want to start putting all the fundamentals together into the applications or packages that are actually useful. It's a big development world out there, with many opportunities. The Meteor landscape is still in its infancy, and if you've followed all (or most) of the recipes in this book, you're probably ready to start defining that landscape. This last chapter will walk you through four of the most useful recipes that apply to most projects. It will give you an even more solid foundation for going out on your own to define, discover, and build!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch12lvl1sec83"/>Creating RESTful web services</h1></div></div></div><p>Alas, alas, the <a id="id624" class="indexterm"/>entire development world hasn't caught on to how amazing the DDP protocol is (yet!). Data-over-the-wire is an amazing concept, and we believe that it (or something like it) is the future of how applications will communicate. In the meantime, we have some very useful and well-established protocols that, if implemented in our applications, increase the reach and accessibility of our apps for other platforms.</p><p>The granddaddy of <a id="id625" class="indexterm"/>all of these protocols is REST. REST is mature, well-defined, and has been implemented in nearly every programming language imaginable. It wouldn't surprise us to discover that, if/when we contact an alien race, the first signal will be a <code class="literal">POST</code> request. Given its current status (and our most likely option for peaceful interstellar negotiations), we will want to add REST capabilities to some of our applications. This recipe will walk you through implementing a server-side REST implementation using Iron Router.</p><div><div><div><div><h2 class="title"><a id="ch12lvl2sec299"/>Getting ready</h2></div></div></div><p>Since we're only <a id="id626" class="indexterm"/>dealing with the REST part of an app in this recipe, we don't need anything fancy. A simple, standard Meteor app will do, with just a couple of server-side files.</p><div><div><div><div><h3 class="title"><a id="ch12lvl3sec40"/>Creating the baseline application</h3></div></div></div><p>Open a <a id="id627" class="indexterm"/>terminal window, navigate to where you would like your project root to be, and enter the following:</p><div><pre class="programlisting">
<strong>$ meteor create RESTSample</strong>
<strong>$ cd RESTSample</strong>
<strong>$ rm RESTSample.*</strong>
<strong>$ mkdir -p server/api</strong>
<strong>$ mkdir server/model</strong>
<strong>$ meteor add iron:router</strong>
<strong>$ meteor</strong>
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch12lvl3sec41"/>Installing and configuring Postman</h3></div></div></div><p>We need <a id="id628" class="indexterm"/>a way to manually call our REST service, and the Postman plugin/app for Chrome is as good as any. If you have your own <a id="id629" class="indexterm"/>way of manually calling REST <a id="id630" class="indexterm"/>services, feel free to use it. If not, here's how to install Postman:</p><div><ol class="orderedlist arabic"><li class="listitem">In a browser, navigate to <a class="ulink" href="http://getpostman.com">http://getpostman.com</a> and click on the <strong>Get it now</strong> link <a id="id631" class="indexterm"/>towards the bottom. A preview of the Postman app <a id="id632" class="indexterm"/>will pop up, and towards the top-right corner will be a button to install Postman. Click on that button, follow the directions, and open Postman.</li><li class="listitem">In the request window in Postman, under the <strong>Normal</strong> tab, enter the following URL:<div><pre class="programlisting">
<strong>http://localhost:3000/api/</strong>
</pre></div></li><li class="listitem">Next, click on the <strong>Headers</strong> button, and enter the following under the <strong>Header</strong> | <strong>Value</strong> sections:<div><pre class="programlisting">
<strong>Content-Type | application/json</strong>
</pre></div></li><li class="listitem">When complete, your screen should look like the following screenshot:<div><img src="img/image00424.jpeg" alt="Installing and configuring Postman"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>We're now <a id="id633" class="indexterm"/>ready to build our REST service and <a id="id634" class="indexterm"/>test it using Postman.</p></div></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec300"/>How to do it...</h2></div></div></div><p>Proceed with the <a id="id635" class="indexterm"/>following steps to create RESTful web services:</p><div><ol class="orderedlist arabic"><li class="listitem">First, we will declare the <code class="literal">Quotes</code> collection. Create a file named <code class="literal">[project root]/server/model/quotes.js</code> and add the following code:<div><pre class="programlisting">Quotes = new Mongo.Collection('quotes');</pre></div></li><li class="listitem">Next, we will <a id="id636" class="indexterm"/>add the <code class="literal">writeHeaders</code> function. Create a file named <code class="literal">[project root]/server/api/REST.js</code> and add the following function to the bottom:<div><pre class="programlisting">function writeHeaders(self) {
  self.response.statusCode = 200;
  self.response.setHeader('Content-type', 'application/json');
  self.response.setHeader('Access-Control-Allow-Origin', '*');
  self.response.setHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
}</pre></div></li><li class="listitem">We will now write the code to handle <code class="literal">GET</code> requests. At the very top of the <code class="literal">REST.js</code> file, create the following <code class="literal">Router.route()</code> method call:<div><pre class="programlisting">Router.route('/api', {
    where: 'server'
  })
  .get(function () {
    //write headers
    writeHeaders(this);
    //send our response...
    this.response.end('GET not supported\n');
  });</pre></div><p>Save all of your changes, make sure your app is running, and click on the <strong>Send</strong> button in Postman. In the results section, click on the <strong>Body</strong> tab and the <strong>Raw</strong> button. You should see the following message:</p><div><img src="img/image00425.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><p>Congratulations, you've just created your first REST service!</p></li><li class="listitem">Now, let's move on to <code class="literal">post</code> calls. We are going to assume that a <code class="literal">POST</code> query is asking to see any quotes in our <code class="literal">Quotes</code> collection that are owned by a particular <a id="id637" class="indexterm"/>user. In <code class="literal">REST.js</code>, remove the last semicolon from the <code class="literal">.get()</code> function call (we are chaining <a id="id638" class="indexterm"/>commands, so it's important <a id="id639" class="indexterm"/>that you do this) and add the following <a id="id640" class="indexterm"/>code where you removed the semicolon:<div><pre class="programlisting">.post(function () {
    writeHeaders(this);
    var user = this.request.body.owner;
    if (!user) {
      this.response.end('No user specified...\n');
      return;
    }
    var quotes = Quotes.find({
      owner: user
    }).fetch();
    this.response.end(JSON.stringify(quotes));
  })</pre></div></li><li class="listitem">It doesn't make much sense to test a <code class="literal">POST</code> query until we have some data in our collection, does it? Let's take care of that right now by adding support for <code class="literal">PUT</code>. Immediately after the code you just entered (as a continuation of the function chain), add the following code:<div><pre class="programlisting">.put(function () {
    writeHeaders(this)
    var upQuote = this.request.body.update;
    if (!upQuote) {
      this.response.end('nothing to update');
    }
    var update = Quotes.upsert({
      _id: upQuote.id
    }, {
      $set: upQuote.changes

    });
    this.response.end('Quote accepted!...\n');

  });</pre></div><div><h3 class="title"><a id="note09"/>Note</h3><p>Note that we have a semicolon at the end, which means we're done and can start using our fully functional service!</p></div></li><li class="listitem">In Postman, change the service type from <code class="literal">GET</code> to <code class="literal">PUT</code>. In the input field, click on the <a id="id641" class="indexterm"/>button labeled <strong>raw</strong>, and <a id="id642" class="indexterm"/>enter the <a id="id643" class="indexterm"/>following JSON code:<div><pre class="programlisting">{"update":{
"changes":{"author":"Jerry Pournelle and Larry Niven", "text":"Second guessing God is an old, old game.", "owner":"me"    
}
}}</pre></div><p>Your screen <a id="id644" class="indexterm"/>should look like the following screenshot:</p><div><img src="img/image00426.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Send</strong> button, and in just a few milliseconds, the response area will display the following message:<div><pre class="programlisting">
<strong>Quote accepted!...</strong>
</pre></div></li><li class="listitem">Repeat the preceding steps as many times as you would like, varying the quote/author and owner as desired.</li><li class="listitem">We can now test the <code class="literal">POST</code> query. Change the service type from <code class="literal">PUT</code> to <code class="literal">POST</code>, and enter the following JSON in the input field:<div><pre class="programlisting">{"owner":"me"}</pre></div></li><li class="listitem">Click on the <a id="id645" class="indexterm"/><strong>Send</strong> button, and on the <a id="id646" class="indexterm"/>output window, click <a id="id647" class="indexterm"/>on the <strong>Pretty</strong> button. The output will be some <a id="id648" class="indexterm"/>well-formatted JSON with at least one entry, similar to that in the following screenshot:<div><img src="img/image00427.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>You have just written a simple yet fully functional REST service in Meteor!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec301"/>How it works...</h2></div></div></div><p>The heavy lifting for this recipe is done by Iron Router. When we add the <code class="literal">iron:router</code> package, that package listens for all incoming requests on the server side. We configured Iron Router to listen on the <code class="literal">http://[yourapp.url]/api/</code> route for the <code class="literal">GET</code>, <code class="literal">POST</code>, and <code class="literal">PUT</code> requests. To get Iron Router to listen on that particular route, we used the <code class="literal">Router.route('/api'...)</code> method call. Importantly, we declared that, that route is to be handled on the server side using the <code class="literal">{where: 'server'}</code> parameter.</p><p>Chaining each type of request to the <code class="literal">.route()</code> call, we used the <code class="literal">.get()</code>, <code class="literal">.post()</code>, and <code class="literal">.put()</code> method calls. In each of these, we can read the JSON data passed in with the request by referencing <code class="literal">this.request.body.[key]</code>.</p><p>Finally, we are able to <a id="id649" class="indexterm"/>send a response by using Iron <a id="id650" class="indexterm"/>Router's <code class="literal">response</code> object, which we used to form the headers and to send messages back to the calling client.</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec302"/>There's more…</h2></div></div></div><p>As usual, we've tried to <a id="id651" class="indexterm"/>keep the functionality to a minimum, to reduce the signal-to-noise of what this recipe is about. There's enough here, however, to give you a good taste <a id="id652" class="indexterm"/>of what is possible with REST services using Iron Router. If you would like more information and specifics on what the RESTful functions <a id="id653" class="indexterm"/>in Iron Router can do, please visit the Iron Router guide at: <a class="ulink" href="https://github.com/iron-meteor/iron-router/blob/devel/Guide.md#server-routing">https://github.com/iron-meteor/iron-router/blob/devel/Guide.md#server-routing</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec303"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Creating a multipage application with Iron Router</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li><li class="listitem">The <em>Creating a complete app with Iron Router</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch12lvl1sec84"/>Creating a complete app with Iron Router</h1></div></div></div><p>From <a id="id654" class="indexterm"/>nearly the beginning of Meteor, the development <a id="id655" class="indexterm"/>emphasis has been on "smart" client-based applications. We left the server-dominated world behind a long time ago, and as a result, the single-page model is extremely well-supported inside the Meteor development stack.</p><p>Essential to this type <a id="id656" class="indexterm"/>of application is the <code class="literal">iron:router</code> package (<a class="ulink" href="https://atmospherejs.com/iron/router">https://atmospherejs.com/iron/router</a>). Yes, you technically could build a multi-functional, mobile-first app without Iron Router, but it would be much more time consuming and complex by comparison. Think of Iron Router as the equivalent of using a microwave versus cooking outdoors on a campfire. With no utensils. In a rainstorm. With rabies-carrying raccoons all up in your business. Okay, okay, maybe it's not that bad, but you get the point—you should use Iron Router.</p><p>This recipe will walk you through the building of a fully functional, quote tracking service with a single-page app frontend built using Iron Router.</p><div><div><div><div><h2 class="title"><a id="ch12lvl2sec304"/>Getting ready</h2></div></div></div><p>We would usually add a lot of preparation steps to a recipe, but in this one, we need to build everything in one go as part of the recipe. As such, we are only going to add the bare minimum here.</p><p>Open a terminal window, navigate to where you would like your application root to be, and enter the following commands:</p><div><pre class="programlisting">
<strong>$ meteor create QuotesApp</strong>
<strong>$ cd QuotesApp</strong>
<strong>$ rm QuotesApp.*</strong>
<strong>$ mkdir {client,both}</strong>
<strong>$ meteor add twbs:bootstrap</strong>
<strong>$ meteor</strong>
</pre></div><p>We've got a lot of work to do, so let's get started!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec305"/>How to do it…</h2></div></div></div><p>The major <a id="id657" class="indexterm"/>sections of this recipe are as follows:</p><div><ul class="itemizedlist"><li class="listitem">Creating <a id="id658" class="indexterm"/>the top <code class="literal">navbar</code></li><li class="listitem">Adding user authentication</li><li class="listitem">Adding the <code class="literal">Quotes</code> collection</li><li class="listitem">Adding Iron Router routes</li><li class="listitem">Creating page transition animations</li><li class="listitem">Displaying the <code class="literal">Quotes</code> collection</li><li class="listitem">Adding and editing <code class="literal">Quotes</code></li><li class="listitem">Deploying the App</li></ul></div><p>There will be a little crossover from section to section, but we should be able to keep things fairly clean, so if you would like to switch out some functionality or add some features, feel free to do so as we move along.</p><div><ol class="orderedlist arabic"><li class="listitem">First up, we need to create the top <code class="literal">navbar</code>.<p>We will be using the standard Bootstrap <code class="literal">navbar</code> elements because we don't want to spend a large chunk of time with CSS styling. Once you're more comfortable with CSS, you can extend or replace the Bootstrap styling and make it your own.</p><p>First, since this is a mobile-oriented app, let's set our headers, and use a Google font. Create a new file named <code class="literal">[project root]/client/header.html</code> and add the following declarations:</p><div><pre class="programlisting">&lt;head&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"&gt;
  &lt;link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'&gt;
&lt;/head&gt;</pre></div><p>Create a <a id="id659" class="indexterm"/>new file named <code class="literal">[project root]/client/layout.html</code> and add the following template, which <a id="id660" class="indexterm"/>will act as the foundation for our navigation toolbar:</p><div><pre class="programlisting">&lt;template name="layout"&gt;
  &lt;div class="navbar navbar-default navbar-fixed-top" role="navigation"&gt;
    &lt;div class="navbar-header"&gt;
      &lt;a class="navbar-brand" id="btn-home" href="/"&gt;
        &lt;span class="glyphicon glyphicon-book"&gt;&lt;/span&gt;&lt;/a&gt;
      &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse"&gt;
        &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div class="navbar-collapse collapse"&gt;
      &lt;ul class="nav navbar-nav navbar-right"&gt;
        &lt;!-- Login buttons will go here --&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- App panels will go here--&gt;
&lt;/template&gt;</pre></div><p>We will want to temporarily add a <code class="literal">body</code> element afterwards, just so we can check the display (we will remove it when we implement <code class="literal">iron:router</code>):</p><div><pre class="programlisting">&lt;body&gt;
  {{&gt; layout}}
&lt;/body&gt;</pre></div><p>Lastly, we <a id="id661" class="indexterm"/>have some minor CSS to add, to make sure everything upcoming runs smoothly. Create a file named <code class="literal">[project root]/client/styles.css</code> and add the following CSS declarations:</p><div><pre class="programlisting">body {font-family: 'Raleway', sans-serif;}
.page {vertical-align: top;position: absolute;width: 100%;height: 100%;background-color: #eee;top: 50px;}
.page-detail {background-color: #fff;color: #555;}
.glyphicon-book {font-size: 3rem;line-height: 2rem;}
.toggle-edit{margin-top: 1.4rem;font-size: 2rem;
background-color: #777;border-radius: 50%;
border: none;padding: 1.5rem;width: 5rem;height: 5rem;}
.input-group {margin-top: 1.4rem;}
.quote {font-size:2rem;}
.title {font-size:3rem;}
.author {margin-bottom:2rem;margin-top:1rem;}
.tag {margin:0.25rem;}
.tags {margin-top:1rem;}
.add-quote {height:9rem;}
.add-quote .btn{color:#5bc0de;font-size:4rem;}</pre></div></li><li class="listitem">Next, we <a id="id662" class="indexterm"/>need to add user authentication.<p>Because we've had experience with it in the past, we will enable authentication using Twitter. We will also use some stylized login buttons that fit in with our Bootstrap toolbar. Open a terminal window, navigate to your project root, and enter the following commands:</p><div><pre class="programlisting">
<strong>$ meteor add accounts-twitter</strong>
<strong>$ meteor add ian:accounts-ui-bootstrap-3</strong>
</pre></div><p>We now need to add the <code class="literal">loginButtons</code> template to our toolbar. Open <code class="literal">[project root]/client/layout.html</code> and locate the comment that reads as follows:</p><div><pre class="programlisting">&lt;!-- Login buttons will go here --&gt;</pre></div><p>Replace this comment with the following code:</p><div><pre class="programlisting">{{&gt; loginButtons}}</pre></div><p>Save your changes and navigate to your app in a browser. The top-right corner will contain a <strong>Configure Twitter</strong> button. Click on this button and configure Twitter according to the instructions, just as we did in the <em>Implementing OAuth accounts packages</em> recipe in <a class="link" title="Chapter 10. Working with Accounts" href="part0079.xhtml#aid-2BASE1">Chapter 10</a>, <em>Working with Accounts</em>.</p><p>After configuration, you may want test the login with your Twitter account. If everything is satisfactory, we can move on to the meat of our application.</p></li><li class="listitem">Let's add the <code class="literal">Quotes</code> collection.<p>We're definitely ready to add our <code class="literal">Quotes</code> collection, but we want to have some control over what records will be sent to the client, based on whether the user is logged in or not. To accomplish this, we need to remove <code class="literal">autopublish</code>. In a terminal window, in our project root directory, enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor remove autopublish</strong>
</pre></div><p>Next, create a file named <code class="literal">[project root]/both/model.js</code> and add the following line to that file:</p><div><pre class="programlisting">Quotes = new Mongo.Collection('quotes');</pre></div><p>Ordinarily, we would add a <code class="literal">subscribe</code> command in a client-only file and a <code class="literal">publish</code> command in a server-only file, but the logic is so simple <a id="id663" class="indexterm"/>that we'll just add them directly <a id="id664" class="indexterm"/>to the <code class="literal">model.js</code> file in this case. Add the following code to <code class="literal">model.js</code> and save your changes:</p><div><pre class="programlisting">if (Meteor.isClient) {
  Meteor.subscribe('quotes');
} else {
  Meteor.publish('quotes', function () {
    return Quotes.find({
      owner: this.userId
    });
  })
}</pre></div></li><li class="listitem">Up next, we need to add our Iron Router routes.<p>When you add Iron Router, the changes needed in the running Meteor instance are pretty major. Technically, you could add Iron Router without stopping your app, but we recommend stopping your Meteor app while installing and configuring Iron Router.</p><p>Once you've stopped your app, enter the following command in the terminal window:</p><div><pre class="programlisting">
<strong>$ meteor add iron:router</strong>
</pre></div><p>Let's now declare our default layout template. Create a file named <code class="literal">[project root]/both/router.js</code> and add the following line:</p><div><pre class="programlisting">Router.configure({ layoutTemplate: 'layout' });</pre></div><p>Now that our layout template is being called by Iron Router, we no longer need the body element we temporarily put in the <code class="literal">layout.html</code> file. Open <code class="literal">[project root]/client/layout.html</code> and remove the entire <code class="literal">&lt;body&gt;...&lt;/body&gt;</code> segment.</p><p>We also have a placeholder in <code class="literal">layout.html</code> for our application pages, which we need to fill in with the customary Iron Router yield directive. In <code class="literal">layout.html</code>, locate the following line:</p><div><pre class="programlisting">&lt;!-- App panels will go here--&gt;</pre></div><p>Replace that line with the following code:</p><div><pre class="programlisting">{{&gt; yield}}</pre></div><p>We have <a id="id665" class="indexterm"/>two routes to create, so let's do that <a id="id666" class="indexterm"/>now. Open <code class="literal">[project root]/both/router.js</code> and add the following <code class="literal">Router.map</code> declaration:</p><div><pre class="programlisting">Router.map(function(){
  this.route('main', {
    path: '/',
    template:'main'
  });
  this.route('detail', {
    path: '/quote/:_id',
    template:'detail', data: function () {
      return Quotes.findOne({_id: this.params._id});
    }
  });
});</pre></div><p>We've created our routes, and now we need to create placeholder templates for those routes. Create a file named <code class="literal">[project root]/client/main.html</code> and add the following template:</p><div><pre class="programlisting">&lt;template name="main"&gt;
  &lt;div class="page"&gt;
    &lt;h1&gt;this is the main page&lt;/h1&gt;
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>Create a file named <code class="literal">[project root]/client/detail.html</code> and add the following template:</p><div><pre class="programlisting">&lt;template name="detail"&gt;
  &lt;div class="page page-detail"&gt;
    &lt;h1&gt;this is the detail page&lt;/h1&gt;
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>You can <a id="id667" class="indexterm"/>now start your app back <a id="id668" class="indexterm"/>up (enter the <code class="literal">meteor</code> command in your terminal) and test the routes. As you navigate to <code class="literal">http://localhost:3000</code> and to <code class="literal">http://localhost:3000/quote/1234</code>, you should see pages similar to those in the following screenshot:</p><div><img src="img/image00428.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We will now create page transition animations.<p>There's an excellent Atmosphere package out there called <code class="literal">momentum</code>. With an Iron Router-specific package created by Percolate Studios, we can extend <code class="literal">momentum</code> to do Iron Router route transitions with very little fuss. In a terminal window, enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor add percolate:momentum-iron-router</strong>
</pre></div><p>Create a file named <code class="literal">[project root]/client/transitions.js</code> and add the following transition declaration as a <code class="literal">Template</code> helper:</p><div><pre class="programlisting">Template.layout.helpers({
  transition: function () {
    return function (from, to, element) {
      if (to.template=="main") return 'left-to-right';
      return 'right-to-left';
    }
  }
});</pre></div><p>We also <a id="id669" class="indexterm"/>need to surround our <code class="literal">{{&gt; yield}}</code> inclusion with the <code class="literal">momentum</code> template helper. Open <code class="literal">layout.html</code> <a id="id670" class="indexterm"/>and add the following wrapper around the inclusion:</p><div><pre class="programlisting">
<strong>{{#momentum plugin='iron-router' options=transition}}</strong>
      {{&gt; yield}}
<strong>{{/momentum}}</strong>
</pre></div><p>Save your changes and navigate again to <code class="literal">http://localhost:3000/page/1234</code>. Once the page loads, click on the book icon in the top-left corner of the page. The main page should slide into place. The reverse animation will occur if you click the back button in your browser.</p></li><li class="listitem">We are now <a id="id671" class="indexterm"/>ready to display the <code class="literal">Quotes</code> collection.<p>We will <a id="id672" class="indexterm"/>display some light summary information for each quote in our main template and then expand that into a lot more detail for the detail template. Let's start with the main template.</p><p>Open <code class="literal">[project root]/client/main.html</code>, remove the <code class="literal">&lt;h1&gt;</code> placeholder tag, and add the following code, which iterates over the <code class="literal">Quotes</code> collection and creates group items for each one:</p><div><pre class="programlisting"> &lt;template name="main"&gt;
  &lt;div class="page"&gt;
<strong>    &lt;div class="list-group"&gt;</strong>
<strong>      {{#each quotes}}</strong>
<strong>      &lt;a class="list-group-item quote-title"&gt;</strong>
<strong>        &lt;span class="glyphicon glyphicon-menu-right pull-right"&gt;&lt;/span&gt;</strong>
<strong>        &lt;h4 class="list-group-item-heading"&gt;{{title}}&lt;/h4&gt;</strong>
<strong>        {{#each tagsFormatted}}</strong>
<strong>        &lt;div class="btn btn-xs btn-primary"&gt;{{tag}}&lt;/div&gt;</strong>
<strong>        {{/each}}</strong>
<strong>      &lt;/a&gt;</strong>
<strong>      {{/each}}</strong>
<strong>    &lt;/div&gt;</strong>
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>We need to add a couple of helpers to support the previously created template, so create a file named <code class="literal">[project root]/client/main.js</code> and add the following code:</p><div><pre class="programlisting">Template.main.helpers({
  quotes: function(){
    return Quotes.find().fetch();
  },
  tagsFormatted: function(){
    var tags = this.tags;
    if (!tags) return [];
    return _.map(tags.split(','),function(d){
      var retTag = '#' + d;
      return {tag:retTag};
    });
  }
});</pre></div><p>We will also need a <code class="literal">click</code> event handler, which will get us to the <code class="literal">detail</code> <a id="id673" class="indexterm"/>page template whenever we click on a quote group item. Add the following code to the bottom of the <code class="literal">main.js</code> file:</p><div><pre class="programlisting">Template.main.events({
  'click .quote-title' : function(e){
    Router.go('/quote/'+this._id);
  }
});</pre></div><p>Save your changes. Now let's programmatically add a couple of entries to the <code class="literal">Quotes</code> collection. Navigate in a browser to <code class="literal">http://localhost:3000/</code>. Make sure that you are logged in with your Twitter account, open the browser console, and execute the following command two or so times:</p><div><pre class="programlisting">
<strong>Quotes.insert({owner:Meteor.userId(), title:'quote title', quote:'quote body', author:'quote author', tags:'test,tags,field'})</strong>
</pre></div><p>After <a id="id674" class="indexterm"/>doing so, your screen should look similar to the following screenshot:</p><div><img src="img/image00429.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>If you <a id="id675" class="indexterm"/>click on one of the items, the generic detail page should slide into view. Let's now take care of the <code class="literal">detail</code> <a id="id676" class="indexterm"/>page template, so that it will display the details of our quotes. Open the <code class="literal">[project root]/client/detail.html</code> file and replace the template contents with the following:</p><div><pre class="programlisting">&lt;template name="detail"&gt;
  &lt;div class="page page-detail"&gt;
    &lt;div class="container"&gt;
      {{#if editing}}
      {{else}}
      &lt;h3 class="title"&gt;{{title}}&lt;/h3&gt;
      &lt;div class="container quote"&gt;{{quote}}&lt;/div&gt;
      &lt;div class="row container author"&gt;
        &lt;div class="pull-right"&gt;-{{author}}&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="row container tags"&gt;
        {{#each tagsFormatted}}
        &lt;div class="btn btn-xs btn-primary tag"&gt;{{tag}}&lt;/div&gt;
        {{/each}}
      &lt;/div&gt;
      {{/if}}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>Save your changes and click on one of the placeholder quotes. You should see a screen come into view that looks similar to the following screenshot:</p><div><img src="img/image00430.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>The tags <a id="id677" class="indexterm"/>aren't showing up because <a id="id678" class="indexterm"/>we haven't added the necessary helpers yet. Create a file named <code class="literal">[project root]/client/detail.js</code> and add the following helpers declaration:</p><div><pre class="programlisting">Template.detail.helpers({
  tagsFormatted: function () {
    var tags = this.tags;
    if (!tags) return [];
    return _.map(tags.split(','), function (d) {
      var retTag = '#' + d;
      return {
        tag: retTag
      };
    });
  }
});</pre></div><p>Look back in your browser; the tags should now appear on the detail page template.</p></li><li class="listitem">Now that we've got our display taken care of, let's add the ability to edit and insert new <code class="literal">quote</code> objects.<p>First, let's adjust the <code class="literal">detail.html</code> file and add an editing toggle button. Open <code class="literal">detail.html</code> and add the following <code class="literal">div</code> element just before the last <code class="literal">&lt;/div&gt;</code> tag:</p><div><pre class="programlisting">    &lt;/div&gt;
<strong>    &lt;div class="container"&gt;</strong>
<strong>      &lt;div class="btn btn-danger toggle-edit pull-right"&gt;</strong>
<strong>        &lt;span class="glyphicon {{editbuttonstate}}"&gt;&lt;/span&gt;</strong>
<strong>      &lt;/div&gt;</strong>
<strong>    &lt;/div&gt;</strong>
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>Next, let's <a id="id679" class="indexterm"/>add the input fields for editing/inserting. In the same <code class="literal">detail.html</code> file, in the <code class="literal">{{#if editing}}</code> section, add the title input field. Do this using the Bootstrap <code class="literal">input-group</code> styling, like so:</p><div><pre class="programlisting">{{#if editing}}
<strong>      &lt;div class="input-group input-group-lg"&gt;</strong>
<strong>        &lt;span class="input-group-addon" id="addon-title"&gt;Title&lt;/span&gt;</strong>
<strong>        &lt;input type="text" id="input-title" class="form-control" placeholder="title..." value="{{title}}"&gt;</strong>
<strong>      &lt;/div&gt;</strong>
{{else}}</pre></div><p>Next is <a id="id680" class="indexterm"/>the <code class="literal">input-group</code>  element for the <code class="literal">quote</code> body. Add the following just after the <code class="literal">title</code> group in the preceding code snippet:</p><div><pre class="programlisting">      &lt;/div&gt;
<strong>      &lt;div class="input-group"&gt;</strong>
<strong>        &lt;span class="input-group-addon" id="addon-quote"&gt;Quote&lt;/span&gt;</strong>
<strong>        &lt;textarea name="input-quote" id="input-quote" rows="4" class="form-control"&gt;{{quote}}</strong>
<strong>        &lt;/textarea&gt;</strong>
<strong>      &lt;/div&gt;</strong>
{{else}}</pre></div><p>We need an <code class="literal">input-group</code> element for the author. Add that just below the <code class="literal">quote</code> group, as follows:</p><div><pre class="programlisting">      &lt;/div&gt;
<strong>      &lt;div class="input-group"&gt;</strong>
<strong>        &lt;input type="text" id="input-author" class="form-control" placeholder="author..." value="{{author}}"&gt;</strong>
<strong>        &lt;span class="input-group-addon" id="addon-author"&gt;Author&lt;/span&gt;</strong>
<strong>      &lt;/div&gt;</strong>
{{else}}</pre></div><p>Last but <a id="id681" class="indexterm"/>not least for the template are the tags. Just below the <code class="literal">author</code> group, add the following code:</p><div><pre class="programlisting">      &lt;/div&gt;
<strong>      &lt;div class="form tags"&gt;</strong>
<strong>        &lt;textarea name="input-tags" id="input-tags" class="form-control" rows="5"&gt;{{tags}}&lt;/textarea&gt;</strong>
<strong>      &lt;/div&gt;</strong>
{{else}}</pre></div><p>We have a <a id="id682" class="indexterm"/>couple of extra helpers to add. Open <code class="literal">detail.js</code> and add the following two helpers immediately after the <code class="literal">tagsFormatted</code> helper block, in the <code class="literal">Template.detail.helpers()</code> method (don't forget the extra comma at the top!):</p><div><pre class="programlisting">  },
<strong>  editbuttonstate: function () {</strong>
<strong>    return (Session.get('editing')) ?</strong>
<strong>      'glyphicon-ok' : 'glyphicon-pencil';</strong>
<strong>  },</strong>
<strong>  editing: function () {</strong>
<strong>    return (Session.equals('editing', true));</strong>
<strong>  }</strong>
});</pre></div><p>We now need to add the event handler for toggling between editing and display. We also need to add a submit button. So, let's kill two birds with one stone and give our toggle button the ability to turn into a submit button depending on the state. At the bottom of <code class="literal">detail.js</code>, add the following Template <code class="literal">events</code> declaration:</p><div><pre class="programlisting">Template.detail.events({
  'click .toggle-edit': function (e) {
    e.preventDefault();
    var editflag = Session.equals('editing', true);
    if (editflag &amp;&amp; Meteor.userId()) {
      var upQuote = {};
      upQuote.title = $('#input-title').val();
      upQuote.quote = $('#input-quote').val();
      upQuote.author = $('#input-author').val();
      upQuote.tags = $('#input-tags').val();
      upQuote.owner = Meteor.userId();
      Quotes.upsert({
        _id: this._id
      }, {
        $set: upQuote
      });
    }
    if (!editflag &amp;&amp; !Meteor.userId()) return;
    Session.set('editing', (!editflag));
  }
});</pre></div><p>Save your <a id="id683" class="indexterm"/>changes, navigate to display a <a id="id684" class="indexterm"/>single quote, and click on the pencil icon at the bottom right. You can change the generic quote into a specific quote, as shown in the following screenshot:</p><div><img src="img/image00431.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Click on the <a id="id685" class="indexterm"/>checkmark and your <a id="id686" class="indexterm"/>changes should be saved, as shown in the following screenshot:</p><div><img src="img/image00432.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>We've taken care of editing; now we need to allow the user to add new quotes. The <a id="id687" class="indexterm"/>logic we're going to use will piggyback on our editing. When the "new qoute" button is clicked, we will instantly create a new <code class="literal">quote</code> object in the <code class="literal">Quotes</code> collection <a id="id688" class="indexterm"/>and then navigate to the editing screen. Open <code class="literal">[project root]/client/main.html</code> and add the following button group just after the last <code class="literal">{{/each}}</code> tag, but still inside the <code class="literal">list-group</code> <code class="literal">&lt;/div&gt;</code> tag:</p><div><pre class="programlisting">      {{/each}}
<strong>      &lt;a href="#" class="list-group-item add-quote"&gt;</strong>
<strong>        &lt;div class="btn btn-lg center-block"&gt;</strong>
<strong>          &lt;span class="glyphicon glyphicon-plus"&gt;&lt;/span&gt;</strong>
<strong>        &lt;/div&gt;</strong>
<strong>      &lt;/a&gt;</strong>
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>When this button is clicked, we want to insert a new object into the <code class="literal">Quotes</code> collection and then navigate to the editing screen. Open <code class="literal">main.js</code> and add the following event handler inside the <code class="literal">Template.main.events()</code> method call, just after the <code class="literal">.quote-title</code> event handler (again, don't forget the comma!):</p><div><pre class="programlisting">  },
<strong>  'click .add-quote' : function(e){</strong>
<strong>    if (!Meteor.userId()) return;</strong>
<strong>    Quotes.insert({owner:Meteor.userId()},</strong>
<strong>      function(e,d){</strong>
<strong>        if (!e){</strong>
<strong>          Session.set('editing',true);</strong>
<strong>          Router.go('/quote/'+d);</strong>
<strong>        }</strong>
<strong>    });</strong>
<strong>  }</strong>
});</pre></div><p>Save all of your changes, navigate to <code class="literal">http://localhost:3000</code> in a browser, and <a id="id689" class="indexterm"/>you should see a big blue <a id="id690" class="indexterm"/>plus sign at the bottom of the quote group. Click on the button and you'll be taken to a fresh, clean editing screen similar to the following sceenshot. Here, you can enter a new quote:</p><div><img src="img/image00433.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">With all functionality in place, we are ready to deploy our app.<p>We can deploy our app wherever we would like to (please refer to one of the <a id="id691" class="indexterm"/>many deployment recipes in <a class="link" title="Chapter 1. Optimizing Your Workflow" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <em>Optimizing Your Workflow</em> for details), but for this recipe we'll pick the easiest/quickest way to deploy, which is directly to the Meteor servers.</p><p>Stop your application from running in the terminal using <em>Ctrl</em> + <em>C</em> and execute <a id="id692" class="indexterm"/>the following command, replacing <code class="literal">[your-test-url]</code> with whatever you would like:</p><div><pre class="programlisting">
<strong>$ meteor deploy [your-test-url].meteor.com</strong>
</pre></div><p>In our case, we used the following command:</p><div><pre class="programlisting">
<strong>$ meteor deploy packt-quotes.meteor.com</strong>
</pre></div><p>Wait for your app to build and then upload, and you should get a familiar message, similar to the following:</p><div><pre class="programlisting">
<strong>Deploying to packt-quotes.meteor.com.         </strong>
<strong>Now serving at http://packt-quotes.meteor.com</strong>
</pre></div><p>Navigate <a id="id693" class="indexterm"/>to your newly-deployed app, configure Twitter if needed (you will need a new Twitter app ID, one that points to your new deployment URL), log in, and add some quotes. When you're finished, your app should look similar to the following screenshot:</p><div><img src="img/image00434.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>Congratulations! You've <a id="id694" class="indexterm"/>just created and deployed a complete application in eight steps. You should be proud of yourself. Go get a soda or a celebratory slice of pizza. You deserve it!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec306"/>How it works…</h2></div></div></div><p>Since each of the preceding steps involves recipes from other chapters, we won't focus too much on the code specifics. Instead, we'll have a general overview of what each step does and add detail where needed.</p><p>We first added our top menu/navbar. Using the <code class="literal">navbar</code> and <code class="literal">navbar-fixed-top</code> CSS classes built in to Bootstrap, we were able to position our <code class="literal">navbar</code> at the top of our screen with very little effort. We added a web font (thank you, Google!) and set the parameters for use on mobile devices in our header file.</p><p>For user <a id="id695" class="indexterm"/>authentication, we relied on the default Meteor packages for accounts (specifically the <code class="literal">accounts-twitter </code>package). For formatting, we used the excellently designed <code class="literal">Bootstrap</code> package created by Ian Martorell. He did the heavy lifting for us, so all we had to do was add the package and place our <code class="literal">{{&gt; loginButtons}}</code> inclusion in the correct place.</p><p>We declared the <code class="literal">Quotes</code> collection in a file visible to the client and the server, as usual, and added a <code class="literal">publish</code> function that will only send those results to the client which were created by the logged in user.</p><p>We added the Iron Router package and took advantage of the <code class="literal">Router.map()</code> and the <code class="literal">layoutTemplate</code> helpers of that package to implement a baseline layout template, a main template, and a details template.</p><p>We next leveraged a bit of wizardry from Percolate Studios, called <code class="literal">momentum</code>. They've created a plugin for <code class="literal">momentum</code> that allows you to wrap the <code class="literal">{{&gt;yield}}</code> directive and point it to a template <a id="id696" class="indexterm"/>helper, where we perform some quick logic to say, "If we're going to the main page, go left to right. If not, go right to left." It's a well-designed package and is very easy to implement!</p><p>Our next steps (displaying, editing, and creating quotes) could be considered the meat of the recipe, but because all the scaffolding was already in place, and because this type of functionality is so easy to implement in Meteor, we simply used an <code class="literal">{{#each…}}</code> directive, some reactive data bindings, and a few <code class="literal">click</code> event handlers to display and edit the records from the <code class="literal">Quotes</code> collection.</p><p>In fact, the most complicated bit in the entire project was taking the <code class="literal">tags</code> property and parsing it into an array using <code class="literal">_.map()</code>. Think about that for a second. The most technically "challenging" part of our entire app was parsing a string. Meteor is pretty awesome, isn't it?</p><p>Our last step was deployment, which is also pretty straightforward, since we have already done it a few times in <a class="link" title="Chapter 1. Optimizing Your Workflow" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <em>Optimizing Your Workflow</em>.</p><p>Taken as a whole, the building of an entire app from scratch seems daunting. Breaking it down into discreet steps made it not only straightforward, but actually pretty fun as well. We hope that you enjoyed it, and we hope that you will take this recipe, modify it and expand on it, and create some quick, useful apps of your own!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec307"/>There's more…</h2></div></div></div><p>If you examined the finished product of this recipe closely, you probably noticed that there is some missing functionality and some refinement that still needs to happen. For example, there's currently no way to delete a quote, we can't sort by tags/subject/author, and we actually deployed without removing the insecure package.</p><p>In other words, there are a <a id="id697" class="indexterm"/>lot of other recipes from previous <a id="id698" class="indexterm"/>chapters we could apply to improve the app. We will leave you to that, as you build and expand your own applications, and we can't wait to see what you come up with!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec308"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Deploying a test app to Meteor</em> recipe in <a class="link" title="Chapter 1. Optimizing Your Workflow" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <em>Optimizing Your Workflow</em></li><li class="listitem">The <em>Adding Meteor packages</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li><li class="listitem">The <em>Building a smooth interface with Bootstrap</em> recipe in <a class="link" title="Chapter 3. Building Great User Interfaces" href="part0036.xhtml#aid-12AK81">Chapter 3</a>, <em>Building Great User Interfaces</em></li><li class="listitem">The <em>Implementing OAuth accounts packages</em> recipe in <a class="link" title="Chapter 10. Working with Accounts" href="part0079.xhtml#aid-2BASE1">Chapter 10</a>, <em>Working with Accounts</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch12lvl1sec85"/>Deploying apps to mobile devices</h1></div></div></div><p>What <a id="id699" class="indexterm"/>good is building single-page apps with all kinds of <a id="id700" class="indexterm"/>cool functionality if you're only going to make it available as a web page? This recipe will take you through all the steps necessary to test and deploy your app to an iOS device.</p><div><div><div><div><h2 class="title"><a id="ch12lvl2sec309"/>Getting ready</h2></div></div></div><p>You need an app to complete this recipe. We will be using the app created in the <em>Creating a complete app with Iron Router</em> recipe found earlier in this chapter. If you don't have your own app you would like to deploy, please complete that recipe first and then come back to this one to learn how to deploy your app.</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec310"/>How to do it…</h2></div></div></div><p>There are two parts to deploying your application. The first is testing it on a device while using the server-side code that has already been deployed to a production URL. The second is to prepare an app build for deployment to the App Store.</p><div><ol class="orderedlist arabic"><li class="listitem">First, let's <a id="id701" class="indexterm"/>set up our mobile app building environment. To deploy to an iOS device, you will need an Apple developer license, a machine running Mac OS X, and Xcode installed on that machine.<p>To obtain <a id="id702" class="indexterm"/>an Apple Developer license, visit <a class="ulink" href="https://developer.apple.com/programs/">https://developer.apple.com/programs/</a> and follow the links/instructions to join the iOS Developer program.</p><p>Once you have joined the program, download and install Xcode from <a class="ulink" href="https://developer.apple.com/xcode/downloads/">https://developer.apple.com/xcode/downloads/</a>. You will need to properly <a id="id703" class="indexterm"/>configure Xcode, including adding certificates and mobile provisions as needed. There is a learning curve involved, and we strongly recommend that you take some time to learn the development, certification, and the App Store submission processes before proceeding.</p><p>Open a terminal window, navigate to your app directory, and enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor install-sdk ios</strong>
</pre></div><p>This can take a while, but make sure that the SDK is installed properly and fix any errors or outstanding installation items as directed.</p><p>Once completed, enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor add-platform ios</strong>
</pre></div><p>You're now properly configured, and can test/deploy your app on an iOS device.</p></li><li class="listitem">Let's now test our app on an iOS device.<p>Connect your iOS device to your machine via a USB cable. Enter the following command in the command line:</p><div><pre class="programlisting">
<strong>$ meteor run ios-device --mobile-server [your-app-url.com]</strong>
</pre></div><p>Here, <code class="literal">[you-app-url.com]</code> is replaced by the URL for your deployed server instance. In our case, we used the following command (all on one line, of course):</p><div><pre class="programlisting">
<strong>$ meteor run ios-device --mobile-server packt-quotes.meteor.com</strong>
</pre></div><p>The application will be built and bundled, and then <code class="literal">Xcode</code> will open. Once the app has been compiled in <code class="literal">Xcode</code>, you will see the following message at the top-middle of the <code class="literal">Xcode</code> app:</p><div><img src="img/image00435.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Select <a id="id704" class="indexterm"/>your iOS device from the dropdown menu and click the play button, as displayed in this screenshot:</p><div><img src="img/image00436.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Make sure that your device is unlocked, and after some download and code push activity, an icon with the Meteor logo will appear on your device. The app will quickly open; then, after a short delay, your app will run just as if you pulled it up in a browser, but it is running as a full-fledged application on your device! Here's a screenshot of the <code class="literal">Quotes</code> app running on an iPhone:</p><div><img src="img/image00437.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The next step is to build a standalone mobile app file.<p>Once <a id="id705" class="indexterm"/>you've tested everything and it's working as it should be, you will want to create an actual app file that you can submit to the Apple App Store. When you installed a test app on your mobile device, Meteor auto-created several assets for your app. You can view these assets by navigating to the <code class="literal">[project root]/.meteor/local/cordova-build/resources</code> folder, as shown in the following screenshot:</p><div><img src="img/image00438.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>You can use these resources or swap them out as needed. Once you've got your correct icons and splash screens in place, you will need to create a <a id="id706" class="indexterm"/>file named <code class="literal">[project root]/mobile-config.js</code> and add the following parameters, at a bare minimum:</p><div><pre class="programlisting">App.info({
name: '[yourappname]',
description: 'Description of my app',
version: '0.0.1'
});

App.icons({
'iphone': 'resources/icons/icon-60.png',
'iphone_2x': 'resources/icons/icon-60@2x.png'
});

App.launchScreens({
'iphone': 'resources/splash/Default~iphone.png',
'iphone_2x': 'resources/splash/Default@2x~iphone.png',
'iphone5': 'resources/splash/Default-568h@2x~iphone.png'
});</pre></div><p>You can, of course, change anything you would like in this file, and there are several other parameters you can add to further tweak the installation. See the <code class="literal">[project root]/.meteor/local/cordova-build/config.xml</code> file for a good solid list of options.</p><p>Once you're satisfied with your configuration, navigate to the root app directory and enter the following command in the terminal (all on one line, of course):</p><div><pre class="programlisting">
<strong>$ meteor build [your-output-directory] --server=[your-app-url]</strong>
</pre></div><p>For example, our command for the <code class="literal">Quotes</code> application would look like this (all on one line, of course):</p><div><pre class="programlisting">
<strong>$ meteor build ~/builds/ --server=packt-quotes.meteor.com</strong>
</pre></div><p>Once <a id="id707" class="indexterm"/>completed, you can open the project directory in <code class="literal">Xcode</code> (in our case, the project directory would be <code class="literal">~/builds/ios/project</code>) and configure to your heart's content. Once everything is correct and running how you would like it, you can sign the app and submit it to the Apple App Store.</p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec311"/>How it works…</h2></div></div></div><p>Meteor leverages the <code class="literal">cordova</code> library, <code class="literal">Xcode</code>, and your Mac's operating system to bundle, compile, and package your application. The emphasis is to get it into <code class="literal">Xcode</code>, where you can then manipulate the app as you would any native app, testing or deploying or submitting to the App Store.</p><p>The specifics on what to do inside <code class="literal">Xcode</code> and while submitting to the Apple App Store are beyond the <a id="id708" class="indexterm"/>scope of this book. If you would like more Meteor-specific app building information, please visit <a class="ulink" href="https://github.com/meteor/meteor/wiki/How-to-submit-your-iOS-app-to-App-Store">https://github.com/meteor/meteor/wiki/How-to-submit-your-iOS-app-to-App-Store</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec312"/>There's more…</h2></div></div></div><p>Everything is brain surgery the first time. Building and deploying a mobile app is no exception. Here are some tips to help you troubleshoot, should things go wrong:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Do a "dial tone" test</strong>: If your app is being built but is taking forever to "boot up" on the device, or if you just get a blank screen, first try making sure all of your network and Xcode configurations are correct. You can do this by building a brand new Meteor project using <code class="literal">meteor create my-test-app</code> and deploying that barebones app to your mobile device. If it comes up properly, you've successfully gotten a "dial tone" and you can start finding out which package or piece of code is the source of your slow-loading woes.</li><li class="listitem"><strong>The Iron Router configuration must be on point</strong>: If you are using Iron Router and you don't have your Iron Router routes configured properly, the app will usually refuse to load. If you are running into problems, implement the bare minimum routes, with no fancy code, and see if you can get the routes to come up on the device. Again, start simple.</li><li class="listitem"><strong>Use the simulator</strong>: You don't have to always push to the actual device. Using the <code class="literal">meteor run ios</code> or <code class="literal">meteor run android</code> commands will boot up a simulator in almost no time, where you can test and debug much more quickly than you could on an actual device.</li><li class="listitem"><strong>Use Xcode's logs</strong>: If there's a problem, check the logs, found in the bottom-right panel of Xcode. You can also set breakpoints using Xcode while the app is running on your device, which can help you isolate potential problems.</li></ul></div><p>Above all else, stick with it. We can assure you that deploying to mobile devices, once you're properly configured, is extremely straightforward, with very high rates of success. Don't give up! Have faith that very soon it will just "click" and you won't have any problems/anxiety about building a mobile application. It will, in fact, become fun and extremely rewarding <a id="id709" class="indexterm"/>as you see your app in the App Store or on people's devices. It's worth the learning curve!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec313"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Creating a complete app with Iron Router</em> recipe in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch12lvl1sec86"/>Adding social sharing</h1></div></div></div><p>With the <a id="id710" class="indexterm"/>ever-increasing demand to integrate social media into your apps, you'll want to gain a basic understanding of how to send/post/share directly from within your app. This recipe will show you how to add Twitter posting (tweets) to your application.</p><div><div><div><div><h2 class="title"><a id="ch12lvl2sec314"/>Getting ready</h2></div></div></div><p>We will be using the Quotes application, from the <em>Creating a complete app with Iron Router</em> recipe found earlier in this in this chapter. Please complete that recipe before proceeding.</p><p>We will also be using the <code class="literal">npm</code> <code class="literal">twit</code> module to complete this recipe. For a step-by-step recipe with a full explanation of each step, please see the first part of the <em>Handling asynchronous events</em> recipe in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <em>Leveraging Advanced Features</em>.</p><p>Quickly, here are the steps you'll need to install and configure the <code class="literal">twit</code> module:</p><div><ol class="orderedlist arabic"><li class="listitem">Execute the following terminal commands:<div><pre class="programlisting">
<strong>$ meteor add meteorhacks:npm</strong>
<strong>$ meteor</strong>
</pre></div></li><li class="listitem">Open <code class="literal">packages.json</code> and add the following code:<div><pre class="programlisting">{
  "twit" : "1.1.20"
}</pre></div></li><li class="listitem">Run the following terminal command:<div><pre class="programlisting">
<strong>$ meteor</strong>
</pre></div></li><li class="listitem">Create <code class="literal">[project root]/server/config-twit.js</code> and add the following configuration:<div><pre class="programlisting">Twitter = Meteor.npmRequire('twit');

Twit = new Twitter({
  consumer_key: '…',
  consumer_secret:'…',
  access_token: '…',
  access_token_secret: '…'
});</pre></div></li></ol><div></div><p>With our Twitter <a id="id711" class="indexterm"/>keys, tokens, and secrets all in place, and with <code class="literal">twit</code> initialized, we are ready to start tweeting!</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec315"/>How to do it…</h2></div></div></div><p>We need to create a server method, update our UI, and give an indication that a quote has been shared. Thanks to twit, the actual call to the Twitter API is fairly easy. Let's get started.</p><div><ol class="orderedlist arabic"><li class="listitem">First, let's create the <code class="literal">twuote</code> server method.<p>Create a file named <code class="literal">[project root]/server/tweets.js</code> and add the following <code class="literal">Meteor.methods</code> declaration:</p><div><pre class="programlisting">Meteor.methods({
  twuote : function(id){
  }
});</pre></div><p>We will first do our checking to make sure that a user is logged in and that we were passed the <code class="literal">id</code> argument of a valid <code class="literal">quote</code> variable. In the <code class="literal">twuote</code> function call, add the following lines:</p><div><pre class="programlisting">    if (!id || !this.userId) return;
    var quote = Quotes.findOne({_id:id});
    if (!quote || !quote.quote || !quote.author) return;</pre></div><p>We now need to manipulate the <code class="literal">quote</code> and <code class="literal">author</code> strings, making sure it's only <code class="literal">140</code> maximum in length. Just below the previously inserted lines, add the following string manipulation logic:</p><div><pre class="programlisting">    var tweet = '"';
    if (quote.quote.length&gt;138){
      tweet += quote.quote.slice(0,135);
      tweet += '..."';
    } else {
      tweet += quote.quote + '" --' + quote.author;
    }
    if (tweet.length&gt;140){
      tweet = tweet.slice(0,137) + '...';
    }</pre></div><p>After combing <a id="id712" class="indexterm"/>the quote, we are ready to send the tweet! Just below the string manipulation logic, add the following <code class="literal">Twit.post()</code> function and wrapped callback function:</p><div><pre class="programlisting">    Twit.post('statuses/update', { status: tweet },
      Meteor.bindEnvironment(function(err, data, response) {
      Quotes.update({_id:id},{$set:{tweeted:true}});
    })
    );
    return tweet;</pre></div><p>Our method is complete. Let's modify our UI.</p></li><li class="listitem">We'll start modifying our UI by adding the share button.<p>Open the <code class="literal">[project root]/client/detail.html</code> file and add the following button just below the <code class="literal">toggle-edit</code> button, inside the parent container element:</p><div><pre class="programlisting">    &lt;div class="container"&gt;
      &lt;div class="btn btn-danger toggle-edit pull-right"&gt;
        ...
      &lt;/div&gt;
<strong>      &lt;div class="btn pull-left {{tweetColor}}" id="btn-tweet"&gt;{{tweetText}}</strong>
<strong>      &lt;/div&gt;</strong>
    &lt;/div&gt;</pre></div><p>We want to give our button just a slight downward nudge, so add the following CSS directive at the bottom of the <code class="literal">[project root]/client/styles.css</code> file:</p><div><pre class="programlisting">#btn-tweet{margin-top: 2.4rem;}</pre></div><p>We need to add a couple of additional helpers for our button, as well. Open <code class="literal">[project root]/client/detail.js</code>, and add the following two helper functions to the bottom of the <code class="literal">Template.detail.helpers</code> code block (don't forget the comma on the line before, as usual!):</p><div><pre class="programlisting">editing: function () {
    ...
  }<strong>,</strong>
<strong>  tweetText: function (){</strong>
<strong>    return (this.tweeted)?'shared':'share...';</strong>
<strong>  },</strong>
<strong>  tweetColor: function (){</strong>
<strong>    return (this.tweeted)?'btn-success':'btn-info';</strong>
<strong>  }</strong>
});</pre></div><p>All that's left <a id="id713" class="indexterm"/>is hooking up the click event. Open the <code class="literal">[project root]/client/detail.js</code> file, locate the <code class="literal">Template.detail.events</code> declaration, and add the following click <code class="literal">event</code> handler just inside the closing bracket (don't forget the comma on the line just before the handler!):</p><div><pre class="programlisting">  },
<strong>  'click #btn-tweet' : function (e) {</strong>
<strong>    if (this.tweeted) return;</strong>
<strong>    Meteor.call('twuote',this._id);</strong>
<strong>  }</strong>
});</pre></div><p>Save all of your changes, navigate to your app in a browser (usually <code class="literal">http://localhost:3000</code>), click on a quote to pull up the details page, and click on the button labeled <strong>share...</strong> shown in the following screenshot:</p><div><img src="img/image00439.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Give your server a moment or two to send the tweet. The <strong>share...</strong> button will turn green and the text will change to <strong>shared</strong>. Your tweet will be live on <a id="id714" class="indexterm"/>Twitter, as shown in the following screenshot:</p><div><img src="img/image00440.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec316"/>How it works…</h2></div></div></div><p>The important code is all found in the <code class="literal">[project root]/server/tweets.js</code> file, in the <code class="literal">Meteor.methods({})</code> declaration.</p><p>We are calling <code class="literal">Twit.post()</code>, which takes a callback for its last argument. That callback is asynchronous because <code class="literal">twit</code> is a Node module. Because it is asynchronous, we need a way of preserving the current state of the environment while the call is out and we need a way of putting the process back into the <code class="literal">event</code> loop when the callback is executed (see the <em>Handling asynchronous events</em> recipe in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <em>Leveraging Advanced Features</em>, for a full explanation).</p><p>We accomplish both of these items by wrapping the callback with <code class="literal">Meteor.bindEnvironment()</code>. When the callback does fire, we update the <code class="literal">Quotes</code> collection, adding a <code class="literal">{tweeted : true}</code> property to the corresponding quote.</p><p>This property, in turn, causes our UI to update with the green button and disallows additional tweets (checked in the <code class="literal">click event</code> handler, in <code class="literal">[project root]/client/detail.js</code>).</p><p>So, just like that, we've added social sharing. From here, you can take and expand this recipe to other social platforms to be even more seamlessly integrated in to your applications.</p></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec317"/>There's more…</h2></div></div></div><p>It is very, very important that we caution against using the preceding code in production! We stripped out all the <a id="id715" class="indexterm"/>security and error handling. There is no validation, and the example is hard-wired for a single server-side user. If you use this code as it is in a production app, something not so pleasant will happen, and it won't be our fault (no blamezies allowed!).</p><p>Instead, we recommend that you flesh these elements out, particularly around allowing the use of the logged-in user's access token rather than that of a hard-wired user.</p><p>With just a little bit of spit and polish, you can easily use this code to complement your Meteor apps and extend the functionality to Facebook, Instagram, LinkedIn, Pinterest, and so on.</p><div><h3 class="title"><a id="tip47"/>Tip</h3><p>For a full <a id="id716" class="indexterm"/>write-up on what you can do with the <code class="literal">twit</code> module, please visit <a class="ulink" href="https://github.com/ttezel/twit">https://github.com/ttezel/twit</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch12lvl2sec318"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Adding Meteor packages</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li><li class="listitem">The <em>Handling asynchronous events</em> recipe in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <em>Leveraging Advanced Features</em></li><li class="listitem">The <em>Creating a complete app with Iron Router</em> recipe in this chapter</li></ul></div></div></div></body></html>