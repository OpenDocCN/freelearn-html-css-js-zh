<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Performing Animation and Transforming Function"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Performing Animation and Transforming Function</h1></div></div></div><p>Now that you have learned how to work with events and callbacks in the previous chapter, it's time to move ahead and work with the Animation and Transforming function. This chapter is supposed to be more interactive than the previous chapter, because we are going to talk about and use the Animation and Transforming function of CreateJS. In this chapter, we use <span class="emphasis"><em>TweenJS</em></span> and <span class="emphasis"><em>EaselJS</em></span> to create basic animation in browsers. You can then use these functions to create more innovative animations.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating animations with CreateJS</li><li class="listitem" style="list-style-type: disc">Understanding TweenJS</li><li class="listitem" style="list-style-type: disc">Understanding the TweenJS API</li><li class="listitem" style="list-style-type: disc">Creating simple animations</li><li class="listitem" style="list-style-type: disc">Transforming shapes</li><li class="listitem" style="list-style-type: disc">Understanding Sprite Sheets</li><li class="listitem" style="list-style-type: disc">Developing animations using Sprite Sheet</li></ul></div><div class="section" title="Creating animations with CreateJS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec18"/>Creating animations with CreateJS</h1></div></div></div><p>As you may <a id="id64" class="indexterm"/>already know, creating animations <a id="id65" class="indexterm"/>in web browsers during web development is a difficult job because you have to write code that has to work in all browsers; this is called <span class="emphasis"><em>browser compatibility</em></span>. The good news is that CreateJS provides modules to write and develop animations in web browsers without thinking about browser compatibility. CreateJS modules can do this job very well and all you need to do is work with <span class="emphasis"><em>CreateJS API</em></span>.</p></div></div>
<div class="section" title="Understanding TweenJS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec19"/>Understanding TweenJS</h1></div></div></div><p>TweenJS is<a id="id66" class="indexterm"/> one<a id="id67" class="indexterm"/> of the modules of CreateJS that helps you develop animations in web browsers. We will now introduce TweenJS.</p><div class="blockquote"><blockquote class="blockquote"><p>The TweenJS JavaScript library provides a simple but powerful tweening interface. It supports tweening of both numeric object properties and CSS style properties, and allows you to chain tweens and actions together to create complex sequences.—TweenJS API Documentation</p></blockquote></div><p>For more information on TweenJS, please refer to the official documentation<a id="id68" class="indexterm"/> at:</p><p>
<a class="ulink" href="http://www.createjs.com/Docs/TweenJS/modules/TweenJS.html">http://www.createjs.com/Docs/TweenJS/modules/TweenJS.html</a>
</p><div class="section" title="What is tweening?"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec13"/>What is tweening?</h2></div></div></div><p>Let us understand precisely what tweening means:</p><div class="blockquote"><blockquote class="blockquote"><p>Inbetweening or tweening is the process of generating intermediate frames between two images to give the appearance that the first image evolves smoothly into the second image.—Wikipedia</p></blockquote></div><p>For more information on tweening, visit:</p><p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Tweening">http://en.wikipedia.org/wiki/Tweening</a>
</p><div class="mediaobject"><img src="graphics/0260OS_4_1.jpg" alt="What is tweening?"/></div><p>The same as other CreateJS subsets, TweenJS contains many functions and methods; however, we are going to work with and create examples for specific basic methods, based on which you can read the rest of the documentation of TweenJS to create more complex animations.</p></div></div>
<div class="section" title="Understanding API and methods of TweenJS"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec20"/>Understanding API and methods of TweenJS</h1></div></div></div><p>In order to create animations in TweenJS, you don't have to work with a lot of methods. There are a few functions that help you to create animations. Following are all the methods<a id="id69" class="indexterm"/> with a brief description:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">get</code>: It <a id="id70" class="indexterm"/>returns a new tween instance.</li><li class="listitem" style="list-style-type: disc"><code class="literal">to</code>: It <a id="id71" class="indexterm"/>queues a tween from the current values to the target properties.</li><li class="listitem" style="list-style-type: disc"><code class="literal">set</code>: It <a id="id72" class="indexterm"/>queues an action to set the specified properties on the specified target.</li><li class="listitem" style="list-style-type: disc"><code class="literal">wait</code>: It <a id="id73" class="indexterm"/>queues a wait (essentially an empty tween).</li><li class="listitem" style="list-style-type: disc"><code class="literal">call</code>: It <a id="id74" class="indexterm"/>queues an action to call the specified function.</li><li class="listitem" style="list-style-type: disc"><code class="literal">play</code>: It <a id="id75" class="indexterm"/>queues an action to play (un-pause) the specified tween.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pause</code>: It <a id="id76" class="indexterm"/>queues an action to pause the specified tween.</li></ul></div><p>The following is an example of using the <a id="id77" class="indexterm"/>Tweening API:</p><div class="informalexample"><pre class="programlisting">var tween = createjs.Tween.get(myTarget).to({x:300},400).set({label:"hello!"}).wait(500).to({alpha:0,visible:false},1000).call(onComplete);</pre></div><p>The previous example will create a tween, which:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Tweens the target to an <code class="literal">x</code> value of <code class="literal">300</code> with duration <code class="literal">400</code>ms and sets its <code class="literal">label</code> to <code class="literal">hello!</code>.</li><li class="listitem" style="list-style-type: disc">Waits <code class="literal">500</code>ms.</li><li class="listitem" style="list-style-type: disc">Tweens the target's <code class="literal">alpha</code> property to <code class="literal">0</code> with duration <code class="literal">1</code>s and sets the <code class="literal">visible</code> property to <code class="literal">false</code>.</li><li class="listitem" style="list-style-type: disc">Finally, calls the <code class="literal">onCom</code><code class="literal">plete</code> function.</li></ul></div></div>
<div class="section" title="Creating a simple animation"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec21"/>Creating a simple animation</h1></div></div></div><p>Now, it's time <a id="id78" class="indexterm"/>to create our simplest animation with TweenJS. It is a simple but powerful API, which gives you the ability to develop animations with <span class="emphasis"><em>method chaining</em></span>.</p><div class="section" title="Scenario"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec14"/>Scenario</h2></div></div></div><p>The <a id="id79" class="indexterm"/>animation has a red ball that comes from the top of the <code class="literal">Canvas</code> element and then drops down.</p><div class="mediaobject"><img src="graphics/0260OS_4_2.jpg" alt="Scenario"/></div><p>In the preceding screenshot, you can see all the steps of our simple animation; consequently, you can predict what we need to do to prepare this animation. In our animation, we are going to use two methods: <code class="literal">get</code> and <code class="literal">to</code>.</p><p>The following is the complete source code for our animation:</p><div class="informalexample"><pre class="programlisting">var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

var ball = new createjs.Shape();
ball.graphics.beginFill("#FF0000").drawCircle(0, 0, 50);

ball.x = 200;
ball.y = -50;

var tween = createjs.Tween.get(ball) to({
  y: 300
}, 1500, createjs.Ease.bounceOut);

stage.addChild(ball);
createjs.Ticker.addEventListener("tick", stage);</pre></div><p>In the second<a id="id80" class="indexterm"/> and third line of the JavaScript code snippet, two variables are declared, namely; the <code class="literal">canvas</code> and <code class="literal">stage</code> objects. In the next line, the <code class="literal">ball</code> variable is declared, which contains our <code class="literal">shape</code> object. In the following line, we drew a red circle with the <code class="literal">drawCircle</code> method (we have discussed about the <code class="literal">drawCircle</code> method in the previous chapter). Then, in order to set the coordinates of our shape object outside the viewport, we set the <code class="literal">x</code> axis to <code class="literal">-50 </code>px.</p><p>After this, we created a <code class="literal">tween</code> variable, which holds the <code class="literal">Tween</code> object; then, using the TweenJS method chaining, the <code class="literal">to</code> method is called with duration of <code class="literal">1500 </code>ms and the <code class="literal">y</code> property set to <code class="literal">300 </code>px. The third parameter of the <code class="literal">to</code> method represents the <code class="literal">ease</code> function of <code class="literal">tween</code>, which we set to <code class="literal">bounceOut</code> in this example.</p><p>In the following lines, the <code class="literal">ball</code> variable is added to <code class="literal">Stage</code> and the <code class="literal">tick</code> event is added to the <code class="literal">Ticker</code> class to keep <code class="literal">Stage</code> updated while the animation is playing. You can also find the <code class="literal">Canvas</code> element in line 30, using which all animations and shapes are rendered in this element.</p></div></div>
<div class="section" title="Transforming shapes"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec22"/>Transforming shapes</h1></div></div></div><p>CreateJS provides<a id="id81" class="indexterm"/> some functions to transform shapes easily on <code class="literal">Stage</code>. Each <code class="literal">DisplayObject</code> has a <code class="literal">setTransform</code> method that allows the transforming of a <code class="literal">DisplayObject</code> (like a circle).</p><p>The following shortcut method is used to quickly set the transform properties on the display object. All its parameters are optional. Omitted parameters will have the default value set.</p><div class="informalexample"><pre class="programlisting">setTransform([x=0] [y=0] [scaleX=1] [scaleY=1] [rotation=0] [skewX=0] [skewY=0] [regX=0] [regY=0])</pre></div><p>This was taken from:</p><p>
<a class="ulink" href="http://www.createjs.com/Docs/EaselJS/classes/Shape.html#method_setTransform">http://www.createjs.com/Docs/EaselJS/classes/Shape.html#method_setTransform</a>
</p><p>Furthermore, you can change all the properties via <code class="literal">DisplayObject</code> directly (like <code class="literal">scaleY</code> and <code class="literal">scaleX</code>) as shown in the following example:</p><div class="informalexample"><pre class="programlisting">displayObject.setTransform(100, 100, 2, 2);</pre></div><div class="section" title="An example of Transforming function"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec15"/>An example of Transforming function</h2></div></div></div><p>As an instance <a id="id82" class="indexterm"/>of using the shape transforming feature with CreateJS, we are going to extend our previous example:</p><div class="informalexample"><pre class="programlisting">var angle = 0;
window.ball;
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

ball = new createjs.Shape();
ball.graphics.beginFill("#FF0000").drawCircle(0, 0, 50);

ball.x = 200;
ball.y = 300;

stage.addChild(ball);

function tick(event) {
  angle += 0.025;
  var scale = Math.cos(angle);

  ball.setTransform(ball.x, ball.y, scale, scale);
  stage.update(event);
}

createjs.Ticker.addEventListener("tick", tick);</pre></div><p>In this example, we have a red circle, similar to the previous example of tweening. We set the coordinates of the circle to <code class="literal">200</code> and <code class="literal">300</code> and added the circle to the <code class="literal">stage</code> object. In the next line, we have a <code class="literal">tick</code> function that transforms the shape of the circle. Inside this function, we have an <code class="literal">angle</code> variable that increases with each call. We then set the <code class="literal">ballX</code> and <code class="literal">ballY</code> coordinates to the cosine of the <code class="literal">angle </code>variable. The transforming done is similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/0260OS_4_3.jpg" alt="An example of Transforming function"/></div><p>This is a basic <a id="id83" class="indexterm"/>example of transforming shapes in CreateJS, but obviously you can develop and create better transforming by playing with a shape's properties and values.</p></div></div>
<div class="section" title="Understanding Sprite Sheet"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Understanding Sprite Sheet</h1></div></div></div><p>In this section,<a id="id84" class="indexterm"/> we will discuss about the EaselJS feature to make an animation using a series of images. This feature is called <span class="strong"><strong>Sprite Sheet</strong></span>. A Sprite Sheet combines a series of images or frames of an animation to produce 2D or 3D animation. For instance, if you want to animate a hero that is walking, we can combine all frames of the walking character into a single image, and then make the animation using the Sprite Sheet feature of EaselJS.</p><p>The following is a series of images (animation frames) that are combined into a single image:</p><div class="mediaobject"><img src="graphics/0260OS_4_4.jpg" alt="Understanding Sprite Sheet"/></div><p>In the next section, you will learn how to use the Sprite Sheet feature to develop animations.</p><div class="section" title="Developing animations using Sprite Sheet"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec16"/>Developing animations using Sprite Sheet</h2></div></div></div><p>Let's start by<a id="id85" class="indexterm"/> understanding the <code class="literal">SpriteSheet</code> class. This class is used to initialize the Sprite Sheet feature and encapsulate its properties and configurations. After creating the <code class="literal">SpriteSheet</code> class, we can use its methods to control the animation.</p><p>The basic configuration of this class has three mandatory properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The image or images to use for animation frames.</li><li class="listitem" style="list-style-type: disc">The position of each image, which can be defined using a single value for all frames or even with an individual configuration for each frame.</li><li class="listitem" style="list-style-type: disc">The representation of the animation, which can be defined by a start and end frame or with individual values for each frame.</li></ul></div><p>The following is a code snippet defines the configuration for the <code class="literal">SpriteSheet</code> class:</p><div class="informalexample"><pre class="programlisting">data = {
  // list of images or image URIs to use. SpriteSheet can handle preloading.
  // the order dictates their index value for frame definition.
images: [image1, "path/to/image2.png"],

  // the simple way to define frames, only requires frame size because frames are consecutive:
  // define frame width/height, and optionally the frame count and registration point x/y.
  // if count is omitted, it will be calculated automatically based on image dimensions.
frames: {width:64, height:64, count:20, regX: 32, regY:64},

// OR, the complex way that defines individual rects for frames.
  // The 5th value is the image index per the list defined in "images" (defaults to 0).
frames: [
  // x, y, width, height, imageIndex, regX, regY
  [0,0,64,64,0,32,64],
  [64,0,96,64,0]
],

  // simple animation definitions. Define a consecutive range of frames (begin to end inclusive).
  // optionally define a "next" animation to sequence to (or false to stop) and a playback "speed".
animations: {
  // start, end, next, speed
run: [0,8],
jump: [9,12,"run",2]
}

// the complex approach which specifies every frame in the animation by index.
animations: {
  run: {
  frames: [1,2,3,3,2,1]
  },
  jump: {
    frames: [1,4,5,6,1],
    next: "run",
    speed: 2
  },
stand: { frames: [7] }
  }
}</pre></div><p>The following<a id="id86" class="indexterm"/> is a sample configuration for the <code class="literal">SpriteSheet</code> class:</p><div class="informalexample"><pre class="programlisting">var data = {
  images: ["sprites.jpg"],
  frames: { width:50, height:20 },
  animations: { 
    run:[0,4], 
    jump:[5,8,"run"]
  }
};</pre></div><p>This is explained more in detail at: <a class="ulink" href="http://www.createjs.com/Docs/EaselJS/classes/SpriteSheet.html">http://www.createjs.com/Docs/EaselJS/classes/SpriteSheet.html</a>
</p><p>Now, we will develop a simple walking animation using Sprite Sheets. The following is our sprite image that will be used for the animation frames:</p><div class="mediaobject"><img src="graphics/0260OS_4_5.jpg" alt="Developing animations using Sprite Sheet"/><div class="caption"><p>Sprite image</p></div></div><p>The next step is to configure our <code class="literal">SpriteSheet</code> class. The following is the configuration:</p><div class="informalexample"><pre class="programlisting">var data = {
  "animations":
  {
    "run": [0, 15]
  },
  "images": ["running.png"],
  "frames": {
    "height": 70,
    "width": 51,
    "regX": 0,
    "regY": 0,
    "count": 16
  }
};</pre></div><p>We have a total of 16 <a id="id87" class="indexterm"/>frames for our animation; hence, the <span class="emphasis"><em>run</em></span> frameset that defines the frames of the animation, starts from <code class="literal">0</code> and extends till <code class="literal">15</code>. We defined the path of the sprite image. We then defined the configuration of the frames with height <code class="literal">70</code>, width <code class="literal">51</code> (this is the width of each individual image), and a count of 16 that refers to the number of frames.</p><p>The following is the complete source code for the animation:</p><div class="informalexample"><pre class="programlisting">stage = new createjs.Stage(document.getElementById("canvas"));

varss = new createjs.SpriteSheet({
  "animations":
  {
    "run": [0, 15]
  },
  "images": ["running.png"],
  "frames": {
    "height": 70,
    "width": 51,
    "regX": 0,
    "regY": 0,
    "count": 16
  }
});

var grant = new createjs.Sprite(ss, "run");

stage.addChild(grant);
createjs.Ticker.setFPS(40);
createjs.Ticker.addEventListener("tick", stage);</pre></div><p>As seen in previous<a id="id88" class="indexterm"/> examples, first we defined the stage using the <code class="literal">Stage</code> class. After that, the <code class="literal">SpriteSheet</code> class was initiated using the configuration, and then we passed the object to the <code class="literal">Sprite</code> class to start the animation. The second parameter for the <code class="literal">Sprite</code> class defines the starting frameset for animation. Finally, we added the <code class="literal">Sprite</code> object to the stage with the <code class="literal">addChild</code> method.</p><p>It's important to add the <code class="literal">tick</code> event to the <code class="literal">Ticker</code> class and pass the <code class="literal">Stage</code> object to it to start the animation; otherwise, you will see a blank screen. Furthermore, using the <code class="literal">Ticker</code> class and <code class="literal">setFPS</code> method, we can control the ratio of rendering the animation.</p><p>The following image shows a preview of our Sprite Sheet example:</p><div class="mediaobject"><img src="graphics/0260OS_4_6.jpg" alt="Developing animations using Sprite Sheet"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Summary</h1></div></div></div><p>In this chapter, we have learned how to develop and create animations with TweenJS and EaselJS. We discussed in detail about working with chaining methods in TweenJS, callback functions in animations, and also how to change a shape's properties with TweenJS functions. We then learned how to transform with EaselJS in order to change a shape's properties like rotation or scale. We then went on to learn about utilizing the Sprite Sheet feature to create animated characters.</p><p>In the next chapter, we will discuss about caching techniques in CreateJS and how to improve the performance of applications using cache.</p></div></body></html>