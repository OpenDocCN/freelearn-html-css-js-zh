<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Blending In"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Blending In</h1></div></div></div><p>CSS, <a id="id911" class="indexterm"/>HTML, and JavaScript<a id="id912" class="indexterm"/> can take us a long way to building an app that feels 99 percent <a id="id913" class="indexterm"/>native. That is, it almost feels native, it looks nearly native, and it acts mostly native. But if you take a closer look, you can see the small differences that tell any user with a lot of experience with their device that things really aren't native. To help overcome this, we can <span class="emphasis"><em>blend in</em></span> to our environment using plugins that use real, true-blue native components.</p><div class="section" title="What do we build?"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec81"/>What do we build?</h1></div></div></div><p>We're going to revisit the<a id="id914" class="indexterm"/> <code class="literal">Socializer</code> app from <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Lets Get Social!</em></span> It's a good fit for blending in, and we can easily add our native components on to it without worrying too much about changing a lot of the app itself. There are some minor changes, of course, but in general, it works much the same, and even gains a little functionality in the process!</p><div class="section" title="What does it do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec183"/>What does it do?</h2></div></div></div><p>Although, we<a id="id915" class="indexterm"/> will add a couple of features to the app, the primary goal here is to use native components. For this, we'll be taking advantage of several great plugins in the PhoneGap Plugins repository (<a class="ulink" href="http://github.com/phonegap/phonegap-plugins/tree/master/iOS">http://github.com/phonegap/phonegap-plugins/tree/master/iOS</a>). As the URL implies, we'll be doing this for iOS only. Unfortunately there aren't a lot of native plugins in this repository for Android. You can search around a bit and find some here and there (and some really great ones), but for now, we'll focus on iOS.</p><p>In fact, we'll be using quite a few native components: the navigation bar, the tab bar, the ActionSheet, the message box, the picker, and the e-mail composer. Oh, and let's not forget <a id="id916" class="indexterm"/>ChildBrowser either!</p></div><div class="section" title="Why is it great?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec184"/>Why is it great?</h2></div></div></div><p>This project will give<a id="id917" class="indexterm"/> us a much better understanding of interacting with multiple plugins, and we will also get much closer to a native look and feel.</p></div><div class="section" title="How are we going to do it?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec185"/>How are we going to do it?</h2></div></div></div><p>Here are the <a id="id918" class="indexterm"/>steps we'll be following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing the plugins</li><li class="listitem" style="list-style-type: disc">Adding the navigation bar</li><li class="listitem" style="list-style-type: disc">Adding the tab bar</li><li class="listitem" style="list-style-type: disc">Adding the ActionSheet</li><li class="listitem" style="list-style-type: disc">Adding the message box</li><li class="listitem" style="list-style-type: disc">Adding the picker</li><li class="listitem" style="list-style-type: disc">Adding the e-mail composer</li></ul></div></div><div class="section" title="What do I need to get started?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec186"/>What do I need to get started?</h2></div></div></div><p>Make sure you've <a id="id919" class="indexterm"/>downloaded the code for this project so that you can follow along.</p></div></div></div>
<div class="section" title="Installing the plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec82"/>Installing the plugins</h1></div></div></div><p>We've already had to deal with <a id="id920" class="indexterm"/>
<a id="id921" class="indexterm"/>plugins a little bit, from ChildBrowser<a id="id922" class="indexterm"/> to even our own plugins. But this time, we'll be adding a lot of them. To install the plugins, go ahead and open up (or create) your Xcode project.</p><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec187"/>Getting on with it</h2></div></div></div><p>When you've downloaded the PhoneGap plugin repository, you should be able to extract it and navigate to the <code class="literal">iOS</code> folder inside. Go ahead and install the ChildBrowser plugin, as described in <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Let's Get Social!</em></span> in the <span class="emphasis"><em>Configuring the plugins</em></span> section. Once done, you need to go into <a id="id923" class="indexterm"/>
<a id="id924" class="indexterm"/>each of the following directories and install each plugin:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ActionSheet</code><a id="id925" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">ActionSheet.h</code> and <code class="literal">ActionSheet.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">ActionSheet.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">EmailComposer</code><a id="id926" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">EmailComposer.h</code> and <code class="literal">EmailComposer.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">EmailComposer.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">MessageBox</code><a id="id927" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">MessageBox.h</code> and <code class="literal">MessageBox.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">MessageBox.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">NavigationBar</code><a id="id928" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">CDVNavigationBar.xib</code>, <code class="literal">CDVNavigationBarController.h</code>, <code class="literal">CDVNavigationBarController.m</code>, <code class="literal">NavigationBar.h</code>, and <code class="literal">NavigationBar.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">NavigationBar.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">PickerView</code><a id="id929" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">PickerView.h</code> and <code class="literal">PickerView.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">PickerView.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">TabBar</code><a id="id930" class="indexterm"/><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">TabBar.h</code> and <code class="literal">TabBar.m</code> files into Xcode into the <code class="literal">Plugins</code> directory.</li><li class="listitem" style="list-style-type: disc">Copy the <code class="literal">TabBar.js</code> file to the <code class="literal">www/plugins/iOS</code> directory using Finder.</li></ul></div></li></ul></div><p>When done, you<a id="id931" class="indexterm"/>
<a id="id932" class="indexterm"/> should have something that looks like this in Xcode:</p><div class="mediaobject"><img src="graphics/9403_09_01.jpg" alt="Getting on with it"/></div><p>Next, navigate <a id="id933" class="indexterm"/>
<a id="id934" class="indexterm"/>to <code class="literal">Cordova.plist</code> in the <code class="literal">Resources</code> directory, and add the following key/value pairs to the <code class="literal">Plugins</code> section:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ActionSheet</code>, <code class="literal">String</code>, <code class="literal">ActionSheet</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">NavigationBar</code>, <code class="literal">String</code>, <code class="literal">NavigationBar</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MessageBox</code>, <code class="literal">String</code>, <code class="literal">MessageBox</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TabBar</code>, <code class="literal">String</code>, <code class="literal">TabBar</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PickerView</code>, <code class="literal">String</code>, <code class="literal">PickerView</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">EmailComposer</code>, <code class="literal">String</code>, <code class="literal">EmailComposer</code></li></ul></div><p>The result <a id="id935" class="indexterm"/>
<a id="id936" class="indexterm"/>should look like the following screenshot:</p><div class="mediaobject"><img src="graphics/9403_09_02.jpg" alt="Getting on with it"/></div><p>Next, add the <code class="literal">script</code> tags to our <code class="literal">index.html</code> file:</p><div class="informalexample"><pre class="programlisting">    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/ChildBrowser.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/NavigationBar.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/TabBar.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/MessageBox.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/ActionSheet.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/PickerView.js"&gt;&lt;/script&gt;
    &lt;script type="application/javascript" charset="utf-8" src="./plugins/iOS/EmailComposer.js"&gt;&lt;/script&gt;</pre></div></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec188"/>What did we do?</h2></div></div></div><p>In this section, <a id="id937" class="indexterm"/>
<a id="id938" class="indexterm"/>you added all the plugins our project will use to Xcode.</p></div><div class="section" title="What else do I need to know?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec189"/>What else do I need to know?</h2></div></div></div><p>There are a couple files that may give you problems when compiling—<code class="literal">ActionSheet.h</code> and <code class="literal">PickerView.h</code>. In particular, the error references an inability to find <code class="literal">CDVPlugin.h</code> Just change the code at the top until it looks like the following:</p><div class="informalexample"><pre class="programlisting">//#ifdef CORDOVA_FRAMEWORK
#import &lt;CORDOVA/CDVPlugin.h&gt;
//#else
//#import "CDVPlugin.h"
//#endif</pre></div></div></div>
<div class="section" title="Adding the navigation bar"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec83"/>Adding the navigation bar</h1></div></div></div><p>We're already<a id="id939" class="indexterm"/>
<a id="id940" class="indexterm"/> pretty familiar with the concept of the navigation bar. We've been using one at the top of our HTML views for several projects now. This time, however, we're going to take that out and replace it with a native navigation bar. Here's how it will look:</p><div class="mediaobject"><img src="graphics/9403_09_03.jpg" alt="Adding the navigation bar"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec190"/>Getting ready</h2></div></div></div><p>This will <a id="id941" class="indexterm"/>
<a id="id942" class="indexterm"/>require minor surgery on all three views—<code class="literal">startView.html</code>, <code class="literal">socialView.html</code>, and <code class="literal">tweetView.html</code> in the <code class="literal">www/views</code> directory. Go ahead and open those files so you can follow along. You might also want to open the versions from <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Let's Get Social!</em></span> as well, so you can see what has changed.</p></div><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec191"/>Getting on with it</h2></div></div></div><p>First, our HTML views are going to change, since we need to remove our own navigation bar.</p><p>For <code class="literal">startView.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div class="viewBackground"&gt;
 &lt;div class="content" style="padding:0; overflow: scroll; -webkit-overflow-scrolling: touch;" id="startView_scroller"&gt;
  &lt;div class="content" id="startView_welcome"&gt;
  &lt;/div&gt;
 &lt;/div&gt;
&lt;/div&gt;</pre></div><p>For <code class="literal">socialView.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div class="viewBackground"&gt;
  &lt;div class="content" style="padding:0; overflow: scroll; -webkit-overflow-scrolling: touch;" id="socialView_scroller"&gt;
    &lt;div id="socialView_contentArea" style="padding: 0; height: auto; position: relative;"&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><p>For <code class="literal">tweetView.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;div class="viewBackground"&gt;
  &lt;div class="content " style="padding:0; overflow:scroll; -webkit-overflow-scrolling: touch;" id="tweetView_scroller"&gt;
    &lt;div id="tweetView_contentArea" style="padding: 0; height: auto; position: relative;"&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><p>If you're<a id="id943" class="indexterm"/>
<a id="id944" class="indexterm"/> comparing each view to that of <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Let's Get Social! </em></span>the navigation bar and tool bars have been removed in each view. We've also added native iOS scrolling to each view using <code class="literal">-webkit-overflow-scrolling: touch</code>.</p><p>By doing this, we've also removed several buttons: buttons that we'll need to replace in the navigation bar. But we will also need to remove the old references to them, typically in each view's<a id="id945" class="indexterm"/> <code class="literal">initializeView()</code> method:</p><p>For<a id="id946" class="indexterm"/> <code class="literal">startView.html</code>:</p><div class="informalexample"><pre class="programlisting">  startView.initializeView = function() {
    var theWelcomeContent = $geLocale("startView_welcome");
    $ge("startView_welcome").innerHTML = theWelcomeContent.innerHTML;
  }</pre></div><p>For<a id="id947" class="indexterm"/> <code class="literal">socialView.html</code>:</p><div class="informalexample"><pre class="programlisting">socialView.initializeView = function() {
  PKUTIL.include(["./models/twitterStreams.js", "./models/twitterStream.js"], function() {
    TWITTER.loadTwitterUsers(socialView.initializeToolbar);
  });
}</pre></div><p>For<a id="id948" class="indexterm"/> <code class="literal">tweetView.html</code>:</p><div class="informalexample"><pre class="programlisting">(the method is removed)</pre></div><p>You may be wondering, then, if we aren't going to initialize our buttons or the navigation bar in <code class="literal">intializeView()</code>, when and where are we going to do it?</p><p>First, the initialization part actually needs to happen in <code class="literal">app.js</code>. The navigation bar is going to persist across all of our views, and we can only have one of them. Therefore, we need to initialize it at the very start of our app. So in <code class="literal">app.js</code> in the <code class="literal">APP.init()</code> method (after <code class="literal">PKUI.CORE.initializeApplication</code>), we add the following code snippet:</p><div class="informalexample"><pre class="programlisting">    window.addEventListener("resize", function() {
        plugins.navigationBar.resize();
    , false);
    plugins.navigationBar.init();
    plugins.navigationBar.create();
    plugins.navigationBar.hideLeftButton();
    plugins.navigationBar.hideRightButton();
    plugins.navigationBar.setTitle(__T("APP_TITLE"));
    plugins.navigationBar.show();</pre></div><p>This initializes and creates the navigation bar, hides its two buttons, and then sets its title. Finally, we display it on the screen.</p><p>Once we've <a id="id949" class="indexterm"/>
<a id="id950" class="indexterm"/>done that, we can do some work in our views to tweak the navigation bar to our needs in each view.</p><p>In<a id="id951" class="indexterm"/> <code class="literal">startView.html</code>:</p><div class="informalexample"><pre class="programlisting">  startView.viewDidAppear = function () {
    plugins.navigationBar.hideLeftButton();
    plugins.navigationBar.hideRightButton();
    plugins.navigationBar.setTitle(__T("APP_TITLE"));
    plugins.navigationBar.setupRightButton( __T("START"), null, startView.startApp);
    plugins.navigationBar.showRightButton();
  }</pre></div><p>First, we hide the buttons (just in case there are buttons visible we don't want seen), and then we set the title to the app's title—<code class="literal">Socializer2</code>. Then, we give the right button a title of <code class="literal">Start</code>, and link it to the <code class="literal">startApp()</code> method<a id="id952" class="indexterm"/>. At the end, we also show the right button.</p><div class="informalexample"><pre class="programlisting">  startView.viewWillHide = function ()
  {
    plugins.navigationBar.hideLeftButton();
    plugins.navigationBar.hideRightButton();
    plugins.navigationBar.setTitle("");
  }</pre></div><p>When the view is about to hide, we essentially clear the entire navigation bar so that the buttons don't hang around for the next view.</p><p>In<a id="id953" class="indexterm"/> <code class="literal">socialView.html</code>:</p><div class="informalexample"><pre class="programlisting">socialView.viewDidAppear = function() {
  plugins.navigationBar.hideLeftButton();
  plugins.navigationBar.hideRightButton();
  plugins.navigationBar.setTitle(socialView.currentTitle);
  plugins.navigationBar.setupLeftButton( __T("BACK"), null, socialView.backButtonPressed);
  plugins.navigationBar.setupRightButton(__T("#"), null, socialView.changeReturnCount);
  plugins.navigationBar.showLeftButton();
  plugins.navigationBar.showRightButton();
…  
}</pre></div><p>In this case, <a id="id954" class="indexterm"/>
<a id="id955" class="indexterm"/>we set the title of the view to the currently selected Twitter account, which by default will be the first one. We've added <code class="literal">currentTitle</code> to <code class="literal">socialView</code>, and are setting it in <code class="literal">loadStreamFor()</code> <a id="id956" class="indexterm"/>so that we can keep track of it.</p><p>We also add a <code class="literal">Back</code> button, on the left, and then we add a <code class="literal">#</code> button on the right. The <code class="literal">Back</code> button is just like every back button we've done in the past, so it will return us back to the starting view. The <code class="literal">#</code> button—this one's going to be interesting, but we'll save it for later.</p><div class="informalexample"><pre class="programlisting">socialView.viewWillHide = function() {
  plugins.navigationBar.hideLeftButton();
  plugins.navigationBar.hideRightButton();
  plugins.navigationBar.setTitle("");
…
}</pre></div><p>Again, like good citizens, we clean up after ourselves!</p><p>In<a id="id957" class="indexterm"/> <code class="literal">tweetView.html</code>:</p><div class="informalexample"><pre class="programlisting">tweetView.viewDidAppear = function ()
{
  plugins.navigationBar.hideLeftButton();
  plugins.navigationBar.hideRightButton();
  plugins.navigationBar.setupLeftButton( __T("BACK"), null, tweetView.backButtonPressed);
  plugins.navigationBar.showLeftButton();
  plugins.navigationBar.setupRightButton( __T("SHARE"), null, tweetView.share );
  plugins.navigationBar.showRightButton();
}</pre></div><p>Okay, this is a little different. Notice anything missing? That's right, we aren't setting the title. That's because we'll actually set it in<a id="id958" class="indexterm"/> <code class="literal">loadTweet()</code>:</p><div class="informalexample"><pre class="programlisting">{ …
  plugins.navigationBar.setTitle(theTweet.text);
… }</pre></div><p>Because we load the tweet immediately upon loading the tweet view, this has the effect of setting the navigation bar's title to the tweet's text.</p><p>But what if the tweet's text is too long? In fact, the chances of it being too long are really good. The native navigation bar will happily truncate it and append a "…" at the end, so we never have to worry if it will actually end up overflowing its bounds.</p><p>And of course, we'll clean up after ourselves, but there's no sense in printing the same code again.</p></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec192"/>What did we do?</h2></div></div></div><p>In this task, <a id="id959" class="indexterm"/>
<a id="id960" class="indexterm"/>we added the navigation bar and modified its title and interacted with the buttons on the navigation bar.</p></div><div class="section" title="What else do I need to know?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec193"/>What else do I need to know?</h2></div></div></div><p>The iOS-native navigation bar can do a lot of cool things, but the plugin doesn't expose all of those cool features (such as changing the tint color). So, for the time being, we're left with a rather plain-looking navigation bar—certainly not the color we used in <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Let's Get Social!</em></span> You can get around this by using some native Objective-C code, but the plugin itself doesn't offer us any other option but the black gloss navigation bar.</p><p>For a long time, iOS navigation bars were limited to two buttons—one on the left, and one on the right. And for the iPhone and iPod Touch, this is still a pretty good idea. For the iPad, one can add quite a few buttons to the bar without getting in the way of any text. Again, however, the plugin doesn't expose this functionality, so we can only have one button on the left and one button on the right.</p><p>Usually the button on the left is a <span class="strong"><strong>Back</strong></span> button. This is typically given a left-pointing arrow, but the only way to do this is to create an image and pass it to the plugin. For our purposes, we decided to use a regular button without the left-pointing arrow. The plugin does have instructions on how to create the image and add it to the project if you want it, though.</p></div></div>
<div class="section" title="Adding the tab bar"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec84"/>Adding the tab bar</h1></div></div></div><p>In the social view and <a id="id961" class="indexterm"/>
<a id="id962" class="indexterm"/>tweet view we've had something similar to an iOS-native tab bar – something we called a toolbar. This is where the <span class="strong"><strong>Share</strong></span> button in the tweet view lived. Unfortunately there's no native plugin for an actual toolbar, so we moved the <span class="strong"><strong>Share</strong></span> button to the navigation bar.</p><p>In the social view, however, we're using the toolbar just like a real tab bar—namely a method to switch the contents of the view. We have five icons that represent Twitter accounts, and pressing any one of them will load recent posts from that stream. This works perfectly for a tab bar. Here's how it will look:</p><div class="mediaobject"><img src="graphics/9403_09_04.jpg" alt="Adding the tab bar"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec194"/>Getting ready</h2></div></div></div><p>There's only one hitch. While we were able to display full-color, pretty avatars in our HTML tab bar, the iOS-native tab bar doesn't support that. In fact, it requires the images to be masks. iOS will then create the non-selected and selected images it uses on the tab bar from that mask. Essentially whatever is <span class="emphasis"><em>white</em></span> (realistically, whatever has a value other than transparent) is painted on to the tab bar, and whatever is <span class="emphasis"><em>transparent</em></span> isn't painted on to the tab bar.</p><p>This means we can't use the images we get from Twitter. We'd end up with five rectangle-shaped icons with no similarity to the original avatars. So we need to create our own versions in Photoshop or your preferred editor.</p><p>For tab bars, the best size to aim it is 30 x 30 for non-retina displays and 60 x 60 for retina displays. Then each image is saved as <code class="literal">tab#.png</code> and <code class="literal">tab#@2x.png</code>. The <code class="literal">@2x</code> version is for the retina displays. You can see each one in our code download in the <code class="literal">www/images</code> directory. All we did was to take the avatar from Twitter and color it white and then strip out all the background stuff and make it transparent.</p></div><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec195"/>Getting on with it</h2></div></div></div><p>We'll be doing<a id="id963" class="indexterm"/>
<a id="id964" class="indexterm"/> most of our work in our social view this time, since it's really the only view that did anything close to what a real tab bar does. Even so, we do need to add some code to <code class="literal">app.js</code> again (in the same spot as the previous task):</p><div class="informalexample"><pre class="programlisting">    window.addEventListener("resize", function() {
        plugins.navigationBar.resize();
        plugins.tabBar.resize(); }
    , false);

    plugins.navigationBar.init();
    plugins.tabBar.init();

    plugins.navigationBar.create();
    plugins.tabBar.create();
  
    plugins.navigationBar.hideLeftButton();
    plugins.navigationBar.hideRightButton();

    plugins.navigationBar.setTitle(__T("APP_TITLE"));

    plugins.navigationBar.show();</pre></div><p>Notice the two commands to initialize and create the tab bar. This has to be done here as the tab bar must always follow the initialization and creation of the navigation bar; otherwise the size of the web view (sandwiched in between) will be incorrectly set.</p><p>Now, let's go to our social view:</p><div class="informalexample"><pre class="programlisting">socialView.initializeToolbar = function() {
  var users = TWITTER.users;

  if (users.error) {
    console.log(streams.error);
    alert("Rate limited. Please try again later.");
    return;
  }

  for (var i = 0; i &lt; users.length; i++) {
    plugins.tabBar.createItem("tab" + i,users[i].getScreenName(),"/www/images/tab"+i+".png",
        {
        onSelect: function(tabName) {var i = tabName.substr(3,1);
          socialView.loadStreamFor('@' + users[i].getScreenName());
        }
    });
    
  }
}</pre></div><p>First, we create<a id="id965" class="indexterm"/>
<a id="id966" class="indexterm"/> a tab bar item for each Twitter account. We give it the name of <code class="literal">tab#</code>—so <code class="literal">tab0</code>, <code class="literal">tab1</code>, and so on. We give the Twitter account name as the text of the tab bar, and then we use the images we created earlier as the icons for each tab bar instead of using the avatars Twitter gives us. Notice that we don't ever specify <code class="literal">@2x</code>; iOS just knows to use it when on a retina display. (Magic! It's also worth noting that the same thing happens when writing native code; rarely does one have to worry about appending <code class="literal">@2x</code> programmatically.)</p><p>We also add an <code class="literal">onSelect</code> handler to each tab item. We'll take the last character of the name of the tab item, which will be a number from <code class="literal">0</code> to <code class="literal">4</code>, and then load the stream for that index. This means tapping on the first tab bar (named <code class="literal">tab0</code>) will load the stream for the first Twitter account.</p><div class="informalexample"><pre class="programlisting">…
socialView.viewDidAppear = function() {
  plugins.navigationBar.hideLeftButton();
  plugins.navigationBar.hideRightButton();
  plugins.navigationBar.setTitle(socialView.currentTitle);
 plugins.navigationBar.setupLeftButton( __T("BACK"), null, socialView.backButtonPressed);
  plugins.navigationBar.setupRightButton(__T("#"), null, socialView.changeReturnCount);
  plugins.navigationBar.showLeftButton();
  plugins.navigationBar.showRightButton();

  plugins.tabBar.show();
  plugins.tabBar.showItems("tab0","tab1","tab2","tab3","tab4");
…
}</pre></div><p>Now we've added the code to show the tab bar. We've also added the code to show each tab bar item. Since we know we'll always have five items, we just hardcode these values for now, but it would be equally possible to create lots of tab bar items and only show a few at a time.</p><div class="informalexample"><pre class="programlisting">socialView.viewWillHide = function() {
  plugins.navigationBar.hideLeftButton();
  plugins.navigationBar.hideRightButton();
  plugins.navigationBar.setTitle("");
  plugins.tabBar.hide();
…
}</pre></div><p>Finally, we clean up after ourselves and hide the tab bar whenever the view hides. This keeps the tab bar from being visible on any other view.</p></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec196"/>What did we do?</h2></div></div></div><p>In this task, we created the tab bar and then assigned tab bar items to it. We also assigned callback functions to each tab bar item.</p></div><div class="section" title="What else do I need to know?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec197"/>What else do I need to know?</h2></div></div></div><p>Apple<a id="id967" class="indexterm"/> is <a id="id968" class="indexterm"/>
<a id="id969" class="indexterm"/>pretty strict when it comes to how a tab bar works. For one, on anything other than an iPad, it should never have more than five icons. (The reasons are pretty obvious: there's not a lot of space!)</p><p>So, what to do if you need more than five tabs? The accepted method would be to show four of those icons, add a <span class="emphasis"><em>more</em></span> icon (consisting of three dots as the image), and then when the user taps that tab, show the remaining tabs in a table list. You can see this behavior in the <span class="emphasis"><em>Music</em></span> app on the iPhone and iPod Touch, and if we were writing native code, we'd get this behavior nearly for free.</p><p>But we aren't writing native code, and so we have to do this manually. This means, if you want more than five tabs, you'll need to manually create the <span class="emphasis"><em>more</em></span> tab and display the list of remaining tabs in a list on your own. One more catch: on an iPad, you should display all the tabs—displaying a <span class="emphasis"><em>more</em></span> button is valid only for the iPhone and iPod Touch.</p><p>Finally, Apple highly suggests that one use no more than seven tabs on an iPad, but this is not as rigorously enforced.</p></div></div>
<div class="section" title="Adding the ActionSheet"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec85"/>Adding the ActionSheet</h1></div></div></div><p>ActionSheets<a id="id970" class="indexterm"/>
<a id="id971" class="indexterm"/> are great ways to present a few limited choices to the user, and so far we've been doing the equivalent by using pop-up message boxes with several buttons in them. For this project, we're going to display an ActionSheet when the user taps the <span class="strong"><strong>Share</strong></span> button in the tweet view. Here's how it will look:</p><div class="mediaobject"><img src="graphics/9403_09_05.jpg" alt="Adding the ActionSheet"/></div><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec198"/>Getting on with it</h2></div></div></div><p>In <code class="literal">TweetView.html</code>:</p><div class="informalexample"><pre class="programlisting">tweetView.share = function() {
  var actionSheet = window.plugins.actionSheet;
  actionSheet.create(__T('Share'), ['Twitter', 'Facebook', __T('Email'), __T('Cancel')],
  function(buttonValue, buttonIndex) {
    if (buttonIndex==0)
    {
      PKUTIL.showURL("https://twitter.com/intent/tweet?text=" + encodeURIComponent(tweetView.theTweet.text) + "%20(via%20" + encodeURIComponent("@" + (tweetView.theTweet.from_user || tweetView.theTweet.user.screen_name)) + ")");
    }
  }, {cancelButtonIndex: 3});</pre></div><p>First off, we create the ActionSheet using <code class="literal">actionSheet.create()</code>. We give the sheet a title (<code class="literal">Share</code>), and then specify the buttons that can appear (<code class="literal">Twitter</code>, <code class="literal">Facebook</code>, <code class="literal">Email</code>, and <code class="literal">Cancel</code>). We then specify the handler for the ActionSheet, which will share the tweet to Twitter if the <span class="strong"><strong>Twitter</strong></span> button is tapped. It won't do anything yet for the other buttons. Finally, we indicate that the <span class="strong"><strong>Cancel</strong></span> button is the last button. This is so that iOS will know to color the <span class="strong"><strong>Cancel</strong></span> button a different color to make it obvious that it is different. (Remember that indexes are zero-based.)</p><p>When our <a id="id972" class="indexterm"/>
<a id="id973" class="indexterm"/>callback is invoked, we get two values: <code class="literal">buttonIndex</code> and <code class="literal">buttonValue</code>. While <code class="literal">buttonValue</code> could be useful, chances are good this could be anything, especially when we consider localization. Instead it's better to use <code class="literal">buttonIndex</code>. The first button will be <code class="literal">buttonIndex</code> <code class="literal">zero</code>, and so on.</p></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec199"/>What did we do?</h2></div></div></div><p>In this task, we added an ActionSheet when the user taps on the <span class="strong"><strong>Share</strong></span> button for a specific tweet.</p></div><div class="section" title="What else do I need to know?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec200"/>What else do I need to know?</h2></div></div></div><p>The ActionSheet is a pretty nifty thing, and it works really well on an iPhone or iPod Touch. On the iPad, it will appear in the center of the screen as a popover, not the best user interface, but something we can deal with. There are native methods you can use to position it correctly and add an arrow, but Apple seems to take apps using centered ActionSheets too, so we're not worrying about that now.</p><p>Something else that we need to know is that it's a good idea to keep the number of items to a small number, or the list will start to get really long. While the ActionSheet is supposed to condense these into a scrollable list view when this happens, there are bugs as to when it happens. This means that you can get a really long list that has some buttons cut off or missing entirely. (This is usually most visible on the iPad.)</p><p>Long story-short, keep the number of items to a reasonable value. Five or less is probably a good idea on a small device, and ten or less on an iPad.</p></div></div>
<div class="section" title="Adding the message box"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec86"/>Adding the message box</h1></div></div></div><p>So far we've done pretty <a id="id974" class="indexterm"/>
<a id="id975" class="indexterm"/>good with our own message box. It's not quite like an iOS-native message box, but it's pretty close. In this case, though, we want to go all the way.</p><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec201"/>Getting on with it</h2></div></div></div><p>Working with the Message Box plugin is really easy. Let's go back to the <code class="literal">share()</code> method<a id="id976" class="indexterm"/> in our Tweet View:</p><div class="informalexample"><pre class="programlisting">tweetView.share = function() {
  var actionSheet = window.plugins.actionSheet;
  actionSheet.create('Share', ['Twitter', 'Facebook', 'Email', 'Cancel'],
  function(buttonValue, buttonIndex) {
    if (buttonIndex==0)
    {
      PKUTIL.showURL("https://twitter.com/intent/tweet?text=" + encodeURIComponent(tweetView.theTweet.text) + "%20(via%20" + encodeURIComponent("@" + (tweetView.theTweet.from_user || tweetView.theTweet.user.screen_name)) + ")");
    }
<span class="strong"><strong>    if (buttonIndex==1)</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      var messageBox = window.plugins.messageBox;</strong></span>
<span class="strong"><strong>      messageBox.alert('Not Implemented', 'Sorry, sharing with FaceBook is not yet implemented.',</strong></span>
<span class="strong"><strong>      function(button) {</strong></span>
<span class="strong"><strong>        console.log('button ' + button + ' pressed');</strong></span>
<span class="strong"><strong>        });</strong></span>
<span class="strong"><strong>    }</strong></span>
  }, {cancelButtonIndex: 3});</pre></div><p>I've highlighted the preceding code that displays a native message box. In this case, we use it for the second button on our ActionSheet: <code class="literal">FaceBook</code>. Since we've not implemented it yet, we display a nice notice to the user. Here's what it looks like:</p><div class="mediaobject"><img src="graphics/9403_09_06.jpg" alt="Getting on with it"/></div><p>Just like the <a id="id977" class="indexterm"/>
<a id="id978" class="indexterm"/>ActionSheet and tab bar, we can respond (if we like) to any pressed buttons. In this case, we just log it to the console, but there are confirmation message boxes that one could use to make different things happen depending on what button was pressed.</p></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec202"/>What did we do?</h2></div></div></div><p>We displayed a native message box and handled the callback when a button is pressed.</p></div><div class="section" title="What else do I need to know?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec203"/>What else do I need to know?</h2></div></div></div><p>
<span class="emphasis"><em>Never, ever do this in a real application</em></span>. I don't mean never use a message box; no, I mean never tell a user a feature isn't implemented in the first place. In fact, never show them that the feature was intended to be implemented but wasn't. Users don't appreciate it very much, and Apple will certainly reject the app if you leave it in.</p><p>The message box plugin describes other uses, including confirmation boxes, input boxes, and password input boxes. Read the plugin's readme for more information about how to use these additional features.</p></div></div>
<div class="section" title="Adding the picker"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec87"/>Adding the picker</h1></div></div></div><p>Pickers are<a id="id979" class="indexterm"/>
<a id="id980" class="indexterm"/> all over the place in iOS, and we really don't have a good analogue for them in our own framework yet. These things look like the following screenshot:</p><div class="mediaobject"><img src="graphics/9403_09_07.jpg" alt="Adding the picker"/></div><p>They're great at showing several choices at once and letting the user select one. They are often used to pick calendar dates, times, or even just a specific number out of a large range. They are good for this because they allow the user to scroll over a large range quickly.</p><p>In our example, we're just going to give a few options, but we could have had two hundred items in here with no real loss of functionality (but really, the user wouldn't need all of those in our case).</p><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec204"/>Getting on with it</h2></div></div></div><p>We're going to go back to the social view for a moment and revisit something we said we'd come back to. Remember that <span class="strong"><strong>#</strong></span> button? Yeah, now's the time we handle it.</p><p>Essentially, we're going to give the user the option to pick how many tweets they want to be loaded at once. Cool, right? This could be done in an ActionSheet, but the number of items is more than would really fit well, and so we'll use a picker instead.</p><div class="informalexample"><pre class="programlisting">socialView.numberOfTweets = 100;
…
socialView.loadStreamFor = function(searchPhrase) {
…
  var aStream = new TWITTER.TwitterStream(searchPhrase, function(theStream) {
…
  }, socialView.numberOfTweets);
}</pre></div><p>First off, we've <a id="id981" class="indexterm"/>
<a id="id982" class="indexterm"/>added a new property to the view: the number of tweets to load; and we've defaulted this to <code class="literal">100</code>. Then we modified <code class="literal">loadStreamFor()</code> to use this value instead of the hard coded value in <a class="link" href="ch02.html" title="Chapter 2. Let's Get Social!">Project 2</a>, <span class="emphasis"><em>Let's Get Social!</em></span>
</p><div class="informalexample"><pre class="programlisting">socialView.changeReturnCount = function ()
{
  var pickerView = window.plugins.pickerView;
  var slots = [
    {name: 'count', value: socialView.numberOfTweets, data: [
        {value: 25, text: __T('Twenty-Five')},
        {value: 50, text: __T('Fifty')},
        {value: 75, text: __T('Seventy-Five')},
        {value:100, text: __T('One Hundred')},
        {value:125, text: __T('One Hundred Twenty-Five')},
        {value:150, text: __T('One Hundred Fifty')},
        {value:175, text: __T('One Hundred Seventy-Five')},
        {value:200, text: __T('Two Hundred')}
      ]}
  ];</pre></div><p>Next, we create the values that we want to display in our picker. The <span class="emphasis"><em>name</em></span> isn't displayed anywhere; it's just used when we get told what the user selected. The first <span class="emphasis"><em>value</em></span> is the currently selected value. This means the picker will show the user which item is currently selected. The remaining items define the value and the display text for each item. So the user will see <code class="literal">Twenty-Five</code>, but we'll get back <code class="literal">25</code>.</p><div class="informalexample"><pre class="programlisting">  pickerView.create(__T('Number of Tweets'), slots, function(selectedValues, buttonIndex) {
    if (buttonIndex == 1)
    {
      socialView.numberOfTweets = selectedValues["count"];
      socialView.loadStreamFor(socialView.currentTitle);
    }
  },  {style: 'black-opaque', doneButtonLabel: __T('OK'), cancelButtonLabel: __T('Cancel')});
}</pre></div><p>Next, we actually create the picker. We give it the title of <code class="literal">Number of Tweets</code>, so the user knows what they are setting. We pass in the values to display (slots), and then pass in a callback handler. This handler will set the value to the selected value and reload the Twitter stream, but only if the user taps on <span class="strong"><strong>OK</strong></span>. Finally, we set the style (black), and pass in the names of the two buttons.</p><p>Pickers aren't limited to single-value lists. You can get multiple columns going, which is useful when setting a date, for example. You could have a Year column, a Month column, and a Date column. See the Plugin's readme file for more information on how to do this.</p></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec205"/>What did we do?</h2></div></div></div><p>We created a<a id="id983" class="indexterm"/>
<a id="id984" class="indexterm"/> picker, filled it with data, and reacted to the user picking a specific result.</p></div></div>
<div class="section" title="Adding the e-mail composer"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Adding the e-mail composer</h1></div></div></div><p>Sharing via e-mail is <a id="id985" class="indexterm"/>
<a id="id986" class="indexterm"/>built in to nearly every app, and yet it's difficult to actually accomplish without using a plugin. Since this app is intended to share things easily, let's add sharing via e-mail.</p><div class="section" title="Getting on with it"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec206"/>Getting on with it</h2></div></div></div><p>Back in our tweet view, we have the following:</p><div class="informalexample"><pre class="programlisting">tweetView.share = function() {
  var actionSheet = window.plugins.actionSheet;
  actionSheet.create('Share', ['Twitter', 'Facebook', 'Email', 'Cancel'],
  function(buttonValue, buttonIndex) {
    if (buttonIndex==0)
    {
      PKUTIL.showURL("https://twitter.com/intent/tweet?text=" + encodeURIComponent(tweetView.theTweet.text) + "%20(via%20" + encodeURIComponent("@" + (tweetView.theTweet.from_user || tweetView.theTweet.user.screen_name)) + ")");
    }
    if (buttonIndex==1)
    {
      var messageBox = window.plugins.messageBox;
      messageBox.alert('Not Implemented', 'Sorry, sharing with FaceBook is not yet implemented.',
        function(button) {
          console.log('button ' + button + ' pressed');
        });
    }
<span class="strong"><strong>    if (buttonIndex==2)</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      cordova.exec(null, null, "EmailComposer", "showEmailComposer",</strong></span>
<span class="strong"><strong>         [{"body": tweetView.theTweet.text + " (via @" + (tweetView.theTweet.from_user || tweetView.theTweet.user.screen_name) + ")",</strong></span>
<span class="strong"><strong>         "subject": "Thought this was interesting..." }]);</strong></span>
<span class="strong"><strong>    }</strong></span>
  }, {cancelButtonIndex: 3});

}</pre></div><p>Again, we're in the<a id="id987" class="indexterm"/> <code class="literal">share()</code> method, and I've highlighted the code that's changed. Here we're responding to the <span class="strong"><strong>Email</strong></span> button, which is index <code class="literal">2</code>. We call the plugin using <code class="literal">cordova.exec()</code>, giving it the plugin name and the method we want to use (<code class="literal">showEmailComposer</code>). Then we pass the body and subject to the plugin. The body will be the tweet, plus who it was from, and the subject will be "<span class="emphasis"><em>Thought this was interesting…"</em></span>. We<a id="id988" class="indexterm"/>
<a id="id989" class="indexterm"/> could pass in more information, such as who the message should be sent to, but in our case, we don't know that information, so we don't send it on to the plugin.</p><p>Once done, we let go of control entirely, though it is possible to determine if the user actually did share via e-mail or not. In our case, we don't really care if they did, just that we offer the option to do so.</p><p>Here's what it looks like:</p><div class="mediaobject"><img src="graphics/9403_09_08.jpg" alt="Getting on with it"/></div></div><div class="section" title="What did we do?"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec207"/>What did we do?</h2></div></div></div><p>In this task, we <a id="id990" class="indexterm"/>
<a id="id991" class="indexterm"/>created an e-mail composer with the subject and body set to data we specified.</p></div></div>
<div class="section" title="Game Over..... Wrapping it up"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Game Over..... Wrapping it up</h1></div></div></div><p>We've accomplished quite a bit—we used seven plugins in total, and our app looks and feels pretty native now. It's not perfect; for example, navigation bars have a cool animation on native apps and in our app, it <span class="emphasis"><em>blanks out</em></span> during view changes, but other than that, things look and feel pretty close to what a user would expect.</p></div>
<div class="section" title="Can you take the HEAT? The Hotshot Challenge"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Can you take the HEAT? The Hotshot Challenge</h1></div></div></div><p>Of course, there are always things that can be added and changed. Why don't you try a few of these challenges:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add Facebook sharing to the app.</li><li class="listitem" style="list-style-type: disc">Store the number of tweets to load so that it is a persistent setting.</li><li class="listitem" style="list-style-type: disc">Change up the way the navigation bar is cleared at the end of each view; try to achieve a more <span class="emphasis"><em>native</em></span> feel. To truly achieve a native feel, you may need to delve into native code.</li><li class="listitem" style="list-style-type: disc">Want a really complicated challenge? Download the avatars from Twitter and then figure out how to mask them programmatically. Then save them to the user's temporary storage and use them as the icons on the tab bar.</li></ul></div></div></body></html>