<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Dynamic Visualforce Bindings"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Dynamic Visualforce Bindings</h1></div></div></div><p>The dynamic Visualforce binding<a id="id197" class="indexterm"/> is one of the greatest features of the Spring '11 release. We can use this feature to build generic Visualforce pages without thinking which record fields have to be shown on the page. The record fields are determined at runtime rather than compile time. This is a powerful feature which allows us to minimize the code (Visualforce and Apex code). Otherwise, we have to write more queries, and have to populate lists of records, and render more fields. Using the dynamic Visualforce binding, we can develop a single page that renders differently for various users based on their authorizations or preferences.</p><p>This chapter covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using dynamic references with standard objects and custom objects</li><li class="listitem" style="list-style-type: disc">Referencing Apex Maps and Lists</li><li class="listitem" style="list-style-type: disc">Working with field sets</li><li class="listitem" style="list-style-type: disc">Dynamic references to global variables</li></ul></div><p>Let's learn about dynamic Visualforce binding…</p><div class="section" title="Using dynamic references with standard objects and custom objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec32"/>Using dynamic references with standard objects and custom objects</h1></div></div></div><p>Dynamic <a id="id198" class="indexterm"/>Visualforce binding is supported for both standard and<a id="id199" class="indexterm"/> custom objects in Salesforce. We <a id="id200" class="indexterm"/>can use dynamic binding in the <a id="id201" class="indexterm"/>following form:</p><p>
<code class="literal">reference[expression]</code>
</p><p>Let's discuss the preceding form in detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">reference</code>: This can be an sObject, an Apex class, or a global variable.</li><li class="listitem" style="list-style-type: disc"><code class="literal">expression</code>: This can be the name of the field or a related object. If it is a related object, then recursively-selected fields or further related objects can be used.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip23"/>Tip</h3><p>Dynamic bindings<a id="id202" class="indexterm"/> can be used in the page where formula expressions are valid. It is used with the <code class="literal">{!}</code> notation. If it is referenced from an Apex class, then the particular attribute (sObject or variable) must be public or global.</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>
<span class="strong"><strong>Defining relationships</strong></span>: If there are<a id="id203" class="indexterm"/> object relationships to be evaluated in expressions, they become complex expressions. Consider our example, where the <code class="literal">Order__c</code> custom object has a relationship with the <code class="literal">Customer__c</code> custom object. The relationship between these two objects is called <code class="literal">Orders__r</code>. The <code class="literal">Customer__c</code> object has the <code class="literal">Email__c</code> field. The same <code class="literal">Email__c</code> field will be returned by the following dynamically-cast lookups:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c.Customer__c['Email__c']</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c['Customer__c.Email__c']</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c['Customer__c']['Email__c']</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c.Orders__r[Email__c]</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c[Orders__r.Email__c]</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Order__c[Orders__r][Email__c]</code></li></ul></div></div></div><p>A dynamic <a id="id204" class="indexterm"/>Visualforce page must have a <a id="id205" class="indexterm"/>standard controller and further <a id="id206" class="indexterm"/>implementations can be done in an<a id="id207" class="indexterm"/> associated controller extension. The reason is that Visualforce automatically handles the optimization of the SOQL queries performed by the page's<a id="id208" class="indexterm"/> <code class="literal">StandardController</code> or <code class="literal">StandardSetController</code> object<a id="id209" class="indexterm"/> by loading only the used fields.</p><p>When we create a page with static references, the page can identify the fields and objects during compilation. Then the <code class="literal">StandardController</code> object will transform the particular fields and objects into SOQL queries. But the dynamic references are evaluated at runtime and not at compile time. This means that the dynamic references are evaluated after performing the SOQL query<a id="id210" class="indexterm"/> of the <code class="literal">StandardController</code> object. Therefore, when we use dynamic references and we have to provide some extra information to the controller extension, we can use the <code class="literal">addFields()</code> method<a id="id211" class="indexterm"/> to add any number of additional fields. This method will pass a list of additional fields to <code class="literal">StandardController</code> and those fields will load without giving runtime errors. The usage of the <code class="literal">addField()</code> method<a id="id212" class="indexterm"/> is as follows:</p><div class="informalexample"><pre class="programlisting">public DynamicOrderExtension(ApexPages.StandardController controller) {         
controller.addFields(editableFields);
}</pre></div><p>The following example shows the usage of dynamic Visualforce binding. This page shows an order record with some editable fields. Some fields are related to <code class="literal">object(Customer__c)</code>. We can understand the usage of dynamic reference with object relationship traversing.</p><div class="informalexample"><pre class="programlisting">&lt;apex:page standardController="Order__c" extensions="DynamicOrderExtension"&gt;
    &lt;apex:pageMessages /&gt;&lt;br/&gt;
    &lt;apex:form &gt;
        &lt;apex:pageBlock title="Edit Order" mode="edit"&gt;        
            &lt;apex:pageBlockSection columns="1"&gt;
                &lt;apex:inputField value="{!Order__c.Name}"/&gt;
                &lt;apex:repeat value="{!editableFields}" var="f"&gt;
                    &lt;apex:inputField value="{!Order__c[f]}"/&gt;
                &lt;/apex:repeat&gt;
            &lt;/apex:pageBlockSection&gt;
        &lt;/apex:pageBlock&gt;
    &lt;/apex:form&gt;
&lt;/apex:page&gt;</pre></div><p>The following code is the <a id="id213" class="indexterm"/>controller extension of the<a id="id214" class="indexterm"/> preceding Visualforce page. The<a id="id215" class="indexterm"/> <code class="literal">DynamicOrderExtension</code> controller<a id="id216" class="indexterm"/> extension has a list of strings called <code class="literal">editableFields</code> and this string list contains some fieldnames of the <code class="literal">Order__c</code> object and some fields of related object (<code class="literal">Customer__c</code>) of <code class="literal">Order__c</code>. In this example, editable fields are hardcoded. But we can get information for your dynamic references by using the Apex's <code class="literal">Schema.sObjectType</code> methods. This will make a more dynamic and powerful reference. For example, <code class="literal">Schema.SobjectType.Order__c.fields.getMap()</code> returns a map with the name of the <code class="literal">Order__c</code> fields. The preceding markup has the <code class="literal">&lt;apex:repeat&gt;</code> tag, which is used to loop the <code class="literal">editableFields</code> string list and the <code class="literal">&lt;apex:inputField&gt;</code> tag which displays that particular returned string. It represents the field names of the order and the related object's field names. The following markup line displays the dynamic reference:</p><div class="informalexample"><pre class="programlisting">&lt;apex:inputField value="{!Order__c[f]}"/&gt;

public with sharing class DynamicOrderExtension {
    public final Order__c orderDetails { get; private set; }
    
    public DynamicOrderExtension(ApexPages.StandardController controller) { 
        String qid = ApexPages.currentPage().getParameters().get('id');
        String theQuery = 'SELECT Id, ' + joinList(editableFields, ', ') +
        ' FROM Order__c WHERE Id = :qid';
        this.orderDetails = Database.query(theQuery);
        controller.addFields(editableFields);
    }
    
    public List&lt;String&gt; editableFields {
        get {
            if (editableFields == null) {
                editableFields = new List&lt;String&gt;();
                editableFields.add('Delivered__c');
                editableFields.add('Customer__c');
                editableFields.add('Planned_Delivery_Date__c');
                editableFields.add('Status__c');
                editableFields.add('Customer__r.Email__c');
            }
            return editableFields ;
        }
        private set;
    }
    
    private static String joinList(List&lt;String&gt; theList, String separator) {
       
        if (theList == null) {
            return null;
        }
        
        if (separator == null) {
            separator = '';
        }
        
        String joined = '';
        Boolean firstItem = true;
        
        for (String item : theList) {
            if(null != item) {
                if(firstItem){
                    firstItem = false;
                }
                else {
                    joined += separator;
                }
                joined += item;
            }
        }
        return joined;
    }
}</pre></div><p>This page needs to<a id="id217" class="indexterm"/> be accessed with the ID of a<a id="id218" class="indexterm"/> valid case record specified as the id query <a id="id219" class="indexterm"/>parameter. For<a id="id220" class="indexterm"/> example, <a class="ulink" href="https://c.ap1.visual.force.com/apex/DynamicBindingExample?id=a02900000086Hlr">https://c.ap1.visual.force.com/apex/DynamicBindingExample?id=a02900000086Hlr</a>.</p></div></div>
<div class="section" title="Referencing Apex Maps and Lists"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec33"/>Referencing Apex Maps and Lists</h1></div></div></div><p>Apex Maps<a id="id221" class="indexterm"/> and Lists<a id="id222" class="indexterm"/> can be dynamically refered in a Visualforce page. Apex Lists are vastly used with the <code class="literal">&lt;apex:pageBlockTable&gt;</code> and <code class="literal">&lt;apex:repeat&gt;</code> tags. In our preceding example (under the <span class="emphasis"><em>Using Dynamic references with Standard objects and custom object</em></span> section) we have already seen the dynamic<a id="id223" class="indexterm"/> references of Apex List. The following example shows the <a id="id224" class="indexterm"/>dynamic reference of an Apex Map. This is the markup of the <code class="literal">DynamicExampleListMap</code> page:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page controller="DynamicBindingsMapListExample"&gt;
  &lt;apex:form &gt;
    &lt;apex:actionFunction name="reDisplayCustomers" rerender="cust" /&gt;
    &lt;apex:pageBlock title="Criteria"&gt;
       &lt;apex:outputLabel value="Starting Letter"/&gt;
       &lt;apex:selectList value="{!selectedKey}" size="1" onchange="reDisplayCustomers()"&gt;
          &lt;apex:selectOptions value="{!keys}" /&gt;
       &lt;/apex:selectList&gt;
    &lt;/apex:pageBlock&gt;
    &lt;apex:pageBlock title="Customers"&gt;
       
             &lt;apex:outputPanel id="cust"&gt;
                &lt;apex:pageBlockTable value="{!customerMap[selectedKey]}" var="cus"&gt;
                   &lt;apex:column value="{!cus.name}"/&gt;
                   &lt;apex:column value="{!cus.Address__c}"/&gt;
                   &lt;apex:column value="{!cus.Email__c}"/&gt;
                  
                &lt;/apex:pageBlockTable&gt;
             &lt;/apex:outputPanel&gt;
    &lt;/apex:pageBlock&gt;
  &lt;/apex:form&gt;
&lt;/apex:page&gt;</pre></div><p>The following is the <a id="id225" class="indexterm"/>related custom controller. The <code class="literal">customerMap</code> object contains<a id="id226" class="indexterm"/> the customer's records and the pick list is dynamically filled with the appropriate values from the Map. We can select a letter from the pick list and the customer list, and then rearrange the result according to the selected letter. The <code class="literal">customerMap</code> object returns the corresponding customer list at runtime by using the <code class="literal">{!customerMap[selectedKey]}</code> dynamic reference:</p><div class="informalexample"><pre class="programlisting">public class DynamicBindingsMapListExample
{
    public Map&lt;string, List&lt;Customer__c&gt;&gt; customerMap{get; set;}
    public List&lt;selectoption&gt; keys {get; set;}
    public String selectedKey {get;set;}
    public Map&lt;string, Customer__c&gt; custByName {get;set;}
     
    public Set&lt;string&gt; getMapKeys()
    {
        return customerMap.keySet();
    }
     
    public DynamicBindingsMapListExample()
    {
        custByName = new Map&lt;string, Customer__c&gt;();
        List&lt;string&gt; sortedKeys=new List&lt;string&gt;();
        customerMap = new Map&lt;string, list&lt;Customer__c&gt;&gt;();
        customerMap.put('All', new List&lt;Customer__c&gt;());
        List&lt;Customer__c&gt; customers = [SELECT Id, Name, Email__c, Address__c FROM Customer__c ORDER BY Name asc];
                             
                             
        for (Customer__c tempCustomer : customers)
        {
            customerMap.get('All').add(tempCustomer);
            String start = tempCustomer.Name.substring(0,1);
            List&lt;Customer__c&gt; custFromMap = customerMap.get(start);
            if (custFromMap == null)
            {
                custFromMap =new List&lt;Customer__c&gt;();
                customerMap.put(start, custFromMap);
            }
            custFromMap.add(tempCustomer);
            custByName.put(tempCustomer.name, tempCustomer);
        }
         
        keys=new List&lt;selectoption&gt;();
        for (String key : customerMap.keySet())
        {
            if (key != 'All')
            {
                sortedKeys.add(key);
            }
        }
        sortedKeys.sort();
        sortedKeys.add(0, 'All');
         
        for (String key : sortedKeys)   {
            keys.add(new SelectOption(key, key));
        }         
        selectedKey='All';
    }
}</pre></div></div>
<div class="section" title="Working with field sets"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec34"/>Working with field sets</h1></div></div></div><p>A field set<a id="id227" class="indexterm"/> is a group of fields which can be defined in a declarative manner. Field sets are available in Visualforce pages in the API Version 21.0. These field sets can be displayed on a Visuaforce page by dynamic binding. For example, suppose we have created a field set (field set name: <code class="literal">CustomerDetails</code>) with the <code class="literal">Email__c</code>, <code class="literal">Name</code>, and <code class="literal">Address__c</code> fields of the customer object. We can refer to the <code class="literal">CustomerDetails</code> <a id="id228" class="indexterm"/>field set in Visualforce as follows:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page standardController="Customer__c"&gt;
    &lt;apex:repeat value="{!$ObjectType.Customer__c.FieldSets.CustomerDetails}" var="f"&gt;
        &lt;apex:outputText value="{! Customer__c [f]}" /&gt;&lt;br/&gt;
    &lt;/apex:repeat&gt;
&lt;/apex:page&gt;</pre></div><p>When we want to create a managed package or add/ remove/reorder fields in the field set, we can accomplish that without modifying any code.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip24"/>Tip</h3><p>A Visualforce page can have up to 50 field sets.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Summary</h1></div></div></div><p>In this chapter, we learned about the powerful feature of dynamic binding, which was released by Spring'11. We became familiar with the usage of standard and custom object dynamic references. And we acquired a good knowledge of referencing Apex Maps/List and the way of using field sets. We have also seen the usage of dynamic reference of global variables. With all these, we learned the mechanisms of minimizing the Visualforce and Apex code.</p></div></body></html>