<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Templating Engines" id="aid-TI1E1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Templating Engines</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Rendering Jade templates</li><li class="listitem">Using data in a Jade template</li><li class="listitem">Using custom filters in a Jade template</li><li class="listitem">Compiling Jade templates</li><li class="listitem">Compiling Handlebars templates</li><li class="listitem">Compiling Underscore templates</li><li class="listitem">Using partials in Handlebars templates</li><li class="listitem">Wrapping Jade templates in AMD modules</li><li class="listitem">Wrapping Handlebars templates in AMD modules</li><li class="listitem">Wrapping Underscore templates in AMD modules</li><li class="listitem">Wrapping Handlebars templates in CommonJS modules</li><li class="listitem">Altering Jade templates before compilation</li><li class="listitem">Altering Handlebars templates before compilation</li><li class="listitem">Altering Underscore templates before compilation</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Introduction</h1></div></div></div><p>The generation of content by combining logic and data poses a unique set of problems, and template engines are specifically designed to solve them. In this chapter, we'll mostly be focusing on generating HTML using various template engines, even though some of them are designed in such a way as to allow for the generation of pretty much any type of readable file format.</p><p>Even though many of the more feature-rich web application frameworks available in the JavaScript community provide for the on-demand compilation, rendering and caching of templates, doing so using Grunt provides for the flexibility required in building a highly optimized and specialized solution. Templates can be rendered directly to HTML or compiled to JSTs that can be used directly without any extra processing. The products of these templates can also be packaged to be made available in pretty much any environment you might want to use them in.</p><p>At the time of writing, there are many great templating engines available, and the majority of them support Grunt by way of plugins, but in this chapter, we'll focus on the ones most widely used by the Grunt community.</p></div></div>
<div class="section" title="Rendering Jade templates" id="aid-UGI01"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Rendering Jade templates</h1></div></div></div><p>The Jade template engine<a id="id0" class="indexterm"/> allows us to easily build and maintain HTML templates using its minimal yet familiar syntax. In this recipe, we'll make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin to compile a template that renders a simple HTML page.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec51"/>Getting ready</h2></div></div></div><p>In this example, we'll <a id="id1" class="indexterm"/>work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>How to do it...</h2></div></div></div><p>The following steps will take us through creating a simple Jade template and rendering it to an HTML file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-jade</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Let's create a simple Jade template called <code class="literal">index.jade</code> in our project directory, and add the following contents:<div class="informalexample"><pre class="programlisting">doctype html
html
  head
    title Index
  body
    h1 Index</pre></div></li><li class="listitem">Now, we can add the following <code class="literal">jade</code> task to our configuration, which will compile the <code class="literal">index.jade</code> file we just created to the <code class="literal">index.html</code> file in our project directory:<div class="informalexample"><pre class="programlisting">jade: {
  sample: {
    options: {
      pretty: true
    },
    src: 'index.jade',
    dest: 'index.html'
  }
}</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip29"/>Tip</h3><p>We set the <code class="literal">pretty</code> option to <code class="literal">true</code> in this example so that the HTML generated from the template can be more readable. This is usually preferred when your project is still in development, but is usually not used in production, as enabling this option increases the size of the generated files.</p></div></li><li class="listitem">Finally, we can <a id="id2" class="indexterm"/>run the task using the <code class="literal">grunt jade</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:sample" (jade) task</strong></span>
<span class="strong"><strong>File index.html created.</strong></span>
</pre></div></li><li class="listitem">If we now take a look at our project directory, we should see the new <code class="literal">index.html</code> file with the following contents:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Index&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Index&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Using data in a Jade template" id="aid-VF2I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Using data in a Jade template</h1></div></div></div><p>Once we've got a <a id="id3" class="indexterm"/>Jade template, we can use it to render the same page <a id="id4" class="indexterm"/>structure with a variety of data. In this recipe, we'll make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin in conjunction with the <code class="literal">data</code> option to send data that should be used in the rendering of the template.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec53"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Rendering Jade templates</em></span> recipe in this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec54"/>How to do it...</h2></div></div></div><p>The following steps take <a id="id5" class="indexterm"/>us through providing data when rendering our template, and <a id="id6" class="indexterm"/>altering our <code class="literal">index.jade</code> template to make use of the provided data.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll alter our <code class="literal">index.jade</code> template to make use of the variables provided by its context:<div class="informalexample"><pre class="programlisting">doctype html
html
  head
<span class="strong"><strong>    title= title</strong></span>
  body
<span class="strong"><strong>    h1= title</strong></span>
<span class="strong"><strong>    p= body</strong></span>
</pre></div></li><li class="listitem">Now, we can provide values for the <code class="literal">title</code> and <code class="literal">body</code> variables that are to be used by the template. This is done by specifying them in the <code class="literal">data</code> option that we'll add to the configuration of our <code class="literal">jade</code> task:<div class="informalexample"><pre class="programlisting">jade: {
  sample: {
    options: {
      pretty: true,
<span class="strong"><strong>      data: {</strong></span>
<span class="strong"><strong>        title: 'Most Amazing Site',</strong></span>
<span class="strong"><strong>        body: 'Disappointing mundane content.'</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'index.jade',
    dest: 'index.html'
  }
}</pre></div></li><li class="listitem">Finally, we can <a id="id7" class="indexterm"/>run the task using the <code class="literal">grunt jade</code> command, which <a id="id8" class="indexterm"/>should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:sample" (jade) task</strong></span>
<span class="strong"><strong>File index.html created.</strong></span>
</pre></div></li><li class="listitem">If we now take a look at the <code class="literal">index.html</code> file that was generated by running the task, we'll find that the variables indicated in the template were replaced by the values specified in the <code class="literal">data</code> option:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;!DOCTYPE html&gt;</strong></span>
<span class="strong"><strong>&lt;html&gt;</strong></span>
<span class="strong"><strong>  &lt;head&gt;</strong></span>
<span class="strong"><strong>    &lt;title&gt;Most Amazing Site&lt;/title&gt;</strong></span>
<span class="strong"><strong>  &lt;/head&gt;</strong></span>
<span class="strong"><strong>  &lt;body&gt;</strong></span>
<span class="strong"><strong>    &lt;h1&gt;Most Amazing Site&lt;/h1&gt;</strong></span>
<span class="strong"><strong>    &lt;p&gt;Disappointing mundane content.&lt;/p&gt;</strong></span>
<span class="strong"><strong>  &lt;/body&gt;</strong></span>
<span class="strong"><strong>&lt;/html&gt;</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec55"/>There's more...</h2></div></div></div><p>It's usually not a very good idea to keep the data used in a template hardcoded in the Grunt configuration, but rather to have it imported from an external data source.</p><p>The following steps take us through creating an external data source and altering our configuration so that the data used in rendering our template is loaded from it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll create a file called <code class="literal">data.json</code> in our project directory, which contains the data we wish to use in the rendering of our template:<div class="informalexample"><pre class="programlisting">{
  "title": "Most Amazing Site",
  "body": "Disappointing mundane content."
}</pre></div></li><li class="listitem">Then, we can alter our <code class="literal">jade</code> task's configuration to import the data from the external source by making use of the <code class="literal">grunt.file.readJSON</code> method:<div class="informalexample"><pre class="programlisting">jade: {
  sample: {
    options: {
      pretty: true,
      <span class="strong"><strong>data: grunt.file.readJSON('data.json')</strong></span>
    },
    src: 'index.jade',
    dest: 'index.html'
  }
}</pre></div></li><li class="listitem">If we <a id="id9" class="indexterm"/>now run the task using the <code class="literal">grunt jade</code> <a id="id10" class="indexterm"/>command, we should have the exact same result as in the main recipe.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Using custom filters in a Jade template" id="aid-10DJ41"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Using custom filters in a Jade template</h1></div></div></div><p>The filters provided by <a id="id11" class="indexterm"/>the Jade template engine enable us to indicate <a id="id12" class="indexterm"/>the method that should be used when processing a specific block in a template. This is usually used for blocks of content that are written in a format other than the Jade language itself. As an example, the <code class="literal">coffee</code> and <code class="literal">markdown</code> filters provided by the Jade library provide the rendering of <span class="strong"><strong>CoffeeScript</strong></span><a id="id13" class="indexterm"/> code into JavaScript and <span class="strong"><strong>Markdown</strong></span><a id="id14" class="indexterm"/> content into HTML.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin in conjunction with its <code class="literal">filters</code> option to make a custom filter called <code class="literal">link</code> available to us in our templates. This filter will use a simplistic algorithm to find URLs and surround them with an anchor tag, turning them into links.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec56"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Rendering Jade templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec57"/>How to do it...</h2></div></div></div><p>The following steps take us through adding the <code class="literal">link</code> custom filter and altering our <code class="literal">index.jade</code> template to make use of it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll add the <code class="literal">link</code> custom filter to our configuration by using the <code class="literal">filters</code> option in the <code class="literal">jade</code> task we configured before:<div class="informalexample"><pre class="programlisting">jade: {
  sample: {
    options: {
      pretty: true,
      <span class="strong"><strong>filters: {</strong></span>
<span class="strong"><strong>        link: function (block) {</strong></span>
<span class="strong"><strong>          var url_re = /(http:\/\/[^\s]*)/;</strong></span>
<span class="strong"><strong>          var link_replace = '&lt;a href="$1"&gt;$1&lt;/a&gt;';</strong></span>
<span class="strong"><strong>          return block.replace(url_re, link_replace);</strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'index.jade',
    dest: 'index.html'
  }
}</pre></div></li><li class="listitem">Now, we can<a id="id15" class="indexterm"/> alter the contents of our <code class="literal">index.jade</code> template<a id="id16" class="indexterm"/> to make use of our <code class="literal">link</code> custom filter:<div class="informalexample"><pre class="programlisting">doctype html
html
  head
    title Index
  body
    h1 Index
    <span class="strong"><strong>p</strong></span>
<span class="strong"><strong>      :link</strong></span>
<span class="strong"><strong>        Be sure to check out</strong></span>
<span class="strong"><strong>        http://gruntjs.com/</strong></span>
<span class="strong"><strong>        for more information.</strong></span>
</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt jade</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:sample" (jade) task</strong></span>
<span class="strong"><strong>File index.html created.</strong></span>
</pre></div></li><li class="listitem">If we now take a look at the <code class="literal">index.html</code> file that was generated by running the task, we'll find that it has surrounded the link we had inside the block provided to the <code class="literal">link</code> filter with an anchor tag:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Index&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Index&lt;/h1&gt;
    &lt;p&gt;
      Be sure to check out
      &lt;a href="http://gruntjs.com/"&gt;http://gruntjs.com/&lt;/a&gt;
      for more information.
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Compiling Jade templates" id="aid-11C3M1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Compiling Jade templates</h1></div></div></div><p>When building a web <a id="id17" class="indexterm"/>application that needs to render HTML templates on the frontend in as little time as possible, the compiling templates become essential. The Jade templating engine allows us to compile our templates to <span class="strong"><strong>JavaScript Templates</strong></span> (<span class="strong"><strong>JSTs</strong></span>)<a id="id18" class="indexterm"/> for use on the frontend.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin to compile a template that renders a minimalistic blog.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec58"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec59"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a simple Jade template and compiling it to a JST contained in another file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-jade</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Let's create a simple Jade template file called <code class="literal">blog.jade</code> in our project directory and give it the following contents:<div class="informalexample"><pre class="programlisting">.blog
  h1= title
  each post in posts
    .post
      h2= post.title
      p= post.body</pre></div></li><li class="listitem">Now, we can add the following <code class="literal">jade</code> task to our configuration, which will compile the <code class="literal">blog.jade</code> template into a JST contained inside the <code class="literal">templates.js</code> file of our project directory:<div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      client: true
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt jade</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:blog" (jade) task</strong></span>
<span class="strong"><strong>File templates.js created.</strong></span>
</pre></div></li><li class="listitem">We should now have a new file called <code class="literal">templates.js</code> in our project directory that contains the JST code for our compiled template.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec60"/>How it works...</h2></div></div></div><p>The following steps<a id="id19" class="indexterm"/> demonstrate the usage template of the compiled and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to include the Jade runtime library in the application or page in which you'd like to make use of the compiled templates.<div class="note" title="Note"><h3 class="title"><a id="tip30"/>Tip</h3><p>At the time of writing, the<a id="id20" class="indexterm"/> Jade runtime library was available at the root of the official Jade repository and could be downloaded from the following URL:</p><p><a class="ulink" href="https://raw.githubusercontent.com/jadejs/jade/1.11.0/runtime.js">https://raw.githubusercontent.com/jadejs/jade/1.11.0/runtime.js</a></p></div></li><li class="listitem">Then, you'll need to include the <code class="literal">templates.js</code> file that was generated by the <code class="literal">jade</code> task in the application or page to make the <code class="literal">JST</code> global variable that contains the templates available.</li><li class="listitem">The following example code will render the compiled template, using some sample data and store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">var result = JST['blog']({
  title: 'My Awesome Blog',
  posts: [{
    title: 'First Post',
    body: 'My very first post.'
  }, {
    title: 'Second Post',
    body: 'This is getting old.'
  }]
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>There's more...</h2></div></div></div><p>The <code class="literal">jade</code> task provides<a id="id21" class="indexterm"/> some useful options in conjunction with the basic compilation of templates that allows us to specify the namespace of compiled templates, indicate how template names should be derived from their filenames, and compile templates with debug support.</p><div class="section" title="Specifying the namespace of compiled templates"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec30"/>Specifying the namespace of compiled templates</h3></div></div></div><p>By default, compiled <a id="id22" class="indexterm"/>templates are stored in the <code class="literal">JST</code> namespace, but this can be changed to anything we like, by using the <code class="literal">namespace</code> option. In the following example, we configure the task to store templates in the <code class="literal">Templates</code> namespace:</p><div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      client: true,
      <span class="strong"><strong>namespace: 'Templates'</strong></span>
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Indicating how template names should be derived from filenames"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec31"/>Indicating how template names should be derived from filenames</h3></div></div></div><p>The <code class="literal">processName</code> option <a id="id23" class="indexterm"/>can be used to indicate how the names under which templates are to be stored in the namespace should be derived from their filenames. The default behavior of the <code class="literal">jade</code> task is to use everything before the file's extension. In the following example, we indicate that the entire filename should be in uppercase:</p><div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      client: true,
      <span class="strong"><strong>processName: function (filename) {</strong></span>
<span class="strong"><strong>        return filename.toUpperCase();</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Compiling templates with debug support"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec32"/>Compiling templates with debug support</h3></div></div></div><p>The Jade template engine <a id="id24" class="indexterm"/>provides extra debug support for compiled templates, which can be enabled by way of the <code class="literal">compileDebug</code> option, as it is in the following example:</p><div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      client: true,
      <span class="strong"><strong>compileDebug: true</strong></span>
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></div></div></div>
<div class="section" title="Compiling Handlebars templates" id="aid-12AK81"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Compiling Handlebars templates</h1></div></div></div><p>The Handlebars template <a id="id25" class="indexterm"/>engine simplifies the building and maintaining of any markup or other readable files. Its familiar syntax, extensibility, and logic-less approach provides a great all-round template building experience. The engine is focused mainly on compiling templates to JSTs that are mostly used in the frontend of a web application.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-handlebars (0.8.0)</code> plugin<a id="id26" class="indexterm"/> to compile a template that renders a minimalistic blog.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>How to do it...</h2></div></div></div><p>The following steps <a id="id27" class="indexterm"/>take us through creating a simple Handlebars template and setting up Grunt to compile it to a JST contained in another file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-handlebars</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Let's create a simple Handlebars template file called <code class="literal">blog.hbs</code> in our project directory and give it the following contents:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;{{title}}&lt;/h1&gt;
  {{#posts}}
    &lt;h2&gt;{{title}}&lt;/h2&gt;
    &lt;p&gt;{{body}}&lt;/p&gt;
  {{/posts}}
&lt;/div&gt;</pre></div></li><li class="listitem">Now, we can add the following <code class="literal">handlebars</code> task to our configuration, which will compile the <code class="literal">post.hbs</code> template into a JST contained inside the <code class="literal">templates.js</code> file:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt handlebars</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "handlebars:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">We should now have a new file called <code class="literal">templates.js</code> in our project directory that contains the JST code for our compiled template.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>How it works...</h2></div></div></div><p>The following steps demonstrate the usage of the compiled template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to include the Handlebars runtime library in the application or page in which you'd like to make use of the compiled templates.<div class="note" title="Note"><h3 class="title"><a id="tip31"/>Tip</h3><p>At the time of writing, the Handlebars runtime library<a id="id28" class="indexterm"/> could be downloaded from the following URL:</p><p><a class="ulink" href="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js">http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js</a></p></div></li><li class="listitem">Then, you'll <a id="id29" class="indexterm"/>need to include the <code class="literal">templates.js</code> file that was generated by the <code class="literal">handlebars</code> task in the application or page to create the <code class="literal">JST</code> global variable that contains the templates available.</li><li class="listitem">The following example code will render the compiled template, using some sample data and store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">var result = JST['blog.hbs']({
  title: 'My Awesome Blog',
  posts: [{
    title: 'First Post',
    body: 'My very first post.'
  }, {
    title: 'Second Post',
    body: 'This is getting old.'
  }]
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>There's more...</h2></div></div></div><p>The <code class="literal">handlebars</code> task provides some useful options in conjunction with the basic compilation of templates which allows us to specify the namespace for compiled templates and indicate how template names should be derived from their filenames.</p><div class="section" title="Specifying the namespace for compiled templates"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec33"/>Specifying the namespace for compiled templates</h3></div></div></div><p>By default, compiled<a id="id30" class="indexterm"/> templates are stored in the <code class="literal">JST</code> namespace, but this can be changed to anything we like, by using the <code class="literal">namespace</code> option. In the following example, we configure the task to store templates in the <code class="literal">Templates</code> namespace:</p><div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>namespace: 'Templates'</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Indicating how template names should be derived from file names"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec34"/>Indicating how template names should be derived from file names</h3></div></div></div><p>The <code class="literal">processName</code> option <a id="id31" class="indexterm"/>can be used to indicate how the names under which templates are to be stored in the namespace should be derived from their file names. The default behavior of the <code class="literal">handlebars</code> task is to use the entire filename. In the following example, we indicate that it should still use the file name, but in uppercase letters:</p><div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>processName: function (filename) {</strong></span>
<span class="strong"><strong>        return filename.toUpperCase();</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></div></div></div>
<div class="section" title="Compiling Underscore templates" id="aid-1394Q1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Compiling Underscore templates</h1></div></div></div><p>Along with the many utilities it <a id="id32" class="indexterm"/>provides, the Underscore library also includes a simple, fast, and flexible templating engine. These templates are most commonly compiled to JSTs for use in the frontend of a web application.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-jst (0.6.0)</code> plugin to compile a template that renders a minimalistic blog.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Installing Grunt on a project</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a simple Underscore template and compiling it to a JST contained in another file.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the package that contains the <code class="literal">contrib-jst</code> plugin as per the instructions provided in the <span class="emphasis"><em>Installing a plugin</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>.</li><li class="listitem">Let's create a simple Underscore template file called <code class="literal">blog.html</code> in our project directory and give it the following contents:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;
  &lt;% _.each(posts, function (post) { %&gt;
    &lt;div class="post"&gt;
      &lt;h2&gt;&lt;%= post.title %&gt;&lt;/h2&gt;
      &lt;p&gt;&lt;%= post.body %&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;% }) %&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Now, we can add the following <code class="literal">jst</code> task to our configuration, which will compile the <code class="literal">blog.html</code> template into a JST contained inside the <code class="literal">templates.js</code> file in our project directory:<div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt jst</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jst:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">We should now have a new file called <code class="literal">templates.js</code> in our project directory, which contains the JST code for our compiled template.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>How it works...</h2></div></div></div><p>The following steps <a id="id33" class="indexterm"/>demonstrate the usage of the compiled template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to include the Underscore runtime library in the application or page in which you'd like to make use of the compiled templates.<div class="note" title="Note"><h3 class="title"><a id="tip32"/>Tip</h3><p>At the time of writing, the Underscore runtime library<a id="id34" class="indexterm"/> could be downloaded from the following URL:</p><p><a class="ulink" href="http://underscorejs.org/underscore-min.js">http://underscorejs.org/underscore-min.js</a></p></div></li><li class="listitem">Then, you'll need to include the <code class="literal">templates.js</code> file that was generated by the <code class="literal">jst</code> task in the application or page to make the <code class="literal">JST</code> global variable that contains the templates available.</li><li class="listitem">The following example code will render the compiled template, using some sample data and store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">var result = JST['blog.html']({
  title: 'My Awesome Blog',
  posts: [{
    title: 'First Post',
    body: 'My very first post.'
  }, {
    title: 'Second Post',
    body: 'This is getting old.'
  }]
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec69"/>There's more...</h2></div></div></div><p>The <code class="literal">jst</code> task provides<a id="id35" class="indexterm"/> some useful options in conjunction with the basic compilation of templates which allows us to specify the namespace for compiled templates and indicate how template names should be derived from their file names.</p><div class="section" title="Specifying the namespace for compiled templates"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec35"/>Specifying the namespace for compiled templates</h3></div></div></div><p>By default, compiled <a id="id36" class="indexterm"/>templates are stored in the <code class="literal">JST</code> namespace, but this can be changed to anything we like, by using the <code class="literal">namespace</code> option. In the following example, we configure the task to store templates in the <code class="literal">Templates</code> namespace:</p><div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    options: {
      <span class="strong"><strong>namespace: 'Templates'</strong></span>
    },
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Indicating how template names should be derived from file names"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec36"/>Indicating how template names should be derived from file names</h3></div></div></div><p>The <code class="literal">processName</code> option can<a id="id37" class="indexterm"/> be used to indicate how the names under which templates are to be stored in the namespace should be derived from their file names. The default behavior of the <code class="literal">jst</code> task is to use the entire file name. In the following example, we indicate that it should still use the file name, but in uppercase letters:</p><div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    options: {
      <span class="strong"><strong>processName: function (filename) {</strong></span>
<span class="strong"><strong>        return filename.toUpperCase();</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></div></div></div>
<div class="section" title="Using partials in Handlebars templates" id="aid-147LC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Using partials in Handlebars templates</h1></div></div></div><p>The partials system provided <a id="id38" class="indexterm"/>by the Handlebars templating engine <a id="id39" class="indexterm"/>allows us to reuse smaller bits of template code in varying contexts. Whenever you see a pattern repeated at different points in your template, it's probably a good opportunity to make use of a partial.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-handlebars (0.8.0)</code> plugin and its partial template loading functionality to render posts with a similar structure in two different sections of a blog.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec70"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Handlebars templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec71"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a post partial template and altering our blog template so that it renders a new and old section.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">By default, the <code class="literal">handlebars</code> task identifies a template starting with an underscore as a partial template and loads it. Let's create a file called <code class="literal">_post.hbs</code> in our project directory, which will contain our partial post template:<div class="informalexample"><pre class="programlisting">&lt;div class="post"&gt;
  &lt;h3&gt;{{title}}&lt;/h3&gt;
  &lt;p&gt;{{body}}&lt;/p&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Now, we'll alter the configuration of the task by adding the new partial template's filename to the list of templates that should be included in the task:<div class="informalexample"><pre class="programlisting">handlebars: {
  sample: {
    <span class="strong"><strong>src: ['blog.hbs', '_post.hbs'],</strong></span>
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Once the partial template is set up to be included, we can alter our <code class="literal">blog.hbs</code> template to make use of it. Let's change it so that it renders a new and old section:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;{{title}}&lt;/h1&gt;
  <span class="strong"><strong>&lt;h2&gt;New Posts&lt;/h2&gt;</strong></span>
<span class="strong"><strong>  {{#newPosts}}</strong></span>
<span class="strong"><strong>    {{&gt;post}}</strong></span>
<span class="strong"><strong>  {{/newPosts}}</strong></span>
<span class="strong"><strong>  &lt;h2&gt;Old Posts&lt;/h2&gt;</strong></span>
<span class="strong"><strong>  {{#oldPosts}}</strong></span>
<span class="strong"><strong>    {{&gt;post}}</strong></span>
<span class="strong"><strong>  {{/oldPosts}}</strong></span>
&lt;/div&gt;</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt handlebars</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "handlebars:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">We should now have a modified version of the <code class="literal">templates.js</code> file in our project directory, which contains the JST code for our latest blog template.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>How it works...</h2></div></div></div><p>The following steps <a id="id40" class="indexterm"/>demonstrate the usage of the compiled template<a id="id41" class="indexterm"/> and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to include the Handlebars runtime library in the application or page in which you'd like to make use of the compiled templates.<div class="note" title="Note"><h3 class="title"><a id="tip33"/>Tip</h3><p>At the time of writing, the Handlebars runtime library<a id="id42" class="indexterm"/> could be downloaded from the following URL:</p><p><a class="ulink" href="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js">http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js</a></p></div></li><li class="listitem">Then, you'll need to include the <code class="literal">templates.js</code> file that was generated by the <code class="literal">handlebars</code> task in the application or page to make the <code class="literal">JST</code> global variable that contains the templates available.</li><li class="listitem">The following <a id="id43" class="indexterm"/>example code will render the<a id="id44" class="indexterm"/> compiled template, using some sample data and store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">var result = JST['blog.hbs']({
  title: 'My Awesome Blog',
  newPosts: [{
    title: 'Brand Spanking',
    body: 'Still has that new post smell.'
  }, {
    title: 'Shiny Post',
    body: 'Just got off the floor.'
  }],
  oldPosts: [{
    title: 'Old News',
    body: 'Not that relevant anymore.'
  }, {
    title: 'Way Back When',
    body: 'My very first post.'
  }]
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
  &lt;h2&gt;New Posts&lt;/h2&gt;
  &lt;div class="post"&gt;
    &lt;h3&gt;Brand Spanking&lt;/h3&gt;
    &lt;p&gt;Still has that new post smell.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class="post"&gt;
    &lt;h3&gt;Shiny Post&lt;/h3&gt;
    &lt;p&gt;Just got off the floor.&lt;/p&gt;
  &lt;/div&gt;
  &lt;h2&gt;Old Posts&lt;/h2&gt;
  &lt;div class="post"&gt;
    &lt;h3&gt;Old News&lt;/h3&gt;
    &lt;p&gt;Not that relevant anymore.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class="post"&gt;
    &lt;h3&gt;Way Back When&lt;/h3&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>There's more...</h2></div></div></div><p>The <code class="literal">handlebars</code> task <a id="id45" class="indexterm"/>provides some useful options in conjunction <a id="id46" class="indexterm"/>with the loading of partial templates that allow us to make partials available in the namespace, indicate how partial templates should be identified, and also indicate how partial template names should be derived.</p><div class="section" title="Making partials available in the namespace"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec37"/>Making partials available in the namespace</h3></div></div></div><p>In the case that we'd like to <a id="id47" class="indexterm"/>make use of partial templates directly in our code and not just in our other templates, we can make them available in the namespace along with the other templates by using the <code class="literal">partialsUseNamespace</code> option as we do in the following example:</p><div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>partialsUseNamespace: true</strong></span>
    },
    src: ['blog.hbs', '_post.hbs'],
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Indicating how partial templates should be identified"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec38"/>Indicating how partial templates should be identified</h3></div></div></div><p>We'll probably reach the <a id="id48" class="indexterm"/>point where we would like to change the way partial templates are identified. This can be done using a combination of the <code class="literal">partialRegex</code> and <code class="literal">partialsPathRegex</code> options. The following example indicates that all templates found in the <code class="literal">partials</code> directory should be loaded as partials:</p><div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>partialRegex: /.*/,</strong></span>
<span class="strong"><strong>      partialsPathRegex: /partials\//</strong></span>
    },
    <span class="strong"><strong>src: ['blog.hbs', 'partials/post.hbs'],</strong></span>
    dest: 'templates.js'
  }
}</pre></div></div><div class="section" title="Indicating how partial template names should be derived"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec39"/>Indicating how partial template names should be derived</h3></div></div></div><p>By default, the <code class="literal">handlebars</code><a id="id49" class="indexterm"/> task removes the preceding underscore and file extension from partial file names to determine their names. The following example makes use of the <code class="literal">processPartialName</code> option to indicate that the entire file name should be uppercased before use:</p><div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>processPartialName: function (filename) {</strong></span>
<span class="strong"><strong>        return filename.toUpperCase();</strong></span>
<span class="strong"><strong>      }</strong></span>
    },
    src: ['blog.hbs', '_post.hbs'],
    dest: 'templates.js'
  }
}</pre></div></div></div></div>
<div class="section" title="Wrapping Jade templates in AMD modules" id="aid-1565U1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Wrapping Jade templates in AMD modules</h1></div></div></div><p>In this recipe, we'll <a id="id50" class="indexterm"/>make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin <a id="id51" class="indexterm"/>and its <code class="literal">amd</code> option to wrap our compiled blog template in an <span class="strong"><strong>Asynchronous Module Definition</strong></span> (<span class="strong"><strong>AMD</strong></span>) module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Jade templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that it wraps our compiled templates in an AMD module.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll alter the configuration by adding the <code class="literal">amd</code> option to indicate that the compiled templates should be wrapped in an AMD module:<div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      <span class="strong"><strong>amd: true,</strong></span>
      client: true
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Using the <code class="literal">namespace</code> option, we can now also specify that we no longer want the compiled templates to be contained within the <code class="literal">JST</code> namespace, since they will now be contained within their own module:<div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      amd: true,
      client: true,
      <span class="strong"><strong>namespace: false</strong></span>
    },
    src: 'blog.jade',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">We can now also <a id="id52" class="indexterm"/>compile the template<a id="id53" class="indexterm"/> to a different file name, as each template will now be represented by its own file:<div class="informalexample"><pre class="programlisting">jade: {
  blog: {
    options: {
      amd: true,
      client: true,
      namespace: false
    },
    src: 'blog.jade',
    <span class="strong"><strong>dest: 'blog.js'</strong></span>
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt jade</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:blog" (jade) task</strong></span>
<span class="strong"><strong>File blog.js created.</strong></span>
</pre></div></li><li class="listitem">There should now be a <code class="literal">blog.js</code> file located in the project directory that contains the compiled template wrapped in an AMD module.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>How it works...</h2></div></div></div><p>The following steps demonstrate the usage of the compiled and wrapped template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to ensure that the AMD framework you have in place has access to the Jade runtime library under the name <code class="literal">jade</code>. This may require the configuration of the AMD framework to be altered.<div class="note" title="Note"><h3 class="title"><a id="tip34"/>Tip</h3><p>At the time of writing, the Jade runtime library<a id="id54" class="indexterm"/> was available in the root of the official Jade repository and could be downloaded from the following URL:</p><p><a class="ulink" href="https://raw.githubusercontent.com/jadejs/jade/1.11.0/runtime.js">https://raw.githubusercontent.com/jadejs/jade/1.11.0/runtime.js</a></p></div></li><li class="listitem">Then, you'll need <a id="id55" class="indexterm"/>to make sure that <a id="id56" class="indexterm"/>the <code class="literal">blog.js</code> file that was generated by the <code class="literal">jade</code> task is accessible to the AMD framework under whichever name or path you prefer.</li><li class="listitem">The following example code will fetch the compiled template as a dependency, render the compiled template using some sample data, and then proceed to store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">define(['templates/blog'], function(blog) {
  var result = blog({
    title: 'My Awesome Blog',
    posts: [{
      title: 'First Post',
      body: 'My very first post.'
    }, {
      title: 'Second Post',
      body: 'This is getting old.'
    }]
  });
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Wrapping Handlebars templates in AMD modules" id="aid-164MG1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Wrapping Handlebars templates in AMD modules</h1></div></div></div><p>In this recipe, we'll make <a id="id57" class="indexterm"/>use of the <code class="literal">contrib-handlebars (0.8.0)</code> plugin <a id="id58" class="indexterm"/>and its <code class="literal">amd</code> option to wrap our compiled blog template in an AMD module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Handlebars templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec78"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that it wraps our compiled templates in an AMD module.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll alter the configuration by adding the <code class="literal">amd</code> option to indicate that the compiled templates should be wrapped in an AMD module:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>amd: true</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Using the <code class="literal">namespace</code> option, we can now also specify that we no longer want the compiled templates to be contained within the <code class="literal">JST</code> namespace, since they will now be contained within their own module:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      amd: true,
      <span class="strong"><strong>namespace: false</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">We can now also compile the template to a different file name, as each template will now be represented by its own file:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      amd: true,
      namespace: false
    },
    src: 'blog.hbs',
    <span class="strong"><strong>dest: 'blog.js'</strong></span>
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt handlebars</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "handlebars:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">There should now be a <code class="literal">blog.js</code> file located in the project directory, which contains the compiled template wrapped in an AMD module.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How it works...</h2></div></div></div><p>The following steps <a id="id59" class="indexterm"/>demonstrate the usage of <a id="id60" class="indexterm"/>the compiled and wrapped template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to ensure that the AMD framework you have in place has access to the Handlebars runtime library under the <code class="literal">handlebars</code> name. This may require the configuration of the AMD framework to be altered.<div class="note" title="Note"><h3 class="title"><a id="tip35"/>Tip</h3><p>At the time of writing, the Handlebars runtime library<a id="id61" class="indexterm"/> could be downloaded from the following URL:</p><p><a class="ulink" href="http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js">http://builds.handlebarsjs.com.s3.amazonaws.com/handlebars-v1.3.0.js</a></p><p>In the case of the runtime library mentioned in this tip, you will have to make use of a shim as the library is not prepared for use with AMD modules. You can read more about shimming using the RequireJS framework<a id="id62" class="indexterm"/> at the following URL:</p><p><a class="ulink" href="http://requirejs.org/docs/api.html#config-shim">http://requirejs.org/docs/api.html#config-shim</a></p></div></li><li class="listitem">Then, you'll need to make sure that the <code class="literal">blog.js</code> file that was generated by the <code class="literal">handlebars</code> task is accessible to the AMD framework under whichever name or path you prefer.</li><li class="listitem">The following example code will fetch the compiled template as a dependency, render the compiled template using some sample data, and then proceed to store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">define(['templates/blog'], function(blog) {
  var result = blog({
    title: 'My Awesome Blog',
    posts: [{
      title: 'First Post',
      body: 'My very first post.'
    }, {
      title: 'Second Post',
      body: 'This is getting old.'
    }]
  });
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable <a id="id63" class="indexterm"/>should now<a id="id64" class="indexterm"/> contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Wrapping Underscore templates in AMD modules" id="aid-173721"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Wrapping Underscore templates in AMD modules</h1></div></div></div><p>In this recipe, we'll<a id="id65" class="indexterm"/> make use of the <code class="literal">contrib-jst (0.6.0)</code> plugin <a id="id66" class="indexterm"/>and its <code class="literal">amd</code> option to wrap our compiled blog template in an AMD module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec80"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Underscore templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec81"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that it wraps our compiled template in an AMD module.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll alter the configuration by adding the <code class="literal">amd</code> option to indicate that the compiled templates should be wrapped in an AMD module:<div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    options: {
      <span class="strong"><strong>amd: true</strong></span>
    },
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Using <a id="id67" class="indexterm"/>the <code class="literal">namespace</code> option, we<a id="id68" class="indexterm"/> can now also specify that we no longer want the compiled templates to be contained within the <code class="literal">JST</code> namespace, since they will now be contained within their own module:<div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    options: {
      amd: true,
      <span class="strong"><strong>namespace: false</strong></span>
    },
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">We can now also compile the template to a different filename, as each template will now be located inside its own file:<div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    options: {
      amd: true,
      namespace: false
    },
    src: 'blog.html',
    <span class="strong"><strong>dest: 'blog.js'</strong></span>
  }
}</pre></div></li><li class="listitem">Finally, we can run the task using the <code class="literal">grunt jst</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jst:blog" (jst) task</strong></span>
<span class="strong"><strong>File blog.js created.</strong></span>
</pre></div></li><li class="listitem">There should now be a <code class="literal">blog.js</code> file located in the project directory that contains the compiled template wrapped in an AMD module.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec82"/>How it works...</h2></div></div></div><p>The following <a id="id69" class="indexterm"/>steps demonstrate the usage of<a id="id70" class="indexterm"/> the compiled and wrapped template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, you'll need to ensure that the AMD framework you have in place loads the Underscore library on startup, since the wrappers created by this plugin don't reference it as a dependency.<div class="note" title="Note"><h3 class="title"><a id="tip36"/>Tip</h3><p>At the time of writing, the Underscore runtime library<a id="id71" class="indexterm"/> could be downloaded from the following URL:</p><p><a class="ulink" href="http://underscorejs.org/underscore-min.js">http://underscorejs.org/underscore-min.js</a></p><p>You can read more about specifying startup dependencies on the RequireJS framework<a id="id72" class="indexterm"/> at the following URL:</p><p><a class="ulink" href="http://requirejs.org/docs/api.html#config-deps">http://requirejs.org/docs/api.html#config-deps</a></p></div></li><li class="listitem">Then, you'll need to make sure that the <code class="literal">blog.js</code> file that was generated by the <code class="literal">jst</code> task is accessible to the AMD framework under whichever name or path you prefer.</li><li class="listitem">The following example code will fetch the compiled template as a dependency, render the compiled template using some sample data, and then proceed to store the result in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">define(['templates/blog'], function(blog) {
  var result = blog({
    title: 'My Awesome Blog',
    posts: [{
      title: 'First Post',
      body: 'My very first post.'
    }, {
      title: 'Second Post',
      body: 'This is getting old.'
    }]
  });
});</pre></div></li><li class="listitem">The <code class="literal">result</code> <a id="id73" class="indexterm"/>variable should <a id="id74" class="indexterm"/>now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;  
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Wrapping Handlebars templates in CommonJS modules" id="aid-181NK1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Wrapping Handlebars templates in CommonJS modules</h1></div></div></div><p>In this recipe, we'll <a id="id75" class="indexterm"/>make use of the <code class="literal">contrib-handlebars (0.8.0)</code> plugin to<a id="id76" class="indexterm"/> wrap our compiled blog template in a <span class="strong"><strong>CommonJS</strong></span> module.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec83"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Handlebars templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec84"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that it wraps our compiled template in a CommonJS module.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll alter the configuration by adding the <code class="literal">amd</code> option to indicate that the compiled templates should be wrapped in a CommonJS module.<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      <span class="strong"><strong>commonjs: true</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Using the <code class="literal">namespace</code> option, we can now also specify that we no longer want the compiled templates to be contained within the <code class="literal">JST</code> namespace, since they will now be contained within a module:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    options: {
      commonjs: true,
      <span class="strong"><strong>namespace: false</strong></span>
    },
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Finally, we can <a id="id77" class="indexterm"/>run the task<a id="id78" class="indexterm"/> using the <code class="literal">grunt handlebars</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "handlebars:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">There should now be a <code class="literal">templates.js</code> file located in the project directory that contains the compiled template wrapped in a CommonJS module.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec85"/>How it works...</h2></div></div></div><p>The following steps demonstrate the usage of the compiled and wrapped template and display an example of the rendered result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll have to ensure that the Handlebars library is installed in the current CommonJS supporting environment. Using Node.js as an example, the module will have to be installed using the <code class="literal">npm install handlebars</code> command.</li><li class="listitem">Next, we will have to make it available in the piece of code that we'll be importing the templates into, by using code similar to the following:<div class="informalexample"><pre class="programlisting">var Handlebars = require('handlebars');</pre></div></li><li class="listitem">Then, we'll need to import the templates into our code and pass it to the Handlebars library by using code similar to the following:<div class="informalexample"><pre class="programlisting">var templates = require('./templates')(Handlebars);</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip37"/>Tip</h3><p>This bit of code assumes that the generated <code class="literal">templates.js</code> file is on the same path as the file containing the piece of code we're currently working on.</p></div></li><li class="listitem">Now that we've imported the templates, we can make use of them. The following example<a id="id79" class="indexterm"/> renders the <code class="literal">blog.hbs</code> templates <a id="id80" class="indexterm"/>and stores the results in the <code class="literal">result</code> variable:<div class="informalexample"><pre class="programlisting">var result = templates['blog.hbs']({
  title: 'My Awesome Blog',
  posts: [{
    title: 'First Post',
    body: 'My very first post.'
  }, {
    title: 'Second Post',
    body: 'This is getting old.'
  }]
});</pre></div></li><li class="listitem">The <code class="literal">result</code> variable should now contain the following HTML:<div class="informalexample"><pre class="programlisting">&lt;div class="blog"&gt;
  &lt;h1&gt;My Awesome Blog&lt;/h1&gt;
    &lt;h2&gt;First Post&lt;/h2&gt;
    &lt;p&gt;My very first post.&lt;/p&gt;
    &lt;h2&gt;Second Post&lt;/h2&gt;
    &lt;p&gt;This is getting old.&lt;/p&gt;
&lt;/div&gt;</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Altering Jade templates before compilation" id="aid-190861"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Altering Jade templates before compilation</h1></div></div></div><p>There might come <a id="id81" class="indexterm"/>a time that you would want to alter the contents of a template before compiling or rendering it. This is most commonly required when you would like to remove excessive white space from templates, or if you'd like to remove or replace parts of a template you have no control over.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-jade (0.12.0)</code> plugin and the <code class="literal">processContent</code> option provided by its <code class="literal">jade</code> task to remove whitespace from our templates before rendering them to HTML.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec86"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Jade templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec87"/>How to do it...</h2></div></div></div><p>The following steps take us<a id="id82" class="indexterm"/> through altering our configuration so that excessive whitespace is removed from our templates before rendering them to HTML.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we can provide an empty function to the <code class="literal">processContent</code> option that receives the content of the template and passes it through without altering it:<div class="informalexample"><pre class="programlisting">jade: {
  sample: {
    <span class="strong"><strong>options: {</strong></span>
<span class="strong"><strong>      processContent: function (content) {</strong></span>
<span class="strong"><strong>        return content;</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    },</strong></span>
    src: 'index.jade',
    dest: 'index.html'
  }
}</pre></div></li><li class="listitem">Then, we can alter the code of the function provided to <code class="literal">processContent</code> so that it removes all of the trailing whitespace from the template's content:<div class="informalexample"><pre class="programlisting">processContent: function (content) {
  <span class="strong"><strong>content = content.replace(/[\x20\t]+$/mg, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/[\r\n]*$/, '\n');</strong></span>
  return content;
}</pre></div></li><li class="listitem">If we now run the task using the <code class="literal">grunt jade</code> command, we will see output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jade:sample" (jade) task</strong></span>
<span class="strong"><strong>File index.html created.</strong></span>
</pre></div></li><li class="listitem">The rendered result in the <code class="literal">index.html</code> file should now display no signs of any of the trailing whitespace that was present in the original template.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Altering Handlebars templates before compilation" id="aid-19UOO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Altering Handlebars templates before compilation</h1></div></div></div><p>Although not very common, there <a id="id83" class="indexterm"/>might come a time that you would want to alter the contents of a template before compiling or rendering it. This is most commonly required when you would like to remove excessive whitespace from templates, or if you'd like to remove or replace certain parts of a template you have no control over.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-handlebars (0.8.0)</code> plugin and the <code class="literal">processContent</code> option provided by its <code class="literal">handlebars</code> task to remove whitespace from our templates before compiling them.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec88"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Handlebars templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec89"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that excessive whitespace is removed from our templates before compiling them.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we can provide an empty function to the <code class="literal">processContent</code> option that receives the content of the template and passes it through without altering it:<div class="informalexample"><pre class="programlisting">handlebars: {
  blog: {
    <span class="strong"><strong>options: {</strong></span>
<span class="strong"><strong>      processContent: function (content) {</strong></span>
<span class="strong"><strong>        return content;</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    },</strong></span>
    src: 'blog.hbs',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Then, we can alter the code of the function provided to <code class="literal">processContent</code> so that it removes all of the leading and trailing whitespace from the template's content:<div class="informalexample"><pre class="programlisting">processContent: function (content) {
  <span class="strong"><strong>content = content.replace(/^[\x20\t]+/mg, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/[\x20\t]+$/mg, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/^[\r\n]+/, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/[\r\n]*$/, '\n');</strong></span>
  return content;
}</pre></div></li><li class="listitem">If we now run the task using the <code class="literal">grunt handlebars</code> command, we should see output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "handlebars:blog" (handlebars) task</strong></span>
<span class="strong"><strong>&gt;&gt; 1 file created.</strong></span>
</pre></div></li><li class="listitem">The<a id="id84" class="indexterm"/> compiled result in the <code class="literal">templates.js</code> file should now display no signs of any of the trailing whitespace that was present in the original template.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Altering Underscore templates before compilation" id="aid-1AT9A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Altering Underscore templates before compilation</h1></div></div></div><p>Although not very <a id="id85" class="indexterm"/>common, there might come a time that you would want to alter the contents of a template before compiling or rendering it. This is most commonly required when you would like to remove excessive whitespace from templates, or if you'd like to remove or replace certain parts of a template you have no control over.</p><p>In this recipe, we'll make use of the <code class="literal">contrib-jst (0.6.0)</code> plugin and the <code class="literal">processContent</code> option provided by its <code class="literal">jst</code> task to remove whitespace from our templates before compiling them.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec90"/>Getting ready</h2></div></div></div><p>In this example, we'll work with the basic project structure we created in the <span class="emphasis"><em>Compiling Underscore templates</em></span> recipe of this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec91"/>How to do it...</h2></div></div></div><p>The following steps take us through altering our configuration so that excessive whitespace is removed from our templates before compiling them.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we can provide an empty function to the <code class="literal">processContent</code> option that receives the content of the template and passes it through without altering it:<div class="informalexample"><pre class="programlisting">jst: {
  blog: {
    <span class="strong"><strong>options: {</strong></span>
<span class="strong"><strong>      processContent: function (content) {</strong></span>
<span class="strong"><strong>        return content;</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    },</strong></span>
    src: 'blog.html',
    dest: 'templates.js'
  }
}</pre></div></li><li class="listitem">Then, we can alter the code of the function provided to <code class="literal">processContent</code> so that it removes all leading and trailing whitespace from the template's content:<div class="informalexample"><pre class="programlisting">processContent: function (content) {
  <span class="strong"><strong>content = content.replace(/^[\x20\t]+/mg, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/[\x20\t]+$/mg, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/^[\r\n]+/, '');</strong></span>
<span class="strong"><strong>  content = content.replace(/[\r\n]*$/, '\n');</strong></span>
  return content;
}</pre></div></li><li class="listitem">If we now run the <a id="id86" class="indexterm"/>task using the <code class="literal">grunt jst</code> command, we should see output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "jst:blog" (jst) task</strong></span>
<span class="strong"><strong>File templates.js created.</strong></span>
</pre></div></li><li class="listitem">The compiled result in the <code class="literal">templates.js</code> file should now display no signs of any of the trailing whitespace that was present in the original template.</li></ol><div style="height:10px; width: 1px"/></div></div></div></body></html>