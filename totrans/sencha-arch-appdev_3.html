<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Creating a Sencha Touch App"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Creating a Sencha Touch App</h1></div></div></div><p>In this chapter, we will take our first step building a Sencha Touch application with Sencha Architect. We will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a Sencha Touch project</li><li class="listitem" style="list-style-type: disc">Creating models, stores, views, and controllers</li><li class="listitem" style="list-style-type: disc">Executing the project for the first time</li><li class="listitem" style="list-style-type: disc">Integrating Sencha Touch with PhoneGap</li></ul></div><div class="section" title="Implementing the Sencha Touch app"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Implementing the Sencha Touch app</h1></div></div></div><p>Before we implement our <a id="id112" class="indexterm"/>Sencha Touch application, let's take a look at what we will build by the end of this chapter:</p><div class="mediaobject"><img src="graphics/9819OS_03_01.jpg" alt="Implementing the Sencha Touch app"/></div><p>It is a simple list that lists all the contacts available on the phone. All the UI design will be done with Sencha Touch, and to retrieve the native contacts from the device we will use PhoneGap. The <a id="id113" class="indexterm"/>previous screenshot was taken from an iPhone with the app running. We will learn how to build and prepare the application to be executed on a real device later in this book.</p></div></div>
<div class="section" title="Creating the project"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Creating the project</h1></div></div></div><p>First, create a new <a id="id114" class="indexterm"/>Sencha Touch project; we can do this by selecting the <span class="strong"><strong>New Project</strong></span> option<a id="id115" class="indexterm"/> from the welcome <a id="id116" class="indexterm"/>screen or from the toolbar:</p><div class="mediaobject"><img src="graphics/9819OS_03_02.jpg" alt="Creating the project"/></div><p>Right after the project is created, we will see the landing screen, with the toolbar, canvas, project inspector, config panel, and toolbox. We will save our project immediately. To do so, click on <span class="strong"><strong>Save</strong></span> in the toolbox or press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>S</em></span> (<span class="emphasis"><em>cmd</em></span> + <span class="emphasis"><em>S</em></span> on Mac OS). The <span class="strong"><strong>Save Project</strong></span> screen will be displayed.</p><p>We will save the project as <code class="literal">SenchaContacts</code> inside the <code class="literal">sencha-architect</code> directory, the same directory we saved our Ext JS project to. The following screenshot shows the <span class="strong"><strong>Save Project</strong></span> screen:</p><div class="mediaobject"><img src="graphics/9819OS_03_03.jpg" alt="Creating the project"/></div><p>Now that the project is saved, we can start implementing it. We will use the following development workflow: first we will implement the <span class="strong"><strong>Model</strong></span>, then the <span class="strong"><strong>Store</strong></span>, then the <span class="strong"><strong>View</strong></span>, lastly the <span class="strong"><strong>Controller</strong></span>, and repeat it until our project is finished.</p></div>
<div class="section" title="Configuring the app"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Configuring the app</h1></div></div></div><p>The first step is to set up the application we are going to develop throughout this chapter. Before we start, in the project inspector, select <span class="strong"><strong>Application</strong></span> (<span class="emphasis"><em>Step 1</em></span>), and then go to the config panel, locate <a id="id117" class="indexterm"/>the property <span class="strong"><strong>name</strong></span>, and set its value to <code class="literal">Packt</code> (<span class="emphasis"><em>Step 2</em></span>). This is the namespace of our application, meaning all the classes will be named <code class="literal">Packt + package + className</code>. If we open the code editor, the code that we will see is shown in the following screenshot (<span class="emphasis"><em>Step 3</em></span>):</p><div class="mediaobject"><img src="graphics/9819OS_03_04.jpg" alt="Configuring the app"/></div><p>All these configurations will be applied on the <code class="literal">app.js</code> file, since the application represents the <code class="literal">app.js</code> file.</p><p>You will notice that many of the steps that we will perform throughout this chapter are very similar to the ones we did in the previous chapter. This is because Ext JS and Sencha Touch share part of the API and also because once you are used to Ext JS or Sencha Touch, learning the second framework is easier.</p></div>
<div class="section" title="Creating the model"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Creating the model</h1></div></div></div><p>Following our development <a id="id118" class="indexterm"/>workflow, we will start with the model. On the top of the project inspector, click on the <span class="strong"><strong>+</strong></span> icon and select <span class="strong"><strong>Model</strong></span> (<span class="emphasis"><em>Step 1</em></span>):</p><div class="mediaobject"><img src="graphics/9819OS_03_05.jpg" alt="Creating the model"/></div><p>Once the <span class="strong"><strong>Model</strong></span> is created, select it, go to the config panel, and set the class name (<code class="literal">userClassName</code>) to <code class="literal">Contact</code> (<span class="emphasis"><em>Step 2</em></span>). Then, still on the config panel, locate the <span class="strong"><strong>fields</strong></span> property, click on its <span class="strong"><strong>+</strong></span> icon and add the first field, which is named <code class="literal">id</code>. Continue until we have the following fields<a id="id119" class="indexterm"/> created: <code class="literal">id</code>, <code class="literal">displayName</code>, <code class="literal">phoneNumber</code>, <code class="literal">familyName</code>, and <code class="literal">givenName</code> (<span class="emphasis"><em>Step 3</em></span>). These fields represent some of the fields that are available on the device.</p><div class="mediaobject"><img src="graphics/9819OS_03_06.jpg" alt="Creating the model"/></div><p>As we have <code class="literal">givenName</code> and <code class="literal">familyName</code>, let's say we want to create a field that returns the <code class="literal">givenName</code> and <code class="literal">familyName</code> fields concatenated. For this reason we created the <code class="literal">displayName</code> field. So to do what we want, we need to create a <code class="literal">convert()</code> function for the <code class="literal">displayName</code> field. To do so, we need to select the <code class="literal">displayName</code> field in the project inspector (<span class="emphasis"><em>Step 4</em></span>), locate the <span class="strong"><strong>convert</strong></span> property and click on the <span class="strong"><strong>+</strong></span> icon (<span class="emphasis"><em>Step 5</em></span>), then, a green diamond icon will appear near to the left of the <span class="strong"><strong>convert</strong></span> property. This means a function was created on the code editor, and it is available for editing. To go to the code editor, we can click on the arrow icon (<span class="emphasis"><em>Step 6</em></span>). Then we can add the code that will concatenate the <code class="literal">givenName</code> and <code class="literal">familyName</code> fields (<span class="emphasis"><em>Step 7</em></span>).</p><p>If we go back to the project inspector, the contact model should look as shown in the following screenshot (<span class="emphasis"><em>Step 8</em></span>). If we look at the canvas, nothing will be displayed in the <span class="strong"><strong>Design</strong></span> mode, but if we take a look at the <span class="strong"><strong>Code</strong></span> editor, the <code class="literal">Packt.model.Contact</code> class will be defined. If we try to edit its code, we will notice that the only code available for editing is the <code class="literal">convert()</code> function<a id="id120" class="indexterm"/> we created for the <code class="literal">displayName</code> field (the edit icon will appear when we hover the mouse over the <code class="literal">convert()</code> function content). Any other change must be done using the config panel.</p><p>Once we save the project and take a look at the files that Sencha Architect has created so far, we will see that it created a file named <code class="literal">Contact.js</code> inside the <code class="literal">app/model</code> directory.</p></div>
<div class="section" title="Creating the store"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Creating the store</h1></div></div></div><p>The next step is to create a store. Our data is going to come from the device, and we will use a special proxy with PhoneGap code to load it. This means that we can create a store that will use an Ajax Proxy, as on the<a id="id121" class="indexterm"/> project inspector <span class="strong"><strong>+</strong></span> menu we do not have the option to create an empty store (neither by creating the store from the toolbox). So we need to go back to the project inspector, click on the <span class="strong"><strong>+</strong></span> icon again, select <span class="strong"><strong>Store</strong></span> and then select <span class="strong"><strong>Json Store</strong></span> as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9819OS_03_07.jpg" alt="Creating the store"/></div><p>Right after we create the store, we need to give a name to it. So select the store on the project inspector, go to the config panel, locate the <span class="strong"><strong>userClassName</strong></span>, and set its value as <span class="strong"><strong>Contacts</strong></span> (this will be the name of the store—<span class="emphasis"><em>Step 1</em></span>). Then, we also need to assign a <span class="strong"><strong>storeId</strong></span> to it that will also have its value set to <span class="strong"><strong>Contacts</strong></span> (<span class="emphasis"><em>Step 2</em></span>). After we create the store, we will also see a red exclamation mark icon (<span class="emphasis"><em>Step 3</em></span>). If we click on it (<span class="emphasis"><em>Step 3</em></span>), we will see an error message saying that we need to associate a model to this store or create at least one field on the store (<span class="emphasis"><em>Step 4</em></span>). As we already have a model, click on the <span class="strong"><strong>Store</strong></span> in the project inspector, go to the config panel, search for <span class="strong"><strong>model</strong></span> and then you can choose from the list of models we already created (<span class="emphasis"><em>Step 5</em></span>). </p><p>In this case, we have only created the <span class="strong"><strong>Contact</strong></span> model. And at last, as we will use our own proxy (not the ones available on Sencha Touch API) we can delete the proxy by selecting it and right-clicking on it, then selecting the <span class="strong"><strong>Delete</strong></span> option <a id="id122" class="indexterm"/>(<span class="emphasis"><em>Step 6</em></span>):</p><div class="mediaobject"><img src="graphics/9819OS_03_08.jpg" alt="Creating the store"/></div><p>We can also create a store with no proxy by clicking directly on the <span class="strong"><strong>Store</strong></span> option (as highlighted in the <a id="id123" class="indexterm"/>next screenshot), without the need to click on one of the following options; <span class="strong"><strong>Array Store</strong></span>, <span class="strong"><strong>Direct Store</strong></span>, and so on:</p><div class="mediaobject"><img src="graphics/9819OS_03_23.jpg" alt="Creating the store"/></div><p>As we saw earlier in this chapter, in the screenshot taken from an iPhone, a letter groups the contacts (this letter represents the first letter of the <code class="literal">givenName</code>—or the <code class="literal">familyName</code> if the contact does not have a <code class="literal">givenName</code>). We will add this configuration on the list later, but the class that will do the work of grouping the contacts is the store. So to do it, we need to select the <span class="strong"><strong>Contacts</strong></span> in the <span class="strong"><strong>Stores</strong></span> from the project inspector (<span class="emphasis"><em>Step 7</em></span>), go to the toolbox, select the data, and then, under <span class="strong"><strong>Data Utilities</strong></span>, we will find the <span class="strong"><strong>Grouper</strong></span>. Double-click on it and a grouper will be added to the <span class="strong"><strong>Contacts</strong></span> store. Then, select <span class="strong"><strong>MyGrouper</strong></span> under the <span class="strong"><strong>Contacts</strong></span> store, locate the <span class="strong"><strong>groupFn</strong></span> on the config panel, and click on the <span class="strong"><strong>+</strong></span> icon (<span class="emphasis"><em>Step 8</em></span>). A green diamond icon will appear next to the <span class="strong"><strong>groupFn</strong></span> function.<a id="id124" class="indexterm"/> Click on the arrow icon (<span class="emphasis"><em>Step 9</em></span>) and the code <a id="id125" class="indexterm"/>editor will be opened, so we can add the grouper code (<span class="emphasis"><em>Step 10</em></span>):</p><div class="mediaobject"><img src="graphics/9819OS_03_09.jpg" alt="Creating the store"/></div><p>If the contact has a <code class="literal">givenName</code>, the store will use its first letter to group; if not, it will use the <code class="literal">familyName</code> first letter. In case the contact does not have a name (it can happen), we will return <code class="literal">"-"</code>. It is very important to cover all the cases, because if not, the contacts will not appear in the list when we run this example on a real device.</p><p>Once we save the project and take a look at the files that Sencha Architect has created so far, we will see that it created a file named <code class="literal">Contacts.js</code> inside the <code class="literal">app/store</code> directory.</p><div class="section" title="Creating the contacts proxy – PhoneGap"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>Creating the contacts proxy – PhoneGap</h2></div></div></div><p>As our idea is to load <a id="id126" class="indexterm"/>the contacts from the device, we will use PhoneGap to do the native access for us. To do so, we need to create our own <a id="id127" class="indexterm"/>proxy with the PhoneGap code. So go to the application directory (<code class="literal">sencha-architect/SenchaContacts</code>) and inside the <code class="literal">app</code> folder create a new folder named <code class="literal">proxy</code>, and create a file named <code class="literal">ContactsProxy.js</code> as demonstrated in the following screenshot:</p><div class="mediaobject"><img src="graphics/9819OS_03_10.jpg" alt="Creating the contacts proxy – PhoneGap"/></div><p>Inside the <code class="literal">ContactsProxy.js</code> file we will add the following code (using a code editor of your choice—Notepad,<a id="id128" class="indexterm"/> Sublime Text, Eclipse, and so on)—unfortunately, this is something that we cannot do from Sencha Architect, as it is limited to the <a id="id129" class="indexterm"/>model, store, view and controller packages:</p><div class="informalexample"><pre class="programlisting">Ext.define('Packt.proxy.ContactsProxy', { // #1
    extend: 'Ext.data.proxy.Proxy', // #2
    alias : 'proxy.contactstorage', // #3
    constructor: function(config) { // #4
        var me = this;
        config = config || {};
        me.callParent([config]);
    },
    create: function(operation, callback, scope) { }, // #5
   update: function(operation, callback, scope) { }, // #6
   destroy: function(operation, callback, scope) { } // #7
});</pre></div><p>This is the skeleton of our proxy. Creating custom proxies is an advanced topic and requires some knowledge of the API source code. So let's go step-by-step. First we have the definition of the class (<code class="literal">#1</code>) that follows the Sencha naming convention. </p><p>Notice that <code class="literal">Packt</code> is the namespace we chose for our app, <code class="literal">proxy</code> is the name of the package, and <code class="literal">ContactsProxy</code> is the name of the <code class="literal">.js</code> file we created. Then we are extending the proxy class from Sencha Touch API (<code class="literal">#2</code>). Next we are creating an alias so we can use the <code class="literal">contactsstorage</code> type later when we define the proxy inside the contacts store (<code class="literal">#3</code>). Following the code we have the default <code class="literal">constructor</code> (<code class="literal">#4</code>) and then, we have the signature of functions that our proxy needs to have: <code class="literal">create()</code> (<code class="literal">#5</code>), <code class="literal">update()</code> (<code class="literal">#6</code>), and <code class="literal">destroy()</code> (<code class="literal">#7</code>). We<a id="id130" class="indexterm"/> will not<a id="id131" class="indexterm"/> implement these functions. The one we will implement is <code class="literal">read()</code>, that we will add to our <a id="id132" class="indexterm"/>
<code class="literal">ContactsProxy</code> class:</p><div class="informalexample"><pre class="programlisting">read: function(operation, callback, scope) {
    var thisProxy = this;
    var fields = ['id', 'name', 'phoneNumbers']; // #8
    navigator.contacts.find(fields,
        function(deviceContacts) { // #9
            //loop over contacts and create Contact model instance
            var contacts = [];
            for (var i = 0; i &lt; deviceContacts.length; i++){// #10
                var deviceContact = deviceContacts[ i ];
                            
                var phone = "";
                if (deviceContact.phoneNumbers){ // #11
                    phone = deviceContact.phoneNumbers[0];
                    if (phone){
                        phone = phone.value;
                    } else{
                        phone = "";
                    }
                }
                // #12
                contacts.push(Ext.create('Packt.model.Contact',{ 
                        id: deviceContact.id,
                        givenName: deviceContact.name.givenName,
                        familyName: deviceContact.name.familyName,
                        phoneNumber: phone
                    }));
                }
            //return model instances in a result set
            operation.setResultSet( // #13
                Ext.create('Ext.data.ResultSet', {
                    records: contacts,
                    total  : contacts.length
                })
            );
            //announce success
            operation.setSuccessful(); // #14
            operation.setCompleted();
            //finish with callback
            if (typeof callback == "function") { // #15
                callback.call(scope || thisProxy, operation);
            }
        },
        function (e) { // error handling from PhoneGap
            console.log('Error fetching contacts'); // #16
        },
        {multiple: true} // #17
    );
}</pre></div><p>Inside the method <code class="literal">read()</code>, we have a mix of Sencha and PhoneGap code. To read the contacts, we will use a PhoneGap function (navigate to <a class="ulink" href="http://docs.phonegap.com/en/2.6.0/cordova_contacts_contacts.md.html#Contacts">http://docs.phonegap.com/en/2.6.0/cordova_contacts_contacts.md.html#Contacts</a> for more information). The <a id="id133" class="indexterm"/>
<code class="literal">navigator.contacts.find()</code> function needs the <code class="literal">contactFields</code> to be searched (<code class="literal">#8</code>), the success function in case PhoneGap was able to read the contacts <a id="id134" class="indexterm"/>successfully (<code class="literal">#9</code>), an error callback (<code class="literal">#16</code>), and some options (<code class="literal">#17</code>).</p><p>Our biggest interest is inside the <code class="literal">success()</code> function (<code class="literal">#9</code>). First, we are going to iterate each contact returned <a id="id135" class="indexterm"/>by the device to PhoneGap (<code class="literal">#10</code>). We will extract a phone number (<code class="literal">#11</code>—the contact can have more than one phone, in this case we will retrieve only the first one). Then we need to create a contact model instance with the information we extracted from the device (<code class="literal">#12</code>). We will push this contact model instance into an array. Finally, we need to set the information (contact model instances and their totals) into the <code class="literal">ResultSet</code> so the Ext JS contacts store can understand the information (<code class="literal">#14</code>) and set the <code class="literal">operation</code> as a success and complete (<code class="literal">#14</code>). And at last, we need to inform the Ext JS callback function (<code class="literal">#15</code>).</p><p>Then, the contacts store will understand the information we retrieved from the device. The <code class="literal">read()</code> function <a id="id136" class="indexterm"/>will be called when we call the <code class="literal">load()</code> method from the store. We will see how to apply this proxy in the store on the controller section.</p></div></div>
<div class="section" title="Creating the list view"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Creating the list view</h1></div></div></div><p>In the next step we will create our view, which is the contacts list. There are two ways of creating a view. You can<a id="id137" class="indexterm"/> choose the one you like the most. The first one requires selecting the <span class="strong"><strong>Views</strong></span> package on the project inspector (<span class="emphasis"><em>Step 1</em></span>); go to the <span class="strong"><strong>Toolbox</strong></span> and locate the <span class="strong"><strong>Grid Panel</strong></span> component and then double-click on it (<span class="emphasis"><em>Step 2</em></span>). A new list view called <code class="literal">MyList</code> will be created under the <span class="strong"><strong>Views</strong></span>:</p><div class="mediaobject"><img src="graphics/9819OS_03_11.jpg" alt="Creating the list view"/></div><p>Then, after the list is created, we need to select it from the project inspector, locate the <span class="strong"><strong>userAlias</strong></span>, and set its <a id="id138" class="indexterm"/>value to <span class="strong"><strong>contactsList</strong></span> and also set the <span class="strong"><strong>userClassName</strong></span> to <span class="strong"><strong>contactsList</strong></span> (<span class="emphasis"><em>Step 3</em></span>). Still on the config panel, we also need to set a <span class="strong"><strong>store</strong></span> to the list (<span class="emphasis"><em>Step 4</em></span>).</p><p>The second way of creating the view is to select the component from the <span class="strong"><strong>Toolbox</strong></span>, and drag-and-drop it inside the <span class="strong"><strong>Views</strong></span> package (or it can be the <span class="strong"><strong>Views</strong></span>, <span class="strong"><strong>Stores</strong></span>, <span class="strong"><strong>Models</strong></span>, or <span class="strong"><strong>Controllers</strong></span> packages as well):</p><div class="mediaobject"><img src="graphics/9819OS_03_12.jpg" alt="Creating the list view"/></div><p>The next step is to change the <span class="strong"><strong>itemTpl</strong></span>. The <span class="strong"><strong>itemTpl</strong></span> is the template of what information from the <span class="strong"><strong>Model</strong></span> we will display as an item of the <span class="strong"><strong>ContactsList</strong></span>. In this case, we want to display the <code class="literal">givenName</code> in bold and the <code class="literal">familyName</code> in a regular font as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9819OS_03_13.jpg" alt="Creating the list view"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>If we double-click on <span class="strong"><strong>itemTpl</strong></span> in the project inspector, the code editor will be displayed, and then we can edit the <span class="strong"><strong>itemTpl</strong></span> as shown in the previous screenshot.</p></div></div><p>To make our list prettier, let's add a toolbar to it. Select the <span class="strong"><strong>ContactsList</strong></span> from the project inspector, then go to<a id="id139" class="indexterm"/> the toolbox and locate the <span class="strong"><strong>Toolbar</strong></span> component; double-click on it (<span class="emphasis"><em>Step 5</em></span>). Then, select the <span class="strong"><strong>Toolbar</strong></span> from the project inspector, go to the config panel, locate the <span class="strong"><strong>title</strong></span>, and set its value to <code class="literal">My Contacts</code> (<span class="emphasis"><em>Step 6</em></span>). Another way of setting the toolbar's title is using the design view and changing the title by double clicking on it:</p><div class="mediaobject"><img src="graphics/9819OS_03_14.jpg" alt="Creating the list view"/></div><p>Our last step is to add the index bar and group the list. So first, to add the index bar, select the <span class="strong"><strong>ContactsList</strong></span> from the project inspector, go to <span class="strong"><strong>Toolbox</strong></span> | <span class="strong"><strong>Views</strong></span>, and locate the<a id="id140" class="indexterm"/> <span class="strong"><strong>List Index Bar</strong></span> component (<span class="emphasis"><em>Step 8</em></span>), which is the only thing we need to do. If we go to the code editor, we will see that Sencha Architect added the property <code class="literal">indexBar: true</code>.</p><div class="mediaobject"><img src="graphics/9819OS_03_15.jpg" alt="Creating the list view"/></div><p>And finally, select the <span class="strong"><strong>ContactsList</strong></span> from the project inspector again, go to the config panel, locate the <a id="id141" class="indexterm"/>
<span class="strong"><strong>grouped</strong></span> property checkbox, and check it. This will add the property <code class="literal">grouped: true</code> in the code editor.</p><p>Once we save the project and take a look at the files that Sencha Architect has created so far, we will see <a id="id142" class="indexterm"/>that it created a file named <code class="literal">ContactsList.js</code> inside the <code class="literal">app/view</code> directory.</p></div>
<div class="section" title="Creating the controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Creating the controller</h1></div></div></div><p>So to create the controller, let's go back to the top of the project inspector and click on the <span class="strong"><strong>+</strong></span> icon once again and select<a id="id143" class="indexterm"/> the <span class="strong"><strong>Controller </strong></span>option (<span class="emphasis"><em>Step 1</em></span>). Then, with the <span class="strong"><strong>Controller</strong></span> selected, go to the config panel, and change its <span class="strong"><strong>userClassName</strong></span> to <span class="strong"><strong>Contacts</strong></span> (<span class="emphasis"><em>Step 2</em></span>):</p><div class="mediaobject"><img src="graphics/9819OS_03_16.jpg" alt="Creating the controller"/></div><p>Still on the config panel, locate the <span class="strong"><strong>models</strong></span>, <span class="strong"><strong>stores</strong></span>, and <span class="strong"><strong>views</strong></span> properties (<span class="emphasis"><em>Step 3</em></span>). With these properties, we will declare the models, stores and views that this controller will care about. Once you select <span class="strong"><strong>Model</strong></span>, <span class="strong"><strong>Store</strong></span>, or <span class="strong"><strong>View</strong></span>, Sencha Architect will display a window with a question as shown in the following screenshot. Click on <span class="strong"><strong>Remove</strong></span>:</p><div class="mediaobject"><img src="graphics/9819OS_03_17.jpg" alt="Creating the controller"/></div><p>This is because on the application (<code class="literal">app.js</code>), as we create models, stores, and views, they will be declared on the <span class="strong"><strong>models</strong></span>, <span class="strong"><strong>views</strong></span>, and <span class="strong"><strong>stores</strong></span> properties of the application. With this step, we are transferring the responsibility to the controller, and there is no need to keep their declaration on the <code class="literal">app.js</code> application and also on the controller (which is what will happen if we click on the <span class="strong"><strong>Keep</strong></span> button).</p><p>The next step is to add a new <span class="strong"><strong>Controller Action</strong></span> to the contacts controller. To do so, select the contacts controller on the project inspector, go to the toolbox, locate the <span class="strong"><strong>Controller</strong></span> <span class="strong"><strong>Action</strong></span>, and double-click on it (or drag-and-drop) as demonstrated by <span class="emphasis"><em>Step 4</em></span>. Once the <span class="strong"><strong>Controller</strong></span> <span class="strong"><strong>Action</strong></span> is listed under the contacts controller, select it, go to the config panel, and choose <span class="strong"><strong>ContactsList</strong></span> as <span class="strong"><strong>targetType</strong></span> (<span class="emphasis"><em>Step 5</em></span>); then, on the <span class="strong"><strong>EventBinding</strong></span>, select the <span class="strong"><strong>name</strong></span> of the event we <a id="id144" class="indexterm"/>want to listen to, which is <span class="strong"><strong>show</strong></span>. If you would like, you can change the <span class="strong"><strong>controlQuery</strong></span> to be more specific, as well as the name of the <span class="strong"><strong>BasicFunction</strong></span> by changing <span class="strong"><strong>fn</strong></span>.</p><div class="mediaobject"><img src="graphics/9819OS_03_18.jpg" alt="Creating the controller"/></div><p>Then on the code editor, we will add the logic we want to take place, when the <span class="strong"><strong>ContactsList</strong></span> is displayed, which is to load its <span class="strong"><strong>Store</strong></span>, so PhoneGap can load the contacts from the device. But what happens is that the contacts store does not have a proxy set, so we can set <code class="literal">contactsstorage</code>, which is the proxy we created using the <code class="literal">setProxy()</code> method. This is the easiest way we can do it. The other way would be creating an override of the contacts store, but this is an advanced topic that we will learn in the next chapter.</p><p>Next on line <code class="literal">26</code> of the <code class="literal">onListShow()</code> method<a id="id145" class="indexterm"/> we have the <code class="literal">document.addEventListener('deviceready')</code> declaration. This is a PhoneGap code that will be fired when the device is ready to be used. Then, as a function we load the <span class="strong"><strong>ContactsList</strong></span> store. As the proxy we created uses PhoneGap code, we need to make sure we will call it only when the device is ready to be used.</p><p>Once we save the project and take a look at the files that Sencha Architect has created so far, we will see that it created a file named <code class="literal">Contacts.js</code> inside the <code class="literal">app/controller</code> directory.</p><p>We can click on the preview icon again in the toolbar, and now we will see the final version of our project, but first we need to set the <span class="strong"><strong>URL Prefix:</strong></span> as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9819OS_03_19.jpg" alt="Creating the controller"/></div><p>And then, by clicking on the <a id="id146" class="indexterm"/>
<span class="strong"><strong>Preview</strong></span> button, the browser will be opened, but it will not display anything, as the<a id="id147" class="indexterm"/> browser is not a device. To display any contacts, we need to use an emulator or test the app on a real device; we will learn about this later in this book.</p><div class="mediaobject"><img src="graphics/9819OS_03_20.jpg" alt="Creating the controller"/></div></div>
<div class="section" title="Adding PhoneGap"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Adding PhoneGap</h1></div></div></div><p>As we already coded everything we need to do, the only thing left to do is to add the <code class="literal">PhoneGap js</code> file into our Sencha Architect project. To do so, select <span class="strong"><strong>Resources</strong></span> on the project inspector, go to the <a id="id148" class="indexterm"/>toolbox, select <span class="strong"><strong>Resources</strong></span>, and then double-click on <span class="strong"><strong>JS</strong></span> <span class="strong"><strong>Resource</strong></span>. Then, on the config panel, give an <span class="strong"><strong>id</strong></span> to it (<span class="strong"><strong>phonegap</strong></span>) and set the <span class="strong"><strong>URL</strong></span> as the <span class="strong"><strong>phonegap</strong></span> file (in this case we are using the <span class="strong"><strong>cordova-2.5.0.js</strong></span> that we can get from <a class="ulink" href="http://phonegap.com">http://phonegap.com</a>). And then we are done!</p><div class="mediaobject"><img src="graphics/9819OS_03_21.jpg" alt="Adding PhoneGap"/></div></div>
<div class="section" title="The final project structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>The final project structure</h1></div></div></div><p>As we have finished implementing <a id="id149" class="indexterm"/>our first Sencha Touch project with Sencha Architect, let's take a look at the code generated for us as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9819OS_03_22.jpg" alt="The final project structure"/></div><p>Notice that Sencha Architect created all the files for us (with the exception of proxy).</p><p>Similar to an Ext JS project, it is very important to bring to our attention that we cannot modify the files on a code editor. In case we do modify any files and try to open in Sencha Architect again, all changes will be lost because Sencha Architect will override them. So in case you decide you want to change any file on a code editor, it is important to know that you will not be able to use Sencha Architect again (and if you do, you will lose the modifications).</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Summary</h1></div></div></div><p>In this chapter we learned how to implement our first Sencha Touch project using Sencha Architect. We learned how to create a new Sencha Touch project, and how to set up the <code class="literal">app.js</code> file using the application. We learned how to create the model, store, view, and controller, and we also covered how to integrate our Sencha Touch project with PhoneGap, which is an advanced topic.</p><p>In the next chapter, we will learn some tips and tricks, such as multilingual apps, create overrides, exporting and importing a project, and much more.</p></div></body></html>