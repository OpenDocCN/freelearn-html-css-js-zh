<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Our First Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Our First Application</h1></div></div></div><p>In the previous chapter, we learned what Marionette is, where to find the source code and documentation, and other useful resources that will help us to learn more about Marionette. But we believe the best way to learn something is by putting it into practice. So in this book, we will build an application with moderate complexity, that is, it is complex enough to break the Hello World! barrier, allowing us to discover the benefits that Marionette has to offer, but simple enough to complete it with in this book. We will show some standalone code snippets to introduce you to each new concept; however most of the time we will stick to the application code.</p><p>In this chapter, we will review how to set up your development environment in order to build our first application. We will also learn three important parts of <code class="literal">Marionette.js</code>: the marionette router, marionette controller, and marionette application.</p><div class="section" title="Introduction to what we are building"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec11"/>Introduction to what we are building</h1></div></div></div><p>The application that we will be building in this book is a website for a book store. We should be able to perform the following actions on the website:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Display a list of book categories</li><li class="listitem" style="list-style-type: disc">Select a category and display the related books</li><li class="listitem" style="list-style-type: disc">Present a description, price, and other important details of the book</li><li class="listitem" style="list-style-type: disc">Add books to the shopping cart</li><li class="listitem" style="list-style-type: disc">Display the shopping cart items</li></ul></div><p>The website that we are going to build is just an example application. It's mandatory to follow the structure proposed in this book, as every application has different needs. Nevertheless, it's a good starting point and our idea is to show how each component of Marionette solves a problem and how to make its components work together.</p><p>Also, keep in mind that we will give attention to the Marionette components of the code, explaining in detail their benefits, and to adding them to the application. However, we will not dive deep into Backbone details such as<a id="id21" class="indexterm"/> <code class="literal">Backbone.Model</code> and<a id="id22" class="indexterm"/> <code class="literal">Backbone.Collection</code>, which are the core components of Backbone, as knowledge of this is already assumed.</p><p>One of the concepts that Marionette adds to Backbone is that of an application object—<code class="literal">Backbone.Marionette.Application</code>. We will start this book with this topic because the object will be the container of all of your Backbone views and models. One of its responsibilities is, before the user starts interacting with the website, it must initialize some of the components, such as the <code class="literal">Backbone.Router</code> component, that will be listening to the route (URL) changes of our application. This object provides some handy methods to perform this initialization. But, before we dig deeper into details, let's first take a look at what we are building.</p><p>The following screenshot helps us to illustrate the structure of the book store application that we are going to build:</p><div class="mediaobject"><img src="graphics/4252OS_02_01.jpg" alt="Introduction to what we are building"/></div><p>We have a navigation section that provides the categories of the books. Then in the middle, we have two sections. The one on top is the list of books by name, author, and price. This section also allows users to order books.</p><p>The second section, in the center of the screen, will show a description of each book as the user selects from the list on top. Finally, to the right of the screen, we have the Order section that will contain the details about our order.</p><p>At the end of the book, the application should look like the following screenshot:</p><div class="mediaobject"><img src="graphics/4252OS_02_02.jpg" alt="Introduction to what we are building"/></div><p>The goal of this chapter is to build the foundation of the book store website and a part of that foundation is to have the <code class="literal">Backbone.Marionette.Application</code> object working with enough functionality so that we can call it an application. Our philosophy is to take small steps at a time and then check where we stand. So let's get started!</p></div></div>
<div class="section" title="Setting up our development environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec12"/>Setting up our development environment</h1></div></div></div><p>As we will be building an<a id="id23" class="indexterm"/> application together, we need to set up our development environment. The following are the steps to do it:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a folder and name it <code class="literal">Bookstore</code>.</li><li class="listitem">Inside this folder, create two new folders—one named <code class="literal">Source Code</code> and the other <code class="literal">Libraries</code>.</li><li class="listitem">In the <code class="literal">Libraries</code> folder, place the following four libraries:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Underscore.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">jQuery.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Backbone.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Backbone.Marionette.js</code></li></ul></div><p>For styling purposes, we will use Twitter bootstrap v2. Download the default package, unzip it, and place the entire unzipped bootstrap folder beside the <code class="literal">.js</code> files inside the <code class="literal">Libraries</code> folder.</p></li><li class="listitem">In<a id="id24" class="indexterm"/> the <code class="literal">Source Code</code> folder, create a new folder with the name <code class="literal">js</code> as it will be the location where we will save all our JavaScript files.</li><li class="listitem">Under the <code class="literal">Source Code</code> folder, create an HTML file and name it <code class="literal">Index.html</code>. It should be placed at the same level as the <code class="literal">js</code> folder.</li><li class="listitem">Make sure that your folder structure looks like the following screenshot and that you have the right library files inside the <code class="literal">Libraries</code> folder.<div class="mediaobject"><img src="graphics/4252OS_02_03.jpg" alt="Setting up our development environment"/></div><p>Your <code class="literal">Source Code</code> folder should look like the following screenshot:</p><p> </p><div class="mediaobject"><img src="graphics/4252OS_02_04.jpg" alt="Setting up our development environment"/></div><p>
</p><p>We are building a single-page application and in this section, we are about to build the initial HTML page structure for our application. It is the HTML file that will be rendered by the server the first time a user types the URL of the site.</p></li><li class="listitem">Open the <code class="literal">Index.html</code> file in your preferred code editor.</li><li class="listitem">To avoid<a id="id25" class="indexterm"/> the tedious task of writing the HTML file manually for this chapter, we have made it available for you at <a class="ulink" href="http://jsfiddle.net/">http://jsfiddle.net/</a>. The code is available at <a class="ulink" href="http://jsfiddle.net/rayweb_on/hsrv7/11/">http://jsfiddle.net/rayweb_on/hsrv7/11/</a>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>
<a class="ulink" href="http://jsfiddle.net">jsfiddle.net</a>—if you don't know<a id="id26" class="indexterm"/> it already, this is an excellent tool to test the small parts of your JavaScript code and share your snippets with ease.</p></div></div><p>I'm sure that if you are reading a Marionette book, it is because you have enough experience to put the CSS and JS tags in the right place. So feel free to skip the following steps.</p></li><li class="listitem">Copy the <span class="strong"><strong>CSS</strong></span> section and paste it into the <code class="literal">&lt;head&gt;</code> section of the HTML file.</li><li class="listitem">Copy the <span class="strong"><strong>HTML</strong></span> section and paste it into the <code class="literal">&lt;body&gt;</code> section of the HTML file.</li><li class="listitem">At <a class="ulink" href="http://jsfiddle.net/">http://jsfiddle.net/</a>, the scripts are already included for you. But in our local environment, we have to add them. We will do it just at the bottom of the <code class="literal">&lt;html&gt; </code>tag, but still inside the <code class="literal">&lt;body&gt;</code> tag.</li><li class="listitem">When you are done with copying the initial structure, your HTML file should look like the <a id="id27" class="indexterm"/>following screenshot (the style script and the template script are collapsed in the screenshot). In this chapter, we will be using the console of your browser and we won't be interacting with the HTML file for now, but it's important that your <code class="literal">Index.html</code> file follows the structure shown in the following screenshot:<div class="mediaobject"><img src="graphics/4252OS_02_05.jpg" alt="Setting up our development environment"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>Bootstrap and styling your page is outside the scope of this book. But it's a pretty convenient library that allows us to set up a decent looking HTML file for this demo application.</p></div></div><p>But wait<a id="id28" class="indexterm"/> a minute…what does the last script <code class="literal">js/BookStore.js</code> refer to? Well, that's the JavaScript code that we will be creating in the next step.</p></li></ol></div></div>
<div class="section" title="The Backbone.Marionette.Application object"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec13"/>The Backbone.Marionette.Application object</h1></div></div></div><p>Create a new<a id="id29" class="indexterm"/> file inside the <code class="literal">js</code> folder and name it <code class="literal">BookStore.js</code>. To create a new application, we just need to type the following line in <code class="literal">Bookstore.js</code>:</p><div class="informalexample"><pre class="programlisting">var bookStoreApp = new Backbone.Marionette.Application();</pre></div><p>We will name the application <code class="literal">BookStoreApp</code> and will start attaching our Backbone pieces to this application. But, we already mentioned that Marionette brings the concept of an application object and, from the documentation, we also know that it is an object that will help us to coordinate the pieces of our application. You may ask, what pieces; for example, a <code class="literal">Marionette.Router</code> object and a <code class="literal">Marionette.Controller</code> object.</p><div class="section" title="Backbone already has a router!"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>Backbone already has a router!</h2></div></div></div><p>Yes, Backbone<a id="id30" class="indexterm"/> already has a router object. Then what does the <code class="literal">Marionette.Router</code> object do differently? Well, the new router adds the ability of reducing your router to just a small file that will contain only the routes of your application and not the methods that will respond and take action once a route is matched. These methods belong to a controller—another new concept that Marionette adds to Backbone.</p><p>Let's build a <code class="literal">Marionette.Router</code> object<a id="id31" class="indexterm"/> and a <code class="literal">Marionette.Controller</code> object<a id="id32" class="indexterm"/> to get a better understanding of them:</p><div class="informalexample"><pre class="programlisting">var BookStoreController = Backbone.Marionette.Controller.extend({displayBooks : function (){
    console.log("I will display books...");
  }
});
var BookStoreRouter = Backbone.Marionette.AppRouter.extend({
  controller :  BookStoreController,
  appRoutes: {
    "": "displayBooks"
  }
});</pre></div><p>In the preceding code snippet, we created the <code class="literal">BookStoreController</code> object, which is just a JavaScript object containing the functions that will match the name of the methods defined in the router. In this case, the empty router will call the <code class="literal">displayBooks</code> method or the controller. This separation of concerns will allow us to have a cleaner code base as the router will only know about the routes. We declare which controller will handle the routes by setting the controller property of the router to <code class="literal">BookStoreController</code>. The rest of the code snippet is just the declaration of the routes.</p><p>It is not <a id="id33" class="indexterm"/>mandatory to have a router in order to use a controller. The Marionette controllers can be instantiated without the need of a router. You may not handle the interaction of your site by changes in the URL but by events. In this case, the controller still adds value as it can be the container of your views.</p><p>It's recommended to have small routers and controllers divided as per the purpose of your application instead of a giant single-router file that will contain all the routes and the functions.</p><p>While these two pieces are part of the application's foundation, we still need to make them work within it. But, we also need to do a little more in order to achieve a functional application. Let's take small steps for this. Let's first check out whether we can see a message log in the console of our browser.</p><p>To do that, we need to put all the code together and add the missing pieces in order to make it work.</p><p>So far, we have only defined the application, controller, and router. But where should we instantiate them? The <code class="literal">Backbone.Marionette.Application</code> object offers the possibility to add initializer methods that will run when we start our application.</p><p>Yes, you read correctly! You can add as many methods as you need in case you want to keep the logic of this initializers separated.</p><p>Inside this initializer method, we will instantiate the router and the controller, and just for fun, add another log message to see the order of execution.</p><p>Use the following code to do this:</p><div class="informalexample"><pre class="programlisting">BookStoreApp.addInitializer(function () {
  var bookStoreController = new BookStoreController({
    var bookStoreRouter = new BookStoreRouter({controller:controller});
  console.log('Message from the addInitializer Method');
..});
})</pre></div><p>Another useful function of the applications is the events that fire the <code class="literal">initialize:before</code>, <code class="literal">initialize:after</code>, and <code class="literal">start</code> functions. The names of these functions are quite descriptive. As the name suggests, the <code class="literal">initialize:before</code> function will be executed before the initializers, the <code class="literal">initialize:after</code> function will be executed after the initializers, and the <code class="literal">start</code> function is responsible for starting the application and thereafter starting the initializers.</p><p>In our<a id="id34" class="indexterm"/> application, we will use <code class="literal">initialize:after</code>. This function will be helpful for us, as the last thing we want to do once we instantiate the router is start <code class="literal">Backbone.history</code>.</p><div class="informalexample"><pre class="programlisting">BookStoreApp.on('initialize:after', function () {
  if (Backbone.history) {
    Backbone.history.start();
  }
  console.log('Mesagge from initialize:after method');
});</pre></div><p>The last step to complete the infrastructure or foundation of our application is call the following function:</p><div class="informalexample"><pre class="programlisting">BookStoreApp.start();</pre></div><p>Now, let's put all the code snippets together as follows:</p><div class="informalexample"><pre class="programlisting">var BookStoreApp = new Backbone.Marionette.Application();
var BookStoreController = Backbone.Marionette.Controller.extend({
  displayBooks : function (){
    console.log("I will display books...");
  }
});
var BookStoreRouter = Backbone.Marionette.AppRouter.extend({
  controller :  BookStoreController,
  appRoutes: {
    "": "displayBooks"
  }
});
BookStoreApp.addInitializer(function () {
  var controller = new BookStoreController();
  var router = new BookStoreRouter({controller:controller});
  console.log("hello from the addInitializer.");
});
BookStoreApp.on('initialize:after', function () {
  if (Backbone.history) {
    Backbone.history.start();}
  console.log("hello from the initialize:after.");
});
BookStoreApp.start();</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><p>Now, you can go ahead and open the <code class="literal">Index.html</code> file in your browser and see the results on the console.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Summary</h1></div></div></div><p>In this chapter, we learned about the application, controller, and router functionality, and how to get them working together to get a simple application skeleton which will be the base for our book store application.</p><p>In the next chapter, we will familiarize ourselves with the different views that Marionette adds to the Backbone development.</p></div></body></html>