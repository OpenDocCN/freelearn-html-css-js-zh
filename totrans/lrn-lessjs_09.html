<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;9.&#xA0;Working with Less in a CMS"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09" class="calibre1"/>Chapter 9. Working with Less in a CMS</h1></div></div></div><p class="calibre7">Working in a CMS…Ah, choices, choices…!</p><p class="calibre7">Question: what do the following have in common—Facebook, Beyoncé, Sony, Dallas Mavericks NBA basketball team, and Time?</p><p class="calibre7">Worked it out? Well, it's the subject of our next chapter in our journey of learning Less. They all have blogs or sites created using WordPress! Created back in 2003, WordPress has become one of the world's most well-known content management system platforms, used in dozens of scenarios, from simple blogs to full-blown e-commerce systems.</p><p class="calibre7">Throughout the next few pages, we're going to learn how to incorporate our favorite CSS preprocessor into WordPress and some of the tricks we can use to help simplify the creation of style sheets. The best bit—most are tricks we've already covered throughout the book so far; we're just going to adapt where we use them.</p><p class="calibre7">In this chapter, we will cover the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">An overview of the WP theme structure</li><li class="listitem">Incorporating Less into pages</li><li class="listitem">Some examples of converting code to use Less</li><li class="listitem">Prebuilt themes for WP, using Less</li><li class="listitem">Plugins available to use Less with WordPress</li><li class="listitem">Using Grunt to help Less development in WP</li></ul></div><p class="calibre7">Curious? Let's get started...!</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note43" class="calibre1"/>Note</h3><p class="calibre7">This chapter will assume a certain level of familiarity with the WordPress theme design; if you're new to WordPress, you might like to peruse one of the several books by Packt Publishing on WordPress theme design.</p></div></div>

<div class="book" title="Chapter&#xA0;9.&#xA0;Working with Less in a CMS">
<div class="book" title="Introducing the WP theme structure"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch09lvl1sec77" class="calibre1"/>Introducing the WP theme structure</h1></div></div></div><p class="calibre7">If you've spent any time working with CMS systems, then you will likely have come across the concept of <a id="id632" class="calibre1"/>using themes to customize your site and add or remove features as you see fit.</p><p class="calibre7">WordPress is no different; it uses a system of themes to customize its appearance; throughout this chapter, we're going to follow this principle and see how we can use Less to help simplify the process. Before we start writing code, it's worth taking a moment to examine the anatomy of a WordPress theme.</p><p class="calibre7">First, we need to download the WordPress source files, which are available at <a class="calibre1" href="http://wordpress.org/latest.zip">http://wordpress.org/latest.zip</a>; at the time of writing this, the latest version is 3.9.1. When we open the WordPress archive, navigate to <span class="strong"><strong class="calibre8">wp-content</strong></span> | <span class="strong"><strong class="calibre8">themes</strong></span> | <span class="strong"><strong class="calibre8">twentyfourteen</strong></span>. We'll see something akin to this:</p><div class="mediaobject"><img src="../images/00091.jpeg" alt="Introducing the WP theme structure" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">All of these files are required to operate the Twenty Fourteen theme that comes with this version of WordPress; we will be using this theme as a basis for our exercises throughout this chapter.</p><p class="calibre7">We are most interested in the <code class="email">style.css</code> file—this is the main style sheet for any theme. This file contains the theme information that is displayed within the theme selection area of WordPress, where we can see details such as the name of the theme, author, support URL, and so on. We will also make use of the <code class="email">functions.php</code> file to add support for Less, but this will be a one-off process that happens before we really get to work on customizing<a id="id633" class="calibre1"/> our theme.</p></div></div>
<div class="book" title="Preparing our environment"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec78" class="calibre1"/>Preparing our environment</h1></div></div></div><p class="calibre7">Now that we've downloaded WordPress, we need to ensure we have a working environment available<a id="id634" class="calibre1"/> in order to work with Less.</p><p class="calibre7">Each person's environment might differ, but to get the most benefit out of the exercises that follow, you will need to ensure that you at least have the following:</p><div class="book"><ul class="itemizedlist"><li class="listitem">A working copy of WordPress that can be customized—ideally, this will be locally hosted using a web server such <a id="id635" class="calibre1"/>as WAMP (for Windows, available at <a class="calibre1" href="http://www.wampserver.com">http://www.wampserver.com</a>), or <a id="id636" class="calibre1"/>MAMP (for Mac, available at <a class="calibre1" href="http://www.mamp.info">http://www.mamp.info</a>). Alternatively, you might have some online webspace available for use—this will work as well, although you might find the automation exercises at the end of this chapter hard to do.</li><li class="listitem">For the purposes of the book, I will assume WampServer is installed; change accordingly, if your server is different.</li><li class="listitem">A copy of Node.js installed along with Grunt; we covered how to install both earlier in <a class="calibre1" title="Chapter 2. Building a Less Development Toolkit" href="part0025_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre9">Building a Less Development Toolkit</em></span>.</li><li class="listitem">A text editor of your choice—there are hundreds available; my personal preference is Sublime Text 2, which I will assume you have installed.</li></ul></div><p class="calibre7">If you do not have WordPress<a id="id637" class="calibre1"/> already installed, then you can find full instructions at <a class="calibre1" href="http://codex.wordpress.org/Installing_WordPress">http://codex.wordpress.org/Installing_WordPress</a> on how to install it.</p><p class="calibre7">Okay, assuming we have the requisite pieces of software installed, let's move on and take a look at preparing our theme for working with Less.</p></div>
<div class="book" title="Creating a basic child theme"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec79" class="calibre1"/>Creating a basic child theme</h1></div></div></div><p class="calibre7">Hold on, preparing our theme?</p><p class="calibre7">Yes, you read<a id="id638" class="calibre1"/> correctly—preparing our theme. While WordPress does come with three themes available for use out of the box, it is not good practice to modify the source files directly.</p><p class="calibre7">Modifying the source files means that your theme will break if an update is released for it (and yes, WordPress does release updates to its themes). We can get around this by creating a child theme, which sits in the same theme folder, but is set to inherit the base files of its parent theme.</p><p class="calibre7">What this means is that we can retain the original system files for the parent theme, but use new styles created in the child theme to override existing styles. We will make good use of this principle later<a id="id639" class="calibre1"/> in this chapter, when we start to write new Less code.</p><p class="calibre7">For now, let's quickly run through creating our new child theme:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Navigate to <span class="strong"><strong class="calibre8">wp-content</strong></span> | <span class="strong"><strong class="calibre8">themes</strong></span>; here, you will see a folder called <code class="email">twentyfourteen</code>:<div class="mediaobject"><img src="../images/00092.jpeg" alt="Creating a basic child theme" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Create a copy of this folder, but rename it <code class="email">twentyfourteen-child</code>. It is good practice to append <code class="email">child</code> at the end of such a theme, to identify it in the theme folder list.</li><li class="listitem" value="3">Within the <code class="email">twentyfourteen-child</code> folder, crack open a copy of <code class="email">style.css</code>, then remove everything below the closing <code class="email">*/</code>, and replace as shown:<div class="informalexample"><pre class="programlisting">This theme, like WordPress, is licensed under the GPL.
Use it to make something cool, have fun, and share what you've learned with others.
*/

<span class="strong"><strong class="calibre8">@import url("../twentyfourteen/style.css");</strong></span>

<span class="strong"><strong class="calibre8">/* =Theme customization starts here</strong></span>
<span class="strong"><strong class="calibre8">-------------------------------------------------------------- */</strong></span>
</pre></div></li></ol><div class="calibre14"/></div><p class="calibre7">That's all we need to do. If we browse to the <span class="strong"><strong class="calibre8">Central Administration</strong></span> area of our WordPress installation, we will see the child theme present in the <span class="strong"><strong class="calibre8">Appearance</strong></span> | <span class="strong"><strong class="calibre8">Themes</strong></span> area. All that remains to do is to activate it in the usual manner.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note44" class="calibre1"/>Note</h3><p class="calibre7">Note that going forward, it is assumed all changes will be made in the child theme, unless directed otherwise.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Adding support for Less in WordPress"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec80" class="calibre1"/>Adding support for Less in WordPress</h1></div></div></div><p class="calibre7">With WordPress installed and working, it's time to turn our attention to adding support for Less.</p><p class="calibre7">In older versions <a id="id640" class="calibre1"/>of WordPress, it was customary to add this directly to the <code class="email">header.php</code> file. While it worked fine, it meant we couldn't maintain<a id="id641" class="calibre1"/> a clear separation between HTML content and presentational markup. Thankfully, in more recent versions, the WordPress team moved to adding the style sheet by using a function stored in the <code class="email">functions.php</code> file. Let's take a look at how to achieve this now:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a text editor of your choice, then browse to the <code class="email">twentyfourteen</code> theme folder, and look for <code class="email">functions.php</code>. Add the following code at the bottom of the file:<div class="informalexample"><pre class="programlisting">/*
 * Adds support for the Less preprocessor to your theme.
 *
 * @since Twenty Fourteen 1.0
 * @param string $current_user Determines the currently logged in user
 */
if ( ! function_exists( 'less_enqueue_scripts' ) ) {
    function less_enqueue_scripts() {
         
        $current_user = wp_get_current_user();
         
        if ( $current_user-&gt;ID == '1' ) {
          wp_enqueue_script( 'lesscss', get_stylesheet_directory_uri() . '/js/less.min.js' );
        }
    }
    add_action( 'wp_enqueue_scripts', 'less_enqueue_scripts' );
}</pre></div></li><li class="listitem" value="2">Save the changes. If we refresh the screen and then preview the results in a browser, we won't see any visual changes. However, if we preview the compiled <a id="id642" class="calibre1"/>source code in a DOM Inspector such as Firebug, we can clearly see the addition of Less:<div class="mediaobject"><img src="../images/00093.jpeg" alt="Adding support for Less in WordPress" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre7">At this point, we<a id="id643" class="calibre1"/> have a version of WordPress working perfectly well with Less support—we can go ahead and create a Less file, called <code class="email">style.less</code>, and drop this in as a replacement for <code class="email">style.css</code>, right…?</p></div>

<div class="book" title="Adding support for Less in WordPress">
<div class="book" title="Showing Less style sheets to specific users"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec73" class="calibre1"/>Showing Less style sheets to specific users</h2></div></div></div><p class="calibre7">Not so fast. We<a id="id644" class="calibre1"/> told WordPress how to call in Less, but not how to retrieve the right set of Less styles yet! To do this, we need to add another function into the <code class="email">functions.php</code> file; this one will not only incorporate a replacement Less-based style sheet, but also show it only to the administrator and display a compiled version for normal use. Bear with me on this; all will become clear<a id="id645" class="calibre1"/> shortly:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a copy of the <code class="email">functions.php</code> file that we worked on in the previous exercise. This time, add the following at the bottom of the file:<div class="informalexample"><pre class="programlisting">if ( ! function_exists( 'less_filter_stylesheet_uri' ) ) {
  function less_filter_stylesheet_uri( $stylesheet_uri, $stylesheet_dir_uri ) {
    $current_user = wp_get_current_user();
         
    if ( $current_user-&gt;ID == '1' ) {
      $style_src = $stylesheet_dir_uri . '/style.less';
    } else {
      $style_src = $stylesheet_dir_uri . '/style.min.css';
      return $style_src;
    }
    add_filter( 'stylesheet_uri', 'less_filter_stylesheet_uri', 10, 2 );
}</pre></div></li><li class="listitem" value="2">Save a copy of the file, then refresh the browser window that currently displays WordPress. If we open up our DOM Inspector as we did before, we can now see the replacement style sheet in use:<div class="mediaobject"><img src="../images/00094.jpeg" alt="Showing Less style sheets to specific users" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre7">If we log out of WordPress and log in as another user, the compiled CSS version of the style sheet will be displayed instead.</p></div></div>
<div class="book" title="Adding Less support using a plugin"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec81" class="calibre1"/>Adding Less support using a plugin</h1></div></div></div><p class="calibre7">Adding in code manually works perfectly well, but after a while it gets tedious. Surely we can make things <a id="id646" class="calibre1"/>easier using a plugin, right?</p><p class="calibre7">Absolutely, we can add support for Less using a plugin; there are several ways to achieve this, but my favorite has to be the plugin created by Justin Kopepasah and available for download from <a id="id647" class="calibre1"/>WordPress Plugin Directory at <a class="calibre1" href="https://wordpress.org/plugins/less-theme-support/">https://wordpress.org/plugins/less-theme-support/</a>. Let's take a peek at how to use it; it's really easy to install:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start by navigating to <a class="calibre1" href="https://wordpress.org/plugins/less-theme-support/">https://wordpress.org/plugins/less-theme-support/</a> and then clicking on <span class="strong"><strong class="calibre8">Download Version 1.0.2</strong></span>. When prompted to do so, save it into the <code class="email">plugins</code> folder within our installation of WordPress.</li><li class="listitem" value="2">Browse to the <span class="strong"><strong class="calibre8">Plugins</strong></span> area in WordPress' admin, then click on <span class="strong"><strong class="calibre8">Upload</strong></span> and select <span class="strong"><strong class="calibre8">less-theme-support.1.0.2.zip</strong></span>.</li><li class="listitem" value="3">Click on <span class="strong"><strong class="calibre8">Install Now</strong></span>, then when prompted, click on <span class="strong"><strong class="calibre8">Activate Plugin</strong></span>.</li></ol><div class="calibre14"/></div><p class="calibre7">At this point, the plugin is now active and we need to tell our WordPress theme how to use it:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">If you have not already done so from a previous exercise, rename the <code class="email">style.css</code> file at the root of our theme to <code class="email">style.less</code>.</li><li class="listitem" value="2">Fire up your favorite text editor and open a copy of the <code class="email">functions.php</code> file that is located at the root of our <code class="email">theme</code> folder.</li><li class="listitem" value="3">Look for the <code class="email">twentyfourteen_setup()</code>function (on or around line 58) and add the following at the end of the function, as shown:<div class="informalexample"><pre class="programlisting">    add_filter( 'use_default_gallery_style', '__return_false' );

    <span class="strong"><strong class="calibre8">// Add support for Less preprocessor</strong></span>
    <span class="strong"><strong class="calibre8">add_theme_support( 'less', array('enable' =&gt; true ) );</strong></span>
}
endif; // twentyfourteen_setup</pre></div></li></ol><div class="calibre14"/></div><p class="calibre7">Save the file. If we revert to our WordPress site and refresh the screen, we should see no visual change. The real change will show if we look at the code within DOM Inspector:</p><div class="mediaobject"><img src="../images/00095.jpeg" alt="Adding Less support using a plugin" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">It is worth<a id="id648" class="calibre1"/> noting that Less Theme Support comes with a number of configuration options, which we can use to change how it works. This is perfect if we're switching from using it in a development site, to a production one. The values that can be set are Boolean and the default is false:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><code class="email">Enable</code>: This enables Less and enqueues <code class="email">less.min.js</code> on the frontend</li><li class="listitem"><code class="email">Develop</code>: This enables a development environment for Less and enqueues <code class="email">less-develop.js</code></li><li class="listitem"><code class="email">Watch</code>: This enables the watch mode for Less and enqueues <code class="email">less-watch.js</code></li><li class="listitem"><code class="email">Minify</code>: This enables usage of a minified style sheet (<code class="email">style.min.css</code>) on the frontend for all other visitors (best generated using <code class="email">lessc -x style.less &gt; style.min.css</code>)</li></ul></div><p class="calibre7">If used with care, they can be very flexible; for instance, you might want to configure your theme to use Less dynamically when working in development, but not in production:</p><div class="informalexample"><pre class="programlisting">add_theme_support('less', array(
  'enable'  =&gt; true,
  'develop' =&gt; true,
  'watch'  =&gt; true
));</pre></div><p class="calibre7">If we switch to production use, then we are likely to use the <code class="email">minify</code> option instead:</p><div class="informalexample"><pre class="programlisting">add_theme_support( 'less', array(
   'minify' =&gt; true
));</pre></div><p class="calibre7">As we've seen, it's an easy plugin to configure. If you're working with Less on a number of sites, it's often better to use a plugin to install Less so that we don't have to delve into source files and edit them. The key part of this exercise is the use of the <code class="email">add_theme_support</code> keyword for WordPress, which allows a theme or plugin to register support<a id="id649" class="calibre1"/> for a certain feature within our theme.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note45" class="calibre1"/>Note</h3><p class="calibre7">If you are interested in learning more about <code class="email">add_theme_support</code>, it is worth browsing the<a id="id650" class="calibre1"/> WordPress Codex page at <a class="calibre1" href="http://codex.wordpress.org/Function_Reference/add_theme_support">http://codex.wordpress.org/Function_Reference/add_theme_support</a>.</p></div><p class="calibre7">This allows us to tell the theme to use Less. We can always do this manually (as we have seen), but it is preferable where possible to use plugins, unless circumstances dictate an alternative method is needed.</p></div>

<div id="page" style="height:0pt"/><div class="book" title="Working with Less themes in WordPress"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec82" class="calibre1"/>Working with Less themes in WordPress</h1></div></div></div><p class="calibre7">Now that we<a id="id651" class="calibre1"/> have support for Less in place, let's move on and take a look at the options available to use Less styles in our themes, either within <a id="id652" class="calibre1"/>our own creations, or as part of prebuilt themes available for sale or download via the Internet.</p></div>

<div class="book" title="Working with Less themes in WordPress">
<div class="book" title="Converting themes to use Less"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec74" class="calibre1"/>Converting themes to use Less</h2></div></div></div><p class="calibre7">We now have the <a id="id653" class="calibre1"/>basis for a Less style sheet, to which we can start to add our converted styles. Hold on, I hear you ask, "If we're converting a theme such as <code class="email">TwentyFourteen</code>, where on earth do we start?"</p><p class="calibre7">It's a very good question. Within excess of 4200 lines in the current style sheet for this theme, it's easy to feel bewildered! However, all will begin to come clear if we follow two simple principles:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Less allows us to break down our style sheet into multiple files, which are compiled into one by Less. Make use of this; it will be a big help, as smaller files make for easier conversion!</li><li class="listitem">Don't try to convert all of it in one go; do it bit by bit. Less is a superset of CSS, which means that it is effectively all CSS; Less will happily compile unchanged CSS styles, even in a <code class="email">.less</code> file.</li></ul></div><p class="calibre7">With these principles in mind, let's make a start on converting our theme:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start by opening a copy of the <code class="email">style.css</code> file from the <code class="email">TwentyFourteen</code> parent theme and look for section 4, which starts on or around line 831 to 926.</li><li class="listitem" value="2">Copy this section to the <code class="email">style.less</code> file in our child theme; paste it in below this line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">/* =Theme customization starts here</strong></span>
<span class="strong"><strong class="calibre8">-------------------------------------------------------------- */</strong></span>
</pre></div></li><li class="listitem" value="3">We'll start by<a id="id654" class="calibre1"/> converting the normal green color for the search box to use a variable, then use it to work out the light green color used when hovering over it. Add the following immediately below the <code class="email">@import</code> statement in <code class="email">style.less</code>, as shown:<div class="informalexample"><pre class="programlisting">@import url("../twentyfourteen/style.css");

<span class="strong"><strong class="calibre8">/* Define colors */</strong></span>
<span class="strong"><strong class="calibre8">@search-box-color: #24890d;</strong></span>
<span class="strong"><strong class="calibre8">@search-box-hover-color: @search-box-color + #333;</strong></span>
</pre></div></li><li class="listitem" value="4">The next change we'll make will be to the <code class="email">.site-title</code> style. We'll convert it to Less' nesting format, so remove these two styles:<div class="informalexample"><pre class="programlisting">.site-title { float: left; font-size: 18px; font-weight: 700;
  line-height: 48px; margin: 0; }

.site-title a, .site-title a:hover { color: #fff; }</pre></div><p class="calibre24">Replace the previous two styles with the following:</p><div class="informalexample"><pre class="programlisting">.site-title {
  float: left;
  font-size: 18px;
  font-weight: 700;
  line-height: 48px;
  margin: 0;
  a {
    color: #fff;
    &amp;:hover { color: #fff; }
  }
}</pre></div></li><li class="listitem" value="5">We also have an opportunity to incorporate a mixin. This time, it will be in the form of a replacement<a id="id655" class="calibre1"/> for the <code class="email">box-sizing</code> style used in the <code class="email">.search-box-wrapper</code> class. Look for this class in the <code class="email">style.less</code> file and modify as shown:<div class="informalexample"><pre class="programlisting">.search-box-wrapper {
  .box-sizing(border-box);
  position: absolute;
  top: 48px;
  right: 0;
  width: 100%;
  z-index: 2;
}</pre></div></li><li class="listitem" value="6">In a separate file, add the following code and save it as <code class="email">mixins.less</code> in the <code class="email">less</code> folder:<div class="informalexample"><pre class="programlisting">.box-sizing(@sizing: border-box) {
  -ms-box-sizing: @sizing;
  -moz-box-sizing: @sizing;
  -webkit-box-sizing: @sizing;
  box-sizing: @sizing;
}</pre></div></li><li class="listitem" value="7">We need to import this into our Less file, so go ahead and add the following line, as indicated:<div class="informalexample"><pre class="programlisting">@import url("../twentyfourteen/style.css");
@import "less/mixins.less";</pre></div></li><li class="listitem" value="8">The final step is to rename the <code class="email">style.css</code> file in our child theme to <code class="email">style.less</code>; although this is not yet fully converted, Less will still compile this as valid CSS.<div class="mediaobject"><img src="../images/00096.jpeg" alt="Converting themes to use Less" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre7">At this point, we can now save our work, then refresh the browser window, which displays our WordPress site. If all is well, you will not see any visual difference. The only difference you will see is when looking at the compiled code through a DOM Inspector, such as Firebug:</p><p class="calibre7">The keen-eyed among<a id="id656" class="calibre1"/> you might have spotted something—why are we duplicating code, I hear you ask? There's a good reason for duplicating the code, at least temporarily—while this is something we wouldn't normally want do to do, the irony here is that we can use the unintended duplication to good effect, to  help confirm if our new styles are correct.</p><p class="calibre7">We took a copy of <code class="email">section 4</code> from the original parent theme's CSS file and copied it into our child theme. By default, styles in a child theme are appended to the parent's style sheet. In this instance, our theme has appended the duplicated style, as we would expect. Here comes the rub: we need to then rework the duplicated style to its Less equivalent (as was done here). We can then check against the original theme, indicated by the <code class="email">style.css</code> at line 917, to see if our Less version is correct.</p><p class="calibre7">If it is correct, we can then either remove it from the original theme, or we can remove the <code class="email">@import</code> statement; this breaks the dependency on the parent theme and turns the child theme into a theme in its own right.</p><p class="calibre7">Now that we've covered the basics of converting a theme, let's take a moment to consider some useful tips that will help us with creating your own theme.</p></div></div>

<div class="book" title="Working with Less themes in WordPress">
<div class="book" title="Creating our own theme"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch09lvl2sec75" class="calibre1"/>Creating our own theme</h2></div></div></div><p class="calibre7">So far, we've spent time<a id="id657" class="calibre1"/> converting existing CSS styles in our WordPress theme to use Less. While this works well, it will take time to complete, as WordPress core themes, such as <code class="email">TwentyTwelve</code> or <code class="email">TwentyFourteen</code>, run into several thousand lines!</p><p class="calibre7">A more sensible route is to create your own theme. Rather than writing one from scratch, it is preferable to create it as a child theme, so it overrides existing styles within the parent theme.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip15" class="calibre1"/>Tip</h3><p class="calibre7">Although, we've used an example here, the principles detailed can be used in any instance where you need to create a new theme.</p></div><p class="calibre7">"Why use a child theme", I hear you ask? There are several good reasons to do so:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Any changes<a id="id658" class="calibre1"/> you make to a parent theme will likely break if the WordPress team issues an update.</li><li class="listitem">It saves you having<a id="id659" class="calibre1"/> to redefine a whole bunch of styles; you can concentrate instead on making the critical changes. When ready, you can incorporate the parent theme's styles into your own and convert your child theme into one that can be used in its own right.</li></ul></div><p class="calibre7">Let's now take a look at creating a theme using Less. To get the full benefit from this exercise, we'll need to ensure that a few things are in place:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Your WordPress installation has a copy of <code class="email">TwentyTwelve</code> installed and activated. <code class="email">TwentyTwelve</code> has a simpler CSS style sheet than the current <code class="email">TwentyFourteen</code> incarnation; it will make the process easier to grasp and hopefully encourage you to move onto working with the newer theme!</li><li class="listitem">A copy of the <code class="email">TwentyTwelve</code> theme has been saved and reconfigured as a child theme; if you're unsure on how, then refer to the <span class="strong"><em class="calibre9">Creating a basic child theme</em></span> section of this chapter.</li><li class="listitem">A copy of Crunch! has been installed and configured for use on your system.</li><li class="listitem">A copy of Firefox is installed. This theme was developed using Firefox to keep things simple for the purposes of this exercise.</li></ul></div><p class="calibre7">We'll begin with creating the basic style sheet that is key to the whole compilation process:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start by renaming the existing <code class="email">style.css</code> file within your child theme folder. We'll replace it with a compiled version at the end of the exercise.</li><li class="listitem" value="2">From the accompanying download, extract and save a copy of the <span class="strong"><strong class="calibre8">less</strong></span> folder within the <code class="email">learningless</code> folder, to the root of your child theme folder.</li><li class="listitem" value="3">Open your text editor and then add the following to it, saving it as <code class="email">style.less</code> in the root<a id="id660" class="calibre1"/> of your child theme folder:<div class="informalexample"><pre class="programlisting">/*
Theme Name:     Learning Less
Description:    Child theme for the Twenty Twelve theme 
Author:         Alex Libby
Author URI:     http://www.not42.net
Template:       twentytwelve
Version:        0.1
*/

// Import parent theme styles
@import url("../../twentytwelve/style.css");
@import "variables.less";
@import "mixins.less";
@import "misc.less";
@import "navigation.less";
@import "header.less";
@import "posts.less";
@import "pages.less";
@import "sidebar.less";
@import "widgets.less";
@import "footer.less";</pre></div></li><li class="listitem" value="4">Next, we need to compile <code class="email">style.less</code> in order to produce our WordPress style sheet. For now, we'll use Crunch! to compile the file, so go ahead and open <code class="email">style.less</code> within your installation of Crunch!.</li><li class="listitem" value="5">Click on <span class="strong"><strong class="calibre8">Crunch File</strong></span>, then when prompted, enter <code class="email">style.css</code> as the filename to save the compiled results. It will look similar to the following screenshot:<div class="mediaobject"><img src="../images/00097.jpeg" alt="Creating our own theme" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="6">Copy the compiled <code class="email">style.css</code> file into the root of your child theme folder.</li><li class="listitem" value="7">Fire up your copy<a id="id661" class="calibre1"/> of Firefox and browse to your WordPress installation. If all is well, you should see something akin to this screenshot:<div class="mediaobject"><img src="../images/00098.jpeg" alt="Creating our own theme" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre7">Okay, it won't win any style awards! Nevertheless, it helps to illustrate some key points; let's take a breather and look at these in more detail. </p><div class="informalexample" title="Note"><h3 class="title2"><a id="note46" class="calibre1"/>Note</h3><p class="calibre7">There are completed version of the <code class="email">style.less</code> and <code class="email">style.css</code> files within the <code class="email">learningless</code> folder; navigate to the less folder, then rename <code class="email">style-finished.css</code> to style and copy to the root of your child folder. If you are struggling with the less code, then <code class="email">style-finished.less</code> contains a completed copy of the code for this theme.</p></div><p class="calibre7">The crux of this<a id="id662" class="calibre1"/> whole process is the <code class="email">style.less</code> file. Notice how we created a number of <code class="email">@import</code> statements within? This is an essential part of developing themes for WordPress when working with Less; Less allows us to split what could be a lengthy style sheet into smaller, more manageable files.</p><p class="calibre7">At this point, you're probably asking, "How do I know how many files to split my code into?" It's a good question and the short answer is: there is no single right answer! Let me explain.</p><p class="calibre7">It all depends on how large your style sheet is. A good pointer is to consider what elements you have within your style sheet and group them accordingly. You can then use one or more Less file; Less will happily compile them into one single style sheet at the end. In our example, we have a number of suitable groups such as posts, sidebar, navigation and the like; we've set our main style sheet to import a single Less file for each of these groups.</p><p class="calibre7">Throughout all of the Less files, we've made full use of Less' nesting capability; this is one key skill to master when working with WordPress themes built using Less. Nesting is very much your friend when developing WordPress themes; we can group together all of the relevant styles, which makes it easier to read and manage.</p><p class="calibre7">Moving on; anyone<a id="id663" class="calibre1"/> notice the presence of two key files, namely <code class="email">mixins.less</code> and <code class="email">variables.less</code>? These are perfect examples of Less files to be created as part of developing themes for WordPress.</p><p class="calibre7">We can store all of our variables within one file and reference them as required. A perfect example is to first create variables for each of our colors:</p><div class="informalexample"><pre class="programlisting">// Colors
@white: #fff;
@vivid-orange: #f95812;
@desaturated-cyan: #335c64;
@gray: #666;
…</pre></div><p class="calibre7">We can then reference the colors within secondary variables. If there's any need to change, then this is the only file that needs to be updated:</p><div class="informalexample"><pre class="programlisting">// Posts
@entry-title-color: @white;
@entry-title-link: @vivid-orange;
@entry-title-link-hover: @desaturated-cyan;
@border-color: @gray;</pre></div><p class="calibre7">If we open a copy of <code class="email">posts.less</code>, we can see the variables in use as shown in the following code:</p><div class="informalexample"><pre class="programlisting">.entry-header {
  .entry-title {
<span class="strong"><strong class="calibre8">   .links(@entry-title-link, @entry-title-link-hover);</strong></span>
  }
}

.entry-header, .entry-meta {
<span class="strong"><strong class="calibre8">  .links(@entry-title-link, @entry-title-link-hover);</strong></span>
}

.entry-header .entry-title {
<span class="strong"><strong class="calibre8">  </strong></span>
<span class="strong"><strong class="calibre8">.links(@entry-title-color, @entry-title-link-hover);</strong></span>
}</pre></div><p class="calibre7">In the same way, we can store all of our mixins in one file, namely <code class="email">mixins.less</code>; should any of these change, there is only one file that needs updating, not many!</p></div></div>

<div class="book" title="Working with Less themes in WordPress">
<div class="book" title="Taking construction further"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch09lvl2sec76" class="calibre1"/>Taking construction further</h2></div></div></div><p class="calibre7">At this stage, you're probably thinking, "Great, I've got a theme I can use…" Right? Well, yes, and not quite. (Bet you weren't expecting that…)</p><p class="calibre7">Hands up, if you read through each Less file from our new theme? Good. Now, hands up if you really read through the files carefully…ah! not so many of you…</p><p class="calibre7">This was done with good reason—the code works perfectly well; as a start point, it will serve the purpose. However, there are some instances where it can be improved; after all, it was never intended to be a Picasso! I thought I should leave you with this little challenge: can you find where it can be improved? <span class="strong"><em class="calibre9">One clue…there are not enough variables, me thinks…up for the challenge?</em></span>
</p><p class="calibre7">Okay, here's a more involved<a id="id664" class="calibre1"/> challenge: remember how I said we'll use Crunch! to compile our code? Well, we can do better than this. We've used Grunt elsewhere in this book, so here's another use: we can use it to automate our compilation.</p><p class="calibre7">The key to this is compiling only the <code class="email">style.less</code> file. While you can try compiling the others, they will no doubt throw errors, as most will not see the variables' file that is a dependency.</p><p class="calibre7">The next part is to configure <code class="email">gruntfile.js</code>, which will tell Grunt to only compile this file. We can then run Grunt watch in the background to allow it to compile automatically. We will cover this whole process in more detail, later in this chapter.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip16" class="calibre1"/>Tip</h3><p class="calibre7">If you get stuck, have a look on Google, as there are several examples available; <a class="calibre1" href="http://jonathanmh.com/make-grunt-watch-for-lesscss-changes/">http://jonathanmh.com/make-grunt-watch-for-lesscss-changes/</a> contains a useful example by one is the useful blog post by Jonathan Hethey. It contains a number of additional steps, but should be enough to give you an idea of how to use Grunt and watch when compiling Less theme files.</p></div><p class="calibre7">Enough of developing; it's time to change tack and have a breather. Let's delve into using prebuilt Less themes with WordPress.</p></div></div>

<div class="book" title="Working with Less themes in WordPress">
<div class="book" title="Using a prebuilt Less theme"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch09lvl2sec77" class="calibre1"/>Using a prebuilt Less theme</h2></div></div></div><p class="calibre7">If you're not quite<a id="id665" class="calibre1"/> up to building a theme from <a id="id666" class="calibre1"/>scratch, then you can always use a prebuilt one. There are dozens available online, either for free or at a low cost. It's worth having a look on Google for some examples and then trying them out and deciding whether they match your requirements. Here <a id="id667" class="calibre1"/>are some <a id="id668" class="calibre1"/>examples to get you started:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre8">Less</strong></span>: This is a minimalistic<a id="id669" class="calibre1"/> theme from Jared Erickson, available at <a class="calibre1" href="http://jarederickson.com/less-a-free-super-minimal-wordpress-theme/">http://jarederickson.com/less-a-free-super-minimal-wordpress-theme/</a></li><li class="listitem"><span class="strong"><strong class="calibre8">Starter</strong></span>: This theme by <a id="id670" class="calibre1"/>Roots contains support for Less and is available at http://roots.io/starter-theme/</li><li class="listitem"><span class="strong"><strong class="calibre8">Whiteboard</strong></span>: This is<a id="id671" class="calibre1"/> a theme that uses Less 4 Framework, which can be downloaded from <a class="calibre1" href="http://whiteboardframework.com/whiteboard-documentation/">http://whiteboardframework.com/whiteboard-documentation/</a></li><li class="listitem"><span class="strong"><strong class="calibre8">Spare</strong></span>: This is a<a id="id672" class="calibre1"/> paid-for theme, available from Theme Forest, at <a class="calibre1" href="http://themeforest.net/item/spare-ultimate-multipurpose-less-theme/7520253">http://themeforest.net/item/spare-ultimate-multipurpose-less-theme/7520253</a></li></ul></div><p class="calibre7">There are lots of themes available for use and it is worth spending some time on Google to see what is available and trying them out. Hopefully, you will find something that comes close to, or matches your requirements. With luck, you might be able to tweak it a little with skills you've hopefully picked up from reading this book!</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Automating WordPress development"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec83" class="calibre1"/>Automating WordPress development</h1></div></div></div><p class="calibre7">If you spend any<a id="id673" class="calibre1"/> time developing themes, you will no doubt know that it is a manual process, which takes time. Themes often require careful tweaking and retesting; it can get particularly tedious when recompiling Less files!</p><p class="calibre7">Fortunately, there are a number of solutions available to relieve some of the tedium experienced when developing WordPress themes; the most popular option is to use a package we first met back in <a class="calibre1" title="Chapter 2. Building a Less Development Toolkit" href="part0025_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre9">Building a Less Development Toolkit</em></span>. It's time to revisit using Grunt!</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note47" class="calibre1"/>Note</h3><p class="calibre7">For the more experienced, it is worth looking online for <code class="email">lessphp</code>, which is a port of Less to PHP. There is code available that allows direct compilation within WordPress, in much the same way as we will cover in this exercise.</p></div></div>

<div class="book" title="Automating WordPress development">
<div class="book" title="Using Grunt in WordPress development"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec78" class="calibre1"/>Using Grunt in WordPress development</h2></div></div></div><p class="calibre7">Remember back in <a class="calibre1" title="Chapter 2. Building a Less Development Toolkit" href="part0025_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre9">Building a Less Development Toolkit</em></span>, when we met Grunt for the first time?</p><p class="calibre7">Well, we're going<a id="id674" class="calibre1"/> to meet it again, as it is a perfect tool to help with compiling Less files as part of WordPress development. It makes perfect sense to <a id="id675" class="calibre1"/>use it here, as we are compiling style sheets after all! Let's take a look at how we can set up Grunt for use with compiling WordPress style sheets automatically.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note48" class="calibre1"/>Note</h3><p class="calibre7">For the purposes of this exercise, I will assume you are using Grunt as installed in the <span class="strong"><em class="calibre9">Watching for changes to Less files</em></span> section of <a class="calibre1" title="Chapter 2. Building a Less Development Toolkit" href="part0025_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre9">Building a Less Development Toolkit</em></span>. If you've not yet installed it, now's a good time to revert to that chapter and do it.</p></div><p class="calibre7">We'll work with the standard <code class="email">TwentyFourteen</code> theme that comes with WordPress 3.8.x and upwards; the process will work perfectly well with other themes too.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start by opening your favorite text editor, then add the following, and save it as <code class="email">package.json</code> within the root folder of the <code class="email">TwentyFourteen</code> theme:<div class="informalexample"><pre class="programlisting">{
  "name": "WordPress_Meets_Grunt",
  "version": "0.0.0",
  "author": "Alex Libby",
  "dependencies": {
    "grunt-cli": "latest",
    "grunt-contrib-concat": "latest",
    "grunt-contrib-uglify": "latest",
    "grunt-contrib-less": "latest",
    "grunt-contrib-watch": "latest"
  }
}</pre></div></li><li class="listitem" value="2">Next, we need to create a Grunt watch file, which will perform a number of actions, when Grunt's watch facility determines a change has been made. Add the following skeleton to a new file, saving it as <code class="email">gruntfile.js</code>, within the root of your theme folder:<div class="informalexample"><pre class="programlisting">module.exports = function(grunt) {
      grunt.registerTask('watch', [ 'watch' ]);
     grunt.initConfig({ });
 
      grunt.loadNpmTasks('grunt-contrib-concat');
     grunt.loadNpmTasks('grunt-contrib-uglify');
     grunt.loadNpmTasks('grunt-contrib-less');
     grunt.loadNpmTasks('grunt-contrib-watch');
   };</pre></div></li><li class="listitem" value="3">The basic Grunt file contains references to the Node plugins we're going to use—we now<a id="id676" class="calibre1"/> need to add the configuration<a id="id677" class="calibre1"/> options for each plugin. Let's begin by adding them for <code class="email">grunt-contrib-concat</code> to concatenate any JavaScript files into one, as shown:<div class="informalexample"><pre class="programlisting">    grunt.initConfig({
     concat: {
       js: {
         options: {
           separator: ';'
         },
         src: [
           'javascript/*.js'
         ],
         dest: 'public/js/main.min.js'
       },
     },</pre></div></li><li class="listitem" value="4">Next comes the options for <code class="email">UglifyJS</code>. Go ahead and add the following code immediately below the concat block from the previous step:<div class="informalexample"><pre class="programlisting">    uglify: {
      options: {
        mangle: false
      },
      js: {
        files: {
          'public/js/main.min.js': ['public/js/main.min.js']
        }
      }
    },</pre></div></li><li class="listitem" value="5">Our next plugin we need to add in is the one of most interest—Less. Add this code immediately below the closing <code class="email">}</code> of the previous section:<div class="informalexample"><pre class="programlisting">    less: {
      style: {
        files: {
          "style.css": "style.less"
        }
      }
    },</pre></div></li><li class="listitem" value="6">Last, but by no<a id="id678" class="calibre1"/> means least, is <code class="email">watch</code>. This part <a id="id679" class="calibre1"/>watches out for any changes to the code and invokes the relevant command:<div class="informalexample"><pre class="programlisting">    watch: {
      js: {
        files: ['javascript/*.js'],
        tasks: ['concat:js', 'uglify:js'],
        options: {
          livereload: true,
        }
      },
      css: {
        files: ['style.less'],
        tasks: ['less:style'],
        options: {
          livereload: true,
        }
      }
    }</pre></div></li><li class="listitem" value="7">Save the file, and then in a command prompt, change to the location of your theme.</li><li class="listitem" value="8">We now need to configure Grunt. Although we already have the basic application installed from <a class="calibre1" title="Chapter 2. Building a Less Development Toolkit" href="part0025_split_000.html#page">Chapter 2</a>, <span class="strong"><em class="calibre9">Building a Less Development Toolkit</em></span>, we still need to tell it what to do when changes to Less files are made. In the command prompt, run this command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">npm install</strong></span>
</pre></div></li><li class="listitem" value="9">The last step is to activate the <code class="email">watch</code> facility. Once Grunt has completed its changes from the previous step, go ahead and run this command at the prompt:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre8">grunt watch</strong></span>
</pre></div></li><li class="listitem" value="10">Remember the child theme we created earlier in this chapter? Go back to your child theme folder, then open up <code class="email">style.less</code>, and make a single change to a <a id="id680" class="calibre1"/>character within the style sheet.</li><li class="listitem" value="11">Save your work <a id="id681" class="calibre1"/>as you normally do. If all is well, Grunt watch will have picked up on the change and recompiled the style sheet file:<div class="mediaobject"><img src="../images/00099.jpeg" alt="Using Grunt in WordPress development" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre7">We can confirm this by checking back in our <code class="email">theme</code> folder, where the <code class="email">style.less</code> and <code class="email">style.css</code> files have the same date and time stamps:</p><div class="mediaobject"><img src="../images/00100.jpeg" alt="Using Grunt in WordPress development" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre7">Phew! That was a fair bit of code; let's take a moment to recap what we've achieved in this exercise.</p><p class="calibre7">If you've spent any time using Grunt as a task manager, then using the <code class="email">package.json</code> and <code class="email">gruntfile</code> files will be familiar to you; if not, where have you been? Grunt is fast becoming a de facto standard for automating thankless tasks such as compiling Less files; it is well worth getting to know Grunt!</p><p class="calibre7">In our exercise, we've configured Grunt to use a number of Node packages such as Less, watch, UglifyJS, and concat. In a nutshell, the Grunt and JSON package files tell Grunt how to compress and concatenate JavaScript or Less files (as set in the configuration); watch is set to run the tasks<a id="id682" class="calibre1"/> as soon as any changes are made to our source files.</p><p class="calibre7">Provided Grunt watch has kicked in and correctly recompiled our file, we're then free to continue making more<a id="id683" class="calibre1"/> changes. We can either use the Less file to dynamically compile our style sheet, as we saw earlier in the <span class="strong"><em class="calibre9">Adding support for Less in WordPress</em></span> section, or we can simply use the compiled file as a normal style sheet in our theme.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip17" class="calibre1"/>Tip</h3><p class="calibre7">There is a completed version of the <code class="email">gruntfile.js</code> file on GitHub, at <a class="calibre1" href="https://gist.github.com/alibby251/579e3c0308e3cd732b39">https://gist.github.com/alibby251/579e3c0308e3cd732b39</a>.</p></div></div></div>
<div class="book" title="Summary"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec84" class="calibre1"/>Summary</h1></div></div></div><p class="calibre7">Phew! We've covered a lot in this chapter! Let's take a moment to consider what we learned.</p><p class="calibre7">We kicked off our foray into using Less with WordPress with a quick recap of the structure of each WordPress theme, where we examined the basic files you will see within the TwentyFourteen core theme and covered the basics of what you need for each exercise in this chapter.</p><p class="calibre7">We then started our development work with a look at creating a child theme and the reasons for doing so; we then learned how to add Less support to your function file within the theme.</p><p class="calibre7">We took a quick sidestep to see how we can tailor the import for specific users; this will be useful if you are developing as an admin locally, while leaving others to use the compiled CSS style sheet file.</p><p class="calibre7">We then moved on and took a look at how to import Less using a plugin. We saw how in most cases, this would be preferred, but that in a plugin-heavy site, it might be wiser to simply import it using the <code class="email">functions.php</code> file.</p><p class="calibre7">We followed this with a detailed look at some tips on converting existing style sheets to use their Less equivalents. We covered the need to keep the process iterative due to the sheer size of some style sheets. We then took a brief look at creating your own theme using Less; we saw how you can use any prebuilt theme within Less if you are not feeling quite ready for developing your own!</p><p class="calibre7">We then finally rounded off our journey through Less and WordPress by taking a detailed look at how to automate the whole compilation process using Node.js and Grunt. While this initially might seem daunting, it will reward your efforts in spades with the time it saves in compiling Less files!</p><p class="calibre7">It's at this point we say goodbye to using WordPress. In our next chapter, we'll introduce another well-known product that uses Less: Twitter Bootstrap. Now who hasn't heard of Twitter, I wonder?</p></div></body></html>