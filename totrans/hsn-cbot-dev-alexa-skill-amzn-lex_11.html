<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Appendix B</h1>
                </header>
            
            <article>
                


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Debugging</h1>
                </header>
            
            <article>
                
<p>Trying to figure out why your code isn't working can be a very frustrating process and there can be loads of different sources of the issues. Throughout this book, we have three main sources of problems: Lambdas, Alexa Skill setup, and Lex setup.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Debugging Alexa Skills</h1>
                </header>
            
            <article>
                
<p>If your skill hasn't worked, then there are a few things that you need to check:</p>
<ul>
<li>You're using the correct utterances</li>
<li>Your model has been saved and built</li>
<li>Your endpoint is set correctly</li>
<li>You've added Alexa as a trigger for your Lambda</li>
<li>Your Lambda is working properly</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check the utterances</h1>
                </header>
            
            <article>
                
<p>If Alexa is replying with "Sorry, I don't know that one," make sure that you are saying or typing the correct phrase. It should be "Alexa, tell <em>your skill invocation</em> <em>your intent utterance,</em>" so it might be, "Alexa, tell my skill hello" or "Alexa, ask car helper what car I should get." Check that you've correctly set your skill invocation and intent utterances. You can add more utterances to your intent so that it works with a larger variety of phrases.</p>
<p>You can also add console logs to your handlers to make sure that they are getting triggered when you expect them to.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Save and build your model</h1>
                </header>
            
            <article>
                
<p>Check that you've saved and built your model; the <span class="packt_screen">Save Model</span> and <span class="packt_screen">Build Model</span> buttons should be gray, not blue. There is no harm in re-saving and rebuilding your model to make sure that everything is up to date.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check your Endpoint</h1>
                </header>
            
            <article>
                
<p>The last thing to check in the Alexa Skill Kit is that the <span class="packt_screen">Endpoint</span> is correctly set. Make sure that there is a long ARN code in the <span class="packt_screen">Default Region</span> box. If this isn't there, then open your Lambda console and find the Lambda that you want to be dealing with this skill. Copy the ARN number from the top right of the screen and paste it into the <span class="packt_screen">Default Region</span> box in the Alexa Skill Kit. It should have the format <kbd>arn:aws:lambda:your-region:123456789012:function:your-lambda-name</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Added Alexa as a trigger for your Lambda</h1>
                </header>
            
            <article>
                
<p>If your skill still isn't working, then there is probably a problem with your Lambda. In the Lambda editor, make sure that Alexa is on the design diagram exactly as shown next. If <span class="packt_screen">Alexa Skill Kit</span> is not in that diagram, select it from the list of triggers on the left and follow the setup steps explained earlier in the chapter:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-446 image-border" src="assets/2934c059-6b4a-4170-8458-0f62fd85e91c.png" style=""/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">A<span>lexa trigger</span></div>
<p>If the Alexa Skill Kit is shown but there is a message to complete configuration or something similar, then you need to do that. Click on the <span class="packt_screen">Alexa Skill Kit</span> symbol and complete the configuration, as explained earlier in the chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Debugging Lex chatbots</h1>
                </header>
            
            <article>
                
<p>As with Alexa skills, there are a few different places that can cause errors in your chatbot. Here are a few things you need to check:</p>
<ul>
<li>You are using the correct utterances</li>
<li>Your intent has a text response or is triggering the correct Lambda</li>
<li>Your intent has been saved and the chatbot built and deployed</li>
<li>Your connected platform is properly configured (Facebook, Slack, API)</li>
<li>Your Lambdas are working</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check your utterances</h1>
                </header>
            
            <article>
                
<p>If Lex is saying that it couldn't understand what you said, then it couldn't match your utterance to an intent. There are two ways this can happen: you don't have any sample utterances close enough to the utterance you used, or there are two sample utterances on different intents that match well. Having different intents with similar sample utterances can often cause issues.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check the intent response</h1>
                </header>
            
            <article>
                
<p>Your intent may be getting hit, but it isn't returning a response. In the intent, scroll down to <span class="packt_screen">Fulfillment</span> and make sure that either a Lambda is being invoked or you are replying with a text response. If you are invoking a Lambda, check the Lambda logs to see whether the Lambda is being run when you trigger that intent. If not, you may just need to save, build the chatbot, and deploy it again.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Save intents, build, and deploy</h1>
                </header>
            
            <article>
                
<p>If all of your sample utterances and fulfillments are correct, then you should make sure every intent is saved, build your chatbot, and deploy it to the same alias as before. It is very easy to forget this step and wonder why all of your changes haven't made any difference.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check your connected platform</h1>
                </header>
            
            <article>
                
<p>If you are trying to connect your chatbot to a platform such as Facebook, Slack, or your API, make sure that they are set up properly. If you can successfully test your chatbot in the Lex console, then go back through the setup processes for the platform and make sure that you haven't missed a step.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check your Lambdas are working</h1>
                </header>
            
            <article>
                
<p>Use the Lambda debugging tips to ensure that your Lambdas are responding with the correct responses.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Debugging Lambdas</h1>
                </header>
            
            <article>
                
<p>If you have found that the problem is not with your Alexa skill or Lex chatbot, there might be a problem with your Lambda. Before you start changing things in your code, it is often a good idea to create a test in the Lambda console. This should represent the request that is being sent by Alexa or Lex. Use this test to see whether it is your Lambda that is at fault or it works as expected.</p>
<p>If your test is unsuccessful, look in the logs for the error messages. This can often point you to the root of the problem.</p>
<p>Here are some things to check when trying to debug a Lambda:</p>
<ul>
<li>Your Lambda has all of the required packages installed</li>
<li>Your permissions are correct</li>
<li>All of your variables are correctly defined</li>
<li>Your Lambda code is correct</li>
<li>Everything your Lambda calls is working</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Install all of the required packages</h1>
                </header>
            
            <article>
                
<p>If your Lambda isn't working, you need to check that all the packages are installed. Go to your <kbd>Lambdas</kbd> folder and navigate to your problem Lambda. In it, there should be an <kbd>archive.zip</kbd> zipped file. If there isn't, run the build script again and an <kbd>archive.zip</kbd> file should appear <span>–</span> your Lambda should now work.</p>
<p>If there is an <kbd>archive.zip</kbd> file, open it and see what it contains. There should be an <kbd>index.js</kbd> file, a <kbd>package.json</kbd> or <kbd>package-lock.json</kbd> file, and a <kbd>node_modules</kbd> folder. If any of these things are missing, then rerun the build script and make sure that it succeeds.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>If all of that is correct, then check inside <kbd>package.json</kbd> or <kbd>package-lock.json</kbd> that there are dependencies for all of the packages that you are requiring in your Lambda code. Check that there is also a folder for each of the packages inside <kbd>node_modules</kbd>. If there isn't, you will need to run <kbd>npm install --save *PACKAGE-NAME*</kbd> to add it to the <kbd>package.json</kbd> file.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check your permissions</h1>
                </header>
            
            <article>
                
<p>Go into your Lambda, scroll down to the <span class="packt_screen">Execution role</span>, and see which role you have selected. Now, go to the <span class="packt_screen">IAM</span> service and select the role that you have used. Look through the policies that you have added to that role and make sure that you have all the permissions that you need. Add any policies that you need for the role.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Correct your Lambda code</h1>
                </header>
            
            <article>
                
<p>You also need to check that the code in your Lambda is correct. As your Lambdas become more complex, it becomes harder to get them working the first time. Run the tests that you've created, and look for the error message.</p>
<p>If you don't know what the error message means or how to fix it, search online as there will have been other people who have encountered this error before. Make sure you read the replies on how to fix the error and understand why that solution works before using it in your code. It helps you become a better developer and allows you to fix it if there is an error with it in the future.</p>
<p>If the bug isn't obvious from the error message, you can use <kbd>console.log('Some information')</kbd> to log out whenever your code gets to each stage. Use this to work out how far your code is getting and what values are available at that point. It can often be that variables or responses from other services are not in the format that you expected them to be in. Being able to see all of your data just before the error is really useful in finding out why your code isn't working.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Check external services</h1>
                </header>
            
            <article>
                
<p>When working with external services, there is always the possibility that those services stop working or change their response. Every time you deal with an external service, you should handle it, if it is returning an error. If the services appear to be working but your code is not working, then <kbd>console.log</kbd> out the response to check the format.</p>


            </article>

            
        </section>
    </body></html>