- en: Chapter 8. Waterfall, Funnel, Pyramid, and Heatmap Charts
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章：瀑布图、漏斗图、金字塔图和热力图图
- en: 'In this chapter, we explore some of the more unusual charts, such as waterfall
    and funnel charts, by using simple sales and accounting figures. We experiment
    with how we can link both the charts together with related information. Then,
    we move on to investigate how to plot a pyramid chart and assess the flexibility
    of Highcharts by imitating a financial pyramid chart from a proper commercial
    report. Finally, we study the heatmap chart and tweak various specific options
    with real-life statistics in a step-by-step approach. In this chapter, we will
    cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们通过使用简单的销售和会计数据，探索了一些不太常见的图表，例如瀑布图和漏斗图。我们实验了如何将这两个图表与相关信息链接起来。然后，我们继续研究如何绘制金字塔图，并通过模仿一份合适的商业报告中的金融金字塔图来评估Highcharts的灵活性。最后，我们以逐步的方法研究热力图图，并使用现实生活中的统计数据调整各种特定选项。在本章中，我们将涵盖以下主题：
- en: Constructing a waterfall chart
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建瀑布图
- en: Making a funnel chart
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 制作漏斗图
- en: Joining both waterfall and funnel charts
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将瀑布图和漏斗图结合使用
- en: Plotting a commercial pyramid chart
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 绘制商业金字塔图
- en: Exploring a heatmap chart with inflation data
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 探索带有通货膨胀数据的热力图图
- en: Experimenting with the dataClasses and nullColor options of a heatmap chart
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试热力图图的数据类和nullColor选项
- en: Constructing a waterfall chart
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建瀑布图
- en: A waterfall chart is a type of column chart where the positive and negative
    values are accumulated along the *x* axis categories. The start and end of adjacent
    columns are aligned on the same level, with columns going up or down depending
    on the values. They are mainly used to present cash flow at a higher level.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 瀑布图是一种柱状图类型，其中正负值沿*x*轴类别累积。相邻列的起始和结束对齐在同一水平上，列的上升或下降取决于值。它们主要用于在较高层次上展示现金流。
- en: 'To use a waterfall chart, the `highcharts-more.js` library must be included:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用瀑布图，必须包含`highcharts-more.js`库：
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Let''s start with a simple waterfall, with a couple of values for income and
    expenditure. The following is the series configuration:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们从简单的瀑布图开始，其中包含一些收入和支出的值。以下系列配置如下：
- en: '[PRE1]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: First, we specify the series `type` as `waterfall`, then assign a color value
    (blue) to the `upColor` option, which sets the default color for any columns with
    positive values. In the next line, we declare another color value (red) which
    is for columns with negative values. The data point entries are the same as a
    normal column chart, except those columns representing the total sum so far. These
    columns are specified with the `isIntermediateSum` and `isSum` Boolean options
    without *y* axis values. The waterfall chart will display those as accumulated
    columns. We specify the accumulated columns with another color since they are
    neither income nor expenditure.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将系列`type`指定为`waterfall`，然后为`upColor`选项分配一个颜色值（蓝色），这将设置任何正值列的默认颜色。在下一行，我们声明另一个颜色值（红色），这是用于负值列的颜色。数据点条目与普通柱状图相同，除了表示到目前为止的总和的列。这些列使用`isIntermediateSum`和`isSum`布尔选项指定，没有`y`轴值。瀑布图将显示这些为累积列。我们使用另一种颜色指定累积列，因为它们既不是收入也不是支出。
- en: 'Finally, we need to enable the data labels to show the value flow, which is
    the sole purpose of a waterfall chart. The following is the `plotOptions` setting
    with the data label styling and formatting:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们需要启用数据标签以显示价值流动，这是瀑布图的主要目的。以下是与数据标签样式和格式相关的`plotOptions`设置：
- en: '[PRE2]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Here is a screenshot of the waterfall chart:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是瀑布图的截图：
- en: '![Constructing a waterfall chart](img/7451OS_08_01.jpg)'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![构建瀑布图](img/7451OS_08_01.jpg)'
- en: Making a horizontal waterfall chart
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 制作水平瀑布图
- en: 'Let''s assume that we need to plot a slightly more complicated waterfall chart,
    as we have a few more figures for revenue, expenses, and expenditure plans. Moreover,
    we need to display multiple stages of accumulated income. Instead of having a
    traditional waterfall chart with vertical columns, we declare the `inverted` option
    to switch the columns to horizontal. Since the columns are more compacted, the
    data labels may not fit inside the columns. Therefore, we put the data labels
    at the end of the columns. Here is a summary of the changes:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们需要绘制一个稍微复杂一些的瀑布图，因为我们有更多关于收入、支出和支出计划的图表。此外，我们还需要显示累积收入的多个阶段。与传统瀑布图中的垂直列不同，我们声明了`inverted`选项来将列切换为水平。由于列更加紧凑，数据标签可能无法放在列内。因此，我们将数据标签放在列的末尾。以下是变更的总结：
- en: '[PRE3]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The following is the new look of the waterfall chart:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是新外观的瀑布图：
- en: '![Making a horizontal waterfall chart](img/7451OS_08_02.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![制作水平瀑布图](img/7451OS_08_02.jpg)'
- en: Constructing a funnel chart
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建漏斗图
- en: As the name implies, the shape of a funnel chart is that of a funnel. A funnel
    chart is another way of showing how data flows in a diminished fashion. For example,
    it can be used to show the stages from the number of sale leads, demos, and meetings
    to actual sales, or the number of job applicants that pass through exams, interviews,
    and an offer to actual acceptance.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如其名所示，漏斗图的形状就像漏斗。漏斗图是另一种以递减方式展示数据流动的方式。例如，它可以用来展示从销售线索数量、演示和会议到实际销售的阶段，或者通过考试、面试和接受实际工作邀请的求职者数量。
- en: 'The funnel chart is packaged as a separate module which needs to include the
    JavaScript file as follows:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 漏斗图作为一个独立的模块打包，需要包含以下JavaScript文件：
- en: '[PRE4]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'In this funnel chart example, we will plot a product starting from web visits
    and leading to product sales. Here is the series configuration:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个漏斗图示例中，我们将从网站访问开始，追踪到产品销售。以下是系列配置：
- en: '[PRE5]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Apart from the series type option, Highcharts simply draws the set of data
    points in a funnel shape configuration. We use the `neckWidth` option to control
    the width of the narrow part of the funnel as a ration of the plot area. The same
    applies to the `width` and `height` options. Here is a screenshot illustrating
    this:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 除了系列类型选项外，Highcharts简单地以漏斗形状配置绘制一组数据点。我们使用`neckWidth`选项来控制漏斗狭窄部分的宽度，作为绘图区域的比率。同样适用于`width`和`height`选项。以下是说明这一点的屏幕截图：
- en: '![Constructing a funnel chart](img/7451OS_08_03.jpg)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![构建漏斗图](img/7451OS_08_03.jpg)'
- en: Joining both waterfall and funnel charts
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 结合瀑布图和漏斗图
- en: So far, we have explored both waterfall and funnel charts. Both types of chart
    have been used in sales data. In this section, we are going to join the previous
    waterfall and funnel examples together, so that when the client clicks on a horizontal
    bar (let's say **Product B sales**), the waterfall chart is zoomed into the funnel
    chart to show the prospect ratio of the product. To achieve that, we use the drilldown
    feature (described and demonstrated in [Chapter 2](ch02.html "Chapter 2. Highcharts
    Configurations"), *Highcharts Configurations*).
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经探讨了瀑布图和漏斗图。这两种图表都已在销售数据中使用。在本节中，我们将结合先前的瀑布图和漏斗图示例，以便当客户点击水平条（比如说**产品B销售**）时，瀑布图将缩放到漏斗图以显示产品的潜在比率。为了实现这一点，我们使用钻取功能（在第2章中描述和演示，*Highcharts配置*）。
- en: 'First, we set the data point with a drilldown identifier, like `productB`.
    Then, we import the whole funnel series configuration from the previous example
    into the drilldown option with the matching `id` value. Finally, we relocate the
    drill up back button to the bottom of the screen. The final change should be as
    follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们设置一个带有钻取标识符的数据点，例如`productB`。然后，我们将前一个示例中的整个漏斗系列配置导入钻取选项中，匹配`id`值。最后，我们将钻取回退按钮移至屏幕底部。最终更改应如下所示：
- en: '[PRE6]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now, we have a fully interactive chart, from a revenue breakdown waterfall
    chart to the product prospect funnel chart. The following is the waterfall chart
    with the drilldown:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有一个完全交互式的图表，从收入分解瀑布图到产品前景漏斗图。以下是一个带有钻取功能的瀑布图：
- en: '![Joining both waterfall and funnel charts](img/7451OS_08_05.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![结合瀑布图和漏斗图](img/7451OS_08_05.jpg)'
- en: 'Clicking on the **product B sales** column, the chart transforms to a funnel
    to dissect the sales from product activities:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**产品B销售**列，图表将转换为漏斗图以分析产品活动的销售：
- en: '![Joining both waterfall and funnel charts](img/7451OS_08_04.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![结合瀑布图和漏斗图](img/7451OS_08_04.jpg)'
- en: Plotting a commercial pyramid chart
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 绘制商业金字塔图
- en: A pyramid chart is the inverse of a funnel chart, but in a pyramid shape, generally
    used for representing a top-down hierarchical ordering of data. Since this is
    a part of the funnel chart module, `funnel.js` is required.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 金字塔图是漏斗图的倒数，但形状为金字塔，通常用于表示数据的自上而下的层次排序。由于这是漏斗图模块的一部分，需要`funnel.js`。
- en: 'The default order for data entries is that the last entry in the series data
    array is shown at the top of the pyramid. This can be corrected by switching the
    `reverse` option to false. Let''s take a real-life example for this exercise.
    The following is a picture of the Global Wealth Pyramid chart taken from the Credit
    Suisse Global Wealth Databook 2013:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 数据条目默认顺序是系列数据数组中的最后一个条目显示在金字塔的顶部。这可以通过将`reverse`选项切换为false来纠正。让我们用一个现实生活中的例子来做这个练习。以下是从2013年瑞士信贷全球财富数据手册中摘取的全球财富金字塔图表的图片：
- en: '![Plotting a commercial pyramid chart](img/7451OS_08_06.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![绘制商业金字塔图表](img/7451OS_08_06.jpg)'
- en: 'As we can see, it looks stylish with data labels along each side as well as
    in the middle. Let''s make an initial attempt to reproduce the chart:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，在每一边以及中间都有数据标签，看起来非常时尚。让我们尝试一下重现这个图表：
- en: '[PRE7]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'First, we move the title and credits to the top-left corner. Then, we copy
    the color and percentage values into the series, which gives us the following
    chart:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将标题和版权信息移动到左上角。然后，我们将颜色和百分比值复制到系列中，这样就得到了以下图表：
- en: '![Plotting a commercial pyramid chart](img/7451OS_08_07.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![绘制商业金字塔图表](img/7451OS_08_07.jpg)'
- en: 'There are two main problems when compared to the original: the scale of each
    layer is wrong and the data labels are either missing or in the wrong place. As
    we can see, the reality is that the rich population is actually much smaller than
    the original chart showed, amusingly a single pixel. In the next section, we are
    going to see how far we can push Highcharts to make the financial chart.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 与原始图表相比，有两个主要问题：每一层的比例是错误的，数据标签要么缺失，要么位置不正确。正如我们所见，现实是富裕人口实际上比原始图表显示的要小得多，有趣的是只有一个像素。在下一节中，我们将看到我们可以将Highcharts推进多远，以制作财务图表。
- en: Plotting an advanced pyramid chart
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 绘制高级金字塔图表
- en: Let face it. The layers in the original chart do not reflect their true percentage,
    proved in the previous chart. So we need to rig the ratio values to make them
    similar to the original chart. Secondly, the repositioning of data labels is limited
    in a pyramid chart. The only way to move the data label into the center of each
    layer of a pyramid chart is to disable the connectors and gradually adjust the
    `distance` option in `plotOptions.pyramid.dataLabels`. However, this only allows
    us a single label per data layer and we can only apply the same positional settings
    to all the labels.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们面对现实。原始图表中的层并没有反映它们的真实百分比，这在之前的图表中已经证明。因此，我们需要调整比例值，使它们与原始图表相似。其次，在金字塔图表中，数据标签的重新定位是有限的。将数据标签移动到金字塔每一层中心的唯一方法是不启用连接线，并逐渐调整`plotOptions.pyramid.dataLabels`中的`distance`选项。然而，这仅允许我们每个数据层有一个标签，并且我们只能将相同的定位设置应用于所有标签。
- en: So how can we put extra data labels along each side of the layer and the titles
    along the bottom of the pyramid? The answer (after hours of trial and error) is
    to use multiple y axes and `plotLines`. The idea is to have three y axes to put
    data labels on the left, center, and right side of the pyramid. Then, we hide
    all the y axes' interval lines and their labels. We place the y axis title at
    the bottom of the axis line with no rotation, we only rotate for the left (**Wealth**)
    and right (**Total Wealth**) axes.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，我们如何将额外的数据标签放在每一层的两侧以及金字塔底部的标题呢？答案是（经过数小时的尝试和错误）使用多个y轴和`plotLines`。想法是拥有三个y轴，将数据标签放在金字塔的左侧、中心和右侧。然后，我们隐藏所有y轴的间隔线和它们的标签。我们将y轴标题放置在轴线的底部，不旋转，我们只为左侧（**财富**）和右侧（**总财富**）轴旋转。
- en: 'We disable the remaining y axis title. The trick is to use the x axis title
    instead for the center label (**Number of adults**), because it sits on top of
    the pyramid. Here is the code snippet for the configuration of these axes:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们禁用了剩余的y轴标题。技巧是使用x轴标题代替中心标签（**成人数量**），因为它位于金字塔的顶部。以下是配置这些轴的代码片段：
- en: '[PRE8]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The following screenshot demonstrates the titles aligned at the base of pyramid
    chart:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图展示了金字塔图表底部对齐的标题：
- en: '![Plotting an advanced pyramid chart](img/7451OS_08_08.jpg)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![绘制高级金字塔图表](img/7451OS_08_08.jpg)'
- en: 'The next part is to simply create a `plotLine` for each y-axis in each layer
    of the pyramid and set the label for these `plotLines`. Since we know the data
    value range of each pyramid layer, we can set the same `y` value for `plotLines`
    across all the y axes to display the labels on the same level. Here is an example
    of a `plotLines` option for the left y-axis:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是简单地为金字塔每一层的每个y轴创建一个`plotLine`，并为这些`plotLines`设置标签。由于我们知道每个金字塔层的数值范围，我们可以为所有y轴上的`plotLines`设置相同的`y`值，以便在相同级别上显示标签。以下是左y轴的`plotLines`选项示例：
- en: '[PRE9]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'We do the same for the center labels instead of using the points'' data labels.
    Note that the x position here caters for the data in this chart. If the graph
    has dynamic data, a new x position must be calculated to fit the new data. Here
    is the final look in Highcharts:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 我们对中心标签也这样做，而不是使用点的数据标签。请注意，这里的x位置是为了适应图表中的数据。如果图表有动态数据，必须计算新的x位置以适应新的数据。以下是Highcharts中的最终外观：
- en: '![Plotting an advanced pyramid chart](img/7451OS_08_09.jpg)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![绘制高级金字塔图表](img/7451OS_08_09.jpg)'
- en: Exploring a heatmap chart with inflation data
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 探索带有通货膨胀数据的热力图图表
- en: 'Heatmap is the latest chart addition in Highcharts 4\. As its name implies,
    the data values are represented in temperature colors, where the data is arranged
    in a grid-based layout, so the chart expresses three-dimensional data. The heatmap
    appeals to some readers because of the instant awareness of the data trend it
    generates, as temperature is one of the most natural things to sense. The chart
    is generally used for demonstrating climate data, but it has been used for other
    purposes. Let''s explore the heatmap chart with some real-life data. Here, we
    use it to show the inflation of various countries, as in this example in the Wall
    Street Journal ([http://blogs.wsj.com/economics/2011/01/27/feeling-the-heat-comparing-global-inflation/](http://blogs.wsj.com/economics/2011/01/27/feeling-the-heat-comparing-global-inflation/)):'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 热力图是Highcharts 4中的最新图表添加。正如其名所示，数据值以温度颜色表示，数据按网格布局排列，因此图表表达了三维数据。热力图因其产生的数据趋势的即时感知而受到一些读者的喜爱，因为温度是最自然的感觉之一。该图表通常用于展示气候数据，但它也被用于其他目的。让我们用一些真实数据来探索热力图图表。在这里，我们用它来展示各国通货膨胀的情况，如华尔街日报中的这个例子所示（[http://blogs.wsj.com/economics/2011/01/27/feeling-the-heat-comparing-global-inflation/](http://blogs.wsj.com/economics/2011/01/27/feeling-the-heat-comparing-global-inflation/))：
- en: '![Exploring a heatmap chart with inflation data](img/7451OS_08_10.jpg)'
  id: totrans-62
  prefs: []
  type: TYPE_IMG
  zh: '![探索带有通货膨胀数据的热力图图表](img/7451OS_08_10.jpg)'
- en: 'In Highcharts, the heatmap module was released as part of the Highmaps extension,
    which can be used as part of Highmaps or as a module of Highcharts. In order to
    load a heatmap as a Highcharts module, it includes the following library:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在Highcharts中，热力图模块作为Highmaps扩展的一部分发布，它可以作为Highmaps的一部分使用，也可以作为Highcharts的一个模块。为了将热力图作为Highcharts模块加载，它包括以下库：
- en: '[PRE10]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'First, the months are sketched along the y axis, whereas the x axis holds the
    country names. So we need to invert the chart:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，月份被绘制在y轴上，而x轴持有国家名称。因此，我们需要反转图表：
- en: '[PRE11]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The next step is to set both x and y axes as categories with specific labels.
    Then, we set the x axis without interval lines. As for the y axis, we position
    the labels at the top of the cells by assigning the opposite option to true and
    including an offset distance to make sure the axis lines are not too close:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将x轴和y轴都设置为具有特定标签的分类轴。然后，我们设置x轴没有间隔线。至于y轴，我们将标签定位在单元格的顶部，通过将相反的选项设置为true并包含一个偏移距离，以确保轴线不会太靠近：
- en: '[PRE12]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'There is one more axis that we need to configure, `colorAxis` (see [http://api.highcharts.com/highmaps](http://api.highcharts.com/highmaps)),
    which is specific to heatmap charts and Highmaps. The `colorAxis` option is similar
    to `x/yAxis`, which shares a number of options with it. The major difference is
    that `colorAxis` is the definition in mapping between the color and value. There
    are two ways to define color mapping: discrete and linear color range.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要配置一个额外的轴，即`colorAxis`（参见[http://api.highcharts.com/highmaps](http://api.highcharts.com/highmaps)），这是热力图图表和Highmaps特有的。`colorAxis`选项类似于`x/yAxis`，与它共享许多选项。主要区别在于`colorAxis`是在颜色与值之间的映射定义。有两种方式来定义颜色映射：离散和线性颜色范围。
- en: 'In this example, we demonstrate how to define multiple linear color ranges.
    As we can see, the inflation example has an asymmetric color scale, so that it
    ranges from -6.6 percent to 36 percent, but notice that the color between -0.1
    percent and 0.1 percent is gray. In order to imitate the color scale closely,
    we use the `stops` option to define fragments of discrete spectrums. The `stops`
    option takes an array of tuples of ratio range and color, and we transform the
    inflation and color values from the example into a number of ratios (we take the
    range from -1 percent to 30 percent instead because of the subset samples):'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们演示了如何定义多个线性颜色范围。正如我们所见，通货膨胀示例具有非对称的颜色刻度，因此范围从-6.6%到36%，但请注意，-0.1%到0.1%之间的颜色是灰色。为了更接近地模仿颜色刻度，我们使用`stops`选项来定义离散光谱的片段。`stops`选项接受一个包含比例范围和颜色的元组数组，我们将通货膨胀和颜色值从示例转换为多个比例（我们选择从-1%到30%的范围，因为子集样本的原因）：
- en: '[PRE13]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Additionally, we replicate the title (top-left), color scale legend (top-right),
    and credits (bottom-right) as in the original chart, with the following configurations:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们按照原始图表复制了标题（左上角）、颜色刻度图例（右上角）和致谢（右下角），以下为配置信息：
- en: '[PRE14]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The final step is to define the three-dimensional data and switch the `dataLabels`
    option on:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一步是定义三维数据和开启`dataLabels`选项：
- en: '[PRE15]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Here is the display:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 这是显示效果：
- en: '![Exploring a heatmap chart with inflation data](img/7451OS_08_11.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![探索带有通货膨胀数据的热图图表](img/7451OS_08_11.jpg)'
- en: Experimenting with dataClasses and nullColor options in a heatmap
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在热图中尝试使用dataClasses和nullColor选项
- en: 'An alternative way to define the color axis is to have a specific range of
    values associated with a color. Let''s plot another heatmap chart. In this example,
    we reconstruct a graph taken from [http://kindofnormal.com/truthfacts](http://kindofnormal.com/truthfacts),
    shown here:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 定义颜色轴的另一种方法是让特定范围的值与颜色相关联。让我们绘制另一个热图图表。在本例中，我们重构了一个从[http://kindofnormal.com/truthfacts](http://kindofnormal.com/truthfacts)获取的图表，如下所示：
- en: '![Experimenting with dataClasses and nullColor options in a heatmap](img/7451OS_08_12.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![在热图中尝试使用dataClasses和nullColor选项](img/7451OS_08_12.jpg)'
- en: 'To recreate the preceding chart, we first use an inverted heatmap to emulate
    it as a bar chart, but the bars itself are composed of cells with a gradual change
    of color. We treat each block as a unit of y axis value and every two intervals
    associates with a color value. Hence, the range along the y-axis is between 0
    and 8\. Here is the trimmed configuration:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 为了重新创建前面的图表，我们首先使用倒置的热图来模拟它作为一个条形图，但条本身是由颜色逐渐变化的单元格组成。我们将每个块视为y轴值的单位，并且每个两个间隔与一个颜色值相关联。因此，y轴的范围在0到8之间。以下是修剪后的配置：
- en: '[PRE16]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Then, we specify the `colorAxis` with `dataClasses` options which divide the
    value range into four groups of color:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用`dataClasses`选项指定`colorAxis`，将值范围分为四个颜色组：
- en: '[PRE17]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'In order to make the bar appear as being composed of multiple blocks, we set
    the border width and the border color the same as the chart background color:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使条形看起来由多个块组成，我们将边框宽度和边框颜色设置为与图表背景颜色相同：
- en: '[PRE18]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Notice that there is a `nullColor` option; this is to set the color for a data
    point with null value. We assign the null data point the same color as the background.
    We will see later what this null color can do in a heatmap.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 注意到有一个`nullColor`选项；这是为了设置具有null值的点的颜色。我们将null数据点分配与背景相同的颜色。我们将在稍后看到这种null颜色在热图中能做什么。
- en: 'In heatmaps, unlike column charts, we can specify the distance and grouping
    between columns. The only way to have a gap between categories is to fake it,
    hence a category with an empty title:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在热图中，与柱状图不同，我们可以指定列之间的距离和分组。要在类别之间有间隔，唯一的方法是伪造它，因此一个带有空标题的类别：
- en: '[PRE19]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Since we are emulating a bar chart in which the change of color values correlate
    to y-axis values, the z-value is the same as the y-value. Here is the series data
    configuration for **Food** and **Water** categories:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们正在模拟一个颜色值变化与y轴值相关的条形图，z值与y值相同。以下是**食品**和**水**类别的系列数据配置：
- en: '[PRE20]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The first group of data points have zero values on the inverted x axis which
    is the index to the categories—**Food**. The group has a full range of eight data
    points. The next has a group of six data points (value two on the x axis because
    of the dummy category, see `xAxis.categories` in preceding code) which corresponds
    to six blocks in the **Water** category.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 第一组数据点在倒置的x轴上为零值，这是类别——**食品**的索引。该组有八个数据点的完整范围。接下来是六个数据点的组（由于虚拟类别，x轴上的值为二），这对应于**水**类别中的六个块。
- en: 'For the sake of demonstrating how `nullColor` works, instead of displaying
    a block of cells as in the original chart, let''s change it slightly to have a
    fraction unit of cells. In the **Sleep** and **Internet** categories, we are going
    to change the values to 1.5 and 0.25 respectively. The trick to displaying a heatmap
    cell that is not in a full block is to use the `nullColor` option, that is, a
    fraction of the unit value is assigned to null and the color for the null value
    is the same as the chart background color to "hide" the rest of the unit:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示`nullColor`的工作原理，我们不是像原始图表那样显示一个单元格块，而是稍微改变一下，使其具有分数单位的单元格。在**睡眠**和**互联网**类别中，我们将值分别改为1.5和0.25。显示不是完整块的单元格的热力图的小技巧是使用`nullColor`选项，即分配给null的单元值的一部分，null值的颜色与图表背景颜色相同，以“隐藏”其余的单元：
- en: '[PRE21]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Here is a screenshot of the reproduction in Highcharts:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是Highcharts中复制的截图：
- en: '![Experimenting with dataClasses and nullColor options in a heatmap](img/7451OS_08_13.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![在热力图中尝试dataClasses和nullColor选项](img/7451OS_08_13.jpg)'
- en: Summary
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we have learned how to plot waterfall and funnel charts with
    fabricated sales data. We familiarized ourselves with and tested the flexibilities
    of Highcharts by reconstructing a pyramid chart from a financial report. We examined
    the construction of a heatmap chart and studied the color axis property with different
    examples.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了如何使用虚构的销售数据绘制瀑布图和漏斗图。我们通过从财务报告中重建金字塔图来熟悉并测试了Highcharts的灵活性。我们检查了热力图图表的构建，并通过不同的示例研究了颜色轴属性。
- en: In the next chapter, we will investigate that long-awaited Highcharts feature,
    3D charts. We will explore how to apply 3D orientation on charts and plot a gallery
    of various series charts in 3D.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将探讨那个备受期待的高图表功能——3D图表。我们将探讨如何在图表上应用3D方向，并绘制一系列3D系列图表的画廊。
