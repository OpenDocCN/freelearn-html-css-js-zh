<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Building the App"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Building the App</h1></div></div></div><p>In the past few chapters we have learned what JavaScriptMVC is, how to install it, and we went through its components.</p><p>Now is the time for the most exciting chapter for any developer. We are going to build a real-world application. Due to the book's scope limitation we are not going to write backend API set-up servers, and so on, instead of we will use browser storage.</p><p>Thanks to layer separation in JavaScriptMVC this is easily done by changing the code in the model to switch the application persistent layer from browser storage option to any backend language, framework, or system such as Sinatra, Ruby on Rails, Django, and Node.js.</p><p>This chapter's goal is to show how to build a real-word application from concept through design, implementation, documentation, and testing. We will develop an application that actually does something, is useful for readers, and can be easily customized to the reader's needs.</p><div class="section" title="Time tracking and invoicing for freelancers"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec38"/>Time tracking and invoicing for freelancers</h1></div></div></div><p>The app we are going to build in this <a id="id264" class="indexterm"/>chapter is called Time tracking and invoicing for freelancers; let's call it TTI in short.</p><p>Application development will only start here. We are not going to write the complete code base, it will be simply too big to fit it here. It's like a homework exercise, when students start their writing application at university and finish them at home. Be creative!</p><div class="section" title="Planning"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec44"/>Planning</h2></div></div></div><p>Okay, so we are going to write an <a id="id265" class="indexterm"/>application. Now it's time to answer the most important question: <span class="emphasis"><em>What problem is our application is about to solve?</em></span></p><p>We can clearly identify two main application areas:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Tracking time we spend on a task</li><li class="listitem" style="list-style-type: disc">Making an invoice</li></ul></div><p>Let's break down our <a id="id266" class="indexterm"/>application's main areas into a features list as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Clients list</li><li class="listitem" style="list-style-type: disc">Time tracker<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Track time</li><li class="listitem" style="list-style-type: disc">Fixed cost task</li></ul></div></li><li class="listitem" style="list-style-type: disc">Reports<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Daily</li><li class="listitem" style="list-style-type: disc">Weekly</li></ul></div></li><li class="listitem" style="list-style-type: disc">Statistics<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Monthly</li><li class="listitem" style="list-style-type: disc">Yearly</li></ul></div></li><li class="listitem" style="list-style-type: disc">Invoicing</li><li class="listitem" style="list-style-type: disc">Export and import data</li></ul></div><p>A features list will help us make a development plan. Now we can think about how much time we need to accomplish for each of them. We can use just a calendar to write down our estimates or use one of many the <a id="id267" class="indexterm"/>free issue-tracking tools such as <a class="ulink" href="https://trello.com/">https://trello.com/</a> or <a class="ulink" href="http://trac.edgewall.org/">http://trac.edgewall.org/</a>.</p><p>The ideal solution would be to use a methodology such as <a id="id268" class="indexterm"/>Scrum—<a class="ulink" href="http://en.wikipedia.org/wiki/Scrum_(development)">http://en.wikipedia.org/wiki/Scrum_(development)</a> or one of the best issue-tracking tools in the business, JIRA—<a class="ulink" href="http://en.wikipedia.org/wiki/JIRA">http://en.wikipedia.org/wiki/JIRA</a>.</p></div><div class="section" title="Preparing wireframes"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec45"/>Preparing wireframes</h2></div></div></div><p>The next step is preparing <a id="id269" class="indexterm"/>application wireframes. This is a very important step in the application development cycle. It allows us to quickly sketch the application <a id="id270" class="indexterm"/>interface for different pages as well as very fast redesign pages and saves time in future development. Once we start writing the code, any changes will be harder and less cost efficient than changing wireframes.</p><p>The next steps are creating mockups and prototypes. However, we do not have a graphic designer here and no client to show business logic and finally it's out of this book's scope, so we are going straight to the next step.</p><p><span class="strong"><strong>Wireframes</strong></span> are generally basic sketches of components used in the application to show user interface and application features.</p><p><span class="strong"><strong>Mockups</strong></span> are the <a id="id271" class="indexterm"/>next level of wireframes, basically containing all we can find on wireframes but were in the actual design.</p><p><span class="strong"><strong>Prototypes</strong></span> are semi-functional <a id="id272" class="indexterm"/>applications to present business logic.</p><p>We can create wireframes by using <a id="id273" class="indexterm"/>just a piece of paper and pencil; a lot of people prefer this way. There is a bunch of different software that can help us in this step. I'll use Balsamiq Mockups but really any tool will be good here.</p><p>To give us a better overview on TTI application let's have a look at wireframes:</p><p>Since this book orientation is portrait and web browsers orientation are landscape, the reader is asked to have a look at following the wireframes from a different perspective.</p><p>The following wireframe shows the time tracker main page.</p><p>The main menu is located at the <a id="id274" class="indexterm"/>top-left corner and allows us to switch between the main application functionalities.</p><p>Breadcrumb is <a id="id275" class="indexterm"/>located at the top center and allows us to easily indicate which part of the appllication we are currently in.</p><p><span class="strong"><strong>Settings</strong></span> and <span class="strong"><strong>Export/Import Data</strong></span> tabs go on the top-right corner.</p><p><span class="strong"><strong>Time Tracker</strong></span> is located in the center with two main tabs: <span class="strong"><strong>Active Tasks</strong></span> and <span class="strong"><strong>Archive Tasks</strong></span>. Each task has fields: <span class="strong"><strong>Hours</strong></span>, <span class="strong"><strong>Cost</strong></span>, <span class="strong"><strong>Task ID</strong></span>, <span class="strong"><strong>Description</strong></span>, and <span class="strong"><strong>Notes</strong></span>. The <span class="strong"><strong>Add New Task</strong></span> button is located at the bottom that allows us to add a new task. <span class="strong"><strong>Archive</strong></span> button is visible when task is hovered. To edit a task double-click on it. The URL for the time tracker page is <code class="literal">/timetracker</code>.</p><div class="mediaobject"><img src="graphics/0205OS_06_01.jpg" alt="Preparing wireframes"/></div><p>The following wireframe shows <a id="id276" class="indexterm"/>the <a id="id277" class="indexterm"/>invoice main page. The URL is <code class="literal">/invoice</code>:</p><div class="mediaobject"><img src="graphics/0205OS_06_02.jpg" alt="Preparing wireframes"/></div><p>The following wireframe <a id="id278" class="indexterm"/>shows the <a id="id279" class="indexterm"/>clients main page. The URL is <code class="literal">/clients</code>.</p><div class="mediaobject"><img src="graphics/0205OS_06_03.jpg" alt="Preparing wireframes"/></div></div><div class="section" title="Setup project"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec46"/>Setup project</h2></div></div></div><p>We are assuming that the reader has <a id="id280" class="indexterm"/>installed a web server, such as Apache or Nginx. In the server-working directory we need to create the <code class="literal">TTI</code> folder. Another option is to use the Vagrant-powered environment created especially for this book available at <a class="ulink" href="https://github.com/wbednarski/JavaScriptMVC_kick-starter">https://github.com/wbednarski/JavaScriptMVC_kick-starter</a>.</p><p>In this folder we will initialize the Git repository to track all changes, install JavaScriptMVC, and create the application structure.</p><div class="section" title="Tracking changes under VCS"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec25"/>Tracking changes under VCS</h3></div></div></div><p>It's a good idea from the very beginning to keep all the project files under the version control system. The reason for that is very simple and beneficial for future development—we can easily revert any changes and track them.</p><p>Using decentralized VCS has an invaluable benefit over centralized VCS, because we can commit changes without push, so we can commit often even after a small change in the codebase. Another good practice is to use one branch per feature.</p><p>In this book we are going to use Git, but actually any <a id="id281" class="indexterm"/>
<span class="strong"><strong>Distributed Version Control Systems</strong></span> (<span class="strong"><strong>DVCS</strong></span>) is good. Mercurial is another popular DVCS.</p><p>The following steps should be performed to create a new Git repository, add all the files, and commit them:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Inside the <code class="literal">TTI</code> directory, type to install JavaScriptMVC:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git init</strong></span>
<span class="strong"><strong>$ git submodule add git://github.com/jupiterjs/steal.git</strong></span>
<span class="strong"><strong>$ git submodule add git://github.com/jupiterjs/documentjs.git</strong></span>
<span class="strong"><strong>$ git submodule add git://github.com/jupiterjs/funcunit.git</strong></span>
<span class="strong"><strong>$ git submodule add git://github.com/jupiterjs/jquerymx.git jquery</strong></span>
</pre></div></li><li class="listitem">Install and update JavaScriptMVC submodules using the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git submodule init</strong></span>
<span class="strong"><strong>$ git submodule update</strong></span>
</pre></div></li><li class="listitem">Install Syn using the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd funcunit</strong></span>
<span class="strong"><strong>$ git submodule init</strong></span>
<span class="strong"><strong>$ git submodule update</strong></span>
</pre></div></li><li class="listitem">Move the <code class="literal">js</code> command to the project's root directory (run from root directory):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ ./steal/js steal/make.js</strong></span>
</pre></div><p>By default all the repositories are on a master branch. Let's switch to the latest version of JavaScriptMVC, which is 3.2.2 at the time this book was written.</p></li><li class="listitem">In all the submodules <a id="id282" class="indexterm"/>directories, type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git checkout v3.2.2</strong></span>
</pre></div></li><li class="listitem">In the <code class="literal">TTI</code> directory create our application directory <code class="literal">tti</code> and add it under Git.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mkdir tti</strong></span>
<span class="strong"><strong>$ git add .</strong></span>
<span class="strong"><strong>$ git commit -m "initial commit"</strong></span>
</pre></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>If the reader wants to keep the codebase copy on the server, they can do this using the free code hosting <a id="id283" class="indexterm"/>solutions available at <a class="ulink" href="https://github.com">https://github.com</a> or <a class="ulink" href="https://bitbucket.org">https://bitbucket.org</a>.</p></div></div><p>All the code we are going to develop will be placed in the <code class="literal">tti</code> folder.</p></div><div class="section" title="Application structure"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec26"/>Application structure</h3></div></div></div><p>Our application structure will <a id="id284" class="indexterm"/>look similar to the following hierarchy:</p><div class="informalexample"><pre class="programlisting">TTI/
   |
   |tti/
   |   |controllers/
   |   |
   |   |docs/
   |   |
   |   |models/
   |   |
   |   |tests/
   |   |     |unit/
   |   |     |    |models/
   |   |     | 
   |   |     |functional/
   |   |
   |   |views/
   |         |styles/
   |         |      |css/
   |         |      |
   |         |      |sass/
   |         |
   |         |templates/
   |                   |tasks
   |                   |
   |                   |clients
   |
   |vendors/
           |jquery_ui/
           |
           |pouchdb/</pre></div></div></div><div class="section" title="IndexedDB"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec47"/>IndexedDB</h2></div></div></div><p>Since local storage is too simple for our <a id="id285" class="indexterm"/>application and Web SQL database is deprecated the natural choice is IndexedDB.</p><p>In the root level create <code class="literal">vendors</code> directory to store all third part code, plugins, and so on.</p><p>Download and copy PouchDB to the <code class="literal">vendors</code> directory library, which provides good cross-browser API for IndexedDB. You can download <a id="id286" class="indexterm"/>PouchDB from the following location:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://pouchdb.com">http://pouchdb.com</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://github.com/daleharvey/pouchdb">https://github.com/daleharvey/pouchdb</a></li></ul></div></div><div class="section" title="Creating models"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec48"/>Creating models</h2></div></div></div><p>Let's create a <code class="literal">task.js</code> file under the <code class="literal">models</code> <a id="id287" class="indexterm"/>directory. In the <code class="literal">Task</code> model we will keep all task-related CRUD methods that operate on a local database.</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/model',
    'vendors/pouchdb.js',

    function ($) {
        'use strict'

        // local variable to keep reference to time-tracker database
        var db;

        /**
         * @class TTI.Models.Task
         * @parent index
         * @constructor
         * @author Wojciech Bednarski
         */
        $.Model('TTI.Models.Task', {

                /**
                 * @function init
                 * @hide
                 * Creates database time-tracker or get it if exists
                 */
                init: function () {
                    Pouch('idb://time-tracker', function (err, timeTracker) {
                        db = timeTracker;

                        console.log('TTI.Models.Task.init() | idb://time-tracker | err:', err, 'db:', db);
                    })
                },</pre></div><p>The <code class="literal">init</code> method is <a id="id288" class="indexterm"/>responsible <a id="id289" class="indexterm"/>for creating a <code class="literal">time-tracker</code> database or getting reference to it if it exists. The <code class="literal">idb://</code> protocol is telling PouchDB to use <code class="literal">IndexedDB</code> as a storage option.</p><div class="informalexample"><pre class="programlisting">                /**
                 * @function findAll
                 * Get all tasks
                 * @return {Object} an object contains objects with all tasks
                 *
                 * ### Example:
                 * @codestart
                 * TTI.Models.Task.findAll(function (tasks) {
                 *      // do something with tasks
                 * },
                 * function (error) {
                 *      // handle error here
                 * });
                 * task.save(function (task) {
                 *     console.log(task);
                 * });
                 * @codeend
                 */
                findAll: function (success, error) {
                    return db.allDocs(
                        {
                            include_docs: true // this is needed to return not only task ID but task it self
                        },
                        function (err, response) {
                            console.log('TTI.Models.Task.findAll() | GET | err:', err, 'client:', response);

                            if (response) {
                                success(response);
                            }
                            else if (err) {
                                error(err);
                            }
                        }
                    );
                },</pre></div><p>The <code class="literal">findAll</code> method is responsible <a id="id290" class="indexterm"/>for retrieving an object with all the items from our database. Readers can have a look <a id="id291" class="indexterm"/>at the example usage in the comment on the preceding code listing.</p><div class="informalexample"><pre class="programlisting">                /**
                 * @function findOne
                 * Find task by given ID
                 * @param {String} task ID
                 * Task object
                 * @codestart
                 * String (UUID)
                 * @codeend
                 *
                 * @return {Object} an object contains requested task
                 * @codestart
                 * {
                 *     id: String (UUID),
                 *     hours: Number,
                 *     cost: {
                 *          rate: Number,
                 *          total: Number
                 *     },
                 *     taskID: String,
                 *     description: String,
                 *     note: String
                 * }
                 * @codeend
                 *
                 * ### Example:
                 * @codestart
                 * TTI.Models.Task.findOne('UUID', function (success, error) {
                 *      // code goes here
                 * });
                 * @codeend
                 */
                findOne: function (id, success, error) {
                    return db.get(id, function (err, doc) {

                        if (doc) {
                            success(doc);
                        }
                        else if (err) {
                            error(err);
                        }

                    });
                },</pre></div><p>The <code class="literal">findOne</code> method is responsible <a id="id292" class="indexterm"/>for retrieving an object with a particular item from our database. Readers can have a look <a id="id293" class="indexterm"/>at the example usage in the comment on the preceding code listing.</p><div class="informalexample"><pre class="programlisting">                /**
                 * @function create
                 * Create new task
                 * @param {Object} task
                 * Task object
                 * @codestart
                 * {
                 *     hours: Number,
                 *     cost: {
                 *          rate: Number,
                 *          total: Number
                 *     },
                 *     taskID: String,
                 *     description: String,
                 *     note: String
                 * }
                 *
                 * {
                 *      hours: 7,
                 *      cost: {
                 *          rate: 100,
                 *          total: 700
                 *      },
                 *      taskID: 'JIRA-2789',
                 *      description: 'Implement new awesome feature!',
                 *      note: ''
                 *  }
                 * @codeend
                 *
                 * @return {Object} an object contains newly created task UUID
                 * @codestart
                 * {
                 *      id: "8D812FF6-4B96-4D73-8D18-01FACEF33531"
                 *      ok: true
                 *      rev: "1-c5a4055b6c3edac099083cc0b485d4e3"
                 * }
                 * @codeend
                 *
                 * ### Example:
                 * @codestart
                 * var task = new TTI.Models.Task({ task object goes here });
                 * task.save(function (task) {
                 *     console.log(task);
                 * });
                 * @codeend
                 */
                create: function (task, success, error) {
                    return db.post(task, function (err, response) {
                        console.log('TTI.Models.Task.create() | POST | err:', err, 'client:', response);

                        if (response) {
                            success(response);
                        }
                        else if (err) {
                            error(err);
                        }
                    });
                },</pre></div><p>The <code class="literal">create</code> method is <a id="id294" class="indexterm"/>responsible for creating a new item in our database. Readers can have a look at the example usage in the <a id="id295" class="indexterm"/>comment on the preceding code listing.</p><div class="informalexample"><pre class="programlisting">                /**
                 * @function update
                 * Update task by given ID
                 * @param {Object} task
                 * Task object
                 * @codestart
                 * {
                 *      _id: String (UUID),
                 *      hours: Number,
                 *      cost: {
                 *          rate: Number,
                 *          total: Number
                 *      },
                 *      taskID: String,
                 *      description: String,
                 *      note: String
                 * }
                 * @codeend
                 *
                 * @return {Object} an object contains updated task UUID
                 * @codestart
                 * {
                 *      id: "8D812FF6-4B96-4D73-8D18-01FACEF33531"
                 *      ok: true
                 *      rev: "1-c5a4055b6c3edac099083cc0b485d4e3"
                 * }
                 * @codeend
                 *
                 * ### Example:
                 * @codestart
                 * TTI.Models.Task.update({ task object goes here });
                 * @codeend
                 */
                update: function (task, success, error) {
                    return db.put(task, function (err, response) {
                        console.log('TTI.Models.Task.update() | POST | err:', err, 'client:', response);

                        if (response) {
                            success(response);
                        }
                        else if (err) {
                            error(err);
                        }
                    });
                },</pre></div><p>The <code class="literal">update</code> method is <a id="id296" class="indexterm"/>responsible for updating a particular item in our database. Readers can have a look at the example usage in the <a id="id297" class="indexterm"/>comment on the preceding code listing.</p><div class="informalexample"><pre class="programlisting">                /**
                 * @function destroy
                 * Destroy task by given ID
                 * @param {Object} task
                 * Task object
                 * @codestart
                 * String (UUID)
                 * @codeend
                 *
                 * @return {Object} an object contains destroyed task UUID
                 * @codestart
                 * {
                 *      id: "8D812FF6-4B96-4D73-8D18-01FACEF33531"
                 *      ok: true
                 *      rev: "1-c5a4055b6c3edac099083cc0b485d4e3"
                 * }
                 * @codeend
                 *
                 * ### Example:
                 * @codestart
                 * TTI.Models.Task.destroy('UUID', function (success, getError, removeError) {
                 *      // handle errors here
                 * });
                 * @codeend
                 */
                destroy: function (id, success, getError, removeError) {
                    return db.get(id, function (getErr, doc) {

                        if (getErr) {
                            getError(getErr);
                        }

                        db.remove(doc, function (removeErr, response) {

                            if (response) {
                                success(response);
                            }
                            else if (removeErr) {
                                removeError(removeErr);
                            }

                        });
                    });
                }
            },
            {

            }
        );

    }
);</pre></div><p>This <code class="literal">destroy</code> method is <a id="id298" class="indexterm"/>responsible for destroying a particular item in our database. Readers can have a look at the example <a id="id299" class="indexterm"/>usage in the comment on the preceding code listing.</p><p>Let's create a <code class="literal">client.js</code> file under <code class="literal">models</code> directory. In <code class="literal">Client</code> model we will keep all the task-related CRUD methods that operate on a local database. Create a bootstrap file:</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/model',

    function ($) {
        'use strict';

        $.Model('TTI.Models.Client', {
                init: function () {
                    // create database clients or get it if exists.


                    console.log('TTI.Models.Client.init() | idb://clients | err:');

                },

                findAll: function () {

                },

                findOne: function () {

                },

                create: function () {


                },

                update: function () {

                },

                destroy: function () {

                }
            },
            {

            }
        );
    }
);</pre></div></div><div class="section" title="Creating controllers"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec49"/>Creating controllers</h2></div></div></div><p>Let's create a <code class="literal">tasks.js</code> file <a id="id300" class="indexterm"/>under the <code class="literal">controllers</code> directory where we can handle all the application actions.</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/view/ejs',
    'jquery/controller',
    'tti/models/task.js'
).then(
    function ($) {
        'use strict';

        console.log('TTI.Controllers.Tasks');

        /**
         * @class TTI.Controllers.Tasks
         * Creates a new Tasks controller
         * @parent index
         * @constructor
         * @param {String} DOMElement DOM element
         * @return {Object}
         */
        $.Controller('TTI.Controllers.Tasks', {
            'init': function (element, options) {
                var self = this;

                $('title').text('Time Tracker | TTI');

                TTI.Models.Task.findAll(function (data) {
                    if (!data.rows.length) {
                        data.rows = [
                            {
                                doc: {
                                    hours: '',
                                    cost: {
                                        total: ''
                                    },
                                    taskID: '',
                                    description: 'No tasks so far!',
                                    note: ''

                                }
                            }
                        ];
                    }

                    self.element.html('tti/views/templates/tasks/tasks.ejs', data.rows);

                });

            },

            '{TTI.Models.Task} created': function (Task, e, task) {
                console.log('task', task);
                console.log('this.element', this.element);
                $('tbody tr:last', this.element).after('tti/views/templates/tasks/task.ejs', task);
                $('tbody tr:last', this.element).effect('highlight', {}, 3000);
            },

            '{TTI.Models.Task} destroyed': function (Task, e, task) {
                task.elements(this.element).remove();
            },

            '.add-task click': function () {
                this.element.append('tti/views/templates/tasks/add_task.ejs', {}).find('.create-new-task-dialog-form').dialog({
                    autoOpen: false,
                    modal:    true,
                    buttons:  {
                        'Create New Task': function () {
                            var self = this;

                            window.task = new TTI.Models.Task({
                                hours: $('input[name="hours"]', this).val(),
                                taskID: $('input[name="task-id"]', this).val(),
                                cost: {
                                    rate: 0,
                                    total: 0
                                },
                                description: $('input[name="description"]', this).val(),
                                note: $('input[name="note"]', this).val()
                            });

                            window.task.save(function () {
                                $(self).dialog('destroy').remove();
                            });

                        },
                        Cancel: function () {
                            $(this).dialog('destroy').remove();
                        }
                    },
                    close: function () {
                        $(this).dialog('destroy').remove();
                    }
                }).dialog('open');

            }

        });

    }
);</pre></div><p>Let's create the <code class="literal">clients.js</code> file <a id="id301" class="indexterm"/>under the <code class="literal">controllers</code> directory.</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/view/ejs',
    'jquery/controller'
).then(
    function ($) {
        'use strict';

        console.log('TTI.Controllers.Client');

        /**
         * @class TTI.Controllers.Client
         * Creates a new Tasks controller
         * @parent index
         * @constructor
         * @param {String} DOMElement DOM element
         * @return {Object}
         */
        $.Controller('TTI.Controllers.Client', {
            'init': function () {

                $('title').text('Clients | TTI');

                var testData = [
                    {
                        name: 'The First Awesome Client!'
                    },
                    {
                        name: 'The Second Awesome Client!'
                    }
                ];

                this.element.html('tti/views/templates/clients.ejs', testData);

            }

        });

    }
);</pre></div><p>Let's create the <code class="literal">router.js</code> file <a id="id302" class="indexterm"/>under the <code class="literal">controllers</code> directory.</p><div class="informalexample"><pre class="programlisting">steal(
    'tti/controllers/navigation.js',
    'tti/controllers/client.js',
    'tti/controllers/tasks.js',
    'jquery/controller',
    'jquery/controller/route'
).then(
    function ($) {
        'use strict';

        /**
        * @class TTI.Controllers.Router
        * Creates application router
        * @parent index
        * @constructor
        * @param {String} DOMElement DOM element
        * @return {Object}
        */
        $.Controller('TTI.Controllers.Router', {
            init: function () {
                console.log('r init');
            },

            // the index page
            'route': function (e) {
                console.log('default route', e);
            },

            ':page route': function (data) {
                $('#content').empty().append('&lt;div&gt;');

                if (data.page === 'time-tracker') {
                    new TTI.Controllers.Tasks('#content div');
                }
                else if (data.page === 'clients') {
                    new TTI.Controllers.Client('#content div');
                }
            }

        });

        // create new Router controller instance
        $('body').bind('TTI/db-ready', function () {
            new TTI.Controllers.Router(document.body);
        });
    }
);</pre></div><p>Let's create <a id="id303" class="indexterm"/>the <code class="literal">navigation.js</code> file under the <code class="literal">controllers</code> directory.</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/view/ejs',
    'jquery/controller',
    'jquery/dom/route'
).then(
    function ($) {
        'use strict';

        /**
         * @class TTI.Controllers.Navigation
         * Creates application main navigation controller
         * @parent index
         * @constructor
         * @param {String} DOMElement DOM element
         * @return {Object}
         */
        $.Controller('TTI.Controllers.Navigation', {
            init: function () {
                var navItems = [
                    {
                        name: 'Time Tracker',
                        className: 'time-tracker'
                    },
                    {
                        name: 'Invoice',
                        className: 'invoice'
                    },
                    {
                        name:      'Clients',
                        className: 'clients'
                    },
                    {
                        name: 'Reports',
                        className: 'reports'
                    },
                    {
                        name: 'Statistics',
                        className: 'statistics'
                    }
                    ];

                this.element.html('tti/views/templates/navigation.ejs', navItems);
            },

            '.time-tracker click': function (e) {
                $.route.attr('page', 'time-tracker');
            },

            '.clients click': function (e) {
                $.route.attr('page', 'clients');
            }

        });

    }
);</pre></div></div><div class="section" title="Creating views"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec50"/>Creating views</h2></div></div></div><p>Let's create the <code class="literal">views</code> folder <a id="id304" class="indexterm"/>under the <code class="literal">tti</code> directory and inside it, two directories: <code class="literal">styles</code> and <code class="literal">templates</code>.</p><p>In the <code class="literal">templates</code> directory create <code class="literal">client.ejs</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;h2&gt;Clients List&lt;/h2&gt;

&lt;ol&gt;
    &lt;% $.each(this, function(i, client) { %&gt;

        &lt;li &lt;%= ($el) -&gt; $el.model(client) %&gt;&gt;
            &lt;strong&gt;&lt;%= client.name %&gt;&lt;/strong&gt;
        &lt;/li&gt;

    &lt;% }) %&gt;
&lt;/ol&gt;</pre></div><p>In the <code class="literal">templates</code> directory <a id="id305" class="indexterm"/>create the <code class="literal">navigation.ejs</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;% $.each(this, function(i, item) { %&gt;

    &lt;li class="&lt;%= item.className %&gt;"&gt;
        &lt;%= item.name %&gt;
    &lt;/li&gt;

&lt;% }) %&gt;</pre></div><p>In the <code class="literal">templates</code> directory create <a id="id306" class="indexterm"/>the <code class="literal">tasks</code> directory. Create the <code class="literal">tasks.ejs</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;table summary="Time Tracker list of tasks."&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th scope="col"&gt;Hours&lt;/th&gt;
            &lt;th scope="col"&gt;Cost&lt;/th&gt;
            &lt;th scope="col"&gt;Task ID&lt;/th&gt;
            &lt;th scope="col"&gt;Description&lt;/th&gt;
            &lt;th scope="col"&gt;Note&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        &lt;% $.each(this, function(i, task) { %&gt;
            &lt;tr &lt;%= ($el) -&gt; $el.model(task) %&gt;&gt;
                &lt;td&gt;
                    &lt;%= task.doc.hours %&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;%= task.doc.cost.total %&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;%= task.doc.taskID %&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;%= task.doc.description %&gt;
                &lt;/td&gt;
                &lt;td&gt;
                    &lt;%= task.doc.note %&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        &lt;% }) %&gt;
    &lt;/tbody&gt;
&lt;/table&gt;

&lt;span class="add-task"&gt;Add Task&lt;/span&gt;</pre></div><p>In the <code class="literal">tasks</code> directory create the <code class="literal">task.ejs</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;tr &lt;%= ($el) -&gt; $el.model(task) %&gt;&gt;
    &lt;td&gt;
        &lt;%= task.hours %&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;%= task.cost.total %&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;%= task.taskID %&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;%= task.description %&gt;
    &lt;/td&gt;
    &lt;td&gt;
        &lt;%= task.note %&gt;
    &lt;/td&gt;
&lt;/tr&gt;</pre></div><p>In the <code class="literal">tasks</code> directory create <a id="id307" class="indexterm"/>the <code class="literal">add_task.ejs</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;div class="create-new-task-dialog-form" title="Create New Task"&gt;
    &lt;form&gt;
        &lt;fieldset&gt;
            &lt;label&gt;&lt;span&gt;Hours&lt;/span&gt; &lt;input type="text" name="hours" /&gt;&lt;/label&gt;
            &lt;label&gt;&lt;span&gt;Task ID&lt;/span&gt; &lt;input type="text" name="task-id" /&gt;&lt;/label&gt;
            &lt;label&gt;&lt;span&gt;Description&lt;/span&gt; &lt;input type="text" name="description" /&gt;&lt;/label&gt;
            &lt;label&gt;&lt;span&gt;Note&lt;/span&gt; &lt;input type="text" name="note" /&gt;&lt;/label&gt;
        &lt;/fieldset&gt;
    &lt;/form&gt;
&lt;/div&gt;</pre></div><p>In the <code class="literal">styles</code> directory create two directories: <code class="literal">css</code> and <code class="literal">sass</code>.</p><p>In the <code class="literal">sass</code> directory create the <code class="literal">tti.scss</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">@import 'reset';
@import 'static';
@import 'mixins';
@import 'skelton';</pre></div><p>In the <code class="literal">sass</code> directory create the <code class="literal">_static.scss</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">$blue: #5C94BF;
$black: #3E4246;
$white: #F6F6F7;
$vlGreen: #B7D190;
$lGreen: #9CBA6E;
$dGreen: #424A38;
$mGrey: #5B5B5B;
$yellow: #F8AE03;
$lBlue: #167BBE;
$dBlue: #0E69B3;
$gBlue: #7489A1;</pre></div><p>In the <code class="literal">sass</code> directory <a id="id308" class="indexterm"/>create the <code class="literal">_mixins.scss</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">@mixin link {
    color: $lGreen;
    cursor: pointer;
    text-decoration: none;

    &amp;:hover {
        text-decoration: underline;
    }
}

@mixin borderRadius($topLeft, $topRight, $bottomRight, $bottomLeft) {
    -moz-border-radius-topleft: $topLeft;
    -moz-border-radius-topright: $topRight;
    -moz-border-radius-bottomright: $bottomRight;
    -moz-border-radius-bottomleft: $bottomLeft;
    -webkit-border-radius: $topLeft $topRight $bottomRight $bottomLeft;
    border-radius: $topLeft $topRight $bottomRight $bottomLeft;
}

@mixin button {
    @include borderRadius(5px, 5px, 5px, 5px);
    display: inline-block;
    padding: 0 7px;
    line-height: 20px;
    height: 20px;
    cursor: pointer;
}</pre></div><p>In the <code class="literal">sass</code> directory <a id="id309" class="indexterm"/>create the <code class="literal">_reset.scss</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">//   http://meyerweb.com/eric/tools/css/reset/
//   v2.0 | 20110126
//   License: none (public domain)

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
    margin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
}
// HTML5 display-role reset for older browsers
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section {
    display: block;
}

body {
    line-height: 1;
}

ol, ul {
    list-style: none;
}

blockquote, q {
    quotes: none;
}

blockquote:before, blockquote:after,
q:before, q:after {
    content: '';
    content: none;
}

table {
    border-collapse: collapse;
    border-spacing: 0;
}

textarea {
    min-height: 100px;
}</pre></div><p>In the <code class="literal">sass</code> directory <a id="id310" class="indexterm"/>create the <code class="literal">skelton.scss</code> file with the following content:</p><div class="informalexample"><pre class="programlisting">html,
body {
    color: $black;
    background: $white;
    font: 11px/18px "Helvetica Neue", Helvetica, Verdana, sans-serif;
}

input,
select,
textarea {
    font: 12px/18px "Helvetica Neue", Helvetica, Verdana, sans-serif;
}

table {
    width: 100%;
    border: 1px solid $gBlue;

    thead {
        color: $white;
        background: $blue;

        tr {

            &amp;:last-child {
                @include borderRadius(5px, 5px, 5px, 5px);
            }

            th {
                padding: 7px 0;
            }
        }
    }

    tbody {

        tr {

            td {
                padding: 3px 0;
                border-bottom: 1px solid $gBlue;
                text-align: center;
            }
        }
    }

}

#container {
    width: 1100px;
    margin: 0 auto;

    #header {
        padding: 10px;
        height: 50px;

        #main-navigation {

            li {
                @include link;
                margin-right: 7px;
                display: inline-block;
            }
        }
    }

    h2 {
        font-size: 14px;
    }

    ol {
        margin: 7px;
        list-style-type: decimal;
        list-style-position: inside;
    }

    .add-task {
        @include button;
        margin-top: 20px;
        color: $white;
        background: $lGreen;

        &amp;:hover {
            background: $yellow;
        }
    }
}</pre></div></div><div class="section" title="Creating a bootstrap"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec51"/>Creating a bootstrap</h2></div></div></div><p>In the root directory let's <a id="id311" class="indexterm"/>create the <code class="literal">index.html</code> file with the following code. Bootstrap is responsible for loading all the files needed by the application to run.</p><div class="informalexample"><pre class="programlisting">&lt;!doctype html&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;TTI&lt;/title&gt;
        &lt;meta charset="UTF-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id="container"&gt;
            &lt;header id="header"&gt;
                &lt;nav id="main-navigation"&gt;
                    &lt;ul&gt;&lt;/ul&gt;
                &lt;/nav&gt;
                &lt;div id="breadcrumb"&gt;&lt;/div&gt;
                &lt;nav id="secondary-navigation"&gt;&lt;/nav&gt;
            &lt;/header&gt;

            &lt;div id="content"&gt;
                &lt;div&gt;&lt;p&gt;Loading...&lt;/p&gt;&lt;/div&gt;
            &lt;/div&gt;

            &lt;footer id="footer"&gt;

            &lt;/footer&gt;

        &lt;/div&gt;

        &lt;script src="steal/steal.js?tti"&gt;&lt;/script&gt;

    &lt;/body&gt;
&lt;/html&gt;</pre></div><p>In the <code class="literal">tti</code> directory create the <code class="literal">tti.js</code> <a id="id312" class="indexterm"/>file with the following code:</p><div class="informalexample"><pre class="programlisting">steal(
    function ($) {
        console.log('tti.js');
    },
    'vendors/jquery_ui/css/smoothness/jquery.ui.core.css',
    'vendors/jquery_ui/css/smoothness/jquery.ui.dialog.css',
    'vendors/jquery_ui/css/smoothness/jquery.ui.theme.css',
    'tti/views/styles/css/tti.css',
    'tti/models/task.js',
    'tti/models/client.js',
    'tti/controllers/tasks.js',
    'tti/controllers/router.js',
    'tti/controllers/navigation.js'
).then(
    'vendors/jquery_ui/jquery.ui.core.js'
).then(
    'vendors/jquery_ui/jquery.effects.core.js'
).then(
    'vendors/jquery_ui/jquery.effects.highlight.js'
).then(
    'vendors/jquery_ui/jquery.ui.widget.js'
).then(
    'vendors/jquery_ui/jquery.ui.position.js',
    'vendors/jquery_ui/jquery.ui.dialog.js'
).then(
    function ($) {
        new TTI.Controllers.Navigation('#main-navigation ul');
    }
);</pre></div></div><div class="section" title="Running the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>Running the application</h2></div></div></div><p>In order to run our application we convert the SASS files into the CSS file which can be read by web browsers.</p><p>We used SASS instead <a id="id313" class="indexterm"/>of plain CSS to split code into many small files for better readability and better code re-use. This aspect is very important, especially in big applications.</p><p>SASS can be installed by executing <a id="id314" class="indexterm"/>
<code class="literal">$ gem install sass</code> command or downloading it from the Git repository at <a class="ulink" href="http://sass-lang.com/download.html">http://sass-lang.com/download.html</a>.</p><p>To compile SASS code into CSS code, go to views folder and type:</p><div class="informalexample"><pre class="programlisting">$ sass --watch sass:css</pre></div><p>Then run the web server and navigate to <code class="literal">index.html</code>.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec39"/>Summary</h1></div></div></div><p>In this chapter we learned how to build a JavaScriptMVC application and organize code and workflow to create web applications in a more efficient and less error prone way.</p></div></body></html>