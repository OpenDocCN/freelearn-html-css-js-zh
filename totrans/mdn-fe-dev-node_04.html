<html><head></head><body>
<div id="_idContainer042">
<h1 class="chapter-number" id="_idParaDest-43" lang="en-GB"><a id="_idTextAnchor042"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 id="_idParaDest-44" lang="en-GB"><a id="_idTextAnchor043"/><span class="koboSpan" id="kobo.2.1">Using Different Flavors of JavaScript</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.3.1">With the previous chapter, you’ve completed the essentials for doing projects in Node.js. </span><span class="koboSpan" id="kobo.3.2">Looking at real projects out there, you’ll find quickly that people use Node.js with all kinds of flavors of JavaScript. </span><span class="koboSpan" id="kobo.3.3">A </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.4.1">flavor</span></strong><span class="koboSpan" id="kobo.5.1"> of </span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.6.1">JavaScript is a new language that can be seen as a variation of the official JavaScript language standard. </span><span class="koboSpan" id="kobo.6.2">Mostly, these flavors look very much like the JavaScript you are used to but differ in key parts. </span><span class="koboSpan" id="kobo.6.3">Sometimes, they add new language constructs to simplify certain tasks; sometimes, they bring improvements for reliability before releasing </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.7.1">any code.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.8.1">In this chapter, we’ll learn how different flavors of JavaScript can be used with Node.js. </span><span class="koboSpan" id="kobo.8.2">We will introduce the most important tools and flavors. </span><span class="koboSpan" id="kobo.8.3">As far as the tooling part is concerned, we’ll introduce the popular open source </span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.9.1">package, </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.10.1">Babel</span></strong><span class="koboSpan" id="kobo.11.1">. </span><span class="koboSpan" id="kobo.11.2">This tool can be quite helpful to teach Node.js how to use a flavor of JavaScript. </span><span class="koboSpan" id="kobo.11.3">These flavors include interesting </span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.12.1">additions to the language </span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.13.1">such as </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.14.1">Flow</span></strong><span class="koboSpan" id="kobo.15.1"> or </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.16.1">TypeScript</span></strong><span class="koboSpan" id="kobo.17.1">. </span><span class="koboSpan" id="kobo.17.2">Both introduce type systems, but the latter also adds new constructs to </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.18.1">the language.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.19.1">This chapter will help you to use languages that can be converted to JavaScript with Node.js. </span><span class="koboSpan" id="kobo.19.2">Ultimately, this is key – not only to be able to run JavaScript files independent of their syntax with any version of Node.js but also to introduce additional safety and convenience in </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.20.1">larger projects.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.21.1">We will cover the following key topics in </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.22.1">this chapter:</span></span></p>
<ul>
<li lang="en-GB"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.23.1">Integrating Babel</span></span></li>
<li lang="en-GB"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.24.1">Using Flow</span></span></li>
<li lang="en-GB"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.25.1">Using TypeScript</span></span></li>
</ul>
<h1 id="_idParaDest-45" lang="en-GB"><a id="_idTextAnchor044"/><span class="koboSpan" id="kobo.26.1">Technical requirements</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.27.1">The complete source code for this chapter can be found </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.28.1">at </span></span><a href="https://github.com/PacktPublishing/Modern-Frontend-Development-with-Node.js/tree/main/Chapter04"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.29.1">https://github.com/PacktPublishing/Modern-Frontend-Development-with-Node.js/tree/main/Chapter04</span></span></a><span class="No-Break" lang=""><span class="koboSpan" id="kobo.30.1">.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.31.1">The CiA videos for this chapter can be accessed </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.32.1">at </span></span><a href="http://bit.ly/3UeL4Ot"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.33.1">http://bit.ly/3UeL4Ot</span></span></a><span class="No-Break" lang=""><span class="koboSpan" id="kobo.34.1">.</span></span></p>
<h1 id="_idParaDest-46" lang="en-GB"><a id="_idTextAnchor045"/><span class="koboSpan" id="kobo.35.1">Integrating Babel</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.36.1">In the </span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.37.1">last decade, JavaScript ascended from a simple scripting language to the most used programming language in the whole world. </span><span class="koboSpan" id="kobo.37.2">With the increased popularity, the language has also gotten a lot of interesting features. </span><span class="koboSpan" id="kobo.37.3">Unfortunately, it always takes a while until the latest features are made available in all implementations. </span><span class="koboSpan" id="kobo.37.4">The problem gets worse if we want to use the latest language features in old </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.38.1">implementations anyway.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.39.1">This is a problem that has been known by frontend developers for years – after all, the version and variety of the browser used cannot be predetermined by the developer. </span><span class="koboSpan" id="kobo.39.2">Only the user makes this decision – and an older browser may not understand some of the modern features that the developer wants to use. </span><span class="koboSpan" id="kobo.39.3">In Node.js, we don’t have exactly the same problem – as we can theoretically decide the version of Node.js – but it can be a similar issue if Node.js does not have the latest language features or if we create tools that are supposed to run on other </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.40.1">people’s machines.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.41.1">A nice way out of the language feature lockdown (that is, the restriction to only use the feature set supported by the engine) is to use a tool that understands the latest language specification and is capable of properly translating it into an older language specification. </span><span class="koboSpan" id="kobo.41.2">The process of such a programming language</span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.42.1"> translation is called </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.43.1">transpilation</span></strong><span class="koboSpan" id="kobo.44.1">. </span><span class="koboSpan" id="kobo.44.2">The tool is </span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.45.1">called </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.46.1">a </span></span><span class="No-Break" lang=""><strong class="bold" lang=""><span class="koboSpan" id="kobo.47.1">transpiler</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.48.1">.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.49.1">One of the most known transpilers for JavaScript is Babel. </span><span class="koboSpan" id="kobo.49.2">Its power lies in a rich plugin ecosystem. </span><span class="koboSpan" id="kobo.49.3">Actually, it is so easy to extend the JavaScript language with constructs using Babel, that many features were first introduced in Babel before they either became part of the official standard or a de facto standard. </span><span class="koboSpan" id="kobo.49.4">An example of the former is </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.50.1">async</span></strong><span class="koboSpan" id="kobo.51.1">/</span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.52.1">await</span></strong><span class="koboSpan" id="kobo.53.1">, which is a fairly complex feature. </span><span class="koboSpan" id="kobo.53.2">An example of the latter</span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.54.1"> is </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.55.1">JSX</span></strong><span class="koboSpan" id="kobo.56.1">, that is, the extension of JavaScript with </span><span class="No-Break" lang=""><strong class="bold" lang=""><span class="koboSpan" id="kobo.57.1">XML</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.58.1">-like constructs.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.59.1">The following code is using </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.60.1">async</span></strong><span class="koboSpan" id="kobo.61.1">/</span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.62.1">await</span></strong><span class="koboSpan" id="kobo.63.1"> and would be incompatible with Node.js before </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.64.1">version </span></span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.65.1">7.6.0</span></em></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.66.1">:</span></span></p>
<pre class="source-code" lang="en-GB"><span class="koboSpan" id="kobo.67.1">function wait(time) {
  return new Promise(resolve =&gt; setTimeout(resolve, time));
}
async function example() {
  console.log('Starting...');
  await wait(1000);
  console.log('1s later...');
  await wait(1000);
  console.log('2s later...');
  await wait(3000);
  console.log('Done after 5s!');
}
example();</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.68.1">If we </span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.69.1">want to make this compatible with older versions (or, in general, JavaScript engines that cannot handle the modern </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.70.1">async</span></strong><span class="koboSpan" id="kobo.71.1">/</span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.72.1">await</span></strong><span class="koboSpan" id="kobo.73.1"> syntax), then we can </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.74.1">use Babel.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.75.1">There are three ways of transpiling the code </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.76.1">with Babel:</span></span></p>
<ul>
<li lang="en-GB"><span class="koboSpan" id="kobo.77.1">We can use the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.78.1">@babel/node</span></strong><span class="koboSpan" id="kobo.79.1"> package, which is a thin wrapper around Node.js. </span><span class="koboSpan" id="kobo.79.2">Essentially, it will transpile the modules during execution – that is, when they </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.80.1">are needed.</span></span></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.81.1">The </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.82.1">@babel/cli</span></strong><span class="koboSpan" id="kobo.83.1"> package can be used to transpile the modules beforehand and run Node.js on the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.84.1">transpiled modules.</span></span></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.85.1">Alternatively, the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.86.1">@babel/core</span></strong><span class="koboSpan" id="kobo.87.1"> package can be used to programmatically control the transpilation process – that is, which modules are being transpiled and what is done with </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.88.1">the results.</span></span></li>
</ul>
<p lang="en-GB"><span class="koboSpan" id="kobo.89.1">Each way has its own advantages and disadvantages. </span><span class="koboSpan" id="kobo.89.2">For instance, choosing </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.90.1">@babel/node</span></strong><span class="koboSpan" id="kobo.91.1"> might be the easiest to get running, but will actually give us a small performance hit and some uncertainty. </span><span class="koboSpan" id="kobo.91.2">If some lesser-used module has a syntax problem, then we would only find out later when the module </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.92.1">is used.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.93.1">Likewise, </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.94.1">@babel/cli</span></strong><span class="koboSpan" id="kobo.95.1"> certainly hits the sweet spot between convenience and power. </span><span class="koboSpan" id="kobo.95.2">Yes, it only works with files, but that is what we want in almost </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.96.1">all cases.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.97.1">One </span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.98.1">way to see very conveniently how Babel handles things is to use the interactive</span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.99.1"> website located at </span><a href="https://babeljs.io/repl"><span class="koboSpan" id="kobo.100.1">https://babeljs.io/repl</span></a><span class="koboSpan" id="kobo.101.1">. </span><span class="koboSpan" id="kobo.101.2">For our previous code example, which is using an </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.102.1">async</span></strong><span class="koboSpan" id="kobo.103.1"> function with </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.104.1">await</span></strong><span class="koboSpan" id="kobo.105.1">, we get a view as shown in </span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.106.1">Figure 4</span></em></span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.107.1">.1</span></em></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.108.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer039">
<span class="koboSpan" id="kobo.109.1"><img alt="Figure 4.1 – Transpiling some JavaScript via Babel online " src="image/Figure_4.01_B18989.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.110.1">Figure 4.1 – Transpiling some JavaScript via Babel online</span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.111.1">For the screenshot shown in </span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.112.1">Figure 4</span></em></span><em class="italic" lang=""><span class="koboSpan" id="kobo.113.1">.1</span></em><span class="koboSpan" id="kobo.114.1">, we specified the version of Node.js to be </span><em class="italic" lang=""><span class="koboSpan" id="kobo.115.1">7.6</span></em><span class="koboSpan" id="kobo.116.1">. </span><span class="koboSpan" id="kobo.116.2">Once we change that to something lower, for example, </span><em class="italic" lang=""><span class="koboSpan" id="kobo.117.1">7.5</span></em><span class="koboSpan" id="kobo.118.1">, we get a different output. </span><span class="koboSpan" id="kobo.118.2">It all starts with some </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.119.1">generated code:</span></span></p>
<pre class="source-code" lang="en-GB"><span class="koboSpan" id="kobo.120.1">"use strict";
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.121.1">After the </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.122.1">generated code, our own code is spat out. </span><span class="koboSpan" id="kobo.122.2">The crucial difference is that our code now uses the helpers from the preceding </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.123.1">generated code:</span></span></p>
<pre class="source-code" lang="en-GB"><span class="koboSpan" id="kobo.124.1">function wait(time) {
  return new Promise(resolve =&gt; setTimeout(resolve, time));
}
function example() {
  return _example.apply(this, arguments);
}
function _example() {
  _example = _asyncToGenerator(function* () {
    console.log('Starting...');
    yield wait(1000);
    console.log('1s later...');
    yield wait(1000);
    console.log('2s later...');
    yield wait(3000);
    console.log('Done after 5s!');
  });
  return _example.apply(this, arguments);
}
example();</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.125.1">As you can see, the code was modified with the generated functions. </span><span class="koboSpan" id="kobo.125.2">In our case, those functions have been used to replace the standard </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.126.1">async</span></strong><span class="koboSpan" id="kobo.127.1">/</span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.128.1">await</span></strong><span class="koboSpan" id="kobo.129.1"> mechanism with a generator function using </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.130.1">yield</span></strong><span class="koboSpan" id="kobo.131.1">. </span><span class="koboSpan" id="kobo.131.2">But even that could be changed further when transpiling for Node.js before version </span><em class="italic" lang=""><span class="koboSpan" id="kobo.132.1">6.0</span></em><span class="koboSpan" id="kobo.133.1">, which introduced support for </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.134.1">generator functions.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.135.1">In any case, Babel</span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.136.1"> is actually doing the hard work of figuring out which constructs are used in our code, and which constructs need to be replaced depending on the target version of Node.js. </span><span class="koboSpan" id="kobo.136.2">It also knows the proper replacements and can generate some boilerplate code to support the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.137.1">language constructs.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.138.1">For Babel to do all this work, it needs to understand the JavaScript language. </span><span class="koboSpan" id="kobo.138.2">This is done by </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.139.1">parsing</span></strong><span class="koboSpan" id="kobo.140.1"> the source code. </span><span class="koboSpan" id="kobo.140.2">Parsing</span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.141.1"> is a process that involves going over all characters, grouping them into so-called tokens (such as identifiers, numbers, etc.), and then putting these tokens in a tree-like structure known as an </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.142.1">abstract syntax tree</span></strong><span class="koboSpan" id="kobo.143.1"> (</span><strong class="bold" lang=""><span class="koboSpan" id="kobo.144.1">AST</span></strong><span class="koboSpan" id="kobo.145.1">). </span><span class="koboSpan" id="kobo.145.2">One tool to explore the AST </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.146.1">as seen by Babel can be</span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.147.1"> found </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.148.1">at </span></span><a href="https://astexplorer.net/"><span class="No-Break" lang=""><span class="koboSpan" id="kobo.149.1">https://astexplorer.net/</span></span></a><span class="No-Break" lang=""><span class="koboSpan" id="kobo.150.1">.</span></span></p>
<p class="callout-heading" lang="en-GB"><span class="koboSpan" id="kobo.151.1">Understanding ASTs</span></p>
<p class="callout" lang="en-GB"><span class="koboSpan" id="kobo.152.1">Much like processing HTML results in a tree of different nodes, any programming language actually resolves to a tree of expressions and statements. </span><span class="koboSpan" id="kobo.152.2">While statements such as a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.153.1">for</span></strong><span class="koboSpan" id="kobo.154.1"> loop form a closed block of instructions, expressions such as an addition will always return a value. </span><span class="koboSpan" id="kobo.154.2">The AST puts all of those in relation and integrates all provided information for the respective node types. </span><span class="koboSpan" id="kobo.154.3">For instance, an addition expression consists of two expressions that should be added together. </span><span class="koboSpan" id="kobo.154.4">Those could be any expression, for example, a simple literal expression such as a </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.155.1">number token.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.156.1">A snippet of the AST of the preceding example can be seen in </span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.157.1">Figure 4</span></em></span><em class="italic" lang=""><span class="koboSpan" id="kobo.158.1">.2</span></em><span class="koboSpan" id="kobo.159.1">. </span><span class="koboSpan" id="kobo.159.2">Each node in the AST </span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.160.1">has </span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.161.1">an associated type (such as </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.162.1">AwaitExpression</span></strong><span class="koboSpan" id="kobo.163.1">) and a position in the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.164.1">source document:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.165.1"><img alt="Figure 4.2 – The AST Explorer shows the information as parsed by Babel " src="image/Figure_4.02_B18989.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.166.1">Figure 4.2 – The AST Explorer shows the information as parsed by Babel</span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.167.1">Equipped with this knowledge, we can now try to do something locally </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.168.1">using </span></span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.169.1">@babel/node</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.170.1">:</span></span></p>
<ol>
<li lang="en-GB"><span class="koboSpan" id="kobo.171.1">We start by creating a new Node.js project. </span><span class="koboSpan" id="kobo.171.2">In a new directory, run </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.172.1">the following:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.173.1">$ npm init -y</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.174.1">This will create a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.175.1">package.json</span></strong><span class="koboSpan" id="kobo.176.1"> and include some basic information. </span><span class="koboSpan" id="kobo.176.2">Afterwards, you can install the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.177.1">@babel/node</span></strong><span class="koboSpan" id="kobo.178.1"> and </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.179.1">@babel/core</span></strong><span class="koboSpan" id="kobo.180.1"> packages as a </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.181.1">development dependency:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.182.1">$ npm install @babel/core @babel/node --save-dev</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.183.1">Feel free to use another package manager for this. </span><span class="koboSpan" id="kobo.183.2">Once the installation has finished, we </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.184.1">should add the script. </span><span class="koboSpan" id="kobo.184.2">Create a new </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.185.1">index.js</span></strong><span class="koboSpan" id="kobo.186.1"> file </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.187.1">with the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.188.1">following content:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.189.1">          index.js</span></p>
<pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.190.1">
let x = 1;

let y = 2;

// use conditional assignment – ES2021 feature

x &amp;&amp;= y;

console.log('Conditional assignment', x);</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.191.1">The code uses an </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.192.1">ES2021</span></strong><span class="koboSpan" id="kobo.193.1"> feature called conditional assignments. </span><span class="koboSpan" id="kobo.193.2">Only if </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.194.1">y</span></strong><span class="koboSpan" id="kobo.195.1"> is truthy will the assignment be done. </span><span class="koboSpan" id="kobo.195.2">In this case, we expect </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.196.1">x</span></strong><span class="koboSpan" id="kobo.197.1"> to be </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.198.1">2</span></strong><span class="koboSpan" id="kobo.199.1"> after the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.200.1">conditional assignment.</span></span></p>
<ol>
<li lang="en-GB" value="4"><span class="koboSpan" id="kobo.201.1">To run the code, we need to modify </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.202.1">package.json</span></strong><span class="koboSpan" id="kobo.203.1">. </span><span class="koboSpan" id="kobo.203.2">In the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.204.1">scripts</span></strong><span class="koboSpan" id="kobo.205.1"> section, we add a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.206.1">start</span></strong><span class="koboSpan" id="kobo.207.1"> field. </span><span class="koboSpan" id="kobo.207.2">Now, the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.208.1">scripts</span></strong><span class="koboSpan" id="kobo.209.1"> section should look </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.210.1">like this:</span></span><pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.211.1">
"scripts": {</span></pre><pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.212.1">
  "start": "node index.js",</span></pre><pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.213.1">
  "test": "echo \"Error: no test specified\" &amp;&amp; exit</span></pre><pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.214.1">
    1"</span></pre><pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.215.1">
}</span></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.216.1">At this point, we can conveniently run the script using </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.217.1">npm start</span></strong><span class="koboSpan" id="kobo.218.1">. </span><span class="koboSpan" id="kobo.218.2">For recent Node.js versions (</span><em class="italic" lang=""><span class="koboSpan" id="kobo.219.1">15</span></em><span class="koboSpan" id="kobo.220.1"> or later), the output should be </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.221.1">as follows:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.222.1">$ npm start</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.223.1">&gt; example01@1.0.0 start</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.224.1">&gt; node index.js</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.225.1">Conditional assignment 2</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.226.1">However, if we </span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.227.1">try to run the code with Node.js </span><em class="italic" lang=""><span class="koboSpan" id="kobo.228.1">14</span></em><span class="koboSpan" id="kobo.229.1">, we’ll get </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.230.1">an error:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.231.1">$ npm start</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.232.1">&gt; example01@1.0.0 start /home/node/examples/example01</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.233.1">&gt; node index.js</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.234.1">/home/node/examples/example01/index.js:4</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.235.1">x &amp;&amp;= y;</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.236.1">  ^^^</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.237.1">SyntaxError: Unexpected token '&amp;&amp;='</span></strong></pre></li>
</ol>
<p lang="en-GB"><span class="koboSpan" id="kobo.238.1">Now, if you want this to run, you can switch the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.239.1">start</span></strong><span class="koboSpan" id="kobo.240.1"> script of </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.241.1">package.json</span></strong><span class="koboSpan" id="kobo.242.1"> to use </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.243.1">babel-node</span></strong><span class="koboSpan" id="kobo.244.1"> instead of the standard </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.245.1">node</span></strong><span class="koboSpan" id="kobo.246.1">. </span><span class="koboSpan" id="kobo.246.2">Trying this, however, will not work. </span><span class="koboSpan" id="kobo.246.3">The reason is that, by default, Babel does not understand the current environment and, therefore, cannot apply </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.247.1">the transformations.</span></span></p>
<ol>
<li lang="en-GB" value="7"><span class="koboSpan" id="kobo.248.1">For Babel to actually understand it, we need to use the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.249.1">@babel/preset-env</span></strong><span class="koboSpan" id="kobo.250.1"> package. </span><span class="koboSpan" id="kobo.250.2">This is a preset that represents a collection of plugins. </span><span class="koboSpan" id="kobo.250.3">In this case, the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.251.1">env</span></strong><span class="koboSpan" id="kobo.252.1"> preset is a special one that intelligently looks for the right plugins depending on the current environment. </span><span class="koboSpan" id="kobo.252.2">Let’s first </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.253.1">install it:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.254.1">$ npm install @babel/preset-env --save-dev</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.255.1">Afterward, we can integrate it by creating a </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.256.1">new file:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.257.1">          .babelrc</span></p>
<pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.258.1">
{

  "presets": [["@babel/preset-env"]]

}</span></pre>
<ol>
<li lang="en-GB" value="9"><span class="koboSpan" id="kobo.259.1">The file has to be placed next to </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.260.1">package.json</span></strong><span class="koboSpan" id="kobo.261.1">. </span><span class="koboSpan" id="kobo.261.2">Once there, Babel will automatically</span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.262.1"> load the file and take its content as configuration input. </span><span class="koboSpan" id="kobo.262.2">Now the output matches </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.263.1">our expectations:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.264.1">$ npm start</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.265.1">&gt; example01@1.0.0 start</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.266.1">  /home/rapplf/Code/Articles/Node.js-for-Frontend-</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.267.1">  Developers/Chapter04/example01</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.268.1">&gt; babel-node index.js</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.269.1">Conditional assignment 2</span></strong></pre></li>
</ol>
<p lang="en-GB"><span class="koboSpan" id="kobo.270.1">With these instructions, you are now able to run modern code, even on older versions of Node.js. </span><span class="koboSpan" id="kobo.270.2">The preceding example did finally run in Node.js </span><em class="italic" lang=""><span class="koboSpan" id="kobo.271.1">14</span></em><span class="koboSpan" id="kobo.272.1"> – even though this version does not support the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.273.1">&amp;&amp;=</span></strong><span class="koboSpan" id="kobo.274.1"> new </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.275.1">assignment operator.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.276.1">There are many different packages that work together with Babel. </span><span class="koboSpan" id="kobo.276.2">Full languages or language extensions have been written for Babel. </span><span class="koboSpan" id="kobo.276.3">One of those extensions </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.277.1">is Flow.</span></span></p>
<h1 id="_idParaDest-47" lang="en-GB"><a id="_idTextAnchor046"/><span class="koboSpan" id="kobo.278.1">Using Flow</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.279.1">Flow is </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.280.1">mainly</span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.281.1"> a </span><strong class="bold" lang=""><span class="koboSpan" id="kobo.282.1">static type checker</span></strong><span class="koboSpan" id="kobo.283.1"> for JavaScript code. </span><span class="koboSpan" id="kobo.283.2">The purpose of a static type checker is to ensure at build time that everything works together as it should. </span><span class="koboSpan" id="kobo.283.3">As a result, we should see a lot fewer errors at runtime. </span><span class="koboSpan" id="kobo.283.4">In fact, proper usage of a static type checker will essentially eliminate all simple bugs and let us focus on solving the algorithmic and behavioral issues that would </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.284.1">arise anyway.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.285.1">In Flow, every JavaScript file can be changed to a Flow file. </span><span class="koboSpan" id="kobo.285.2">All that needs to be done is to introduce the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.286.1">@flow</span></strong><span class="koboSpan" id="kobo.287.1"> comment. </span><span class="koboSpan" id="kobo.287.2">A simple example is </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.288.1">as follows:</span></span></p>
<pre class="source-code" lang="en-GB"><span class="koboSpan" id="kobo.289.1">// @flow
function square(n: number): number {
  return n * n;
}
square("2"); // Error!</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.290.1">Even though </span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.291.1">the code would work pretty well in standard JavaScript, Flow will help us by raising an error in the last line. </span><span class="koboSpan" id="kobo.291.2">The </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.292.1">square</span></strong><span class="koboSpan" id="kobo.293.1"> function has been annotated using types for the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.294.1">n</span></strong><span class="koboSpan" id="kobo.295.1"> input argument and the return value. </span><span class="koboSpan" id="kobo.295.2">The colon notation separates the identifier or function head from the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.296.1">specified type.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.297.1">Since the colon notation is not part of the JavaScript standard, we cannot just run the preceding code. </span><span class="koboSpan" id="kobo.297.2">Instead, we can use Babel together with the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.298.1">@babel/preset-flow</span></strong><span class="koboSpan" id="kobo.299.1"> package to strip away the Flow type annotations – keeping only the JavaScript that Node.js </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.300.1">can understand.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.301.1">Let’s test this with a </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.302.1">new project:</span></span></p>
<ol>
<li lang="en-GB" value="1"><span class="koboSpan" id="kobo.303.1">We start in a new directory by initializing an </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.304.1">npm</span></strong><span class="koboSpan" id="kobo.305.1"> project and installing the necessary </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.306.1">development dependencies:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.307.1">$ npm init -y</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.308.1">$ npm install @babel/core @babel/node @babel/preset-</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.309.1">  flow --save-dev</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.310.1">Now, we configure Babel and change the </span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.311.1">package.json</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.312.1"> file:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.313.1">          .babelrc</span></p>
<pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.314.1">
{

  "presets": ["@babel/preset-flow"]

}</span></pre>
<ol>
<li lang="en-GB" value="3"><span class="koboSpan" id="kobo.315.1">In </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.316.1">package.json</span></strong><span class="koboSpan" id="kobo.317.1">, we need to add a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.318.1">start</span></strong><span class="koboSpan" id="kobo.319.1"> field to the </span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.320.1">scripts</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.321.1"> section:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.322.1">          package.json</span></p>
<pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.323.1">
{

  "name": "example02",

  "version": "1.0.0",

  "scripts": {

    "start": "babel-node index.js"

  },

  "devDependencies": {

    "@babel/core": "^7.18.5",

    "@babel/node": "^7.18.5",

    "@babel/preset-flow": "^7.17.12"

  }

}</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.324.1">Now, running </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.325.1">npm start</span></strong><span class="koboSpan" id="kobo.326.1"> should work without any error message. </span><span class="koboSpan" id="kobo.326.2">However, if we run </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.327.1">node index.js</span></strong><span class="koboSpan" id="kobo.328.1">, then we’ll actually face an error. </span><span class="koboSpan" id="kobo.328.2">Still, shouldn’t we also face an error in </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.329.1">this case?</span></span></p>
<ol>
<li lang="en-GB" value="4"><span class="koboSpan" id="kobo.330.1">Well, as </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.331.1">mentioned, the Babel part is only for running. </span><span class="koboSpan" id="kobo.331.2">The installed preset only understands and removes the type annotations. </span><span class="koboSpan" id="kobo.331.3">It does not do the actual type checking. </span><span class="koboSpan" id="kobo.331.4">For this, we need to install another package </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.332.1">called </span></span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.333.1">flow-bin</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.334.1">:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.335.1">$ npm install flow-bin --save-dev</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.336.1">We can run </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.337.1">flow</span></strong><span class="koboSpan" id="kobo.338.1"> with the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.339.1">npx</span></strong><span class="koboSpan" id="kobo.340.1"> runner that comes already with </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.341.1">npm</span></strong><span class="koboSpan" id="kobo.342.1">. </span><span class="koboSpan" id="kobo.342.2">First, we initialize </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.343.1">the project:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.344.1">$ npx flow init</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.345.1">Then, we can type-check </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.346.1">our solution:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.347.1">$ npx flow</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.348.1">Launching Flow server for</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.349.1">  /home/node/examples/example02</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.350.1">Spawned flow server (pid=13278)</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.351.1">Logs will go to /tmp/flow/example02.log</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.352.1">Monitor logs will go to</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.353.1">  /tmp/flow/example02.monitor_log</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.354.1">Error </span><span class="koboSpan" id="kobo.355.1"><img alt="" src="image/011.png"/></span><span class="koboSpan" id="kobo.356.1"> index.js:6:8</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.357.1">Cannot call square with "2" bound to n because string</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.358.1"> [1] is incompatible with number [2]. </span><span class="koboSpan" id="kobo.358.2">[incompatible-</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.359.1"> call]</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.360.1"> [2] 2│ function square(n: number): number {</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.361.1">     3│   return n * n;</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.362.1">     4│ }</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.363.1">     5│</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.364.1"> [1] 6│ square("2"); // Error!</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.365.1">     7│</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.366.1">Found 1 error</span></strong></pre></li>
</ol>
<p lang="en-GB"><span class="koboSpan" id="kobo.367.1">As expected, the call </span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.368.1">does not satisfy the type checks. </span><span class="koboSpan" id="kobo.368.2">This is great for our own code, but it is even better for using third-party libraries. </span><span class="koboSpan" id="kobo.368.3">With type checking, we can be sure that we use the provided APIs correctly. </span><span class="koboSpan" id="kobo.368.4">Not only now but also in the future when we install an update for </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.369.1">third-party libraries.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.370.1">Unfortunately, not every package comes with </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.371.1">flow</span></strong><span class="koboSpan" id="kobo.372.1">-type annotations. </span><span class="koboSpan" id="kobo.372.2">However, the situation looks a bit more promising for a quite similar tool </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.373.1">called TypeScript.</span></span></p>
<h1 id="_idParaDest-48" lang="en-GB"><a id="_idTextAnchor047"/><span class="koboSpan" id="kobo.374.1">Using TypeScript</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.375.1">TypeScript is a full</span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.376.1"> programming language that was designed as a superset of JavaScript. </span><span class="koboSpan" id="kobo.376.2">The basic idea was to start with JavaScript, enhance it with missing parts such as types, classes, or enums, and choose JavaScript as a transpilation target for the language. </span><span class="koboSpan" id="kobo.376.3">Over the years, many of the features that were first introduced in the TypeScript language also made it to the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.377.1">JavaScript language.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.378.1">Today, TypeScript</span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.379.1"> is the most popular way to write large-scale JavaScript projects. </span><span class="koboSpan" id="kobo.379.2">Nearly every package on the official </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.380.1">npm</span></strong><span class="koboSpan" id="kobo.381.1"> registry comes with TypeScript-compatible type annotations – either within the package or in a dedicated package. </span><span class="koboSpan" id="kobo.381.2">As an example, the type annotations for the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.382.1">react</span></strong><span class="koboSpan" id="kobo.383.1"> package can be found in the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.384.1">@</span></strong><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.385.1">types/react</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.386.1"> package.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.387.1">To use TypeScript, we need to install the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.388.1">typescript</span></strong><span class="koboSpan" id="kobo.389.1"> package. </span><span class="koboSpan" id="kobo.389.2">This contains the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.390.1">tsc</span></strong><span class="koboSpan" id="kobo.391.1"> script, which gives us the ability to check types and transpile TypeScript files written using the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.392.1">.ts</span></strong><span class="koboSpan" id="kobo.393.1"> or </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.394.1">.</span></strong><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.395.1">tsx</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.396.1"> extension.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.397.1">Let’s go ahead and create a new project, install </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.398.1">typescript</span></strong><span class="koboSpan" id="kobo.399.1">, and add a </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.400.1">source file:</span></span></p>
<ol>
<li lang="en-GB" value="1"><span class="koboSpan" id="kobo.401.1">We start with the project creation. </span><span class="koboSpan" id="kobo.401.2">In a new directory, run </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.402.1">the following:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.403.1">$ npm init -y</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.404.1">$ npm install typescript --save-dev</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.405.1">Let’s add an </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.406.1">index.ts</span></strong><span class="koboSpan" id="kobo.407.1"> file with </span><a id="_idIndexMarker141"/><span class="koboSpan" id="kobo.408.1">content similar to the example </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.409.1">for Flow:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.410.1">          index.ts</span></p>
<pre class="console" lang="en-GB"><span class="koboSpan" id="kobo.411.1">
function square(n: number): number {

  return n * n;

}

square("2"); // Error!</span></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.412.1">The content of the file is pretty much the same as beforehand, however, the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.413.1">@flow</span></strong><span class="koboSpan" id="kobo.414.1"> comment </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.415.1">is missing.</span></span></p>
<ol>
<li lang="en-GB" value="3"><span class="koboSpan" id="kobo.416.1">We can now run this directly via the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.417.1">tsc</span></strong><span class="koboSpan" id="kobo.418.1"> command, which has been installed together with the </span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.419.1">typescript</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.420.1"> package:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.421.1">$ npx tsc index.ts</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.422.1">index.ts:5:8 - error TS2345: Argument of type 'string'</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.423.1">  is not assignable to parameter of type 'number'.</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.424.1">5 square("2"); // Error!</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.425.1">         ~~~</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.426.1">Found 1 error in index.ts:5</span></strong></pre></li>
</ol>
<p lang="en-GB"><span class="koboSpan" id="kobo.427.1">In comparison</span><a id="_idIndexMarker142"/><span class="koboSpan" id="kobo.428.1"> to the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.429.1">flow</span></strong><span class="koboSpan" id="kobo.430.1"> tool, </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.431.1">tsc</span></strong><span class="koboSpan" id="kobo.432.1"> does a bit more. </span><span class="koboSpan" id="kobo.432.2">It does not only do the type checking but it will also produce output files. </span><span class="koboSpan" id="kobo.432.3">What it does not do is run the code. </span><span class="koboSpan" id="kobo.432.4">The immediate evaluation functionality of </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.433.1">@babel/node</span></strong><span class="koboSpan" id="kobo.434.1"> can be found in the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.435.1">ts-node</span></strong><span class="koboSpan" id="kobo.436.1"> package, which works quite similarly to its </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.437.1">Babel counterpart.</span></span></p>
<ol>
<li lang="en-GB" value="4"><span class="koboSpan" id="kobo.438.1">By default, </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.439.1">tsc</span></strong><span class="koboSpan" id="kobo.440.1"> tries to convert a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.441.1">.ts</span></strong><span class="koboSpan" id="kobo.442.1"> or </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.443.1">.tsx</span></strong><span class="koboSpan" id="kobo.444.1"> input file to some new files: a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.445.1">.js</span></strong><span class="koboSpan" id="kobo.446.1"> and </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.447.1">.d.ts</span></strong><span class="koboSpan" id="kobo.448.1"> file. </span><span class="koboSpan" id="kobo.448.2">Even in the case of failed type checks, these files might be produced. </span><span class="koboSpan" id="kobo.448.3">The </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.449.1">.js</span></strong><span class="koboSpan" id="kobo.450.1"> file will be written by default, that is, with every use of </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.451.1">tsc</span></strong><span class="koboSpan" id="kobo.452.1">, unless we tell TypeScript to not emit the output. </span><span class="koboSpan" id="kobo.452.2">The </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.453.1">.d.ts</span></strong><span class="koboSpan" id="kobo.454.1"> file will only be written if we also enable the creation of declarations. </span><span class="koboSpan" id="kobo.454.2">Looking at the directory after we’ve run the previous example will reveal two </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.455.1">new files:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.456.1">$ ls -l</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.457.1">-rw-r--r-- 1   64 index.js</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.458.1">-rw-r--r-- 1   79 index.ts</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.459.1">drwxr-xr-x 4 4096 node_modules</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.460.1">-rw-r--r-- 1  387 package-lock.json</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.461.1">-rw-r--r-- 1  278 package.json</span></strong></pre></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.462.1">Having the additional JavaScript is needed to actually run the code. </span><span class="koboSpan" id="kobo.462.2">This also applies to TypeScript being written for the browser. </span><span class="koboSpan" id="kobo.462.3">Since no browser understands TypeScript code, we need to transpile it to JavaScript beforehand. </span><span class="koboSpan" id="kobo.462.4">Like Babel, we can actually transpile for different versions of the </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.463.1">JavaScript standard.</span></span></li>
<li lang="en-GB"><span class="koboSpan" id="kobo.464.1">In </span><a id="_idIndexMarker143"/><span class="koboSpan" id="kobo.465.1">order to keep your code repository clean, you should not use TypeScript as shown earlier. </span><span class="koboSpan" id="kobo.465.2">Instead, a much better way is to introduce a </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.466.1">tsconfig.json</span></strong><span class="koboSpan" id="kobo.467.1"> file, which you should place adjacent to the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.468.1">package.json</span></strong><span class="koboSpan" id="kobo.469.1">. </span><span class="koboSpan" id="kobo.469.2">This way, you can not only properly define the target JavaScript version but also a destination directory where the transpilation output should be placed. </span><span class="koboSpan" id="kobo.469.3">The destination directory can then be ignored in your version </span><a id="_idIndexMarker144"/><span class="No-Break" lang=""><span class="koboSpan" id="kobo.470.1">control system:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.471.1">          tsconfig.json</span></p>
<pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.472.1">{</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.473.1">  "compilerOptions": {</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.474.1">    "target": "es6",</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.475.1">    "outDir": "./dist"</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.476.1">  },</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.477.1">  "include": [</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.478.1">    "./src"</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.479.1">  ],</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.480.1">  "exclude": [</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.481.1">    "node_modules"</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.482.1">  ]</span></strong>
<strong class="bold" lang=""><span class="koboSpan" id="kobo.483.1">}</span></strong></pre>
<p lang="en-GB"><span class="koboSpan" id="kobo.484.1">In the configuration, we indicated an </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.485.1">src</span></strong><span class="koboSpan" id="kobo.486.1"> directory as the root for the transpilation. </span><span class="koboSpan" id="kobo.486.2">Every </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.487.1">.ts</span></strong><span class="koboSpan" id="kobo.488.1"> and </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.489.1">.tsx</span></strong><span class="koboSpan" id="kobo.490.1"> file inside will be transpiled. </span><span class="koboSpan" id="kobo.490.2">The output will be available in the </span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.491.1">dist</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.492.1"> directory.</span></span></p>
<ol>
<li lang="en-GB" value="7"><span class="koboSpan" id="kobo.493.1">Now, you</span><a id="_idIndexMarker145"/><span class="koboSpan" id="kobo.494.1"> can just move </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.495.1">index.ts</span></strong><span class="koboSpan" id="kobo.496.1"> inside a new </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.497.1">src</span></strong><span class="koboSpan" id="kobo.498.1"> subfolder and try running </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.499.1">tsc</span></strong><span class="koboSpan" id="kobo.500.1"> again. </span><span class="koboSpan" id="kobo.500.2">The same error pops up, but instead of creating the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.501.1">index.js</span></strong><span class="koboSpan" id="kobo.502.1"> adjacent to the </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.503.1">index.ts</span></strong><span class="koboSpan" id="kobo.504.1"> file, the output would appear in the </span><span class="No-Break" lang=""><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.505.1">dist</span></strong></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.506.1"> folder:</span></span><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.507.1">$ npx tsc</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.508.1">src/index.ts:5:8 - error TS2345: Argument of type</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.509.1">  'string' is not assignable to parameter of type</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.510.1">  'number'.</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.511.1">5 square("2"); // Error!</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.512.1">         ~~~</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.513.1">Found 1 error in src/index.ts:5</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.514.1">$ ls -l dist/</span></strong></pre><pre class="console" lang="en-GB">
<strong class="bold" lang=""><span class="koboSpan" id="kobo.515.1">-rw-r--r-- 1   64 index.js</span></strong></pre></li>
</ol>
<p lang="en-GB"><span class="koboSpan" id="kobo.516.1">Today, most libraries that are published on the public </span><strong class="source-inline" lang=""><span class="koboSpan" id="kobo.517.1">npm</span></strong><span class="koboSpan" id="kobo.518.1"> registry will be created using TypeScript. </span><span class="koboSpan" id="kobo.518.2">This not only prevents some unnecessary bugs but also makes the experience for consumers of the library </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.519.1">much better.</span></span></p>
<h1 id="_idParaDest-49" lang="en-GB"><a id="_idTextAnchor048"/><span class="koboSpan" id="kobo.520.1">Summary</span></h1>
<p lang="en-GB"><span class="koboSpan" id="kobo.521.1">In this chapter, you learned how to use different flavors of JavaScript with Node.js. </span><span class="koboSpan" id="kobo.521.2">You have seen how Babel can be installed, configured, and used to transpile your code to the JavaScript standard supported by the target version </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.522.1">of Node.js.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.523.1">Right now, you should also know the basics of the most important JavaScript flavors: Flow and TypeScript. </span><span class="koboSpan" id="kobo.523.2">We discussed how they can be installed and configured. </span><span class="koboSpan" id="kobo.523.3">Of course, to practically use these flavors, you’ll need additional material to learn their syntax and master the concepts behind these languages. </span><span class="koboSpan" id="kobo.523.4">A good book to learn TypeScript is </span><em class="italic" lang=""><span class="koboSpan" id="kobo.524.1">Mastering TypeScript</span></em><span class="koboSpan" id="kobo.525.1"> by </span><span class="No-Break" lang=""><em class="italic" lang=""><span class="koboSpan" id="kobo.526.1">Nathan Rozentals</span></em></span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.527.1">.</span></span></p>
<p lang="en-GB"><span class="koboSpan" id="kobo.528.1">In the next chapter, we will discuss a quite important area of tooling – applications that can give our code improved consistency </span><span class="No-Break" lang=""><span class="koboSpan" id="kobo.529.1">and validation.</span></span></p>
</div>
</body></html>