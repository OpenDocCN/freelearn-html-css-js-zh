<html><head></head><body><div class="chapter" title="Chapter&#xA0;11.&#xA0;Highcharts Events"><div class="titlepage"><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Highcharts Events</h1></div></div></div><p>In the previous chapter, we learned about the Highcharts API. In this chapter, we will go through Highcharts events handling. We will start the chapter by introducing the set of events supported by Highcharts. Then, we will build two web applications to cover most of the events; each one explores a different set of events. Although the applications are far from perfect and there is plenty of room for improvement, the sole purpose is to demonstrate how Highcharts events work. In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Launching an Ajax query with a chart <code class="literal">load</code> event</li><li class="listitem" style="list-style-type: disc">Activating the user interface with a chart <code class="literal">redraw</code> event</li><li class="listitem" style="list-style-type: disc">Selecting and unselecting a data point with the point <code class="literal">select</code> and <code class="literal">unselect</code> events</li><li class="listitem" style="list-style-type: disc">Zooming the selected area with the chart selection event</li><li class="listitem" style="list-style-type: disc">Hovering over a data point with the point <code class="literal">mouseover</code> and <code class="literal">mouseout</code> events</li><li class="listitem" style="list-style-type: disc">Using the chart <code class="literal">click</code> event to create plot lines</li><li class="listitem" style="list-style-type: disc">Launching a dialog with the series <code class="literal">click</code> event</li><li class="listitem" style="list-style-type: disc">Launching a pie chart with the series <code class="literal">checkboxClick</code> event</li><li class="listitem" style="list-style-type: disc">Editing the pie chart with the point <code class="literal">click</code>, <code class="literal">update</code>, and <code class="literal">remove</code> events</li></ul></div><div class="section" title="Introducing Highcharts events"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec69"/>Introducing Highcharts events</h1></div></div></div><p>By now, we have gone<a id="id778" class="indexterm"/> through most of the Highcharts configurations, but there is one area not yet covered: event handling. Highcharts offers a set of event options in several areas such as chart events, series events, and axis base events; they are triggered by API calls and user interactions with the chart.</p><p>Highcharts events can be specified through object configuration while creating a chart or through APIs that accept object configurations, such as <code class="literal">Chart.addSeries</code>, <code class="literal">Axis.addPlotLine</code>, and <code class="literal">Axis.addPlotBand</code>.</p><p>An event object is passed by an event handler that contains mouse information and specific action data related to the event action. For example, <code class="literal">event.xAxis[0]</code> and <code class="literal">event.yAxis[0]</code> are stored in the event parameter for the <code class="literal">chart.events.click</code> handler. Inside each event function, the <code class="literal">'this'</code> keyword can be used and refers to a Highcharts component where the event function is based. For example, the <code class="literal">'this'</code> keyword in <code class="literal">chart.events.click</code> refers to the <code class="literal">chart</code> object, and the <code class="literal">'this'</code> keyword in <code class="literal">plotOptions.series.events.click</code> refers to the <code class="literal">series</code> object being clicked.</p><p>The following is a list of <a id="id779" class="indexterm"/>Highcharts events:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">chart.events</code>: <code class="literal">addSeries</code>, <code class="literal">click</code>, <code class="literal">load</code>, <code class="literal">redraw</code>, <code class="literal">selection</code>, <code class="literal">drilldown</code>, and <code class="literal">drillup</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">plotOptions.&lt;series-type&gt;.events</code>: <code class="literal">click</code>, <code class="literal">checkboxClick</code>, <code class="literal">hide</code>, <code class="literal">mouseover</code>, <code class="literal">mouseout</code>, <code class="literal">show</code>, <code class="literal">afterAnimate</code>, and <code class="literal">legendItemClick</code><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>Alternatively, we can specify event options specifically to a series in the series array, such as: <code class="literal">series[ { events: click: function { ... }, .... } ]</code>.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">plotOptions.&lt;series-type&gt;.point.events</code>: <code class="literal">click</code>, <code class="literal">mouseover</code>, <code class="literal">mouseout</code>, <code class="literal">remove</code>, <code class="literal">select</code>, <code class="literal">unselect</code>, <code class="literal">update</code>, and <code class="literal">legendItemClick</code><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>We can define point events for a specific series, as follows: <code class="literal">series[ { point : { events: { click: function() { ... } }, ... } ]</code>.</p><p>As for defining events for a particular data point in a series, we can specify them as follows: <code class="literal">series[ { data: [ { events: { click: function() { ... } } ], ... } ]</code>.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">x/yAxis.events</code>: <code class="literal">setExtremes</code>, and <code class="literal">afterSetExtremes</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">x/yAxis.plotBands[x].events</code> and <code class="literal">x/yAxis.plotLines[x].events</code>: <code class="literal">click</code>, <code class="literal">mouseover</code>, <code class="literal">mousemove</code>, and <code class="literal">mouseout</code></li></ul></div><p>The Highcharts online documentation provides a comprehensive reference and plenty of mini examples; you are strongly advised to refer to that. There is not much point in repeating the same exercise. Instead, we will build two slightly sizable examples to utilize most of the Highcharts events and demonstrate how these events can work together in an application. Since the complete example code is too long to list in this chapter, only the relevant parts are edited and shown.</p><p>The full demo and source code can be <a id="id780" class="indexterm"/>found at <a class="ulink" href="http://www.joekuan.org/Learning_Highcharts/Chapter_11/chart1.html">http://www.joekuan.org/Learning_Highcharts/Chapter_11/chart1.html</a>.</p></div></div>
<div class="section" title="Portfolio history example"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec70"/>Portfolio history example</h1></div></div></div><p>This application extends the <a id="id781" class="indexterm"/>historical stock chart in the previous chapter with an additional investment portfolio feature. The frontend is implemented with jQuery and jQuery UI, and the following events are covered in this example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">chart.events</code>: <code class="literal">click</code>, <code class="literal">load</code>, <code class="literal">redraw</code>, and <code class="literal">selection</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">plotOptions.series.points.events</code>: <code class="literal">mouseover</code>, <code class="literal">mouseout</code>, <code class="literal">select</code>, and <code class="literal">unselect</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">xAxis/yAxis.plotLines.events</code>: <code class="literal">mouseover</code> and <code class="literal">click</code></li></ul></div><p>The following is the startup screen of the demo, with the components labeled:</p><div class="mediaobject"><img src="graphics/7451OS_11_01.jpg" alt="Portfolio history example"/></div><p>The application contains a pair of time series charts. The bottom chart is the top-level graph that shows the entire historic price movement and points to when company shares are bought and sold. The top chart is the detail chart that zooms in to the finer details when a selected area is made in the bottom graph.</p><p>As soon as the web application is loaded in a browser, both charts are created. The top-level chart is configured with a load event that automatically requests a stock historic price and portfolio history from the web server.</p><p>The following screenshot<a id="id782" class="indexterm"/> shows a graph after the top-level chart is auto-loaded:</p><div class="mediaobject"><img src="graphics/7451OS_11_02.jpg" alt="Portfolio history example"/></div><p>There are circular and triangular data points on top of the top-level chart. These denote the trade history. The <span class="strong"><strong>B</strong></span> symbol indicates when the shares have been bought, whereas <span class="strong"><strong>S</strong></span> signifies when they are sold. The information below the top-level chart is the portfolio detail for the stock as of the current date.</p><p>If we click on one of these trade history points, the portfolio detail section is updated to reflect the investment history as of the selected date. Moreover, when we select an area, it zooms in and displays the stock price movement in the detail chart. There are other features involved in event handling and we will discuss them in later sections.</p><div class="section" title="The top-level chart"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec80"/>The top-level chart</h2></div></div></div><p>The following is the <a id="id783" class="indexterm"/>configuration code for the top-level <a id="id784" class="indexterm"/>chart (the bottom chart shows the entire historic price movement) and we store the <code class="literal">chart</code> object in the <code class="literal">myApp</code> namespace, as follows:</p><div class="informalexample"><pre class="programlisting">     $.myApp.topChart = new Highcharts.Chart({
         chart: {
             zoomType: 'x',
             spacingRight: 15,
             renderTo: 'top-container',
             events: {
                 // Load the default stock symbol of 
                 // the portfolio
                 load: function() {  ....  },

                 // The top level time series have
                 // been redrawn, enable the portfolio
                 // select box
                 redraw: function() { .... },

                 // Selection - get all the data points from
                 // the selection and populate into the 
                 // detail chart
                 selection: function(evt) {  ....  },
             }
         },
         title: { text: null },
         yAxis: {
             title: { text: null },
             gridLineWidth: 0,
             labels: { enabled: false }
         },
         tooltip: { enabled: false },
         xAxis: {
             title: { text: null },
             type: 'datetime'
         },
         series: [ ... ],
         legend: { enabled: false },
         credits: { enabled: false }
     });</pre></div><p>There is a lot going on in this configuration. The chart is defined with most of the features disabled, such as legend, title, tooltip, and <span class="emphasis"><em>y</em></span>-axis label. More importantly, the chart is configured with a <code class="literal">zoomType</code> option, which enables the chart to be zoomable along the <span class="emphasis"><em>x</em></span>-axis direction; hence, we can use the <code class="literal">select</code> event. The series array is composed of <a id="id785" class="indexterm"/>multiple series that also contain event configurations.</p><div class="section" title="Constructing the series configuration for a top-level chart"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec25"/>Constructing the series configuration for a top-level chart</h3></div></div></div><p>In the series array, multiple series <a id="id786" class="indexterm"/>are defined with close and open price, bought and sold trade dates, and a hidden series for tracking mouse movement in the detail chart:</p><div class="informalexample"><pre class="programlisting">        series: [{
             // Past closed price series  
             type: 'areaspline',
             marker: { enabled: false },
             enableMouseTracking: false
        }, {                   
             // This is the open price series and never shown
             // in the bottom chart. We use it to copy this
             // to the detail chart
             visible: false
        }, {
             // Series for date and price when shares 
             // are bought
             type: 'scatter',
             allowPointSelect: true,
             color: $.myApp.boughtColor,
             dataLabels: {
                 enabled: true,
                 formatter: function() { return 'B'; }
             },
             point: {
                 events: { .... }
             }
        }, {
             // Series for date and price when shares are sold
             type: 'scatter',
             allowPointSelect: true,
             color: $.myApp.soldColor,
             dataLabels: {
                 enabled: true,
                 formatter: function() { return 'S'; }
             },
             point: {
                 events: { .... }
             }
        }, {
             // This is the tracker series to show a single 
             // data point of where the mouse is hovered on 
             // the detail chart 
             type: 'scatter',
             color: '#AA4643'
         }]</pre></div><p>The first series<a id="id787" class="indexterm"/> is the historic stock price series and is configured without data point markers. The second series is hidden and acts as a placeholder for historic open price data in the detail chart. The third (bought) and fourth (sold) series are the scatter series revealing the dates when shares have been traded. Both series are set with the <code class="literal">allowPointSelect</code> option, so that we can define the <code class="literal">select</code> and <code class="literal">unselect</code> events in the <code class="literal">point.events</code> option. The final series is also a scatter series to reflect the mouse movement in the detail chart using the <code class="literal">mouseover</code> and <code class="literal">mouseout</code> events; we will see how all these are implemented later on.</p></div><div class="section" title="Launching an Ajax query with the chart load event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec26"/>Launching an Ajax query with the chart load event</h3></div></div></div><p>As mentioned earlier, once <a id="id788" class="indexterm"/>the top-level chart is created and loaded on to the browser, it is ready to fetch the data from the server. The following is the chart's <code class="literal">load</code> event handler definition:</p><div class="informalexample"><pre class="programlisting">     chart: {
         events: { 
             load: function() {
                 // Load the default stock symbol of 
                 // the portfolio
                 var symbol = $('#symbol').val();
                 $('#symbol').attr('disabled', true);
                 loadPortfolio(symbol);
             },</pre></div><p>We first retrieve the value from the <span class="strong"><strong>My Portfolio</strong></span> selection box and disable the selection box during the query time. Then, we call a predefined function, <code class="literal">loadPortfolio</code>. The method performs several tasks, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launching an Ajax call, <code class="literal">$.getJSON</code>, to load the past stock price and portfolio data.</li><li class="listitem">Setting up a handler for the returned Ajax result that further executes the following steps:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Hiding the chart loading mask.</li><li class="listitem">Unpacking the returned data and populating series data with it using the <code class="literal">Series.setData</code> method.</li><li class="listitem">Updating the data in the <span class="strong"><strong>Portfolio Detail</strong></span> section to show how much the <a id="id789" class="indexterm"/>investment is worth as of the current date.</li></ol></div></li></ol></div></div><div class="section" title="Activating the user interface with the chart redraw event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec27"/>Activating the user interface with the chart redraw event</h3></div></div></div><p>Once the top-level <a id="id790" class="indexterm"/>chart is populated with data, we can then enable the <span class="strong"><strong>My Portfolio</strong></span> selection box on the page. To do that, we can rely on the <code class="literal">redraw</code> event, which is triggered by the <code class="literal">Series.setData</code> call in sub-step 2 inside step 2:</p><div class="informalexample"><pre class="programlisting">       redraw: function() {
           $('#symbol').attr('disabled', false);  
       },</pre></div></div><div class="section" title="Selecting and unselecting a data point with the point select and unselect events"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec28"/>Selecting and unselecting a data point with the point select and unselect events</h3></div></div></div><p>The bought and<a id="id791" class="indexterm"/> sold <a id="id792" class="indexterm"/>series share the same events handling; the only differences between them are the color and the point marker shape. The idea is that, when the user clicks on a data point in these series, the <span class="strong"><strong>Portfolio Detail</strong></span> section is updated to show the investment detail for the stock as of the trade date. The following screenshot shows the effect after the first bought trade point is selected:</p><div class="mediaobject"><img src="graphics/7451OS_11_03.jpg" alt="Selecting and unselecting a data point with the point select and unselect events"/></div><p>In order to<a id="id793" class="indexterm"/> keep the data <a id="id794" class="indexterm"/>point selected, we will use the <code class="literal">allowPointSelect</code> option, which allows us to define the <code class="literal">select</code> and <code class="literal">unselect</code> events. The following is the events configuration for the bought and sold series:</p><div class="informalexample"><pre class="programlisting">        point: {
            events: {
                select: function() {
                    updatePortfolio(this.x);
                },
                unselect: function() {
                    // Only default back to current time
                    // portfolio detail when unselecting
                    // itself
                    var selectPt =          
                        $.myApp.topChart.getSelectedPoints();
                    if (selectPt[0].x == this.x) {
                        updatePortfolio(new Date().getTime());
                    }
                }
            }
        }</pre></div><p>Basically, the <code class="literal">select</code> event handler calls a predefined function, <code class="literal">updatePortfolio</code>, that updates the <span class="strong"><strong>Portfolio Detail</strong></span> section based on the selected data point time: <code class="literal">this.x</code>. The <code class="literal">'this'</code> keyword in the handler refers to the selected point object, where <code class="literal">x</code> is the time value.</p><p>Unselecting the data point will call the <code class="literal">unselect</code> event handler. The preceding implementation means that, if the unselected data point (<code class="literal">this.x</code>) is the same as the previously selected point, then it indicates that the user has unselected the same point, so we want to show the portfolio detail as of the current date. Otherwise it will do nothing because it means the user has selected another trade data point; thus, another <code class="literal">select</code> event call is made with a<a id="id795" class="indexterm"/> different <a id="id796" class="indexterm"/>date.</p></div><div class="section" title="Zooming the selected area with the chart selection event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec29"/>Zooming the selected area with the chart selection event</h3></div></div></div><p>The <code class="literal">selection</code> event forms the<a id="id797" class="indexterm"/> bridge between the top-level chart and the detail chart. When we select an area in the top-level chart, the selected area is highlighted and the data is zoomed in the detail chart. This action triggers the <code class="literal">selection</code> event and the following is the cut-down code of the event handler:</p><div class="informalexample"><pre class="programlisting">           selection: function(evt) {
               // Get the xAxis selection
               var selectStart = Math.round(evt.xAxis[0].min);
               var selectEnd   = Math.round(evt.xAxis[0].max);

               // We use plotBand to paint the selected area
               // to simulate a selected area
               this.xAxis[0].removePlotBand('selected');
               this.xAxis[0].addPlotBand({
                   color: 'rgba(69, 114, 167, 0.25)',
                   id: 'selected',
                   from: selectStart,
                   to: selectEnd
               });
               for (var i = 0; 
                    i &lt; this.series[0].data.length; i++) {
                  var pt = this.series[0].data[i];
                  if (pt.x &gt;= selectStart &amp;&amp; 
                      pt.x &lt;= selectEnd) {
                      selectedData.push([pt.x, pt.y]);
                  }
   
                  if (pt.x &gt; selectEnd) {
                      break;
                  }
               }

               // Update the detail serie 
               var dSeries = $.myApp.detailChart.series[0];               
               dSeries.setData(selectedData, false);
               ....

               // Update the detail chart title &amp; subtitle
               $.myApp.detailChart.setTitle({
                   text: $.myApp.stockName + " (" +
                         $.myApp.stockSymbol + ")",
                   style: { fontFamily: 'palatino, serif',
                            fontWeight: 'bold' }
                   }, {
                   text: Highcharts.dateFormat('%e %b %y', 
                         selectStart) + ' -- ' +
                         Highcharts.dateFormat('%e %b %y',
                         selectEnd),
                   style: { fontFamily: 'palatino, serif' }
               });

               $.myApp.detailChart.redraw();
               return false;
          }</pre></div><p>There are several steps <a id="id798" class="indexterm"/>taken in the handler code. First, we extract the selected range values from the handler parameters—<code class="literal">evt.xAxis[0].min</code> and <code class="literal">evt.xAxis[0].max</code>. The next step is to make the selected area stay highlighted in the top-level chart. To do that, we create a plot band using <code class="literal">this.xAxis[0].addPlotBand</code> over the same area to simulate the selection.</p><p>The <code class="literal">'this'</code> keyword refers to the top-level chart object. The next task is to give a fixed <code class="literal">id</code>, so that we can remove the old selection and highlight a new selection. Additionally, the plot band should have the same color as the selection being dragged on the chart. All we need to do is to assign the plot band color to be the same as the default value of the <code class="literal">chart.selectionMarkerFill</code> option.</p><p>After that, we copy the data within the selected range into an array and pass it to the detail chart using <code class="literal">Series.setData</code>. Since we called the <code class="literal">setData</code> method a couple of times, it is worth setting the <code class="literal">redraw</code> option to <code class="literal">false</code> to save resources and then calling the <code class="literal">redraw</code> method.</p><p>Finally, the most important step is to return <code class="literal">false</code> at the end of the function. Returning the <code class="literal">false</code> Boolean value tells Highcharts not to take the default action after the selection has been made. Otherwise the whole top-level chart is redrawn and stretched (alternatively, we can call <code class="literal">event.preventDefault()</code>).</p><p>The following screenshot zooms and displays the detail in another chart:</p><div class="mediaobject"><img src="graphics/7451OS_11_04.jpg" alt="Zooming the selected area with the chart selection event"/></div></div></div><div class="section" title="The detail chart"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec81"/>The detail chart</h2></div></div></div><p>The <a id="id799" class="indexterm"/>detail chart is simply a line chart showing the selected region<a id="id800" class="indexterm"/> from the top-level chart. The chart is configured with a tool tip fixed in the upper-left corner and a number of events that we will discuss later:</p><div class="informalexample"><pre class="programlisting">       $.myApp.detailChart = new Highcharts.Chart({
            chart: {
                showAxes: true,
                renderTo: 'detail-container',
                events: {
                    click: function(evt) {
                        // Only allow to prompt stop order
                        // dialog if the chart contains future
                        // time
                        ....
                    }
                },
             },
             title: {
                margin: 10,
                text: null
             },
             credits: { enabled: false },
             legend: {
                enabled: true,
                floating: true,
                verticalAlign: 'top',
                align: 'right'
             },
             series: [ ... ],
             // Fixed location tooltip in the top left
             tooltip: {
                shared: true,
                positioner: function() {
                    return { x: 10, y: 10 }
                },
                // Include 52 week high and low
                formatter: function() {  .... }
             },
             yAxis: {
                title: { text: 'Price' }
             },
             xAxis: { type: 'datetime' }
        });</pre></div><p>The following is <a id="id801" class="indexterm"/>a screenshot showing a data point being hovered over<a id="id802" class="indexterm"/> and the tool tip shown in the upper-left corner:</p><div class="mediaobject"><img src="graphics/7451OS_11_05.jpg" alt="The detail chart"/></div><div class="section" title="Constructing the series configuration for the detail chart"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec30"/>Constructing the series configuration for the detail chart</h3></div></div></div><p>There are two series <a id="id803" class="indexterm"/>configured in the detail chart. The main focus is the first series, which is the stock closed price. The series is defined without data point markers and has <code class="literal">'crosshair'</code> as the <code class="literal">cursor</code> option, as we can see in the preceding screenshot. In addition, the <code class="literal">mouseout</code> and <code class="literal">mouseover</code> events are defined for the data points that create a marker to the tracker series in the top-level chart. We will go through these events in the next section. The series array is defined as follows:</p><div class="informalexample"><pre class="programlisting">           series: [{
               marker: {
                   enabled: false,
                   states: {
                       hover: { enabled: true }
                   }
               },
               cursor: 'crosshair',
               point: {
                   events: {
                       mouseOver: function() { ... },
                       mouseOut: function() { ... }
                   }
               },
               stickyTracking: false,
               showInLegend: false
           }, {
               name: 'Open Price',
               marker: { enabled: false },
               visible: false
           }],</pre></div></div><div class="section" title="Hovering over a data point with the mouseover and mouseout point events"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec31"/>Hovering over a data point with the mouseover and mouseout point events</h3></div></div></div><p>When we move the <a id="id804" class="indexterm"/>mouse pointer along the series in the detail chart, the movement is also reflected in the top-level chart within the selected area. The following screenshot shows the tracker point (the inverted triangle) displayed in the top-level chart:</p><div class="mediaobject"><img src="graphics/7451OS_11_06.jpg" alt="Hovering over a data point with the mouseover and mouseout point events"/></div><p>The inverted triangle indicates where we are browsing in the top-level chart. To do that, we will set up the <code class="literal">mouseOut</code> and <code class="literal">mouseOver</code> point event options in the detail chart series, as follows:</p><div class="informalexample"><pre class="programlisting">        point: {
            events: {
                mouseOver: function() {
                    var series = $.myApp.topChart.series[4];
                    series.setData([]);
                    series.addPoint([this.x, this.y]);
                },
                mouseOut: function() {
                     var series = $.myApp.topChart.series[4];              
                     series.setData([]);
                }
            }
        },</pre></div><p>Inside the <code class="literal">mouseOver</code> handler, the <code class="literal">'this'</code> keyword refers to the hovered data point object and the <code class="literal">x</code> and <code class="literal">y</code> properties refer to the time and price values. Since both the top-level and detail charts<a id="id805" class="indexterm"/> share the same data type along both x and y axes, we can simply add a data point into the tracker series in the top-level chart. As for the <code class="literal">mouseOut</code> event, we reset the series by emptying the data array.</p></div><div class="section" title="Applying the chart click event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec32"/>Applying the chart click event</h3></div></div></div><p>In this section, we <a id="id806" class="indexterm"/>will apply the chart click event to create a <span class="emphasis"><em>stop order</em></span> for investment portfolios. <span class="strong"><strong>Stop order</strong></span><a id="id807" class="indexterm"/> is an investment term for selling or buying a stock when it reaches the price threshold within a specified date/time range in the future. It is generally used to limit a loss or protect a profit.</p><p>Notice that there is an empty space at the right-hand side of the top-level chart. In fact, this is deliberately created for the next 30-day range from the current date. Let's highlight that area, so that the future date appears in the detail chart:</p><div class="mediaobject"><img src="graphics/7451OS_11_07.jpg" alt="Applying the chart click event"/></div><p>As we can see, the<a id="id808" class="indexterm"/> line series in the detail chart stops as soon as it hits the current date. If we click on the zone for future dates in the detail chart, a <span class="strong"><strong>Create Stop Order</strong></span> dialog box appears. The x, y position of the click on the chart is then converted into date and price, which then populates the values into the dialog box. The following is the screenshot of the dialog box:</p><div class="mediaobject"><img src="graphics/7451OS_11_08.jpg" alt="Applying the chart click event"/></div><p>The expiry date and price<a id="id809" class="indexterm"/> fields can be further adjusted if necessary. Once the <span class="strong"><strong>Save Order</strong></span> button is clicked, a stop order is created and a pair of x and y plot lines are generated to mark the chart. The following is a screenshot showing two stop orders on the chart:</p><div class="mediaobject"><img src="graphics/7451OS_11_09.jpg" alt="Applying the chart click event"/></div><p>Let's see how all these <a id="id810" class="indexterm"/>actions can be derived from the code. First, the jQuery UI dialog is created based on an HTML form declared on the page:</p><div class="informalexample"><pre class="programlisting">  &lt;div id='dialog'&gt;
     &lt;form&gt;
        &lt;fieldset&gt;
           &lt;label for="expire"&gt;Expire at&lt;/label&gt;
           &lt;input type=text name="expire" id="expire" size=9 &gt;&lt;br/&gt;&lt;br/&gt;
           &lt;select name='stopOrder' id='stopOrder'&gt;
              &lt;option value='buy' selected&gt;Buy&lt;/option&gt;
              &lt;option value='sell'&gt;Sell&lt;/option&gt;
           &lt;/select&gt;
           &lt;label for="shares"&gt;no. of shares&lt;/label&gt;
           &lt;input type="text" name="shares" id="shares" value="" size=7 class="text ui-widget-content ui-corner-all" /&gt;,
           &lt;label for="price"&gt;when market price reaches (in pences)&lt;/label&gt;
           &lt;input type="text" name="price" id="price" value="" size=7 class="text ui-widget-content ui-corner-all" /&gt;
        &lt;/fieldset&gt;
     &lt;/form&gt;
  &lt;/div&gt;</pre></div><p>The <code class="literal">click</code> event handler for the detail chart is then defined, as follows:</p><div class="informalexample"><pre class="programlisting">           click: function(evt) {

               // Only allow to prompt stop order dialog
               // if the chart contains future time
               if (!$.myApp.detailChart.futureDate) {
                   return;
               }

               // Based on what we click on the time, set
               // input field inside the dialog
               $('#expire').val(
                   Highcharts.dateFormat("%m/%d/%y",
                   evt.xAxis[0].value));
               $('#price').val(
                   Highcharts.numberFormat(
                   evt.yAxis[0].value, 2));

               // Display the form to setup stop order
               $('#dialog').dialog("open");
           }</pre></div><p>The first guard <a id="id811" class="indexterm"/>condition is to see whether the detail chart contains any future dates. If a future date exists, then it extracts the x and y values from the <code class="literal">click</code> event and assigns them into the form input fields. After that, it calls the jQuery UI dialog method to lay out the HTML form in a dialog box and displays it.</p><p>The following code snippet shows how we define the jQuery UI dialog box and its action buttons. The code is edited for readability:</p><div class="informalexample"><pre class="programlisting">           // Initiate stop order dialog
           $( "#dialog" ).dialog({
              // Dialog startup configuration – 
              // dimension, modal, title, etc
              .... ,
              buttons: [{
                 text: "Save Order",
                 click: function() {
                     // Check whether this dialog is called
                     // with a stop order id. If not, then 
                     // assign a new stop order id
                     // Assign the dialog fields into an
                     // object - 'order' 
                     .... 
                     // Store the stop order 
                     $.myApp.stopOrders[id] = order; 
                     // Remove plotlines if already exist.
                     // This can happen if we modify a stop
                     // order point
                     var xAxis = $.myApp.detailChart.xAxis[0];
                     xAxis.removePlotLine(id);
                     var yAxis = $.myApp.detailChart.yAxis[0];
                     yAxis.removePlotLine(id);

                     // Setup events handling for both 
                     // x &amp; y axis plotlines
                     var events = {
                         // Change the mouse cursor to pointer
                         // when the mouse is hovered above 
                         // the plotlines
                         mouseover: function() { ... },

                         // Launch modify dialog when 
                         // click on a plotline
                         click: function(evt) { ... }
                     };
 
                     // Create the plot lines for the stop
                     // order
                     xAxis.addPlotLine({
                         value: order.expire,
                         width: 2,
                         events: events,
                         color: (order.stopOrder == 'buy') ? $.myApp.boughtColor : $.myApp.soldColor,
                         id: id,
                         // Over both line series and 
                         // plot line
                        zIndex: 3
                     });

                     yAxis.addPlotLine({
                         value: order.price,
                         width: 2,
                         color: (order.stopOrder == 'buy') ? $.myApp.boughtColor : $.myApp.soldColor,
                         id: id,                                 
                         zIndex: 3,
                         events: events,
                         label: {
                             text: ((order.stopOrder == 'buy') ? 'SO-B by (' : 'SO-S by (')  + Highcharts.dateFormat("%e %b %Y", parseInt(order.expire)) + ') @ ' + order.price,
                             align: 'right'
                         } 
                      });

                      $('#dialog').dialog("close");
                 }
              }, {
                 text: "Cancel",
                 click: function() {   
                      $('#dialog').dialog("close"); 
                 } 
              }]                           
           });</pre></div><p>The dialog box <a id="id812" class="indexterm"/>setup code is slightly more complicated. In the <span class="strong"><strong>Save Order</strong></span> button's handler, it performs several tasks, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">It extracts the input values from the dialog box.</li><li class="listitem">It checks whether the dialog box is opened with a specific stop order <code class="literal">id</code>. If not, then it assigns a new stop order <code class="literal">id</code> and stores the values with <code class="literal">id</code> into <code class="literal">$.myApp.stopOrders</code>.</li><li class="listitem">It removes any existing plot lines that match with <code class="literal">id</code>, in case we modify an existing stop order.</li><li class="listitem">It sets up the <code class="literal">click</code> and <code class="literal">mouseover</code> events handling for both x- and y-axis plot lines.</li><li class="listitem">It creates x and y plot lines in the detail chart with the events definitions constructed in step 4.</li></ol></div><p>One scenario with stop orders is that users may want to change or delete a stop order before the condition is fulfilled. Therefore, in step 4 the purpose of the <code class="literal">click</code> event on plot lines is to bring up a modify dialog box. Additionally, we want to change the mouse cursor to a pointer when hovering over the plot lines to show that it is clickable.</p></div><div class="section" title="Changing the mouse cursor over plot lines with the mouseover event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec33"/>Changing the mouse cursor over plot lines with the mouseover event</h3></div></div></div><p>To change the<a id="id813" class="indexterm"/> mouse cursor over the plot lines, we define the <code class="literal">mouseover</code> event handler, as follows:</p><div class="informalexample"><pre class="programlisting">         mouseover: function() {
             $.each(this.axis.plotLinesAndBands, 
                 function(idx, plot) {
                    if (plot.id == id) {
                        plot.svgElem.element.style.cursor =
                           'pointer';
                        return false;
                    }
                 }
             );
         },</pre></div><p>The <code class="literal">'this'</code> keyword contains an axis object that the hovered plot line belongs to. Since there can be multiple plot lines in each axis, we need to loop through the array of plot lines and plot bands that can be found in the <code class="literal">plotLinesAndBands</code> property inside the axis object. Once we have found the target plot line by matching <code class="literal">id</code>, we will dig into the internal element and set the cursor style to <code class="literal">'pointer'</code>. The following screenshot shows a mouse cursor hovered over the plot line:</p><div class="mediaobject"><img src="graphics/7451OS_11_10.jpg" alt="Changing the mouse cursor over plot lines with the mouseover event"/></div></div><div class="section" title="Setting up a plot line action with the click event"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl3sec34"/>Setting up a plot line action with the click event</h3></div></div></div><p>The <code class="literal">click</code> event for plot<a id="id814" class="indexterm"/> lines launches the <span class="strong"><strong>Modify Stop Order</strong></span> dialog box for a stop order:</p><div class="informalexample"><pre class="programlisting">           // Click on the prompt line
           click: function(evt) {
               // Retrieves the stop order object stored in
               // $.myApp.stopOrders                                      
               $('#dialog').dialog("option", 
                                   "stopOrderId", id);
               var stopOrder = $.myApp.stopOrders[id];

               // Put the settings into the stop order form
               $('#dialog').dialog("option", "title", 
                                   "Modify Stop Order");
               $('#price').val(
                   Highcharts.numberFormat(
                            stopOrder.price, 2));
                                     
               $('#stopOrder').val(stopOrder.stopOrder);
               $('#shares').val(stopOrder.shares);
               $('#expire').val(
                   Highcharts.dateFormat("%m/%d/%y", 
                            stopOrder.expire));

               // Add a remove button inside the dialog
               var buttons = 
                   $('#dialog').dialog("option", "buttons");
               buttons.push({
                   text: 'Remove Order',
                   click: function() {
                       // Remove plot line and stop order
                       // settings
                       delete $.myApp.stopOrders[id];
                       var xAxis =  
                           $.myApp.detailChart.xAxis[0];
                       xAxis.removePlotLine(id);
                       var yAxis =  
                           $.myApp.detailChart.yAxis[0];
                       yAxis.removePlotLine(id);
 
                       // Set the dialog to original state
                       resetDialog();                
                       $('#dialog').dialog("close");                
                   }
               });
                                          
               $('#dialog').dialog("option", 
                                   "buttons", buttons);

               $('#dialog').dialog("open");                
           }</pre></div><p>The <code class="literal">click</code> event <a id="id815" class="indexterm"/>handler simply retrieves the stop order settings and puts the values inside the <span class="strong"><strong>Modify Stop Order</strong></span> dialog box. Before launching the dialog box, add a <span class="strong"><strong>Remove Order</strong></span> button into the dialog box that the button handler calls <code class="literal">removePlotLine</code>, with the plot line <code class="literal">id</code>. The following is a screenshot of the <span class="strong"><strong>Create Stop Order</strong></span> dialog box:</p><div class="mediaobject"><img src="graphics/7451OS_11_11.jpg" alt="Setting up a plot line action with the click event"/></div></div></div></div>
<div class="section" title="Stock growth chart example"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec71"/>Stock growth chart example</h1></div></div></div><p>Our next <a id="id816" class="indexterm"/>example (for the online demo, see <a class="ulink" href="http://joekuan.org/Learning_Highcharts/Chapter_11/chart2.html">http://joekuan.org/Learning_Highcharts/Chapter_11/chart2.html</a>) is to demonstrate the<a id="id817" class="indexterm"/> following events:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">chart.events</code>: <code class="literal">addSeries</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">plotOptions.series.events</code>: <code class="literal">click</code>, <code class="literal">checkboxClick</code>, and <code class="literal">legendItemClick</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">plotOptions.series.point.events</code>: <code class="literal">update</code> and <code class="literal">remove</code></li></ul></div><p>Suppose that we want to draft a long-term investment portfolio based on past stock growth performance as a reference. The demo contains a chart started with two series, Portfolio and Average growth, and a form to input stock symbols. Basically, we enter a stock symbol in this demo, and then a line series of stock growth is inserted into the chart.</p><p>So we can plot multiple stock yield trends and tweak their proportion in our portfolio to observe how the <span class="strong"><strong>Average</strong></span> and <span class="strong"><strong>Portfolio</strong></span> lines perform. The following screenshot shows the initial screen:</p><div class="mediaobject"><img src="graphics/7451OS_11_12.jpg" alt="Stock growth chart example"/></div><div class="section" title="Plotting averaging series from displayed stock series"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec82"/>Plotting averaging series from displayed stock series</h2></div></div></div><p>Let's query for two <a id="id818" class="indexterm"/>stocks and click on the <span class="strong"><strong>Average</strong></span> legend to enable the series:</p><div class="mediaobject"><img src="graphics/7451OS_11_13.jpg" alt="Plotting averaging series from displayed stock series"/></div><p>As expected, the<a id="id819" class="indexterm"/> <span class="strong"><strong>Average</strong></span> line is plotted between the two stock lines. Assuming that future growth is similar to the past, this <span class="strong"><strong>Average</strong></span> line projects future growth if we invest in both stocks equally for our portfolio. Let's add another stock symbol onto the chart:</p><div class="mediaobject"><img src="graphics/7451OS_11_14.jpg" alt="Plotting averaging series from displayed stock series"/></div><p>The new growth<a id="id820" class="indexterm"/> line generates a higher yield so that the <span class="strong"><strong>Average</strong></span> line automatically re-adjusts itself and shifts to become the second line from the top. Let's see how it is implemented. The following is the chart configuration code:</p><div class="informalexample"><pre class="programlisting">          $.myChart = new Highcharts.Chart({
               chart: {
                   renderTo: 'container',
                   showAxes: true,
                   events: {
                       addSeries: function() { ... }       
                   }
               },
               series: [{
                   visible: false,
                   name: 'Portfolio',
                   color: $.colorRange.shift(),
                   marker: { enabled: false },
                   events: {
                       legendItemClick: function(evt) { ... }
                   }
               }, {
                   name: 'Average',
                   events: {
                       legendItemClick: function(evt) { ... }
                   },
                   color: $.colorRange.shift(),
                   visible: false,
                   marker: { enabled: false }
               }, {
                   visible: false,
                   type: 'pie',
                   point: {
                       events: {
                           click: function(evt) { ... }, 
                               update: function(evt) { ... },
                               remove: function(evt) { ... }
                       }
                   },
                   center: [ '13%', '5%' ],
                   size: '30%',
                   dataLabels: { enabled: false }
               }],
               title: { text: 'Stocks Growth' },
               credits: { enabled: false },
               legend: {
                   enabled: true,
                   align: 'right',
                   layout: 'vertical',
                   verticalAlign: 'top'
               },
               yAxis: {
                   title: { text: 'Growth (%)' }
               },
               xAxis: { type: 'datetime' }
           });</pre></div><p>The chart contains three series: Portfolio, Average, and a pie chart series to edit the portfolio distribution.</p><p>When we hit the <a id="id821" class="indexterm"/>
<span class="strong"><strong>Add</strong></span> button with a stock symbol, the <code class="literal">showLoading</code> method is called to put a loading mask in front of the chart, and then an Ajax connection is established with the server to query the stock yield data. We implement the Ajax handler by calling the <code class="literal">addSeries</code> function to insert a new series into the chart.</p><p>Once the <code class="literal">addSeries</code> event is triggered, it means that the data has been returned and is ready to plot. In this case, we can disable the chart loading mask, as follows:</p><div class="informalexample"><pre class="programlisting">            chart: {
                .... ,
                events: {
                    addSeries: function() { 
                        this.hideLoading();
                    }       
                },
                .... , </pre></div><p>The following <a id="id822" class="indexterm"/>is the implementation of the <span class="strong"><strong>Add</strong></span> button action:</p><div class="informalexample"><pre class="programlisting">   $('#add').button().on('click', 
       function() {
           var symbol = $('#symbol').val().toLowerCase();
           $.myChart.showLoading();
           $.getJSON('./stockGrowth.php?symbol=' + symbol + 
                     '&amp;years=' + $.numOfYears, 
               function(stockData) {
                   // Build up the series data array
                   var seriesData = [];

                   if (!stockData.rows.length) {
                       return;
                   }

                   $.symbols.push({ 
                       symbol: symbol, 
                       name: stockData.name 
                   });

                   $.each(stockData.rows, 
                       function(idx, data) {
                           seriesData.push([ 
                               data.date * 1000, 
                               data.growth ]);
                   });

                   $.myChart.addSeries({
                       events: {
                           // Remove the stock series
                           click: { ... },
                           // Include the stock into portfolio
                           checkboxClick: { ... }
                       },
                       data: seriesData,
                       name: stockData.name,
                       marker: { enabled: false },
                       stickyTracking: false,
                       showCheckbox: true,

                       // Because we can add/remove series, 
                       // we need to make sure the chosen
                       // color used in the visible series
                       color: $.colorRange.shift()
                   }, false);

                   updateAvg(false);
                   $.myChart.redraw();
               }  // function (stockData)    
            );  //getJSON
        });</pre></div><p>We build a series <a id="id823" class="indexterm"/>configuration object from the Ajax returned data. Within this new series configuration, we set the <code class="literal">showCheckbox</code> option to <code class="literal">true</code> for a checkbox next to the legend item. A couple of events are also added into the configuration, <code class="literal">click</code> and <code class="literal">checkboxClick</code>, and are discussed later.</p><p>After the <code class="literal">addSeries</code> method call, we then call a predefined routine, <code class="literal">updateAvg</code>, that only recomputes and redraws the <span class="strong"><strong>Average</strong></span> line if it is on display.</p><p>Recalling from the preceding Average series events definition, we use the <code class="literal">legendItemClick</code> event to capture when the Average series is clicked in the legend box:</p><div class="informalexample"><pre class="programlisting">               series: [{ 
                    ... 
                   }, {
                   name: 'Average',
                   events: {
                       legendItemClick: function(evt) {
                           if (!this.visible) {
                               updateAvg();
                           }
                       }
                   },
                   .....</pre></div><p>The preceding code means that, if the Average series is not currently in a visible state, then the series will be visible after this handler returns. Hence, it calculates the average values and shows the<a id="id824" class="indexterm"/> series.</p></div><div class="section" title="Launching a dialog with the series click event"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec83"/>Launching a dialog with the series click event</h2></div></div></div><p>Instead of enabling or<a id="id825" class="indexterm"/> disabling a stock yield line by clicking on the legend item, we may want to completely remove the series line. In this scenario, we use the <code class="literal">click</code> event to do that, as follows:</p><div class="informalexample"><pre class="programlisting">       $.myChart.addSeries({
            events: {
                // Launch a confirm dialog box to delete 
                // the series
                click: function() {
                    // Save the clicked series into the dialog
                    $("#dialog-confirm").dialog("option",
                       "seriesIdx", this.index);
                    $("#dialog-confirm").dialog("option",
                       "seriesName", this.name);
                    $("#removeName").text(this.name);

                    $("#dialog-confirm").dialog("open");
                },
                // Include the stock into portfolio
                checkboxClick: function(evt) { ... }
            },
            ....
       });</pre></div><p>The click action launches a confirmation dialog box for removing the series from the chart. We store the clicked series (the <code class="literal">'this'</code> keyword) information inside the dialog box. The <span class="strong"><strong>Remove</strong></span> button's button handler uses that data to remove the series and recalculate the average series if it is shown. The following is the screenshot:</p><div class="mediaobject"><img src="graphics/7451OS_11_15.jpg" alt="Launching a dialog with the series click event"/></div></div><div class="section" title="Launching a pie chart with the series checkboxClick event"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec84"/>Launching a pie chart with the series checkboxClick event</h2></div></div></div><p>Inside the legend box, each <a id="id826" class="indexterm"/>checkbox is used to include the stock in the portfolio. As soon as the checkbox is checked, a pie chart appears in the upper-left corner showing the distribution of the stock within the portfolio. Each slice in the pie chart shares the same color with the corresponding stock line. The following screenshot shows three growth lines and a portfolio pie chart equally distributed for each stock:</p><div class="mediaobject"><img src="graphics/7451OS_11_16.jpg" alt="Launching a pie chart with the series checkboxClick event"/></div><p>Since the growth line <a id="id827" class="indexterm"/>series is configured with the <code class="literal">showCheckbox</code> option, we can define the <code class="literal">checkboxClick</code> event to launch a pie chart when the checkbox is checked:</p><div class="informalexample"><pre class="programlisting">          checkboxClick: function(evt) {
              updatePie(this, evt.checked);
          }</pre></div><p>The <code class="literal">updatePie</code> function is called in several places in this demo, for example, to remove a series, when the legend checkbox is checked, and so on. The following is the shortened version of the code:</p><div class="informalexample"><pre class="programlisting">          var updatePie = function(seriesObj, checked) {

             var index = seriesObj.index;

             // Loop through the stock series. If checkbox
             // checked, then compute the equal distribution 
             // percentage for the pie series data
             for (i = $.pfloIdx + 1; 
                  i &lt; $.myChart.series.length; i++) {
                 var insert = (i == index) ? checked : $.myChart.series[i].selected;
                 if (insert) {
                     data.push({ 
                         name: $.myChart.series[i].name, 
                         y: parseFloat((100 / count).toFixed(2)), 
                         color: $.myChart.series[i].color
                     });
                 }
             }

             // Update the pie chart series
             $.myChart.series[$.pfloIdx].setData(data, false);
             $.myChart.series[$.pfloIdx].show();
         };</pre></div><p>The preceding code <a id="id828" class="indexterm"/>snippet basically loops through the stock series array and checks whether it is selected. If so, then it includes stock in the pie series in an equally distributed manner. Then the pie chart is displayed if there are one or more entries.</p></div><div class="section" title="Editing the pie chart's slice with the data point's click, update, and remove events"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec85"/>Editing the pie chart's slice with the data point's click, update, and remove events</h2></div></div></div><p>It is unlikely that an <a id="id829" class="indexterm"/>investment <a id="id830" class="indexterm"/>portfolio<a id="id831" class="indexterm"/> will have an equal distribution of all stocks. Therefore, we can enhance the example by modifying portions within the pie chart. When a slice of the pie chart is clicked, a dialog box pops up. This allows us to adjust or remove the portion within the portfolio. The following screenshot shows this:</p><div class="mediaobject"><img src="graphics/7451OS_11_17.jpg" alt="Editing the pie chart's slice with the data point's click, update, and remove events"/></div><p>The <span class="strong"><strong>Update</strong></span> <a id="id832" class="indexterm"/>button in <a id="id833" class="indexterm"/>the <span class="strong"><strong>Update Portfolio</strong></span> dialog<a id="id834" class="indexterm"/> box updates the pie chart slice with the <code class="literal">Point.update</code> method, whereas the <span class="strong"><strong>Remove</strong></span> button calls the <code class="literal">Point.remove</code> method. Both calls trigger the <code class="literal">update</code> and <code class="literal">remove</code> events respectively. Here, we define the data point's <code class="literal">click</code>, <code class="literal">update</code>, and <code class="literal">remove</code> events inside the pie chart:</p><div class="informalexample"><pre class="programlisting">      series: [ { 
          ....
          },
          visible: false,
          type: 'pie',
          point: {
              events: {
                  // Bring up the modify dialog box
                  click: function(evt) {
                      // Store the clicked pie slice 
                      // detail into the dialog box                                    
                      $('#updateName').text(evt.point.name);               
                      $('#percentage').val(evt.point.y);
                      $('#dialog-form').dialog("option", 
                          "pieSlice", evt.point);

                      $('#dialog-form').dialog("open");
                  }, 
                  // Once the Update button is clicked, 
                  // the pie slice portion is updated
                  // Hence, this event is triggered and the
                  // portfolio series is updated
                  update: function(evt) {
                      updatePortfolio();
                  },
                  // Pie slice is removed, unselect the series
                  // in the legend checkbox and update the
                  // portfolio series
                  remove: function(evt) {
                      var series = nameToSeries(this.name);
                      series &amp;&amp; series.select(false);
                      updatePortfolio();
                  }
              }
         }</pre></div><p>The <code class="literal">click</code> event<a id="id835" class="indexterm"/> function <a id="id836" class="indexterm"/>stores the <a id="id837" class="indexterm"/>clicked slice (the point object) inside the Modify dialog box and launches it. Inside the dialog box, the <span class="strong"><strong>Update</strong></span> and <span class="strong"><strong>Remove</strong></span> buttons' button handlers then extract these stored point object, call the pie chart, and use the objects' update or remove method to reflect the change in the displayed pie chart. This subsequently triggers point <code class="literal">update</code> or <code class="literal">remove</code> event handlers and calls the predefined function, <code class="literal">updatePortfolio</code>, that recalculates the Portfolio series, with the new distribution among the included stocks. So let's update the distribution for the best past performance stock to an 80 percent ratio and the other two stocks to 10 percent each. The Portfolio series automatically readjusts itself from the <code class="literal">update</code> event, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/7451OS_11_18.jpg" alt="Editing the pie chart's slice with the data point's click, update, and remove events"/></div><p>As we can <a id="id838" class="indexterm"/>see, the Portfolio<a id="id839" class="indexterm"/> series (the second line from the top) has been weighted towards the higher growth trend rather than being<a id="id840" class="indexterm"/> in the middle of all the stocks, like the Average series.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec72"/>Summary</h1></div></div></div><p>In this chapter, we covered the last part of Highcharts configuration: events handling. We built two share portfolio applications using jQuery and jQuery UI to demonstrate most of the Highcharts events.</p><p>In the next chapter, we will bring Highcharts to mobile devices with jQuery Mobile.</p></div></body></html>