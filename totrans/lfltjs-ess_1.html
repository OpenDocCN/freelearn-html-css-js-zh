<html><head></head><body>
  <div id="sbo-rt-content"><div class="chapter" title="Chapter 1. Creating Maps with Leaflet"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Creating Maps with Leaflet</h1></div></div></div><p>Web-based mapping has evolved rapidly over the last two decades, from MapQuest and Google to real-time location information on our phones' mapping apps. There have been open source projects to develop web-based maps in the past, such as MapServer, GeoServer, and OpenLayers. However, <span class="strong"><strong>Environmental Systems Research Institute</strong></span> (<span class="strong"><strong>ESRI</strong></span>) includes<a id="id0" class="indexterm"/> the Flex and Silverlight APIs; these create web-based maps from their ArcServer services.</p><p>Over the last few years, JavaScript has taken the online mapping world by storm. In 2013, there was a JS.geo conference. The library at the center of attention<a id="id1" class="indexterm"/> was Leaflet. This is a JavaScript library used to create interactive, web-based maps. With it, you can create a simple map in as little as three lines of JavaScript, or you can create complex, interactive, editable maps with hundreds of lines of code.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>You can find more information<a id="id2" class="indexterm"/> on Leaflet at <a class="ulink" href="http://leafletjs.com">http://leafletjs.com</a>.</p></div></div><p>This book assumes that you have a basic understanding of HTML and CSS, primarily of how to link external <code class="literal">.js</code> and <code class="literal">.css</code> files and how to name and size a <code class="literal">&lt;div&gt;</code> element. It also assumes that you have a working knowledge of JavaScript.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Tile layers</li><li class="listitem" style="list-style-type: disc">Vector layers</li><li class="listitem" style="list-style-type: disc">Pop ups</li><li class="listitem" style="list-style-type: disc">Custom functions / Responding to events</li><li class="listitem" style="list-style-type: disc">Mobile mapping</li></ul></div><div class="section" title="Creating a simple basemap"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Creating a simple basemap</h1></div></div></div><p>To create a map<a id="id3" class="indexterm"/> with Leaflet, you need to do the following <a id="id4" class="indexterm"/>four things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Reference the JavaScript and <span class="strong"><strong>Cascading Style Sheet</strong></span> (<span class="strong"><strong>CSS</strong></span>) files</li><li class="listitem" style="list-style-type: disc">Create a <code class="literal">&lt;div&gt;</code> element to hold the map</li><li class="listitem" style="list-style-type: disc">Create a <code class="literal">map</code> object</li><li class="listitem" style="list-style-type: disc">Add a tile layer (base layer)</li></ul></div><p>Before we get into the details of building the map, let's set up an HTML file that we can use throughout the book. Open a text editor and enter the following HTML:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;&lt;html&gt;
&lt;head&gt;&lt;title&gt;Leaflet Essentials&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>Save the file as <code class="literal">LeafletEssentials.html</code>. We will add to this file throughout the rest of the book.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" title="Referencing the JavaScript and CSS files"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Referencing the JavaScript and CSS files</h2></div></div></div><p>There are two ways to load Leaflet into your code: you can either reference a hosted file or download a copy to<a id="id5" class="indexterm"/> your local machine and reference that copy. The next<a id="id6" class="indexterm"/> two sections will cover how you <a id="id7" class="indexterm"/>can set up your<a id="id8" class="indexterm"/> environment for a hosted copy or for a local copy.</p><div class="section" title="Using a hosted copy"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Using a hosted copy</h3></div></div></div><p>We will not be <a id="id9" class="indexterm"/>making any changes to the original CSS or JS files, so we will link to the hosted version.</p><p>In a text editor, open <code class="literal">LeafletEssentials.html</code>. In the <code class="literal">&lt;head&gt;</code> element, and after the <code class="literal">&lt;/title&gt;</code> element, add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"0.7.3 /&gt;</pre></div><p>After the <code class="literal">&lt;body&gt;</code> tag, add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;script src="http://cdn.leafletjs.com/leaflet-0.7.3/Leaflet"&gt;&lt;/script&gt;</pre></div><p>The links are standard HTML for <code class="literal">&lt;link&gt;</code> and <code class="literal">&lt;script&gt;</code>. Open either link in your browser and you will see the contents of the files.</p></div><div class="section" title="Using a local copy"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Using a local copy</h3></div></div></div><p>Using a local copy is the same as a hosted copy, except the path to the files is different. Download <code class="literal">Leaflet.js</code> from <a class="ulink" href="http://leafletjs.com/download.html">http://leafletjs.com/download.html</a> and <a id="id10" class="indexterm"/>extract it to your desktop. If you downloaded <code class="literal">Leaflet-0.7.3.zip</code>, you should have a folder<a id="id11" class="indexterm"/> with the same name. In the folder, you will find a subfolder named <code class="literal">images</code> and the following three files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Leaflet.css</code>: This is<a id="id12" class="indexterm"/> the cascading style sheet</li><li class="listitem" style="list-style-type: disc"><code class="literal">Leaflet</code>: This is a compressed <a id="id13" class="indexterm"/>version of Leaflet</li><li class="listitem" style="list-style-type: disc"><code class="literal">Leaflet-src.js</code>: This is the full<a id="id14" class="indexterm"/> version of Leaflet for developers</li></ul></div><p>Add the following code in the <code class="literal">&lt;head&gt;</code> tag of <code class="literal">LeafletEssentials.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;link rel="stylesheet"href="\PATH TO DESKTOP\leaflet-0.7.3\leaflet.css" /&gt;</pre></div><p>Add the following code in the <code class="literal">&lt;body&gt;</code> tag of <code class="literal">LeafletEssentials.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;script src="\leaflet-0.7.3\Leaflet"&gt;&lt;/script&gt;0.7.3Leaflet</pre></div><p>You now have local references to the Leaflet library and CSS. We are using the <code class="literal">Leaflet</code> file because it is smaller and will load faster. As long as you do not need to add any code to the file, you can delete the <code class="literal">Leaflet-src.js</code> file.</p></div></div><div class="section" title="Creating a &lt;div&gt; tag to hold the map"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Creating a &lt;div&gt; tag to hold the map</h2></div></div></div><p>You need a place to put the map. You can accomplished this by creating a <code class="literal">&lt;div&gt;</code> tag with an ID that will be<a id="id15" class="indexterm"/> referenced by a <code class="literal">map</code> object. The <code class="literal">&lt;div&gt;</code> tag that is holding the map needs a defined height. The easiest way to give the tag a height is to use <a id="id16" class="indexterm"/>CSS in the <code class="literal">&lt;div&gt;</code> tag that you created. Add the following code to the <code class="literal">&lt;body&gt;</code> tag of <code class="literal">LeafletEssentials.html</code> after the <code class="literal">&lt;script&gt;</code> reference to the <code class="literal">Leaflet</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;div id="map" style="width: 600px; height: 400px"&gt;&lt;/div&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Style the <code class="literal">&lt;div&gt;</code> tag in the HTML file and <span class="emphasis"><em>not</em></span> the <code class="literal">Leaflet.css</code> file. If you do this, the map <code class="literal">&lt;div&gt;</code> size will be global for every page that uses it.</p></div></div></div><div class="section" title="Creating a map object"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Creating a map object</h2></div></div></div><p>Now that you have the<a id="id17" class="indexterm"/> references and a place to put the map, it is time to start coding the map using JavaScript. The first step is to create a <code class="literal">map</code> object. The<a id="id18" class="indexterm"/> <code class="literal">map</code> class takes a <code class="literal">&lt;div&gt;</code> tag (which you created in the previous step) and <code class="literal">options</code>: <code class="literal">L.map(div id, options)</code>. To create a map object named <code class="literal">map</code>, add the following code after the <code class="literal">&lt;script&gt;</code> element in <code class="literal">LeafletEssentials.html</code>:</p><div class="informalexample"><pre class="programlisting">var map = L.map('map',{center: [35.10418, -106.62987],
zoom: 10
});</pre></div><p>Alternatively, you can shorten the code using the <code class="literal">setView()</code> method, which takes the <code class="literal">center</code> and <code class="literal">zoom</code> options as parameters:</p><div class="informalexample"><pre class="programlisting">var map = L.map('map').setView([35.10418, -106.62987],10);</pre></div><p>In the<a id="id19" class="indexterm"/> preceding code, you created a new instance of the <code class="literal">map</code> class and named it <code class="literal">map</code>. You may be used to creating new instances of a class using the keyword <code class="literal">new</code>; this is shown in the following code:</p><div class="informalexample"><pre class="programlisting">var map = new L.Map();</pre></div><p>Leaflet implements factories that remove the need for the <code class="literal">new</code> keyword. In this example, <code class="literal">L.map()</code> has been given the <code class="literal">&lt;div&gt;</code> map and two options: <code class="literal">center</code> and <code class="literal">zoom</code>. These two options position the map on the screen with the latitude and longitude in the center of the <code class="literal">&lt;div&gt;</code> element and zoomed in or out at the desired level. The <code class="literal">center</code> option takes the <code class="literal">[latitude, longitude]</code> parameters, and <code class="literal">zoom</code> takes an integer; the larger the number, the tighter the zoom.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>It is good practice to always assign the <code class="literal">center</code> and <code class="literal">zoom</code> options. There is nothing worse than seeing a map of the world when all of the data is located Albuquerque, NM.</p></div></div></div><div class="section" title="Adding a tile layer"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Adding a tile layer</h2></div></div></div><p>The last step to create your first map in Leaflet is to add a tile layer. A tile layer can be thought of as your <a id="id20" class="indexterm"/>basemap. It is the imagery that you will add points, lines, and polygons on top of later in the book. Tile layers are a service provided<a id="id21" class="indexterm"/> by a tile server. A tile server usually breaks up the layer into 256 x 256 pixel images. You retrieve the images needed based on your location and zoom through a URL that requests <code class="literal">/z/x/y.png</code>. Only these tiles are loaded. As you pan and zoom, new tiles are added to your map.</p><p>The tile layer, at a minimum, requires the URL to a tile server. In this book, we will use OpenStreetMap for our tile layer.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>You need to abide by<a id="id22" class="indexterm"/> the terms of service to use OpenStreetMap tiles. The TOS is available at <a class="ulink" href="http://wiki.openstreetmap.org/wiki/Tile_usage_policy">http://wiki.openstreetmap.org/wiki/Tile_usage_policy</a>.</p></div></div><p>The URL to the OpenStreetMap tile server is shown in the following code:</p><div class="informalexample"><pre class="programlisting">L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);</pre></div><p>In the code, we<a id="id23" class="indexterm"/> provide the URL template to OpenStreetMaps. We also call the <code class="literal">addTo()</code> method so that the layer is drawn. We need to pass <code class="literal">L.map()</code> as a parameter to the <code class="literal">addTo()</code> function. We named our <code class="literal">L.map()</code> instance map in the previous section (<code class="literal">var map = L.map()</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Leaflet allows<a id="id24" class="indexterm"/> method chaining: the calling of multiple methods on an object at the same time. This is what we did when we put <code class="literal">.addTo(map)</code> at the end of the line, creating the instance of <code class="literal">L.tileLayer()</code>. The longer way of adding the layer to the map without chaining is to assign the instance to a variable and then call <code class="literal">addTo()</code> from the variable, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var x = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
x.addTo(map);</pre></div></div></div><p>You now have a complete map that allows you to pan and zoom around the world. Your <code class="literal">LeafletEssentials.html</code> file should look like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;html&gt;
&lt;head&gt;&lt;title&gt;Leaflet Essentials&lt;/title&gt;
&lt;link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" /&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;script src="http://cdn.leafletjs.com/leaflet-0.7.3/Leaflet"&gt;&lt;/script&gt;
&lt;div id="map" style="width: 600px; height: 400px"&gt;&lt;/div&gt;
&lt;script&gt;
var map = L.map('map', 
{
center: [35.10418, -106.62987],
zoom: 10
});
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>Even with liberal spacing, you were able to build a fully functional map of the world with pan and zoom capabilities in six lines of JavaScript. The following screenshot shows the finished map:</p><div class="mediaobject"><img src="images/4812OS_01_01.jpg" alt="Adding a tile layer"/></div></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Tile layer providers"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Tile layer providers</h1></div></div></div><p>Now that you have created your first map, you are probably wondering how to change the tile layer to something else. There are several tile layer providers, some of which require registration. This section will present you<a id="id25" class="indexterm"/> with two more options: Thunderforest and Stamen. Thunderforest provides tiles that extend OpenStreetMap, while Stamen provides more artistic map tiles. Both of these services can be used to add a different style of basemap to your Leaflet map.</p><p>Thunderforest provides<a id="id26" class="indexterm"/> five tile <a id="id27" class="indexterm"/>services:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">OpenCycleMap</li><li class="listitem" style="list-style-type: disc">Transport</li><li class="listitem" style="list-style-type: disc">Landscape</li><li class="listitem" style="list-style-type: disc">Outdoors</li><li class="listitem" style="list-style-type: disc">Atlas (still in development)</li></ul></div><p>To use Thunderforest, you<a id="id28" class="indexterm"/> need to point your tile layer to the URL of the tile server. The following code shows how you can add a Thunderforest tile layer:</p><div class="informalexample"><pre class="programlisting">var layer = new L.TileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png');
map.addLayer(layer);</pre></div><p>The preceding code loads the landscape tile layer. To use another layer, just replace <code class="literal">landscape</code> in the URL <a id="id29" class="indexterm"/>with <code class="literal">cycle</code>, <code class="literal">transport</code>, or <code class="literal">outdoors</code>. The following screenshot shows the Thunderforest landscape layer loaded in Leaflet:</p><div class="mediaobject"><img src="images/4812OS_01_02.jpg" alt="Tile layer providers"/></div><p>Stamen provides <a id="id30" class="indexterm"/>six tile layers; however, we will only <a id="id31" class="indexterm"/>discuss the following three layers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Terrain (available in the United States only)</li><li class="listitem" style="list-style-type: disc">Watercolor</li><li class="listitem" style="list-style-type: disc">Toner</li></ul></div><p>The other three are Burning Map, Mars and Trees, and Cabs &amp; Crime. The Burning Map and Mars layers require WebGL, and Trees and Cabs &amp; Crime are only available in San Francisco. While these maps have a definite wow factor, they are not practical for our purposes here.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Learn about the Stamen<a id="id32" class="indexterm"/> tile layers, including Burning Map, Mars and Trees, and Cabs &amp; Crime, at <a class="ulink" href="http://maps.stamen.com">http://maps.stamen.com</a>.</p></div></div><p>Stamen requires you to follow the same steps as Thunderforest, but it includes an additional step of adding a<a id="id33" class="indexterm"/> reference to the JavaScript file. After the reference to your Leaflet file, add the following reference:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.4"&gt;&lt;/script&gt;</pre></div><p>Instead of <code class="literal">L.TileLayer()</code>, Stamen uses <code class="literal">L.StamenTileLayer(tile set name)</code>. Replace the tile set name with <code class="literal">terrain</code>, <code class="literal">watercolor</code>, or <code class="literal">toner</code>. Lastly, add <code class="literal">addLayer()</code> to the map as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var layer = new L.StamenTileLayer("watercolor");
map.addLayer(layer);</pre></div><p>Stamen's tile layers are not <a id="id34" class="indexterm"/>your typical basemap layers; they are works of cartographic art.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>Stamen has an online tool to edit map layers and save the output as an image. To create your <a id="id35" class="indexterm"/>own artistic map images, go to <a class="ulink" href="http://mapstack.stamen.com">http://mapstack.stamen.com</a>.</p></div></div><p>The following screenshot shows the Stamen watercolor layer loaded in Leaflet. As you zoom in, you will see more detail:</p><div class="mediaobject"><img src="images/4812OS_01_03.jpg" alt="Tile layer providers"/></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Adding a Web Mapping Service tile layer"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Adding a Web Mapping Service tile layer</h1></div></div></div><p>Another type of tile layer that can be added to a Leaflet <a id="id36" class="indexterm"/>map is a <span class="strong"><strong>Web Mapping Service</strong></span> (<span class="strong"><strong>WMS</strong></span>) tile layer. WMS is a way to request and<a id="id37" class="indexterm"/> transfer map images over the Web through HTTP. It is an <a id="id38" class="indexterm"/>
<span class="strong"><strong>Open Geospatial Consortium</strong></span> (<span class="strong"><strong>OGC</strong></span>) specification.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>For detailed technical information on the <a id="id39" class="indexterm"/>WMS specification, see the OGC website: <a class="ulink" href="http://www.opengeospatial.org/standards/wms">http://www.opengeospatial.org/standards/wms</a>.</p></div></div><p>With an understanding of how to add tile layers, and having seen several examples, you may have noticed<a id="id40" class="indexterm"/> that none of the examples were of satellite imagery. The first WMS layer you will add to your map is the <a id="id41" class="indexterm"/>
<span class="strong"><strong>United States Geological Survey</strong></span> (<span class="strong"><strong>USGS</strong></span>) Imagery Topo.</p><p>Like the <code class="literal">L.tileLayer()</code> function that we used previously, the <code class="literal">L.tileLayer.wms()</code> function takes a URL and a set of options as parameters. The following code adds the WMS layer to your map:</p><div class="informalexample"><pre class="programlisting">varusgs = L.tileLayer.wms("http://basemap.nationalmap.gov/ArcGIS/services/USGSImageryTopo/MapServer/WMSServer", {
layers:'0',
format: 'image/png',
transparent: true,
attribution: "USGS"
}).addTo(map);</pre></div><p>The URL for the WMS was taken from the USGS website. You can find <a id="id42" class="indexterm"/>other WMS layers at <a class="ulink" href="http://basemap.nationalmap.gov/arcgis/rest/services">http://basemap.nationalmap.gov/arcgis/rest/services</a>. The options specified are the layer name, the format, the transparency, and the attribution. The layer name will be provided on the information page of the service you are connecting to. The format is an image, and the transparency is set to <code class="literal">true</code>. Since this layer covers the globe, and we are not putting any other layers underneath it, the transparency could be set to <code class="literal">false</code>. In the next example, you will see how setting the transparency to <code class="literal">true</code> allows another layer to become visible. Lastly, there is an attribution set to USGS. When you assign an attribution to a layer, Leaflet adds the text value in the lower-right corner of the map. It is important to use an attribution as it is similar to citing a source in text. If it is not your data, it is accepted practice to give credit where credit is due. Many times, it is also required by copyright. Since this layer is from the USGS, it is accredited in the attribution property of the layer.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>The attribution value can contain hyperlinks, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">attribution: "&lt;a href='http://basemap.nationalmap.gov/arcgis/rest/services'&gt;USGS&lt;/a&gt;"</pre></div></div></div><p>Insert the WMS layer code into <code class="literal">LeafletEssentials.html</code>, and you should now have a map with satellite imagery. The following <a id="id43" class="indexterm"/> screenshot shows the satellite imagery loaded into Leaflet:</p><div class="mediaobject"><img src="images/4812OS_01_04.jpg" alt="Adding a Web Mapping Service tile layer"/></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Multiple tile layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Multiple tile layers</h1></div></div></div><p>In the previous example, you added a WMS layer and set the transparency to <code class="literal">true</code>. The reason you need to do this is because you can add<a id="id44" class="indexterm"/> multiple tile layers on top of each other, and with the transparency set to <code class="literal">true</code>, you will be able to see them all at the same time. In this example, you need to add the <span class="strong"><strong>National Weather Service</strong></span> (<span class="strong"><strong>NWS</strong></span>) radar<a id="id45" class="indexterm"/> mosaic WMS on top of the USGS satellite imagery.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>The <span class="strong"><strong>National Oceanic and Atmospheric Administration</strong></span> (<span class="strong"><strong>NOAA</strong></span>) provides a list of several WMS layers; they are<a id="id46" class="indexterm"/> available at the following link:</p><p>
<a class="ulink" href="http://nowcoast.noaa.gov/help/mapservices.shtml?name=mapservices">http://nowcoast.noaa.gov/help/mapservices.shtml?name=mapservices</a>
</p></div></div><p>The adding of extra WMS layers follows the same format as the previous example, but with a different URL, layer name, and attribution. Add the following code after the code for the satellite imagery in <code class="literal">LeafletEssentials.html</code>:</p><div class="informalexample"><pre class="programlisting">Varnexrad = L.tileLayer.wms("http://nowcoast.noaa.gov/wms/com.esri.wms.Esrimap/obs", {
layers: 'RAS_RIDGE_NEXRAD',
format: 'image/png',
transparent: true,
attribution: "NOAA/NWS"
}).addTo(map);</pre></div><p>This code adds the NOAA WMS layer for the NWS radar mosaic. Note that the URL and layer have changed <a id="id47" class="indexterm"/>and the attribution is set to <code class="literal">NOAA/NWS</code>. The <a id="id48" class="indexterm"/>
<code class="literal">RAS_RIDGE_NEXRAD</code> layer is a grid that displays values when they begin to exist. The name of the layer can be found on the NOAA website; you are not expected to remember that <code class="literal">RAS_RIDGE_NEXRAD</code> is<a id="id49" class="indexterm"/> the weather radar layer. There are large portions of the map with no data, and since we set the transparency to <code class="literal">true</code>, these blank spaces allow the satellite imagery to become visible. Your map should now show the satellite imagery with the radar mosaic overlaid, as in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_01_05.jpg" alt="Multiple tile layers"/></div><p>If you set the transparency to <code class="literal">false</code>, you allow the layer to draw on the entire map. Areas with no data are displayed as white squares and cover the satellite imagery underneath, as shown in the following screenshot:</p><div class="mediaobject"><img src="images/4812OS_01_06.jpg" alt="Multiple tile layers"/></div><p>WMS layers do<a id="id50" class="indexterm"/> not need to serve as base layers only; they can be used as additional data. This was shown in the previous example where you overlaid the radar on the satellite imagery. In this example, you used a satellite image. You can also use the OpenStreetMap tile layer from the first map. Again, just set the transparency to <code class="literal">true</code>. WMS layers can be added just like points, lines, and polygons, which is discussed in the following sections.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Adding data to your map"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Adding data to your map</h1></div></div></div><p>So far, you have learned how to add tile layers to a map. In the previous example, you added a WMS<a id="id51" class="indexterm"/> layer on top of a base tile layer. Now, you will learn how to draw your own layers that need to be added on top of a tile layer. The three geometric primitives of vector data that you can add to a map are often referred to as points, lines, and polygons.</p><p>In this section, you will learn how to add markers, polylines, and polygons to your map.</p><div class="section" title="Points"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Points</h2></div></div></div><p>So far, your <a id="id52" class="indexterm"/>map is not that interesting. You often draw a map to highlight a specific place or point. Leaflet has a <code class="literal">Point</code> class; however, it is not used to simply add a point on the map with an icon to<a id="id53" class="indexterm"/> specify the place. In Leaflet, points <a id="id54" class="indexterm"/>are added to the map using the <code class="literal">Marker</code> class. At minimum, the <code class="literal">Marker</code> class requires a latitude and longitude, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">Var myMarker = L.marker([35.10418, -106.62987]).addTo(map);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>You can create a marker by simply calling <code class="literal">L.marker([lat,long]).addTo(map);</code>, but assigning the marker to a variable will allow you to interact <a id="id55" class="indexterm"/>with it by name. How do you delete a specific marker if it does not have a name?</p></div></div><p>In the preceding code, you<a id="id56" class="indexterm"/> created a marker at point <code class="literal">[35.10418, -106.62987]</code>, and then, as with the tile layer, you used the <code class="literal">addTo(map)</code> function. This created a marker<a id="id57" class="indexterm"/> icon at the specified latitude and longitude. The<a id="id58" class="indexterm"/> following screenshot shows the marker on the map:</p><div class="mediaobject"><img src="images/4812OS_01_07.jpg" alt="Points"/></div><p>The preceding example is a simplified, and almost useless, marker. The <code class="literal">Marker</code> class has options, events, and methods that you can call to make them more interactive and useful. You will learn about methods—specifically the <code class="literal">bindPopup()</code> method— and events later in this chapter.</p><p>There are 10 options you can specify when<a id="id59" class="indexterm"/> creating a marker, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">icon</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">clickable</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">draggable</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">keyboard</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">title</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">alt</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">zIndexOffset</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">opacity</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">riseOnHover</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">riseOffset</code></li></ul></div><p>The<a id="id60" class="indexterm"/>
<a id="id61" class="indexterm"/> options <code class="literal">clickable</code>, <code class="literal">draggable</code>, <code class="literal">keyboard</code>, <code class="literal">zIndexOffset</code>, <code class="literal">opacity</code>, <code class="literal">riseOnHover</code>, and <code class="literal">riseOffset</code> are all set to a default value. In <a class="link" href="ch04.html" title="Chapter 4. Creating Custom Markers">Chapter 4</a>, <span class="emphasis"><em>Creating Custom Markers</em></span>, you will<a id="id62" class="indexterm"/> learn about the <code class="literal">icon</code> option in detail. Two options that you should set are <code class="literal">title</code> and <code class="literal">alt</code>. The <code class="literal">title</code> option is the tooltip text that will be <a id="id63" class="indexterm"/>displayed when you hover over the point with the cursor, and the <code class="literal">alt</code> option is the alternative text that is read using screen readers for accessibility. These <a id="id64" class="indexterm"/>options are used in the following code:</p><div class="informalexample"><pre class="programlisting">varmyMarker = L.marker([35.10418, -106.62987],
{title:"MyPoint",alt:"The Big I",draggable:true}).addTo(map);</pre></div><p>The code extends the original marker example by adding a title and alt text and making the marker draggable. You will use the <code class="literal">draggable</code> options with an event in the last section of this chapter. The options are set the same as when we created our map instance; use curly braces to group the options, and separate each option with a comma. This is how options will be set for all objects.</p></div><div class="section" title="Polylines"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Polylines</h2></div></div></div><p>The first vector layer you will learn to create is aLine. In Leaflet, you will use the <code class="literal">Polyline</code> class. A polyline<a id="id65" class="indexterm"/> can represent a single line segment or a line with multiple segments. Polylines and polygons extend the <code class="literal">path</code> class. You do not call <code class="literal">path</code> directly, but<a id="id66" class="indexterm"/> you have access to its methods, properties, and events. To draw a polyline, you need to provide at least a single longitude <a id="id67" class="indexterm"/>and latitude pair. The option for a polyline is set as default, so you need not specify any values unless you want to override the default. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">var polyline = L.polyline([[35.10418, -106.62987],[35.19738, -106.875]], {color: 'red',weight:8}).addTo(map);</pre></div><p>In this example, the polyline is <code class="literal">red</code> and has a weight of <code class="literal">8</code>. The <code class="literal">weight</code> option defaults to <code class="literal">5</code>. If you want a thicker line, increase the number. For a thinner line, decrease the number. To add more segments to the line, just add additional latitude and longitude values as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var polyline = L.polyline([[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]], {color: 'red',weight:8}).addTo(map);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>You need to first provide a latitude and longitude pair because a line consists of at least two points. Afterwards, you can declare additional latitudes and longitudes to extend your line.</p></div></div><p>The following<a id="id68" class="indexterm"/> screenshot <a id="id69" class="indexterm"/>shows the polyline added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_08.jpg" alt="Polylines"/></div></div><div class="section" title="Polygons"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Polygons</h2></div></div></div><p>A polygon is a polyline<a id="id70" class="indexterm"/> that is closed. Polygons tend to be classified by the number of sides, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Triangle (3)</li><li class="listitem" style="list-style-type: disc">Hexagon (6)</li><li class="listitem" style="list-style-type: disc">Octagon (8)</li></ul></div><p>Leaflet has a class for drawing two common polygons: a circle and a rectangle. When drawing a polygon, you will<a id="id71" class="indexterm"/> specify a minimum of three coordinates. A triangle is the simplest polygon that you can draw. That is why you need to provide at least<a id="id72" class="indexterm"/> three points. You do not need to specify the starting point at the end of the list. Leaflet will automatically close the polygon for you. To draw a polygon, simply copy the code for the polyline with three points and change the class to <code class="literal">L.polygon()</code>, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var polygon = L.polygon([[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]], {color: 'red',weight:8}).addTo(map);</pre></div><p>Since Leaflet automatically closes the polygon, our three-point polyline can become a polygon. Since <code class="literal">polyline</code> and <code class="literal">polygon</code> inherit from <code class="literal">path</code>, the options <code class="literal">color</code> and <code class="literal">weight</code> apply to both. You will<a id="id73" class="indexterm"/> notice that <code class="literal">color</code> and <code class="literal">weight</code> refer to the outline of the polygon. Two options that you will find useful when drawing polygons are <code class="literal">fillColor</code> and <code class="literal">fillOpacity</code>:</p><div class="informalexample"><pre class="programlisting">var polygon = L.polygon([[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]], {color: 'red',weight:8,fillColor:'blue',fillOpacity:1}).addTo(map);</pre></div><p>The preceding code draws a <code class="literal">red</code> triangle <a id="id74" class="indexterm"/>with a weight of <code class="literal">8</code>. The additional options of <code class="literal">fillColor</code> and <code class="literal">fillOpacity</code> are set to <code class="literal">blue</code> and <code class="literal">1</code>. The fill color of a polygon will be set to the default if no <code class="literal">fillColor</code> option is<a id="id75" class="indexterm"/> selected. You only need to use <code class="literal">fillColor</code> if you want a different fill color than the outline.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Opacity is a value between <code class="literal">0</code> and <code class="literal">1</code>, where <code class="literal">0</code> is 100 percent opacity and <code class="literal">1</code> is no opacity (solid).</p></div></div><p>The following screenshot shows the red triangle with a blue fill added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_09.jpg" alt="Polygons"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Rectangles and circles"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Rectangles and circles</h1></div></div></div><p>Circles and rectangles are<a id="id76" class="indexterm"/> common polygons<a id="id77" class="indexterm"/> that have built-in classes in Leaflet. You can also draw them manually using polygon and by specifying all of the line segments, but that would be a difficult route to take.</p><div class="section" title="Rectangles"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Rectangles</h2></div></div></div><p>To create a<a id="id78" class="indexterm"/> rectangle, you need an instance of the class <code class="literal">L.rectangle()</code> with the latitude and longitude pair for the upper-left corner and lower-right corner as a parameter. The class extends <code class="literal">L.polygon()</code>, so you have access to the same options, methods, and events:</p><div class="informalexample"><pre class="programlisting">var myRectangle = L.rectangle([[35.19738, -106.875],[35.10418, -106.62987]], {color: "red", weight: 8,fillColor:"blue"}).addTo(map);</pre></div><p>The preceding code uses the first two points in the polyline and triangle, but in reverse order (upper left and lower right). The options are the same as the polygon, but with opacity removed. The following screenshot shows the rectangle added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_10.jpg" alt="Rectangles"/></div></div><div class="section" title="Circles"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Circles</h2></div></div></div><p>To create a circle, you need<a id="id79" class="indexterm"/> an instance of <code class="literal">L.circle()</code> with the center point and a radius (in meters) as parameters. You can specify the same options as you used in your rectangle because the <code class="literal">circle</code> class extends the <code class="literal">path</code> class. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">L.circle([35.10418, -106.62987], 8046.72,{color: "red", weight: 8,fillColor:"blue"}).addTo(map);</pre></div><p>The preceding code specifies the center point, a radius of 5 miles (<code class="literal">8046.72</code> meters), and the same options as<a id="id80" class="indexterm"/> the rectangle in the previous example. The following screenshot shows the circle added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_11.jpg" alt="Circles"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="MultiPolylines and MultiPolygons"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>MultiPolylines and MultiPolygons</h1></div></div></div><p>In the previous examples, you created each polyline and polygon as its own layer. When you start creating real data, you will find that you want multiple polylines or polygons on a single layer. For starters, it is more realistic, and it also makes it possible to deal with similar features as a single entity. If you want to map parks and bike trails on a single map, it makes sense to add the parks as<a id="id81" class="indexterm"/> MultiPolygon and the bike trails as MultiPolyline. Then, you<a id="id82" class="indexterm"/> can provide the user with the option of turning either layer on or off.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Bracketing for MultiPolylines and MultiPolygons can get confusing. You need brackets to hold the MultiPolyline or MultiPolygon, brackets for each polyline or polygon, and brackets for each latitude and longitude.</p></div></div><div class="section" title="MultiPolylines"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>MultiPolylines</h2></div></div></div><p>Creating a MultiPolyline is functionally the same as a single polyline, except that you pass multiple longitudes<a id="id83" class="indexterm"/> and latitudes; a set for each polygon. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">var multipolyline = L.multiPolyline([[[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]],[[35.11654, -106.58318],[35.13142, -106.48876],[35.07384, -106.52412]]],{color: 'red',weight:8}).addTo(map);</pre></div><p>In the preceding code, the first polyline is the same as the polyline example. A second polyline is added, and the options are also the same as the first polyline example. The following screenshot shows the MultiPolyline added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_12.jpg" alt="MultiPolylines"/></div></div><div class="section" title="MultiPolygons"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>MultiPolygons</h2></div></div></div><p>Creating a MultiPolygon is the same as creating a MultiPolyline. Since Leaflet will automatically <a id="id84" class="indexterm"/>close the polyline, as long as our polylines have three or more points, we can use them. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">var multipolygon = L.multiPolygon([[[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]],[[35.11654, -106.58318],[35.13142, -106.48876],[35.07384, -106.52412]]],{color: 'red',weight:8}).addTo(map).bindPopup("We are the same layer");</pre></div><p>In the preceding code, you can see that the parameters used are identical to those used in the MultiPolyline example earlier. When we create a MultiPolygon or MultiPolyline, the options will apply to every polygon or polyline in the collection. This means that they all have to be the same color, weight, opacity, and so on. There is a new method in the preceding code: <code class="literal">.bindPopup("We are the same layer")</code>. MultiPolygons and MultiPolylines also<a id="id85" class="indexterm"/> share the same pop up. Pop ups will be discussed later in this chapter. Also, note the use of method chaining in the line <code class="literal">L.multiPolygon().addTo().bindPopup()</code>. The following screenshot shows the MultiPolygon added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_13.jpg" alt="MultiPolygons"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Groups of layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Groups of layers</h1></div></div></div><p>MultiPolyline and MultiPolygon layers allow you to combine multiple polylines and polygons. If you want to creat<a id="id86" class="indexterm"/>e group layers of different types, such as a marker layer with a circle, you can use a layer group or a feature group.</p><div class="section" title="The layer group"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>The layer group</h2></div></div></div><p>A layer group <a id="id87" class="indexterm"/>allows you to <a id="id88" class="indexterm"/>add multiple layers of different types to the map and manage them as a single layer. To use a layer group, you will need to define several layers:</p><div class="informalexample"><pre class="programlisting">var marker=L.marker([35.10418, -106.62987]).bindPopup("I am a Marker");
var marker2=L.marker([35.02381, -106.63811]).bindPopup("I am Marker 2");
var polyline=L.polyline([[35.10418, -106.62987],[35.19738, -106.875],[35.07946, -106.80634]], {color: 'red',weight:8}).bindPopup("I am a Polyline");</pre></div><p>The preceding code<a id="id89" class="indexterm"/> creates two markers and a polyline. Note that you will not use the <code class="literal">addTo(map)</code> function after creating the layers, like you did in the previous examples. You will let the layer group handle adding the layer to the map. A layer group requires a set of layers as a parameter:</p><div class="informalexample"><pre class="programlisting">var myLayerGroup=L.layerGroup([marker, polyline]).addTo(map); </pre></div><p>In the previous code, an<a id="id90" class="indexterm"/> instance of <code class="literal">L.layerGroup()</code> was created as <code class="literal">myLayerGroup</code>. The layers passed as a parameter were <code class="literal">marker</code> and <code class="literal">polyline</code>. Finally, the layer group was added to the map. The earlier code shows three layers, but only two were added to the layer group. To add layers to a layer group without passing them as a parameter during creation, you can use the layer group <code class="literal">addLayer()</code> method. This method takes a layer as a parameter, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">myLayerGroup.addLayer(marker2);</pre></div><p>Now, all three layers have been added to the layer group and are displayed on the map. The following screenshot shows the layer group added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_14.jpg" alt="The layer group"/></div><p>If you want to remove a layer from the layer group, you can use the <code class="literal">removeLayer()</code> method and pass the layer name as a parameter:</p><div class="informalexample"><pre class="programlisting">myLayerGroup.removeLayer(marker);</pre></div><p>If you remove a layer from the group, it will no longer be displayed on the map because the <code class="literal">addTo()</code> function was called for the layer group and not the individual layer. If you want to display the layer but no longer want it to be part of the layer group, use the <code class="literal">removeLayer()</code> function, as shown<a id="id91" class="indexterm"/> in the preceding <a id="id92" class="indexterm"/>code, and then add the layer to<a id="id93" class="indexterm"/> the map as shown in the earlier examples. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">marker.addTo(map);</pre></div><p>All style options and pop ups need to be assigned to the layer when it is created. You cannot assign a style or pop ups to a layer group as a whole. This is where feature groups can be used.</p></div><div class="section" title="Feature groups"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Feature groups</h2></div></div></div><p>A feature group is<a id="id94" class="indexterm"/> similar to a layer group, but extends it to allow mouse events and includes the <code class="literal">bindPopup()</code> method. The constructor for a feature group is the same<a id="id95" class="indexterm"/> as the layer group: just pass a set of layers as a parameter. The following code displays an example of a feature group:</p><div class="informalexample"><pre class="programlisting">VarmyfeatureGroup=L.featureGroup([marker, marker2, polyline])
     .addTo(map).setStyle({color:'purple',opacity:.5})
     .bindPopup("We have the same popup because we are a group");</pre></div><p>In the preceding code, the layers added are the same three that you added in the layer group. Since the feature group extends the layer group, you can assign a style and pop up to all of the layers at once. The following screenshot shows the feature group added to the map:</p><div class="mediaobject"><img src="images/4812OS_01_15.jpg" alt="Feature groups"/></div><p>When you created the polyline in the previous example, you set the color to <code class="literal">red</code>. Note now that since you passed style information to the feature group by setting the color to <code class="literal">purple</code>, the polyline took the information from the feature group and discarded its original settings. If you removed the <a id="id96" class="indexterm"/>polyline from the feature group, it will be removed from the map as well. If you try to add the polyline to the<a id="id97" class="indexterm"/> map using <code class="literal">addTo()</code>, as in the previous examples, it will still be purple and have the new pop up. The markers are still blue<a id="id98" class="indexterm"/> even though you passed style information to the feature group. The <a id="id99" class="indexterm"/>
<code class="literal">setStyle()</code> method only applies to layers in the feature group that have a <code class="literal">setStyle()</code> method. Since a polyline extends the <code class="literal">path</code> class, it has a <code class="literal">setStyle()</code> method. The markers do not have a <code class="literal">setStyle()</code> method, so their color did not change.</p></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Pop ups"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Pop ups</h1></div></div></div><p>The last few examples introduced pop ups. A pop up provides a way to make your layers interactive or provides information to the user. The simplest way to add a pop up to a marker, polyline, or <a id="id100" class="indexterm"/>polygon is to use the <a id="id101" class="indexterm"/>
<code class="literal">bindPopup()</code> method. This method takes the contents of the pop up as a parameter. Using the <code class="literal">marker</code> variable we created earlier, we bind the pop up to it with the following code:</p><div class="informalexample"><pre class="programlisting">marker.bindPopup("I am a marker");</pre></div><p>The <code class="literal">bindPopup()</code> method allows you to enter HTML as the content. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">marker.bindPopup("&lt;h1&gt;My Marker&lt;/h1&gt;&lt;p&gt;This is information about the marker&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Info 1&lt;/li&gt;&lt;li&gt;Info 2&lt;/li&gt;&lt;li&gt;Info 3&lt;/li&gt;&lt;/ul&gt;")</pre></div><p>The ability to use HTML in a pop up comes in handy when you have a lot of details to add. It allows the use of images and links in pop ups. The following screenshot shows the HTML-formatted pop up added to a marker on the map:</p><div class="mediaobject"><img src="images/4812OS_01_16.jpg" alt="Pop ups"/></div><p>You can also create<a id="id102" class="indexterm"/> an instance of the <code class="literal">popup</code> class and then assign it to multiple objects:</p><div class="informalexample"><pre class="programlisting">var mypopup = L.popup({keepInView:true,closeButton:false})
.setContent("&lt;h1&gt;My Marker&lt;/h1&gt;&lt;p&gt;This is information about the marker&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Info 1&lt;/li&gt;&lt;li&gt;Info 2&lt;/li&gt;&lt;li&gt;Info 3&lt;/li&gt;&lt;/ul&gt;");
marker.bindPopup(mypopup);
marker2.bindPopup(mypopup);</pre></div><p>In the preceding code, you create an instance of the <code class="literal">L.popup()</code> class and assign it to the variable <code class="literal">mypopup</code>. Then, you can call the <code class="literal">bindPopup()</code> method on <code class="literal">marker</code> and <code class="literal">marker2</code> with <code class="literal">mypopup</code> as the parameter. Both markers will have the same pop up content and options.</p><p>In the last section of this chapter, you will learn how to create a function that allows you to create a pop up with options and pass the content as a parameter.</p></div></div>


  <div id="sbo-rt-content"><div class="section" title="Mobile mapping"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Mobile mapping</h1></div></div></div><p>The maps you have made so far have been tested on the desktop. One of the benefits of mapping in JavaScript is that mobil<a id="id103" class="indexterm"/>e devices can run the code in a standard web browser without any external applications or plugins. Leaflet runs on mobile devices, such as iPhone, iPad, and Android devices. Any web page with a<a id="id104" class="indexterm"/> Leaflet map will work on a mobile device without any changes; however, you probably want to customize the map for mobile devices so that it works and looks like it was built specifically for mobile.</p><p>Lastly, the <code class="literal">L.map()</code> class has a <code class="literal">locate()</code> method, which uses the W3C Geolocation API. The Geolocation API allows you to find and track a user's location using the IP address, the wireless network information, or the GPS on a device. You do not need to know how to use the API; Leaflet handles all of this when you call <code class="literal">locate()</code>.</p><div class="section" title="HTML and CSS"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>HTML and CSS</h2></div></div></div><p>The first step in converting your Leaflet map to a mobile version is to have it display properly on mobile devices. You<a id="id105" class="indexterm"/> can always tell when you open a website on your phone<a id="id106" class="indexterm"/> whether the developer took the time to make it mobile-accessible. How many times have<a id="id107" class="indexterm"/> you been on a website where the page loads and all you can see is the top-left corner, and you have to zoom around to<a id="id108" class="indexterm"/> read the page. It is not a good user experience. In <code class="literal">LeafletEssentials.html</code> in the <code class="literal">&lt;head&gt;</code> tag after the <code class="literal">&lt;link&gt;</code> tag for the CSS file, add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;style&gt;

body{
padding: 0;
margin: 0;
    }
html, body, #map {
height: 100%;
        }
&lt;/style&gt;</pre></div><p>In the preceding CSS code, you set the <code class="literal">padding</code> and <code class="literal">margin</code> values to <code class="literal">0</code>. Think of a web page as a box model, where each element exists in its own box. Each box has a margin, which is the space between it and other boxes, and also padding, which is the space between the content inside the box and the box border (even if a border is not physically drawn). Setting the <code class="literal">padding</code> and <code class="literal">margin</code> values to <code class="literal">0</code> makes the <code class="literal">&lt;body&gt;</code> content fit to the size of the page. Lastly, you set the <code class="literal">height</code> value of the <code class="literal">&lt;html&gt;</code>, <code class="literal">&lt;body&gt;</code>, and <code class="literal">&lt;div id = 'map'&gt;</code> elements to <code class="literal">100%</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>In CSS, <code class="literal">#</code> is the ID selector. In the code, <code class="literal">#map</code> is telling us to select the element with the <code class="literal">id = 'map'</code> line. In this case, it is our <code class="literal">&lt;div&gt;</code> element that holds the map.</p></div></div><p>The following diagram shows an overview of the settings for the web page:</p><div class="mediaobject"><img src="images/4812OS_01_20.jpg" alt="HTML and CSS"/></div><p>The last step is to<a id="id109" class="indexterm"/> add the following code in the <code class="literal">&lt;head&gt;</code> section<a id="id110" class="indexterm"/> and after the <code class="literal">&lt;/title&gt;</code> element:</p><div class="informalexample"><pre class="programlisting">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"&gt;</pre></div><p>The preceding code modifies the viewport that the site is seen through. This code sets the viewport to the width of the<a id="id111" class="indexterm"/> device and renders it by a ratio of 1:1. Lastly, it<a id="id112" class="indexterm"/> disables the ability to resize the web page. This, however, does not affect your ability to zoom on the map.</p></div><div class="section" title="Creating a mobile map with JavaScript"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Creating a mobile map with JavaScript</h2></div></div></div><p>Now that you have configured the web page to render<a id="id113" class="indexterm"/> properly on mobile devices, it is time to add the<a id="id114" class="indexterm"/> JavaScript code that will grab the user's current location. For this, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the map instance, but do not use <code class="literal">setView</code>:<div class="informalexample"><pre class="programlisting">var map = L.map('map');</pre></div></li><li class="listitem">Add a tile layer:<div class="informalexample"><pre class="programlisting">L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);</pre></div></li><li class="listitem">Define a function to successfully find the location:<div class="informalexample"><pre class="programlisting">Function <code class="literal">f</code>ound<code class="literal">Location</code>(e){}</pre></div></li><li class="listitem">Define a function to unsuccessfully find the location:<div class="informalexample"><pre class="programlisting">functionnotFoundLocation<code class="literal">(e){}</code>
</pre></div></li><li class="listitem">Add an event listener for <code class="literal">foundLocation()</code> and <code class="literal">notFoundLocation()</code>:<div class="informalexample"><pre class="programlisting">map.on('locationfound', foundLocation);
map.on('locationerror', notFoundLocation);</pre></div></li><li class="listitem">Use locate() to set the map view:<div class="informalexample"><pre class="programlisting">map.locate({setView: true, maxZoom:10});</pre></div></li></ol></div><p>The code creates the map and adds a tile layer. It then skips over the functions and event listeners and tries to<a id="id115" class="indexterm"/> locate the user. If it is able to locate the user, it runs the code in <code class="literal">foundLocation()</code> and sets the view to the latitude and longitude<a id="id116" class="indexterm"/> of the user. If it does not locate the user, it executes the code in <code class="literal">notFoundLocation()</code> and displays a zoomed-out world map.</p><p>To make this example more usable, add the following code to <code class="literal">notFoundLocation()</code>:</p><div class="informalexample"><pre class="programlisting">function notFoundLocation(e){
alert("Unable to find your location. You may need to enable Geolocation.");}</pre></div><p>The <code class="literal">alert()</code> function <a id="id117" class="indexterm"/>creates a pop up in the browser with the message passed as a parameter. Anytime that the browser is unable to locate the user, they will see the following message. While some devices do not have location capabilities, at times, they need to be allowed in their security settings:</p><div class="mediaobject"><img src="images/4812OS_01_17.jpg" alt="Creating a mobile map with JavaScript"/></div><p>Now, add the following code to <code class="literal">foundLocation()</code>:</p><div class="informalexample"><pre class="programlisting">function foundLocation(e){
varmydate = new Date(e.timestamp);
L.marker(e.latlng).addTo(map).bindPopup(mydate.toString());
     }</pre></div><p>The preceding code will run when the user's location is found. The <code class="literal">e</code> in <code class="literal">foundLocation(e)</code> is an event object. It is sent when an event is triggered to the function that is responsible for handling that specific event type. It contains information about the event that you will want to know. In the preceding code, the first event object we grab is the <code class="literal">timestamp</code> object. If you were to display the timestamp in a pop up, you would get a bunch of numbers: <span class="strong"><strong>1400094289048</strong></span>. The timestamp is the number of milliseconds that have passed since January 1, 1970 00:00:00 UTC. If you create an instance of the <code class="literal">date</code> class and pass it to the <code class="literal">timestamp</code> object, you receive a human-readable date. Next, the code <a id="id118" class="indexterm"/>creates a marker. The latitude and longitude are stored in <code class="literal">e.latlng</code>. You then add the marker to the map and bind a pop up. The pop up<a id="id119" class="indexterm"/> needs a string as a parameter, so you can use the <a id="id120" class="indexterm"/>
<code class="literal">toString()</code> method of the <code class="literal">date</code> class or use <code class="literal">String(mydate)</code> to convert it. The following screenshot shows the pop up with the date and time when the user clicked on it:</p><div class="mediaobject"><img src="images/4812OS_01_18.jpg" alt="Creating a mobile map with JavaScript"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Events and event handlers"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Events and event handlers</h1></div></div></div><p>So far, you <a id="id121" class="indexterm"/>have created <a id="id122" class="indexterm"/>maps that display data and added a pop up that displayed when the user clicked on a marker. Now, you will learn how to handle other events and assign these events to event handler functions to process them and do something as a result.</p><p>You will first learn how<a id="id123" class="indexterm"/> to handle a <code class="literal">map</code> event. There are 34 events in the <code class="literal">map</code> class that can be subscribed to. This example will focus on the <code class="literal">click</code> event. To subscribe<a id="id124" class="indexterm"/> to an event, you use the event method <code class="literal">.on()</code>; so, for a <code class="literal">map</code> event, you use the <code class="literal">map.on()</code> method and pass the parameters as the event and function to handle the event. This is shown in the following code:</p><div class="informalexample"><pre class="programlisting">map.on('click', function(){alert("You clicked the map");});</pre></div><p>The code tells Leaflet to send an alert pop-up box with the text <span class="strong"><strong>You clicked the map</strong></span> when the user clicks on the map. In the mobile example, you created a listener that had a named function that executed <code class="literal">foundLocation()</code>. In the preceding code, the function was put in as a parameter. This is known as an anonymous function. The function has no name, and so, it can only be called when the user clicks on the map.</p><p>Remember <code class="literal">e</code> from the<a id="id125" class="indexterm"/> mobile example? If you pass <code class="literal">e</code> to the function, you can get the <code class="literal">longlat</code> value of the spot that the user clicked on, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">map.on('click',function(e){
var coord=e.latlng.toString().split(',');
var lat=coord[0].split('(');
var long=coord[1].split(')');
alert("you clicked the map at LAT: "+ lat[1]+" and LONG:"+long[0])
});</pre></div><p>The preceding code is spaced in a way that is more readable, but you can put it all on a single line. The code displays the longitude and latitude of the spot where the user clicked on the map. The second line assigns the variable <code class="literal">coord</code>, the value of <code class="literal">e.latlng</code>. The next two lines strip the latitude and longitude from the value so that you can display them clearly.</p><p>You can build on this example by adding a marker when the user clicks on the map by simply replacing the code with the following:</p><div class="informalexample"><pre class="programlisting">L.marker(e.latlng).addTo(map);</pre></div><p>The preceding code is identical to the code in the mobile example. The difference is that in the mobile example, it was only executed when <code class="literal">locate()</code> was successful. In this example, it is executed every time the user clicks on the map.</p><p>In the section on markers, you created a marker that had the property <code class="literal">draggable:true</code>. Markers have three events that deal with dragging: <code class="literal">dragstart</code>, <code class="literal">drag</code>, and <code class="literal">dragend</code>. Perform the following steps to return the longitude and latitude of the marker in a pop up on <code class="literal">dragend</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the marker and set the draggable property to <code class="literal">true</code>:<div class="informalexample"><pre class="programlisting">varmyMarker = L.marker([35.10418, -106.62987],{title:"MyPoint",alt:"The Big I",draggable:true}).addTo(map);</pre></div></li><li class="listitem">Write a function to bind a pop up to the marker and call the method <code class="literal">getLatLong()</code>:<div class="informalexample"><pre class="programlisting">myMarker.bindPopup("I have been moved to: "+String(myMarker.getLatLng()));</pre></div></li><li class="listitem">Subscribe to the event:<div class="informalexample"><pre class="programlisting">myMarker.on('dragend',whereAmI);</pre></div></li></ol></div><p>Open the map and click on the marker. Hold down the left mouse button and drag the marker to a new<a id="id126" class="indexterm"/> location on the map. Release the left button and<a id="id127" class="indexterm"/> click on the marker again to trigger the pop up. The pop up will have the new latitude and longitude of the marker.</p><div class="section" title="Custom functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Custom functions</h2></div></div></div><p>You subscribed to an event and handled it with a function. So far, you have only passed <code class="literal">e</code> as a parameter. In JavaScript, you can send anything you want to the function. Also, functions can be called anywhere in your code. You do not have to call them only in response to an event. In this <a id="id128" class="indexterm"/>short example, you will create a<a id="id129" class="indexterm"/> function that returns a pop up and is triggered on a call and not by an event.</p><p>First, create a marker and bind a pop up to it. For the content of the pop up, enter <code class="literal">createPopup(Text as a parameter)</code>. Add the marker to the map as shown in the following code:</p><div class="informalexample"><pre class="programlisting">var marker1 = L.marker([35.10418, -106.62987]).addTo(map).bindPopup(createPopup("Text as a parameter"));</pre></div><p>Create a second marker and set the content of the pop up to <code class="literal">createPopup (Different text as a parameter)</code>:</p><div class="informalexample"><pre class="programlisting">var marker2 = L.marker([35, -106]).addTo(map).bindPopup(createPopup("Different text as a parameter"));</pre></div><p>In the previous examples, you created a pop up by passing text or a pop-up instance. In this example, you call a function, <code class="literal">createPopup()</code>, with a string as a parameter, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">functioncreatePopup(x){
return L.popup({keepInView:true,closeButton:false}).setContent(x);function createPopup(x){
returnL.popup({keepInView:true,closeButton:false}).setContent(x);
}</pre></div><p>The function takes a parameter called <code class="literal">x</code>. In the marker, when you call the function, you pass a string. This is sent to the function and stored as <code class="literal">x</code>. When the pop up is created, the <code class="literal">setContent()</code> method is given the value of <code class="literal">x</code> instead of a hardcoded string. This function is useful if you have a lot of options set on your pop ups and want them all to be the same. It limits the number of times that you need to repeat the same code. Just pass the text of the pop up to the function, and you get a new pop up with the standardized formatting options. The following screenshot shows both of the pop ups generated by the custom function:</p><div class="mediaobject"><img src="images/4812OS_01_19.jpg" alt="Custom functions"/></div></div></div></div>


  <div id="sbo-rt-content"><div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Summary</h1></div></div></div><p>This chapter covered almost every major topic required to create a Leaflet map. You learned how to add tile layers from multiple providers, including satellite imagery. You can now add points, lines, and polygons to the map, as well as collections of polylines and polygons. You can group layers of different types into layer or feature collections. This chapter covered the styling of objects and adding pop ups. You learned how to interact with the user by responding to events and created custom functions to allow you to code more by writing less.</p><p>In the next chapter, you will learn how to add GeoJSON data to your map.</p></div></div>
</body></html>