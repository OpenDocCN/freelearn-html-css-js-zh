<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Using Filters in EaselJS</h1></div></div></div><p>One of the great features of CreateJS is the ability to play with filters and apply various filters to pictures and shapes easily. CreateJS makes it easy by providing a <code class="literal">Filter</code> class and <code class="literal">filters</code> property for <code class="literal">DisplayObject</code>; accordingly, we can simply create instances of the <code class="literal">Filter</code> class and apply them to the objects. In this chapter, we will have a look at CreateJS filters and some basic examples of working with the <code class="literal">Filter</code> class.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding the <code class="literal">Filter</code> class</li><li class="listitem" style="list-style-type: disc">How to use built-in EaselJS filters</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec30"/>Understanding the Filter class</h1></div></div></div><p>EaselJS <a id="id105" class="indexterm"/>comes <a id="id106" class="indexterm"/>with a <code class="literal">Filter</code> class, which is the base class for all other filters, and other filter classes should inherit from this class. Filters need to be applied to objects that have been cached using the <code class="literal">cache</code> method; after that, if the object gets changed again, we should use the <code class="literal">cache</code> or <code class="literal">updateCache</code> methods to update the shape.</p><p>The following is an example of applying filters to an object:</p><div><pre class="programlisting">  /* Add canvas and stage */
  var canvas = document.getElementById("canvas");
  var stage = new createjs.Stage(canvas);

/* create and draw the shape */
var circle = new createjs.Shape();
circle.graphics.beginFill("red").drawCircle(50, 50, 40);

/* add the blur filter to filters property */
circle.filters = [new createjs.BlurFilter(5, 5, 10)];
/* cache the shape to apply the filter */
circle.cache(0, 0, 100, 100);
/* add shape to stage and update */
stage.addChild(circle);
stage.update();</pre></div><p>In the first line, we have created a shape object; in the next line, we have created a circle with the color red. <a id="id107" class="indexterm"/>The next line contains the filter configurations, and in the last line we have cached the object using the <code class="literal">cache</code> function.</p><p>Using the <code class="literal">cache</code> method in examples with filtering will not only boost performance but will also apply the filter to the shape and make it work.</p><div><img src="img/0260OS_06_01.jpg" alt="Understanding the Filter class"/></div><p>EaselJS contains several basic filters, such as <code class="literal">blur</code> or <code class="literal">color</code> filters, that you can use easily. Here is a list of built-in filters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AlphaMapFilter</code>: This is used to map a grayscale image to the alpha channel of a display object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">AlphaMaskFilter</code>: This is used to map the alpha channel of an image to the alpha channel of a display object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">BlurFilter</code>: This applies vertical and horizontal blur to a display object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ColorFilter</code>: This color transforms a display object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ColorMatrixFilter</code>: This transforms an image using a <code class="literal">ColorMatrix</code>.</li></ul></div><p>In the next section, we will discuss all these filters in detail.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec31"/>Using the AlphaMapFilter class</h1></div></div></div><p>The <a id="id108" class="indexterm"/>
<code class="literal">AlphaMapFilter</code> is an built-in filter is used for applying<a id="id109" class="indexterm"/> a grayscale alpha map image (or canvas) to the target. To be clearer, the alpha channel of the result will be copied from the red channel of the map and the RGB channels will be copied from the target object.</p><div><blockquote class="blockquote"><p>Generally, it is recommended that you use <code class="literal">AlphaMaskFilter</code>, because it has much better performance.</p></blockquote></div><p>This has been taken from: <a class="ulink" href="http://www.createjs.com/Docs/EaselJS/classes/AlphaMapFilter.html">http://www.createjs.com/Docs/EaselJS/classes/AlphaMapFilter.html</a>
</p><p>The following code snippet is the definition for this class:</p><div><pre class="programlisting">AlphaMapFilter (alphaMap)</pre></div><p>The parameters<a id="id110" class="indexterm"/> are as follows:</p><p>
<code class="literal">alphaMap</code> | <code class="literal">Image</code> | <code class="literal">HTMLCanvasElement</code>
</p><p>We have used the grayscale image or the canvas as the alpha channel. It should be of the same dimensions as the target.</p><p>The following code is an example of using<a id="id111" class="indexterm"/> the <code class="literal">AlphaMapFilter</code> class:</p><div><pre class="programlisting">/* Add canvas and stage */
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

/* Create filter */
var box = new createjs.Shape();
box.graphics.beginLinearGradientFill(["#0000ff", "#ff0000"], [1, 0], 0, 0, 0, 300)
box.graphics.drawRect(0, 0, 300, 300);
box.cache(0, 0, 300, 300);

/* create the second shape */
var box2 = new createjs.Shape();
box2.graphics.beginLinearGradientFill(["#0000ff", "#ff0000"], [0, 1], 0, 0, 0, 300);
box2.graphics.drawRect(0, 0, 300, 300);

/* Add filter to box2 */
box2.filters = [
  new createjs.AlphaMapFilter(box.cacheCanvas)
];
/* and finally, cache the shape to apply changes */
box2.cache(0, 0, 300, 300);

/* Add bitmap to stage and update stage */ 
stage.addChild(box2);
stage.update();</pre></div><p>In the first few<a id="id112" class="indexterm"/> lines of the code, we created a rectangle created with a linear gradient and then cached the object using <code class="literal">cache</code> method. The reason for caching the object is to use it in the filter parameters.</p><p>Then, we created the <code class="literal">box2</code> variable; it's our parent shape. This shape is the same as the first one, but the gradient color is different. We have changed the colors for the start and end of the linear gradient. Afterward, we added <code class="literal">AlphaMapFilter</code> to the <code class="literal">box2</code> filters and the <code class="literal">box </code>variable as the parameter of the filter. Then, in to order apply the filter to the shape, we cached the shape using the <code class="literal">cache</code> method and added it to the stage.</p><p>A preview of the previous example is shown in the following image:</p><div><img src="img/0260OS_06_02.jpg" alt="Using the AlphaMapFilter class"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec32"/>Using the AlphaMaskFilter class</h1></div></div></div><p>This <a id="id113" class="indexterm"/>filter is similar in usage to the <code class="literal">AlphaMapFilter</code> class, <a id="id114" class="indexterm"/>but we will briefly talk about this filter as well. As per the CreateJS documentation, it's recommended that you use this filter instead of <code class="literal">AlphaMapFilter</code> because it has much better performance.</p><p>
<code class="literal">AlphaMaskFilter</code> applies the alpha mask from the mask image (or canvas) to the target. The alpha channel of the result will be derived from the mask, and the RGB channels will be copied from the target object.</p><p>Here is how we define the <code class="literal">AlphaMaskFilter</code> class:</p><div><pre class="programlisting">AlphaMaskFilter (mask)</pre></div><p>The parameters in this code snippet are as follows:</p><p>
<code class="literal">mask</code> | <code class="literal">Image</code>
</p><p>This class is an instance of the <code class="literal">Image</code> class.</p><p>Here is an example of using this filter:</p><div><pre class="programlisting">/* Declare variables */
var canvas, stage, img;

function init() {
  /* Add canvas and stage */
  canvas = document.getElementById("canvas");
  stage = new createjs.Stage(canvas);

  /* Load image */
  img = new Image();
  img.onload = handleimg;   //function that's called once image has loaded
  img.src = "targetImg.png";  //image url
}

function handleimg() {
  /* Create mask layer */
  var box = new createjs.Shape();
  box.graphics.beginLinearGradientFill(["#000000", "rgba(0, 0, 0, 0)"], [0, 1], 0, 0, 0, 200)
  box.graphics.drawRect(0, 0, 200, 200);
  box.cache(0, 0, 200, 200);

  /* Create bitmap */
  var bmp = new createjs.Bitmap(img); 

  /* Add filter to bitmap */
  bmp.filters = [
     new createjs.AlphaMaskFilter(box.cacheCanvas)
  ];
    bmp.cache(0, 0, 200, 200);

  /* Add bitmap to stage and update stage */ 
  stage.addChild(bmp);
  stage.update();
}</pre></div><p>As you can see, the usage of this filter is almost the same as <code class="literal">AlphaMapFilter</code>.</p><p>The example<a id="id115" class="indexterm"/> source code is divided into two functions, <code class="literal">init</code> and <code class="literal">handleimg</code>. In order to load the image properly, we used the <code class="literal">Image</code> class and the <code class="literal">onload</code> event. We then used the <code class="literal">handleimg</code> function for the <code class="literal">onload</code> event callback function.</p><p>Inside <code class="literal">init</code> function, <code class="literal">stage</code> class is created. We also configured the <code class="literal">Image</code> class and assigned the <code class="literal">handleimg</code> function to the <code class="literal">onload</code> event. A major part of the example's source code is inside the <code class="literal">handleimg</code> function. In the first few lines, we created a rectangle with a linear gradient background. The reason for using the <code class="literal">rgba</code> function to define color is to change the alpha channel of the gradient so that the filter will derive this alpha channel for the final result. Finally, we cached the shape using the <code class="literal">cache</code> method.</p><p>Then, we loaded an image using the <code class="literal">Bitmap</code> function and also applied it to the <code class="literal">bmp</code> variable with the <code class="literal">filters</code> property. We also cached this image in order to apply the filter changes.</p><p>The following screenshot illustrates the result of our example:</p><div><img src="img/0260OS_06_03.jpg" alt="Using the AlphaMaskFilter class"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec33"/>Implementing the BlurFilter class </h1></div></div></div><p>The<a id="id116" class="indexterm"/> Blur filter <a id="id117" class="indexterm"/>is one of usable filters<a id="id118" class="indexterm"/> for creating innovative animations and drawings. In this section, we will have a discussion about using the <code class="literal">BlurFilter</code> class.</p><p>This filter applies a <strong>blur box</strong><a id="id119" class="indexterm"/> to <code class="literal">DisplayObject</code>.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>This filter is CPU intensive, particularly if the quality is set to higher than 1.</p></div></div><p>Here is the definition of the <code class="literal">BlurFilter</code> class and its <a id="id120" class="indexterm"/>parameters:</p><div><pre class="programlisting">BlurFilter ([blurX=0] [blurY=0] [quality=1])</pre></div><p>The parameters included in this code snippet are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">[blurX=0]</code> | <code class="literal">Number</code>: It is an optional parameter. It is used to set the horizontal blur radius in pixels.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[blurY=0]</code> | <code class="literal">Number</code>: It is an optional parameter. It is used to set the vertical blur radius in pixels.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[quality=1]</code> | <code class="literal">Number</code>: It is an optional parameter. It is used to set the number of blur iterations.</li></ul></div><p>Here is an example of using the Blur filter with a red circle:</p><div><pre class="programlisting">/* Add canvas and stage */
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

/* create circle shape */
var shape = new createjs.Shape().set({x:100,y:100});
shape.graphics.beginFill("#ff0000").drawCircle(0,0,50);

/* create blur filter and add to shape */
var blurFilter = new createjs.BlurFilter(5, 5, 1);
shape.filters = [blurFilter];

/* add getbounds to give spread effect to blur */
var bounds = blurFilter.getBounds();
shape.cache(-50+bounds.x, -50+bounds.y, 100+bounds.width, 100+bounds.height);

/* add shape to stage and update */
stage.addChild(shape);
stage.update();</pre></div><p>In the first line, <a id="id121" class="indexterm"/>we have the <code class="literal">shape </code>variable, which is the variable for our shape, a circle. In the next line, we filled the circle with the red color and finished drawing the shape using the <code class="literal">drawCircle</code> function.</p><p>Then, we created the blur filter using three parameters and applied it to the <code class="literal">shape</code> object with the <code class="literal">filters</code> property. In order to find the dimension of the caching area, we used the <code class="literal">getBounds</code> function because, as you know, the blur filter has some more padding after applying the <code class="literal">getBounds</code> function.</p><div><img src="img/0260OS_06_04.jpg" alt="Implementing the BlurFilter class"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec34"/>Utilizing the ColorFilter class</h1></div></div></div><p>This<a id="id122" class="indexterm"/> filter <a id="id123" class="indexterm"/>applies a color transform to <code class="literal">DisplayObject</code>. This filter comes handy when you need to play with colors in EaselJS.</p><p>In the following code snippet, you can see the definition of this filter:</p><div><pre class="programlisting">ColorFilter ([redMultiplier=1] [greenMultiplier=1][blueMultiplier=1] [alphaMultiplier=1] [redOffset=0][greenOffset=0] [blueOffset=0] [alphaOffset=0])</pre></div><p>The various <a id="id124" class="indexterm"/>parameters<a id="id125" class="indexterm"/> in this code snippet are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">[redMultiplier=1]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to multiply with the red channel. The value should be between 0 and 1.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[greenMultiplier=1]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to multiply with the green channel. The value should be between 0 and 1.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[blueMultiplier=1]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to multiply with the blue channel. The value should be between 0 and 1.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[alphaMultiplier=1]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to multiply with the alpha channel. The value should be between 0 and 1.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[redOffset=0]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to add to the red channel after it has been multiplied. The value should be between -255 and 255.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[greenOffset=0]</code>– <code class="literal">Number</code>: It <a id="id126" class="indexterm"/>is an optional parameter. It sets the value to add to the green channel after it has been multiplied. The value should be between -255 and 255.</li><li class="listitem" style="list-style-type: disc"><code class="literal">[blueOffset=0]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to add to the blue channel after it has been multiplied. The value should be between -255 and 255. </li><li class="listitem" style="list-style-type: disc"><code class="literal">[alphaOffset=0]</code>– <code class="literal">Number</code>: It is an optional parameter. It sets the value to add to the alpha channel after it has been multiplied. The value should be between -255 and 255.</li></ul></div><p>Here is an example of using this filter:</p><div><pre class="programlisting">/* Add canvas and stage */
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

var shape = new createjs.Shape().set({x:100,y:100});
shape.graphics.beginFill("#ff0000").drawCircle(0,0,50);

shape.filters = [
  new createjs.ColorFilter(0,0,0,1, 0,0,255,0)
];
shape.cache(-50, -50, 100, 100);
/* add shape to stage and update */
stage.addChild(shape);
stage.update();</pre></div><p>In this example, we created a red circle and then changed its color to blue using <code class="literal">ColorFilter</code>. This is done by multiplying all the channels with 0 (except for the alpha channel, which is set to 1) and then adding the value 255 to the blue channel and 0 to the other channels.</p><div><img src="img/0260OS_06_05.jpg" alt="Utilizing the ColorFilter class"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec35"/>Using the ColorMatrixFilter class</h1></div></div></div><p>With<a id="id127" class="indexterm"/> this filter, you can play with complex color operations, <a id="id128" class="indexterm"/>such as saturation, brightness, or inversion. This <a id="id129" class="indexterm"/>filter uses the <code class="literal">ColorMatrix</code> class to perform the action.</p><p>The following code snippet defines this class:</p><div><pre class="programlisting">ColorMatrixFilter (matrix)</pre></div><p>The parameters<a id="id130" class="indexterm"/> present in this code snippet are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">matrix– Array</code>: A 4x5 matrix describing the color operation to perform using the <code class="literal">ColorMatrix</code> class.</li></ul></div><p>Here is an example of using this filter:</p><div><pre class="programlisting">/* Add canvas and stage */
var canvas = document.getElementById("canvas");
var stage = new createjs.Stage(canvas);

var shape = new createjs.Shape().set({x:100,y:100});
shape.graphics.beginFill("#ff0000").drawCircle(0,0,50);

var matrix = new createjs.ColorMatrix().adjustHue(180).adjustSaturation(100);
shape.filters = [
 new createjs.ColorMatrixFilter(matrix)
];

shape.cache(-50, -50, 100, 100);
/* add shape to stage and update */
stage.addChild(shape);
stage.update();</pre></div><p>In the preceeding <a id="id131" class="indexterm"/>example, we created a red circle and then inverted the hue and changed the saturation to 100. We started by creating the <code class="literal">stage</code> class in the first line. Then, we created a circle using the <code class="literal">drawCircle</code> function. To place the circle in the viewport of the <code class="literal">canvas</code> element, we used the <code class="literal">set</code> function to change the <code class="literal">x</code> and <code class="literal">y</code> values.</p><p>Then, we initiated the <code class="literal">matrix</code> variable using the <code class="literal">ColorMatrix</code> class. We used the <code class="literal">adjustHue</code> and <code class="literal">adjustSaturation</code> functions to change the hue and saturation of the circle. An acceptable value for <code class="literal">adjustHue</code> is between -180 to 180. This value for <code class="literal">adjustSaturation</code> is between -100 and 100. We set the hue value to 180 and saturation value to 100 in our example to see the difference better.</p><p>We applied all using the <code class="literal">filter</code> property of the <code class="literal">shape</code> variable. Finally, we cached the shape using the <code class="literal">cache</code> method and updated the stage using <code class="literal">update</code> method to apply the changes.</p><div><img src="img/0260OS_06_06.jpg" alt="Using the ColorMatrixFilter class"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we learned how to use the built-in filters in EaselJS to change <code class="literal">DisplayObject</code> properties such as color, hue, saturation, and so on. We also discussed the definition and basic usage of the filters with interactive examples and screenshots.</p><p>In the next chapter, we will discuss the creation of a web-based painting application using all the methods and functions that we have learned up to now.</p></div></body></html>