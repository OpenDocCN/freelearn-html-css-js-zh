<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9.  A Kik Salesforce CRM Bot </h1></div></div></div><p>Kik Messenger, or simply Kik, is a free mobile messenger app. This is available on iOS, Android, and Windows Phone. Using this instant messenger app, users can send or receive messages, photos, videos, and so on.</p><p>Kik is mainly famous because it does not verify user information upon registration. This helps users to maintain their anonymity.</p><p>Kik users have their own code. Using these codes, users can connect with their friends quickly and easily. Users can scan the code of a user and start chatting right away. This is also applicable to Kik groups. Users can scan Kik codes for groups and join them easily.</p><p>The simplicity and ease of establishing a chat communication and, mainly, the anonymity, have made Kik a very popular chat platform among young people.</p><p>In this chapter, we will learn about how to create a basic Kik bot and how to enhance the same by integrating it with Salesforce CRM.</p><p>But before going into the details, let's understand more about Salesforce CRM.</p><div><div><div><div><h1 class="title"><a id="ch09lvl1sec39"/>What is Salesforce?</h1></div></div></div><p>Salesforce is a cloud-based <strong>customer relationship management</strong> (<strong>CRM</strong>) software solution for sales, service, marketing, analytics, and collaboration. All these software solutions are prebuilt and run on a cloud platform. Salesforce does not need any IT person to set it up or manage. CRM users just need to log in to start using this platform.</p><p>Details of Salesforce can be found at <a class="ulink" href="https://www.salesforce.com">
https://www.salesforce.com
</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec40"/>What is Force.com?</h1></div></div></div><p>Force.com is a <strong>platform as a service</strong> (<strong>PaaS</strong>). This platform consists of underlying components such as database, code, and user interface, on which developers can create and deliver powerful enterprise apps. With this platform, developers can deliver powerful apps just by using a few clicks or code. Even business users can develop and deliver app workflows just by dragging and dropping.</p><p>In short, Salesforce, with its products and solutions, is a customer success platform which changes the way people connect with their customers.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec41"/>Kik mobile app</h1></div></div></div><p>As mentioned in the introduction, Kik is a free mobile messenger app. This can be downloaded from the App Store (<a class="ulink" href="https://itunes.apple.com/ca/app/kik/id357218860?mt=8">
https://itunes.apple.com/ca/app/kik/id357218860?mt=8
</a>) or Google Play Store (<a class="ulink" href="https://play.google.com/store/apps/details?id=kik.android&amp;hl=en">
https://play.google.com/store/apps/details?id=kik.android&amp;hl=en
</a>).</p><p>For this chapter, I am assuming the Kik mobile app has already been downloaded and installed from the App Store or Google Play Store.</p><p>I have already installed the Kik app from the Google Play Store and also created my account on the Kik app. The following screenshot shows what the Kik mobile app looks like:</p><p>
</p><div><img src="img/image00407.jpeg" alt="Kik mobile app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Kik does not have a web or desktop version for messaging so we will be using the Kik app from a mobile.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec42"/>Kik bots</h1></div></div></div><p>Kik bots are just programs that provide users with an automated conversational experience with the help of Kik APIs. Users can chat to these bots for fun, for any help, or for seeking information for entertainment. Kik has recently released a Bot Shop. Users can discover bots and connect them easily.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec43"/>Our Kik bot</h1></div></div></div><p>Our Kik bot will be based on the Salesforce and Force.com platforms, which I explained previously. At a high level, we will be following the following steps for our bot:</p><div><ol class="orderedlist arabic"><li class="listitem">Developing a basic Kik bot</li><li class="listitem">Enhancing our basic bot program for a more conversational experience as per Kik guidelines</li><li class="listitem">Establishing a connection between CRM and our basic bot</li><li class="listitem">Based on the user's requirements, getting CRM data from Salesforce and presenting the user data in the Kik app</li></ol><div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec37"/>Creating our first Kik bot</h2></div></div></div><p>Just like Slack, Kik also helps us to create our bot using an automated agent, <strong>Botsworth</strong>. Let's follow the steps to create our first Kik bot.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec24"/>Using the Kik dev platform on a browser</h3></div></div></div><p>Visit <a class="ulink" href="https://dev.kik.com/#/home">https://dev.kik.com/#/home</a>, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00408.jpeg" alt="Using the Kik dev platform on a browser"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The URL opens the Kik developer platform, which helps us to create and configure our Kik bot. This screen shows a Kik code for creating a bot. This code needs to be scanned using the Kik app, which we have already installed and configured with our Kik account as well.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec25"/>Using the Kik app from a mobile</h3></div></div></div><p>Open the Kik app on a device and pull down from the top of your main chat list to open the scanner, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00409.jpeg" alt="Using the Kik app from a mobile"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Using the scanner, scan the Kik code from <a class="ulink" href="https://dev.kik.com/#/home">https://dev.kik.com/#/home</a>.</p><p>This scanner can also be located from the Kik app's settings menu (a small gear icon on the top right) by selecting your <strong>Kik Code</strong> page from the menu items.</p><p>After scanning, Kik's trusty bot, <strong>Botsworth<strong>,</strong>
</strong> will send a message, as shown in the following screenshot, on our app:</p><p>
</p><div><img src="img/image00410.jpeg" alt="Using the Kik app from a mobile"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Now provide a unique bot name to <strong>Botsworth</strong> in the chat window itself.</p><p>
<strong>Botsworth</strong> will create our bot and will also notify us of the same, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00411.jpeg" alt="Using the Kik app from a mobile"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Now let's go back to our browser, where the <a class="ulink" href="https://dev.kik.com/#/home">
https://dev.kik.com/#/home
</a> page is open. You will notice that the newly configured bot account has logged in to the platform and is showing bot properties such as <strong>Display Name</strong>, <strong>Admins</strong>, and <strong>API Key</strong>, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00412.jpeg" alt="Using the Kik app from a mobile"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The bot name, <strong>sforcebot,</strong> and <strong>API Key</strong> will be used to wire up Kik APIs while building a conversational experience later.</p><p>To receive messages from users, our bot needs <strong>Webhooks</strong> integration. Before we set up Webhooks, let's create a Node.js server app for our bot on Azure in the next section.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec26"/>Setting up our bot server in Azure</h3></div></div></div><p>Let's log in to the Azure portal and locate App Services to create a Node.js-based bot server as <code class="literal">thesfbotsite</code>. This server app is based on the <strong>Node JS Empty Web App </strong>template. Refer to the following screenshot:</p><p>
</p><div><img src="img/image00413.jpeg" alt="Setting up our bot server in Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>This will provision our <code class="literal">thesfbotsite.azurewebsites.net</code> server app in Azure.</p><p>To modify the basic bot program, first we will clone the template on our local filesystem using git commands. Then we will modify it and then deploy it to Microsoft Azure.</p><p>Let's start by creating a folder in our local drive in order to store our bot program from the Command Prompt:</p><pre class="programlisting">
<strong>mkdir thesfbot</strong>
<strong>cd thesfbot</strong>
</pre><p>Now clone the template to the local filesystem and change the remote git repository as well for this bot.</p><p>Detailed steps of how to clone the template to the local filesystem and how to change the remote git repository can be found in the<em> Setting up our bot server in Azure</em> section in<a class="link" title="Chapter 7. Facebook Messenger Bot, Who's Off – A Scheduler Bot for Teams" href="part0042.xhtml#aid-181NK2">
 Chapter 7
</a>, <em>Facebook Messenger Bot Who's Off - A Scheduler Bot for Teams</em>.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec27"/>Kik bot configuration</h3></div></div></div><p>Before our bot can start interacting with users, it needs configuration. To configure our bot, we will be making a POST request with a Webhook URL to which messages will be delivered. Also, any additional features for read receipts and receive typing can also be configured here.</p><p>This can be done by firing a URL command or by writing a JavaScript with the following code in a simple Node.js program:</p><pre class="programlisting">request.post({ 
    url: "https://api.kik.com/v1/config", 
    auth: { 
       'user' : 'sforcebot', 
       'pass' : '&lt;YOUR BOT API KEY&gt;' 
    }, 
    json:{"webhook": "https://thesfbotsite.azurewebsites.net/incoming",  
        "features": { 
            "receiveReadReceipts": false,  
            "receiveIsTyping": false,  
            "manuallySendReadReceipts": false,  
            "receiveDeliveryReceipts": false 
        } 
    } 
}, function(error, response, body){ 
    if(error) { 
        console.log(error); 
    } else { 
        console.log(response.statusCode, body); 
    } 
}); 
</pre><p>This code sets the <code class="literal">webhook</code> for our bot to the newly created site in Azure at the path <code class="literal">/incoming</code>.</p><p>Details of these configurations can be found at <a class="ulink" href="http://bit.do/dev-kik-docs-messaging-configuration">
https://dev.kik.com/#/docs/messaging#configuration
</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec28"/>Wiring up our bot server with the Kik platform</h3></div></div></div><p>In order for our bot to interact with the Kik platform, we will be using the Kik Node API library. This can be found at <a class="ulink" href="https://www.npmjs.com/package/@kikinteractive/kik">https://www.npmjs.com/package/@kikinteractive/kik</a>.</p><p>Let's install the Kik API library and other libraries using the following command:</p><pre class="programlisting">
<strong>npm install @kikinteractive/kik  http  util --save</strong>
</pre><p>Let's update our <code class="literal">server.js</code> file as follows:</p><pre class="programlisting">var util = require('util'); 
var http = require('http'); 
var Bot  = require('@kikinteractive/kik'); 
var request = require('request'); 
 
// Configure the bot 
var bot = new Bot({ 
    username: 'sforcebot', 
    apiKey: '&lt;YOUR BOT API KEY&gt;'  
}); 
 
bot.send(Bot.Message.text('The SForceBot Started... '), 'mbhintade'); 
 
bot.onTextMessage(/^hi|hello|how|hey$/i, (incoming, next) =&gt; { 
     incoming.reply('Hello,I am the SForce Bot. I provide your CRM information just by chatting.'); 
 }); 
 
 
// Set up your server and start listening 
var server = http 
  .createServer(bot.incoming()) 
  .listen(process.env.PORT || 8080); 
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec38"/>Understanding the code of our basic Kik bot</h2></div></div></div><p>Let's look at basic code implementation from <code class="literal">server.js</code>.</p><p>We used the <code class="literal">@kikinteractive/kik</code> library with the following line:</p><pre class="programlisting">var Bot = require('@kikinteractive/kik'); 
</pre><p>Using this library, we instantiated our bot by providing <code class="literal">username</code> and <code class="literal">apikey</code>:</p><pre class="programlisting">var bot = new Bot({ 
    username: 'sforcebot', 
    apiKey: '&lt;YOUR BOT API KEY&gt;'  
}); 
</pre><p>When our bot is wired up successfully, this will show up in the Kik app. Also, our bot will notify the user <code class="literal">mbhintade</code> with the help of the following code:</p><pre class="programlisting">bot.send(Bot.Message.text('The SForceBot Started... '), 'mbhintade'); 
</pre><p>When we say hi or hello to our bot, the bot will reply to us using the following code lines:</p><pre class="programlisting">bot.onTextMessage(/^hi|hello|how|hey$/i, (incoming, next) =&gt; { 
     incoming.reply('Hello,I am the SForce Bot. I provide your CRM information just by chatting.'); 
 }); 
</pre><p>In the preceding code snippet, we are using the regular expression <code class="literal">/^hi|hello|how|hey$/i</code> to find out what user is messaging. The regular expression used precedingly can be described as follows:</p><div><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>
<p>Character</p>
</td><td>
<p>Description</p>
</td></tr><tr><td>
<p>/</p>
</td><td>
<p>Regular expression</p>
</td></tr><tr><td>
<p>^</p>
</td><td>
<p>Matches character <code class="literal">hi</code> and not from any character group</p>
</td></tr><tr><td>
<p>|</p>
</td><td>
<p>Matches any single word between two characters</p>
</td></tr><tr><td>
<p>$</p>
</td><td>
<p>Matches the end of the input</p>
</td></tr></tbody></table></div><p>I hope this has given some basic understanding of our Kik bot and its code implementation. Now let's run our bot and see how it looks in the Kik mobile app.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec39"/>Running our basic Kik bot</h2></div></div></div><p>Let's deploy our modified <code class="literal">server.js</code> and installed Node packages using the following <code class="literal">git</code> commands:</p><pre class="programlisting">
<strong>git add .</strong>
<strong>git commit -m "First Change to server.js"</strong>
<strong>git push origin master</strong>
</pre><p>Once the code is deployed to Azure, hit the URL <a class="ulink" href="https://thesfbotsite.azurewebsites.net">
https://thesfbotsite.azurewebsites.net
</a> and see if there are any errors in the Azure log stream. If the code is successful, then the bot server will start and our bot will be shown in Kik chats with active status.</p><p>When the bot started, it showed us the message, <strong>The SForceBot Started...</strong>
</p><p>When I greeted it by saying <strong>Hi</strong>, the bot replied with the message <strong>Hello, I am the SForce Bot. I provide your CRM information just by chatting.</strong>
</p><p>Refer to the following screenshot:</p><p>
</p><div><img src="img/image00414.jpeg" alt="Running our basic Kik bot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the next section, we will enhance our bot for an interesting use case.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec40"/>Enhancing our Kik bot</h2></div></div></div><p>Having built a very basic Kik bot, <em>sforcebot</em>, let's enhance our Kik bot.</p><p>Typically, sales and marketing business users always need to keep track of their sales and marketing activities. They need to track their own leads and opportunities, and maintain campaigns. Now, to track these activities, they rely on CRM systems.</p><p>In the next section, we will actually look at how a bot can be effective in such business use cases. Our bot will be now integrated with a CRM system and will provide all the required information to the business users at their fingertips.</p><p>Let's assume you are one of the business users who work in sales and marketing. Now, you would like to see upcoming business opportunities quickly and easily. It is assumed that your organization is already on a cloud-based CRM. So you will be interacting with the Kik bot named sforcebot. During the interaction, you will request upcoming opportunities for the current month. The bot knows who you are and will look for opportunities owned by you for the current month. sforcebot will gather the information and will present opportunities in a nice readable format within a chat window.</p><p>Awesome!!</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec29"/>Salesforce and our bot</h3></div></div></div><p>Let's assume we have our business opportunities data in Salesforce and we have already logged in to the Saleforce platform. Now, from our bot perspective, we are interested in showing opportunity data for the current month and the next month. In Salesforce, we get these views preconfigured for us.</p><p>Opportunities closing this month can be seen as in the following screenshot:</p><p>
</p><div><img src="img/image00415.jpeg" alt="Salesforce and our bot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Opportunities closing next month can be seen as in the following screenshot:</p><p>
</p><div><img src="img/image00416.jpeg" alt="Salesforce and our bot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In our bot, we will be pulling the same data based on users' requests for information. So it's time to prepare for Saleforce and our bot integration.</p><div><div><div><div><h4 class="title"><a id="ch09lvl4sec21"/>Security token to access the Salesforce API</h4></div></div></div><p>To access information from Salesforce, we need a security token. This token is a case-sensitive alphanumeric code which is associated with your password. Whenever we change our password, this security token is also reset.</p><p>Let's get our security token for our Salesforce API access, using the <strong>Reset Security Token</strong> menu option from Salesforce as follows:</p><p>
</p><div><img src="img/image00417.jpeg" alt="Security token to access the Salesforce API"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>To quickly locate the <strong>Reset Security Token</strong> option, you can use the Quick Find/Search option from the left corner of menu options from Salesforce. In the preceding screenshot, I entered the words <code class="literal">Security Token</code> and searched for the option, <strong>Reset Security Token</strong>.</p><p>Click on the <strong>Reset Security Token</strong> button to get the fresh token for accessing Salesforce APIs. The new token will be sent to your registered e-mail ID.</p></div></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec30"/>Wiring it up all together</h3></div></div></div><p>To wire up Salesforce and Node.js, we will be using the Salesforce API library JSforce. This can be located at <a class="ulink" href="https://www.npmjs.com/package/jsforce">
https://www.npmjs.com/package/jsforce
</a>.</p><p>Let's install the <code class="literal">JSforce</code> library using the following command:</p><pre class="programlisting">
<strong>npm install jsforce --save</strong>
</pre><p>To wire up all the things together, let's modify our earlier <code class="literal">server.js</code> as follows:</p><pre class="programlisting">var util = require('util'); 
var http = require('http'); 
var Bot = require('@kikinteractive/kik'); 
var request = require('request'); 
 
var username = "&lt;SALESFORCE_USERNAME&gt;"; 
var password = "&lt;SALESFORCE_PASSWORD&gt;"; 
var accesstoken = password + '&lt;SALESFORCE_SECURITY_TOKEN&gt;'; 
 
var fromUserName; 
 
// Configure the bot 
var bot = new Bot({ 
  username: 'sforcebot', 
  apiKey: '&lt;YOUR BOT API KEY&gt;' 
}); 
 
 
var jsforce = require('jsforce'); 
var conn = new jsforce.Connection(); 
 
bot.onTextMessage(/^hi|hello|how|hey$/i, (incoming, next) =&gt; { 
  bot.getUserProfile(incoming.from) 
    .then((user) =&gt; { 
      fromUserName = user.username; 
      incoming.reply('Hello,I am the SForce Bot. I provide your CRM information just by chatting.'); 
 
      bot.send(Bot.Message.text('Select any option...') 
        .addResponseKeyboard(['Closing This Month', 'Closing Next Month']) 
        , fromUserName); 
    }); 
}); 
 
 
bot.onTextMessage(/^Closing This Month/i, (incoming, next) =&gt; { 
  incoming.reply('Opportunities for this month...!'); 
  conn.login(username, accesstoken, function (err, res) { 
    if (err) { return console.error(err); } 
    console.log(res.id); 
    var records = []; 
    var qry = "SELECT Account.Name,Name,Amount FROM Opportunity WHERE CloseDate = THIS_MONTH ORDER BY AMOUNT DESC" 
    conn.query(qry, function (err, result) { 
      if (err) { return console.error(err); } 
      rec = result.records; 
      rec.forEach(function (d) { 
        bot.send(Bot.Message.text(d.Name + ' for ' + d.Account.Name + ' worth ' + d.Amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' })) 
          .addResponseKeyboard(['Closing This Month', 'Closing Next Month']), fromUserName); 
      }); 
    }); 
  }); 
}); 
 
bot.onTextMessage(/^Closing Next Month/i, (incoming, next) =&gt; { 
  incoming.reply('Finding your opportunities for next month...!'); 
  conn.login(username, accesstoken, function (err, res) { 
    if (err) { return console.error(err); } 
    console.log(res.id); 
    var records = []; 
    var qry = "SELECT Account.Name,Name,Amount FROM Opportunity WHERE CloseDate = NEXT_MONTH ORDER BY AMOUNT DESC" 
    conn.query(qry, function (err, result) { 
      if (err) { return console.error(err); } 
      rec = result.records; 
      rec.forEach(function (d) { 
        bot.send(Bot.Message.text(d.Name + ' for ' + d.Account.Name + ' worth ' + d.Amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' })) 
          .addResponseKeyboard(['Closing This Month', 'Closing Next Month']), fromUserName); 
      }); 
    }); 
  });
}); 
 
// Set up your server and start listening 
var server = http 
  .createServer(bot.incoming()) 
  .listen(process.env.PORT || 8080); 
</pre></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec31"/>Understanding the code</h3></div></div></div><p>We already have a code understanding for the basic bot. Let's look at the code step by step from a Salesforce integration perspective:</p><pre class="programlisting">var username = "&lt;SALESFORCE_USERNAME&gt;"; 
var password = "&lt;SALESFORCE_PASSWORD&gt;"; 
var accesstoken = password + '&lt;SALESFORCE_SECURITY_TOKEN&gt;'; 
var fromUserName; 
</pre><p>We have declared variables for the Salesforce username and password. We have also declared a variable, <code class="literal">accesstoken</code>. This is needed while accessing Salesforce APIs. The <code class="literal">fromUserNam</code> variable is declared for storing the username. This is used while replying to messages from the user who has started the conversation.</p><p>Now let's look at how we are wiring up Salesforce for our bot:</p><pre class="programlisting">var jsforce = require('jsforce'); 
var conn = new jsforce.Connection(); 
</pre><p>These code lines use the npm package, <code class="literal">jsforce</code>, for connecting Salesforce.</p><p>Now let's see how we are enhancing the conversation experience for our bot. The following code lines help to guide the end user with possible input options:</p><pre class="programlisting">bot.onTextMessage(/^hi|hello|how|hey$/i, (incoming, next) =&gt; { 
  bot.getUserProfile(incoming.from) 
    .then((user) =&gt; { 
      fromUserName = user.username; 
      incoming.reply('Hello,I am the SForce Bot. I provide your CRM information just by chatting.'); 
 
      bot.send(Bot.Message.text('Select any option...') 
        .addResponseKeyboard(['Closing This Month', 'Closing Next Month']) 
        , fromUserName); 
    }); 
}); 
</pre><p>In the preceding code, whenever the end user says <code class="literal">hi</code> or <code class="literal">hello </code>or <code class="literal">how</code> or <code class="literal">hey</code>, the <code class="literal">bot.onTextMessage()</code> function is called and bot gets the username from an <code class="literal">incoming</code> message with the help of the <code class="literal">bot.getUserProfile()</code>function.</p><p>Once the name of user who is chatting is retrieved, the bot replies with an introduction to the user using the <code class="literal">incoming.reply()</code> function.</p><p>Along with this reply, sforcebot also shows a keyboard with suggested responses. This type of keyboard response is generated using the <code class="literal">addResponseKeyboard()</code> method with an array of suggestions such as <code class="literal">(['Closing This Month', 'Closing Next Month'])</code>.</p><p>To understand this in a better way, let me show you how the suggested responses can be seen in the Kik app in our case:</p><p>
</p><div><img src="img/image00418.jpeg" alt="Understanding the code"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>
<strong>Closing This Month</strong> and <strong>Closing Next Month</strong> are appearing as possible suggested responses which the user can consider. This is really intuitive and helps the user to easily select options rather than entering keywords for further communication. The user can still enter these keywords and continue, but showing such a keyboard saves a lot of time for users. This also guides the user during the conversations.</p><p>In the next section, we will see code implementations for querying data from Salesforce.</p><p>Let's assume now the user has selected one of the options, <strong>Closing This Month</strong>. Our bot quickly captures with the help of the <code class="literal">bot.onTextMessage(/^Closing This Month/i, (incoming, next) </code>function and starts responding. There is a regex pattern matching done to understand what the user is selecting. Refer to the following code snippet:</p><pre class="programlisting">bot.onTextMessage(/^Closing This Month/i, (incoming, next) =&gt; { 
  incoming.reply('Opportunities for this month...!'); 
  conn.login(username, accesstoken, function (err, res) { 
    if (err) { return console.error(err); } 
    console.log(res.id); 
    var records = []; 
    var qry = "SELECT Account.Name,Name,Amount FROM Opportunity WHERE CloseDate = THIS_MONTH ORDER BY AMOUNT DESC" 
    conn.query(qry, function (err, result) { 
      if (err) { return console.error(err); } 
      rec = result.records; 
      rec.forEach(function (d) { 
        bot.send(Bot.Message.text(d.Name + ' for ' + d.Account.Name + ' worth ' + d.Amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' })) 
          .addResponseKeyboard(['Closing This Month', 'Closing Next Month']), fromUserName); 
      }); 
    }); 
  }); 
}); 
</pre><p>Since the user has selected the option to see opportunities closing this month, the bot will log in to Salesforce and query the data with the help of the <code class="literal">conn.login()</code>and <code class="literal">conn.query()</code> functions.</p><p>While logging in to Salesforce, JSforce uses the SOAP login API, so we are using <code class="literal">username</code> and <code class="literal">accesstoken</code>. Once login is established, we execute the query on Salesforce and get the data. We iterate the results and formulate the message to be sent to the user identified by the <code class="literal">fromUserName</code> variable.</p><p>If you notice, the <code class="literal">qry</code> variable is the Salesforce Object Query Language (SOQL). You can find further details of SOQL at <a class="ulink" href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_sosl_intro.htm">https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_sosl_intro.htm</a>.</p><p>In our query, SOQL has made it simpler for date operations. For getting opportunities for the current month from Salesforce, we just need to apply a filter using <code class="literal">THIS_MONTH </code>and <code class="literal">NEXT_MONTH</code>. This really made my life simpler while building these two use cases. SOQL is great!</p><p>Once this response is set to the user, the user might be interested in opportunities for the next month as well, so we are again sending suggested responses at the end.</p><p>The code implementation for <strong>Closing Next Month</strong> is on similar lines to <strong>Closing This Month</strong>. I have kept both the implementations in separate functions. This can be further optimized. I will leave this task to the readers.</p><p>Let's run our bot now and see how it interacts and provides us with a great conversational experience.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec41"/>Running our enhanced Kik Salesforce bot</h2></div></div></div><p>Deploy the updated code to Azure and start our sforcebot server. After successfully starting a bot, it will be shown in Kik. Or you can search by name and then add it for chatting. Once added, just say <code class="literal">Hi</code> and see how the bot is responding to us, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00419.jpeg" alt="Running our enhanced Kik Salesforce bot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>On selecting the option, <strong>Closing This Month</strong>:</p><p>
</p><div><img src="img/image00420.jpeg" alt="Running our enhanced Kik Salesforce bot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Hopefully, you have now enough insight on how we can leverage the Kik platform and Kik bots for better connection with your employees, users, and partners.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec44"/>sforcebot for campaign management</h1></div></div></div><p>So far, we have been retrieving opportunities data in messaging platforms; we can also retrieve Salesforce campaigns data. Assume that one of the universities is using Salesforce for their campaign management. This university would like to spread its campaigns across its students and to ensure there is a better connection and engagement between students and the university while running various campaigns.</p><p>Knowing students' presence on the Kik platform, this becomes a very effective way for connecting to students. Using the same sforcebot, this can be easily achieved. Instead of opportunities, now the data will be coming from campaigns. I am just illustrating this use case using the following screenshots:</p><p>
</p><div><img src="img/image00421.jpeg" alt="sforcebot for campaign management"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the preceding screenshots, just by passing the <code class="literal">Campaign</code> keyword, sforcebot is displaying active campaigns from Salesforce. Since these are campaigns, we are not only showing text messages, but we are also showing pictures about these campaigns and their start date and end date.</p><p>This way, universities can establish a connection with students and improve their engagement and participation for such events.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec45"/>Summary</h1></div></div></div><p>Every enterprise would like to connect to their customers, employees, and partners. Knowing users' increasing engagement with chat platforms, these enterprises can leverage Kik-like messaging platforms for better connection.</p><p>In this chapter, we implemented the Kik bot sforcebot, assuming users' engagement with the Kik messaging platform. Sales and marketing users can collaborate as well as seeking the right information at the right time and tracking their sales and marketing activities easily and effectively.</p><p>Firstly, we created a basic sforcebot by scanning a code and implemented it in Node.js. Then we extended our sforcebot and wired it up with Salesforce. Now, based on the user's request, sforcebot provided information on the user's opportunities in the chatting interface itself.</p><p>We also saw a small example of how universities can use the Kik platform and Salesforce to connect to their graduating students. This way, universities can connect to their graduates and spread the word about campaigns they are running, during their academics.</p><p>I hope you had a nice Kik around with this chapter.</p></div></body></html>