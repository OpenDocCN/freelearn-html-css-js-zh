<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Become a Musical Maestro</h1></div></div></div><p>Although you might think the games you created while reading this book are complete, they lack some kind of atmosphere due to a simple reason: they are mute.</p><p>No sounds, no background music, nothing. A complete, fully polished game must have background music and sound effects, and that's what you are going to learn in this chapter.</p><p>Follow me, and you will be able to:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add sound effects to your games</li><li class="listitem" style="list-style-type: disc">Add background music to your games</li><li class="listitem" style="list-style-type: disc">Loop sounds</li><li class="listitem" style="list-style-type: disc">Start and stop sounds</li><li class="listitem" style="list-style-type: disc">Changing the volume of music and sound effects</li></ul></div><p>Also, just because the more you learn the better it is, you will also see how to create option menus.</p><p>Now, surf the Web and choose some great music and sound effects.</p><div><div><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Choosing sounds</h1></div></div></div><p>Let's guess <a id="id195" class="indexterm"/>what happened. You found that incredible song, which is a <a id="id196" class="indexterm"/>mix between electronic and heavy metal and think it would fit really good in your space shooter game. You downloaded it and enjoyed 4 minutes and 56 seconds of Blu-ray quality sound.</p><p>Also, in a matter of minutes, you found at least three more songs that would also fit perfectly in your game. Let's add them all, doing an in-game radio like in a GTA series.</p><p>No. Wait! The player is running your game in a browser, probably outside any free Wi-Fi zone, with a not so high download speed. You simply can't make them wait half an hour just to download a song unless your name is Lady Gaga and that sound is your latest smash hit.</p><p>People want to press <em>play</em> and play your game; remember, you are making games, not sounds in a matter of seconds, so choose your sounds wisely, they can't be bigger than the game itself.</p><p>Play with sound quality until you find a good compromise between quality and weight, and when choosing background music, a short loop is way better than a long tune.</p><p>Also, remember different browsers in different operative system read different sound types, so you <a id="id197" class="indexterm"/>should provide the same sound in three different formats: <code class="literal">MP3</code>, <code class="literal">WAV</code>, and <code class="literal">OGG</code>.</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>Talking about sounds optimization and conversion is beyond the scope of this book, but I <a id="id198" class="indexterm"/>suggest you use the free software I used to edit sounds to be included in my games, <strong>Audacity</strong>, found at <a class="ulink" href="http://audacity.sourceforge.net/">http://audacity.sourceforge.net/</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Preloading sounds</h1></div></div></div><p>Preloading <a id="id199" class="indexterm"/>sounds is exactly the same as preloading graphic assets. In the <code class="literal">assets</code> folder, there are two mp3 files: <code class="literal">loop.mp3</code>, which is a short loop used as background music, and <code class="literal">bang.mp3</code>, which is an Uzi sound effect. Remember in your final project, you will have to include the <code class="literal">WAV</code> and <code class="literal">OGG</code> files as well in order to ensure the largest compatibility possible among different browsers in various devices.</p><p>The <code class="literal">loadassets.js</code> file will include the array of sounds to preload:</p><div><pre class="programlisting">var gameResources = [
  "assets/bang.mp3",
  "assets/loop.mp3"
];
</pre></div><p>Now, let's create a menu to play with sounds and music.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Creating a sound menu</h1></div></div></div><p>There are <a id="id200" class="indexterm"/>several ways to create a menu, and the most interesting is to create the graphic assets of every menu item, then add touch or mouse listeners, and handle the whole thing in a way you should already know.</p><p>This time, you'll see something new: the Cocos2d-JS built-in <code class="literal">Menu</code> class.</p><p>This is the <a id="id201" class="indexterm"/>content of <code class="literal">gameScript.js</code>:</p><div><pre class="programlisting">var gameScene = cc.Scene.extend({
  onEnter:function () {
    this._super();
    gameLayer = new game();
    gameLayer.init();
    this.addChild(gameLayer);
  }
});

var game = cc.Layer.extend({
  init:function () {
    this._super();
    this.audioEngine = cc.audioEngine;
    var playSoundMenu = new cc.MenuItemFont.create("Play Sound effect",this.playSound,this);
    playSoundMenu.setPosition(new cc.Point(0,350));
    var playBGMusicMenu = new cc.MenuItemFont.create("Play BG music",this.playBGMusic,this);
    playBGMusicMenu.setPosition(new cc.Point(0,300));
    var stopBGMusicMenu = new cc.MenuItemFont.create("Stop BG music",this.stopBGMusic,this);
    stopBGMusicMenu.setPosition(new cc.Point(0,250));
    var musicUpMenu = new cc.MenuItemFont.create("Music volume Up",this.musicUp,this);
    musicUpMenu.setPosition(new cc.Point(0,200));
    var musicDownMenu = new cc.MenuItemFont.create("Music volume Down",this.musicDown,this);
    musicDownMenu.setPosition(new cc.Point(0,150));
    var effectsUpMenu = new cc.MenuItemFont.create("Effects volume Up",this.effectsUp,this);
    effectsUpMenu.setPosition(new cc.Point(0,100));
    var effectsDownMenu = new cc.MenuItemFont.create("Effects volume Down",this.effectsDown,this);
    effectsDownMenu.setPosition(new cc.Point(0,50));
    var menu = cc.Menu.create(playSoundMenu,playBGMusicMenu,stopBGMusicMenu,musicUpMenu,musicDownMenu,effectsUpMenu,effectsDownMenu);
    menu.setPosition(new cc.Point(160,40));
    this.addChild(menu);
  }
});</pre></div><p>That's really a lot of stuff, but there isn't that much to learn: the <code class="literal">gameScene</code> variable declaration is the same as in previous projects, and the game declaration is different from the following line of code:</p><div><pre class="programlisting">this.audioEngine = cc.audioEngine;</pre></div><p>This will allow you to initialize the audio engine, you only find a lot: seven menu item declarations to be precise like this one:</p><div><pre class="programlisting">var playSoundMenu = new cc.MenuItemFont.create("Play Sound effect",this.playSound,this);
playSoundMenu.setPosition(new cc.Point(0,350));</pre></div><p>The <code class="literal">cc.MenuItemFont.create</code> function creates a text menu item with a zoom effect when <a id="id202" class="indexterm"/>it's clicked.</p><p>The three arguments represent the text to display, the callback function to run, and the target to run the callback, respectively.</p><p>All seven menu <a id="id203" class="indexterm"/>items are created in the same way and placed with the <code class="literal">setPosition</code> method you already know.</p><p>Once all these items have been created, you turn them into an actual menu with the following code snippet:</p><div><pre class="programlisting">var menu = cc.Menu.create(playSoundMenu,playBGMusicMenu,stopBGMusicMenu,musicUpMenu,musicDownMenu,effectsUpMenu,effectsDownMenu);
menu.setPosition(new cc.Point(160,40));
this.addChild(menu);</pre></div><p>The <code class="literal">Menu.create</code> <a id="id204" class="indexterm"/>function contains all the menu items you just created, and it's added and positioned on the stage as usual with <code class="literal">addChild</code> and <code class="literal">setPosition</code>.</p><p>Run the project and you will see what is shown in the following screenshot:</p><div><img src="img/0075OS_05_01.jpg" alt="Creating a sound menu"/></div><p>Click or touch <a id="id205" class="indexterm"/>the menu items to see the zoom-in effect, although nothing happens because callback functions still have to be created.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Managing music and sound effects</h1></div></div></div><p>It's <a id="id206" class="indexterm"/>time to create all the callback functions, so let's expand the <a id="id207" class="indexterm"/>content of the <code class="literal">game</code> class declaration:</p><div><pre class="programlisting">var game = cc.Layer.extend({
  init:function () {
    // same as before
  },
  playSound:function(){
    this.audioEngine.playEffect("assets/bang.mp3");
  },
  playBGMusic:function(){
    if(!this.audioEngine.isMusicPlaying()){
      this.audioEngine.playMusic("assets/loop.mp3",true);
    }
  },
  stopBGMusic:function(){
    if(this.audioEngine.isMusicPlaying()){
      this.audioEngine.stopMusic();
    }
  },
  musicUp:function(){
    this.audioEngine.setMusicVolume(this.audioEngine.getMusicVolume()+0.1);
  },
  musicDown:function(){
    this.audioEngine.setMusicVolume(this.audioEngine.getMusicVolume()-0.1);
  },
  effectsUp:function(){
    this.audioEngine.setEffectsVolume(this.audioEngine.getEffectsVolume()+0.1);
  },
  effectsDown:function(){
    this.audioEngine.setEffectsVolume(this.audioEngine.getEffectsVolume()-0.1);
  }
});</pre></div><p>Now, if <a id="id208" class="indexterm"/>you test the project, you will be able to play and stop sounds as well as adjust adjust the volume of the music and sound effects.</p><p>Let's see <a id="id209" class="indexterm"/>all the functions one by one:</p><div><pre class="programlisting">playSound:function(){
  this.audioEngine.playEffect("assets/bang.mp3");
}
playEffect method simply plays a sound effect.
playBGMusic:function(){
  if(!this.audioEngine.isMusicPlaying()){
    this.audioEngine.playMusic("assets/loop.mp3",true);
  }
}</pre></div><p>When the music is not playing, use the <code class="literal">playMusic</code> method to play the music. The second argument means to loop it. You can see whether the music is playing, thanks to the <code class="literal">isMusicPlaying</code> method:</p><div><pre class="programlisting">stopBGMusic:function(){
  if(this.audioEngine.isMusicPlaying()){
    this.audioEngine.stopMusic();
  }
}</pre></div><p>Applying the same concept used before, if the music is already playing, you stop it with the <code class="literal">stopMusic</code> method:</p><div><pre class="programlisting">musicUp:function(){
  this.audioEngine.setMusicVolume(this.audioEngine.getMusicVolume()+0.1);
}</pre></div><p>The <a id="id210" class="indexterm"/>
<code class="literal">getMusicVolume</code> and <code class="literal">setMusicVolume</code> methods get <a id="id211" class="indexterm"/>and set music volume with values from 0 (no volume) to <a id="id212" class="indexterm"/>1 (full volume), respectively:</p><div><pre class="programlisting">musicDown:function(){
this.audioEngine.setMusicVolume(this.audioEngine.getMusicVolume()-0.1);
}</pre></div><p>The following <a id="id213" class="indexterm"/>concepts are applied to <code class="literal">getEffectsVolume</code> and <code class="literal">setEffectsVolume</code>:</p><div><pre class="programlisting">effectsUp:function(){
  this.audioEngine.setEffectsVolume(this.audioEngine.getEffectsVolume()+0.1);
}
effectsDown:function(){
  this.audioEngine.setEffectsVolume(this.audioEngine.getEffectsVolume()-0.1);
}</pre></div><p>Also, this is how you can manage sounds with Cocos2d-JS.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec41"/>Summary</h1></div></div></div><p>Thanks to what you learned in this chapter, your games will now feature background music and sound effects.</p><p>Why don't you add sounds to the games you made during previous chapters? Then, get ready because we are going to bring interactivity to a whole new level!</p></div></body></html>