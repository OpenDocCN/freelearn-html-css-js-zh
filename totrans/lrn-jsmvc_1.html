<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Getting Started with JavaScriptMVC"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with JavaScriptMVC</h1></div></div></div><p>In this chapter, get an overview of the JavaScriptMVC framework. We will install it, go through the architecture, and learn it in the best possible way. Finally, we will build a simple application. There is nothing that works better than an example. Some say this is the only thing that works.</p><div class="section" title="What is JavaScriptMVC?"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>What is JavaScriptMVC?</h1></div></div></div><p><span class="strong"><strong>JavaScriptMVC</strong></span> (<span class="strong"><strong>JMVC</strong></span>) is a <a id="id0" class="indexterm"/>JavaScript open source <span class="strong"><strong>model-view-controller</strong></span> (<span class="strong"><strong>MVC</strong></span>) <a id="id1" class="indexterm"/>framework build, on top of the jQuery library.</p><p>It is the backend agnostic client-side framework that can be used with any backend solution, such as Node.js, Ruby on Rails, Django, and so on.</p><p>The idea behind JavaScriptMVC is to provide a set of tools to build high quality and maintainable applications in the shortest amount of time possible.</p><p>JavaScriptMVC contains the following independent components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>StealJS</strong></span>: This is the <a id="id2" class="indexterm"/><a id="id3" class="indexterm"/>dependency manager and production build</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>FuncUnit</strong></span>: This is the <a id="id4" class="indexterm"/><a id="id5" class="indexterm"/>unit and functional test component</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>jQueryMX</strong></span>: This contains a <a id="id6" class="indexterm"/><a id="id7" class="indexterm"/>set of plugins that provide the functionality to implement and organize large JavaScript codebases into a well-structured and organized form, provide a model-view-controller abstraction layer</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>DocumentJS</strong></span>: This is the <a id="id8" class="indexterm"/><a id="id9" class="indexterm"/>documentation</li></ul></div><p>The first version was published in May 2008. Current Version 3.2 was released in December 2010. The latest version at the time of writing this book is 3.2.2.</p><p>In the next Version 3.3 of JavaScriptMVC, which should be released soon, jQueryMX project will be replaced by CanJS. Projects using current version of JMVC should work after small refactoring with JMVC 3.3 thanks to the names fallback.</p><p>JavaScriptMVC 4.0 will be renamed to DoneJS and contain significant changes to StealJS which will be fully AMD compatible work with CommonJS and run with Node.js. FuncUnit will be split into 3 parts: Syn - Synthetic event library, ShouldJS - Asynchronous test driving using Jasmine or QUnit and DidJS - Automated test runner bindings for Jasmine or QUnit for Selenium, PhantomJS, and so on.</p><div class="section" title="License"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>License</h2></div></div></div><p>JavaScriptMVC is licensed under the MIT <a id="id10" class="indexterm"/>license with the following <a id="id11" class="indexterm"/>exceptions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rhino: This is the JavaScript command line (MPL 1.1)</li><li class="listitem" style="list-style-type: disc">Selenium browser automation (Apache 2)</li></ul></div></div><div class="section" title="Links"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Links</h2></div></div></div><p>You can refer to the following URLs to learn more about JavaScriptMVC:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Official <a id="id12" class="indexterm"/>website: <a class="ulink" href="http://javascriptmvc.com">http://javascriptmvc.com</a></li><li class="listitem" style="list-style-type: disc">Repository<a id="id13" class="indexterm"/>: <a class="ulink" href="https://github.com/bitovi/javascriptmvc">https://github.com/bitovi/javascriptmvc</a> </li></ul></div></div></div></div>
<div class="section" title="Why JavaScriptMVC?"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Why JavaScriptMVC?</h1></div></div></div><p>JavaScriptMVC is a solid and well documented framework.</p><p>It is based on the extremely popular JavaScript library <a id="id14" class="indexterm"/>
<span class="strong"><strong>jQuery</strong></span>, where many JavaScript programmers are familiar with its factory methods and chainable function style.</p><p>JavaScriptMVC is a complete package. It contains everything we need to build, manage, document, and test JavaScript projects.</p><p>Since it is a modular framework, we <a id="id15" class="indexterm"/>don't need to use all the available components. We can start by using only framework components that we actually need, and add additional components as and when we need them.</p><p>The learning curve is pretty low, especially if a reader is familiar with other JavaScript frameworks, such as lightweight Backbone and Sammy or heavyweight toolkits such as Dojo toolkit or Google Closure. At the same time, it offers much more than lightweight brothers without a heavy feel, such as Google Closure which produces much cleaner code and provides better documentation than the very popular Dojo toolkit.</p><p>One of its killer features is that it prevents memory leakage. This is a very important aspect of client-side applications, which perform many operations on the <a id="id16" class="indexterm"/>
<span class="strong"><strong>Document Object Model</strong></span> (<span class="strong"><strong>DOM</strong></span>) tree.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p><span class="strong"><strong>MVC in JavaScriptVC</strong></span></p><p>JavaScriptMVC <a id="id17" class="indexterm"/>utilizes the classic MVC pattern, which separates business logic and application data from the user interface.</p></div></div></div>
<div class="section" title="System architecture approach"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>System architecture approach</h1></div></div></div><p>When building web applications, <a id="id18" class="indexterm"/>we can distinguish between two approaches—multi-page application and single-page application.</p><p>In <span class="strong"><strong>multi-page application</strong></span>, most of the <a id="id19" class="indexterm"/>business logic is implemented in the backend system, with some enhancement done in JavaScript. For example, the Ruby on Rails application, where most of the main logic is done by the backend MVC architecture and when a user navigates to another page, an ordinary <code class="literal">http</code> request is sent.</p><p>In <span class="strong"><strong>single-page application</strong></span>, most of the business logic is implemented on the frontend side. For example, the JavaScriptMVC application, where most of the main logic is done by frontend MVC architecture. When a user navigates to another page, the frontend router dispatches all requests and makes calls to the back end API written; for example, in Sinatra.</p><div class="section" title="JavaScriptMVC single-page application"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>JavaScriptMVC single-page application</h2></div></div></div><p>JavaScriptMVC is designed for single-page application use cases. It's good to know about the advantages and disadvantages of the single-page application approach compared to that of the multi-page application.</p><div class="section" title="Advantages"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Advantages</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Most of the states are maintained in the client, so we don't need to keep the session states on the server side</li><li class="listitem" style="list-style-type: disc">Most of the requests are done through <a id="id20" class="indexterm"/>XRH calls, so there is no need to load a new page each time, which could cause high memory footprint (especially in the old fashion, non event-based servers such as Apache)</li><li class="listitem" style="list-style-type: disc">Most of the business logic is on the client side, so we can save many calls to the server</li></ul></div></div><div class="section" title="Downsides"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Downsides</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Load balance and <a id="id21" class="indexterm"/><span class="strong"><strong>Content Delivery Network</strong></span> (<span class="strong"><strong>CDN</strong></span>) can be tricky since RPC is used to move data back and <a id="id22" class="indexterm"/>forth between the server and client.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Search Engine Optimization</strong></span> (<span class="strong"><strong>SEO</strong></span>) <a id="id23" class="indexterm"/>can be tricky due to on-demand JavaScript built pages.</li></ul></div></div></div></div>
<div class="section" title="Real-world examples"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Real-world examples</h1></div></div></div><p>Readers can find web applications <a id="id24" class="indexterm"/>built with the JavaScriptMVC <a id="id25" class="indexterm"/>framework at <a class="ulink" href="http://community.javascriptmvc.com/posts/in-bucket/apps">http://community.javascriptmvc.com/posts/in-bucket/apps</a>.</p></div>
<div class="section" title="Installing JavaScriptMVC"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Installing JavaScriptMVC</h1></div></div></div><p>Installing JavaScriptMVC is <a id="id26" class="indexterm"/>as easy as making tea, but faster.</p><div class="section" title="Choosing your method"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Choosing your method</h2></div></div></div><p>There are three methods.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download the complete <a id="id27" class="indexterm"/>package from the official website (<a class="ulink" href="http://javascriptmvc.com">http://javascriptmvc.com</a>) or build a custom package including the components we want to use (<a class="ulink" href="http://javascriptmvc.com/builder.html">http://javascriptmvc.com/builder.html</a>)</li><li class="listitem" style="list-style-type: disc">Pull code from the Git repositories hosted on GitHub.</li><li class="listitem" style="list-style-type: disc">Use Vagrant</li></ul></div><p>The last two methods <a id="id28" class="indexterm"/>are the preferred way, for the following reasons:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Easy update to the latest version</li><li class="listitem" style="list-style-type: disc">Easy switch to another version by the <code class="literal">checkout</code> tag</li><li class="listitem" style="list-style-type: disc">Contribution to the project; how awesome is that? For more information about contributing, visit <a class="ulink" href="http://javascriptmvc.com/docs.html#!developwithgit">http://javascriptmvc.com/docs.html#!developwithgit</a></li></ul></div><p>The third method seems to be the best one, because it contains all the advantages from the second one, plus it creates an encapsulated environment, which we can easily and quickly create or delete without affecting our current development environment setup.</p><div class="section" title="Which method is right for me?"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Which method is right for me?</h3></div></div></div><p>For a fast tryout library, choose the first method. For the actual development, definitely choose the second one.</p></div><div class="section" title="The first method – download the package"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>The first method – download the package</h3></div></div></div><p>In this method, we will use a web <a id="id29" class="indexterm"/>interface on the JavaScriptMVC web page to configure and download the package:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download the complete package from <a class="ulink" href="http://javascriptmvc.com">http://javascriptmvc.com</a> and unpack its content. </li><li class="listitem">Create a folder named <code class="literal">Todo</code> under the local web server working directory.</li><li class="listitem">Copy all files from <code class="literal">javascriptmvc-3.2.2</code> to the <code class="literal">Todo</code> folder and start the web server.<div class="informalexample"><pre class="programlisting">
$ mkdir Todo &amp;&amp; cp -r javascriptmvc-3.2.2/* Todo &amp;&amp; cd Todo
</pre></div></li></ol></div><p>That is it; we are all set and ready to go.</p></div><div class="section" title="The second method – pull the code from Git repositories"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>The second method – pull the code from Git repositories</h3></div></div></div><p>We assume that the reader <a id="id30" class="indexterm"/>knows and has installed Git.</p><p>If not, the following resources might be helpful:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Installing </strong></span><a id="id31" class="indexterm"/><span class="strong"><strong>Git</strong></span>: <a class="ulink" href="http://git-scm.com/book/en/Getting-Started-Installing-Git">http://git-scm.com/book/en/Getting-Started-Installing-Git</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Free book Pro Git</strong></span>: <a class="ulink" href="http://git-scm.com/book">http://git-scm.com/book</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Git </strong></span><a id="id32" class="indexterm"/><span class="strong"><strong>reference</strong></span>: <a class="ulink" href="http://gitref.org">http://gitref.org</a></li></ul></div><p>In the following steps, we are going to install <a id="id33" class="indexterm"/>JavaScriptMVC for our <code class="literal">Todo</code> example project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Under local web server directory, create new folder named <code class="literal">Todo</code>:<div class="informalexample"><pre class="programlisting">$ mkdir Todo &amp;&amp; cd Todo</pre></div></li><li class="listitem">Inside the <code class="literal">Todo</code> folder, create a new Git repository:<div class="informalexample"><pre class="programlisting">$ git init</pre></div></li><li class="listitem">Add JavaScriptMVC components as submodules to the project:<div class="informalexample"><pre class="programlisting">$ git submodule add git://github.com/bitovi/steal.git
$ git submodule add git://github.com/bitovi/documentjs.git
$ git submodule add git://github.com/bitovi/funcunit.git
$ git submodule add git://github.com/jupiterjs/jquerymx jquery</pre></div></li><li class="listitem">Install and update the submodules:<div class="informalexample"><pre class="programlisting">$ git submodule init
$ git submodule update</pre></div></li><li class="listitem">The last module we need to install is <code class="literal">Syn</code>. Since it is already a submodule to the <code class="literal">FuncUnit</code> project, all we need to do is initialize and update it:<div class="informalexample"><pre class="programlisting">$ cd funcunit
$ git submodule init
$ git submodule update</pre></div></li><li class="listitem">Switch <code class="literal">Syn</code> to the <code class="literal">master</code> branch:<div class="informalexample"><pre class="programlisting">$ cd syn/
$ git checkout master</pre></div></li><li class="listitem">Go back to the root directory of the project:<div class="informalexample"><pre class="programlisting">$ cd ../..</pre></div></li><li class="listitem">Move the <code class="literal">js</code> command to the root directory of the project:<div class="informalexample"><pre class="programlisting">$ ./steal/js steal/make.js</pre></div></li></ol></div><div class="section" title="Verifying Installation"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec01"/>Verifying Installation</h4></div></div></div><p>The project directory should have <a id="id34" class="indexterm"/>following folder structure:</p><div class="informalexample"><pre class="programlisting">.git
.gitmodules
documentjs
funcunit
jquery
js
js.bat
steal</pre></div><p>That is it; we are all set and <a id="id35" class="indexterm"/>ready to go.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>More about submodules in <a id="id36" class="indexterm"/>Git: <a class="ulink" href="http://git-scm.com/book/en/Git-Tools-Submodules">http://git-scm.com/book/en/Git-Tools-Submodules</a></p></div></div></div></div><div class="section" title="The third method – Vagrant"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>The third method – Vagrant</h3></div></div></div><p>To install JavaScriptMVC using this method, we need to <a id="id37" class="indexterm"/>install <span class="strong"><strong>Vagrant</strong></span>, which is a virtualized development tool wrapper around Oracle VM VirtualBox, an x86 and AMD64/Intel64 virtualization software package.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download and install <a id="id38" class="indexterm"/>Oracle VM VirtualBox (<a class="ulink" href="https://www.virtualbox.org">https://www.virtualbox.org</a>).</li><li class="listitem">Download and install <a id="id39" class="indexterm"/>Vagrant (<a class="ulink" href="http://downloads.vagrantup.com">http://downloads.vagrantup.com</a>).</li><li class="listitem">Download an unpack the JavaScriptMVC kick-starter (<a class="ulink" href="https://github.com/wbednarski/JavaScriptMVC_kick-starter/archive/master.zip">https://github.com/wbednarski/JavaScriptMVC_kick-starter/archive/master.zip</a>).</li><li class="listitem">Inside JavaScriptMVC kick-starter folder type <code class="literal">vagrant up</code>.<p>This command creates a virtual environment and a projects directory. It also installs the web server. JavaScriptMVC framework will be placed in the <code class="literal">Todo</code> directory.</p></li></ol></div><p>Any changes we make inside the projects directory are immediately visible in web browser at <code class="literal">http://192.168.111.111/</code>.</p></div></div></div>
<div class="section" title="Documentation and API"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Documentation and API</h1></div></div></div><p>Good documentation and API, many tutorials, and a well documented codebase is the strong side of JavaScriptMVC:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">JavaScriptMVC <a id="id40" class="indexterm"/>documentation: <a class="ulink" href="http://javascriptmvc.com/docs.html">http://javascriptmvc.com/docs.html</a></li><li class="listitem" style="list-style-type: disc">JavaScriptMVC <a id="id41" class="indexterm"/>API: <a class="ulink" href="http://jqapi.com">http://jqapi.com</a></li><li class="listitem" style="list-style-type: disc">JavaScriptMVC <a id="id42" class="indexterm"/>tutorials: <a class="ulink" href="http://javascriptmvc.com/docs.html#!tutorials">http://javascriptmvc.com/docs.html#!tutorials</a></li><li class="listitem" style="list-style-type: disc">JavaScriptMVC <a id="id43" class="indexterm"/>code examples: <a class="ulink" href="http://javascriptmvc.com/docs.html#!examples">http://javascriptmvc.com/docs.html#!examples</a></li></ul></div><p>Active community on the forum and Stack Overflow:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Stack Overflow questions about <a id="id44" class="indexterm"/>JavaScriptMVC: <a class="ulink" href="http://stackoverflow.com/questions/tagged/javascriptmvc">http://stackoverflow.com/questions/tagged/javascriptmvc</a></li><li class="listitem" style="list-style-type: disc">JavaScriptMVC <a id="id45" class="indexterm"/>official forum: <a class="ulink" href="http://forum.javascriptmvc.com/allforums">http://forum.javascriptmvc.com/allforums</a></li></ul></div></div>
<div class="section" title="The architecture of JavaScriptMVC"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>The architecture of JavaScriptMVC</h1></div></div></div><p>The architecture of JavaScriptMVC is <a id="id46" class="indexterm"/>modular. The powerful stack contains everything we need to build a well organized, tested, and documented application.</p><p>Here is a list of the JavaScriptMVC key components as well as topics covered in the next chapters.</p><div class="section" title="DocumentJS"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>DocumentJS</h2></div></div></div><p><span class="strong"><strong>DocumentJS</strong></span> is an independent JavaScript <a id="id47" class="indexterm"/>documentation application and provides the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Inline demos with source code and HTML panels</li><li class="listitem" style="list-style-type: disc">Adds tags to the documentation</li><li class="listitem" style="list-style-type: disc">Adds documentation as favorite</li><li class="listitem" style="list-style-type: disc">Auto suggest search</li><li class="listitem" style="list-style-type: disc">Test result page</li><li class="listitem" style="list-style-type: disc">Comments</li><li class="listitem" style="list-style-type: disc">Extends the JSDoc syntax</li><li class="listitem" style="list-style-type: disc">Adds undocumented code because it understands JavaScript</li></ul></div></div><div class="section" title="FuncUnit"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>FuncUnit</h2></div></div></div><p><span class="strong"><strong>FuncUnit</strong></span> is an independent web testing <a id="id48" class="indexterm"/>framework and provides the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Test clicking, typing, moving mouse cursor, and drag-and-drop utility</li><li class="listitem" style="list-style-type: disc">Follows users between pages</li><li class="listitem" style="list-style-type: disc">Multi browser and operating system support</li><li class="listitem" style="list-style-type: disc">Continuous integration solution</li><li class="listitem" style="list-style-type: disc">Writes and debugs tests in the web browser</li><li class="listitem" style="list-style-type: disc">Chainable API that parallels jQuery</li></ul></div></div><div class="section" title="jQueryMX"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>jQueryMX</h2></div></div></div><p><span class="strong"><strong>jQueryMX</strong></span> is the MVC part of JavaScriptMVC and <a id="id49" class="indexterm"/>provides the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Encourages logically separated, deterministic code</li><li class="listitem" style="list-style-type: disc">MVC layer</li><li class="listitem" style="list-style-type: disc">Uniform client-side template interface (supports jq-tmpl, EJS, JAML, Micro, and Mustache)</li><li class="listitem" style="list-style-type: disc">Ajax fixtures</li><li class="listitem" style="list-style-type: disc">Useful DOM utilities</li><li class="listitem" style="list-style-type: disc">Language helpers</li><li class="listitem" style="list-style-type: disc">JSON utilities</li><li class="listitem" style="list-style-type: disc">Class system</li><li class="listitem" style="list-style-type: disc">Custom events</li></ul></div></div><div class="section" title="StealJS"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>StealJS</h2></div></div></div><p><span class="strong"><strong>StealJS</strong></span> is an independent code <a id="id50" class="indexterm"/>manager and build tool and provides the following powerful features:</p><div class="section" title="Dependency management"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Dependency management</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loads JavaScript and CoffeeScript</li><li class="listitem" style="list-style-type: disc">Loads CSS, Less, and Sass files</li><li class="listitem" style="list-style-type: disc">Loads client-side templates such as TODO</li><li class="listitem" style="list-style-type: disc">Loasd individual files only once</li><li class="listitem" style="list-style-type: disc">Loads files from a different domain</li></ul></div></div><div class="section" title="Concatenation and compression"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Concatenation and compression</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Google Closure compressor</li><li class="listitem" style="list-style-type: disc">Makes multi-page <a id="id51" class="indexterm"/>build</li><li class="listitem" style="list-style-type: disc">Pre processes <code class="literal">TODO</code></li><li class="listitem" style="list-style-type: disc">Can conditionally remove specified code from the production build</li><li class="listitem" style="list-style-type: disc">Builds standalone jQuery plugins</li></ul></div></div><div class="section" title="Logger"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Logger</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Logs messages in a development mode</li></ul></div></div><div class="section" title="Code generator"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Code generator</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generates an application skeleton</li><li class="listitem" style="list-style-type: disc">Adds the possibility to create your own generator</li></ul></div></div><div class="section" title="Package management"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Package management</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloads and install plugins from SVN and Git repositories</li><li class="listitem" style="list-style-type: disc">Installs the dependencies</li><li class="listitem" style="list-style-type: disc">Runs install scripts</li><li class="listitem" style="list-style-type: disc">Loads individual files only once</li><li class="listitem" style="list-style-type: disc">Loads files from a different domain</li></ul></div></div><div class="section" title="Code cleaner"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Code cleaner</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Runs JavaScript beautifier <a id="id52" class="indexterm"/>against your codebase</li><li class="listitem" style="list-style-type: disc">Runs JSLint against your codebase</li></ul></div></div></div></div>
<div class="section" title="Building simple applications"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Building simple applications</h1></div></div></div><p>We installed JavaScriptMVC <a id="id53" class="indexterm"/>and went briefly through its components. Now, we are ready to build our first JavaScriptMVC application.</p><p>Excited? Let's do the magic.</p><div class="section" title="Todo list"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Todo list</h2></div></div></div><p>We are going to learn <a id="id54" class="indexterm"/>JavaScriptMVC <a id="id55" class="indexterm"/>on the classic example application – the to-do list.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>If you are curious and want to compare different JavaScript frameworks based on the <code class="literal">todos</code> application examples, then the GitHub project is absolutely fantastic. You can find it at <a class="ulink" href="https://github.com/tastejs/todomvc/tree/gh-pages/architecture-examples">https://github.com/tastejs/todomvc/tree/gh-pages/architecture-examples</a>. The project home page is at <a class="ulink" href="http://todomvc.com/">http://todomvc.com/</a>.</p></div></div><div class="section" title="Loader"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Loader</h3></div></div></div><p>In the <code class="literal">Todo</code> folder that we created during installing <a id="id56" class="indexterm"/>JavaScriptMVC, create a folder named <code class="literal">todo</code>. <a id="id57" class="indexterm"/>Create files named <code class="literal">todo.html</code> and <code class="literal">todo.js</code> inside <code class="literal">todo</code>.</p><p>The project directory should have following structure:</p><div class="informalexample"><pre class="programlisting">Todo/
    .git
    .gitmodules
    todo/
        todo.html
        todo.js
    documentjs
    funcunit
    jquery
    js
    js.bat
    steal</pre></div><p>Copy and paste the following code <a id="id58" class="indexterm"/>into <code class="literal">todo.html</code> to load the <code class="literal">StealJS</code> and <code class="literal">todo.js</code> files:</p><div class="informalexample"><pre class="programlisting">&lt;!doctype html&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Todo List&lt;/title&gt;
        &lt;meta charset="UTF-8" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;ul id="todos"&gt;
            &lt;li&gt;all done!&lt;/li&gt;
        &lt;/ul&gt;

        &lt;script src="../steal/steal.js?todo"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p><code class="literal">../steal/steal.js?todo</code> is the equivalent of <code class="literal">../steal/steal.js?todo/todo.js</code>. If file name is not provided <code class="literal">StealJS</code>, try to load the JavaScript file with the same name as the given folder.</p></div></div><p>In <code class="literal">todo.js</code>, add the following code to load the <a id="id59" class="indexterm"/>
<code class="literal">jQueryMX</code> plugins. They are necessary to implement this application:</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/class',
    'jquery/model',
    'jquery/dom/fixture',
    'jquery/view/ejs',
    'jquery/controller',
    'jquery/controller/route',
    
    function ($) {

    }
);</pre></div><p>Open the page in a web browser by typing <code class="literal">http://YOUR_LOCAL_WEB_SERVER/Todo/todo.html</code>, and use a web development tool, such as Google Chrome Inspector, to check if <code class="literal">StealJS</code> and all the listed plugins are loaded properly.</p></div><div class="section" title="Model"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Model</h3></div></div></div><p>The next step is to add a model to our <a id="id60" class="indexterm"/>application by extending <code class="literal">$.Model</code> from the <code class="literal">jQueryMX</code> project.</p><p>The first parameter is the model name (string), <a id="id61" class="indexterm"/>the second parameter is the object with the class properties and methods. The last parameter is the prototype instance property, which we leave as an empty object for this example:</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/class',
    'jquery/model',
    'jquery/dom/fixture',
    'jquery/view/ejs',
    'jquery/controller',
    'jquery/controller/route',

    function ($) {
<span class="strong"><strong>        $.Model('Todo', {</strong></span>
<span class="strong"><strong>                findAll: 'GET /todos',</strong></span>
<span class="strong"><strong>                findOne: 'GET /todos/{id}',</strong></span>
<span class="strong"><strong>                create:  'POST /todos',</strong></span>
<span class="strong"><strong>                update:  'PUT /todos/{id}',</strong></span>
<span class="strong"><strong>                destroy: 'DELETE /todos/{id}'</strong></span>
<span class="strong"><strong>            },</strong></span>
<span class="strong"><strong>            {</strong></span>

<span class="strong"><strong>            }</strong></span>
<span class="strong"><strong>        );</strong></span>
    }
);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Class properties are not random; they are described in the model API. <a class="ulink" href="http://javascriptmvc.com/docs.html#!jquerymx">http://javascriptmvc.com/docs.html#!jquerymx</a>.</p></div></div><p>We've created the <code class="literal">Todo</code> model for <a id="id62" class="indexterm"/>our <code class="literal">todo</code> list application. Now, it's time to <a id="id63" class="indexterm"/>play around with it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a web browser and type the following line into the JavaScript console:<div class="informalexample"><pre class="programlisting">var todo = new Todo({name: 'write a book'});</pre></div><p><code class="literal">todo</code> is now an instance of <code class="literal">Todo</code> with property name and property value <code class="literal">write a book</code>.</p></li><li class="listitem">Get the property value as follows:<div class="informalexample"><pre class="programlisting">todo.attr('name');</pre></div></li><li class="listitem">Set the property value if the property exists, as follows:<div class="informalexample"><pre class="programlisting">todo.attr('name', 'write JavaScript book');</pre></div><p>Or by <code class="literal">attrs</code>, where we can set more then one property at the time as well as add a new property:</p><div class="informalexample"><pre class="programlisting">todo.attrs({name: 'write JavaScriptMVC book!'});</pre></div></li><li class="listitem">Add two new properties:<div class="informalexample"><pre class="programlisting">todo.attrs({
    person: 'Wojtek',
    dueDate: '1 December 1012'
});</pre></div></li><li class="listitem">List all the properties:<div class="informalexample"><pre class="programlisting">Todo.attrs();</pre></div></li></ol></div><p>The following screenshot shows the execution of the preceding commands:</p><div class="mediaobject"><img src="graphics/0205_01_01.jpg" alt="Model"/></div></div><div class="section" title="Fixtures"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Fixtures</h3></div></div></div><p>Since we have no backend service to <a id="id64" class="indexterm"/>handle /todo API calls in our frontend application, any attempt <a id="id65" class="indexterm"/>to invoke one of the model's CRUD methods on the <code class="literal">Todo</code> model will cause a network error.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p><span class="strong"><strong>Create, Read, Update, Delete</strong></span> (<span class="strong"><strong>CRUD</strong></span>) <a id="id66" class="indexterm"/>are the four basic functions of persistent storage.</p></div></div><div class="mediaobject"><img src="graphics/0205_01_02.jpg" alt="Fixtures"/></div><p>At this point, <code class="literal">$</code>
<code class="literal">.fixture </code>
<a id="id67" class="indexterm"/>comes to the rescue. With this feature, we can work on a project even when backend code is not ready yet.</p><p>Create fixtures for the <code class="literal">Todo</code> model:</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/class',
    'jquery/model',
    'jquery/util/fixture',
    'jquery/view/ejs',
    'jquery/controller',
    'jquery/controller/route',

    function ($) {
        $.Model('Todo', {
                findAll: 'GET /todos',
                findOne: 'GET /todos/{id}',
                create:  'POST /todos',
                update:  'PUT /todos/{id}',
                destroy: 'DELETE /todos/{id}'
            },
            {

            }
        );

<span class="strong"><strong>        // Fixtures</strong></span>
<span class="strong"><strong>        (function () {</strong></span>

<span class="strong"><strong>            var TODOS = [</strong></span>
<span class="strong"><strong>                // list of todos</strong></span>
<span class="strong"><strong>                {</strong></span>
<span class="strong"><strong>                    id:   1,</strong></span>
<span class="strong"><strong>                    name: 'read The Good Parts'</strong></span>
<span class="strong"><strong>                },</strong></span>
<span class="strong"><strong>                {</strong></span>
<span class="strong"><strong>                    id:   2,</strong></span>
<span class="strong"><strong>                    name: 'read Pro Git'</strong></span>
<span class="strong"><strong>                },</strong></span>
<span class="strong"><strong>                {</strong></span>
<span class="strong"><strong>                    id:   3,</strong></span>
<span class="strong"><strong>                    name: 'read Programming Ruby'</strong></span>
<span class="strong"><strong>                }</strong></span>
<span class="strong"><strong>            ];</strong></span>

<span class="strong"><strong>            // findAll</strong></span>
<span class="strong"><strong>            $.fixture('GET /todos', function () {</strong></span>
<span class="strong"><strong>                return [TODOS];</strong></span>
<span class="strong"><strong>            });</strong></span>

<span class="strong"><strong>            // findOne</strong></span>
<span class="strong"><strong>            $.fixture('GET /todos/{id}', function (orig) {</strong></span>
<span class="strong"><strong>                return TODOS[(+orig.data.id) - 1];</strong></span>
<span class="strong"><strong>            });</strong></span>

<span class="strong"><strong>            // create</strong></span>
<span class="strong"><strong>            var id = 4;</strong></span>
<span class="strong"><strong>            $.fixture('POST /todos', function () {</strong></span>
<span class="strong"><strong>                return {</strong></span>
<span class="strong"><strong>                    id: (id++)</strong></span>
<span class="strong"><strong>                };</strong></span>
<span class="strong"><strong>            });</strong></span>

<span class="strong"><strong>            // update</strong></span>
<span class="strong"><strong>            $.fixture('PUT /todos/{id}', function () {</strong></span>
<span class="strong"><strong>                return {};</strong></span>
<span class="strong"><strong>            });</strong></span>

<span class="strong"><strong>            // destroy</strong></span>
<span class="strong"><strong>            $.fixture('DELETE /todos/{id}', function () {</strong></span>
<span class="strong"><strong>                return {};</strong></span>
<span class="strong"><strong>            });</strong></span>

<span class="strong"><strong>        }());</strong></span>
    }
);</pre></div><p>Now, we can use our <code class="literal">Todo</code> model <a id="id68" class="indexterm"/>
<a id="id69" class="indexterm"/>methods as if backend services were here.</p><p>For instance, we can list all <code class="literal">todos</code>:</p><div class="informalexample"><pre class="programlisting">Todo.findAll({}, function(todos) {
    console.log('todos: ', todos);
});</pre></div><p>The following screenshot shows the output of the <code class="literal">console.log('todos: ', todos);</code> command:</p><div class="mediaobject"><img src="graphics/0205_01_03.jpg" alt="Fixtures"/></div></div><div class="section" title="View"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>View</h3></div></div></div><p>Now, it is a good time to add some HTML <a id="id70" class="indexterm"/>code to actually see something beyond the browser console. To <a id="id71" class="indexterm"/>do this, use the open source client-side template system <span class="strong"><strong>Embedded JavaScript</strong></span> (<span class="strong"><strong>EJS</strong></span>).</p><p>Create a new file <code class="literal">todos.ejs</code> in the <code class="literal">todo</code> directory (the same folder where <code class="literal">todo.js</code> is located), and add the following code to it:</p><div class="informalexample"><pre class="programlisting">&lt;% $.each(this, function(i, todo) { %&gt;

    &lt;li &lt;%= ($el) -&gt; $el.model(todo) %&gt;&gt;
        &lt;strong&gt;&lt;%= todo.name %&gt;&lt;/strong&gt;
        &lt;em class="destroy"&gt;delete&lt;/em&gt;
    &lt;/li&gt;

&lt;% }) %&gt;</pre></div><p>Then, type the following in the console:</p><div class="informalexample"><pre class="programlisting">$('#todos').html('todos.ejs', Todo.findAll());</pre></div><p>Now, we can see all <code class="literal">todos</code> printed:</p><div class="mediaobject"><img src="graphics/0205_01_04.jpg" alt="View"/></div><p>Basically, the EJS template is an HTML file <a id="id72" class="indexterm"/>with injected JavaScript code between <code class="literal">&lt;%</code> and <code class="literal">%&gt;</code> or <code class="literal">&lt;%=</code> and<code class="literal"> %&gt;</code> (and a few other ways).</p><p>The difference is that in the second <a id="id73" class="indexterm"/>case, all the values returned by the JavaScript code are escaped and printed out. In the first one, they are only evaluated.</p><p>The first line is a jQuery <code class="literal">each</code> loop— no magic here. However, the next line could be a new thing for many readers. It is ECMAScript Harmony-like, arrow style syntax for functions used by the EJS parser that doesn't <a id="id74" class="indexterm"/>
<a id="id75" class="indexterm"/>darken the whole picture by its simplicity.</p><p>The following syntax:</p><div class="informalexample"><pre class="programlisting">($el) -&gt; $el.model(todo)</pre></div><p>Can be explained as follows:</p><div class="informalexample"><pre class="programlisting">function ($el) {
    return $el.model(todo)
}</pre></div></div><div class="section" title="Controller"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Controller</h3></div></div></div><p>Let's add some action to our user <a id="id76" class="indexterm"/>interface.</p><p>Add the following code to the <code class="literal">todo.js</code> file, <a id="id77" class="indexterm"/>and refresh the application in a browser:</p><div class="informalexample"><pre class="programlisting">$.Controller('Todos', {
    // init method is called when new instance is created
    'init': function (element, options) {
        this.element.html('todos.ejs', Todo.findAll());
    },

    // add event listener to strong element on click
    'li strong click': function (el, e) {
        // trigger custom event
        el.trigger('selected', el.closest('li').model());

        // log current model to the console
        console.log('li strong click', el.closest('.todo').model());
    },

    // add event listener to em element on click
    'li .destroy click': function (el, e) {
        // call destroy on the model to prevent memory leaking
        el.closest('.todo').model().destroy();
    },

    // add event listener to Todo model on destroyed
    '{Todo} destroyed': function (Todo, e, destroyedTodo) {
        // remove element from the DOM tree
        destroyedTodo.elements(this.element).remove();

        console.log('destroyed: ', destroyedTodo);
    }
});

// create new controller instance
new Todos('#todos');</pre></div><p>Now, you can click on the <code class="literal">todo</code> name to see the console log or delete it.</p><p>The <code class="literal">init</code> method is called when a new controller is instantiated.</p><p>When the <code class="literal">controller</code> element is removed from the <a id="id78" class="indexterm"/>DOM tree (in our case, <code class="literal">#todos</code>), the  <code class="literal">destroy</code> method is called automatically, unbinding all <code class="literal">controller</code> event handlers and releasing its element to prevent memory leakage.</p></div><div class="section" title="Routing"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec18"/>Routing</h3></div></div></div><p>Replace the <a id="id79" class="indexterm"/>following <a id="id80" class="indexterm"/>code:</p><div class="informalexample"><pre class="programlisting">// create new Todo controller instance
new Todos('#todos');</pre></div><p>With:</p><div class="informalexample"><pre class="programlisting">// routing
$.Controller('Routing', {
    init: function () {
        new Todos('#todos');
    },

    // the index page
    'route': function () {
        console.log('default route');
    },

    // handle URL witch hash
    ':id route': function (data) {
        Todo.findOne(data, $.proxy(function (todo) {
            // increase font size for current todo item
            todo.elements(this.element).animate({fontSize: '125%'}, 750);
        }, this));
    },

    // add event listener on selected
    '.todo selected':  function (el, e, todo) {
        // pass todo id as a parameter to the router
        $.route.attr('id', todo.id);
    }
});

// create new Routing controller instance
new Routing(document.body);</pre></div><p>Refresh the application and try to click <a id="id81" class="indexterm"/>on the <code class="literal">todo</code> list elements. You will see that the URL <a id="id82" class="indexterm"/>updates after clicking on the <code class="literal">todo</code> item with its corresponding ID.</p></div><div class="section" title="Complete application code"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec19"/>Complete application code</h3></div></div></div><p>Here is the complete <a id="id83" class="indexterm"/>
<a id="id84" class="indexterm"/>code for the <code class="literal">Todo</code> application:</p><div class="informalexample"><pre class="programlisting">steal(
    'jquery/class',
    'jquery/model',
    'jquery/util/fixture',
    'jquery/view/ejs',
    'jquery/controller',
    'jquery/controller/route',

    function ($) {
        $.Model('Todo', {
                findAll: 'GET /todos',
                findOne: 'GET /todos/{id}',
                create:  'POST /todos',
                update:  'PUT /todos/{id}',
                destroy: 'DELETE /todos/{id}'
            },
            {

            }
        );

        // Fixtures
        (function () {
            var TODOS = [
                // list of todos
                {
                    id:   1,
                    name: 'read The Good Parts'
                },
                {
                    id:   2,
                    name: 'read Pro Git'
                },
                {
                    id:   3,
                    name: 'read Programming Ruby'
                }
            ];

            // findAll
            $.fixture('GET /todos', function () {
                return [TODOS];
            });

            // findOne
            $.fixture('GET /todos/{id}', function (orig) {
                return TODOS[(+orig.data.id) - 1];
            });

            // create
            var id = 4;
            $.fixture('POST /todos', function () {
                return {
                    id: (id++)
                };
            });

            // update
            $.fixture('PUT /todos/{id}', function () {
                return {};
            });

            // destroy
            $.fixture('DELETE /todos/{id}', function () {
                return {};
            });
        }());

        $.Controller('Todos', {
            // init method is called when new instance is created
            'init': function (element, options) {
                this.element.html('todos.ejs', Todo.findAll());
            },

            // add event listener to strong element on click
            'li strong click': function (el, e) {
                // trigger custom event
                el.trigger('selected', el.closest('li').model());

                // log current model to the console
                console.log('li strong click', el.closest('.todo').model());
            },

            // add event listener to em element on click
            'li .destroy click': function (el, e) {
                // call destroy on the model to prevent memory leaking
                el.closest('.todo').model().destroy();
            },

            // add event listener to Todo model on destroyed
            '{Todo} destroyed': function (Todo, e, destroyedTodo) {
                // remove element from the DOM tree
                destroyedTodo.elements(this.element).remove();

                console.log('destroyed: ', destroyedTodo);
            }
        });

        // routing
        $.Controller('Routing', {
            init: function () {
                new Todos('#todos');
            },

            // the index page
            'route': function () {
                console.log('default route');
            },

            // handle URL witch hash
            ':id route': function (data) {
                Todo.findOne(data, $.proxy(function (todo) {
                    // increase font size for current todo item
                    todo.elements(this.element).animate({fontSize: '125%'}, 750);
                }, this));
            },

            // add event listener on selected
            '.todo selected':  function (el, e, todo) {
                // pass todo id as a parameter to the router
                $.route.attr('id', todo.id);
            }
        });

        // create new Routing controller instance
        new Routing(document.body);
    }
);</pre></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Summary</h1></div></div></div><p>In this chapter, we learned what JavaScriptMVC is, and why it is a good and solid framework. We also learned how to install it, and browse the documentation and API. We got an overview of its architecture by building a simple application.</p><p>If you can understand all the code that we have written in this chapter, you will be able to dig into the framework easily and fast. Congratulations!</p></div></body></html>