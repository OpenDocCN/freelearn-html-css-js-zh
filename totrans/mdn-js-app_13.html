<html><head></head><body><div class="chapter" title="Chapter&#xA0;13.&#xA0;Building a Search Engine Template Using AngularJS 2"><div class="titlepage"><div><div><h1 class="title"><a id="ch13"/>Chapter 13. Building a Search Engine Template Using AngularJS 2</h1></div></div></div><p>To build <span class="strong"><strong>single page applications</strong></span> (<span class="strong"><strong>SPAs</strong></span>) using Angular 2, we need to learn how to implement routing in Angular 2. Angular 2 comes with built-in routing APIs, which are very powerful, feature rich, and easy to use. In this chapter, we will build a basic search engine template to demonstrate routing in Angular 2. We won't be building a complete search engine because that's out of the scope of this book. We will use Bootstrap 4 to design the search engine template. At the end of this chapter, you will be comfortable with building SPAs using Angular 2.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Routing in Angular 2</li><li class="listitem" style="list-style-type: disc">The built-in HTTP client provided by Angular 2</li><li class="listitem" style="list-style-type: disc">Generating random textual data using the <code class="literal">Chance.js</code> library</li></ul></div><div class="section" title="Setting up the project"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec98"/>Setting up the project</h1></div></div></div><p>Follow these <a id="id634" class="indexterm"/>steps to set up your project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the exercise files of this chapter, you will find two directories, <code class="literal">initial</code> and <code class="literal">final</code>. The <code class="literal">final</code> directory contains the final search engine template whereas the <code class="literal">initial</code> directory contains the files to quickly get started with building the search engine template.</li><li class="listitem">In the <code class="literal">initial</code> directory, you will find <code class="literal">app.js</code> and <code class="literal">package.json</code>. In the <code class="literal">package.json</code> file, place this code:<div class="informalexample"><pre class="programlisting">{
  "name": "SearchEngine-Template",
  "dependencies": {
    "express": "4.13.3",
    "chance": "1.0.3"    
  }
}</pre></div><p>Here, we are listing <code class="literal">Express.js</code> and <code class="literal">Chance.js</code> as dependencies. Express will be used to build the web server whereas <code class="literal">Chance.js</code> will be used to generate random textual data to populate the template's search results.</p></li><li class="listitem">Now, run <code class="literal">npm install</code> <a id="id635" class="indexterm"/>inside the <code class="literal">initial</code> directory to download the packages.<p>Inside the <code class="literal">initial</code> directory, you will find a directory named <code class="literal">public</code>, inside which all the static assets will be placed. Inside the <code class="literal">public</code> directory, you will find the <code class="literal">componentTemplates</code>, <code class="literal">css</code>, <code class="literal">html</code>, and <code class="literal">js</code> directories.</p><p>Inside the <code class="literal">css</code> directory, you will find <code class="literal">bootstrap.min.css</code>; <code class="literal">index.html</code> inside the <code class="literal">html</code> directory; and finally, <code class="literal">index.js</code>, <code class="literal">angular2-all.umd.js</code>, <code class="literal">angular2-polyfills.js</code>, and <code class="literal">Rx.umd.js</code> inside the <code class="literal">js</code> directory.</p></li><li class="listitem">In <code class="literal">index.html</code>, place this starting code to load Angular, Bootstrap, and the <code class="literal">index.js</code> file:<div class="informalexample"><pre class="programlisting">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Search Engine Template&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;

    &lt;script src="/js/angular2-polyfills.js"&gt;&lt;/script&gt;
    &lt;script src="/js/Rx.umd.js"&gt;&lt;/script&gt;
    &lt;script src="/js/angular2-all.umd.js"&gt;&lt;/script&gt;
    &lt;script src="/js/index.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>This code is self-explanatory.</p></li><li class="listitem">Now, in the <code class="literal">app.js</code> file, place this code:<div class="informalexample"><pre class="programlisting">var express = require("express");
var app = express();

app.use(express.static(__dirname + "/public"));

app.get("/*", function(httpRequest, httpResponse, next){
  httpResponse.sendFile(__dirname + "/public/html/index.html");
})

app.listen(8080);</pre></div><p>Here as well, most <a id="id636" class="indexterm"/>of the code is self-explanatory. We are simply serving <code class="literal">index.html</code> regardless of what the HTTP request path is.</p></li></ol></div></div></div>
<div class="section" title="Configuring routes and bootstrapping the app"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec99"/>Configuring routes and bootstrapping the app</h1></div></div></div><p>In SPA, the <a id="id637" class="indexterm"/>routes for our app are defined in the frontend. In Angular 2, we need to define the paths and a component associated with the path that will be rendered for that path.</p><p>We provide <a id="id638" class="indexterm"/>the routes to the root component, and the root component displays the component bound to the route.</p><p>Let's create the root component and routes for our search engine template:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Place this code in the <code class="literal">index.js</code> file to to create the root components and routes:<div class="informalexample"><pre class="programlisting">var AppComponent = ng.core.Component({
  selector: "app",
  directives: [ng.router.ROUTER_DIRECTIVES],
  templateUrl: "componentTemplates/app.html"
}).Class({
  constructor: function(){}
})

AppComponent = ng.router.RouteConfig([
    { path: "/", component: HomeComponent, name: "Home" },
    { path: "/search-result", component: SearchResultComponent, name: "SearchResult" },
    { path: "/*path", component: NotFoundComponent, name: "NotFound" }
])(AppComponent);

ng.platform.browser.bootstrap(AppComponent, [
  ng.router.ROUTER_PROVIDERS,
  ng.core.provide(ng.router.APP_BASE_HREF, {useValue : "/" })
]);</pre></div></li><li class="listitem">Now, create a file named <code class="literal">app.html</code> in the <code class="literal">componentTemplates</code> directory and place this code in it:<div class="informalexample"><pre class="programlisting">&lt;nav class="navbar navbar-light bg-faded"&gt;
    &lt;ul class="nav navbar-nav"&gt;
        &lt;li class="nav-item"&gt;
            &lt;a class="nav-link" 
            [routerLink]="['Home']"&gt;Home&lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/nav&gt;
&lt;router-outlet&gt;&lt;/router-outlet&gt;</pre></div></li></ol></div><p>Here is <a id="id639" class="indexterm"/>how <a id="id640" class="indexterm"/>this code works:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">At first, we create the root component, called <code class="literal">AppComponent</code>. While creating the root component, we add the <code class="literal">ng.router.ROUTER_DIRECTIVES</code> directive to it, which lets us use the <code class="literal">routerLink</code> directive.</li><li class="listitem">Then, we use <code class="literal">ng.router.RouteConfig</code> to configure the routes for our application. We are providing an array of routes as an argument to the <code class="literal">ng.router.RouteConfig</code> method. A route consists of a path, component, and the name of the route. The paths can be static, parameterized, or wildcard, just like Express route paths. Here, the first route is for the home page, second for displaying the search result, and finally, the third for handling invalid URLs, that is, URLs for which routes are not defined. The <code class="literal">ng.router.RouteConfig</code> method returns a function that takes the root component and attaches the routes to it.</li><li class="listitem">We then initialize the application. While initializing the app, we're passing the <code class="literal">ng.router.ROUTER_PROVIDERS</code> provider, which will be used to create instances of various services related to routing. Also, we are providing a custom provider, which returns the <code class="literal">/</code> character when an instance of the <code class="literal">ng.router.APP_BASE_HREF</code> service is requested. <code class="literal">ng.router.APP_BASE_HREF</code> is used to find the base URL of the app.</li><li class="listitem">In the <code class="literal">AppComponent</code> template, we are displaying a navigation bar. The navigation bar has an <code class="literal">anchor</code> tag that doesn't have an <code class="literal">href</code> attribute; instead, we are using the <code class="literal">routerLink</code> directive to assign the redirect link so that when clicked on, instead of a complete page reload, it only changes the URL and component. And finally, <code class="literal">&lt;router-outlet&gt;</code> is what displays the component based on the current URL.</li></ol></div></div>
<div class="section" title="Generating random search results"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec100"/>Generating random search results</h1></div></div></div><p>To populate <a id="id641" class="indexterm"/>our template, we need to generate some random search result data. For this, we can use the <code class="literal">Chance.js</code> library. We will generate random data on the server side, not on client side, so that we can later demonstrate how to make an HTTP request using Angular 2.</p><p>
<code class="literal">Chance.js</code> is available for both client-side and server-side JavaScript. We earlier downloaded the <code class="literal">Chance.js </code>package to use with <code class="literal">Node.js</code>. Here is the code to generate random data. Place it in the <code class="literal">app.js</code> file above the <code class="literal">/*</code> route so that <code class="literal">/*</code> doesn't override the random data route:</p><div class="informalexample"><pre class="programlisting">var Chance = require("chance"),
chance = new Chance();
app.get("/getData", function(httpRequest, httpResponse, next){

  var result = [];

  for(var i = 0; i &lt; 10; i++)
  {
    result[result.length] = {
      title: chance.sentence(),
      desc: chance.paragraph()
    }
  }

  httpResponse.send(result);
})</pre></div><p>Here, we first create a route for the <code class="literal">/getData</code> path, which sends an array of search results as a response. The route callback uses <code class="literal">chance.sentence()</code> to generate random titles for the search result and <code class="literal">chance.paragraph()</code> to generate a description.</p></div>
<div class="section" title="Creating route components"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec101"/>Creating route components</h1></div></div></div><p>Let's <a id="id642" class="indexterm"/>create <code class="literal">HomeComponent</code>, <code class="literal">SearchResultComponent</code>, and <code class="literal">NotFoundComponent</code>. Before that, let's create a component to display the search form. The search form will have a textbox and a search button. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Place this code in the <code class="literal">index.js</code> file, above the <code class="literal">AppComponent</code> code:<div class="informalexample"><pre class="programlisting">var FormComponent = ng.core.Component({
  selector: "search-form",
  directives: [ng.router.ROUTER_DIRECTIVES],  
  templateUrl: "componentTemplates/search-form.html",
}).Class({
  constructor: function(){},
  ngOnInit: function(){
    this.searchParams = {
      query: ""
    };

    this.keyup = function(e){
      this.searchParams = {
        query: e.srcElement.value
      };
    };
  }
})</pre></div></li><li class="listitem">Now, create <a id="id643" class="indexterm"/>a file named <code class="literal">search-form.html</code> in the <code class="literal">componentTemplates</code> directory, and place this code in it:<div class="informalexample"><pre class="programlisting">&lt;div class="m-a-2 text-xs-center"&gt;
  &lt;h1&gt;Search for Anything&lt;/h1&gt;
  &lt;form class="form-inline m-t-1"&gt;
        &lt;input (keyup)="keyup($event)" class="form-control" type="text" placeholder="Search"&gt;
        &lt;a [routerLink]="['SearchResult', searchParams]"&gt;
            &lt;button class="btn btn-success-outline" type="submit"&gt;Search&lt;/button&gt;
        &lt;/a&gt;
    &lt;/form&gt;
&lt;/div&gt;</pre></div></li></ol></div><p>This is how the code works:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">At first, we create a component called <code class="literal">FormComponent</code>. It uses the <code class="literal">ng.router.ROUTER_DIRECTIVES</code> directive.</li><li class="listitem">In the template of the component, we display an HTML form. The form has a textbox and button.</li><li class="listitem">We handle the <code class="literal">keyup</code> event of the text input box and store the value in the <code class="literal">searchParams.query</code> property.</li><li class="listitem">The button redirects to the <code class="literal">SearchResult</code> component. Note that here we are passing <code class="literal">searchParams</code> object to <code class="literal">routerLink</code>, which becomes the query parameter when redirecting.</li></ol></div><p>Now, let's create the <code class="literal">HomeComponent</code> component. This component is displayed on the home page. It displays the search form.</p><p>Here is how to create <code class="literal">HomeComponent</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Place this code in the <code class="literal">index.js</code> file, above the <code class="literal">AppComponent</code> code:<div class="informalexample"><pre class="programlisting">var HomeComponent = ng.core.Component({
  selector: "home",
  directives: [FormComponent],
  templateUrl: "componentTemplates/home.html",
}).Class({
  constructor: function(){}
})</pre></div></li><li class="listitem">Now, create <a id="id644" class="indexterm"/>a file named <code class="literal">search-form.html</code>, and place it in the <code class="literal">componentTemplates</code> directory:<div class="informalexample"><pre class="programlisting">&lt;search-form&gt;&lt;/search-form&gt;</pre></div><p>Here, the <code class="literal">HomeComponent</code> code is self-explanatory.</p></li><li class="listitem">Now, let's create the <code class="literal">SearchResultComponent</code> component. This component should display the search form and the search result below it. It should fetch the result by making an HTTP request to the server. Here is the code for the <code class="literal">SearchResultComponent</code>. Place it in the <code class="literal">index.js</code> file, above the <code class="literal">AppComponent</code> code:<div class="informalexample"><pre class="programlisting">var SearchResultComponent = ng.core.Component({
  selector: "search-result",
  directives: [FormComponent],
  viewProviders: [ng.http.HTTP_PROVIDERS],
  templateUrl: "componentTemplates/searchResult.html"
}).Class({
  constructor: [ng.router.RouteParams, ng.http.Http,
  function(params, http) {
      this.params = params;
    this.http = http;
    this.response = [];
  }],
  ngOnInit: function(){
    var q = this.params.get("query");
    this.http.get("getData").subscribe(function(res){
      this.response = JSON.parse(res._body);
    }.bind(this));
  }
})</pre></div></li><li class="listitem">Now, create a file named <code class="literal">searchResult.html</code> and place it in <code class="literal">componentTemplates</code>. Place this code in the file:<div class="informalexample"><pre class="programlisting">&lt;style&gt;
  ul
  {
      list-style-type: none;
  }
&lt;/style&gt;

&lt;div class="container"&gt;
  &lt;search-form&gt;&lt;/search-form&gt;
  &lt;div class="m-a-2 text-xs-center"&gt;
      &lt;ul&gt;
        &lt;li *ngFor="#item of response" class="m-t-2"&gt;
          &lt;h4&gt;{{item.title}}&lt;/h4&gt;
          &lt;p&gt;{{item.desc}}&lt;/p&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></li></ol></div><p>This is <a id="id645" class="indexterm"/>how the code works:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Here, we are providing the <code class="literal">ng,http.HTTP_PROVIDERS</code> provider, which is used when using the HTTP client service provided by Angular 2. Using the HTTP client service, we can make HTTP requests.</li><li class="listitem">In the constructor property, we are injecting the HTTP service along with the <code class="literal">ng.router.RouteParams</code> service, which is used to obtain the query parameters of the current URL.</li><li class="listitem">In the <code class="literal">ngOnInit</code> method, you can see how to make a <code class="literal">GET</code> request using the HTTP service and also how to get the query parameters using the <code class="literal">ng.router.RouteParams</code> service.</li><li class="listitem">In the template of the component, we are displaying the fetched search result using the <code class="literal">ngFor</code> directive.</li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note53"/>Note</h3><p>You can <a id="id646" class="indexterm"/>learn about the HTTP service provided by Angular 2 at <a class="ulink" href="https://angular.io/docs/ts/latest/guide/server-communication.html">https://angular.io/docs/ts/latest/guide/server-communication.html</a>.</p></div></div><p>Now, let's create <code class="literal">NotFoundComponent</code>. Here is the code for that:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Place this code in the <code class="literal">index.js</code> file, above the <code class="literal">AppComponent</code> code:<div class="informalexample"><pre class="programlisting">var NotFoundComponent = ng.core.Component({
  selector: "name-search",
  templateUrl: "componentTemplates/notFound.html"
}).Class({
  constructor: function(){}
})</pre></div></li><li class="listitem">Now, create a file named <code class="literal">notFound.html</code> and place it in the <code class="literal">componentTemplates</code> <a id="id647" class="indexterm"/>directory. Place this code inside the file:<div class="informalexample"><pre class="programlisting">&lt;div class="container"&gt;
  &lt;div class="m-a-2 text-xs-center"&gt;
    &lt;h1&gt;The page your are looking for is not found&lt;/h1&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div><p>The code is self-explanatory.</p></li></ol></div></div>
<div class="section" title="Testing the template"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec102"/>Testing the template</h1></div></div></div><p>To test <a id="id648" class="indexterm"/>the template, we will follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Inside the <code class="literal">initial</code> directory, run the <code class="literal">node app.js</code> command.</li><li class="listitem">Now, in a browser, open the <code class="literal">http://localhost:8080/</code> URL. You should see this output:<div class="mediaobject"><img src="graphics/B05154_13_01.jpg" alt="Testing the template"/></div></li><li class="listitem">Now, type something in the search box and click on the <span class="strong"><strong>Search</strong></span> button. You should then see this output:<div class="mediaobject"><img src="graphics/B05154_13_02.jpg" alt="Testing the template"/></div></li><li class="listitem">Now, enter <a id="id649" class="indexterm"/>an invalid path in the address bar. You should be able to see this output:<p> </p><div class="mediaobject"><img src="graphics/B05154_13_03.jpg" alt="Testing the template"/></div><p>
</p></li></ol></div></div>
<div class="section" title="Routing life cycle methods"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec103"/>Routing life cycle methods</h1></div></div></div><p>When a <a id="id650" class="indexterm"/>path matches a component, Angular 2 activates the component, and when the path changes, Angular 2 deactivates it. When we say that a component has been activated, it means that Angular 2 has created an instance of the component, that is, called the constructor method of the component, whereas when we say a component has been deactivated, it means the component has been removed from the DOM and instance is deleted.</p><p>The methods of a component that are called while activating or deactivating it are called routing lifecycle methods.</p><p>Here is the list of routing lifecycle methods:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">CanActivate</code>: This hook <a id="id651" class="indexterm"/>is invoked before activating the component. It should return a boolean value or a promise indicating whether to activate the component.</li><li class="listitem" style="list-style-type: disc"><code class="literal">routerOnActivate</code>: This method <a id="id652" class="indexterm"/>is invoked after the component has been activated.</li><li class="listitem" style="list-style-type: disc"><code class="literal">routerCanReuse</code>: This method <a id="id653" class="indexterm"/>is invoked to find out whether to reuse the previous instance of the component when the next URL change is the same URL again. It should return a boolean value or a promise indicating whether to reuse. It's invoked only if an instance had been created earlier.</li><li class="listitem" style="list-style-type: disc"><code class="literal">routerOnReuse</code>: This method <a id="id654" class="indexterm"/>is invoked if the component is being reused. It's called after <code class="literal">routerCanReuse</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">routerCanDeactivate</code>: This method <a id="id655" class="indexterm"/>is invoked before deactivating the component. It should return a boolean value or a promise indicating whether to deactivate the component.</li><li class="listitem" style="list-style-type: disc"><code class="literal">routerOnDeactivate</code>: This method <a id="id656" class="indexterm"/>is invoked after the component has been deactivated.</li></ul></div><p>Let's look at a code example of the routing lifecycle methods. Replace the <code class="literal">HomeComponent</code> code with this:</p><div class="informalexample"><pre class="programlisting">var HomeComponent = ng.core.Component({
  selector: "home",
  directives: [FormComponent],
  templateUrl: "componentTemplates/home.html",
}).Class({
  constructor: function(){},
  routerOnActivate: function(){
    console.log("Component has been activated");
  },
  routerCanReuse: function(){
    console.log("Component can be reused");
    return true;
  },
  routerOnReuse: function(){
    console.log("Component is being reused");
  },
  routerCanDeactivate: function(){
    console.log("Component can be deactivated");
    return true;
  },
  routerOnDeactivate: function(){
    console.log("Component has been deactivated");
  }
})

HomeComponent = ng.router.CanActivate(function(){
  console.log("Component can be activated");
  return true;
})(HomeComponent);</pre></div><p>Now, visit <a id="id657" class="indexterm"/>the home page. There, click on the home button again. Now, type something in the search box and click on the <span class="strong"><strong>Search</strong></span> button. This is the console output you will see:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Component can be activated</strong></span>
<span class="strong"><strong>Component has been activated</strong></span>
<span class="strong"><strong>Component can be reused</strong></span>
<span class="strong"><strong>Component is being reused</strong></span>
<span class="strong"><strong>Component can be deactivated</strong></span>
<span class="strong"><strong>Component has been deactivated</strong></span>
</pre></div></div>
<div class="section" title="Production mode versus development mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec104"/>Production mode versus development mode</h1></div></div></div><p>Until now, we <a id="id658" class="indexterm"/>have been running Angular 2 in development mode. The difference between development and production mode is that in development mode, Angular 2 starts change detection immediately after the first run and logs a <span class="strong"><strong>value has changed after it was checked</strong></span> error if anything changes between the first and second run. This helps locate bugs.</p><p>To enable production mode, place this code above the <code class="literal">ng.platform.browser.bootstrap()</code> method call:</p><div class="informalexample"><pre class="programlisting">ng.core.enableProdMode();</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec105"/>Summary</h1></div></div></div><p>In this chapter, we learned routing in Angular 2 by building a basic search engine template. Along with learning routing in depth, we also learned about the Angular 2 HTTP client service as well as how to switch to production mode in Angular 2.</p><p>You should now be comfortable with building the frontend of any kind of web application using Angular 2.</p></div></body></html>