<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Basic Security Approaches</h1></div></div></div><p>In this chapter we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Implementing iOS data protection in Titanium</li><li class="listitem" style="list-style-type: disc">AES encryption using JavaScript</li><li class="listitem" style="list-style-type: disc">Basic authentication using Ti.Network.HTTPClient</li><li class="listitem" style="list-style-type: disc">Implementing a cross-platform passcode screen</li><li class="listitem" style="list-style-type: disc">Working with protected ZIP files on iOS</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Introduction</h1></div></div></div><p>Security, privacy, and safeguards for intellectual property are at the front of the minds of those of us building Titanium Enterprise apps. Titanium allows you to combine the underlying platform tools and third-party JavaScript libraries to help meet your security requirements.</p><p>This chapter provides a series of approaches on how to leverage JavaScript, Titanium modules, and the underlying platform to enable you to create a layered security approach to assist you in meeting your organization's overall secure development goals. Each recipe is designed to provide building blocks to help you implement your industry's existing security and privacy standards.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec55"/>Implementing iOS data protection in Titanium</h1></div></div></div><p>Starting with iOS 4, Apple<a id="id725" class="indexterm"/> introduced the ability for apps to use the data protection feature to add an additional level of security for data stored on disk. Data protection uses the built-in hardware<a id="id726" class="indexterm"/> encryption to <a id="id727" class="indexterm"/>encrypt files stored on the device. This<a id="id728" class="indexterm"/> feature is available when the user's device is locked and protected with a passcode lock. During this time, all files are protected and inaccessible until the user explicitly unlocks the device.</p><div><div><h3 class="title"><a id="note19"/>Note</h3><p>When the device is locked, no app can access protected files. This even applies to the app that created the file.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec116"/>Getting ready</h2></div></div></div><p>This recipe <a id="id729" class="indexterm"/>uses the <code class="literal">securely</code> native module for <a id="id730" class="indexterm"/>enhanced security functionality. This module and other code assets can be downloaded from the source provided by the book. Installing these in your project is straightforward. Simply copy the <code class="literal">modules</code> folder into your project as shown in the following screenshot:</p><div><img src="img/5343_08_01.jpg" alt="Getting ready"/></div><p>After copying the mentioned folder, you will need to click on your <strong>tiapp.xml</strong> file in Titanium Studio and add a reference to the <code class="literal">bencoding.securely</code> module<a id="id731" class="indexterm"/> as shown in the following screenshot:</p><div><img src="img/5343_08_02.jpg" alt="Getting ready"/></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec208"/>Enabling data protection</h3></div></div></div><p>This recipe <a id="id732" class="indexterm"/>requires your iOS device to<a id="id733" class="indexterm"/> have data protection enabled. You <a id="id734" class="indexterm"/>will need a device as the simulator does not support data protection. The following steps cover how to enable this feature on your device:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to <strong>Settings</strong> | <strong>General</strong> | <strong>Passcode</strong>.</li><li class="listitem">Follow the prompts to set up a passcode.</li><li class="listitem">After adding a passcode, scroll to the bottom of the screen and verify that the text <strong>Data protection is enabled</strong> is visible as shown in the following screenshot:<div><img src="img/5343_08_03.jpg" alt="Enabling data protection"/></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec209"/>iOS device browser</h3></div></div></div><p>A third-party iOS device browser<a id="id735" class="indexterm"/> is needed to verify that <a id="id736" class="indexterm"/>data protection for the example recipe app has <a id="id737" class="indexterm"/>successfully been enabled. This recipe discusses how to verify data protection using the popular iExplorer app. An evaluation version of the iExplorer app can be used to follow along with this recipe. For more information and to download iExplorer<a id="id738" class="indexterm"/>, please visit <a class="ulink" href="http://www.macroplant.com/iexplorer">http://www.macroplant.com/iexplorer</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec117"/>How to do it...</h2></div></div></div><p>To enable iOS data protection, the <code class="literal">DataProtectionClass</code> and <code class="literal">com.apple.developer.default-data-protection</code> keys need to be added to your <code class="literal">tiapp.xml</code> as demonstrated in the following code snippet:</p><div><ol class="orderedlist arabic"><li class="listitem">First, add the <code class="literal">ios</code> configuration node if your project does not already contain this element.<div><pre class="programlisting">&lt;ios&gt;
  &lt;plist&gt;
    &lt;dict&gt;</pre></div></li><li class="listitem">Then at the top of the <code class="literal">dict</code> node, add the following highlighted keys.<div><pre class="programlisting">
<strong>      &lt;key&gt;DataProtectionClass&lt;/key&gt;</strong>
<strong>      &lt;string&gt;NSFileProtectionComplete&lt;/string&gt;</strong>
<strong>      &lt;key&gt;com.apple.developer.</strong>
<strong>      default-data-protection&lt;/key&gt;</strong>
<strong>      &lt;string&gt;NSFileProtectionComplete&lt;/string&gt;</strong>
     &lt;/dict&gt;
  &lt;/plist&gt;
&lt;/ios&gt;</pre></div></li><li class="listitem">After <a id="id739" class="indexterm"/>saving the updates to<a id="id740" class="indexterm"/> your <code class="literal">tiapp.xml</code>, you must clean your Titanium project in order to have the updates take effect. This can be done in Titanium Studio by selecting <strong>Project</strong> | <strong>Clean</strong>.</li></ol></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec210"/>Creating the namespace and imports</h3></div></div></div><p>Once you have <a id="id741" class="indexterm"/>added the <code class="literal">securely</code> module<a id="id742" class="indexterm"/> and added the <code class="literal">tiapp.xml</code> updates to your project, you need to create your application namespace in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code as the following code snippet demonstrates:</p><div><pre class="programlisting">//Create our application namespace
var my = {
  secure : require('bencoding.securely')
};</pre></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec211"/>Creating the recipe UI</h3></div></div></div><p>The following steps<a id="id743" class="indexterm"/> outline how to create the UI used in this recipe:</p><div><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> is created to attach all UI elements.<div><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', 
  title: 'Data Protection Example', 
  barColor:'#000',layout:'vertical'
});</pre></div></li><li class="listitem">Next, a <code class="literal">Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. This will be used to trigger our example.<div><pre class="programlisting">var button1 = Ti.UI.createButton({
  title:'Create Test File',
  top:25, height:45, left:5, right:5
});
win.add(button1);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec212"/>Creating a file to verify data protection</h3></div></div></div><p>To verify if data <a id="id744" class="indexterm"/>protection is enabled in the app, the recipe creates a time-stamped file in the <code class="literal">Ti.Filesystem.applicationDataDirectory</code> directory. Using an iOS device browser, we can verify if the test file is protected when the device is locked. The following steps describe how the recipe creates this test file:</p><div><ol class="orderedlist arabic"><li class="listitem">The <code class="literal">click</code> event for <code class="literal">button1</code> creates a time-stamped file that allows us to verify if data protection has been correctly enabled for the app.<div><pre class="programlisting">button1.addEventListener('click',function(e){</pre></div></li><li class="listitem">Next the <code class="literal">isProtectedDataAvailable</code> method is called on <code class="literal">securely</code>. This provides a Boolean result indicating that data protection allows the app to read from or write to the filesystem.<div><pre class="programlisting">  if(!my.secure.isProtectedDataAvailable()){
    alert('Protected data is not yet available.');
    return;
  }</pre></div></li><li class="listitem">To ensure there is a unique identifier in the file, a token is created using the current date and time. This token is then added to the following message template:<div><pre class="programlisting">  var timeToken = String.formatDate(new Date(),"medium") +
  String.formatTime(new Date());
  var msg = "When device is locked you will not be able";
  msg += " to read this file. Your time token is ";
  msg += timeToken;</pre></div></li><li class="listitem">The message created in step 3 is then written to the <code class="literal">test.txt</code> file located in the <code class="literal">Ti.Filesystem.applicationDataDirectory</code> directory. If the file already exists, it is removed so that the latest message will be available for testing.<div><pre class="programlisting">  var testfile = Ti.Filesystem.getFile(
  Ti.Filesystem.applicationDataDirectory, 'test.txt');
  if(testfile.exists()){
    testfile.deleteFile();
  }
  testfile.write(msg);
  testfile = null;</pre></div></li><li class="listitem">Once the <code class="literal">test.txt</code> file is written to the device, a message is displayed to the user notifying them to lock their device and use an iOS device browser to <a id="id745" class="indexterm"/>confirm data protection is enabled.<div><pre class="programlisting">  var alertMsg = "Please lock your device.";
  alertMsg+= "Then open an iOS Device Browser.";
  alertMsg+= "The time token you are looking for is ";
  alertMsg+= timeToken;
  alert(alertMsg);</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec118"/>How it works...</h2></div></div></div><p>After<a id="id746" class="indexterm"/> the <code class="literal">DataProtectionClass</code> and <code class="literal">com.apple.developer.default-data-protection</code> keys have been added to your <code class="literal">tiapp.xml</code>, the iOS device handles protecting your files when the device is locked. The following steps discuss how to test that this recipe has correctly implemented data protection:</p><div><ol class="orderedlist arabic"><li class="listitem">The first step in the validation process is to build and deploy the recipe app to your iOS device.</li><li class="listitem">Once the app has been loaded onto your device, open the app and press the <strong>Create Test File</strong> button.<div><img src="img/5343_08_04.jpg" alt="How it works..."/></div></li><li class="listitem">Once you <a id="id747" class="indexterm"/>have received an alert message indicating the test file has been created, press the home button and lock your device.</li><li class="listitem">Plug your device into a computer with iExplorer installed.</li><li class="listitem">Open iExplorer and navigate so that you can view the apps on your device.</li><li class="listitem">Select the <strong>DataProtection</strong> app as marked with the red box in the following screenshot. Then right-click on the <strong>test.txt</strong> file located in the <strong>Documents</strong> folder and select <strong>Quick Look</strong> as marked with the green box in the following screenshot:<div><img src="img/5343_08_05.jpg" alt="How it works..."/></div></li><li class="listitem">After <a id="id748" class="indexterm"/><strong>Quick Look</strong> is selected, iExplorer will try to open the <code class="literal">test.txt</code> file. Since it is protected, it cannot be opened and <strong>Quick Look</strong> will show the progress indicator until a timeout has been reached.<div><img src="img/5343_08_06.jpg" alt="How it works..."/></div></li><li class="listitem">You can then unlock your device and repeat the preceding steps to open the file in <strong>Quick Look</strong>.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec56"/>AES encryption using JavaScript</h1></div></div></div><p>The <strong>Advanced Encryption Standard</strong> (<strong>AES</strong>) is a <a id="id749" class="indexterm"/>specification for the encryption of electronic data established by the U.S. NIST in 2001. This encryption algorithm is used for securing sensitive, but unclassified material by U.S. Government agencies. AES has been widely adopted by enterprise and has become a de facto encryption standard for many commercially sensitive transactions.</p><p>This recipe <a id="id750" class="indexterm"/>discusses how AES can be implemented in JavaScript and incorporated into your Titanium Enterprise app.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec119"/>Getting ready</h2></div></div></div><p>This recipe <a id="id751" class="indexterm"/>uses<a id="id752" class="indexterm"/> the <code class="literal">Ti.SlowAES</code> CommonJS <a id="id753" class="indexterm"/>module as a wrapper around the <code class="literal">SlowAES</code> open source project. This module and other code assets can be downloaded from the source provided by the book, or individually through the links provided in the <em>See also</em> section at the end of this recipe. Installing these in your project is straightforward. Simply copy the <code class="literal">SlowAES</code> folder into the <code class="literal">Resources</code> folder of your project as shown in the following screenshot:</p><div><img src="img/5343_08_07.jpg" alt="Getting ready"/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec120"/>How to do it...</h2></div></div></div><p>Once you<a id="id754" class="indexterm"/> have added the <code class="literal">SlowAES</code> folder to<a id="id755" class="indexterm"/> your project, next you need to create your application namespace in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code as the following code snippet demonstrates:</p><div><pre class="programlisting">//Create our application namespace
var my = {
  mod : require('SlowAES/Ti.SlowAES')
};</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec213"/>Creating the recipe UI</h3></div></div></div><p>This recipe <a id="id756" class="indexterm"/>demonstrates the usage of the <code class="literal">Ti.SlowAES</code> CommonJS module through a sample app using two <code class="literal">Ti.UI.TextField</code> controls for input.</p><div><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> is created to attach all UI elements.<div><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', title: 'AES Crypto Example',
  barColor:'#000',layout:'vertical',fullscreen:false
});</pre></div><div><img src="img/5343_08_08.jpg" alt="Creating the recipe UI"/></div></li><li class="listitem">Next, a<a id="id757" class="indexterm"/> <code class="literal">Ti.UI.TextField</code> control<a id="id758" class="indexterm"/> is <a id="id759" class="indexterm"/>added to the <code class="literal">Ti.UI.Window</code> to gather the secret from the user.<div><pre class="programlisting">var txtSecret = Ti.UI.createTextField({
  value:'DoNotTell',hintText:'Enter Secret',
  height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtSecret);</pre></div></li><li class="listitem">Another <code class="literal">Ti.UI.TextField</code> is added to the <code class="literal">Ti.UI.Window</code> to gather the string to encrypt from the user.<div><pre class="programlisting">var txtToEncrypt = Ti.UI.createTextField({
  value:'some information we want to encrypt',
  hintText:'Enter information to encrypt',
  height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtToEncrypt);</pre></div></li><li class="listitem">Next a <code class="literal">Ti.UI.Label</code> is added to the <code class="literal">Ti.UI.Window</code>. This <code class="literal">Ti.UI.Label</code> will be used to display the encrypted value to the user.<div><pre class="programlisting">var encryptedLabel = Ti.UI.createLabel({
  top:10, height:65, left:5, right:5,color:'#000',
  textAlign:'left',font:{fontSize:14}
});
win.add(encryptedLabel);</pre></div></li><li class="listitem">Finally <a id="id760" class="indexterm"/>a <code class="literal">Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. This <code class="literal">Ti.UI.Button</code> will be used later in the recipe<a id="id761" class="indexterm"/> to perform the encryption test.<div><pre class="programlisting">var btnEncrypt = Ti.UI.createButton({
  title:'Run Encryption Test', top:25, 
  height:45, left:5, right:5
});
win.add(btnEncrypt);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec214"/>Encrypting and decrypting values</h3></div></div></div><p>This section<a id="id762" class="indexterm"/> demonstrates how to use the <code class="literal">Ti.SlowAES</code> module to <a id="id763" class="indexterm"/>use the secret <a id="id764" class="indexterm"/>entered in the <code class="literal">txtSecret</code>, <code class="literal">Ti.UI.TextField</code> to encrypt the contents of the <code class="literal">txtToEncrypt</code>, <code class="literal">Ti.UI.TextField</code>. Once completed, the encrypted value is then decrypted and compared against the original input. The results are displayed to the user in an alert message as shown in the following screenshots:</p><div><img src="img/5343_08_09.jpg" alt="Encrypting and decrypting values"/></div><p>The <a id="id765" class="indexterm"/>encryption test is performed when the click event for<a id="id766" class="indexterm"/> the <code class="literal">btnEncrypt</code> control is fired as shown in the following code snippet:</p><div><pre class="programlisting">btnEncrypt.addEventListener('click',function(x){</pre></div><div><ol class="orderedlist arabic"><li class="listitem">The <a id="id767" class="indexterm"/>first step in the <a id="id768" class="indexterm"/>encryption process is to create a new instance of the <code class="literal">SlowAES</code> module as shown in this code snippet.<div><pre class="programlisting">  var crypto = new my.mod();</pre></div></li><li class="listitem">Next using the encrypt function, the secret provided in the <code class="literal">txtSecret</code> control is used to encrypt the value in the <code class="literal">txtToEncrypt</code> control. The encrypted results are then returned to the <code class="literal">encryptedValue</code> as demonstrated in the following statement:<div><pre class="programlisting">  var encryptedValue = 
  crypto.encrypt(txtToEncrypt.value,txtSecret.value);</pre></div></li><li class="listitem">The <code class="literal">encryptedLabel.text</code> property is then updated to display the encrypted value to the user.<div><pre class="programlisting">  encryptedLabel.text = 'Encrypted:' + encryptedValue;</pre></div></li><li class="listitem">Next, the <code class="literal">decrypt</code> method is used to demonstrate how to decrypt the string value encrypted earlier. This method requires the encrypted string value and the secret as shown in the following snippet:<div><pre class="programlisting">  var decryptedValue = 
  crypto.decrypt(encryptedValue,txtSecret.value);</pre></div></li><li class="listitem">Finally, the <a id="id769" class="indexterm"/>original input value is compared <a id="id770" class="indexterm"/>against the decrypted value to ensure our encryption test was successful. The results of this test are then displayed to the user through a message alert and the <a id="id771" class="indexterm"/>Titanium Studio <a id="id772" class="indexterm"/>console.<div><pre class="programlisting">  alert((txtToEncrypt.value ===decryptedValue) ? 
  'Encryption Test successfully ran check console for details.': 
  'Test failed, please check console for details.');

});</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec121"/>See also</h2></div></div></div><p>You can also refer to the following resources:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It is important to understand some of the weaknesses of JavaScript Cryptography. When deciding on an encryption approach, I would recommend reading the Matasano Security article on this subject available at <a class="ulink" href="http://www.matasano.com/articles/javascript-cryptography">http://www.matasano.com/articles/javascript-cryptography</a>.</li><li class="listitem" style="list-style-type: disc">This recipe uses the <code class="literal">SlowAES</code> project to implement the AES algorithm. To read the license and to learn more about the <code class="literal">SlowAES</code> project, please visit <a class="ulink" href="http://code.google.com/p/slowaes">http://code.google.com/p/slowaes</a>.</li><li class="listitem" style="list-style-type: disc">To download the<a id="id773" class="indexterm"/> <code class="literal">Ti.SlowAES</code> CommonJS module and learn more about how to implement its functionality visit <a class="ulink" href="https://github.com/benbahrenburg/Ti.SlowAES">https://github.com/benbahrenburg/Ti.SlowAES</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Basic authentication using Ti.Network.HTTPClient</h1></div></div></div><p>Most enterprise sites or<a id="id774" class="indexterm"/> services provide access to content <a id="id775" class="indexterm"/>through basic access<a id="id776" class="indexterm"/> authentication. Basic authentication is a method for a HTTP user agent to provide a username and password when making a request. It is important to remember that basic authentication base64 encodes your credentials, not encrypts them. For this reason, it is advised that HTTPS is used when creating network connections.</p><p>Titanium provides full support for basic authentication using the SDK's <code class="literal">Ti.Network</code> functionality. This recipe describes how to use the <code class="literal">Ti.Network.HTTPClient</code> proxy to connect to a website using basic authentication headers.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec122"/>Getting ready</h2></div></div></div><p>This recipe uses the <code class="literal">Ti.BA</code> CommonJS module as an assist to Titanium's native <code class="literal">Ti.Network.HTTPClient</code>. This <a id="id777" class="indexterm"/>module and other code assets can<a id="id778" class="indexterm"/> be downloaded <a id="id779" class="indexterm"/>from the source provided by the book. Installing this module in your project is straightforward. Simply copy the <code class="literal">Ti.BA.js</code> file<a id="id780" class="indexterm"/> into <code class="literal">Resources</code> folder of your project as shown in the following screenshot:</p><div><img src="img/5343_08_10.jpg" alt="Getting ready"/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec123"/>How to do it...</h2></div></div></div><p>Once you have added the <code class="literal">Ti.BA.js</code> file to your project, you need to create your application namespace in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code as the following code snippet demonstrates:</p><div><pre class="programlisting">//Create our application namespace
var my = {
  mod : require('Ti.BA')
};</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec215"/>Creating the recipe UI</h3></div></div></div><p>This recipe uses a <a id="id781" class="indexterm"/>simple UI to illustrate how to establish a <a id="id782" class="indexterm"/>basic authenticated network connection. The code snippets in this section <a id="id783" class="indexterm"/>walkthrough how to construct the basic authentication testing app shown in the following screenshots:</p><div><img src="img/5343_08_11.jpg" alt="Creating the recipe UI"/></div><p>Now perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> is created to attach all UI elements.<div><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', title: 'AES Crypto Example', 
  barColor:'#000',layout:'vertical',fullscreen:false
});</pre></div></li><li class="listitem">Next the <code class="literal">txtUsername Ti.UI.TextField</code> is added to the <code class="literal">Ti.UI.Window</code>. The default value is set to <code class="literal">test</code> since it is the default for the <code class="literal">browserspy.dk</code> test site used to create our mock test connection.<div><pre class="programlisting">var txtUsername = Ti.UI.createTextField({
  value:'test',hintText:'Enter username',
  height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtUsername);</pre></div></li><li class="listitem">The<a id="id784" class="indexterm"/> <code class="literal">txtPassword Ti.UI.TextField</code> is then added to the <code class="literal">Ti.UI.Window</code>. The default value is <a id="id785" class="indexterm"/>set to <code class="literal">test</code> since it is the default for the <code class="literal">browserspy.dk</code> test site used to create our mock test connection.<div><pre class="programlisting">var txtPassword = Ti.UI.createTextField({
  value:'test',hintText:'Enter password',
  passwordMask:true,height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtPassword);</pre></div></li><li class="listitem">Next<a id="id786" class="indexterm"/> the <code class="literal">txtUrl Ti.UI.TextField</code> is added to the <code class="literal">Ti.UI.Window</code>. The default value is set to <code class="literal">"http://browserspy.dk/password-ok"</code>. The value for <code class="literal">txtUrl</code> can be updated to any service requiring basic authentication. For demonstration purposes, the recipe uses the <code class="literal">browserspy.dk</code> test site.<div><pre class="programlisting">var txtUrl = Ti.UI.createTextField({
  value:'http://browserspy.dk/password-ok.php',
  hintText:'Enter Url',
  height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtUrl);</pre></div></li><li class="listitem">Finally the <code class="literal">btnConnect Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. Later in this recipe, the <code class="literal">btnConnect</code> control will be used to initialize the authenticated network connection.<div><pre class="programlisting">var btnConnect = Ti.UI.createButton({
  title:'Connect', top:25, height:45, left:5, right:5
});
win.add(btnConnect);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec216"/>Creating a service connection</h3></div></div></div><p>With the sample UI<a id="id787" class="indexterm"/> now in place, the <a id="id788" class="indexterm"/>next step in the recipe is to perform a secure network connection using basic <a id="id789" class="indexterm"/>authentication. The following snippets are used to create a network connection and display the results shown in the following screenshots:</p><div><img src="img/5343_08_12.jpg" alt="Creating a service connection"/></div><p>A basic authenticated test network connection is performed when the <code class="literal">click</code> event for the <code class="literal">btnConnect</code> control is fired as shown in the following code snippet:</p><div><pre class="programlisting">btnConnect.addEventListener('click',function(x){</pre></div><div><ol class="orderedlist arabic"><li class="listitem">First, the <code class="literal">Ti.Network.online</code> property is checked to ensure the device has a network connection. If no network connection is available, the user is alerted and the function is exit.<div><pre class="programlisting">  if(!Ti.Network.online){
    alert('Network connection is required');
    return;
  }</pre></div></li><li class="listitem">Next the <code class="literal">onDone</code> function is created. This function is used as a callback for the results of the authentication network connection.<div><pre class="programlisting">  function onDone(d){</pre></div></li><li class="listitem">When in the <code class="literal">onDone</code> function, the first action performed is to check the results provided in the <code class="literal">d.success</code> property. If this property is <code class="literal">true</code>, the network connection was successfully completed. Otherwise, the <code class="literal">d.error</code> message is printed to the console and the user is notified.<div><pre class="programlisting">    if(d.success){
      Ti.API.info('Results = ' + 
      JSON.stringify(d.results));
      alert('Authenticated successfully');
    }else{
      Ti.API.info('error = ' + JSON.stringify(d.error));
      alert('Authenticated Failed');
    }
  };</pre></div></li><li class="listitem">The<a id="id790" class="indexterm"/> <code class="literal">credentials</code> object <a id="id791" class="indexterm"/>is then created. This contains the username and password to be used when creating <a id="id792" class="indexterm"/>our authenticated connection. Please note these values should be in plain text as demonstrated in taking the values directly from the <code class="literal">Ti.UI.TextField</code> controls on the screen.<div><pre class="programlisting">  var credentials = {
    username:txtUsername.value,
    password:txtPassword.value
  };</pre></div></li><li class="listitem">The <code class="literal">Ti.BA module</code> allows you to configure all of the <code class="literal">Ti.Network.HTTPClient</code> options along with controlling and specifying the service's output format. The following snippet demonstrates how to configure the request to set the timeout to 9 seconds, and specify the <code class="literal">responseText</code> be the returned response.<div><pre class="programlisting">  var options = {format:'text', timeout:9000};</pre></div></li><li class="listitem">Finally a new instance of the <code class="literal">Ti.BA</code> module is created and the following are provided:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Method</strong>: The <code class="literal">GET</code> or <code class="literal">POST</code> action is performed. In the case of this sample, the <code class="literal">POST</code> method is provided.</li><li class="listitem" style="list-style-type: disc"><strong>URL</strong>: The URL the module uses to connect.</li><li class="listitem" style="list-style-type: disc"><strong>Credentials</strong>: The <code class="literal">credentials</code> object contains the username and password that will be used to create the basic authenticated connection.</li><li class="listitem" style="list-style-type: disc"><strong>Callback</strong>: This <a id="id793" class="indexterm"/>parameter requires a callback method to be provided. In this sample, the <code class="literal">onDone</code> method is provided to the module and will return the connection response.</li><li class="listitem" style="list-style-type: disc"><strong>Options</strong>: These<a id="id794" class="indexterm"/> are the configuration options for the <code class="literal">Ti.Network.HTTPClient</code> and result type to be returned. If none is<a id="id795" class="indexterm"/> provided, the module's default values are returned.<div><pre class="programlisting">  var basicAuth = new 
  my.mod('POST',txtUrl.value,credentials, onDone,options);
});</pre></div></li></ul></div></li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec58"/>Implementing a cross-platform passcode screen</h1></div></div></div><p>Password and passcode <a id="id796" class="indexterm"/>screens are common verification instruments for enterprise apps. These screens provide interaction patterns that help solve both authentication and confirmation scenarios.</p><p>This recipe <a id="id797" class="indexterm"/>demonstrates how to implement a cross-platform passcode screen similar to those seen on iOS and in the Android networking screens.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec124"/>Getting ready</h2></div></div></div><p>This recipe uses the<a id="id798" class="indexterm"/> <code class="literal">Ti.Passcode</code> CommonJS module to implement a cross-platform passcode screen. This module and other code assets can be downloaded from the source provided by the book, or individually through the links provided in the <em>See also</em> section at the end of this recipe. Installing this module in your project is straightforward. Simply copy the <code class="literal">Ti.Passcode.js</code> file<a id="id799" class="indexterm"/> into the <code class="literal">Resources</code> folder of your project as shown in the following screenshot:</p><div><img src="img/5343_08_13.jpg" alt="Getting ready"/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec125"/>How to do it...</h2></div></div></div><p>Once you have added the <code class="literal">Ti.Passcode.js</code> file to your project, you need to create your application namespaces in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code as the following code demonstrates:</p><div><pre class="programlisting">//Create our application namespace
var my = {
  mod : require('Ti.Passcode')
};</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec217"/>Creating the recipe UI</h3></div></div></div><p>This recipe<a id="id800" class="indexterm"/> uses <code class="literal">Ti.UI.Windows</code> to <a id="id801" class="indexterm"/>present information to the user. The code used to create the first <code class="literal">Ti.UI.Window</code> is discussed in this section. This section details how to launch the <code class="literal">Ti.Passcode</code> module and provides a code to have it verified.</p><div><img src="img/5343_08_14.jpg" alt="Creating the recipe UI"/></div><p>Now perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> is created to attach all UI elements.<div><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', title: 'Passcode Example', 
  layout:'vertical',fullscreen:false, exitOnClose:true
});</pre></div></li><li class="listitem">Next<a id="id802" class="indexterm"/> the <code class="literal">txtPasscode Ti.UI.TextField</code> is added to the <code class="literal">Ti.UI.Window</code>. This <a id="id803" class="indexterm"/>control is used to collect the passcode that the <code class="literal">Ti.Passcode</code> module will verify against.<div><pre class="programlisting">var txtPasscode = Ti.UI.createTextField({
  value:'1234',hintText:'Enter Passcode',
  height:45, left:5, right:5,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtPasscode);</pre></div></li><li class="listitem">Finally the <code class="literal">bntRunPasscode Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. This button will be used later in the recipe to launch the passcode screen.<div><pre class="programlisting">var btnRunPasscode = Ti.UI.createButton({
  title:'Open Passcode Screen', top:25, height:45, 
  left:5, right:5	
});
win.add(btnRunPasscode);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec218"/>Launching the passcode screen</h3></div></div></div><p>The second <code class="literal">Ti.UI.Window</code> in this<a id="id804" class="indexterm"/> recipe is created by the <code class="literal">Ti.Passcode</code> module. This <code class="literal">Ti.UI.Window</code> is responsible for the presentation and verification of the application passcode. This section describes how to configure, create, and confirm your app passcode using this module's display element shown in the following screenshot:</p><div><img src="img/5343_08_15.jpg" alt="Launching the passcode screen"/></div><p>The passcode verification screen is launched when the user taps the <code class="literal">btnRunPasscode Ti.UI.Button</code> and <a id="id805" class="indexterm"/>triggers the <code class="literal">click</code> event to be fired. The following code snippet discusses the actions performed after the <code class="literal">click</code> event is fired:</p><div><pre class="programlisting">btnRunPasscode.addEventListener('click',function(x){</pre></div><div><ol class="orderedlist arabic"><li class="listitem">The first code block in the <code class="literal">click</code> event of the <code class="literal">btnRunPasscode</code> button is to create our configuration and other variables. The <code class="literal">options</code> object contains all of the settings needed to configure the <code class="literal">Ti.Passcode</code> window.<div><pre class="programlisting">  var codeWindow  = null, 
  options = {</pre></div></li><li class="listitem">The <code class="literal">window</code> configuration element allows for all of the standard <code class="literal">Ti.UI.Window</code> properties to be used. The following snippet shows how to set the <code class="literal">backgroudnColor</code> and <code class="literal">navBarHidden</code> properties on the passcode window.<div><pre class="programlisting">    window:{
      backgroundColor:'#ccc',
      navBarHidden:true
    },</pre></div></li><li class="listitem">The <code class="literal">view</code> <a id="id806" class="indexterm"/>configuration <a id="id807" class="indexterm"/>element allows for the configuration of a majority of the components displayed in the <code class="literal">Ti.Passcode</code> window. The following snippet demonstrates how to set the <code class="literal">passcode</code> title property and code for displaying the error message:<div><pre class="programlisting">    view:{
      title:'Enter application passcode',
      errorColor:'yellow'
    }
  };</pre></div><div><div><h3 class="title"><a id="tip38"/>Tip</h3><p>Please review the <code class="literal">Ti.Passcode</code> module for a complete list of the configuration properties available.</p></div></div></li><li class="listitem">Next the <code class="literal">onCompleted</code> callback function is defined. This function will be used as the callback method provided to the <code class="literal">Ti.Passcode</code> module. The passcode verification results will be provided as a dictionary to the <code class="literal">d</code> input parameters.<div><pre class="programlisting">  function onCompleted(d){</pre></div></li><li class="listitem">The <code class="literal">d</code> argument is an object with the verification results. The <code class="literal">d.success</code> property provides an indicator if the entered passcode matches the passcode provided on launch. The following code snippet alerts the user if they have entered the correct passcode or if they need to try the process again.<div><pre class="programlisting">    if(d.success){
      alert('Passcode entered is correct');
      codeWindow.close();
    }else{
      Alert('Invalid passcode, please try again');
    }
  };</pre></div></li><li class="listitem">The next step in this section of the recipe is to create a new instance of the passcode module. The following snippet demonstrates how to do this:<div><pre class="programlisting">  var passcode = new my.mod();</pre></div></li><li class="listitem">The <code class="literal">createWindow</code> method is then called on the new passcode instance. This<a id="id808" class="indexterm"/> method<a id="id809" class="indexterm"/> provides the passcode to verify from the <code class="literal">txtPasscode</code> control, and also provides the callback and options objects created earlier. This method then returns a <code class="literal">Ti.UI.Window</code>. Once the passcode has been entered, the callback method <code class="literal">onCompleted</code> will send the verification results.<div><pre class="programlisting">  var codeWindow =
  passcode.createWindow(txtPasscode.value,
  onCompleted,options);</pre></div></li><li class="listitem">The <code class="literal">Ti.UI.Window</code> returned by the <code class="literal">createWindow</code> method is then opened with a modal flag. The passcode <code class="literal">Ti.UI.Window</code> will remain open until closed by the <code class="literal">onCompleted</code> callback method as discussed earlier.<div><pre class="programlisting">  codeWindow.open({modal:true});
});</pre></div></li></ol></div><p>The following screenshots illustrate how this section of the code looks on the device after the user has successfully entered his/her passcode.</p><div><img src="img/5343_08_16.jpg" alt="Launching the passcode screen"/></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec126"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This recipe uses the <code class="literal">Ti.Passcode</code> CommonJS module. To read the documentation and to learn more about this project, please visit <a class="ulink" href="https://github.com/benbahrenburg/Ti.Passcode">https://github.com/benbahrenburg/Ti.Passcode</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec59"/>Working with protected ZIP files on iOS</h1></div></div></div><p>Protected zip files<a id="id810" class="indexterm"/> are a common way to exchange, store, and transmit enterprise data.  ZIP files are often used to bundle several files together for transmission or storage. As an extra layer of security, all such files should always be protected <a id="id811" class="indexterm"/>with a strong password.</p><p>The following recipe discusses how to create and unzip protected compressed files on iOS.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec127"/>Getting ready</h2></div></div></div><p>This recipe uses the <code class="literal">bencoding.zip</code> <a id="id812" class="indexterm"/>native module to work with protected zip files. This module and other code assets can be downloaded from the source provided by the book, or individually through the links provided in the <em>See also</em> section at the end of this recipe. Installing this module in your project is straightforward. Simply copy the <code class="literal">modules</code> folder into the root of your project, and then copy the <code class="literal">data</code> folder into the <code class="literal">Resources</code> directory of your project as shown in the following screenshot:</p><div><img src="img/5343_08_17.jpg" alt="Getting ready"/></div><p>After copying the mentioned folders, you will need to click on your <strong>tiapp.xml</strong> file in Titanium Studio and add a reference to the <code class="literal">bencoding.zip</code> module as shown in the following<a id="id813" class="indexterm"/> screenshot:</p><div><img src="img/5343_08_18.jpg" alt="Getting ready"/></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec128"/>How to do it...</h2></div></div></div><p>Once you have added the <code class="literal">modules</code> and <code class="literal">data</code> folders to your project, you need to create your application namespaces in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code as the following code snippet demonstrates:</p><div><pre class="programlisting">//Create our application namespace
var my = {
  zip : require('bencoding.zip')
};</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec219"/>Creating the recipe UI</h3></div></div></div><p>This recipe uses a <a id="id814" class="indexterm"/>simple UI to illustrate how to create (zip) and unzip protected ZIP files. The code discussed in this section walks through how to construct the recipe's UI shown in the following screenshot:</p><div><img src="img/5343_08_19.jpg" alt="Creating the recipe UI"/></div><p>The following steps outline how to create the recipe's UI:</p><div><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> is created to attach all UI elements.<div><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', title: 'Protected Zip Example', 
  barColor:'#000',layout:'vertical'
});</pre></div></li><li class="listitem">Next add the <code class="literal">txtPassword Ti.UI.TextField</code> control. This control will be used to provide the password to create protected ZIP files or to unzip them. The default is set to <code class="literal">foo123</code>. This is also the password for the included sample file.<div><pre class="programlisting">var txtPassword = Ti.UI.createTextField({
  value:'foo123',hintText:'Enter Password',
  height:45, left:5, right:5, passwordMask:true,
  borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED
});
win.add(txtPassword);</pre></div></li><li class="listitem">Then the <code class="literal">btnZip Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. This button will be used to demonstrate how to create a protected ZIP file later in the discussion of this recipe.<div><pre class="programlisting">var btnZip = Ti.UI.createButton({
  title:'Zip with Password', 
  top:25, height:45, left:5, right:5
});
win.add(btnZip);</pre></div></li><li class="listitem">Next <a id="id815" class="indexterm"/>the <code class="literal">btnUnzip Ti.UI.Button</code> is added to the <code class="literal">Ti.UI.Window</code>. This button will be used to demonstrate how to unzip a protected ZIP file later in the discussion of this recipe.<div><pre class="programlisting">var btnUnzip = Ti.UI.createButton({
  title:'Unzip with Password', top:25, height:45, 
  left:5, right:5	
});
win.add(btnUnzip);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec220"/>Creating a password-protected ZIP file</h3></div></div></div><p>This section of this <a id="id816" class="indexterm"/>recipe demonstrates how to create a<a id="id817" class="indexterm"/> protected ZIP file. The following screenshot shows this recipe in action, creating a protected ZIP file and alerting the user of the output file path:</p><div><img src="img/5343_08_20.jpg" alt="Creating a password-protected ZIP file"/></div><p>The created ZIP file is executed when the user clicks on the <code class="literal">btnZip Ti.UI.Button</code> and triggers the <code class="literal">click</code> event to be fired. The following code snippet discusses the actions performed after the <code class="literal">click</code> event is fired:</p><div><pre class="programlisting">btnZip.addEventListener('click',function(x){</pre></div><div><ol class="orderedlist arabic"><li class="listitem">The first step in the zip process is to create the <code class="literal">onZipCompleted</code> callback method. When the zip process is completed, the module will send the results to this callback method:<div><pre class="programlisting">  function onZipCompleted(d){</pre></div></li><li class="listitem">The <code class="literal">d</code> <a id="id818" class="indexterm"/>method parameter provides the results from the module. The first step in processing the module results is to check the <code class="literal">d.success</code> property to see if the zip process was successful. If so, the user is alerted of the path of the completed ZIP file. Otherwise, the user is alerted to the error generated in creating the file.<div><pre class="programlisting">    if(d.success){
      alert('Protected zip created at: ' + d.zip);
    }else{
      alert('failed due to: ' + d.message);
    }
  };</pre></div></li><li class="listitem">Next the <code class="literal">writeToZip</code> and <code class="literal">inputDirectory</code> variables are created. The <code class="literal">writeToZip</code> variable contains the path to the <code class="literal">taxforms</code>.ZIP output file in the app's <code class="literal">Documents</code> directory. The <code class="literal">inputDirectory</code> creates a reference to the <code class="literal">Resources/data</code> created during the <em>Getting ready</em> section of this recipe.<div><pre class="programlisting">  var writeToZip = Ti.Filesystem.applicationDataDirectory + 
  '/taxforms.zip';
  var inputDirectory = Ti.Filesystem.resourcesDirectory + 
  'data/';</pre></div></li><li class="listitem">Finally<a id="id819" class="indexterm"/> the <code class="literal">zip</code> method is called and this method provides the parameters built earlier in the <code class="literal">click</code> event handler. Once completed, the <code class="literal">zip</code> method provides results to the provided <code class="literal">onZipCompleted</code> callback method.<div><pre class="programlisting">  my.zip.zip({
    zip: writeToZip, 
    password:txtPassword.value,
    files: [inputDirectory + 'w2.pdf',
    inputDirectory + 'w4.pdf'],
    completed:onZipCompleted
  });
});</pre></div><div><div><h3 class="title"><a id="tip200"/>Tip</h3><p>The <code class="literal">files</code> parameter provides an array of files using the <code class="literal">inputDirectory</code> variable. In this example, the files included are the <code class="literal">w2.pdf</code> and <code class="literal">w4.pdf</code> files included in the <code class="literal">Resources/data</code> folder created during the <em>Getting ready</em> section of this recipe.</p></div></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec221"/>Unzipping a protected ZIP file</h3></div></div></div><p>This section of the<a id="id820" class="indexterm"/> current recipe demonstrates how to unzip a protected ZIP file. The following screenshot shows this recipe in action, unzipping the contents of a protected file into the app's <code class="literal">Documents</code> directory:</p><div><img src="img/5343_08_21.jpg" alt="Unzipping a protected ZIP file"/></div><p>The unzip <a id="id821" class="indexterm"/>example is executed when the user taps on the <code class="literal">btnUnzip Ti.UI.Button</code> and triggers the <code class="literal">click</code> event to be fired. The following code snippet discusses the actions performed after the <code class="literal">click</code> event is fired.</p><div><pre class="programlisting">btnUnzip.addEventListener('click',function(x){</pre></div><div><ol class="orderedlist arabic"><li class="listitem">The first step in the unzip process is to create the <code class="literal">onUnzipCompleted</code> callback method. When the unzip process is completed, the module will send the results to this callback method.<div><pre class="programlisting">  function onUnzipCompleted(e){</pre></div></li><li class="listitem">The <code class="literal">d</code> method parameter provides the results from the module. The first step in processing the module results is to check the <code class="literal">d.success</code> property to see if the unzip process was successful. If so, the user is alerted of the directory path of the unzipped file. Otherwise, the user is alerted to the error generating the file.<div><pre class="programlisting">    if(e.success){
      alert('Unzipped to ' + e.outputDirectory);
    }else{
      alert('failed due to: ' + e.message);
    }
  };</pre></div></li><li class="listitem">The <code class="literal">outputDirectory</code> and <code class="literal">zipFileName</code> variables are created next. The <code class="literal">outputDirectory</code> variable contains the path to the output directory in the app's <code class="literal">Documents</code> directory. The <code class="literal">zipFileName</code> creates a reference to the <code class="literal">Resources/data/taxform.zip</code> file created during the <em>Getting ready</em> section of this recipe.<div><pre class="programlisting">  var outputDirectory = 
  Ti.Filesystem.applicationDataDirectory;
  var zipFileName = Ti.Filesystem.resourcesDirectory + 
  'data/taxforms.zip';</pre></div></li><li class="listitem">Finally, the <code class="literal">unzip</code> method<a id="id822" class="indexterm"/> is called and this method provides the parameters built earlier in the <code class="literal">click</code> event handler. Once completed, the <code class="literal">unzip</code> method provides results to the provided <code class="literal">onUnzipCompleted</code> callback method.<div><pre class="programlisting">  my.zip.unzip({
    outputDirectory:outputDirectory, 
    zip:zipFileName, 
    overwrite:true,
    completed:onUnzipCompleted
  });
});</pre></div><div><div><h3 class="title"><a id="note21"/>Note</h3><p>All files contained within the <code class="literal">zipFileName</code> ZIP file will be unzipped to the root of the directory provided in the <code class="literal">outputDirectory</code> parameter.</p></div></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec129"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This recipe uses the <code class="literal">benCoding.Zip</code> native module. To read the documentation and to learn more about this project, please visit <a class="ulink" href="https://github.com/benbahrenburg/Zipper">https://github.com/benbahrenburg/Zipper</a>.</li></ul></div></div></div></body></html>