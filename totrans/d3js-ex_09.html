<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Complex Shapes Using Paths"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Complex Shapes Using Paths</h1></div></div></div><p>In <a class="link" href="ch03.html" title="Chapter 3. Creating Visuals with SVG">Chapter 3</a>, <span class="emphasis"><em>Creating Visuals with SVG</em></span>, we briefly examined the concept of paths. We saw that we could use paths and their associated mini-language to create multi-segment renderings by creating a sequence of commands. These paths, although very powerful, can be cumbersome to create manually.</p><p>But don't fret, as D3.js provides a number of objects to create complex paths using just a few JavaScript statements. These <span class="strong"><strong>path generators</strong></span> take much of the pain out of creating complex paths manually, as they do the heavy lifting of assembling the sequence of commands automatically.</p><p>Additionally, an important type of graph we have not looked at in this book is a line graph. This has been purposefully pushed off until now, as it is the most commonly used to create lines using path generators. After the examples in this chapter, the power of the path to create lines will be evident.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An overview of path data generators</li><li class="listitem" style="list-style-type: disc">Lines and area generators</li><li class="listitem" style="list-style-type: disc">Arcs and pie generators</li><li class="listitem" style="list-style-type: disc">Symbols generators</li><li class="listitem" style="list-style-type: disc">Diagonals and radial generators</li><li class="listitem" style="list-style-type: disc">Line interpolators</li></ul></div><div class="section" title="An overview of path data generators"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec43"/>An overview of path data generators</h1></div></div></div><p>D3.js goes to <a id="id390" class="indexterm"/>great lengths to make using SVG easy, particularly when creating complex paths. To do this, D3 provides a number of helper functions referred to as path generators that have been created to handle the gory details of path generation from a set of data.</p><p>The generators we examine will follow a common pattern of usage, so once you learn to use one, the use of the others will come naturally. These steps include:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Creating the <code class="literal">generator</code> object.</li><li class="listitem">Specifying accessor functions that can be used to find the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> values.</li><li class="listitem">Calling any additional methods to specify various rendering instructions.</li><li class="listitem">Adding a path to the visual.</li><li class="listitem">Specifying the data using <code class="literal">.datum()</code>on that path.</li><li class="listitem">And finally, setting the <code class="literal">d</code> attribute of the path to the generator, which tells the path where to find the <code class="literal">generator</code> object for the path.</li></ol></div><p>Once these are completed <a id="id391" class="indexterm"/>and D3.js renders the visual, it uses the generator that is attached to a <code class="literal">d</code> attribute and creates path commands based on your data. This is also why we use <code class="literal">.datum()</code> instead of <code class="literal">.data()</code>, as datum assigns the data to just that one element and does not force the execution of an enter-update-exit loop on that data.</p><p>Now let's examine doing this with various common generators—this will be fun!</p><div class="section" title="Creating a sequence of lines"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec50"/>Creating a sequence of lines</h2></div></div></div><p>The line <a id="id392" class="indexterm"/>generator creates the necessary commands to draw a sequence of lines that are connected to each other:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note109"/>Note</h3><p>bl.ock (9.1): <a class="ulink" href="http://goo.gl/eAgBjL">http://goo.gl/eAgBjL</a>
</p></div></div><p>The preceding example creates a single line path generator and renders it twice, resulting in the following graphics:</p><div class="mediaobject"><img src="graphics/B04230_09_01.jpg" alt="Creating a sequence of lines"/></div><p>The path generator is created with the following data and using a <code class="literal">d3.svg.line()</code> object. On that object, we call two functions, <code class="literal">x()</code> and <code class="literal">y()</code>, which we give a function that tells the generator how to locate the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> values for each datum:</p><div class="informalexample"><pre class="programlisting">var data = [
    { X: 10, Y: 10 },
    { X: 60, Y: 60 },
    { X: 80, Y: 20 }
];
var generator = d3.svg.line()
    .x(function(d) { return d.X; })
    .y(function(d) { return d.Y; });</pre></div><p>The next step is to add a path, call its .<code class="literal">datum()</code> function passing the data, and setting the <code class="literal">d</code> attribute at a <a id="id393" class="indexterm"/>minimum to specify which generator to use. The example creates two paths that use the same data and generator but apply a different fill:</p><div class="informalexample"><pre class="programlisting">svg.append('path')
    .datum(data)
    .attr({
        d: generator,
        fill: 'none',
        stroke: 'steelblue'
    });
svg.append('path')
    .datum(data)
    .attr({
        transform: 'translate(100,0)',
        d: generator,
        fill: 'none',
        stroke: 'steelblue'
    });</pre></div><p>This path specifies two lines. The default operation for a line path is to connect the last point with the first and fill in the internals. In the case of the first path, this is a black fill and results in the black triangle (if you zoom in, you will see the <code class="literal">steelblue</code> outline on two of the sides). The latter path sets the fill to empty, so the result is just the two lines.</p><p>This example also demonstrates using a single path generator but applying a transform and a different style to the actual path.</p><p>Examining the generated SVG, we see that D3.js has created the two paths and automatically generated the path data that is assigned to the <code class="literal">d</code> property of the path:</p><div class="mediaobject"><img src="graphics/B04230_09_02.jpg" alt="Creating a sequence of lines"/></div></div><div class="section" title="Areas"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec51"/>Areas</h2></div></div></div><p>An area path <a id="id394" class="indexterm"/>generator allows us to make line plots <a id="id395" class="indexterm"/>where the area below the line plot is filled in with a particular color. A practical use of these is for the creation of area graphs. The following example demonstrates the creation of an area graph:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note110"/>Note</h3><p>bl.ock (9.2): <a class="ulink" href="http://goo.gl/7Xmo7u">http://goo.gl/7Xmo7u</a>
</p></div></div><p>This preceding example results in something that looks like the following image. The data is random, so it will be different each time it runs:</p><div class="mediaobject"><img src="graphics/B04230_09_03.jpg" alt="Areas"/></div><p>The data is generated by generating 100 random numbers between 0 and 30, and defining <code class="literal">Y</code> as the random value and <code class="literal">X</code> increasing in increments of 10:</p><div class="informalexample"><pre class="programlisting">var data = d3.range(100)
    .map(function(i) {
        return Math.random() * 30;
    })
    .map(function(d, i) {
            return { X: i * 10, Y: d }
    });</pre></div><p>The path is generated using a <code class="literal">d3.svg.area()</code> object:</p><div class="informalexample"><pre class="programlisting">var generator = d3.svg.area()
    .y0(100)
    .x(function(d) { return d.X; })
    .y1(function (d) { return d.Y; });</pre></div><p>An area path generator requires providing three accessor functions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">x()</code>: This specifies where to get the <span class="emphasis"><em>X</em></span> values</li><li class="listitem" style="list-style-type: disc"><code class="literal">y0()</code>: This gets the position of the baseline of the area</li><li class="listitem" style="list-style-type: disc"><code class="literal">y1()</code>: This retrieves the height at the given <code class="literal">x()</code> value</li></ul></div><p>The actual SVG path is then created and styled similar to the previous example.</p></div><div class="section" title="Creating arcs, donuts, wedges, and segments"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec52"/>Creating arcs, donuts, wedges, and segments</h2></div></div></div><p>An arc is a <a id="id396" class="indexterm"/>slice of a circle that has a portion of it swept <a id="id397" class="indexterm"/>through two specific angles. An arc swept <a id="id398" class="indexterm"/>through a full 360 degrees will actually <a id="id399" class="indexterm"/>result in a circle. A sweep of less than 360 <a id="id400" class="indexterm"/>degrees gives you a wedge of that circle and is often called a <a id="id401" class="indexterm"/>pie <span class="strong"><strong>wedge</strong></span>.</p><p>An arc is created <a id="id402" class="indexterm"/>using the <code class="literal">d3.svg.arc() </code>function. This generator takes four <a id="id403" class="indexterm"/>parameters, describing the mathematics of the arc. The size of the wedge is defined by using the <code class="literal">.outerRadius()</code> function and an inner radius that is specified using <code class="literal">.innerRadius()</code>.</p><p>The following example uses an arc to draw a circle:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note111"/>Note</h3><p>bl.ock (9.3): <a class="ulink" href="http://goo.gl/fJN80J">http://goo.gl/fJN80J</a>
</p></div></div><div class="mediaobject"><img src="graphics/B04230_09_04.jpg" alt="Creating arcs, donuts, wedges, and segments"/></div><p>The code to create the generator is the following:</p><div class="informalexample"><pre class="programlisting">var generator = d3.svg.arc()
    .innerRadius(0)
    .outerRadius(60)
    .startAngle(0)
    .endAngle(Math.PI * 2);</pre></div><p>The generator specifies an inner radius of <code class="literal">0</code> and outer radius of <code class="literal">60</code>. The start and end angles are in radians and sweep out an entire circle.</p><p>The following example increases the size of the inner radius to create a donut:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note112"/>Note</h3><p>bl.ock (9.4): <a class="ulink" href="http://goo.gl/NDVPRw">http://goo.gl/NDVPRw</a>
</p></div></div><div class="mediaobject"><img src="graphics/B04230_09_05.jpg" alt="Creating arcs, donuts, wedges, and segments"/></div><p>The only difference in the code is the call to <code class="literal">.innerRadius()</code>:</p><div class="informalexample"><pre class="programlisting">var generator = d3.svg.arc()
    .innerRadius(30)
    .outerRadius(60)
    .startAngle(0)
    .endAngle(Math.PI * 2);</pre></div><p>We have now <a id="id404" class="indexterm"/>created a donut! Now how about an example of creating a pie wedge? We <a id="id405" class="indexterm"/>can create a pie wedge by specifying an inner radius <a id="id406" class="indexterm"/>of <code class="literal">0</code> and setting the start angle and end angle to not sweep <a id="id407" class="indexterm"/>out a full 360 degrees, as shown in the following example.</p><p>To demonstrate, the following example creates a pie wedge sweeping between <code class="literal">45</code> and <code class="literal">105</code> degrees:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note113"/>Note</h3><p>bl.ock (9.5): <a class="ulink" href="http://goo.gl/cNizYk">http://goo.gl/cNizYk</a>
</p></div></div><div class="mediaobject"><img src="graphics/B04230_09_06.jpg" alt="Creating arcs, donuts, wedges, and segments"/></div><p>The generator for the preceding pie wedge is as follows:</p><div class="informalexample"><pre class="programlisting">var generator = d3.svg.arc()
    .innerRadius(0)
    .outerRadius(60)
    .startAngle(45 * Math.PI * 2 / 360)
    .endAngle(105 * Math.PI * 2 / 360);</pre></div><p>A final example <a id="id408" class="indexterm"/>for arcs is to create a segment by increasing the inner radius <a id="id409" class="indexterm"/>of <a id="id410" class="indexterm"/>the previous example to be <a id="id411" class="indexterm"/>greater than 0:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note114"/>Note</h3><p>bl.ock (9.6): <a class="ulink" href="http://goo.gl/24djAS">http://goo.gl/24djAS</a>
</p></div></div><div class="informalexample"><pre class="programlisting">var generator = d3.svg.arc()
    .innerRadius(40)
    .outerRadius(60)
    .startAngle(45 * Math.PI * 2/360)
    .endAngle(105 * Math.PI * 2/360);</pre></div><div class="mediaobject"><img src="graphics/B04230_09_07.jpg" alt="Creating arcs, donuts, wedges, and segments"/></div></div><div class="section" title="Creating a pie chart"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec53"/>Creating a pie chart</h2></div></div></div><p>One of the most <a id="id412" class="indexterm"/>common type of charts is the pie chart (it is also <a id="id413" class="indexterm"/>one of the most reviled). A pie chart could be created by using multiple arc generators and placing them manually.</p><p>To make this simpler, D3.js provides us with a tool to help us generate pies and the associated arcs with a generator for pies, <code class="literal">d3.layout.pie()</code>. From an array of data, this function will generate an array of arc specifications that we can then use to generate all the pie segments automatically.</p><p>So, let's examine the creation of a pie:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note115"/>Note</h3><p>bl.ock (9.7): <a class="ulink" href="http://goo.gl/omVW2n">http://goo.gl/omVW2n</a>
</p></div></div><p>The preceding code results in the following pie chart:</p><div class="mediaobject"><img src="graphics/B04230_09_08.jpg" alt="Creating a pie chart"/></div><p>The example starts by declaring values that represent each piece of the pie and then we pass that to the <code class="literal">d3.layout.pie()</code> function:</p><div class="informalexample"><pre class="programlisting"> var data = [21, 32, 35, 64, 83];
 var pieSegments = d3.layout.pie()(data);</pre></div><p>If you examine the <a id="id414" class="indexterm"/>contents of <code class="literal">pieSegments,</code> you <a id="id415" class="indexterm"/>will see a series of objects similar to the following:</p><div class="informalexample"><pre class="programlisting">[[object Object] {
  data: 21,
  endAngle: 6.283185307179587,
  padAngle: 0,
  startAngle: 5.721709173346517,
  value: 21
},
…
] </pre></div><p>We can use this data via an arc generator and generate the pie:</p><div class="informalexample"><pre class="programlisting">var arcGenerator = d3.svg.arc()
    .innerRadius(0)
    .outerRadius(100)
    .startAngle(function(d) {
         return d.startAngle;
    })
    .endAngle(function(d) {
         return d.endAngle;
    });
var colors = d3.scale.category10();
group.selectAll('path')
    .data(pieSegments)
    .enter()
    .append('path')
    .attr('d', arcGenerator)
    .style('fill', function(d, i) {
        return colors(i);
  });</pre></div><div class="section" title="Exploding the pie"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec18"/>Exploding the pie</h3></div></div></div><p>We can make an <a id="id416" class="indexterm"/>exploded pie by setting the width of the border of the pie wedges. The following example demonstrates this in action. We'll skip the walkthrough of the code, as it's just adding a <code class="literal">stroke</code> and <code class="literal">stroke-width</code> to the previous example:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note116"/>Note</h3><p>bl.ock (9.8): <a class="ulink" href="http://goo.gl/fhQEau">http://goo.gl/fhQEau</a>
</p></div></div><div class="mediaobject"><img src="graphics/B04230_09_09.jpg" alt="Exploding the pie"/></div></div><div class="section" title="Creating a ring graph"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec19"/>Creating a ring graph</h3></div></div></div><p>We can also easily <a id="id417" class="indexterm"/>make this into a ring chart by increasing the inner <a id="id418" class="indexterm"/>radius, as shown in the following example (with a brief modification to the previous example):</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note117"/>Note</h3><p>bl.ock (9.9): <a class="ulink" href="http://goo.gl/Mk60ws">http://goo.gl/Mk60ws</a>
</p></div></div><div class="mediaobject"><img src="graphics/B04230_09_10.jpg" alt="Creating a ring graph"/></div></div></div><div class="section" title="Creating symbols"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec54"/>Creating symbols</h2></div></div></div><p>Symbols are little <a id="id419" class="indexterm"/>shapes that can be used on a chart, much <a id="id420" class="indexterm"/>like how we used small circles and squares in the chapter on scatter plots. D3.js comes with a generator that creates six symbols: circle, cross, diamond, square, triangle-down, and triangle-up.</p><p>These symbols are named, and the <code class="literal">d3.svg.symbolTypes</code> contains an array of the names of the available symbol types. A symbol is then created by passing the symbol name to the <code class="literal">d3.svg.symbol().type()</code> function, which returns a path generator for the specified symbol.</p><p>An example of rendering the available symbols is available at the following link:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note118"/>Note</h3><p>bl.ock (9.10): <a class="ulink" href="http://goo.gl/AM2ErM">http://goo.gl/AM2ErM</a>
</p></div></div><p>The preceding code renders the following symbols as the result:</p><div class="mediaobject"><img src="graphics/B04230_09_11.jpg" alt="Creating symbols"/></div><p>Perhaps they're not the most <a id="id421" class="indexterm"/>exciting things in the world, but they are useful for representing different data items on scatter plots or as point markers on line diagrams.</p></div><div class="section" title="Using diagonals to create curved lines"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec55"/>Using diagonals to create curved lines</h2></div></div></div><p>The <a id="id422" class="indexterm"/>diagonal is one of my personal <a id="id423" class="indexterm"/>favorites, and it can be used in many complex visualizations. This is a concept which I believe is best understood by seeing an example:</p><div class="mediaobject"><img src="graphics/B04230_09_12.jpg" alt="Using diagonals to create curved lines"/></div><p>The diagonal generator generates the curved lines between one point and a set of other points, generating the appropriate curves based on the position of the target points.</p><p>The following example creates the previous image:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note119"/>Note</h3><p>bl.ock (9.11): <a class="ulink" href="http://goo.gl/by9B4S">http://goo.gl/by9B4S</a>
</p></div></div><p>This example starts with defining the source and target positions using JavaScript objects, and then, by creating from those an array of objects representing every combination of <code class="literal">source</code> and <code class="literal">target</code>:</p><div class="informalexample"><pre class="programlisting">var source = { x: 500, y: 50 };
var targets = [
    { x: 100, y: 150 },
    { x: 300, y: 150 },
    { x: 500, y: 150 },
    { x: 700, y: 150 },
    { x: 900, y: 150 }
];
var links = targets.map(function (target) {
    return { source: source, target: target };
});</pre></div><p>We can then <a id="id424" class="indexterm"/>generate the curved lines <a id="id425" class="indexterm"/>using the following selection, which uses a <code class="literal">d3.svg.diagonal()</code> object as the generator of the path data:</p><div class="informalexample"><pre class="programlisting">svg.selectAll('path')
    .data(links)
    .enter()
    .append('path')
    .attr({
        d: d3.svg.diagonal(),
        fill: 'none',
        stroke: '#ccc'
    });</pre></div><p>The circles are not rendered by the diagonal generator. The code renders and positions them based on the positions of the source and target points.</p></div></div></div>
<div class="section" title="Drawing line graphs using interpolators"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec44"/>Drawing line graphs using interpolators</h1></div></div></div><p>Now let's <a id="id426" class="indexterm"/>examine creating line graphs <a id="id427" class="indexterm"/>using a number of the built-in line generators. The capability for rendering lines in D3.js is very robust, and can be used to generate lines with straight segments, or to fit curves through a series of points using a number of different algorithms.</p><p>When rendering a line using a line generator, D3.js applies an interpolator across your data to determine how to create the path segments that connect your data points. The following tables lists the available line interpolators that are available:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Interpolator</p>
</th><th style="text-align: left" valign="bottom">
<p>Operation</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">linear</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Straight lines between points</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">linear-closed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Closes the line segment, last point to first, making a polygon</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">step-before</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Step-wise drawing vertically then horizontally</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">step-after</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Step-wise drawing horizontally then vertically</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">basis</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Renders a b-spline curve with control points at the ends</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">basis-open</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Renders a b-spline curve with control points at the ends, not closing the loop</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">basic-closed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Renders a b-spline curve with control points at the ends, closing the loop</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bundle</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Equivalent to basis, but with a tension parameter</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cardinal</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A cardinal spline, with control points at the ends</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cardinal-open</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A cardinal spline, with control points at the ends; the line may not intersect the end points, but will pass through the internal points</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">cardinal-closed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Closes the cardinal spline into a loop</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">monotone</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A cubic interpolation that preserves monotonicity in y</p>
</td></tr></tbody></table></div><p>The default is to use a linear interpolator, which essentially draws a straight line between each pair of adjacent points. We will take a look at each of these, as I think they are worth demonstrating (and are fun!).</p><p>The example is <a id="id428" class="indexterm"/>available at the following <a id="id429" class="indexterm"/>link:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note120"/>Note</h3><p>bl.ock (9.12): <a class="ulink" href="http://goo.gl/MdjuPz">http://goo.gl/MdjuPz</a>
</p></div></div><p>The application presents the user with two options. One is to select the type of interpolation and the other is to select a tension value, which is only used when the selected interpolation is bundle.</p><p>The example then generates a cycle of a sine wave that is represented by 8 points. As an example, the result is the following when linear interpolation is selected:</p><div class="mediaobject"><img src="graphics/B04230_09_13.jpg" alt="Drawing line graphs using interpolators"/></div><p>The application starts by creating the dropdown boxes and the main SVG element in HTML. It then sets up the scales for the sine wave to map the points into the SVG. The first time the page is loaded, and upon every change of a selection for interpolation or tension, the <code class="literal">redraw()</code> function is called and the graph is generated.</p><p>The <code class="literal">redraw()</code> function retrieves the current value from the interpolation dropdown and uses it to create the line path generator using the selected value:</p><div class="informalexample"><pre class="programlisting">var line = d3.svg.line()
    .interpolate(interpolation)
    .x(function(d) { return xScale(d[0]); })
    .y(function(d) { return yScale(d[1]); });</pre></div><p>If the selected interpolation is bundle, it also retrieves the selected value for the tension and applies that value to the line path generator:</p><div class="informalexample"><pre class="programlisting">if (interpolation === "bundle") {
    var tensionsSel = document.getElementById('tensions');
    var tension = tensionsSel.options[
        tensionsSel.selectedIndex].value;
    line.tension(tension);
}</pre></div><p>The lines are then <a id="id430" class="indexterm"/>generated using a path and the associated <a id="id431" class="indexterm"/>generator and then circles are added at the location of each point.</p><p>Now let's examine what each of these interpolations does to render our sine wave.</p><div class="section" title="Linear and linear-closed interpolators"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec56"/>Linear and linear-closed interpolators</h2></div></div></div><p>The linear <a id="id432" class="indexterm"/>interpolator draws straight lines between <a id="id433" class="indexterm"/>the points:</p><div class="mediaobject"><img src="graphics/B04230_09_14.jpg" alt="Linear and linear-closed interpolators"/></div><p>Linear closed is <a id="id434" class="indexterm"/>a slight variant that also connects the last point to the <a id="id435" class="indexterm"/>first:</p><div class="mediaobject"><img src="graphics/B04230_09_15.jpg" alt="Linear and linear-closed interpolators"/></div></div><div class="section" title="Step-before and step-after interpolations"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec57"/>Step-before and step-after interpolations</h2></div></div></div><p>The best <a id="id436" class="indexterm"/>way to demonstrate a <a id="id437" class="indexterm"/>step-before and step-after is just by giving examples. But <a id="id438" class="indexterm"/>essentially, each pair of points are connected by two lines, one horizontal and the other vertical.</p><p>With step-before, the vertical line come first:</p><div class="mediaobject"><img src="graphics/B04230_09_16.jpg" alt="Step-before and step-after interpolations"/></div><p>A step-after <a id="id439" class="indexterm"/>renders <a id="id440" class="indexterm"/>the horizontal line first:</p><div class="mediaobject"><img src="graphics/B04230_09_17.jpg" alt="Step-before and step-after interpolations"/></div></div><div class="section" title="Creating curved lines using the basis interpolation"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec58"/>Creating curved lines using the basis interpolation</h2></div></div></div><p>A <span class="strong"><strong>basis</strong></span> <a id="id441" class="indexterm"/>curve will pass through the <a id="id442" class="indexterm"/>end points but may not <a id="id443" class="indexterm"/>pass through internal points. The internal points influence the curve of the line, but it is not necessary that the line runs through any of the internal points.</p><p>The following is an example of the basis interpolation:</p><div class="mediaobject"><img src="graphics/B04230_09_18.jpg" alt="Creating curved lines using the basis interpolation"/></div><p>A <span class="strong"><strong>basis-open</strong></span> interpolation does not pass through the end points. It looks similar to basis, but with the line not being drawn between the first and second points and between the next to last and last points:</p><div class="mediaobject"><img src="graphics/B04230_09_19.jpg" alt="Creating curved lines using the basis interpolation"/></div><p>Why would <a id="id444" class="indexterm"/>we want this? This would be in the case where the first and last are control points and can be changed in the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> values to influence how the curve moves through the inner points. Examining this is beyond the scope of this book, but I challenge you to take the concepts that you learned in <a class="link" href="ch08.html" title="Chapter 8. Adding User Interactivity">Chapter 8</a>, <span class="emphasis"><em>Adding User Interactivity</em></span>, allowing the user to drag the control points around, and see how that changes the flow of the line.</p><p>
<span class="strong"><strong>basis-closed</strong></span> tells the <a id="id445" class="indexterm"/>generator to close the loop and <a id="id446" class="indexterm"/>ensure the loop is smooth across all points (the small change in code is omitted again). The result is the following:</p><div class="mediaobject"><img src="graphics/B04230_09_20.jpg" alt="Creating curved lines using the basis interpolation"/></div><p>Pretty <a id="id447" class="indexterm"/>awesome! As you can see, you can use these interpolators to create really complex curved shapes. Imagine doing this by creating the path commands all by yourself. I dare you to examine the path commands for this line—there are a lot of them.</p></div><div class="section" title="Creating curved lines using the bundle interpolation"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec59"/>Creating curved lines using the bundle interpolation</h2></div></div></div><p>
<code class="literal">bundle</code> <a id="id448" class="indexterm"/>is similar to <code class="literal">basis,</code> except <a id="id449" class="indexterm"/>you can specify a parameter for the amount of tension in the line that is generated. Tension allows you to control how tightly the line will conform to the given points. To specify tension, chain the <code class="literal">.tension()</code> function with a parameter value between <code class="literal">0.0</code> and <code class="literal">1.0</code> (the default is <code class="literal">0.7</code>). The following <a id="id450" class="indexterm"/>shows a selected tension <a id="id451" class="indexterm"/>of <code class="literal">0.75</code>:</p><div class="mediaobject"><img src="graphics/B04230_09_21.jpg" alt="Creating curved lines using the bundle interpolation"/></div><p>You can see how the generated line (well, curve) is now influenced a lot less closely by the points. If you set the value to <code class="literal">0.0</code>, this would actually be a straight line. To demonstrate efficiently other values for tension, the following table demonstrates the change in shape at various points of tension from <code class="literal">0.0</code> to <code class="literal">1.0</code>:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Tension</p>
</th><th style="text-align: left" valign="bottom">
<p>Result</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">0.0</code>
</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_22.jpg" alt="Creating curved lines using the bundle interpolation"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">0.5 </code>
</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_23.jpg" alt="Creating curved lines using the bundle interpolation"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">1.0</code>
</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_24.jpg" alt="Creating curved lines using the bundle interpolation"/></div>
</td></tr></tbody></table></div><p>If you <a id="id452" class="indexterm"/>compare a tension of <code class="literal">1.0</code> to the <a id="id453" class="indexterm"/>basis interpolation, you <a id="id454" class="indexterm"/>will notice they are identical.</p></div><div class="section" title="Creating curved lines using the cardinal interpolation"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec60"/>Creating curved lines using the cardinal interpolation</h2></div></div></div><p>
<code class="literal">cardinal</code> <a id="id455" class="indexterm"/>curves are like <code class="literal">basis</code> <a id="id456" class="indexterm"/>curves, except that the <a id="id457" class="indexterm"/>lines are forced to run through all points. The following graph demonstrates the normal, open, and closed forms:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Interpolation</p>
</th><th style="text-align: left" valign="bottom">
<p>Result</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>cardinal</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_25.jpg" alt="Creating curved lines using the cardinal interpolation"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>cardinal-open</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_26.jpg" alt="Creating curved lines using the cardinal interpolation"/></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>cardinal-closed</p>
</td><td style="text-align: left" valign="top">
<div class="mediaobject"><img src="graphics/B04230_09_27.jpg" alt="Creating curved lines using the cardinal interpolation"/></div>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec45"/>Summary</h1></div></div></div><p>In this chapter, we examined several techniques of creating complex shapes using D3.js path data generators. We started with examples of common generators, including line, area, circles, donuts, arcs, and diagonals. These are extremely powerful tools and enhance your ability to create complex visualizations easily.</p><p>We finished the chapter with an examination of line interpolators, a means of informing the line path generator of how to fit lines between data points. These interpolations, including the default linear interpolation, are for the basis of efficiently creating complex line graphs and curved shapes that fit data.</p><p>In the next chapter on layouts, we will move a little higher up the visual stack of D3.js to examine layouts, which are essentially generators for complex data visualizations.</p></div></body></html>