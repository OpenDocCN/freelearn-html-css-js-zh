<html><head></head><body>
        

                            
                    <h1 class="header-title">Creating Your First Johnny-Five Project</h1>
                
            
            
                
<p>Now that we've set up our development environment, it's time to start writing code and making LEDs light up! We'll start by running the <em>Hello World!</em> of Johnny-Five robotics: making an LED blink. In the process, we'll look at how to navigate the Johnny-Five and Raspi-IO API documents, and examine the event system in Johnny-Five.</p>
<p>The following topics will be covered in this chapter:</p>
<ul>
<li>Creating a project folder</li>
<li>Installing Johnny-Five and Raspi-IO</li>
<li>Wiring up an LED</li>
<li>Making an LED blink</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Technical requirements</h1>
                
            
            
                
<p>You'll need the Raspberry Pi that you set up in <a href="bab2feb9-9667-4f8b-bb2e-1702009b87b4.xhtml" target="_blank">Chapter 1</a>,<em> Setting Up Your Development Environment</em>, a breadboard, and a Pi Cobbler for easier pin access. You can get a Pi Cobbler (also sometimes called a Pi Wedge) from Adafruit, SparkFun, or Amazon. A Pi Cobbler also comes in the kits recommended in <a href="bab2feb9-9667-4f8b-bb2e-1702009b87b4.xhtml" target="_blank">Chapter 1</a>, <em>Setting Up Your Development Environment</em>.</p>
<p>The example code for this chapter is here: <a href="https://github.com/PacktPublishing/Hands-On-Robotics-with-JavaScript/tree/master/Chapter02">https://github.com/PacktPublishing/Hands-On-Robotics-with-JavaScript/tree/master/Chapter02</a>.<a href="https://github.com/PacktPublishing/Hands-On-Robotics-with-JavaScript/tree/master/Chapter02"/></p>
<p class="mce-root"/>
<p>The following diagram shows two different Raspberry Pi Cobblers, both from Adafruit. The one on the right has the ribbon cable attached:</p>
<div><img class="alignnone size-full wp-image-100 image-border" src="img/f4f36773-2aef-4571-bb61-18ec2e4a1813.png" style="width:125.00em;height:44.83em;"/></div>
<p>We'll talk about how to set up the cobbler later in this chapter. You'll also need an LED, some jumper or breadboard wires, and a 330-ohm resistor.</p>
<p>In case you're asking yourself <em>what's a resistor, and what does it do?</em>, the short explanation is that a resistor will prevent the 5V electricity from the pin from burning out your LED, which needs closer to 3.3V of electricity. For a better primer on electricity, voltage, and resistors, there is some great, free material on SparkFun's website. You can access this material via the following links:<br/>
<br/>
<strong>Electricity</strong>: <a href="https://learn.sparkfun.com/tutorials/what-is-electricity">https://learn.sparkfun.com/tutorials/what-is-electricity</a><br/>
<br/>
<strong>Resistors</strong>: <a href="https://learn.sparkfun.com/tutorials/resistors">https://learn.sparkfun.com/tutorials/resistors</a></p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a project folder</h1>
                
            
            
                
<p>I find the best way to organize your Raspberry Pi is to put each project in its own folder. In the source code that accompanies this book, I've done just that. But let's walk through how to set up your own project folders. First, you'll want to create the folder itself. For the project in this chapter, which we'll call <kbd>led-blink</kbd>, you'll want to run the following:</p>
<pre><strong>cd ~</strong><br/><strong>mkdir led-blink</strong></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mceNonEditable"/>
<p>Make sure that you're running this in your SSH session to the Raspberry Pi, and not on your desktop.</p>
<p>From here on out, unless the text directly says to run something on your desktop, you should run all of your commands in the SSH session to your Raspberry Pi that we set up in <a href="bab2feb9-9667-4f8b-bb2e-1702009b87b4.xhtml" target="_blank">Chapter 1</a>, <em>Setting Up Your Development Environment</em>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up npm to manage our modules</h1>
                
            
            
                
<p>We're going to be using more than just Johnny-Five and Raspi-IO to create our projects, and you want to be able to move your code around via your favorite Git hosting service, perhaps to move it to a new Raspberry Pi, for example. In order to make this as smooth as possible, we're going to make sure that <kbd>npm</kbd> knows how to accurately recreate your projects. For this, we want a preprepared <kbd>package.json</kbd> file. To do this, navigate into your <kbd>project</kbd> folder and tell it to initialize:</p>
<pre><strong>cd led-blink</strong><br/><strong>npm init -y</strong></pre>
<p>The <kbd>-y</kbd> in the <kbd>npm init</kbd> command tells <kbd>npm</kbd> to <em>use the default answer to all initialization questions</em>. This is fine for projects that only you will use, but if you plan to deploy your work for others to use, or create your own <kbd>npm</kbd> modules, be sure to edit your <kbd>package.json</kbd> accordingly.</p>
<p>These commands create our <kbd>package.json</kbd> so that when we install <kbd>npm</kbd> modules with <kbd>--save</kbd>, the manifest will update so that when you move your project, there's a complete record of our dependencies.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting started with Johnny-Five and Raspi-IO</h1>
                
            
            
                
<p>Now that our project folder is ready for dependencies, we'll start exploring the Johnny-Five and Raspi-IO documentation that'll help us create the projects in this book.</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Gathering resources and documentation</h1>
                
            
            
                
<p>There are two main sources of documentation that we'll be using for the projects in this book:</p>
<ul>
<li><strong>The Johnny-Five website</strong>: <a href="http://johnny-five.io/">http://johnny-five.io/</a></li>
<li><strong>The Raspi-IO GitHub README and wiki</strong>: <a href="https://github.com/nebrius/raspi-io">https://github.com/nebrius/raspi-io</a></li>
</ul>
<p>The following screenshot shows the Raspi-IO README on GitHub:</p>
<div><img src="img/a15679d1-c7c8-412b-8507-db2a1aa24ee0.png"/></div>
<p> </p>
<p>We will be using the Johnny-Five documentation at <kbd>johnny-five.io</kbd> to look up API calls and other information about the Johnny-Five library, and the Raspi-IO README for Raspberry Pi-specific information, including pin numbers.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Taking a look at the LED-blink project</h1>
                
            
            
                
<p>The first thing we'll need is from the Raspi-IO README: we're going to read and run their <kbd>led-blink</kbd> code as our <em>Hello World!</em> Let's take a look at the code as a block: </p>
<pre>const Raspi = require('raspi-io');
const five = require('johnny-five');
<br/>const board = new five.Board({
  io: new Raspi()
});

board.on('ready', () =&gt; {

  // Create an Led on pin 7 (GPIO4) on P1 and strobe it on/off
  // Optionally set the speed; defaults to 100ms
  (new five.Led('P1-7')).strobe();

});</pre>
<p>This doesn't look like much, but there's a lot going on here! The first two lines use <kbd>require</kbd> to pull in the <kbd>johnny-five</kbd> and <kbd>raspi-io</kbd> modules. Then, we begin constructing a <kbd>board</kbd> object, and we pass a new instance of the <kbd>raspi-io</kbd> module in as its I/O. This is how we tell the Johnny-Five library we're running this code on a Raspberry Pi.</p>
<p class="mce-root">Next, we'll set up an event listener on our board object on the <kbd>ready</kbd> event. According to the Johnny-Five documentation, this event fires <em>when the board</em><em> instance object has completed any hardware initialization that must take place before the program can operate</em>. This means you shouldn't run any robotics-related code outside of this event handler, because you cannot be sure your board is ready to receive hardware commands.</p>
<p>The comments starting on line 10 are very helpful, as they tell us where to hook up our LED. We'll be using pin 7 (GPIO 4)—that means the seventh physical pin from the top, which is designated as GPIO 4.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Raspberry Pi pin numbers</h1>
                
            
            
                
<p>Pin 7... is labeled GPIO 4? That's confusing! Luckily, there are many pin diagrams freely available to help us translate, as shown in the following diagram:</p>
<div><img class="alignnone size-full wp-image-747 image-border" src="img/92437148-d3d8-4694-ab4a-55750cb5f4a1.png" style="width:18.25em;height:22.83em;"/></div>
<p>A GPIO/pin map (source: raspberrypi.org)</p>
<p>Also, the Raspi-IO library will accept many names for the same pin, as shown in the handy conversion table in the wiki:</p>
<div><img src="img/9fa8d0dd-b9a9-4dd2-893a-cacc88a32ea6.png" style="width:31.25em;height:39.33em;"/></div>
<p>The pin table from the Raspi-IO wiki</p>
<p>Keeping one of these pin guides handy is helpful when wiring up any Johnny-Five project on the Raspberry Pi.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Wiring up an LED</h1>
                
            
            
                
<p>Now that we've gone through the documentation and figured out what goes where, we can start assembling our Raspberry Pi project. You'll need your Raspberry Pi, Pi Cobbler, two breadboard wires, an LED (doesn't matter what color), and a 300-ohm resistor.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Putting together and attaching the cobbler</h1>
                
            
            
                
<p>In order to make sure the cobbler is seated correctly, you'll want to make sure that the ribbon cable points outward from the Raspberry Pi when placed on the GPIO pins, and that the little tab on the side of the connector faces the right way in the cobbler itself (this is usually ensured by a plastic wall around the pins that the ribbon cable plugs into; make sure that you check that it's lined up before applying too much pressure!). </p>
<p>You'll want to seat the cobbler on a breadboard that's at least half sized, though I tend to prefer full size for Raspberry Pi projects. Make sure the two rows of pins on the cobbler are on opposite sides of the groove down the center of the breadboard, as shown in the following photograph:</p>
<p class="mce-root"/>
<div><img class="alignnone size-full wp-image-101 image-border" src="img/38dc80d7-bb23-48a6-beb6-55c3771eb298.png" style="width:100.00em;height:66.33em;"/></div>
<p>Cobblers on a full-size (top) and half-size (bottom) breadboard</p>
<p>New to breadboards? There's a great explanation of how they work (as well as some neat trivia) on the SparkFun website (<a href="https://learn.sparkfun.com/tutorials/how-to-use-a-breadboard">https://learn.sparkfun.com/tutorials/how-to-use-a-breadboard</a>).</p>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Attaching the resistor and LED</h1>
                
            
            
                
<p>You'll want to use a wire to connect GPIO 4 (pin 7) to a 330-ohm resistor and the resistor to the positive (long) leg of the LED. Then, you'll want to connect the negative (short) leg to ground, or any pin marked GND. Your finished project will look something like this:</p>
<div><img class="alignnone size-full wp-image-102 image-border" src="img/212be3a4-ccb0-4b68-b940-ea254c6bed5a.png" style="width:54.67em;height:31.00em;"/></div>
<p>Your LED project</p>
<p>Now that your LED is wired up, it's time to make it blink!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Making the LED blink</h1>
                
            
            
                
<p>In order to make the LED blink, we'll need to install the code on the Raspberry Pi, and then run it!</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Putting your code on the Raspberry Pi</h1>
                
            
            
                
<p>If you wrote your code on your desktop and need to transfer it to your Raspberry Pi, there are a couple of ways to go about it: you can use <kbd>rsync</kbd> on an macOS X or Linux machine:</p>
<pre><strong>rsync ./blink-led.js <br/>pi@raspberrypi.local:~/&lt;project folder&gt;/</strong></pre>
<p>Replace <kbd>&lt;project folder&gt;</kbd> with the folder you want to transfer into (for example, the book folder would be <kbd>hands-on-robotics-with-javascript/ch2/blink-led</kbd>).</p>
<p>For Windows, follow the guide for installing and using WinSCP at <a href="https://winscp.net/eng/docs/ui_commander">https://winscp.net/eng/docs/ui_commander</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Running your code</h1>
                
            
            
                
<p>Once your code is on your Raspberry Pi, you'll want to switch to your SSH session and run the following, if you're using the source code from this book:</p>
<pre><strong>cd hands-on-robotics-with-javascript/ch2/blink-led</strong></pre>
<p>Otherwise, use <kbd>cd</kbd> to enter the folder where you stored your <kbd>blink-led.js</kbd> file on the Raspberry Pi. Then, run the following:</p>
<pre><strong>sudo node blink-led.js</strong></pre>
<p>Note that the Raspi-IO plugin requires you to run the command as <kbd>sudo</kbd>. If all has gone well, you should see a quickly blinking LED on your breadboard. If not, here are some troubleshooting steps:</p>
<ol>
<li>Check the wiring</li>
<li>Double-check the wiring (seriously, 95% of the time it's a wiring issue)</li>
<li>Make sure that the Node.js script did not experience an error on the Raspberry Pi</li>
</ol>
<p class="mce-root"/>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>Congratulations! You've made a Johnny-Five bot! In this chapter, you've learned how to wire up an LED, navigate the documentation for Johnny-Five and Raspi-IO, and run your code on the Raspberry Pi!</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Questions</h1>
                
            
            
                
<ol>
<li>Look in the Johnny-Five documentation, under the LED heading in the section on the API. Look for the <kbd>strobe</kbd> function. What does the first argument do? What would happen if you passed 500 as that first argument?</li>
<li>What is the second argument in the <kbd>LED.strobe()</kbd> function? How would this come in handy for applications waiting for the LED to be off?</li>
<li>Does the Johnny-Five LED object emit any events? Why, or why not?</li>
<li>Using the Raspi-IO documentation, what does the Raspberry Pi pin P1-29 translate to in terms of GPIO #?</li>
<li>Using the Johnny-Five documentation, name a function that is an alias for the <kbd>LED.strobe()</kbd> function.</li>
<li>What happens before the board's <kbd>ready</kbd> event fires in a Johnny-Five application?</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Further reading</h1>
                
            
            
                
<p>You can consult the following sources for further reading related to the topics covered in this chapter:</p>
<ul>
<li><strong>The Johnny-Five documentation</strong>: <a href="http://johnny-five.io">johnny-five.io</a></li>
<li><strong>T</strong><strong>he Johnny-Five GitHub repository</strong>: <a href="https://github.com/rwaldron/johnny-five">https://github.com/rwaldron/johnny-five</a></li>
<li><strong>The Raspi-IO library</strong>: <a href="https://github.com/nebrius/raspi-io">https://github.com/nebrius/raspi-io</a></li>
</ul>


            

            
        
    </body></html>