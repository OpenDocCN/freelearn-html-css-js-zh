<html><head></head><body><div><h1 class="header-title">Validating Forms and Making HTTP Requests</h1>
                
            
            
                
<p>In this chapter, we will cover the following tasks related to creating form input validation, mocked API calls, and payment pages using Stripe:</p>
<ul>
<li>Creating a complex form with input validation</li>
<li>Creating reactive forms in Ionic</li>
<li>Retrieving data via a mocked API using a static JSON file</li>
<li>Integrating with Stripe for online payment</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Introduction</h1>
                
            
            
                
<p>All mobile apps require taking user input and sending it to a backend server. A simple example is filling out a form, such as a user registration or contact form. The information is validated against a set of rules before being sent to the backend. Also, there are many other scenarios where the information is captured based on user behavior from the app, such as where they touch or how much time they spend on a certain page. Regardless, you will run into many sending- and retrieving-data scenarios.</p>
<p>This chapter will cover the following three basic examples:</p>
<ul>
<li>How to validate user inputs, such as text, number, and required versus not required, and communicate data to another page</li>
<li>How to render data without having an actual backend</li>
<li>How to process payments using Stripe</li>
</ul>
<p>All of these are actually available natively in Angular 2. However, since Angular 2 has a lot of changes compared to Angular 1 in terms of processing data and working with the backend server, it's worth covering these topics in detail.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Creating a complex form with input validation</h1>
                
            
            
                
<p>In this section, you will build an app to demonstrate form validation using <kbd>ngForm</kbd> and <kbd>ngControl</kbd>. Here is a screenshot of the form:</p>
<div><img class="aligncenter size-full wp-image-153 image-border" src="img/d130605a-958a-46df-81ad-4f2d1038631f.png" style="width:18.83em;height:30.50em;" width="317" height="515"/></div>
<p>If the user tries to submit without providing valid information, the form will show the following error:</p>
<div><img class="aligncenter size-full wp-image-154 image-border" src="img/3d86a3f3-2630-4b02-b3a9-e792997c37e5.png" style="width:19.42em;height:34.58em;" width="313" height="559"/></div>
<p>Basically, the Name field is required. The Phone field is the number type, but is optional. The Comment field is required and the user must enter at least four characters. Of course, this is just for demonstration of the input length. The user, finally, must agree to the terms and conditions via the toggle input.</p>
<p>After a successful validation, the user will be taken to the second screen with a summary of the previous screen, as illustrated in the following screenshot:</p>
<div><img class="aligncenter size-full wp-image-155 image-border" src="img/4c255437-1338-4b90-aefa-e4a2b0162d86.png" style="width:19.50em;height:13.58em;" width="318" height="223"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This app example could work either in a browser or on a physical device. However, you can optionally connect your physical device to verify the Phone field for number keypad.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Create a new <kbd>MyFormValidation</kbd> app using the <kbd>blank</kbd> template, as shown, and go to the <kbd>MyFormValidation</kbd> folder:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start MyFormValidation blank
$ cd MyFormValidation</strong></pre>
<ol start="2">
<li>Open the <kbd>./src/app/app.module.ts</kbd> file and replace the content with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/>import { ThankyouPage } from '../pages/thankyou/thankyou';<br/>import { MyFormService } from '../services/myform';<br/><br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage,<br/>    ThankyouPage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage,<br/>    ThankyouPage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    MyFormService,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler}<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<p style="padding-left: 60px">You may realize that there is a common service to be used in the app, called <kbd>MyFormService</kbd> here. This example also has a second page, called <kbd>ThankyouPage</kbd>.</p>
<ol start="3">
<li>Now, let's create the service by first creating a directory, as shown:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ mkdir ./src/services</strong></pre>
<ol start="4">
<li>Create the <kbd>myform.ts</kbd> file in the component's directory that you just created,<br/>
as follows:</li>
</ol>
<pre style="padding-left: 60px">import { Injectable } from '@angular/core';<br/><br/>@Injectable()<br/>export class MyFormService {<br/>    public name: string = '';<br/>    public phone: number;<br/>    public comment: string = '';<br/>}</pre>
<p style="padding-left: 60px">This example will keep the service component simple for demonstration purposes.</p>
<ol start="5">
<li>Open and edit the <kbd>./src/pages/home/home.html</kbd> template, as shown:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>  &lt;ion-navbar color="primary"&gt;<br/>    &lt;ion-title&gt;<br/>      Contact Form<br/>    &lt;/ion-title&gt;<br/>  &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content&gt;<br/>  &lt;p class="center"&gt;<br/>    &lt;ion-icon class="large lighter" primary name="contact"&gt;&lt;/ion-icon&gt;<br/>  &lt;/p&gt;<br/><br/>  &lt;form #f="ngForm" novalidate (ngSubmit)="onSubmit(f)"&gt;<br/>    &lt;ion-list&gt;<br/>      &lt;ion-item&gt;<br/>        &lt;ion-label floating&gt;Name&lt;/ion-label&gt;<br/>        &lt;ion-input type="text" name="name" required <br/>        [(ngModel)]="data.name"&gt;&lt;/ion-input&gt;<br/>      &lt;/ion-item&gt;<br/>      &lt;div [hidden]="f.controls.name &amp;&amp; (f.controls.name.valid || <br/>      (f.controls.name.pristine &amp;&amp; !isSubmitted))" class="note danger"&gt;<br/>        Name is required<br/>      &lt;/div&gt;<br/><br/>      &lt;ion-item&gt;<br/>        &lt;ion-label floating&gt;Phone&lt;/ion-label&gt;<br/>        &lt;ion-input type="tel" name="phone" [(ngModel)]="data.phone"&gt;<br/>      &lt;/ion-input&gt;<br/>      &lt;/ion-item&gt;<br/><br/>      &lt;ion-item&gt;<br/>        &lt;ion-label floating&gt;Comment&lt;/ion-label&gt;<br/>        &lt;ion-input type="text" required minlength=4 name="comment" <br/>        [(ngModel)]="data.comment"&gt;<br/>        &lt;/ion-input&gt;<br/>      &lt;/ion-item&gt;<br/>      &lt;div *ngIf="(isSubmitted &amp;&amp; f.controls.comment &amp;&amp; <br/>      f.controls.comment.pristine) || ((f.controls.comment) &amp;&amp; <br/>      (f.controls.comment.dirty &amp;&amp; f.controls.comment.errors))" class="note <br/>      danger"&gt;<br/>        Please enter {{ 4 - (f.controls.comment.errors.minlength ? <br/>        f.controls.comment.errors.minlength.actualLength : 0) }} more<br/>        characters<br/>      &lt;/div&gt;<br/>      &lt;ion-item class="tos"&gt;<br/>        &lt;ion-toggle item-left [(ngModel)]="data.tos" name="tos" <br/>        type="button" (click)="noSubmit($event)"&gt;&lt;/ion-toggle&gt;<br/>        &lt;ion-label item-right&gt;Agree to terms and conditions<br/>        &lt;/ion-label&gt;<br/>      &lt;/ion-item&gt;<br/>      &lt;div [hidden]="(!isSubmitted) || (f.controls.tos &amp;&amp; data.tos)" <br/>       class="note danger"&gt;<br/>        Please check Agree!<br/>      &lt;/div&gt;<br/>    &lt;/ion-list&gt;<br/>    &lt;div class="center"&gt;<br/>      &lt;button ion-button type="submit" round outline&gt;Submit&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  &lt;/form&gt;<br/>&lt;/ion-content&gt;</pre>
<p style="padding-left: 60px">This is probably the most complicated part of the form validation process because there are many places where you have to embed validation logic for the input.</p>
<ol start="6">
<li>Open and replace the content of the <kbd>./src/pages/home/home.scss</kbd> file with the following code:</li>
</ol>
<pre style="padding-left: 60px">page-home {<br/>    .center {<br/>        text-align: center;<br/>    }<br/>    ion-icon.large {<br/>        font-size: 7em;<br/>    }<br/>    ion-icon.lighter {<br/>        opacity: 0.5;<br/>    }<br/>    ion-list &gt; .item:first-child {<br/>        border-top: 0;<br/>    }<br/>    ion-list &gt; .item:last-child, ion-list &gt; ion-itemsliding:last-child .item <br/>   {<br/>        border-bottom: 0;<br/>    }<br/>    .tos {<br/>        padding-top: 10px;<br/>        ion-toggle {<br/>            padding-left: 0px;<br/>        }<br/>        .item-inner {<br/>            border-bottom: 0;<br/>        }<br/>    }<br/>    .item ion-toggle {<br/>        padding-left: 0;<br/>    }<br/>    .note.danger {<br/>        padding-left: 16px;<br/>        color: #d14;<br/>    }<br/>}</pre>
<ol start="7">
<li>Open <kbd>./src/pages/home/home.ts</kbd> for editing with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core';<br/>import { NavController } from 'ionic-angular';<br/>import { ThankyouPage } from '../thankyou/thankyou';<br/>import { MyFormService } from '../../services/myform';<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  private data: any;<br/>  private isSubmitted: Boolean = false;<br/>  constructor(public nav: NavController, private formData:<br/>    MyFormService) {<br/>    this.nav = nav;<br/>    this.formData = formData;<br/>    this.data = {<br/>      name: '',<br/>      phone: '',<br/>      comment: '',<br/>      tos: false<br/>    }<br/>  }<br/>  onSubmit(myForm) {<br/>    this.isSubmitted = true;<br/>    console.log('onSubmit');<br/>    console.log(myForm);<br/>    if ((myForm.valid) &amp;&amp; (myForm.value.tos)) {<br/>      this.formData.name = this.data.name;<br/>      this.formData.phone = this.data.phone;<br/>      this.formData.comment = this.data.comment;<br/>      this.nav.push(ThankyouPage);<br/>    }<br/>  }<br/>  noSubmit(e) {<br/>    e.preventDefault();<br/>  }<br/>}</pre>
<p style="padding-left: 60px">You may note that there isn't much validation code in the JavaScript part. This means that the template takes care of a lot of the validations. There is also an <kbd>import</kbd> command for a <kbd>thankyou</kbd> page, which you will have to create next.</p>
<ol start="8">
<li>Now, let's create the <kbd>thankyou</kbd> folder, as follows:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ mkdir ./src/pages/thankyou<br/></strong></pre>
<ol start="9">
<li>Create a <kbd>thankyou.ts</kbd> file in the <kbd>Component</kbd>'s directory that you just created, as shown:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core';<br/>import { MyFormService } from '../../services/myform';<br/>@Component({<br/>    selector: 'page-thankyou',<br/>    templateUrl: 'thankyou.html'<br/>})<br/>export class ThankyouPage {<br/>    constructor(private formData: MyFormService) {<br/>        this.formData = formData;<br/>    }<br/>}</pre>
<p style="padding-left: 60px">This page just renders the data from the <kbd>MyFormService</kbd> service, so you can keep it very simple.</p>
<ol start="10">
<li>Create <kbd>thankyou.html</kbd> in the <kbd>./src/pages/thankyou</kbd> folder, as illustrated:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>    &lt;ion-navbar color="secondary"&gt;<br/>        &lt;ion-title&gt;<br/>            Thank You<br/>        &lt;/ion-title&gt;<br/>    &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/>&lt;ion-content&gt;<br/>    &lt;h6 class="padding"&gt;<br/>        You submitted the following information<br/>    &lt;/h6&gt;<br/>    &lt;div class="my-table"&gt;<br/>        &lt;ion-row&gt;<br/>            &lt;ion-col width-25 class="my-label"&gt;Name&lt;/ion-col&gt;<br/>            &lt;ion-col width-75&gt;{{ formData.name }}&lt;/ion-col&gt;<br/>        &lt;/ion-row&gt;<br/>        &lt;ion-row&gt;<br/>            &lt;ion-col width-25 class="my-label"&gt;Phone&lt;/ion-col&gt;<br/>            &lt;ion-col width-75&gt;{{ formData.phone }}&lt;/ion-col&gt;<br/>        &lt;/ion-row&gt;<br/>        &lt;ion-row&gt;<br/>            &lt;ion-col width-25 class="my-label"&gt;Comment&lt;/ion-col&gt;<br/>            &lt;ion-col width-75&gt;{{ formData.comment }}&lt;/ion-col&gt;<br/>        &lt;/ion-row&gt;<br/>    &lt;/div&gt;<br/>&lt;/ion-content&gt;</pre>
<ol start="11">
<li>Create <kbd>thankyou.scss</kbd> in the <kbd>./src/pages/thankyou</kbd> folder, as shown:</li>
</ol>
<pre style="padding-left: 60px">page-thankyou {<br/>    h6.padding {<br/>        color: #4C555A;<br/>        padding: 10px;<br/>    }<br/>    .my-label {<br/>        text-align: right;<br/>        font-weight: bold;<br/>    }<br/>    .my-table {<br/>        ion-row {<br/>            color: #4C555A;<br/>            padding: 0;<br/>            height: 30px;<br/>        }<br/>        ion-row + ion-row {<br/>            margin-top: 0;<br/>        }<br/>        ion-row:nth-child(odd) ion-col {<br/>            background: #F9FAFB;<br/>        }<br/>    }<br/>}</pre>
<ol start="12">
<li>Go to your Terminal and run the app with the following command:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic serve</strong></pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Let's start with the <kbd>home.html</kbd> file, where most of the validation code is located. If you look at the structure of this page, it's very typical. You have <kbd>&lt;ion-navbar&gt;</kbd> with <kbd>&lt;ion-title&gt;</kbd>. The <kbd>&lt;form&gt;</kbd> element must be inside the <kbd>&lt;ion-content&gt;</kbd> area.</p>
<p>It's a requirement to use the <kbd>&lt;form&gt;</kbd> element for Angular validation to work. Otherwise, there will be no <kbd>submit</kbd> event and you cannot catch errors for each input.</p>
<p><kbd>form</kbd> has the following attributes:</p>
<pre>&lt;form #f="ngForm" novalidate (ngSubmit)="onSubmit(f)"&gt; </pre>
<p>To assign a local variable on the fly, you use the <kbd>#</kbd> sign. This means that you want the <kbd>f</kbd> variable to refer to <kbd>ngForm</kbd>, which is automatically created by Angular. This is a special object that contains everything related to the current form. You are advised to use <kbd>novalidate</kbd> to bypass the default HTML5 validation because you are using Angular for validation instead. Otherwise, the <kbd>form</kbd> will acquire conflicts. The <kbd>(ngSubmit)</kbd> is pretty much an event to trigger the <kbd>onSubmit(f)</kbd> function whenever the <kbd>button</kbd> with <kbd>type=submit</kbd> is touched or clicked. When you submit the form, it will pass the <kbd>f</kbd> variable along so that you can process the object inside the <kbd>onSubmit</kbd> method.</p>
<p>The <kbd>form</kbd> template consists of just <kbd>&lt;ion-list&gt;</kbd> and <kbd>&lt;ion-item&gt;</kbd>. You just need to know how to validate each input and display the error. Let's use the <kbd>Name</kbd> field as the first example. This is the <kbd>&lt;ion-input&gt;</kbd> for <kbd>Name</kbd>:</p>
<pre>&lt;ion-input type="text" name="name" required [(ngModel)]="data.name"&gt;&lt;/ion-input&gt; </pre>
<p>The following is the error displayed:</p>
<pre>&lt;div [hidden]="f.controls.name &amp;&amp; (f.controls.name.valid || (f.controls.name.pristine &amp;&amp; !isSubmitted))" class="note danger"&gt; 
  Name is required 
&lt;/div&gt;</pre>
<p>To validate, you must assign <kbd>name</kbd> a local variable name. This is to refer to that input using <kbd>f.controls.name</kbd> in other areas. Recall that the <kbd>f</kbd> variable has been declared previously as the <kbd>ngForm</kbd> object. Here is a view of how the <kbd>ngForm</kbd> is structured:</p>
<div><img class="aligncenter size-full wp-image-156 image-border" src="img/e37a2771-75c9-4454-a907-e70d34054853.png" style="width:27.58em;height:22.25em;" width="404" height="326"/></div>
<p>You can view this using the Chrome Developer console because the code actually gives this output when you submit the form.</p>
<p>The error message <kbd>Name is required</kbd> will be hidden when either of the following conditions takes place:</p>
<ul>
<li>The form has not been submitted yet. Otherwise, people will see the error message right away before they even type in something. This is not a good user experience. To check for this, you have to use a temporary Boolean, called <kbd>isSubmitted</kbd>. The <kbd>f.controls.name.pristine</kbd> variable means that the input has not been modified. The opposite of this would be <kbd>f.controls.name.dirty</kbd>.</li>
<li>The <kbd>f.controls.name.valid</kbd> variable is <kbd>true</kbd>. However, you cannot check this right away because, if the input is empty, the <kbd>name</kbd> object does not exist yet. That's why you need to check for the existence of <kbd>f.controls.name</kbd> before checking for the <kbd>valid</kbd> Boolean.</li>
</ul>
<p>There is no need to check the phone requirement; so, you just need to assign <kbd>name</kbd> and a model, as shown:</p>
<pre>&lt;ion-input type="tel" name="phone" [(ngModel)]="data.phone"&gt;&lt;/ion-input&gt; </pre>
<p>For the <kbd>comment</kbd> field, you need to validate using both <kbd>required</kbd> and <kbd>minlength=4</kbd>, as follows:</p>
<pre>&lt;ion-input type="text" required minlength=4 name="comment" [(ngModel)]="data.comment"&gt;&lt;/ion-input&gt; </pre>
<p>You may think <kbd>required</kbd> is unnecessary because, if the length is zero, Angular will trigger an error flag. However, that is not true. When the user doesn't enter anything in the input, the input will have no length because the variable doesn't exist. That's why you need to check for both scenarios.</p>
<p>The error message for the <kbd>comment</kbd> field is quite interesting because it shows the number of characters the user needs to enter, as shown in the following code:</p>
<pre>&lt;div *ngIf="(isSubmitted &amp;&amp; f.controls.comment &amp;&amp; <br/> f.controls.comment.pristine) || ((f.controls.comment) &amp;&amp; <br/> (f.controls.comment.dirty &amp;&amp; f.controls.comment.errors))" <br/> class="note danger"&gt; Please enter {{ 4 - (f.controls.comment.errors.minlength <br/> ? <br/> f.controls.comment.errors.minlength.actualLength : 0) }} more <br/> characters 
&lt;/div&gt; </pre>
<p>The main idea here is that you only want to show this <kbd>div</kbd> when the form is submitted and it's pristine via <kbd>f.controls.comment.pristine</kbd>. This means that the user has not entered anything in the form. You also want to show the message when the form is dirty and has errors via <kbd>f.controls.comment.errors</kbd>. If you inspect the console, you can see a list of many detailed errors under the <kbd>f.controls.comment.errors</kbd> object. In order to tell the user how many characters they have left to enter, you have to first check <kbd>f.controls.comment.errors.minlength</kbd> because, if that variable doesn't exist, there is no error or the <kbd>comment</kbd> input is empty. If you do not check for this, you will get a parse error later on.</p>
<p>In your <kbd>home.ts</kbd> file, the <kbd>onSubmit</kbd> method must toggle the <kbd>isSubmitted</kbd> Boolean to <kbd>true</kbd>, as shown in the following code snippet:</p>
<pre>onSubmit(myForm) { 
  this.isSubmitted = true; 
  console.log('onSubmit'); 
  console.log(myForm); 
   
  if ((myForm.valid) &amp;&amp; (myForm.value.tos)) { 
    this.formData.name = this.data.name; 
    this.formData.phone = this.data.phone; 
    this.formData.comment = this.data.comment; 
    this.nav.push(ThankyouPage); 
  } 
} </pre>
<p>Then, you have to do a general check for <kbd>myForm.valid</kbd> and <kbd>myForm.value.tos</kbd>. You may wonder why we are checking for <kbd>tos</kbd> here instead of validating it inside the template. The reason is that there is no way to validate a toggle button in Angular since it doesn't make sense to do so as it cannot be <kbd>required</kbd>. Therefore, you have to do a custom validation here to make sure it's <kbd>true</kbd> in the form. This means that the user has checked the Agree to terms and conditions toggle.</p>
<p>Refer to the W3 website, at <a href="https://www.w3.org/TR/2011/WD-html5-20110525/the-button-element.html">https://www.w3.org/TR/2011/WD-html5-20110525/the-button-element.html</a> , for information about the default behavior of the <a href="https://www.w3.org/TR/2011/WD-html5-20110525/the-button-element.html"><kbd>button</kbd></a> element.</p>
<p>The <kbd>thankyou</kbd> page is very self-explanatory because you just parse the <kbd>formData</kbd> object in the template by getting the data from the <kbd>MyFormService</kbd> service.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">See also</h1>
                
            
            
                
<p>Check out the following links for more information:</p>
<ul>
<li>For more information about <kbd>form</kbd> from the Angular 2 documentation, you can visit <a href="https://angular.io/docs/ts/latest/guide/forms.html" target="_blank">https://angular.io/docs/ts/latest/guide/forms.html</a> and <a href="https://angular.io/docs/ts/latest/api/forms/index/NgForm-directive.html">https://angular.io/docs/ts/latest/api/forms/index/NgForm-directive.html</a><a href="https://angular.io/docs/ts/latest/api/forms/index/NgForm-directive.html"/></li>
<li>The Ionic documentation has its own page specifically for Ionic input components, which is at <a href="https://ionicframework.com/docs/v2/resources/forms/">https://ionicframework.com/docs/v2/resources/forms/</a><a href="https://ionicframework.com/docs/v2/resources/forms/"/></li>
<li>It also has a good list of HTML5 input types that you can use for validation or keyboard enforcement, which you can find at <a href="http://ionicframework.com/html5-input-types/">http://ionicframework.com/html5-input-types/</a><a href="http://ionicframework.com/html5-input-types/"/></li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Creating reactive forms in Ionic</h1>
                
            
            
                
<p>In the previous example, we have created a complex form with validations. If you notice carefully, we used angular validations inside our template file, particularly in <kbd>home.html</kbd>. These type of forms are called as template driven form, where most of the work is done on template side. This is something very similar to what we had in AngularJS.</p>
<p>There is another type of form in Angular, called the reactive form. The difference is, in reactive forms, we used validations and other configuration inside the class of the component, instead of in the template. The following is the definition from Angular Docs:</p>
<p>"With <em>reactive</em> forms, you create a tree of Angular form control objects in the component class and bind them to native form control elements in the component template."</p>
<p>We will create a registration form, which looks like the following:</p>
<div><img src="img/a027786a-3c9e-45c4-9891-82b01d23fe43.png" style="width:18.50em;height:33.08em;" width="366" height="654"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>Since we are using forms, we only require a web browser to run this recipe.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open Terminal (or Command Prompt) and create a new app named <kbd>ReactiveForm</kbd> based on <kbd>blank</kbd> template and go into the folder as follows:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start ReactiveForm blank</strong><br/><strong>$ cd ReactiveForm</strong></pre>
<ol start="2">
<li>Open <kbd>home.html</kbd> and replace the file with following content:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>&lt;ion-navbar color="primary"&gt;<br/>&lt;ion-title&gt;<br/>Reactive Form<br/>&lt;/ion-title&gt;<br/>&lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content padding&gt;<br/>&lt;p class="center"&gt;<br/>&lt;ion-icon class="large lighter" primary name="contact"&gt;&lt;/ion-icon&gt;<br/>&lt;/p&gt; <br/>&lt;form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate&gt;<br/>&lt;ion-list&gt;<br/>&lt;ion-item&gt;<br/>&lt;ion-label floating&gt;Username&lt;/ion-label&gt;<br/>&lt;ion-input type="text" formControlName="username"&gt;&lt;/ion-input&gt;<br/>&lt;/ion-item&gt;<br/>&lt;ion-item&gt;<br/>&lt;ion-label floating&gt;Email&lt;/ion-label&gt;<br/>&lt;ion-input type="email" formControlName="email"&gt;&lt;/ion-input&gt;<br/>&lt;/ion-item&gt;<br/><br/>&lt;ion-item&gt;<br/>&lt;ion-label floating&gt;Password&lt;/ion-label&gt;<br/>&lt;ion-input type="password" formControlName="pass"&gt;&lt;/ion-input&gt;<br/>&lt;/ion-item&gt;<br/><br/>&lt;ion-item&gt;<br/>&lt;ion-label floating&gt;Confirm Password&lt;/ion-label&gt;<br/>&lt;ion-input type="password" formControlName="repass"&gt;&lt;/ion-input&gt;<br/>&lt;/ion-item&gt;<br/><br/>&lt;ion-item text-wrap class="error"&gt;<br/>&lt;div *ngIf="registerForm.controls['username'].dirty &amp;&amp; registerForm.controls['username'].invalid"&gt;<br/>Username should at least have 10 Characters.<br/>&lt;/div&gt;<br/>&lt;div *ngIf="registerForm.controls['email'].dirty &amp;&amp; registerForm.controls['email'].invalid"&gt;<br/>Email is incorrect.<br/>&lt;/div&gt;<br/>&lt;div *ngIf="registerForm.controls['pass'].dirty &amp;&amp; registerForm.controls['pass'].invalid"&gt;<br/>Password should be 8 Character long.<br/>&lt;/div&gt;<br/>&lt;div *ngIf="registerForm.controls['repass'].dirty &amp;&amp; registerForm.controls['repass'].invalid"&gt;<br/>Choose same password in confirm password field.<br/>&lt;/div&gt;<br/>&lt;/ion-item&gt;<br/>&lt;/ion-list&gt;<br/>&lt;button ion-button full type="submit" [disabled]="registerForm.invalid"&gt;Register&lt;/button&gt;<br/>&lt;/form&gt;<br/>      <br/>&lt;/ion-content&gt;</pre>
<ol start="3">
<li>Open the <kbd>home.scss</kbd> file and replace the content with the following:</li>
</ol>
<pre style="padding-left: 60px">page-home {<br/> .center {<br/> text-align: center;<br/> }<br/> ion-icon.large {<br/> font-size: 7em;<br/> }<br/> ion-icon.lighter {<br/> opacity: 0.5;<br/> }<br/> .error {<br/> color: red;<br/> }<br/>}</pre>
<ol start="4">
<li>Open the <kbd>home.ts</kbd> file and replace the content with the following:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core';<br/>import { FormBuilder, FormGroup, Validators } from '@angular/forms';<br/>import { NavController, AlertController } from 'ionic-angular';<br/>import { confirmPassword } from "../../app/confirmPassword";<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  registerForm:FormGroup;<br/> <br/>  constructor(public navCtrl: NavController, private fb:FormBuilder, <br/>    private alertCtrl: AlertController) {<br/>    this.registerForm = this.fb.group({<br/>      username: ['', [Validators.required, Validators.minLength(10)]],<br/>      email: ['', [Validators.required, Validators.email]],<br/>      pass: ['', [Validators.required, Validators.minLength(8)]],<br/>      repass: ['', [Validators.required, Validators.minLength(8)]],<br/>    }, {<br/>      validator: confirmPassword('pass', 'repass')<br/>    });<br/>  }<br/><br/>  onSubmit() {<br/>    this.alertCtrl.create({<br/>      title: 'Your inputs are:',<br/>      message: JSON.stringify(this.registerForm.value),<br/>      buttons: ['Dismiss']<br/>    })<br/>    .present();<br/>    console.log(this.registerForm);<br/>  }<br/><br/>}</pre>
<p style="padding-left: 60px">Since, in our example, we have the registration form with the password and confirm password fields, we will be creating a custom validator for making sure that both fields have some values.</p>
<ol start="5">
<li>Create a file named <kbd>confirmPassword.ts</kbd> in <kbd>/app</kbd> folder. Then add the following content inside it:</li>
</ol>
<pre style="padding-left: 60px">import { FormGroup } from '@angular/forms';<br/><br/>export function confirmPassword(passwordKey: string, passwordConfirmationKey: string) {<br/>    return (group: FormGroup) =&gt; {<br/>      let passwordInput = group.controls[passwordKey],<br/>          passwordConfirmationInput = <br/>          group.controls[passwordConfirmationKey];<br/>      if (passwordInput.value !== passwordConfirmationInput.value) {<br/>        return passwordConfirmationInput.setErrors({notEquivalent: true})<br/>      }<br/>      else {<br/>          return passwordConfirmationInput.setErrors(null);<br/>      }<br/>    }<br/>  }</pre>
<ol start="6">
<li>Make sure your <kbd>app.module.ts</kbd> has the following content:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/><br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler}<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<ol start="7">
<li>Open the Terminal and run the following command :</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic serve</strong></pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Since this recipe uses reactive forms, let's first take a look at <kbd>home.ts</kbd>, which initializes and sets up our form.</p>
<p>In the <kbd>HomePage</kbd> class, we have <kbd>registerForm:FormGroup</kbd> property, which is the collection of <kbd>FormControl</kbd>. Each <kbd>FormControl</kbd> is bound to the native <kbd>FormControl</kbd> in our template. In order to create <kbd>FormGroup</kbd>, we can do something like the following:</p>
<pre>this.myForm = new FormGroup({<br/> first: new FormControl('Nancy', Validators.minLength(2)),<br/> last: new FormControl('Drew'),<br/>});</pre>
<p>In the preceding example, we are creating a <kbd>FormGroup</kbd> named <kbd>myForm</kbd>. The <kbd>FormGroup</kbd> constructor takes an object as input, which is the collection of <kbd>FormControl</kbd>. Each key in this object refers to some native <kbd>FormControl</kbd> in the template. The value in the key pair is a <kbd>FormControl</kbd> object. The <kbd>FormControl</kbd> constructor takes the initial value and a validator or array of validators as input. The template will look something like this:</p>
<pre>&lt;form formGroup="myForm" novalidate&gt;<br/> &lt;input type="text" formControlName="first"/&gt;<br/> &lt;input type="text" formControlName="last" /&gt;<br/>&lt;/form&gt;</pre>
<p>Here, <kbd>formControlName</kbd> is set to the key of <kbd>FormControl</kbd>; for example, <kbd>first</kbd>. <kbd>formGroup</kbd> is set to the name of the group; in this example, it is <kbd>myForm</kbd>.</p>
<p>However, this method becomes complicated if we have nested <kbd>FormGroup</kbd>. To ease this process, Angular provides a better API via <kbd>FormBuilder</kbd>. <kbd>FormBuilder</kbd> is class, which allow us to create <kbd>FormGroup</kbd> via a really nice API. Take a look:</p>
<pre>this.registerForm = this.fb.group({<br/> username: ['', [Validators.required, Validators.minLength(10)]],<br/> email: ['', [Validators.required, Validators.email]],<br/> pass: ['', [Validators.required, Validators.minLength(8)]],<br/> repass: ['', [Validators.required, Validators.minLength(8)]],<br/> }, {<br/> validator: confirmPassword('pass', 'repass')<br/>});</pre>
<p><kbd>this.fb</kbd> is an instance of <kbd>FormBuilder</kbd> and has a <kbd>group</kbd> method to create <kbd>FormGroup</kbd>. It takes an object with a key-value pair. The key is used with <kbd>formControlName</kbd> to bind to the native element in the template and the value is an array with the initial value of the native element and a list of validators. For example, <kbd>username</kbd> has <kbd>required</kbd> and <kbd>minLength(10)</kbd> validators; similarly, other fields have validations too. You may notice that there is no <kbd>FormControl</kbd> constructor here. This is the abstraction provided by <kbd>FormBuilder</kbd>.</p>
<p>You can also pass group-level validator as a second input to the <kbd>group</kbd> method of <kbd>FormBuilder</kbd>. In the preceding example, we are using a custom <kbd>confirmPassword</kbd> validator with inputs <kbd>pass</kbd> and <kbd>repass</kbd>. These are keys inside the first object and refer to input fields; the validator makes sure that they are equal.</p>
<p>Our custom validator is created in the <kbd>confirmPassword.ts</kbd> file, as follows:</p>
<pre>export function confirmPassword(passwordKey: string, passwordConfirmationKey: string) {<br/> return (group: FormGroup) =&gt; {<br/>     let passwordInput = group.controls[passwordKey],<br/>     passwordConfirmationInput = group.controls[passwordConfirmationKey];<br/>     if (passwordInput.value !== passwordConfirmationInput.value) {<br/>         return passwordConfirmationInput.setErrors({notEquivalent: true})<br/>     }<br/>     else {<br/>         return passwordConfirmationInput.setErrors(null);<br/>     }<br/> }<br/>}</pre>
<p>It is just a function that takes two string type arguments. These are the names of the two fields that we want to compare. It compares the values in both fields and sets the validation on the <kbd>repass</kbd> (a.k.a confirm password) field accordingly.</p>
<p>In <kbd>home.html</kbd>, we have form element which looks like following:</p>
<div><pre>&lt;form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate&gt;</pre></div>
<p><kbd>[formGroup]</kbd> is set to <kbd>registerForm</kbd>, and when the user clicks on the submit button, it fires the <kbd>onSubmit</kbd> method.</p>
<p>Each input is configured as follows:</p>
<pre> &lt;ion-item&gt;<br/>   &lt;ion-label floating&gt;Username&lt;/ion-label&gt;<br/>   &lt;ion-input type="text" formControlName="username"&gt;&lt;/ion-input&gt;<br/> &lt;/ion-item&gt;</pre>
<p>We also show error messages, since we use validators in our form. Here is how we show validation error messages. We check whether the field is <kbd>dirty</kbd> or <kbd>invalid</kbd> and then show the appropriate error. <kbd>formName.controls['controlName']</kbd> is the syntax to get control. Here, <kbd>formName</kbd> is the name of <kbd>formGroup</kbd> and <kbd>controlName</kbd> is the name of the control:</p>
<pre>&lt;ion-item text-wrap class="error"&gt;<br/> &lt;div *ngIf="registerForm.controls['username'].dirty &amp;&amp; registerForm.controls['username'].invalid"&gt;<br/> Username should at least have 10 Characters.<br/> &lt;/div&gt;<br/> &lt;div *ngIf="registerForm.controls['email'].dirty &amp;&amp; registerForm.controls['email'].invalid"&gt;<br/> Email is incorrect.<br/> &lt;/div&gt;<br/> &lt;div *ngIf="registerForm.controls['pass'].dirty &amp;&amp; registerForm.controls['pass'].invalid"&gt;<br/> Password should be 8 Character long.<br/> &lt;/div&gt;<br/> &lt;div *ngIf="registerForm.controls['repass'].dirty &amp;&amp; registerForm.controls['repass'].invalid"&gt;<br/> Choose same password in confirm password field.<br/> &lt;/div&gt;<br/> &lt;/ion-item&gt;</pre>
<p>Errors look something like this:</p>
<div><img src="img/ab4bd704-40d7-4e6a-88b0-886abfbd5fd3.png" style="width:20.00em;height:35.67em;" width="366" height="653"/></div>
<p>At last, we have Register button, which has following code:</p>
<div><pre>&lt;button ion-button full type="submit" [disabled]="registerForm.invalid"&gt;Register&lt;/button&gt;</pre></div>
<p>We disable the button when the form is invalid. When the user clicks on it, it calls the <kbd>onSubmit</kbd> method and we show an alert box with the user's input, as shown in the following code:</p>
<pre>onSubmit() {<br/> this.alertCtrl.create({<br/>     title: 'Your inputs are:',<br/>     message: JSON.stringify(this.registerForm.value),<br/>     buttons: ['Dismiss']<br/> })<br/> .present();<br/>  console.log(this.registerForm);<br/> }</pre>
<p>The alert message looks like the following:</p>
<div><img src="img/e8a04494-3f7f-4eec-bccc-f01d9f9fcb4b.png" style="width:18.00em;height:32.08em;" width="367" height="655"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">See also</h1>
                
            
            
                
<ul>
<li>For further reading about reactive forms, go to Angular's Guide on reactive forms at <a href="https://angular.io/guide/reactive-forms" target="_blank">https://angular.io/guide/reactive-forms</a><a href="https://angular.io/guide/reactive-forms" target="_blank"/></li>
<li>There is an excellent article written by Todd Moto on reactive forms at <a href="https://toddmotto.com/angular-2-forms-reactive" target="_blank">https://toddmotto.com/angular-2-forms-reactive</a><a href="https://toddmotto.com/angular-2-forms-reactive"/></li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Retrieving data via a mocked API using a static JSON file</h1>
                
            
            
                
<p>As a frontend and app developer, you are often working with a team where someone else is responsible for the backend APIs. However, it's not always possible to have the backend available when you are developing the frontend. You have to simulate the backend in scenarios where the final backend APIs are not ready.</p>
<p>In this recipe, you will learn how to call a REST API using the <kbd>HttpClient</kbd> service. The API endpoint will be just a static JSON located on your local machine. You will also learn how to leverage placeholder images to meet design requirements. The app will show a list of image feeds and a description, as shown in the following screenshot:</p>
<div><img class="aligncenter size-full wp-image-157 image-border" src="img/85cbfe58-7f0c-4ca2-96a8-78bb23f08494.png" style="width:17.83em;height:31.75em;" width="314" height="560"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This app example would work either in a browser or on a physical device. However, the fake backend server must be running on your local computer.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>First, let's quickly create the fake backend server. You must install <kbd>http-server</kbd><br/>
for this:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ sudo npm install -g http-server</strong></pre>
<ol start="2">
<li>Create a folder to store your <kbd>.json</kbd> file. Let's call it <kbd>MockRest</kbd>, as shown:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ mkdir MockRest
$ cd MockRest</strong></pre>
<ol start="3">
<li>Create the <kbd>test.json</kbd> file and fill in the following content for the REST response:</li>
</ol>
<pre style="padding-left: 60px">[ 
  { 
    "title": "What a beautiful song", 
    "category": "objects", 
    "description": "Music is a moral law. It gives soul to the universe, wings to the mind, flight to the imagination, and charm and gaiety to life and to everything." 
  }, 
  { 
    "title": "The world we live in", 
    "category": "nature", 
    "description": "Look deep into nature, and then you will understand everything better." 
  }, 
  { 
    "title": "Life experiences", 
    "category": "people", 
    "description": "People who know little are usually great talkers, while <br/>    men who know much say little." 
  } 
]</pre>
<p style="padding-left: 60px">Basically, whenever you send a REST request, you should receive the preceding content as the response. As your backend developer updates the REST response, you can always change the content of the <kbd>test.json</kbd> file accordingly.</p>
<ol start="4">
<li>Start your backend server by calling <kbd>http-server</kbd> from the Terminal in the <kbd>MockRest</kbd> folder, as shown:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ http-server --cors=Access-Control-Allow-Origin</strong><br/></pre>
<div><p style="padding-left: 60px">Go to your browser and visit <kbd>http://localhost:8080/test.json</kbd> to verify that you can see the JSON content. If not, you probably have a port conflict with another web server. You need to ensure that there is no other application using port <kbd>8080</kbd>. After completing your backend, open another Terminal window, create a new <kbd>MyRestBackend</kbd> app using the <kbd>blank</kbd> template, and go to the <kbd>MyRestBackend</kbd> folder, as shown:</p>
</div>
<div><pre style="padding-left: 30px"><strong>$ ionic start MyRestbackend blank
$ cd MyRestbackend</strong></pre></div>
<p>You must not stop the backend server or create an Ionic project inside the <kbd>MockRest</kbd> folder. They are two independent project folders</p>
<ol start="5">
<li>Open the <kbd>home.html</kbd> file and replace the content with the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>  &lt;ion-navbar&gt;<br/>    &lt;ion-title&gt;<br/>      Home<br/>    &lt;/ion-title&gt;<br/>  &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content padding&gt;<br/>  &lt;ion-card #myCard *ngFor="let item of quotes.data"&gt;<br/>    &lt;img [src]='"https://source.unsplash.com/category/" + item.category + "/600x390"' [height]="myCard.clientWidth * 390 / 600" /&gt;<br/>    &lt;ion-card-content&gt;<br/>      &lt;ion-card-title&gt;<br/>        {{ item.title }}<br/>      &lt;/ion-card-title&gt;<br/>      &lt;p&gt;<br/>        {{ item.description }}<br/>      &lt;/p&gt;<br/>    &lt;/ion-card-content&gt;<br/>  &lt;/ion-card&gt;<br/>&lt;/ion-content&gt;</pre>
<p style="padding-left: 60px">This example uses free photos from <a href="https://source.unsplash.com/" target="_blank">https://source.unsplash.com/</a> because you can easily query to get random photos that meet your need.</p>
<ol start="6">
<li>Open <kbd>home.ts</kbd> and edit it with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core';<br/>import { NavController } from 'ionic-angular';<br/>import { QuoteService } from '../../services/quote';<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  constructor(public navCtrl: NavController, public quotes:QuoteService) {<br/>    this.quotes = quotes;<br/>    this.quotes.getQuotes();<br/>  }<br/>}</pre>
<p style="padding-left: 60px">You have not created the <kbd>QuoteService</kbd> service yet. However, you probably know that this service will call the fake backend server to get the JSON content using the <kbd>getQuotes()</kbd> method.</p>
<ol start="7">
<li>Do a small modification of the stylesheet <kbd>home.scss</kbd>, as follows:</li>
</ol>
<pre style="padding-left: 60px">page-home {<br/>    ion-card {<br/>        img {<br/>            background-color: #f4f4f4;<br/>        }<br/>    }<br/>}</pre>
<ol start="8">
<li>Create the <kbd>./src/services</kbd> folder with the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>$ mkdir ./src/services</strong></pre>
<ol start="9">
<li>Create the <kbd>quote.ts</kbd> file in the <kbd>services</kbd> folder and copy the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Injectable } from '@angular/core';<br/>import { HttpClient } from '@angular/common/http';<br/>@Injectable()<br/>export class QuoteService {<br/>    private http: any;<br/>    public data: any;<br/>    constructor(http: HttpClient) {<br/>        this.http = http;<br/>    }<br/>    getQuotes() {<br/>        this.http.get("http://localhost:8080/test.json")<br/>            .subscribe(res =&gt; {<br/>                this.data = res;<br/>                console.log(this.data, this.http);<br/>            }, error =&gt; {<br/>                console.log(error);<br/>            });<br/>    }<br/>}</pre>
<ol start="10">
<li>Open and edit <kbd>./src/app/app.module.ts</kbd> to declare <kbd>QuoteService</kbd>, as shown:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { HttpClientModule } from '@angular/common/http';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/>import { QuoteService } from '../services/quote'<br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    HttpClientModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    QuoteService,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler}<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<ol start="11">
<li>Go to your Terminal and run the app, as illustrated:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic serve </strong></pre>
<ol start="12">
<li>You will note that the page is empty and the Console shows the following error:</li>
</ol>
<div><img class="aligncenter size-full wp-image-158 image-border" src="img/470ac180-d007-45a7-8617-d5770614fb03.png" style="width:32.50em;height:19.17em;" width="390" height="230"/></div>
<p style="padding-left: 60px"/>
<p style="padding-left: 60px">This means that your browser (in this case, Chrome) does not allow calling REST API from <kbd>http://localhost:8100</kbd> to <kbd>http://localhost:8080</kbd>. You need to install the Allow-<strong>Control-Allow-Origin</strong> (<strong>CORS</strong>) plugin, such as <a href="https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?hl=en" target="_blank">https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?hl=en</a>, for Chrome. After that, turn on CORS, as shown in the following screenshot:</p>
<div><img class="aligncenter size-full wp-image-159 image-border" src="img/cf08655c-c9d4-4922-88ad-9ee0bddf9bc4.png" style="width:24.42em;height:26.00em;" width="399" height="426"/></div>
<p>Refresh your browser to see the updated app.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Your fake backend simply returns any file in the current <kbd>MockRest</kbd> folder. As you get more sample responses from the backend developer, you can copy them into this folder to provide additional backend endpoints.</p>
<p>This section does not provide examples of how to handle POST and complex scenarios where the responses depend on request parameters. You may want to keep the code to handle temporary cases as simple as possible since they are not production code. The recommendation is to return the same content for each POST request as well.</p>
<p>Let's take a look at <kbd>quote.ts</kbd>, because it's the main place where the <kbd>Http</kbd> request is made. First, you need to import <kbd>Injectable</kbd> and <kbd>Http</kbd>, which you can do as follows:</p>
<pre>import {Injectable} from '@angular/core'; 
import {Http} from '@angular/http';</pre>
<p>The <kbd>@Injectable</kbd> decorator is used to allow other pages and components to use <kbd>QuoteService</kbd> as a dependency. The <kbd>Http</kbd> service (or class) is provided by Angular (not Ionic) and this is similar to the <kbd>$http</kbd> provider in Angular 1. However, instead of returning a promise, <kbd>Http</kbd> will return an <strong>observable</strong> object so that you can <em>subscribe</em> to it. The <kbd>getQuotes()</kbd> method, shown as follows, is the most important part of this file:</p>
<pre>  getQuotes() { 
    this.http.get("http://localhost:8080/test.json") 
      .subscribe(res =&gt; { 
        this.data = res.json(); 
        console.log(this.data); 
      }, error =&gt; { 
        console.log(error); 
      }); 
  } </pre>
<p>The <kbd>this.http</kbd> object must be injected from the constructor. Then, it will trigger GET via <kbd>this.http.get()</kbd>, just like the <kbd>$http</kbd> provider. However, there is no <kbd>.then()</kbd> function but in Angular 2; you have to <kbd>subscribe</kbd> to the object. A new feature of ES6 is the arrow function, as you see via <kbd>res =&gt; {}</kbd>. This is similar to the lambda function in other languages (for example, Python). There is no need to declare the name of the function and you don't have to type function each time. In addition, it automatically passes the parameter (<kbd>res</kbd> in this case) and the <kbd>this</kbd> context inside the function.</p>
<p>You can read more about the arrow function from TypeScript documentation at <a href="https://www.typescriptlang.org/docs/handbook/functions.html" target="_blank">https://www.typescriptlang.org/docs/handbook/functions.html</a>.</p>
<p>The REST response from your fake backend will be assigned to <kbd>this.data</kbd> of the <kbd>QuoteService</kbd> service, as shown:</p>
<pre>this.data = JSON.parse(res._body); </pre>
<p>If you see the browser console, it will look similar to the following screenshot:</p>
<div><img class="aligncenter size-full wp-image-160 image-border" src="img/7616ddb3-4526-463d-a982-3d15804eaf8b.png" style="width:65.92em;height:25.67em;" width="791" height="308"/></div>
<p>Another nice trick in the <kbd>home.html</kbd> template is to display a gray placeholder for the photos instead of pushing down the content when the photos are downloaded and rendered, as shown in the following code snippet:</p>
<pre>&lt;ion-card #myCard *ngFor="let item of quotes.data"&gt; 
    &lt;img [src]='"https://source.unsplash.com/category/" + item.category + "/600x390"' [height]="myCard.clientWidth * 390 / 600"/&gt; </pre>
<p>The following screenshot shows a quick example before the photos are loaded:</p>
<div><img class="aligncenter size-full wp-image-161 image-border" src="img/fe50cf51-c15f-4370-9f36-8cdfd53829f6.png" style="width:17.17em;height:30.50em;" width="313" height="557"/></div>
<p>In order to tell the <kbd>&lt;img&gt;</kbd> tag to have an exact size, you have to do a height calculation using <kbd>[height]="myCard.clientWidth * 390 / 600"</kbd>. This is because the photo is 600 x 390. The <kbd>myCard</kbd> object is a local object created from <kbd>ion-card</kbd>. This <kbd>myCard</kbd> object will have access to all properties of the <kbd>ion-card</kbd> DOM, including the width via <kbd>clientWidth</kbd>. You have probably noted that this is just pure JavaScript and has nothing to do with Ionic or Angular itself.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">See also</h1>
                
            
            
                
<p>For more information about the Angular <kbd>Http</kbd> provider, you can visit the official documentation at <a href="https://angular.io/docs/ts/latest/api/http/index/HttpModule-class.html">https://angular.io/docs/ts/latest/api/http/index/HttpModule-class.html</a>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Integrating with Stripe for online payment</h1>
                
            
            
                
<p>In this section, you will learn how to integrate with a real backend service for the payment process. Earning revenue is an important aspect of creating an app. While there are many other methods of collecting payment, Stripe is a common payment system and can integrate very well with Ionic. In addition, there is no need to provide a high level of security and compliance (that is, PCI) since you will not be storing the credit card information.</p>
<p>Your app will not process via a real payment method because you can use a public test key from Stripe. The app will ask for a few fields to create a token. Observe the following screenshot of the app:</p>
<div><img class="aligncenter size-full wp-image-162 image-border" src="img/063bcdc2-b4c8-4870-97e5-74689d0dc6f8.png" style="width:18.08em;height:32.33em;" width="366" height="655"/></div>
<p>If you touch the Pay button, it will take you to the next screen where you will get the payment token, as shown in the following screenshot:</p>
<div><img class="aligncenter size-full wp-image-163 image-border" src="img/5e7e6a47-89b8-4b7e-95e1-a9041758e50a.png" style="width:16.42em;height:14.25em;" width="308" height="266"/></div>
<p>Actually, there are additional steps for your backend to call Stripe to authorize and process the transaction. However, it's not within the scope of this section. The Stripe document has a good tutorial page on Node.js at <a href="https://stripe.com/docs/api/node#authentication" target="_blank">https://stripe.com/docs/api/node#authentication</a>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>There is no need to test in a physical device because Ionic and Stripe will work just fine in the web browser.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>If you don't have a Stripe account, you need to register on <a href="https://stripe.com" target="_blank">https://stripe.com.</a></li>
<li>Log in and go to <a href="https://dashboard.stripe.com/account/apikeys" target="_blank">https://dashboard.stripe.com/account/apikeys</a>.<a href="https://dashboard.stripe.com/account/apikeys" target="_blank"/></li>
</ol>
<ol start="3">
<li>Copy your Publishable Key, shown as follows, somewhere because you need to use it for your JavaScript code later:</li>
</ol>
<div><img class="aligncenter size-full wp-image-165 image-border" src="img/359cbf19-91ae-493b-982f-a441c8b9d2b5.png" style="width:34.42em;height:2.67em;" width="890" height="69"/></div>
<ol start="4">
<li>Now, go back to the Terminal and create a new <kbd>StripePayment</kbd> app using the <kbd>blank</kbd> template, as follows, and go into the <kbd>StripePayment</kbd> folder:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start StripePayment blank
$ cd StripePayment</strong></pre>
<ol start="5">
<li>Open the <kbd>./src/index.html</kbd> file and insert the line shown somewhere in the <kbd>&lt;body&gt;</kbd> tab as follows:</li>
</ol>
<pre style="padding-left: 60px">&lt;script type="text/javascript" <br/>src="img/"&gt;&lt;/script&gt;</pre>
<p>This is to load the <kbd>Stripe</kbd> object globally in your app. This is not the recommended method with Angular because anything that is used within a component must be imported via the <kbd>import</kbd> instruction. However, at the time of writing this book, angular-stripe is unavailable for Angular. So, there is no way to do this properly. The preceding method will work just fine.</p>
<ol start="6">
<li>Open the <kbd>./src/pages/home/home.html</kbd> file and modify the content with the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-content class="gray-bg"&gt;<br/>  &lt;p class="center"&gt;<br/>    &lt;ion-icon class="icon-large" name="card"&gt;&lt;/ion-icon&gt;<br/>  &lt;/p&gt;<br/>  &lt;ion-card&gt;<br/>    &lt;ion-card-content&gt;<br/>      &lt;ion-card-header&gt;<br/>        Credit or debit card<br/>      &lt;/ion-card-header&gt;<br/>        &lt;ion-item&gt;<br/>          &lt;div #cardElement&gt;<br/>            &lt;!-- a Stripe Element will be inserted here. --&gt;<br/>          &lt;/div&gt;<br/>        &lt;/ion-item&gt;<br/>        &lt;button ion-button full (click)="onSubmit()"&gt;Pay&lt;/button&gt;<br/>    &lt;/ion-card-content&gt;<br/>  &lt;/ion-card&gt;<br/>&lt;/ion-content&gt;</pre>
<p style="padding-left: 60px">Stripe only needs the credit card number, CVC, and expiration to create a token for charging. The customer name and address are optional; so, you don't need to include them here.</p>
<ol start="7">
<li>Then, replace the content of <kbd>./src/pages/home/home.ts</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component, ViewChild } from '@angular/core';<br/>import { NavController } from 'ionic-angular';<br/>import { ThankyouPage } from '../thankyou/thankyou'<br/>declare var Stripe: any;<br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  private token: string = '';<br/>  private card:any;<br/>  private elements:any;<br/>  private stripe:any;<br/>  @ViewChild('cardElement') cardElement;<br/>  constructor(public nav: NavController) {<br/>    this.nav = nav;<br/>    this.stripe = Stripe('YOUR STRIPE PUBLIC KEY HERE');<br/>    this.elements = this.stripe.elements();<br/>  }<br/><br/>  ngOnInit() { <br/>    const style = {<br/>      base: {<br/>        fontSize: '16px',<br/>        lineHeight: '24px',<br/>        marginBottom: '10px'<br/>      },<br/>    };<br/>    this.card = this.elements.create('card', {style});<br/>    this.card.mount(this.cardElement.nativeElement);<br/>  }<br/>  onSubmit() {<br/>    this.stripe.createToken(this.card)<br/>    .then((data) =&gt; {<br/>      this.stripeResponseHandler(data);<br/>    });<br/>  }<br/><br/>  stripeResponseHandler(response) {<br/>    if (response.error) {<br/>      // Show the errors on the form<br/>      console.log('error');<br/>      console.log(response.error.message);<br/>    } else {<br/>      // response contains id and card, which contains additional card   <br/>      //details<br/>      this.token = response.token.id;<br/>      // Insert the token into the form so it gets submitted to the server<br/>      console.log('success');<br/>      console.log('Sending token param:');<br/>      console.log(this.token);<br/>      this.nav.push(ThankyouPage, { token: this.token });<br/>    }<br/>  }<br/>}</pre>
<p style="padding-left: 60px">You need to change your <kbd>Test Publishable Key</kbd> here by replacing <kbd>YOUR STRIPE PUBLIC KEY HERE</kbd> in <kbd>Stripe</kbd> Constructor with your own key that you copied earlier.</p>
<ol start="8">
<li>Edit <kbd>./src/pages/home/home.scss</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">.page-home {<br/>    .center {<br/>        text-align: center;<br/>    }<br/>    .gray-bg {<br/>        background-color: #f4f4f7;<br/>    }<br/>    .icon-large {<br/>        font-size: 150px;<br/>        color: #387ef5;<br/>        opacity: 0.5;<br/>    }<br/>}</pre>
<ol start="9">
<li>Create the <kbd>thankyou</kbd> page that shows the token ID by making a new folder, called <kbd>./src/pages/thankyou</kbd>, as shown:</li>
</ol>
<pre><strong>$ mkdir ./src/pages/thankyou</strong></pre>
<ol start="10">
<li>Create the <kbd>thankyou.html</kbd> file in the <kbd>thankyou</kbd> folder and copy the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-content class="green-bg"&gt; 
  &lt;h4 class="center"&gt; 
    Your token is 
  &lt;/h4&gt; 
  &lt;p class="center"&gt; 
    &lt;code&gt; 
      {{ token }} 
    &lt;/code&gt; 
  &lt;/p&gt; 
&lt;/ion-content&gt; </pre>
<p style="padding-left: 60px">In reality, there is no need to show the token ID to the user. This is just an example to get the token ID to charge.</p>
<ol start="11">
<li>Create the <kbd>thankyou.ts</kbd> file in the <kbd>thankyou</kbd> folder and copy the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core'; 
import { NavController, NavParams } from 'ionic-angular'; 
 
@Component({ 
  selector: 'thank-you', 
  templateUrl: 'thankyou.html' 
}) 
export class ThankyouPage { 
  private token: string = ''; 
   
  constructor(public nav: NavController, public params: <br/>   NavParams) { 
    this.token = this.params.get('token'); 
    console.log('Getting token param:'); 
    console.log(this.token); 
  } 
 
} </pre>
<ol start="12">
<li>Create the <kbd>thankyou.scss</kbd> file to modify the theme using the following code:</li>
</ol>
<pre style="padding-left: 60px">thank-you {<br/>    .green-bg {<br/>        color: black;<br/>        background-color: #32db64;<br/>    }<br/>    h4.center {<br/>        padding-top: 150px;<br/>    }<br/>    .center {<br/>        text-align: center;<br/>    }<br/>}</pre>
<ol start="13">
<li>Open and edit <kbd>./src/app/app.module.ts</kbd> to declare <kbd>ThankyouPage</kbd> as follows:</li>
</ol>
<pre style="padding-left: 60px">import { NgModule } from '@angular/core'; 
import { IonicApp, IonicModule } from 'ionic-angular'; 
import { MyApp } from './app.component'; 
import { HomePage } from '../pages/home/home'; 
import { ThankyouPage } from '../pages/thankyou/thankyou' 
 
@NgModule({ 
  declarations: [ 
    MyApp, 
    HomePage, 
    ThankyouPage 
  ], 
  imports: [ 
    IonicModule.forRoot(MyApp) 
  ], 
  bootstrap: [IonicApp], 
  entryComponents: [ 
    MyApp, 
    HomePage, 
    ThankyouPage 
  ], 
  providers: [] 
}) 
export class AppModule {} </pre>
<ol start="14">
<li>Go to your Terminal and run the app:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic serve</strong></pre>
<ol start="15">
<li>For the purpose of testing, you can use <kbd>4242424242424242</kbd> as the credit card number, <kbd>123</kbd> as <kbd>cvc</kbd>, and <kbd>12/2017</kbd> as the expiration.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works...</h1>
                
            
            
                
<p>This is the Stripe charging process:</p>
<ol>
<li>The user fills in the payment form and clicks on the Submit button.</li>
<li>The frontend (your Ionic app) will call API to Stripe using the <kbd>Stripe</kbd> object and send along all the payment information.</li>
<li>Stripe will return a token ID, which is basically a way to confirm that everything is correct and you can charge the card now.</li>
</ol>
<ol start="4">
<li>The frontend will use the token ID to send to its backend (without the credit card information) to authorize the charge.</li>
<li>The backend will call another Stripe API to say <em>I'm going to charge now</em>. Stripe will return the <kbd>success</kbd> event to the backend at this point.</li>
<li>The backend will then return the <kbd>success</kbd> event to the frontend.</li>
<li>The frontend should render a new page, such as the <kbd>thankyou</kbd> page.</li>
</ol>
<p>As discussed previously, this chapter will not cover the backend portion of this app because it doesn't focus on Ionic. You can build the backend using any language, such as Node.js, PHP, or Python.</p>
<p>Let's take a look at <kbd>home.ts</kbd> because the majority of Stripe API processing is located there. First, you need to do a <kbd>declare</kbd>, as illustrated, because <kbd>Stripe</kbd> is a global object that was included in the <kbd>index.html</kbd>:</p>
<pre>declare var Stripe: any; </pre>
<p>If you don't do a <kbd>declare</kbd>, the app will still run but you will get an error from TypeScript.</p>
<p>We are using Stripe Elements, which is pre-built set of UI Elements for payment. When our <kbd>home.ts</kbd> page is loaded, we initialize our Payment form using <kbd>ngOnInit</kbd> LikeCycle hook. Take a look at following code, inside <kbd>ngOnInt</kbd>:</p>
<pre> this.card = this.elements.create('card', {style});<br/> this.card.mount(this.cardElement.nativeElement);</pre>
<p>We are creating a Stripe element card with a given style and then mounting that card to HTML element inside template using <kbd>this.card.mount</kbd>.</p>
<p>If you take a look at <kbd>home.html</kbd>, you will see something like this:</p>
<pre>&lt;div #cardElement&gt;<br/> &lt;!-- a Stripe Element will be inserted here. --&gt;<br/>&lt;/div&gt;</pre>
<p>We created a <kbd>div</kbd> in <kbd>home.html</kbd> with <kbd>#cardElement</kbd> local variable, and in <kbd>home.ts</kbd> we used <kbd>@ViewChild</kbd> decorator to get hold of it, and then mounted the <kbd>Stripe Element</kbd> UI on it. Mounting means creating an input field for card number, date of expiry, and CVV. <kbd>Stripe Element</kbd> also comes with its own validations and error messages.</p>
<p>When the user submits the form, it will trigger the following method:</p>
<pre> onSubmit() {<br/>    this.stripe.createToken(this.card)<br/>    .then((data) =&gt; {<br/>      this.stripeResponseHandler(data);<br/>    });<br/>  }</pre>
<p>When you call <kbd>Stripe.card.createToken</kbd>, the Stripe object will trigger an API call in the background to <a href="https://stripe.com/">https://stripe.com/</a> with the information filled by the user via form. This functionality is accomplished by the following code in your <kbd>home.html</kbd>:</p>
<pre>&lt;button type="button" ion-button bottom block <br/> (click)="onSubmit()"&gt;Pay&lt;/button&gt;</pre>
<p>Once Stripe returns your token ID, it will call the <kbd>this.stripeResponseHandler(response)</kbd> function:</p>
<pre>   stripeResponseHandler(response) {<br/>    if (response.error) {<br/>      // Show the errors on the form<br/>      console.log('error');<br/>      console.log(response.error.message);<br/>    } else {<br/>      // response contains id and card, which contains additional card details<br/>      this.token = response.token.id;<br/>      // Insert the token into the form so it gets submitted to the server<br/>      console.log('success');<br/>      console.log('Sending token param:');<br/>      console.log(this.token);<br/>      this.nav.push(ThankyouPage, { token: this.token });<br/>    }<br/>  }</pre>
<p>The <kbd>response.token.id</kbd> will have your token ID from Stripe. Otherwise, you can handle the error using <kbd>response.error.message</kbd>. In this example, since it only passes the token ID to the next page, you can simply send it as a parameter <kbd>{token: this.token}</kbd>:</p>
<pre>this.nav.push(ThankyouPage, {token: this.token}); </pre>
<p>In your <kbd>thankyou.ts</kbd>, you can access the parameter <kbd>token</kbd> using the following code:</p>
<pre>this.params.get('token');</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">See also</h1>
                
            
            
                
<ul>
<li>To understand more about Stripe API, you can check out the official documentation at <a href="https://stripe.com/docs/stripe.js" target="_blank">https://stripe.com/docs/stripe.js</a><a href="https://stripe.com/docs/stripe.js" target="_blank"/></li>
<li>To know more about Strip elements, you can take a look at <a href="https://stripe.com/elements" target="_blank">https://stripe.com/elements</a><a href="https://stripe.com/elements" target="_blank"/></li>
<li>There are more examples from other languages that you can experiment with at <a href="https://stripe.com/docs/examples" target="_blank">https://stripe.com/docs/examples</a><a href="https://stripe.com/docs/examples" target="_blank"/></li>
</ul>


            

            
        
    </div>



  </body></html>