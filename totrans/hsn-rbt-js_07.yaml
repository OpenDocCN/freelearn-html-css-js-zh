- en: Using Servos for Measured Movement
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now that we''ve looked at motors, let''s look at a more precise way to add
    to movement to our projects: the servo. We''ll dive into how to wire up one servo,
    then another, and how to code both a single servo and multiple ones.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The following topics will be covered in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Differences between motors and servos
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Getting a servo working with Johnny-Five
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Project – two servos and the REPL
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Project – the continuous servo
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You'll need your Pi, Cobbler, PWM hat, 2 hobby servos, and the AA battery pack
    from [Chapter 6](4135cf2d-d967-49b3-bf2b-37f82e7f5f62.xhtml), *Using Motors to
    Move Your Project*. You'll also need a continuous servo. Finally, you'll need
    your light sensor. Optional, but helpful, is a Popsicle or other small stick and
    some tape for turning our servo into a meter.
  prefs: []
  type: TYPE_NORMAL
- en: The code for this chapter is available at: [https://github.com/PacktPublishing/Hands-On-Robotics-with-JavaScript/tree/master/Chapter07](https://github.com/PacktPublishing/Hands-On-Robotics-with-JavaScript/tree/master/Chapter07).
  prefs: []
  type: TYPE_NORMAL
- en: Differences between motors and servos
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The average hobby servo looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4fe97e2a-ac4e-4b33-8685-1737f2be8447.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Also pictured are common accessories: some different arms, and mounting screws/washers.
    The wire ends terminate in a solid socket of three: perfect for attaching to our
    PWM hat.'
  prefs: []
  type: TYPE_NORMAL
- en: The motors we worked with last chapter have some very basic differences, and
    we should explore them before we start our servo project.
  prefs: []
  type: TYPE_NORMAL
- en: Calculated movements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Unlike the motors we dealt with in the previous chapter, you can make precise
    and calculated movements with a servo. Name a degree between 0 and 180 on a regular
    servo, and it will go. Motors (excluding stepper motors, which aren't covered
    in this book) cannot make these precise movements. So if you're looking to make
    a wheel go and you don't care about accurate movements, use a motor. When you're
    looking to make the joint of a limb that needs to move precisely with other joints,
    time to use a servo.
  prefs: []
  type: TYPE_NORMAL
- en: Regular versus continuous servos
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are two kinds of servos, and they look remarkably alike. The other kind
    is called a continuous servo. They work very similar to regular servos in Johnny-Five,
    as you can see in the documentation for *servo.continuous*, which is on the same
    page as the servo documentation. The main difference is that while a regular servo
    can only go 180 degrees, a continuous one can go full 360 and continue spinning
    in the same direction indefinitely. Some favor using these to move wheels in their
    vehicle projects, and that's just fine!
  prefs: []
  type: TYPE_NORMAL
- en: Powering servos and motors
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This is where servos and motors are very similar: while one servo tends to
    take less power than a motor, many projects make use of more servos than they
    would motors, and that can mean a strain on your Pi. If you add a lot of servos,
    you''re going to want to provide external power to the PWM hat; many use 3-4 AA
    battery packs. I recommend using the one we used for motors in [Chapter 6](4135cf2d-d967-49b3-bf2b-37f82e7f5f62.xhtml),
    *Using Motors to Move Your Project*.'
  prefs: []
  type: TYPE_NORMAL
- en: Powering your servos off of the Pi can have consequences that you wouldn't expect--
    if you're getting memory leak issues while running servo code, it can be because
    you're pulling too much power from the Pi!
  prefs: []
  type: TYPE_NORMAL
- en: In general, if you're having weird issues with running servo code, make sure
    your servos are adequately powered by an external source.
  prefs: []
  type: TYPE_NORMAL
- en: Getting a servo working with Johnny-Five
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To get a servo working with Johnny-Five, we'll look at the Johnny-Five servo
    object, talk about wiring the servo to our PWM hat, and write our first piece
    of code to get the servo to sweep back and forth.
  prefs: []
  type: TYPE_NORMAL
- en: The Johnny-Five servo object
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Looking at the servo page in the API section of the Johnny-Five documentation,
    we will look first for our constructor. Because we''re still using the PCA9685
    PWM hat, our constructor will look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'As for moving the servo, there are a few method described in the docs to move
    the servo. The first move can be to a fixed position:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Or, another is to sweep back and forth, either as far back and forth as possible,
    or between a range:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'You can also stop a moving servo:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Now that we have a good grasp on coding our servo in Johnny-Five, let's wire
    up a servo and test our new knowledge.
  prefs: []
  type: TYPE_NORMAL
- en: Wiring the servo to our PWM hat
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Wiring the servo to the PWM hat is relatively simple; you need to line up the
    3-pin socket of the servo to the column of pins you want. You also need to attach
    the power leads of the shield to AA battery pack from [Chapter 6](4135cf2d-d967-49b3-bf2b-37f82e7f5f62.xhtml), *Using
    Motors to Move Your Project*.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/dc2a8e90-51b4-4a41-8a73-3332e0af8115.png)'
  prefs: []
  type: TYPE_IMG
- en: I find that figuring out which pin is ground, then making sure that socket is
    on the bottom, helps. Ground wires on servos are typically black or brown in color.
    Then, line up the socket and slide it onto the pins in the first column (pin 0).
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ca2ade60-1337-4608-b729-b5d48ca94565.png)'
  prefs: []
  type: TYPE_IMG
- en: We've hooked up our servo and given power to the PWM hat, so let's code up a
    servo.
  prefs: []
  type: TYPE_NORMAL
- en: Coding your first servo sweep
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In a file called `single-servo.js`, we''re going to set up our board, the our
    servo, and when it''s ready, tell it to sweep back and forth:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Move the file into its own folder on the Pi, navigate to that folder in your
    Pi SSH session, and run the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: You should see the servo move back and forth. Great! Now it's time to control
    two servos using the Johnny-Five Servos object and the command-line REPL.
  prefs: []
  type: TYPE_NORMAL
- en: Project – two servos and the REPL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have one servo up and running, we're going to wire up a second one
    and use the REPL to explore the Johnny-Five Servos object, which is meant to help
    control several servos at once.
  prefs: []
  type: TYPE_NORMAL
- en: First, let's wire up our second servo.
  prefs: []
  type: TYPE_NORMAL
- en: Wiring up a second servo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Take the second servo, figure out which side is ground, put that one on the
    bottom, and slide the three-pin socket over the pins in the second column (pin
    1):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2de508fb-45f0-441c-a334-f848908783c1.png)'
  prefs: []
  type: TYPE_IMG
- en: Now that we've wired up a second servo, let's start coding our Johnny-Five servos
    object!
  prefs: []
  type: TYPE_NORMAL
- en: Using the Johnny-Five servos object
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Johnny-Five servos object is meant to help you group servos in ways that
    make sense for projects with many servos, such as hexapods with six legs, each
    containing multiple servos.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can create a `Servos` object in a few different ways; the way we will use
    is to pass an array of constructed `servo` objects:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'This is where the magic happens—now that our `servo` objects are grouped in
    a `Servos` object, we can control them both independently and as a group:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: And *all servo object functions are available on the Servos object.*
  prefs: []
  type: TYPE_NORMAL
- en: Let's add this to our code.
  prefs: []
  type: TYPE_NORMAL
- en: Adding the Servos object to our code
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the same folder as `single-servo.js`, create a new file, `servos-repl.js`,
    and copy the contents of `single-servo.js` into it.
  prefs: []
  type: TYPE_NORMAL
- en: 'Then, in the `board.on(''ready'')` handler, rename `servo` to `servoOne` and
    add a constructor for `servoTwo` on pin `1` of the PWM hat:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, we''ll construct a `Servos` object containing `servoOne` and `servoTwo`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Now that our servos are coded, let's add Johnny-Five REPL functionality so we
    can control our servos from the command line.
  prefs: []
  type: TYPE_NORMAL
- en: Adding in REPL functionality
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'First, delete the `servo.sweep()` line from `servos-repl.js`, as it''ll cause
    an error now. Instead, place this code, which will allow us to access both of
    our servos and our servos group object from the command-line, on the Pi:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Now we're ready to play with our servos!
  prefs: []
  type: TYPE_NORMAL
- en: Playing with our servos on the command line
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Load the folder onto the Pi, navigate to the folder in your Pi SSH session,
    and run the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Once you see `Board Initialized`, the REPL is ready for commands. Try these
    out for starters:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Use the Johnny-Five documentation on servo to see what other fun things you
    can try with your servos from the command line!
  prefs: []
  type: TYPE_NORMAL
- en: Project – light meter with the servo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's build a project where our servo servos as a light meter that sweeps between
    0 and 180 degrees based on the reading from the light sensor.
  prefs: []
  type: TYPE_NORMAL
- en: Adding in the light sensor
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: First, we need to wire the light sensor to the board. Remember, I²C devices
    can share an SDA and SCL pin as long as they have different addresses (which the
    TSL2591, at 0x29, and the PWM hat, at 0x40, do).
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/de142e6a-1142-4f49-a35a-a2307c5ae823.png)'
  prefs: []
  type: TYPE_IMG
- en: Now that we've wired up the sensor, we'll take on the (optional) task of modifying
    our servo to look more like a meter.
  prefs: []
  type: TYPE_NORMAL
- en: Making the servo into a meter
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Take the servo horn and, with the center of the horn facing away from you,
    move it as far to the left as possible (0 degrees). *Do not use a lot of force
    or you''ll strip the gears.* Then, use the tape to tape your stick to the servo
    horn to make it appear longer. then, you can tape it down to a desk or onto a
    wall, with your meter pointing left. You can see my attempt in the following diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bd241b33-a6bc-459b-81ad-f62539f44f77.png)'
  prefs: []
  type: TYPE_IMG
- en: Now that we have our light sensor wired up and our meter cobbled together, let's
    code our light meter.
  prefs: []
  type: TYPE_NORMAL
- en: Coding the project
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Create a new file in your `project` folder called `light-meter.js`. Set up
    your normal scaffolding: requiring in Johnny-Five and Raspi-IO, setting up our
    `Board` object, and creating the `board.on(''ready'')` handler:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'Inside the `board.on(''ready'')` handler, construct your `Servo` and `Light`
    objects:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, we need to build a `lightSensor.on(''change'')` handler. We''re going
    to use the `Sensor.scaleTo([min, max])` to scale the 0-255 input of the light
    sensor to the `0`-`180` output of the `servo`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: And that's it! Let's get it on the Pi and see it at work.
  prefs: []
  type: TYPE_NORMAL
- en: Running and using our light meter
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Load your `project` folder onto the Pi, navigate to the folder in your Pi SSH
    session, and run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: Then, cover the light sensor, or shine a light onto it—the servo should move
    back and forth accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: Now that we've explored the servo as a means of communicating data as well as
    creating motion, let's take a look at the continuous servo.
  prefs: []
  type: TYPE_NORMAL
- en: Project – the continuous servo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Continuous servos are a little like a motor combined with a regular servo:
    you lose the ability to go to specific degrees like a regular servo, but you can
    stop instantly instead of coasting to a stop like many motors. You can tell a
    continuous servo to move clockwise or counterclockwise at different speeds, and
    you can tell it to stop.'
  prefs: []
  type: TYPE_NORMAL
- en: Let's wire up a continuous servo and play with its abilities via the Johnny-Five
    REPL.
  prefs: []
  type: TYPE_NORMAL
- en: Wiring up the servo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The only difference in the wiring is continuous servos look different from regular
    servos in that nearly all have a disc instead of a horn. And most have red, white,
    and black power, signal, and ground wires, respectively.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/37eb26e1-e496-42ef-8d94-5cb089f8b34a.png)'
  prefs: []
  type: TYPE_IMG
- en: (Fritzing didn't have a continuous servo object, so we'll have to make due.)
  prefs: []
  type: TYPE_NORMAL
- en: Continuous servo constructor and methods
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The constructor for the continuous servo is reminiscent of the RGB LED constructor,
    in that it is a property of the `Servo` object. Otherwise, it looks very similar
    to the `Servo` constructor with our PWM hat:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'There are three methods we can use with the continuous servo:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Now that we know how to use it and have it wired up, let's write a quick program
    that lets us play with our continuous servo in the REPL.
  prefs: []
  type: TYPE_NORMAL
- en: Using the REPL with the continuous servo
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Create a file in your `project` folder called `continuous-servo-repl.js`, and
    start with your usual setup:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, in our `board.on(''ready'')` handler, construct the `Servo.Continuous`
    object:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, after the constructor, inject the continuous servo into the REPL so
    we can use it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Now we can load it up and try it out!
  prefs: []
  type: TYPE_NORMAL
- en: Playing with the continuous servo in the REPL
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Load your `project` folder onto the Pi, navigate to the folder in your Pi SSH
    session, and run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: 'Once you see `Board Initialized`, you can try controlling the continuous servo
    by entering commands into the Johnny-Five REPL:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: It is because of the ability to change direction and stop quickly that some
    prefer continuous servos to motors for wheeled robots—it's always great to have
    options.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we learned how servos differ from motors, and the difference
    between regular and continuous servos. We also learned about the constructor for
    the Johnny-Five servo object and its functions. Next, we built a project that
    taught us how to group servos with the servos object, and control them from the
    Pi's command line via REPL. Then, we built a project that showed the ability of
    the servo to convey information as well as create movement by building a light
    meter. Finally, we learned more about and played with continuous servos.
  prefs: []
  type: TYPE_NORMAL
- en: Questions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: What are the differences between servos and motors?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What is the difference between regular and continuous servos?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Why do servos require an external power source?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When would you use servos over motors?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: What are the benefits of the servos object?
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
