<html><head></head><body>
<div><h1 class="chapternumber">2</h1>
<h1 class="chaptertitle" id="_idParaDest-17">Working with the Node.js Tools</h1>
<p class="normal1">In this chapter, I explain the simple process of <a id="_idIndexMarker003" class="calibre3"/>getting started with <strong class="screentext">Node.js</strong>, beginning with the simple steps that are required to prepare for development. I explain how to execute JavaScript code using Node.js and then I introduce the real power in Node.js development: the <strong class="screentext">Node Package Manager</strong> (<strong class="screentext">npm</strong>). <code class="inlinecode">npm</code> is the <a id="_idIndexMarker004" class="calibre3"/>tool that does most of the work during development, taking responsibility for everything from downloading and installing JavaScript packages, reporting on security vulnerabilities, and running development commands. <em class="italic">Table 2.1</em> summarizes the chapter.</p>
<p class="packt_figref">Table 2.1: Chapter summary </p>
<table class="table-container" id="table001">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Problem</p>
</td>
<td class="table-cell">
<p class="normal">Solution</p>
</td>
<td class="table-cell">
<p class="normal">Listing</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Execute a JavaScript file.</p>
</td>
<td class="table-cell">
<p class="normal">Use the <code class="inlinecode">node</code> command.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">5</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Initialize a project for use with JavaScript packages.</p>
</td>
<td class="table-cell">
<p class="normal">Use the <code class="inlinecode">npm init</code> command.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">6</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Add a JavaScript package to a project.</p>
</td>
<td class="table-cell">
<p class="normal">Use the <code class="inlinecode">npm install</code> command. Use the <code class="inlinecode">--save-dev</code> argument for development tool packages. </p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">7, 8</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">List the packages in a project.</p>
</td>
<td class="table-cell">
<p class="normal">Use the <code class="inlinecode">npm list</code> command.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">9, 10</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">List the reported security vulnerabilities in the packages used by a project.</p>
</td>
<td class="table-cell">
<p class="normal">Use the <code class="inlinecode">npm audit</code> command.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">N/A</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Execute the code in a package.</p>
</td>
<td class="table-cell">
<p class="normal">Add the <code class="inlinecode">node_modules/.bin</code> folder to the path or use the <code class="inlinecode">npx</code> command.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">11–17</em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Start the development tools used by a project.</p>
</td>
<td class="table-cell">
<p class="normal">Define commands in the scripts section of the <code class="inlinecode">package.json</code> file and use the <code class="inlinecode">npm start</code> or <code class="inlinecode">npm run</code> commands.</p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1">18–22</em></p>
</td>
</tr>
</tbody>
</table>
<h1 class="heading" id="_idParaDest-18">Getting ready</h1>
<p class="normal1">The key step to <a id="_idIndexMarker005" class="calibre3"/>prepare for Node.js development is, as you would expect, to install Node.js and its supporting tools. The version of Node.js I have used in this book is 20.9.0, which is <a id="_idIndexMarker006" class="calibre3"/>the <strong class="screentext">Long-Term Support</strong> (<strong class="screentext">LTS</strong>) version at the time of writing. There may be later versions available by the time you read this, but you should stick to this release for the examples in this book.</p>
<p class="normal">A complete set of installers for Node.js version 20.10.0 is available at <a href="https://nodejs.org/download/release/v20.10.0" class="calibre3">https://nodejs.org/download/release/v20.10.0</a>. Download and run the installer for your platform and ensure the <strong class="screentext">npm package manager</strong> and the <strong class="screentext">Add to PATH</strong> options are checked, as shown in <em class="italic">Figure 2.1</em>: </p>
<figure class="mediaobject"><img alt="A screenshot of a computer setup  Description automatically generated" src="img/B21959_02_01.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 2.1: Installing Node.js</p>
<p class="normal">When <a id="_idIndexMarker007" class="calibre3"/>the installation is complete, open a new command prompt and run the command shown in <em class="italic">Listing 2.1</em>:</p>
<p class="packt_figref">Listing 2.1: Running Node.js</p>
<pre class="programlisting1"><code class="hljs-con">node -v
</code></pre>
<p class="normal">If the installation has been successful, you will see the following version number displayed:</p>
<pre class="programlisting1"><code class="hljs-con">v20.10.0
</code></pre>
<p class="normal">The installer should have set up the package manager, which plays a key role in Node.js development. Run the command shown in <em class="italic">Listing 2.2</em> to ensure the package<a id="_idIndexMarker008" class="calibre3"/> manager is working:</p>
<p class="packt_figref">Listing 2.2: Running the package manager</p>
<pre class="programlisting1"><code class="hljs-con">npm -v
</code></pre>
<p class="normal">If the installation was successful, you will see the following version number:</p>
<pre class="programlisting1"><code class="hljs-con">10.1.0
</code></pre>
<h2 class="heading1" id="_idParaDest-19">Installing Git</h2>
<p class="normal1">Some<a id="_idIndexMarker009" class="calibre3"/> packages depend on <strong class="screentext">Git</strong>, which is a popular version control system. Download the installer for your platform from <a href="https://git-scm.com/downloads" class="calibre3">https://git-scm.com/downloads</a> and follow the installation instructions. </p>
<p class="normal">Once you have completed the installation, use a command prompt to run the command shown in <em class="italic">Listing 2.3</em> to check that Git is working. You may have to manually configure the executable paths:</p>
<p class="packt_figref">Listing 2.3: Checking Git</p>
<pre class="programlisting1"><code class="hljs-con">git --version
</code></pre>
<p class="normal">At the time of writing, the latest version of Git for Windows and Linux is 2.42.0.</p>
<h2 class="heading1" id="_idParaDest-20">Selecting a code editor</h2>
<p class="normal1">An editor is <a id="_idIndexMarker010" class="calibre3"/>required to write the code that will be executed by Node.js, and any editor that supports JavaScript and TypeScript can be used to follow the examples in this book. If you don’t already have a preferred editor, then Visual Studio Code (<a href="https://code.visualstudio.com" class="calibre3">https://code.visualstudio.com</a>) has become the most popular editor because it is good (and free), and it is the editor that I used while writing this book.</p>
<p class="normal">If you are using Visual Studio Code, run the command code to start the editor or use the program icon created during installation, and you will see the welcome screen shown in <em class="italic">Figure 2.2</em>. (You may need to add Visual Studio Code to your command prompt <a id="_idIndexMarker011" class="calibre3"/>path before using the command code.) </p>
<figure class="mediaobject"><img alt="" src="img/B21959_02_02.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 2.2: The Visual Studio Code Welcome screen</p>
<h1 class="heading" id="_idParaDest-21">Using Node.js</h1>
<p class="normal1">The <a id="_idIndexMarker012" class="calibre3"/>entire purpose of Node.js is to execute JavaScript code. Open a command prompt, navigate to a convenient location, and create a folder named <code class="inlinecode">tools</code>. Add a file named <code class="inlinecode">hello.js</code> to the <code class="inlinecode">tools</code> folder, with the content shown in <em class="italic">Listing 2.4</em>:</p>
<p class="packt_figref">Listing 2.4: The Contents of the hello.js File in the tools Folder</p>
<pre class="programlisting"><code class="hljs-code">console.log("Hello, World");
</code></pre>
<p class="normal">The Node.js API has some features that are also provided by modern JavaScript browsers, including the <code class="inlinecode">console.log</code> method, which writes a message to the console. Run the command shown in <em class="italic">Listing 2.5</em> in the <code class="inlinecode">tools</code> folder to execute the JavaScript code:</p>
<p class="packt_figref">Listing 2.5: Executing the JavaScript Code</p>
<pre class="programlisting1"><code class="hljs-con">node hello.js
</code></pre>
<p class="normal">The <code class="inlinecode">node</code> command<a id="_idIndexMarker013" class="calibre3"/> starts the Node.js runtime and executes the specified JavaScript file, producing the following output:</p>
<pre class="programlisting1"><code class="hljs-con">Hello, World
</code></pre>
<p class="normal">That’s all there is to know about executing JavaScript code. The rest of the functionality that Node.js provides is delivered through an API, which is described in the rest of this book, starting with <em class="italic">Chapter 4</em>.</p>
<h1 class="heading" id="_idParaDest-22">Understanding the npm tool</h1>
<p class="normal1">The <code class="inlinecode">node</code> command isn’t often used directly, and most development activities rely on the <code class="inlinecode">npm</code> tool, which<a id="_idIndexMarker014" class="calibre3"/> is installed alongside Node.js. The headline <code class="inlinecode">npm</code> feature is that it provides access to the <code class="inlinecode">npm</code> repository (<a href="http://npmjs.com" class="calibre3">npmjs.com</a>), which contains an incredible collection of open-source JavaScript packages that can be added to projects. <code class="inlinecode">npm</code> has grown from its original purpose to add related features and has become an integral part of working with Node.js, as I describe in the following sections. For quick reference, <em class="italic">Table 2.2</em> lists the most useful commands supported by <code class="inlinecode">npm</code>, which is the package manager command.</p>
<table class="table-container" id="table002">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Name</p>
</td>
<td class="table-cell">
<p class="normal">Description</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm init</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command creates a <code class="inlinecode">package.json</code> file, which is used to keep track of a project’s packages.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm install</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command adds a package to the project. The <code class="inlinecode">--save-dev</code> argument is used to install packages that are used during development but are not part of the application.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm list</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command lists all of the packages that have been added to the project. The <code class="inlinecode">--all</code> argument includes package dependencies in the output.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm audit</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command reports on security vulnerabilities that have been reported in the packages used in the project.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm start</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes the <code class="inlinecode">start</code> script defined in the <code class="inlinecode">package.json</code> file.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm stop</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes the <code class="inlinecode">stop</code> script defined in the <code class="inlinecode">package.json</code> file.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm restart</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes the <code class="inlinecode">restart</code> script defined in the <code class="inlinecode">package.json</code> file.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm test</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes the <code class="inlinecode">test</code> script defined in the <code class="inlinecode">package.json</code> file.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm run</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes custom commands defined in the <code class="inlinecode">package.json</code> file.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npx</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This command executes a package.</p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 2.2: Useful <code class="inlinecode2">npm</code> commands</p>
<h2 class="heading1" id="_idParaDest-23">Initializing a project</h2>
<p class="normal1"><code class="inlinecode">npm</code> relies<a id="_idIndexMarker015" class="calibre3"/> on a configuration file named <code class="inlinecode">package.json</code>, which describes the development project, keeps track of the packages on which it depends, and stores configuration settings related to packages. Run the command shown in <em class="italic">Listing 2.6</em> in the <code class="inlinecode">tools</code> folder to create the <code class="inlinecode">package.json</code> file for the example project:</p>
<p class="packt_figref">Listing 2.6: Initializing the project</p>
<pre class="programlisting1"><code class="hljs-con">npm init -y
</code></pre>
<p class="normal">The <code class="inlinecode">init</code> command prompts the user for the values to put in the <code class="inlinecode">package.json</code> file, but the <code class="inlinecode">-y</code> argument selects the default values, which are suitable for most projects, including the example for the chapter. The <code class="inlinecode">init</code> command creates a <code class="inlinecode">package.json</code> file with the following contents:</p>
<pre class="programlisting"><code class="hljs-code">{
  "name": "tools",
  "version": "1.0.0",
  "description": "",
  "main": "hello.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
</code></pre>
<p class="normal">Most of the initial contents of the <code class="inlinecode">package.json</code> file describe the project so that it can be published to a package registry, which is why there are settings for version numbers<a id="_idIndexMarker016" class="calibre3"/> and licenses. Additional settings will be added to the file in later sections, and you can see the complete list of supported settings at <a href="https://docs.npmjs.com/cli/v10/configuring-npm/package-json" class="calibre3">https://docs.npmjs.com/cli/v10/configuring-npm/package-json</a>.</p>
<h2 class="heading1" id="_idParaDest-24">Managing packages</h2>
<p class="normal1">The<a id="_idIndexMarker017" class="calibre3"/> headline <code class="inlinecode">npm</code> feature is the management <a id="_idIndexMarker018" class="calibre3"/>of the packages used in a project. This may not seem like a big deal, but one compelling aspect of Node.js development is the immense library of open-source packages, which are available in a public registry (<a href="http://npmjs.com" class="calibre3">npmjs.com</a>). <code class="inlinecode">npm</code> provides access to the registry, takes care of downloading and installing packages, and manages dependencies between packages to avoid conflicts.</p>
<p class="normal">Packages are added to the project <a id="_idIndexMarker019" class="calibre3"/>with the <code class="inlinecode">npm install</code> command. Run the command shown in <em class="italic">Listing 2.7</em> in the <code class="inlinecode">tools</code> folder to add a package to the example project:</p>
<p class="packt_figref">Listing 2.7: Adding a package</p>
<pre class="programlisting1"><code class="hljs-con">npm install bootstrap@5.3.0
</code></pre>
<p class="normal">The <code class="inlinecode">npm install</code> command adds a package to the project and the argument specifies the name of the package (<code class="inlinecode">bootstrap</code>, in this case), followed by the <code class="inlinecode">@</code> character, followed by a version number. You can omit the <code class="inlinecode">@</code> character and the version number, in which case, the latest version will be installed, but it is good practice to be specific when installing a package.</p>
<p class="normal">The <a id="_idIndexMarker020" class="calibre3"/>command in <em class="italic">Listing 2.7</em> adds the excellent Bootstrap CSS/JavaScript package to the project. As part of this process, <code class="inlinecode">npm</code> looks at the packages that Bootstrap depends <a id="_idIndexMarker021" class="calibre3"/>on and installs them, too. Once the command has completed, you will see a new section in the <code class="inlinecode">package.json</code> file:</p>
<pre class="programlisting"><code class="hljs-code">{
  "name": "tools",
  "version": "1.0.0",
  "description": "",
  "main": "hello.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
<strong class="screentext">  "dependencies": {</strong>
<strong class="screentext">    "bootstrap": "^5.3.0"</strong>
<strong class="screentext">  }</strong>
}
</code></pre>
<p class="normal">The <code class="inlinecode">dependencies</code> section is used to keep track of the packages used in the project. The version number in the <code class="inlinecode">packages.json</code> file is prefixed with a caret (the <code class="inlinecode">^</code> character), which is part of the <code class="inlinecode">npm</code> system for specifying ranges of version numbers, as described in <em class="italic">Table 2.3</em>:</p>
<table class="table-container" id="table003">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Name</p>
</td>
<td class="table-cell">
<p class="normal">Description</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode3">*</code></p>
</td>
<td class="table-cell">
<p class="normal">Using an asterisk accepts any version of the package to be installed.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode3">5.3.0</code></p>
</td>
<td class="table-cell">
<p class="normal">Expressing a version number directly will accept only the package with the exact matching version number, e.g., <code class="inlinecode">5.3.0</code>.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode4">&gt;5.3.0</code> <code class="inlinecode5">&gt;=3.3.0</code></p>
</td>
<td class="table-cell">
<p class="normal">Prefixing a version number with <code class="inlinecode">&gt;</code> or <code class="inlinecode">&gt;=</code> accepts any version of the package that is greater than or equal to a given version.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode4">&lt;5.3.0</code> <code class="inlinecode5">&lt;=5.3.0</code></p>
</td>
<td class="table-cell">
<p class="normal">Prefixing a version number with <code class="inlinecode">&lt;</code> or <code class="inlinecode">&lt;=</code> accepts any version of the package that is less than or equal to a given version.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode3">~5.3.0</code></p>
</td>
<td class="table-cell">
<p class="normal">Prefixing a version number with a tilde (the <code class="inlinecode">~</code> character) accepts versions to be installed even if the patch level number (the last of the three version numbers) doesn’t match. For example, specifying <code class="inlinecode">~5.3.0</code> will accept version <code class="inlinecode">5.3.1</code> or <code class="inlinecode">5.3.2</code> (which would contain patches to version <code class="inlinecode">5.3.0</code>) but not version <code class="inlinecode">5.4.0</code> (which would be a new minor release).</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><code class="inlinecode3">^5.3.0</code></p>
</td>
<td class="table-cell">
<p class="normal">Prefixing a version number with a caret (the <code class="inlinecode">^</code> character) will accept versions even if the minor release number (the second of the three version numbers) or the patch number doesn’t match. For example, specifying <code class="inlinecode">^5.3.0</code> will allow versions <code class="inlinecode">5.4.0</code> and <code class="inlinecode">5.5.0</code> but not version <code class="inlinecode">6.0.0</code>.</p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 2.3: <code class="inlinecode2">npm</code> version numbers</p>
<div><p class="normal"><strong class="screentext">Using exact version numbers</strong></p>
<p class="normal">When I specified <code class="inlinecode">bootstrap@5.3.0</code> in <em class="italic">Listing 2.7</em>, <code class="inlinecode">npm</code> gave itself some wiggle room by interpreting the version as <code class="inlinecode">^5.3.0</code>. The process of resolving dependencies and conflicts between packages is a complex process, which is made easier by broadening the range of acceptable versions. This approach relies on the idea that version <code class="inlinecode">5.4.0</code>, say, will be compatible with version <code class="inlinecode">5.3.0</code> and won’t contain breaking changes.</p>
<p class="normal">If you can’t rely on packages to maintain compatibility, then you can configure <code class="inlinecode">npm</code> to use exact version numbers by running this command:</p>
<pre class="programlisting2"><code class="hljs-code"><code class="inlinecode2">npm config set save-exact false</code>
</code></pre>
<p class="normal"><code class="inlinecode">npm</code> will only use the versions that you specify, but the trade-off is that resolving dependencies and version conflicts between packages may be more difficult.</p>
</div>
<p class="normal">Packages <a id="_idIndexMarker022" class="calibre3"/>are stored in the <code class="inlinecode">node_modules</code> folder, which is created automatically. <code class="inlinecode">npm</code> creates a<a id="_idIndexMarker023" class="calibre3"/> folder for each package that it downloads, and there can be a large number of folders as packages and their dependencies are resolved.</p>
<p class="normal">To ensure that dependencies are resolved consistently, <code class="inlinecode">npm</code> creates the <code class="inlinecode">package-lock.json</code> file, which contains a complete list of the packages that have been installed, along with specific version numbers.</p>
<h3 class="heading2" id="_idParaDest-25">Installing development packages</h3>
<p class="normal1">The <code class="inlinecode">dependencies</code> section of the <code class="inlinecode">package.json</code> file is for the packages that the application<a id="_idIndexMarker024" class="calibre3"/> needs to run. The <code class="inlinecode">npm</code> command<a id="_idIndexMarker025" class="calibre3"/> can also be used to add packages that are only required during development, such as compilers and debuggers. Run the command shown in <em class="italic">Listing 2.8</em> in the <code class="inlinecode">tools</code> folder to add development packages to the project:</p>
<p class="packt_figref">Listing 2.8: Adding a development package to the example project</p>
<pre class="programlisting1"><code class="hljs-con">npm install --save-dev typescript@5.2.2 tsc-watch@6.0.4
</code></pre>
<p class="normal">The <code class="inlinecode">--save-dev</code> argument specifies a development package, and this command installs two packages that are required only during development. The <code class="inlinecode">typescript</code> package includes the TypeScript compiler, which is used to compile TypeScript code into JavaScript that can be executed by Node.js. The <code class="inlinecode">tsc-watch</code> package is a useful add-on that monitors TypeScript files for changes and automatically compiles and executes them.</p>
<p class="normal">Examine the <code class="inlinecode">package.json</code> file and you will see a new configuration section:</p>
<pre class="programlisting"><code class="hljs-code">{
  "name": "tools",
  "version": "1.0.0",
  "description": "",
  "main": "hello.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    "start": "tsc message.ts"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "bootstrap": "^5.3.0"
  },
<strong class="screentext">  "devDependencies": {</strong>
<strong class="screentext">    "tsc-watch": "</strong><strong class="screentext">^6.0.4",</strong>
<strong class="screentext">    "typescript": "^5.2.2"</strong>
<strong class="screentext">  }</strong>
}
</code></pre>
<p class="normal">The <code class="inlinecode">devDependencies</code> section keeps track of the development packages, which don’t need<a id="_idIndexMarker026" class="calibre3"/> to be included when the application is prepared for deployment. The new section contains entries for the packages specified by the command in <em class="italic">Listing 2.8</em>.</p>
<div><p class="normal"><strong class="screentext">Choosing packages and tools</strong></p>
<p class="normal">JavaScript benefits from a broad and dynamic ecosystem of open-source packages that solve just about any problem you might encounter. There is so much choice that it can be difficult to decide which packages to use, especially since there is a constant flow of online articles claiming that a particular new package is a hot way to build applications.</p>
<p class="normal">The sad fact is most projects die from a lack of support. Someone, somewhere, becomes frustrated with the way that a particular package works and decides to write their own replacement. They realize that other people may benefit and altruistically decide to publish their code for anyone to use. Most of the time, that’s the end of the story, either because not many other people encounter the same frustrations or because the new package solves the problem in a way that doesn’t suit other projects.</p>
<p class="normal">In many ways, that’s the best outcome – at least for the original developer – because as soon as a package starts to get users, the developer will start to get demands for fixes, features, and general support. The idea of open-source packages is that everyone pitches in, but that often doesn’t happen. The burdens on the package developer can be substantial, user demands can be endless and aggressive, and the amount of – unpaid – work can get out of hand. Many packages that start to become popular are abandoned at this point because the original developer can’t cope with the maintenance and no one pitches in to help.</p>
</div>
<div><p class="normal"> A small number of packages make it past this point. The original developer successfully enlists help in fixing problems and writing new features and puts the package onto a project-like footing. The original developer may move on to other projects, but the package becomes important enough that someone else is willing to take on the task and the project continues. At this point, the package matures, can be widely used, and almost always becomes the unfashionable approach that attracts the ire of all those online articles.</p>
<p class="normal">My advice is to choose packages that suit the type of project you are working on. For mainstream commercial development, I recommend using packages that have made it past these hurdles and become well-established and well-maintained. These are the packages that have high weekly download numbers (which you can see on <code class="inlinecode">npm.js</code>), which are updated regularly, and have an engaged team that responds to issues and queries. These are the packages that will continue to be supported throughout the life of <em class="italic">your</em> project, allowing you to deliver your features on a solid platform. It is this type of package that I have used throughout this book.</p>
<p class="normal">For hobby and experimental projects, I recommend using the less well-established packages. These won’t be as well-supported and you will encounter more problems and do more work to get everything working, but you will learn more, and you may have more fun.</p>
<p class="normal">Regardless of how you choose packages, remember that you are benefiting from the altruism of others. If you can, then contribute to the packages you use. Just about every package has a list of bugs waiting to be fixed, which is a good way to get involved. If you don’t feel confident contributing code, then consider making a financial contribution. Many projects accept donations, and even the largest and most widely used packages are managed by foundations that welcome individual and corporate supporters.</p>
</div>
<h3 class="heading2" id="_idParaDest-26">Listing packages</h3>
<p class="normal1">You may <a id="_idIndexMarker027" class="calibre3"/>only rely on a small number of packages in a <a id="_idIndexMarker028" class="calibre3"/>project but each of those packages has dependencies and it is easy to end up with hundreds of small packages in a project, each of which contributes a small amount of functionality. To see the set of packages that have been added to the project, run the command shown in <em class="italic">Listing 2.9</em> in the <code class="inlinecode">tools</code> folder:</p>
<p class="packt_figref">Listing 2.9: Listing the installed packages</p>
<pre class="programlisting1"><code class="hljs-con">npm list
</code></pre>
<p class="normal">The <a id="_idIndexMarker029" class="calibre3"/>output corresponds to the <code class="inlinecode">npm install</code> commands used in earlier sections of this chapter, although you may see slightly different version numbers:</p>
<pre class="programlisting1"><code class="hljs-con">+-- bootstrap@5.3.0
+-- tsc-watch@6.0.4
`-- typescript@5.2.2
</code></pre>
<p class="normal">Behind<a id="_idIndexMarker030" class="calibre3"/> the scenes, <code class="inlinecode">npm</code> has inspected these packages to discover their dependencies and installed those packages as well, which can be seen by running the command shown in <em class="italic">Listing 2.10</em> in the <code class="inlinecode">tools</code> folder:</p>
<p class="packt_figref">Listing 2.10: Listing packages and dependencies</p>
<pre class="programlisting1"><code class="hljs-con">npm list --all
</code></pre>
<p class="normal">The <code class="inlinecode">--all</code> argument tells <code class="inlinecode">npm</code> to list dependencies as well and produces output similar to the following, although you may see different details:</p>
<pre class="programlisting1"><code class="hljs-con">+-- bootstrap@5.3.0
+-- tsc-watch@6.0.4
| +-- cross-spawn@7.0.3
| | +-- path-key@3.1.1
| | +-- shebang-command@2.0.0
| | | `-- shebang-regex@3.0.0
| | `-- which@2.0.2
| |   `-- isexe@2.0.0
| +-- node-cleanup@2.1.2
| +-- ps-tree@1.2.0
| | `-- event-stream@3.3.4
| |   +-- duplexer@0.1.2
| |   +-- from@0.1.7
| |   +-- map-stream@0.1.0
| |   +-- pause-stream@0.0.11
| |   | `-- through@2.3.8 deduped
| |   +-- split@0.3.3
| |   | `-- through@2.3.8 deduped
| |   +-- stream-combiner@0.0.4
| |   | `-- duplexer@0.1.2 deduped
| |   `-- through@2.3.8
| +-- string-argv@0.3.2
| `-- typescript@5.2.2 deduped
`-- typescript@5.2.2
</code></pre>
<p class="normal">You may see <a id="_idIndexMarker031" class="calibre3"/>small differences when you run this command. Most <a id="_idIndexMarker032" class="calibre3"/>projects rely on a deep tree of packages, and <code class="inlinecode">npm</code> takes care of resolving the dependencies for each of them and automatically downloading all the packages that are required.</p>
<h3 class="heading2" id="_idParaDest-27">Checking for package security vulnerabilities</h3>
<p class="normal1">The<a id="_idIndexMarker033" class="calibre3"/> large number of JavaScript packages in a project makes it difficult to know exactly which packages you are using and whether those packages may have reported security vulnerabilities.</p>
<p class="normal">To address<a id="_idIndexMarker034" class="calibre3"/> this issue, package repositories maintain a list of known problems. As <code class="inlinecode">npm</code> resolves package dependencies, it checks all of the packages that it is installing against the vulnerabilities list and emits a warning if it finds any problems. As an example, here is a command that installs a package whose dependencies contain a vulnerability:</p>
<pre class="programlisting1"><code class="hljs-con">npm install --save-dev nodemon@2.0.20
</code></pre>
<p class="normal">This command may not have the same effect by the time this book is published because of the dynamic nature of JavaScript package dependencies, but when I ran this command, I received the following response:</p>
<pre class="programlisting1"><code class="hljs-con">added 32 packages, and audited 54 packages in 3s
5 packages are looking for funding
  run `npm fund` for details
<strong class="screentext">3 moderate severity vulnerabilities</strong>
</code></pre>
<p class="normal"><code class="inlinecode">npm</code> has identified three security issues in the packages that have been installed. For more details, I ran this command:</p>
<pre class="programlisting1"><code class="hljs-con">npm audit
</code></pre>
<p class="normal">The <code class="inlinecode">npm audit</code> command<a id="_idIndexMarker035" class="calibre3"/> reports on potential problems. In this case, there is an issue with <a id="_idIndexMarker036" class="calibre3"/>versions 7.0.0 to 7.5.1 with a package named <code class="inlinecode">semver</code>:</p>
<pre class="programlisting1"><code class="hljs-con"># npm audit report
semver  7.0.0 - 7.5.1
Severity: moderate
semver vulnerable to Regular Expression Denial of Service - https://github.com/advisories/GHSA-c2qf-rxjj-qqgw
fix available via `npm audit fix --force`
Will install nodemon@3.0.1, which is a breaking change
node_modules/simple-update-notifier/node_modules/semver
  simple-update-notifier  1.0.7 - 1.1.0
  Depends on vulnerable versions of semver
  node_modules/simple-update-notifier
    nodemon  2.0.19 - 2.0.22
    Depends on vulnerable versions of simple-update-notifier
    node_modules/nodemon
3 moderate severity vulnerabilities
</code></pre>
<p class="normal">The output provides a URL where details can be found and the suggestion that installing a later version of the top-level package – the one added by the <code class="inlinecode">npm install</code> command – would fix the problem, albeit by introducing a breaking change that may stop existing code from working.</p>
<p class="normal">There is an <code class="inlinecode">npm audit fix</code> command that attempts to move to fixed versions of packages but that can cause problems with deeply nested dependencies and should be used with caution.</p>
<p class="normal">For the packages used in this book, you should use the versions I have specified, even if there are warnings about security vulnerabilities, to ensure the examples work as expected. For real projects, you should assess each reported vulnerability and figure out whether moving to a patched package is possible without breaking code. It won’t always be possible to move away from all vulnerable <a id="_idIndexMarker037" class="calibre3"/>packages without making corresponding changes in the project, and only you can decide what is sensible for your projects.</p>
<p class="normal">To be clear, I am <a id="_idIndexMarker038" class="calibre3"/>not advising you to ignore security warnings. I am saying that not all warnings are for problems that are likely to occur in all projects and there will be times when you might decide to stick with a vulnerable package because the risk to your project is low and the amount of work required to upgrade a package is substantial. You might also form the view that problems with developer packages are less of a risk because those packages are not included when the project is deployed.</p>
<h2 class="heading1" id="_idParaDest-28">Executing packages</h2>
<p class="normal1">Some <a id="_idIndexMarker039" class="calibre3"/>packages include shell scripts that can be used to <a id="_idIndexMarker040" class="calibre3"/>execute the package features, and these are installed in the <code class="inlinecode">node_modules/.bin</code> folder. The package added in <em class="italic">Listing 2.10</em>, for example, includes a <code class="inlinecode">tsc</code> script, which starts the TypeScript compiler. Add a file named <code class="inlinecode">message.ts</code> to the <code class="inlinecode">tools</code> folder, with the content shown in <em class="italic">Listing 2.11</em>. (The <code class="inlinecode">ts</code> file extension denotes a TypeScript file.)</p>
<p class="packt_figref">Listing 2.11: The contents of the message.ts file in the tools folder</p>
<pre class="programlisting"><code class="hljs-code">function writeMessage(msg: string) {
    console.log(`Message: ${msg}`);
}
writeMessage("This is the message");
</code></pre>
<p class="normal">TypeScript code has to be compiled into pure JavaScript before it can be executed by Node.js. I describe this process in more detail in <em class="italic">Chapter 3</em>, but for this chapter, it is enough to know that I need to use the <code class="inlinecode">tsc</code> command provided by the package added to the project in <em class="italic">Listing 2.8</em>.</p>
<p class="normal">The first step<a id="_idIndexMarker041" class="calibre3"/> is to add the folder that contains the scripts to the path used to search for commands. Execute the command shown in <em class="italic">Listing 2.12</em> if you are using PowerShell, which is what I use for development on Windows machines:</p>
<p class="packt_figref">Listing 2.12: Setting the path in powershell</p>
<pre class="programlisting1"><code class="hljs-con">$env:path += ';.\node_modules\.bin'
</code></pre>
<p class="normal"><em class="italic">Listing 2.13</em> shows<a id="_idIndexMarker042" class="calibre3"/> the equivalent command for the Bourne shell, which is commonly encountered on Linux machines:</p>
<p class="packt_figref">Listing 2.13: Setting the path in the bourne shell</p>
<pre class="programlisting1"><code class="hljs-con">PATH=$PATH:./node_modules/.bin/
</code></pre>
<p class="normal">Packages that provide shell scripts generally support a range of command shells. For its compiler, the <code class="inlinecode">typescript</code> package adds three files to the <code class="inlinecode">node_modules/.bin</code> folder: <code class="inlinecode">tsc</code> (which supports the Bourne shell), <code class="inlinecode">tsc.ps1</code> (which supports PowerShell), and <code class="inlinecode">tsc.cmd</code> (which supports the older Windows Command Prompt).</p>
<p class="normal">These are not the only script files added to the <code class="inlinecode">.bin</code> folder. The <code class="inlinecode">typescript</code> package also adds scripts for the <code class="inlinecode">tsserver</code> command, which is used to integrate TypeScript into development tools, such as editors, but which is not required for this book. Entries are added by other packages as <code class="inlinecode">npm</code> installs packages and resolves dependencies.</p>
<p class="normal">Run the command shown in <em class="italic">Listing 2.14</em> in the <code class="inlinecode">tools</code> folder to run the compiler:</p>
<p class="packt_figref">Listing 2.14: Running a package command</p>
<pre class="programlisting1"><code class="hljs-con">tsc message.ts
</code></pre>
<p class="normal">The command won’t produce any messages but it does create a file named <code class="inlinecode">message.js</code> in the <code class="inlinecode">tools</code> folder, with the following content:</p>
<pre class="programlisting"><code class="hljs-code">...
function writeMessage(msg) {
    console.log("Message: ".concat(msg));
}
writeMessage("This is the message");
...
</code></pre>
<p class="normal">Run the <a id="_idIndexMarker043" class="calibre3"/>command shown in <em class="italic">Listing 2.15</em> in the <code class="inlinecode">tools</code> folder to execute the compiled JavaScript code using Node.js:</p>
<p class="packt_figref">Listing 2.15: Executing JavaScript code</p>
<pre class="programlisting1"><code class="hljs-con">node message.js
</code></pre>
<p class="normal">The Node.js runtime<a id="_idIndexMarker044" class="calibre3"/> executes the code in the file created by the TypeScript compiler, producing the following output:</p>
<pre class="programlisting1"><code class="hljs-con">Message: This is the message
</code></pre>
<h3 class="heading2" id="_idParaDest-29">Using the npx command</h3>
<p class="normal1">Not all <a id="_idIndexMarker045" class="calibre3"/>packages install scripts, and another way to execute package features is to use the <code class="inlinecode">npx</code> command. Each package added to the <code class="inlinecode">node_modules</code> folder has its own <code class="inlinecode">package.json</code> file. In addition to keeping track of the package’s dependencies, the <code class="inlinecode">package.json</code> file defines a <code class="inlinecode">bin</code> section that defines the commands that <code class="inlinecode">npx</code> can execute. For the package added in <em class="italic">Listing 2.8</em>, the <code class="inlinecode">package.json</code> file can be found in the <code class="inlinecode">node_modules/typescript</code> folder and it contains this <code class="inlinecode">bin</code> section:</p>
<pre class="programlisting"><code class="hljs-code">...
"bin": {
    "tsc": "./bin/tsc",
    "tsserver": "./bin/tsserver"
},
...
</code></pre>
<p class="normal">The entries in the <code class="inlinecode">bin</code> section define a command and a JavaScript file that will be executed by that command. The <code class="inlinecode">typescript</code> package defines <code class="inlinecode">bin</code> entries for <code class="inlinecode">tsc</code> and <code class="inlinecode">tsserver</code> commands, which correspond to the shell scripts used in the previous section. Run the command shown in <em class="italic">Listing 2.16</em> in the <code class="inlinecode">tools</code> folder to execute the TypeScript compiler using <code class="inlinecode">npx</code>:</p>
<p class="packt_figref">Listing 2.16: Executing the TypeScript compiler</p>
<pre class="programlisting1"><code class="hljs-con">npx tsc message.ts
</code></pre>
<p class="normal">This command<a id="_idIndexMarker046" class="calibre3"/> has the same effect as the one in <em class="italic">Listing 2.14</em>. When multiple packages define commands with the same name, the <code class="inlinecode">--package</code> argument can be used, as shown in <em class="italic">Listing 2.17</em>:</p>
<p class="packt_figref">Listing 2.17: Specifying a package</p>
<pre class="programlisting1"><code class="hljs-con">npx --package=typescript tsc message.ts
</code></pre>
<p class="normal">If the package that contains the command isn’t installed, then the <code class="inlinecode">npx</code> command will download the package into a cache folder and then execute the command.</p>
<h2 class="heading1" id="_idParaDest-30">Using script commands</h2>
<p class="normal1"><code class="inlinecode">npm</code> supports<a id="_idIndexMarker047" class="calibre3"/> a set of commands that are customized by adding entries to the <code class="inlinecode">scripts</code> section of the <code class="inlinecode">package.json</code> file. This <a id="_idIndexMarker048" class="calibre3"/>can feel a little odd at first, but it is a powerful way to use the features provided by JavaScript packages concisely and consistently. <code class="inlinecode">npm</code> supports the following basic commands:</p>
<ul class="calibre4">
<li class="bulletlist"><code class="inlinecode">start</code></li>
<li class="bulletlist1"><code class="inlinecode">stop</code></li>
<li class="bulletlist1"><code class="inlinecode">restart</code></li>
<li class="bulletlist1"><code class="inlinecode">test</code></li>
</ul>
<p class="normal">Projects won’t always need every command, and there are no firm rules for how these commands can be used, but the convention is to use the <code class="inlinecode">start</code> command to start the development tools and use the <code class="inlinecode">test</code> command to run unit tests, which I describe in <em class="italic">Chapter 8</em>.</p>
<p class="normal"><em class="italic">Listing 2.18</em> adds an entry to the <code class="inlinecode">scripts</code> section:</p>
<p class="packt_figref">Listing 2.18: Configuring a command in the package.Json file in the tools folder</p>
<pre class="programlisting"><code class="hljs-code">{
  "name": "tools",
  "version": "1.0.0",
  "description": "",
  "main": "hello.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    <strong class="screentext">"start"</strong><strong class="screentext">: "tsc-watch message.ts --onSuccess \"node message.js\""</strong>  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "bootstrap": "^5.3.0"
  },
  "devDependencies": {
    "tsc-watch": "^6.0.4",
    "typescript": "^5.2.2"
  }
}
</code></pre>
<p class="normal">Each <a id="_idIndexMarker049" class="calibre3"/>entry in the <code class="inlinecode">scripts</code> section consists of a <a id="_idIndexMarker050" class="calibre3"/>command name and an associated action. The action associated with the <code class="inlinecode">start</code> command in <em class="italic">Listing 2.18</em> runs the <code class="inlinecode">tsc-watch</code> command, which is a wrapper around the TypeScript compiler that watches TypeScript files for changes and can be configured to execute a command when compilation is successful. (The <code class="inlinecode">test</code> command was added automatically when the <code class="inlinecode">package.json</code> file was created and just prints out an error message.)</p>
<p class="normal">I could run the <code class="inlinecode">tsc-watch</code> command directly from the command line, either using the shell scripts the package added to the <code class="inlinecode">node_modules/.bin</code> folder or with the <code class="inlinecode">npx</code> command, but as commands get more complex, it becomes more difficult to remember the syntax and enter them correctly. The new entry in the <code class="inlinecode">package.json</code> file lets me define the command once and then always invoke it consistently. Run the command shown in <em class="italic">Listing 2.19</em> in the <code class="inlinecode">tools</code> folder:</p>
<p class="packt_figref">Listing 2.19: Running a script command</p>
<pre class="programlisting1"><code class="hljs-con">npm start
</code></pre>
<p class="normal">The <code class="inlinecode">npm start</code> command tells <code class="inlinecode">npm</code> to perform the <code class="inlinecode">start</code> action defined in the <code class="inlinecode">package.json</code> file, producing the following output:</p>
<pre class="programlisting1"><code class="hljs-con">09:19:15 - Starting compilation in watch mode...
09:19:16 - Found 0 errors. Watching for file changes.
Message: This is the message
</code></pre>
<p class="normal"><em class="italic">Listing 2.20</em> makes a small change to the TypeScript file:</p>
<p class="packt_figref">Listing 2.20: Making a change in the message.ts file in the tools folder</p>
<pre class="programlisting"><code class="hljs-code">function writeMessage(msg: string) {
    console.log(`Message: ${msg}`);
}
<strong class="screentext">writeMessage("This is the new message");</strong>
</code></pre>
<p class="normal">When <a id="_idIndexMarker051" class="calibre3"/>you save the altered file, the change is<a id="_idIndexMarker052" class="calibre3"/> detected, the TypeScript file is compiled, and Node.js is used to execute the JavaScript, producing the following output:</p>
<pre class="programlisting1"><code class="hljs-con">...
Message: This is the new message
...
</code></pre>
<p class="normal">Most web application project development depends on tools that run continuously, monitoring files for changes, and this is a pattern that I will follow throughout this book. Use <em class="italic">Control+C</em> to stop the command once you have seen the output.</p>
<h3 class="heading2" id="_idParaDest-31">Defining custom commands</h3>
<p class="normal1">In<a id="_idIndexMarker053" class="calibre3"/> addition to the built-in commands, <code class="inlinecode">npm</code> supports <a id="_idIndexMarker054" class="calibre3"/>custom commands as well, as shown in <em class="italic">Listing 2.21</em>:</p>
<p class="packt_figref">Listing 2.21: Defining a custom script command in the package.json file in the tools folder</p>
<pre class="programlisting"><code class="hljs-code">...
"scripts": {
  "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
  "start": "tsc-watch message.ts --onSuccess \"node message.js\"",
  <strong class="screentext">"go": "tsc message.ts &amp;&amp; node message.js"</strong>
},
...
</code></pre>
<p class="normal">The name of the new command is <code class="inlinecode">go</code> and it compiles the <code class="inlinecode">message.ts</code> TypeScript file and then uses Node.js to execute the compiled JavaScript.</p>
<div><p class="normal"><strong class="screentext">Tip</strong></p>
<p class="normal">Commands separated by <code class="inlinecode">&amp;&amp;</code> are executed sequentially. Commands separated by a single <code class="inlinecode">&amp;</code> are executed in parallel.</p>
</div>
<p class="normal">Custom commands are executed with <code class="inlinecode">npm run</code>, as shown in <em class="italic">Listing 2.22</em>:</p>
<p class="packt_figref">Listing 2.22: Executing a custom script command</p>
<pre class="programlisting1"><code class="hljs-con">npm run go
</code></pre>
<p class="normal">The name<a id="_idIndexMarker055" class="calibre3"/> of the custom command follows <code class="inlinecode">npm run</code>, so that <code class="inlinecode">npm run go</code> executes the custom <code class="inlinecode">go</code> command, producing the following output:</p>
<pre class="programlisting1"><code class="hljs-con">Message: This is the new message
</code></pre>
<h1 class="heading" id="_idParaDest-32">Summary</h1>
<p class="normal1">In this chapter, I explained the simple setup process to prepare for this book and introduced the core Node.js tools:</p>
<ul class="calibre4">
<li class="bulletlist">Node.js development requires the Node.js installer, the Git version control system, and a JavaScript/TypeScript code editor, such as Visual Studio Code.</li>
<li class="bulletlist1">JavaScript files are executed with the <code class="inlinecode">node</code> command.</li>
<li class="bulletlist1">Much of the functionality provided by Node.js is presented through the API it provides, which is the topic of this book.</li>
<li class="bulletlist1">The <strong class="screentext">node package manager</strong> (<strong class="screentext">npm</strong>) is used to download JavaScript packages, execute commands, run development tools, and start unit tests.</li>
</ul>
<p class="normal">In the next chapter, I will provide a primer that describes the essential JavaScript and TypeScript features that are required to follow the examples in this book.</p>
</div>
</body></html>