<html><head></head><body>
<div class="calibre1" id="_idContainer119">
<h1 class="chapternumber"><span class="kobospan" id="kobo.1.1">9</span></h1>
<h1 class="chaptertitle" id="_idParaDest-163"><span class="kobospan" id="kobo.2.1">Creating the Example Project</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.3.1">In this chapter, I create the example project that is used throughout this part of the book, using the features described in </span><em class="italic"><span class="kobospan" id="kobo.4.1">Part 1</span></em><span class="kobospan" id="kobo.5.1">. </span><span class="kobospan" id="kobo.5.2">In later chapters, I’ll start to add new features, but this chapter is all about building the foundation.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.6.1">Tip</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.7.1">You can download the example project for this chapter – and for all the other chapters in this book – from </span><a href="https://github.com/PacktPublishing/Mastering-Node.js-Web-Development" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.8.1">https://github.com/PacktPublishing/Mastering-Node.js-Web-Development</span></span></a><span class="kobospan" id="kobo.9.1">. </span><span class="kobospan" id="kobo.9.2">See </span><em class="italic"><span class="kobospan" id="kobo.10.1">Chapter 1</span></em><span class="kobospan" id="kobo.11.1"> for how to get help if you have problems running the examples.</span></p>
</div>
<h1 class="heading" id="_idParaDest-164"><span class="kobospan" id="kobo.12.1">Understanding the project</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.13.1">The example project </span><a id="_idIndexMarker451" class="calibre3"/><span class="kobospan" id="kobo.14.1">will use the features and packages introduced in </span><em class="italic"><span class="kobospan" id="kobo.15.1">Part 1</span></em><span class="kobospan" id="kobo.16.1"> of this book. </span><span class="kobospan" id="kobo.16.2">The backend server will be written in TypeScript and the code files will be in the </span><code class="inlinecode"><span class="kobospan" id="kobo.17.1">src/server</span></code><span class="kobospan" id="kobo.18.1"> folder. </span><span class="kobospan" id="kobo.18.2">The TypeScript compiler will write JavaScript files to the </span><code class="inlinecode"><span class="kobospan" id="kobo.19.1">dist/server</span></code><span class="kobospan" id="kobo.20.1"> folder, where they will be executed by the Node.js runtime, which will listen for HTTP requests on port </span><code class="inlinecode"><span class="kobospan" id="kobo.21.1">5000</span></code><span class="kobospan" id="kobo.22.1">, as shown in </span><em class="italic"><span class="kobospan" id="kobo.23.1">Figure 9.1</span></em><span class="kobospan" id="kobo.24.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.25.1"><img alt="" src="../Images/B21959_09_01.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.26.1">Figure 9.1: The backend server</span></p>
<p class="normal"><span class="kobospan" id="kobo.27.1">The client-side part of the application will be simpler than the backend and used only to send requests and process responses to demonstrate server-side features. </span><span class="kobospan" id="kobo.27.2">The</span><a id="_idIndexMarker452" class="calibre3"/><span class="kobospan" id="kobo.28.1"> client-side code will be written in JavaScript and packaged into a bundle using webpack. </span><span class="kobospan" id="kobo.28.2">The bundle will be served by the webpack development server, which will listen for HTTP requests on port 5100, as shown in </span><em class="italic"><span class="kobospan" id="kobo.29.1">Figure 9.2</span></em><span class="kobospan" id="kobo.30.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.31.1"><img alt="" src="../Images/B21959_09_02.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.32.1">Figure 9.2: Adding the client-side part of the project</span></p>
<p class="normal"><span class="kobospan" id="kobo.33.1">The browser will make requests to the backend server on port 5000. </span><span class="kobospan" id="kobo.33.2">The Express router will be used to match requests to handler functions, starting with a single </span><code class="inlinecode"><span class="kobospan" id="kobo.34.1">/test</span></code><span class="kobospan" id="kobo.35.1"> URL just to get started. </span><span class="kobospan" id="kobo.35.2">Requests for static content, such as HTML files and images, will be served from the </span><code class="inlinecode"><span class="kobospan" id="kobo.36.1">static</span></code><span class="kobospan" id="kobo.37.1"> folder, using the Express </span><code class="inlinecode"><span class="kobospan" id="kobo.38.1">static</span></code><span class="kobospan" id="kobo.39.1"> middleware component.</span></p>
<p class="normal"><span class="kobospan" id="kobo.40.1">All other requests</span><a id="_idIndexMarker453" class="calibre3"/><span class="kobospan" id="kobo.41.1"> will be forwarded to the webpack server, which will allow the client-side bundle to be requested and allow the live reload feature to work, as shown in </span><em class="italic"><span class="kobospan" id="kobo.42.1">Figure 9.3</span></em><span class="kobospan" id="kobo.43.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.44.1"><img alt="" src="../Images/B21959_09_03.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.45.1">Figure 9.3: Routing requests</span></p>
<h1 class="heading" id="_idParaDest-165"><span class="kobospan" id="kobo.46.1">Creating the project</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.47.1">Open a </span><a id="_idIndexMarker454" class="calibre3"/><span class="kobospan" id="kobo.48.1">new command prompt, navigate to a convenient location, and create a folder named </span><code class="inlinecode"><span class="kobospan" id="kobo.49.1">part2app</span></code><span class="kobospan" id="kobo.50.1">. </span><span class="kobospan" id="kobo.50.2">Navigate to the </span><code class="inlinecode"><span class="kobospan" id="kobo.51.1">part2app</span></code><span class="kobospan" id="kobo.52.1"> folder and run the command shown in </span><em class="italic"><span class="kobospan" id="kobo.53.1">Listing 9.1</span></em><span class="kobospan" id="kobo.54.1"> to initialize the project and create the </span><code class="inlinecode"><span class="kobospan" id="kobo.55.1">package.json</span></code><span class="kobospan" id="kobo.56.1"> file.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.57.1">Listing 9.1: Initializing the project</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.58.1">npm init -y
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.59.1">In the sections that follow, I go through the process of creating the different parts of the project, starting with the backend server. </span><span class="kobospan" id="kobo.59.2">I start by installing the JavaScript packages each part of the application requires, all of which were introduced in </span><em class="italic"><span class="kobospan" id="kobo.60.1">Part 1</span></em><span class="kobospan" id="kobo.61.1"> of this book.</span></p>
<h2 class="heading1" id="_idParaDest-166"><span class="kobospan" id="kobo.62.1">Installing the application packages</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.63.1">The </span><a id="_idIndexMarker455" class="calibre3"/><span class="kobospan" id="kobo.64.1">application packages are those whose features are incorporated into either the backend server or the client-side code. </span><em class="italic"><span class="kobospan" id="kobo.65.1">Table 9.1</span></em><span class="kobospan" id="kobo.66.1"> describes the application packages used in this chapter.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.67.1">Table 9.1: The application packages used in this chapter</span></p>
<table class="table-container" id="table001-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.68.1">Name</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.69.1">Description</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.70.1">bootstrap</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.71.1">This package contains CSS styles and JavaScript code to style the client-side content.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.72.1">express</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.73.1">This package contains enhancements to the Node.js API to simplify HTTP request handling.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.74.1">helmet</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.75.1">This package sets security-related headers in HTTP responses.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.76.1">http-proxy</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.77.1">This package forwards HTTP requests and will be used to connect the backend server to the webpack development server.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="normal"><span class="kobospan" id="kobo.78.1">To install these packages, run the commands shown in </span><em class="italic"><span class="kobospan" id="kobo.79.1">Listing 9.2</span></em><span class="kobospan" id="kobo.80.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.81.1">part2app</span></code><span class="kobospan" id="kobo.82.1"> folder.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.83.1">Listing 9.2: Installing the application packages</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.84.1">npm install bootstrap@5.3.2
npm install express@4.18.2
npm install helmet@7.1.0
npm install http-proxy@1.18.1
</span></code></pre>
<h2 class="heading1" id="_idParaDest-167"><span class="kobospan" id="kobo.85.1">Installing the development tool packages</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.86.1">The </span><a id="_idIndexMarker456" class="calibre3"/><span class="kobospan" id="kobo.87.1">development tool packages provide features that are used during development but are not included when the application is deployed. </span><em class="italic"><span class="kobospan" id="kobo.88.1">Table 9.2</span></em><span class="kobospan" id="kobo.89.1"> describes the tool packages used in this chapter.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.90.1">Table 9.2: The development tool packages used in this chapter</span></p>
<table class="table-container" id="table002-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.91.1">Name</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.92.1">Description</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.93.1">@tsconfig/node20</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.94.1">This file contains the TypeScript compiler configuration settings for working with Node.js.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.95.1">npm-run-all</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.96.1">This package allows multiple commands to be started at once.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.97.1">tsc-watch</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.98.1">This package contains the watcher for TypeScript files.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.99.1">typescript</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.100.1">This package contains the TypeScript compiler.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.101.1">webpack</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.102.1">This package contains the webpack bundler. </span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.103.1">webpack-cli</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.104.1">This package contains the command-line interface for webpack.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.105.1">webpack-dev-server</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.106.1">This package contains the webpack development HTTP server.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="normal"><span class="kobospan" id="kobo.107.1">To install these packages, run the commands shown in </span><em class="italic"><span class="kobospan" id="kobo.108.1">Listing 9.3</span></em><span class="kobospan" id="kobo.109.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.110.1">part2app</span></code><span class="kobospan" id="kobo.111.1"> folder.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.112.1">Listing 9.3: Installing the development tool packages</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.113.1">npm install --save-dev @tsconfig/node20
npm install --save-dev npm-run-all@4.1.5
npm install --save-dev tsc-watch@6.0.4
npm install --save-dev typescript@5.2.2
npm install --save-dev webpack@5.89.0
npm install --save-dev webpack-cli@5.1.4
npm install --save-dev webpack-dev-server@4.15.1
</span></code></pre>
<h2 class="heading1" id="_idParaDest-168"><span class="kobospan" id="kobo.114.1">Installing the type packages</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.115.1">The</span><a id="_idIndexMarker457" class="calibre3"/><span class="kobospan" id="kobo.116.1"> final packages contain descriptions of the types used by two of the development packages, which makes them easier to use with TypeScript, as described in </span><em class="italic"><span class="kobospan" id="kobo.117.1">Table 9.3</span></em><span class="kobospan" id="kobo.118.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.119.1">Table 9.3: The type description packages</span></p>
<table class="table-container" id="table003-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.120.1">Name</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.121.1">Description</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.122.1">@types/express</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.123.1">This package contains the descriptions of the Express API</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.124.1">@types/node</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.125.1">This package contains the descriptions of the Node.js API</span></p>
</td>
</tr>
</tbody>
</table>
<p class="normal"><span class="kobospan" id="kobo.126.1">To install these packages, run the commands shown in </span><em class="italic"><span class="kobospan" id="kobo.127.1">Listing 9.4</span></em><span class="kobospan" id="kobo.128.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.129.1">part2app</span></code><span class="kobospan" id="kobo.130.1"> folder.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.131.1">Listing 9.4: Installing the type packages</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.132.1">npm install --save-dev @types/express@4.17.20
npm install --save-dev @types/node@20.6.1
</span></code></pre>
<h1 class="heading" id="_idParaDest-169"><span class="kobospan" id="kobo.133.1">Creating the configuration files</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.134.1">To create the</span><a id="_idIndexMarker458" class="calibre3"/><span class="kobospan" id="kobo.135.1"> configuration for the TypeScript compiler, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.136.1">tsconfig.json</span></code><span class="kobospan" id="kobo.137.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.138.1">part2app</span></code><span class="kobospan" id="kobo.139.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.140.1">Listing 9.5</span></em><span class="kobospan" id="kobo.141.1">.</span></p>
<div class="note">
<p class="normal"><span class="kobospan" id="kobo.142.1">Your code editor may report errors with the </span><code class="inlinecode"><span class="kobospan" id="kobo.143.1">tsconfig.json</span></code><span class="kobospan" id="kobo.144.1"> file, but these will be resolved when you start the development tools in </span><em class="italic"><span class="kobospan" id="kobo.145.1">Listing 9.12</span></em><span class="kobospan" id="kobo.146.1">.</span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.147.1">Listing 9.5: The contents of the tsconfig.json file in the part2app folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.148.1">{
    "extends": "@tsconfig/node20/tsconfig.json",
     "compilerOptions": {                     
         "rootDir": "src/server", 
         "outDir": "dist/server/"
     },
     "include": ["src/server/**/*"]
}
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.149.1">This file builds on the configuration contained in the </span><code class="inlinecode"><span class="kobospan" id="kobo.150.1">@tsconfig/node20</span></code><span class="kobospan" id="kobo.151.1"> package added to the project in </span><em class="italic"><span class="kobospan" id="kobo.152.1">Listing 9.4</span></em><span class="kobospan" id="kobo.153.1">. </span><span class="kobospan" id="kobo.153.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.154.1">rootDir</span></code><span class="kobospan" id="kobo.155.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.156.1">include</span></code><span class="kobospan" id="kobo.157.1"> settings are used to tell the compiler to process files in the </span><code class="inlinecode"><span class="kobospan" id="kobo.158.1">src/server</span></code><span class="kobospan" id="kobo.159.1"> folder. </span><span class="kobospan" id="kobo.159.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.160.1">outDir</span></code><span class="kobospan" id="kobo.161.1"> setting tells the compiler to write the processed JavaScript files into the </span><code class="inlinecode"><span class="kobospan" id="kobo.162.1">dist/server</span></code><span class="kobospan" id="kobo.163.1"> folder.</span></p>
<p class="normal"><span class="kobospan" id="kobo.164.1">To create the </span><a id="_idIndexMarker459" class="calibre3"/><span class="kobospan" id="kobo.165.1">configuration file for webpack, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.166.1">webpack.config.mjs</span></code><span class="kobospan" id="kobo.167.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.168.1">part2app</span></code><span class="kobospan" id="kobo.169.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.170.1">Listing 9.6</span></em><span class="kobospan" id="kobo.171.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.172.1">Listing 9.6: The contents of the webpack.config.mjs file in the part2app folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.173.1">import path from "path";
import { fileURLToPath } from 'url';
const __dirname = path.dirname(fileURLToPath(import.meta.url));
export default  {
    mode: "development",
    entry: "./src/client/client.js",
    devtool: "source-map",  
    output: {
        path: path.resolve(__dirname, "dist/client"),
        filename: "bundle.js"
    },
    devServer: {
        static: ["./static"],       
        port: 5100,
        client: { webSocketURL: "http://localhost:5000/ws" }
    }
};
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.174.1">This configuration file tells webpack to bundle the JavaScript files it finds in the </span><code class="inlinecode"><span class="kobospan" id="kobo.175.1">src/client</span></code><span class="kobospan" id="kobo.176.1"> folder and to write the bundle that is created to the </span><code class="inlinecode"><span class="kobospan" id="kobo.177.1">dist/client</span></code><span class="kobospan" id="kobo.178.1"> folder. </span><span class="kobospan" id="kobo.178.2">(Although, as noted in </span><em class="italic"><span class="kobospan" id="kobo.179.1">Part 1</span></em><span class="kobospan" id="kobo.180.1">, webpack will keep the bundle file in memory during development and only write the file to disk when the application is being prepared for deployment.)</span></p>
<p class="normal"><span class="kobospan" id="kobo.181.1">To define the commands that will be used to start the development tools, add the setting shown in </span><em class="italic"><span class="kobospan" id="kobo.182.1">Listing 9.7</span></em><span class="kobospan" id="kobo.183.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.184.1">package.json</span></code><span class="kobospan" id="kobo.185.1"> file.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.186.1">Listing 9.7. </span><span class="kobospan" id="kobo.186.2">Defining scripts in the package.json file in the part2app folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.187.1">...
</span><span class="kobospan" id="kobo.187.2">"scripts": {
   </span><strong class="screentext"><span class="kobospan" id="kobo.188.1"> "server": "</span></strong><strong class="screentext"><span class="kobospan" id="kobo.189.1">tsc-watch --noClear --onsuccess \"node dist/server/server.js\"",</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.190.1">    "client": "webpack serve",</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.191.1">    "start": "npm-run-all --parallel server client"</span></strong><span class="kobospan" id="kobo.192.1">
},
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.193.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.194.1">server</span></code><span class="kobospan" id="kobo.195.1"> command </span><a id="_idIndexMarker460" class="calibre3"/><span class="kobospan" id="kobo.196.1">uses the </span><code class="inlinecode"><span class="kobospan" id="kobo.197.1">tsc-watch</span></code><span class="kobospan" id="kobo.198.1"> package to compile the backend TypeScript code and execute the JavaScript that is produced. </span><span class="kobospan" id="kobo.198.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.199.1">client</span></code><span class="kobospan" id="kobo.200.1"> command starts the </span><code class="inlinecode"><span class="kobospan" id="kobo.201.1">webpack</span></code><span class="kobospan" id="kobo.202.1"> development HTTP server. </span><span class="kobospan" id="kobo.202.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.203.1">start</span></code><span class="kobospan" id="kobo.204.1"> command uses the </span><code class="inlinecode"><span class="kobospan" id="kobo.205.1">npm-run-all</span></code><span class="kobospan" id="kobo.206.1"> command so that both the </span><code class="inlinecode"><span class="kobospan" id="kobo.207.1">client</span></code><span class="kobospan" id="kobo.208.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.209.1">server</span></code><span class="kobospan" id="kobo.210.1"> commands can be started together.</span></p>
<h1 class="heading" id="_idParaDest-170"><span class="kobospan" id="kobo.211.1">Creating the backend server</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.212.1">Create</span><a id="_idIndexMarker461" class="calibre3"/><span class="kobospan" id="kobo.213.1"> the </span><code class="inlinecode"><span class="kobospan" id="kobo.214.1">src/server</span></code><span class="kobospan" id="kobo.215.1"> folder and add to it a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.216.1">server.ts</span></code><span class="kobospan" id="kobo.217.1"> with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.218.1">Listing 9.8</span></em><span class="kobospan" id="kobo.219.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.220.1">Listing 9.8: The contents of the server.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.221.1">import { createServer } from "http";
import express, {Express } from "express";
import { testHandler } from "./testHandler";
import httpProxy from "http-proxy";
import helmet from "helmet";
const port = 5000;
const expressApp: Express = express();
const proxy = httpProxy.createProxyServer({
    target: "http://localhost:5100", ws: true
});
expressApp.use(helmet());
expressApp.use(express.json());
expressApp.post("/test", testHandler);
expressApp.use(express.static("static"));
expressApp.use(express.static("node_modules/bootstrap/dist"));
expressApp.use((req, resp) =&gt; proxy.web(req, resp));
const server = createServer(expressApp);
server.on('upgrade', (req, socket, head) =&gt; proxy.ws(req, socket, head));
server.listen(port,
    () =&gt; console.log(`HTTP Server listening on port ${port}`));
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.222.1">The </span><a id="_idIndexMarker462" class="calibre3"/><span class="kobospan" id="kobo.223.1">code creates an HTTP server that listens for requests on port 5000. </span><span class="kobospan" id="kobo.223.2">The Express package is used to decode JSON request bodies, serve static content, and forward unhandled requests to the webpack HTTP server.</span></p>
<p class="normal"><span class="kobospan" id="kobo.224.1">The Express router is used to match HTTP POST requests sent to the </span><code class="inlinecode"><span class="kobospan" id="kobo.225.1">/test</span></code><span class="kobospan" id="kobo.226.1"> URL. </span><span class="kobospan" id="kobo.226.2">To create the handler, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.227.1">testHandler.ts</span></code><span class="kobospan" id="kobo.228.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.229.1">src/server</span></code><span class="kobospan" id="kobo.230.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.231.1">Listing 9.9</span></em><span class="kobospan" id="kobo.232.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.233.1">Listing 9.9: The contents of the testHandler.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.234.1">import { Request, Response } from "express";
export const testHandler = async (req: Request, resp: Response) =&gt; {  
    resp.setHeader("Content-Type", "application/json")
    resp.json(req.body);
    resp.end();      
}
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.235.1">The handler sets the </span><code class="inlinecode"><span class="kobospan" id="kobo.236.1">Content-Type</span></code><span class="kobospan" id="kobo.237.1"> header of the response and writes the request body to the response, which has the effect of echoing the data sent by the client. </span><span class="kobospan" id="kobo.237.2">In </span><em class="italic"><span class="kobospan" id="kobo.238.1">Part 1</span></em><span class="kobospan" id="kobo.239.1">, I used the </span><code class="inlinecode"><span class="kobospan" id="kobo.240.1">pipe</span></code><span class="kobospan" id="kobo.241.1"> method to achieve a similar effect, but that won’t work in this example because the Express JSON middleware will read the request body and decode the JSON data it contains into a JavaScript object, which means there is no data in the request stream to read. </span><span class="kobospan" id="kobo.241.2">For this reason, I create the response using the </span><code class="inlinecode"><span class="kobospan" id="kobo.242.1">Request.body</span></code><span class="kobospan" id="kobo.243.1"> property, which is where the object created by the JSON middleware can be found.</span></p>
<h1 class="heading" id="_idParaDest-171"><span class="kobospan" id="kobo.244.1">Creating the HTML and client-side JavaScript code</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.245.1">To </span><a id="_idIndexMarker463" class="calibre3"/><span class="kobospan" id="kobo.246.1">define the HTML document that will be delivered to the browser, create the </span><code class="inlinecode"><span class="kobospan" id="kobo.247.1">static</span></code><span class="kobospan" id="kobo.248.1"> folder and add to it a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.249.1">index.html</span></code><span class="kobospan" id="kobo.250.1"> with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.251.1">Listing 9.10</span></em><span class="kobospan" id="kobo.252.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.253.1">Listing 9.10: The contents of the index.html file in the static folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.254.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;script src="/bundle.js"&gt;&lt;/script&gt;
        &lt;link href="css/bootstrap.min.css" rel="stylesheet" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;button id="btn" class="btn btn-primary m-2"&gt;Send Request&lt;/button&gt;
        &lt;table class="table table-striped"&gt;
            &lt;tbody&gt;
                &lt;tr&gt;&lt;th&gt;Status&lt;/th&gt;&lt;td id="msg"&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;tr&gt;&lt;th&gt;Response&lt;/th&gt;&lt;td id="body"&gt;&lt;/td&gt;&lt;/tr&gt;
            &lt;/tbody&gt;
       &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.255.1">This file contains a button that will be used to send HTTP requests to the backend server and a table that will be used to display details of the response. </span><span class="kobospan" id="kobo.255.2">To create the JavaScript code that will respond to the button and send the request, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.256.1">client.js</span></code><span class="kobospan" id="kobo.257.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.258.1">src/client</span></code><span class="kobospan" id="kobo.259.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.260.1">Listing 9.11</span></em><span class="kobospan" id="kobo.261.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.262.1">Listing 9.11: The contents of the client.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.263.1">document.addEventListener('DOMContentLoaded', function() {
    document.getElementById("btn").addEventListener("click", sendReq);
});
sendReq = async () =&gt; {
    const response = await fetch("/test", {
        method: "POST", body: JSON.stringify({message: "Hello, World"}),
        headers: { "Content-Type": "application/json" }
    });
    document.getElementById("msg").textContent = response.statusText;
    document.getElementById("body").innerHTML = await response.text();
};
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.264.1">The</span><a id="_idIndexMarker464" class="calibre3"/><span class="kobospan" id="kobo.265.1"> JavaScript code in this file uses the APIs provided by the browser to send an HTTP POST request to the </span><code class="inlinecode"><span class="kobospan" id="kobo.266.1">/test</span></code><span class="kobospan" id="kobo.267.1"> URL and display details of the response received from the backend server.</span></p>
<h1 class="heading" id="_idParaDest-172"><span class="kobospan" id="kobo.268.1">Running the example application</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.269.1">All that</span><a id="_idIndexMarker465" class="calibre3"/><span class="kobospan" id="kobo.270.1"> remains is to make sure the example application works as expected. </span><span class="kobospan" id="kobo.270.2">Run the command shown in </span><em class="italic"><span class="kobospan" id="kobo.271.1">Listing 9.12</span></em><span class="kobospan" id="kobo.272.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.273.1">part2app</span></code><span class="kobospan" id="kobo.274.1"> folder to start the development tools.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.275.1">Listing 9.12: Starting the development tools</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.276.1">npm start
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.277.1">Give the tools a moment to start up and then use a web browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.278.1">http://localhost:5000</span></code><span class="kobospan" id="kobo.279.1">. </span><span class="kobospan" id="kobo.279.2">The browser will receive the HTML document defined in </span><em class="italic"><span class="kobospan" id="kobo.280.1">Listing 9.10</span></em><span class="kobospan" id="kobo.281.1">, which contains a link to the bundle that is provided by webpack. </span><span class="kobospan" id="kobo.281.2">Click the </span><strong class="screentext"><span class="kobospan" id="kobo.282.1">Send Request</span></strong><span class="kobospan" id="kobo.283.1"> button and the client-side JavaScript will send an HTTP request to the backend server, producing the response shown in </span><em class="italic"><span class="kobospan" id="kobo.284.1">Figure 9.4</span></em><span class="kobospan" id="kobo.285.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.286.1"><img alt="" src="../Images/B21959_09_04.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.287.1">Figure 9.4: Running the example application</span></p>
<h1 class="heading" id="_idParaDest-173"><span class="kobospan" id="kobo.288.1">Summary</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.289.1">In this chapter, I created the example project that will be used throughout this part of the book, using the packages and features described in </span><em class="italic"><span class="kobospan" id="kobo.290.1">Part 1</span></em><span class="kobospan" id="kobo.291.1">. </span><span class="kobospan" id="kobo.291.2">In the next chapter, I will describe the key features required for web applications, starting with using templates to generate HTML content.</span></p>
</div>
</body></html>