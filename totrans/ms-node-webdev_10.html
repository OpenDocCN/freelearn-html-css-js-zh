<html><head></head><body>
<div><h1 class="chapternumber">9</h1>
<h1 class="chaptertitle" id="_idParaDest-163">Creating the Example Project</h1>
<p class="normal1">In this chapter, I create the example project that is used throughout this part of the book, using the features described in <em class="italic">Part 1</em>. In later chapters, I’ll start to add new features, but this chapter is all about building the foundation.</p>
<div><p class="normal"><strong class="screentext">Tip</strong></p>
<p class="normal">You can download the example project for this chapter – and for all the other chapters in this book – from <a href="https://github.com/PacktPublishing/Mastering-Node.js-Web-Development" class="calibre3">https://github.com/PacktPublishing/Mastering-Node.js-Web-Development</a>. See <em class="italic">Chapter 1</em> for how to get help if you have problems running the examples.</p>
</div>
<h1 class="heading" id="_idParaDest-164">Understanding the project</h1>
<p class="normal1">The example project <a id="_idIndexMarker451" class="calibre3"/>will use the features and packages introduced in <em class="italic">Part 1</em> of this book. The backend server will be written in TypeScript and the code files will be in the <code class="inlinecode">src/server</code> folder. The TypeScript compiler will write JavaScript files to the <code class="inlinecode">dist/server</code> folder, where they will be executed by the Node.js runtime, which will listen for HTTP requests on port <code class="inlinecode">5000</code>, as shown in <em class="italic">Figure 9.1</em>.</p>
<figure class="mediaobject"><img alt="" src="img/B21959_09_01.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 9.1: The backend server</p>
<p class="normal">The client-side part of the application will be simpler than the backend and used only to send requests and process responses to demonstrate server-side features. The<a id="_idIndexMarker452" class="calibre3"/> client-side code will be written in JavaScript and packaged into a bundle using webpack. The bundle will be served by the webpack development server, which will listen for HTTP requests on port 5100, as shown in <em class="italic">Figure 9.2</em>.</p>
<figure class="mediaobject"><img alt="" src="img/B21959_09_02.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 9.2: Adding the client-side part of the project</p>
<p class="normal">The browser will make requests to the backend server on port 5000. The Express router will be used to match requests to handler functions, starting with a single <code class="inlinecode">/test</code> URL just to get started. Requests for static content, such as HTML files and images, will be served from the <code class="inlinecode">static</code> folder, using the Express <code class="inlinecode">static</code> middleware component.</p>
<p class="normal">All other requests<a id="_idIndexMarker453" class="calibre3"/> will be forwarded to the webpack server, which will allow the client-side bundle to be requested and allow the live reload feature to work, as shown in <em class="italic">Figure 9.3</em>.</p>
<figure class="mediaobject"><img alt="" src="img/B21959_09_03.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 9.3: Routing requests</p>
<h1 class="heading" id="_idParaDest-165">Creating the project</h1>
<p class="normal1">Open a <a id="_idIndexMarker454" class="calibre3"/>new command prompt, navigate to a convenient location, and create a folder named <code class="inlinecode">part2app</code>. Navigate to the <code class="inlinecode">part2app</code> folder and run the command shown in <em class="italic">Listing 9.1</em> to initialize the project and create the <code class="inlinecode">package.json</code> file.</p>
<p class="packt_figref">Listing 9.1: Initializing the project</p>
<pre class="programlisting1"><code class="hljs-con">npm init -y
</code></pre>
<p class="normal">In the sections that follow, I go through the process of creating the different parts of the project, starting with the backend server. I start by installing the JavaScript packages each part of the application requires, all of which were introduced in <em class="italic">Part 1</em> of this book.</p>
<h2 class="heading1" id="_idParaDest-166">Installing the application packages</h2>
<p class="normal1">The <a id="_idIndexMarker455" class="calibre3"/>application packages are those whose features are incorporated into either the backend server or the client-side code. <em class="italic">Table 9.1</em> describes the application packages used in this chapter.</p>
<p class="packt_figref">Table 9.1: The application packages used in this chapter</p>
<table class="table-container" id="table001-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Name</p>
</td>
<td class="table-cell">
<p class="normal">Description</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">bootstrap</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains CSS styles and JavaScript code to style the client-side content.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">express</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains enhancements to the Node.js API to simplify HTTP request handling.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">helmet</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package sets security-related headers in HTTP responses.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">http-proxy</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package forwards HTTP requests and will be used to connect the backend server to the webpack development server.</p>
</td>
</tr>
</tbody>
</table>
<p class="normal">To install these packages, run the commands shown in <em class="italic">Listing 9.2</em> in the <code class="inlinecode">part2app</code> folder.</p>
<p class="packt_figref">Listing 9.2: Installing the application packages</p>
<pre class="programlisting1"><code class="hljs-con">npm install bootstrap@5.3.2
npm install express@4.18.2
npm install helmet@7.1.0
npm install http-proxy@1.18.1
</code></pre>
<h2 class="heading1" id="_idParaDest-167">Installing the development tool packages</h2>
<p class="normal1">The <a id="_idIndexMarker456" class="calibre3"/>development tool packages provide features that are used during development but are not included when the application is deployed. <em class="italic">Table 9.2</em> describes the tool packages used in this chapter.</p>
<p class="packt_figref">Table 9.2: The development tool packages used in this chapter</p>
<table class="table-container" id="table002-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Name</p>
</td>
<td class="table-cell">
<p class="normal">Description</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">@tsconfig/node20</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This file contains the TypeScript compiler configuration settings for working with Node.js.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">npm-run-all</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package allows multiple commands to be started at once.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">tsc-watch</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the watcher for TypeScript files.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">typescript</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the TypeScript compiler.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">webpack</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the webpack bundler. </p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">webpack-cli</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the command-line interface for webpack.</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">webpack-dev-server</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the webpack development HTTP server.</p>
</td>
</tr>
</tbody>
</table>
<p class="normal">To install these packages, run the commands shown in <em class="italic">Listing 9.3</em> in the <code class="inlinecode">part2app</code> folder.</p>
<p class="packt_figref">Listing 9.3: Installing the development tool packages</p>
<pre class="programlisting1"><code class="hljs-con">npm install --save-dev @tsconfig/node20
npm install --save-dev npm-run-all@4.1.5
npm install --save-dev tsc-watch@6.0.4
npm install --save-dev typescript@5.2.2
npm install --save-dev webpack@5.89.0
npm install --save-dev webpack-cli@5.1.4
npm install --save-dev webpack-dev-server@4.15.1
</code></pre>
<h2 class="heading1" id="_idParaDest-168">Installing the type packages</h2>
<p class="normal1">The<a id="_idIndexMarker457" class="calibre3"/> final packages contain descriptions of the types used by two of the development packages, which makes them easier to use with TypeScript, as described in <em class="italic">Table 9.3</em>.</p>
<p class="packt_figref">Table 9.3: The type description packages</p>
<table class="table-container" id="table003-6">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal">Name</p>
</td>
<td class="table-cell">
<p class="normal">Description</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">@types/express</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the descriptions of the Express API</p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1">@types/node</code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal">This package contains the descriptions of the Node.js API</p>
</td>
</tr>
</tbody>
</table>
<p class="normal">To install these packages, run the commands shown in <em class="italic">Listing 9.4</em> in the <code class="inlinecode">part2app</code> folder.</p>
<p class="packt_figref">Listing 9.4: Installing the type packages</p>
<pre class="programlisting1"><code class="hljs-con">npm install --save-dev @types/express@4.17.20
npm install --save-dev @types/node@20.6.1
</code></pre>
<h1 class="heading" id="_idParaDest-169">Creating the configuration files</h1>
<p class="normal1">To create the<a id="_idIndexMarker458" class="calibre3"/> configuration for the TypeScript compiler, add a file named <code class="inlinecode">tsconfig.json</code> to the <code class="inlinecode">part2app</code> folder with the content shown in <em class="italic">Listing 9.5</em>.</p>
<div><p class="normal">Your code editor may report errors with the <code class="inlinecode">tsconfig.json</code> file, but these will be resolved when you start the development tools in <em class="italic">Listing 9.12</em>.</p>
</div>
<p class="packt_figref">Listing 9.5: The contents of the tsconfig.json file in the part2app folder</p>
<pre class="programlisting"><code class="hljs-code">{
    "extends": "@tsconfig/node20/tsconfig.json",
     "compilerOptions": {                     
         "rootDir": "src/server", 
         "outDir": "dist/server/"
     },
     "include": ["src/server/**/*"]
}
</code></pre>
<p class="normal">This file builds on the configuration contained in the <code class="inlinecode">@tsconfig/node20</code> package added to the project in <em class="italic">Listing 9.4</em>. The <code class="inlinecode">rootDir</code> and <code class="inlinecode">include</code> settings are used to tell the compiler to process files in the <code class="inlinecode">src/server</code> folder. The <code class="inlinecode">outDir</code> setting tells the compiler to write the processed JavaScript files into the <code class="inlinecode">dist/server</code> folder.</p>
<p class="normal">To create the <a id="_idIndexMarker459" class="calibre3"/>configuration file for webpack, add a file named <code class="inlinecode">webpack.config.mjs</code> to the <code class="inlinecode">part2app</code> folder with the content shown in <em class="italic">Listing 9.6</em>.</p>
<p class="packt_figref">Listing 9.6: The contents of the webpack.config.mjs file in the part2app folder</p>
<pre class="programlisting"><code class="hljs-code">import path from "path";
import { fileURLToPath } from 'url';
const __dirname = path.dirname(fileURLToPath(import.meta.url));
export default  {
    mode: "development",
    entry: "./src/client/client.js",
    devtool: "source-map",  
    output: {
        path: path.resolve(__dirname, "dist/client"),
        filename: "bundle.js"
    },
    devServer: {
        static: ["./static"],       
        port: 5100,
        client: { webSocketURL: "http://localhost:5000/ws" }
    }
};
</code></pre>
<p class="normal">This configuration file tells webpack to bundle the JavaScript files it finds in the <code class="inlinecode">src/client</code> folder and to write the bundle that is created to the <code class="inlinecode">dist/client</code> folder. (Although, as noted in <em class="italic">Part 1</em>, webpack will keep the bundle file in memory during development and only write the file to disk when the application is being prepared for deployment.)</p>
<p class="normal">To define the commands that will be used to start the development tools, add the setting shown in <em class="italic">Listing 9.7</em> to the <code class="inlinecode">package.json</code> file.</p>
<p class="packt_figref">Listing 9.7. Defining scripts in the package.json file in the part2app folder</p>
<pre class="programlisting"><code class="hljs-code">...
"scripts": {
   <strong class="screentext"> "server": "</strong><strong class="screentext">tsc-watch --noClear --onsuccess \"node dist/server/server.js\"",</strong>
<strong class="screentext">    "client": "webpack serve",</strong>
<strong class="screentext">    "start": "npm-run-all --parallel server client"</strong>
},
...
</code></pre>
<p class="normal">The <code class="inlinecode">server</code> command <a id="_idIndexMarker460" class="calibre3"/>uses the <code class="inlinecode">tsc-watch</code> package to compile the backend TypeScript code and execute the JavaScript that is produced. The <code class="inlinecode">client</code> command starts the <code class="inlinecode">webpack</code> development HTTP server. The <code class="inlinecode">start</code> command uses the <code class="inlinecode">npm-run-all</code> command so that both the <code class="inlinecode">client</code> and <code class="inlinecode">server</code> commands can be started together.</p>
<h1 class="heading" id="_idParaDest-170">Creating the backend server</h1>
<p class="normal1">Create<a id="_idIndexMarker461" class="calibre3"/> the <code class="inlinecode">src/server</code> folder and add to it a file named <code class="inlinecode">server.ts</code> with the content shown in <em class="italic">Listing 9.8</em>.</p>
<p class="packt_figref">Listing 9.8: The contents of the server.ts file in the src/server folder</p>
<pre class="programlisting"><code class="hljs-code">import { createServer } from "http";
import express, {Express } from "express";
import { testHandler } from "./testHandler";
import httpProxy from "http-proxy";
import helmet from "helmet";
const port = 5000;
const expressApp: Express = express();
const proxy = httpProxy.createProxyServer({
    target: "http://localhost:5100", ws: true
});
expressApp.use(helmet());
expressApp.use(express.json());
expressApp.post("/test", testHandler);
expressApp.use(express.static("static"));
expressApp.use(express.static("node_modules/bootstrap/dist"));
expressApp.use((req, resp) =&gt; proxy.web(req, resp));
const server = createServer(expressApp);
server.on('upgrade', (req, socket, head) =&gt; proxy.ws(req, socket, head));
server.listen(port,
    () =&gt; console.log(`HTTP Server listening on port ${port}`));
</code></pre>
<p class="normal">The <a id="_idIndexMarker462" class="calibre3"/>code creates an HTTP server that listens for requests on port 5000. The Express package is used to decode JSON request bodies, serve static content, and forward unhandled requests to the webpack HTTP server.</p>
<p class="normal">The Express router is used to match HTTP POST requests sent to the <code class="inlinecode">/test</code> URL. To create the handler, add a file named <code class="inlinecode">testHandler.ts</code> to the <code class="inlinecode">src/server</code> folder with the content shown in <em class="italic">Listing 9.9</em>.</p>
<p class="packt_figref">Listing 9.9: The contents of the testHandler.ts file in the src/server folder</p>
<pre class="programlisting"><code class="hljs-code">import { Request, Response } from "express";
export const testHandler = async (req: Request, resp: Response) =&gt; {  
    resp.setHeader("Content-Type", "application/json")
    resp.json(req.body);
    resp.end();      
}
</code></pre>
<p class="normal">The handler sets the <code class="inlinecode">Content-Type</code> header of the response and writes the request body to the response, which has the effect of echoing the data sent by the client. In <em class="italic">Part 1</em>, I used the <code class="inlinecode">pipe</code> method to achieve a similar effect, but that won’t work in this example because the Express JSON middleware will read the request body and decode the JSON data it contains into a JavaScript object, which means there is no data in the request stream to read. For this reason, I create the response using the <code class="inlinecode">Request.body</code> property, which is where the object created by the JSON middleware can be found.</p>
<h1 class="heading" id="_idParaDest-171">Creating the HTML and client-side JavaScript code</h1>
<p class="normal1">To <a id="_idIndexMarker463" class="calibre3"/>define the HTML document that will be delivered to the browser, create the <code class="inlinecode">static</code> folder and add to it a file named <code class="inlinecode">index.html</code> with the content shown in <em class="italic">Listing 9.10</em>.</p>
<p class="packt_figref">Listing 9.10: The contents of the index.html file in the static folder</p>
<pre class="programlisting"><code class="hljs-code">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;script src="img/bundle.js"&gt;&lt;/script&gt;
        &lt;link href="css/bootstrap.min.css" rel="stylesheet" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;button id="btn" class="btn btn-primary m-2"&gt;Send Request&lt;/button&gt;
        &lt;table class="table table-striped"&gt;
            &lt;tbody&gt;
                &lt;tr&gt;&lt;th&gt;Status&lt;/th&gt;&lt;td id="msg"&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;tr&gt;&lt;th&gt;Response&lt;/th&gt;&lt;td id="body"&gt;&lt;/td&gt;&lt;/tr&gt;
            &lt;/tbody&gt;
       &lt;/table&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p class="normal">This file contains a button that will be used to send HTTP requests to the backend server and a table that will be used to display details of the response. To create the JavaScript code that will respond to the button and send the request, add a file named <code class="inlinecode">client.js</code> to the <code class="inlinecode">src/client</code> folder with the content shown in <em class="italic">Listing 9.11</em>.</p>
<p class="packt_figref">Listing 9.11: The contents of the client.js file in the src/client folder</p>
<pre class="programlisting"><code class="hljs-code">document.addEventListener('DOMContentLoaded', function() {
    document.getElementById("btn").addEventListener("click", sendReq);
});
sendReq = async () =&gt; {
    const response = await fetch("/test", {
        method: "POST", body: JSON.stringify({message: "Hello, World"}),
        headers: { "Content-Type": "application/json" }
    });
    document.getElementById("msg").textContent = response.statusText;
    document.getElementById("body").innerHTML = await response.text();
};
</code></pre>
<p class="normal">The<a id="_idIndexMarker464" class="calibre3"/> JavaScript code in this file uses the APIs provided by the browser to send an HTTP POST request to the <code class="inlinecode">/test</code> URL and display details of the response received from the backend server.</p>
<h1 class="heading" id="_idParaDest-172">Running the example application</h1>
<p class="normal1">All that<a id="_idIndexMarker465" class="calibre3"/> remains is to make sure the example application works as expected. Run the command shown in <em class="italic">Listing 9.12</em> in the <code class="inlinecode">part2app</code> folder to start the development tools.</p>
<p class="packt_figref">Listing 9.12: Starting the development tools</p>
<pre class="programlisting1"><code class="hljs-con">npm start
</code></pre>
<p class="normal">Give the tools a moment to start up and then use a web browser to request <code class="inlinecode">http://localhost:5000</code>. The browser will receive the HTML document defined in <em class="italic">Listing 9.10</em>, which contains a link to the bundle that is provided by webpack. Click the <strong class="screentext">Send Request</strong> button and the client-side JavaScript will send an HTTP request to the backend server, producing the response shown in <em class="italic">Figure 9.4</em>.</p>
<figure class="mediaobject"><img alt="" src="img/B21959_09_04.png" class="calibre7"/></figure>
<p class="packt_figref">Figure 9.4: Running the example application</p>
<h1 class="heading" id="_idParaDest-173">Summary</h1>
<p class="normal1">In this chapter, I created the example project that will be used throughout this part of the book, using the packages and features described in <em class="italic">Part 1</em>. In the next chapter, I will describe the key features required for web applications, starting with using templates to generate HTML content.</p>
</div>
</body></html>