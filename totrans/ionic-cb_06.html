<html><head></head><body><div><h1 class="header-title">User Authentication and Push Notifications</h1>
                
            
            
                
<p>In this chapter, we will cover the following tasks related to authenticating users, and register and receiving push notification messages:</p>
<ul>
<li>Registering and authenticating users using Auth0</li>
<li>Building an iOS app to receive push notifications</li>
<li>Building an Android app to receive push notifications</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Introduction</h1>
                
            
            
                
<p>Tracking and engaging users are key features necessary for your app to grow. That means you should be able to register and authenticate users. Once the users start using the app, you also need to segment the users so that you can customize their interactions. Then, you can send push notifications to encourage users to revisit the app.</p>
<p>There are two components that you need to use for your project, as follows:</p>
<ul>
<li><strong>Auth0</strong>: Auth0 is a cloud-based authentication service. The whole idea is that you delegate authentication of your application to Auth0. Auth0 supports many frameworks, including Ionic2+, and also supports many social providers for authentication such as Google and Facebook. On the top of that, they have excellent documentation.</li>
<li><strong>OneSignal</strong>: OneSignal is a service that allows us to send the push notification to both iOS and Android. As a matter of fact, it supports other platforms such as Windows, Web Push Notifications, Amazon Fire, and so on. The best part is, in general, we need different code for adding push notifications. But because of Cordova and OneSignal's abstract API, we only need to write push notification code once for both platforms.</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Registering and authenticating users using Auth0</h1>
                
            
            
                
<p><strong>Auth0</strong> can provide all of the user management and authentication capabilities out of the box. There are lots of providers supported by Auth0. Following are some famous providers that are supported by Auth0:</p>
<ul>
<li>Email/password</li>
<li>Facebook</li>
<li>Google</li>
<li>Twitter</li>
<li>Instagram</li>
<li>LinkedIn</li>
<li>GitHub</li>
</ul>
<p>Depending on the app, you may not need to use all of these authentication methods. For example, it would make more sense to use a LinkedIn authentication for an app focusing on a working professional to narrow down the audiences who fit the user profile of the app.</p>
<p>In this chapter, we will try to simplify the authentication concept as much as possible. You will learn how to do the following things:</p>
<ul>
<li>Registering a new user</li>
<li>Logging in and logging out a user</li>
<li>Showing a user's profile information</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>You need the device to test the app because we are using Cordova plugins for authentication, which requires either device or simulator to run the app.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it...</h1>
                
            
            
                
<p>We will do it in two ways:</p>
<ul>
<li>Creating an app in the Auth0 dashboard</li>
<li>Coding our Ionic app</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Creating our app in the Auth0 dashboard</h1>
                
            
            
                
<p>In this section, we are going to learn how we can create an app in the Auth0 dashboard. Do the following steps:</p>
<ol>
<li>
<p>Go to <a href="https://auth0.com">https://auth0.com</a> and create an account there.</p>
</li>
</ol>
<ol start="2">
<li>After creating an account, it will open Auth0 dashboard. There is a New Application button. Click on it, and it will open the following dialog:
<div><img src="img/e8c4129a-4228-4511-888b-5fd5cb203982.png" width="802" height="645"/></div>
Choose a Name for your client and select the client type as Native.</li>
<li>
<p>Now, in the side menu Dashboard, click on Applications and select the Application that you created. You will see the following page:</p>
<div><img src="img/8cfb6246-1615-496b-8d1f-cd26d8c434da.png" width="2304" height="1366"/></div>
We need Domain and Client ID later in the app, so save them somewhere.</li>
<li>On the same page, in the Allowed Callback URLs input, add <kbd>YOUR_PACKAGE_ID://YOUR_DOMAIN/cordova/YOUR_PACKAGE_ID/callback</kbd>. Replace YOUR_PACKAGE_ID with the package ID of your app, and <kbd><em>YOUR_DOMAIN</em></kbd> is the domain that you saved in the previous step.</li>
<li>Also, in the Allowed Origins(CORS) input, add <kbd>file://</kbd>.</li>
</ol>
<p>With the latest Ionic, they are using WKWebView plugin by default, which servers the app from a local web server at <a href="https://localhost:8080">https://localhost:8080</a>. So you have to add it too in the Allowed Origin(CORS) section. If you are not going to use WKWebView, you don't have to add it.</p>
<ol start="6">
<li>Hit Save Changes.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">Let's code</h1>
                
            
            
                
<p>Now that we have already created our app in the Auth0 dashboard, it's time to write the code for it. Take the following steps:</p>
<ol>
<li>Now,Â create a new <kbd>MySimpleAuth</kbd> app using the <kbd>blank</kbd> template, as shown in the following code, and go to the <kbd>MySimpleAuth</kbd> folder:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start MySimpleAuth blank<br/></strong><strong>$ cd MySimpleAuth</strong></pre>
<ol start="2">
<li>Install <kbd>auth0.js</kbd> and <kbd>auth0/cordova</kbd> npm packages, which are required for Auth0 authentication:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ npm install auth0-js @auth0/cordova --save</strong></pre>
<ol start="3">
<li>We also need to install the following <kbd>Cordova</kbd> plugin:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova plugin add cordova-plugin-safariviewcontroller<br/><br/>$ ionic cordova plugin add cordova-plugin-customurlscheme --variable URL_SCHEME={YOUR_PACKAGE_ID} --variable ANDROID_SCHEME={YOUR_PACKAGE_ID} --variable ANDROID_HOST={YOUR_DOMAIN} --variable ANDROID_PATHPREFIX=/cordova/{YOUR_PACKAGE_ID}/callback<br/></strong></pre>
<p>You should change <kbd>{YOUR_PACKAGE_ID}</kbd> to your app's package ID, and <kbd>{YOUR_DOMAIN}</kbd> to your domain from Auth0 that you saved earlier in the third step.</p>
<ol start="4">
<li>You also have to add the following line to <kbd>config.xml</kbd>:</li>
</ol>
<pre style="padding-left: 60px">&lt;preference name="AndroidLaunchMode" value="singleTask" /&gt;</pre>
<ol start="5">
<li>Create a file at <kbd>./src/providers/auth/auth.ts</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Injectable, NgZone } from '@angular/core';<br/>import { Observable, Subscription } from 'rxjs';<br/><br/>import Auth0Cordova from '@auth0/cordova';<br/>import Auth0 from 'auth0-js';<br/><br/>const auth0Config = {<br/>  // needed for auth0<br/>  clientID: 'sIQavE9jev8VXOTQkeb2Cn62m9s9faLN',<br/><br/>  // needed for auth0cordova<br/>  clientId: 'sIQavE9jev8VXOTQkeb2Cn62m9s9faLN',<br/>  domain: 'imtest.auth0.com',<br/>  callbackURL: location.href,<br/>  packageIdentifier: 'io.ionic.imtest'<br/>};<br/><br/>@Injectable()<br/>export class AuthProvider {<br/>  auth0 = new Auth0.WebAuth(auth0Config);<br/>  accessToken: string;<br/>  idToken: string;<br/>  user: any;<br/><br/>  constructor(public zone: NgZone) {<br/>    this.user = this.getStorageVariable('profile');<br/>    this.idToken = this.getStorageVariable('id_token');<br/>  }<br/><br/>  private getStorageVariable(name) {<br/>    return JSON.parse(window.localStorage.getItem(name));<br/>  }<br/><br/>  private setStorageVariable(name, data) {<br/>    window.localStorage.setItem(name, JSON.stringify(data));<br/>  }<br/><br/>  private setIdToken(token) {<br/>    this.idToken = token;<br/>    this.setStorageVariable('id_token', token);<br/>  }<br/><br/>  private setAccessToken(token) {<br/>    this.accessToken = token;<br/>    this.setStorageVariable('access_token', token);<br/>  }<br/><br/>  public isAuthenticated() {<br/>    const expiresAt = JSON.parse(localStorage.getItem('expires_at'));<br/>    return Date.now() &lt; expiresAt;<br/>  }<br/><br/>  public login() {<br/>    const client = new Auth0Cordova(auth0Config);<br/><br/>    const options = {<br/>      scope: 'openid profile offline_access'<br/>    };<br/><br/>    client.authorize(options, (err, authResult) =&gt; {<br/>      if(err) {<br/>        throw err;<br/>      }<br/><br/>      this.setIdToken(authResult.idToken);<br/>      this.setAccessToken(authResult.accessToken);<br/><br/>      const expiresAt = JSON.stringify((authResult.expiresIn * 1000) <br/>      + <br/>      new Date().getTime());<br/>      this.setStorageVariable('expires_at', expiresAt);<br/><br/>      this.auth0.client.userInfo(this.accessToken, (err, profile)=&gt; <br/>      {<br/>        if(err) {<br/>          throw err;<br/>        }<br/><br/>        profile.user_metadata = profile.user_metadata || {};<br/>        this.setStorageVariable('profile', profile);<br/>        this.zone.run(() =&gt; {<br/>          this.user = profile;<br/>        });<br/>      });<br/>    });<br/>  }<br/><br/>  public logout() {<br/>    window.localStorage.removeItem('profile');<br/>    window.localStorage.removeItem('access_token');<br/>    window.localStorage.removeItem('id_token');<br/>    window.localStorage.removeItem('expires_at');<br/><br/>    this.idToken = null;<br/>    this.accessToken = null;<br/>    this.user = null;<br/>  }<br/><br/>}</pre>
<p>Make sure to use your own value for <kbd>clientID</kbd>, <kbd>domain</kbd>, and <kbd>packageIdentifier</kbd> for <kbd>auth0Config</kbd> in <kbd>auth.ts</kbd>.</p>
<ol start="6">
<li>Open and edit <kbd>./src/app/app.module.ts</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/>import { AuthProvider } from '../providers/auth/auth';<br/><br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler},<br/>    AuthProvider<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<ol start="7">
<li>Edit and replace <kbd>./src/pages/home/home.html</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>  &lt;ion-navbar&gt;<br/>    &lt;ion-title&gt;<br/>      Home Page<br/>    &lt;/ion-title&gt;<br/>  &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content padding&gt;<br/>    &lt;div *ngIf="!auth.isAuthenticated()"&gt;<br/>        &lt;button ion-button block color="primary" (click)="auth.login()"&gt;Log In&lt;/button&gt;<br/>    &lt;/div&gt;<br/><br/>    &lt;div *ngIf="auth.isAuthenticated()"&gt;<br/>      &lt;ion-card&gt;<br/>        &lt;img [src]="auth.user.picture" /&gt;<br/>        &lt;ion-card-content&gt;<br/>          &lt;ion-card-title&gt;{{ auth.user.name }}&lt;/ion-card-title&gt;<br/>        &lt;/ion-card-content&gt;<br/>      &lt;/ion-card&gt;<br/>      &lt;button ion-button block color="primary" <br/>      (click)="auth.logout()"&gt;Logout&lt;/button&gt;<br/>    &lt;/div&gt;<br/>&lt;/ion-content&gt;</pre>
<p>These are just your basic <kbd>login</kbd> and <kbd>logout</kbd> templates. It's all in a single page to keep things simple.</p>
<ol start="8">
<li>Open and edit <kbd>./src/pages/home/home.ts</kbd> with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component } from '@angular/core';<br/>import { NavController } from 'ionic-angular';<br/>import { AuthProvider } from '../../providers/auth/auth';<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/><br/>  constructor(public navCtrl: NavController, public auth: AuthProvider) {<br/><br/>  }<br/><br/>}</pre>
<ol start="9">
<li>Then run this in the device using the following command in CLI:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova run android</strong></pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works</h1>
                
            
            
                
<p>There are certain things that we need to know before digging more into code.</p>
<p>Auth0 uses <strong>JWT</strong> (<strong>JSON Web Token</strong>), which is a compact way of sharing information between two parties via JSON. In simple terms, when the user is authenticated, Auth0 sends us JWTs, which have information about the user and also allow the user to access authenticated routes/URLs. Auth0 sends back an <kbd>access_token</kbd>, which is required for accessing authenticated routes, and it also sends us an <kbd>id_token</kbd>, which contains the user's profile information such as their username, profile picture, and so on. Both of these tokens have a short lifespan and then they expire. But along with that, Auth0 also sends us a <kbd>refresh_token</kbd>, which has a long expiry date and can be used to get a new <kbd>id_token</kbd> and <kbd>access_token</kbd>.</p>
<p>We configured the Callback URL in our app. This is the URL where Auth0 redirects the user after authentication. A callback URL includes the app's package ID, and that's why we need to mention it while installing the plugin. We also need to add <kbd>file://</kbd> in <strong>CORS</strong> (<strong>Cross-Origin Resource Sharing</strong>), because the Ionic app makes an HTTP request from <kbd>file://</kbd> origin.</p>
<p>If you are using Ionic's WKWebView. It runs a local webserver inside the app. So you have to whitelist http://localhost:8080 for CORS in Auth0 Dashboard</p>
<p>Most of the work is in <kbd>AuthService</kbd>. AuthService allows us to log in/log out. It uses the <kbd>auth0.js</kbd> and <kbd>auth0/cordova</kbd> library for authentication. First, we are creating an <kbd>auth0Config</kbd> object. This object looks like the following:</p>
<pre>const auth0Config = {   <br/>    clientID: ''  <br/>    clientId: '',   <br/>    domain: '',   <br/>    callbackURL: location.href,   <br/>    packageIdentifier: '' <br/>};</pre>
<ul>
<li>In the preceding code, you can see that <kbd>clientID</kbd> and <kbd>clientId</kbd> have the same value. It is the value that we saved earlier. The first is used by <kbd>auth0.js</kbd>, and the latter is used by <kbd>auth0/cordova</kbd>.</li>
<li>The <kbd>domain</kbd> is also our <strong>Auth0 Domain</strong> used for authentication. We saved it earlier when we created our app on the Auth0 dashboard.</li>
<li><kbd>callbackURL</kbd> will always be <kbd>location.href</kbd>.</li>
<li><kbd>packageIdentifier</kbd> is the package ID of your app, same as in your <kbd>config.xml</kbd>.</li>
</ul>
<p>We are then passing this config to both <kbd>Auth0.WebAuth</kbd> constructor function, and <kbd>Auth0Cordova</kbd> constructor function.</p>
<p>In the <kbd>login</kbd> function, we initiate authentication by calling Auth0Cordova's <kbd>authorize</kbd> function. It is important to notice that we are passing an <kbd>option</kbd> object with <kbd>scope</kbd> key into an <kbd>authorize</kbd> function as the parameter. This scope key tells Auth0 to return certain data like an email and profile after authentication is completed. We are also passing a callback function as the second parameter, which fires when authentication is completed. When authentication is initiated, Auth0Cordova opens the OS browser and redirects us to our Auth0 Domain. Here, the user can log in and register. By default, email/password authentication is configured for the app. But you can enable Google, Facebook, and GitHub authentication, and they will also appear along with email/password authentication. When the user is authenticated, the browser redirects us to our app via the <strong>Custom URL Scheme.</strong> Then, we store <kbd>idToken</kbd> and <kbd>accessToken</kbd> in <strong>localstorage</strong> and also get profile information using the <kbd>auth0.client.userInfo</kbd> function. Then later in the login method, we also save this information to <strong>localstorage</strong>.</p>
<p>In the <kbd>logout</kbd> function, we are just removing <kbd>idToken</kbd>, <kbd>accessToken</kbd>, token Expiration information, and Profile data from localstorage and also resetting the AuthService class.</p>
<p>In <kbd>home.html</kbd>, we show a Log In button when the user is not authenticated; when the user is authenticated, we show a profile picture and the username of the user, along with the LOGOUTÂ button. These <kbd>login</kbd> and <kbd>logout</kbd> methods in <kbd>home.ts</kbd> call <kbd>AuthService</kbd>'s login and logout function respectively.</p>
<p>Here is how our app looks when the user is not authenticated:</p>
<div><img src="img/30cca472-7afe-4fa0-8914-c4e5dced4754.png" style="width:20.92em;height:37.17em;" width="720" height="1280"/></div>
<p>When the user clicks on, it opens a web page for authenticating the user. It looks like the following:</p>
<div><img src="img/8a0d6940-4d67-4ba3-aa40-92e7709253d2.png" style="width:21.42em;height:38.00em;" width="720" height="1280"/></div>
<p>Here is how our app looks when the user is authenticated:</p>
<div><img src="img/bb01a7f3-3ce1-47b2-807c-3823b3079537.png" style="width:17.92em;height:31.58em;" width="720" height="1280"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">There's more...</h1>
                
            
            
                
<p>You can secure your custom backend using Auth0, and access the backend inside Ionic app using the <kbd>angular2-jwt</kbd> library. Take a look at <a href="https://github.com/auth0/angular2-jwt">https://github.com/auth0/angular2-jwt</a>.<a href="https://github.com/auth0/angular2-jwt"/></p>


            

            
        
    </div>



  
<div><h1 class="header-title">Building an iOS app to receive push notifications</h1>
                
            
            
                
<p>A <strong>push notification</strong> is an important feature to engage users frequently, especially when the users are not using the app. Many people download an app, but only open it a few times. If you send them a push notification message, it will encourage them to open the app to get involved in a new activity. Implementing push notifications is very complex if you have to build everything from scratch; however, OneSignal makes it very simple. A push notification provider is a server that can communicate with the <strong>Apple Push Notification service</strong> (<strong>APNs</strong>), or Google's <strong>Firebase Cloud Messaging</strong> (<strong>FCM</strong>). You can set up your own provider server using existing open sources, but you have to maintain this server separately and keep up with potential changes from the APN APIs.</p>
<p>In this section, you will learn how to do the following things:</p>
<ul>
<li>Set up OneSignal for iOS push notification</li>
<li>Configure an iOS app, certificates (app and push), and provisioning profile</li>
<li>Write code to receive push notifications</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>It's required to have a physical iOS device available in order to test for notification messages.</p>
<p>You must also register for the <strong>A</strong><strong>pple Developer Program (ADP</strong>) in order to access <a href="https://developer.apple.com">https://developer.apple.com</a> and <a href="https://itunesconnect.apple.com">https://itunesconnect.apple.com</a>, because these websites will require an approved account.</p>
<p>In addition to that, you must have an Apple Mac and Xcode installed.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it</h1>
                
            
            
                
<p>You need the device to see the push notification. We will be doing this in multiple steps:</p>
<ul>
<li>Creating an Apple Signing Certificate</li>
<li>Adding devices and creating a provisioning profile</li>
<li>Creating push certificates for use in the OneSignal dashboard</li>
<li>Configuring app in OneSignal dashboard</li>
<li>Coding the application</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Let's create an Apple signing certificate</h1>
                
            
            
                
<p>Follow the instructions to create apple signging certficiates:</p>
<ol>
<li>Visit the <strong>Apple Developer</strong> website at <a href="https://developer.apple.com" target="_blank">https://developer.apple.com</a> and log in with your credentials.</li>
<li>
<p>Click on Certificates, Identifiers &amp;amp; Profiles, as illustrated in the following screenshot:</p>
<div><img src="img/189f60ec-21a6-4832-87ca-2e3e25b2a0fd.png" style="width:16.33em;height:3.33em;" width="520" height="108"/></div>
</li>
<li>Select the correct device platform you are targeting. In this case, it will be iOS, tvOS, watchOS as shown in the following screenshot:
<div><img src="img/69fccd5c-b67a-4d78-acc4-ae1e4875a253.png" style="width:14.58em;height:9.42em;" width="442" height="286"/></div>
</li>
</ol>
<ol start="4">
<li>Navigate to <strong>Identifiers</strong> | <strong>App IDs</strong> to create an app ID, as illustrated in the following screenshot:</li>
</ol>
<div><img src="img/e9b70cb7-7fd3-4182-9af3-ff731012c199.png" style="width:18.17em;height:17.67em;" width="466" height="454"/></div>
<ol start="5">
<li class="mce-root">Click on the plus (<strong>+</strong>) button in the top-right corner of the screen, as shown in the following screenshot:</li>
</ol>
<div><img src="img/512a5a81-883e-4c5a-bc5e-af233a243372.png" style="width:42.17em;height:9.33em;" width="1370" height="304"/></div>
<ol start="6">
<li>Fill in the form to register your app ID. The <kbd>Name</kbd> field could be anything. You can provide the name of your project (that is, <kbd>MyiOSPush</kbd>) to keep things simple, as shown:</li>
</ol>
<div><img src="img/810b191b-deda-4f9d-bec9-458c501f56e9.png" style="width:34.08em;height:19.08em;" width="1276" height="716"/></div>
<ol start="7">
<li>The important part that you need to do correctly here is the <strong>Bundle ID</strong>, because it must match your bundle identifier in the <kbd>./config.xml</kbd> file or Xcode, as illustrated:</li>
</ol>
<div><img src="img/6e16669b-0f5d-4bed-9b9d-dfc7d28c12fd.png" style="width:37.25em;height:28.67em;" width="1286" height="994"/></div>
<ol start="8">
<li>To enable push notifications, you need to check the <strong>Push Notifications</strong> service on the following page:</li>
</ol>
<div><img src="img/564d0e89-2135-4c03-b57a-2e6646f35e60.png" style="width:39.83em;height:39.08em;" width="1280" height="1258"/></div>
<ol start="9">
<li>Select <strong>Register</strong>, as shown:</li>
</ol>
<div><img src="img/fcabbfc8-002a-4e51-9294-0300e1e6b061.png" style="width:25.17em;height:3.75em;" width="710" height="106"/></div>
<ol start="10">
<li>Select <strong>Done</strong> to complete the step to create an app ID, as follows:</li>
</ol>
<div><img src="img/94b8ba8b-9319-44d7-b432-4ce6f654462a.png" style="width:8.33em;height:3.25em;" width="252" height="102"/></div>
<ol start="11">
<li>To start with certificate creation, you will need to generate a certificate signing request file locally on your Mac OSX using <strong>Keychain Access</strong>. Navigate to the Keychain Access in the top-left menu, and navigate to Certificate Assistant | Request a Certificate From a Certificate Authority..., as illustrated:</li>
</ol>
<div><img src="img/b3953ec7-f9ce-487f-b163-67bd7742e677.png" style="width:47.00em;height:15.42em;" width="1370" height="450"/></div>
<ol start="12">
<li>Enter your User Email Address and Common Name. Leave the CA Email Address field blank and check Saved to disk, as shown:
<div><img src="img/e204b005-ef88-41be-a30a-b428546a89a8.png" style="width:37.92em;height:26.67em;" width="1236" height="874"/></div>
</li>
</ol>
<ol start="13">
<li>Save your <kbd>CertificateSigningRequest.certSigningRequest</kbd> file, as follows:
<div><img src="img/34b57ad2-3b58-4973-b3ad-e440f8562772.png" style="width:29.42em;height:11.67em;" width="850" height="340"/></div>
</li>
<li>Navigate to the <strong>Apple Developer</strong> website, and navigate to Certificates | All, as shown:
<div><img src="img/d4b8d8cf-0c7f-4b1c-bf30-bbe17480bf92.png" style="width:17.42em;height:11.17em;" width="456" height="292"/></div>
</li>
<li>Click on the plus (<strong>+</strong>) button in the top-right corner to start creating a certificate,<br/>
as follows:
<div><img src="img/724946ee-fa34-45f0-8982-0989d7bf8e95.png" style="width:39.17em;height:9.33em;" width="1368" height="326"/></div>
</li>
<li>Now, you just have to go through the steps on the website to fill out the necessary information. In this example, you will select the Development version instead of Production, as illustrated:
<div><img src="img/ef1ebdb8-e041-47dd-b984-f8fc8ecfbac9.png" style="width:39.58em;height:22.33em;" width="1412" height="800"/></div>
</li>
</ol>
<ol start="17">
<li>Click on the Continue button, as follows, to proceed:
<div><img src="img/47496f99-10a3-4845-aef6-29e6756b61a0.png" style="width:43.92em;height:37.42em;" width="1318" height="1124"/></div>
</li>
<li>Click on the Choose File... button, as shown in the following screenshot, to upload your signing request file that you saved earlier:
<div><img src="img/8cb24d68-5fb7-4bed-9fb0-12cd07886fff.png" style="width:43.25em;height:10.33em;" width="1360" height="326"/></div>
</li>
</ol>
<ol start="19">
<li>Click on the Continue button, as illustrated, to proceed:
<div><img src="img/6d68fb1b-cbf5-4895-8195-52acc72ca269.png" style="width:28.83em;height:4.17em;" width="702" height="102"/></div>
</li>
<li>Click on the Download button to download your iOS Development certificate file:
<div><img src="img/f3ee9595-ccba-4ce1-b42b-15a600155427.png" style="width:44.92em;height:19.42em;" width="1364" height="590"/></div>
</li>
<li>Click on the <kbd>.cer</kbd> file you downloaded, as shown so that it can be imported to Keychain Access:
<div><img src="img/e1ef7063-9090-45d6-8b7c-8d519ed1275b.png" style="width:20.17em;height:3.75em;" width="434" height="82"/></div>
</li>
</ol>
<p>It is very important to remember that you have to install the signing certificate on the Mac because when you will build the app, it will be used to sign the app. Just double-click the downloaded <kbd>.cer</kbd> file to install it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Adding a device and creating the provisioning profile</h1>
                
            
            
                
<ol>
<li>If you need to push the app to a specific device, you must register the device. Go to Devices | All:
<div><img src="img/28a7a9cb-2753-4f43-a24e-f707a02b2652.png" width="226" height="199"/></div>
</li>
<li>Click on the plus (<strong>+</strong>) button:
<div><img src="img/f31dfd0b-1eda-46d4-b0b6-81426e905b6e.png" style="width:29.17em;height:2.92em;" width="420" height="43"/></div>
</li>
<li>Provide the device a UDID and save to register the device. Observe the following screenshot:
<div><img src="img/8da506f1-d400-4620-a8b8-95c3073af1f2.png" style="width:37.42em;height:12.25em;" width="542" height="178"/></div>
</li>
</ol>
<ol start="4">
<li>You'll need a provisioning profile. Navigate to Provisioning Profiles | All:
<div><img src="img/7e947195-f5b2-412b-bb7b-69509b2ffeb2.png" style="width:19.83em;height:10.33em;" width="468" height="246"/></div>
</li>
<li>Click on the plus (<strong>+</strong>) button:
<div><img src="img/0c8f45ac-a17f-48b7-bb63-89a760f8a18b.png" style="width:37.17em;height:4.50em;" width="986" height="118"/></div>
</li>
<li>Select iOS App Development as your provisioning profile, since this example is for the development version only:
<div><img src="img/ab64001d-c36b-477c-9c80-72a8f0f7d5be.png" style="width:41.50em;height:24.33em;" width="1434" height="840"/></div>
</li>
</ol>
<ol start="7">
<li>Click on the Continue button:</li>
</ol>
<div><img src="img/94a9f328-b9f5-4629-a095-4587741fa569.png" style="width:20.08em;height:4.67em;" width="494" height="116"/></div>
<ol start="8">
<li class="mce-root">Select the correct App ID in the drop-down menu, and save to finalize your provisioning profile creation:</li>
</ol>
<div><img style="color: black;font-size: 1em;width:40.67em;height:20.42em;" src="img/bf178e13-acb5-4ed4-b851-e4937f4a19a3.png" width="1234" height="620"/></div>
<ol start="9">
<li>Click on the Continue button:</li>
</ol>
<div><img src="img/d7d1596b-a0f0-4d54-af35-e20fd7d4f1ac.png" style="width:24.83em;height:4.58em;" width="706" height="130"/></div>
<ol start="10">
<li class="mce-root">Select the iOS Development certificate you created earlier, as shown in the following screenshot:</li>
</ol>
<div><img src="img/729f9d7f-cf74-42d9-acca-8337e810d90c.png" style="width:43.08em;height:18.00em;" width="1372" height="574"/></div>
<ol start="11">
<li class="mce-root">As illustrated, select at least one device that you want to be able to install the app for testing:</li>
</ol>
<div><img style="text-align: center;font-size: 1em;width:43.08em;height:24.08em;" src="img/f1b2b79d-7bdf-4a57-9676-52b5937b87f5.png" width="1376" height="768"/></div>
<ol start="12">
<li>Provide a <strong>Profile Name</strong> to your provisioning profile, as shown:
<div><img src="img/08b92673-f21b-4388-a707-50dad9143990.png" style="width:33.17em;height:21.75em;" width="1142" height="748"/></div>
</li>
<li>
<p class="CDPAlignLeft CDPAlign">Click on the Download button to download the provisioning profile file (that is, <kbd>MyiOSPush_Provisioning_Profile.mobileprovision</kbd>):</p>
<div><img src="img/99d1e0d0-8bcf-4d0d-bfcb-7ce2c1987638.png" style="width:33.33em;height:23.92em;" width="1104" height="794"/></div>
</li>
</ol>
<ol start="14">
<li>Click on <kbd>MyiOSPush_Provisioning_Profile.mobileprovision</kbd>, which you just downloaded, in order to import it into Xcode:
<div><img src="img/ac50f4a8-caa3-42ac-9cfe-68f4b4725abb.png" style="width:19.33em;height:3.67em;" width="428" height="82"/></div>
</li>
</ol>
<p>This step is very important, because if you don't import it into Xcode, your app cannot be built successfully. If your app failed to build because of an invalid provisioning profile, it's best to check the provisioning profile status in the Developer Console.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Creating a push certificate</h1>
                
            
            
                
<p>Follow the steps to create push certificates for iOS application:</p>
<ol>
<li>To enable the Push Notification feature, you must request a Push Certificate, which is different from the app certificate. Select the App ID that you created earlier (that is, <kbd>MyiOSPush</kbd>):
<div><img src="img/f2dfc9bf-df8f-469e-9760-3f0ef2e6ad7c.png" width="1930" height="358"/></div>
</li>
<li>Click on the Edit button at the bottom of the page:
<div><img src="img/f34b3df3-d84a-4b09-833e-b9c05f85ac6a.png" style="width:35.92em;height:13.75em;" width="1040" height="398"/></div>
</li>
</ol>
<p>The Push Notifications must show the Configurable state. Otherwise, your app is not available for push notifications.</p>
<ol start="3">
<li>Click on the Create Certificates... button under the <strong>Push Notifications | Development SSL Certificate</strong> section:</li>
</ol>
<div><img src="img/e7f7a436-9165-465f-8c01-9ad2b0759e47.png" style="width:43.50em;height:27.58em;" width="1302" height="826"/></div>
<ol start="4">
<li>You will be taken to a new page to create your CSR file. Click on the Continue button:</li>
</ol>
<div><img src="img/be1e422c-ab7d-4231-a06f-32d390547458.png" style="width:38.83em;height:40.83em;" width="1298" height="1364"/></div>
<ol start="5">
<li class="mce-root">Click on the Choose File... button: <br/></li>
</ol>
<div><img src="img/4f69b393-e402-46a6-9882-d2848483eb0d.png" style="width:40.08em;height:24.17em;" width="1358" height="818"/></div>
<ol start="6">
<li>Locate the <kbd>CertificateSigningRequest.certSigningRequest</kbd> file that you created earlier:</li>
</ol>
<div><img style="font-size: 1em;width:43.75em;height:11.08em;" src="img/21fe30d5-bc16-40ca-bfe8-905681719851.png" width="1360" height="344"/></div>
<p>You must upload the same <kbd>.certSigningRequest</kbd> file as you did for the app certificate. Otherwise, your app will not receive push notifications, and it's very hard to debug.</p>
<ol start="7">
<li>Click on the Continue button:</li>
</ol>
<div><img src="img/6a3c48aa-4a9a-48cf-a4e1-150cb3b42eb0.png" style="width:27.33em;height:3.83em;" width="690" height="96"/></div>
<ol start="8">
<li class="mce-root">Click on the Download button to download the certificate file. You can name it <kbd>aps_certificate.cer</kbd> to avoid overwriting to the earlier <kbd>.cer</kbd> file:</li>
</ol>
<div><img src="img/5d77d4a4-f945-40cd-a1c5-910b872f6d81.png" style="width:41.00em;height:25.92em;" width="1360" height="860"/></div>
<ol start="9">
<li class="mce-root">Once your <kbd>.cer</kbd> file is downloaded, you need to click on it to import it to <strong>Keychain Access</strong>:</li>
</ol>
<div><img style="text-align: center;font-size: 1em;width:19.25em;height:3.58em;" src="img/de2a67f9-393e-4fa4-8d87-d6a2aabca780.png" width="434" height="82"/></div>
<ol start="10">
<li class="mce-root">Locate the new push services certificate in Keychain Access and select it, as illustrated in the following screenshot:</li>
</ol>
<div><img style="font-size: 1em;color: black;" src="img/265ba748-1788-4c52-a989-dee7750310bd.png" width="1998" height="328"/></div>
<ol start="11">
<li class="mce-root">
<p>Right-click on the certificate and select Export:</p>
<div><img src="img/dfdd9afe-1e19-487c-af1e-e45586dc67c9.png" style="width:44.92em;height:20.00em;" width="1298" height="578"/></div>
</li>
<li style="color: black">Give it a new name to avoid overwriting it to the app certificate. This process is, basically, to convert from a <kbd>.cer</kbd> to <kbd>.p12</kbd> file for OneSignal:</li>
</ol>
<div><img style="color: black;font-size: 1em;width:27.83em;height:14.75em;" src="img/7ef57e72-8452-4587-a4cf-b95684daf287.png" width="838" height="444"/></div>
<ol start="13">
<li>Provide a password for this <kbd>.p12</kbd> file to protect it:
<div><img src="img/1c53f8e6-abbb-473e-aa14-3db591775edb.png" style="width:31.75em;height:20.75em;" width="884" height="580"/></div>
</li>
</ol>
<p>A password for the <kbd>.p12</kbd> file is not mandatory for OneSignal, but it is in the best interest to secure it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Now let's configure OneSignal</h1>
                
            
            
                
<p>Follow the below steps to configure OneSignal for sending push notifications:</p>
<ol>
<li>Go to <a href="https://onesignal.com">https://onesignal.com</a> and create an account.</li>
</ol>
<ol start="2">
<li>In the dashboard, click on Add a new app. You will see the following dialog:</li>
</ol>
<div><img src="img/b3a9ea6a-07ca-45e3-9ba3-66181649f1ba.png" style="width:34.00em;height:15.08em;" width="566" height="252"/></div>
<ol start="3">
<li class="mce-root">Fill it with the name that you want and click on Create. It will open the following dialog:</li>
</ol>
<div><img src="img/ca40af39-a8cc-4dd5-9e27-887215c920fa.png" style="width:44.25em;height:27.58em;" width="856" height="535"/></div>
<ol start="4">
<li>Select <strong>Apple iOS</strong> and Hit Next. You will see the following:</li>
</ol>
<div><img src="img/6580cb88-b414-4da6-afed-ef7260c802e7.png" style="width:48.00em;height:30.17em;" width="857" height="539"/></div>
<ol start="5">
<li>Select Upload optional sandbox certificate and upload the <kbd>.p12</kbd> file for the <strong>push certificate</strong> that you created earlier. Also, fill in the password for the <kbd>.p12</kbd> file. Then hit Save.</li>
<li>Now in the top main menu, click on Keys &amp;amp; ID. You will see OneSignal App ID, as shown below:<br/>
<div><img src="img/80f75dd8-6954-4fe0-aa73-7b87d35ebd43.png" width="785" height="50"/></div>
</li>
</ol>
<p style="padding-left: 60px">Note down the OneSignal App ID somewhere; we need this to configure our app.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Let's code</h1>
                
            
            
                
<p>Follow the below steps to create the example app:</p>
<ol>
<li>Now, create a new <kbd>MyiOSPush</kbd> app using the <kbd>blank</kbd> template, as shown, and go to the <kbd>MyiOSPush</kbd> folder:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start MyiOSPush blank</strong>
<strong>$ cd MyiOSPush</strong></pre>
<ol start="2">
<li>Install the Cordova plugin and <strong>Ionic Native</strong> wrapper for <strong>OneSignal</strong>:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova plugin add onesignal-cordova-plugin<br/>$ npm install --save @ionic-native/onesignal</strong></pre>
<p style="padding-left: 60px">We need to add this <kbd>ionic-native</kbd> plugin to <kbd>app.module.ts</kbd>.</p>
<ol start="3">
<li>We also need to install <kbd>cocoapods</kbd>. Go to <strong>Terminal</strong>, and install it as follows:</li>
</ol>
<pre style="padding-left: 30px"><strong>sudo gem install cocoapods</strong><br/><strong>pod repo update</strong></pre>
<ol start="4">
<li>Open and edit <kbd>./src/app/app.module.ts</kbd> with the following content:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/>import { OneSignal } from '@ionic-native/onesignal';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/><br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    OneSignal,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler}<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<ol start="5">
<li>You need to modify your home page code in order to receive notification messages. Open and edit <kbd>./src/pages/home/home.html</kbd> and paste the given code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>  &lt;ion-navbar&gt;<br/>    &lt;ion-title&gt;<br/>      Push Notification<br/>    &lt;/ion-title&gt;<br/>  &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content padding&gt;<br/>  &lt;h2 class="big-square" *ngIf="!this.messages.length"&gt;<br/>    You have no message<br/>  &lt;/h2&gt;<br/>  &lt;h3 class="sub-title" *ngIf="!!this.messages.length"&gt;<br/>    Your messages<br/>  &lt;/h3&gt;<br/>  &lt;ion-card *ngFor="let msg of messages"&gt;<br/>    &lt;ion-card-header&gt;<br/>      {{ msg.title }}<br/>    &lt;/ion-card-header&gt;<br/>    &lt;ion-card-content&gt;<br/>      {{ msg.text }}<br/>    &lt;/ion-card-content&gt;<br/>  &lt;/ion-card&gt;<br/>&lt;/ion-content&gt;</pre>
<ol start="6">
<li>Replace the content of the <kbd>home.ts</kbd> file, in the same folder, with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component, ChangeDetectorRef } from '@angular/core';<br/>import { NavController, Platform } from 'ionic-angular';<br/>import { OneSignal } from '@ionic-native/onesignal';<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  public messages = [];<br/>  public clicked: Boolean = false;<br/>  constructor(public navCtrl: NavController, public oneSignal: OneSignal, platform: Platform, private changeDetector: ChangeDetectorRef) {<br/>    platform.ready().then(() =&gt; {<br/>      this.oneSignalConfig();<br/>    });<br/>  }<br/><br/>  oneSignalConfig() {<br/>    this.oneSignal.startInit("94218e7a-2307-41fa-9bc3-20783b4cde9a");<br/>   <br/>    this.oneSignal.handleNotificationReceived().subscribe((value:any) =&gt; {<br/>      let msg = value.payload;<br/>      this.messages.push({<br/>        title: msg.title,<br/>        text: msg.body<br/>      });<br/>      this.changeDetector.detectChanges();<br/>    });<br/>    this.oneSignal.endInit();<br/>  }<br/>}</pre>
<p style="padding-left: 60px">In the <kbd>startInit</kbd> function, you have to pass your own <strong>OneSignal App ID</strong>, which you created earlier.</p>
<ol start="7">
<li>Replace <kbd>home.scss</kbd>, also in the <kbd>/home</kbd> folder, with the given code:</li>
</ol>
<pre style="padding-left: 60px">page-home {<br/>    .center {<br/>        text-align: center;<br/>    }<br/>    h2.big-square {<br/>        text-align: center;<br/>        padding: 50px;<br/>        color: #D91E18;<br/>        background: #F9BF3B;<br/>    }<br/>    h3.sub-title {<br/>        text-align: center;<br/>        padding: 10px;<br/>        color: #446CB3;<br/>        background: #E4F1FE;<br/>    }<br/>    ion-card ion-card-header {<br/>        padding: 10px 16px;<br/>        background: #F9690E;<br/>        color: white;<br/>    }<br/>    ion-card ion-card-header + ion-card-content,<br/>    ion-card .item + ion-card-content {<br/>        padding-top: 16px;<br/>    }<br/>}</pre>
<ol start="8">
<li>Connect your physical iPhone to the Mac via a USB connection.</li>
<li>Ensure that you are in the app folder, and build the app for the iOS platform, as follows:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova run ios</strong> </pre>
<ol start="10">
<li>The OS will prompt to allow codesign to sign using the iOS Developer certificate. You must accept this to allow access in order to build the app and upload it to your device:</li>
</ol>
<div><img src="img/998e5337-2dbc-46d4-ac56-0730820c66b8.png" style="width:34.08em;height:15.58em;" width="864" height="396"/></div>
<ol start="11">
<li>Verify that the app has been running successfully on the device. At this point, you have completed the push notification setup and coding. The next step is to send the push notification via the <strong>OneSignal dashboard</strong>. Here are the instructions:</li>
</ol>
<ol start="12">
<li>After selecting your app in OneSignal, you will see following side menu:</li>
</ol>
<div><img src="img/9fe68e62-8f9a-4087-9013-bcf938357fd6.png" style="width:15.08em;height:45.50em;" width="196" height="595"/></div>
<ol start="13">
<li>Click on New Message. You will see a screen like the following:</li>
</ol>
<div><img src="img/d67fd5f6-d3c9-4d40-b743-468188271e4f.png" width="1644" height="758"/></div>
<ol start="14">
<li>Select <kbd>Send to Everyone</kbd>, since at this point only you will be using the app. Then click <strong>Next</strong>. The following page will appear:
<div><img src="img/4e413845-d213-44a5-88db-2b3fcf14e033.png" style="width:48.92em;height:22.67em;" width="801" height="371"/></div>
</li>
<li>Type your Title and Message.</li>
</ol>
<ol start="16">
<li>In the top menu, you will see the following links. At this moment, we are at <strong>Message</strong>:
<div><img src="img/f8c033c8-65b5-45f7-b48f-4b7364bd5865.png" style="width:34.67em;height:5.75em;" width="434" height="72"/></div>
</li>
<li>If you want to do some configuration and scheduling, you can do it in the following sections. Otherwise, you can jump to <strong>Confirm</strong> link and you will see following buttons on the top right of the page:
<div><img src="img/3476abad-7405-4dc0-88ed-727158f82d96.png" style="width:13.42em;height:4.25em;" width="220" height="69"/></div>
</li>
<li>Just hit SEND MESSAGE, and OneSignal will deliver your push notification.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works</h1>
                
            
            
                
<p>To understand how the entire process works, let's summarize what you have done, as shown in the following section:</p>
<p>Set up your Apple Developer account by doing the following things:</p>
<ul>
<li>Creating an app ID</li>
<li>Creating an app certificate (after creating a signing request locally via Keychain Access)</li>
<li>Creating a provisioning profile</li>
<li>Creating a push certificate</li>
</ul>
<p class="mce-root">Set up your OneSignal App</p>
<p class="mce-root">Now, let's focus on the coding portion itself to understand how this works.</p>
<p class="mce-root">Inside <kbd>NgModul</kbd>, we added an <strong>Ionic Native</strong> wrapper for OneSignal in the providers array.</p>
<p class="mce-root">Then, in <kbd>home.ts</kbd>, In the constructor we initialized OneSignal by calling the <kbd>oneSignalConfig()</kbd> function. In the <kbd>oneSignalConfig()</kbd> function, we called the <kbd>startInit</kbd> function, which initiated the push notification registration process. We have to pass a OneSignal App ID to this function. Then, we subscribe to the <kbd>handleNotificationReceived</kbd> observable. It is fired each time the user gets a notification. In it, we are pushing each received push notification into <kbd>this.messages</kbd> array, and then we stop the initialization process with the <kbd>endInit</kbd> function, as shown in the following code:</p>
<pre> oneSignalConfig() {<br/>    this.oneSignal.startInit("94218e7a-2307-41fa-9bc3-20783b4cde9a");<br/>   <br/>    this.oneSignal.handleNotificationReceived().subscribe((value:any) =&gt; {<br/>      let msg = value.payload;<br/>      this.messages.push({<br/>        title: msg.title,<br/>        text: msg.body<br/>      });<br/>      this.changeDetector.detectChanges();<br/>    });<br/>    this.oneSignal.endInit();<br/>  }</pre>
<p>It is important to call change Detector's <kbd>detectChanges</kbd> function, otherwise, the UI will not be updated since this process is outside the scope of Angular's Change Detection.</p>
<p>In the <kbd>home.html</kbd> template, the messages will be displayed via the <kbd>messages</kbd> object, as shown in the following code:</p>
<pre>&lt;ion-card *ngFor="let msg of messages"&gt; 
  &lt;ion-card-header&gt; 
    {{ msg.title }} 
  &lt;/ion-card-header&gt; 
  &lt;ion-card-content&gt; 
    {{ msg.text }} 
  &lt;/ion-card-content&gt; 
&lt;/ion-card&gt;</pre>
<p>Here, each <kbd>message</kbd> item has the <kbd>title</kbd> and <kbd>text</kbd> fields.</p>
<p>If the user doesn't open the app, you will see that the notification appears in the notification area.</p>
<p class="mce-root CDPAlignLeft CDPAlign">This is how the app looks on an iPhone:</p>
<div><img src="img/74b6e01e-b216-4bf4-9e5c-3b8428b83f00.png" style="width:17.83em;height:35.50em;" width="833" height="1663"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">There's more...</h1>
                
            
            
                
<p>For more information about the APNs, you can visit the official documentation at <a href="https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html">https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html</a></p>
<p>For more information about OneSignal setup, take a look at <a href="https://onesignal.com/ionic">https://onesignal.com/ionic</a>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Building an Android app to receive push notifications</h1>
                
            
            
                
<p>A push notification works in the same way as iOS for Google; however, instead of using the Apple Notification Service, you will be working through the FCM server, which is a new replacement for <strong>Google Cloud Messaging</strong> (<strong>GCM</strong>). However, OneSignal abstracts this process so that you don't have to code using a different API. You will be using the same push object as for the iOS app.</p>
<p>For more information about the differences between FCM and GCM, visit the FAQs at <a href="https://firebase.google.com/support/faq">https://firebase.google.com/support/faq</a>.<a href="https://firebase.google.com/support/faq"/></p>
<p>In this section, you will learn how to do the following things:</p>
<ul>
<li>Set up OneSignal for Android push notification</li>
<li>Configure the Firebase project for the push API</li>
<li>Write code to receive push notifications on Android</li>
</ul>
<p>You will be using the same code base as your iOS push notification example. The main difference is the process to set up in your Firebase and OneSignal account.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>You can test the Android push notification using the Android emulator. So, there is no need to have a physical Android device available.</p>
<p>In order to gain access, you must also register for Firebase at <a href="https://console.firebase.google.com">https://console.firebase.google.com</a>.</p>
<p>In addition to your current setup, you need to install <strong>Android Studio</strong>.</p>
<ol>
<li>Observe the following screenshot:</li>
</ol>
<div><a href="https://software.intel.com/en-us/android/articles/installation-instructions-for-intel-hardware-accelerated-execution-manager-windows"><img src="img/a6608fa6-dbe4-4e5a-8cbf-22f68f5e5050.png" style="width:55.17em;height:32.08em;" width="1982" height="1150"/></a></div>
<ol start="2">
<li>Android SDK Tools, Build Tools, Platform Tools and Intel <strong>Hardware Accelerated Execution Manager</strong> (<strong>HAXM</strong>) (<a href="https://software.intel.com/en-us/android/articles/installation-instructions-for-intel-hardware-accelerated-execution-manager-windows">https://software.intel.com/en-us/android/articles/installation-instructions-for-intel-hardware-accelerated-execution-manager-windows</a>).Observe the following screenshot:</li>
</ol>
<div><img style="font-size: 1em;width:52.67em;height:38.58em;" src="img/4addcf93-a11b-4297-a8dd-34ab100f6a84.png" width="1514" height="1108"/></div>
<ol start="3">
<li>At least one <strong>Android Virtual Device</strong> (<strong>AVD</strong>) has been created (use the <strong><kbd>$ android avd</kbd></strong> command line to open AVD Manager). Observe the following screenshot:</li>
</ol>
<div><img style="color: black;font-size: 1em;width:50.67em;height:33.17em;" src="img/d80c5a17-dcff-4b53-8473-c28667309f58.png" width="1398" height="916"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it</h1>
                
            
            
                
<p>First, we are going to configure push notifications in Firebase console and then we are going to code the example app.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Configuring Firebase for push notifications</h1>
                
            
            
                
<p>Here are the instructions for configuring firebase console:</p>
<ol>
<li>You will need a Firebase project number and a Firebase server ID in order to receive push notifications. First, let's log into the Firebase console at <a href="https://console.firebase.google.com" target="_blank">https://console.firebase.google.com</a>.</li>
</ol>
<ol start="2">
<li>Click on the CREATE NEW PROJECT button, and fill in a project name (that is, <kbd>MyAndroidPush</kbd>):</li>
</ol>
<div><img src="img/0fc7dccd-0fbe-4b38-b610-ac2cbc822e00.png" style="width:25.83em;height:4.50em;" width="898" height="158"/></div>
<ol start="3">
<li>Navigate to Grow | Notifications in the left navigation menu:</li>
</ol>
<div><img src="img/a814fd9d-3712-402e-b9b7-b1969bae39a2.png" style="width:13.00em;height:8.33em;" width="370" height="238"/></div>
<ol start="4">
<li>Select the Android icon:</li>
</ol>
<div><img src="img/71e03402-0764-4816-8662-49cfae476a3f.png" style="width:12.75em;height:7.67em;" width="412" height="248"/></div>
<p>The FCM service also supports the iOS app. So, it's possible that you can use FCM for both the iOS and Android projects.</p>
<ol start="5">
<li>Provide the <strong>Package name</strong> in the form. You can copy and paste the Package name from your app project at <kbd>./config.xml</kbd>:</li>
</ol>
<div><img style="text-align: center;font-size: 1em;width:43.75em;height:22.92em;" src="img/1371966d-f1e2-4621-aa43-226375baf2dc.png" width="1346" height="706"/></div>
<ol start="6">
<li>Select CONTINUE, and save the JSON file somewhere. You will not need this JSON file for the Ionic project:</li>
</ol>
<div><img src="img/0714cffa-cfc8-4ac5-af4c-afcdff9b5aee.png" style="width:44.58em;height:35.17em;" width="1344" height="1060"/></div>
<ol start="7">
<li>Click on the FINISH button to complete setting up of the notification service:
<div><img src="img/41f115c3-1523-435c-a441-a3320aff3717.png" style="width:7.17em;height:3.17em;" width="202" height="92"/></div>
</li>
</ol>
<ol start="8">
<li>Now, you will need the Server key and Sender ID. Navigate to the gear icon in the top-left corner and select the Project settings menu item:
<div><img src="img/4b6f36bf-d056-4f3e-8129-16a7833d4296.png" style="width:14.25em;height:8.33em;" width="389" height="227"/></div>
</li>
<li>Select the CLOUD MESSAGING tab:
<p>. <img src="img/d9a82e78-c2de-454e-b5e9-4af939cd59ed.png" style="width:14.83em;height:4.50em;" width="384" height="118"/></p>
</li>
<li>Copy both the <strong>Server key</strong> and Sender ID (the same as Project ID if using GCM):
<div><img style="text-align: center;font-size: 1em;" src="img/97dd7004-1a2d-43b7-a9b5-53f7d3bd37a7.png" width="1984" height="338"/></div>
</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">Configuring OneSignal</h1>
                
            
            
                
<p>Here are the instructions to configure OneSignal:</p>
<ol>
<li>In your <strong>OneSignal dashboard</strong>, open your previously created app for iOS and click on <strong>App Settings</strong>. You will see the following page:</li>
</ol>
<div><img src="img/6a145702-47d9-4743-bf9b-a41225412e8c.png" style="width:58.50em;height:32.50em;" width="1204" height="670"/></div>
<ol start="2">
<li>Click on the CONFIGURE button parallel to <strong>Google Android Platform</strong>. You will see the following dialog:</li>
</ol>
<div><img src="img/1bdb356a-96bd-494c-a7f9-f6f6b027088d.png" width="855" height="536"/></div>
<ol start="3">
<li>Enter the <strong>Server API Key</strong> and <strong>Project Number</strong> (also called a <strong>Sender ID</strong>) to their appropriate fields, and hit <strong>Save</strong>.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">Let's code now</h1>
                
            
            
                
<p>Here are the instructions for creating example app:</p>
<ol>
<li>Create a new <kbd>MyAndroidPush</kbd> app using the <kbd>blank</kbd> template, as follows, and go to the <kbd>MyAndroidPush</kbd> folder:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic start MyAndroidPush blank</strong>
<strong>$ cd MyAndroidPush</strong></pre>
<ol start="2">
<li>Install the Cordova plugin and Ionic native wrapper for OneSignal:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova plugin add onesignal-cordova-plugin<br/>$ npm install --save @ionic-native/onesignal</strong></pre>
<ol start="3">
<li>Open and edit <kbd>./src/app/app.module.ts</kbd> with the following content:</li>
</ol>
<pre style="padding-left: 60px">import { BrowserModule } from '@angular/platform-browser';<br/>import { ErrorHandler, NgModule } from '@angular/core';<br/>import { IonicApp, IonicErrorHandler, IonicModule } from 'ionic-angular';<br/>import { SplashScreen } from '@ionic-native/splash-screen';<br/>import { StatusBar } from '@ionic-native/status-bar';<br/>import { OneSignal } from '@ionic-native/onesignal';<br/><br/>import { MyApp } from './app.component';<br/>import { HomePage } from '../pages/home/home';<br/><br/>@NgModule({<br/>  declarations: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  imports: [<br/>    BrowserModule,<br/>    IonicModule.forRoot(MyApp)<br/>  ],<br/>  bootstrap: [IonicApp],<br/>  entryComponents: [<br/>    MyApp,<br/>    HomePage<br/>  ],<br/>  providers: [<br/>    StatusBar,<br/>    SplashScreen,<br/>    OneSignal,<br/>    {provide: ErrorHandler, useClass: IonicErrorHandler}<br/>  ]<br/>})<br/>export class AppModule {}</pre>
<ol start="4">
<li>The code for your home page is very similar to the iOS push example. Open and edit <kbd>./src/pages/home/home.html</kbd>, and paste the following code:</li>
</ol>
<pre style="padding-left: 60px">&lt;ion-header&gt;<br/>  &lt;ion-navbar&gt;<br/>    &lt;ion-title&gt;<br/>      Push Notification<br/>    &lt;/ion-title&gt;<br/>  &lt;/ion-navbar&gt;<br/>&lt;/ion-header&gt;<br/><br/>&lt;ion-content padding&gt;<br/>  &lt;h2 class="big-square" *ngIf="!this.messages.length"&gt;<br/>    You have no message<br/>  &lt;/h2&gt;<br/>  &lt;h3 class="sub-title" *ngIf="!!this.messages.length"&gt;<br/>    Your messages<br/>  &lt;/h3&gt;<br/>  &lt;ion-card *ngFor="let msg of messages"&gt;<br/>    &lt;ion-card-header&gt;<br/>      {{ msg.title }}<br/>    &lt;/ion-card-header&gt;<br/>    &lt;ion-card-content&gt;<br/>      {{ msg.text }}<br/>    &lt;/ion-card-content&gt;<br/>  &lt;/ion-card&gt;<br/>&lt;/ion-content&gt;</pre>
<ol start="5">
<li>Replace the content of the <kbd>home.ts</kbd> file, in the same folder, with the following code:</li>
</ol>
<pre style="padding-left: 60px">import { Component, ChangeDetectorRef } from '@angular/core';<br/>import { NavController, Platform } from 'ionic-angular';<br/>import { OneSignal } from '@ionic-native/onesignal';<br/><br/>@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {<br/>  public messages = [];<br/>  public clicked: Boolean = false;<br/>  constructor(public navCtrl: NavController, public oneSignal: OneSignal, platform: Platform, private changeDetector: ChangeDetectorRef) {<br/>    platform.ready().then(() =&gt; {<br/>      this.oneSignalConfig();<br/>    });<br/>  }<br/><br/>  oneSignalConfig() {<br/>    this.oneSignal.startInit("94218e7a-2307-41fa-9bc3-20783b4cde9a", "539293856976");<br/>    this.oneSignal.handleNotificationReceived().subscribe((value:any) =&gt; {<br/>      // do something when notification is received<br/>      let msg = value.payload;<br/>      this.messages.push({<br/>        title: msg.title,<br/>        text: msg.body<br/>      });<br/>      this.changeDetector.detectChanges();<br/>    });<br/>    this.oneSignal.endInit();<br/>  }<br/>} </pre>
<p style="padding-left: 60px">If you take notice, for Android, a call to <kbd>startInit</kbd> has two parameters instead of one parameter. The first parameter is <strong>OneSignal App ID</strong>, and the second parameter is <strong>Google Project Number/Sender ID</strong>.</p>
<ol start="6">
<li>Replace <kbd>home.scss</kbd>, also in the <kbd>/home</kbd> folder, with the following code:</li>
</ol>
<pre style="padding-left: 60px">page-home {<br/> .center {<br/>     text-align: center;<br/> }<br/> h2.big-square {<br/>     text-align: center;<br/>     padding: 50px;<br/>     color: #D91E18;<br/>     background: #F9BF3B;<br/> }<br/> h3.sub-title {<br/>     text-align: center;<br/>     padding: 10px;<br/>     color: #446CB3;<br/>     background: #E4F1FE;<br/> }<br/> ion-card ion-card-header {<br/>     padding: 10px 16px;<br/>     background: #F9690E;<br/>     color: white;<br/> }<br/> ion-card ion-card-header + ion-card-content,<br/> ion-card .item + ion-card-content {<br/>     padding-top: 16px;<br/> }<br/>}</pre>
<ol start="7">
<li>Ensure that you are in the app folder and build for the Android platform, as follows:</li>
</ol>
<pre style="padding-left: 30px"><strong>$ ionic cordova run android</strong></pre>
<p>The process of sending push notifications is exactly the same as iOS.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works</h1>
                
            
            
                
<p>The process is almost the same as iOS. The reason is, OneSignal abstracts lots of things for us. The difference is that, instead of sending push notification requests to APNS, it is now sending push notification requests to Google's FCM servers. Then, it forwards the push notification to the actual device.</p>
<p>You will see the notification in the Android phone as follows:</p>
<div><img src="img/4af930b7-46f2-4e3c-8535-ab9533ef612b.png" style="width:20.83em;height:37.08em;" width="720" height="1280"/></div>
<p>By Default, it will use app icon as a notification icon, but you can customize that for Android. Take a look at <a href="https://documentation.onesignal.com/docs/customize-notification-icons" target="_blank">https://documentation.onesignal.com/docs/customize-notification-icons</a>. On iOS, you can't customize the icon.</p>
<p>When you open the app, you will see notifications in the app as follows:</p>
<div><img src="img/ac92decd-d4a0-4805-92fd-16387923f41a.png" style="width:20.25em;height:36.00em;" width="720" height="1280"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">There's more...</h1>
                
            
            
                
<p>For more information about the <strong>Firebase Notification</strong> service, you can visit the official documentation at <a href="https://firebase.google.com/docs/cloud-messaging/.">https://firebase.google.com/docs/cloud-messaging/</a>.</p>


            

            
        
    </div>



  </body></html>