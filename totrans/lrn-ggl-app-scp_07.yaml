- en: Chapter 7. Creating Interactive Webpages
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, you learned to create an RSS/Atom feed reader, stock
    quote ticker, language translator, and to create a document reviewing and commenting
    application.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, you will learn:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: To create web applications that return Sheet data as HTML, JSON, and PDF
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To send HTTP/HTTPS request with the query string
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To create an RSS feed
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To create a file upload application
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To create a timesheet application
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a web app to render Sheet data as HTML
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We will create an application to return Sheet data as HTML in the browser.
    Create a Sheet, rename it as `Data`, and populate it with some test data as shown
    in the next screenshot. You can populate the Sheet with any random data with the
    three columns named `First Name`, `Last Name`, and `Full Name`:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a web app to render Sheet data as HTML](img/B05010_07_03.jpg)'
  id: totrans-10
  prefs: []
  type: TYPE_IMG
- en: 'In the `Code.gs` file, create the `doGet` function as shown here:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The `HtmlService` function can be used to create any HTML content. The preceding
    `doGet` function returns HTML content created by `HtmlService` to the browser.
    Publish the script as explained earlier, and enter the URL in the browser's address
    bar. You can see the result as shown in the following screenshot. The data shown
    may vary as per your input data.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a web app to render Sheet data as HTML](img/B05010_07_04.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
- en: Creating a web app to return JSON
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Now, we will see how to return JSON string instead of HTML content. In the
    `Data` Sheet, add another column named `DOB` as shown here:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a web app to return JSON](img/B05010_07_05.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
- en: 'Create the `doGet` function as shown here:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The output in the browser will be JSON string as follows:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a web app to return JSON](img/B05010_07_06.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
- en: Converting Sheet data as a PDF file
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can create an application to convert Sheet data into a PDF file and store
    it in Drive, and return the PDF file''s URL to the user:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: 'In the `Code.gs` file, create the `doGet` function as listed here:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Create a new HTML file, `Template.html`, and enter the following HTML code.
    In this code, the `data` array is a 2-dimensional array already assigned to the
    `template` object in the `doGet` function:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-27
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: In the mentioned code, the template markers `<?` and `?>` enclose the script
    code, which is identical to the `script` tag in the normal HTML code. The enclosed
    code executes, but does not return anything. The markers `<?=` and `?>` return
    the result of the enclosed code. For example, `<?= data[i][j] ?>` returns the
    *i*th row *j*th column value of a 2-dimensional `data` array.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: 'For your understanding the server script without template markup in the previous
    code is reproduced here:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Publish and enter the published URL in a browser''s address bar. The result
    will be as shown in the following screenshot. Click on the hyperlink to open the
    PDF file in Drive:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: '![Converting Sheet data as a PDF file](img/B05010_07_07.jpg)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
- en: 'A sample output of the created PDF as per the Sheet data is shown in the following
    screenshot. The output may vary as per your input data:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: '![Converting Sheet data as a PDF file](img/B05010_07_08.jpg)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
- en: Sending an HTTP/HTTPS request with query string
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You can send an HTTP/HTTPS request along with the query string. To do this,
    append the published URL with your query string.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'For example: `https://script.google.com/macros/s/AKfycbxa4ErKHiX_0gQ0JUU-Q1qMhvRrOsrx3HXuVZp7pzX8UVxMu4w/exec?`**fname=John**'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'A sample of the logged HTTP/HTTPS request''s `event` object is shown here:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: '![Sending an HTTP/HTTPS request with query string](img/B05010_07_09.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
- en: 'The `doGet` function listed in the following code snippet shows how you can
    use the `event` object to get the required parameters for further processing:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The mentioned `doGet` function gets the `fname` parameter from the query string
    and returns the calculated `age` value along with `dob` for matching `fname`.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: '![Sending an HTTP/HTTPS request with query string](img/B05010_07_10.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
- en: Creating RSS feed using ContentService
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You created an RSS reader application in [Chapter 6](ch06.html "Chapter 6. Creating
    Feed Reader and Translator Applications"), *Creating Feed Reader and Translator
    Applications*. Now, you can create an application to publish an RSS feed. Put
    the RSS data in a Sheet as shown here:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating RSS feed using ContentService](img/B05010_07_11.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
- en: 'Also, edit/enter the following `doGet` function:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Publish the script as you did before. You can use the published URL as the RSS
    URL in your RSS reader application built in the previous chapter.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Creating a file upload application
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can create an application to upload any file to Drive from the browser.
    Create the `doGet` and `uploadFiles` functions in the `Code.gs` file as listed
    here:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: 'In the `Code.gs` file, add this code:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `uploadFiles` function looks for an existing folder with the name `Uploaded
    Files`. If not found, then it creates the same within root, `My Drive,` folder.
    Subsequently, it creates the file passed with the argument and returns the created
    file's URL.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: 'Update the code in the `Form.html` file:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The preceding code renders the upload form controls, and if **Upload** is clicked,
    then it calls the `uploadFiles` server function.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: 'A sample of the file upload form''s controls is shown here:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a file upload application](img/B05010_07_12.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
- en: Click on the **Browse…** button to select any file stored locally. Then, click
    on the **Upload** button to upload to Drive. The selected file will be uploaded
    to the `Uploaded Files` folder within the `My Drive` folder.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
- en: After a successful upload, an alert box with the uploaded file's URL will be
    displayed as shown in the following screenshot. You can use the URL to verify
    the successful file upload.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a file upload application](img/B05010_07_13.jpg)'
  id: totrans-63
  prefs: []
  type: TYPE_IMG
- en: Creating an employee timesheet application
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: From the knowledge and experience gathered by creating the preceding applications,
    you can create this full blown timesheet application. This application can be
    used in an organization or company to log employees, worked hours in a day or
    shift. The daily attendance data will be backed in the `Backup` Sheet for future
    reference.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: Create a new spreadsheet with a Sheet named `EmployeesList` and populate it
    with employee names. All these names will be listed as a dropdown automatically
    in the user interface.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating an employee timesheet application](img/B05010_07_14.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: Create another Sheet named `TimeSheet` and arrange the column headers as shown
    in the following screenshot. Ensure columns *C*, *D*, *E*, and *F* are formatted
    as `date`, otherwise date may be shown as epoch number. Leave column *A* blank
    as it will be used by the script to mark the status of a shift such as `sb` (shift
    begin), `bb` (break begin), `be` (break end), and `se` (shift end).
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating an employee timesheet application](img/B05010_07_15.jpg)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
- en: Create another Sheet with the name `Backup`, which is used to back up every
    day's shift data from the `TimeSheet` Sheet. Arrange the columns as shown here.
    Remember to format columns *B*, *C*, *D*, and *E* as `date`.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating an employee timesheet application](img/B05010_07_16.jpg)'
  id: totrans-71
  prefs: []
  type: TYPE_IMG
- en: 'Create another new Sheet and name it as `Message`, which will be used to pass
    a message, if any, to employees:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating an employee timesheet application](img/B05010_07_17.jpg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
- en: 'In the `Code.gs` file, create the global variables as well as the `doGet` and
    `getEmpNames` functions. Replace `[[ this spreadsheet id ]]` with the actual ID/key
    (as a string) of the spreadsheet in which you are editing the code:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This `getEmpList` function creates and returns employee names as an array:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'In the `doGet` function, the message and employee list are assigned to the
    `template` object and returns evaluated HTML content:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This `getEmpStatus` function returns employee shift status as an array:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The `fmtDate_` function is a helper function that returns the formatted date
    string:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The `postTime` function populates timesheet with respect to the employee name
    and what button he/she has clicked and these values are supplied as an argument
    (`name` and `val`). This function also throws errors, if any.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-85
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The keyword throw returns an error object and terminates the execution.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The preceding `postTime` function populates data to the `TimeSheet` Sheet as
    per the button clicked by the user. Also, it throws errors if there are any conflicts
    in the shift time. For example, a user cannot click on **Break End** before **Break
    Start** and cannot click on **Shift Start** without ending the previous shift,
    and so on.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a new HTML file named as `Timesheet` and enter the following code in
    it:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Publish the script and enter the published URL in the browser's address bar,
    then you will get the timesheet application loaded as shown in the screenshot.
    Experiment by selecting employee names from the dropdown and by clicking on buttons
    next to it. For every user action, the `Timesheet` and/or `Backup` Sheet data
    will be updated.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 发布脚本并将发布的URL输入到浏览器的地址栏中，然后你将看到截图所示的工时应用被加载。通过从下拉菜单中选择员工姓名以及点击其旁边的按钮进行实验。对于每个用户操作，`工时`和/或`备份`表的数据将被更新。
- en: '![Creating an employee timesheet application](img/B05010_07_18.jpg)'
  id: totrans-92
  prefs: []
  type: TYPE_IMG
  zh: '![创建员工工时应用](img/B05010_07_18.jpg)'
- en: 'A sample output of the `Timesheet` data is shown here:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是`工时`数据的示例输出：
- en: '![Creating an employee timesheet application](img/B05010_07_19.jpg)'
  id: totrans-94
  prefs: []
  type: TYPE_IMG
  zh: '![创建员工工时应用](img/B05010_07_19.jpg)'
- en: 'As soon as the user clicks on **Shift End**, then the corresponding data from
    the `TimeSheet` Sheet will be transferred to the `Backup` Sheet and formulas will
    be created for the `Shift Hours`, `Break Time`, and `Worked Hours` columns. These
    formulas calculate the date difference and multiply it by 24 to show it as an
    hour value. A sample output of the `Backup` Sheet is shown here:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户点击**班次结束**时，`工时`表中的相应数据将被转移到`备份`表中，并为`班次小时数`、`休息时间`和`工作时间`列创建公式。这些公式计算日期差异并将其乘以24，以显示为小时值。以下是`备份`表的示例输出：
- en: '![Creating an employee timesheet application](img/B05010_07_20.jpg)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![创建员工工时应用](img/B05010_07_20.jpg)'
- en: Summary
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned and created many useful real-life applications
    including RSS publisher and a full-blown timesheet application. In the next chapter,
    you will create an order processing workflow application.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了并创建了许多实用的实际应用，包括RSS发布者和一个完整的工时应用。在下一章中，你将创建一个订单处理工作流应用。
