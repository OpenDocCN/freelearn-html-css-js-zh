<html><head></head><body><div class="chapter" title="Chapter&#xA0;13.&#xA0;Troubleshooting PostCSS Issues"><div class="titlepage"><div><div><h1 class="title"><a id="ch13"/>Chapter 13. Troubleshooting PostCSS Issues</h1></div></div></div><p>For many readers, PostCSS can be a little confusing—after all, it's still a relatively new library that is unlike other processors! Throughout the book, we've been on a journey of discovery—we'll finish with a look at some tips and tricks for best practice, along with some pointers for troubleshooting if we should find ourselves stuck.</p><p>Throughout the course of this chapter, we will take a look at some common issues you might experience when creating PostCSS processors. We'll see how easy it is to fix them, and discover what to do next if issues are not as easy to solve as we might have expected…</p><p>We will cover a number of topics throughout this chapter, which will include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Fixing some common issues</li><li class="listitem" style="list-style-type: disc">Exploring some common issues in detail</li><li class="listitem" style="list-style-type: disc">Getting help from others</li></ul></div><p>Let's make a start!</p><div class="section" title="Fixing some common issues"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec108"/>Fixing some common issues</h1></div></div></div><p>In an ideal world, any<a id="id811" class="indexterm"/> processor we build will work flawlessly, irrespective of which task runner or method we use to process each PostCSS task. Our aim is to end up with one or more successfully compiled files, as shown in this example:</p><div class="mediaobject"><img src="graphics/BO5194_13_01.jpg" alt="Fixing some common issues"/></div><p>But as we all know, not everything goes well 100% of the time; if it did, we would either be exceptionally lucky, or things would begin to get mundane! </p><p>Being a pragmatist, I suspect most people will have some form of issue crop up as they get to grips with <a id="id812" class="indexterm"/>PostCSS; throughout the course of this chapter we will explore some of the more common issues, how to resolve them, and bring together some of the tips and tricks we can use to help make our lives a little easier when using PostCSS. Let's begin with a look at some of the more common issues we might face, in more detail. </p></div></div>
<div class="section" title="Exploring some common issues"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec109"/>Exploring some common issues</h1></div></div></div><p>PostCSS as a processing<a id="id813" class="indexterm"/> system is easy to set up and use, but occasionally we may come across issues during development. The issues will vary, of course, but to help you along, we can explore some of the more common issues we may face during development. </p><p>For the purposes of this chapter, we will assume that the Gulp task runner has been used—you will likely see similar issues with other task runners such as Grunt or Broccoli. It's time to explore some of these issues in more detail.</p><div class="section" title="Not compatible with your operating system…"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec135"/>Not compatible with your operating system…</h2></div></div></div><p>The beauty<a id="id814" class="indexterm"/> of PostCSS is that we can install any one of dozens of plugins available—if we're using a task runner such as Gulp, then we can easily extend this to cover the vast array available for use.</p><p>In most instances, plugins will install without a hitch; you may find that you see this appear occasionally:</p><div class="mediaobject"><img src="graphics/BO5194_13_02.jpg" alt="Not compatible with your operating system…"/></div><p>The warning message that is of most importance to us is not the <code class="literal">ENOENT</code> messages, but this one:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>notsup: Not compatible with your operating system or architecture: fsevents@1.0.6</strong></span>
</pre></div><p>It should be noted that this is only a warning, and not an error (as such)—it is caused by the use of <code class="literal">fsevents</code>, which is MacOSX only and will not work on Windows or Linux environments. In most cases this can be ignored, although it would be wise to test your processor to<a id="id815" class="indexterm"/> ensure it has not had any detrimental impact on your code.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note62"/>Note</h3><p>This error is not limited to <code class="literal">fsevents</code>—it can apply to any package, which is not supported in the environment you use.</p></div></div></div><div class="section" title="Task '&lt;name of task&gt;' is not in your gulpfile"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec136"/>Task '&lt;name of task&gt;' is not in your gulpfile</h2></div></div></div><p>We've created a <a id="id816" class="indexterm"/>Gulp task file with a number of tasks within, and run it to compile our style sheet. Instead of getting our processed files, we end up with this message:</p><div class="mediaobject"><img src="graphics/BO5194_13_03.jpg" alt="Task '&lt;name of task&gt;' is not in your gulpfile"/></div><p>This is caused by the Gulp task not being present in the gulp file—in this declaration example, we're calling the <code class="literal">rename</code> task:</p><div class="mediaobject"><img src="graphics/BO5194_13_04.jpg" alt="Task '&lt;name of task&gt;' is not in your gulpfile"/></div><p>But a look through<a id="id817" class="indexterm"/> the gulp file shows that there is no <code class="literal">rename</code> task in sight:</p><div class="mediaobject"><img src="graphics/BO5194_13_05.jpg" alt="Task '&lt;name of task&gt;' is not in your gulpfile"/></div><p>This is a simple fix—just rename the task so that the names match, and retry the compilation. Note, though—if more than one task is incorrectly named, then the process will fail but will only<a id="id818" class="indexterm"/> show the name of the first one that is at fault. Make sure that each task name is entered correctly in the file to ensure successful compilation.</p></div><div class="section" title="Cannot find module '&lt;name of plugin&gt;'"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec137"/>Cannot find module '&lt;name of plugin&gt;'</h2></div></div></div><p>If any error is<a id="id819" class="indexterm"/> likely to catch us out, then it is this one—let me explain:</p><p>As you get to grips with installing PostCSS plugins, you will see many that use the naming convention <code class="literal">postcss-&lt;name of plugin&gt;</code>. It seems a sensible proposition, but beware – not every PostCSS plugin uses this naming convention! </p><p>A great example is Rucksack – one would expect to use <code class="literal">postcss-rucksack</code> (and yes, that includes me!), but we will get this error if we do:</p><div class="mediaobject"><img src="graphics/BO5194_13_06.jpg" alt="Cannot find module '&lt;name of plugin&gt;'"/></div><p>It turns out that Rucksack is one of those examples that doesn't use the same naming convention that many people would expect it to use. Instead, it uses <code class="literal">rucksack-css</code>, as the name we would expect to use had already been taken.</p><p>This is one of those instances where it pays to read the documentation, if only to save a lot of embarrassment later:</p><div class="mediaobject"><img src="graphics/BO5194_13_07.jpg" alt="Cannot find module '&lt;name of plugin&gt;'"/></div><p>It clearly states <a id="id820" class="indexterm"/>what name to use when installing the plugin! Yes, it happens to the best of us…</p></div><div class="section" title="ReferenceError: &lt;name of task&gt; is not defined"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec138"/>ReferenceError: &lt;name of task&gt; is not defined</h2></div></div></div><p>Let us assume<a id="id821" class="indexterm"/> that we have a series of tasks in our gulp file, but for some unknown reason, we're getting this error when we compile our code:</p><div class="mediaobject"><img src="graphics/BO5194_13_08.jpg" alt="ReferenceError: &lt;name of task&gt; is not defined"/></div><p>What could be causing it? Well, there are at least two possible causes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We include the plugin within the task itself, but forget to include a reference to it within the declarations at the top of our file</li><li class="listitem" style="list-style-type: disc">We do manage to include both the plugin within the task and its associated declaration, but somehow manage not to give the same declaration name</li></ul></div><p>The fix for this is to make sure that when we include the declaration at the top of the Gulp task file, that the same name is used when calling the task later in the file.</p></div><div class="section" title="Please provide array of postcss processors!"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec139"/>Please provide array of postcss processors!</h2></div></div></div><p>This next error is one that can catch anyone out, but is easy to fix—as time goes by you will develop <a id="id822" class="indexterm"/>your own processor; you will likely reach a point where you start to move some of the PostCSS processor tasks out from the main PostCSS call into their own task.</p><p>Imagine that you have a PostCSS task similar to this:</p><div class="mediaobject"><img src="graphics/BO5194_13_09.jpg" alt="Please provide array of postcss processors!"/></div><p>There is a natural temptation to split this task into separate ones; after all, I extolled the virtues of keeping a 1:1 relationship between the task name (that is, styles), and what it does in the task! If, however, you take things a little too far, and think that you don't need to have a PostCSS processor in the task, then you may come unstuck, and land up with an error similar to this screenshot:</p><div class="mediaobject"><img src="graphics/BO5194_13_10.jpg" alt="Please provide array of postcss processors!"/></div><p>A quick check in your Gulp task file will likely show something akin to this:</p><div class="mediaobject"><img src="graphics/BO5194_13_11.jpg" alt="Please provide array of postcss processors!"/></div><p>We have a <code class="literal">postcss</code> task, but without any processors within it! Although it is tempting to rework processors to ensure we maintain that 1:1 relationship, we must always leave one processor in the <code class="literal">postcss()</code> task, to ensure it operates correctly.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note63"/>Note</h3><p>You will hear talk<a id="id823" class="indexterm"/> of the term processor used in several different ways—they can equally apply as a generic term for what is our Gulp task file. It can also apply to the processor tasks that should be added to any <code class="literal">postcss()</code> task.</p></div></div></div><div class="section" title="Entries failing to appear in the package.json file"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec140"/>Entries failing to appear in the package.json file</h2></div></div></div><p>This next error is a<a id="id824" class="indexterm"/> little trickier to catch, but the fix for it is easy—over time, you will likely make changes to your Gulp task file; this of course means that new plugins will need to be added from another <code class="literal">package.json</code> file (if already installed), or added afresh, if they haven't already been installed.</p><p>As the Gulp task file is just a plain text file, we can edit it in any text editor—my personal favorite is <a id="id825" class="indexterm"/>Sublime Text 3 (<a class="ulink" href="http://www.sublimetext.com/3">http://www.sublimetext.com/3</a>), but any will suffice. Notepad isn't a good one, as it will fail to handle the line-endings correctly!</p><p>This aside, if we edit our <code class="literal">package.json</code> file to remove an entry, then add a new one, we might come across this warning:</p><div class="mediaobject"><img src="graphics/BO5194_13_17.jpg" alt="Entries failing to appear in the package.json file"/></div><p>The cause of this little gem is a really irritating one—it's amazing how one single character can cause all these warnings! The culprit is the extraneous comma at the end of a line where there <span class="emphasis"><em>isn't</em></span> another plugin listed immediately after, as shown on line 27 in this screenshot:</p><div class="mediaobject"><img src="graphics/BO5194_13_12.jpg" alt="Entries failing to appear in the package.json file"/></div><p>If we remove<a id="id826" class="indexterm"/> the comma and retry the installation, we will soon see that the error has disappeared.</p></div><div class="section" title="Output of compiling results is not as expected"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec141"/>Output of compiling results is not as expected</h2></div></div></div><p>This final error <a id="id827" class="indexterm"/>can be deceptive—it's not strictly speaking even an error! Imagine we've created a killer processor application using Node and Gulp; it contains a number of tasks similar to the ones we created earlier, and have since used throughout this book.</p><p>We enter the relevant command and hit <span class="emphasis"><em>Enter</em></span>. PostCSS starts the compilation: so far so good. A look in the <code class="literal">dest</code> folder shows this—where's our minified file and source map?</p><div class="mediaobject"><img src="graphics/BO5194_13_13.jpg" alt="Output of compiling results is not as expected"/></div><p>But hold on – where's the error? A check of the output from the compilation process shows no error, so what gives?</p><div class="mediaobject"><img src="graphics/BO5194_13_14.jpg" alt="Output of compiling results is not as expected"/></div><p>This little oddity<a id="id828" class="indexterm"/> is caused by miscalculating the order in which tasks should run—although the screenshot clearly says an error, it's not an error in the true sense. Let me explain.</p><p>The key to a successful compilation process (and by default, a working processor), lies in the need to make sure that each task we run is fired in the right order. To generate this error, I removed the constraint on our rename task in the Gulp file from the <code class="literal">T45 – converting to use Rucksack</code> demo, thus:</p><div class="informalexample"><pre class="programlisting">gulp.task('rename', function () {
  return gulp.src('dest/*.css')
    .pipe(postcss([ cssnano() ]))
    .pipe(rename('style.min.css'))
    .pipe(gulp.dest("dest/"));
});</pre></div><p>The task looks perfectly acceptable, but introduces a problem—instead of just one starting task, we now have two! </p><p>The net result of this is that the styles task is run first (as it is called first in the default task from line 36). It's quickly followed by the rename task (no constraint on it), then <code class="literal">sourcemap</code> and <code class="literal">lint-styles</code> (following the constraints set against each task).</p><p>We end up with just one compiled file in the <code class="literal">dest</code> folder—the rename and styles tasks are both run at the same time; as the latter isn't completed, the former can't produce any content!</p><p>Let's move on. If all<a id="id829" class="indexterm"/> else fails, and you find problems you can't fix, then it is time to seek help….here's a quick rundown of the options available to you as a beginner to using PostCSS.</p></div></div>
<div class="section" title="Getting help from others"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec110"/>Getting help from others</h1></div></div></div><p>At this stage, you've<a id="id830" class="indexterm"/> tried fixing an issue, but failed – you're not quite sure where to go next…</p><p>Don't worry, there are plenty of people who have been there, and needed help! A good start is the main<a id="id831" class="indexterm"/> documentation, which is available at <a class="ulink" href="https://github.com/postcss/postcss/tree/master/docs">https://github.com/postcss/postcss/tree/master/docs</a>. If this draws a blank, then Google is a good option; in addition, there are a couple of other options that may help.</p><div class="section" title="Logging issues at Stack Overflow"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec142"/>Logging issues at Stack Overflow</h2></div></div></div><p>If you spend time<a id="id832" class="indexterm"/> researching Google and don't find anyone who has had this problem before, then you can try logging a question on Stack Overflow:</p><div class="mediaobject"><img src="graphics/BO5194_13_15.jpg" alt="Logging issues at Stack Overflow"/></div><p>The URL is <a class="ulink" href="http://stackoverflow.com/questions/tagged/postcss">http://stackoverflow.com/questions/tagged/postcss</a>—this lists all of the questions tagged with the <a id="id833" class="indexterm"/>name <code class="literal">postcss</code>, and is open to anyone to suggest a course of action <a id="id834" class="indexterm"/>or hopefully a tip that will get you back in business. If you do find yourself logging an issue, please try where possible to give details of the system you use (Windows, Mac, or Linux), any screenshots or details of the error, and the steps you were taking to arrive at the error.</p></div><div class="section" title="Finding a bug with PostCSS"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec143"/>Finding a bug with PostCSS</h2></div></div></div><p>Taking things<a id="id835" class="indexterm"/> a step further, you can also log a development<a id="id836" class="indexterm"/> request, or an issue that requires a change to the code—to do this, please browse to the issues log on the GitHub site, at <a class="ulink" href="https://github.com/postcss/postcss/issues">https://github.com/postcss/postcss/issues</a>:</p><div class="mediaobject"><img src="graphics/BO5194_13_16.jpg" alt="Finding a bug with PostCSS"/></div><p>There are a few things to bear in mind:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Don't be alarmed if you are advised to log the issue on the plugin's website, and not in GitHub for PostCSS – many issues are not as a result of a problem in PostCSS, but in the plugin itself.</li><li class="listitem" style="list-style-type: disc">It helps to show a copy of your task runner's task file and <code class="literal">package.json</code>, just in case—some of the issues that people experience are as a result of (known or unknown) compatibility issues between plugins, or where a certain order must be followed to ensure plugins can be used.</li><li class="listitem" style="list-style-type: disc">PostCSS plugin developers frequently develop on the Apple Mac or Linux platforms—it means that some errors you may see are as a result of using a platform that doesn't support one or more commands in the plugin. </li><li class="listitem" style="list-style-type: disc">If you do come across problems when using one or more plugins, try to strip back your processor tasks to those that include the plugins that are causing issues. Even if this doesn't eliminate the issue, it will help narrow the cause and avoid<a id="id837" class="indexterm"/> unnecessary checks by others during the troubleshooting process.</li><li class="listitem" style="list-style-type: disc">The license used by PostCSS is the MIT license—it effectively means that you can do as you like with the software, as long as the copyright notice remains with the library. </li><li class="listitem" style="list-style-type: disc">It's worth noting that CodePen supports the use of PostCSS—you may find it useful to try out code online (and have it compile automatically), rather than running your processor manually. CodePen only supports a limited range of plugins, so it won't be useful for<a id="id838" class="indexterm"/> all occasions—but hopefully some!<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip31"/>Tip</h3><p>For more details, take a look at this blog posting on the CodePen site: <a class="ulink" href="https://blog.codepen.io/2015/07/14/postcss-now-supported-on-codepen/">https://blog.codepen.io/2015/07/14/postcss-now-supported-on-codepen/</a>.</p></div></div></li><li class="listitem" style="list-style-type: disc">The downside of open source software (and plugins created for PostCSS) is the varying levels of support offered by plugin developers—whilst support for the core system is very good, you may find support for individual plugins to not be quite so active! Don't rely on plugin developers to respond quickly if you have a critical issue—please log it via Stack Overflow first, before raising it on the plugin site. The latter should be used if the issue is identified to require further development.</li></ul></div><p>With these in mind, good luck! PostCSS is fast gaining ground—with some big name companies using it, such as WordPress and Google, it is sure to become very popular. It would be a shame to give up on something if you come across a problem with using a plugin!</p><p>Remember, if one plugin doesn't work, then look around—others may well be available that can take their place. It's a dog eat dog world, where those plugins that are not supported are likely to fall by the wayside, leaving those where support is active and problems are resolved efficiently and promptly.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec111"/>Summary</h1></div></div></div><p>When learning a new topic, it is highly likely that we will have questions—throughout the course of this chapter, we've looked at some of the common errors you might experience, and listed solutions to help get back on track. We then explored what might happen if you have issues that can't easily be resolved with help from other developers.</p><p>Okay, let's move on: we've covered a lot of ground throughout the book, so it's time to look forward and see what CSS may bring. The great thing about PostCSS is that plugins already exist that allow us to use tomorrow's features today—we'll cover this and more in the next chapter.</p></div></body></html>