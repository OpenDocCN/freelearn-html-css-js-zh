<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Understanding Google Maps JavaScript API Events"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Understanding Google Maps JavaScript API Events</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating two synced maps side by side</li><li class="listitem" style="list-style-type: disc">Getting the coordinates of a mouse click</li><li class="listitem" style="list-style-type: disc">Creating a context menu on a map</li><li class="listitem" style="list-style-type: disc">Restricting the map extent</li><li class="listitem" style="list-style-type: disc">Creating a control that shows coordinates</li><li class="listitem" style="list-style-type: disc">Creating your own events</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec42"/>Introduction</h1></div></div></div><p>If you have ever worked on JavaScript programming, you should know the importance of events. Events <a id="id349" class="indexterm"/>are the core of JavaScript. There are events behind interactions in web pages. There can be user interactions or browser actions that can be handled with the help of events.</p><p>For example, in every code from the beginning of this book, we have wrote something like the following line of code:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addDomListener(window, 'load', initMap);</pre></div><p>This line is a simple form of event definition. This line tells the browser to call the <code class="literal">initMap()</code> function when all the contents are loaded. This event is required to start mapping functions after loading all DOM elements.</p><p>This chapter is about using events in the Google Maps JavaScript API to interact with maps in different ways. The Google Maps JavaScript API has the <code class="literal">google.maps.event</code> namespace<a id="id350" class="indexterm"/> to work with events. This namespace has static methods to listen to events defined in the API. You should check the supported event types of objects in the API via the Google Maps API reference documentation.</p></div></div>
<div class="section" title="Creating two synced maps side by side"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Creating two synced maps side by side</h1></div></div></div><p>Maps <a id="id351" class="indexterm"/>are useful to <a id="id352" class="indexterm"/>human beings. With the help of maps, people explore or compare their surrounding area. Sometimes they need to compare two maps side by side to see the difference in real time. For example, you might want to check a satellite imagery side by side with terrain maps to see where the mountains are.</p><p>This recipe shows you how to add two maps in the same page and sync them together to show the same area and compare them with the help of Google Maps JavaScript API events.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec124"/>Getting ready</h2></div></div></div><p>You already know how to create a map from the previous chapters. So, only additional code lines are written.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_sync_maps.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec125"/>How to do it…</h2></div></div></div><p>If you want to create two maps that are synced together, you should perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, add the CSS styles of the <code class="literal">div</code> objects in the header to show them side by side:<div class="informalexample"><pre class="programlisting">.mapClass { width: 500px; height: 500px; display: inline-block; }</pre></div></li><li class="listitem">Then define two global map variables to access them within event callbacks:<div class="informalexample"><pre class="programlisting">var map1, map2;</pre></div></li><li class="listitem">Next create the function that initializes the left map:<div class="informalexample"><pre class="programlisting">function initMapOne() {
  //Setting starting options of map
  var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    maxZoom: 15,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  //Getting map DOM element
  var mapElement = document.getElementById('mapDiv');

  //Creating a map with DOM element which is just obtained
  map1 = new google.maps.Map(mapElement, mapOptions);

  //Listening center_changed event of map 1 to
  //change center of map 2
  google.maps.event.addListener(map1, 'center_changed', function() { 
     map2.setCenter(map1.getCenter());
  });

  //Listening zoom_changed event of map 1 to change
  //zoom level of map 2
  google.maps.event.addListener(map1, 'zoom_changed', function() {
      map2.setZoom(map1.getZoom());
  });
}</pre></div></li><li class="listitem">Now, add the <a id="id353" class="indexterm"/>second function that initializes the right map. The contents of the functions created before are almost the same, except for variable names, the <code class="literal">div</code> ID, the map type, and timers in event handlers:<div class="informalexample"><pre class="programlisting">function initMapTwo() {
  //Setting starting options of map
  var mapOptions2 = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    maxZoom: 15,
    mapTypeId: google.maps.MapTypeId.TERRAIN
  };

  //Getting map DOM element
  var mapElement2 = document.getElementById('mapDiv2');

  //Creating a map with DOM element which is just //obtained
  map2 = new google.maps.Map(mapElement2, mapOptions2);

  //Listening center_changed event of map 2 to 
  //change center of map 1
  google.maps.event.addListener(map2, 'center_changed', function() {
      setTimeout(function() { map1.setCenter(map2.getCenter());
      }, 10);
  });

  //Listening zoom_changed event of map 2 to change
  //zoom level of map 1
  google.maps.event.addListener(map2, 'zoom_changed', function() {
      setTimeout(function() {
        map1.setZoom(map2.getZoom());
      }, 10);
  });
}</pre></div></li><li class="listitem">We now have two <a id="id354" class="indexterm"/>maps, and we must initialize both of them at the start, so we need a single function to call the previous functions:<div class="informalexample"><pre class="programlisting">//Starting two maps
function initMaps() {
  initMapOne();
  initMapTwo();
}</pre></div></li><li class="listitem">Call the <code class="literal">initMaps()</code> function when everything has been loaded on the <code class="literal">load</code> event of the <code class="literal">window</code> element:<div class="informalexample"><pre class="programlisting">google.maps.event.addDomListener(window, 'load', initMaps);</pre></div></li><li class="listitem">Do not forget to add the two <code class="literal">div</code> objects in HTML tags:<div class="informalexample"><pre class="programlisting">&lt;div id="mapDiv" class="mapClass"&gt;&lt;/div&gt;
&lt;div id="mapDiv2" class="mapClass"&gt;&lt;/div&gt;</pre></div></li><li class="listitem">Go to your local URL where your HTML file is stored in your favorite browser and see the result. You will see two maps side by side. When you drag or zoom in on one map, then the other map is also changed based on the changed one. The final map will look like the following screenshot:<div class="mediaobject"><img src="graphics/8825OT_05_01.jpg" alt="How to do it…"/></div></li></ol></div><p>As a result of the recipe, we can create two maps that are synced together to show the same area of different map types.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec126"/>How it works...</h2></div></div></div><p>The important<a id="id355" class="indexterm"/> point in this recipe is to keep two maps in synchronization at the same position and zoom level. To achieve this goal, we need to know when the map has moved and when the zoom level has changed.</p><p>The <code class="literal">map</code> object has different events to trigger. The<a id="id356" class="indexterm"/> <code class="literal">center_changed</code> and <code class="literal">zoom_changed</code> events are<a id="id357" class="indexterm"/> two of those events. The <code class="literal">center_changed</code> event is triggered every time the map center is changed. There are also<a id="id358" class="indexterm"/> <code class="literal">bounds_changed</code>,<a id="id359" class="indexterm"/> <code class="literal">drag</code>,<a id="id360" class="indexterm"/> <code class="literal">dragstart</code>, and<a id="id361" class="indexterm"/> <code class="literal">dragend</code> events that can be used to achieve our goal, but <code class="literal">center_changed</code> is the simplest one to handle. The <code class="literal">zoom_changed</code> event<a id="id362" class="indexterm"/> is triggered when there is a change in the zoom level.</p><p>To listen for the events, we need to register these events with the <code class="literal">google.maps.event</code> namespace as follows:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map1, 'center_changed', function() {
  map2.setCenter(map1.getCenter());
});</pre></div><p>The <code class="literal">addListener()</code> method gets three parameters; an object to listen, an event type, and an event handler. The event handler can be a function that has been defined earlier or an anonymous function used only here. In this example, we listen for the left map object—<code class="literal">map1</code>—for the <code class="literal">center_changed</code> event and set the center of the right map to the center of the left map. The zoom part also works in the same way. When the zoom level of the left map changes, the event handler of <code class="literal">zoom_changed</code> sets the zoom level of the right map to the zoom level of the left map.</p><p>This should<a id="id363" class="indexterm"/> be the same for the right map, but the code used for event handling in the right map is a bit different from that of the left one because of an infinite event loop. If we use the same code for event handling, we create an infinite loop between the two maps. This loop will cause your browser to crash in most cases. To avoid this infinite loop, we create a small break (10 milliseconds) between events. This break will solve all the problems and users will not recognize the difference. This break is created with the <code class="literal">setTimeout()</code> function of JavaScript. There is also a better version to use instead of using timeouts, which is explained in the <span class="emphasis"><em>There's more...</em></span> section of this recipe. The recipe covers the ways to use map events in these cases:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map2, 'zoom_changed', function() {
  setTimeout(function() {
    map1.setZoom(map2.getZoom());
  }, 10);
});</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec127"/>There's more…</h2></div></div></div><p>In this recipe, our events are being listened for continuously, which is as expected. But what if you need to listen for an event for a limited time? There are two options. One option is that of storing the returning <code class="literal">google.maps.MapEventListener</code> object of the <code class="literal">addListener()</code> function and removing it when needed as follows:</p><div class="informalexample"><pre class="programlisting">var eventObj = google.maps.event.addListener(map1, 'center_changed',function() {
    map2.setCenter(map1.getCenter());
});
function removeListener() {
    google.maps.event.removeListener(eventObj);
}</pre></div><p>Another option to remove event listeners is to use the <code class="literal">clearInstanceListeners()</code> or <code class="literal">clearListeners()</code> functions of the <code class="literal">google.maps.event</code> namespace, which are used for removing all listeners for all events for the given instance or removing all listeners for the given event for the given instance, respectively. You can look at the following code for example usages:</p><div class="informalexample"><pre class="programlisting">var eventObj = google.maps.event.addListener(map1, 'center_changed',function() {
    map2.setCenter(map1.getCenter());
});
//This one removes all the listeners of map1 object
google.maps.event.clearInstanceListeners(map1); 
//This one removes all center_changed listeners of map1 object
google.maps.event.clearListeners(map1, 'center_changed');</pre></div><p>The Google Maps JavaScript API also provides other methods to listen for DOM events, named <code class="literal">addDomListener()</code> under the <code class="literal">google.maps.event</code> namespace. There is also the <code class="literal">addListenerOnce()</code> method to listen for events once.</p><p>There is also an alternate method to sync maps. The following code block just syncs two maps' events:</p><div class="informalexample"><pre class="programlisting">map2.bindTo('center', map1, 'center');
map2.bindTo('zoom', map1, 'zoom');</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec128"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li></ul></div></div></div>
<div class="section" title="Getting the coordinates of a mouse click"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Getting the coordinates of a mouse click</h1></div></div></div><p>The mouse has been the <a id="id364" class="indexterm"/>most effective input device for computers for a<a id="id365" class="indexterm"/> long time. Nowadays, there is an attempt to change it with touchscreens, but nothing can be compared to the ease of use that a mouse provides.</p><p>The mouse has different interactions on maps, such as click, double-click, right-click, move, and drag. These events can be handled in different ways to interact with users.</p><p>In this recipe, we will get the coordinates of a mouse click on any point on the map. Users will see an info window upon a mouse click, which can be seen in the following screenshot:</p><div class="mediaobject"><img src="graphics/8825OT_05_02.jpg" alt="Getting the coordinates of a mouse click"/></div><p>This is how we achieve the <a id="id366" class="indexterm"/>creation of a map that is listening for each mouse click to<a id="id367" class="indexterm"/> get coordinates.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec129"/>Getting ready</h2></div></div></div><p>We assume that you already know how to create a simple map. We will only cover the code that is needed for showing an info window upon mouse clicks.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_getting_coordinates.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec130"/>How to do it…</h2></div></div></div><p>If you perform the following steps, you can get the coordinates of each mouse click on the map:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we must add an <code class="literal">infowindow</code> variable at the beginning of the JavaScript code to use as a global object:<div class="informalexample"><pre class="programlisting">var infowindow = null;</pre></div></li><li class="listitem">Then, add the following lines to the <code class="literal">initMap()</code> function after the initialization of the <code class="literal">map</code> object:<div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map, 'click', function(e) {
  if (infowindow != null)
    infowindow.close();

  infowindow = new google.maps.InfoWindow({
    content: '&lt;b&gt;Mouse Coordinates : &lt;/b&gt;&lt;br&gt;&lt;b&gt;Latitude : &lt;/b&gt;' + e.latLng.lat() + '&lt;br&gt;&lt;b&gt;Longitude: &lt;/b&gt;' + e.latLng.lng(),
    position: e.latLng
  });
  infowindow.open(map);
});</pre></div></li><li class="listitem">Go to your local URL where your HTML is stored in your favorite browser and click on the map to see the result. Each mouse click opens an info window with the coordinate information.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec131"/>How it works...</h2></div></div></div><p>After initializing the <a id="id368" class="indexterm"/>map, we create an event listener to handle mouse clicks<a id="id369" class="indexterm"/> on the map:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map, 'click', function(e) {
  
});</pre></div><p>The <code class="literal">click</code> event type has a different handler than other events. The handler has an input parameter that is an object derived from the <code class="literal">google.maps.MouseEvent</code> class. This object has a property named <code class="literal">LatLng</code>, which is an instance of the <code class="literal">google.maps.latLng</code> class. This property gives us the coordinates of the mouse click.</p><p>We want to show an info window upon each mouse click, and we want to see only one info window. To achieve this, we create <code class="literal">infowindow</code> as a global variable at the beginning of the JavaScript code and check whether it is still defined or not. If there is an <code class="literal">infowindow</code> object from previous clicks, then we will close it as follows:</p><div class="informalexample"><pre class="programlisting">if (infowindow != null)
  infowindow.close();</pre></div><p>Upon each mouse click, we will create a new <code class="literal">infowindow</code> object with new contents, coordinates, and position from the <code class="literal">e.latLng</code> object. After creating <code class="literal">infowindow</code>, we will just open it on the map defined previously:</p><div class="informalexample"><pre class="programlisting">infowindow = new google.maps.InfoWindow({
  content: '&lt;b&gt;Mouse Coordinates : &lt;/b&gt;&lt;br&gt;&lt;b&gt;Latitude : &lt;/b&gt;' + e.latLng.lat() + '&lt;br&gt;&lt;b&gt;Longitude: &lt;/b&gt;' + e.latLng.lng(),
  position: e.latLng
});
infowindow.open(map);</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec132"/>There's more…</h2></div></div></div><p>As already <a id="id370" class="indexterm"/>mentioned, some event types have different event handlers that can get <a id="id371" class="indexterm"/>a parameter. This parameter is an object derived from the <code class="literal">google.maps.MouseEvent</code> class. The <code class="literal">google.maps.Map</code> class has the following events that return <code class="literal">MouseEvent </code>objects to the handlers: <code class="literal">click</code>, <code class="literal">dblclick</code>, <code class="literal">mousemove</code>, <code class="literal">mouseout</code>, <code class="literal">mouseover</code>, and <code class="literal">rightclick</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec133"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li></ul></div></div></div>
<div class="section" title="Creating a context menu on a map"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Creating a context menu on a map</h1></div></div></div><p>Using menus in a user interface is a way to communicate with users. Users select a menu item to interact with web applications. Some of the menu types can be accessible from a visible place, but some of them can be accessible with some extra actions, such as <span class="strong"><strong>context menus</strong></span>. Context menus <a id="id372" class="indexterm"/>usually appear on applications with a right-click of the mouse.</p><p>In this recipe, we will create a context menu on the map that opens when we right-click on the map. This menu includes zoom in, zoom out, and add marker functions. You will also get the position of the right-click to use it in some geo methods such as adding a marker in this example.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec134"/>Getting ready</h2></div></div></div><p>This recipe is also like the other<a id="id373" class="indexterm"/> recipes in that we assume you already know how to<a id="id374" class="indexterm"/> create a simple map. So, we will only show extra lines of code to add the context menu.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_context_menu.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec135"/>How to do it…</h2></div></div></div><p>The following are the steps we need to create a map with a context menu to show extra commands:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start by adding CSS styles of the context menu to the header of HTML:<div class="informalexample"><pre class="programlisting">.contextmenu{
  visibility: hidden;
  background: #ffffff;
  border: 1px solid #8888FF;
  z-index: 10;
  position: relative;
  width: 100px;
  height: 50px;
  padding: 5px;
}</pre></div></li><li class="listitem">The next step is to define <a id="id375" class="indexterm"/>the global variables for the context<a id="id376" class="indexterm"/> menu and coordinates:<div class="informalexample"><pre class="programlisting">var contextMenu, lastCoordinate;</pre></div></li><li class="listitem">Then, we will add lines that define the context menu class. The details will be explained later:<div class="informalexample"><pre class="programlisting">//Defining the context menu class.
function ContextMenuClass(map) {
  this.setMap(map);
  this.map = map;
  this.mapDiv = map.getDiv();
  this.menuDiv = null;
};

ContextMenuClass.prototype = new google.maps.OverlayView();
ContextMenuClass.prototype.draw = function() {};
ContextMenuClass.prototype.onAdd = function() {
  var that = this;
  this.menuDiv = document.createElement('div');
  this.menuDiv.className = 'contextmenu';
  this.menuDiv.innerHTML = '&lt;a href="javascript:createMarker()"&gt;Create Marker Here&lt;/a&gt;&lt;br&gt;&lt;a href="javascript:zoomIn()"&gt;Zoom In&lt;/a&gt;&lt;br&gt;&lt;a href="javascript:zoomOut()"&gt;Zoom Out&lt;/a&gt;&lt;br&gt;';
  this.getPanes().floatPane.appendChild(this.menuDiv);

  //This event listener below will close the context menu //on map click
  google.maps.event.addListener(this.map, 'click', function(mouseEvent) {
      that.hide();
  });
};

ContextMenuClass.prototype.onRemove = function() {
  this.menuDiv.parentNode.removeChild(this.menuDiv);
};

ContextMenuClass.prototype.show = function(coord) {
  var proj = this.getProjection();
  var mouseCoords = proj.fromLatLngToDivPixel(coord);
  var left = Math.floor(mouseCoords.x);
  var top =  Math.floor(mouseCoords.y);
  this.menuDiv.style.display = 'block';
  this.menuDiv.style.left = left + 'px';
  this.menuDiv.style.top = top + 'px';
  this.menuDiv.style.visibility = 'visible';
};

ContextMenuClass.prototype.hide = function(x,y) {
  this.menuDiv.style.visibility= 'hidden';
}</pre></div></li><li class="listitem">Now, add the <a id="id377" class="indexterm"/>functions <a id="id378" class="indexterm"/>to be used in the context menu:<div class="informalexample"><pre class="programlisting">//Defining context menu functions
function zoomIn() {
  map.setZoom(map.getZoom() + 1);
}

function zoomOut() {
  map.setZoom(map.getZoom() - 1);
}

function createMarker() {
  var marker = new google.maps.Marker({
    position: lastCoordinate,
    map: map,
    title: 'Random Marker'
  });
}</pre></div></li><li class="listitem">Add the following code block after initializing the <code class="literal">map</code> object. This block will create an object from the <code class="literal">ContextMenuClass</code> class and start listening in the <code class="literal">map</code> object for the right-click to show the <code class="literal">contextMenu</code> object created:<div class="informalexample"><pre class="programlisting">//Creating a context menu to use it in event handler
contextMenu = new ContextMenuClass(map);

//Listening the map object for mouse right click.
google.maps.event.addListener(map, 'rightclick', function(e) {
    lastCoordinate = e.latLng;
    contextMenu.show(e.latLng);
});</pre></div></li><li class="listitem">Go to your local<a id="id379" class="indexterm"/> URL where your HTML is stored in your <a id="id380" class="indexterm"/>favorite browser and right-click to see the context menu.<div class="mediaobject"><img src="graphics/8825OT_05_03.jpg" alt="How to do it…"/></div></li></ol></div><p>As it can be seen in the preceding screenshot, we created our simple map with the context menu.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec136"/>How it works...</h2></div></div></div><p>JavaScript<a id="id381" class="indexterm"/> is a prototype-based scripting language that supports object-oriented programming in a different way compared to classical server-side programming languages. There isn't any classic class definition, but you have prototypes to create classes or inherit other classes. This book is not a JavaScript book. If you have any questions about these concepts of JavaScript, you should google it to learn the details.</p><p>The Google Maps <a id="id382" class="indexterm"/>JavaScript API has a <code class="literal">google.maps.OverlayView</code> class to<a id="id383" class="indexterm"/> create your own custom types of overlay objects on the map. We will inherit this class to create our own context menu class. First, we will define the <code class="literal">ContextMenu</code> class with its constructor as follows:</p><div class="informalexample"><pre class="programlisting">function ContextMenuClass (map) {
  this.setMap(map);
  this.map = map;
  this.mapDiv = map.getDiv();
  this.menuDiv = null;
};</pre></div><p>Then, we will set a prototype of the <code class="literal">ContextMenu</code> class to an object created from the <code class="literal">google.maps.OverlayView</code> class:</p><div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype = new google.maps.OverlayView();</pre></div><p>The <code class="literal">google.maps.OverlayView</code> class has three methods to be implemented in our newly created class: <code class="literal">onAdd()</code>, <code class="literal">draw()</code>, and <code class="literal">onRemove()</code>. In addition to these methods, we add two methods to show or hide the context menu. Each method's mission is explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">onAdd()</code>: The creation of <a id="id384" class="indexterm"/>DOM objects and appending them as children of the panes is done in this method. We will create a <code class="literal">div</code> object with the CSS class defined at the top of the HTML. Menu items are also added to this <code class="literal">div</code> object with the <code class="literal">innerHTML</code> property. We will also create an event listener of map clicks to remove the context menu from other actions:<div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype.onAdd = function () {
  var that = this;
  this.menuDiv = document.createElement('div');
  this.menuDiv.className = 'contextmenu';
  this.menuDiv.innerHTML = '&lt;a href="javascript:createMarker()"&gt;Create Marker Here&lt;/a&gt;&lt;br&gt;&lt;a href="javascript:zoomIn()"&gt;Zoom In&lt;/a&gt;&lt;br&gt;&lt;a href="javascript:zoomOut()"&gt;Zoom Out&lt;/a&gt;&lt;br&gt;';
  this.getPanes().floatPane.appendChild(this.menuDiv);

  //This event listener below will close the context menu // on map click
  google.maps.event.addListener(this.map, 'click', function(mouseEvent){
      that.hide();
  });
};</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">draw()</code>: The positioning of created <a id="id385" class="indexterm"/>elements is done via this method, but we skip steps to fill this method. We create <code class="literal">show()</code> and <code class="literal">hide()</code> methods instead of adding or removing the context menu each time:<div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype.draw = function() {};</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">onRemove()</code>: Removing<a id="id386" class="indexterm"/> the created elements is done in this method:<div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype.onRemove = function() {
  this.menuDiv.parentNode.removeChild(this.menuDiv);
};</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">show(coord)</code>: Showing the<a id="id387" class="indexterm"/> context menu when we right-click on the mouse <a id="id388" class="indexterm"/>is done in this method. The <a id="id389" class="indexterm"/>input parameter is a <code class="literal">latLng</code> object, so we have to convert it to pixel coordinates in the <code class="literal">div</code> element. To achieve this, we need extra objects created from the <code class="literal">google.maps.MapCanvasProjection</code> class. This class has a method named <code class="literal">fromLatLngToDivPixel</code> to convert the <code class="literal">latLng</code> object to simple <code class="literal">google.maps.Point</code> objects. This object is used to set the <code class="literal">x</code> and <code class="literal">y</code> coordinates of the context menu from the top-left corner of the map. We also change the visibility style of <code class="literal">div</code> to show on the map:<div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype.show = function(coord) {
  var proj = this.getProjection();
  var mouseCoords = proj.fromLatLngToDivPixel(coord);
  var left = Math.floor(mouseCoords.x);
  var top =  Math.floor(mouseCoords.y);
  this.menuDiv.style.display = 'block';
  this.menuDiv.style.left = left + 'px';
  this.menuDiv.style.top = top + 'px';
  this.menuDiv.style.visibility = 'visible';
};</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">hide()</code>: Hiding the<a id="id390" class="indexterm"/> context menu is done in this method. We just change the visibility property of the context menu <code class="literal">div</code> to <code class="literal">hidden</code> to hide it:<div class="informalexample"><pre class="programlisting">ContextMenuClass.prototype.hide = function(x,y) {
  this.menuDiv.style.visibility = 'hidden';
}</pre></div></li></ul></div><p>The <code class="literal">ContextMenuClass</code> class has been defined earlier, but there isn't any object created from this class. We created a <code class="literal">contextMenu</code> object from our new class as follows:</p><div class="informalexample"><pre class="programlisting">contextMenu = new ContextMenuClass(map);</pre></div><p>In order to use this <code class="literal">contextMenu</code> object, we should listen for the <code class="literal">map</code> object's <code class="literal">rightclick</code> event and show the context menu in its handler. We will also update the global variable <code class="literal">lastCoordinate</code> to keep the last right-click coordinate to use it in the <code class="literal">createMarker()</code> function:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map, 'rightclick', function(e) {
  lastCoordinate = e.latLng;
  contextMenu.show(e.latLng);
});</pre></div><p>Context menu <a id="id391" class="indexterm"/>functions are covered in previous chapters, so they are not <a id="id392" class="indexterm"/>explained here. You can also create other types of overlays like in this recipe with the help of the <code class="literal">google.maps.OverlayView</code> class.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>
<span class="strong"><strong>More on JavaScript prototype-based inheritance</strong></span>
</p><p>If you are<a id="id393" class="indexterm"/> interested in the details of JavaScript<a id="id394" class="indexterm"/> prototype-based inheritance, please get more details from the following page: <a class="ulink" href="http://javascript.crockford.com/prototypal.html">http://javascript.crockford.com/prototypal.html</a>.</p><p>This article is written by <span class="emphasis"><em>Douglas Crockford</em></span>, who is the guru of JavaScript and the father of the JSON format. I suggest you read his popular JavaScript book <span class="emphasis"><em>JavaScript: The Good Parts</em></span> to delve deeper into JavaScript.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec137"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Changing map properties programmatically</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding markers to maps</em></span> recipe of <a class="link" href="ch03.html" title="Chapter 3. Adding Vector Layers">Chapter 3</a>, <span class="emphasis"><em>Adding Vector Layers</em></span></li></ul></div></div></div>
<div class="section" title="Restricting the map extent"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Restricting the map extent</h1></div></div></div><p>Google Maps<a id="id395" class="indexterm"/> has a worldwide extent that shows almost every street on the earth. You can use the Google Maps JavaScript API for the whole earth, but sometimes you need to show only the related area in the mapping application. You can zoom to a fixed location, but this doesn't stop users from moving to another place that is not in the extent of your application.</p><p>In this recipe, we will listen for map events to check if we are in an allowed extent. If we are not in the allowed extent, then we move the map to the allowed center within the extent. We used Turkey's geographic extent in this recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec138"/>Getting ready</h2></div></div></div><p>This recipe is still using the <a id="id396" class="indexterm"/>same map creation process defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span>, but there are some additional code blocks to listen for map events and to check for the restricted extent.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_restrict_extent.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec139"/>How to do it…</h2></div></div></div><p>Restricting the map extent is quite easy if you perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we must add the <code class="literal">allowedMapBounds</code> and <code class="literal">allowedZoomLevel</code> variables as global variables after defining the <code class="literal">map</code> variable. This is the geographic boundary of Turkey:<div class="informalexample"><pre class="programlisting">var allowedMapBounds = new google.maps.LatLngBounds(
  new google.maps.LatLng(35.817813, 26.147461),
  new google.maps.LatLng(42.049293, 44.274902)
);
var allowedZoomLevel = 6;</pre></div></li><li class="listitem">The next step is to listen for the <code class="literal">drag</code> and <code class="literal">zoom_changed</code> events of the map after initializing the map:<div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map, 'drag', checkBounds);
google.maps.event.addListener(map, 'zoom_changed', checkBounds);</pre></div></li><li class="listitem">Then, we create a <code class="literal">checkBounds()</code> function to handle events when they are fired. The first part of the function is to check for zoom levels. We choose <code class="literal">6</code> to minimize the zoom level of the map for this recipe:<div class="informalexample"><pre class="programlisting">function checkBounds() {
  if (map.getZoom() &lt; allowedZoomLevel) 
    map.setZoom(allowedZoomLevel);
}</pre></div></li><li class="listitem">The following lines of code will add to the <code class="literal">checkBounds()</code> function to get the allowed bounds, recent bounds, and recent center of the map:<div class="informalexample"><pre class="programlisting">if (allowedMapBounds) {
  var allowedNELng = allowedMapBounds.getNorthEast().lng();
  var allowedNELat = allowedMapBounds.getNorthEast().lat();
  var allowedSWLng = allowedMapBounds.getSouthWest().lng();
  var allowedSWLat = allowedMapBounds.getSouthWest().lat();

  var recentBounds = map.getBounds();
  var recentNELng = recentBounds.getNorthEast().lng();
  var recentNELat = recentBounds.getNorthEast().lat();
  var recentSWLng = recentBounds.getSouthWest().lng();
  var recentSWLat = recentBounds.getSouthWest().lat();

  var recentCenter = map.getCenter();
  var centerX = recentCenter.lng();
  var centerY = recentCenter.lat();

  var nCenterX = centerX;
  var nCenterY = centerY;
}</pre></div></li><li class="listitem">The important part <a id="id397" class="indexterm"/>of the <code class="literal">checkBounds()</code> function is the comparing of allowed bounds with recent bounds. If there is a difference between <code class="literal">centerX</code> and <code class="literal">centerY</code> with the <code class="literal">nCenterX</code> and <code class="literal">nCenterY</code> variables, then we move the map to the center that is within the allowed bounds:<div class="informalexample"><pre class="programlisting">if (recentNELng &gt; allowedNELng) centerX = centerX- (recentNELng - allowedNELng);
if (recentNELat &gt; allowedNELat) centerY = centerY- (recentNELat - allowedNELat);
if (recentSWLng &lt; allowedSWLng) centerX = centerX+ (allowedSWLng - recentSWLng);
if (recentSWLat &lt; allowedSWLat) centerY = centerY+ (allowedSWLat - recentSWLat);

if (nCenterX != centerX || nCenterY != centerY) {
  map.panTo(new google.maps.LatLng(centerY,centerX));
}
else {
  return;
}</pre></div></li><li class="listitem">Go to your local URL where your HTML is stored in your favorite browser and try to move the map of other countries near Turkey. You will see that the map moves back to its previous position that is allowed within the boundaries defined at the top.<div class="mediaobject"><img src="graphics/8825OT_05_04.jpg" alt="How to do it…"/></div></li></ol></div><p>As it can be seen in the <a id="id398" class="indexterm"/>preceding screenshot, you can easily restrict the map extent by events provided by the Google Maps JavaScript API.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec140"/>How it works...</h2></div></div></div><p>As it is stated in previous event recipes, the Google Maps JavaScript API gives the developer many events that are related to mapping activities. The <code class="literal">drag</code> and <code class="literal">zoom_changed</code> events are the ones we are using in this recipe to listen for. This time, we do not create anonymous event handlers because we use the same event handler for two event listeners, named <code class="literal">checkBounds()</code>:</p><div class="informalexample"><pre class="programlisting">google.maps.event.addListener(map, 'drag', checkBounds);
google.maps.event.addListener(map, 'zoom_changed', checkBounds);</pre></div><p>The Google Maps JavaScript API has the <code class="literal">google.maps.LatLngBounds</code> class for defining geographical bounds. This class' constructor gets two objects as parameters created from the <code class="literal">google.maps.LatLng</code> class. The parameters are the geographical coordinates of the south-west and north-east corners respectively. This creates a geographical boundary for our application. South-west has the minimum latitude and longitude while on the other side, north-east has the maximum latitude and longitude:</p><div class="informalexample"><pre class="programlisting">var allowedMapBounds = new google.maps.LatLngBounds(
  new google.maps.LatLng(35.817813, 26.147461),
  new google.maps.LatLng(42.049293, 44.274902)
);</pre></div><p>The main trick in this recipe is in the <code class="literal">checkBounds()</code> function. First, we get the minimum and maximum latitudes and longitudes of the allowed bounds and recent bounds. The <code class="literal">NE</code> label is the maximum value and the <code class="literal">SW</code> label is the minimum value of latitudes and longitudes:</p><div class="informalexample"><pre class="programlisting">var allowedNELng = allowedMapBounds.getNorthEast().lng();
var allowedNELat = allowedMapBounds.getNorthEast().lat();
var allowedSWLng = allowedMapBounds.getSouthWest().lng();
var allowedSWLat = allowedMapBounds.getSouthWest().lat();

var recentBounds = map.getBounds();
var recentNELng = recentBounds.getNorthEast().lng();
var recentNELat = recentBounds.getNorthEast().lat();
var recentSWLng = recentBounds.getSouthWest().lng();
var recentSWLat = recentBounds.getSouthWest().lat();</pre></div><p>The center of the map <a id="id399" class="indexterm"/>is used for both checking the difference and centering the map according to this value. The <code class="literal">nCenterX</code> and <code class="literal">nCenterY</code> values are used for checking if there is a change in the <code class="literal">centerX</code> and <code class="literal">centerY</code> values. The <code class="literal">if</code> statement checks for the recent values and allowed values. If the map is going out of the allowed bounds,  it will change the <code class="literal">centerX</code> or <code class="literal">centerY</code> values:</p><div class="informalexample"><pre class="programlisting">var recentCenter = map.getCenter();
var centerX = recentCenter.lng();
var centerY = recentCenter.lat();

var nCenterX = centerX;
var nCenterY = centerY;

if (recentNELng &gt; allowedNELng) centerX = centerX - (recentNELng - allowedNELng);
if (recentNELat &gt; allowedNELat) centerY = centerY - (recentNELat - allowedNELat);
if (recentSWLng &lt; allowedSWLng) centerX = centerX + (allowedSWLng - recentSWLng);
if (recentSWLat &lt; allowedSWLat) centerY = centerY + (allowedSWLat - recentSWLat);</pre></div><p>If there is a change in the <code class="literal">centerX</code> or <code class="literal">centerY</code> values, then we must keep the map in the bounds with the help of the <code class="literal">panTo()</code> method; otherwise, do nothing using <code class="literal">return</code>:</p><div class="informalexample"><pre class="programlisting">if (nCenterX != centerX || nCenterY != centerY) {
  map.panTo(new google.maps.LatLng(centerY,centerX));
}
else {
  return;
}</pre></div><p>There may be different ways to <a id="id400" class="indexterm"/>check the allowed bounds, such as only checking the center of the map, but this method will not limit the exact bounds you want.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec141"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Changing map properties programmatically</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li></ul></div></div></div>
<div class="section" title="Creating a control that shows coordinates"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Creating a control that shows coordinates</h1></div></div></div><p>Geographical coordinates<a id="id401" class="indexterm"/> are very important for showing where you are on the earth. Latitudes and longitudes come together to create a two-dimensional grid that simulates the earth's surface. Showing the latitude and longitude in a control on the map while you are moving the mouse can be a good usage of controls and events together.</p><p>In <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <span class="emphasis"><em>Working with Controls</em></span>, we have seen recipes such as <span class="emphasis"><em>Adding your own logo as a control</em></span>, and we have also seen how to use map events in this chapter. In this recipe, we will create a control with the help of the <code class="literal">mousemove</code> event of the map that shows the coordinates<a id="id402" class="indexterm"/> in real time.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec142"/>Getting ready</h2></div></div></div><p>In this recipe, we will use the first recipe defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span> as a template in order to skip the map creation.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_coordinate_control.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec143"/>How to do it…</h2></div></div></div><p>You can easily create a simple control to show the coordinates on mouse moves by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we will add a CSS class at the style part of the head section. This will decorate the coordinate control:<div class="informalexample"><pre class="programlisting">.mapControl { 
  width: 165px; 
  height: 16px; 
  background-color: #FFFFFF; 
  border-style: solid; 
  border-width: 1px; 
  padding: 2px 5px; 
}</pre></div></li><li class="listitem">After initializing <a id="id403" class="indexterm"/>the map, we will define the control parameters:<div class="informalexample"><pre class="programlisting">//Defining control parameters
var controlDiv = document.createElement('div');
controlDiv.className = 'mapControl';
controlDiv.id = 'mapCoordinates';
controlDiv.innerHTML = 'Lat/Lng: 0.00 / 0.00';</pre></div></li><li class="listitem">Then, add a control to the map with the following line:<div class="informalexample"><pre class="programlisting">//Creating a control and adding it to the map.
map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(controlDiv);</pre></div></li><li class="listitem">Now, we add an event listener to the map to handle the <code class="literal">mousemove</code> event and update the coordinates on each <code class="literal">mousemove</code> event:<div class="informalexample"><pre class="programlisting">//Listening the map for mousemove event to show it in control.
google.maps.event.addListener(map, 'mousemove', function(e) {
  var coordinateText = 'Lat/Lng: ' + e.latLng.lat().toFixed(6) + ' / ' + e.latLng.lng().toFixed(6);
  controlDiv.innerHTML = coordinateText;
});</pre></div></li><li class="listitem">Go to your local URL where your HTML is stored in your favorite browser and try to move the mouse. You will see the coordinate control changes in the left-bottom corner of the map.<div class="mediaobject"><img src="graphics/8825OT_05_05.jpg" alt="How to do it…"/></div></li></ol></div><p>We have successfully <a id="id404" class="indexterm"/>created a simple control that shows coordinates on mouse moves.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec144"/>How it works...</h2></div></div></div><p>This recipe is a combination of two chapters: <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <span class="emphasis"><em>Working with Controls</em></span>, and this chapter. More detailed information about controls can be gathered from <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <span class="emphasis"><em>Working with Controls</em></span>.</p><p>As it has been stated earlier, the Google Maps JavaScript API gives us different events to listen for, for different purposes. In this recipe, we will use the <code class="literal">mousemove</code> event of the map to get the coordinates of the mouse. The <code class="literal">mousemove</code> event handler has an input parameter to get coordinates. We will get the latitude and longitude from the <code class="literal">e.latLng</code> object with the help of the <code class="literal">lat()</code> and <code class="literal">lng()</code> functions, respectively. Then, we will fix their decimals to <code class="literal">6</code> digits in order to make an ordered view in the coordinate control with the Math function <code class="literal">toFixed()</code>:</p><div class="informalexample"><pre class="programlisting">//Listening the map for mousemove event to show it in control.
google.maps.event.addListener(map, 'mousemove', function(e) {
  var coordinateText = 'Lat/Lng: ' + e.latLng.lat().toFixed(6) + ' / ' + e.latLng.lng().toFixed(6);
  controlDiv.innerHTML = coordinateText;
});</pre></div><p>The remaining part of the<a id="id405" class="indexterm"/> code is related to simple map creation and creating a custom control, which is not the scope of this chapter.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec145"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding your own logo as a control</em></span> recipe of <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <span class="emphasis"><em>Working with Controls</em></span></li></ul></div></div></div>
<div class="section" title="Creating your own events"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Creating your own events</h1></div></div></div><p>Events <a id="id406" class="indexterm"/>are very important for JavaScript programming, and all JavaScript frameworks and APIs give developers access to some predefined event types related to their classes. The Google Maps JavaScript API is doing the same, and it gives us the most used event types with their classes. But what if you need a custom event type?</p><p>The Google Maps JavaScript API has a base class named <code class="literal">google.maps.MVCObject</code> that is the top class that most of the classes inherit. The class is ready for using in custom events with the <code class="literal">google.maps.event</code> namespace.</p><p>In this recipe, we will create a custom object with the <code class="literal">google.maps.MVCObject</code> class and bind it to a custom event to create your own events. The usage of the custom event cannot be a real-world case, but it will give you an idea about listening and firing your own events.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec146"/>Getting ready</h2></div></div></div><p>This recipe is still using<a id="id407" class="indexterm"/> the same map creation process defined in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span>, but there are some additional code blocks to create a table of contents (ToC) control and the custom event.</p><p>You can find the source code at <code class="literal">Chapter 5/ch05_custom_events.html</code>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec147"/>How to do it…</h2></div></div></div><p>If you perform the following steps, you can add and create your own types of events:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we add the CSS class of our custom control:<div class="informalexample"><pre class="programlisting">.mapControl { 
  width: 165px; 
  height: 55px; 
  background-color: #FFFFFF; 
  border-style: solid; 
  border-width: 1px; 
  padding: 2px 5px; 
}</pre></div></li><li class="listitem">Now, we create a <code class="literal">customObject</code> variable as a global variable after the <code class="literal">map</code> variable:<div class="informalexample"><pre class="programlisting">var customObject;</pre></div></li><li class="listitem">Then, we create <code class="literal">createTOCControl()</code> to create our table of contents control as follows:<div class="informalexample"><pre class="programlisting">function createTOCControl () {
  var controlDiv = document.createElement('div');
  controlDiv.className = 'mapControl';
  controlDiv.id = 'layerTable';
  map.controls[google.maps.ControlPosition.RIGHT_TOP].push(controlDiv);
  var html = '&lt;b&gt;Map Layers&lt;/b&gt;&lt;br/&gt;';
  html = html + '&lt;input type="checkbox" onclick="checkLayers(this)" value="geojson"&gt;GeoJSON Layer&lt;br/&gt;';
  html = html + '&lt;input type="checkbox" onclick="checkLayers(this)" value="marker"&gt;MarkerLayer';
  controlDiv.innerHTML = html;
}</pre></div></li><li class="listitem">The next step is <a id="id408" class="indexterm"/>adding another function, named <code class="literal">checkLayers()</code>, that is the function calling from the <code class="literal">onclick</code> event of the checkboxes:<div class="informalexample"><pre class="programlisting">function checkLayers(cb) {
  //Firing customEvent with trigger function.
  google.maps.event.trigger(customObject, 'customEvent', {layerName: cb.value, isChecked: cb.checked});
}</pre></div></li><li class="listitem">All the functions are ready to be added to the <code class="literal">initMap()</code> function. Add the following lines after initialization of the map:<div class="informalexample"><pre class="programlisting">//Creating Table of Contents Control.
createTOCControl();

//Creating custom object from Google Maps JS Base Class
customObject = new google.maps.MVCObject();

//Start listening custom object's custom event
google.maps.event.addListener(customObject, 'customEvent', function (e) {
    var txt = '';
    if(e.isChecked) {
      txt = e.layerName + ' layer is added to the map';
    }
    else {
      txt = e.layerName + ' layer is removed from the map';
    }
    alert(txt);
});</pre></div></li><li class="listitem">Go to your local <a id="id409" class="indexterm"/>URL where your HTML is stored in your favorite browser and see the map. When you click on one of the checkboxes in the table of contents control, you will see an alert box with the name of the layer and its status as to whether it has been added or removed.<div class="mediaobject"><img src="graphics/8825OT_05_06.jpg" alt="How to do it…"/></div></li></ol></div><p>This is the result of the recipe that shows both triggering and listening for the custom events defined by yourself.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec148"/>How it works...</h2></div></div></div><p>JavaScript has an<a id="id410" class="indexterm"/> inheritance that is one of the core concepts of object-oriented programming. This makes your life easier in order not to write the same methods again and again.</p><p>The Google Maps JavaScript API uses the inheritance of JavaScript both for itself and API developers. There are core classes that are the bases for other classes. The Google Maps JavaScript API has a base class named <code class="literal">google.maps.MVCObject</code> that all other classes are produced from.</p><p>If you want to create a custom class as in previous recipes, you should create a class from the <code class="literal">google.maps.MVCObject</code> class. In this recipe, we just create an object from the <code class="literal">MVCObject</code> class instead of creating a new class. Then, we will listen for <code class="literal">customEvent</code> of this created object just like other events:</p><div class="informalexample"><pre class="programlisting">//Creating custom object from Google Maps JS Base Class
customObject = new google.maps.MVCObject();

//Start listening custom object's custom event
google.maps.event.addListener(customObject, 'customEvent', function (e) {
    var txt = '';
    if(e.isChecked) {
      txt = e.layerName + ' layer is added to the map';
    }
    else {
      txt = e.layerName + ' layer is removed from the map';
    }
    alert(txt);
});</pre></div><p>Firing the custom event is much easier than listening for it. We use the <code class="literal">google.maps.event.trigger()</code> function to fire the event with additional parameters. Parameters should be in the JSON object format to send it to the event handler:</p><div class="informalexample"><pre class="programlisting">//Firing customEvent with trigger function.
google.maps.event.trigger(customObject, 'customEvent', {layerName: cb.value, isChecked: cb.checked});</pre></div><p>Creating a custom event in this recipe cannot be directly used in real-life cases, but this should give you an idea about how to use them. Events should be used carefully in order to use memory efficiently.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec149"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating a simple map in a custom DIV element</em></span> recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <span class="emphasis"><em>Google Maps JavaScript API Basics</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding your own logo as a control</em></span> recipe of <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <span class="emphasis"><em>Working with Controls</em></span></li></ul></div></div></div></body></html>