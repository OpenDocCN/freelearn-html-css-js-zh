<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Creating Interactive Forms</h1></div></div></div><p>In the previous chapter, you learned about many of the features of <code class="literal">GmailApp</code> and <code class="literal">ContactApp</code> and you built lots of real-world applications. In this chapter, you will learn how to create Forms programmatically using <code class="literal">FormApp</code> and <code class="literal">HtmlService</code>. Also, you will learn about the <code class="literal">doGet</code> and <code class="literal">doPost</code> functions.</p><div><div><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Creating Forms using script</h1></div></div></div><p>In <a class="link" href="ch01.html" title="Chapter 1. Introducing Google Apps Scripts">Chapter 1</a>, <em>Introducing Google Apps Scripts</em>, you created a Form manually, but this time we<a class="indexterm" id="id145"/> will create Forms programmatically by script. First <a class="indexterm" id="id146"/>of all, we will create a Form with four choices and an <strong>Other</strong> option choice. For simplicity, we add places as a multiple choice radio group. Each choice is exclusively selectable. Create the function <code class="literal">createForm</code> as shown here in a spreadsheet code file:</p><div><pre class="programlisting">function createForm() {
  
  var places = ["Place 1","Place 2","Place 3","Place 4"];

  var form = FormApp.create("Vacation Form");
  
  form.addMultipleChoiceItem()
    .setTitle('Where will you go for vacation?')
    .setChoiceValues(places)
    .showOtherOption(true);
  
}</pre></div><p>The <code class="literal">places</code> variable holds a few random places, and you can assign any place name and any number of places as an array of strings. The <code class="literal">create</code> method of <code class="literal">FormApp</code> class creates a form titled <code class="literal">Vacation Form</code> in your Drive's root folder (<code class="literal">My Drive</code>). On running the function, the created Form will look like this:</p><div><img alt="Creating Forms using script" src="img/B05010_04_01.jpg"/></div><p>The<a class="indexterm" id="id147"/> choices are hardcoded in the code. If you would like to <a class="indexterm" id="id148"/>change any choice or add more choices, then you should edit the code to make the required changes. If you need to change the choices frequently, it might become irritating or hard to edit the code every time. Now we will add place names from spreadsheet's data rather than them being hardcoded. Add or rename an existing sheet as <code class="literal">Places</code> and add a few place names in it as shown here:</p><div><img alt="Creating Forms using script" src="img/B05010_04_02.jpg"/></div><p>Now<a class="indexterm" id="id149"/> update the <code class="literal">createForm</code> function<a class="indexterm" id="id150"/> as shown here:</p><div><pre class="programlisting">function createForm() {
  
  var ThisSpreadsheet = SpreadsheetApp.getActive();
  var SheetPlaces = ThisSpreadsheet.getSheetByName("Places");
  
  // Load 'Places' sheet data as a 2-dimensional array.
  var data = SheetPlaces.getDataRange().getValues();
  
  // remove the header row
  data.shift();
  
  var places = [];
  
  // Populate the places array with the first column's data
  data.forEach(function(row){
    places.push(row[0]);
  });
  
  // Create a new form
  var form = FormApp.create("Vacation Form");
  
  form.addMultipleChoiceItem()
    .setTitle('Where will you go for a vacation?')
    .setChoiceValues(places)
    .showOtherOption(true);
  
}</pre></div><p>The <a class="indexterm" id="id151"/>preceding function will create a Form with the choices' <a class="indexterm" id="id152"/>text retrieved from the Sheet's data. The choices' text and/or number of choices can be varied as per your Sheet's data. If you would like to make any changes in the choices' text, then it is enough to edit the Sheet's data, and you do not need to edit the code.</p><p>When you run the function just mentioned, it will create a Form named <code class="literal">Vacation Form</code> in the <code class="literal">My Drive</code> folder. To open the Form in edit mode, double-click or right-click (context click) on Form name and go to <strong>Open with</strong> | <strong>Google Forms</strong>. The following screenshot shows what the Form would look like in edit mode. You can make any adjustments and/or perform formatting in edit mode:</p><div><img alt="Creating Forms using script" src="img/B05010_04_03.jpg"/></div><p>To <a class="indexterm" id="id153"/>open the live Form, right-click (context click) on the<a class="indexterm" id="id154"/> Form name, click on <strong>Get link</strong>, copy the link, and then paste the link in your browser's address bar. The following screenshot shows what the live Form will look like:</p><div><img alt="Creating Forms using script" src="img/B05010_04_04.jpg"/></div><p>You<a class="indexterm" id="id155"/> can share the<a class="indexterm" id="id156"/> live Form link with your users. Your user's responses are stored in the Form itself. You can see responses in the Form editor, or link a spreadsheet to it to view the responses, as shown:</p><div><img alt="Creating Forms using script" src="img/B05010_04_05.jpg"/></div><p>You can<a class="indexterm" id="id157"/> link Form responses to a spreadsheet manually <a class="indexterm" id="id158"/>by clicking on the icon in the top right-hand corner of the Form editor. A new <code class="literal">Form Responses</code> Sheet will be created in the selected spreadsheet.</p><p>To programmatically link a spreadsheet, use the following code:</p><div><pre class="programlisting">form.setDestination( FormApp.DestinationType.SPREADSHEET, ThisSpreadsheet.getId() ); // Replace with your spreadsheet's ID</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Publishing the script as a web application</h1></div></div></div><p>You <a class="indexterm" id="id159"/>can create awesome web pages/applications<a class="indexterm" id="id160"/> by publishing your script as a web application. In this section, you'll see how to publish a script. Start by creating a new Sheet and entering the following code in the script editor:</p><div><pre class="programlisting">function doGet(){
  var str = "Hello world!";
  return ContentService.createTextOutput(str);
}</pre></div><p>The <code class="literal">doGet</code> function will be executed whenever a HTTP/HTTPS request is sent to the script. In the preceding code, <code class="literal">ContentService</code> is used to return a string to the browser. Content <a class="indexterm" id="id161"/>service can be used to return any type <a class="indexterm" id="id162"/>of content including simple text, HTML, XML, JSON, CSV, and so on.</p><p>To publish the script, within the script editor, navigate to <strong>Publish</strong> | <strong>Deploy as web app…</strong>. A new <strong>Deploy as web app</strong> dialog will open as shown here:</p><div><img alt="Publishing the script as a web application" src="img/B05010_04_06.jpg"/></div><p>Select any one of the existing project versions or select <strong>New</strong> to create a new project version. There will be two choices under the <strong>Execute the app as</strong> option, <strong>Me</strong> and <strong>User</strong>, accessing the web app. For this application, select <strong>Me</strong> (your user ID). This means the script will run on behalf of your user ID. If you had selected the second option then the script would run on behalf of the user who is accessing the application. Select <strong>Anyone, even anonymous</strong> under the <strong>Who has access to the app</strong> option.</p><div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>There are two more choices <strong>Only myself</strong> and <strong>Anyone</strong> available under the <strong>Who has access to the app</strong> option. Select <strong>Only myself</strong> if you would only like to get access to the published app. Select <strong>Anyone</strong> if you would like to give access to others, but please be aware that the others should be logged in with their Google user ID. If you select <strong>Anyone, even anonymous</strong>, then your user can be anyone and does not need to be logged in. They do not even need to be a Google user.</p></div></div><p>Finally, click<a class="indexterm" id="id163"/> on the <strong>Deploy</strong> button. Then another<a class="indexterm" id="id164"/> dialog will open as shown in the following screenshot:</p><div><img alt="Publishing the script as a web application" src="img/B05010_04_07.jpg"/></div><div><div><h3 class="title"><a id="tip16"/>Tip</h3><p>If you are publishing the script for the first time, then you need to authorize the script. Authorization is initiated before web app deployment. Click <strong>Allow</strong> in the authorization dialog.</p></div></div><p>In this dialog, you can see the published URL under the <strong>Current web app URL</strong> textbox. You can copy and paste this URL in a new browser window/tab address bar to see the working<a class="indexterm" id="id165"/> of your web application. For the preceding<a class="indexterm" id="id166"/> code, the text returned will be <strong>Hello world!</strong> Click <strong>OK</strong> to close the dialog.</p><div><div><h3 class="title"><a id="tip17"/>Tip</h3><p>If you make any changes in your code, then you should publish the new version again, otherwise the updates will not take effect. Alternatively, you can use the <strong>latest code</strong> URL for development purposes.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec46"/>HtmlService</h1></div></div></div><p>At the <a class="indexterm" id="id167"/>beginning of this chapter, you created a Form using script codes. However, this Form is a static one, meaning you cannot add dynamic formatting or script on the client side. You can perform formatting and calculations, if there are any to be done, on the server side only.</p><p>
<code class="literal">HtmlService</code> allows scripts to return HTML or web pages to clients. For security reasons the HTML content, including CSS and JavaScript, are compiled and sandboxed by Caja compiler before returning to the client browser. The returned web page(s) can interact with server-side GAS functions using the <code class="literal">google.script.run</code> API methods.</p><p>The advantages of using <code class="literal">HtmlService</code> are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can use CSS and client-side JavaScript</li><li class="listitem" style="list-style-type: disc">You can create dynamic HTML forms rather than static Forms</li><li class="listitem" style="list-style-type: disc">You can work on client-side HTML and server-side script codes separately</li></ul></div><p>
<code class="literal">HtmlService</code> can<a class="indexterm" id="id168"/> create HTML codes from templates. The <strong>templates</strong> are HTML files mixed with HTML markup and scripts (these are called <strong>scriptlets</strong> and <a class="indexterm" id="id169"/>are executed on the server side).</p><p>Scriptlets enclosed by <code class="literal">&lt;?</code> and <code class="literal">?&gt;</code> execute but output nothing to the enclosing HTML. In other words, they do not alter the surrounding HTML code. Scriptlets enclosed by <code class="literal">&lt;?=</code> and <code class="literal">?&gt;</code> return the output to the surrounding HTML code. Any functions inside scriptlets can call functions of other scriptlets or server-script functions, but server functions cannot call functions within scriptlets.</p><p>For further<a class="indexterm" id="id170"/> reading on scriptlet tags, visit: <a class="ulink" href="https://developers.google.com/apps-script/guides/html/templates">https://developers.google.com/apps-script/guides/html/templates</a>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Creating a Form using HtmlService</h1></div></div></div><p>Create <a class="indexterm" id="id171"/>a <code class="literal">Form.html</code> file, which we are going to<a class="indexterm" id="id172"/> use as an HTML template and enter the following code in it:</p><div><pre class="programlisting">&lt;!-- Form.html  --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;

  &lt;head&gt;
    &lt;base target="_top"&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;form&gt;
      &lt;h4&gt;Where will you go for vacation?&lt;/h4&gt;

      &lt;input type="radio" name="places" value="Place 1" /&gt;Place 1

      &lt;br /&gt;
      &lt;input type="radio" name="places" value="Place 2" /&gt;Place 2

      &lt;br /&gt;
      &lt;input type="radio" name="places" value="Place 3" /&gt;Place 3

      &lt;br /&gt;
      &lt;input type="radio" name="places" value="Place 4" /&gt;Place 4
      
      &lt;br /&gt;
      &lt;br /&gt;
      &lt;input type="submit" value="SUBMIT" /&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>Use the same name attribute value for radio type input fields so that they are all grouped together. This means they will work exclusively. Update the <code class="literal">doGet</code> function in the <code class="literal">Code.gs</code> file to render the previously mentioned HTML form, as follows:</p><div><pre class="programlisting">// Code.gs
function doGet() {
  var template = HtmlService.createTemplateFromFile("Form.html");
  var html = template.evaluate();

  return HtmlService.createHtmlOutput(html);
}</pre></div><p>Publish<a class="indexterm" id="id173"/> the<a class="indexterm" id="id174"/> script and enter the published URL in your browser's address bar. The basic HTML form returned is shown here:</p><div><img alt="Creating a Form using HtmlService" src="img/B05010_04_08.jpg"/></div><p>To populate places automatically from spreadsheet data, update the HTML code as shown here:</p><div><pre class="programlisting">   &lt;form&gt;
      &lt;h4&gt;Where will you go for vacation?&lt;/h4&gt;
      &lt;? for (var i in places) { ?&gt;
        &lt;input type="radio" name="places" value="&lt;?= places[i] ?&gt;" /&gt;&lt;?= places[i] ?&gt;&lt;br /&gt;
      &lt;? } ?&gt;
      &lt;br /&gt;
      &lt;input type="submit" value="SUBMIT" /&gt;
    &lt;/form&gt;</pre></div><p>The scriptlet <code class="literal">&lt;?= places[i] ?&gt;</code> returns the <em>i</em>th element from the <code class="literal">places</code> array. You also need to<a class="indexterm" id="id175"/> update<a class="indexterm" id="id176"/> the <code class="literal">doGet</code> function as shown here:</p><div><pre class="programlisting">function doGet() {
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetPlaces = ss.getSheetByName("Places");
  
  var data = SheetPlaces.getDataRange().getValues();
  
  // Remove header row.
  data.shift();
  
  var places = [];
  
  // Populate the places array with the first column's data.
  data.forEach(function(row){
    places.push(row[0]);
  });
  
  var template = HtmlService.createTemplateFromFile("Form.html");
  
  // Assign the places array to the template object.
  template.places = places;

  var html = template.evaluate();
  return HtmlService.createHtmlOutput(html);
}</pre></div><p>The <code class="literal">places</code> array is assigned to the template in the <code class="literal">doGet</code> function and referenced in the HTML template. Then, the output becomes the following:</p><div><img alt="Creating a Form using HtmlService" src="img/B05010_04_09.jpg"/></div><p>To <a class="indexterm" id="id177"/>submit<a class="indexterm" id="id178"/> this Form data to the spreadsheet, you need to add method and action attributes to the Form element:</p><div><pre class="programlisting">    &lt;form method="post" action="&lt;?= pubUrl ?&gt;" &gt;</pre></div><p>Assign the published URL to the <code class="literal">template</code> object in the <code class="literal">doGet</code> function, for example:</p><div><pre class="programlisting">template.pubUrl = "https://script.google.com/macros/s/AKfycbzMqmOaaD- TTDbycMl2AxF7dtn9EqxqZTwozcQBNHxe9hg4Kbc/exec";</pre></div><p>You could also assign it as follows:</p><div><pre class="programlisting">template.pubUrl = ScriptApp.getService().getUrl();</pre></div><p>To process the submitted Form data, add a <code class="literal">doPost</code> function. The <code class="literal">doGet</code> or <code class="literal">doPost</code> functions execute as per the HTTP/HTTPS request method (<code class="literal">GET</code> and <code class="literal">POST</code>):</p><div><pre class="programlisting">function doPost(e){
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");

  var SheetResponses = ss.getSheetByName("Responses");
  
  // Create a 'Responses' sheet if it does not exist.
  if(!SheetResponses){
     SheetResponses = ss.insertSheet("Responses");
  };
  
  SheetResponses.appendRow([e.parameter.places]);
  
  return ContentService.createTextOutput(
     "Your response submitted successfully. Thank you!"
  );

}</pre></div><p>After <a class="indexterm" id="id179"/>the Form is<a class="indexterm" id="id180"/> submitted, a thank you message is returned as the normal text content:</p><div><img alt="Creating a Form using HtmlService" src="img/B05010_04_10.jpg"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Submitting form using Google script API method</h1></div></div></div><p>To submit data using the <code class="literal">google.script.run</code> API methods, add <code class="literal">onclick</code> property to the <strong>Submit</strong> button:</p><div><pre class="programlisting">&lt;input type="submit" value="SUBMIT" onclick="google.script.run.postFormDataToSheet(this.parentNode);" /&gt;
&lt;!-- this.parentNode is the 'form' element --&gt;</pre></div><p>Create the <code class="literal">postFormDataToSheet</code> function as shown here:</p><div><pre class="programlisting">function postFormDataToSheet(e){
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");

  var SheetResponses = ss.getSheetByName("Responses");

  // Create a 'Responses' sheet if it does not exist.
  if(!SheetResponses){
    SheetResponses = ss.insertSheet("Responses");
  }

  SheetResponses.appendRow([e.places]);
}</pre></div><p>To<a class="indexterm" id="id181"/> show Form submission result or error message, insert the <code class="literal">postData</code> function in a separate <code class="literal">&lt;script&gt;</code> tag and add success and failure handlers with a callback function as shown here:</p><div><pre class="programlisting">    &lt;script&gt;
      function postData(form){
        google.script.run
          .withSuccessHandler(callback)
          .withFailureHandler(callback)
          .postFormDataToSheet(form);
      }

      function callback(msg){
        alert(msg);
      }
    &lt;/script&gt;</pre></div><p>Insert<a class="indexterm" id="id182"/> a return statement with a message to the user at the end of the <code class="literal">postFormDataToSheet</code> function.</p><p>To add the <code class="literal">User</code> object to the <code class="literal">google.script.run</code> API calls, add the <code class="literal">withUserObject</code> method along with the success and failure handlers:</p><p>The complete HTML code with the <code class="literal">user</code> object is shown here:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    
    &lt;script&gt;
      function postData(form){
        google.script.run
          .withSuccessHandler(showSuccess)
          .withFailureHandler(showError)
          .withUserObject(form)
          .postFormDataToSheet(form);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showSuccess(msg,elem) {
        var newElement = document.createElement("div");
        newElement.innerHTML = '&lt;font color="green"&gt;'
          + msg + '&lt;/font&gt;';
        elem.appendChild(newElement);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showError(msg,elem){
        var newElement = document.createElement("div");

        newElement.innerHTML = '&lt;font color="red"&gt;'
          + msg + '&lt;/font&gt;';

        elem.appendChild(newElement);
      }

    &lt;/script&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    &lt;form&gt;
      &lt;h4&gt;Where will you go for vacation?&lt;/h4&gt;
      
      &lt;? for (var i in places) { ?&gt;
        &lt;input type="radio" name="places"
          value="&lt;?= places[i] ?&gt;" /&gt;&lt;?= places[i] ?&gt;
        &lt;br /&gt;
      &lt;? } ?&gt;
      
      &lt;br /&gt;
      &lt;input type="button" value="SUBMIT"
        onclick="postData(this.parentNode);" /&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>The <a class="indexterm" id="id183"/>complete <a class="indexterm" id="id184"/>version of the <code class="literal">postFormDataToSheet</code> function is listed here:</p><div><pre class="programlisting">function postFormDataToSheet(e){
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetResponses = ss.getSheetByName("Responses");
  
  // Create 'Responses' sheet if it does not exist.
  if(!SheetResponses){
    SheetResponses = ss.insertSheet("Responses");
  }
  
  SheetResponses.appendRow([e.places]);
  
  return "Your response submitted successfully. Thank you!";
}</pre></div><p>In this script, you used HTML code in a separate file, namely <code class="literal">Form.html</code>. This file is used as a template in the GAS server, and only the resulted markup and script code are returned to the user's browser. From the browser (the client side), we use the Google client-side JavaScript API (<code class="literal">google.script.run</code>) to interact with the GAS server. This is an AJAX-like interaction between the client and server. Here, the client and server are your browser and GAS server respectively.</p><p>Referencing HTML tags/elements (DOM elements) using plain JavaScript most of the time is a tedious task. To make life easier, you can use jQuery libraries. Also, you need not define CSS styles in the <code class="literal">&lt;style&gt;</code> tag yourself; rather you can use any officially-supported (by Google) third-party style sheets.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec49"/>Creating forms using add-ons CSS and jQuery libraries</h1></div></div></div><p>The same HTML code using the Google add-on CSS and jQuery libraries is as follows:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    
    &lt;!-- Google's Add-ons stylesheet //--&gt;
    &lt;link rel="stylesheet" href="https://ssl.gstatic.com/docs/ script/css/add-ons1.css" /&gt;

    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    
    &lt;script&gt;
      // on document load, assign postData function to submit // button's onclick property.
      $(function(){
        $("#btnSubmit").click(postData);
      });
      
      // Calls server side function 'postFormDataToSheet'
      // with form as the argument.
      function postData(){
        google.script.run
          .withSuccessHandler(showSuccess)
          .withFailureHandler(showError)
          .withUserObject(this)
          .postFormDataToSheet(this.parentNode);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showSuccess(msg,elem) {
        var div = $('&lt;div id="error"&gt; &lt;font color="green"&gt;' + msg + '&lt;/font&gt;&lt;/div&gt;');
        $(elem).after(div);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showError(msg,elem) {
        var div = $('&lt;div id="error" class="error"&gt;' + msg + '&lt;/div&gt;');
        $(elem).after(div);
      }
    &lt;/script&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    &lt;form&gt;
      &lt;h4&gt;Where will you go for vacation?&lt;/h4&gt;
      
      &lt;? for (var i in places) { ?&gt;
        &lt;input type="radio" name="places"
          value="&lt;?= places[i] ?&gt;" /&gt;&lt;?= places[i] ?&gt;
        &lt;br /&gt;
      &lt;? } ?&gt;
      
      &lt;br /&gt;
      &lt;input class="submit" id="btnSubmit" type="button" value="SUBMIT" /&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec50"/>Creating an e-voting application</h1></div></div></div><p>The<a class="indexterm" id="id185"/> previous application appends each response to the <code class="literal">Responses</code> Sheet. But, we need to update the count against each choice. If we can make the selected choices increment by a counter then we can use the same application for e-voting purposes.</p><p>Edit the labels/headers for column <em>A</em> and <em>B</em> in the <code class="literal">Places</code> sheet as follows:</p><div><img alt="Creating an e-voting application" src="img/B05010_04_11.jpg"/></div><p>Update the HTML code in the <code class="literal">Form.html</code> file as shown here:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    
    &lt;link rel="stylesheet" href="https://ssl.gstatic.com/docs/ script/css/add-ons1.css" /&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    
    &lt;script&gt;
      $(function(){
        $("#btnSubmit").click(postData);
      });
      
      function postData(){
        // Remove previous messages if any
        $("#error,#success").remove();

        // Disable the submit button until server returns // anything.
        this.disabled = true;

        // Call server function
        google.script.run
          .withSuccessHandler(showSuccess)
          .withFailureHandler(showError)
          .withUserObject(this)
          .postFormDataToSheet(this.parentNode);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showSuccess(msg,elem) {
        elem.disabled = false;
        var div = $('&lt;div id="success"&gt; &lt;font color="green"&gt;' + msg + '&lt;/font&gt;&lt;/div&gt;');
        $(elem).after(div);
      }
      
      /*
       * msg -  the error or success message returned *        from the server.
       *
       * elem - the reference to the user object (form).
       *
       */
      function showError(msg,elem) {
        elem.disabled = false;
        var div = $('&lt;div id="error" class="error"&gt;' + msg + '&lt;/div&gt;');
        $(elem).after(div);
      }
    &lt;/script&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    &lt;form&gt;
      &lt;h4&gt;Where will you go for vacation?&lt;/h4&gt;
      
      &lt;? for (var i in places) { ?&gt;
        &lt;input type="radio" name="places" value="&lt;?= i ?&gt;" /&gt;&lt;?= places[i] ?&gt;&lt;br /&gt;
      &lt;? } ?&gt;
      
      &lt;br /&gt;
      &lt;input class="blue" id="btnSubmit" type="button" value="SUBMIT" /&gt;
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>For this application keep the <code class="literal">Form.html</code> code as it is, but update the <code class="literal">doGet</code> and <code class="literal">postFormDataToSheet</code> functions <a class="indexterm" id="id186"/>as shown here:</p><div><pre class="programlisting">function doGet() {
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetPlaces = ss.getSheetByName("Places");
  
  var data = SheetPlaces.getDataRange().getValues();
  data.shift();
  
  var places = [];
  data.forEach(function(row){
    places.push(row[0]);
  });
  
  var template = HtmlService.createTemplateFromFile("Form.html");
  template.places = places;
  
  var html = template.evaluate();
  html.setTitle("eVoting");

  return HtmlService.createHtmlOutput(html);
}

function postFormDataToSheet(e){
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetPlaces = ss.getSheetByName("Places");
  
  var data = SheetPlaces.getDataRange().getValues();
  
  var i = Number(e.places)+1;
  data[i][1]++;
  
  SheetPlaces.getRange(1, 1, data.length, data[0].length).setValues(data);
  
  return "Your response submitted successfully. Thank you!";
}</pre></div><p>In this<a class="indexterm" id="id187"/> application, the responses are not appended, but the counts are incremented on every submission. A sample output is shown here:</p><div><img alt="Creating an e-voting application" src="img/B05010_04_12.jpg"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec51"/>Creating a ticket reservation application</h1></div></div></div><p>This<a class="indexterm" id="id188"/> application serves as an HTML form to the user to let them submit values to the server. This could be to reserve a ticket for a show, book a seat in a venue, book a room in a hotel, and many more purposes.</p><p>Create a spreadsheet and create column labels as shown in the following screenshot:</p><div><img alt="Creating a ticket reservation application" src="img/B05010_04_13.jpg"/></div><p>In the code file, create the <code class="literal">doGet</code>, <code class="literal">doPost</code> and <code class="literal">cancelReservation</code> functions:</p><div><pre class="programlisting">function doGet(e) {
  // Maximum available
  const MAX_TICKETS = 25;

  // 'cancel' is a query string appended with the published URL.
  var cancel = e.parameter.cancel;

  if(cancel){
    var msg = cancelReservation(cancel);
    return ContentService.createTextOutput(msg);
  }
  
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetReservations = ss.getSheetByName("Reservations");
  
  var data = SheetReservations.getDataRange().getValues();
  data.shift();
  
  var template = HtmlService.createTemplateFromFile("Form.html");
  template.available = MAX_TICKETS - data.length;
  
  if(template.available &lt; 1)
  return ContentService.createTextOutput ("All tickets reserved, sorry!");
  
  // Use the following line of code for testing purposes only
  // Replace with your development URL.
  template.pubUrl = "https://script.google.com/macros/s/ " + " AKfycbzIkrLEaMMRRYwOA_d_Tiy1TFtxUylaotB07HB4wZGW/dev";

  // Uncomment the following line for the production use.
  //template.pubUrl = ScriptApp.getService().getUrl();
  
  var html = template.evaluate();
  return HtmlService.createHtmlOutput(html);
  
}</pre></div><p>In the<a class="indexterm" id="id189"/> preceding code, the <code class="literal">doGet</code> function initially checks for any query such as <code class="literal">cancel</code>, appended with the URL. If <code class="literal">cancel</code> is present, then the <code class="literal">cancelReservation</code> function is called, otherwise the HTML form is returned:</p><div><pre class="programlisting">/**
 *  This function post the form data to the
 *  spreadsheet.
 *
 */
function doPost(e){
  // Replace with your spreadsheet's ID.
  var ss = SpreadsheetApp.openById("spreadsheet's id");
  var SheetReservations = ss.getSheetByName("Reservations");
  
  // name, phone_number and e-mail are form elements.
  var name = e.parameter.name;
  var phoneNumber = e.parameter.phone_number;
  var email = e.parameter.email;
  var ticketNumber = +new Date(); // current date as epoch number

  SheetReservations.appendRow(
    [name, phoneNumber, email, ticketNumber, "Reserved"]
  );
  
  // Use the following line of code for testing purposes only.
  // Replace with your development URl.
  var pubUrl = "https://script.google.com/macros/s/ " + " AKfycbzIkrLEaMMRRYwOA_d_Tiy1TFtxUylaotB07HB4wZGW/dev";

  // Uncomment the following line for production use.
  //pubUrl = ScriptApp.getService().getUrl();
  
  var emailBody = '&lt;p&gt;Thank you for registering. Your ticket number: ' + ticketNumber + '&lt;/p&gt;';

  emailBody += '&lt;p&gt;You can &lt;a href="'+ pubUrl +'?cancel=' + ticketNumber + '"&gt;click here&lt;/a&gt; to cancel reservation.&lt;/p&gt;';
  
  // Send confirmation e-mail with cancel link
  MailApp.sendEmail({
    to: email,
    subject: "Reservation Confirmation",
    htmlBody: emailBody
  });

  // Return confirmation text message to the browser.
  return ContentService.createTextOutput("Your ticket reserved and confirmation email has been sent.\nThank you!");
}


function cancelReservation(timestamp){
  
  // Replace with your spreadsheet id.
  var ss = SpreadsheetApp.openById("spreadsheet's id");

  var SheetReservations = ss.getSheetByName("Reservations");
  
  var data = SheetReservations.getDataRange().getValues();
  
  /*
   * Identify sheet row by timestamp if it matches
   * then mark as cancelled.
   *
   */
  for(var i = 0; i &lt; data.length; i++){
    if(data[i][3] == timestamp) data[i][4] = "Cancelled";
  }
  
  // Replace the updated data in sheet
  SheetReservations.getRange(1, 1, data.length, data[0].length).setValues(data);
  
  return "Your reservation cancelled.";
}</pre></div><p>The <a class="indexterm" id="id190"/>preceding function compares the ticket number (<code class="literal">timestamp</code>) with the existing data and, if that ticket number is present, then it is marked as cancelled.</p><p>Insert the following code in the <code class="literal">Form.html</code> file:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    &lt;link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/ css/add-ons1.css" /&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  
  &lt;body&gt;
    &lt;form method="post" action="&lt;?= pubUrl ?&gt;" &gt;
    
      &lt;h4&gt;Reservation Form&lt;/h4&gt;
      &lt;p&gt;Available: &lt;?= available ?&gt;&lt;/p&gt;

      &lt;input type="text" name="name" placeholder="Enter your name"/&gt;

      &lt;br /&gt;
      &lt;input type="text" name="phone_number" placeholder="Enter phone number"/&gt;

      &lt;br /&gt;
      &lt;input type="text" name="email" placeholder="Enter email id"/&gt;

      &lt;br /&gt;&lt;br /&gt;
      &lt;input class="blue" id="btnSubmit" type="submit" value="Reserve"/&gt;
      
    &lt;/form&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>A sample e-mail's body text is shown in the following screenshot:</p><div><img alt="Creating a ticket reservation application" src="img/B05010_04_14.jpg"/></div><p>A <a class="indexterm" id="id191"/>sample output of the <code class="literal">Reservations</code> sheet is shown here:</p><div><img alt="Creating a ticket reservation application" src="img/B05010_04_15.jpg"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec52"/>Summary</h1></div></div></div><p>In this chapter, you learned how to create many useful real-life applications including a reservation system application. The next chapter will be focused on Google Calendar. You will learn how to create Calendar events and how to enable Google's advanced services. You will also learn to create Drive file routing and search applications.</p></div></body></html>