- en: Chapter 2. File Management
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Copying files
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compressing files
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating symbolic links
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Concatenating files
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching a single URL
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching multiple URLs
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we'll be focused on making use of Grunt for our every-day file
    management tasks. A day rarely passes without us copying, compressing, downloading,
    or concatenating files, and with the help of Grunt, we can automate even these
    simple tasks.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: Copying files
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In our quest for ultimate project automation, it won't be long before we'll
    want to automate the copying of files or directories from one part of our project
    to another. The `contrib-copy(0.5.0)` plugin provides us with this functionality,
    along with some other options that become especially useful in the process of
    copying files.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The following steps will take us through copying a single file from one directory
    to another.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: We'll start by installing the package that contains the `contrib-copy` plugin
    as per the instructions provided in the *Installing a plugin* recipe in [Chapter
    1](part0015.xhtml#aid-E9OE1 "Chapter 1. Getting Started with Grunt"), *Getting
    Started with Grunt*.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Let''s also set up a sample file in our project, which we can try out with
    the copy operation. Create a file named `sample.txt` in the `src` directory with
    the following contents:'
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-18
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Now, we can add the configuration for our `copy` task, which will instruct
    it to copy our sample file from the `src` directory to the `dest` directory:'
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-20
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Tip
  id: totrans-21
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Note that the destination directory specified in the copy operation will be
    automatically created if it does not yet exist.
  id: totrans-22
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Finally, we can run the `grunt copy` command, which should provide output informing
    us of the successful copy operation:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: To confirm that the sample file was copied, we can now open the `dest/sample.txt`
    file using our favorite editor and confirm that its contents match the original
    file's contents.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `copy` task provides some useful configuration options that allow us to
    process the contents of the files that are being copied, copy the source file's
    permissions, and set the file permissions for destination files.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: Processing file contents
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The `copy` task provides the option of altering the contents of files as they
    are being copied. There are a number of useful applications for this functionality,
    such as rendering a template or replacing parts of a file that are matched by
    a regular expression.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: In the following example, we'll simply focus on prepending a string to a copied
    file. We'll build upon our work earlier in this recipe.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: 'We''ll start by providing a stub function for the `process` option that just
    passes through the content without altering anything. This will change the configuration
    of our `copy` task to the following:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将首先提供一个 `process` 选项的占位函数，该函数只是传递内容而不做任何修改。这将改变我们 `copy` 任务的配置，如下所示：
- en: '[PRE3]'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, we can alter the function passed to the `process` option so that it prepends
    a string to the contents of the file being copied, making it look similar to the
    following:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以修改传递给 `process` 选项的函数，以便在正在复制的文件内容前添加一个字符串，使其看起来类似于以下内容：
- en: '[PRE4]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'If we now run the `grunt copy` command again, we will see a confirmation of
    the file being copied, and looking at the contents of the `dest/sample.txt` file,
    we should see the following:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们现在再次运行 `grunt copy` 命令，我们将看到文件正在被复制的确认信息，并且查看 `dest/sample.txt` 文件的内容，我们应该看到以下内容：
- en: '[PRE5]'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Copying the source file's permissions
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 复制源文件的权限
- en: 'The permissions attached to a file are usually of great importance. By default,
    the copy task will ignore the file permissions of the source file, but if you''d
    like them to be applied to the destination file, then the `mode` option can be
    set to `true` as per the following example:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 文件附加的权限通常非常重要。默认情况下，复制任务将忽略源文件的文件权限，但如果你希望它们应用于目标文件，则可以将 `mode` 选项设置为 `true`，如下例所示：
- en: '[PRE6]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Setting the permissions of the destination file
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置目标文件的权限
- en: In case you'd like to specify the permissions that the destination files of
    a copy operation should get, you can do so by setting the `mode` option to the
    desired permission mode using the traditional Unix permissions in octal format.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你希望指定复制操作的目标文件应获得的权限，你可以通过将 `mode` 选项设置为所需的权限模式，使用传统的八进制格式的 Unix 权限来实现。
- en: Tip
  id: totrans-42
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: You can read more about the traditional Unix permissions convention at [http://en.wikipedia.org/wiki/File_system_permissions](http://en.wikipedia.org/wiki/File_system_permissions).
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 [http://en.wikipedia.org/wiki/File_system_permissions](http://en.wikipedia.org/wiki/File_system_permissions)
    上阅读有关传统 Unix 权限约定的更多信息。
- en: There's also a handy Unix file permissions calculator available at [http://permissions-calculator.org/](http://permissions-calculator.org/).
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有一个方便的 Unix 文件权限计算器，可在 [http://permissions-calculator.org/](http://permissions-calculator.org/)
    找到。
- en: 'The following example configuration will make the destination file readable
    and writable, only for their owner:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例配置将使目标文件只对其所有者可读和可写：
- en: '[PRE7]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Compressing files
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 文件压缩
- en: The compression of files is quite a common practice within our local system,
    and across the World Wide Web. The most prominent use for file compression is
    to reduce the size of data that will be transferred across a network.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的本地系统以及整个万维网上，文件压缩是一种相当常见的做法。文件压缩最显著的应用是减少将通过网络传输的数据大小。
- en: For our own purposes, we may at some point want to automate the compression
    of a file or folder that we'd like to make available for download or prepare for
    a transfer. The `contrib-compress (0.10.0)` plugin provides us with this functionality,
    along with options to specify the archive type and algorithms used in the process.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 为了我们自己的目的，我们可能在某个时候想要自动化压缩一个我们希望可供下载或准备传输的文件或文件夹。`contrib-compress (0.10.0)`
    插件为我们提供了这种功能，以及指定在过程中使用的存档类型和算法的选项。
- en: Getting ready
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们将使用我们在 [第1章](part0015.xhtml#aid-E9OE1 "第1章。使用 Grunt 入门") 中 *在项目中安装 Grunt*
    菜单创建的基本项目结构。如果你还不熟悉其内容，请务必参考。
- en: How to do it...
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following steps will take us through compressing a single sample file using
    the default settings of the `compress` task.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导我们使用 `compress` 任务的默认设置压缩单个样本文件。
- en: We'll start by installing the package that contains the `contrib-compress` plugin
    as per the instructions provided in the *Installing a plugin* recipe in [Chapter
    1](part0015.xhtml#aid-E9OE1 "Chapter 1. Getting Started with Grunt"), *Getting
    Started with Grunt*.
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将按照 [第1章](part0015.xhtml#aid-E9OE1 "第1章。使用 Grunt 入门") 中 *安装插件* 菜单提供的说明，安装包含
    `contrib-compress` 插件的包，*使用 Grunt 入门*。
- en: Then, we can create a sample file to demonstrate the compression functionality.
    Let's download a book in text format as an example and save it as `book.txt` in
    our project directory.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-56
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The text version of Jane Austen''s *Pride and Prejudice* can be downloaded
    at the following URL:'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[http://www.gutenberg.org/cache/epub/1342/pg1342.txt](http://www.gutenberg.org/cache/epub/1342/pg1342.txt)'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now, we can add the following configuration for the `compress` task, which
    will compress our sample file into the `book.txt.gz` archive file:'
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To try it out, we can run the `grunt compress` command, which should produce
    output similar to the following:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: If we take a look at the `book.txt.gz` file, we'll see that it's about half
    the size of the `book.txt` file. We can also go as far as extracting this file
    using our favorite archive extractor to confirm that it contains the original
    file.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `compress` task provides us with several options that allow us to archive
    a collection of files, specify the compression mode, and specify the archive compression
    level.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: Archiving a collection of files
  id: totrans-66
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In our main recipe, we compressed a single file on its own, but it's possibly
    more common to archive a collection of files into one single file. In order to
    do this, we alter our `src` configuration to specify the files that should be
    archived, remove the `dest` configuration, and then provide a filename for our
    archive file using the `archive` option.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: The following steps continues from the work we did earlier in this recipe, through
    to archiving and compressing a collection of files into a single file.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: First, we'll add some more files that we'd like to have archived and compressed.
    Let's change the name of our previously downloaded book from `book.txt` to `austen.txt`
    and download a couple more, renaming them as `wells.txt` and `thoreau.txt`.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Tip
  id: totrans-70
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The two sample books mentioned can be downloaded from the following URLs in
    the same order they were mentioned:'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[http://www.gutenberg.org/cache/epub/36/pg36.txt](http://www.gutenberg.org/cache/epub/36/pg36.txt)'
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[http://www.gutenberg.org/files/205/205-0.txt](http://www.gutenberg.org/files/205/205-0.txt)'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now, we can change our `compress` task''s configuration from just compressing
    the file named `book.txt` to including all three downloaded books in an archive
    file named `books.zip`. We do this by changing its configuration to the following:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Let''s try it out by running the `grunt compress` command, which should provide
    us with output similar to the following:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: We should now see the `books.zip` archive in our project directory. To confirm
    that it contains all the files we specified, you can use your favorite archiving
    tool to explore or extract it.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Specifying the compression mode
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: By default, the `compress` task will determine the compression mode to use in
    its operations by looking at the extension of the file name specified in `archive`
    option. This behavior can be altered by indicating the compression mode using
    the `mode` option.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`compress`任务将根据在`archive`选项中指定的文件名的扩展名来确定其操作中使用的压缩模式。可以通过使用`mode`选项来改变这种行为。
- en: 'The following example will make use of the `zip` mode despite the extension
    of the filename specified in the `archive` option being `tgz`:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例将使用`zip`模式，尽管在`archive`选项中指定的文件扩展名是`tgz`：
- en: '[PRE12]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Tip
  id: totrans-83
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: At the time of publication, the compression modes supported for the `mode` option
    were `gzip`, `deflate`, `deflateRaw`, `tar`, `tgz`, and `zip`.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在出版时，`mode`选项支持的压缩模式有`gzip`、`deflate`、`deflateRaw`、`tar`、`tgz`和`zip`。
- en: Specifying the archive compression level
  id: totrans-85
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 指定存档压缩级别
- en: In case we'd like to specify a compression rate when using either the `zip`
    or `gzip` compression modes, we can do so using the `level` option. This option
    is set to `1` by default, but can be set to any integer up to `9`, the latter
    indicating better compression at the cost of slower performance.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想在使用`zip`或`gzip`压缩模式时指定压缩率，我们可以使用`level`选项来做到这一点。该选项默认设置为`1`，但可以设置为从`1`到`9`的任何整数，后者表示更好的压缩效果，但性能会稍慢。
- en: 'The following configuration will compress our books to level `9`, which takes
    a little longer, but decreases the size of the produced archive by about 10 percent:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 以下配置将把我们的书籍压缩到`9`级，这会花费一点时间，但可以将生成的存档大小减少大约10%：
- en: '[PRE13]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Creating symbolic links
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建符号链接
- en: Creating references to files and directories can be quite useful in various
    circumstances, most notably when we'd like to distribute duplicates of a file
    and keep them up to date without having to manually copy them after each change.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在各种情况下创建文件和目录的引用可能非常有用，尤其是在我们想要分发文件的副本并保持它们更新，而无需在每次更改后手动复制它们时。
- en: The functionality of creating symbolic links is provided to us by the `contrib-symlink`
    `(0.3.0)` plugin. It's a very simple plugin but provides all the standard Grunt
    configuration options.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '`contrib-symlink` `(0.3.0)`插件为我们提供了创建符号链接的功能。这是一个非常简单的插件，但它提供了所有标准的Grunt配置选项。'
- en: Getting ready
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们将使用在[第1章](part0015.xhtml#aid-E9OE1 "第1章. 使用Grunt入门")中“在项目中安装Grunt”配方中创建的基本项目结构，即*使用Grunt入门*。如果你还不熟悉其内容，请务必参考。
- en: How to do it...
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following steps will take us through creating a symbolic link to a file
    named `assets/img/logo.png` inside the `www/img` directory.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导我们创建指向`www/img`目录内名为`assets/img/logo.png`的文件的符号链接。
- en: We'll start by installing the package that contains the `contrib-symlink` plugin
    as per the instructions provided in the *Installing a plugin* recipe in [Chapter
    1](part0015.xhtml#aid-E9OE1 "Chapter 1. Getting Started with Grunt"), *Getting
    Started with Grunt*.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将按照[第1章](part0015.xhtml#aid-E9OE1 "第1章. 使用Grunt入门")中“安装插件”配方中的说明来安装包含`contrib-symlink`插件的包。
- en: 'Then, we can add the following configuration, which will create the symbolic
    link in the `img/www` directory:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，我们可以添加以下配置，它将在`img/www`目录中创建符号链接：
- en: '[PRE14]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To try it out, we can run the `grunt symlink` command, which should inform
    us of the creation of the symbolic link with output similar to the following:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要尝试它，我们可以运行`grunt symlink`命令，它应该会通知我们符号链接的创建，输出类似于以下内容：
- en: '[PRE15]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: If you now take a look inside the `www/img` directory, you should see a symbolic
    link called `logo.png`, which points to the `assets/img/logo.png` file. You can
    perhaps also try to change the contents of the image to see them reflected in
    the symbolic link.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你现在查看`www/img`目录，你应该会看到一个名为`logo.png`的符号链接，它指向`assets/img/logo.png`文件。也许你还可以尝试更改图片的内容，以查看它们在符号链接中的反映。
- en: Concatenating files
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 文件连接
- en: The practice of concatenating files is quite often found in the routines of
    all kinds of developers. Be it combining fragmented log files or many smaller
    source files into one big code base, joining files end-to-end comes in handy on
    a regular basis.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 将文件连接起来的实践在所有类型的开发者中都很常见。无论是将分散的日志文件或许多较小的源文件合并到一个大的代码库中，文件端到端连接在日常工作中非常有用。
- en: Concatenation functionality can be provided to us by the `contrib-concat` `(0.4.0)`
    plugin. Along with the standard Grunt configurations, it also provides a large
    set of options to tailor its behavior according to our unique requirements.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 连接功能可以通过`contrib-concat` `(0.4.0)`插件提供。除了标准的Grunt配置外，它还提供了一组选项，以便根据我们的独特需求定制其行为。
- en: Getting ready
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备中
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，我们将使用我们在[第1章](part0015.xhtml#aid-E9OE1 "第1章. 使用Grunt入门")中“在项目中安装Grunt”配方中创建的基本项目结构。如果您还不熟悉其内容，请务必参考它。
- en: How to do it...
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following steps will take us through concatenating three JavaScript source
    files into one combined source file, so that we only have to serve one source
    file along with our web application.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导我们将三个JavaScript源文件连接到一个组合源文件中，这样我们只需要与我们的Web应用程序一起提供单个源文件。
- en: We'll start by installing the package that contains the `contrib-concat` plugin
    as per the instructions provided in the *Installing a plugin* recipe in [Chapter
    1](part0015.xhtml#aid-E9OE1 "Chapter 1. Getting Started with Grunt"), *Getting
    Started with Grunt*.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将按照[第1章](part0015.xhtml#aid-E9OE1 "第1章. 使用Grunt入门")中“安装插件”配方提供的说明，安装包含`contrib-concat`插件的包，该配方位于*使用Grunt入门*。
- en: 'For our example, we''ll also require three JavaScript source files. Let''s
    call them `one.js`, `two.js`, and `three.js`, and provide them each with the following
    contents, only replacing `<filename>` with their names:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于我们的示例，我们还需要三个JavaScript源文件。让我们称它们为`one.js`、`two.js`和`three.js`，并为每个文件提供以下内容，只需将`<filename>`替换为它们的名称：
- en: '[PRE16]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Now, we can add the following configuration for the `concat` task, which will
    combine our three sample files into the `all.js` file:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以为`concat`任务添加以下配置，该配置将把我们的三个样本文件合并到`all.js`文件中：
- en: '[PRE17]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'To try out our task, we can run the `grunt concat` command, which will produce
    output similar to the following:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要尝试我们的任务，我们可以运行`grunt concat`命令，这将产生类似于以下内容的输出：
- en: '[PRE18]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We can now take a look at the `all.js` file that was created, which will contain
    the following code:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以查看创建的`all.js`文件，其中将包含以下代码：
- en: '[PRE19]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: There's more...
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The `concat` task provides us with several options that allow us to join the
    files with a custom separator, strip banners before concatenation, add a banner
    and footer to the concatenated result, and process the source file's contents
    before concatenation.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '`concat`任务为我们提供了几个选项，允许我们使用自定义分隔符连接文件，在连接之前去除横幅，向连接结果添加横幅和页脚，以及在连接之前处理源文件的内容。'
- en: Joining files with a custom separator
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用自定义分隔符连接文件
- en: It's usually preferable to have a prominent separator between the joined files
    so that it's easier to distinguish between them, in case we need to review the
    contents of the concatenated result.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，在连接的文件之间有一个明显的分隔符会更受欢迎，这样在需要审查连接结果的内容时更容易区分它们。
- en: 'By default, the `concat` task will just separate joined files with a linefeed
    character, but a custom separator can be provided using the `separator` option
    as per the following example:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，`concat`任务将仅使用换行符分隔连接的文件，但可以通过`separator`选项提供自定义分隔符，如下例所示：
- en: '[PRE20]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Running the task with the preceding example code should produce a `all.js`
    file with contents similar to the following:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的示例代码运行任务应该会产生一个内容类似于以下内容的`all.js`文件：
- en: '[PRE21]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Stripping banners before concatenation
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在连接之前去除横幅
- en: The need to remove banners from JavaScript source files before joining them
    is quite common since they usually take up quite a bit of extra storage space,
    and as every web developer knows, every bit counts.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在连接之前从JavaScript源文件中去除横幅的需求相当常见，因为它们通常占用相当多的额外存储空间，而且正如每个Web开发者都知道的，每一比特都很重要。
- en: 'To automatically strip banners from JavaScript source files, we can make use
    of the `stripBanners` option as per the following example:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 要自动从JavaScript源文件中删除横幅，我们可以按照以下示例使用 `stripBanners` 选项：
- en: '[PRE22]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Adding a banner and footer to the concatenated result
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 向合并结果添加横幅和页脚
- en: 'Once the concatenated result is generated, it can often be useful to add a
    banner or footer that provides some extra information. The following example does
    just that by making use of the `banner` and `footer` options:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦生成了合并的结果，添加一个横幅或页脚以提供一些额外信息通常很有用。以下示例正是通过使用 `banner` 和 `footer` 选项来做到这一点的：
- en: '[PRE23]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Running the task with the preceding example code should produce an `all.js`
    file with contents similar to the following:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的示例代码运行任务应该会生成一个包含以下内容的 `all.js` 文件：
- en: '[PRE24]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Processing the source file's contents before concatenation
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在合并之前处理源文件的内容
- en: In case we'd like to alter the contents of the files we're joining, the `concat`
    task provides the option of doing so with code, before concatenating them. This
    can be done by providing a function to the `process` option, which receives the
    file content, modifies it, and returns it.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想修改合并的文件内容，`concat` 任务提供了在合并之前使用代码进行修改的选项。这可以通过向 `process` 选项提供一个函数来实现，该函数接收文件内容，修改它，并返回它。
- en: 'The following example makes use of this functionality to create a banner above
    each joined file that indicates its filename:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例利用此功能在合并的每个文件上方创建一个横幅，指示其文件名：
- en: '[PRE25]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Running the task with the preceding example code should produce an `all.js`
    file with contents similar to the following:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 使用前面的示例代码运行任务应该会生成一个包含以下内容的 `all.js` 文件：
- en: '[PRE26]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Fetching a single URL
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取单个URL
- en: If you're working on web-based projects, you'll probably want to download something
    at some point. Downloading a file is quite a simple operation, but automating
    it can save you a significant amount of time in the long run.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在处理基于Web的项目，您可能需要在某个时候下载一些内容。下载文件是一个相当简单的操作，但自动化它可以从长远来看为您节省大量时间。
- en: We'll make use of the relatively popular `curl` `(2.0.2)` plugin to download
    a resource from the Internet. The `curl` task is provided by this plugin to download
    single files.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用相对流行的 `curl` `(2.0.2)` 插件从互联网下载资源。该插件提供了 `curl` 任务以下载单个文件。
- en: Getting ready
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们将使用我们在 [第1章](part0015.xhtml#aid-E9OE1 "第1章。使用Grunt入门") 中创建的基本项目结构，即 *在项目中安装Grunt*
    菜谱，*使用Grunt入门*。如果您还不熟悉其内容，请务必参考。
- en: How to do it...
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following steps will take us through using the **OpenWeatherMap API** to
    download the current weather for the city of London and saving it to the `london.json`
    file.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导我们使用 **OpenWeatherMap API** 下载伦敦市的当前天气并将其保存到 `london.json` 文件中。
- en: We'll start by installing the package that contains the `curl` plugin as per
    the instructions provided in the *Installing a plugin* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将按照 *安装插件* 菜谱中提供的说明安装包含 `curl` 插件的包，该菜谱位于 [第1章](part0015.xhtml#aid-E9OE1 "第1章。使用Grunt入门")，*使用Grunt入门*。
- en: 'Now, we can add the following configuration to download London''s current weather
    information to the `london.json` file:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以添加以下配置以将伦敦当前的天气信息下载到 `london.json` 文件中：
- en: '[PRE27]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'To test our setup, we can run the `grunt curl` command, which should provide
    us with output similar to the following:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了测试我们的设置，我们可以运行 `grunt curl` 命令，它应该会提供类似于以下输出的结果：
- en: '[PRE28]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: If we now take a look at the project directory, we should see the downloaded
    weather information saved to the `london.json` file.
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们现在查看项目目录，我们应该看到下载的天气信息已保存到 `london.json` 文件中。
- en: There's more...
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: If we need more flexibility in our requests to download content, the `curl`
    task allows us to do so using the `request` HTTP client utility provided by the
    `request` package. The same options that can be used for the `request` utility
    can be provided in the `src` configuration.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们需要在下载内容时获得更多灵活性，`curl` 任务允许我们使用 `request` 包提供的 `request` HTTP 客户端实用工具来实现。可以在
    `src` 配置中提供用于 `request` 实用工具的相同选项。
- en: Tip
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: 'You can read more about the `request` HTTP client utility at the following
    URL:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在以下网址了解更多关于 `request` HTTP 客户端实用程序的信息：
- en: '[https://github.com/mikeal/request](https://github.com/mikeal/request)'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://github.com/mikeal/request](https://github.com/mikeal/request)'
- en: 'The following example uses this functionality to provide an object for the
    query string of the request, instead of having it included in the URL string:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例使用此功能为请求的查询字符串提供一个对象，而不是将其包含在 URL 字符串中：
- en: '[PRE29]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Fetching multiple URLs
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 获取多个 URL
- en: If you're automating resource downloads for your project, you'll probably want
    to download more than one resource to the same directory, and probably from the
    same site.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在为你的项目自动化资源下载，你可能希望将多个资源下载到同一个目录中，并且很可能是从同一个网站下载。
- en: We'll make use of the relatively popular `curl` `(2.0.2)` plugin to download
    multiple resources from the Internet. It provides the `curl-dir` task specifically
    to download multiple resources.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用相对流行的 `curl` `(2.0.2)` 插件从互联网下载多个资源。它提供了一个专门的 `curl-dir` 任务来下载多个资源。
- en: Getting ready
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: In this example, we'll work with the basic project structure we created in the
    *Installing Grunt on a project* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*. Be sure
    to refer to it if you are not yet familiar with its contents.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们将使用我们在 [第 1 章](part0015.xhtml#aid-E9OE1 "第 1 章. 使用 Grunt 开始") 中 *在项目中安装
    Grunt* 菜单创建的基本项目结构。如果你还不熟悉其内容，请务必参考它。
- en: How to do it...
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: The following steps take us through downloading both the Grunt and Node.js logos
    into the `logos` directory.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将指导我们将 Grunt 和 Node.js 的标志都下载到 `logos` 目录中。
- en: We'll start by installing the package that contains the `curl` plugin as per
    the instructions provided in the *Installing a plugin* recipe in [Chapter 1](part0015.xhtml#aid-E9OE1
    "Chapter 1. Getting Started with Grunt"), *Getting Started with Grunt*.
  id: totrans-168
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将按照 [第 1 章](part0015.xhtml#aid-E9OE1 "第 1 章. 使用 Grunt 开始") 中 *安装插件* 菜单提供的说明来安装包含
    `curl` 插件的包，*使用 Grunt 开始*。
- en: 'Now, we can add the following `curl-dir` task configuration, which will download
    the two logos into the `logos` directory:'
  id: totrans-169
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，我们可以添加以下 `curl-dir` 任务配置，它将下载两个标志到 `logos` 目录中：
- en: '[PRE30]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'To test the task, we can run it using the `grunt curl-dir` command, which should
    provide output similar to the following:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要测试任务，我们可以使用 `grunt curl-dir` 命令来运行它，它应该提供类似于以下输出的结果：
- en: '[PRE31]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: We should now have a directory called `logos` in our project path that contains
    both the Grunt and Node.js logos.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们应该在项目路径中有一个名为 `logos` 的目录，其中包含 Grunt 和 Node.js 的标志。
- en: There's more...
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: The `curl-dir` task provides us with several options that allow us to download
    similar URLs, save downloaded files to altered filenames, and download files using
    special request options.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '`curl-dir` 任务为我们提供了几个选项，允许我们下载类似的 URL，将下载的文件保存到修改后的文件名中，并使用特殊请求选项下载文件。'
- en: Downloading similar URLs
  id: totrans-176
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 下载类似的 URL
- en: It's also quite common that we might want to download multiple URLs that are
    very similar. In this case, we can make use of the brace expansion support provided
    by the `curl-dir` task.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，我们可能想要下载多个非常相似的 URL。在这种情况下，我们可以利用 `curl-dir` 任务提供的花括号扩展支持。
- en: 'The following configuration example illustrates how we would go about downloading
    the weather information for London, Paris, and Tokyo, without having to repeat
    the start of each URL:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 以下配置示例说明了我们如何下载伦敦、巴黎和东京的天气信息，而无需重复每个 URL 的起始部分：
- en: '[PRE32]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Saving downloaded files to altered filenames
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将下载的文件保存到修改后的文件名中
- en: It is also quite common to save downloaded resources to filenames other than
    the ones contained in their URLs. The `router` configuration provided by the `curl-dir`
    task allows us to specify a function that receives the URL we downloaded and return
    the filename that the resource should be saved to.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 保存下载的资源到不同于其 URL 中包含的文件名也是相当常见的。`curl-dir` 任务提供的 `router` 配置允许我们指定一个函数，该函数接收我们下载的
    URL 并返回资源应该保存到的文件名。
- en: 'The following configuration example illustrates how we can download weather
    information for three cities and save each of the results to a file with only
    the city name and the `.json` file extension:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 以下配置示例说明了我们如何下载三个城市的天气信息，并将每个结果保存到仅包含城市名称和 `.json` 文件扩展名的文件中：
- en: '[PRE33]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Downloading files using special request options
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用特殊请求选项下载文件
- en: If we need more flexibility in our requests to download content, the `curl-dir`
    task allows us to do so using the `request` HTTP client utility provided by the
    `request` package. The same options that can be used for the `request` utility
    can be provided in the `src` configuration.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们需要在下载内容请求中增加更多的灵活性，`curl-dir`任务允许我们通过使用`request`包提供的`request` HTTP客户端工具来实现这一点。可以为`request`工具提供的相同选项在`src`配置中也可以提供。
- en: 'The following configuration example makes use of this functionality by providing
    the query parameters as objects rather than strings that are appended to the URLs,
    and also demonstrates using the `router` configuration discussed earlier for this
    type of setup:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 以下配置示例通过将查询参数作为对象而不是附加到URL的字符串来利用此功能，同时也展示了如何使用之前讨论过的`router`配置来设置此类环境：
- en: '[PRE34]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
