<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;Socket.IO Quick Reference"><div class="titlepage"><div><div><h1 class="title"><a id="appA"/>Appendix A. Socket.IO Quick Reference</h1></div></div></div><p>In this appendix we will take a look at the APIs provided by socket.io. The intention is to have a cursory glance through all the APIs so we know if there is a function that can help us while we are working. <a id="id209" class="indexterm"/>Socket.io is under active development and the APIs themselves are subject to change. Although the documented methods may not change, there are always new functions and features being added to socket.io. So always check with the socket.io website and wiki for the availability of a function that does what you want.</p><div class="section" title="The server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec52"/>The server</h1></div></div></div><p>As we already know<a id="id210" class="indexterm"/> by now, socket.io provides libraries to be used both in the server and the client. Let's first see the APIs provided for the server.</p><div class="section" title="Instantiating socket"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec25"/>Instantiating socket</h2></div></div></div><p>The <code class="literal">socket.io</code> module is instantiated, just like any other node module, by using <code class="literal">require</code> to import the module:<a id="id211" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">var io = require('socket.io');</pre></div></div><div class="section" title="Starting Socket.IO"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec26"/>Starting Socket.IO</h2></div></div></div><p>The socket.io server <a id="id212" class="indexterm"/>component is started by using the <code class="literal">listen</code> method, which attaches the socket.io to the node HTTP server:</p><div class="informalexample"><pre class="programlisting">var sio = io.listen(&lt;server&gt;)</pre></div><p>Here, <code class="literal">server</code> is the instance of the node HTTP server.</p></div><div class="section" title="Listening to events"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec27"/>Listening to events</h2></div></div></div><p>The event handlers<a id="id213" class="indexterm"/> are attached to socket using the <code class="literal">on</code> method. The <code class="literal">on</code> method takes the event name and the callback/handler function as parameters:</p><div class="informalexample"><pre class="programlisting">sio.on(&lt;event&gt;, function(eventData){
  //DO SOMETHING
});</pre></div><p>Here, <code class="literal">event</code> is the name of the event and <code class="literal">eventData</code> represents the event-specific data passed to the handler when it is invoked.</p></div><div class="section" title="Emitting an event"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec28"/>Emitting an event</h2></div></div></div><p>We use the <code class="literal">emit</code> method to trigger an event. This event will be handled on the client:</p><div class="informalexample"><pre class="programlisting">socket.emit(&lt;event&gt;, &lt;event_data&gt;, ack_callback);</pre></div><p>Here, <code class="literal">event</code>
<a id="id214" class="indexterm"/> is the name of the event to trigger, <code class="literal">event_data</code> is the event data as a JSON object, and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the event on the client.</p></div><div class="section" title="Sending a message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec29"/>Sending a message</h2></div></div></div><p>The <code class="literal">send</code> method is <a id="id215" class="indexterm"/>used to send a message to the client:</p><div class="informalexample"><pre class="programlisting">socket.send(&lt;message&gt;, ack_callback);</pre></div><p>Where <code class="literal">message</code> is the message that will be sent to the client and<code class="literal"> ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the client.</p></div><div class="section" title="Sending a JSON message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec30"/>Sending a JSON message</h2></div></div></div><p>A<a id="id216" class="indexterm"/> JSON message can be sent by using the <code class="literal">json</code> flag before the <code class="literal">send</code> method:</p><div class="informalexample"><pre class="programlisting">socket.json.send(&lt;message&gt;, ack_callback);</pre></div><p>Here, <code class="literal">message</code> is the message that will be sent to the client and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the client.</p></div><div class="section" title="Broadcasting a message/event"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec31"/>Broadcasting a message/event</h2></div></div></div><p>A message or an event can be broadcasted to all the connected sockets using the <code class="literal">broadcast</code> flag:<a id="id217" class="indexterm"/>
<a id="id218" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">socket.broadcast.emit(&lt;event&gt;, &lt;event_data&gt;);</pre></div><p>Here, <code class="literal">event</code> is the name of event to emit and <code class="literal">event_data</code> is the JSON data that will be sent with the event. The following line of code shows how to broadcast a message:</p><div class="informalexample"><pre class="programlisting">socket.broadcast.send(&lt;message&gt;);</pre></div><p>Here, <code class="literal">message</code> is the message that will be sent to the client and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the client.</p></div><div class="section" title="Sending a volatile message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec32"/>Sending a volatile message</h2></div></div></div><p>Sometimes<a id="id219" class="indexterm"/> the message being sent is not important and can be ignored if not delivered. So these methods need not be queued or attempted to be redelivered. This is done with the <code class="literal">volatile</code> flag:</p><div class="informalexample"><pre class="programlisting">socket.volatile.send(&lt;message&gt;);</pre></div><p>Here, <code class="literal">message</code> is the message that will be sent to the client and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the client.</p></div><div class="section" title="Storing socket data"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec33"/>Storing socket data</h2></div></div></div><p>We can<a id="id220" class="indexterm"/> call the <code class="literal">set</code> method<a id="id221" class="indexterm"/> on the socket to store some data on the socket. This is an asynchronous method call and takes a key, value, and a callback function:</p><div class="informalexample"><pre class="programlisting">socket.set(&lt;key&gt;, &lt;value&gt;, function(){
  //DO SOMETHING
});</pre></div><p>Here, <code class="literal">key</code> is the key name for this data and <code class="literal">value</code> is the value to store.</p></div><div class="section" title="Getting the socket data"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec34"/>Getting the socket data</h2></div></div></div><p>We use the <code class="literal">get</code> method<a id="id222" class="indexterm"/> to fetch<a id="id223" class="indexterm"/> the value stored on a socket. This is an asynchronous method and takes a key and a callback function, which will get the value:</p><div class="informalexample"><pre class="programlisting">socket.get(&lt;key&gt;, function(value){
  //DO SOMETHING
});</pre></div><p>Here, <code class="literal">key</code> is the key of the data to fetch and <code class="literal">value</code> is the value if stored with the socket. This will be <code class="literal">null</code> if the value is not stored.<a id="id224" class="indexterm"/>
</p></div><div class="section" title="Restricting to a namespace"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec35"/>Restricting to a namespace</h2></div></div></div><p>We can multiplex the socket <a id="id225" class="indexterm"/>and restrict messages/events to a namespace by using the <code class="literal">of</code> method. This method returns a socket, which can be used as any other socket, but the messages will be restricted to only the clients connected to this namespace:</p><div class="informalexample"><pre class="programlisting">var namespace_socket = socket.of(&lt;namespace&gt;);</pre></div><p>Here, <code class="literal">namespace</code> is the namespace we want to restrict the socket to.</p></div><div class="section" title="Joining a room"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec36"/>Joining a room</h2></div></div></div><p>We use the <code class="literal">join</code> method<a id="id226" class="indexterm"/> of <code class="literal">socket</code> to join a room.<a id="id227" class="indexterm"/> It will create a new room if one doesn't already exist:</p><div class="informalexample"><pre class="programlisting">socket.join(&lt;room&gt;);</pre></div><p>Here, <code class="literal">room</code> is the name of the room to join.</p></div><div class="section" title="Broadcasting messages/events in a room"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec37"/>Broadcasting messages/events in a room</h2></div></div></div><p>We can send messages to all the <a id="id228" class="indexterm"/>
<a id="id229" class="indexterm"/>connected clients in the room by using the <code class="literal">in</code> flag with <code class="literal">broadcast</code>:</p><div class="informalexample"><pre class="programlisting">socket.broadcast.in(&lt;room&gt;).send(&lt;message&gt;);
socket.broadcast.in(&lt;room&gt;).emit(&lt;event&gt;, &lt;event_data&gt;);</pre></div><p>Here, <code class="literal">room</code> is the room to send the message in, <code class="literal">message</code> is the message to send, <code class="literal">event</code> is the event to emit, and <code class="literal">event_data</code> is the data to be sent with the event.</p></div><div class="section" title="Leaving a room"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec38"/>Leaving a room</h2></div></div></div><p>The <code class="literal">leave</code> method is used to <a id="id230" class="indexterm"/>leave a room. We don't need to do this explicitly if the socket is exiting. Also, an empty room will automatically be destroyed:</p><div class="informalexample"><pre class="programlisting">socket.leave(&lt;room&gt;);</pre></div><p>Here, <code class="literal">room</code> is the room to exit from.</p></div><div class="section" title="Changing the configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec39"/>Changing the configuration</h2></div></div></div><p>Socket.io is <a id="id231" class="indexterm"/>configured using the <code class="literal">set</code> method in the <code class="literal">configure</code> method's callback handler:</p><div class="informalexample"><pre class="programlisting">io.configure('environment', function () {
  io.set(&lt;property&gt;, &lt;value&gt;);
});</pre></div><p>Here, <code class="literal">environment</code> is the optional environment in which this configuration will be used, <code class="literal">property</code> is the property to be set, and <code class="literal">value</code> is the value for the property.</p></div></div></div>
<div class="section" title="Server events"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec53"/>Server events</h1></div></div></div><a id="id232" class="indexterm"/><p>We will discuss some server-related events in this section.</p><div class="section" title="connection"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec40"/>connection</h2></div></div></div><p>This event<a id="id233" class="indexterm"/> is fired when an initial connection with a client is established:</p><div class="informalexample"><pre class="programlisting">io.sockets.on('connection', function(socket) {})</pre></div><p>Here, <code class="literal">socket</code> is used in further communication with the client.</p></div><div class="section" title="message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec41"/>message</h2></div></div></div><p>The <code class="literal">message</code> event is<a id="id234" class="indexterm"/> emitted when a message sent with <code class="literal">socket.send</code> is received:</p><div class="informalexample"><pre class="programlisting">socket.on('message', function(&lt;message&gt;, &lt;ack_callback&gt;) {})</pre></div><p>Here, <code class="literal">message</code> is the message sent and <code class="literal">ack_callback</code> is an optional acknowledgment function.</p></div><div class="section" title="disconnect"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec42"/>disconnect</h2></div></div></div><p>This event is fired <a id="id235" class="indexterm"/>when the socket disconnects:</p><div class="informalexample"><pre class="programlisting">socket.on('disconnect', function() {})</pre></div></div></div>
<div class="section" title="The client"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec54"/>The client</h1></div></div></div><a id="id236" class="indexterm"/><p>In this section we will get to know the client APIs.</p><div class="section" title="Connecting to a socket"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec43"/>Connecting to a socket</h2></div></div></div><p>We connect to a socket<a id="id237" class="indexterm"/> using the <code class="literal">connect</code> method<a id="id238" class="indexterm"/> on the <code class="literal">io</code> object in the client:</p><div class="informalexample"><pre class="programlisting">var socket = io.connect(&lt;uri&gt;);</pre></div><p>Here, <code class="literal">uri</code> is the server URI to connect to. It can be absolute or relative. If it is other than <code class="literal">/</code>, or an absolute equivalent of that, it will connect to the namespace.</p></div><div class="section" title="Listening to events"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec44"/>Listening to events</h2></div></div></div><p>We can attach event handlers to a socket using the <code class="literal">on</code> method:</p><div class="informalexample"><pre class="programlisting">socket.on(&lt;event&gt;, function(event_data, ack_callback){});</pre></div><p>Here, <code class="literal">event</code> is the event<a id="id239" class="indexterm"/> to listen for, <code class="literal">event_data</code> is the data for the event, and <code class="literal">ack_callback</code> is the optional callback method to call to acknowledge the receipt of the event.</p></div><div class="section" title="Emitting an event"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec45"/>Emitting an event</h2></div></div></div><p>We use the <code class="literal">emit</code> method<a id="id240" class="indexterm"/> <a id="id241" class="indexterm"/>to trigger an event. This event will be handled on the server:</p><div class="informalexample"><pre class="programlisting">socket.on(&lt;event&gt;, &lt;event_data&gt;, ack_callback);</pre></div><p>Here, <code class="literal">event</code> is the name of the event to trigger, <code class="literal">event_data</code> is the event data as a JSON object, and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the server.</p></div><div class="section" title="Sending a message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec46"/>Sending a message</h2></div></div></div><p>The <code class="literal">send</code> method<a id="id242" class="indexterm"/> is<a id="id243" class="indexterm"/> used to send a message to the server:</p><div class="informalexample"><pre class="programlisting">socket.send(&lt;message&gt;, ack_callback);</pre></div><p>Here, <code class="literal">message</code> is the message that will be sent to the server and <code class="literal">ack_callback</code> is the optional callback function that is invoked on the successful receipt of the message on the server.</p></div></div>
<div class="section" title="Client events"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec55"/>Client events</h1></div></div></div><a id="id244" class="indexterm"/><p>In this section we will get to know some client-side events.</p><div class="section" title="connect"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec47"/>connect</h2></div></div></div><p>The <code class="literal">connect</code> event<a id="id245" class="indexterm"/> is emitted <a id="id246" class="indexterm"/>when the socket is connected successfully:</p><div class="informalexample"><pre class="programlisting">socket.on('connect', function () {})</pre></div></div><div class="section" title="connecting"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec48"/>connecting</h2></div></div></div><p>The <code class="literal">connecting</code> event<a id="id247" class="indexterm"/> is emitted <a id="id248" class="indexterm"/>when the socket is attempting to connect with the server:</p><div class="informalexample"><pre class="programlisting">socket.on('connecting', function () {})</pre></div></div><div class="section" title="disconnect"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec49"/>disconnect</h2></div></div></div><p>The <code class="literal">disconnect</code> event<a id="id249" class="indexterm"/> is emitted <a id="id250" class="indexterm"/>when the socket is disconnected:</p><div class="informalexample"><pre class="programlisting">socket.on('disconnect', function () {})</pre></div></div><div class="section" title="connect_failed"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec50"/>connect_failed</h2></div></div></div><p>The <code class="literal">connect_failed</code> event<a id="id251" class="indexterm"/> is emitted <a id="id252" class="indexterm"/>when socket.io fails to establish a connection to the server for reasons such as when none of the transports work or authorization failed:</p><div class="informalexample"><pre class="programlisting">socket.on('connect_failed', function () {})</pre></div></div><div class="section" title="error"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec51"/>error</h2></div></div></div><p>The <code class="literal">error</code> event<a id="id253" class="indexterm"/> is emitted <a id="id254" class="indexterm"/>when an error occurs and it cannot be handled by the other event types:</p><div class="informalexample"><pre class="programlisting">socket.on('error', function () {})</pre></div></div><div class="section" title="message"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>message</h2></div></div></div><p>The <code class="literal">message</code> event<a id="id255" class="indexterm"/> is <a id="id256" class="indexterm"/>emitted when a message sent with <code class="literal">socket.send</code> is received:</p><div class="informalexample"><pre class="programlisting">socket.on('message', function (&lt;message&gt;, &lt;ack_callback&gt;) {})</pre></div><p>Here, <code class="literal">message</code> is the sent message and <code class="literal">ack_callback</code> is an optional acknowledgment function.</p></div><div class="section" title="reconnect"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec53"/>reconnect</h2></div></div></div><p>The <code class="literal">reconnect</code> event<a id="id257" class="indexterm"/> is emitted when <a id="id258" class="indexterm"/>socket.io successfully reconnects to the server:</p><div class="informalexample"><pre class="programlisting">socket.on('reconnect', function () {})</pre></div></div><div class="section" title="reconnecting"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec54"/>reconnecting</h2></div></div></div><p>The <code class="literal">reconnecting</code> event<a id="id259" class="indexterm"/> is <a id="id260" class="indexterm"/>emitted when the socket is attempting to reconnect with the server:</p><div class="informalexample"><pre class="programlisting">socket.on('reconnecting', function () {})</pre></div></div><div class="section" title="reconnect_failed"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec55"/>reconnect_failed</h2></div></div></div><p>The <code class="literal">reconnect_failed</code> event<a id="id261" class="indexterm"/>
<a id="id262" class="indexterm"/> is emitted when socket.io fails to reestablish a working connection after the connection was dropped:</p><div class="informalexample"><pre class="programlisting">socket.on('reconnect_failed', function () {})</pre></div></div></div></body></html>