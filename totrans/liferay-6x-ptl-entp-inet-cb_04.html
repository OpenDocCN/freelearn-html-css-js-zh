<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Liferay Site Configuration" id="aid-1394Q1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Liferay Site Configuration</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Creating an organization and a standalone site</li><li class="listitem">Site configuration</li><li class="listitem">Creating and customizing private and public pages for the site</li><li class="listitem">Using page templates and site templates for quick site and page creation</li><li class="listitem">Enabling local live staging</li><li class="listitem">Enabling remote live staging</li><li class="listitem">Enabling page versioning</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Introduction</h1></div></div></div><p>In the previous chapter, we described how to model an organizational structure in the intranet using organizations and user groups. We also discussed their attributes, such as address, phone numbers, websites, services, and so on. There is one attribute that makes organizations and user groups a very important component of Liferay Portal CMS. This attribute is site. A site<a id="id187" class="indexterm"/> is set of pages that may contain applications and content. Users gathered within an organization or user group can have their site, which stores and presents information that is produced and published by its users (files, articles, calendar events, bookmarks, and so on). There are also sites that are not connected to any structured collection of users. In this chapter, we will discuss how to create, customize and manage sites.</p></div></div>
<div class="section" title="Creating an organization and a standalone site"><div class="titlepage" id="aid-147LC2"><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Creating an organization and a standalone site</h1></div></div></div><p>Each organization <a id="id188" class="indexterm"/>and user group can have a site, which consists of a <a id="id189" class="indexterm"/>group of public and private pages organized into a tree-like structure. Public pages are pages accessible by anyone who has a link to the site. Private pages are pages that can only be accessed by logged-in users, who are members of the organization, user group, or standalone site. It is also possible to create a standalone site that is not assigned to any organization or user group. Standalone sites can additionally form a structure of sites, similar to the organization structure described in the previous chapter (for example, there can be a top-level site that has subsites). Organization sites are often created to store and present content and provide tools for users from a <a id="id190" class="indexterm"/>specific department or localization of the company. User <a id="id191" class="indexterm"/>group sites group information and tools used by people sharing common interests or people who are a part of the same project team. Standalone sites or site structures are used to provide a site or group of sites outside the organizational structure and are common for members of different user groups.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec85"/>How to do it…</h2></div></div></div><p>In this recipe, we will show you how to create an organization site and a standalone site. User group sites are created while setting up a user group. Unlike the organization, it is not possible to create a user group without the site.</p><p>In order to create a site for an existing organization, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Users</strong></span>| <span class="strong"><strong>Users and Organizations</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button located near the name of the organization you want to modify.</li><li class="listitem">Choose the <span class="strong"><strong>Edit</strong></span> option.</li><li class="listitem">Click on the <span class="strong"><strong>Organization Site</strong></span> link in the right menu.</li><li class="listitem">Check the <span class="strong"><strong>Create Site</strong></span> checkbox:<div class="mediaobject"><img src="../Images/image00314.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div><p>In order<a id="id192" class="indexterm"/> to <a id="id193" class="indexterm"/>create a standalone site, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Choose the <span class="strong"><strong>Blank Site</strong></span> option.<div class="mediaobject"><img src="../Images/image00315.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide<a id="id194" class="indexterm"/> the <span class="strong"><strong>Name (Required)</strong></span> and <span class="strong"><strong>Description</strong></span> for the site.</li><li class="listitem">Enable<a id="id195" class="indexterm"/> the <span class="strong"><strong>Active</strong></span> option.</li><li class="listitem">Choose the <span class="strong"><strong>Membership Type</strong></span>.</li><li class="listitem">Enable the <span class="strong"><strong>Allow Manual Membership Management</strong></span> option.</li><li class="listitem">Choose the parent site.</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div><p>Once the site has been created, it is possible to add pages, place and configure portlets on them, and present content. However, it is not possible to enter the site before the first page is added. For more information on adding pages to the site, refer to the <span class="emphasis"><em>Creating and customizing private and public pages for the site</em></span> recipe. To enter the site after adding the first page, execute these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button next to the particular site name.</li><li class="listitem">Click on the <span class="strong"><strong>Site Administration</strong></span> action.</li><li class="listitem">Go to the <span class="strong"><strong>Pages</strong></span> | <span class="strong"><strong>Site Pages</strong></span> section.</li><li class="listitem">Choose the set of pages you want to enter by clicking on the <span class="strong"><strong>Public Pages</strong></span> or <span class="strong"><strong>Private Pages</strong></span> tab.</li><li class="listitem">Click on<a id="id196" class="indexterm"/> the <span class="strong"><strong>Public Pages</strong></span> or <span class="strong"><strong>Private Pages</strong></span> link (depending on the tab chosen in step 5).</li><li class="listitem">Click <a id="id197" class="indexterm"/>on the <span class="strong"><strong>View pages</strong></span> link.</li></ol><div style="height:10px; width: 1px"/></div><p>You can also enter the site by typing the URL. The default URL addresses are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">http://localhost:8080/web/site-name</code> for public pages</li><li class="listitem"><code class="literal">http://localhost:8080/group/site-name</code> for private pages</li></ul></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec86"/>How it works…</h2></div></div></div><p>In the first part of the recipe, we created an organization site. The second part of the recipe describes how to add a standalone site. Both the organization and standalone sites we created are empty and require us to add and configure pages and portlets. All the organization and standalone sites can be accessed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</p><div class="section" title="Active and inactive sites"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec25"/>Active and inactive sites</h3></div></div></div><p>Each site<a id="id198" class="indexterm"/> can be set as active or inactive. The active site is accessible for<a id="id199" class="indexterm"/> users. An inactive site cannot be entered by users, but it is <a id="id200" class="indexterm"/>still<a id="id201" class="indexterm"/> available and can be activated any time. The activation option can be used when we want to switch the site off temporarily or when we need to turn it off permanently while keeping all the content as an archive.</p></div><div class="section" title="Public and private pages and their membership type"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec26"/>Public and private pages and their membership type</h3></div></div></div><p>Each organization, user group, or standalone site consists of public and private pages, which are <a id="id202" class="indexterm"/>organized in two separate trees. Public pages are pages accessible<a id="id203" class="indexterm"/> by anyone who has a link to the site. In Liferay, these<a id="id204" class="indexterm"/> users are called <a id="id205" class="indexterm"/>guests. Private pages are pages that <a id="id206" class="indexterm"/>can<a id="id207" class="indexterm"/> only be accessed by<a id="id208" class="indexterm"/> logged-in users, who are members of the organization, user group, or standalone site. Users can become members of organizations, user groups, or standalone sites when they are assigned to them by an administrator or they join by themselves using the My Sites portlet. The My Sites portlet is one of the many applications available for administrators to place on a site's pages. Its main purpose is to show the sites of which the user is a member and list other sites that the user can join or request membership to.</p><p>The way a user becomes a member of the site is defined by the type of membership; the parameter can be specified while adding a new site.</p><p>There are three types of membership:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Open</strong></span>: This <a id="id209" class="indexterm"/>allows any user to join and leave the site. The open sites are shown in the My Sites portlet.</li><li class="listitem"><span class="strong"><strong>Restricted</strong></span>: In this<a id="id210" class="indexterm"/> type of membership, the administrator or the owner manages the user's membership of the site. Although users do not have the ability to join the site, they can request membership and leave it by themselves. What is important is whether their membership can be granted by the administrator. The restricted sites are also listed in the My Sites portlet.<p>If users want to join to the site, they can request membership. When a user sends a request or when an administrator approves the request, the system sends an e-mail message. It is possible to define the templates of notification in <code class="literal">portal-ext.properties</code>:</p><div class="informalexample"><pre class="programlisting">sites.email.from.name=
sites.email.from.address=

sites.email.membership.reply.subject=com/liferay/portlet/sites/dependencies/email_membership_reply_subject.tmpl
sites.email.membership.reply.body=com/liferay/portlet/sites/dependencies/email_membership_reply_body.tmpl

sites.email.membership.request.subject=com/liferay/portlet/sites/dependencies/email_membership_request_subject.tmpl
sites.email.membership.request.body=com/liferay/portlet/sites/dependencies/email_membership_request_body.tmpl </pre></div></li><li class="listitem"><span class="strong"><strong>Private</strong></span>: Denies users the chance to join, request membership from, or leave the site. Users must be assigned to the site manually by its administrator. The <a id="id211" class="indexterm"/>private site does not appear in the My Sites portlet.<p>The membership type is strictly connected to the <span class="strong"><strong>Allow Manual Membership Management</strong></span> option, which determines whether users can be manually added to and removed from the site by its administrators. If the option is enabled (except manual membership management), it<a id="id212" class="indexterm"/> also allows users to join open sites or request membership to restricted sites using the My Sites portlet. By default, the option is enabled for standalone sites and disabled for organization sites, where the users section of site administration is not available.</p></li></ul></div></div><div class="section" title="Creating an empty site versus creating a site using site templates"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec27"/>Creating an empty site versus creating a site using site templates</h3></div></div></div><p>When a new site is created, the tree of pages is empty. It is worth noting that when an empty site is created (as described in this recipe), it is not possible to enter the site before adding its first <a id="id213" class="indexterm"/>page. What's more, newly created sites are by default set as<a id="id214" class="indexterm"/> active, which means that users can immediately access them. However, it is possible to create a preconfigured set of public and/or private pages using site templates, which consist of preconfigured sites that can consist of pages, portlets, and content. You can find more about templates in the <span class="emphasis"><em>Using page templates and site templates for quick site and page creation</em></span> recipe.</p></div><div class="section" title="Technical view"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec28"/>Technical view</h3></div></div></div><p>From the technical point of view, a site is a group of layouts. In the database, each site is stored in the <code class="literal">Group_</code> table. Understanding this concept may be difficult. However, it is one of the <a id="id215" class="indexterm"/>most important functionalities in Liferay.</p><p>Liferay allows the administrator to run many portal instances on the same server. In the basic installation, it is called Liferay.com. Remember that portal instances keep their data separately from every portal instance (in the same database or in a different database).</p><p>Each portal instance can aggregate many groups: organizations, user groups, teams, users, and sites. All of these settings have a different <code class="literal">groupId</code>, but all of them are stored in the same table called <code class="literal">Group_</code>. Moreover, layouts (pages) can be created from templates (page templates or/and sites templates). Furthermore, users can have their private and public pages. This information is stored in the <code class="literal">Group_</code> table too. To sum up, <code class="literal">Group_</code> contains the following settings:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Group (site)</li><li class="listitem">Organization</li><li class="listitem">User group</li><li class="listitem">User</li><li class="listitem">Team</li><li class="listitem">Layout prototype</li><li class="listitem">Layout set prototype</li></ul></div><p>To distinguish<a id="id216" class="indexterm"/> these records in the <code class="literal">Group_</code> table, there are two columns:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">classNameId</code> contains the ID of the <code class="literal">className</code> (names of classes are stored in the <code class="literal">ClassName_</code>) table</li><li class="listitem"><code class="literal">classPK</code> is the primary key of the specific class, for instance, user, team, or just group</li></ul></div><p>Every site can have only private pages or only public pages, or both. Public pages are accessible to anyone, especially users who aren't logged in. Private pages are only accessible to the users who belong to the organization where this site is. Each of them is a set of the pages (layouts) that define the default theme, language, logo, and so on. Liferay contains this information in the <code class="literal">LayoutSet</code> table. These settings are the default settings of each layout. For example, if a layout does not define a theme, this setting comes from <code class="literal">LayoutSet</code>.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec87"/>There's more…</h2></div></div></div><p>It is also possible to manage the site using actions available in the site actions menu.</p><p>There are<a id="id217" class="indexterm"/> several possible actions that can be performed on a site:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Site Administration</strong></span> action redirects the user to the site settings section in <span class="strong"><strong>Control Panel</strong></span> and allows them to manage an organization's public and private sites</li><li class="listitem">The <span class="strong"><strong>Add Child Site</strong></span> action allows us to create a subsite</li><li class="listitem">The <span class="strong"><strong>View Child Sites</strong></span> action allows us to browse the list of child sites</li><li class="listitem">The <span class="strong"><strong>Go to Public Pages</strong></span> action opens the site's public pages in a new window</li><li class="listitem">The <span class="strong"><strong>Go to Private Pages</strong></span> action opens the site's private pages in a new window</li><li class="listitem">The <span class="strong"><strong>Activate</strong></span> action allows us to activate the site</li><li class="listitem">The <span class="strong"><strong>Deactivate</strong></span> action allows us to deactivate the site</li><li class="listitem">The <span class="strong"><strong>Delete</strong></span> action allows us to delete a site</li><li class="listitem">The <span class="strong"><strong>Leave</strong></span> action allows users to leave the site. This option is available only if the user is a member of the site</li></ul></div><p>In order to perform one of the actions listed earlier, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on <a id="id218" class="indexterm"/>the <span class="strong"><strong>Actions</strong></span> button, located near the name of the site you want to modify.<div class="mediaobject"><img src="../Images/image00316.jpeg" alt="There's more…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the name of the chosen action.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec88"/>See also</h2></div></div></div><p>You may also refer to the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For information on creating organizations and user groups, refer to the <span class="emphasis"><em>Managing an organization structure</em></span> and <span class="emphasis"><em>Creating a new user group</em></span> recipes from <a class="link" title="Chapter 3. Working with a Liferay User / User Group / Organization" href="part0030.xhtml#aid-SJGS1">Chapter 3</a>, <span class="emphasis"><em>Working with a Liferay User / User Group / Organization</em></span></li><li class="listitem">For information on customizing the site and adding pages to it, refer to the the <span class="emphasis"><em>Site configuration</em></span> and <span class="emphasis"><em>Creating and customizing private and public pages for the site</em></span> recipes</li><li class="listitem">For more information on creating sites, refer to the <span class="emphasis"><em>Using page templates and site templates for quick site and page creation</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Site configuration"><div class="titlepage" id="aid-1565U2"><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Site configuration</h1></div></div></div><p>When a site is created, it is possible to configure each site parameter, but the range of possible options <a id="id219" class="indexterm"/>is determined by the origin of the site (whether it is an organization, users group, or a standalone site). After creating an organization site, the link to the <span class="strong"><strong>Site Settings</strong></span> section will appear on the organization menu and its actions menu. All the new organizations and standalone sites are also visible on the list that you can see by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>. The user group pages are not included in this list, but can be accessed from the actions menu of the particular user group by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>User Group</strong></span>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec89"/>Getting ready</h2></div></div></div><p>To step through this recipe, you have to create a site first (for more information on how to create a site, refer to the <span class="emphasis"><em>Creating an organization and a standalone site</em></span> recipe).</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec90"/>How to do it…</h2></div></div></div><p>In this recipe, we will show you how to set parameters of an organization site and a standalone site.</p><p>In order to configure a site of an organization, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Users and Organizations</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, located near the name of the organization, for which you want to configure the site.</li><li class="listitem">Choose the <span class="strong"><strong>Manage Site</strong></span> option.</li><li class="listitem">Fill in the <span class="strong"><strong>Details</strong></span>, <span class="strong"><strong>Search Engine Optimization</strong></span>, <span class="strong"><strong>Advanced</strong></span>, and <span class="strong"><strong>Miscellaneous</strong></span> fields.<div class="mediaobject"><img src="../Images/image00317.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div><p>In order to <a id="id220" class="indexterm"/>configure a standalone site, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, located near the name of the site.</li><li class="listitem">Choose the <span class="strong"><strong>Site Administration</strong></span> option.</li><li class="listitem">Go to the <span class="strong"><strong>Configuration</strong></span> section.</li><li class="listitem">Fill in the <span class="strong"><strong>Details</strong></span>, <span class="strong"><strong>Search Engine Optimization</strong></span>, <span class="strong"><strong>Advanced</strong></span> and <span class="strong"><strong>Miscellaneous</strong></span> fields.</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec91"/>How it works…</h2></div></div></div><p>All the <a id="id221" class="indexterm"/>available parameters are divided into the following groups:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Basic information</strong></span> group, which contains the following sections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Details</strong></span> section contains a set of options that allow changing the Name, Description, Membership Options, create Public and Private pages, choose Parent Site or activate and deactivate the site</li><li class="listitem">The <span class="strong"><strong>Categorization</strong></span> section, which provides tags and categories that can be assigned to a site</li><li class="listitem">The <span class="strong"><strong>Site URL</strong></span> section, which allows the user to enter the friendly URL that will be used by both public and private pages</li><li class="listitem">The <span class="strong"><strong>Site Template</strong></span> section, which shows the names of templates used to create public and private pages and their basic settings</li></ul></div></li><li class="listitem"><span class="strong"><strong>Search Engine Optimization</strong></span>, which consists of the following sections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Sitemap</strong></span> section, which allows the user to send sitemap information to preview</li><li class="listitem">The <span class="strong"><strong>Robots</strong></span> section, which allows us to set robot parameters for public and private pages</li></ul></div></li><li class="listitem"><span class="strong"><strong>Advanced</strong></span>, which consists of the following sections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Default User Associations</strong></span> section, which allows us to define the default site roles and teams that should be assigned to the site's users</li><li class="listitem">The <span class="strong"><strong>Staging</strong></span> section, which allows us to enable the staging functionality</li><li class="listitem">The <span class="strong"><strong>Analytics</strong></span> section, which allows the user to define the Google Analytics ID or Piwik script that will be used for this set of pages</li><li class="listitem">The <span class="strong"><strong>Content Sharing</strong></span> section, which allows us to decide whether subsites can display content from this site</li><li class="listitem">The <span class="strong"><strong>Recycle Bin</strong></span> section, which allows the user to enable the recycle bin functionality and also move entries in trash; the trash automatically deletes the stored content after the indicated number of days</li></ul></div></li><li class="listitem"><span class="strong"><strong>Miscellaneous</strong></span>, which contains the following sections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Custom Fields</strong></span> section, which provides a tool to manage values of custom attributes defined for the site.</li><li class="listitem">The <span class="strong"><strong>Display Settings</strong></span> section, which allows the user to set the language of the site. It is possible to use the default language option or define a custom default language and additional available languages for this site.</li></ul></div></li></ul></div><p>Each section<a id="id222" class="indexterm"/> can be customized in <code class="literal">portal-ext.properties</code> by setting the following properties:</p><div class="informalexample"><pre class="programlisting">sites.form.add.main=details,categorization
sites.form.add.seo=
sites.form.add.advanced=
sites.form.add.miscellaneous=

sites.form.update.main=details,categorization,site-url,site-template
sites.form.update.seo=sitemap,robots
sites.form.update.advanced=default-user-associations,staging,analytics,content-sharing,recycle-bin
sites.form.update.miscellaneous=custom-fields,display-settings</pre></div><p>Another interesting feature is sharing content between sites (from parent to children). It can be set by the <code class="literal">sites.content.sharing.with.children.enabled</code> property. Here are the possible values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>0</strong></span> disables the sharing of content with subsites for all sites</li><li class="listitem"><span class="strong"><strong>1</strong></span> disables the sharing of content by default while allowing site administrators to enable it per site</li><li class="listitem"><span class="strong"><strong>2</strong></span> enables the sharing of content by default while allowing site administrators to disable it per site</li></ul></div><p>The next setting corresponds to the earlier one. The administrator can be a member of many sites. It is possible to allow or deny content sharing across the sites that an administrator manages. To enable or disable this feature, set the following property:</p><div class="informalexample"><pre class="programlisting">sites.content.sharing.through.administrators.enabled=true</pre></div><p>The last property settings correspond to the site map. Every site map can be refreshed by particular units of time (always, hourly, daily, weekly, monthly, yearly or newer). In the site map, pages can have a default priority (ranging between 0.0 to 1.0). Set the following properties to order these settings:</p><div class="informalexample"><pre class="programlisting">sites.sitemap.default.change.frequency=daily

sites.sitemap.default.priority=</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec92"/>See also</h2></div></div></div><p>For more<a id="id223" class="indexterm"/> information on creating sites, refer to the <span class="emphasis"><em>Creating an organization and a standalone site</em></span> and <span class="emphasis"><em>Using page templates and site templates for quick site and page creation</em></span> recipes.</p></div></div>
<div class="section" title="Creating and customizing private and public pages for the site"><div class="titlepage" id="aid-164MG2"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Creating and customizing private and public pages for the site</h1></div></div></div><p>As was mentioned <a id="id224" class="indexterm"/>earlier, there are two groups of pages within a site: public <a id="id225" class="indexterm"/>pages and private pages. Each page in a group is a part <a id="id226" class="indexterm"/>of a separate tree-like structure, reflecting levels in the <a id="id227" class="indexterm"/>website's information architecture. Pages in a tree can differ, depending <a id="id228" class="indexterm"/>on their purpose and origin. The page could be <a id="id229" class="indexterm"/>just a place where the information arranged in portlets is shown. It can provide a range of tools for users who manage the content of the website. It is also possible to add a page that is the link to another page of the same or a separate site. In addition, pages can be created as empty pages, copies of already existing ones, or can be based on defined templates.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec93"/>Getting ready</h2></div></div></div><p>To step through this recipe, you have to create a site first (for more information how to create a site, refer to the <span class="emphasis"><em>Creating an organization and a standalone site</em></span> recipe).</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec94"/>How to do it…</h2></div></div></div><p>The following recipe will illustrate how to create pages and arrange their structure.</p><p>In order to create public pages, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, located near the name of the site.</li><li class="listitem">Choose the <span class="strong"><strong>Site Administration</strong></span> option.</li><li class="listitem">Click on the <span class="strong"><strong>Site Pages</strong></span> link in the <span class="strong"><strong>Pages</strong></span> section of the left menu.</li><li class="listitem">Make sure you are in the <span class="strong"><strong>Public Pages</strong></span> tab.</li><li class="listitem">Click on the <span class="strong"><strong>Add Page</strong></span> button (indicated by <span class="strong"><strong>+</strong></span> icon).<div class="mediaobject"><img src="../Images/image00318.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide<a id="id230" class="indexterm"/> the name of the page (in our example, it is <a id="id231" class="indexterm"/><span class="strong"><strong>Home</strong></span>).</li><li class="listitem">Enable<a id="id232" class="indexterm"/> the <span class="strong"><strong>Hide from Navigation Menu</strong></span> option.</li><li class="listitem">Choose <a id="id233" class="indexterm"/>the <span class="strong"><strong>Empty Page</strong></span> type.</li><li class="listitem">Choose the page layout.</li><li class="listitem">Click on the <span class="strong"><strong>Add Page</strong></span> button.</li><li class="listitem">Click on the newly added page's name on the <span class="strong"><strong>Public Pages</strong></span> tree.</li><li class="listitem">Click on the <span class="strong"><strong>Add Child Page</strong></span> button.</li><li class="listitem">Provide the name of the page (for instance, News).</li><li class="listitem">Disable the <span class="strong"><strong>Hide from Navigation Menu</strong></span> option.</li><li class="listitem">Choose the <span class="strong"><strong>Empty page</strong></span> type.</li><li class="listitem">Choose the page layout.</li><li class="listitem">Click on the <span class="strong"><strong>Add Page</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec95"/>How it works…</h2></div></div></div><p>As shown in the previous recipe, the creation of a page is a very simple action that requires<a id="id234" class="indexterm"/> us to provide some basic information, such as:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <a id="id235" class="indexterm"/><span class="strong"><strong>Name</strong></span>, which identifies the page. The name will be <a id="id236" class="indexterm"/>shown in all the portlets listing pages <a id="id237" class="indexterm"/>and (if the page title is not set) will be used as a page HTML title.</li><li class="listitem">The layout of the page determines whether it should consist of one, two, or other combinations of columns.</li><li class="listitem">The <span class="strong"><strong>Hide from Navigation Menu</strong></span> option allows us to manage the visibility of the page. If the option is enabled, the page is not visible in the navigation menu, navigation portlet, site map portlet, and so on.</li><li class="listitem">The <span class="strong"><strong>Type</strong></span> option allows the user to choose the type of newly created page. There are the following types of pages:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Empty Page</strong></span>: An empty page will be added</li><li class="listitem"><span class="strong"><strong>Panel</strong></span>: This allows us to create a page with predefined applications and navigation</li><li class="listitem"><span class="strong"><strong>Embedded page</strong></span>: This presents content from another website</li><li class="listitem"><span class="strong"><strong>Link to URL</strong></span>: This is a link to another website</li><li class="listitem"><span class="strong"><strong>Link to a Page of This Site</strong></span>: This is a link to another page within the current site</li><li class="listitem"><span class="strong"><strong>Copy of a Page of This Site</strong></span>: This is a copy an existing page from this site</li></ul></div><p>There is also a list of page templates that can be used.</p></li></ul></div><p>It is worth noting that as was shown in a previous example, the level of the page is determined by the page that is chosen and marked before we click on the <span class="strong"><strong>Add Child Page</strong></span> button. If we want to create a top-level page, the public pages or (private pages) branch must be selected. What's more, it is also possible to manage the localization of the page within a tree by simply dragging and dropping pages on different tree levels.</p><p>There are many others parameters that influence the page's appearance and behavior. These parameters can be managed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span> | <span class="strong"><strong>Pages</strong></span> | <span class="strong"><strong>Site Pages</strong></span>.</p><div class="section" title="Page parameters"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec29"/>Page parameters</h3></div></div></div><p>Page customization options (available after clicking on the page name link on the appropriate <a id="id238" class="indexterm"/>tab by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span> | <span class="strong"><strong>Pages</strong></span> | <span class="strong"><strong>Site Pages</strong></span>) are divided into the following sections:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Details</strong></span> sections, which allows us to change the parameters set while adding the page, such as <span class="strong"><strong>Name</strong></span>, <span class="strong"><strong>Type</strong></span>, <span class="strong"><strong>Friendly URL</strong></span>, <span class="strong"><strong>Layout of the page</strong></span>, for example <span class="strong"><strong>1 Column</strong></span>, <span class="strong"><strong>2 Columns (50/50)</strong></span>, <span class="strong"><strong>2 Columns (30/70)</strong></span> and so on, and decide whether to hide the page from the navigation menu.</li><li class="listitem">The <span class="strong"><strong>SEO</strong></span> section, which allows us to provide information that helps to optimize the page for search engines, such as HTML title, meta tags, and description, keywords, robot information, and sitemap options.</li><li class="listitem">The <span class="strong"><strong>Look and Feel</strong></span> section, which allows us to decide what look and feel should be used for the site. It is possible to use the same look and feel configuration as that of the whole tree (<span class="strong"><strong>Use the same look and feel of the public pages</strong></span> option) or customize it by choosing the <span class="strong"><strong>Define a specific look and feel for this page</strong></span> option.</li><li class="listitem">The <span class="strong"><strong>JavaScript</strong></span> section, which allows us to define JavaScript code that will be executed at the bottom of the page.</li><li class="listitem">The <span class="strong"><strong>Custom Fields</strong></span> section, which provides a tool to manage the values of custom attributes defined for the page.</li><li class="listitem">The <span class="strong"><strong>Advanced</strong></span> section, which allows us to set the target and icon for the page that appears in the navigation menu.</li><li class="listitem">The <span class="strong"><strong>Mobile Device Rules</strong></span> section, which allows us to decide whether to use the mobile device rules of the public pages or define specific mobile device rules for this page.</li><li class="listitem">The <span class="strong"><strong>Customization Settings</strong></span> section, which allows us to decide which sections of the page will be customizable for users having required permissions.</li></ul></div></div><div class="section" title="Whole-tree parameters"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec30"/>Whole-tree parameters</h3></div></div></div><p>There are also <a id="id239" class="indexterm"/>some parameters that can be set for the whole tree of pages (available after clicking on the public pages or private pages link on the corresponding tab by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span> | <span class="strong"><strong>Pages</strong></span> | <span class="strong"><strong>Site Pages</strong></span>). These parameters are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Look and Feel</strong></span> section, which allows us to choose the graphical theme, bullet styles, and color schemes for this group of pages; decide whether portlet borders should be visible by default; or insert custom CSS to be loaded after the theme</li><li class="listitem">The <span class="strong"><strong>Logo</strong></span> section, which allows us to set the logo of this particular tree of pages and decide whether the name of the site should be shown</li><li class="listitem">The <span class="strong"><strong>JavaScript</strong></span> section, which allows us to define JavaScript code that will be executed at the bottom of the page</li><li class="listitem">The <span class="strong"><strong>Advanced</strong></span> section, which allows us to merge the public pages of our portal's <a id="id240" class="indexterm"/>default site with the public pages of the current site</li><li class="listitem">The <span class="strong"><strong>Mobile Device Rules</strong></span> section, which allows the user to define groups of devices and corresponding rules</li></ul></div></div><div class="section" title="Technical view"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec31"/>Technical view</h3></div></div></div><p>Layouts are<a id="id241" class="indexterm"/> stored in the <code class="literal">Layout</code> table. This table has the following columns:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">plid</code>: Unique identified</li><li class="listitem">Audit fields (<code class="literal">groupId</code>, <code class="literal">companyId</code>, <code class="literal">userId</code>, <code class="literal">userName</code>, <code class="literal">createDate</code>, <code class="literal">modifiedDate</code>)</li><li class="listitem"><code class="literal">name</code>: Layout name</li><li class="listitem"><code class="literal">type_</code>: One of the values—<code class="literal">portlet</code>, <code class="literal">panel</code>, <code class="literal">embedded</code>, <code class="literal">url</code>, <code class="literal">link_to_layout</code></li><li class="listitem"><code class="literal">friendlyURL</code>: Friendly URL to the specific layout</li><li class="listitem"><code class="literal">typeSettings</code>: Aggregate layout settings</li><li class="listitem">Any other columns that are not important to understand this recipe</li></ul></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec96"/>There's more…</h2></div></div></div><p>It is also possible to manage the page using available actions.</p><p>There are <a id="id242" class="indexterm"/>several possible actions that can be performed on a site page:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="strong"><strong>Permissions</strong></span> action allows us to set permissions for the site page</li><li class="listitem">The <span class="strong"><strong>Copy Applications</strong></span> action is used to copy all the portlets (and their configurations) from another page</li><li class="listitem">The <span class="strong"><strong>Go to Private Pages</strong></span> action opens the site's private pages in a new window</li><li class="listitem">The <span class="strong"><strong>Delete</strong></span> action allows us to delete a page</li></ul></div><p>In order to perform one of the actions listed earlier, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, located near the name of the site whose page you want to modify.</li><li class="listitem">Click <a id="id243" class="indexterm"/>on the <span class="strong"><strong>Site Administration</strong></span> option.</li><li class="listitem">Select the page to modify.<div class="mediaobject"><img src="../Images/image00319.jpeg" alt="There's more…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the name of the chosen action.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Using page templates and site templates for quick site and page creation"><div class="titlepage" id="aid-173722"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Using page templates and site templates for quick site and page creation</h1></div></div></div><p>In some cases, selected groups or even all sites within the intranet should contain the same set of pages, including the same set of portlets. This model can be employed, for example, when <a id="id244" class="indexterm"/>sites are used as department websites or <a id="id245" class="indexterm"/>project spaces. Liferay provides a very effective tool that allows us to create whole preconfigured sites or pages from templates prepared earlier. It is also possible to enable the connection between the template and the site, which will ensure live propagation of changes.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec97"/>How to do it…</h2></div></div></div><p>In this recipe, we will show you how to create a standalone site using site templates and how to create a single page from the page template.</p><p>In order to create a standalone site using a site template, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Sites</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Choose the template you want to use from the drop-down list (for example, <span class="strong"><strong>Community Site</strong></span>).<div class="mediaobject"><img src="../Images/image00320.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide <a id="id246" class="indexterm"/>the <span class="strong"><strong>Name (Required)</strong></span> and <span class="strong"><strong>Description</strong></span> for the site.</li><li class="listitem">Make <a id="id247" class="indexterm"/>sure the <span class="strong"><strong>Active</strong></span> option is enabled.</li><li class="listitem">Choose <span class="strong"><strong>Membership Type</strong></span>.</li><li class="listitem">Enable or disable the <span class="strong"><strong>Allow Manual Membership Management</strong></span> option.</li><li class="listitem">Choose the <span class="strong"><strong>Copy As</strong></span> | <span class="strong"><strong>Public Pages</strong></span> option.</li><li class="listitem">Set the <span class="strong"><strong>Enable propagation of changes from the site template</strong></span> option.</li><li class="listitem">Choose <span class="strong"><strong>Parent Site</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div><p>In order to create a page using a page template, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, located near the name of the site.</li><li class="listitem">Choose<a id="id248" class="indexterm"/> the <span class="strong"><strong>Site administration</strong></span> option.</li><li class="listitem">Click <a id="id249" class="indexterm"/>on the <span class="strong"><strong>Site pages</strong></span> section.</li><li class="listitem">Click on the <span class="strong"><strong>Public Pages</strong></span> tab.</li><li class="listitem">Click on the <span class="strong"><strong>Add Page</strong></span> button:<div class="mediaobject"><img src="../Images/image00321.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide the <span class="strong"><strong>Name</strong></span> of the page (for example, <span class="strong"><strong>Blog</strong></span>).</li><li class="listitem">Enable the <span class="strong"><strong>Hide from Navigation Menu</strong></span> option.</li><li class="listitem">Choose the <span class="strong"><strong>Blog</strong></span> page type of the page.</li><li class="listitem">Click on the <span class="strong"><strong>Add Page</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec98"/>How it works…</h2></div></div></div><p>There are two types of templates: <span class="strong"><strong>Page Templates</strong></span> and <span class="strong"><strong>Site Templates</strong></span>.</p><p>The <a id="id250" class="indexterm"/>page template is a base for creating single <a id="id251" class="indexterm"/>pages and can be chosen when creating a new page. It can be configured by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Page Templates</strong></span>. A page template stores not only page configurations, but also portlets with their configuration and, in some cases, content.</p><p>The site template is used for creating whole sites and can be managed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Control Panel</strong></span> | <span class="strong"><strong>Site Templates</strong></span>. The list of templates is available when creating a standalone site, user group, or organization site. The site template may contain a group of pages with their configurations, portlets, and content.</p><div class="section" title="Propagation of changes"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec32"/>Propagation of changes</h3></div></div></div><p>When creating a site form template, it is important to decide whether the propagation of changes<a id="id252" class="indexterm"/> from the site template should be enabled or not. When the propagation is enabled, the changes made in the template are automatically applied to sites connected to it.</p><p>It is also worth noting that templates may allow site administrators to modify sites based on a template. When the template allows modifications (the <span class="strong"><strong>Enable propagation of changes from the site template</strong></span> option is enabled) each modification of the pages of a site (site configuration and configuration of portlets) causes disconnection from the template. When template modifications are not allowed, administrators of sites cannot change the configuration of pages and their portlets.</p></div><div class="section" title="Technical view"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec33"/>Technical view</h3></div></div></div><p>Site templates<a id="id253" class="indexterm"/> and page templates are stored in the <code class="literal">LayoutSetPrototype</code> and <code class="literal">LayoutPrototype</code> tables. <code class="literal">LayoutSetPrototype</code> contains default information<a id="id254" class="indexterm"/> about layouts that belong to a specific Layout Set. As mentioned earlier, site templates define a set of pages that can be copied after creating the new site.</p><p>A page template <a id="id255" class="indexterm"/>is a page created to be copied in other pages. The <code class="literal">LayoutPrototype</code> table stores all the required information about the page prototype.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec99"/>See also</h2></div></div></div><p>For information on creating new empty sites, refer to the <span class="emphasis"><em>Creating an organization and a standalone site</em></span> recipe.</p></div></div>
<div class="section" title="Enabling local live staging" id="aid-181NK1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Enabling local live staging</h1></div></div></div><p>Staging<a id="id256" class="indexterm"/> is a powerful tool that allows users to change, deploy, and test a new site's configuration before it goes into production. In other words, it provides a testing <a id="id257" class="indexterm"/>environment that is visible only to administrators. Users can stage their work; this means they have the ability to work on the working copy of the website.</p><p>Liferay provides the site administrator with the possibility to use local live staging and remote live staging. When we are talking about local live staging, the staging site and live site are in the same Liferay instance and on the same server. Remote live staging provides the possibility to configure and test changes in a different host (which is invisible in the production environment) and deploy changes to the production environment.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec100"/>How to do it…</h2></div></div></div><p>To enable local live staging, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Site Settings</strong></span>.</li><li class="listitem">Choose the <span class="strong"><strong>Staging</strong></span> tab in the <span class="strong"><strong>Advanced</strong></span> section.<div class="note" title="Note"><h3 class="title"><a id="tip08"/>Tip</h3><p>Staging cannot be used for sites where propagation of changes from the site template is enabled.</p></div></li><li class="listitem">Select the <span class="strong"><strong>Local Live</strong></span> option.</li><li class="listitem">Decide if page versioning is necessary.</li><li class="listitem">Select portlets that should be staged. Liferay defines the following rule:<div class="note" title="Note"><h3 class="title"><a id="note15"/>Note</h3><p>When a portlet is checked, its data will be copied to staging and it may not be possible to edit it directly in live. When unchecking a portlet, make sure that any changes done in staging are published first; otherwise, they might be lost.</p></div></li><li class="listitem">After saving this configuration, there should be two additional buttons on the site dockbar: <span class="strong"><strong>Staging</strong></span> and <span class="strong"><strong>Live</strong></span>.<div class="mediaobject"><img src="../Images/image00322.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec101"/>How it works…</h2></div></div></div><p>Staging is a powerful functionality that gives users a tested area. After enabling staging, the portal <a id="id258" class="indexterm"/>gives users two areas:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Live</strong></span>: Which gives a real-world view</li><li class="listitem"><span class="strong"><strong>Staging</strong></span>: Which gives an area to test and configure a specific layout or portlet</li></ul></div><p>Live view is a real view that is presented to all users who have access to the page. The staging view is a technical area where a user can change settings without life view influence. If an administrator is ready to submit and publish changes, they do it by clicking on the <span class="strong"><strong>Publish to Live</strong></span> button.</p><p>Technically, it is a simple mechanism. Liferay creates a new group, which <span class="emphasis"><em>friendlyURL</em></span> value has suffix <span class="emphasis"><em>-staging</em></span> (for instance, <span class="emphasis"><em>/guest-staging</em></span>) This group contains its layouts, portlet preferences, content, and so on.</p><p>After enabling staging, Liferay invokes a background process, which copies layouts, portlet preferences, and specific content to the staging group (with a new <code class="literal">groupId</code>).</p><div class="note" title="Note"><h3 class="title"><a id="note16"/>Note</h3><p>This process can be quite long, so Liferay gives the following information:</p><p>
<span class="strong"><strong>An initial staging publication is in progress. The status of the publication can be checked on the publish screen.</strong></span>
</p></div><p>Additionally, Liferay stores information about staging in the <code class="literal">Group_.typeSettings</code> column:</p><div class="informalexample"><pre class="programlisting">staged-portlet_{NUMBER}=true
stagedRemotely=false
staged=true</pre></div><p>After enabling staging, Liferay duplicates a lot of data in the database. If you have a large amount of data, be careful and track database performance.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec102"/>See also</h2></div></div></div><p>If you want to configure remote live staging, refer to the next recipe. For information on how to enable page versioning, refer to the <span class="emphasis"><em>Enabling page versioning</em></span> recipe</p></div></div>
<div class="section" title="Enabling remote live staging" id="aid-190861"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Enabling remote live staging</h1></div></div></div><p>Liferay provides<a id="id259" class="indexterm"/> remote live staging for separate testing areas and production environments. In the local server, we can configure and test a new layout or a whole site after publish event changes are propagated into the production environment. To achieve this, both servers have to know about themselves.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec103"/>How to do it…</h2></div></div></div><p>Let's assume that the local server for the test environment is called <code class="literal">STAGING_SERVER</code> and the server machine for the production environment is <code class="literal">PRODUCTION_SERVER</code>.</p><p>To properly configure remote live staging, go through following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">On the local server (<code class="literal">STAGING_SERVER</code>) in <code class="literal">portal-ext.properties</code>, set the following properties:<div class="informalexample"><pre class="programlisting">tunnel.servlet.hosts.allowed=127.0.0.1,PRODUCTION_SERVER_IP
axis.servlet.hosts.allowed=127.0.0.1, PRODUCTION_SERVER_IP
tunneling.servlet.shared.secret=SHARED_SECRET
auth.verifier.TunnelingServletAuthVerifier.hosts.allowed=</pre></div></li><li class="listitem">On the remote server (<code class="literal">PRODUCTION_SERVER</code>) in <code class="literal">portal-ext.properties</code>, set the following properties:<div class="informalexample"><pre class="programlisting">tunnel.servlet.hosts.allowed=127.0.0.1,LOCAL_SERVER_IP
axis.servlet.hosts.allowed=127.0.0.1, LOCAL_SERVER_IP
tunneling.servlet.shared.secret=SHARED_SECRET
auth.verifier.TunnelingServletAuthVerifier.hosts.allowed=</pre></div><div class="note" title="Note"><h3 class="title"><a id="note17"/>Note</h3><p>Make sure that the <code class="literal">SHARED_SECRET</code> phrase has 16, 32, or 64 characters.</p></div></li><li class="listitem">Restart both servers.</li><li class="listitem">On the local (<code class="literal">STAGING_SERVER</code>) server, go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Configuration</strong></span> and open the <span class="strong"><strong>Staging</strong></span> tab from the right menu.</li><li class="listitem">Choose the <span class="strong"><strong>Remote Live</strong></span> radio button.</li><li class="listitem">Fill in the following inputs on the form:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Remote Host/IP</strong></span>: IP address of <code class="literal">PRODUCTION_SERVER</code></li><li class="listitem"><span class="strong"><strong>Remote Port</strong></span>: Port number of <code class="literal">PRODUCTION_SERVER</code></li><li class="listitem"><span class="strong"><strong>Remote Path Context</strong></span>: Context name of Liferay instance (if it is the root (<code class="literal">/</code>) context, leave blank)</li><li class="listitem"><span class="strong"><strong>Remote Site ID</strong></span>: A site identifier (<code class="literal">groupId</code>) of the site that our configuration will install. If the site doesn't exist, create it.<div class="note" title="Note"><h3 class="title"><a id="tip09"/>Tip</h3><p>The <code class="literal">groupId</code> number can be found by going to <span class="strong"><strong>Site</strong></span> | <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Site Settings</strong></span> | <span class="strong"><strong>Site ID</strong></span>.</p></div></li></ul></div></li><li class="listitem">Click on<a id="id260" class="indexterm"/> the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">After successful configuration in the dockbar area, we should have the following view:<div class="mediaobject"><img src="../Images/image00323.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec104"/>How it works…</h2></div></div></div><p>Remote staging is a more difficult process than the local one. Liferay Portal uses two out-of-the-box mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Export layouts to the LAR file on a local server and import it on a remote server</li><li class="listitem">Transfer file by soap API using the <code class="literal">StagingServiceHttp</code> class</li></ul></div><p>Properties that we set in <code class="literal">portal-ext.properties</code> allow us to invoke the portal API by an external client. In order to allow it, we set <code class="literal">PRODUCTION_SERVER_IP</code> and <code class="literal">LOCAL_SERVER_IP</code>. There is another property called: <code class="literal">tunneling.servlet.shared.secret</code>, which is used to create an authorization context (permission checker) to help secure the remote publication process.</p><p>After establishing a connection between servers, the system exports all the setting into the LAR file (a special file called Liferay Archive File) and transfers it by invoking <code class="literal">updateStagingRequest</code>. The entire process is implemented in the <code class="literal">com.liferay.portal.lar.backgroundtask.LayoutRemoteStagingBackgroundTaskExecutor</code> class.</p><p>Information about remote staging is kept in the <code class="literal">Group_.typeSettings</code> database column with the following properties:</p><div class="informalexample"><pre class="programlisting">staged-portlet_{NUMBER}=true
staged=true
stagedRemotely=true
remoteGroupId=GROUP_ID
remoteAddress=ADDRESS
remotePort=PORT_NUMBER
secureConnection=false</pre></div><div class="note" title="Note"><h3 class="title"><a id="note18"/>Note</h3><p>Users in the<a id="id261" class="indexterm"/> local instance and remote instance must be the same, with the same credentials as well as roles and permissions.</p></div></div></div>
<div class="section" title="Enabling page versioning" id="aid-19UOO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Enabling page versioning</h1></div></div></div><p>Page versioning<a id="id262" class="indexterm"/> works only if staging is enabled. This functionality has two main advantages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Allows users to work in a parallel way on a different version of the page</li><li class="listitem">Keeps a history of the page and gives users a backup point</li></ul></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec105"/>How to do it…</h2></div></div></div><p>Enabling page versioning is a simple process. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Login as an administrator, go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Configuration</strong></span> and open the <span class="strong"><strong>Staging</strong></span> tab.</li><li class="listitem">Select <span class="strong"><strong>Enabled On Public Pages</strong></span> in the <span class="strong"><strong>Versioning</strong></span> section.</li><li class="listitem">Confirm by clicking on the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">After enabling versioning, the dockbar should present the following information:<div class="mediaobject"><img src="../Images/image00324.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec106"/>How it works…</h2></div></div></div><p>Working with page versioning is similar to working with code repositories such as Git or Subversion. This mechanism is connected with all sites (<code class="literal">LayoutSet</code>) and with specific pages (<code class="literal">Layout</code>). This means that it is possible to version the entire site or a single page. Moreover, Liferay provides a feature to branch changes. This functionality will be useful if a user wants to reorganize the whole site. The next important button is the undo/redo arrow in the<a id="id263" class="indexterm"/> top-right corner of the dockbar.</p><p>From a technical point of view, Liferay defines another table that keeps branches and versions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">LayoutSetBranch</code>: Stores site branches</li><li class="listitem"><code class="literal">LayoutBranch</code>: Stores layouts (pages) branches</li><li class="listitem"><code class="literal">LayoutRevision</code>: Stores layout (page) revision—undo/redo and versioning functionality</li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec107"/>See also</h2></div></div></div><p>If you want to configure staging, refer to the <span class="emphasis"><em>Enabling local live staging</em></span> and <span class="emphasis"><em>Enabling remote live staging</em></span> recipes.</p></div></div></body></html>