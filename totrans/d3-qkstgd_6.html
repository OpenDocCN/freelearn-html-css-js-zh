<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Animating SVG Elements to Create an Interactive Pie Chart</h1>
                </header>
            
            <article>
                
<p>In this chapter, we'll be use animation to make our graphs move. This can give your visualizations a more polished and professional feel.</p>
<p>In this section, we will cover the following topics:</p>
<ul>
<li>Creating an ordinal scale</li>
<li>Creating a color scale</li>
<li>Adding paths for each pie segment</li>
<li>Generating an arc creating function</li>
<li>Formatting the data for the arc</li>
<li>Adjusting the position of the pie</li>
<li>Making a donut graph</li>
<li>Removing parts of the pie</li>
</ul>
<p><span>The complete code for this section can be found at</span> <span><a href="https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter06">https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter06</a>.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the application</h1>
                </header>
            
            <article>
                
<p>As always, we'll need an <kbd>index.html</kbd> file to house our SVG code. Let's create the file and add the following code to it:</p>
<div class="highlight highlight-text-html-basic">
<pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span>&gt;
    &lt;<span class="pl-ent">head</span>&gt;
        &lt;<span class="pl-ent">meta</span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">title</span>&gt;&lt;/<span class="pl-ent">title</span>&gt;
        &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>https://d3js.org/d3.v5.min.js<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
    &lt;/<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">body</span>&gt;
        &lt;<span class="pl-ent">svg</span>&gt;
            &lt;<span class="pl-ent">g</span>&gt;&lt;/<span class="pl-ent">g</span>&gt;
        &lt;/<span class="pl-ent">svg</span>&gt;
        &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>app.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
    &lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create data/configuration variables</h1>
                </header>
            
            <article>
                
<p>At the bottom of the <kbd>&lt;body&gt;</kbd> tag, we're referencing an <kbd>app.js</kbd> file. Let's create that file and add the following code to it:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-c1">WIDTH</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> <span class="pl-c1">HEIGHT</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> radius <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">min</span>(<span class="pl-c1">WIDTH</span>, <span class="pl-c1">HEIGHT</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>;

<span class="pl-k">var</span> dataset <span class="pl-k">=</span> [
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">10</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">20</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Matt<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">30</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Jane<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">40</span> }
];
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(dataset);</pre></div>
<p>To be sure that it's working and linked up properly, we've added <kbd>console.log(dataset)</kbd> to the bottom. Let's open <kbd>index.html</kbd> <span>in Chrome</span> and view the developer console, to make sure that everything is hooked up the way it should be:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/614496bf-68b5-46c3-a3f7-8987be6399ac.png" style=""/></div>
<p>Once we're sure that it's working, we can remove <kbd>console.log(dataset)</kbd>;, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-c1">WIDTH</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> <span class="pl-c1">HEIGHT</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> radius <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">min</span>(<span class="pl-c1">WIDTH</span>, <span class="pl-c1">HEIGHT</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>;

<span class="pl-k">var</span> dataset <span class="pl-k">=</span> [
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">10</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">20</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Matt<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">30</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Jane<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">40</span> }
];</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an ordinal scale</h1>
                </header>
            
            <article>
                
<p>An ordinal scale maps a discrete value to some other value. A discrete value is something that can't be divided. Previously, we've used values such as numbers that can be divided up and interpolated. Interpolated just means that for any two numbers, we can find other numbers in between them. For instance, given 10 and 5, we can find values between them (6, 8.2, 7, 9.9, and so on). Now, we want to map values that can't be interpolatedâ€”the label properties in our dataset (Bob, Sally, Matt, and Jane). What values lie between Bob and Sally? What about between Bob and Matt? There are none. These are just strings, not numerical values that can be divided up and interpolated.</p>
<p>What we want to do is map these discrete values to other values. The following is an example of how to do this with an ordinal scale. Add the following to the bottom of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> mapper <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleOrdinal</span>();
<span class="pl-smi">mapper</span>.<span class="pl-en">range</span>([<span class="pl-c1">45</span>, <span class="pl-c1">63</span>, <span class="pl-c1">400</span>]); <span class="pl-c">//list each value for ordinal scales, not just min/max</span>
<span class="pl-smi">mapper</span>.<span class="pl-en">domain</span>([<span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Zagthor<span class="pl-pds">'</span></span>]); <span class="pl-c">//list each value for ordinal scales, not just min/max</span>

<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">mapper</span>(<span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>));
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">mapper</span>(<span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>));
<span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">mapper</span>(<span class="pl-s"><span class="pl-pds">'</span>Zagthor<span class="pl-pds">'</span></span>));</pre></div>
<p>The previous code should produce the following:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6119e550-d852-4c66-b6d4-0826bb07ea53.png" style=""/></div>
<p>Note that when you are working with ordinal scales, you'll need to list all of the values for both the domain and range. Even if one set is numerical (in the previous case, the range), you'll still have to list each value. If we just listed the min/max for the range, omitting63, D3 would have no idea what value to map Sally to. After all, how close is Sally to Bob,as a value? How close is Sally to Zagth or, as a value? There's no way to calculate that distance, since they're all strings of text, not numbers.</p>
<p>One thing that's surprising is that you can't invert ordinal scales. Remove the previous three <kbd>console.log()</kbd> statements and temporarily add the following to the bottom of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">mapper</span>.<span class="pl-en">invert</span>(<span class="pl-c1">45</span>));</pre>
<p>The following will be displayed:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-429 image-border" src="assets/3dcec0f1-1823-421c-a200-03442ae29824.png" style=""/></div>
</div>
<p>D3 can only go in one direction: from domain to range. You can now remove the <kbd>console.log()</kbd> <span>statement.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating the color scale to map labels to colors</h1>
                </header>
            
            <article>
                
<p>Now, we want to map the label properties of our dataset to colors, instead of random numbers, like in the previous section. We can come up with our own color scheme, or we choose one of D3's sets of colors from <a href="https://github.com/d3/d3-scale-chromatic#categorical">https://github.com/d3/d3-scale-chromatic#categorical</a>.<a href="https://github.com/d3/d3-scale-chromatic#categorical"/></p>
<p>If we want to, we can see that these color schemes are just arrays. <span>Temporarily, add the following to the bottom of </span><kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">d3</span>.<span class="pl-smi">schemeCategory10</span>)</pre>
<p>The following content will be displayed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7408b48d-b675-4f6f-8ef1-6ad550d96e00.png"/></div>
</div>
<p>Consequently, we can use a color scheme when setting a range. Replace the previous <kbd>console.log()</kbd> statement with the following:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> colorScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleOrdinal</span>();
<span class="pl-smi">colorScale</span>.<span class="pl-en">range</span>(<span class="pl-smi">d3</span>.<span class="pl-smi">schemeCategory10</span>);</pre></div>
<p>We can generate an array of labels for the domain by using JavaScript's native <kbd>map</kbd> function. Add the following to the bottom of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">colorScale</span>.<span class="pl-en">domain</span>(<span class="pl-smi">dataset</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">element</span>){
    <span class="pl-k">return</span> <span class="pl-smi">element</span>.<span class="pl-c1">label</span>;
}));</pre></div>
<p>The following is our code, so far:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-c1">WIDTH</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> <span class="pl-c1">HEIGHT</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> radius <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">min</span>(<span class="pl-c1">WIDTH</span>, <span class="pl-c1">HEIGHT</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>;

<span class="pl-k">var</span> dataset <span class="pl-k">=</span> [
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">10</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">20</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Matt<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">30</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Jane<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">40</span> }
];

<span class="pl-k">var</span> colorScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleOrdinal</span>();
<span class="pl-smi">colorScale</span>.<span class="pl-en">range</span>(<span class="pl-smi">d3</span>.<span class="pl-smi">schemeCategory10</span>);
<span class="pl-smi">colorScale</span>.<span class="pl-en">domain</span>(<span class="pl-smi">dataset</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">element</span>){
    <span class="pl-k">return</span> <span class="pl-smi">element</span>.<span class="pl-c1">label</span>;
}));</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the SVG</h1>
                </header>
            
            <article>
                
<p>The next code block is pretty standard. Add the following code to the bottom of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>, <span class="pl-c1">WIDTH</span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, <span class="pl-c1">HEIGHT</span>);</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding paths for each pie segment</h1>
                </header>
            
            <article>
                
<p>Let's add path elements for each element in our dataset. <span>Add the following code to the bottom</span> of <kbd>app.js</kbd><span>:</span></p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(dataset)
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">label</span>);
    });</pre></div>
<p>If we examine our elements in the developer tools, we'll see that the paths were added, and each path has a fill value, as determined by <kbd>colorScale(d.label)</kbd>, which is mapping the label of each data object to a color:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/44c97e7f-30fd-4b1e-9c1d-3382e11fbc2d.png" style=""/></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Generating an arc creating function</h1>
                </header>
            
            <article>
                
<p>The paths have fill colors, but no shapes. If you'll recall, the <kbd>&lt;path&gt;</kbd> elements take a <kbd>d=</kbd> attribute, which determines how they're drawn. We want to set up something that will somehow map data to a <kbd>d=</kbd> string, such as the following code (you don't have to add the next code snippet; it's only there for reference):</p>
<div class="highlight highlight-source-js">
<pre>.<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>){
    <span class="pl-c">//return path string here</span>
})</pre></div>
<p>Fortunately, D3 can generate the anonymous function that we need for the second parameter of <kbd>.attr()</kbd> in the previous code snippet. Add the following to <kbd>app.js</kbd>, just before our previous code for <kbd>var path = d3.select('g').selectAll('path')...</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> arc <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">arc</span>()
    .<span class="pl-en">innerRadius</span>(<span class="pl-c1">0</span>) <span class="pl-c">//to make this a donut graph, adjust this value</span>
    .<span class="pl-en">outerRadius</span>(radius);</pre></div>
<p>Let's plug this function into its correct place in our previous <kbd>var path = d3.select('g').selectAll('path')...</kbd> code (it won't work yet, though):</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(dataset)
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, arc) <span class="pl-c">//add this</span>
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">label</span>);
    });</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Formatting the data for the arc</h1>
                </header>
            
            <article>
                
<p>The reason that our <kbd>arc()</kbd> function won't work is the data isn't formatted properly for the function. The arc function that we generated expects the data object to have things like a start angle, an end angle, and so on. Fortunately, D3 can reformat our data so that it will work with our generated <kbd>arc()</kbd> function. To do this, we'll generate a <kbd>pie</kbd> function that will take a dataset and add the necessary attributes to it for the start angle, end angle, and so on. Add the following just before the code for <kbd>var path =d3.select('g').selectAll('path')...</kbd><span>:</span></p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> pie <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">pie</span>()
    .<span class="pl-c1">value</span>(<span class="pl-k">function</span>(<span class="pl-smi">d</span>) { <span class="pl-k">return</span> <span class="pl-smi">d</span>.<span class="pl-smi">count</span>; }) <span class="pl-c">//use the 'count' property each value in the original array to determine how big the piece of pie should be</span>
    .<span class="pl-c1">sort</span>(<span class="pl-c1">null</span>); <span class="pl-c">//don't sort the values</span></pre></div>
<p>Our <kbd>pie</kbd> variable is a function that takes an array of values as a parameter and returns an array of objects that are formatted for our <kbd>arc</kbd> function. Temporarily add the following code to the bottom of <kbd>app.js</kbd>, and take a look at the console in Chrome's Developer tools:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-en">pie</span>(dataset));</pre>
<p>The following content will be displayed:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-432 image-border" src="assets/ce1dd5be-eba8-4b98-b307-a240815fa091.png" style=""/></div>
</div>
<p>You can now remove the <kbd>console.log(pie(dataset))</kbd> call. We can use this <kbd>pie()</kbd> function when attaching data to our paths. Adjust the previous <kbd>var path = d3.select('g').selectAll('path')</kbd> code, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset)) <span class="pl-c">//adjust this line to reformat data for arc</span>
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, arc)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">label</span>);
    });</pre></div>
<p>Unfortunately, now, each object from the data array that's been attached to our path elements doesn't have a <kbd>.label</kbd> property, so our code for <kbd>.attr('fill', function(d) {})</kbd>is broken. Fortunately, our data does have a <kbd>.data</kbd> attribute that mirrors what the data looked like before we passed it to the <kbd>pie()</kbd> function. Let's adjust our <kbd>var path = d3.select('g').selectAll('path')</kbd> code to use that code, instead, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset))
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, arc)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">data</span>.<span class="pl-c1">label</span>); <span class="pl-c">//use .data property to access <br/>        original data</span>
    });</pre></div>
<p>So far, our code is as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-c1">WIDTH</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> <span class="pl-c1">HEIGHT</span> <span class="pl-k">=</span> <span class="pl-c1">360</span>;
<span class="pl-k">var</span> radius <span class="pl-k">=</span> <span class="pl-c1">Math</span>.<span class="pl-c1">min</span>(<span class="pl-c1">WIDTH</span>, <span class="pl-c1">HEIGHT</span>) <span class="pl-k">/</span> <span class="pl-c1">2</span>;

<span class="pl-k">var</span> dataset <span class="pl-k">=</span> [
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">10</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">20</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Matt<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">30</span> },
    { label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Jane<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">40</span> }
];

<span class="pl-k">var</span> mapper <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleOrdinal</span>();
<span class="pl-k">var</span> colorScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleOrdinal</span>();
<span class="pl-smi">colorScale</span>.<span class="pl-en">range</span>(<span class="pl-smi">d3</span>.<span class="pl-smi">schemeCategory10</span>);
<span class="pl-smi">colorScale</span>.<span class="pl-en">domain</span>(<span class="pl-smi">dataset</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">element</span>){
    <span class="pl-k">return</span> <span class="pl-smi">element</span>.<span class="pl-c1">label</span>;
}));

<span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>, <span class="pl-c1">WIDTH</span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, <span class="pl-c1">HEIGHT</span>);

<span class="pl-k">var</span> arc <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">arc</span>()
    .<span class="pl-en">innerRadius</span>(<span class="pl-c1">0</span>)
    .<span class="pl-en">outerRadius</span>(radius);

<span class="pl-k">var</span> pie <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">pie</span>()
    .<span class="pl-c1">value</span>(<span class="pl-k">function</span>(<span class="pl-smi">d</span>) { <span class="pl-k">return</span> <span class="pl-smi">d</span>.<span class="pl-smi">count</span>; })
    .<span class="pl-c1">sort</span>(<span class="pl-c1">null</span>);

<span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset))
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, arc)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">data</span>.<span class="pl-c1">label</span>);
    });</pre></div>
<p>The preceding code produces the following result:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/817b382e-5517-4c82-88e1-63ef00034860.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adjusting the position of the pie</h1>
                </header>
            
            <article>
                
<p>Currently, we can only see the lower-right quarter of the pie graph. This is because the pie starts at (<kbd>0,0</kbd>), but we can move the <kbd>group</kbd> element containing the pie by adjusting our <kbd>d3.select('svg')</kbd> code, as follows:</p>
<div class="highlight highlight-source-js">
<pre>d3.select('svg')<br/>    .attr('width', WIDTH)<br/>    .attr('height', HEIGHT);<br/>var container = d3.select('g') //add this line and the next:<br/>    .attr('transform', 'translate(' + (WIDTH / 2) + ',' + (HEIGHT / 2) + ')'); //add this line</pre></div>
<p>The pie graph now looks as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-434 image-border" src="assets/39092768-e765-496e-a7b7-a452e7c3700b.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making a donut graph</h1>
                </header>
            
            <article>
                
<p>If you want the pie to have a hole in the center, just adjust the inner radius of the <kbd>arc()</kbd> function, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> arc <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">arc</span>()
    .<span class="pl-en">innerRadius</span>(<span class="pl-c1">100</span>) <span class="pl-c">//to make this a donut graph, adjust this value</span>
    .<span class="pl-en">outerRadius</span>(radius);</pre></div>
<p>The graph will now look as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-435 image-border" src="assets/c024f1ea-ae2a-4f3a-b0ab-1286566a5108.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Removing parts of the pie</h1>
                </header>
            
            <article>
                
<p>We want to make it possible to click on a section of the pie to remove it. First, let's add IDs to our data, to make the removal easier. Adjust the <kbd>var dataset</kbd> code at the top of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> dataset <span class="pl-k">=</span> [
    { id<span class="pl-k">:</span> <span class="pl-c1">1</span>, label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Bob<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">10</span> }, //add id property
    { id<span class="pl-k">:</span> <span class="pl-c1">2</span>, label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Sally<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">20</span> }, //add id property
    { id<span class="pl-k">:</span> <span class="pl-c1">3</span>, label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Matt<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">30</span> }, //add id property
    { id<span class="pl-k">:</span> <span class="pl-c1">4</span>, label<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>Jane<span class="pl-pds">'</span></span>, count<span class="pl-k">:</span> <span class="pl-c1">40</span> } //add id property
];</pre></div>
<p>Now, let's use those IDs when we map data to paths. Adjust the <kbd>.data()</kbd> portion of our <kbd>var path =d3.select('g').selectAll('path')</kbd>code at the bottom of <kbd>app.js</kbd>, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset), <span class="pl-k">function</span>(<span class="pl-smi">datum</span>){ <span class="pl-c">//attach datum.data.id to each element</span>
        <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span>
    })</pre></div>
<p>Let's save a record of the current data for each element by adding a <kbd>_current</kbd> property to each element (we'll use this later). Add <kbd>.each(function(d) { this._current = d; });</kbd>to the end of our <kbd>var path =d3.select('g')</kbd> <span>code, at the bottom of <kbd>app.js</kbd>:</span></p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> path <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset), <span class="pl-k">function</span>(<span class="pl-smi">datum</span>){
        <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span>
    })
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, arc)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) {
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">d</span>.<span class="pl-c1">data</span>.<span class="pl-c1">label</span>);
    })<span class="pl-c">//watch out! remove the semicolon here</span>
    .<span class="pl-en">each</span>(<span class="pl-k">function</span>(<span class="pl-smi">d</span>) { <span class="pl-c1">this</span>.<span class="pl-smi">_current</span> <span class="pl-k">=</span> d; }); <span class="pl-c">//add this</span></pre></div>
<p>Create the click handler by adding the following code to the bottom of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">path</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">clickedDatum</span>, <span class="pl-smi">clickedIndex</span>){<br/>});</pre></div>
<p>Remove the selected data from the dataset array, using JavaScript's native <kbd>filter</kbd> function. Adjust the code that we just added, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">path</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">clickedDatum</span>, <span class="pl-smi">clickedIndex</span>){
    dataset <span class="pl-k">=</span> <span class="pl-smi">dataset</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">currentDatum</span>, <span class="pl-smi">currentIndex</span>){ <span class="pl-c">//new</span>
        <span class="pl-k">return</span> <span class="pl-smi">clickedDatum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span> <span class="pl-k">!==</span> <span class="pl-smi">currentDatum</span>.<span class="pl-c1">id</span> <span class="pl-c">//new</span>
    }); <span class="pl-c">//new</span>
});</pre></div>
<p>Remove the <kbd>path</kbd> elements from the SVG by adding the following to our click handler function:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">path</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">clickedDatum</span>, <span class="pl-smi">clickedIndex</span>){
    dataset <span class="pl-k">=</span> <span class="pl-smi">dataset</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">currentDatum</span>, <span class="pl-smi">currentIndex</span>){
        <span class="pl-k">return</span> <span class="pl-smi">clickedDatum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span> <span class="pl-k">!==</span> <span class="pl-smi">currentDatum</span>.<span class="pl-c1">id</span>
    });
    path <span class="pl-c">//new</span>
        .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset), <span class="pl-k">function</span>(<span class="pl-smi">datum</span>){ <span class="pl-c">//new</span>
            <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span> <span class="pl-c">//new</span>
        }) <span class="pl-c">//new</span>
        .<span class="pl-en">exit</span>().<span class="pl-c1">remove</span>(); <span class="pl-c">//new</span>
});</pre></div>
<p>Now, if we click on the orange segment, we should get the following result:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-436 image-border" src="assets/86789fa3-405b-4ffb-9a98-89f744dd1b2c.png" style=""/></div>
<p>Let's close the donut and add a transition. Add the following to the bottom of our click handler. Check out the comments in the following code to see what each line does:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">path</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>click<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">clickedDatum</span>, <span class="pl-smi">clickedIndex</span>){
    dataset <span class="pl-k">=</span> <span class="pl-smi">dataset</span>.<span class="pl-en">filter</span>(<span class="pl-k">function</span>(<span class="pl-smi">currentDatum</span>, <span class="pl-smi">currentIndex</span>){
        <span class="pl-k">return</span> <span class="pl-smi">clickedDatum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span> <span class="pl-k">!==</span> <span class="pl-smi">currentDatum</span>.<span class="pl-c1">id</span>
    });
    path
        .<span class="pl-c1">data</span>(<span class="pl-en">pie</span>(dataset), <span class="pl-k">function</span>(<span class="pl-smi">datum</span>){
            <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-c1">data</span>.<span class="pl-c1">id</span>
        })
        .<span class="pl-en">exit</span>().<span class="pl-c1">remove</span>();

    <span class="pl-smi">path</span>.<span class="pl-en">transition</span>() <span class="pl-c">//create the transition</span>
        .<span class="pl-en">duration</span>(<span class="pl-c1">750</span>) <span class="pl-c">//add how long the transition takes</span>
        .<span class="pl-en">attrTween</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">d</span>) { <span class="pl-c">//tween the d attribute</span>
            <span class="pl-k">var</span> interpolate <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">interpolate</span>(<span class="pl-c1">this</span>.<span class="pl-smi">_current</span>, d); <br/><span class="pl-c">            //interpolate <br/>            from what the d attribute was and what it is now</span>
            <span class="pl-c1">this</span>.<span class="pl-smi">_current</span> <span class="pl-k">=</span> <span class="pl-en">interpolate</span>(<span class="pl-c1">0</span>); <span class="pl-c">//save new value of data</span>
            <span class="pl-k">return</span> <span class="pl-k">function</span>(<span class="pl-smi">t</span>) { <span class="pl-c">//re-run the arc function:</span>
                <span class="pl-k">return</span> <span class="pl-en">arc</span>(<span class="pl-en">interpolate</span>(t));
            };
        });
});</pre></div>
<p class="CDPAlignLeft CDPAlign">Now, when we click on the orange segment, the donut closes smoothly, as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-437 image-border" src="assets/acd510e8-3252-44b5-bd20-2cdddca0ecce.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we created a pie chart that animates when you remove sections from it. You learned how to generate paths from data, so that you can get different parts of the pie without having to specify the drawing commands directly in the path elements. You also learned how to use animation to make visualizations look more professional. Finally, you learned how to remove sections of the pie and have the other path elements redraw themselves, so that the result will be a full pie.</p>
<p>In the next chapter, we will use D3 to create a graph that visualizes the relationships between various nodes of data.</p>


            </article>

            
        </section>
    </body></html>