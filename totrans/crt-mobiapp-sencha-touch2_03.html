<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Going Command Line</h1></div></div></div><p>For our third project, we are going to change it up a bit from our reliance on Sencha Designer. In this chapter, we will explore the uses of Sencha's free command-line tool called<a id="id245" class="indexterm"/> <strong>Sencha Cmd</strong>. Using this new toolset, we can quickly generate the basic skeleton of a new application, create controllers and models, and compile our application into a native application for iOS and Android.</p><p>The application for this chapter is a simple time tracker for scheduling break times. We call it <strong>TimeCop</strong>.</p><p>The TimeCop application<a id="id246" class="indexterm"/> lets the user set an alert for a certain amount of time in the future (say 15 minutes for break time). Once the time is set, the start button is pressed, and an alert will appear after the appropriate delay. The simplicity of this application will allow us to focus on some of the details and issues involved in using Sencha Cmd and creating a compiled application.</p><p>In this chapter we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a basic application using Sencha Cmd</li><li class="listitem" style="list-style-type: disc">Features of Sencha Cmd</li><li class="listitem" style="list-style-type: disc">Creating a developer account for iOS</li><li class="listitem" style="list-style-type: disc">Provisioning an application for iOS</li><li class="listitem" style="list-style-type: disc">Creating the correct file configurations</li><li class="listitem" style="list-style-type: disc">Adding native notifications</li><li class="listitem" style="list-style-type: disc">Compiling the application</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>The basic application</h1></div></div></div><p>The TimeCop application<a id="id247" class="indexterm"/> is designed as a simple way to track when your break or lunch time is over. The application consists of four main buttons labeled <strong>5</strong>, <strong>10</strong>, <strong>30</strong>, and <strong>60</strong>. Clicking on any of these buttons will cause a fifth button to appear in the center. This button will display the amount of time the user selected and serves as a start button. The user can add differing amounts of allotted time by clicking the four outer buttons multiple times.</p><div><img src="img/8901OS_1.jpg" alt="The basic application"/></div><p>For example, clicking on<a id="id248" class="indexterm"/> the <strong>5</strong> button twice will place 10 minutes on our allotted time in the center button. Clicking the <strong>5</strong> button once and then clicking the <strong>10</strong> button once will place <strong>15</strong> minutes on our allotted time. Once the desired amount of time is reached, the user clicks the center button and the countdown begins. When the countdown ends, the user is alerted via a device notification.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec32"/>Installing Sencha Cmd</h2></div></div></div><p>Sencha Cmd<a id="id249" class="indexterm"/> is a separate download from our Sencha Touch code and can be found at: <a class="ulink" href="http://www.sencha.com/products/sencha-cmd/download">http://www.sencha.com/products/sencha-cmd/download</a>. The download is available for Windows, OSX, and Linux (32 and 64 bit). When you unzip the downloaded file, you can double-click on it to install Sencha Cmd.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>For this book we are using Sencha Cmd Version 3 (at least 3.0.0.250 is required). Detailed installation instructions can be found at: <a class="ulink" href="http://docs.sencha.com/ext-js/4-1/#!/guide/command">http://docs.sencha.com/ext-js/4-1/#!/guide/command</a>.</p></div></div><p>Once you have <a id="id250" class="indexterm"/>
<a id="id251" class="indexterm"/>installed Sencha Cmd, you can open up the command line on your computer as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">On Mac OSX, go to <strong>Applications</strong> and launch <strong>Terminal</strong></li><li class="listitem" style="list-style-type: disc">On Windows, go to <strong>Start</strong> | <strong>Run</strong> and type <code class="literal">cmd</code></li></ul></div><p>From here you will need to change to the directory where your Sencha Touch files are installed (not the Sencha Cmd files we just downloaded, but your original Sencha Touch 2.1 files):</p><div><pre class="programlisting">
<strong>cd /path/to/Sencha-touch-directory/</strong>
</pre></div><p>Once you have changed directories, type:</p><div><pre class="programlisting">
<strong>sencha</strong>
</pre></div><p>You should see something like the following screenshot in your terminal:</p><div><img src="img/8901OS_03_02.jpg" alt="Installing Sencha Cmd"/></div><p>This text gives you a quick overview of the commands available and the version of Sencha Cmd you <a id="id252" class="indexterm"/>
<a id="id253" class="indexterm"/>are currently running (this should be Version 3.0.0.250 or higher).</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Advantages of Sencha Cmd </h2></div></div></div><p>One of the big advantages of <a id="id254" class="indexterm"/>Sencha Cmd is that, unlike Designer, it is provided free of charge. Sencha Cmd can also handle a lot of our repetitive coding for us. For example, you can generate a complete application skeleton by executing the following command from your Sencha Touch 2.1 directory:</p><div><pre class="programlisting">
<strong>sencha generate app MyApp /path/to/www/myapp</strong>
</pre></div><p>This will create a new application called <code class="literal">MyApp</code> in the directory specified.</p><p>You can also create models from the command line using something like this in your new application directory:</p><div><pre class="programlisting">
<strong>sencha generate model Contact --fields=id:int,firstName, lastName,email,phone</strong>
</pre></div><p>This will create a complete model for a user with the five specified fields, and will make sure that the <code class="literal">id</code> field is an integer.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>
<strong>A note about Sencha Cmd and directories</strong>
</p><p>When generating the skeleton for an application, you will need to be in the Sencha Touch 2.1 directory. Once the application is generated, you will need to change to the new application directory to execute commands for generating models and controllers, or for building and compiling the application.</p></div></div><p>You can also use the <code class="literal">build</code> command to automatically optimize your application for production. This includes resolving dependencies so that your application only includes the code it actually needs. Additionally, the <code class="literal">build</code> command sets up HTML5 application caching, minimizes all the JavaScript and CSS, as well as other speed and caching enhancements.</p><p>Let's take a look at how this works by generating our TimeCop application.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec34"/>Generating the application skeleton</h2></div></div></div><p>We start <a id="id255" class="indexterm"/>with the <code class="literal">create</code> command<a id="id256" class="indexterm"/> in our previous example:</p><div><pre class="programlisting">
<strong>sencha generate app TimeCop /Library/Documents/Webserver/timecop</strong>
</pre></div><p>You will also need to make sure that you adjust the output path to suit your development environment.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>As we noted previously, this command should be executed from your Sencha Touch 2.1 directory in order to work correctly. You can also specify the Sencha Touch directory by using the <code class="literal">-sdk</code> option like this:</p><div><pre class="programlisting">
<strong>sencha -sdk /Path/to /sencha-touch-2.1 generate app AppName /path/to/your/app/directory</strong>
</pre></div></div></div><p>This will create the<a id="id257" class="indexterm"/> following files and directory structure in the <code class="literal">timecop</code> folder:</p><div><img src="img/8901OS_4.jpg" alt="Generating the application skeleton"/></div><p>If you look at the <code class="literal">index.html</code> file, you will see that it already sets up the basic application and includes the following JavaScript:</p><div><pre class="programlisting">&lt;script id="microloader" type="text/javascript" src="img/development.js"&gt;&lt;/script&gt;</pre></div><p>This is the autoloader, which will automatically include the rest of the JavaScript we need. It also includes a loading indication in CSS. This will fire off while the application loads, to alert the user that things are happening behind the scenes. You shouldn't need to touch the <code class="literal">index.html</code> file.</p><p>The <code class="literal">app.js</code> file has a few more interesting pieces included:</p><div><pre class="programlisting">Ext.Loader.setPath({
    'Ext': 'touch/src',
    'TimeCop': 'app'
});
Ext.application({
    name: 'TimeCop',

    requires: [
        'Ext.MessageBox'
    ],

    views: ['Main'],

    icon: {
        57: 'resources/icons/Icon.png',
        72: 'resources/icons/Icon~ipad.png',
        114: 'resources/icons/Icon@2x.png',
        144: 'resources/icons/Icon~ipad@2x.png'
    },
    
    phoneStartupScreen: 'resources/loading/Homescreen.jpg',
    tabletStartupScreen: 'resources/loading/Homescreen~ipad.jpg',

    launch: function() {
        // Destroy the #appLoadingIndicator element
        Ext.fly('appLoadingIndicator').destroy();

        // Initialize the main view
        Ext.Viewport.add(Ext.create('TimeCop.view.Main'));
    },

});</pre></div><p>The<a id="id258" class="indexterm"/> <code class="literal">Ext.Loader.setPath</code> function at the top will point to our <code class="literal">touch</code> directory where all of our base Sencha Touch 2 library files are located.</p><p>The next section sets up the name of our application, our required components, our views, our icons, and the startup screens.</p><p>The <code class="literal">launch</code> section removes our loading indicator and then adds our <code class="literal">TimeCop.view.Main</code> to the viewport.</p><p>If you navigate to the folder in Safari and look at the application, you will see something like this:</p><div><img src="img/8901OS_5.jpg" alt="Generating the application skeleton"/></div><p>Most of the<a id="id259" class="indexterm"/> actual display code for this application is contained in the <code class="literal">TimeCop.view.Main</code> file. This is the file we will modify to create our actual application.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Creating the TimeCop layout</h2></div></div></div><p>The layout for this <a id="id260" class="indexterm"/>
<a id="id261" class="indexterm"/>application consists of a vbox layout on our main container. Inside the main container is a set of three containers, each with an hbox layout and containing three additional containers. This gives us a flexible 3 x 3 grid where we can place our components:</p><div><img src="img/8901OS_03_06.jpg" alt="Creating the TimeCop layout"/></div><p>Inside of <a id="id262" class="indexterm"/>
<a id="id263" class="indexterm"/>containers <strong>1</strong>, <strong>3</strong>, <strong>7</strong>, and <strong>8</strong> we need buttons with our four time increments. In container <strong>5</strong> we will place our start button. By using the <code class="literal">vbox</code> and <code class="literal">hbox</code> layouts as described later in this section we can keep our components centered regardless of the screen size.</p><p>The containers for our buttons can be given a fixed width (in this case we choose <code class="literal">120</code>). The empty containers in the row are then given a <code class="literal">flex</code> value of <code class="literal">1</code>. This will cause them to take up the rest of the available space and maintain an even spacing between our buttons regardless of screen size.</p><p>For example, <a id="id264" class="indexterm"/>
<a id="id265" class="indexterm"/>our first row is laid out like so:</p><div><pre class="programlisting">{
    xtype: 'container',
    layout: {
        type: 'hbox'
    },
    flex: 1,
    items: [
        {
            xtype: 'container',
            width: 120,
            layout: {
                type: 'fit'
            },
            items: [
                {
                    xtype: 'incrementButton',
                    text: 5

                }
            ]
        },
        {
            xtype: 'container',
            flex: 1
        },
        {
            xtype: 'container',
            layout: {
                type: 'fit'
            },
            width: 120,
            items: [
                {
                    xtype: 'incrementButton',
                    text: 10
                }
            ]
        }
    ]
}</pre></div><p>You will notice that each of our buttons has an <code class="literal">xtype</code> type of <code class="literal">incrementButton</code>, but different values for text (<code class="literal">5</code> and <code class="literal">10</code>). We will come back to that in just a moment, but we need to take a look at our second row first.</p><p>The second <code class="literal">hbox</code> container <a id="id266" class="indexterm"/>
<a id="id267" class="indexterm"/>row is a variation on the first row; a single fixed-width container in the center and a variable-width (<code class="literal">flex:1</code>) container on either side:</p><div><pre class="programlisting">{
    xtype: 'container',
    layout: {
        type: 'hbox'
    },
    flex: 1,
    items: [
        {
            xtype: 'container',
            flex: 1
        },
        {
            xtype: 'container',
            width: '',
            layout: {
                type: 'fit'
            },
            width: 120,
            items: [
                {
                    xtype: 'button',
                    hidden: true,
                    id: 'startButton',
                    ui: 'roundStart',
                    text: 0
                }
            ]
        },
        {
            xtype: 'container',
            flex: 1
        }
    ]
}</pre></div><p>Our <code class="literal">startButton</code> in the center starts out hidden by default and it will only appear when the <code class="literal">incrementButtons</code> are tapped. We set  <code class="literal">ui</code> to <code class="literal">roundStart</code>, which we will use later on to style the button, and we set the <code class="literal">text</code> value of the button to <code class="literal">0</code> (we will use this value later in our <code class="literal">incrementButton</code> functions). We also add a listener for our <code class="literal">startButton</code> instance's tap event.</p><p>Our third row is <a id="id268" class="indexterm"/>
<a id="id269" class="indexterm"/>simply a copy of our first row, with the button values set to <code class="literal">30</code> and <code class="literal">60</code> respectively. Both of these buttons will have <code class="literal">xtype:incrementButton</code> as in the first row.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Creating the theme</h2></div></div></div><p>The base layout we<a id="id270" class="indexterm"/>
<a id="id271" class="indexterm"/> currently have will give us a bunch of large, ugly, square buttons. We want something a bit cooler than that, so we are going to set a new theme for the application. Sencha Touch Themes use SASS and Compass to customize the user interface in a number of interesting ways.</p><div><div><h3 class="title"><a id="note10"/>Note</h3><p>For more information on creating Sencha Touch themes, review the documentation and tutorial videos at: <a class="ulink" href="http://docs.sencha.com/touch/2-0/#!/guide/theming">http://docs.sencha.com/touch/2-0/#!/guide/theming</a>.</p></div></div><p>The first step in our theme is adding a <code class="literal">ui</code> configuration for our buttons. The four time increment buttons will have <code class="literal">ui: 'round'</code> added to their configuration options. This will give us a more pleasing circular button.</p><p>The center button will have <code class="literal">ui: 'roundStart'</code> added to its configuration options. We will make <code class="literal">ui</code> inherit all of our qualities from our original round ui and add some color changes to give us a green start button.</p><p>We can then add the following code to <code class="literal">app.scss</code>:</p><div><pre class="programlisting">.x-button-round, .x-button-roundStart {
  background-color: transparent;
  background-image: none;
  width: 120px;
  padding: 10px;
  height: 120px;
  overflow:hidden;
  border: none;

  span  {
    color:#333;
    font-size:24px;
    line-height:68px;
  }
  span.x-button-label {
    display: block;
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(230,230,230,1)), color-stop(50%,rgba(168,168,168,1)), color-stop(50%,rgba(168,168,168,1)), color-stop(100%,rgba(230,230,230,1))); /* Chrome,Safari4+ */
    position:relative;
    height:100px;
    width:100px;
    text-align:center;
    cursor:pointer;
    border:16px solid #e8e8e8;
    -webkit-border-radius: 60px;
    font-weight: 900;
    -webkit-box-shadow: inset 0 0 10px#C7C7C7, 0 0 1px 2px #bababa;
  }
}</pre></div><p>The key <a id="id272" class="indexterm"/>
<a id="id273" class="indexterm"/>pieces of this are <code class="literal">-webkit-border-radius: 60px</code> (half of our button width/height), which makes the buttons circular, and <code class="literal">background: -webkit-gradient</code>, which creates the gradient background of the buttons.</p><p>We do something similar with our start button, but we make the text white and the background green:</p><div><pre class="programlisting">.x-button-roundStart {
  span {
  color: white;
  }
  span.x-button-label {
  background-color: #0C0;
  background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, #1AFF1A), color-stop(50%, #00E600), color-stop(51%, #0C0), color-stop(100%, #00B300));
  background-image: -webkit-linear-gradient(#1AFF1A, #00E600 50%, #0C0 51%, #00B300);
  background-image: linear-gradient(#1AFF1A, #00E600 50%, #0C0 51%, #00B300);
  }
}</pre></div><p>Running <code class="literal">compass compile</code> will regenerate the <code class="literal">app.css</code> file with our new styles in it. Now that we have the basic look and feel of our application, we need to talk about using the native APIs in a <a id="id274" class="indexterm"/>
<a id="id275" class="indexterm"/>Sencha Touch application.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Creating the increment button</h2></div></div></div><p>Since each of our <a id="id276" class="indexterm"/>
<a id="id277" class="indexterm"/>increment buttons will do much the same thing, this becomes an excellent opportunity to create a button class.</p><p>To do this we will make a separate file on our view folder called <code class="literal">incrementButton.js</code>:</p><div><pre class="programlisting">Ext.define('TimeCop.view.incrementButton', {
    extend: 'Ext.Button',
    alias: 'widget.incrementButton', 
    config: {
        itemId: 'mybutton',
        ui: 'round',
        text: 5,
        listeners: [
            {
                fn: 'onMybuttonTap',
                event: 'tap'
            }
        ]
    }
});</pre></div><p>This code extends the standard <code class="literal">Ext.Button</code> class and sets defaults for <code class="literal">itemID</code>, <code class="literal">text</code>, and <code class="literal">ui</code> (we will use <code class="literal">ui</code> later on to style the buttons). We also add a tap listener for when the user presses the button.</p><p>When our time increment button is tapped, we need to add the appropriate time to our start button in the center and display it (if it is hidden). We will do this by adding the following to our tap handler function after the <code class="literal">Config</code> section in our previous code:</p><div><pre class="programlisting">onMybuttonTap: function(button, e, options) {
 var increment = button.getText();
 var start = Ext.getCmp('startButton');

 var startInt = start.getText();

 var total = parseInt(startInt, 10) + parseInt(increment, 10);

 start.setText(total);

 if(start.isHidden()) {
  start.show();
 }
}</pre></div><p>This code<a id="id278" class="indexterm"/>
<a id="id279" class="indexterm"/> grabs the text from our current button, which is <code class="literal">5</code>, and then grabs the start button. We then add the values from the two buttons together and set this as the text on our start button. Since this function is now a part of the base <code class="literal">incrementButton</code>, each of our four buttons with an <code class="literal">xtype</code> of <code class="literal">incrementButton</code> will be able to use this same function. The only thing that will change is the text value of the button. This allows you to easily choose other time increments if you desire.</p><p>Using the buttons works like this: when the user first starts the application, the start button is hidden and has a text value of <strong>0</strong>. The user taps the <strong>5</strong> button and the start button appears, 5 is added to 0 and the start button's text is set to <strong>5</strong>. The user then taps the <strong>10</strong> button, causing the start button text to be increased to <strong>15</strong> and so on.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Creating the start button</h2></div></div></div><p>Our start button uses a separate <a id="id280" class="indexterm"/>
<a id="id281" class="indexterm"/>function to begin the timer countdown. In this case, we will add a listener to our main view:</p><div><pre class="programlisting">listeners: [
 {
  fn: 'onStartButtonTap',
  event: 'tap',
  delegate: '#startButton'
 }
]</pre></div><p>This will fire a function called <code class="literal">onStartButtonTap</code>. We add this new function after the <code class="literal">Config</code> section of our <code class="literal">Main.js</code> file. This is the function that starts the countdown for the timer:</p><div><pre class="programlisting">onStartButtonTap: function(button, e, options) {
 var delay = button.getText();
 setTimeout(function() {
  Ext.Msg.alert('Back to work minion!', 
  'The boss needs a new villa!', 
  Ext.emptyFn);
 },parseInt(delay)*1000);
}</pre></div><p>This function grabs the text of the buttons, which is now set for the total amount of time we want to set on our timer. We then create a <code class="literal">setTimeout</code> function that will display a message box after the timer finishes. For the purposes of testing, we have set the delay for delay *1000, which will actually give us our delay time in seconds instead of minutes. When we want to set the delay to minutes, the last line can be changed to:</p><div><pre class="programlisting">setTimeout(function() {
 Ext.Msg.alert('Back to work minion!', 
 'The boss needs a new villa!', 
 Ext.emptyFn);
},parseInt(delay)*60000);</pre></div><p>For testing purposes<a id="id282" class="indexterm"/>
<a id="id283" class="indexterm"/> let's leave the code as is for now and test the functions.</p><div><img src="img/8901OS_7.jpg" alt="Creating the start button"/></div><p>As we can see from <a id="id284" class="indexterm"/>
<a id="id285" class="indexterm"/>our example, the alert appears once the delay time expires. However this doesn't currently use any of the native alerts available on the device. In order to do this, we need to take a look at <code class="literal">Ext.device</code>.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Using native APIs with Ext.device</h1></div></div></div><p>By default, a Sencha Touch <a id="id286" class="indexterm"/>
<a id="id287" class="indexterm"/>application is web-based. This means that a user on Android or iOS will use a web browser to access your application. You can add the web page to the desktop and it will look and behave very much like a compiled application. However, there are a number of features available on a mobile device that cannot be accessed through a web-based application; these include things like the camera, the device orientation, connection monitoring, native alerts, and some native geolocation features.</p><p>Sencha Touch offers a way around this issue by using <code class="literal">Ext.device</code>. This component accepts JavaScript commands, which will then be translated into native functions when the application is compiled.</p><div><div><h3 class="title"><a id="note11"/>Note</h3><p>It should be noted that one essential consideration when using <code class="literal">Ext.device</code> is that the application has to be compiled each time in order to actually test the native application features. If you make changes, or need to do debugging, you will have to recompile the application and reinstall it on your mobile device.</p></div></div><p>
<code class="literal">Ext.device</code>
<a id="id288" class="indexterm"/> offers the following options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Connection</strong>: This <a id="id289" class="indexterm"/>allows you to check if the user is online using <code class="literal">Ext.device.Connection.isOnline()</code>. You can also check the type of connection using <code class="literal">Ext.device.Connection.getType()</code>.</li><li class="listitem" style="list-style-type: disc"><strong>Notification</strong>: This <a id="id290" class="indexterm"/>allows you to access native notification windows and the vibrate device option.</li><li class="listitem" style="list-style-type: disc"><strong>Orientation</strong>: This <a id="id291" class="indexterm"/>provides the current orientation of the device tracked in three dimensions (alpha, beta, and gamma). These dimensions return values between 0 and 360 and can be used to calculate various device movements.</li><li class="listitem" style="list-style-type: disc"><strong>Camera</strong>: This <a id="id292" class="indexterm"/>lets your application take pictures or select existing images from the camera library (with your user's permission).</li></ul></div><p>For TimeCop, we will use a simple notification/vibrate alert. In later chapters, we will cover the other <code class="literal">Ext.Device</code> components. First, though, we will need to take a bit of a detour and explore some of the additional steps we need to take to test and run compiled applications <a id="id293" class="indexterm"/>
<a id="id294" class="indexterm"/>under iOS.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Testing and running native applications</h1></div></div></div><p>In order to run a<a id="id295" class="indexterm"/>
<a id="id296" class="indexterm"/> native (compiled) application on iOS, you will need to take the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Register as an Apple iOS developer (cost is $99 annually as of this writing).</li><li class="listitem">Enable your device for development.</li><li class="listitem">Provision the application with Apple and create a P12 certificate.</li><li class="listitem">Install the application on your device.</li></ol></div><p>This process is not always intuitive, and can often seem more laborious than coding the actual application. If you would prefer to create an Android application, we will discuss building native Android applications later in this chapter.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Registering as a developer</h2></div></div></div><p>In order to publish your application to the <a id="id297" class="indexterm"/>Apple Store, or even to simply test compiled iOS applications, you are going to have to sign up for a developer account. There is a fee to become a developer (the cost is $99 annually as of this writing), and Apple will require quite a bit of information about you. They require this information for several reasons. First, they have to know who you are so that you can get paid for apps that you sell in their store. Second, they need to know how to contact you if there's a problem with your application. And last, they need to be able to track you down if you try to do something evil with your app. Not that you would, of course.</p><p>Even if you are not yet ready to distribute your application, you will still need to register as a developer in order to install a compiled application on your iOS device.</p><p>Your iOS device will also need to be registered for development with Apple. This will allow you to install and test your own personal compiled applications directly from your development computer instead of going through the Apple store.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Becoming an Apple developer</h2></div></div></div><p>To become an<a id="id298" class="indexterm"/> Apple developer, first you must go to: <a class="ulink" href="http://developer.apple.com/programs/register/">http://developer.apple.com/programs/register/</a>.</p><p>You will either need to supply your existing Apple ID or sign up for a new one, fill out some lengthy profile information, agree to some legal documents, and then perform an e-mail verification. From there <a id="id299" class="indexterm"/>you will have access to the Apple Developer center. The two points of most interest to us as mobile developers are the iOS Dev Center and the iOS Provisioning Portal.</p><p>The <strong>iOS Dev Center</strong>
<a id="id300" class="indexterm"/> is where you can download the iOS SDK (known as <a id="id301" class="indexterm"/>Xcode), as well as read documentation, see sample code and tutorials, and view some videos on iOS development.</p><p>The <strong>iOS Provisioning Portal</strong>
<a id="id302" class="indexterm"/> is where you add your application to the Apple store or publish test versions of your application.</p><div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>Note that in order to use Xcode, install a development certificate, or publish your application to the Apple store, you must have a computer running OSX. Windows and Linux computers cannot run Xcode or publish to the Apple store.</p></div></div><p>The provisioning portal is the main area we are concerned with.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Provisioning an application</h2></div></div></div><p>In order to run a compiled <a id="id303" class="indexterm"/>Sencha Touch application that you're developing for iPhone, iPad, or iPod touch, you must have a provisioning profile and a development certificate installed on your device and your Mac. (This is only true for compiled applications and not standard Sencha web applications.)</p><p>While the provisioning process can seem a bit complex, Apple has a very nice set of "How To…" videos listed on the right side of the provisioning portal, as well as a handy <strong>Provisioning Assistant</strong> setup wizard. The <strong>Provisioning Assistant</strong> wizard will guide you through the steps to create and install your development provisioning profile and iOS development certificate.</p><p>The first step in the process is to obtain a development certificate. The <strong>development certificate</strong>
<a id="id304" class="indexterm"/> is an electronic document that links you as an Apple developer with your compiled applications. For testing purposes, the certificate gets loaded onto your iOS device and it lets the device know that it's okay to run your application.</p><p>The provisioning profile is used when your application is compiled. It contains a separate set of development certificates, a device ID, and an app ID. This is checked against the original development certificate to authorize the application to run on your device.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Meanwhile back in the code</h1></div></div></div><p>Now that we have our certificates properly set up, we can get back to the business of writing code.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Using the native notifications</h2></div></div></div><p>To use the native notifications we need to replace our original <code class="literal">onStartButtonTap</code> function<a id="id305" class="indexterm"/> with a new function that uses <code class="literal">Ext.device</code>. Aside from that, the code for native notifications <a id="id306" class="indexterm"/>looks almost the same as our previous code:</p><div><pre class="programlisting">    onStartButtonTap: function(button, e, options) {
        var delay = button.getText();
        setTimeout(function() {
            Ext.device.Notification.vibrate();
            Ext.device.Notification.show({
                title: ' Back to work minion! ',
                message: 'The boss needs a new villa!'
            });


        },parseInt(delay)*1000);
    }</pre></div><p>We still wrap the function in a <code class="literal">setTimeout</code> statement. We then call <code class="literal">Ext.device.Notification.vibrate</code> and <code class="literal">Ext.device.Notification.show</code>. This will cause the device to vibrate (if the device supports it) and then show our original message as before.</p><p>Also, <code class="literal">Ext.device</code> is not loaded by default, so we need to add it to our <code class="literal">app.js</code> file, in the <code class="literal">requires</code> configuration:</p><div><pre class="programlisting">Ext.application({
    name: 'TimeCop',

    requires: [
        'Ext.MessageBox',
        'Ext.device.Notification'
    ],</pre></div><div><div><h3 class="title"><a id="note12"/>Note</h3><p>Debugging problems with <code class="literal">Ext.device</code> is a difficult proposition. The <code class="literal">Ext.device</code> functionality is not available in desktop browsers, or when your app hasn't been compiled. However, if you need to debug an app running on your mobile device, there are some third-party solutions out there, one of the best being<a id="id307" class="indexterm"/> <strong>weinre</strong>, which stands for <strong>WEb INspector REmote</strong>. You can learn more about weinre at: <a class="ulink" href="http://people.apache.org/~pmuellr/weinre/docs/latest/">http://people.apache.org/~pmuellr/weinre/docs/latest/</a>.</p></div></div><p>For now, though, we need to compile the application for a native iPhone using Sencha Cmd.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Compiling the application</h1></div></div></div><p>In order to compile an <a id="id308" class="indexterm"/>application you will need a few things from Apple first:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A developer certificate in P12 format (for a walkthrough on this process go to <a class="ulink" href="http://docs.sencha.com/touch/2-0/#!/guide/native_provisioning">http://docs.sencha.com/touch/2-0/#!/guide/native_provisioning</a>)</li><li class="listitem" style="list-style-type: disc">A provisioning profile (from Apple Provisioning Profile, launch the Development Provisioning Assistant:<a class="ulink" href="http://%20https://developer.apple.com/ios/manage/overview/index.action"> https://developer.apple.com/ios/manage/overview/index.action</a>)</li></ul></div><p>You will also need to know the application name, application ID, and bundle seed ID for your application. This information can be found by clicking on <strong>configure</strong> next to the application name in the <strong>App ID</strong> section of the portal. The format looks like this mockup:</p><div><img src="img/8901OS_8.jpg" alt="Compiling the application"/></div><p>Once we have this information and the files, we need to set up our <code class="literal">packager.json</code> file.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec43"/>Setting up packager.json</h2></div></div></div><p>The <code class="literal">packager.json</code> file <a id="id309" class="indexterm"/>is in the root directory of our application folder and it is a template originally generated for us by Sencha Cmd. We need to change some of the default information in order to compile the application.</p><p>The <code class="literal">packager.json</code> file<a id="id310" class="indexterm"/> has extensive comments, so we will just take a look at some of the more critical settings in the file:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">"applicationName":"TimeCop"</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">"applicationId":"com.example.TimeCop"</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">"bundleSeedId":"D3THNXJT69"</code></li></ul></div><p>This is where we use the values from our previous example mockup. You will need to change these to reflect your own application information.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>Please note that we are using example information for our <code class="literal">applicationID</code> and <code class="literal">bundleSeedId</code> values. You will need to change these values to the ones you get from Apple.</p></div></div><p>The next important section is:</p><div><pre class="programlisting">"configuration":"Debug",
"platform":"iOSSimulator",
"deviceType":"Universal",</pre></div><p>We can leave these as is for right now, but they control how the application is outputted and what devices it works on. The <code class="literal">Configuration</code> type should always be <code class="literal">Debug</code> until you are ready to distribute the application through the app store. This will help you track down any code errors that you might have.</p><p>The platform options are: </p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">iOSSimulator</li><li class="listitem" style="list-style-type: disc">iOS</li><li class="listitem" style="list-style-type: disc">Android</li><li class="listitem" style="list-style-type: disc">AndroidEmulator</li></ul></div><p>Using the <code class="literal">iOSSimmulator</code> or <code class="literal">AndroidEmulator</code> options allows you to test locally on your machine without an iOS or Android device. You will need to have Xcode and/or the Android SDK kit installed on your machine to use this option.</p><p>
<code class="literal">deviceType</code> is an iOS-only option that declares the application as <code class="literal">iPhone</code>, <code class="literal">iPad</code>, or <code class="literal">Universal</code> (meaning both).</p><p>The last critical pieces of information are:</p><div><pre class="programlisting">"certificatePath":"/Users/12ftguru/Downloads/New_Cer/Certificates.p12",
"provisionProfile":"/Users/12ftguru/Downloads/New_Cer/TimeCop.mobileprovision",</pre></div><p>Both <code class="literal">certificatePath</code> and <code class="literal">provisionProfile</code> should correspond to the correct paths to the converted P12 certificate mentioned earlier and the provisioning profile you downloaded from Apple.</p><p>Once you have the information in place, we are ready to compile the application.</p><p>In the command line, change to your application directory:</p><div><pre class="programlisting">
<strong>cd /path/to/your/application</strong>
</pre></div><p>And then type:</p><div><pre class="programlisting">
<strong>sencha app build -run native</strong>
</pre></div><p>This should compile your <a id="id311" class="indexterm"/>application into an executable file and launch the iOS simulator.</p><div><div><h3 class="title"><a id="note14"/>Note</h3><p>The <code class="literal">-run</code> option is new in Sencha Cmd Version 3. Previous versions would launch the simulator by default. You can drop the <code class="literal">-run</code> option if you only want to build the application.</p></div></div><div><img src="img/8901OS_9.jpg" alt="Setting up packager.json"/></div><p>This looks more like a native iPhone app should, and if the application is run on an iPhone, the phone will also vibrate when the notification occurs.</p><p>The compiled<a id="id312" class="indexterm"/> application should now be in the <code class="literal">build/native</code> folder in your application directory. You can drag it onto iTunes to install it on your device.</p><div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>
<strong>Installing a native application</strong>
</p><p>If your application fails to install, it is often helpful to try installing under Xcode. Connect your device and drop the application file on top of the Xcode application. This will launch Xcode and attempt to install the application on your mobile device. Xcode often gives back better error information than iTunes does.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Building native Android applications</h1></div></div></div><p>Building compiled <a id="id313" class="indexterm"/>applications in Android follows a similar pattern as the one we used for iOS:</p><div><ol class="orderedlist arabic"><li class="listitem">We create an Android signing certificate.</li><li class="listitem">We create a package configuration file for Sencha Cmd to use.</li><li class="listitem">We run the Sencha Cmd packager to create an <code class="literal">application.apk</code> file, which will run on Android devices or the Android emulator for testing.</li></ol></div><p>The nice part is that we can still use the exact same code, all we need is a new certificate and some configuration changes.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Creating the Android signing certificate</h2></div></div></div><p>Generating the <a id="id314" class="indexterm"/>Android signing certificate is significantly less complex than its iOS counterpart. All of our keys can be generated on our local machine and there is no provisioning process for Android applications.</p><p>The first thing we need to do is download the Android SDK from <a class="ulink" href="http://developer.android.com/sdk/index.html">http://developer.android.com/sdk/index.html</a>. Once the ZIP file is downloaded, we need to extract it and save it in an appropriate location. For this example, we have chosen our home directory in a folder called <code class="literal">development</code>. When we create our configuration files, your file path information may vary depending on where you place the SDK.</p><p>The Android certificate is generated from the command line using the following command (all on one line):</p><div><pre class="programlisting">
<strong>keytool -genkey -v -keystore time-cop.keystore -alias timecop -keyalg RSA -keysize 2048 -validity 10000</strong>
</pre></div><p>The important parts of this command are the <code class="literal">keystore</code> name, <code class="literal">time-cop.keystore</code>, and the <code class="literal">alias</code>, which is <code class="literal">timecop</code>. We will need to have these values in order to correctly set up our configuration file.</p><p>When you execute this <a id="id315" class="indexterm"/>command, you will be prompted to create a password for the keystore. You will then be walked through a series of questions about your organization and location (these are optional, but probably a good idea).</p><p>Once you have answered all of the questions, a file will be generated called <code class="literal">time-cop.keystore</code> (or whatever you named your keystore).</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Creating the Android configuration file</h2></div></div></div><p>As with our previous iOS <a id="id316" class="indexterm"/>configuration file, we create a JSON file called <code class="literal">packager_android.json</code>. The format for this file will follow the same format as our previous iOS file:</p><div><pre class="programlisting">{
 "applicationName": "TimeCop",
 "applicationId": "com.12ftguru.TimeCop",
 "outputPath": "/Users/12ftguru/Development/compiled/",
 "iconName": "timecop.png",
"versionCode": "1.0", 
"versionString": "1.0 Release 1",
 "inputPath": "/path/to/your/application",
 "configuration": "Debug",
 "platform": "AndroidEmulator",
 "certificatePath": "/Users/12ftguru/Development/time-cop.keystore",
 "certificateAlias": "timecop",
 "sdkPath": "/Users/12ftguru/Development/sdk",
 "orientations": [
  "portrait",
  "landscapeLeft",
  "landscapeRight",
  "portraitUpsideDown"
 ],
 "deviceType": "&lt;Not applicable for Android&gt;"
}</pre></div><p>
<code class="literal">applicationName</code> will be the name of the <code class="literal">.apk</code> file that is created when we compile, which in this case, is <code class="literal">TimeCop.apk</code>.</p><p>
<code class="literal">applicationId</code> is a unique identifier for your application, we recommend using something like <code class="literal">com.your_name.your_application_name</code>.</p><p>
<code class="literal">outputPath</code> is where the <code class="literal">.apk</code> file will be saved and <code class="literal">iconName</code> is the file that will be used as the icon for your application. <code class="literal">versionCode</code> and <code class="literal">versionString</code> are up to you and should be used to differentiate which version of the software is being used.</p><p>
<code class="literal">inputPath</code> is the full path to your TimeCop files (or a path relative to this configuration file).</p><p>
<code class="literal">configuration</code> can be set to <code class="literal">Release</code> or <code class="literal">Debug</code> and <code class="literal">platform</code> can be set to <code class="literal">Android</code> or <code class="literal">AndroidEmulator</code>. These settings will typically be <code class="literal">Debug</code> + <code class="literal">AndroidEmulator</code> for testing and <code class="literal">Release</code> + <code class="literal">Android</code> for a finished application.</p><p>
<code class="literal">certificatePath</code> is the<a id="id317" class="indexterm"/> location of the <code class="literal">keystore</code> file that we generated in the previous section and <code class="literal">certificateAlias</code> is the alias we supplied as part of our command-line arguments when we created <code class="literal">keystore</code>.</p><p>The orientations are the viewing positions available to your application. They will typically stay as the defaults listed before. The device type is ignored by Android, but the configuration manager will return errors if the configuration or value is left off. You can keep this value set as <code class="literal">&lt;Not applicable for Android&gt;</code> and it will be safely ignored.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Compiling and launching the Android application</h2></div></div></div><p>Just like the previous iOS application, <a id="id318" class="indexterm"/>we will use the Sencha package command to compile the application. However, if you are testing in the Android emulator, you will need to start the emulator before issuing the command.</p><p>Once the emulator is running, enter the following command on the command line:</p><div><pre class="programlisting">
<strong>sencha package run packager_android.json</strong>
</pre></div><p>This will execute our <code class="literal">packagerAndroid.json</code> file we created in the previous section.</p><p>If you are <a id="id319" class="indexterm"/>creating a release version of the application, set <code class="literal">configuration</code> to <code class="literal">Release</code> and <code class="literal">platform</code> to <code class="literal">Android</code> in your <code class="literal">packager_android.json</code> configuration file. You can then execute the <code class="literal">package</code> command, but leave off the <code class="literal">run</code> command like so:</p><div><pre class="programlisting">
<strong>sencha package packager_android.json</strong>
</pre></div><p>This will compile the application without running it in the emulator.</p><div><div><h3 class="title"><a id="note15"/>Note</h3><p>The Android emulator is capable of emulating a wide variety of hardware. For more information on the Android emulator, go to <a class="ulink" href="http://developer.android.com/tools/devices/emulator.html">http://developer.android.com/tools/devices/emulator.html</a>.</p><p>For information on setting up different hardware profiles (sometimes called <strong>Android Virtual Devices</strong> (<strong>ADVs</strong>)<a id="id320" class="indexterm"/> with the Android emulator, take a look at the documentation available at <a class="ulink" href="http://developer.android.com/tools/devices/managing-avds.html">http://developer.android.com/tools/devices/managing-avds.html</a>.</p></div></div><p>Once the application is running, you can begin testing the different features and fixing any issues.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Summary</h1></div></div></div><p>In this chapter we learned about:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating an application skeleton with the Sencha SDK command-line tools</li><li class="listitem" style="list-style-type: disc">Using Sencha's native <code class="literal">Ext.device</code> APIs</li><li class="listitem" style="list-style-type: disc">Provisioning iOS applications through the Apple developer portal</li><li class="listitem" style="list-style-type: disc">Compiling a Sencha Touch web application into a native iOS app</li><li class="listitem" style="list-style-type: disc">Compiling a Sencha Touch web application into a native Android  app</li></ul></div><p>In the next chapter, we will take a look at the Sencha Touch Charts package. The Charts package is an add-on to Sencha Touch that will let us use charts and graphs in our applications. We will show you how to take a standard <code class="literal">datastore</code> instance and use it to feed data to your charts and graphs.</p></div></body></html>