<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Building OAuth Strategies with passport.js</h1>
                </header>
            
            <article>
                
<p class="mce-root">In the preceding chapter, we discussed the passport-JWT strategy. We discussed how to leverage the JWT package to build a robust user on-boarding process. We covered how to implement the signup and sign-in process for a user. In this chapter, we will dive into the following parts:</p>
<ul>
<li><kbd>passport.js</kbd> <span>Facebook</span> Strategy</li>
<li><kbd>passport<span>.js</span></kbd> <span>Twitter</span> Strategy</li>
<li><kbd>passport.j<span>s</span></kbd> <span>Google</span> Strategy</li>
<li><kbd>passport<span>.js</span></kbd> LinkedIn Strategy</li>
</ul>
<p><span>All t</span>hese parts individually consume a lot of time if we set out to do them from scratch. <kbd>passport.js</kbd> provides a simpler way to integrate all these strategies in a very flexible way, and also makes them easier to implement.</p>
<p><strong>OAuth</strong> is an authentication protocol that lets users log in via different external services. For example, logging in to an application via Facebook or Twitter does not require a user to provide their username and password if the user is already logged in to Facebook or Twitter. It saves the user from setting up a new account in an application, which makes the login process smooth. This makes logging in to an app easier; otherwise, a user first needs to register to our application and then log in using those credentials. Passport's OAuth strategies allow users to log in to our application with a single click if the browser remembers the account. Everything else is done automatically and is handled by the strategy itself.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Passport's Facebook Strategy</h1>
                </header>
            
            <article>
                
<p>Passport's Facebook Strategy is easy to integrate. As always, let's start with the installation of this strategy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Passport's Facebook Strategy</h1>
                </header>
            
            <article>
                
<p>We can install passport's Facebook Strategy by running the following command:</p>
<pre><strong>$ npm install <span>passport-facebook --save</span></strong></pre>
<p>The following code should add the package to your <kbd>package.json</kbd> file:</p>
<pre>...<br/>"node-sass": "^4.7.2",<br/>"nodemon": "^1.14.10",<br/>"passport": "^0.4.0",<br/><strong>"passport-facebook": "^2.1.1",</strong><br/>...</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Passport's Facebook Strategy</h1>
                </header>
            
            <article>
                
<p>There are a few steps to configure the Passport's Facebook Strategy. We will discuss each step in detail:</p>
<ol>
<li>Create and set up a Facebook app. This will provide us with an <kbd>App ID</kbd> and an <kbd>App Secret</kbd>.</li>
<li>Add a button to our login page that allows our users to log in via Facebook.</li>
<li>Add the necessary routes for Facebook authentication.</li>
<li>Add a middleware method to check whether authentication is successful.</li>
</ol>
<p>Let's dive into the details for each of the preceding steps.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and setting up a Facebook app</h1>
                </header>
            
            <article>
                
<p>To be able to use the Facebook Strategy, you have to build a Facebook application first. The developers, portal for Facebook is at <a href="https://developers.facebook.com/">https://developers.facebook.com/</a>.</p>
<p>After logging in, click on the <span class="packt_screen">Get Started</span> button and then click on <span class="packt_screen">Next</span>.</p>
<p>Then, you will see a drop-down menu in the top-right corner of the screen called <span class="packt_screen">My Apps</span>, where you can find the option to create a new application.</p>
<p>Choose a display name that you want to name your application. In this case, we will name it <kbd>movie_rating_app</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c16be676-d69d-40a3-be90-e4592e943604.png"/></div>
<p>Click on <span class="packt_screen">Create App ID</span>. If you go the settings page, you will see the <span class="packt_screen">App ID</span> and <span class="packt_screen">App Secret</span> for your application:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/f449d1c8-dae4-4401-8070-966e4455aaec.png"/></div>
<p>You will be needing the values mentioned in the preceding screenshot.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a button to our login page that allows users to log in via Facebook</h1>
                </header>
            
            <article>
                
<p>The next step is to add a <span class="packt_screen">LOGIN WITH FACEBOOK</span> button in your login page, which you will be linking to your Facebook application. Replace the contents of <kbd>Login.vue</kbd>, with the following:</p>
<pre>&lt;template&gt;<br/>  <strong>&lt;div&gt;</strong><br/>    <strong>&lt;div class="login"&gt;</strong><br/>      <strong>&lt;a class="btn facebook" href="/login/facebook"&gt; LOGIN WITH FACEBOOK&lt;/a&gt;</strong><br/><strong>    &lt;/div&gt;</strong><br/>    &lt;v-form v-model="valid" ref="form" lazy-validation&gt;<br/>      &lt;v-text-field<br/>        label="Email"<br/>        v-model="email"<br/>        :rules="emailRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-text-field<br/>        label="Password"<br/>        v-model="password"<br/>        :rules="passwordRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-btn<br/>        @click="submit"<br/>        :disabled="!valid"<br/>      &gt;<br/>        submit<br/>      &lt;/v-btn&gt;<br/>      &lt;v-btn @click="clear"&gt;clear&lt;/v-btn&gt;&lt;br/&gt;<br/>    &lt;/v-form&gt;<br/>  <strong>&lt;/div&gt;</strong><br/>&lt;/template&gt;<br/>...</pre>
<p>Let's also add some styling to these buttons. In <kbd>src/assets/stylesheets/home.css</kbd>, add the following code:</p>
<pre>#app {<br/>  font-family: 'Avenir', Helvetica, Arial, sans-serif;<br/>  -webkit-font-smoothing: antialiased;<br/>  -moz-osx-font-smoothing: grayscale;<br/>  text-align: center;<br/>  color: #2c3e50;<br/>  width: 100%;<br/>}<br/><br/>#inspire {<br/>  font-family: 'Avenir', Helvetica, Arial, sans-serif;<br/>}<br/><br/>.container.fill-height {<br/>  align-items: normal;<br/>}<br/><br/>a.side_bar_link {<br/>  text-decoration: none;<br/>}<br/><br/>.card__title--primary, .card__text {<br/>  text-align: left;<br/>}<br/><br/>.card {<br/>  height: 100% !important;<br/>}<br/><br/><strong>.btn.facebook {</strong><br/><strong>  background-color: #3b5998 !important;</strong><br/><strong>  border-color: #2196f3;</strong><br/><strong>  color: #fff !important;</strong><br/><strong>}</strong><br/><br/><strong>.btn.twitter {</strong><br/><strong>  background-color: #2196f3 !important;</strong><br/><strong>  border-color: #2196f3;</strong><br/><strong>  color: #fff !important;</strong><br/><strong>}</strong><br/><br/><strong>.btn.google {</strong><br/><strong>  background-color: #dd4b39 !important;</strong><br/><strong>  border-color: #dd4b39;</strong><br/><strong>  color: #fff !important;</strong><br/><strong>}</strong><br/><br/><strong>.btn.linkedin {</strong><br/><strong>  background-color: #4875B4 !important;</strong><br/><strong>  border-color: #4875B4;</strong><br/><strong>  color: #fff !important;</strong><br/><strong>}</strong></pre>
<p>The preceding code will add a <span class="packt_screen">LOGIN WITH FACEBOOK</span> button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/c49cfff2-17ec-4208-9611-efb6650fd253.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding configurations for Facebook app</h1>
                </header>
            
            <article>
                
<p>Let's configure the Facebook Strategy just as we did for the local strategy. We will create a separate file to handle Facebook login so that the code is simpler. Let's create a file called <kbd>facebook.js</kbd> inside the <kbd>controllers</kbd> folder and add the following contents to it:</p>
<pre><strong>const User = require('../models/User.js');</strong><br/><strong>const passport = require('passport');</strong><br/><strong>const config = require('./../config/Config');</strong><br/><strong>const Strategy = require('passport-facebook').Strategy;</strong><br/><br/><strong>module.exports.controller = (app) =&gt; {</strong><br/><strong>  // facebook strategy</strong><br/><strong>  passport.use(new Strategy({</strong><br/><strong>    clientID: config.FACEBOOK_APP_ID,</strong><br/><strong>    clientSecret: config.FACEBOOK_APP_SECRET,</strong><br/><strong>    callbackURL: '/login/facebook/return',</strong><br/><strong>    profileFields: ['id', 'displayName', 'email']</strong><br/><strong>  },</strong><br/><strong>  (accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    // Handle facebook login</strong><br/><strong>  }));</strong><br/><strong>};</strong></pre>
<p>In the preceding code, the first line inside the <kbd>exports</kbd> method imports the Facebook Strategy. The configuration takes three parameters: <kbd>clientID</kbd>, <kbd>clientSecret</kbd>, and callback URL. <kbd>clientID</kbd> and <kbd>clientSecret</kbd> are the <kbd>App ID</kbd> and <kbd>App Secret</kbd> for your Facebook app, respectively.</p>
<p>Let's add those secrets into our config file. In <kbd>config/Config.js</kbd>, let's add our Facebook keys, the <kbd>facebook_client_id</kbd> and <kbd>facebook_client_secret</kbd>:</p>
<pre>module.exports = {<br/>  DB: 'mongodb://localhost/movie_rating_app',<br/>  SECRET: 'movieratingappsecretkey',<br/>  <strong>FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,</strong><br/><strong>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;</strong><br/>}</pre>
<p>The callback URL is the URL that you want to route your application to after the successful transaction with Facebook.</p>
<p>The callback we have defined here is <kbd>http://127.0.0.1:8081/login/facebook/return</kbd>, which we have to define. The configuration is followed by a function that takes the following four parameters:</p>
<ul>
<li><kbd>accessToken</kbd></li>
<li><kbd>refreshToken</kbd></li>
<li><kbd>profile</kbd></li>
<li><kbd>cb</kbd> (callback)</li>
</ul>
<p>Upon successful request, our application will get redirected to the home page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding necessary routes for Facebook login</h1>
                </header>
            
            <article>
                
<p>Now, let's go ahead and add the necessary routes for when we click on the login button and when we receive the callback from Facebook. In the same file, <kbd>facebook.js</kbd>, add the following routes:</p>
<pre>const User = require("../models/User");<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // facebook strategy<br/>  const Strategy = require('passport-facebook').Strategy;<br/><br/>  passport.use(new Strategy({<br/>    clientID: config.FACEBOOK_APP_ID,<br/>    clientSecret: config.FACEBOOK_APP_SECRET,<br/>    callbackURL: '/api/login/facebook/return',<br/>    profileFields: ['id', 'displayName', 'email']<br/>  },<br/>  function(accessToken, refreshToken, profile, cb) {<br/>  }));<br/><br/>  <strong>app.get('/login/facebook',</strong><br/><strong>    passport.authenticate('facebook', { scope: ['email'] }));</strong><br/><br/><strong>  app.get('/login/facebook/return',</strong><br/><strong>    passport.authenticate('facebook', { failureRedirect: '/login' }),</strong><br/><strong>    (req, res) =&gt; {</strong><br/><strong>      res.redirect('/');</strong><br/><strong>    });</strong><br/>}</pre>
<p>In the preceding code, we have added two routes. If you remember, in <kbd>Login.vue</kbd>, we have added a link to <kbd>http://127.0.0.1:8081/login/facebook</kbd>, which will be served by the first route that we defined here.</p>
<p>Also, if you recall, in the configuration setting, we have added a callback function that will be served by the second route, which we have defined here as well.</p>
<p>Now, the final thing to do is to actually log in the user using the strategy. Replace the contents of <kbd>facebook.js</kbd> with the following:</p>
<pre>const User = require('../models/User.js');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-facebook').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // facebook strategy<br/>  passport.use(new Strategy({<br/>    clientID: config.FACEBOOK_APP_ID,<br/>    clientSecret: config.FACEBOOK_APP_SECRET,<br/>    callbackURL: '/login/facebook/return',<br/>    profileFields: ['id', 'displayName', 'email'],<br/>  },<br/>  <strong>(accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    const email = profile.emails[0].value;</strong><br/><strong>    User.getUserByEmail(email, (err, user) =&gt; {</strong><br/><strong>      if (!user) {</strong><br/><strong>        const newUser = new User({</strong><br/><strong>          fullname: profile.displayName,</strong><br/><strong>          email,</strong><br/><strong>          facebookId: profile.id,</strong><br/><strong>        });</strong><br/><strong>        User.createUser(newUser, (error) =&gt; {</strong><br/><strong>          if (error) {</strong><br/><strong>            // Handle error</strong><br/><strong>          }</strong><br/><strong>          return cb(null, user);</strong><br/><strong>        });</strong><br/><strong>      } else {</strong><br/><strong>        return cb(null, user);</strong><br/><strong>      }</strong><br/><strong>      return true;</strong><br/><strong>    });</strong><br/><strong>  }));</strong><br/><br/>  app.get('/login/facebook',<br/>    passport.authenticate('facebook', { scope: ['email'] }));<br/><br/>  app.get('/login/facebook/return',<br/>    passport.authenticate('facebook', { failureRedirect: '/login' }),<br/>    (req, res) =&gt; {<br/>      res.redirect('/');<br/>    });<br/>};</pre>
<p>While logging in with the Facebook login, if the user already exists in our database, the user simply gets logged in and saved in the session. The session data is not stored in the browser cookies but on the server-side itself. If <span>the user doesn't exist in our database</span>, then we create a new user with the provided email from Facebook.</p>
<p>The last thing to configure here is to add the return URLs or the redirect URL from Facebook to our application. For this, we can add the URLs in the <span class="packt_screen">App Settings</span> page in Facebook. In the app <kbd>Settings</kbd> page, under the <span><kbd>Valid OAuth Redirect URIs</kbd>, add the redirect URLs to our application from Facebook.</span></p>
<p>Now, we should be able to log in via Facebook. When the <kbd>login</kbd> function is successful, it will redirect the user to the home page. If you notice, Facebook redirects us to <kbd>http://localhost:8081/#<em>=</em> </kbd>instead of just <kbd>http://localhost:8081</kbd>. This is because of a security vulnerability. We can remove the <kbd>#</kbd> from the URL by adding the following piece of code in the main file, which is <kbd>index.html</kbd>:</p>
<pre>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width,initial-scale=1.0"&gt;<br/>    &lt;link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet"&gt;<br/>    &lt;link href="https://unpkg.com/vuetify/dist/vuetify.min.css" rel="stylesheet"&gt;<br/>    &lt;title&gt;movie_rating_app&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="app"&gt;&lt;/div&gt;<br/>    &lt;!-- built files will be auto injected --&gt;<br/>  &lt;/body&gt;<br/>  <strong>&lt;script type="text/javascript"&gt;</strong><br/><strong>    if (window.location.hash == '#_=_'){</strong><br/><strong>      history.replaceState</strong><br/><strong>          ? history.replaceState(null, null, window.location.href.split('#')[0])</strong><br/><strong>          : window.location.hash = '';</strong><br/><strong>    }</strong><br/><strong>  &lt;/script&gt;</strong><br/>&lt;/html&gt;</pre>
<p>This will remove the <kbd>#</kbd> symbol from the preceding URL. When you are successfully logged in, we should see your email in the top bar view similar to this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e9a8c95b-fcd9-4d90-9d01-6673e544d493.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Passport's Twitter Strategy</h1>
                </header>
            
            <article>
                
<p>The next strategy is Passport's Twitter Strategy.  Let's start with the installation of this strategy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Passport's Twitter Strategy</h1>
                </header>
            
            <article>
                
<p>Run the following command to install the Twitter Strategy:</p>
<pre><strong>$ npm install <span>passport-twitter --save</span></strong></pre>
<p>The preceding command should add the package to your <kbd>package.json</kbd> file:</p>
<pre>...<br/>"node-sass": "^4.7.2",<br/>"nodemon": "^1.14.10",<br/>"passport": "^0.4.0",<br/><strong>"passport-twitter": "^2.1.1",</strong><br/>...</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Passport's Twitter Strategy</h1>
                </header>
            
            <article>
                
<p>Just like Facebook Strategy, we have to perform the following steps to configure passport's Twitter Strategy: </p>
<ol>
<li>Creating and setting up a Twitter application. This will provide us with a consumer key (API Key) and a consumer secret (API Secret).</li>
<li>Adding a button to our login page that allows our users to <span class="packt_screen">LOGIN WITH TWITTER</span>.</li>
<li>Adding the necessary routes.</li>
<li>Adding a middleware method to check authentication.</li>
<li>Redirecting the user to the home page after redirection and displaying the logged-in user's email in the top bar.</li>
</ol>
<p>Let's dive into the details for each of the preceding steps.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and setting up a Twitter app</h1>
                </header>
            
            <article>
                
<p>Just as with Facebook Strategy, to be able to use the Twitter Strategy, we have to build a Twitter application as well. The developers' portal for Twitter is at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>, where you will see a list of all of your applications. If this is new, you will see a button to create a new application—click on <span class="packt_screen">Create your Twitter application</span>.</p>
<p>You will see a form, which will ask you to fill in the application name and other details. You can name the application whatever you want. For this application, we will name the application <kbd>movie_rating_app</kbd>. For the callback URL, we have provided <kbd>http://localhost:8081/login/twitter/return</kbd>, which we will have to define later:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/201cae01-374c-4749-9d30-7da5d1d2add5.png"/></div>
<p>Upon successful creation of the application, you can see the API Key (Consumer Key) and API Secret <span>(Consumer Secret) in the</span> <span class="packt_screen">Keys and Access Tokens</span><span> tab:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-565 image-border" src="assets/65e39922-dee4-4d3d-9352-3f2b19f5af24.png" style="width:47.42em;height:35.58em;"/></div>
<p>These tokens will be used for authentication in our application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a button to our login page that allows users to log in via Twitter</h1>
                </header>
            
            <article>
                
<p>The next step is to add a <span class="packt_screen">LOGIN WITH TWITTER</span> button in our login page, which we will link to our Twitter application that we just created.</p>
<p>In <kbd>Login.vue</kbd>, add a link to log in via Twitter with the following:</p>
<pre>&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div class="login"&gt;<br/>      &lt;a class="btn facebook" href="/login/facebook"&gt; LOGIN WITH FACEBOOK&lt;/a&gt;<br/>       <strong>&lt;a class="btn twitter" href="/login/twitter"&gt; <span>LOGIN WITH TWITTER</span>&lt;/a&gt;</strong><br/>    &lt;/div&gt;<br/>    &lt;v-form v-model="valid" ref="form" lazy-validation&gt;<br/>      &lt;v-text-field<br/>        label="Email"<br/>        v-model="email"<br/>        :rules="emailRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>...</pre>
<p>The preceding code will add a <span class="packt_screen">LOGIN WITH TWITTER</span> button. Let's run the following command:</p>
<pre><strong>$ npm run build</strong></pre>
<p><span><span>Now, if we visit the URL <kbd>http://localhost:8080/users/login</kbd>, we should see the following page:</span></span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/7252b3ec-3ecd-4607-9c42-d7dd9bd95592.png" style="width:40.33em;height:22.42em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding configurations for Twitter App</h1>
                </header>
            
            <article>
                
<p>Now, the next step is to add the necessary routes for the Twitter login. For this, we will need to configure the settings and callback URL. Just like we did for the Facebook Strategy, let's create a separate file to set up our Twitter login. Let's create a new file inside the <kbd>controllers</kbd> directory called <kbd>twitter.js</kbd> and add the following contents:</p>
<pre><strong>const User = require('../models/User.js');</strong><br/><strong>const passport = require('passport');</strong><br/><strong>const config = require('./../config/Config');</strong><br/><strong>const Strategy = require('passport-twitter').Strategy;</strong><br/><br/><strong>module.exports.controller = (app) =&gt; {</strong><br/><strong>  // twitter strategy</strong><br/><strong>  passport.use(new Strategy({</strong><br/><strong>    consumerKey: config.TWITTER_APP_ID,</strong><br/><strong>    consumerSecret: config.TWITTER_APP_SECRET,</strong><br/><strong>    callbackURL: '/login/twitter/return',</strong><br/><strong>    profileFields: ['id', 'displayName', 'email'],</strong><br/><strong>  },</strong><br/><strong>  (accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    // Handle twitter login</strong><br/><strong>  }));</strong><br/><strong>};</strong></pre>
<p>As we did in the Facebook Strategy, the first line imports the Twitter Strategy. The configuration takes the following three parameters: <kbd>clientID</kbd>, <kbd>clientSecret</kbd>, and a callback URL. The <kbd>consumerKey</kbd> and <kbd>consumerSecret</kbd> are the <kbd>App ID</kbd> and <kbd>App Secret</kbd> for your Twitter application app, respectively.</p>
<p>Let's add those secrets into our config file. In<span> </span><kbd>config/Config.js</kbd>, add the <kbd>Facebook client ID</kbd> and <kbd>Facebook Client Secret</kbd>:</p>
<pre>module.exports = {<br/>  DB: 'mongodb://localhost/movie_rating_app',<br/>  SECRET: 'movieratingappsecretkey',<br/>  FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,<br/>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;,<strong><br/>  TWITTER_APP_ID: &lt;twitter_consumer_id&gt;,<br/>  TWITTER_APP_SECRET: &lt;twitter_consumer_secret&gt;</strong><br/>}</pre>
<p>The callback URL is the URL that you want to route your application to after the successful transaction with Twitter.</p>
<p>The callback we have defined in the [preceding piece of code is <kbd>http://localhost:8081/login/twitter/return</kbd>, which we have to define. The configuration is followed by a function that takes the following four parameters:</p>
<ul>
<li><kbd>accessToken</kbd></li>
<li><kbd>refreshToken</kbd></li>
<li><kbd>profile</kbd></li>
<li><kbd>cb</kbd> (callback)</li>
</ul>
<p>Upon a successful request, our application will get redirected to the home page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding necessary routes for Twitter login</h1>
                </header>
            
            <article>
                
<p>Now, let's add the necessary routes for when we click on the <kbd>Login</kbd> button and when we receive the callback from Twitter. <span>In the same file,</span> <kbd>twitter.js</kbd><span>, add the following routes:</span></p>
<pre>const User = require('../models/User.js');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-twitter').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // twitter strategy<br/>  passport.use(new Strategy({<br/>    consumerKey: config.TWITTER_APP_ID,<br/>    consumerSecret: config.TWITTER_APP_SECRET,<br/>    callbackURL: '/login/twitter/return',<br/>    profileFields: ['id', 'displayName', 'email'],<br/>  },<br/>  (accessToken, refreshToken, profile, cb) =&gt; {<br/>    // Handle twitter login<br/>  }));<br/><br/>  <strong>app.get('/login/google',</strong><br/><strong>    passport.authenticate('google', { scope: ['email'] }));</strong><br/><br/><strong>  app.get('/login/google/return',</strong><br/><strong>    passport.authenticate('google', { failureRedirect: '/login' }),</strong><br/><strong>    (req, res) =&gt; {</strong><br/><strong>      res.redirect('/');</strong><br/><strong>    });</strong><br/>};</pre>
<p>In the preceding code, we have added two routes: <kbd>/login/google</kbd> and <kbd>/login/google/return</kbd>. If you remember, in <kbd>Login.vue</kbd>, we have added a link to <kbd>http://localhost:8081/login/twitter</kbd>, which will be served by the first route that we defined here.</p>
<p><span>Now, the final thing to do is to actually log in the user using the strategy. Replace the contents of <kbd>twitter.js</kbd> with the following:</span></p>
<pre>const User = require('../models/User.js');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-twitter').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // twitter strategy<br/>  passport.use(new Strategy({<br/>    consumerKey: config.TWITTER_APP_ID,<br/>    consumerSecret: config.TWITTER_APP_SECRET,<br/>    <strong>userProfileURL: 'https://api.twitter.com/1.1/account/verify_credentials.json?include_email=true',</strong><br/>    callbackURL: '/login/twitter/return',<br/>  },<br/>  <strong>(accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    const email = profile.emails[0].value;</strong><br/><strong>    User.getUserByEmail(email, (err, user) =&gt; {</strong><br/><strong>      if (!user) {</strong><br/><strong>        const newUser = new User({</strong><br/><strong>          fullname: profile.displayName,</strong><br/><strong>          email,</strong><br/><strong>          facebookId: profile.id,</strong><br/><strong>        });</strong><br/><strong>        User.createUser(newUser, (error) =&gt; {</strong><br/><strong>          if (error) {</strong><br/><strong>            // Handle error</strong><br/><strong>          }</strong><br/><strong>          return cb(null, user);</strong><br/><strong>        });</strong><br/><strong>      } else {</strong><br/><strong>        return cb(null, user);</strong><br/><strong>      }</strong><br/><strong>      return true;</strong><br/><strong>    });</strong><br/><strong>  }));</strong><br/><br/>  app.get('/login/twitter',<br/>    passport.authenticate('twitter', { scope: ['email'] }));<br/><br/>  app.get('/login/twitter/return',<br/>    passport.authenticate('twitter', { failureRedirect: '/login' }),<br/>    (req, res) =&gt; {<br/>      res.redirect('/');<br/>    });<br/>};</pre>
<p>We have to consider a few things here. Twitter does not allow us to access the user's email address by default. For that, we will need to check a field called <span class="packt_screen">Request email addresses from users</span> <span>while setting up the Twitter application, which can be found under the</span> <span class="packt_screen">Permissions</span><span> tab.</span></p>
<p class="mce-root">Before we do that, we also need to set the <span class="packt_screen">Privacy Policy URL</span> and <span class="packt_screen">Terms of Service URL</span> in order to request the user's access to their email address. This setting can be found under the <span class="packt_screen">Settings</span> tab:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/553ca72b-d8a4-441b-a4cd-859b3e3454eb.png"/></div>
<p>Fill in the privacy policy and terms of service URLs, and then under the <span class="packt_screen">Permissions</span> tab, check the checkbox that says <span class="packt_screen">Request email addresses from users</span> and click on <span class="packt_screen">Update</span> <span class="packt_screen">Settings</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/4e38f0c5-dd9f-4ded-b1e5-52d1007e2509.png"/></div>
<p>The last thing we also need is to specify the resource URL to be able to access the email address, which we do by adding the following in <kbd>twitter.js</kbd>:</p>
<pre>...<br/>passport.use(new Strategy({<br/>    consumerKey: config.TWITTER_APP_ID,<br/>    consumerSecret: config.TWITTER_APP_SECRET,<br/>    <strong>userProfileURL: <br/>    "https://api.twitter.com/1.1/account/verify_credentials.json?   <br/>    include_email=true",</strong><br/>    callbackURL: '/login/twitter/return',<br/>  },<br/>...</pre>
<p>Now, everything is ready to go for the Twitter login. We should be able to log in successfully with the <span><span class="packt_screen">LOGIN WITH TWITTER</span></span> button now.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Passport's Google strategy</h1>
                </header>
            
            <article>
                
<p>The next strategy is the Passport's Google Strategy.  Let's start with the installation of this strategy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Passport's Google strategy</h1>
                </header>
            
            <article>
                
<p>Run the following command to install Passport's Google strategy:</p>
<pre><strong>$ npm install passport-google-oauth20 --save</strong></pre>
<p>The preceding command should add the package to your <kbd>package.json</kbd> file:</p>
<pre>...<br/>"node-sass": "^4.7.2",<br/>"nodemon": "^1.14.10",<br/>"passport": "^0.4.0",<br/><strong>"passport-google-oauth20": "^1.0.0",</strong><br/>...</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Passport's Google strategy</h1>
                </header>
            
            <article>
                
<p>The configuration for all the strategies is somewhat similar. For the Google strategy, the following are the steps we have to follow for configuration:</p>
<ol>
<li>Creating and registering an application on Google. This will provide us with a consumer key (API key) and a consumer secret (API secret).</li>
<li>Adding a button to our login page that allows our users to log in via Google.</li>
<li>Adding the necessary routes.</li>
<li>Adding a middleware method to check authentication.</li>
<li>Redirecting the user to the home page and displaying the logged-in user's email in the top bar.</li>
</ol>
<p>Let's dive into the details for each of the preceding steps.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and setting up a Google app</h1>
                </header>
            
            <article>
                
<p>Just as we did for the Facebook and Twitter strategies, to be able to use the Google Strategy, we have to build a Google application. The developers, portal for Google is at <a href="https://console.developers.google.com/">https://console.developers.google.com/</a>. </p>
<p>Then, click on the drop-down list of the projects, which lies at the top-left corner of the page. A popup will show up. Then, click on the <span class="packt_screen">+</span> icon to create a new application.</p>
<p>You just have to add the name of your application. We will name the application <em>movieratingapp</em>, as Google does not allow underscores or any other special characters:  </p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-568 image-border" src="assets/1fe5003c-736e-440f-b59e-b0383aa820f7.png" style="width:152.75em;height:106.50em;"/></div>
<p><span>When the application gets created successfully, click on</span> <span class="packt_screen">Credentials</span><span> and</span> <kbd>Create</kbd> and<span><span class="packt_screen"> </span>then on</span> <span class="packt_screen">OAuth Client ID</span> <span>to generate the app tokens. To generate the tokens, we will first need to</span> <span class="packt_screen">Enable</span> <span>the</span> Google+ API <span>via</span> Developer Console <span>at <a href="https://console.developers.google.com/">https://console.developers.google.com/</a>.</span></p>
<p>It then takes us to the <kbd>Create Consent</kbd> page, where we need to fill in some information about our application. After that, on the <span class="packt_screen">Credentials</span> page, we will be able to view our <kbd>Client ID</kbd> and <kbd>Client Secret</kbd>.</p>
<p><span>These tokens will be used to verify the authentication in our application:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-569 image-border" src="assets/5d509cd5-ae77-4ee8-8d96-4d53b7378e5b.png" style="width:162.50em;height:68.00em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a button to our login page that allows users to log in via Google</h1>
                </header>
            
            <article>
                
<p>The next step is to add a <span class="packt_screen">LOGIN WITH GOOGLE</span> button in our login page, which we will be linking to our Google application that we just created:</p>
<pre>&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div class="login"&gt;<br/>       &lt;a class="btn facebook" href="/login/facebook"&gt; LOGIN WITH FACEBOOK&lt;/a&gt;<br/>       &lt;a class="btn twitter" href="/login/twitter"&gt; <span>LOGIN WITH TWITTER</span>&lt;/a&gt;<br/>       <strong>&lt;a class="btn google" href="/login/google"&gt; LOGIN WITH GOOGLE&lt;/a&gt;</strong><br/><strong>    &lt;/div&gt;</strong><br/>    &lt;v-form v-model="valid" ref="form" lazy-validation&gt;<br/>      &lt;v-text-field<br/>        label="Email"<br/>        v-model="email"<br/>        :rules="emailRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-text-field<br/>        label="Password"<br/>        v-model="password"<br/>        :rules="passwordRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-btn<br/>        @click="submit"<br/>        :disabled="!valid"<br/>      &gt;<br/>        submit<br/>      &lt;/v-btn&gt;<br/>      &lt;v-btn @click="clear"&gt;clear&lt;/v-btn&gt;&lt;br/&gt;<br/>    &lt;/v-form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>...</pre>
<p>The preceding code will add a <span class="packt_screen">LOGIN WITH GOOGLE</span> button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b72db97e-b9df-4aea-ba88-23eb2c5e7c6e.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding configurations for Google app</h1>
                </header>
            
            <article>
                
<p><span>Let's configure the Google Strategy just as we did for the Facebook and Twitter strategies. We will create a separate file to handle Google login so that the code is simple. Let's create a file called </span><kbd>google.js</kbd><span> inside the </span><kbd>controllers</kbd><span> folder and add the following contents to it:</span></p>
<pre><strong>const User = require('../models/User');</strong><br/><strong>const passport = require('passport');</strong><br/><strong>const config = require('./../config/Config');</strong><br/><strong>const Strategy = require('passport-google-oauth20').OAuth2Strategy;</strong><br/><br/><strong>module.exports.controller = (app) =&gt; {</strong><br/><strong>  // google strategy</strong><br/><strong>  passport.use(new Strategy({</strong><br/><strong>    clientID: config.GOOGLE_APP_ID,</strong><br/><strong>    clientSecret: config.GOOGLE_APP_SECRET,</strong><br/><strong>    callbackURL: '/login/google/return',</strong><br/><strong>  },</strong><br/><strong>  (accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    // Handle google login</strong><br/><strong>  }));</strong><br/><strong>};</strong></pre>
<p>As we did in the Facebook and Twitter strategies, the first line imports the Google Strategy. The configuration takes the following three parameters: <kbd>clientID</kbd>, <kbd>clientSecret</kbd>, and callback URL. The <kbd>clientID</kbd> and <kbd>clientSecret</kbd> are the <kbd>App ID</kbd> and <kbd>App Secret</kbd> of the Google application we just created.</p>
<p>Let's add those secrets into our <kbd>config</kbd> file. In<span> </span><kbd>config/Config.js</kbd>, add the <kbd>facebook_client_id</kbd> and <kbd>facebook_client_secret</kbd>:</p>
<pre>module.exports = {<br/>  DB: 'mongodb://localhost/movie_rating_app',<br/>  SECRET: 'movieratingappsecretkey',<br/>  FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,<br/>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;,<br/>  TWITTER_APP_ID: &lt;twitter_client_id&gt;,<br/>  TWITTER_APP_SECRET: &lt;twitter_client_secret&gt;,<strong><br/>  GOOGLE_APP_ID: &lt;google_client_id&gt;,<br/>  GOOGLE_APP_SECRET: &lt;google_client_secret&gt;</strong><br/>}</pre>
<p>The callback URL is the URL that you want to route your application to after the successful transaction with Google.</p>
<p>The callback we just added is <kbd>http://127.0.0.1:8081/login/google/return</kbd>, which we have to define. The configuration is followed by a function that takes the following four parameters:</p>
<ul>
<li><kbd>accessToken</kbd></li>
<li><kbd>refreshToken</kbd></li>
<li><kbd>profile</kbd></li>
<li><kbd>cb</kbd> (callback)</li>
</ul>
<p>Upon a successful request, our application will get redirected to the <kbd>profile</kbd> page, which we are yet to define.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding necessary routes for Google login</h1>
                </header>
            
            <article>
                
<p><span>Now, let's go ahead and add the necessary routes, when we click on the login button and when we receive the callback from Google. In the same file, <kbd>google.js</kbd>, add the following routes:</span></p>
<pre>const User = require('../models/User');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-google-oauth20').OAuth2Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // google strategy<br/>  passport.use(new Strategy({<br/>    clientID: config.GOOGLE_APP_ID,<br/>    clientSecret: config.GOOGLE_APP_SECRET,<br/>    callbackURL: '/login/google/return',<br/>  },<br/>  (accessToken, refreshToken, profile, cb) =&gt; {<br/>    // Handle google login<br/>  }));<br/><br/>  <strong>app.get('/login/google',</strong><br/><strong>    passport.authenticate('google', { scope: ['email'] }));</strong><br/><br/><strong>  app.get('/login/google/return',</strong><br/><strong>    passport.authenticate('google', { failureRedirect: '/login' }),</strong><br/><strong>    (req, res) =&gt; {</strong><br/><strong>      res.redirect('/');</strong><br/><strong>    });</strong><br/>};</pre>
<p>In the preceding code, we have added two routes. If you remember, in <kbd>Login.vue</kbd>, we have added a link to <kbd>http://localhost:8081/login/google</kbd>, which will be served by the first route that we defined here.</p>
<p>Also, if you recall, in the configuration setting, we have added a callback function, which will be served by the second route that we have defined here as well.</p>
<p><span>Now, the final thing to do is to actually log in the user using the strategy. Replace the contents of <kbd>google.js</kbd> with the following:</span></p>
<pre>const User = require('../models/User');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const GoogleStrategy = require('passport-google-oauth20').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // google strategy<br/>  passport.use(new GoogleStrategy({<br/>    clientID: config.GOOGLE_APP_ID,<br/>    clientSecret: config.GOOGLE_APP_SECRET,<br/>    callbackURL: '/login/google/return',<br/>  },<br/>  <strong>(accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    const email = profile.emails[0].value;</strong><br/><strong>    User.getUserByEmail(email, (err, user) =&gt; {</strong><br/><strong>      if (!user) {</strong><br/><strong>        const newUser = new User({</strong><br/><strong>          fullname: profile.displayName,</strong><br/><strong>          email,</strong><br/><strong>          facebookId: profile.id,</strong><br/><strong>        });</strong><br/><strong>        User.createUser(newUser, (error) =&gt; {</strong><br/><strong>          if (error) {</strong><br/><strong>            // Handle error</strong><br/><strong>          }</strong><br/><strong>          return cb(null, user);</strong><br/><strong>        });</strong><br/><strong>      } else {</strong><br/><strong>        return cb(null, user);</strong><br/><strong>      }</strong><br/><strong>      return true;</strong><br/><strong>    });</strong><br/>  }));<br/><br/>  app.get('/login/google',<br/>    passport.authenticate('google', { scope: ['email'] }));<br/><br/>  app.get('/login/google/return',<br/>    passport.authenticate('google', { failureRedirect: '/login' }),<br/>    (req, res) =&gt; {<br/>      res.redirect('/');<br/>    });<br/>};</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Passport's LinkedIn strategy</h1>
                </header>
            
            <article>
                
<p>By now, you must understand quite well how to use each of the strategies provided by <kbd>passport.js</kbd>. Let's quickly revise these using the LinkedIn strategy. This is the last strategy we will be covering in this book. There are several other strategies that you can use according to your needs. You can find the list at <a href="https://github.com/jaredhanson/passport/wiki/Strategies">https://github.com/jaredhanson/passport/wiki/Strategies</a>.</p>
<p>Now, let's start with the installation of this strategy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing Passport's LinkedIn strategy</h1>
                </header>
            
            <article>
                
<p>Run the following command to install the LinkedIn strategy:</p>
<pre><strong>$ npm install passport-linkedin --save</strong></pre>
<p>The preceding command should add the following package to your <kbd>package.json</kbd> file:</p>
<pre>...<br/>"node-sass": "^4.7.2",<br/>"nodemon": "^1.14.10",<br/>"passport": "^0.4.0",<br/><strong>"passport-linkedin-oauth2": "^2.1.1",</strong><br/>...</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring Passport's LinkedIn strategy</h1>
                </header>
            
            <article>
                
<p>The configuration for all the strategies is somewhat similar. So, the following are the steps we have to follow to configure this strategy:</p>
<ol>
<li>Creating and registering an application on LinkedIn. This will provide us with a consumer key (API Key) and a consumer secret (API Secret).</li>
<li>Adding a button to our login page that allows users to log in via LinkedIn.</li>
</ol>
<p> </p>
<ol start="3">
<li>Adding the necessary routes.</li>
<li>Adding a middleware method to check authentication.</li>
<li>Redirecting the user to the home page and displaying the logged in user's email in the top bar.</li>
</ol>
<p>Let's dive into the details for each of the preceding steps.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating and setting up a LinkedIn app</h1>
                </header>
            
            <article>
                
<p>Just like we did for the Facebook and Twitter Strategies, to be able to use the Linkedin Strategy, we have to build a LinkedIn application. The developers, portal for LinkedIn is at <a href="https://www.linkedin.com/developer/apps">https://www.linkedin.com/developer/apps</a>. You will see a list of all of your applications there. You will also note a button to create a new application; click on <span class="packt_screen">Create Application</span>.</p>
<p>We just have to add the name of our application. We can name the application whatever we want, but for our application, we will be naming it <kbd>movie_rating_app</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-573 image-border" src="assets/297423a4-5b9b-4491-997b-e3f203051476.png" style="width:44.25em;height:29.08em;"/></div>
<p><span>Upon successful creation of the application, you can see the API Key (<kbd>clientID</kbd>) and API Secret </span><span>(client secret) in the</span> <span class="packt_screen">Credentials</span><span> tab.</span></p>
<p>These tokens will be used to verify the authentication in our application:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-574 image-border" src="assets/0f34f2eb-7114-47e8-8f88-1ee30738ed2f.png" style="width:53.08em;height:38.75em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a button to our login page that allows users to log in via LinkedIn</h1>
                </header>
            
            <article>
                
<p>The next step is to add a <span class="packt_screen">LOGIN WITH LINKEDIN</span> button in our login page, which we will be linking to our LinkedIn application  that we just created.</p>
<p>In <kbd>Login.vue</kbd>, add the following code:</p>
<pre>&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div class="login"&gt;<br/>      &lt;a class="btn facebook" href="/login/facebook"&gt; LOGIN WITH FACEBOOK&lt;/a&gt;<br/>       &lt;a class="btn twitter" href="/login/twitter"&gt; LOGIN WITH TWITTER&lt;/a&gt;<br/>       &lt;a class="btn google" href="/login/google"&gt; LOGIN WITH GOOGLE&lt;/a&gt;<br/>       <strong>&lt;a class="btn linkedin" href="/login/linkedin"&gt; LOGIN WITH LINKEDIN&lt;/a&gt;</strong><br/>    &lt;/div&gt;<br/>    &lt;v-form v-model="valid" ref="form" lazy-validation&gt;<br/>      &lt;v-text-field<br/>        label="Email"<br/>        v-model="email"<br/>        :rules="emailRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-text-field<br/>        label="Password"<br/>        v-model="password"<br/>        :rules="passwordRules"<br/>        required<br/>      &gt;&lt;/v-text-field&gt;<br/>      &lt;v-btn<br/>        @click="submit"<br/>        :disabled="!valid"<br/>      &gt;<br/>        submit<br/>      &lt;/v-btn&gt;<br/>      &lt;v-btn @click="clear"&gt;clear&lt;/v-btn&gt;&lt;br/&gt;<br/>    &lt;/v-form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/>&lt;script&gt;<br/>  import axios from 'axios';<br/>  import bus from "./../bus.js";<br/><br/>  export default {<br/>    data: () =&gt; ({<br/>      valid: true,<br/>      email: '',<br/>      password: '',<br/>      emailRules: [<br/>        (v) =&gt; !!v || 'E-mail is required',<br/>        (v) =&gt; /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(v) || 'E-mail must be valid'<br/>      ],<br/>      passwordRules: [<br/>        (v) =&gt; !!v || 'Password is required',<br/>      ]<br/>    }),<br/>    methods: {<br/>      async submit () {<br/>        if (this.$refs.form.validate()) {<br/>          return axios({<br/>            method: 'post',<br/>            data: {<br/>              email: this.email,<br/>              password: this.password<br/>            },<br/>            url: '/users/login',<br/>            headers: {<br/>              'Content-Type': 'application/json'<br/>            }<br/>          })<br/>          .then((response) =&gt; {<br/>            localStorage.setItem('jwtToken', response.data.token)<br/>            this.$swal("Good job!", "You are ready to start!", <br/>            "success");<br/>            bus.$emit("refreshUser");<br/>            this.$router.push({ name: 'Home' });<br/>          })<br/>          .catch((error) =&gt; {<br/>            const message = error.response.data.message;<br/>            this.$swal("Oh oo!", `${message}`, "error")<br/>          });<br/>        }<br/>      },<br/>      clear () {<br/>        this.$refs.form.reset()<br/>      }<br/>    }<br/>  }<br/>&lt;/script&gt;</pre>
<p>The preceding code will add a <span class="packt_screen">LOGIN WITH LINKEDIN</span> button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d184e8a0-f2e6-43a4-830e-dbd4248ed8a2.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding configurations for LinkedIn app</h1>
                </header>
            
            <article>
                
<p><span>Let's configure the LinkedIn strategy just as we did for all the other strategies. We will create a separate file to handle LinkedIn login so that the code is simple. Let's create a file called </span><kbd>linkedin.js</kbd><span> inside the </span><kbd>controllers</kbd><span> folder and add the following contents to it:</span></p>
<pre><strong>const User = require('../models/User.js');</strong><br/><strong>const passport = require('passport');</strong><br/><strong>const config = require('./../config/Config');</strong><br/><strong>const Strategy = require('passport-linkedin').Strategy;</strong><br/><br/><strong>module.exports.controller = (app) =&gt; {</strong><br/><strong>  // linkedin strategy</strong><br/><strong>  passport.use(new Strategy({</strong><br/><strong>    consumerKey: config.LINKEDIN_APP_ID,</strong><br/><strong>    consumerSecret: config.LINKEDIN_APP_SECRET,</strong><br/><strong>    callbackURL: '/login/linkedin/return',</strong><br/><strong>    profileFields: ['id', 'first-name', 'last-name', 'email-address']</strong><br/><strong>  },</strong><br/><strong>  (accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    // Handle linkedin login</strong><br/><strong>  }));</strong><br/><strong>};</strong></pre>
<p>In the preceding code, the first line imports the LinkedIn Strategy. The configuration takes the following three parameters: <kbd>clientID</kbd>, <kbd>clientSecret</kbd>, and a callback URL. The <kbd>clientID</kbd> and <kbd>clientSecret</kbd> are the <kbd>App ID</kbd> and <kbd>App Secret</kbd> of the LinkedIn application we just created, respectively.</p>
<p>Let's add those secrets to our <kbd>config</kbd> file. In<span> </span><kbd>config/Config.js</kbd>, add the <kbd>Facebook Client ID</kbd> and <kbd>Facebook Client Secret</kbd>:</p>
<pre>module.exports = {<br/>  DB: 'mongodb://localhost/movie_rating_app',<br/>  SECRET: 'movieratingappsecretkey',<br/>  FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,<br/>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;,<br/>  TWITTER_APP_ID: &lt;twitter_consumer_id&gt;,<br/>  TWITTER_APP_SECRET: &lt;twitter_consumer_secret&gt;,<br/>  GOOGLE_APP_ID: &lt;google_consumer_id&gt;,<br/>  GOOGLE_APP_SECRET: &lt;google_consumer_secret&gt;,<br/> <strong> LINKEDIN_APP_ID: &lt;linkedin_consumer_id&gt;,</strong><br/><strong>  LINKEDIN_APP_SECRET: &lt;linkedin_consumer_secret&gt;</strong><br/>}</pre>
<p>The <kbd>callbackURL</kbd> is the URL that you want to route your application to after the successful transaction with LinkedIn.</p>
<p>The <kbd>callbackURL</kbd> that we have defined in the preceding code is <kbd>http://127.0.0.1:8081/login/linkedin/return</kbd>, which we have to define. The configuration is followed by a function that takes the following four parameters:</p>
<ul>
<li><kbd>accessToken</kbd></li>
<li><kbd>refreshToken</kbd></li>
<li><kbd>profile</kbd></li>
<li><kbd>cb</kbd> (callback)</li>
</ul>
<p>Upon successful request, our application will get redirected to the profile page, which we are yet to define.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding necessary routes for LinkedIn login</h1>
                </header>
            
            <article>
                
<p>Now, let's add the necessary routes for when we click on the <span class="packt_screen">Login</span> button and when we receive the callback from LinkedIn:</p>
<pre>const User = require('../models/User.js');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-linkedin').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // linkedin strategy<br/>  passport.use(new Strategy({<br/>    consumerKey: config.LINKEDIN_APP_ID,<br/>    consumerSecret: config.LINKEDIN_APP_SECRET,<br/>    callbackURL: '/login/linkedin/return',<br/>    profileFields: ['id', 'first-name', 'last-name', 'email-address']<br/>  },<br/>  (accessToken, refreshToken, profile, cb) =&gt; {<br/>    // Handle linkedin login<br/>  }));<br/><br/>  <strong>app.get('/login/linkedin',</strong><br/><strong>    passport.authenticate('linkedin'));</strong><br/><br/><strong>  app.get('/login/linkedin/return',</strong><br/><strong>    passport.authenticate('linkedin', { failureRedirect: '/login' }),</strong><br/><strong>    (req, res) =&gt; {</strong><br/><strong>      res.redirect('/');</strong><br/><strong>    });</strong><br/>};</pre>
<p>In the preceding code, we have added two routes. If you remember, in <kbd>Login.vue</kbd>, we have added a link to <kbd>http://localhost:8081/login/<span>linkedin</span></kbd>, which will be served by the first route that we defined here.</p>
<p>Also, if you recall, in the configuration setting, we have added a callback function that will be served by the second route, which we have defined here as well.</p>
<p><span>Now, the final thing to do is to actually log in the user using the strategy. Replace the contents of <kbd>linkedin.js</kbd> with the following:</span></p>
<pre>const User = require('../models/User');<br/>const passport = require('passport');<br/>const config = require('./../config/Config');<br/>const Strategy = require('passport-linkedin').Strategy;<br/><br/>module.exports.controller = (app) =&gt; {<br/>  // linkedin strategy<br/>  passport.use(new Strategy({<br/>    consumerKey: config.LINKEDIN_APP_ID,<br/>    consumerSecret: config.LINKEDIN_APP_SECRET,<br/>    callbackURL: '/login/linkedin/return',<br/>    profileFields: ['id', 'first-name', 'last-name', 'email-address'],<br/>  },<br/>  <strong>(accessToken, refreshToken, profile, cb) =&gt; {</strong><br/><strong>    const email = profile.emails[0].value;</strong><br/><strong>    User.getUserByEmail(email, (err, user) =&gt; {</strong><br/><strong>      if (!user) {</strong><br/><strong>        const newUser = new User({</strong><br/><strong>          fullname: profile.displayName,</strong><br/><strong>          email: profile.emails[0].value,</strong><br/><strong>          facebookId: profile.id,</strong><br/><strong>        });</strong><br/><strong>        User.createUser(newUser, (error) =&gt; {</strong><br/><strong>          if (error) {</strong><br/><strong>            // Handle error</strong><br/><strong>          }</strong><br/><strong>          return cb(null, user);</strong><br/><strong>        });</strong><br/><strong>      } else {</strong><br/><strong>        return cb(null, user);</strong><br/><strong>      }</strong><br/><strong>      return true;</strong><br/><strong>    });</strong><br/>  }));<br/><br/>  app.get('/login/linkedin',<br/>    passport.authenticate('linkedin'));<br/><br/>  app.get('/login/linkedin/return',<br/>    passport.authenticate('linkedin', { failureRedirect: '/login' }),<br/>    (req, res) =&gt; {<br/>      res.redirect('/');<br/>    });<br/>};</pre>
<p><span>With this, everything is ready to go </span>for<span> the LinkedIn login. We should be able to log in successfully with the</span> <span><span class="packt_screen">LOGIN WITH LINKEDIN</span></span><span> button now.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we covered what OAuth is and how to integrate different varieties of OAuth with our application. We also covered Facebook, Twitter, Google, and LinkedIn strategies provided by <kbd>passport.js</kbd>. If you want to explore a different strategy, a good list of available packages is available at<a href="https://github.com/jaredhanson/passport/wiki/Strategies"> https://github.com/jaredhanson/passport/wiki/Strategies</a>.</p>
<p>In the next chapter, we will find out more about what <kbd>Vuex</kbd> is and how can we use <kbd>Vuex</kbd> to simplify our application.</p>


            </article>

            
        </section>
    </body></html>