<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Views</h1></div></div></div><p>In this chapter, we will cover the following areas:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rendering a view</li><li class="listitem" style="list-style-type: disc">Dealing with a view element using jQuery</li><li class="listitem" style="list-style-type: disc">Rendering a model in a view</li><li class="listitem" style="list-style-type: disc">Rendering a collection in a view</li><li class="listitem" style="list-style-type: disc">Splitting a view into subviews</li><li class="listitem" style="list-style-type: disc">Handling <strong>Document Object Model</strong> (<strong>DOM</strong>) events in a view</li><li class="listitem" style="list-style-type: disc">Switching views using Backbone.Router</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Introduction</h1></div></div></div><p>This chapter is devoted to the view object in Backbone.js; it is used for rendering data into HTML code. A view<a class="indexterm" id="id314"/> can be bound to the HTML element in the DOM tree and can handle its events and events for its child elements.</p><p>Models<a class="indexterm" id="id315"/> and collections<a class="indexterm" id="id316"/> are typically rendered with the help of a view that acts as an interactive bridge between business logic and a user. For example, a view can listen to DOM events and as a result, manipulate models and collections or navigate the user to a different page. The process can also go in a reverse direction: changes in models and collections trigger a view update, and so changes in a DOM tree are made.</p><p>A Backbone view relies on frontend JavaScript libraries, such as jQuery<a class="indexterm" id="id317"/> or Zepto<a class="indexterm" id="id318"/> when dealing with HTML elements and handling their events.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Rendering a view</h1></div></div></div><p>When we want to output any data to the user, we should typically do it with the help of a Backbone view. In this recipe, we are going to create a simple view and render it.</p><p>Our result will look like the following screenshot:</p><div><img alt="Rendering a view" src="img/2728_04_01.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec115"/>How to do it...</h2></div></div></div><p>Follow the ensuing steps to <a class="indexterm" id="id319"/>create a simple view and render it.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a new view by extending the <code class="literal">Backbone.View</code> object:<div><pre class="programlisting">  var InvoiceItemView = Backbone.View.extend({
    
    // HTML element name, where to render a view.
    el: 'body',

    // Initialize view object values.
    initialize: function() {
      this.html = 'Description: Wooden Toy House. ' +
        'Price: $22. Quantity: 3.'
    },

    // Render view.
    render: function() {
      // Set html for the view element using jQuery.
      $(this.el).html(this.html);
    }
  });</pre></div></li><li class="listitem">Create an instance of the view:<div><pre class="programlisting">    var invoiceItemView = new InvoiceItemView();</pre></div></li><li class="listitem">Call the <code class="literal">render()</code> method manually<a class="indexterm" id="id320"/> to output HTML code to the user:<div><pre class="programlisting">    invoiceItemView.render();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec116"/>How it works...</h2></div></div></div><p>In the <code class="literal">initialize()</code> method of the view, we generate the HTML code and save it in the <code class="literal">html</code> property, which we have been using lately in the<a class="indexterm" id="id321"/> <code class="literal">render()</code> method, where we assign this code to the HTML container defined by the <code class="literal">el</code> property. To do so, we invoke jQuery functions, such as <code class="literal">$()</code> and <code class="literal">html()</code>.</p><p>When a new view instance is created, the <code class="literal">initialize()</code> method<a class="indexterm" id="id322"/> is triggered automatically. Additionally, we can pass any standard property to the view from outside of the object when creating its instance. It can be done with the help of the following code snippet:</p><div><pre class="programlisting">var invoiceItemView = new InvoiceItemView({
  el: 'body'
});</pre></div><p>The <code class="literal">el</code> property can also be defined as a function if we want it to be calculated dynamically.</p><p>When the <code class="literal">render()</code> method is called, it runs our code that then renders the view.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec117"/>There's more...</h2></div></div></div><p>In this section, we will learn some useful tricks when dealing with a view.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec42"/>Creating a new HTML element associated with a view</h3></div></div></div><p>Sometimes, we may not want to <a class="indexterm" id="id323"/>render a view into the existing HTML element in the DOM tree; instead, we may want to create a new one and then add it to the document. Follow the given steps to create a new HTML element associated with a view.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a view and set its elements and attributes manually by assigning values to the <code class="literal">tagName</code>, <code class="literal">className</code>, and <code class="literal">attributes</code> properties:<div><pre class="programlisting">  // Define new view.
  var InvoiceItemView2 = Backbone.View.extend({
    // Set tag name and its attributes.
    tagName: 'p',
    className: 'item',
    attributes: {
      'align': 'left'
    },

    // Initialize view object values.
    initialize: function() {
      this.html = 'Farm Animal Set. Price: $17. Quantity: 1.'
    },

    // Render view.
    render: function() {

      // Set html for the view element using jQuery.
      $(this.el).html(this.html);
    }
  });</pre></div></li><li class="listitem">Create a new view<a class="indexterm" id="id324"/> instance. When doing this, Backbone will automatically assign <code class="literal">el</code> with an appropriate value:<div><pre class="programlisting">    // Create new view instance.
    var invoiceItemView2 = new InvoiceItemView2();

    invoiceItemView2.el; // &lt;p align="left" class="item"&gt;&lt;/p&gt;</pre></div></li><li class="listitem">Render this view. Our render code will create a new HTML object:<div><pre class="programlisting">    invoiceItemView2.render();</pre></div></li><li class="listitem">Insert the newly created HTML object into the DOM:<div><pre class="programlisting">    $('body').append(invoiceItemView2.el);</pre></div></li><li class="listitem">Check the result. The body of our HTML page should contain a code like the following code snippet:<div><pre class="programlisting">&lt;body&gt;
    &lt;p align="left" class="item"&gt;
        Farm Animal Set. Price: $17. Quantity: 1.
    &lt;/p&gt;
&lt;/body&gt;</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec43"/>Changing the view element dynamically</h3></div></div></div><p>We may want to change the <a class="indexterm" id="id325"/>view element during the working of our code. This could be done with the help of a<a class="indexterm" id="id326"/> <code class="literal">setElement()</code> method. Both of the following are valid.</p><div><pre class="programlisting">// Change existing element to the new one.
InvoiceItemView.setElement('li');

// Change existing element to the one already exists
// in the DOM tree.
InvoiceItemView.setElement($('body div'));</pre></div><p>When calling the <code class="literal">setElement()</code> method, Backbone undelegates events assigned to a previous element, and assigns them to a new element.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec44"/>Removing a view</h3></div></div></div><p>When we have finished <a class="indexterm" id="id327"/>working with a view and want to remove it, we also need to remove its elements from the DOM and stop listening to events. To do this, we simply need to call the<a class="indexterm" id="id328"/> <code class="literal">remove()</code> method.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec118"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In this recipe, we use the jQuery method <code class="literal">$()</code> to access the properties of the view element. Please refer to the next recipe to get more information about jQuery.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Dealing with a view element using jQuery</h1></div></div></div><p>There is no doubt that jQuery<a class="indexterm" id="id329"/> is the most popular JavaScript library nowadays. It simplifies document traversing with the help of CSS selectors, and provides easy event handling, animating, and AJAX interactions.</p><p>Backbone.js relies on jQuery when dealing with a view. In this recipe, we are going to learn how to interact with a view element using jQuery.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec119"/>How to do it...</h2></div></div></div><p>Follow the given steps<a class="indexterm" id="id330"/> to deal<a class="indexterm" id="id331"/> with a view element using jQuery.</p><div><ol class="orderedlist arabic"><li class="listitem">To access a view element with jQuery, use <code class="literal">$(this.el)</code>:<div><pre class="programlisting">$(this.el).show();</pre></div></li><li class="listitem">Use <code class="literal">this.$el</code> as a shortened alias for <code class="literal">$(this.el)</code>:<div><pre class="programlisting">this.$el.appendl('&lt;li&gt;An item&lt;/li&gt;');</pre></div></li><li class="listitem">To run a query within the scope of a view, use <code class="literal">this.$el.find()</code>:<div><pre class="programlisting">this.$el.find('li').html('Hey there');</pre></div></li><li class="listitem">Use <code class="literal">this.$()</code> as a shortened alias for <code class="literal">this.$el.find()</code>:<div><pre class="programlisting">this.$el('li').addClass('highlighted');</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec120"/>How it works...</h2></div></div></div><p>Backbone<a class="indexterm" id="id332"/> integrates with the jQuery library as well as with Zepto.js and<a class="indexterm" id="id333"/> Ender.js. When Backbone <a class="indexterm" id="id334"/>is loaded, it determines which library is used and assigns a reference to it in the form of the <code class="literal">Backbone.$</code> variable.</p><p>There are a couple of aliases, such as <code class="literal">this.$el</code> and <code class="literal">this.$()</code>, that simplify access to the library.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec121"/>There's more...</h2></div></div></div><p>In this section, we are going to meet a jQuery alternative known as Zepto.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec45"/>Using Zepto as a faster alternative to jQuery</h3></div></div></div><p>Zepto<a class="indexterm" id="id335"/> is a minimalist JavaScript library that is 99 percent compatible with jQuery. The design goal of Zepto was to have a small-sized library and faster execution rate, which can be achieved by supporting modern browsers only. As a result, Zepto works much faster on mobile devices.</p><p>To use Zepto with <a class="indexterm" id="id336"/>Backbone, you need <a class="indexterm" id="id337"/>to perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the library from <a class="ulink" href="http://zeptojs.com">http://zeptojs.com</a> and include it in the <code class="literal">lib</code> folder of your project.</li><li class="listitem">Include Zepto in the <code class="literal">index.html</code> file instead of in jQuery.<div><pre class="programlisting">  &lt;script src="img/zepto.js"&gt;&lt;/script&gt;</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec122"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can find the complete documentation of<a class="indexterm" id="id338"/> jQuery on its official website <a class="ulink" href="http://jquery.com">http://jquery.com</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Rendering a model in a view</h1></div></div></div><p>When working with <a class="indexterm" id="id339"/>models, we may often want to render them and show<a class="indexterm" id="id340"/> them in the browser. Typically, this can be done by creating a view for rendering a model and passing the model instance as a parameter.</p><p>In this recipe, we are going to render a simple model with a view, and the result will look like the following screenshot:</p><div><img alt="Rendering a model in a view" src="img/2728_04_01.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec123"/>How to do it...</h2></div></div></div><p>Follow the given steps to render a model in a view.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a new model:<div><pre class="programlisting">  var InvoiceItemModel = Backbone.Model.extend({

  });</pre></div></li><li class="listitem">Define a view that will render this model:<div><pre class="programlisting">  var InvoiceItemView = Backbone.View.extend({
    
    // HTML element name, where to render a view.
    el: 'body',

    // Render view.
    render: function() {
      var html = 'Description: ' +
        this.model.get('description') + '. ' +
        'Price: ' + this.model.get('price') + '. ' +
        'Quantity: ' + this.model.get('quantity') + '.';

      // Set html for the view element using jQuery.
      $(this.el).html(html);
    }
  });</pre></div></li><li class="listitem">Create a model instance:<div><pre class="programlisting">    var invoiceItemModel = new InvoiceItemModel({
      description: 'Farmer Figure',
      price: 8,
      quantity: 1
    });</pre></div></li><li class="listitem">Create a view instance and pass the model to it as a parameter:<div><pre class="programlisting">    var invoiceItemView = new InvoiceItemView({
      
      // Pass model as a parameter to a view.
      model: invoiceItemModel
    });</pre></div></li><li class="listitem">Render the view:<div><pre class="programlisting">    invoiceItemView.render();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec124"/>How it works...</h2></div></div></div><p>When initializing a new <a class="indexterm" id="id341"/>view object, we pass a model object to the view that is added to <a class="indexterm" id="id342"/>its property array by Backbone. In any method of this view, the assigned model can be made available by using the <code class="literal">this.model</code> property.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec125"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Often when rendering a model in a view, we need to update HTML if the model object has to get updated. This means we need to call the <code class="literal">setElement()</code> method <a class="indexterm" id="id343"/>every time the model is changed. Fortunately, Backbone provides an event-handling mechanism that does this automatically. It has been described in <a class="link" href="ch05.html" title="Chapter 5. Events and Bindings">Chapter 5</a>, <em>Events and Bindings</em>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Rendering a collection in a view</h1></div></div></div><p>In this recipe, we are<a class="indexterm" id="id344"/> going to <a class="indexterm" id="id345"/>learn a simple way of rendering a collection of models in the view.</p><p>The result output is an HTML list and looks like the following screenshot:</p><div><img alt="Rendering a collection in a view" src="img/2728_04_02.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec126"/>How to do it...</h2></div></div></div><p>Follow the given steps to render a collection in a view.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a model:<div><pre class="programlisting">  var InvoiceItemModel = Backbone.Model.extend({

  });</pre></div></li><li class="listitem">Define a collection:<div><pre class="programlisting">  var InvoiceItemCollection = Backbone.Collection.extend({
    model: InvoiceItemModel
  });</pre></div></li><li class="listitem">Define a view:<div><pre class="programlisting">var InvoiceItemListView = Backbone.View.extend({

  // HTML element name, where to render a view.
  el: 'body',

  // Render view.
  render: function() {
    var html = '';
    _.each(this.collection.models,function(model,index,list) {    
      var item_html = 'Description: ' +
        model.get('description') + '. ' +
        'Price: ' + model.get('price') + '. ' +
        'Quantity: ' + model.get('quantity') + '.';
      html = html + '&lt;li&gt;' + item_html + '&lt;/li&gt;';
    });

    html = '&lt;ul&gt;' + html + '&lt;/ul&gt;';

    // Set html for the view element using jQuery.
    $(this.el).html(html);
  }
});</pre></div></li><li class="listitem">Create a<a class="indexterm" id="id346"/> collection instance:<div><pre class="programlisting">var invoiceItemCollection = new InvoiceItemCollection([
  { description: 'Wooden Toy House', price: 22, quantity: 3 },
  { description: 'Farm Animal Set', price: 17, quantity: 1 },
  { description: 'Farmer Figure', price: 8, quantity: 1 },
  { description: 'Toy Tractor', price: 15, quantity: 1 }
]);</pre></div></li><li class="listitem">Create a view instance:<div><pre class="programlisting">    var invoiceItemListView = new InvoiceItemListView({

      // Pass model as a parameter to a view.
      collection: invoiceItemCollection
    });</pre></div></li><li class="listitem">Render a view:<div><pre class="programlisting">    invoiceItemListView.render();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec127"/>How it works...</h2></div></div></div><p>When<a class="indexterm" id="id347"/> initializing a new view object, we pass the collection object to it, so that we later handle in a loop with the help of the<a class="indexterm" id="id348"/> <code class="literal">render()</code> method. Thus, we create the result HTML code that is later assigned to the view element.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec128"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Often when rendering a collection in a view, we need to update HTML if the collection is being sorted or updated. This means we need to call the <code class="literal">setElement()</code> method<a class="indexterm" id="id349"/> every time the model is changed. Fortunately, Backbone provides an event-handling <a class="indexterm" id="id350"/>mechanism<a class="indexterm" id="id351"/> that does this automatically. It has been described in <a class="link" href="ch05.html" title="Chapter 5. Events and Bindings">Chapter 5</a>, <em>Events and Bindings</em>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Splitting a view into subviews</h1></div></div></div><p>In the previous recipe, we <a class="indexterm" id="id352"/>used a single big view to render the collection. However, there<a class="indexterm" id="id353"/> is a better way to handle big views, by splitting them into multiple small views. Such a practice should have several advantages. In the context of our collection, the following advantages are observed:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The ability to insert, delete, or update a model in a collection without the need to re-render the whole collection</li><li class="listitem" style="list-style-type: disc">The ability to re-use subviews in other places of the program</li><li class="listitem" style="list-style-type: disc">The ability to split a single big piece of code into small and simple parts<div><img alt="Splitting a view into subviews" src="img/2728_04_03.jpg"/></div></li></ul></div><p>In this recipe, we are going to split a view which renders a collection into several simple subviews. Let's output the data in a table rather than in a list and apply some <strong>Cascading Style Sheets</strong> (<strong>CSS</strong>)<a class="indexterm" id="id354"/> to make it look better.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec129"/>How to do it...</h2></div></div></div><p>Follow the given steps to split one big view into small subviews.</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure you have the model and the collection definition:<div><pre class="programlisting">  var InvoiceItemModel = Backbone.Model.extend({

  });
  var InvoiceItemCollection = Backbone.Collection.extend({
    model: InvoiceItemModel
  });</pre></div></li><li class="listitem">Define a <a class="indexterm" id="id355"/>view for<a class="indexterm" id="id356"/> rendering a single model:<div><pre class="programlisting">  // Define new view to render a model.
  var InvoiceItemView = Backbone.View.extend({
    
    // Define element tag name.
    tagName: 'tr',

    // Render view.
    render: function() {

      // Add cells to the table row.
      $(this.el).html(_.map([
        this.model.get('quantity'),
        this.model.get('description'),
        this.model.get('price'), this.model.calculateAmount(),
      ], function(val, key){
        return '&lt;td&gt;' + val + '&lt;/td&gt;'
      }));

      return this;
    }
  });</pre></div></li><li class="listitem">Define a view for rendering a collection:<div><pre class="programlisting">  // Define new view to render a collection.
  var InvoiceItemListView = Backbone.View.extend({

    // Define element tag name.
    tagName: 'table',

    // Define element class name.
    className: 'invoice-item-view',

    // Render view.
    render: function() {

      $(this.el).empty();

      // Append table with a table header.
      $(this.el).append($('&lt;tr&gt;&lt;/tr&gt;').html(
        _.map(['Quantity', 'Description', 'Price', 'Total'], 
          function(val, key){
            return '&lt;th&gt;' + val + '&lt;/th&gt;'
        })
      ));

      // Append table  with a row.
      $(this.el).append(
        _.map(this.collection.models, function(model, key) {
          return new InvoiceItemView({
            model: model
          }).render().el;
        })
      );

      return this;
    }
  });</pre></div></li><li class="listitem">Define a<a class="indexterm" id="id357"/> view for <a class="indexterm" id="id358"/>rendering a whole page.<div><pre class="programlisting">  var InvoiceItemListPageView = Backbone.View.extend({

    // Render whole page view.
    render: function() {
      $(this.el).html(new InvoiceItemListView({
        collection: this.collection
      }).render().el);
    }
  });</pre></div></li><li class="listitem">Create and initialize a collection instance with data.<div><pre class="programlisting">var invoiceItemCollection = new InvoiceItemCollection([
  { description: 'Wooden Toy House', price: 22, quantity: 3 },
  { description: 'Farm Animal Set', price: 17, quantity: 1 },
  { description: 'Farmer Figure', price: 8, quantity: 1 },
  { description: 'Toy Tractor', price: 15, quantity: 1 }
]);</pre></div></li><li class="listitem">Create a view instance for a whole page and render it.<div><pre class="programlisting">    new InvoiceItemListPageView({
      collection: invoiceItemCollection,
      el: 'body'
    }).render();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec130"/>How it works...</h2></div></div></div><p>In this example, we <a class="indexterm" id="id359"/>used <code class="literal">InvoiceItemView</code> for rendering the model and <code class="literal">InvoiceItemListView</code> for rendering the collection.</p><p>Also, we introduced <a class="indexterm" id="id360"/>the new view <code class="literal">InvoiceItemListPageView</code> that renders the whole page. When creating an instance of this view, we pass the <code class="literal">el</code> property; it contains the HTML element name where the view should output its result. This gives us more flexibility, and so we can render the view wherever we need.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec49"/>Handling Document Object Model (DOM) events in a view</h1></div></div></div><p>A view in Backbone provides some functionality to interact with a user. It allows the handling of events that <a class="indexterm" id="id361"/>occur in the DOM in context of the view element.</p><p>In this recipe, we are going to modify an example given in the previous recipe. Let's add an <strong>Edit</strong> button to each row of the table as shown in the following screenshot:</p><div><img alt="Handling Document Object Model (DOM) events in a view" src="img/2728_04_04.jpg"/></div><p>By clicking on the <a class="indexterm" id="id362"/>
<strong>Edit</strong> button, we will immediately replace the<a class="indexterm" id="id363"/> text values with input boxes so that the user can enter new values. We will also show <strong>Save</strong> and <strong>Cancel</strong> buttons to save or cancel the changes.</p><div><img alt="Handling Document Object Model (DOM) events in a view" src="img/2728_04_05.jpg"/></div><p>If the user clicks on the <a class="indexterm" id="id364"/>
<strong>Save</strong> button, the model gets updated. If the user clicks on the <strong>Cancel</strong> button, values in the row are restored. Clicking on both the buttons makes the row view work in the view mode again.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec131"/>How to do it...</h2></div></div></div><p>Apply the following <a class="indexterm" id="id365"/>changes to <code class="literal">InvoiceItemView</code> that we created in the previous recipe.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a view:<div><pre class="programlisting">  // Define new view to render a model.
  var InvoiceItemView = Backbone.View.extend({
    
    // Define tag name.
    tagName: 'tr',
  });</pre></div></li><li class="listitem">Introduce a rendering function when the user is viewing an item:<div><pre class="programlisting">    renderViewMode: function() {
     $(this.el).html(_.map([
        this.model.get('quantity'),
        this.model.get('description'),
        this.model.get('price'),
        this.model.calculateAmount(),
        '&lt;button class="edit"&gt;Edit&lt;/button&gt;'
      ], function(val, key){
        return '&lt;td&gt;' + val + '&lt;/td&gt;'
      }));
    },</pre></div></li><li class="listitem">Introduce a rendering function when the user is editing an item:<div><pre class="programlisting">   renderEditMode: function() {
      $(this.el).html(_.map([
        '&lt;input class="quantity" value="' + 
          this.model.get('quantity') + '"&gt;',
        '&lt;input class="description" value="' + 
          this.model.get('description') +
        '"&gt;',
        '&lt;input class="price" value="' + 
          this.model.get('price') + '"&gt;',
        this.model.calculateAmount(),
        '&lt;button class="save"&gt;Save&lt;/button&gt;' +
        '&lt;button class="cancel"&gt;Cancel&lt;/button&gt;'
      ], function(val, key){
        return '&lt;td&gt;' + val + '&lt;/td&gt;'
      }));
    },</pre></div></li><li class="listitem">Set a<a class="indexterm" id="id366"/> property that will contain a function name<a class="indexterm" id="id367"/> that will be called on rendering the view:<div><pre class="programlisting">    renderCallback: 'renderViewMode',

    render: function() {
      this[this.renderCallback]();

      return this;
    },</pre></div></li><li class="listitem">Map the DOM events to the handlers:<div><pre class="programlisting">    events: {
      'click button.edit': 'edit',
      'click button.save': 'save',
      'click button.cancel': 'cancel',
    },</pre></div></li><li class="listitem">Define the event handlers:<div><pre class="programlisting">    // Edit button click handler.
    edit: function() {
      this.renderCallback = 'renderEditMode';

      this.render();
    },

    // Save button click handler.
    save: function() {
      this.model.set({
        quantity: $(this.el).find('input.quantity').val(),
        description: 
          $(this.el).find('input.description').val(),
        price: $(this.el).find('input.price').val(),
      });

      this.renderCallback = 'renderViewMode';

      this.render();
    },

    // Cancel button click handler.
    cancel: function() {
      this.renderCallback = 'renderViewMode';

      this.render();
    }</pre></div></li><li class="listitem">Create and<a class="indexterm" id="id368"/> initialize <a class="indexterm" id="id369"/>a collection instance with data:<div><pre class="programlisting">var invoiceItemCollection = new InvoiceItemCollection([
  { description: 'Wooden Toy House', price: 22, quantity: 3 },
  { description: 'Farm Animal Set', price: 17, quantity: 1 },
  { description: 'Farmer Figure', price: 8, quantity: 1 },
  { description: 'Toy Tractor', price: 15, quantity: 1 }
]);</pre></div></li><li class="listitem">Create a view instance for a whole page and render it:<div><pre class="programlisting">    new InvoiceItemListPageView({
      collection: invoiceItemCollection,
      el: 'body'
    }).render();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec132"/>How it works...</h2></div></div></div><p>By defining the <code class="literal">event</code> property, we can tell Backbone how to map events to the handlers. To do so, we will use the following syntax:</p><div><pre class="programlisting">{"event selector": "callback"}</pre></div><p>Backbone.js uses jQuery's <code class="literal">on()</code> function<a class="indexterm" id="id370"/> to provide declarative callbacks for DOM events <a class="indexterm" id="id371"/>within a view. If the <code class="literal">selector</code> value is not given, the view's <a class="indexterm" id="id372"/>root element (<code class="literal">this.el</code>) is assumed.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec133"/>There's more...</h2></div></div></div><p>This section describes view methods to delegate and undelegate DOM events.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec46"/>Delegating and undelegating events manually</h3></div></div></div><p>In some cases, we may<a class="indexterm" id="id373"/> need a view to start handling DOM events manually from a specific place in the program. This can be done by calling the<a class="indexterm" id="id374"/> <code class="literal">delegateEvents()</code> method. It accepts a hash table of event names and their callbacks. If no parameter is given, <code class="literal">this.events</code> is used.</p><p>If we need a view to stop <a class="indexterm" id="id375"/>handling DOM events, we should call the<a class="indexterm" id="id376"/> <code class="literal">undelegateEvents()</code> method. This can be useful when we hide the view temporarily and need to ensure that no unexpected behavior is caused by the DOM events.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec134"/>See also...</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A complete reference to the jQuery events<a class="indexterm" id="id377"/> can be found at <a class="ulink" href="http://api.jquery.com/category/events/">http://api.jquery.com/category/events/</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec50"/>Switching views using Backbone.Router</h1></div></div></div><p>In the real Backbone<a class="indexterm" id="id378"/> application, we'll often need to switch <a class="indexterm" id="id379"/>from one view to another. This is typically done with the help of Backbone.Router; it allows us to map a URL to the specific callback that renders a view. In <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>, we learned about a router in Backbone.js. However, we did not speak much about its interaction with views.</p><p>In this recipe, we are going to build a Backbone application that will dynamically render an appropriate view on the URL, as well as change and remove the view that was shown tothe user previously in order to prevent a memory leak. The views are going to be switched without a page reload, because Backbone.Router supports hash URLs and <code class="literal">pushState</code>.</p><p>In our application, we are going to implement <code class="literal">InvoiceListView</code> and <code class="literal">InvoicePageView</code>. The first one<a class="indexterm" id="id380"/> displays a list of invoices, as shown in the following screenshot:</p><div><img alt="Switching views using Backbone.Router" src="img/2728_04_07.jpg"/></div><p>When the user <a class="indexterm" id="id381"/>clicks on the <strong>view details</strong> link, he/she is shown an invoice details screen like the one shown in the following screenshot:</p><div><img alt="Switching views using Backbone.Router" src="img/2728_04_08.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec135"/>How to do it...</h2></div></div></div><p>Let's assume that<a class="indexterm" id="id382"/> we already have a model, a collection, and view objects<a class="indexterm" id="id383"/> defined. Follow the given steps to create a router that switches views.</p><div><ol class="orderedlist arabic"><li class="listitem">Define a router object and its routes:<div><pre class="programlisting">  var Workspace = Backbone.Router.extend({

    // Define routes
    routes: {
      '': 'invoiceList',
      'invoice': 'invoiceList',
      'invoice/:id': 'invoicePage',
    }</pre></div></li><li class="listitem">Create a new collection instance in the <code class="literal">initialize()</code> method in the router object:<div><pre class="programlisting">    initialize: function() {

      //  Create collection
      this.invoiceCollection = new InvoiceCollection([
        { referenceNumber: 1234},
        { referenceNumber: 2345},
        { referenceNumber: 3456},
        { referenceNumber: 4567}
      ]);
    }</pre></div></li><li class="listitem">Define routing callbacks in the router object:<div><pre class="programlisting">    invoiceList: function() {
      this.changeView(new InvoiceListView({
        collection: this.invoiceCollection
      }));
    },

    invoicePage: function(id) {
      this.changeView(new InvoicePageView({
        model: this.invoiceCollection.get(id)
      }));
    }</pre></div></li><li class="listitem">Define a <code class="literal">changeView()</code> method in the<a class="indexterm" id="id384"/> router <a class="indexterm" id="id385"/>object that will help us change the current view:<div><pre class="programlisting">    changeView: function(view) {
      if (this.currentView) {
        if (this.currentView == view) {
          return;
        }

        this.currentView.remove();
      }

      $('body').append(view.render().el);

      this.currentView = view;
    }
  });</pre></div></li><li class="listitem">Create a router instance and run the <code class="literal">Backbone.history.start()</code> method to start our application:<div><pre class="programlisting">    new Workspace();
    Backbone.history.start();</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec136"/>How it works...</h2></div></div></div><p>Many interesting things are happening in the<a class="indexterm" id="id386"/> <code class="literal">changeView()</code> method. Just for our assurance, we check if the current view is not the one to which we are going to switch and then remove. While removing a view, all the events handled by it need to be unbound, and the corresponding HTML elements removed from the DOM tree. Then, we render a new view and append its element to the body.</p><p>Removing previously <a class="indexterm" id="id387"/>used views helps us to avoid memory leaks, which<a class="indexterm" id="id388"/> can happen when the application is used continuously for a very long time.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec137"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Please refer to <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>, to learn more about routers in Backbone.js.</li></ul></div></div></div></body></html>