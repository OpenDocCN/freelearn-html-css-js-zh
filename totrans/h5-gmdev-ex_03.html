<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Building a Card-matching Game in CSS3</h1></div></div></div><p>
<em>CSS3 introduces many exciting features. In this chapter, we will explore and use some of them to create a card-matching game. CSS3 styles how the game objects look and animate, while the jQuery library helps us to define the game logic.</em>
</p><p>In this chapter, we will:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Transform a playing card with animation</li><li class="listitem" style="list-style-type: disc">Flip a playing card with new CSS3 properties</li><li class="listitem" style="list-style-type: disc">Create the whole memory matching game</li><li class="listitem" style="list-style-type: disc">Embed a custom web font to our game</li></ul></div><p>You can try the card-matching game<a id="id161" class="indexterm"/> at the following URL to have a glimpse of what we are going to achieve in this chapter:</p><p>
<a class="ulink" href="http://makzan.net/html5-games/card-matching/">http://makzan.net/html5-games/card-matching/</a>
</p><p>So, let's get on with it.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Moving game objects with CSS3 transition</h1></div></div></div><p>We had a glimpse of the <a id="id162" class="indexterm"/>CSS3 transition and transformation<a id="id163" class="indexterm"/> modules in <a class="link" href="ch01.html" title="Chapter 1. Introducing HTML5 Games">Chapter 1</a>, <em>Introducing HTML5 Games,</em> when we were overviewing the new CSS3 features. We often want to animate the game objects by easing the properties. Transition is the CSS property designed for this purpose. Suppose that we have a playing card on the web page and want to move it to another position in five seconds. We would have to use JavaScript to set up a timer and write our own function to change the position every few milliseconds. By using the <code class="literal">transition</code> property, we just need to specify the start and end styles and the duration. The browser optimizes the output and does all the easing and in-between animations.</p><p>Let's take a look at<a id="id164" class="indexterm"/> some<a id="id165" class="indexterm"/> examples to understand this.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Time for action – moving a playing card around</h1></div></div></div><p>In this example, we will place two <a id="id166" class="indexterm"/>playing cards on a web page and transform them to a different position, scale, and rotation. We will tween the transformation by setting the transition:</p><div><ol class="orderedlist arabic"><li class="listitem">To do this, create a new project folder with the following hierarchy. The <code class="literal">css3transition.css</code> and <code class="literal">index.html</code> files are empty now and we will add the code later. The <code class="literal">jquery-2.1.3.min.js</code> file is the jQuery library that we used in the previous chapter.<div><pre class="programlisting">index.html
js/
  js/jquery-2.1.3.js
css/
  css/css3transition.css
images/</pre></div></li><li class="listitem">We are using two playing card graphic images in this example. They are <code class="literal">AK.png</code> and <code class="literal">AQ.png</code>. The images are available in the code bundle or you can download them from the book assets website at <a class="ulink" href="http://mak.la/book-assets/">http://mak.la/book-assets/</a>.</li><li class="listitem">Put the two card images inside the <code class="literal">images</code> folder.</li><li class="listitem">The next thing is to code the HTML with two card DIV elements. We will apply CSS transition style to these two cards elements when the page is loaded:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Getting Familiar with CSS3 Transition&lt;/title&gt;
  &lt;link rel="stylesheet" href="css/css3transition.css" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;h1&gt;Getting Familiar with CSS3 Transition&lt;/h1&gt;
  &lt;/header&gt;
  
  &lt;section id="game"&gt;
    &lt;div id="cards"&gt;
      &lt;div id="card1" class="card cardAK"&gt;&lt;/div&gt;
      &lt;div id="card2" class="card cardAQ"&gt;&lt;/div&gt;
    &lt;/div&gt; &lt;!-- #cards --&gt;
  &lt;/section&gt; &lt;!-- #game --&gt;
  &lt;footer&gt;
    &lt;p&gt;This is an example of transitioning cards.&lt;/p&gt;
  &lt;/footer&gt;
&lt;script src="img/jquery-2.1.3.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
$(function(){
  $("#card1").addClass("move-and-scale");
  $("#card2").addClass("rotate-right");
});
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">It is time to define the<a id="id167" class="indexterm"/> visual styles of the playing cards via CSS. This contains basic CSS 2.1 properties and CSS3's new properties. In the following code, the new CSS3 properties are highlighted:<div><pre class="programlisting">body {
  background: LIGHTGREY;
}
/* defines styles for each card */
.card {
  width: 80px;
  height: 120px;
  margin: 20px;
  position: absolute;
<strong>  transition: all 1s linear;</strong>
}

/* set the card to corresponding playing card graphics */
.cardAK {
  background: url(../images/AK.png);
}
.cardAQ {
  background: url(../images/AQ.png);
}
/* rotate the applied DOM element 90 degree */
.rotate-right {
<strong>  transform: rotate3d(0, 0, 1, 90deg);</strong>
}

/* move and scale up the applied DOM element */
.move-and-scale {
<strong>  transform: translate3d(150px, 150px, 0) scale3d(1.5, 1.5, 1);</strong>
}</pre></div></li><li class="listitem">Let's save all the files <a id="id168" class="indexterm"/>and open the <code class="literal">index.html</code> file in the browser. The two cards should animate as shown in the following screenshot:<div><img src="img/B04290_03_01.jpg" alt="Time for action – moving a playing card around"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec62"/>
<em>What just happened?</em>
</h2></div></div></div><p>We just created two animation effects by using the CSS3 transition to tween the <code class="literal">transform</code> property.</p><p>Here is the usage of CSS transform:</p><div><pre class="programlisting">transform: transform-function1 transform-function2;</pre></div><p>The arguments of the <code class="literal">transform</code> property are functions. There are two sets of functions: the 2D and 3D transform functions. <strong>CSS transform</strong>
<a id="id169" class="indexterm"/> functions are designed to move, scale, rotate, and skew the target DOM elements. The following sections show the usage of the transform functions.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec63"/>2D transform functions</h2></div></div></div><p>The 2D <code class="literal">rotate</code> function<a id="id170" class="indexterm"/> rotates the<a id="id171" class="indexterm"/> element clockwise on a given positive argument and counter-clockwise on a given negative argument:</p><div><pre class="programlisting">rotate(angle)</pre></div><p>The <code class="literal">translate</code> function <a id="id172" class="indexterm"/>moves the element by the given <em>x</em> and <em>y</em> displacement:</p><div><pre class="programlisting">translate (tx, ty)</pre></div><p>We can translate the <em>x</em> or <em>y</em> axis independently by calling the <code class="literal">translateX</code> and <code class="literal">translateY</code> function as follows:</p><div><pre class="programlisting">translateX(number)
translateY(number)</pre></div><p>The <code class="literal">scale</code> function<a id="id173" class="indexterm"/> scales the element by the given <code class="literal">sx</code> and <code class="literal">sy</code> vectors. If we only pass the first argument, then <code class="literal">sy</code> will be of the same value as <code class="literal">sx</code>:</p><div><pre class="programlisting">scale(sx, sy)</pre></div><p>In addition, we can independently scale the <em>x</em> and <em>y</em> axis as follows:</p><div><pre class="programlisting">scaleX(number)
scaleY(number)</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec64"/>3D transform functions</h2></div></div></div><p>The 3D rotation function rotates <a id="id174" class="indexterm"/>the element in 3D space by the given [x, y, z] unit vector. For example, we can rotate the <em>y</em> axis 60 degrees by using <code class="literal">rotate3d(0,</code> <code class="literal">1,</code> <code class="literal">0,</code> <code class="literal">60deg)</code>:</p><div><pre class="programlisting">rotate3d(x, y, z, angle)</pre></div><p>We can also rotate one axis only by calling the following handy functions:</p><div><pre class="programlisting">rotateX(angle)
rotateY(angle)
rotateZ(angle)</pre></div><p>Similar to the 2D <code class="literal">translate</code> function, <code class="literal">translate3d</code> allows <a id="id175" class="indexterm"/>us to move the element in all the three axes:</p><div><pre class="programlisting">translate3d(tx, ty, tz)
translateX(tx)
translateY(ty)
translateZ(tz)</pre></div><p>Also, the <code class="literal">scale3d</code> scales the <a id="id176" class="indexterm"/>element in the 3D spaces:</p><div><pre class="programlisting">scale3d(sx, sy, sz)
scaleX(sx)
scaleY(sy)
scaleZ(sz)</pre></div><p>The <code class="literal">transform</code> functions that we just discussed are common, and we will use them many times. There are several other <code class="literal">transform</code> functions that are not discussed; they are <code class="literal">matrix</code>, <code class="literal">skew</code>, and <code class="literal">perspective</code>.</p><p>If you want to find the latest CSS Transforms working spec, you can visit the W3C website of CSS Transforms Modules<a id="id177" class="indexterm"/> at: <a class="ulink" href="http://www.w3.org/TR/css3-3d-transforms/">http://www.w3.org/TR/css3-3d-transforms/</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec65"/>Tweening the styles using CSS3 transition</h2></div></div></div><p>There are tons of new<a id="id178" class="indexterm"/> features in CSS3. Transition module is one among them<a id="id179" class="indexterm"/> that affects us most in game designing.</p><p>What is <a id="id180" class="indexterm"/>
<strong>CSS3 transition</strong>? W3C explains it in one sentence:</p><div><blockquote class="blockquote"><p><em>CSS transitions allows property changes in CSS values to occur smoothly over a specified duration.</em>
</p></blockquote></div><p>Normally, when we change any properties of the element, the properties are updated to the new value immediately. Transition slows down the changing process. It creates smooth in-between easing from the old value towards the new value in the given duration.</p><p>Here is the usage of the <code class="literal">transition</code> property: </p><div><pre class="programlisting">transition: property_name duration timing_function delay</pre></div><p>The following table <a id="id181" class="indexterm"/>explains each of the parameters used in the <code class="literal">transition</code> property:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Definition</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">property_name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id182" class="indexterm"/>name of the property where the transition applies. It can be set to <code class="literal">all</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">duration</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id183" class="indexterm"/> the duration that the transition takes.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">timing_function</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The<a id="id184" class="indexterm"/> <code class="literal">timing</code> function defines the interpolation between the start and end values. The default value is <code class="literal">ease</code>. Normally, we will use <code class="literal">ease</code>, <code class="literal">ease-in</code>, <code class="literal">ease-out</code>, and <code class="literal">linear</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">delay</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The <code class="literal">delay</code> argument <a id="id185" class="indexterm"/>delays the start of the transition by the given seconds.</p>
</td></tr></tbody></table></div><p>We can put several <code class="literal">transition</code> properties in one line. For example, the following code transitions the opacity in <a id="id186" class="indexterm"/>0.3 seconds and background color in 0.5 seconds:</p><div><pre class="programlisting">transition: opacity 0.3s, background-color 0.5s</pre></div><p>We can also define each transition property individually by using the following properties:</p><div><pre class="programlisting">transition-property, transition-duration, transition-timing-function and transition-delay</pre></div><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>
<strong>Modules of CSS3</strong>
</p><p>According to W3C, CSS3<a id="id187" class="indexterm"/> is unlike CSS 2.1 in that there is only one CSS 2.1 spec. CSS3 is divided into different modules. Each module is reviewed individually. For example, there is a transition module, 2D/3D transforms module, and the Flexible Box Layout module.</p><p>The reason for dividing the spec into modules is because the pace at which the work of each part of the CSS3 progresses is not the same. Some CSS3 features are rather stable, such as border radius, while some have not yet settled down. Dividing the whole spec into different parts allows the browser vendor to support modules that are stable. In this scenario, slow-paced features will not slow down the whole spec. The aim of the CSS3 spec is to standardize the most common visual usage in web designing and this module fits this aim.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec66"/>Have a go hero </h2></div></div></div><p>We have translated, scaled, and rotated the playing cards. How about we try to change different values in the example? There are three axes in the <code class="literal">rotate3d</code> function. What will happen if we rotate the other axis? Experiment with the code yourself to get familiar with the transform and transition modules.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Creating a card-flipping effect</h1></div></div></div><p>Imagine now that we are <a id="id188" class="indexterm"/>not just moving the playing card around, but we also want to flip the card element, just like we flip a real playing card. By using the <code class="literal">rotation</code> <code class="literal">transform</code> function, it is now possible to create the card-flipping effect.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Time for action – flipping a card with CSS3</h1></div></div></div><p>We are going to start a new <a id="id189" class="indexterm"/>project<a id="id190" class="indexterm"/> and create a card-flipping effect when we click on the playing card:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's continue with our previous code example.</li><li class="listitem">The card now contains two faces: a front face and a back face. Replace the following code in the <code class="literal">body</code> tag in the HTML code:<div><pre class="programlisting">&lt;section id="game"&gt;
  &lt;div id="cards"&gt;
    &lt;div class="card"&gt;
      &lt;div class="face front"&gt;&lt;/div&gt;
      &lt;div class="face back cardAK"&gt;&lt;/div&gt;
    &lt;/div&gt; &lt;!-- .card --&gt;
    &lt;div class="card"&gt;
      &lt;div class="face front"&gt;&lt;/div&gt;
      &lt;div class="face back cardAQ"&gt;&lt;/div&gt;
    &lt;/div&gt; &lt;!-- .card --&gt;
  &lt;/div&gt; &lt;!-- #cards --&gt;
&lt;/section&gt; &lt;!-- #game --&gt;
&lt;script src="img/jquery-2.1.3.min.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Then, create a new <code class="literal">css3flip.css </code>file in the <code class="literal">css </code>folder to test the flipping effect.</li><li class="listitem">In the <code class="literal">index.html </code>file, change the CSS external link to the <code class="literal">css3flip.css</code> file:<div><pre class="programlisting">&lt;link rel="stylesheet" href="css/css3flip.css" /&gt;</pre></div></li><li class="listitem">Now, let's add the styles to the <code class="literal">css3flip.css</code>:<div><pre class="programlisting">#game {
  background: #9c9;
  padding: 5px;
}
/* Define the 3D perspective view and dimension of each card. */
.card {
  perspective: 600px;
  width: 80px;
  height: 120px;
}</pre></div></li><li class="listitem">There are two faces on <a id="id191" class="indexterm"/>each card. We are going to slowly rotate the <a id="id192" class="indexterm"/>face of the card. Therefore, we define how the face transitions by CSS3's <code class="literal">transition</code> property. We also hide the back face's visibility. We will look at the detail of this property later:<div><pre class="programlisting">.face {
  border-radius: 10px;
  width: 100%;
  height: 100%;
  position: absolute;
  transition: all .3s;
<strong>  backface-visibility: hidden;</strong>
}</pre></div></li><li class="listitem">Now, it is time to style each individual face. The front face has a higher z-index than the back face:<div><pre class="programlisting">.front {
  background: #966;
}
.back {
  background: #eaa;
  transform: rotate3d(0,1,0,-180deg);
}</pre></div></li><li class="listitem">When we flip the card, we rotate the front face to the back and the back face to the front. We also swap the z-index of the front and back faces:<div><pre class="programlisting">.card-flipped .front {
  transform: rotate3d(0,1,0,180deg);
}
.card-flipped .back {
  transform: rotate3d(0,1,0,0deg);
}
.cardAK {
  background: url(../images/AK.png);
}
.cardAQ {
  background: url(../images/AQ.png);
}</pre></div></li><li class="listitem">Next, we will add logic after loading the jQuery library to toggle the card-flipped status when we click on the card:<div><pre class="programlisting">&lt;script&gt;
(function($){
  $(function(){
    $("#cards").children().each(function(index) {
      // listen the click event on each card DIV element.
      $(this).click(function() {
        // add the class "card-flipped".
        // the browser will animate the styles 
        // between current state and card-flipped state.
        $(this).toggleClass("card-flipped");
      });
    });
  });
})(jQuery);
&lt;/script&gt;</pre></div></li><li class="listitem">The styles and the <a id="id193" class="indexterm"/>scripts are now ready. Let's save all the files and<a id="id194" class="indexterm"/> preview it in our web browser. Click on the playing card to flip it over, and click on it again to flip it back.<div><img src="img/B04290_03_02.jpg" alt="Time for action – flipping a card with CSS3"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec67"/>
<em>What just happened?</em>
</h2></div></div></div><p>We have created a card-flipping effect that can be toggled by a mouse click. You can try out the example at  <a class="ulink" href="http://makzan.net/html5-games/simple-card-flip/">http://makzan.net/html5-games/simple-card-flip/</a>.</p><p>The example made use of several CSS transform properties and JavaScript to handle the mouse click event.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec68"/>Toggling a class with jQuery's toggleClass function</h2></div></div></div><p>We apply the <code class="literal">card-flipped</code> class to the card element when the mouse is clicked on the card. On the second click, we want to remove the applied card-flipped style so that the card flips back again. This is called <a id="id195" class="indexterm"/>
<strong>toggling a class</strong> style.</p><p>jQuery provides us with a handy function named <code class="literal">toggleClass</code> to add or remove classes automatically, depending on whether the class is applied or not.</p><p>To use the function, we simply pass the classes that we want to toggle as an argument.</p><p>For example, the following code adds or removes the <code class="literal">card-flipped</code> class to an element with the ID as <code class="literal">card1</code>:</p><div><pre class="programlisting">$("#card1").toggleClass("card-flipped");</pre></div><p>The <code class="literal">toggleClass</code> function accepts the toggle instruction from more than one class at the same time. We can pass in several class names and separate them by using a space. Here is an example of toggling two classes at the same time:</p><div><pre class="programlisting">$("#card1").toggleClass("card-flipped scale-up");</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec69"/>Introducing CSS' perspective property</h2></div></div></div><p>CSS3 lets us present elements<a id="id196" class="indexterm"/> in 3D, and we have been able to transform the elements<a id="id197" class="indexterm"/> in the 3D space. The <code class="literal">perspective</code> property defines how the 3D perspective view looks. You can treat the value as far as you are looking at the object. The closer you are, the more perspective distortion there is on the viewing object.</p><p>The following two 3D cubes demonstrate how different perspective values change the perspective view of the element:</p><div><img src="img/B04290_03_03.jpg" alt="Introducing CSS' perspective property"/></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec70"/>Have a go hero </h2></div></div></div><p>The cube is created by putting six faces together with 3D transforms applied to each face. It used the techniques that we've discussed. Try to create a cube and experiment with the <code class="literal">perspective</code> property.</p><p>The following web page gives a comprehensive<a id="id198" class="indexterm"/> explanation on creating the CSS3 cube, and it also explains how to control the rotation of the cube with the keyboard:</p><p>
<a class="ulink" href="http://paulrhayes.com/experiments/cube-3d/">http://paulrhayes.com/experiments/cube-3d/</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec71"/>Introducing backface-visibility</h2></div></div></div><p>Before the <code class="literal">backface-visibility</code> property<a id="id199" class="indexterm"/> was introduced, all the elements on the page presented their front face to the visitor. Actually, there was no concept of the front face or the back face of the element because presenting the front face was the only choice. While CSS3 introduces the rotation in three axes, we can rotate an element so that its face is on the back. Try looking at your palm and rotating your wrist, your palm turns and you see the back of your palm. This happens to the rotated elements too.</p><p>CSS3 introduces a property named <code class="literal">backface-visibility</code> to define whether or not we can see the back face of the element. By default, it is visible. The following figure demonstrates the two different behaviors of the <code class="literal">backface-visibility</code> property:</p><div><img src="img/B04290_03_04.jpg" alt="Introducing backface-visibility"/></div><div><div><h3 class="title"><a id="note09"/>Note</h3><p>You can read more detailed information about different properties and functions in CSS 3D transforms<a id="id200" class="indexterm"/> on its official Webkit blog at <a class="ulink" href="http://webkit.org/blog/386/3d-transforms/">http://webkit.org/blog/386/3d-transforms/</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Creating a card-matching memory game</h1></div></div></div><p>We have gone through some <a id="id201" class="indexterm"/>basic techniques in CSS. Now, let's make a game using the techniques. We are going to make a card game. The card game will make use of transform to flip the card, transition to move the card, JavaScript to hold the logic, and a new HTML5 feature called <strong>custom data attribute</strong>
<a id="id202" class="indexterm"/> to store custom data. Don't worry, we will discuss each component step by step.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec72"/>Downloading the sprite sheet of playing cards</h2></div></div></div><p>In the card-flipping example, we were <a id="id203" class="indexterm"/>using the graphics of two different <a id="id204" class="indexterm"/>playing cards. Now, we will prepare graphics for the whole deck of playing cards. Although we will only use six playing cards in the matching game, we will prepare the whole deck so that we can reuse these graphics in other card games that we may create.</p><p>There are 52 playing cards in a deck and we have one more graphic for the backside. Instead of using 53 separate files, it is good practice to put separate graphics into one big sprite sheet file. Sprite sheet is a graphics technique that loads one graphic's texture into memory and displays part of the graphics for each game component.</p><p>One benefit of using a big sprite sheet instead of separate image files is that we can reduce the amount of <a id="id205" class="indexterm"/>
<strong>HTTP requests</strong>. When the browser loads the web page, it creates a new HTTP request to load each external resource, including JavaScript files, CSS files, and images. It takes quite a lot of time to establish a new HTTP request for each separated small file. Combining the graphics into one file, greatly reduces the amount of requests and thus improves the responsiveness of the game when it is loading in the browser.</p><p>Another benefit of placing graphics in one file is to avoid the overhead of the file format header and reduce the amount of HTTP requests. The time to load a sprite sheet with 53 images is faster than loading 53 different images with the file header in each file.</p><p>The following deck of playing cards' graphics is drawn and aligned in Adobe Illustrator. You can download it from <a class="ulink" href="http://mak.la/deck.png">http://mak.la/deck.png</a>.</p><div><div><h3 class="title"><a id="note10"/>Note</h3><p>You can create your own sprite sheet with Instant Sprite Generator<a id="id206" class="indexterm"/> (<a class="ulink" href="http://instantsprite.com">http://instantsprite.com</a>). The article at <a class="ulink" href="http://css-tricks.com/css-sprites/">http://css-tricks.com/css-sprites/</a> explains in detail why and how we can create and use the<a id="id207" class="indexterm"/> CSS sprite sheet.</p></div></div><div><img src="img/B04290_03_05.jpg" alt="Downloading the sprite sheet of playing cards"/></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec73"/>Setting up the game environment</h2></div></div></div><p>Once the graphics are<a id="id208" class="indexterm"/> ready, we will need to set up a static page with the game objects that are prepared and placed on the game area. It is then easier to add game logic and interaction later:</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Time for action – preparing the card-matching game</h1></div></div></div><p>Before adding the complicated game<a id="id209" class="indexterm"/> logic to our matching game, let's prepare the HTML game structure and all the CSS styles:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's continue with our project. Create a new file named <code class="literal">matchgame.js</code> inside the <code class="literal">js</code> folder.</li><li class="listitem">Replace the <code class="literal">index.html</code> file with the following HTML code:<div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset=utf-8&gt;
  &lt;title&gt;CSS3 Matching Game&lt;/title&gt;
  &lt;link rel="stylesheet" href="css/matchgame.css" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;h1&gt;CSS3 Matching Game&lt;/h1&gt;
  &lt;/header&gt;

  &lt;section id="game"&gt;
    &lt;div id="cards"&gt; 
      &lt;div class="card"&gt;
        &lt;div class="face front"&gt;&lt;/div&gt;
        &lt;div class="face back"&gt;&lt;/div&gt;
      &lt;/div&gt; &lt;!-- .card --&gt;
    &lt;/div&gt; &lt;!-- #cards --&gt;
  &lt;/section&gt; &lt;!-- #game --&gt;

  &lt;footer&gt;
    &lt;p&gt;This is an example of creating a matching game with CSS3.&lt;/p&gt;
  &lt;/footer&gt;

&lt;script src="img/jquery-2.1.3.min.js"&gt;&lt;/script&gt;
&lt;script src="img/matchgame.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">In order to make the game <a id="id210" class="indexterm"/>more appealing, I prepared background images for the game table and the page. These graphic assets can be found in the code example bundle. The background images are optional, and they will not affect the gameplay and the logic of the matching game.</li><li class="listitem">We will also place the deck's sprite sheet graphics into the images folder. Then, we will download the <code class="literal">deck.png</code> file from <a class="ulink" href="http://mak.la/deck.png">http://mak.la/deck.png</a> and save it within the images folder.</li><li class="listitem">Create a dedicated CSS file named <code class="literal">matchgame.css</code> for our game and put it inside the <code class="literal">css</code> folder.</li><li class="listitem">Now, let's add style to the matching game before writing any logic. Open <code class="literal">matchgame.css</code> and add the following body styles:<div><pre class="programlisting">body {
  text-align: center;
  background: BROWN url(../images/bg.jpg);
}</pre></div></li><li class="listitem">We will continue to<a id="id211" class="indexterm"/> add the styles to the <code class="literal">game</code> element. This will be the main area of the game:<div><pre class="programlisting">#game {
  border-radius: 10px;
  border: 1px solid GRAY;
  background: DARKGREEN url(../images/table.jpg);
  width: 500px;
  height: 460px;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
}</pre></div></li><li class="listitem">We will put all card elements into a parent DOM named <code class="literal">cards</code>. By doing this, we can easily center all the cards in the game area:<div><pre class="programlisting">#cards {
  position: relative;
  width: 380px;
  height: 400px;
}</pre></div></li><li class="listitem">For each card, we define a <code class="literal">perspective</code> property to give it a visual depth effect:<div><pre class="programlisting">.card {
  perspective: 600px;
  width: 80px;
  height: 120px;
  position: absolute;
  transition: all .3s;
}</pre></div></li><li class="listitem">There are two faces on each card. The back face will be rotated later, and we will define the transition properties to animate the style changes. We also want to make sure that the back face is hidden:<div><pre class="programlisting">.face {
  border-radius: 10px;
  width: 100%;
  height: 100%;
  position: absolute;
  transition-property: opacity, transform, box-shadow;
  transition-duration: .3s;
  
  backface-visibility: hidden;
}</pre></div></li><li class="listitem">Now, we will set the styles for the front and back faces. They are almost the same as the flipping card example, except that we are now giving them background images and box <a id="id212" class="indexterm"/>shadows:<div><pre class="programlisting">.front {
  background: GRAY url(../images/deck.png) 0 -480px;
}
.back {
  background: LIGHTGREY url(../images/deck.png);
  transform: rotate3d(0,1,0,-180deg);
}
.card:hover .face, .card-flipped .face {
  box-shadow: 0 0 10px #aaa;
}
.card-flipped .front {
  transform: rotate3d(0,1,0,180deg);
}
.card-flipped .back {
  transform: rotate3d(0,1,0,0deg);
}</pre></div></li><li class="listitem">When any card is removed, we want it to fade out. Therefore, we declare a card-removed class with 0 opacity:<div><pre class="programlisting">.card-removed {
  opacity: 0;
}</pre></div></li><li class="listitem">In order to show different playing card graphics from the sprite sheet of the card deck, we clip the background of the card into different background positions:<div><pre class="programlisting">.cardAJ {background-position: -800px 0;}
.cardAQ {background-position: -880px 0;}
.cardAK {background-position: -960px 0;}
.cardBJ {background-position: -800px -120px;}
.cardBQ {background-position: -880px -120px;}
.cardBK {background-position: -960px -120px;}
.cardCJ {background-position: -800px -240px;}
.cardCQ {background-position: -880px -240px;}
.cardCK {background-position: -960px -240px;}
.cardDJ {background-position: -800px -360px;}
.cardDQ {background-position: -880px -360px;}
.cardDK {background-position: -960px -360px;}</pre></div></li><li class="listitem">We have defined<a id="id213" class="indexterm"/> a lot of CSS styles. It is now time for JavaScript's logic. We will open the <code class="literal">js/matchgame.js</code> file and put the following code inside:<div><pre class="programlisting">$(function(){
  // clone 12 copies of the card
  for(var i=0; i&lt;11; i++){
    $(".card:first-child").clone().appendTo("#cards");
  }
  // initialize each card's position
  $("#cards").children().each(function(index) {
    // align the cards to be 4x3 ourselves.
    var x = ($(this).width() + 20) * (index % 4);
    var y = ($(this).height() + 20) * Math.floor(index / 4);
    $(this).css("transform", "translateX(" + x + "px) translateY(" + y + "px)");
  });
});</pre></div></li><li class="listitem">Now, we will save all the files and preview the game in the browser. The game should be well styled, and 12 cards should appear in the center. However, we cannot click on the cards yet because we have not set any interaction logic for the cards.<div><img src="img/B04290_03_06.jpg" alt="Time for action – preparing the card-matching game"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec74"/>
<em>What just happened?</em>
</h2></div></div></div><p>We created the game<a id="id214" class="indexterm"/> structure in HTML and applied styles to the HTML elements. You can find the working example of the game with the current progress at <a class="ulink" href="http://makzan.net/html5-games/card-matching-wip-step1/">http://makzan.net/html5-games/card-matching-wip-step1/</a>.</p><p>We also used jQuery to create 12 cards on the game area once the web was loaded and ready. The styles to flip and remove the cards were also prepared and will be applied to the card by using the game logic later.</p><p>Since we are using <a id="id215" class="indexterm"/>absolute positioning for each card, we need to align the cards into 4x3 tiles ourselves. In the JavaScript logic, we loop through each card and align it by calculating the position with the looping index:</p><div><pre class="programlisting">$("#cards").children().each(function(index) {
  // align the cards to be 4x3 ourselves.
  var x = ($(this).width() + 20) * (index % 4);
  var y = ($(this).height() + 20) * Math.floor(index / 4);
  $(this).css("transform", "translateX(" + x + "px) translateY(" + y + "px)");
});</pre></div><p>The % character in JavaScript is the <strong>modulus operator</strong>
<a id="id216" class="indexterm"/> that returns the remainder left after division. The remainder is used to get the column count when we loop the cards. The following diagram shows the row/column relationship with the index number:</p><div><img src="img/B04290_03_07.jpg" alt="What just happened?"/></div><p>The division, on the other hand, is used to get the row count so that we can position the card on the corresponding row.</p><p>Take index 3 as an example; 3 % 4 is 3. So, the card at index 3 is on the third column. And 3 / 4 is 0, so it is on the first row.</p><p>Let's pick another number to see how the formula works. Let's see index 8; 8 % 4 is 0, and it is on the first column. 8 / 4 is 2 so it is on the third row.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec75"/>Cloning DOM elements with jQuery</h2></div></div></div><p>In our HTML structure, we only<a id="id217" class="indexterm"/> have one card and in the result, we have 12<a id="id218" class="indexterm"/> cards. This is because we used the <code class="literal">clone</code> function in jQuery to clone the card element. After cloning the target element, we called the <code class="literal">appendTo</code> function to append the cloned card element as a child in the cards element:</p><div><pre class="programlisting">$(".card:first-child").clone().appendTo("#cards");</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec76"/>Selecting the first child of an element in jQuery using child filters</h2></div></div></div><p>When we selected the<a id="id219" class="indexterm"/> card element and cloned it, we used the following selector:</p><div><pre class="programlisting">$(".card:first-child")</pre></div><p>The <code class="literal">:first-child</code> filter is a <strong>child filter</strong>
<a id="id220" class="indexterm"/> that selects the first child of the given parent element.</p><p>Besides <code class="literal">:first-child</code>, we can also select the last child by using <code class="literal">:last-child</code>.</p><div><div><h3 class="title"><a id="note11"/>Note</h3><p>You can also check other child-related selectors<a id="id221" class="indexterm"/> on the jQuery document at: <a class="ulink" href="http://api.jquery.com/category/selectors/child-filter-selectors/">http://api.jquery.com/category/selectors/child-filter-selectors/</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec77"/>Vertically aligning a DOM element</h2></div></div></div><p>We put the cards DIV in the center of the game element. <strong>CSS3 flexible box layout module</strong>
<a id="id222" class="indexterm"/> introduces <a id="id223" class="indexterm"/>an easy method to achieve the<a id="id224" class="indexterm"/> <strong>vertical center alignment</strong>, as follows:</p><div><pre class="programlisting">display: flex;
justify-content: center;
align-items: center;</pre></div><p>The flexible box module defines the alignment of the element when there are extra spaces in the container. We can set the element to certain behaviors as a flexible box container by using the display, a CSS2 property, with the <code class="literal">box</code> value, and a new CSS3 property value.</p><p>
<code class="literal">justify-content </code>and <code class="literal">align-items</code> are two properties to define how it aligns and uses the extra free space horizontally and vertically. We can center the element by setting both properties to <code class="literal">center</code>.</p><p>Vertical alignment is just a small part of the flexible box layout module. It is very powerful when you make <a id="id225" class="indexterm"/>layouts in web design. You may find further information on the W3C page of the module (<a class="ulink" href="http://www.w3.org/TR/css3-flexbox/">http://www.w3.org/TR/css3-flexbox/</a>) or the CSS3 trick<a id="id226" class="indexterm"/>s website (<a class="ulink" href="http://css-tricks.com/snippets/css/a-guide-to-flexbox/">http://css-tricks.com/snippets/css/a-guide-to-flexbox/</a>).</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec78"/>Using CSS sprite with a background position</h2></div></div></div><p>The CSS sprite sheet is a big image<a id="id227" class="indexterm"/> that contains many individual graphics. The<a id="id228" class="indexterm"/> big sprite sheet image is applied as the background image for the elements. We can clip each graphic out by moving the background position to a fixed width and height element.</p><p>Our deck's image contains a total of 53 graphics. In order to demonstrate the background position easily, let's assume that we have an image that contains three card images, as shown in the following screenshot:</p><div><img src="img/B04290_03_08.jpg" alt="Using CSS sprite with a background position"/></div><p>In the CSS style, we set the card element to a width of 80 px and a height of 120 px, with the background image set to the big deck image. If we want the top-left graphic, we change the values of both the <em>x</em> and <em>y</em> axes of the background position to 0. If we want the second graphic, we move the background image 80px to the left. This means setting the X position to <code class="literal">-80px</code> and Y to 0. Since we have a fixed width and height, only the clipped 80 x 120 area shows the background image. The rectangle in the following screenshot shows the <a id="id229" class="indexterm"/>viewable<a id="id230" class="indexterm"/> area:</p><div><img src="img/B04290_03_09.jpg" alt="Using CSS sprite with a background position"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Adding game logic to the matching game</h1></div></div></div><p>Let's now imagine <a id="id231" class="indexterm"/>holding a real deck in our hand and setting up <a id="id232" class="indexterm"/>the matching game.</p><p>We would first shuffle the cards in our hands and then we would put each card on the table with the back facing up. For an easier gameplay, we align the cards into a 4 x 3 array. Now, the game is set up and we are going to play it.</p><p>We pick up one card and flip it to make it face up. We pick another one and face it upwards. Afterwards, we have two possible actions. We take away the two cards if they have the same pattern. Otherwise, we put them back facing down, as if we had not touched them. The game continues until we pair all of the cards.</p><p>The code flow will be much clearer after we have this step-by-step scenario in our mind. Actually, the code in this example is exactly the same as the procedure we play with a real deck. We just need to replace the human language into the JavaScript code.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Time for action – adding game logic to the matching game</h1></div></div></div><p>We have prepared the game environment in the last example and decided the game logic should be the same as playing a real deck. It is time to code the JavaScript logic now:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's begin from our last matching game example. We have styled the CSS, and now, it is time to add the game logic in the<code class="literal"> js/matchgame.js</code> file.</li><li class="listitem">The game is to match pairs of playing cards. We have 12 cards now, so we need six pairs of playing cards. Put the following code in the <code class="literal">js/matchgame.js</code> file. The array declares six pairs of card patterns:<div><pre class="programlisting">var matchingGame = {};
matchingGame.deck = [
  'cardAK', 'cardAK',
  'cardAQ', 'cardAQ',
  'cardAJ', 'cardAJ',
  'cardBK', 'cardBK',
  'cardBQ', 'cardBQ',
  'cardBJ', 'cardBJ',
];</pre></div></li><li class="listitem">We aligned the cards in jQuery's <code class="literal">ready</code> function in the previous chapter. Now we need to prepare and initialize more code in the <code class="literal">ready</code> function. To do this, change the <code class="literal">ready</code> function into the following code. The changed code is highlighted here:<div><pre class="programlisting">$(function(){
<strong>  matchingGame.deck.sort(shuffle);</strong>

  for(var i=0;i&lt;11;i++){
    $(".card:first-child").clone().appendTo("#cards");
  }

  $("#cards").children().each(function(index) {
    var x = ($(this).width() + 20) * (index % 4);
    var y = ($(this).height() + 20) * Math.floor(index / 4);
    $(this).css("transform", "translateX(" + x + "px) translateY(" + y + "px)");

<strong>    // get a pattern from the shuffled deck</strong>
<strong>    var pattern = matchingGame.deck.pop();</strong>

<strong>    // visually apply the pattern on the card's back side.</strong>
<strong>    $(this).find(".back").addClass(pattern);</strong>

<strong>    // embed the pattern data into the DOM element.</strong>
<strong>    $(this).attr("data-pattern",pattern);</strong>

<strong>    // listen the click event on each card DIV element.</strong>
<strong>    $(this).click(selectCard);</strong>
  });
});</pre></div></li><li class="listitem">Similar to playing<a id="id233" class="indexterm"/> a real deck, the first thing we<a id="id234" class="indexterm"/> want to do is shuffle the deck. To do this, we need to add the following <code class="literal">shuffle</code> function to the JavaScript file:<div><pre class="programlisting">function shuffle() {
  return 0.5 - Math.random();<a id="id235" class="indexterm"/>
}</pre></div></li><li class="listitem">When we click on the card, we flip it and schedule the checking function. So, we must append the following codes to the JavaScript file:<div><pre class="programlisting">function selectCard() {
  // we do nothing if there are already two card flipped.
  if ($(".card-flipped").size() &gt; 1) {
    return;
  }
  $(this).addClass("card-flipped");
  // check the pattern of both flipped card 0.7s later.
  if ($(".card-flipped").size() === 2) {
    setTimeout(checkPattern,700);
  }
}</pre></div></li><li class="listitem">When two cards are opened, the following function is executed. It controls whether we remove the card or flip it back:<div><pre class="programlisting">function checkPattern() {
  if (isMatchPattern()) {
    $(".card-flipped").removeClass("card-flipped").addClass("card-removed");
    $(".card-removed").bind("transitionend",removeTookCards);
  } else {
    $(".card-flipped").removeClass("card-flipped");
  }
}</pre></div></li><li class="listitem">It is time for the <a id="id236" class="indexterm"/>pattern-checking function. The <a id="id237" class="indexterm"/>following function accesses the custom pattern attribute of the opened cards and compares them to see whether they are in the same pattern:<div><pre class="programlisting">function isMatchPattern() {
  var cards = $(".card-flipped");
  var pattern = $(cards[0]).data("pattern");
  var anotherPattern = $(cards[1]).data("pattern");
  return (pattern === anotherPattern);
}</pre></div></li><li class="listitem">After the matched cards fade out, we execute the following function to remove the cards:<div><pre class="programlisting">function removeTookCards() {
  $(".card-removed").remove();
}</pre></div></li><li class="listitem">The game logic is ready now. Let's open the game's HTML file in a browser and play. Remember to check the console window in <strong>Developer Tools</strong> to see whether there is any error.</li></ol></div><p>The following screenshot shows the CSS3 Card Matching game:</p><div><img src="img/B04290_03_10.jpg" alt="Time for action – adding game logic to the matching game"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec79"/>
<em>What just happened?</em>
</h2></div></div></div><p>We coded the game <a id="id238" class="indexterm"/>logic of the CSS3 matching game. The logic<a id="id239" class="indexterm"/> adds the mouse click interaction to the playing cards, and it controls the flow of pattern checking. You can try the game and view the full source code at <a class="ulink" href="http://makzan.net/html5-games/card-matching-wip-step2/">http://makzan.net/html5-games/card-matching-wip-step2/</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec80"/>Executing code after the CSS transition has ended</h2></div></div></div><p>We remove the paired cards after playing the<a id="id240" class="indexterm"/> fade out transition. We can schedule a function to be executed after the transition has ended by using the <code class="literal">transitionend</code> event. The following code snippet from our code example adds a <code class="literal">card-removed</code> class to the paired card to start the transition. Then, it binds the <code class="literal">transitionend</code> event to remove the card complete with the DOM, afterwards:</p><div><pre class="programlisting">$(".card-flipped").removeClass("card-flipped").addClass("card-removed");
$(".card-removed").bind("transitionend", removeTookCards);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec81"/>Delaying code execution on flipping cards</h2></div></div></div><p>The game logic flow is<a id="id241" class="indexterm"/> designed in the same way as playing a<a id="id242" class="indexterm"/> real deck. One big difference is that we used several <code class="literal">setTimeout</code> functions to delay the execution of the code. When the second card is clicked, we schedule the <code class="literal">checkPattern</code> function to be executed 0.7 seconds later by using the following code example snippet:</p><div><pre class="programlisting">if ($(".card-flipped").size() == 2) {
  setTimeout(checkPattern, 700);
}</pre></div><p>The reason we delay the function call is to give time to the player to memorize the card pattern.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec82"/>Randomizing an array in JavaScript </h2></div></div></div><p>There is no built-in array<a id="id243" class="indexterm"/> randomize function in JavaScript. We have to write our <a id="id244" class="indexterm"/>own. Luckily, we can get help from the built-in array sorting function.</p><p>Here is the usage of the <code class="literal">sort</code> function:</p><div><pre class="programlisting">sort(compare_function);</pre></div><p>The <code class="literal">sort</code> function takes one optional argument:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Definition</p>
</th><th style="text-align: left" valign="bottom">
<p>Discussion</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">compare_function</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A function <a id="id245" class="indexterm"/>that defines the sort order of the array. The <code class="literal">compare_function</code> requires two arguments.</p>
</td><td style="text-align: left" valign="top">
<p>The <code class="literal">sort</code> function compares two elements in the array by using the <code class="literal">compare</code> function. Therefore, the <code class="literal">compare</code> function requires two arguments.</p>
<p>When the <code class="literal">compare</code> function returns any value that is bigger than 0, it puts the first argument at a lower index than the second argument.</p>
<p>When the return value is smaller than 0, it puts the second argument at a lower index than the first argument.</p>
</td></tr></tbody></table></div><p>The trick here is<a id="id246" class="indexterm"/> that we used the <code class="literal">compare</code> function that returns a <a id="id247" class="indexterm"/>random number between -0.5 and 0.5:</p><div><pre class="programlisting">anArray.sort(shuffle);
function shuffle(a, b) {
  return 0.5 - Math.random();
}</pre></div><p>By returning a random number in the <code class="literal">compare</code> function, the <code class="literal">sort</code> function sorts the same array in an inconsistent way. In other words, we shuffle the array.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>The following link from the Mozilla Developer Network provides a detailed explanation on using the <code class="literal">sort</code> function<a id="id248" class="indexterm"/> with examples:</p><p>
<a class="ulink" href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/sort">https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/sort</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec83"/>Storing internal custom data with an HTML5 custom data attribute</h2></div></div></div><p>We can store custom data inside the <a id="id249" class="indexterm"/>DOM element by using the <a id="id250" class="indexterm"/>
<strong>custom data attribute</strong>. We can create a<a id="id251" class="indexterm"/> custom attribute name with the <code class="literal">data-</code> prefix and assign a value to it.</p><p>For instance, we can embed custom data to the list elements in the following code:</p><div><pre class="programlisting">&lt;ul id="games"&gt;
  &lt;li data-chapter="2" data-difficulty="easy"&gt;Ping-Pong&lt;/li&gt;
  &lt;li data-chapter="3" data-difficulty="medium"&gt;Matching Game&lt;/li&gt;
&lt;/ul&gt;</pre></div><p>This is a new feature proposed in the HTML5 spec. According to the W3C, the custom data attributes are intended to store custom data that is private to a page or an application for which there are no more appropriate attributes or elements.</p><p>W3C also states that this custom data attribute is "intended for use by the site's own script and not a generic extension mechanism for publicly-usable metadata."</p><p>We are coding our matching game and embedding our own data to the card elements; therefore, custom data attribute fits our usage.</p><p>We use the custom<a id="id252" class="indexterm"/> attribute to<a id="id253" class="indexterm"/> store the card pattern inside each card so that we can check by comparing the pattern value whether the two flipped cards match in JavaScript. In addition, the pattern is used to style the playing cards into corresponding graphics as well:</p><div><pre class="programlisting">$(this).find(".back").addClass(pattern);
$(this).attr("data-pattern",pattern);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec84"/>Pop quiz</h2></div></div></div><p>Q1. According to W3C's guidelines about the custom data attribute, which of the following statements is true?</p><div><ol class="orderedlist arabic"><li class="listitem">We can create a <code class="literal">data-link</code> attribute to store the link of the <code class="literal">css</code> tag.</li><li class="listitem">We can access the custom data attribute in a third-party game portal website.</li><li class="listitem">We can store a <code class="literal">data-score</code> attribute in each player's DOM element to sort the ranking in our web page.</li><li class="listitem">We can create a <code class="literal">ranking</code> attribute in each player's DOM element to store the ranking data.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec85"/>Accessing custom data attribute with jQuery</h2></div></div></div><p>In the matching game example, we used<a id="id254" class="indexterm"/> the <code class="literal">attr</code> function<a id="id255" class="indexterm"/> from the jQuery library to access our custom data:</p><div><pre class="programlisting">pattern = $(this).attr("data-pattern");</pre></div><p>The <code class="literal">attr</code> function returns the value of the given attribute name. For example, we can get the links in all the <code class="literal">a</code> tags by calling the following code:</p><div><pre class="programlisting">$("a").attr("href");</pre></div><p>For the HTML5 custom data attribute, jQuery provides us with another function to access the HTML5 custom data attribute. This is the <code class="literal">data</code> function.</p><p>
<code class="literal">Data</code> function was designed to embed custom data into the jQuery object of the HTML elements. It was designed before the HTML5 custom data attribute.</p><p>Here is the usage of the <code class="literal">data</code> function:</p><div><pre class="programlisting">.data(key)
.data(key,value)</pre></div><p>The <code class="literal">data</code> function accepts two types of functions:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function type</p>
</th><th style="text-align: left" valign="bottom">
<p>Arguments definition</p>
</th><th style="text-align: left" valign="bottom">
<p>Discussion</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.data(key)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The <code class="literal">key</code> <a id="id256" class="indexterm"/>argument is a string that names the entry of the data.</p>
</td><td style="text-align: left" valign="top">
<p>When only the <code class="literal">key</code> argument is given, the <code class="literal">data</code> function reads the data associated with the jQuery object and returns the corresponding value.</p>
<p>In the recent jQuery update, this function is extended to support the HTML5 custom data attribute.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.data(key,</code> <code class="literal">value)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">The key</code> argument is<a id="id257" class="indexterm"/> a string that names the entry of the data.</p>
<p>
<code class="literal">The value</code> argument is the data to be associated with the jQuery object.</p>
</td><td style="text-align: left" valign="top">
<p>When both the <code class="literal">key</code> and <code class="literal">value</code> arguments are given, the <code class="literal">data</code> function sets a new data entry to the jQuery object.</p>
<p>The <code class="literal">value</code> argument can be any JavaScript type, including an array and an object.</p>
</td></tr></tbody></table></div><p>In order to support the <a id="id258" class="indexterm"/>HTML5 custom data attribute, jQuery<a id="id259" class="indexterm"/> extends the <code class="literal">data</code> function to let it access the custom data that is defined in the HTML code.</p><p>Now, let's see how we use the <code class="literal">data</code> function. Consider the following line of an HTML code:</p><div><pre class="programlisting">&lt;div id="target" data-custom-name="HTML5 Games"&gt;&lt;/div&gt;</pre></div><p>Now, using the preceding line of code, we can access the <code class="literal">data-custom-name</code> attribute by calling the <code class="literal">data</code> function in jQuery:</p><div><pre class="programlisting">$("#target").data("customName")</pre></div><p>This will return "HTML5 Games".</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>Keep in mind <a id="id260" class="indexterm"/>that <code class="literal">attr</code> would always return a<a id="id261" class="indexterm"/> string value. However, the <code class="literal">data</code> method will attempt to convert the HTML string value into a JavaScript value, such as a number or a Boolean.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec86"/>Pop quiz</h2></div></div></div><p>Q1. Given the following HTML code, which jQuery statements read the custom score data and return 100 in the integer format?</p><div><pre class="programlisting">&lt;div id="game" data-score="100"&gt;&lt;/div&gt;</pre></div><div><ol class="orderedlist arabic"><li class="listitem"><code class="literal">$("#game").attr("data-score");</code></li><li class="listitem"><code class="literal">$("#game").attr("score");</code></li><li class="listitem"><code class="literal">$("#game").data("data-score");</code></li><li class="listitem"><code class="literal">$("#game").data("score");</code></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec87"/>Have a go hero</h2></div></div></div><p>We have created the CSS3 matching game. So, what is missing here? The game logic does not check whether the game is over. Try adding a "You won!" text when the game is over. You can also animate the text by using the techniques that we discussed in this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec88"/>Making other playing card games</h2></div></div></div><p>This CSS3 playing card approach is <a id="id262" class="indexterm"/>suitable to create card games. There are two sides on a card that fit the flipping. The transition feature is suitable to move the cards. With both moving and flipping, we can just define the playing rule and make the most of the card games.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec89"/>Have a go hero </h2></div></div></div><p>Can you use the playing card graphics and flipping techniques to create another game? How about poker?</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Embedding web fonts into our game</h1></div></div></div><p>Over the years, we <a id="id263" class="indexterm"/>have been using limited fonts to design web <a id="id264" class="indexterm"/>pages. We could not use whatever fonts we wanted because the browser loaded the font from the visitor's local machine, and we cannot control or ensure that visitors have our desired fonts.</p><p>Although we can embed <strong>web fonts</strong>
<a id="id265" class="indexterm"/> to Internet Explorer 5 with a limited type format, we have to wait until browser vendors support embedding the most common TrueType font format.</p><p>Imagine that we can control the mood of the game by embedding different styles of web fonts. We can then design the games with our desired fonts and have more control over the appeal of the game. Let's try to embed a web font into our memory matching game.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec40"/>Time for action – embedding a font from the Google Fonts directory</h1></div></div></div><p>
<strong>Google Fonts</strong> directory<a id="id266" class="indexterm"/> is a web font service that lists free-to-use web fonts. We will embed a web font chosen from the Google Fonts directory:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the <a id="id267" class="indexterm"/>Google Fonts <a id="id268" class="indexterm"/>directory site<a id="id269" class="indexterm"/> at <a class="ulink" href="http://google.com/fonts">http://google.com/fonts</a>.</li><li class="listitem">In the font directory, there is a list of web fonts that are available under an open source license and can be used freely.</li><li class="listitem">Choose one of them and click on the font name to proceed to the next step. In this example, I used <strong>Droid Serif</strong>.</li><li class="listitem">After you click on a font, the font directory displays detailed information about the font. There are several actions that we can carry out here, such as preview the font, choose from variants, and most importantly, get the font embedding code.</li><li class="listitem">In MAC, click on the <strong>Get the code</strong> tab and you will see the following screenshot; this shows a guide on how to embed this font into our web page. Alternatively, in Windows, you can click on the <strong>Use</strong> tab and you will find instructions to get the code:<div><img src="img/B04290_03_11.jpg" alt="Time for action – embedding a font from the Google Fonts directory"/></div></li><li class="listitem">Copy the <code class="literal">link</code> tag<a id="id270" class="indexterm"/> provided by Google, and <a id="id271" class="indexterm"/>then paste it into the HTML code. This should be placed before any other style definition:<div><pre class="programlisting">&lt;link href='http://fonts.googleapis.com/css?family=Droid+Serif:regular,bold&amp;subset=latin' rel='stylesheet' type='text/css'&gt;</pre></div></li><li class="listitem">Now, we can use the font to style our text. Set the body's font family property as the following code:<div><pre class="programlisting">body {
  font-family: 'Droid Serif', Arial, serif;
}</pre></div></li><li class="listitem">Save all the files and open the <code class="literal">index.html</code> file. The browser will download the font from the Google server and embed it into the web page. Keep an eye on the fonts; they should be loaded and rendered as our selected Google font.<div><img src="img/B04290_03_12.jpg" alt="Time for action – embedding a font from the Google Fonts directory"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec90"/>
<em>What just happened?</em>
</h2></div></div></div><p>We have just styled our<a id="id272" class="indexterm"/> game with an uncommon web font. The <a id="id273" class="indexterm"/>font is hosted and delivered through the Google Fonts directory.</p><p>Besides using the font directory, we can embed our font file by using <code class="literal">@font face</code>. The following link provides a bulletproof approach to embed a font ourselves:</p><p>
<a class="ulink" href="http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax">http://www.fontspring.com/blog/the-new-bulletproof-font-face-syntax</a>
</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p>
<strong>Check the font license before embedding</strong>
</p><p>Normally, the <a id="id274" class="indexterm"/>font license does not cover its<a id="id275" class="indexterm"/> usage on web pages. Be sure to check the license before embedding the font. All the fonts listed in the Google Fonts directory are licensed under the open source license and can be used on any website. You can check the <a id="id276" class="indexterm"/>license of individual fonts listed in the directory at <a class="ulink" href="https://www.google.com/fonts/attribution">https://www.google.com/fonts/attribution</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec91"/>Choosing different font delivery services</h2></div></div></div><p>Google Fonts directory is<a id="id277" class="indexterm"/> just one of the font delivery services. Typekit <a id="id278" class="indexterm"/>(<a class="ulink" href="http://typekit.com">http://typekit.com</a>) and Fontdeck<a id="id279" class="indexterm"/> (<a class="ulink" href="http://fontdeck.com">http://fontdeck.com</a>) are two other font services that provide hundreds of high quality fonts via yearly subscription plans.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec41"/>Summary</h1></div></div></div><p>In this chapter, you learned about using different new properties of CSS3 to create games.</p><p>Specifically, we covered how you can build a card game that is based on CSS3 styles and animation. You learned how to transform and animate the game object by using the transition module. We can flip a card back and forth with perspective depth illusion. We also embedded web fonts from an online font delivery service.</p><p>Now that you've learned about creating DOM-based HTML5 games with the help of CSS3 features, we are going to explore another approach—using the new <code class="literal">canvas</code> tag and the drawing API—to create HTML5 games in the next chapter.</p></div></body></html>