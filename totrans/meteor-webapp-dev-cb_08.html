<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Integrating Third-party Libraries" id="aid-21PMQ1"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Integrating Third-party Libraries</h1></div></div></div><p>In this chapter, you will learn the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Using npm packages directly</li><li class="listitem">Building graphs with D3.js</li><li class="listitem">Creating cutting-edge UIs with Polymer</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec63"/>Introduction</h1></div></div></div><p>With so many <a id="id421" class="indexterm"/>third-party packages available via Atmosphere it's very easy to build, basically, anything! If you have a specific development need—some type of logic or library—chances are someone else has already packaged it up for you (and if they haven't, what a great opportunity for you!).</p><p>That being said, not all packages are created equal. Some will have fantastic documentation, with samples and tutorials on how to implement a library inside Meteor. Others, not so much. In either case, you will at some point need to roll up your sleeves and do a bit of work yourself. In this chapter, we will go over a few of the more popular third-party libraries, and show you how to implement them in Meteor.</p></div></div>
<div class="section" title="Using npm packages directly"><div class="titlepage" id="aid-22O7C2"><div><div><h1 class="title"><a id="ch08lvl1sec64"/>Using npm packages directly</h1></div></div></div><p>We have <a id="id422" class="indexterm"/>seen from the <span class="emphasis"><em>Using npm modules</em></span> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <span class="emphasis"><em>Customizing with Packages</em></span>, how to wrap npm packages inside your own personal package, using the <code class="literal">Npm.depends()</code> directive. That's all well and good, but what if we want to just use npm directly, without creating a custom package? Arunoda Susiripala — one of the most prolific (and brilliant) Meteor community developers, has written a package that helps us do just that. In this recipe, you will learn how to use the <code class="literal">meteorhacks:npm</code> package to implement a npm module directly in your code. Specifically, we will use the <code class="literal">Highlight.js</code> module on the server to properly format JavaScript code, as you might see in markdown or in an online code editor.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec228"/>Getting ready</h2></div></div></div><p>We will be using a default project installation, with the <code class="literal">client</code>, <code class="literal">server</code>, and <code class="literal">both</code> folders, to keep the code clean and readable. We will also use the <code class="literal">private</code> folder for some static content, so let's add that while we're at it. In a terminal window, navigate to where you would like your project to reside, and execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor create npmdirect</strong></span>
<span class="strong"><strong>$ cd npmdirect</strong></span>
<span class="strong"><strong>$ rm npmdirect.*</strong></span>
<span class="strong"><strong>$ mkdir {client,server,private,both}</strong></span>
</pre></div><p>We also want to make use of the <code class="literal">meteorhacks:npm</code> package, so let's do that now. Run the following commands in the terminal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add meteorhacks:npm</strong></span>
<span class="strong"><strong>$ meteor</strong></span>
</pre></div><p>Lastly, we will <a id="id423" class="indexterm"/>want to open a browser to <code class="literal">http://localhost:3000</code>, so we can watch the fun! We're now ready to start creating our direct npm integrations.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec229"/>How to do it...</h2></div></div></div><p>We will be adding the <code class="literal">Highlight.js</code> Node module and adding some sample code to leverage the module, using an inline template as our work area. Proceed with the following steps to use npm packages directly:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will first add the <code class="literal">Highlight.js</code> Node module. To add a direct-use npm module, we will make a simple declaration in the <code class="literal">packages.json</code> file that was automatically added to our project when we added <code class="literal">meteorhacks:npm</code>. Open <code class="literal">[project root]/packages.json</code> and add the following declaration:<div class="informalexample"><pre class="programlisting">{
<span class="strong"><strong>  "highlight.js" : "8.4.0"</strong></span>
}</pre></div><p>If you look in the terminal window where Meteor is running, you will see something similar to the following text:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>npm-container: updating npm dependencies -- highlight.js...</strong></span>
<span class="strong"><strong>=&gt; Meteor server restarted</strong></span>
</pre></div><p>Our <code class="literal">Highlight.js</code> module is now ready to use!</p></li><li class="listitem">We will now create the server logic needed to use <code class="literal">Highlight.js</code>. Create a file named <code class="literal">server.js</code> in the <code class="literal">[project root]/server/</code> directory. Open that file for editing and add the following code:<div class="informalexample"><pre class="programlisting">Meteor.methods({
  highlight : function(){
    return setC();
  }
});

var setC = function(){
  var hLight = Meteor.npmRequire('highlight.js');
  var code = Assets.getText('code.txt');
  code = hLight.highlight('javascript',code,true);
  return code.value;
};</pre></div></li><li class="listitem">Next, let's create a sample code file in the <code class="literal">private</code> folder. We are going to use a base text file for the code we will highlight to make the syntax much easier (rather than try to do it in a JavaScript <code class="literal">var</code>, which can be messy with escape sequences). Meteor lets us use the <code class="literal">[project root]/private/</code> folder to store static files only visible on the server. Create a file in the <code class="literal">private</code> folder, called <code class="literal">code.txt</code>, and add some (valid) JavaScript to the file. We will reuse the <code class="literal">var setC = …</code> function from the preceding step, but you can put anything you want inside there, provided it's valid JavaScript. Once you've added some code, save your changes.</li><li class="listitem">We now <a id="id424" class="indexterm"/>need to create a simple code panel template. Create a file in <code class="literal">[project root]/client/</code> named <code class="literal">main.html</code>. Open that file for editing, and add the following code:<div class="informalexample"><pre class="programlisting">&lt;body&gt;
{{&gt; code}}
&lt;/body&gt;
&lt;template name="code"&gt;
  &lt;pre class="hljs"&gt;{{{highlighted}}}&lt;/pre&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">With the template in place, we can add <code class="literal">Template.code.helpers</code>, and use <code class="literal">Meteor.call()</code>. Create a file in <code class="literal">[project root]/client/</code> called <code class="literal">tmpl-code.js</code> and add the following code:<div class="informalexample"><pre class="programlisting">Template.code.helpers({
  highlighted : function(){
    return Session.get('code');
  }
});

Meteor.startup(function(){
  Meteor.call('highlight', function(e,d){
    if (e) return;
      Session.set('code',d);
  });
});</pre></div><p>After saving these changes, your code from the <code class="literal">code.js</code> file will be visible, albeit with little/no CSS formatting. If you check your browser, you should see something similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00393.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Well, that's <a id="id425" class="indexterm"/>not all that impressive, is it? Let's really highlight what is happening with some custom CSS. In a browser, navigate to the official list of <code class="literal">Highlights.js</code> themes, found at <a class="ulink" href="https://github.com/isagalaev/highlight.js/tree/master/src/styles">https://github.com/isagalaev/highlight.js/tree/master/src/styles</a> and pick any theme you like. Simply click on the name of the theme, click on the <a id="id426" class="indexterm"/>button labeled <span class="strong"><strong>Raw</strong></span>, and copy the corresponding CSS code. Then, create a file named <code class="literal">style.css</code> in your <code class="literal">[project root]/client/</code> folder, paste the code you copied, and save the file. Your formatted text should now have some noticeable formatting and coloring, similar to the following screenshot (this is the <code class="literal">Solarized Light</code> theme, copied from <code class="literal">solarized_light.css</code> at the link that we mentioned previously):<div class="mediaobject"><img src="../Images/image00394.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec230"/>How it works...</h2></div></div></div><p>Inside of our <code class="literal">server.js</code> file, we created a simple <code class="literal">Meteor</code> method, available on (and called by) the client via <code class="literal">Meteor.call()</code>. We created a separate function that is called inside of the method even though we didn't have to (we could have just put the logic directly in the method call), because we wanted to keep our code clean and illustrative. Inside the <code class="literal">setC()</code> function, we make direct use of a npm module by using <code class="literal">Meteor.npmRequire()</code>:</p><div class="informalexample"><pre class="programlisting">var hLight = <span class="strong"><strong>Meteor.npmRequire</strong></span>('highlight.js');</pre></div><p>Quickly referencing <a id="id427" class="indexterm"/>our text file via <code class="literal">Assets.getText()</code>, we pipe our sample code into the <code class="literal">Highlights.js</code> file in the <code class="literal">.highlight()</code> method, which takes the language (<code class="literal">'javascript'</code>) as an argument, to let the module know what language highlighting we would like to see in the resultant formatted text:</p><div class="informalexample"><pre class="programlisting">var code = <span class="strong"><strong>Assets.getText</strong></span>('code.txt');
code = hLight<span class="strong"><strong>.highlight</strong></span>('javascript',code,true);
return code.value;</pre></div><p>We return the formatted text, which is subsequently updated in the client UI, through the <code class="literal">Session.get('code')</code> variable. The template renders the raw HTML string, thanks to the use of <code class="literal">{{{triple moustaches}}}</code> rather than double, and the CSS file we added takes care of the eye candy for us.</p><p>In a nutshell, it really is that simple — by adding the <code class="literal">meteorhacks:npm</code> package, we can simply declare which npm modules we would like to use in our <code class="literal">packages.json</code> file, and then use them directly in Meteor, via the <code class="literal">Meteor.npmRequire()</code> function.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec231"/>There's more...</h2></div></div></div><p>As you may be aware, npm runs strictly asynchronously and is non-blocking. This means that a lot of the times when you want to use an npm module in Meteor, and want to do so synchronously, you need to wrap the call in an <code class="literal">Async</code> wrapper. We will explore how to do this in more depth in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <span class="emphasis"><em>Leveraging Advanced Features,</em></span> but the <code class="literal">meteorhacks:npm</code> package allows us to do this quickly/easily as well, via the <code class="literal">Async.wrap()</code> and <code class="literal">Async.runSync()</code> methods.</p><div class="note" title="Note"><h3 class="title"><a id="tip34"/>Tip</h3><p>To learn more <a id="id428" class="indexterm"/>about <code class="literal">Async.wrap</code> and other methods available in <code class="literal">meteorhacks:npm</code>, please see the introduction available at <a class="ulink" href="https://atmospherejs.com/meteorhacks/npm">https://atmospherejs.com/meteorhacks/npm</a>.</p></div><p>Lastly, even though <a id="id429" class="indexterm"/>it's undocumented (and therefore not officially supported/subject to change), there are some npm modules used by the core Meteor server libraries that are exposed and usable on the server side. To use any of these, simply use <code class="literal">Npm.require()</code> in your server code, and you don't need to implement anything else. You can use them directly. The current list, as of <code class="literal">v1.0.2</code>, is as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">child_process</code></li><li class="listitem"><code class="literal">crypto</code></li><li class="listitem"><code class="literal">fibers</code></li><li class="listitem"><code class="literal">fibers/future</code></li><li class="listitem"><code class="literal">fs</code></li><li class="listitem"><code class="literal">http</code></li><li class="listitem"><code class="literal">os</code></li><li class="listitem"><code class="literal">path</code></li><li class="listitem"><code class="literal">semver</code></li><li class="listitem"><code class="literal">source-map-support</code></li><li class="listitem"><code class="literal">underscore</code></li><li class="listitem"><code class="literal">url</code></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec232"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Using npm modules</em></span> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <span class="emphasis"><em>Customizing with Packages</em></span></li><li class="listitem">The <span class="emphasis"><em>Inserting raw HTML using triple braces</em></span> recipe in <a class="link" title="Chapter 3. Building Great User Interfaces" href="part0036.xhtml#aid-12AK81">Chapter 3</a>, <span class="emphasis"><em>Building Great User Interfaces</em></span></li><li class="listitem">The <span class="emphasis"><em>Handling asynchronous events</em></span> and <span class="emphasis"><em>Using asynchronous functions</em></span> recipes in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <span class="emphasis"><em>Leveraging Advanced Features</em></span></li></ul></div></div></div>
<div class="section" title="Building graphs with D3.js"><div class="titlepage" id="aid-23MNU2"><div><div><h1 class="title"><a id="ch08lvl1sec65"/>Building graphs with D3.js</h1></div></div></div><p>Using <a id="id430" class="indexterm"/>third-party libraries to render content inside Meteor is <a id="id431" class="indexterm"/>simple and easy to do, and there are a lot of great libraries out there. One of our personal favorites is the <code class="literal">D3.js</code> library (<a class="ulink" href="http://d3js.org/">http://d3js.org/</a>). It's <a id="id432" class="indexterm"/>well-documented, well-supported, and is a representative example of how to implement other (mostly) self-contained graphics rendering libraries. In this recipe we will create a demo graph application, complete with animations, using <code class="literal">D3.js.</code></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec233"/>Getting ready</h2></div></div></div><p>We will be using a default project installation, with the <code class="literal">client</code>, <code class="literal">server</code>, and <code class="literal">both</code> folders, and we will of course need the official <code class="literal">D3.js</code> package. In a terminal window, navigate to where you would like your project to reside, and execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor create d3sample</strong></span>
<span class="strong"><strong>$ cd d3sample</strong></span>
<span class="strong"><strong>$ rm d3sample.*</strong></span>
<span class="strong"><strong>$ mkdir {client,server,both}</strong></span>
<span class="strong"><strong>$ meteor add d3js:d3</strong></span>
<span class="strong"><strong>$ meteor</strong></span>
</pre></div><p>With that out of the way, let's build us some sample graphs in D3!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec234"/>How to do it…</h2></div></div></div><p>Normally, the <code class="literal">D3.js</code> data sources are updated manually, or as the result of a feed, with an <code class="literal">update</code> statement of some kind being called. Because Meteor enables reactive computations (see the <span class="emphasis"><em>Creating and consuming a reactive value</em></span> recipe in <a class="link" title="Chapter 6. Mastering Reactivity" href="part0058.xhtml#aid-1NA0K1">Chapter 6</a>, <span class="emphasis"><em>Mastering Reactivity</em></span>), we are going to put the <code class="literal">D3.js</code> rendering logic right into a <code class="literal">Tracker.autorun()</code> computation instead. Let's set up our reactive data source, throw that rendering logic into an <code class="literal">autorun</code>, and add some animations for good measure!</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We first need to create and initialize the <code class="literal">Letters</code> collection. Create a file named <code class="literal">model.js</code> in your <code class="literal">[project root]/both/</code> folder, and add the following code:<div class="informalexample"><pre class="programlisting">Letters = new Mongo.Collection('letters');</pre></div><p>Let's add an initialization of that collection as well. In your <code class="literal">[project root]/server/</code> folder, create a file named <code class="literal">server.js</code> and add the following <code class="literal">Meteor.startup</code> function code:</p><div class="informalexample"><pre class="programlisting">Meteor.startup(function(){
  if (!Letters.find().fetch().length){
    Letters.insert({letter:'A',frequency:.08167});
    Letters.insert({letter:'B',frequency:.01492});
    Letters.insert({letter:'C',frequency:.02782});
    Letters.insert({letter:'D',frequency:.04253});
    Letters.insert({letter:'E',frequency:.12702});
    Letters.insert({letter:'F',frequency:.02288});
    Letters.insert({letter:'G',frequency:.02015});
    Letters.insert({letter:'H',frequency:.06094});
    Letters.insert({letter:'I',frequency:.06966});
    Letters.insert({letter:'J',frequency:.00153});
    Letters.insert({letter:'K',frequency:.00772});
    Letters.insert({letter:'L',frequency:.04025});
    Letters.insert({letter:'M',frequency:.02406});
    Letters.insert({letter:'N',frequency:.06749});
    Letters.insert({letter:'O',frequency:.07507});
    Letters.insert({letter:'P',frequency:.01929});
    Letters.insert({letter:'Q',frequency:.00095});
    Letters.insert({letter:'R',frequency:.05987});
    Letters.insert({letter:'S',frequency:.06327});
    Letters.insert({letter:'T',frequency:.09056});
    Letters.insert({letter:'U',frequency:.02758});
    Letters.insert({letter:'V',frequency:.00978});
    Letters.insert({letter:'W',frequency:.02360});
    Letters.insert({letter:'X',frequency:.00150});
    Letters.insert({letter:'Y',frequency:.01974});
    Letters.insert({letter:'Z',frequency:.00074});
  }
});</pre></div></li><li class="listitem">While we <a id="id433" class="indexterm"/>have <code class="literal">server.js</code> open, let's add a quick <a id="id434" class="indexterm"/>helper method to update the frequency, which we will use a bit later. Add the following code to <code class="literal">server.js</code>:<div class="informalexample"><pre class="programlisting">Meteor.methods({
  updateFrequency : function(letter,frequency){
    Letters.update({letter:letter},
      {$set:{frequency:frequency}});
  }
});</pre></div></li><li class="listitem">Now, we will add some simple scaffolding and styling. Our HTML is extremely simple, because <code class="literal">D3.js</code> is doing the heavy lifting. That said, we do want to put our <code class="literal">svg</code> element into a Meteor Template. Navigate to your <code class="literal">[project root]/client/</code> folder, create a file named <code class="literal">client.html</code>, and add the following code:<div class="informalexample"><pre class="programlisting">&lt;body&gt;
  {{&gt; diagram}}
&lt;/body&gt;

&lt;template name="diagram"&gt;
  &lt;svg class="chart"&gt;&lt;/svg&gt;
&lt;/template&gt;</pre></div><p>Let's add some simple styling to adjust fonts and colors, and so on. Create a file named <code class="literal">[project root]/client/style.css</code> and add the following CSS declarations:</p><div class="informalexample"><pre class="programlisting">.bar {
  fill: steelblue;
}
.bar:hover {
  fill: brown;
}
.axis {
  font: 10px sans-serif;
}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
.x.axis path {
  display: none;
}</pre></div><p>We are now ready to add the <code class="literal">D3.js</code> rendering logic, inside <code class="literal">rendered</code>/<code class="literal">autorun</code>. The following code is taken almost line-for-line from Mike <a id="id435" class="indexterm"/>Bostock's awesome introductory <a id="id436" class="indexterm"/>tutorial on <code class="literal">D3.js</code>. The easiest thing to do would be to take the existing code base from that tutorial, copy and paste it into a local file, and then modify it. To do this, navigate in a browser to <a class="ulink" href="http://bl.ocks.org/mbostock/3885304">http://bl.ocks.org/mbostock/3885304</a> and copy everything inside the <code class="literal">&lt;script&gt;</code> tag to the ending <code class="literal">&lt;/script&gt;</code> tag. Create a file named <code class="literal">client.js</code> in your <code class="literal">[project root]/client/</code> folder, and paste the code into the new file (about 60 lines of code).</p><p>We will now modify the code from that page in the following four ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Wrap all of the code inside a <code class="literal">Template.rendered</code> callback</li><li class="listitem">Wrap and extend the <code class="literal">d3.selectAll</code> rendering code inside an <code class="literal">autorun</code> computation</li><li class="listitem">Move and modify the axes rendering code outside the <code class="literal">autorun</code></li><li class="listitem">Change data to point to our <code class="literal">Letters.find()</code> Mongo query</li></ul></div><p>The completed <code class="literal">Template.diagram.rendered</code> callback is listed in the following code. It mainly consists of the <code class="literal">D3.js</code> sample code, with the preceding four modifications highlighted. If it's easier, you can simply copy and paste from below, rather than making the modifications yourself. However, it's worthwhile to at least go over the changes, to see how the code was modified. In your <code class="literal">client.js</code> file, make the following <a id="id437" class="indexterm"/>modifications to the existing <a id="id438" class="indexterm"/>code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Template.diagram.rendered = function(){</strong></span>
<span class="strong"><strong>  //we wrap everything in the Template.rendered() callback,</strong></span>
<span class="strong"><strong>  // so that we don't interfere with Blaze</strong></span>
  var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

<span class="strong"><strong>  //We are going to set the domains for x an y immediately</strong></span>
<span class="strong"><strong>  //(assuming the alphabet isn't going to change)</strong></span>
<span class="strong"><strong>  x</strong></span> = d3.scale.ordinal()
  <span class="strong"><strong>.domain('ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''))</strong></span>
  .rangeRoundBands([0, width], .1);

<span class="strong"><strong>  //ALSO: note that we *removed* the 'var' declarations,</strong></span>
<span class="strong"><strong>  //so that x and y are global / accessible</strong></span>
<span class="strong"><strong>  y</strong></span> = d3.scale.linear()
  <span class="strong"><strong>.domain([0,0.15])</strong></span>
  .range([height, 0]);

  var xAxis = d3.svg.axis()
  .scale(x)
  .orient("bottom");

  var yAxis = d3.svg.axis()
  .scale(y)
  .orient("left")
  .ticks(10, "%");

<span class="strong"><strong>  // We are moving the axes creation (and SVG init)</strong></span>
<span class="strong"><strong>  // to be *outside* our autorun()</strong></span>
  var svg = d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(xAxis);

  svg.append("g")
  .attr("class", "y axis")
  .call(yAxis)
  .append("text")
  .attr("transform", "rotate(-90)")
  .attr("y", 6)
  .attr("dy", ".71em")
  .style("text-anchor", "end")
  .text("Frequency");


  //We move D3.js rendering inside Tracker.autorun()
  <span class="strong"><strong>this.autorun(function(){</strong></span>
    // Instead of reading data from a static file,
    // we access the Letters collection
    <span class="strong"><strong>var data = Letters.find().fetch();</strong></span>
    <span class="strong"><strong>if (!data.length) return;</strong></span>

    // To use D3.js's built-in update tracking,
    // we need access to our d3.selectAll() object..
    <span class="strong"><strong>var bars = svg</strong></span>
    .selectAll(".bar")
    <span class="strong"><strong>.data(data, function(d){return d._id;});</strong></span>

    // On new (when initializing), we append and animate
    bars.enter()
    .append("rect")
    .attr("class", "bar")
    .attr("x", function(d) { return x(d.letter); })
    .attr("width", x.rangeBand())
<span class="strong"><strong>    .attr("height",0)</strong></span>
<span class="strong"><strong>    .attr("y", height)</strong></span>
<span class="strong"><strong>    .transition()</strong></span>
    .attr("y", function(d) { return y(d.frequency); })
    .attr("height", function(d) { return height - y(d.frequency); });

    // On change, we just animate to the new position
    <span class="strong"><strong>bars</strong></span>
    <span class="strong"><strong>.transition()</strong></span>
    <span class="strong"><strong>.duration(200)</strong></span>
    <span class="strong"><strong>.ease("sin-out")</strong></span>
    <span class="strong"><strong>.attr("y", function(d) { return y(d.frequency); })</strong></span>
    <span class="strong"><strong>.attr("height", function(d) { return height - </strong></span>      <span class="strong"><strong>y(d.frequency); });</strong></span>

  });
};</pre></div></li><li class="listitem">We can now create and call the <code class="literal">randomize</code> function. Our page should be rendering correctly now (check at <code class="literal">http://localhost:3000</code> and see for yourself), but it's not moving or doing anything else. Let's change that by changing to <a id="id439" class="indexterm"/>random frequency values for our letters. Towards <a id="id440" class="indexterm"/>the bottom of <code class="literal">client.js</code>, just after the <code class="literal">autorun</code> block, and just before the ending bracket for the rendered <code class="literal">callback</code> block, add the following timer call:<div class="informalexample"><pre class="programlisting">});//&lt;--- end of autorun()

<span class="strong"><strong>// everything's set! let's randomize 5 times / second...</strong></span>
<span class="strong"><strong>  Meteor.setInterval(randomize,200);</strong></span>

};//&lt;-- end of rendered()</pre></div><p>Finally, add the <code class="literal">randomize()</code> function at the very bottom of the file, after everything else:</p><div class="informalexample"><pre class="programlisting">// Our randomize function
randomize = function(){
  // get a random position between 0-25
  var ranLetter = ~~(Math.random()*26),
  // and a random frequency between 0-15%
    ranFreq = (Math.random()*0.15);

  // get the actual character
  ranLetter = x.domain()[ranLetter];

// update the frequency using a server call,
// because it's easier than tracking down the _id
  Meteor.call('updateFrequency',ranLetter,ranFreq);
};</pre></div><p>Save all of your changes, and your bar chart should be hopping along happily, similar <a id="id441" class="indexterm"/>to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00395.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec235"/>How it works…</h2></div></div></div><p>There are two key <a id="id442" class="indexterm"/>rules to remember when integrating <code class="literal">D3.js</code> (and, by extension, any other rendering engine):</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Put all your DOM/SVG manipulation logic inside <code class="literal">Template.rendered()</code></li><li class="listitem">Make the data source reactive, and wrap the rendering logic inside <code class="literal">Tracker.autorun()</code></li></ol><div style="height:10px; width: 1px"/></div><p>We followed rule #1 when we added the entire <code class="literal">D3.js</code> logic from the tutorial inside of <code class="literal">Template.diagram.rendered()</code>. This tells Blaze to keep its (awesome, yet grubby) hands off everything we'll be doing. We're essentially telling Blaze to go have a smoke break, while we implement some good ol' fashioned DOM/SVG manipulation (and animations!).</p><p>Then, instead of relying on a non-reactive data source, where we would have to periodically check for updates and/or call an <code class="literal">update()</code> function whenever results change, we used Meteor's declarative, reactive programming style by wrapping the <code class="literal">D3.js</code> logic inside an <code class="literal">autorun</code> function. That <code class="literal">autorun</code> function will re-run every time there's a change to the <code class="literal">Letters</code> collection, thanks to <code class="literal">var data = Letters.find().fetch()</code>; which is a reactive data source.</p><p>In other words, we followed rule #2 by creating a <code class="literal">D3.js</code>-friendly reactive computation, instead of using a functional (non-reactive) data model, like a hobo. Mike Bostock would be proud of us, as the avoidance of functional programming is one of the core tenets of <code class="literal">D3.js</code>.</p><p>It seems like we wrote a lot of code because of the <code class="literal">D3.js</code> sample code, and there are some details we're <a id="id443" class="indexterm"/>leaving out, such as moving the <code class="literal">y</code> and <code class="literal">x</code> axes rendering <a id="id444" class="indexterm"/>logic outside the <code class="literal">autorun</code> function (because we don't want to re-render it every time), but it really is that simple. Notice how incredibly simple (and loosely-coupled) our update statement is, inside the <code class="literal">randomize()</code> function: one. single. line.</p><p>When it comes to third-party renderers, wrap using <code class="literal">rendered()</code> and be reactive using <code class="literal">autorun()</code>.</p><div class="note" title="Note"><h3 class="title"><a id="tip35"/>Tip</h3><p>Wrap using <code class="literal">rendered()</code>, be reactive using <code class="literal">autorun()</code>.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec236"/>There's more…</h2></div></div></div><p>We strongly encourage you to look deeper into <code class="literal">D3.js</code>, which (as mentioned) runs on the same declarative programming principle as Meteor. There's a reason it integrates so cleanly, and for <a id="id445" class="indexterm"/>SVG graphs and animations, it really is top notch.</p><div class="note" title="Note"><h3 class="title"><a id="tip36"/>Tip</h3><p>Tutorials for <code class="literal">D3.js</code> can be found at <a class="ulink" href="https://github.com/mbostock/d3/wiki/Tutorials">https://github.com/mbostock/d3/wiki/Tutorials</a>.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec237"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Creating dynamic lists</em></span> recipe in <a class="link" title="Chapter 3. Building Great User Interfaces" href="part0036.xhtml#aid-12AK81">Chapter 3</a>, <span class="emphasis"><em>Building Great User Interfaces</em></span></li><li class="listitem">The <span class="emphasis"><em>Creating dynamic graphs with SVG and Ajax</em></span> recipe in <a class="link" title="Chapter 7. Using Client Methods" href="part0065.xhtml#aid-1TVKI1">Chapter 7</a>, <span class="emphasis"><em>Using Client Methods</em></span></li></ul></div></div></div>
<div class="section" title="Creating cutting-edge UIs with Polymer"><div class="titlepage" id="aid-24L8G2"><div><div><h1 class="title"><a id="ch08lvl1sec66"/>Creating cutting-edge UIs with Polymer</h1></div></div></div><p>Polymer (<a class="ulink" href="https://www.polymer-project.org/">https://www.polymer-project.org/</a>) is ambitious. It is ambitious in the very best <a id="id446" class="indexterm"/>possible way, in that, if it succeeds, it will <a id="id447" class="indexterm"/>make our development lives so much better.</p><p>One of the <a id="id448" class="indexterm"/>largest time-wasting activities we as web developers go through is tweaking CSS, repositioning DOM elements, and trying to manually code animations. It's not that those things are bad (some of us quite enjoy well-designed components); It's that nearly every time, our efforts are thrown away when a new project or design theme is introduced.</p><p>Through the use of reusable, reliable components that work the same on every modern browser (or at least that's the goal — ambitious, right?), Polymer intends to abstract the design from the development, allowing developers to focus on development, and designers to focus on design.</p><p>This recipe will show you how to use Polymer components inside a Meteor application.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec238"/>Getting ready</h2></div></div></div><p>We are going to break down the actual recipe into two parts: configuring Meteor and Polymer and adding Polymer elements to our app. Because of this, we are going to handle the configuration and setup in the <span class="emphasis"><em>Getting ready</em></span> step to keep the code and explanation of the code easier to understand.</p><div class="section" title="Creating your app and folders"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec14"/>Creating your app and folders</h3></div></div></div><p>We will need <a id="id449" class="indexterm"/>several folders and subfolders we don't normally use, so <a id="id450" class="indexterm"/>let's get our entire file structure out of the way. Open a terminal window, navigate to where you would like to create your root project, and execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor create polymersample</strong></span>
<span class="strong"><strong>$ cd polymersample</strong></span>
<span class="strong"><strong>$ rm polymersample.*</strong></span>
<span class="strong"><strong>$ mkdir -p client/templates/init</strong></span>
<span class="strong"><strong>$ mkdir {both,server}</strong></span>
<span class="strong"><strong>$ mkdir -p public/components</strong></span>
</pre></div></div><div class="section" title="Creating your files"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec15"/>Creating your files</h3></div></div></div><p>To save time <a id="id451" class="indexterm"/>creating files one by one later on, let's create them all right now. In the same terminal window, in your <code class="literal">[project root]</code> folder, execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ touch .bowerrc</strong></span>
<span class="strong"><strong>$ touch client/imports.html</strong></span>
<span class="strong"><strong>$ touch client/main.html</strong></span>
<span class="strong"><strong>$ touch client/styles.css</strong></span>
<span class="strong"><strong>$ touch client/templates/tmpl-authors.html</strong></span>
<span class="strong"><strong>$ touch client/templates/tmpl-authors.js</strong></span>
<span class="strong"><strong>$ touch client/templates/tmpl-search.html</strong></span>
<span class="strong"><strong>$ touch client/templates/tmpl-search.js</strong></span>
<span class="strong"><strong>$ touch client/templates/init/head.html</strong></span>
<span class="strong"><strong>$ touch both/model.js</strong></span>
<span class="strong"><strong>$ touch server/server.js</strong></span>
</pre></div></div><div class="section" title="Configuring Bower and installing Polymer"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec16"/>Configuring Bower and installing Polymer</h3></div></div></div><p><span class="strong"><strong>Bower</strong></span> is the <a id="id452" class="indexterm"/>safest and best way to install the Polymer libraries, as it <a id="id453" class="indexterm"/>makes sure we have the latest and greatest. You will want to make sure that you have Bower installed. If you don't, in your terminal window run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm install -g bower</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip37"/>Tip</h3><p>You may need to run npm as <code class="literal">sudo</code> because you're installing globally. If so, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>sudo npm install -g bower.</strong></span>
</pre></div></div><p>With Bower installed, we want to tell Bower where we would like the Polymer components installed. In Meteor, that is in the <code class="literal">public</code>/<code class="literal">components</code> folder. In a text editor, open the <code class="literal">[project root]/.bowerrc</code> file, add the following line and save your changes:</p><div class="informalexample"><pre class="programlisting">{"directory":"public/components/"}</pre></div><p>We are now ready to initialize our project using Bower. In a terminal window, in your <code class="literal">[project root]/</code> directory, enter the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ bower init</strong></span>
</pre></div><p>Bower is about to ask you a lot of questions! The good news is the answer to most of them is the <span class="emphasis"><em>return</em></span> key, or a <span class="emphasis"><em>space</em></span> and then the <span class="emphasis"><em>return</em></span> key. Even better news is that most of the answers don't really matter. But, you do need to go through this, so that Bower will generate the <code class="literal">bower.json</code> file for you, which will keep track of which Polymer libraries we install (more on that in a minute), so answer the questions similar to the following example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>? name: Polymer Sample</strong></span>
<span class="strong"><strong>? version: 0.0.1</strong></span>
<span class="strong"><strong>? description: </strong></span>
<span class="strong"><strong>? main file: </strong></span>
<span class="strong"><strong>? what types of modules does this package expose?: </strong></span>
<span class="strong"><strong>? keywords: </strong></span>
<span class="strong"><strong>? authors:  </strong></span>
<span class="strong"><strong>? license: none</strong></span>
<span class="strong"><strong>? homepage:  </strong></span>
<span class="strong"><strong>? set currently installed components as dependencies?: No</strong></span>
<span class="strong"><strong>? add commonly ignored files to ignore list?: Yes</strong></span>
<span class="strong"><strong>? would you like to mark this package as private which prevents it from being accidentally published to the registry?: Yes</strong></span>
</pre></div><p>You will then get a <a id="id454" class="indexterm"/>preview of your <code class="literal">bower.json</code> file, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00396.jpeg" alt="Configuring Bower and installing Polymer"/></div><p style="clear:both; height: 1em;"> </p><p>Provided that <code class="literal">private:true</code>, and <code class="literal">ignore:[…]</code> are in place, type <span class="emphasis"><em>Y</em></span> and hit <span class="emphasis"><em>Enter</em></span>. Your Bower <a id="id455" class="indexterm"/>configuration is now complete!</p><p>We are now ready to install the Polymer libraries. In the same terminal window, enter the following commands, one after another, allowing one to complete before moving on to the next:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ bower install polymer --save</strong></span>
<span class="strong"><strong>$ bower install polymer/core-elements --save</strong></span>
<span class="strong"><strong>$ bower install polymer/paper-elements --save</strong></span>
<span class="strong"><strong>$ bower install polymer-github-card --save</strong></span>
</pre></div><p>On the last <a id="id456" class="indexterm"/>install, Bower will ask you what version of <code class="literal">polymer</code> <a id="id457" class="indexterm"/>and <code class="literal">core-components</code> will be supporting <code class="literal">polymer-github-card</code>. Select the version that the other components are dependent upon (as of this writing, this is <code class="literal">[library]#^0.5.0</code>).</p></div><div class="section" title="Adding helper Meteor packages"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec17"/>Adding helper Meteor packages</h3></div></div></div><p>There are <a id="id458" class="indexterm"/>three third-party packages we need to add. One of them, (<code class="literal">voodoohop:masonrify</code>), will assist with our layout, and the other two, (<code class="literal">meteorhacks:inject-initial</code> and <code class="literal">differential:vulcanize</code>), will allow Polymer elements to be added to our Meteor project with the least amount of pain (we suspect that this will get better in the future, but for now this is the workaround; and honestly it's not really so bad). In a terminal window, in your <code class="literal">[project root]/</code> folder, enter the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add voodoohop:masonrify</strong></span>
<span class="strong"><strong>$ meteor add meteorhacks:inject-initial</strong></span>
<span class="strong"><strong>$ meteor add differential:vulcanize</strong></span>
</pre></div></div><div class="section" title="Configuring Meteor"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec18"/>Configuring Meteor</h3></div></div></div><p>Setup is almost <a id="id459" class="indexterm"/>done! Meteor generally gets along with other frameworks, but because Polymer has some pre-rendering DOM manipulations (which are really cool, but mess with Meteor's mojo…) we have to be able to inject an attribute into the <code class="literal">&lt;body&gt;</code> tag, and we also need to ensure that the base <code class="literal">polymer</code> and <code class="literal">webcomponents</code> files are referenced properly.</p><p>In an editor, open the <code class="literal">[project root]/server/server.js</code> file, and add the following HTML injection code:</p><div class="informalexample"><pre class="programlisting">Meteor.startup(function(){
  Inject.rawModHtml('addUnresolved',function(html){
    return html = html.replace('&lt;body&gt;', '&lt;body unresolved&gt;');
  })
});</pre></div><p>Now we will take care of the baseline file references. Open <code class="literal">[project root]/client/templates/init/head.html</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;head&gt;
  &lt;script src="/components/webcomponentsjs/webcomponents.js"&gt;&lt;/script&gt;
  &lt;title&gt;github authors&lt;/title&gt;
&lt;/head&gt;</pre></div><p>One last step (this is for <code class="literal">vulcanize</code> to be able to consolidate all the component references), open <code class="literal">[project root]/client/imports.html</code> and add the following lines:</p><div class="informalexample"><pre class="programlisting">&lt;!-- Components --&gt;
&lt;link rel="import" href="/components/polymer/polymer.html"&gt;

&lt;!-- Styles --&gt;
&lt;link rel="import" href="/components/font-roboto/roboto.html"&gt;</pre></div><p>Setup is <a id="id460" class="indexterm"/>complete! Let's start Meteor (run the <code class="literal">meteor</code> command in the terminal), open a browser to <code class="literal">http://localhost:3000</code>, and start using Polymer components!</p></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec239"/>How to do it…</h2></div></div></div><p>Two caveats to what <a id="id461" class="indexterm"/>we're about to do: first, currently <a id="id462" class="indexterm"/>Polymer plays best with the Chrome browser. The samples below will work in other browsers, but there are some idiosyncrasies, such as <code class="literal">click</code> or <code class="literal">keypress</code> events, that may cause a little bit of frustration. Second, due to timing issues, as you're making changes to your code, there may be some instances where you will need to manually refresh your browser (which is a very rare thing when using Meteor!).</p><p>Keep in mind that Polymer is nowhere near being a <code class="literal">1.0</code> product — you are on the cutting edge with this recipe — so you'll have to bear with us, as we go through the fundamentals of using Polymer inside Meteor. Optimizing the timing and events and other behaviors across all other browsers would be a book in itself, so let's focus on the foundational part, and as Meteor and Polymer progress, these issues will work themselves out.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will first add our CSS styling. Polymer does the heavy lifting here, so let's get what little CSS we have to contribute out of the way. Open <code class="literal">[project root]/client/styles.css</code> and add the following CSS declarations:<div class="informalexample"><pre class="programlisting">html,body {
  height: 100%;
  margin: 0;
  font-family: 'RobotoDraft', sans-serif;
}
.container {
  width: 80%;
  margin: 50px auto;
}
div.sText {
  display:inline-block;
  width: 20rem;
}
div.sBtn {
  display: inline-block;
  width: 5rem;
  vertical-align: text-top;
}
paper-button.colored {
  color: white);
}
paper-button[raised].colored {
  background: rgb(66, 133, 244);
  color: white;
}</pre></div></li><li class="listitem">Let's take a look at the <code class="literal">polymer-github-card</code> component, using a static representation, just to see what we're playing around with. Open <code class="literal">[project root]/client/imports.html</code>, and add the following line just below the <code class="literal">"…polymer.html"</code> entry in the <code class="literal">C</code><code class="literal">omponents</code> section:<div class="informalexample"><pre class="programlisting">&lt;link rel="import" 
href="/components/polymer-github-card/dist/polymer-github-card.html"&gt;</pre></div><p>Now open <a id="id463" class="indexterm"/>
<code class="literal">main.html</code>, found in the <a id="id464" class="indexterm"/>same folder, and add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;polymer-github-card user="meteor"&gt;&lt;/polymer-github-card&gt;
  &lt;/div&gt;
&lt;/body&gt;</pre></div><p>In your browser, after <code class="literal">vulcanize</code> recompiles your <code class="literal">&lt;header&gt;</code>, you should see something similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00397.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now that we have confirmed that Polymer is working correctly, let's put the <code class="literal">polymer-github-card</code> component into a Meteor template, and create the ability to add multiple cards, based on a Mongo collection. Open <code class="literal">[project root]/both/model.js</code> and add the following line:<div class="informalexample"><pre class="programlisting">Authors = new Mongo.Collection('authors');</pre></div></li><li class="listitem">Now let's create our template. You'll remember that we're using <code class="literal">voodoohop:masonrify</code> to control the layout, so we will need to wrap our template <a id="id465" class="indexterm"/>declarations inside the <code class="literal">{{#masonry…}}</code> <a id="id466" class="indexterm"/>blocks, as appropriate. Open <code class="literal">[project root]/client/templates/tmpl-authors.html</code> and add the following code:<div class="informalexample"><pre class="programlisting">&lt;template name="authors"&gt;
  {{#masonryContainer columnWidth=265 gutter=5 transitionDuration="0.2s" id="MasonryContainer" }}
    {{#each authors}}
      {{&gt; authorCard}}
    {{/each}}
  {{/masonryContainer}}
&lt;/template&gt;

&lt;template name="authorCard"&gt;
  {{#masonryElement "masonryContainer"}}
    &lt;div&gt;
      &lt;polymer-github-card user="{{userid}}"&gt;
      &lt;/polymer-github-card&gt;
    &lt;/div&gt;
  {{/masonryElement}}
&lt;/template&gt;</pre></div><p>Again, the majority of the previous code relates to layout. The actual call to dynamically populate <code class="literal">polymer-github-card</code> components is found in the <code class="literal">authorCard</code> template, and references <code class="literal">{{userid}}</code> in the <code class="literal">user</code> attribute. <code class="literal">userid</code> comes free, as it will be a property for each record in the <code class="literal">Authors</code> collection.</p></li><li class="listitem">Let's now create <a id="id467" class="indexterm"/>the <code class="literal">Template.helper</code> function for passing the <code class="literal">Authors</code> collection, via the <code class="literal">Collection.find()</code> function. Open <code class="literal">[project root]/client/templates/tmpl-authors.js</code> and add the following code:<div class="informalexample"><pre class="programlisting">Template.authors.helpers({
  authors: function(){
    return Authors.find().fetch();
  }
});</pre></div></li><li class="listitem">While we're at it, lets make deleting records very simple. In <code class="literal">tmpl-authors.js</code>, add <a id="id468" class="indexterm"/>the following event handler at the bottom:<div class="informalexample"><pre class="programlisting">Template.authors.events({
  'dblclick polymer-github-card': function(e){
    Authors.remove({_id:this._id});
  }
});</pre></div></li><li class="listitem">We now need to modify our main template to reference our new dynamic template. Open <code class="literal">main.html</code> and modify the contents to look like the following:<div class="informalexample"><pre class="programlisting">&lt;body&gt;
<span class="strong"><strong>  &lt;div class="container"&gt;</strong></span>
<span class="strong"><strong>    {{&gt; authors}}</strong></span>
<span class="strong"><strong>  &lt;/div&gt;</strong></span>
&lt;/body&gt;</pre></div></li><li class="listitem">Save all your changes, look in your browser (give <code class="literal">vulcanize</code> a second to do its thing), and you should see a completely blank page. Wow! That's only because our <code class="literal">Authors</code> collection is empty. Let's fix that. In your browser console, execute the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; Authors.insert({userid:'meteor'})</strong></span>
<span class="strong"><strong>&gt; Authors.insert({userid:'glasser'})</strong></span>
</pre></div><p>As you enter each command, a new card will pop into place, with the Meteor logo, and David Glasser's smiling happy childhood picture, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00398.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>The <a id="id469" class="indexterm"/>command line is so 1960's! Let's <a id="id470" class="indexterm"/>update our page to use some paper-elements components, and give us an easy way to add more GitHub authors.</p></li><li class="listitem">Open <code class="literal">[project root]/imports.html</code> and add links for the components we will be using (which are found in our <code class="literal">public/components/</code> folder, by the way…) just below the <code class="literal">"…polymer.html"</code> declaration. When finished, your file should look like the following:<div class="informalexample"><pre class="programlisting">&lt;!-- Components --&gt;
&lt;link rel="import" href="/components/polymer/polymer.html"&gt;
<span class="strong"><strong>&lt;link rel="import" href="/components/paper-ripple/paper-ripple.html"&gt;</strong></span>
<span class="strong"><strong>&lt;link rel="import" href="/components/paper-shadow/paper-shadow.html"&gt;</strong></span>
<span class="strong"><strong>&lt;link rel="import" href="/components/paper-input/paper-input.html"&gt;</strong></span>
<span class="strong"><strong>&lt;link rel="import" href="/components/paper-button/paper-button.html"&gt;</strong></span>
&lt;link rel="import" href="/components/polymer-github-card/dist/polymer-github- card.html"&gt;


&lt;!-- Styles --&gt;
&lt;link rel="import" href="/components/font-roboto/roboto.html"&gt;</pre></div><p>Let's create our <code class="literal">search</code> template, which will contain a <code class="literal">paper-input</code> component, and a <code class="literal">paper-button</code> component. Open <code class="literal">[project root]/client/templates/tmpl-search.html</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">&lt;template name="search"&gt;
  &lt;div class="sText"&gt;
    &lt;paper-input-decorator id="searchText"
      floatingLabel
      label="find an author"&gt;
      &lt;input is="core-input" id="sInput"&gt;
    &lt;/paper-input-decorator&gt;
  &lt;/div&gt;
  &lt;div class="sBtn"&gt;
    &lt;paper-button raised class="colored" role="button" tabindex="0"&gt;
      search
      &lt;/paper-button&gt;
  &lt;/div&gt;
&lt;/template&gt;</pre></div><p>There's nothing special about the preceding code, Meteor-wise. It's all just straight <a id="id471" class="indexterm"/>up Polymer formatting and configuration.</p><div class="note" title="Note"><h3 class="title"><a id="tip38"/>Tip</h3><p>To learn more about <a id="id472" class="indexterm"/>Polymer components, please visit:</p><p><a class="ulink" href="https://www.polymer-project.org/docs/polymer/polymer.html">https://www.polymer-project.org/docs/polymer/polymer.html</a>.</p></div></li><li class="listitem">We will want to add a new card whenever we perform a search, that is, whenever we hit <span class="emphasis"><em>Enter</em></span> inside our <code class="literal">paper-input</code> component, or click on our <code class="literal">paper-button</code> <a id="id473" class="indexterm"/>component. Open <code class="literal">tmpl-search.js</code>, found in the same <code class="literal">client/templates/</code> folder, and add the <a id="id474" class="indexterm"/>following code:<div class="informalexample"><pre class="programlisting">Template.search.events({
  'keypress #sInput' : function(e){
    if (e.keyCode!=13) return;
    addAuthor();
  },
  'click paper-button': function(e){
    addAuthor();
  }
});

function addAuthor(){
  var sInput = $('#sInput'),
      sVal = sInput.val();
  sInput.blur();
  if (!sVal || (Authors.findOne({userid:sVal}))) return;
  sInput.val('');
  Authors.insert({userid:sVal});
}</pre></div></li><li class="listitem">The very last step is to add a template inclusion for our <code class="literal">search</code> template to <code class="literal">main.html</code>. Open <code class="literal">[project root]/client/main.html</code> and add the following highlighted code:<div class="informalexample"><pre class="programlisting">&lt;body&gt;
<span class="strong"><strong>  &lt;div class="container"&gt;</strong></span>
<span class="strong"><strong>    {{&gt; search}}</strong></span>
<span class="strong"><strong>  &lt;/div&gt;</strong></span>
  &lt;div class="container"&gt;
    {{&gt; authors}}
  &lt;/div&gt;
&lt;/body&gt;</pre></div><p>All done! Check out your app in the browser, allowing for refresh/recompiling, and you should be able to add as many GitHub author cards as you would like. Add some authors (suggestions: <code class="literal">meteorhacks</code> , <code class="literal">arunoda</code> , <code class="literal">d3</code> , <code class="literal">mbostock</code> , <code class="literal">voodoohop</code> , <code class="literal">pazguille</code> , <code class="literal">polymer</code> , <code class="literal">addyosmani</code> ) and new cards will appear after each entry, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00399.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec240"/>How it works…</h2></div></div></div><p>Very rarely do we need to refer to the <span class="emphasis"><em>Getting ready</em></span> section to fully understand what's going on, but the context around where and how to place Polymer files is important, so let's start there. We directed Bower to put any and all Polymer files into a subfolder belonging to <code class="literal">[project root]/public/</code>. Meteor treats files in the <code class="literal">public</code> folder differently than other folders—it <a id="id475" class="indexterm"/>treats them as static, and will not process the <code class="literal">.js</code> or <code class="literal">.html</code> files found inside.</p><p>This is to our advantage, because there are currently some pretty nasty conflicts between the Polymer and Meteor <a id="id476" class="indexterm"/>renderers. Specifically, both use the <code class="literal">{{double-stache}}</code> notation and the <code class="literal">&lt;template&gt;</code> tag, and interpret them differently. To resolve these conflicts (Nobel peace prize incoming!...) we "fence off" each framework, allowing Polymer to link to anything in the <code class="literal">public</code> folder, and having Meteor ignore everything in the same place. It's almost like the <span class="strong"><strong>Meteor Development Group</strong></span> (<span class="strong"><strong>MDG</strong></span>) planned it that way! Of course they did, anticipating and encouraging the use of other opinionated frameworks. MDG truly does want Meteor to play well with others, and in this case, it allows us to use Polymer in our applications.</p><p>A couple of other adjustments had to be made, such as inserting link elements into our <code class="literal">&lt;head&gt;</code> block, and injecting the unresolved attribute into the <code class="literal">&lt;body&gt;</code> element, but these are small, one-time issues, and once they're complete, we are free to use Polymer components to our heart's content.</p><p>As for the use of the Polymer components themselves, we can either use them directly (as shown in step #2) with no involvement from Meteor, or we can incorporate them into our <code class="literal">{{#each…}}</code> template or other template inclusions. We then have access to the normal Meteor <code class="literal">Template.helpers</code> and <code class="literal">Template.events</code>, which gives us easy, declarative-style access to reactive data.</p><p>Specifically, if we look at the <code class="literal">tmpl-authors.html</code> file, we will see that we are using the <code class="literal">{{#each authors}}</code> and <code class="literal">{{userid}}</code> template helpers, to iterate and render <code class="literal">polymer-github-card</code> <a id="id477" class="indexterm"/>components on the fly:</p><div class="informalexample"><pre class="programlisting">&lt;template name="authors"&gt;
  ...
<span class="strong"><strong>  {{#each authors}}</strong></span>
    {{&gt; authorCard}}
<span class="strong"><strong>  {{/each}}</strong></span>
  ...
&lt;/template&gt;

&lt;template name="authorCard"&gt;
  ...
    &lt;polymer-github-card user="<span class="strong"><strong>{{userid}}</strong></span>"&gt;
    &lt;/polymer-github-card&gt;
  ...
&lt;/template&gt;</pre></div><p>In <code class="literal">tmpl-authors.js</code> and <code class="literal">tmpl-search.js</code>, we make use of <code class="literal">Template.events</code> to interpret <code class="literal">keypressed</code>, <code class="literal">click</code>, and <code class="literal">dblclick</code>, and are able to use the in-context (inline) data to modify <a id="id478" class="indexterm"/>records, such as when we delete a record, using the <code class="literal">Authors.remove({_id:this._id})</code> statement:</p><div class="informalexample"><pre class="programlisting">Template.authors.events({
  'dblclick polymer-github-card': function(e){
    Authors.remove({_id:<span class="strong"><strong>this._id</strong></span>});
  }
});</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec241"/>There's more…</h2></div></div></div><p>There are a very large number of interaction and compatibility/performance nuances between Polymer and Meteor, which are beyond the scope of this recipe (and this book). We recommend <a id="id479" class="indexterm"/>perusing Stack Overflow (<a class="ulink" href="http://stackoverflow.com/questions/tagged/meteor">http://stackoverflow.com/questions/tagged/meteor</a>), the Meteor forums (<a class="ulink" href="https://forums.meteor.com/">https://forums.meteor.com/</a>), or <a id="id480" class="indexterm"/>just lifting the hood and experimenting, to <a id="id481" class="indexterm"/>gain more experience in properly <a id="id482" class="indexterm"/>integrating Polymer and Meteor.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec242"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Adding Meteor packages</em></span> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <span class="emphasis"><em>Customizing with Packages</em></span></li><li class="listitem">The <span class="emphasis"><em>Creating custom components</em></span> recipe in <a class="link" title="Chapter 3. Building Great User Interfaces" href="part0036.xhtml#aid-12AK81">Chapter 3</a>, <span class="emphasis"><em>Building Great User Interfaces</em></span></li><li class="listitem">The <span class="emphasis"><em>Implementing a simple collection</em></span> recipe in <a class="link" title="Chapter 4. Creating Models" href="part0046.xhtml#aid-1BRPS1">Chapter 4</a>, <span class="emphasis"><em>Creating Models</em></span></li></ul></div></div></div></body></html>