<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. User Authentication and Push Notification Using Ionic Cloud</h1></div></div></div><p>In this chapter, we will cover the following tasks related to authenticating users and registering and receiving push notification messages:</p><div><ul class="itemizedlist"><li class="listitem">Registering and authenticating users using Ionic Cloud</li><li class="listitem">Building an iOS app to receive push notifications</li><li class="listitem">Building an Android app to receive push notifications</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec36"/>Introduction</h1></div></div></div><p>Tracking and engaging users are key features necessary for your app to grow. That means you should be able to register and authenticate users. Once the users start using the app, you also need to segment the users so that you can customize their interactions. Then, you can send push notifications to encourage users to revisit the app.</p><p>There are three components that you need to use for your project, as follows:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Ionic Cloud</strong>: This is a <a id="id371" class="indexterm"/>cloud service that helps save user information and coordinate push notifications between you, Apple, or Google and the end users' devices.</li><li class="listitem"><strong>Ionic Cloud Angular module</strong>: This is just an Angular module to import to your local project. It provides<a id="id372" class="indexterm"/> some simple utilities for your code to interface with Ionic Cloud. Otherwise, directly calling Ionic Cloud API would be very complex.</li><li class="listitem"><strong>Cordova Push Notification and InAppBrowser</strong>: Since your code is in JavaScript, you <a id="id373" class="indexterm"/>need to<a id="id374" class="indexterm"/> communicate with the device's native features, such as push notification.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec37"/>Registering and authenticating users using Ionic Cloud</h1></div></div></div><p>Ionic Cloud can provide <a id="id375" class="indexterm"/>all of the user management and authentication capabilities out of the box. The following providers are supported by Ionic <a id="id376" class="indexterm"/>Cloud:</p><div><ul class="itemizedlist"><li class="listitem">E-mail/password</li><li class="listitem">Custom authentication</li><li class="listitem">Facebook</li><li class="listitem">Google</li><li class="listitem">Twitter</li><li class="listitem">Instagram</li><li class="listitem">LinkedIn</li><li class="listitem">GitHub</li></ul></div><p>Depending on the app, you may not need to use all of these authentication methods. For example, it would make more<a id="id377" class="indexterm"/> sense to use a LinkedIn authentication for an app focusing on a working professional to narrow down the audiences who fit the<a id="id378" class="indexterm"/> user profile of the app. If you have your own authentication server where you maintain your own user database, you can still use the custom authentication of Ionic Cloud to create a custom token.</p><p>This chapter will try to simplify the authentication concept as much as possible. You will learn how to do the following things:</p><div><ul class="itemizedlist"><li class="listitem">Register a new user</li><li class="listitem">Log in and logging out a user</li><li class="listitem">Change user profile data using custom fields</li></ul></div><p>Observe the following screenshot of the app:</p><div><img src="img/image00269.jpeg" alt="Registering and authenticating users using Ionic Cloud"/></div><p style="clear:both; height: 1em;"> </p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec85"/>Getting ready</h2></div></div></div><p>You can run this app <a id="id379" class="indexterm"/>via a browser. There is no need to test <a id="id380" class="indexterm"/>user authentication using a physical device.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec86"/>How to do it...</h2></div></div></div><p>Observe the<a id="id381" class="indexterm"/> following instructions:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new <code class="literal">MySimpleAuth</code> app using the <code class="literal">blank</code> template, as shown, and go to the <code class="literal">MySimpleAuth</code> folder:<div><pre class="programlisting">
<strong>$ ionic start MySimpleAuth blank --v2</strong>
<strong>$ cd MySimpleAuth</strong>
</pre></div></li><li class="listitem">Install Ionic Cloud Angular using the following command:<div><pre class="programlisting">
<strong>$ npm install @ionic/cloud-angular --save</strong>
</pre></div></li><li class="listitem">Initialize your Ionic Cloud <a id="id382" class="indexterm"/>setting so that an app ID can be created in your account, as follows:<div><pre class="programlisting">
<strong>$ ionic io init</strong>
</pre></div><div><h3 class="title"><a id="note10"/>Note</h3><p>You will be prompted to log in to your Ionic Cloud account for this command line. The initialization process will save the <code class="literal">app_id</code> and <code class="literal">api_key</code> values to your project's <code class="literal">ionic.io.bundle.min.js</code>. This means you cannot change the project in your Ionic Cloud account after this (or you will have to manually remove the IDs and reinitialize). Your app ID is also recorded in the <code class="literal">ionic.config.json</code> file.</p></div></li><li class="listitem">Log in to<a id="id383" class="indexterm"/> your Ionic Cloud at <a class="ulink" href="https://apps.ionic.io">https://apps.ionic.io</a>.</li><li class="listitem">Identify the new <a id="id384" class="indexterm"/>app that you initialized and copy the app ID (that is, <code class="literal">7588ce26</code>), as <a id="id385" class="indexterm"/>shown in the following <a id="id386" class="indexterm"/>screenshot:<div><img src="img/image00270.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open<a id="id387" class="indexterm"/> and edit <code class="literal">./src/app/app.module.ts</code> with the following code:<div><pre class="programlisting">import { NgModule } from '@angular/core';
import { IonicApp, IonicModule } from 'ionic-angular';
import { CloudSettings, CloudModule } from '@ionic/cloud-angular';
import { MyApp } from './app.component';
import { HomePage } from '../pages/home/home';

const cloudSettings: CloudSettings = {
  'core': {
    'app_id': '288db316'
  }
};

@NgModule({
  declarations: [
    MyApp,
    HomePage
  ],
  imports: [
    IonicModule.forRoot(MyApp),
    CloudModule.forRoot(cloudSettings)
  ],
  bootstrap: [IonicApp],
  entryComponents: [
    MyApp,
    HomePage
  ],
  providers: []
})
export class AppModule {} </pre></div><div><h3 class="title"><a id="note11"/>Note</h3><p>You need to <a id="id388" class="indexterm"/>ensure that the <code class="literal">app_id</code> has the correct value in <a id="id389" class="indexterm"/>your case.</p></div></li><li class="listitem">Edit and<a id="id390" class="indexterm"/> replace ./src/pages/home/home.html with<a id="id391" class="indexterm"/> the following code:<div><pre class="programlisting">&lt;ion-header&gt;
  &lt;ion-navbar&gt;
    &lt;ion-title&gt;
      User Authentication
    &lt;/ion-title&gt;
  &lt;/ion-navbar&gt;
&lt;/ion-header&gt;

&lt;ion-content padding&gt;

  &lt;div *ngIf="!auth.isAuthenticated()"&gt;

    &lt;h4&gt;
      Register or Login
    &lt;/h4&gt;

    &lt;ion-list&gt;

      &lt;ion-item&gt;
        &lt;ion-label fixed&gt;Email&lt;/ion-label&gt;
        &lt;ion-input type="text" [(ngModel)]="email"&gt;&lt;/ion-input&gt;
      &lt;/ion-item&gt;

      &lt;ion-item&gt;
        &lt;ion-label fixed&gt;Password&lt;/ion-label&gt;
        &lt;ion-input type="password" [(ngModel)]="password"&gt;&lt;/ion-input&gt;
      &lt;/ion-item&gt;

    &lt;/ion-list&gt;

    &lt;ion-grid&gt;
      &lt;ion-row&gt;
        &lt;ion-col width-50&gt;
          &lt;button ion-button block (click)="register()"&gt;Register&lt;/button&gt;
        &lt;/ion-col&gt;
        &lt;ion-col width-50&gt;
          &lt;button ion-button block (click)="login()"&gt;Login&lt;/button&gt;
        &lt;/ion-col&gt;
      &lt;/ion-row&gt;
    &lt;/ion-grid&gt;

  &lt;/div&gt;

  &lt;div *ngIf="auth.isAuthenticated()"&gt;

    &lt;h4&gt;
      User Profile
    &lt;/h4&gt;

    &lt;ion-list *ngIf="auth.isAuthenticated()"&gt;

      &lt;ion-item&gt;
        &lt;ion-label fixed&gt;Name&lt;/ion-label&gt;
        &lt;ion-input class="right" type="text" [(ngModel)]="name"&gt;&lt;/ion-input&gt;
      &lt;/ion-item&gt;

      &lt;ion-item&gt;
        &lt;ion-label&gt;Birthday&lt;/ion-label&gt;
        &lt;ion-datetime displayFormat="MM/DD/YYYY" [(ngModel)]="birthday"&gt;&lt;/ion-datetime&gt;
      &lt;/ion-item&gt;

    &lt;/ion-list&gt;

    &lt;ion-grid&gt;
      &lt;ion-row&gt;
        &lt;ion-col width-50&gt;
          &lt;button ion-button color="secondary" block (click)="save()"&gt;Save&lt;/button&gt;
        &lt;/ion-col&gt;
        &lt;ion-col width-50&gt;
          &lt;button ion-button color="dark" block (click)="logout()"&gt;Logout&lt;/button&gt;
        &lt;/ion-col&gt;
      &lt;/ion-row&gt;
    &lt;/ion-grid&gt;

  &lt;/div&gt;

&lt;/ion-content&gt;</pre></div><div><h3 class="title"><a id="note12"/>Note</h3><p>These <a id="id392" class="indexterm"/>are just your basic <code class="literal">login</code> and <code class="literal">logout</code> templates. It's all in<a id="id393" class="indexterm"/> a single page to keep<a id="id394" class="indexterm"/> things simple.</p></div></li><li class="listitem">Open and<a id="id395" class="indexterm"/> edit <code class="literal">./src/pages/home/home.ts</code> with the following code:<div><pre class="programlisting">import { Component } from '@angular/core';
import { NavController, LoadingController, ToastController } from 'ionic-angular';
import { Auth, User, UserDetails, IDetailedError } from '@ionic/cloud-angular';

@Component({
  templateUrl: 'home.html'
})
export class HomePage {
  public email: string = "";
  public password: string = "";
  public name: string = "";
  public birthday: string = "";

  constructor(public navCtrl: NavController, public auth: Auth, public user: User, public loadingCtrl: LoadingController, public toastCtrl: ToastController) {
    this.initProfile();
  }

  private initProfile() {
    if (this.auth.isAuthenticated()) {
      this.name = this.user.get('name', '');
      this.birthday = this.user.get('birthday', '');
    }
  }

  register() {
    let details: UserDetails = {'email': this.email, 'password': this.password};

    let loader = this.loadingCtrl.create({
      content: "Registering user..."
    });
    loader.present();    

    this.auth.signup(details).then(() =&gt; {
      console.log('User is now registered');
      console.log(this.user);
      loader.dismiss();
      return this.auth.login('basic', {'email': this.email, 'password': this.password});

    }, (err: IDetailedError&lt;string[]&gt;) =&gt; {
      loader.dismiss();
      
      for (let e of err.details) {
        if (e === 'conflict_email') {
          alert('Email already exists.');
        } else {
          alert('Error creating user.');
        }
      }
    });
  }

  login() {
    let details: UserDetails = {'email': this.email, 'password': this.password};

    let loader = this.loadingCtrl.create({
      content: "Logging in user..."
    });
    loader.present();    

    this.auth.login('basic', details).then((data) =&gt; {
      console.log('Finished login');
      this.initProfile();

      loader.dismiss();

      console.log(data);
      console.log(this.user);
    }, (err) =&gt; {
      loader.dismiss();
      alert('Login Error');
    } );    
  }

  save() {
    let toast = this.toastCtrl.create({
      message: 'User profile was saved successfully',
      position: 'bottom',
      duration: 3000
    });
    toast.present();

    this.user.set('name', this.name);
    this.user.set('birthday', this.birthday);
    this.user.save();
  }

  logout() {
    this.auth.logout();
    this.email = '';
    this.password = '';
    this.name = '';
    this.birthday = '';
  }

}</pre></div><div><h3 class="title"><a id="note13"/>Note</h3><p>The<a id="id396" class="indexterm"/> preceding code provides four <a id="id397" class="indexterm"/>methods to register, save data, log in, and log out a user.</p></div></li><li class="listitem">Finally, add a <a id="id398" class="indexterm"/>minor <code class="literal">input</code> field <a id="id399" class="indexterm"/>alignment in <code class="literal">./src/pages/home/home.scss</code>, as follows:<div><pre class="programlisting">.home-page {
  ion-input.right &gt; input {
    text-align: right;
  }
}</pre></div></li><li class="listitem">Go to your Terminal and run the app:<div><pre class="programlisting">
<strong>$ ionic serve</strong>
</pre></div></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec87"/>How it works...</h2></div></div></div><p>In a nutshell, Ionic Cloud acts as a backend server for your app. It allows you to create a new user record in<a id="id400" class="indexterm"/> its database. Through the <code class="literal">user</code> class, you can<a id="id401" class="indexterm"/> interact with the Ionic Cloud authentication <a id="id402" class="indexterm"/>system. The first step is to register the user. This<a id="id403" class="indexterm"/> takes an <strong>Email</strong> and <strong>Password</strong> as shown in the following screenshot:</p><div><img src="img/image00271.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>When you click on <strong>Register</strong>, the following code will be executed:</p><div><pre class="programlisting">this.auth.signup(details).then(() =&gt; {
  console.log('User is now registered');
  console.log(this.user);
  loader.dismiss();
  return this.auth.login('basic', {'email': this.email, 'password': this.password});
}</pre></div><p>The <code class="literal">details</code> object has the e-mail and password from the form. Once it has successfully completed, it will automatically log in the user via <code class="literal">this.auth.login</code>.</p><p>Note that this piece of code here is just to show the loading screen to prevent the user from clicking on the Register button multiple times:</p><div><pre class="programlisting">let loader = this.loadingCtrl.create({
  content: "Registering user..."
});
loader.present();  </pre></div><p>This example app only has <strong>Name</strong> and <strong>Birthday</strong> as custom user data, as illustrated in the following screenshot:</p><div><img src="img/image00272.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>To save<a id="id404" class="indexterm"/> the <strong>User Profile</strong>, you call the <code class="literal">save()</code> method <a id="id405" class="indexterm"/>as shown in the following code:</p><div><pre class="programlisting">save() {
  let toast = this.toastCtrl.create({
    message: 'User profile was saved successfully',
    position: 'bottom',
    duration: 3000
  });
  toast.present();

  this.user.set('name', this.name);
  this.user.set('birthday', this.birthday);
  this.user.save();
}</pre></div><p>If you look into<a id="id406" class="indexterm"/> the console log, the user token and custom data are also<a id="id407" class="indexterm"/> available, as shown in the following screenshot:</p><div><img src="img/image00273.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>You can also view the <strong>UserData</strong> in the<a id="id408" class="indexterm"/> Ionic Cloud portal. Log in to your account and navigate to your app's <strong>Auth</strong> menu.</p><p>Click on the <strong>VIEW</strong> button<a id="id409" class="indexterm"/> of the user you created, as shown<a id="id410" class="indexterm"/> in the following screenshot:</p><div><img src="img/image00274.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>Select the <strong>CUSTOM DATA</strong> tab and you can see the same information stored for the user, as illustrated in the<a id="id411" class="indexterm"/> following screenshot:</p><div><img src="img/image00275.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>For more<a id="id412" class="indexterm"/> information about user authentication, you may <a id="id413" class="indexterm"/>want to refer the official Ionic documentation at <a class="ulink" href="http://docs.ionic.io/services/users/">http://docs.ionic.io/services/users/</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec38"/>Building an iOS app to receive push notifications</h1></div></div></div><p>Push notification is an<a id="id414" class="indexterm"/> important feature to engage users frequently, especially when the users are not using the app. Many people download an app but only open it a few times. If you send them a push notification message, it will <a id="id415" class="indexterm"/>encourage them to open the app to get involved in a new activity. Implementing push notifications is very complex if you have to build everything from scratch. However, Ionic makes it very simple by leveraging the Cordova Push Notification plugin and Ionic Cloud as the providers. A push <a id="id416" class="indexterm"/>notification provider is a server that can communicate with the <strong>Apple Push Notification service</strong> (<strong>APNs</strong>) or Google's <strong>Firebase Cloud Messaging</strong> (<strong>FCM</strong>). You can set up your own provider server using existing<a id="id417" class="indexterm"/> open sources, but you have to maintain this server separately and keep up with potential changes from the APN APIs.</p><p>In this section, you will learn how to do the following things:</p><div><ul class="itemizedlist"><li class="listitem">Set up Ionic Cloud for iOS Push Notification</li><li class="listitem">Configure iOS app, certificates (App and Push), and provisioning profile</li><li class="listitem">Write code to receive push notifications</li></ul></div><p>The following is a screenshot of the app after receiving a couple of notification messages:</p><div><img src="img/image00276.jpeg" alt="Building an iOS app to receive push notifications"/></div><p style="clear:both; height: 1em;"> </p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec88"/>Getting ready</h2></div></div></div><p>It's required to <a id="id418" class="indexterm"/>have a physical iOS device available in order to test for notification messages.</p><p>You must also register for the <strong>Apple Developer Program</strong> (<strong>ADP</strong>) in order to access <a class="ulink" href="https://developer.apple.com">https://developer.apple.com</a> and <a class="ulink" href="https://itunesconnect.apple.com">https://itunesconnect.apple.com</a> because these websites will require<a id="id419" class="indexterm"/> an approved <a id="id420" class="indexterm"/>account.</p><p>In addition, the following instructions use the specific version of these components:</p><div><ul class="itemizedlist"><li class="listitem">Mac OSX El Capitan 10.11.4</li><li class="listitem">Xcode 7.3.1</li><li class="listitem">Ionic CLI 2.1.8</li><li class="listitem">Cordova 6.4.0</li><li class="listitem">Node 6.8.1</li><li class="listitem">NPM 3.10.8</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec89"/>How to do it...</h2></div></div></div><p>Observe the following instructions:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new <code class="literal">MyiOSPush</code> app using the <code class="literal">blank</code> template, as shown, and go to the <code class="literal">MyiOSPush</code> folder:<div><pre class="programlisting">
<strong>$ ionic start MyiOSPush blank --v2</strong>
<strong>$ cd MyiOSPush</strong>
</pre></div></li><li class="listitem">Install the Ionic <code class="literal">cloud-angular</code> client, which is a library to interact with the <code class="literal">push</code> object, as<a id="id421" class="indexterm"/> follows:<div><pre class="programlisting">
<strong>$ npm install @ionic/cloud-angular --save</strong>
</pre></div><div><h3 class="title"><a id="note14"/>Note</h3><p>You need to have Node version 4.x or later and NPM version 3.x or later.</p></div></li><li class="listitem">Initialize your Ionic Cloud setting, as illustrated, so that an app ID can be created in your account:<div><pre class="programlisting">
<strong>$ ionic io init</strong>
</pre></div><div><h3 class="title"><a id="note15"/>Note</h3><p>You will be prompted<a id="id422" class="indexterm"/> to log in to your Ionic Cloud account for this command line. The initialization process will save the <code class="literal">app_id</code> and <code class="literal">api_key</code> values to your project's <code class="literal">ionic.io.bundle.min.js</code>. This means you cannot change the project in your Ionic Cloud account after this (or you will have to manually remove the IDs and reinitialize). Your app ID is also recorded in the <code class="literal">ionic.config.json</code> file.</p></div></li><li class="listitem">You need to install the Cordova Push Notification plugin and provide some value as <code class="literal">SENDER_ID</code>. Since you are only using iOS Push Notification, you can just provide a fake value, temporarily, here, as shown in the following code:<div><pre class="programlisting">
<strong>$ cordova plugin add phonegap-plugin-push --variable SENDER_ID=12341234 --save</strong>
</pre></div></li><li class="listitem">Open your <code class="literal">./ionic.config.json</code> file in the project folder and copy the <code class="literal">app_id</code> value. In this case, the value is <code class="literal">00f293c4</code> from the following code:<div><pre class="programlisting">{
  "name": "MyiOSPush",
  "app_id": "00f293c4",
  "v2": true,
  "typescript": true
}</pre></div></li><li class="listitem">Open and edit <code class="literal">./src/app/app.module.ts</code> with the following content:<div><pre class="programlisting">import { NgModule } from '@angular/core';
import { IonicApp, IonicModule } from 'ionic-angular';
import { CloudSettings, CloudModule } from '@ionic/cloud-angular';
import { MyApp } from './app.component';	
import { HomePage } from '../pages/home/home';

const cloudSettings: CloudSettings = {
  'core': {
    'app_id': '00f293c4'
  },
  'push': {
    'sender_id': 'SENDER_ID',
    'pluginConfig': {
      'ios': {
        'badge': true,
        'sound': true
      },
      'android': {
        'iconColor': '#343434'
      }
    }
  }
};

@NgModule({
  declarations: [
    MyApp,
    HomePage
  ],
  imports: [
    IonicModule.forRoot(MyApp),
    CloudModule.forRoot(cloudSettings)
  ],
  bootstrap: [IonicApp],
  entryComponents: [
    MyApp,
    HomePage
  ],
  providers: []
})
export class AppModule {}</pre></div><div><h3 class="title"><a id="note16"/>Note</h3><p>You must<a id="id423" class="indexterm"/> replace <code class="literal">'app_id': '00f293c4'</code> with your <a id="id424" class="indexterm"/>own app ID.</p></div></li><li class="listitem"><a id="id425" class="indexterm"/>Visit the Apple Developer website at <a class="ulink" href="https://developer.apple.com">https://developer.apple.com</a> and log in with your credentials.</li><li class="listitem">Click on <strong>Certificates, Identifiers &amp; Profiles</strong>, as illustrated in the following screenshot:<div><img src="img/image00277.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the correct<a id="id426" class="indexterm"/> device platform you are<a id="id427" class="indexterm"/> targeting. In this case, it will be <strong>iOS, tvOS, watchOS</strong> as shown in the following screenshot:<div><img src="img/image00278.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to <strong>Identifiers</strong> &gt; <strong>App IDs</strong> to create an app ID, as illustrated in the following screenshot:<div><img src="img/image00279.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id428" class="indexterm"/> the plus(<strong>+</strong>) button in the top right corner of the screen, as shown in the following screenshot:<div><img src="img/image00280.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Fill in the form to<a id="id429" class="indexterm"/> register your <strong>App ID</strong>. The <strong>Name</strong> field could be anything and it's not the same Ionic Cloud's app ID. You can provide the name of your project (that is, <code class="literal">MyiOSPush</code>) to keep things simple, as shown:<div><img src="img/image00281.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">The<a id="id430" class="indexterm"/> important part that you need to do correctly<a id="id431" class="indexterm"/> here is the <strong>Bundle ID</strong> because it must match your bundle identifier in the <code class="literal">./config.xml</code> file or Xcode, as illustrated:<div><img src="img/image00282.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">To enable <a id="id432" class="indexterm"/>push notifications, you<a id="id433" class="indexterm"/> need to check the <strong>Push Notification</strong> service on the following page:<div><img src="img/image00283.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <a id="id434" class="indexterm"/><strong>Register</strong>, as <a id="id435" class="indexterm"/>shown:<div><img src="img/image00284.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>Done</strong> to complete the step to create <strong>App ID</strong>, as follows:<div><img src="img/image00285.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">To start with certificate creation, you will need to generate a certificate signing<a id="id436" class="indexterm"/> request file locally on your Mac<a id="id437" class="indexterm"/> OSX using <strong>Keychain Access</strong>. Navigate to the <strong>Keychain Access</strong> top left menu and navigate to <strong>Certificate Assistant</strong> &gt; <strong>Request a Certificate From a Certificate Authority…</strong>, as illustrated:<div><img src="img/image00286.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter your <strong>User Email Address</strong> and <strong>Common Name</strong>. Leave the <strong>CA Email Address</strong> field blank and check <strong>Saved to disk</strong>, as shown:<div><img src="img/image00287.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Save <a id="id438" class="indexterm"/>your <code class="literal">CertificateSigningRequest.certSigningRequest</code> file, as follows:<div><img src="img/image00288.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to<a id="id439" class="indexterm"/> the Apple Developer website and navigate to <strong>Certificates</strong> &gt; <strong>All</strong>, as shown:<div><img src="img/image00289.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <a id="id440" class="indexterm"/>plus button in the top right corner to start creating a certificate, as follows:<div><img src="img/image00290.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You just have to<a id="id441" class="indexterm"/> go through the steps on the website to fill out the necessary information. In this example, you will select the <strong>Development</strong> version instead of <strong>Production</strong>, as illustrated:<div><img src="img/image00291.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id442" class="indexterm"/> the <strong>Continue</strong> button, as<a id="id443" class="indexterm"/> follows, to proceed:<div><img src="img/image00292.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id444" class="indexterm"/> the <strong>Choose File…</strong> button, as shown in the following screenshot, to upload your<a id="id445" class="indexterm"/> signing request file that you saved earlier:<div><img src="img/image00293.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <a id="id446" class="indexterm"/><strong>Continue</strong> button, as illustrated, to proceed:<div><img src="img/image00294.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the<a id="id447" class="indexterm"/> <strong>Download</strong> button to download your iOS Development certificate file:<div><img src="img/image00295.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <code class="literal">.cer</code> file you downloaded, as shown, so that it can be imported to <strong>Keychain Access</strong>:<div><img src="img/image00296.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Locate your certificate in <strong>Keychain Access</strong> because you need to export this to the <code class="literal">.p12</code> file format. Ionic Cloud will need this file later in order to generate a push token and send push notifications to the app. Observe the following screenshot:<div><img src="img/image00297.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Right click and select <strong>Export</strong> from the drop-down menu:<div><img src="img/image00298.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Save <a id="id448" class="indexterm"/>your <code class="literal">Certificates.p12</code> file, as illustrated, so that you<a id="id449" class="indexterm"/> can import it to Ionic Cloud later:<div><img src="img/image00299.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">As illustrated in the following screenshot, provide a password to protect this file:<div><img src="img/image00300.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note17"/>Note</h3><p>You must provide a password in this step although it's optional in <strong>Keychain Access</strong>. The reason is that Ionic Cloud cannot import a <code class="literal">.p12</code> file without a <a id="id450" class="indexterm"/>password.</p></div></li><li class="listitem">If you need to <a id="id451" class="indexterm"/>push the app to a specific device, you must register the device. Go to <strong>Devices</strong> &gt; <strong>All</strong>:<div><img src="img/image00301.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the plus button:<div><img src="img/image00302.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide<a id="id452" class="indexterm"/> the device <strong>UDID</strong> and save to register the device. Observe the following <a id="id453" class="indexterm"/>screenshot:<div><img src="img/image00303.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You'll need a provisioning profile. Navigate to <strong>Provisioning Profiles</strong> &gt; <strong>All</strong>:<div><img src="img/image00304.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the plus button:<div><img src="img/image00305.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>iOS App Development</strong> as your provisioning profile since this example is for the development version only:<div><img src="img/image00306.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id454" class="indexterm"/> the <strong>Continue</strong> button:<div><img src="img/image00307.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the <a id="id455" class="indexterm"/>correct <strong>App ID</strong> in the drop-down menu and save to finalize your provisioning profile creation:<div><img src="img/image00308.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id456" class="indexterm"/> the <strong>Continue</strong> button:<div><img src="img/image00309.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the<a id="id457" class="indexterm"/> iOS Development certificate you created earlier, as shown in the following screenshot:<div><img src="img/image00310.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">As illustrated, select at<a id="id458" class="indexterm"/> least one device<a id="id459" class="indexterm"/> that you want to be able to install the app for testing:<div><img src="img/image00311.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a <strong>Profile Name</strong> to your provisioning profile, as shown:<div><img src="img/image00312.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the<a id="id460" class="indexterm"/> <strong>Download</strong> button to download the <a id="id461" class="indexterm"/>provisioning profile file (that is, <code class="literal">MyiOSPush_Provisioning_Profile.mobileprovision</code>):<div><img src="img/image00313.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on <code class="literal">MyiOSPush_Provisioning_Profile.mobileprovision</code>, which you just <a id="id462" class="indexterm"/>downloaded, in order to import it into Xcode:<div><img src="img/image00314.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note18"/>Note</h3><p>This step is<a id="id463" class="indexterm"/> very important because if you don't import it into Xcode, your app cannot be built successfully. If your app failed to build because of an invalid provisioning profile, it's best to check the provisioning profile status in the Developer console.</p></div></li><li class="listitem">To enable the <strong>Push Notification</strong> feature, you must request a <strong>Push Certificate</strong>, which is different from the app certificate. Select the <strong>App ID</strong> that you<a id="id464" class="indexterm"/> created earlier (that is, <code class="literal">MyiOSPush</code>):<div><img src="img/image00315.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Edit</strong> button at the bottom of the page:<div><img src="img/image00316.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note19"/>Note</h3><p>The <strong>Push Notifications</strong> must show the <strong>Configurable</strong> state. Otherwise, your app is not <a id="id465" class="indexterm"/>available for <strong>Push Notifications</strong>.</p></div></li><li class="listitem">Click on the <strong>Create Certificates...</strong> button under the <strong>Push Notifications</strong> &gt; <strong>Development SSL Certificate</strong> section:<div><img src="img/image00317.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You will be<a id="id466" class="indexterm"/> taken to a new page to create your <a id="id467" class="indexterm"/>CSR file. Click on the <strong>Continue</strong> button:<div><img src="img/image00318.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id468" class="indexterm"/> the <strong>Choose File...</strong> button:<div><img src="img/image00319.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Locate the <code class="literal">CertificateSigningRequest.certSigningRequest</code> file that you created <a id="id469" class="indexterm"/>earlier:<div><img src="img/image00320.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note20"/>Note</h3><p>You must <a id="id470" class="indexterm"/>upload the same, <code class="literal">.certSigningRequest</code> file as you did for the app certificate. Otherwise, your app will not receive push notifications and it's very hard to debug.</p></div></li><li class="listitem">Click on the <strong>Continue</strong> button:<div><img src="img/image00321.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the<a id="id471" class="indexterm"/> <strong>Download</strong> button to download the certificate file. You can name it <code class="literal">aps_certificate.cer</code> to avoid<a id="id472" class="indexterm"/> overwriting to the earlier <code class="literal">.cer</code> file:<div><img src="img/image00322.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Once your <code class="literal">.cer</code> file is downloaded, you need to click on it to import it to <strong>Keychain Access</strong>:<div><img src="img/image00323.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Locate the new push services certificate in <strong>Keychain Access</strong> and select it, as illustrated in<a id="id473" class="indexterm"/> the following screenshot:<div><img src="img/image00324.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Right click on<a id="id474" class="indexterm"/> the certificate and select <strong>Export</strong>:<div><img src="img/image00325.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Give it a new name to avoid overwriting it to the app certificate. This process is, basically, converting a <code class="literal">.cer</code> to <code class="literal">.p12</code> file for Ionic Cloud:<div><img src="img/image00326.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a<a id="id475" class="indexterm"/> password for this <code class="literal">.p12</code> file to protect it:<div><img src="img/image00327.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note21"/>Note</h3><p>Password for the <code class="literal">.p12</code> file is required because Ionic Cloud will not import a <code class="literal">.p12</code> file for APN without password.</p></div></li><li class="listitem">Once you have <a id="id476" class="indexterm"/>completed the setup on the Apple Developer website, you need to upload the provisioning profile and two certificates (app and push) to Ionic Cloud. Navigate to <a class="ulink" href="https://apps.ionic.io">https://apps.ionic.io</a> and log in with your credentials.</li><li class="listitem">Select the app generated for this project (that is, <code class="literal">MyiOSPush</code>):<div><img src="img/image00328.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate<a id="id477" class="indexterm"/> to <strong>Settings</strong> &gt; <strong>Certificates</strong>:<div><img src="img/image00329.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select<a id="id478" class="indexterm"/> <strong>New Security Profile</strong>:<div><img src="img/image00330.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide<a id="id479" class="indexterm"/> a <strong>Profile Name</strong> and click on the <strong>Create</strong> button to save the profile:<div><img src="img/image00331.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>EDIT</strong> <a id="id480" class="indexterm"/>next to the <code class="literal">MyPushProfile</code> that you just created to edit the settings:<div><img src="img/image00332.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You will need to upload three files: a provisioning profile, and app development certificate for the app itself, and an APN certificate for push notification. Let's start with the app requirements. Click on <strong>Choose File</strong> under <strong>Build Credentials</strong> and upload two files: <code class="literal">Certificates.p12</code> (from Step 30) and <code class="literal">MyiOSPush_Provisioning_Profile.mobileprovision</code> (from Step 44). Ensure<a id="id481" class="indexterm"/> that you provide the same password that you used to protect the <code class="literal">.p12</code> file earlier:<div><img src="img/image00333.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on <strong>Choose File</strong> under <strong>Push Notification Service</strong> and upload the <code class="literal">push_Certificates.p12</code> file (from Step 58). Ensure that you provide the same password that protects<a id="id482" class="indexterm"/> this file:<div><img src="img/image00334.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note22"/>Note</h3><p>You should not get confused between the two <code class="literal">.p12</code> files as one is for your app and one is for your push notification feature.</p></div></li><li class="listitem">Click on the <strong>Save</strong> button to save your security profile. This completes your Ionic Cloud setup for push notification.</li><li class="listitem">You need to<a id="id483" class="indexterm"/> modify your home page code in <a id="id484" class="indexterm"/>order to receive notification messages. Open and edit <code class="literal">./src/pages/home/home.html</code> and paste the given code:<div><pre class="programlisting">&lt;ion-header&gt;
  &lt;ion-navbar&gt;
    &lt;ion-title&gt;
      Push Notification
    &lt;/ion-title&gt;
  &lt;/ion-navbar&gt;
&lt;/ion-header&gt;

&lt;ion-content padding&gt;

  &lt;code class="center"&gt;{{ pushToken }}&lt;/code&gt;
  &lt;button ion-button block [disabled]="clicked" [hidden]="pushToken" (click)="registerPush()"&gt;
    &lt;span [hidden]="clicked"&gt;Register Push&lt;/span&gt;
    &lt;span [hidden]="!clicked"&gt;Registering...&lt;/span&gt;
  &lt;/button&gt;

  &lt;h2 class="big-square" *ngIf="!pushToken"&gt;
    You have no message
  &lt;/h2&gt;

  &lt;h3 class="sub-title" *ngIf="pushToken"&gt;
    Your messages
  &lt;/h3&gt;

  &lt;ion-card *ngFor="let msg of messages"&gt;
    &lt;ion-card-header&gt;
      {{ msg.title }}
    &lt;/ion-card-header&gt;
    &lt;ion-card-content&gt;
      {{ msg.text }}
    &lt;/ion-card-content&gt;
  &lt;/ion-card&gt;  
&lt;/ion-content&gt;</pre></div></li><li class="listitem">Replace the<a id="id485" class="indexterm"/> content of the <code class="literal">home.ts</code> file, in the<a id="id486" class="indexterm"/> same folder, with the following code:<div><pre class="programlisting">import { Component, ApplicationRef } from '@angular/core';
import { NavController } from 'ionic-angular';
import { Push, PushToken } from '@ionic/cloud-angular';

@Component({
  templateUrl: 'home.html'
})
export class HomePage {
  public push: any;
  public pushToken: string;
  public messages = [];
  public clicked: Boolean = false;
  constructor(public navCtrl: NavController, push: Push, private applicationRef: ApplicationRef) {
    this.push = push;
  }

  private processPush(msg, that) {
    console.log('Push notification message received');
    console.log(msg);
    this.messages.push({
      title: msg.title,
      text: msg.text
    })
    this.applicationRef.tick();
  }

  registerPush() {
    this.clicked = true;

    this.push.register().then((t: PushToken) =&gt; {
      return this.push.saveToken(t);
    }).then((t: PushToken) =&gt; {

      this.push.rx.notification().subscribe(msg =&gt; this.processPush(msg, this));

      console.log('Token saved:', t.token);
      this.pushToken = t.token;
    }, (err) =&gt; {
      alert('Token error');
      console.log(err);
    });

  }  
}</pre></div></li><li class="listitem">Replace <code class="literal">home.scss</code>, also<a id="id487" class="indexterm"/> in the <code class="literal">/home</code> folder, with<a id="id488" class="indexterm"/> the given code:<div><pre class="programlisting">.home-page {
  .center {
    text-align: center;
  }

  h2.big-square {
    text-align: center;
    padding: 50px;
    color: #D91E18;
    background: #F9BF3B;
  }

  h3.sub-title {
    text-align: center;
    padding: 10px;
    color: #446CB3;
    background: #E4F1FE;
  }

  ion-card ion-card-header {
    padding: 10px 16px;
    background: #F9690E;
    color: white;
  }

  ion-card ion-card-header + ion-card-content, ion-card .item + ion-card-content {
    padding-top: 16px;
  }
}</pre></div></li><li class="listitem">Connect your<a id="id489" class="indexterm"/> physical iPhone to the Mac via a USB connection.</li><li class="listitem">Ensure that <a id="id490" class="indexterm"/>you are in the app folder and build for the iOS platform, as follows:<div><pre class="programlisting">
<strong>$ ionic run ios --device</strong>
</pre></div><div><h3 class="title"><a id="note23"/>Note</h3><p>You may need to include the <code class="literal">--device</code> parameter at the end due to an existing bug with Ionic 2.</p></div></li><li class="listitem">The OS will prompt to allow codesign to sign using the iOS Developer certificate. You must accept this to allow access in order to build the app and upload it to your device:<div><img src="img/image00335.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Verify that the app has been running successfully on the device. The initial screen should look as illustrated:<div><img src="img/image00336.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>At this point, you have <a id="id491" class="indexterm"/>completed the push notification setup and coding. The next step is to verify that you<a id="id492" class="indexterm"/> receive notifications via the app. Here are the instructions:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>Register Push</strong> button in the mobile app to register for push notification to the Ionic Cloud provider server to acquire a token. Click on <strong>OK</strong> to accept permission to receive push notifications, as follows:<div><img src="img/image00337.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to <strong>Ionic Cloud</strong> &gt; your app (<strong>MyiOSPush</strong>) &gt; <strong>Push</strong>:<div><img src="img/image00338.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id493" class="indexterm"/> the <strong>CREATE YOUR FIRST PUSH</strong> button:<div><img src="img/image00339.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Fill in the <a id="id494" class="indexterm"/>push notification form to create your first push message:<div><img src="img/image00340.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Verify on<a id="id495" class="indexterm"/> the right screen to ensure tha<a id="id496" class="indexterm"/>t the push message is displayed as desired:<div><img src="img/image00341.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Leave<a id="id497" class="indexterm"/> the segment as <strong>All users</strong> so that anyone<a id="id498" class="indexterm"/> can get the push:<div><img src="img/image00342.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the security profile (that is, <code class="literal">mypushprofile</code>) that you created earlier. Then, click on the <strong>Send this Push</strong> button:<div><img src="img/image00343.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Verify that<a id="id499" class="indexterm"/> the push notification has been<a id="id500" class="indexterm"/> sent successfully from Ionic Cloud. It should have the <strong>Sent</strong> status, as shown:<div><img src="img/image00344.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the app on your mobile device, verify that the push message has appeared as illustrated:<div><img src="img/image00345.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>You have successfully <a id="id501" class="indexterm"/>completed the verification steps.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec90"/>How it works...</h2></div></div></div><p>To understand <a id="id502" class="indexterm"/>how the entire process works, let's summarize what you have done, as shown in the following section:</p><div><ul class="itemizedlist"><li class="listitem">Created an Ionic project and initialized it to create an Ionic Cloud project:<div><ul class="itemizedlist"><li class="listitem">Your Ionic project on the local computer must sync with the Ionic Cloud project for push notifications and other management, such as user authentication</li></ul></div></li><li class="listitem">Set up your Apple Developer account by doing the following things:<div><ul class="itemizedlist"><li class="listitem">Created an app ID</li><li class="listitem">Created app certificate (after creating a signing request locally via <strong>Keychain Access</strong>)</li><li class="listitem">Created a provisioning profile</li><li class="listitem">Created a push certificate</li></ul></div></li><li class="listitem">Set up your Ionic Cloud account:<div><ul class="itemizedlist"><li class="listitem">Created a security profile.</li><li class="listitem">Imported three files from Apple Developer: an app certificate, a provisioning profile, and a push certificate. These files are needed so that Ionic Cloud can be a trusted provider to communicate with Apple's APN server to trigger push notifications.</li></ul></div></li><li class="listitem">Wrote code in your app to receive notifications:<div><ul class="itemizedlist"><li class="listitem">You need to install the Ionic Cloud Angular library and the Cordova Push Notification plugin. The basic idea is to make the <code class="literal">push</code> object available for the app to use. This <code class="literal">push</code> object has been configured with your Ionic Cloud push provider.</li></ul></div></li></ul></div><p>Now, let's focus on<a id="id503" class="indexterm"/> the coding portion itself to understand how this works.</p><p>You need to change<a id="id504" class="indexterm"/> how the app bootstraps in <code class="literal">app.module.ts</code>. This requires the importing of the <code class="literal">provideCloud</code> and <code class="literal">CloudSettings</code> providers, as shown:</p><div><pre class="programlisting">import { provideCloud, CloudSettings } from '@ionic/cloud-angular';</pre></div><p>Besides setting the <code class="literal">app_id</code> to match with your project <code class="literal">app_id</code> in Ionic Cloud, you need to specify the <code class="literal">push</code> object with the parameters you want for both iOS and Android, as follows:</p><div><pre class="programlisting">const cloudSettings: CloudSettings = {
  'core': {
    'app_id': '00f293c4'
  },
  'push': {
    'sender_id': 'SENDER_ID',
    'pluginConfig': {
      'ios': {
        'badge': true,
        'sound': true
      },
      'android': {
        'iconColor': '#343434'
      }
    }
  }
};</pre></div><p>Then, inside <code class="literal">NgModule</code>, you need to insert the following line so that Ionic knows that it needs to initialize Ionic Cloud as well:</p><div><pre class="programlisting">CloudModule.forRoot(cloudSettings)</pre></div><p>In your <code class="literal">home.html</code> template, there is a button to trigger the registration of push notification by calling <code class="literal">registerpush()</code>:</p><div><pre class="programlisting">&lt;code class="center"&gt;{{ pushToken }}&lt;/code&gt;
&lt;button ion-button block [disabled]="clicked" [hidden]="pushToken" (click)="registerPush()"&gt;
  &lt;span [hidden]="clicked"&gt;Register Push&lt;/span&gt;
  &lt;span [hidden]="!clicked"&gt;Registering...&lt;/span&gt;
&lt;/button&gt;</pre></div><p>This registration process must be intervened manually by the user because the user will have to accept<a id="id505" class="indexterm"/> permission in the next step. It's not recommended to require the users to accept a push <a id="id506" class="indexterm"/>notification request when they open the app right away. The main reason is because they are not familiar with your app and don't know what to expect (that is, whether they will get bombarded with notifications later on).</p><p>The messages will be displayed via the <code class="literal">messages</code> object, as shown in the following code:</p><div><pre class="programlisting">&lt;ion-card *ngFor="let msg of messages"&gt;
  &lt;ion-card-header&gt;
    {{ msg.title }}
  &lt;/ion-card-header&gt;
  &lt;ion-card-content&gt;
    {{ msg.text }}
  &lt;/ion-card-content&gt;
&lt;/ion-card&gt;  </pre></div><p>Here, each <code class="literal">message</code> item has the <code class="literal">title</code> and <code class="literal">text</code> fields.</p><p>In <code class="literal">home.ts</code>, there are two critical imports that you must be aware of: <code class="literal">Push</code> and <code class="literal">PushToken</code> are required to register and receive push notifications. <code class="literal">ApplicationRef</code> will be discussed later as you need to trigger re-render the Angular template manually, as illustrated:</p><div><pre class="programlisting">import { Component, ApplicationRef } from '@angular/core';
import { NavController } from 'ionic-angular';
import { Push, PushToken } from '@ionic/cloud-angular';
The <code class="literal">register</code>Push() method is the key to acquire the PushToken from Ionic Cloud, as shown:
registerPush() {
  this.clicked = true;

  this.push.register().then((t: PushToken) =&gt; {
    return this.push.saveToken(t);
  }).then((t: PushToken) =&gt; {

    this.push.rx.notification().subscribe(msg =&gt; this.processPush(msg, this));

    console.log('Token saved:', t.token);
    this.pushToken = t.token;
  }, (err) =&gt; {
    alert('Token error');
    console.log(err);
  });
}  </pre></div><p>All you need to call is the <code class="literal">this.push.register()</code> function. This will return a <code class="literal">PushToken</code> object as you can see in the following screenshot of the console log:</p><div><img src="img/image00346.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>To receive<a id="id507" class="indexterm"/> notifications, you need to subscribe by using the following code:</p><div><pre class="programlisting">this.push.rx.notification().subscribe()</pre></div><p>This will call <code class="literal">processPush()</code> each time there is a new notification message, as follows:</p><div><pre class="programlisting">private processPush(msg, that) {
  console.log('Push notification message received');
  console.log(msg);
  this.messages.push({
    title: msg.title,
    text: msg.text
  })
  this.applicationRef.tick();
}</pre></div><p>When the user receives <a id="id508" class="indexterm"/>a push message, this function will append to the <code class="literal">messages</code> array. If you don't call <code class="literal">this.applicationRef.tick()</code>, the UI will not get updated since this process is outside Angular cycle. If you look into the console log, the <code class="literal">PushMessage</code> looks as follows, with the <code class="literal">text</code> and <code class="literal">title</code> fields:</p><div><img src="img/image00347.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>If the user doesn't open<a id="id509" class="indexterm"/> the app, you will see that the <a id="id510" class="indexterm"/>notification appears in the notification area.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec91"/>There's more...</h2></div></div></div><p>Ionic has its<a id="id511" class="indexterm"/> own iOS setup instructions pages, as follows:</p><div><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://docs.ionic.io/setup.html">http://docs.ionic.io/setup.html</a></li><li class="listitem"><a class="ulink" href="http://docs.ionic.io/services/profiles/#ios-setup">http://docs.ionic.io/services/profiles/#ios-setup</a></li><li class="listitem"><a class="ulink" href="http://docs.ionic.io/services/push/">http://docs.ionic.io/services/push/</a></li></ul></div><p>The Cordova Push Notification <a id="id512" class="indexterm"/>plugin is available directly at <a class="ulink" href="https://github.com/phonegap/phonegap-plugin-push">https://github.com/phonegap/phonegap-plugin-push</a>.</p><p>For more information about the<a id="id513" class="indexterm"/> Apple Push Notification service, you can visit the official documentation at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html">https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/ApplePushService.html</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec39"/>Building an Android app to receive push notifications</h1></div></div></div><p>Push notification works in the<a id="id514" class="indexterm"/> same way as iOS for Google. However, instead of using the Apple Notification Service, you will be <a id="id515" class="indexterm"/>working through the Firebase Cloud Messaging server, which is a new replacement for <strong>Google Cloud Messaging</strong> (<strong>GCM</strong>). However, Ionic <a id="id516" class="indexterm"/>Cloud abstracts this process so that you don't have to code using a different API. You will be using the same <code class="literal">push</code> object as for the iOS app.</p><div><h3 class="title"><a id="note24"/>Note</h3><p>For more information about the <a id="id517" class="indexterm"/>differences between FCM and GCM, visit the FAQ at <a class="ulink" href="https://firebase.google.com/support/faq">https://firebase.google.com/support/faq</a>.</p></div><p>In this section, you will learn how to do the following things:</p><div><ul class="itemizedlist"><li class="listitem">Set up Ionic Cloud for Android push notification</li><li class="listitem">Configure the Firebase <a id="id518" class="indexterm"/>project for the push API</li><li class="listitem">Write code to<a id="id519" class="indexterm"/> receive push notifications in Android</li></ul></div><p>You will be using the same code base as your iOS Push Notification example. The main difference is the process to set up in your Firebase and Ionic Cloud account.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec92"/>Getting ready</h2></div></div></div><p>You can test the Android push notification using the Android emulator. So, there is no need to have a physical Android device available.</p><p>You must also<a id="id520" class="indexterm"/> register for Firebase in order to access <a class="ulink" href="https://console.firebase.google.com">https://console.firebase.google.com</a>.</p><p>In addition, the following instructions use the specific version of these components:</p><div><ul class="itemizedlist"><li class="listitem">Mac OSX El Capitan 10.11.4</li><li class="listitem">Ionic CLI 2.1.8</li><li class="listitem">Cordova 6.4.0</li><li class="listitem">Node 6.8.1</li><li class="listitem">NPM 3.10.8</li><li class="listitem">Android Studio 2.x, with at least Android 5.1 (Lollipop) installed.<p>Observe the following</p><div><img src="img/image00348.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Android SDK Tools, Build Tools, Platform Tools and Intel <strong>Hardware Accelerated Execution Manager</strong> (<strong>HAXM</strong>) (<a class="ulink" href="https://software.intel.com/en-us/android/articles/installation-instructions-for-intel-hardware-accelerated-execution-manager-windows">https://software.intel.com/en-us/android/articles/installation-instructions-for-intel-hardware-accelerated-execution-manager-windows</a>).<p>Observe the following <a id="id521" class="indexterm"/>screenshot:</p><div><img src="img/image00349.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">At least<a id="id522" class="indexterm"/> one <strong>Android Virtual Device</strong> (<strong>AVD</strong>) has been created (use the <code class="literal">$ android avd</code> command line to<a id="id523" class="indexterm"/> open AVD Manager). Observe<a id="id524" class="indexterm"/> the following screenshot:<div><img src="img/image00350.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec93"/>How to do it...</h2></div></div></div><p>Here are the<a id="id525" class="indexterm"/> instructions:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new <code class="literal">MyAndroidPush</code> app using the <code class="literal">blank</code> template, as follows, and go to the <code class="literal">MyAndroidPush</code> folder:<div><pre class="programlisting">
<strong>$ ionic start MyAndroidPush blank --v2</strong>
<strong>$ cd MyAndroidPush</strong>
</pre></div></li><li class="listitem">Install the Ionic Cloud Angular<a id="id526" class="indexterm"/> client, which is a library, to interact with the <code class="literal">push</code> object, as illustrated:<div><pre class="programlisting">
<strong>$ npm install @ionic/cloud-angular --save</strong>
</pre></div><div><h3 class="title"><a id="note25"/>Note</h3><p>You need to have Node version 4.x or later and NPM version 3.x or later.</p></div></li><li class="listitem">Initialize your Ionic Cloud setting so that an app ID can be created in your account, as shown:<div><pre class="programlisting">
<strong>$ ionic io init</strong>
</pre></div><div><h3 class="title"><a id="note26"/>Note</h3><p>You will be prompted to log in to your Ionic Cloud account for this command line.</p></div></li><li class="listitem">You will need a <a id="id527" class="indexterm"/>Firebase project number <a id="id528" class="indexterm"/>and a Firebase server ID in order to set up your <code class="literal">app.ts</code> file correctly. First, let's log in to<a id="id529" class="indexterm"/> the Firebase console at <a class="ulink" href="https://console.firebase.google.com">https://console.firebase.google.com</a>.</li><li class="listitem">Click on the <strong>CREATE NEW PROJECT</strong> button and fill in a project name (that is, <code class="literal">MyAndroidPush</code>):<div><img src="img/image00351.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to <strong>Grow</strong> &gt; <strong>Notifications</strong> in the left navigation menu:<div><img src="img/image00352.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the Android icon:<div><img src="img/image00353.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p><div><h3 class="title"><a id="note27"/>Note</h3><p>The Firebase Cloud Messaging service also supports the iOS app. So, it's possible that you can use FCM for both the iOS and Android projects.</p></div></li><li class="listitem">Provide <strong>Package name</strong> in the form. You can copy and paste the <strong>Package name</strong> from your app project at <code class="literal">./config.xml</code>:<div><img src="img/image00354.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>CONTINUE</strong> and <a id="id530" class="indexterm"/>save the JSON file somewhere. You will not need this JSON file<a id="id531" class="indexterm"/> for Ionic project:<div><img src="img/image00355.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the<a id="id532" class="indexterm"/> <strong>FINISH</strong> button to complete setting up the notification service:<div><img src="img/image00356.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now, you will<a id="id533" class="indexterm"/> need the <strong>Server key</strong> and <strong>Sender ID</strong>. Navigate to the gear icon in the top left corner and select the <strong>Project settings</strong> menu item:<div><img src="img/image00357.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select the <strong>CLOUD MESSAGING</strong> tab:<div><img src="img/image00358.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Copy both the <strong>Server key</strong> and <strong>Sender ID</strong> (the same as <strong>Project ID</strong> if using Google Cloud Messaging):<div><img src="img/image00359.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate back to the Terminal and ensure that you are in the Ionic project folder.</li><li class="listitem">You need to install the <a id="id534" class="indexterm"/>Cordova Push<a id="id535" class="indexterm"/> Notification plugin and provide the same <strong>Sender ID</strong> value as the <code class="literal">SENDER_ID</code> value in the command line previously, as shown:<div><pre class="programlisting">
<strong>$ cordova plugin add phonegap-plugin-push --variable SENDER_ID=749277510481 --save</strong>
</pre></div></li><li class="listitem">Open your <code class="literal">./ionic.config.json</code> file in the project folder and copy the <code class="literal">app_id</code> value (in this case, the value is <code class="literal">e546b9f6</code>) from the following code:<div><pre class="programlisting">{
  "name": "MyAndroidPush",
  "app_id": "e546b9f6",
  "v2": true,
  "typescript": true
}</pre></div></li><li class="listitem">Open and edit <code class="literal">./src/app/app.module.ts</code> with the following content:<div><pre class="programlisting">import { NgModule } from '@angular/core';
import { IonicApp, IonicModule } from 'ionic-angular';
import { MyApp } from './app.component';

import { CloudSettings, CloudModule } from '@ionic/cloud-angular';

import { HomePage } from '../pages/home/home';

const cloudSettings: CloudSettings = {
  'core': {
    'app_id': 'e546b9f6'
  },
  'push': {
    'sender_id': '749277510481',
    'pluginConfig': {
      'ios': {
        'badge': true,
        'sound': true
      },
      'android': {
        'iconColor': '#343434'
      }
    }
  }
};


@NgModule({
  declarations: [
    MyApp,
    HomePage
  ],
  imports: [
    IonicModule.forRoot(MyApp),
    CloudModule.forRoot(cloudSettings)
  ],
  bootstrap: [IonicApp],
  entryComponents: [
    MyApp,
    HomePage
  ],
  providers: []
})
export class AppModule {}</pre></div><div><h3 class="title"><a id="note28"/>Note</h3><p>You must replace <code class="literal">'app_id': '00f293c4'</code> with your own app ID. Also, you have to provide <strong>Sender ID</strong> here one more time.</p></div></li><li class="listitem">The code for your home <a id="id536" class="indexterm"/>page is very similar to<a id="id537" class="indexterm"/> the iOS push example. Open and edit <code class="literal">./src/pages/home/home.html</code>, and paste the following code:<div><pre class="programlisting">&lt;ion-header&gt;
  &lt;ion-navbar&gt;
    &lt;ion-title&gt;
      Push Notification
    &lt;/ion-title&gt;
  &lt;/ion-navbar&gt;
&lt;/ion-header&gt;

&lt;ion-content padding&gt;

  &lt;code class="center"&gt;{{ pushToken }}&lt;/code&gt;
  &lt;button ion-button block [disabled]="clicked" [hidden]="pushToken" (click)="registerPush()"&gt;
    &lt;span [hidden]="clicked"&gt;Register Push&lt;/span&gt;
    &lt;span [hidden]="!clicked"&gt;Registering...&lt;/span&gt;
  &lt;/button&gt;

  &lt;h2 class="big-square" *ngIf="!pushToken"&gt;
    You have no message
  &lt;/h2&gt;

  &lt;h3 class="sub-title" *ngIf="pushToken"&gt;
    Your messages
  &lt;/h3&gt;

  &lt;ion-card *ngFor="let msg of messages"&gt;
    &lt;ion-card-header&gt;
      {{ msg.title }}
    &lt;/ion-card-header&gt;
    &lt;ion-card-content&gt;
      {{ msg.text }}
    &lt;/ion-card-content&gt;
  &lt;/ion-card&gt;  
&lt;/ion-content&gt;</pre></div></li><li class="listitem">Replace the <a id="id538" class="indexterm"/>content of the <code class="literal">home.ts</code> file, in the<a id="id539" class="indexterm"/> same folder, with the following code:<div><pre class="programlisting">import { Component, ApplicationRef } from '@angular/core';
import { NavController } from 'ionic-angular';
import { Push, PushToken } from '@ionic/cloud-angular';

@Component({
  templateUrl: home.html'
})
export class HomePage {
  public push: any;
  public pushToken: string;
  public messages = [];
  public clicked: Boolean = false;
  constructor(public navCtrl: NavController, push: Push, private applicationRef: ApplicationRef) {
    this.push = push;
  }

  private processPush(msg, that) {
    console.log('Push notification message received');
    console.log(msg);
    this.messages.push({
      title: msg.title,
      text: msg.text
    })
    this.applicationRef.tick();
  }

  registerPush() {
    this.clicked = true;

    this.push.register().then((t: PushToken) =&gt; {
      return this.push.saveToken(t);
    }).then((t: PushToken) =&gt; {

      this.push.rx.notification().subscribe(msg =&gt; this.processPush(msg, this));

      console.log('Token saved:', t.token);
      this.pushToken = t.token;
    }, (err) =&gt; {
      alert('Token error');
      console.log(err);
    });

  }  
}</pre></div></li><li class="listitem">Replace <code class="literal">home.scss</code>, also<a id="id540" class="indexterm"/> in the <code class="literal">/home</code> folder, with the<a id="id541" class="indexterm"/> following code:<div><pre class="programlisting">.home-page {
  .center {
    text-align: center;
  }

  h2.big-square {
    text-align: center;
    padding: 50px;
    color: #D91E18;
    background: #F9BF3B;
  }

  h3.sub-title {
    text-align: center;
    padding: 10px;
    color: #446CB3;
    background: #E4F1FE;
  }

  ion-card ion-card-header {
    padding: 10px 16px;
    background: #F9690E;
    color: white;
  }

  ion-card ion-card-header + ion-card-content, ion-card .item + ion-card-content {
    padding-top: 16px;
  }
}</pre></div></li><li class="listitem">If this is the first<a id="id542" class="indexterm"/> time you create this app, you must have a <code class="literal">keystore</code> file. This file is used to identify your app for push and publishing. If you lose it, you cannot update your app later on. To create a <code class="literal">keystore</code>, type the following command line<a id="id543" class="indexterm"/> and ensure that it's the same <code class="literal">keytool</code> version of the SDK (that is, check your <code class="literal">PATH</code> environment variable):<div><pre class="programlisting">
<strong>$ keytool -genkey -v -keystore MyAndroidPushKey.keystore -alias MyAndroidPushKey -keyalg RSA -keysize 2048 -validity 10000</strong>
</pre></div></li><li class="listitem">Once you fill out the information in the command line, make a copy of this file somewhere safe because you will need it later. Observe the following code:<div><pre class="programlisting">
<strong>Enter keystore password:</strong>
<strong>Re-enter new password:</strong>
<strong>What is your first and last name?</strong>
<strong>  [Unknown]:  Hoc Phan</strong>
<strong>What is the name of your organizational unit?</strong>
<strong>  [Unknown]:</strong>
<strong>What is the name of your organization?</strong>
<strong>  [Unknown]:</strong>
<strong>What is the name of your City or Locality?</strong>
<strong>  [Unknown]:</strong>
<strong>What is the name of your State or Province?</strong>
<strong>  [Unknown]:</strong>
<strong>What is the two-letter country code for this unit?</strong>
<strong>  [Unknown]:</strong>
<strong>Is CN=Hoc Phan, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct?</strong>
<strong>  [no]:  yes</strong>

<strong>Generating 2,048 bit RSA key pair and self-signed certificate (SHA256withRSA) with a validity of 10,000 days</strong>
<strong>	for: CN=Hoc Phan, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown</strong>
<strong>Enter key password for &lt;MyAndroidPushKey&gt;</strong>
<strong>	(RETURN if same as keystore password):</strong>
<strong>[Storing MyAndroidPushKey.keystore]</strong>
</pre></div><div><h3 class="title"><a id="note29"/>Note</h3><p>You must<a id="id544" class="indexterm"/> provide a password for this step. Otherwise, Ionic Cloud won't let you upload the <code class="literal">keystore</code> file.</p></div></li><li class="listitem">Now, log in<a id="id545" class="indexterm"/> to your Ionic Cloud at <a class="ulink" href="https://apps.ionic.io">https://apps.ionic.io</a> to configure the security <a id="id546" class="indexterm"/>profile next.</li><li class="listitem">Navigate to your project (that is, <code class="literal">MyAndroidPush</code>) and select the <strong>Settings</strong> menu:<div><img src="img/image00360.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>Certificates</strong>, as follows:<div><img src="img/image00361.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Create<a id="id547" class="indexterm"/> a <strong>New Security Profile</strong> and provide a name (for example, <code class="literal">MyAndroidPush</code>):<div><img src="img/image00362.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>EDIT</strong>, as illustrated:<div><img src="img/image00363.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Upload your<a id="id548" class="indexterm"/> <code class="literal">keystore</code> file (for example, <code class="literal">MyAndroidPushKe</code><code class="literal">y.keystore</code>,) alias name (for example, <code class="literal">MyAndroidPushKey</code>), and password from Step 22:<div><img src="img/image00364.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Paste<a id="id549" class="indexterm"/> <strong>Server key</strong> from Step 13 into the <strong>GCM API Key</strong> input box:<div><img src="img/image00365.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select <strong>Save</strong> to complete creating a security profile.</li><li class="listitem">Navigate back to the terminal.</li><li class="listitem">Ensure that<a id="id550" class="indexterm"/> you are in the app folder and build for the Android platform, as follows:<div><pre class="programlisting">
<strong>$ ionic emulate android</strong>
</pre></div></li></ol><div></div><p>The process to verify push notification for Android is very similar to iOS. Here are the instructions:</p><div><ol class="orderedlist arabic"><li class="listitem">Navigate to <strong>Ionic Cloud</strong> &gt; your app (<strong>MyAndroidPush</strong>) &gt; <strong>Push</strong>:<div><img src="img/image00338.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click<a id="id551" class="indexterm"/> on the <strong>CREATE YOUR FIRST PUSH</strong> button:<div><img src="img/image00339.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Fill in the push<a id="id552" class="indexterm"/> notification form from the create your first push message:<div><img src="img/image00366.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Leave the segment as <strong>All users</strong> so that anyone can get the push:<div><img src="img/image00342.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Select your <a id="id553" class="indexterm"/>security <a id="id554" class="indexterm"/>profile (that is, <code class="literal">MyAndroidPush</code>) that you created earlier. Then, click on the <strong>Send this Push</strong> button. Observe the following screenshot:<div><img src="img/image00343.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Verify that the push notification has been sent successfully from Ionic Cloud. It should have the <strong>Sent</strong> status, as illustrated:<div><img src="img/image00367.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">In the app on <a id="id555" class="indexterm"/>your simulator<a id="id556" class="indexterm"/> device, verify that the push message has appeared, as shown:<div><img src="img/image00368.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>You have successfully completed the verification steps.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec94"/>How it works...</h2></div></div></div><p>At a high level, this is the communication process behind the scene:</p><div><ul class="itemizedlist"><li class="listitem">Your device sends a registration request for push notification to Google's Firebase server. Your device's app must have the following:<div><ul class="itemizedlist"><li class="listitem">Firebase <strong>Project ID</strong></li><li class="listitem">Firebase <strong>Sender ID</strong></li></ul></div></li><li class="listitem">Google will reply with the registration ID (which is the same as the push token from the Ionic <code class="literal">push</code> object).</li><li class="listitem">Your app will send the registration ID to Ionic Cloud (or any push provider server). This process is<a id="id557" class="indexterm"/> behind the scene because Ionic Cloud Angular calls Ionic Cloud APIs to execute. However, your Ionic Cloud must have a security profile <a id="id558" class="indexterm"/>with four pieces of information, as listed in the following section:<div><ul class="itemizedlist"><li class="listitem">Firebase's Server key</li><li class="listitem">Keystore</li><li class="listitem">Keystore Alias</li><li class="listitem">Keystore password</li></ul></div></li><li class="listitem">Ionic Cloud will save this registration ID to request Google to send push notification later. You can trigger notifications via the Ionic Cloud UI.</li></ul></div><p>This is very similar to how Ionic Cloud works with Apple. Everything is simplified into your interactions with the <code class="literal">push</code> object from the Ionic Cloud Angular module.</p><p>To receive the console output, you can navigate to Google's URL at <a class="ulink" href="http://chrome://inspect/#devices">chrome://inspect/#devices</a>. This will provide a list of the available simulators to debug. Click on the <strong>inspect</strong> link to open the Google Developer Tool:</p><div><img src="img/image00369.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>You should be able to see the same screen as follows:</p><div><img src="img/image00370.jpeg" alt="How it works..."/></div><p style="clear:both; height: 1em;"> </p><p>The app outputs a token (that is, a Registration ID) and each push notification will be a <code class="literal">PushMessage</code> object. You can open and inspect the properties.</p><p>In summary, Android <a id="id559" class="indexterm"/>push notification works nicely<a id="id560" class="indexterm"/> because of the out-of-the-box integration between Ionic Cloud, Ionic Angular module, and Firebase Cloud Messaging.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec95"/>There's more...</h2></div></div></div><p>Ionic has its own Android setup<a id="id561" class="indexterm"/> instructions pages, as follows:</p><div><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://docs.ionic.io/setup.html">http://docs.ionic.io/setup.html</a></li><li class="listitem"><a class="ulink" href="http://docs.ionic.io/services/profiles/#android-app-keystore">http://docs.ionic.io/services/profiles/#android-app-keystore</a></li><li class="listitem"><a class="ulink" href="http://docs.ionic.io/services/push/">http://docs.ionic.io/services/push/</a></li></ul></div><p>For more<a id="id562" class="indexterm"/> information about the Firebase Notification service, you can visit the official documentation at <a class="ulink" href="https://firebase.google.com/docs/cloud-messaging/">https://firebase.google.com/docs/cloud-messaging/</a>.</p></div></div></body></html>