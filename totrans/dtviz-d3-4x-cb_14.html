<html><head></head><body><div><div><div><div><div><div><h1 class="title"><a id="appA"/>Chapter Appendix. Building Interactive Analytics in Minutes</h1></div></div></div><p>In this appendix we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learning Crossfilter.js library</li><li class="listitem" style="list-style-type: disc">Charting with dimensions using dc.js</li></ul></div><div><div><div><div><h1 class="title"><a id="ch14lvl1sec91"/>Introduction</h1></div></div></div><p>Congratulations! You have finished an entire book on data visualization with D3. Together we have explored various topics and techniques. At this point you will probably agree that building interactive, accurate, and aesthetically appealing data visualization is not a trivial matter even with the help of a powerful library like D3. It typically takes days or even weeks to finish a professional data visualization project even without counting the effort usually required on the backend. What if you need to build an interactive visualization quickly, or a proof-of-concept before a full-fledged visualization project can be commenced, and you need to do just that not in weeks or days, but minutes. In this appendix we will introduce you to two interesting JavaScript libraries that allow you to do just that: building quick in-browser interactive multidimensional data visualization in minutes.</p></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch14lvl1sec92"/>The crossfilter.js library</h1></div></div></div><p>Crossfilter is also a library created by D3's author <em>Mike Bostock</em>, initially used to power analytics for Square Register.</p><div><blockquote class="blockquote"><p>
<em>Crossfilter is a JavaScript library for exploring large multivariate datasets in browser. Crossfilter supports extremely fast (&lt;30ms) interaction with coordinated views, even with datasets containing a million or more records.</em>
</p></blockquote></div><div><blockquote class="blockquote"><p>
<em>-Crossfilter Wiki (August 2013)</em>
</p></blockquote></div><p>In other words, Crossfilter is a library that you can use to generate data dimensions on large and typically flat multivariate datasets. So what is a data dimension? A data dimension can be considered as a type of data grouping or categorization while each dimensional data element is a categorical variable. Since this is still a pretty abstract concept, let's take a look at the following JSON dataset and see how it can be transformed into dimensional dataset using Crossfilter. Assume that we have the following flat dataset in JSON describing payment transactions in a bar:</p><pre class="programlisting">[ 
  {"date": "2011-11-14T01:17:54Z", "quantity": 2, "total": 190,    "tip": 100, "type": "tab"}, 
  {"date": "2011-11-14T02:20:19Z", "quantity": 2, "total": 190,    "tip": 100, "type": "tab"}, 
  {"date": "2011-11-14T02:28:54Z", "quantity": 1, "total": 300,    "tip": 200, "type": "visa"}, 
.. 
] 
</pre><div><div><h3 class="title"><a id="note86"/>Note</h3><p>Sample dataset borrowed from Crossfilter Wiki: <a class="ulink" href="https://github.com/square/crossfilter/wiki/API-Reference">
https://github.com/square/crossfilter/wiki/API-Reference
</a>.</p></div></div><p>How many dimensions do we see here in this sample dataset? The answer is: it has as many dimensions as the number of different ways that you can categorize the data. For example, since this data is about customer payment, which is observation on time series, obviously the <code class="literal">date</code> is a dimension. Secondly, the payment type is naturally a way to categorize data; therefore, <code class="literal">type</code> is also a dimension.
</p><p>
The next dimension is bit tricky since technically we can model any of the field in the dataset as dimension or its derivatives; however, we don't want to make something as a dimension if it does not help us slice the data more efficiently or provide more insight into what the data is trying to say. The total and tip fields have very high cardinality, which usually is an indicator for poor dimension unless we group them into different buckets (though tip/total, that is, tip in percentage could be an interesting dimension); however, the <code class="literal">quantity</code> field is likely to have a relatively small cardinality assuming people don't buy thousands of drinks in this bar, therefore, we choose to use quantity as our third dimension. Now, here is what the dimensional logical model looks like:</p><p>
</p><div><img src="img/image_65_001.jpg" alt="The crossfilter.js library"/></div><p>
</p><p>Dimensional Dataset</p><p>These dimensions allow us to look at the data from a different angle, and if combined will allow us to ask some pretty interesting questions, for example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Are customers who pay by tab more likely to buy in larger quantity?</li><li class="listitem" style="list-style-type: disc">Are customers more likely to buy larger quantity on Friday night?</li><li class="listitem" style="list-style-type: disc">Are customers more likely to tip when using tab versus cash?</li></ul></div><p>Now, you can see why dimensional dataset is such a powerful idea. Essentially, each dimension gives you a different lens to view your data, and when combined, they can quickly turn raw data into knowledge. A good analyst can quickly use this kind of tool to formulate a hypothesis, hence gaining knowledge from data.</p><div><div><div><div><h2 class="title"><a id="ch14lvl2sec278"/>How to do it...</h2></div></div></div><p>Now, we understand why we would want to establish dimensions with our dataset; let's see how this can be done using Crossfilter:</p><pre class="programlisting">var timeFormat = d3.time.format.iso; 
var data = crossfilter(json); // &lt;-A 
 
var hours = data.dimension(function(d){ 
  return d3.time.hour(timeFormat.parse(d.date)); // &lt;-B 
}); 
var totalByHour = hours.group().reduceSum(function(d){ 
  return d.total; 
}); 
 
var types = data.dimension(function(d){return d.type;}); 
var transactionByType = types.group().reduceCount(); 
         
var quantities = data.dimension(function(d){return d.quantity;}); 
var salesByQuantity = quantities.group().reduceCount(); 
</pre></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec279"/>How it works...</h2></div></div></div><p>As shown in the preceding section, creating dimensions and groups are quite straight-forward in Crossfilter. First step before we can create anything is to feed our JSON dataset, loaded using D3, through Crossfilter by calling the <code class="literal">crossfilter</code> function (line <code class="literal">A</code>). Once that's done, you can create your dimension by calling the <code class="literal">dimension</code> function and pass in an accessor function that will retrieve the data element that can be used to define the dimension. In the case for <code class="literal">type</code> we will simply pass in <code class="literal">function(d){return d.type;}</code>. You can also perform data formatting or other task in dimension function (for example, date formatting on line <code class="literal">B</code>). After creating the dimensions, we can perform the categorization or grouping by using the dimension, so <code class="literal">totalByHour</code> is a grouping that sums up total amount of the sale for each hour, while <code class="literal">salesByQuantity</code> is a grouping of counting the number of transactions by quantity. To better understand how <code class="literal">group</code> works, we will take a look at what the group object looks like. If you invoke the <code class="literal">all</code> function on the <code class="literal">transactionsByType</code> group you will get the following objects back:</p><p>
</p><div><img src="img/5530_App_02.jpg" alt="How it works..."/></div><p>
</p><p>Crossfilter group objects</p><p>We can clearly see that <code class="literal">transactionByType</code> group is essentially a grouping of the data element by its type while counting the total number of data elements within each group since we had called <code class="literal">reduceCount</code> function when creating the group.</p><p>The following are the description for functions we used in this example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">crossfilter</code>: Creates a new crossfilter with given records if specified. Records can be any array of objects or primitives.</li><li class="listitem" style="list-style-type: disc"><code class="literal">dimension</code>: Creates a new dimension using the given value accessor function. The function must return naturally-ordered values, that is, values that behave correctly with respect to JavaScript's <code class="literal">&lt;</code>, <code class="literal">&lt;=</code>, <code class="literal">&gt;=</code>, and <code class="literal">&gt;</code> operators. This typically means primitives: Booleans, numbers, or strings.</li><li class="listitem" style="list-style-type: disc"><code class="literal">dimension.group</code>: Creates a new grouping for the given dimension, based on the given <code class="literal">groupValue</code> function, which takes a dimension value as input and returns the corresponding rounded value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">group.all</code>: Returns all groups, in ascending natural order by key.</li><li class="listitem" style="list-style-type: disc"><code class="literal">group.reduceCount</code>: A shortcut function to count the records; returns this group.</li><li class="listitem" style="list-style-type: disc"><code class="literal">group.reduceSum</code>: A shortcut function to sum records using the specified value accessor function.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec280"/>There's more...</h2></div></div></div><p>We have only touched a very limited number of Crossfilter functions. Crossfilter provides a lot more capability when it comes to how dimension and group can be created; for more information please check out its API reference: <a class="ulink" href="https://github.com/square/crossfilter/wiki/API-Reference">
https://github.com/square/crossfilter/wiki/API-Reference
</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec281"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Data Dimension: <a class="ulink" href="http://en.wikipedia.org/wiki/Dimension_(data_warehouse)">
http://en.wikipedia.org/wiki/Dimension_(data_warehouse)
</a></li><li class="listitem" style="list-style-type: disc">Cardinality: <a class="ulink" href="http://en.wikipedia.org/wiki/Cardinality">
http://en.wikipedia.org/wiki/Cardinality
</a></li></ul></div><p>At this point we have everything we want to analyze. Now, let's see how this can be done in minutes instead of hours or days.</p></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch14lvl1sec93"/>Dimensional charting - dc.js</h1></div></div></div><p>Visualizing Crossfilter dimensions and groups is precisely the reason why <code class="literal">dc.js</code> was created. This handy JavaScript library was created by your humble author and is designed to allow you to visualize Crossfilter dimensional dataset easily and quickly. This library was originally created by your humble author now maintained by a group of community contributor led by Gordon Woodhull.</p><div><div><h3 class="title"><a id="note87"/>Note</h3><p>dc.js version 2.0 beta that we used in this chapter has not yet been upgrade to D3 v4.x therefore you will notice usage and references to old D3 v3 API which is somewhat different from what we have witnessed so far in this book.</p></div></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec282"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file as reference:</p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/appendix-a/dc.html">
https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/appendix-a/dc.html
</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec283"/>How to do it...</h2></div></div></div><p>In this example we will create three charts:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A line chart for visualizing total amount of transaction on time series</li><li class="listitem" style="list-style-type: disc">A pie chart to visualize number of transactions by payment type</li><li class="listitem" style="list-style-type: disc">A bar chart showing number of sales by purchase quantity</li></ul></div><p>Here is what the code looks like:</p><pre class="programlisting">&lt;div id="area-chart"&gt;&lt;/div&gt; 
&lt;div id="donut-chart"&gt;&lt;/div&gt; 
&lt;div id="bar-chart"&gt;&lt;/div&gt; 
... 
dc.lineChart("#area-chart") 
                .width(500) 
                .height(250) 
                .dimension(hours) 
                .group(totalByHour) 
                .x(d3.time.scale().domain([ 
                 timeFormat.parse("2011-11-14T01:17:54Z"),  
                  timeFormat.parse("2011-11-14T18:09:52Z") 
])) 
                .elasticY(true) 
                .xUnits(d3.time.hours) 
                .renderArea(true) 
                .xAxis().ticks(5); 
 
        dc.pieChart("#donut-chart") 
                .width(250) 
                .height(250) 
                .radius(125) 
                .innerRadius(50) 
                .dimension(types) 
                .group(transactionByType); 
                 
        dc.barChart("#bar-chart") 
                .width(500) 
                .height(250) 
                .dimension(quantities) 
                .group(salesByQuantity) 
                .x(d3.scale.linear().domain([0, 7])) 
                .y(d3.scale.linear().domain([0, 12])) 
                .centerBar(true); 
 
        dc.renderAll(); 
</pre><p>This generates a group of coordinated interactive charts:</p><p>
</p><div><img src="img/image_65_003.jpg" alt="How to do it..."/></div><p>
</p><p>Interactive dc.js charts</p><p>When you click or drag your mouse across these charts you will see the underlying Crossfilter dimensions being filtered accordingly on all charts:</p><p>
</p><div><img src="img/image_65_004.jpg" alt="How to do it..."/></div><p>
</p><p>Filtered dc.js charts</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec284"/>How it works...</h2></div></div></div><p>As we have seen through this example, <code class="literal">dc.js</code> is designed to generate standard chart-based visualization on top of Crossfilter. Each <code class="literal">dc.js</code> chart is designed to be interactive so user can apply dimensional filter by simply interacting with the chart. <code class="literal">dc.js</code> is built entirely on D3, therefore, its API is very D3-like and I am sure with the knowledge you have gained from this book you will feel quite at home when using <code class="literal">dc.js</code>. Charts are usually created in the following steps.</p><div><ol class="orderedlist arabic"><li class="listitem">First step creates a chart object by calling one of the chart creation functions while passing in a D3 selection for its anchor element, which in our example is the <code class="literal">div</code> element to host the chart:
<pre class="programlisting">      &lt;div id="area-chart"&gt;&lt;/div&gt; 
      ... 
      dc.lineChart("#area-chart") 
</pre></li><li class="listitem">Then we set the <code class="literal">width</code>, <code class="literal">height</code>, <code class="literal">dimension</code>, and <code class="literal">group</code> for each chart:
<pre class="programlisting">        chart.width(500) 
             .height(250) 
             .dimension(hours) 
             .group(totalByHour) 
</pre></li></ol></div><p>For coordinate charts rendered on a Cartesian plane you also need to set the <code class="literal">x</code> and <code class="literal">y</code> scale:</p><pre class="programlisting">chart.x(d3.time.scale().domain([ 
  timeFormat.parse("2011-11-14T01:17:54Z"),  
  timeFormat.parse("2011-11-14T18:09:52Z") 
])).elasticY(true) 
</pre><p>In this first case, we explicitly set the x axis scale while letting the chart automatically calculate the y-scale for us. While in the next case we set both x and y scale explicitly.</p><pre class="programlisting">chart.x(d3.scale.linear().domain([0, 7])) 
        .y(d3.scale.linear().domain([0, 12])) 
</pre></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec285"/>There's more...</h2></div></div></div><p>Different charts have different functions for customizing their look-and-feel and you can see the complete API reference at <a class="ulink" href="https://github.com/dc-js/dc.js/blob/master/web/docs/api-latest.md">
https://github.com/dc-js/dc.js/blob/master/web/docs/api-latest.md
</a>.</p><p>Leveraging <code class="literal">crossfilter.js</code> and <code class="literal">dc.js</code> allows you to build sophisticated data analytics dashboard fairly quickly. The following is a demo dashboard for analyzing the NASDAQ 100 Index for the last 20 years <a class="ulink" href="https://dc-js.github.io/dc.js/">
https://dc-js.github.io/dc.js/
</a>:</p><p>
</p><div><img src="img/image_65_006.jpg" alt="There's more..."/></div><p>
</p><p>dc.js NASDAQ demo</p><p>At the time of writing this book, <code class="literal">dc.js</code> supports the following chart types:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bar chart (stackable)</li><li class="listitem" style="list-style-type: disc">Line chart (stackable)</li><li class="listitem" style="list-style-type: disc">Area chart (stackable)</li><li class="listitem" style="list-style-type: disc">Pie chart</li><li class="listitem" style="list-style-type: disc">Bubble chart</li><li class="listitem" style="list-style-type: disc">Composite chart</li><li class="listitem" style="list-style-type: disc">Choropleth map</li><li class="listitem" style="list-style-type: disc">Boxplot</li><li class="listitem" style="list-style-type: disc">Heatmap</li><li class="listitem" style="list-style-type: disc">Sparkline</li><li class="listitem" style="list-style-type: disc">Bubble overlay chart</li></ul></div><p>And many more, see this page for a complete list of supported chart types 
<a class="ulink" href="http://dc-js.github.io/dc.js/examples/">http://dc-js.github.io/dc.js/examples/</a>
. For more information on the <code class="literal">dc.js</code> 'library please check out our Wiki page at <a class="ulink" href="https://github.com/dc-js/dc.js">
https://github.com/dc-js/dc.js
</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec286"/>See also</h2></div></div></div><p>The following are some other useful D3 based reusable charting libraries. Although, unlike <code class="literal">dc.js</code> they are not designed to work with Crossfilter natively nevertheless they tend to be richer and more flexible when tackling general visualization challenges:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">NVD3: <a class="ulink" href="http://nvd3.org/">
http://nvd3.org/
</a></li><li class="listitem" style="list-style-type: disc">Rickshaw: <a class="ulink" href="http://code.shutterstock.com/rickshaw/">
http://code.shutterstock.com/rickshaw/
</a></li></ul></div></div></div></div></div></body></html>