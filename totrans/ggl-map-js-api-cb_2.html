<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Adding Raster Layers</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Styling of Google base maps</li><li class="listitem" style="list-style-type: disc">Using different tile sources as base maps</li><li class="listitem" style="list-style-type: disc">Adding tile overlays to maps</li><li class="listitem" style="list-style-type: disc">Adding image overlays to maps</li><li class="listitem" style="list-style-type: disc">Changing the transparency of overlays</li><li class="listitem" style="list-style-type: disc">Creating a heat map</li><li class="listitem" style="list-style-type: disc">Adding a traffic layer</li><li class="listitem" style="list-style-type: disc">Adding a transit layer</li><li class="listitem" style="list-style-type: disc">Adding a bicycling layer</li><li class="listitem" style="list-style-type: disc">Adding weather and cloud layers</li><li class="listitem" style="list-style-type: disc">Adding a Panoramio layer</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Introduction</h1></div></div></div><p>This chapter will cover everything about working with<a id="id46" class="indexterm"/> raster layers. The collection of recipes is composed of the most common use cases of handling raster layers in the Google Maps JavaScript API.</p><p>
<strong>Raster</strong>
<a id="id47" class="indexterm"/> is one of the prime data types in the <strong>GIS</strong>
<a id="id48" class="indexterm"/> world. The Google Maps JavaScript API presents an extensive set of tools to integrate external sources of imagery. Also, the API enables application developers to change the styling of its base maps with a palette of practically unlimited array of choices.</p><p>This chapter will introduce you to changing the styling of base maps and will then continue by covering how to display raster data, focusing on external <a id="id49" class="indexterm"/>
<strong>TMS</strong> (<strong>Tile Map Services</strong>), where the raster layer is composed of organized tiles in the map display (for example, OpenStreetMap). Lastly, there are a number of raster layers (traffic, transit, weather, bicycle, and Panoramio) that can be presented on the map by integrating them with the Google Maps JavaScript API.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Styling of Google base maps</h1></div></div></div><p>
<strong>Google base maps</strong>
<a id="id50" class="indexterm"/> show a variety of details such as water bodies (oceans, seas, rivers, lakes, and so on), roads, parks, and built-up areas (residential, industrial, and so on). As you have observed in the first chapter, all these are shown in predefined cartographic parameters. With the styling capability of base maps, you have a virtually unlimited set of choices in terms of the cartographic representation of base maps.</p><p>In your web or mobile applications, it is very beneficial to have a diversity of representations (in all different color schemes with different emphasis) in order to keep your audience more involved; maps blend neatly into your website design.</p><p>This recipe will guide you <a id="id51" class="indexterm"/>through the process of changing the styling of base maps.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Getting ready</h2></div></div></div><p>We can continue from the <em>Creating a simple map in a custom DIV element</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as we do not need to recall the basics of creating the map.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How to do it…</h2></div></div></div><p>The end product of the recipe will look like bluish Google Maps if you follow the given steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an array of styles as follows:<div><pre class="programlisting">var bluishStyle = [
    {
        stylers: [
            { hue: "#009999" },
            { saturation: -5 },
            { lightness: -40 }
        ]
     }
    {
        featureType: "road",
        elementType: "geometry",
        stylers: [
            { lightness: 100 },
            { visibility: "simplified" }
        ]
    },
    {
        featureType: "water",
        elementType: "geometry",
        stylers: [
            { hue: "#0000FF" },
            {saturation:-40}
        ]
    },
    {
        featureType: "administrative.neighborhood",
        elementType: "labels.text.stroke",
        stylers: [
            { color: "#E80000" },
            {weight: 1}
        ]
     },
     {
        featureType: "road",
        elementType: "labels.text",
        stylers: [
            { visibility: "off" }
        ]
    },
    {
        featureType: "road.highway",
        elementType: "geometry.fill",
        stylers: [
            { color: "#FF00FF" },
            {weight: 2}
        ]
    }
]</pre></div></li><li class="listitem">Add your <code class="literal">style</code> array<a id="id52" class="indexterm"/> to the <code class="literal">initMap()</code> function.</li><li class="listitem">Within the <code class="literal">initMap()</code> function, create a <code class="literal">styledMapType</code> object with its name and reference it with the <code class="literal">style</code> array:<div><pre class="programlisting">var bluishStyledMap = new google.maps.StyledMapType(bluishStyle,
    {name: "Bluish Google Base Maps with Pink Highways"});</pre></div></li><li class="listitem">Add the <code class="literal">mapTypeControlOptions</code> object having the <code class="literal">mapTypeIds</code> property to your original <code class="literal">mapOptions</code> object:<div><pre class="programlisting">var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    mapTypeControlOptions: {mapTypeIds: 
        [google.maps.MapTypeId.ROADMAP, 'new_bluish_style']}
};</pre></div></li><li class="listitem">Relate the new <code class="literal">mapTypeId</code> property to your <code class="literal">styledMapType</code> object:<div><pre class="programlisting">map.mapTypes.set('new_bluish_style', bluishStyledMap);</pre></div></li><li class="listitem">And lastly, set this new <code class="literal">mapTypeId</code> property to be displayed:<div><pre class="programlisting">map.setMapTypeId('new_bluish_style');</pre></div></li><li class="listitem">You can<a id="id53" class="indexterm"/> now observe the bluish-styled Google base maps as seen in the following screenshot:<div><img src="img/8825OT_02_01.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec31"/>How it works...</h2></div></div></div><p>Firstly, let's look at the <code class="literal">bluishStyle</code> array consisting of one or more <code class="literal">google.maps.MapTypeStyle</code> objects arranged as shown in the following code:</p><div><pre class="programlisting">var bluishStyle = [
  {
    featureType: '',
    elementType: '',
    stylers: [
      {hue: ''},
      {saturation: ''},
      {lightness: ''},
            ...
    ]
  },
  {
    featureType: '',
        ...
  }
]</pre></div><p>In this array, <a id="id54" class="indexterm"/>you can include several styles for the different map features and their respective elements such as their geometries, labels, and so on (all these are specified in <code class="literal">google.maps.MapTypeStyleElementType</code>).</p><p>Map features embrace the types of geographic representations that are found in the base maps. Administrative areas, landscape features, points of interest, roads, and water bodies are examples of map features.</p><p>In addition to these general definitions of map features, the Google Maps JavaScript API enables you to specify the subtypes of these features. For example, you may wish to change the default style on specific <code class="literal">poi</code> types by giving them the <code class="literal">featureType</code> property as follows:</p><div><pre class="programlisting">featureType: 'poi.school'</pre></div><p>Or, you can be more specific on the landscape map features:</p><div><pre class="programlisting">featureType: 'landscape.man_made'</pre></div><div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>
<strong>More about the google.maps.MapTypeStyleFeatureType object</strong>
</p><p>A complete listing of the <code class="literal">MapTypeStyleFeatureType</code> object specification can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyleFeatureType">https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyleFeatureType</a>.</p></div></div><p>Please note that the first element of our <code class="literal">bluishstyle</code> array does not include any <code class="literal">featureType </code>property, making the styler options valid for the entire base map as shown in the following code:</p><div><pre class="programlisting">{
    stylers: [
        { hue: "#009999" },
        { saturation: -5 },
        { lightness: -40 }
    ]
}</pre></div><p>In addition <a id="id55" class="indexterm"/>to <code class="literal">google.maps.MapTypeStyleFeatureType</code> and its constants, you can also detail each of its map features such as the geometries, geometry strokes and fills, labels, label texts (also text fill and stroke), and label icons. Taking this opportunity, you can style the geometries of roads in different settings than their related icons.</p><p>In our recipe, we have disabled the visibility of all the label texts of the roads, not touching their geometry or label icons as shown in the following code:</p><div><pre class="programlisting">{
     featureType: "road",
     elementType: "labels.text",
     stylers: [
        { visibility: "off" }
     ]
}</pre></div><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>
<strong>More about the google.maps.MapTypeStyleElementType object</strong>
</p><p>A complete <a id="id56" class="indexterm"/>listing of the <code class="literal">MapTypeStyleElementType</code> object specification can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyleElementType">https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyleElementType</a>.</p></div></div><p>For every feature type and its element type, you can specify a <code class="literal">google.maps.MapTypeStyler</code> object that covers the options of <code class="literal">hue</code>, <code class="literal">lightness</code>, <code class="literal">saturation</code>, <code class="literal">gamma</code>, <code class="literal">inverse_lightness</code>, <code class="literal">visibility</code>, and <code class="literal">weight</code> as an array. In our recipe, the styler option that makes the highway road appear in pink is as follows:</p><div><pre class="programlisting">{
    featureType: "road.highway",
    elementType: "geometry.fill",
    stylers: [
        { color: "#FF00FF" },
        {weight: 2}
    ]
}</pre></div><p>Here, the <code class="literal">color</code> <a id="id57" class="indexterm"/>option in the <code class="literal">stylers</code> array is an RGB Hex string of a pink tone, while <code class="literal">weight</code> defines the weight of the feature in pixels.</p><div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>
<strong>More about the google.maps.MapTypeStyler object</strong>
</p><p>A complete listing of the <code class="literal">MapTypeStyler</code> object specification can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyler">https://developers.google.com/maps/documentation/javascript/reference#MapTypeStyler</a>.</p></div></div><p>After defining the <code class="literal">style</code> array in our <code class="literal">initMap()</code> function, we created a <code class="literal">StyledMapType</code> object:</p><div><pre class="programlisting">var bluishStyledMap = new google.maps.StyledMapType(bluishStyle,
    {name: "Bluish Google Base Maps with Pink Highways"});</pre></div><p>This object takes two arguments—the first one is the <code class="literal">style</code> array and the second one is a <code class="literal">google.maps.StyledMapTypeOptions</code> object. Here, we have included only the <code class="literal">name</code> property; however, you can additionally include the <code class="literal">maxZoom</code> and <code class="literal">minZoom</code> properties between which the <code class="literal">StyledMapType</code> object will be displayed. In the screenshot of this recipe, you can see that the value we have assigned for the <code class="literal">name</code> property is displayed in the interface.</p><p>After we created the <code class="literal">StyledMapType</code> object, we added an additional object called <code class="literal">mapTypeControlOptions</code>, which takes the <code class="literal">mapTypeIds</code> array in the <code class="literal">mapOptions</code> object, replacing the <code class="literal">mapTypeId</code> property:</p><div><pre class="programlisting">var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    mapTypeControlOptions: {mapTypeIds: 
        [google.maps.MapTypeId.ROADMAP, 'new_bluish_style']}
};</pre></div><p>This enables us to add multiple styles in addition to the standard <code class="literal">ROADMAP</code> map type.</p><p>Next comes the step of linking the <code class="literal">mapTypeId ('new_bluish_style')</code> property that we have specified in the <code class="literal">mapTypeIds</code> array with the <code class="literal">StyledMapType</code> object (<code class="literal">bluishStyledMap</code>):</p><div><pre class="programlisting">map.mapTypes.set('new_bluish_style', bluishStyledMap);</pre></div><p>After linking the <code class="literal">mapTypeId</code> property with the <code class="literal">StyledMapType</code> object, we can end with the following line of code so that the map interface opens with a base map styled as per our intentions:</p><div><pre class="programlisting">map.setMapTypeId('new_bluish_style');</pre></div><p>In our recipe, <a id="id58" class="indexterm"/>we have covered how to style the base maps according to our taste. We have made use of the <code class="literal">google.maps.MapTypeStyle</code> object to select the feature types (<code class="literal">google.maps.MapTypeStyleFeatureType</code>) and the related elements (<code class="literal">google.maps.MapTypeStyleElementType</code>) and styled them using the <code class="literal">google.maps.MapTypeStyler</code> object. Then, we have added our <code class="literal">StyledMapType</code> object to the map, showing our own styling of the base maps of Google Maps.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec32"/>There's more...</h2></div></div></div><p>Using the <code class="literal">StyledMapType</code> object is only one of the ways of handling the user-defined styled base maps in the Google Maps Javascript API.</p><p>Another simpler usage is specifying the <code class="literal">style</code> array in the <code class="literal">styles</code> property of the <code class="literal">mapOptions</code> object:</p><div><pre class="programlisting">var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    styles: bluishStyle
};</pre></div><p>Another alternative is that after defining our <code class="literal">mapOptions</code> object, we can add the <code class="literal">styles</code> property later with the following code:</p><div><pre class="programlisting">map.setOptions({styles: bluishStyle });</pre></div><p>There is an important difference between using the <code class="literal">StyledMapType</code> object and the <code class="literal">style</code> property of the <code class="literal">mapOptions</code> object. Using the <code class="literal">StyledMapType</code> object enables us to define a number of (virtually infinite) styles as map types. In addition, these map types can be seen in the map type control of the map interface, so it is very easy for the user to switch back and forth between the map types.</p><p>However, if the styles are attached to the map by the <code class="literal">mapOptions</code> object's <code class="literal">style</code> property, there is no way for the user to change multiple styles. In fact, in the map type control, there will be an option for you to select new styles, because styles are not attached to a <code class="literal">StyledMapType</code> object, and therefore cannot be identified as map types.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>You can get information on how to use the Styled Maps Wizard<a id="id59" class="indexterm"/> at <a class="ulink" href="http://gmaps-samples-v3.googlecode.com/svn/trunk/styledmaps/wizard/index.html">http://gmaps-samples-v3.googlecode.com/svn/trunk/styledmaps/wizard/index.html</a>.</p><p>Preparing the <code class="literal">style</code> arrays is a job with many cartographic details. Finding the correct combination for each feature and the element type in stylers would take too much time, especially if the only way of editing is in a text editor. Google has done a great job by creating the Styled Map Wizard to ease this time-consuming task. It enables you to perform all your styling tasks in an interface, so you can have an overview of what you are changing in real time. After you finish your work, you can export your styles as JSON to be used as a <code class="literal">style</code> array in your application.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Using different tile sources as base maps</h1></div></div></div><p>Google base maps display an immense amount of content (local POI information, road hierarchies, driving directions, and so on) and a large styling palette. In addition, it provides tools to change the styling of its base maps in its JavaScript API.</p><p>Moreover, you can have your other map tile sources displayed as base maps in the Google Maps interface. This feature enables you to display your tiled maps in the Google Maps interface, utilizing most of the tools of the Google Maps JavaScript API.</p><p>In this recipe, we will go<a id="id60" class="indexterm"/> through displaying OpenStreetMap tiles as base<a id="id61" class="indexterm"/> maps in the Google Maps interface, using the JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Getting ready</h2></div></div></div><p>We can continue on from the <em>Creating a simple map in a custom DIV element</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as we do not need to reiterate the basics of getting the map on screen.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec34"/>How to do it…</h2></div></div></div><p>With this recipe, you will see the OpenStreetMap tiles on top of Google Maps after completing the given steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In your <code class="literal">initMap()</code> function, create an <code class="literal">ImageMapType</code> object with the following code:<div><pre class="programlisting">var osmMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        return "http://tile.openstreetmap.org/" + zoom + 
        "/" + coord.x + "/" + coord.y + ".png";
    },
    tileSize: new google.maps.Size(256, 256),
    name: "OpenStreetMap",
    maxZoom: 18
});</pre></div></li><li class="listitem">Add <a id="id62" class="indexterm"/>the <code class="literal">google.maps.mapTypeControlOptions</code> object <a id="id63" class="indexterm"/>having the <code class="literal">mapTypeIds</code> property to your original <code class="literal">google.maps.MapTypeId</code> object and the <code class="literal">ImageMapType</code> object:<div><pre class="programlisting">var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    {mapTypeIds: [google.maps.MapTypeId.ROADMAP,  
    'OSM']}
};</pre></div></li><li class="listitem">Relate the new <code class="literal">mapTypeId</code> array to your <code class="literal">ImageMapType</code> object:<div><pre class="programlisting">map.mapTypes.set('OSM', osmMapType);</pre></div></li><li class="listitem">And lastly, set this new <code class="literal">google.maps.mapTypeId</code> object to be displayed:<div><pre class="programlisting">map.setMapTypeId('OSM');</pre></div></li><li class="listitem">You can see the OpenStreetMap tiles on top of the Google base map tiles as shown in the following screenshot:<div><img src="img/8825OT_02_02.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec35"/>How it works...</h2></div></div></div><p>You might <a id="id64" class="indexterm"/>have observed that there is indeed little difference<a id="id65" class="indexterm"/> between the structure of code extracts of the <em>Styling of the Google base maps</em> recipe and this recipe. In the former, we have used the <code class="literal">StyledMapType</code> object to change the styles of the original base maps, while in this recipe, we have used the <code class="literal">ImageMapType</code> object.</p><p>This is because both the <code class="literal">StyledMapType</code> and <code class="literal">ImageMapType</code> objects are all special types of the <code class="literal">MapType</code> object (<code class="literal">google.maps.MapType</code>), in addition to the original base map types such as Roadmap, Satellite, Hybrid, and Terrain, which were introduced in the previous chapter.</p><p>Let's move step by step:</p><div><pre class="programlisting">var osmMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        return "http://tile.openstreetmap.org/" + zoom + "/" + 
        coord.x + "/" + coord.y + ".png";
     },
    tileSize: new google.maps.Size(256, 256),
    name: "OpenStreetMap",
    maxZoom: 18
});</pre></div><p>This part <a id="id66" class="indexterm"/>of the recipe creates an <code class="literal">osmMapType</code> object of <code class="literal">ImageMapType</code>. To create an <code class="literal">ImageMapType</code> object, we must supply two required properties: <code class="literal">getTileUrl</code> and <code class="literal">tileSize</code>.</p><p>Before filling in these two parameters, we must make sure we have a tiled map service of which we can use tiles. OpenStreetMap (<a class="ulink" href="http://www.openstreetmap.org/">http://www.openstreetmap.org/</a>) is<a id="id67" class="indexterm"/> a kind of a <a id="id68" class="indexterm"/>map service, built and existing thanks to the community efforts around the world.</p><p>Tiled map services are<a id="id69" class="indexterm"/> organized in a manner that the cartographic imagery is broken into parts (tiles) for each predetermined zoom level. These tiles are to be located alongside the x and y axis so that the tile map service consumers (such as the Google Maps API) can recognize their respective locations as seen in the following diagram:</p><div><img src="img/8825OT_02_03.jpg" alt="How it works..."/></div><p>The upper-left tile's coordinate is (0,0), and it is called the origin tile. In Google Maps, the origin is at the upper-left (northwest) corner of the map interface.</p><p>Remember that for the <code class="literal">getTileUrl</code> property, we supply a function that has two parameters: <code class="literal">coord</code> and <code class="literal">zoom</code>:</p><div><pre class="programlisting">getTileUrl: function(coord, zoom) {
    return "http://tile.openstreetmap.org/" + zoom + "/" + 
    coord.x + "/" + coord.y + ".png";
}</pre></div><p>The <code class="literal">coord</code> parameter is <a id="id70" class="indexterm"/>exactly the coordinate pair that takes the value of<a id="id71" class="indexterm"/> the tile coordinates introduced in the preceding screenshot. In other words, in the upper-left corner, <code class="literal">coord.x</code> should be 0 and <code class="literal">coord.y</code> should be 0.</p><p>Assuming that we are at zoom level 0, we can try and get a tile from the Openstreetmap URL supplied for the <code class="literal">getTileUrl</code> property:</p><div><pre class="programlisting">"http://tile.openstreetmap.org/" + zoom + "/" + coord.x + "/" + 
coord.y + ".png"</pre></div><p>This will give the following output:</p><div><pre class="programlisting">"http://tile.openstreetmap.org/0/0/0.png"</pre></div><p>If you copy this URL <a id="id72" class="indexterm"/>to the address bar of your browser, you will get the<a id="id73" class="indexterm"/> output as shown in the following screenshot:</p><div><img src="img/8825OT_02_04.jpg" alt="How it works..."/></div><p>This image is a single tile from Openstreetmap at zoom level 0. It is understood that the single OpenStreetMap tile at zoom level 0 covers the entire world.</p><p>Now, let's continue with zoom level 1:</p><p>
<a class="ulink" href="http://tile.openstreetmap.org/1/0/0.png">http://tile.openstreetmap.org/1/0/0.png</a>
</p><div><img src="img/8825OT_02_05.jpg" alt="How it works..."/></div><p>You might have <a id="id74" class="indexterm"/>noticed that the level of detail has increased as the <a id="id75" class="indexterm"/>zoom level has increased from 0 to 1. Also, the coverage area for each tile has been dramatically reduced (one-fourth in this case).</p><p>You can see the complete tile layout at zoom level 1 in the following screenshot:</p><div><img src="img/8825OT_02_06.jpg" alt="How it works..."/></div><p>An important<a id="id76" class="indexterm"/> property of the tiled map services is that at each zoom <a id="id77" class="indexterm"/>level, each tile of the previous zoom level is tiled again to possess the level of detail required for the current zoom level.</p><p>Returning to our <code class="literal">osmMapType</code> creation, the function for the <code class="literal">getTileUrl</code> property works for placing the tiles of an external source (OpenStreetMap in our recipe). The two arguments named <code class="literal">coord</code> and <code class="literal">zoom</code> are handled by the Google Maps API itself. The API detects the bounding box of the map and builds up the tile layout for each zoom level. Therefore, the API recognizes which tile coordinate should be requested at which zoom level. The only thing that is left for you to do is to present the tile URLs of the external tiled map source, which is what you have done in the <code class="literal">getTileUrl</code> property.</p><p>The second property is the <code class="literal">tileSize</code> property, which accepts a <code class="literal">google.maps.Size</code> object. As its name implies, this property defines the width and height of each tile in terms of pixel values. The Google Maps tile layout is outlined for 256 px by 256 px tiles; so we supply <code class="literal">google.maps.Size(256,256)</code>, where the first parameter stands for width and the second parameter stands for height.</p><p>The <code class="literal">maxZoom</code> property sets the maximum zoom level of display for the tiled map service. The external base maps will not be shown at zoom level 19 as <code class="literal">maxZoom</code> is set at <code class="literal">18</code> in this recipe.</p><p>The <code class="literal">name</code> property is set for the name of your choice for the tiled map service. It is directly seen in the <code class="literal">mapTypeControl</code> object at the upper-right corner of the map interface.</p><p>The final <a id="id78" class="indexterm"/>two lines are the same as the ones in the previous recipe; the<a id="id79" class="indexterm"/> first one relates to the <code class="literal">osmMapType</code> object of <code class="literal">ImageMapType</code> with <code class="literal">OSM</code> set for the <code class="literal">mapTypeID</code> object specified in the <code class="literal">mapTypeControlOptions</code> property of <code class="literal">mapOptions</code>:</p><div><pre class="programlisting">map.mapTypes.set('OSM', osmMapType);
map.setMapTypeId('OSM');</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec36"/>See also</h2></div></div></div><p>Detailed explanations of tile coordinates, pixel coordinates, and world coordinates in conjunction with projection details will be covered in the oncoming chapters.</p><p>Furthermore, using tiled map services as overlays to base maps will be covered in the next recipe.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Adding tile overlays to maps</h1></div></div></div><p>Google Maps has a selection of base maps as street maps and satellite imagery, which we discussed in the previous chapter; we will now discuss how additional base maps can be introduced to the Google Maps interface.</p><p>We can also<a id="id80" class="indexterm"/> use tiled map services as overlays to the base maps. By<a id="id81" class="indexterm"/> overlay, you can think of a separate sheet of map tiles put over the base maps. You can observe the details of the overlaid layer together with the base map. Examples of overlay layers might be of the boundaries of areas of interest, special POIs that are not found in the Google Maps' base maps, statistical results to be presented with aerial or point styling, and so on.</p><p>The tile map services that are used as base maps can technically be used as overlays in the Google Maps JavaScript API. However, using these tile map services (such as OpenStreetMaps) as overlays results in blocking the original base maps of Google Maps, as there would be no blank space in the map of overlaid tile map services (originally aimed to be base maps). This is because both the Google Maps base maps and the overlaid tile map services are designed to be base maps. Therefore, it is not recommended to use another tile map service that is meant for base maps as an overlay layer on top of the Google Maps base maps.</p><p>In this recipe, we will cover how to show the OpenStreetMap tiles as overlay layers in the Google Maps interface using the JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Getting ready</h2></div></div></div><p>We can use the previous recipe's code and change it a bit for this recipe in order to eliminate the need of rewriting the <code class="literal">osmMapType</code> object details.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How to do it…</h2></div></div></div><p>In this recipe, <a id="id82" class="indexterm"/>you will <a id="id83" class="indexterm"/>see the OpenStreetMap tiles as an overlay layer if you follow the given steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In your <code class="literal">initMap()</code> function, leave the <code class="literal">osmMapType</code> object as it is:<div><pre class="programlisting">var osmMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        return "http://tile.openstreetmap.org/" + 
        zoom + "/" + coord.x + "/" + coord.y + ".png";
    },
    tileSize: new google.maps.Size(256, 256),
    name: "OpenStreetMap",
    maxZoom: 18
});</pre></div></li><li class="listitem">Change the <code class="literal">google.maps.mapTypeControlOptions</code> object having <code class="literal">mapTypeIds</code> of both <code class="literal">google.maps.MapTypeId.ROADMAP</code> and <code class="literal">google.maps.MapTypeId.SATELLITE</code> in your <code class="literal">mapOptions</code> object:<div><pre class="programlisting">var mapOptions = {
    center: new google.maps.LatLng(39.9078, 32.8252),
    zoom: 10,
    mapTypeControlOptions:
        {mapTypeIds: [google.maps.MapTypeId.ROADMAP, 
        google.maps.MapTypeId.SATELLITE]}
};</pre></div></li><li class="listitem">Delete the following line of code (as no other base maps were specified in the preceding step):<div><pre class="programlisting">map.mapTypes.set('OSM', osmMapType);</pre></div></li><li class="listitem">Set the <code class="literal">ROADMAP</code> map type to be displayed as the base map:<div><pre class="programlisting">map.setMapTypeId(google.maps.MapTypeId.ROADMAP);</pre></div></li><li class="listitem">Overlay the <code class="literal">osmMapType</code> map type on top of the base map:<div><pre class="programlisting">map.overlayMapTypes.insertAt(0, osmMapType);</pre></div><div><img src="img/8825OT_02_07.jpg" alt="How to do it…"/></div></li><li class="listitem">You now have the OpenStreetMap tiles as an overlay layer, as shown in the preceding screenshot.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How it works...</h2></div></div></div><p>There is little <a id="id84" class="indexterm"/>difference between the preceding recipe and this recipe as<a id="id85" class="indexterm"/> you might have noticed. We have used the same custom <code class="literal">osmMapType</code> object of <code class="literal">google.maps.imageMapType</code>. We have used another tiled map service, but the structure remains the same.</p><p>The modifications have begun with the used <code class="literal">mapTypes</code> object in the <code class="literal">mapTypeControlOptions</code> property of the <code class="literal">mapOptions</code> object:</p><div><pre class="programlisting">mapTypeControlOptions:
{mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE]}</pre></div><p>We have included both the <code class="literal">ROADMAP</code> and <code class="literal">SATELLITE</code> map types to be selected as base maps.</p><p>Step 3 is important; we delete the following line:</p><div><pre class="programlisting">map.mapTypes.set('OSM', osmMapType);</pre></div><p>We are deleting this because we do not want the <code class="literal">osmMapType</code> object to be considered as a base map. We will just use it as an overlay.</p><p>In the next step, we are selecting our default base map as <code class="literal">ROADMAP</code>. You can change the code line for <code class="literal">SATELLITE</code> or you can make the switch from the <code class="literal">mapTypeControl</code> object in the map interface.</p><p>The final line is the line where our overlay operation happens:</p><div><pre class="programlisting">map.overlayMapTypes.insertAt(0, osmMapType);</pre></div><p>Here, the <code class="literal">overlayMapTypes</code> property is an array (<code class="literal">google.maps.MVCArray</code>). The <code class="literal">insertAt</code> method of <code class="literal">MVCArray</code> inserts objects at the specified index, and we have inserted our <code class="literal">imageMapType</code> object at index 0.</p><div><div><h3 class="title"><a id="tip08"/>Tip</h3><p>
<strong>More on google.maps.MVCArray</strong>
</p><p>The <code class="literal">google.maps.MVCArray</code> array is <a id="id86" class="indexterm"/>a Google implementation of the ordinary JavaScript array. You can construct an MVC Array from an array. More details can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#MVCArray">https://developers.google.com/maps/documentation/javascript/reference#MVCArray</a>.</p></div></div><p>You can have <a id="id87" class="indexterm"/>multiple overlays over the Google Maps base maps. You <a id="id88" class="indexterm"/>must use the <code class="literal">overlayMapTypes</code> property to set the associated orders for the overlay maps with the first parameter of the <code class="literal">insertAt</code> method as follows:</p><div><pre class="programlisting">map.overlayMapTypes.insertAt(1, anotherMapType1);
map.overlayMapTypes.insertAt(2, anotherMapType2);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec40"/>There's more...</h2></div></div></div><p>Overlay layers are placed on top of the base maps, and it is a good practice to turn them on and off to see the base maps. If you need to turn the overlay off, you need to include the following code:</p><div><pre class="programlisting">map.overlayMapTypes.setAt(0, null);</pre></div><p>This makes the overlay layer go off the map interface, but remember that the slot in the <code class="literal">overlayMapTypes</code> array is already allocated by the <code class="literal">insertAt</code> method. Therefore, if you want to present your user with the opportunity to toggle the overlay layers on and off (by means of a checkbox or so on), you can follow the given steps (copy the code of your current recipe before proceeding):</p><div><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">&lt;body&gt;</code> tag of your HTML code, add a checkbox:<div><pre class="programlisting">&lt;input type="checkbox" id="OSM" class="overlayMaps" onclick="toggleOverlayMaps()" /&gt;
&lt;label 
    for="OSM"&gt;OpenStreetMap Layer&lt;/label&gt;</pre></div></li><li class="listitem">Make <code class="literal">osmMaptype</code> a global variable outside the <code class="literal">initMap()</code> function:<div><pre class="programlisting">   var osmMapType;</pre></div></li><li class="listitem">Change the <code class="literal">osmMapType</code> declaration in your <code class="literal">initMap()</code> function to assign the new global variable:<div><pre class="programlisting">osmMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        return "http://tile.openstreetmap.org/" + zoom + 
        "/" + coord.x + "/" + coord.y + ".png";
    },
    tileSize: new google.maps.Size(256, 256),
    name: "OpenStreetMap",
    maxZoom: 18
});</pre></div></li><li class="listitem">Replace the <code class="literal">insertAt</code> method with the <code class="literal">pull(null)</code> method:<div><pre class="programlisting">map.overlayMapTypes.push(null);</pre></div></li><li class="listitem">Add an overlay layer toggling function:<div><pre class="programlisting">function toggleOverlayMaps() {
    var OSMLayer = document.getElementById("OSM");
    if (OSMLayer.checked)
    {
        map.overlayMapTypes.setAt(0, osmMapType);
    }
    else
    {
        map.overlayMapTypes.setAt(0, null);
    }
}</pre></div></li><li class="listitem">The <a id="id89" class="indexterm"/>main<a id="id90" class="indexterm"/> trick of the preceding code extract is to first open a space in the <code class="literal">overlayMapTypes</code> array of the <code class="literal">initMap()</code> function. After that, you can call the <code class="literal">setAt()</code> method to turn the overlay layer on or off.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Adding image overlays to maps</h1></div></div></div><p>Overlaying tiled map <a id="id91" class="indexterm"/>services is a big capability on hand. It enables a<a id="id92" class="indexterm"/> variety of tiled map services that come into the scene using the Google Maps API. The existing stock of tiled map services are, in general, global map services, which means that they cover the whole world or at least some continent/country.</p><p>We may be interested, for instance, to overlay a map for a university campus, having its rough plan on hand. Or, we may have found some map of a historical sheet and want to make use of it. Or, we may have an internal building plan of a particular building and we would like to see this building plan on top of Google Maps.</p><p>Is it possible to overlay these microscale images on top of Google Maps? Yes, certainly! In fact, technically, there would be no difference between using campus plans or building plans instead of tiled map services as overlays. The important thing to note is that those plan sheets should be aligned as tiles similar to the tiled map services on top of base maps.</p><p>In this recipe, we will not go through the details of preparing the tiles, but using them by means of the Google Maps JavaScript API. For convenience, we will use the plan of Google I/O's 2010 venue at Moscone Center, San Francisco.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>There are tools to prepare image tiles which can be used as overlays. The most prominent ones are<a id="id93" class="indexterm"/> MapTiler (<a class="ulink" href="http://www.maptiler.org">www.maptiler.org</a>) and<a id="id94" class="indexterm"/> GDAL2Tiles (<a class="ulink" href="http://www.klokan.cz/projects/gdal2tiles/">http://www.klokan.cz/projects/gdal2tiles/</a>). With these tools, you can georeference, rectify, and tile your images for the zoom levels of your choice.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Getting ready</h2></div></div></div><p>We can use the code from the <em>Using different tile sources as base maps</em> recipe, as very few modifications are required.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it…</h2></div></div></div><p>You will have an<a id="id95" class="indexterm"/> overlay layer—a building—on top of the Google Maps base <a id="id96" class="indexterm"/>maps if you follow the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Insert a <code class="literal">bounds</code> object:<div><pre class="programlisting">var bounds = {
    17: [[20969, 20970], [50657, 50658]],
    18: [[41939, 41940], [101315, 101317]],
    19: [[83878, 83881], [202631, 202634]],
    20: [[167757, 167763], [405263, 405269]]
};</pre></div></li><li class="listitem">Replace the <code class="literal">osmMapType</code> object with the <code class="literal">buildPlanMapType</code> object:<div><pre class="programlisting">var buildPlanMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        if (zoom &lt; 17 || zoom &gt; 20 ||
            bounds[zoom][0][0] &gt; coord.x ||
            coord.x &gt; bounds[zoom][0][1] ||
            bounds[zoom][1][0] &gt; coord.y ||
            coord.y &gt; bounds[zoom][1][1]) {
                return null;
        }
        return ['http://www.gstatic.com/io2010maps/tiles/5/L2_', zoom, '_', coord.x, '_', coord.y, '.png'].join('');
    },
    tileSize: new google.maps.Size(256, 256),
    name: "Google IO Building Plan",
    maxZoom: 20
});</pre></div></li><li class="listitem">Change the <a id="id97" class="indexterm"/>last line to:<div><pre class="programlisting">map.overlayMapTypes.insertAt(0, buildPlanMapType);</pre></div></li><li class="listitem"> Center the map<a id="id98" class="indexterm"/> on the Moscone Center:<div><pre class="programlisting">map.setCenter(new google.maps.LatLng(37.78320, -122.40421));</pre></div><div><img src="img/8825OT_02_08.jpg" alt="How to do it…"/></div></li></ol></div><p>You can see the building floor plan supplied as an image organized in tiles on top of the Google Maps base maps in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works...</h2></div></div></div><p>You may have observed that the main structure stays the same as in the previous recipe. First, you define a <code class="literal">google.maps.ImageMapType</code> object and then overlay it on top of base maps by using the <code class="literal">overlayMapTypes.insertAt</code> array of the <code class="literal">map</code> object.</p><p>The only change introduced in this recipe is due to the example building plan's boundaries (bounding box). In the previous recipe, the boundaries of the overlaid tiled map service were of the world, whereas in this recipe, we have limited it to the building, comparably on a much higher scale.</p><p>Therefore, we <a id="id99" class="indexterm"/>have included the <code class="literal">bounds</code> object defining the<a id="id100" class="indexterm"/> boundaries in terms of tile coordinates for each zoom level. We have limited the zoom level from 17 to 20 as lower zoom levels (&lt;17) would not show the building in a sensible fashion. The building would be just a small rectangle in zoom levels 16 and 15, and it would not show up in zoom levels lower than 14.</p><p>For each zoom level property in the <code class="literal">bounds</code> object, we have an array of x and y tile coordinates, x being the first and y being the second. Inside these arrays, the lower and upper bounds for the tile coordinates are found.</p><p>At this point, you may be wondering how these specific numbers are found:</p><div><pre class="programlisting">var bounds = {
var bounds = {
    17: [[20969, 20970], [50657, 50658]],
     ...
}</pre></div><p>These numbers are actually the tile coordinates that intersect with the boundaries of the Moscone Center as shown in the following screenshot:</p><div><img src="img/8825OT_02_09.jpg" alt="How it works..."/></div><p>You can <a id="id101" class="indexterm"/>observe that in the 17th zoom level, the x coordinate must <a id="id102" class="indexterm"/>be between 20969 and 20970, and the y coordinate must be between 50657 and 50658 for our image overlay.</p><p>The <code class="literal">bounds</code> object is used to create constraints for a restricted number of zoom levels to fetch tiles in the definition of the <code class="literal">buildPlanMapType</code> object's <code class="literal">getTileUrl</code> function. The function for the <code class="literal">getTileUrl</code> property checks each tile coordinate against the <code class="literal">bounds</code> object's items, so that the API does not try to fetch tiles that do not intersect with the boundaries of the building plan.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Changing the transparency of overlays</h1></div></div></div><p>The Google Maps JavaScript<a id="id103" class="indexterm"/> API supports third-party tiled map services <a id="id104" class="indexterm"/>or images to be overlaid on top of base maps. However, there is a problem with the overlay layers; they come on top of base maps and make them invisible. Of course, you can turn them on or off according to your choice; however, this is not a solution if you want to see the base maps together with the overlay layers.</p><p>In fact, you can just modify the opacity of the overlay layers to see the base maps and the overlay layers.</p><p>This recipe is focused on changing the transparency of the overlay layers introduced in the last two recipes.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Getting ready</h2></div></div></div><p>We can use the code introduced in the <em>Adding tile overlays to maps</em> recipe of this chapter and modify it a little to achieve the result. Be sure to copy the code of the recipe first.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How to do it…</h2></div></div></div><p>You will be able to make your overlay layer transparent after completing the one-step operation presented in the following code:</p><div><ol class="orderedlist arabic"><li class="listitem">Just change the <code class="literal">osmMapType</code> object:<div><pre class="programlisting">var osmMapType = new google.maps.ImageMapType({
    getTileUrl: function(coord, zoom) {
        return "http://tile.openstreetmap.org/" + zoom + 
        "/" +coord.x + "/" + coord.y + ".png";},
    tileSize: new google.maps.Size(256, 256),
    name: "OpenStreetMap",
    maxZoom: 18,
    opacity:0.6
});</pre></div></li><li class="listitem">You can adjust the transparency of your overlay layers as shown in the following screenshot:<div><img src="img/8825OT_02_10.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec46"/>How it works...</h2></div></div></div><p>Changing the<a id="id105" class="indexterm"/> transparency of overlay layers is very simple. Adding <a id="id106" class="indexterm"/>the following code to the <code class="literal">imageMapType</code> object does our work:</p><div><pre class="programlisting">opacity:0.6</pre></div><p>The opacity property of the <code class="literal">imageMapType</code> object makes the incoming tiles transparent according to the values supplied. The value for the opacity property must be between 1 and 0, where 1.0 stands for fully opaque overlays, while 0 stands for fully transparent overlays.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Creating a heat map</h1></div></div></div><p>The Google Maps API lays the foundation for several map-based analysis, including heat maps. A heat map is a form of visualization that shows the concentration of points through gradient color scales.</p><p>Points, in this respect, may be the representation of any geographically represented items such as hospitals, houses, schools, measured values of sea pollution tagged with coordinates, the location of waste collection bins, and so on. The list is practically infinite.</p><p>Heat maps are<a id="id107" class="indexterm"/> very important inputs for geostatistics. In a map display, you capture the intensity in a moment compared to the sole display of the locations of points:</p><div><img src="img/8825OT_02_11.jpg" alt="Creating a heat map"/></div><p>The preceding screenshot depicts the location of the OpenStreetMap points layer in İstanbul, Turkey, as of July. You might just get an idea of where the concentration of points is from the preceding screenshot, but the following screenshot shows it more clearly. The most intensely concentrated locations are colored in red, whereas lesser concentrated locations are in yellow. And, as you might have guessed, the green-colored locations are the least concentrated ones.</p><div><img src="img/8825OT_02_12.jpg" alt="Creating a heat map"/></div><p>In this<a id="id108" class="indexterm"/> recipe, we will create a heat map from a set of points using the Google Maps JavaScript API. It is worth noticing that this feature is not available within the standard Google Maps API; you need to load the visualization library to the API as shown in this recipe.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec47"/>Getting ready</h2></div></div></div><p>We can use the first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics,</em> as a base, because we do not need to reiterate the code for the map display. Please do not forget to copy the code from the original recipe before editing for this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How to do it…</h2></div></div></div><p>You will have a heatmap overlay from the set of points you use if you follow the given steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Reference the <code class="literal">visualization</code> libraries where you reference the Google Maps API:<div><pre class="programlisting">    &lt;script type="text/javascript"
        src="img/js? sensor=false&amp;libraries=visualization"&gt;
    &lt;/script&gt;</pre></div></li><li class="listitem">Open up a new text file in the same directory that contains our HTML file and name it <code class="literal">ch2_heatMapPoints.js</code>.</li><li class="listitem">Create an array of <code class="literal">google.maps.LatLng</code> objects (the complete array consists of 217 objects, which you can get from the downloaded code) in the newly created JavaScript file from the previous step:<div><pre class="programlisting">var heatmapPoints = [
new google.maps.LatLng(41.0182827999113,28.973224999734),
new google.maps.LatLng(41.0150707003526,28.9764445996386),
new google.maps.LatLng(41.01140130003,28.9831846001892),
new google.maps.LatLng(41.0148609002104,28.9764469999292),
new google.maps.LatLng(41.0149687001455,28.9764550002981),
new google.maps.LatLng(41.0148247996249,28.9757389996552),
new google.maps.LatLng(41.0020956002318,28.9736237995987),
];</pre></div></li><li class="listitem">Reference<a id="id109" class="indexterm"/> the <code class="literal">ch2_heatMapPoints.js</code> file in your HTML code:<div><pre class="programlisting">    &lt;script type="text/javascript" src="img/ch2_heatMapPoints.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Create the heatmap layer:<div><pre class="programlisting">    var heatmap = new google.maps.visualization.HeatmapLayer({
        data: heatmapPoints
    });</pre></div></li><li class="listitem">Add the heatmap layer to the map:<div><pre class="programlisting">    heatmap.setMap(map);</pre></div></li><li class="listitem">You should now have your heatmap overlay from your set of points, as shown in the following screenshot:<div><img src="img/8825OT_02_13.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec49"/>How it works...</h2></div></div></div><p>Firstly, creating a <a id="id110" class="indexterm"/>heatmap layer in the Google Maps JavaScript API requires the <code class="literal">visualization</code> library of the API to be added to the section where the Google Maps JavaScript API is referenced:</p><div><pre class="programlisting">    &amp;libraries=visualization</pre></div><p>With this addition, you can use the <code class="literal">google.maps.visualization.HeatmapLayer</code> object to create the heatmap layers.</p><p>The <code class="literal">google.maps.visualization.HeatmapLayer</code> object needs a JavaScript array or the <code class="literal">google.maps.MVCArray</code> object (an array) in which its elements are the <code class="literal">google.maps.LatLng</code> objects:</p><div><pre class="programlisting">    var heatmap = new google.maps.visualization.HeatmapLayer({
        data: heatmapPoints
    });</pre></div><p>The <code class="literal">google.maps.LatLng</code> object is constructed with two parameters with a longitude and latitude coordinate pair, to mention a point:</p><div><pre class="programlisting">    new google.maps.LatLng(41.0182827999113,28.973224999734)</pre></div><p>We have created the array object and its contents with 217 points in another JavaScript file, because it would take too much space in our original HTML file. Also, it is a good practice to have our data and related objects in another file to avoid potential structural problems.</p><p>Finally, we can add our heatmap layer to our current map with the following code:</p><div><pre class="programlisting">    heatmap.setMap(map);</pre></div><p>As you can <a id="id111" class="indexterm"/>toggle the overlay layers introduced in the previous recipes, you can also toggle the heatmap layers with the following:</p><div><pre class="programlisting">    heatmap.setMap(null);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec50"/>There's more...</h2></div></div></div><p>Heat maps are created from a set of points, and these points can be at different places as well as the same places. In other words, multiple <code class="literal">google.maps.LatLng</code> objects may be placed at the same place. The following code is an example:</p><div><pre class="programlisting">    new google.maps.LatLng(41.0182827999113,28.973224999734),
    new google.maps.LatLng(41.0182827999113,28.973224999734),
    new google.maps.LatLng(41.0182827999113,28.973224999734)</pre></div><p>This will increase the intensity of this point; it will be likely to be seen in red in the heat map.</p><p>But what if the instances of the <code class="literal">google.maps.LatLng</code> objects sharing the same coordinate pair increases? One method is to copy the lines as shown in the preceding code. However, there is another smarter way:</p><div><pre class="programlisting">    {location: new  
        google.maps.LatLng41.0182827999113,28.973224999734), 
        weight: 3
    },</pre></div><p>This object is <code class="literal">google.maps.visualization.WeightedLocation</code>, and it takes two properties: one is the <code class="literal">google.maps.LatLng</code> object, and the other one is <code class="literal">weight</code>. This <code class="literal">weight</code> parameter takes any numeric value representing the occurrence count of the points.</p><p>By default, the <code class="literal">LatLng</code> object itself has a weight of 1. Therefore, having a <code class="literal">WeightedLocation</code> object with the <code class="literal">weight</code> property set to <code class="literal">3</code> is equivalent to having the same <code class="literal">LatLng</code> object.</p><p>The <code class="literal">WeightedLocation</code> and <code class="literal">LatLng</code> objects may be used together in the array supplied for the heatmap layer's <code class="literal">data</code> property.</p><p>The heatmap layer's object possesses a range of options including <code class="literal">gradient</code>, <code class="literal">radius</code>, <code class="literal">opacity</code>, <code class="literal">maxIntensity</code>, and <code class="literal">dissipating</code>.</p><p>The <code class="literal">gradient</code> option <a id="id112" class="indexterm"/>takes an array of colors:</p><div><pre class="programlisting">    var gradientScheme = [
        'rgba(0, 0, 255, 0)',
        'rgba(0, 60, 200, 1)',
        'rgba(0, 120, 120, 1)',
        'rgba(125, 125, 125, 0)',
        'rgba(125, 120, 60, 0)',
        'rgba(200, 60, 0, 0)',
        'rgba(255, 0, 0, 1)'
    ];</pre></div><p>You can set the gradient property by adding a property to the <code class="literal">HeatmapLayer</code> constructor:</p><div><pre class="programlisting">    var heatmap = new google.maps.visualization.HeatmapLayer({
        data: heatmapPoints,
        gradient: gradientScheme
    });</pre></div><p>Alternatively, you can set the options later:</p><div><pre class="programlisting">    heatmap.setOptions({
        gradient: gradientScheme
    });</pre></div><p>The <code class="literal">dissipating</code> option is for adjusting the pixels needed to show intensity across zoom levels. Its default value is <code class="literal">false</code>, and this allows more pixels to be colored per point for intensity when the zoom level is increased.</p><p>By using the <code class="literal">maxIntensity</code> property, you can scroll up or down the heatmap layer:</p><div><pre class="programlisting">    heatmap.setOptions({
        maxIntensity: 2
    });</pre></div><p>The preceding code makes this recipe's output greenish because the intensity is increased. More points at the same location are required to make the heat map look reddish.</p><p>You can tweak the <code class="literal">radius</code> property to adjust the radius of the intensity for each point. The unit is in pixels.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec51"/>See also</h2></div></div></div><p>You can create heat maps using Fusion Tables in the cloud, which will be introduced later in the book. There are pros and cons when creating a heat map in either a browser or the cloud; this will be discussed in detail later in the book.</p><p>Details on the <code class="literal">LatLng</code> object and its use to create point vector overlays will be covered in the next chapter.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Adding the traffic layer</h1></div></div></div><p>In today's world, the condition of traffic is very important information in cities. If there is an accident on the way or a recent construction that blocks an important street, it affects your whole day. How useful would it be to have real-time traffic information directly on your maps?</p><p>The Google Maps JavaScript API has a very handy aspect that lets you have traffic information fed on a real-time basis on top of your base maps.</p><p>In this recipe, we will cover <a id="id113" class="indexterm"/>how to display traffic information on your<a id="id114" class="indexterm"/> Google Maps.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec52"/>Getting ready</h2></div></div></div><p>We can use the first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics,</em> as a base for the basic map display. After copying the code of the original recipe, you can proceed forward.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec53"/>How to do it…</h2></div></div></div><p>Here are the steps to show the traffic layer:</p><div><ol class="orderedlist arabic"><li class="listitem">Firstly, change the center of your map to a location where the traffic layer is served (details will be available in the <em>How it works...</em> section). For instance, for Barcelona, Spain, use the following values:<div><pre class="programlisting">    center: new google.maps.LatLng(41.3854, 2.1822),</pre></div></li><li class="listitem">Construct the <code class="literal">TrafficLayer</code> object:<div><pre class="programlisting">    var trafficLayer = new google.maps.TrafficLayer();</pre></div></li><li class="listitem">Add the <code class="literal">TrafficLayer</code> object to the map:<div><pre class="programlisting">    trafficLayer.setMap(map);</pre></div></li><li class="listitem">You can see the traffic layer colored according to the density of the real-time traffic condition as shown in the following screenshot:<div><img src="img/8825OT_02_14.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec54"/>How it works...</h2></div></div></div><p>In the first step, <a id="id115" class="indexterm"/>you might have noticed that we have <a id="id116" class="indexterm"/>switched to Barcelona, Spain, because in some countries, the traffic layer is not available. For the list of countries with the availability of traffic layers, you must view the spreadsheet at <a class="ulink" href="http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html">http://gmaps-samples.googlecode.com/svn/trunk/mapcoverage_filtered.html</a>. You can filter the <strong>traffic</strong> column to see all the countries with traffic layers.</p><p>The construction of the <code class="literal">TrafficLayer</code> object and its addition to the map is straightforward. There is no property involved in the construction of the <code class="literal">TrafficLayer</code> object.</p><p>You can toggle the <code class="literal">TrafficLayer</code> object off with the following code:</p><div><pre class="programlisting">        trafficLayer.setMap(null);</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Adding the transit layer</h1></div></div></div><p>Public transit lines have immense importance in cities, especially for tourists and foreigners in the city. Mapping these transit lines (bus, underground, and so on) onto the base maps of several cities is a tedious task, and this is what the Google Maps JavaScript API offers through its special objects.</p><p>In this recipe, we will add <a id="id117" class="indexterm"/>transit layers to <a id="id118" class="indexterm"/>the Google Maps map interface.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec55"/>Getting ready</h2></div></div></div><p>Continuing from the previous recipe, <em>Adding the traffic layer</em>, will simplify our work, as we will only replace the <code class="literal">TrafficLayer</code> object with <code class="literal">TransitLayer</code> classes. Remember to copy the code of the original recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec56"/>How to do it…</h2></div></div></div><p>Here are the steps to show public transit lines as an overlay:</p><div><ol class="orderedlist arabic"><li class="listitem">Delete <code class="literal">TrafficLayer</code> related lines (the last two lines).</li><li class="listitem">Instead of the <code class="literal">TrafficLayer</code> object, use the <code class="literal">TransitLayer</code> object:<div><pre class="programlisting">    var transitLayer = new google.maps.TransitLayer();</pre></div></li><li class="listitem">Add the <code class="literal">TransitLayer</code> object to the map:<div><pre class="programlisting">    transitLayer.setMap(map);</pre></div></li><li class="listitem">You can see the public transit lines as an overlay on Google Maps in your area of preference as shown in the following screenshot:<div><img src="img/8825OT_02_15.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How it works...</h2></div></div></div><p>The transit layer is <a id="id119" class="indexterm"/>offered in certain cities around the<a id="id120" class="indexterm"/> world, and you can find the complete listing of these cities at <a class="ulink" href="http://www.google.com/intl/en/landing/transit/">http://www.google.com/intl/en/landing/transit/</a>.</p><p>The <code class="literal">TransitLayer</code> object can bring multiple colored public transit lines. The color choices are not random; they are selected based on distinct transit line operators.</p><p>The construction and display of the <code class="literal">TransitLayer</code> object is the same as the <code class="literal">TrafficLayer</code> object.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Adding the bicycling layer</h1></div></div></div><p>It is good to have the information about the cycling paths and common routes on top of base maps; Google Maps offers this as an overlay layer.</p><p>In this recipe, we will introduce the<a id="id121" class="indexterm"/> bicycling layer and its usage as an overlay in the Google Maps JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec58"/>Getting ready</h2></div></div></div><p>Continuing from the previous recipe, <em>Adding the traffic layer</em>, will simplify our work, as we will only replace the <code class="literal">TransitLayer</code> object with the <code class="literal">BicyclingLayer</code> classes. Remember to copy the code of the original recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec59"/>How to do it…</h2></div></div></div><p>The steps required for showing the cycling paths and routes are presented as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Change the two lines containing <code class="literal">TransitLayer</code>, supplanting the <code class="literal">BicyclingLayer</code> object instead of the <code class="literal">TransitLayer</code> object:<div><pre class="programlisting">    var bicyclingLayer = new google.maps.BicyclingLayer ();
    bicyclingLayer.setMap(map);</pre></div></li><li class="listitem">You can observe the cycling paths and routes on top of the Google Maps base maps as shown in the following screenshot:<div><img src="img/8825OT_02_16.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec60"/>How it works...</h2></div></div></div><p>The bicycling layer <a id="id122" class="indexterm"/>has its own subdivisions reflected in its styles; the dark green routes represent the paths dedicated for cycling, while the light green ones represent streets with bike lanes. Lastly, the dashed routes represent the bicycle paths and streets recommended for use, but are not dedicated.</p><p>The steps to display the bicycling layer are totally identical to the transit or traffic layers, so there is no additional detail for the specifics of the bicycling layer.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Adding the weather and cloud layers</h1></div></div></div><p>Information on the temperature and weather conditions coupled with a map display is very common in weather reports on TVs; Google has put a feature in its API so that we can have this information in our own maps.</p><p>In this recipe, we will learn how to display weather-related information<a id="id123" class="indexterm"/> on top of base maps as overlays.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec61"/>Getting ready</h2></div></div></div><p>We can continue on from the <em>Creating a simple map in a custom DIV element</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as we do not need to go into detail for the basic map display.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec62"/>How to do it…</h2></div></div></div><p>Here are the steps to show the respective temperatures and cloud conditions in your maps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the weather library to the end of the reference for the Google Maps JavaScript API:<div><pre class="programlisting">    &lt;script type="text/javascript"
     src="img/js? sensor=false&amp;libraries=weather"&gt;
    &lt;/script&gt;</pre></div></li><li class="listitem">Change the center and zoom of the map in the <code class="literal">mapOptions</code> object so that we can make use of the related layers:<div><pre class="programlisting">    center: new google.maps.LatLng(38.0, 20.4),
    zoom: 5,</pre></div></li><li class="listitem">Construct an instance of the <code class="literal">google.maps.weatherLayer</code> object named <code class="literal">weatherLayer</code>:<div><pre class="programlisting">    var weatherLayer = new google.maps.weather.WeatherLayer
    ({
       temperatureUnits: 
       google.maps.weather.TemperatureUnit.CELCIUS
    });</pre></div></li><li class="listitem">Add <code class="literal">weatherLayer</code> to the map:<div><pre class="programlisting">    weatherLayer.setMap(map);</pre></div></li><li class="listitem">Construct an instance of <code class="literal">google.maps.weather.cloudLayer</code> named <code class="literal">cloudLayer</code>:<div><pre class="programlisting">    var cloudLayer = new google.maps.weather.CloudLayer();</pre></div></li><li class="listitem">Add <code class="literal">cloudLayer</code> to the map:<div><pre class="programlisting">    cloudLayer.setMap(map);</pre></div></li><li class="listitem">You can see the <a id="id124" class="indexterm"/>respective temperatures and cloud conditions in your Google Maps application as shown in the following screenshot:<div><img src="img/8825OT_02_17.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec63"/>How it works...</h2></div></div></div><p>In order to see weather-specific layers, we have to reference the <code class="literal">weather</code> libraries exactly in the same way we have referenced the <code class="literal">visualization</code> libraries for the heatmap overlays.</p><p>We have changed the center and zoom of the map for a purpose. The zoom is set to 5 as cloud layers are only visible between the zoom levels of 0 and 6. Also, we have arranged the center of the map in the Mediterranean to view a couple of countries with the weather information of their big cities.</p><p>It is important to note that together with the weather layers, administrative labels such as street and city names are not shown. Also, the weather layer is applicable between the zoom levels of 0 and 12.</p><p>In the construction of the <code class="literal">google.maps.weather.weatherLayer</code> object, you can specify the temperature units through the <code class="literal">temperatureUnits</code> property. The possible values are defined in <code class="literal">google.maps.weather.TemperatureUnit</code>:</p><div><pre class="programlisting">google.maps.weather.TemperatureUnit.CELCIUS
google.maps.weather.TemperatureUnit.FAHRENHEIT</pre></div><p>You can <a id="id125" class="indexterm"/>add the <code class="literal">weatherLayer</code> and <code class="literal">cloudLayer</code> layers to the map by calling their respective <code class="literal">setMap()</code> method and supplying the <code class="literal">map</code> object as the only argument.</p><p>Displaying the weather layer, you view the cities' weather conditions with the temperature information fed by <a class="ulink" href="http://www.weather.com">http://www.weather.com</a>. The icons displayed on top of the cities will change according to the real-time weather, whether it is the sun, clouds, or rain. Also, clicking on an icon will open a detailed popup showing the weather conditions for the next four days.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec64"/>There's more...</h2></div></div></div><p>You can tweak additional properties besides <code class="literal">temperatureUnits</code> for the <code class="literal">weatherLayer</code> object. You can suppress the detailed pop-up window or you can set the units for the wind speed and so on.</p><div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>
<strong>More about WeatherLayerOptions</strong>
</p><p>The complete listing on<a id="id126" class="indexterm"/> <code class="literal">WeatherLayerOptions</code> can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#WeatherLayerOptions">https://developers.google.com/maps/documentation/javascript/reference#WeatherLayerOptions</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Adding the Panoramio layer</h1></div></div></div><p>Panoramio<a id="id127" class="indexterm"/> is a geotagged photo-sharing website. This means you can upload your photos provided you geotag (georeference) them. Geotagging involves attaching a coordinate pair to the target object, whether it is a photo, video, or any other resource. You can find detailed<a id="id128" class="indexterm"/> information on how to use Panoramio at <a class="ulink" href="http://www.panoramio.com/">http://www.panoramio.com/</a>.</p><p>You can view Panoramio photos on Google Maps, and this recipe will cover the basics of how to do it.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec65"/>Getting ready</h2></div></div></div><p>We can continue on from the <em>Creating a simple map in a custom DIV element</em> recipe from <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as map display basics are already covered here.</p><p>As always, please copy the original recipe before proceeding.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec66"/>How to do it…</h2></div></div></div><p>You can overlay the <a id="id129" class="indexterm"/>variety of Panoramio image stocks on top of Google Maps if you follow the steps presented:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the Panoramio library to the referenced libraries:<div><pre class="programlisting">    &lt;script type="text/javascript"
     src="https://maps.googleapis.com/maps/api/js? 
     sensor=false&amp;libraries=panoramio"&gt;
    &lt;/script&gt;</pre></div></li><li class="listitem">Construct a new <code class="literal">google.maps.panoramio.PanoramioLayer()</code> object named <code class="literal">panoramioLayer</code> after the creation of the map object:<div><pre class="programlisting">    var panoramioLayer = new google.maps.panoramio.PanoramioLayer();</pre></div></li><li class="listitem">Add the <code class="literal">panoramioLayer</code> object to the map:<div><pre class="programlisting">    panoramioLayer.setMap(map);</pre></div></li><li class="listitem">You can now have the Panoramio images overlaid on top of Google Maps as shown in the following screenshot:<div><img src="img/8825OT_02_18.jpg" alt="How to do it…"/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec67"/>How it works...</h2></div></div></div><p>Adding the <a id="id130" class="indexterm"/>Panoramio layer is technically no different from what we did in the previous recipe. We add the related reference library, construct the layer, and add it to the map in the same pattern.</p><p>You can click on the thumbnail photos and a detailed pop-up window will open. In this popup, you can view the photo in a larger size along with its name and the username of the person who uploaded the photo.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec68"/>There's more...</h2></div></div></div><p>The Panoramio layer provides extra capability to customize the overlay layer. For instance, you can restrict the photos by filtering tags using the <code class="literal">setTag()</code> method:</p><div><pre class="programlisting">    panoramioLayer.setTag("Eiffel");</pre></div><p>This will filter the displayed thumbnails to the ones that include the <code class="literal">Eiffel</code> keyword in their tags.</p><p>Also, you can filter according to the user ID by calling the <code class="literal">setUserId()</code> method, supplying the <code class="literal">userId</code> string as an argument.</p><p>You can also <a id="id131" class="indexterm"/>suppress the detailed pop-up window that opens by using the <code class="literal">suppressInfoWindows</code> property that the <code class="literal">PanoramioLayer</code> object takes:</p><div><pre class="programlisting">    var panoramioLayer = new google.maps.panoramio.PanoramioLayer({
        suppressInfoWindows:true
    });</pre></div><div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>
<strong>More about PanoramioLayer</strong>
</p><p>The complete listing on <code class="literal">PanoramioLayer</code> can be found at <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#PanoramioLayerOptions">https://developers.google.com/maps/documentation/javascript/reference#PanoramioLayerOptions</a>.</p></div></div></div></div></body></html>