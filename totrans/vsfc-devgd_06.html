<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Visualforce Charting"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Visualforce Charting</h1></div></div></div><p>Visualforce charting<a id="id229" class="indexterm"/> is one of the best features from the Winter '13 release. It is a collection of components which provides a simple way to create charts on our Visualforce pages and Visualforce custom components. This feature gives us the facility to customize charts that are based on our data sets from SOQL queries, and create custom charts (such as pie, bar, and line charts) on our Visualforce pages. We can create charts with Visualforce and Apex, and the charting component takes care of all of the JavaScript code for us. Visualforce charts are rendered by using JavaScript on the client side and it allows us to build animated and visually excited charts on the Visualforce pages.</p><p>Sometimes, the standard Salesforce charts and dashboards may be insufficient to meet our requirements. This is where Visualforce charting comes into play. When we cannot fulfill our requirement with Visualforce charting we can use Google charts in Visualforce.</p><p>This chapter explains Visualforce charting, which is a collection of components that provides a simple and intuitive way to create charts in your Visualforce pages and custom components. The following topics will be covered in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Limitations and considerations of Visualforce charting</li><li class="listitem" style="list-style-type: disc">How does Visualforce charting work</li><li class="listitem" style="list-style-type: disc">A complex chart with Visualforce charting</li></ul></div><p>Let's build some exciting Visualforce charts…</p><div class="section" title="Limitations and considerations of Visualforce charting"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec36"/>Limitations and considerations of Visualforce charting</h1></div></div></div><p>When Force.com released the Visualforce charting feature, they announced a few known limitations and considerations for Visuaforce charting, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Visualforce<a id="id230" class="indexterm"/> charting can be rendered <a id="id231" class="indexterm"/>only in <span class="strong"><strong>Scalable Vector Graphics</strong></span> (<span class="strong"><strong>SVG</strong></span>)<a id="id232" class="indexterm"/> supported browsers.</li><li class="listitem" style="list-style-type: disc">Visualforce charts cannot be displayed in pages rendered as PDFs because Visualforce charting uses JavaScript to draw the charts.</li><li class="listitem" style="list-style-type: disc">Visualforce charting is not used in e-mail messages or e-mail templates because e-mail clients do not support JavaScript's execution in e-mail messages.</li><li class="listitem" style="list-style-type: disc">When we develop a Visulforce page with Visualforce charting, we need to use a JavaScript debugging tool such as Firebug to track errors and messages returning from Visualforce charting to the JavaScript console.</li><li class="listitem" style="list-style-type: disc">Dynamic Visualforce charting (Apex-generated) is still (as of Spring 2013) not supported by the Force.com platform. However, this feature is supposed to be released soon.</li></ul></div></div></div>
<div class="section" title="How does Visualforce charting work"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec37"/>How does Visualforce charting work</h1></div></div></div><p>Visualforce charting <a id="id233" class="indexterm"/>relies on Apex, Visualforce, and JavaScript. When we create Visualforce charts, we need an Apex method to prepare or query data to use as the source of the chart. Then we need to define our chart by using Visualforce charting components. The chart data that is prepared in the Apex method is bound to the chart component and the JavaScript draws the chart in the browser.</p><p>A Visualforce chart needs a chart container that has at least one data series component. We have the ability to add additional series, chart axes, and labeling components (such as legend, chart labels, and tool tips for data points).</p><p>The following example creates a simple pie chart that contains the number of items that are delivered to customers. In this example, we have hardcoded values for the chart data source. The following is the markup of a pie chart example:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page controller="VFChartController" title="Pie Chart"&gt;
    &lt;apex:chart height="350" width="450" data="{!chartData}"&gt;
        &lt;apex:pieSeries dataField="data" labelField="name"/&gt;
        &lt;apex:legend position="right"/&gt;
    &lt;/apex:chart&gt;
&lt;/apex:page&gt;</pre></div><p>Here is the associated custom controller, which prepares the data source for the chart. The chart container is defined by the <code class="literal">&lt;apex:chart&gt;</code> component<a id="id234" class="indexterm"/> and data binding is done by the <code class="literal">getChartData()</code> controller<a id="id235" class="indexterm"/> method. The <code class="literal">&lt;apex:pieSeries&gt;</code> component<a id="id236" class="indexterm"/> defines the label and data <a id="id237" class="indexterm"/>field from the returned data as follows:</p><div class="informalexample"><pre class="programlisting">public class VFChartController {

    public List&lt;PieChartData&gt; getChartData () {
        List&lt;PieChartData&gt; data = new List&lt;PieChartData&gt;();
        data.add(new PieChartData('RAM', 30));
        
        data.add(new PieChartData('Hard Disk', 15));
        data.add(new PieChartData('VGA Card', 10));
        data.add(new PieChartData('Mouse', 20));
        data.add(new PieChartData('USB Drive 16BG', 20));
        data.add(new PieChartData('USB Drive 32BG', 5));
        return data;
    }
    // Wrapper class
    public class PieChartData {
        public String name { get; set; }
        public Integer data { get; set; }
        
        public PieChartData(String name, Integer data) {
        this.name = name;
        this.data = data;
        }
    }
}</pre></div><p>The resultant chart of the preceding example is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9818_06_01.jpg" alt="How does Visualforce charting work"/><div class="caption"><p>The resultant pie chart</p></div></div><p>The preceding <a id="id238" class="indexterm"/>example illustrates the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PieChartData</code>: This is an inner class which has a set of properties to define the label (the <code class="literal">name</code> property) and the data (the <code class="literal">data</code> property) of the chart.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getChartData()</code>: This method returns a list of wrapper objects of <code class="literal">PieChartData</code>. These list elements create the data points for the chart.</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:pieSeries&gt;</code>: This component defines the label and data field from the returned data (objects of <code class="literal">PieChartData</code>).</li></ul></div><div class="section" title="Providing chart data"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec21"/>Providing chart data</h2></div></div></div><p>The following are the three different<a id="id239" class="indexterm"/> ways to provide data source to the chart:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using the controller method</li><li class="listitem" style="list-style-type: disc">Using a JavaScript function</li><li class="listitem" style="list-style-type: disc">Using a JavaScript array</li></ul></div><div class="section" title="Using the controller method"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec05"/>Using the controller method</h3></div></div></div><p>This technique has<a id="id240" class="indexterm"/> been <a id="id241" class="indexterm"/>illustrated in our simple pie chart example. This is a server-side technique and here we have used a controller method to return a list of objects. This object list can be our own Apex wrapper objects (as in our previous example), <code class="literal">AggregateResult</code> objects. or <code class="literal">sObjects</code>. The result of the method is serialized to JSON on the server side, and the result is directly used by the <code class="literal">&lt;apex:chart&gt;</code> component on the client side. Refer to the simple pie chart example for this technique.</p></div><div class="section" title="Using a JavaScript function"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec06"/>Using a JavaScript function</h3></div></div></div><p>There is another way<a id="id242" class="indexterm"/> to provide data to the chart component <a id="id243" class="indexterm"/>that is via a JavaScript function. We can use the name of the JavaScript function in the <code class="literal">&lt;apex:chart&gt;</code> component. This JavaScript function is the data provider and it can be defined in the Visualforce page or linked to the Visualforce page. We can use this JavaScript function to manipulate the data before sending it to the <code class="literal">&lt;apex:chart&gt;</code> component. See the JavaScript Remoting for Apex Controllers section for more information about using JavaScript remoting in Visualforce. The following is a simple example of a JavaScript function with the <code class="literal">&lt;apex:chart&gt;</code> component:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page controller="VFRemoteChartController" title="Pie Chart"&gt;
  &lt;script&gt;
    function getRemoteChartData(callback) {
      VFRemoteChartController.getRemotePieChartData(function(result, event) {
        if(event.status &amp;&amp; result &amp;&amp; result.constructor === Array) {
          callback(result);
        }
      });
    }
  &lt;/script&gt;
    &lt;apex:chart height="350" width="450" data="getRemoteChartData"&gt;
        &lt;apex:pieSeries dataField="data" labelField="name"/&gt;
        &lt;apex:legend position="right"/&gt;
    &lt;/apex:chart&gt;
&lt;/apex:page&gt;</pre></div><p>The following class is the associated custom controller of the preceding page. We have defined the remote method with the <code class="literal">@RemoteAction</code> annotation. That remote method transforms the data into the chart component:</p><div class="informalexample"><pre class="programlisting">public class VFRemoteChartController {
   
  @RemoteAction
  public static List&lt;PieChartData&gt; getRemotePieChartData() {
    List&lt;PieChartData&gt; data = new List&lt;PieChartData&gt;();
        data.add(new PieChartData('RAM', 30));
        
        data.add(new PieChartData('Hard Disk', 15));
        data.add(new PieChartData('VGA Card', 10));
        data.add(new PieChartData('Mouse', 20));
        data.add(new PieChartData('USB Drive 16BG', 20));
        data.add(new PieChartData('USB Drive 32BG', 5));
        return data;
  }
    
  // Wrapper class
    public class PieChartData {
        public String name { get; set; }
        public Integer data { get; set; }
        
        public PieChartData(String name, Integer data) {
        this.name = name;
        this.data = data;
        }
    }
}</pre></div></div><div class="section" title="Using a JavaScript array"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec07"/>Using a JavaScript array</h3></div></div></div><p>Another way of <a id="id244" class="indexterm"/>providing data is by using a JavaScript array. We <a id="id245" class="indexterm"/>can use Visualforce charting without using any custom controller by using a JavaScript array which can be Salesforce data or non-Salesforce data. We can query the Salesforce data in JavaScript code by using the Ajax Toolkit API which is a JavaScript wrapper around the API and we can build non-Salesforce data sources by using a JavaScript array in our own JavaScript code. Then we can use the array in the chart component by providing the name of the array to the <code class="literal">&lt;apex:chart&gt;</code> component. This method is useful when your data source relies only on the client side, and not on the server side. The following example illustrates how to define a Visualforce chart with a JavaScript array:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page &gt;
    &lt;script&gt;
        // Build the chart data array in JavaScript
        var dataArray = new Array();
        dataArray.push({'data':15,'name':'Hard Disk'});
        dataArray.push({'data':10,'name':'VGA Card'});
        dataArray.push({'data':20,'name':'Mouse'});
        dataArray.push({'data':20,'name':'USB Drive 16BG'});
        dataArray.push({'data':5,'name':'USB Drive 32BG'});
    &lt;/script&gt;
    &lt;apex:chart height="350" width="450" data="dataArray"&gt;
        &lt;apex:pieSeries dataField="data" labelField="name"/&gt;
        &lt;apex:legend position="right"/&gt;
    &lt;/apex:chart&gt;
&lt;/apex:page&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip25"/>Tip</h3><p>Visualforce charts are more customizable. We can customize the look and feel of elements, markers, the opacity of fill colors/lines, and can combine various data sources.</p></div></div></div></div></div>
<div class="section" title="A complex chart with Visualforce charting"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec38"/>A complex chart with Visualforce charting</h1></div></div></div><p>We can use Visualforce <a id="id246" class="indexterm"/>charting to build complex charts that <a id="id247" class="indexterm"/>represent various data series in one chart. For example, we can build a chart with multiple data series. The following example shows the number of items sold in three different years. The code shows the custom controller the custom controller. The <code class="literal">getComplexChartData()</code> method<a id="id248" class="indexterm"/> prepares the data for the chart component. This controller also has a <code class="literal">@RemoteAction</code> method<a id="id249" class="indexterm"/> to get the data to the chart component. But this example hasn't used the JavaScript remoting. It illustrates the way of reusing the data generation method for both server-side and JavaScript remoting methods.</p><div class="informalexample"><pre class="programlisting">public class ComplexChartController{
    
    // Return a list of data points for a chart
    public List&lt;ChartData&gt; getVFChartData() {
        return ComplexChartController.getComplexChartData();
    }
    
    // Make the chart data available via JavaScript remoting
    @RemoteAction
    public static List&lt;ChartData&gt; getRemoteVFChartData() {
        return ComplexChartController.getComplexChartData();
    }
  
    //prepare data sources
    public static List&lt;ChartData&gt; getComplexChartData() {
        List&lt;ChartData&gt; data = new List&lt;ChartData&gt;();
        data.add(new ChartData('RAM', 1300, 1275, 2534));
        data.add(new ChartData('Hard Disk', 1234, 2431, 1534));
        data.add(new ChartData('VGA Card', 2634, 2500, 2376));
        data.add(new ChartData('Mouse', 1765, 2000, 1432));
        data.add(new ChartData('USB D 16BG', 967, 932, 1450));
        data.add(new ChartData('USB D 32BG', 500, 765, 1768));        
        return data;
    }
    // Wrapper class
    public class ChartData{
        public String name { get; set; }
        public Integer data1 { get; set; }
        public Integer data2 { get; set; }
        public Integer data3 { get; set; }
        
        public ChartData(String name, Integer data1, Integer data2, Integer data3) {
            this.name = name;
            this.data1 = data1;
            this.data2 = data2;
            this.data3 = data3;
        }
    }
}</pre></div><p>The following<a id="id250" class="indexterm"/> screenshot represents a <a id="id251" class="indexterm"/>chart with three line series. This chart illustrates the number of items sold in three different years:</p><div class="mediaobject"><img src="graphics/9818_06_02.jpg" alt="A complex chart with Visualforce charting"/><div class="caption"><p>The output of the complex chart example</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>The x and y axes need to be defined in line and bar charts.</p></div></div><p>The markup of the <a id="id252" class="indexterm"/>complex chart example is as<a id="id253" class="indexterm"/> follows:</p><div class="informalexample"><pre class="programlisting">&lt;apex:page controller="ComplexChartController"&gt;
    &lt;apex:chart height="400" width="700" data="{!vFChartData}"&gt;
    
    &lt;apex:axis type="Numeric" position="left" fields="data1" title="Items Sold Quantity" grid="true"/&gt;
    &lt;apex:axis type="Category" position="bottom" fields="name" title="Item"&gt; &lt;/apex:axis&gt;
    &lt;apex:lineSeries axis="left" fill="true" xField="name" yField="data1" markerType="cross" markerSize="4" markerFill="#FF0000"/&gt;
    &lt;apex:lineSeries axis="left" xField="name" yField="data2" markerType="circle" markerSize="4" markerFill="#8E35EF"/&gt;
    &lt;apex:lineSeries axis="left" xField="name" yField="data3" markerType="circle" markerSize="8" markerFill="#FFFFFF"/&gt;
    &lt;/apex:chart&gt;
&lt;/apex:page&gt;</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec39"/>Summary</h1></div></div></div><p>In this chapter, we became familiar with Visualforce charting which allows us to build customized charts based on our data. We learned that Visualforce charting is a JavaScript-based feature. Therefore, we have learned about the limitations and considerations of Visualforce charting. We have also seen how to create simple and complex charts by using Visualforce charting components.</p></div></body></html>