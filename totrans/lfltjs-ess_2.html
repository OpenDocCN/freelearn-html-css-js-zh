<html><head></head><body>
  <div><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Mapping GeoJSON Data</h1></div></div></div><p>In <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>, all of the geometry elements—points, lines, and polygons—were created one at a time. You learned how to create groups of features using layer and feature groups and also multipolyline and multipolygon classes. In this chapter, you will learn how to add GeoJSON data to your map. The data will be comprised of multiple geometries and will have descriptive data associated with it.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What is GeoJSON?</li><li class="listitem" style="list-style-type: disc">How to add it to your map</li><li class="listitem" style="list-style-type: disc">How to style it</li><li class="listitem" style="list-style-type: disc">Iterating through features</li><li class="listitem" style="list-style-type: disc">How to call GeoJSON from external sources</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Understanding the roots of GeoJSON</h1></div></div></div><p>Before GeoJSON, there was <strong>JavaScript Object Notation</strong> (<strong>JSON</strong>), and before JSON, there was <strong>Extensible Markup Language</strong> (<strong>XML</strong>). As computers<a id="id130" class="indexterm"/> started to talk to each other over the Internet, the ability to send data from a service to a client became more important. XML, JSON, and GeoJSON are<a id="id131" class="indexterm"/> formats that represent and transmit data. XML was an attempt at a human-readable format that could store and send data. XML uses<a id="id132" class="indexterm"/> opening and closing tags to separate data. JSON is an alternative to XML that more closely resembles the way objects are created in JavaScript. JSON uses key-value pairs and is usually smaller than XML.</p></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Exploring GeoJSON</h1></div></div></div><p>GeoJSON is a <a id="id133" class="indexterm"/>JSON format that encodes geometries. GeoJSON can encode points, line strings, and polygons. It also allows for multipart geometries. You can encode multipoints, multiline strings, and multipolygons. These should sound familiar because they are pretty close to the geometries you learned to draw in <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>. The following GeoJSON code shows you two points in a feature collection:</p><div><pre class="programlisting">{"type":"FeatureCollection",
  "features":[
      {"type":"Feature",
          "geometry":{
              "type":"Point",
              "coordinates":[-106.62987,35.10418]
                  },
          "properties":{
              "name":"My Point",
              "title":"A point at the Big I"
                  }
      },      {"type":"Feature",
          "geometry":{
              "type":"Point",
              "coordinates":[-106,35]
                  },
          "properties":{
              "name":"MyOther Point",
              "title":"A point near Moriarty and I40"
              }
      }
]
}</pre></div><p>The feature collection in the preceding code is not a geometry, but rather a collection of geometries similar to the feature layer described in <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>.</p><p>To view the full <a id="id134" class="indexterm"/>GeoJSON specification, you can go to <a class="ulink" href="http://geojson.org/geojson-spec.html">http://geojson.org/geojson-spec.html</a>.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>For tools that can help you<a id="id135" class="indexterm"/> write and check your JSON, see <a class="ulink" href="http://www.jsoneditoronline.org/">http://www.jsoneditoronline.org/</a> or <a class="ulink" href="http://geojsonlint.com/">http://geojsonlint.com/</a>.</p></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>GeoJSON in Leaflet.js</h1></div></div></div><p>GeoJSON is just another data format for you to add to your map. It can be added as a hardcoded variable. Leaflet.js geometries—markers, polylines, and polygons—can be converted to GeoJSON. You<a id="id136" class="indexterm"/> can style the data, apply options to each feature, and even<a id="id137" class="indexterm"/> filter the data. The next sections will cover these topics, starting with adding GeoJSON as a hardcoded variable.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec23"/>GeoJSON as a variable</h2></div></div></div><p>The easiest way to add GeoJSON<a id="id138" class="indexterm"/> to your map is to hardcode the data into a variable. In Leaflet.js, you will start by creating a variable that will contain GeoJSON. In the following code, GeoJSON data consisting of two points is assigned to the <code class="literal">geojson</code> variable:</p><div><pre class="programlisting">vargeojson = [{
"type": "Feature",
"geometry": {
"type": "Point",
"coordinates": [-106.62987,35.10418]
          },
  "properties": {
  "name": "My Point",
 "title": "A point at the Big I"
        }
},{
"type": "Feature",
  "geometry": {
      "type": "Point",
       "coordinates": [-106, 35]
               },
"properties": {
      "name": "My Other Point",
       "title": "A point near Moriarty and I40"
                 }
}];</pre></div><p>Once you have the GeoJSON data in a variable, as shown in the preceding code, adding it to the map is no different from adding any other geometry you have learned so far. The following code adds GeoJSON to the map:</p><div><pre class="programlisting">vargeoJsonLayer = L.geoJson(geojson).addTo(map);</pre></div><p>The preceding code creates a <code class="literal">geoJsonLayer</code> variable. This variable is an instance of the <code class="literal">L.geoJson()</code>class. It takes a variable with the GeoJSON data as a parameter and then you chain <code class="literal">.addTo(map)</code> to the end.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>Objects have been created using <code class="literal">(latitude, longitude)</code> in <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>; however, note that in GeoJSON, the format is <code class="literal">(longitude, latitude)</code>.</p></div></div><p>The result of this code will<a id="id139" class="indexterm"/> be a map with two markers, as shown in the following screenshot:</p><div><img src="img/4812OS_02_01.jpg" alt="GeoJSON as a variable"/></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Multiple geometries in GeoJSON</h2></div></div></div><p>In the preceding example, GeoJSON contained only points. While it is common for a GeoJSON file to contain a<a id="id140" class="indexterm"/> single geographic feature, it is not a requirement. Leaflet.js can load GeoJSON with multiple geometries in a single GeoJSON file. In this example, you will learn how to create and add a GeoJSON file with a point, line string, and polygon. The following GeoJSON code contains three different geometries:</p><div><pre class="programlisting">vargeojson = [{
"type": "Feature",
"geometry": {
"type": "Point",
"coordinates": [-106.62987, 35.10418]
          },
  "properties": {
  "name": "My Point",
         "title": "A point at the Big I"
        }
},{
"type": "Feature",
  "geometry": {
      "type": "LineString",
        "coordinates":[[-106.67999, 35.14097],
                        [-106.68892, 35.12974],
  [-106.69064, 35.1098]]
               },
"properties": {
      "name": "My LineString",
      "title": "A line along the Rio Grande"
                  }
},{
"type": "Feature",
  "geometry": {
      "type": "Polygon",
       "coordinates":[[[-106.78059, 35.14574],
           [-106.7799, 35.10559],
           [-106.71467, 35.13704],
           [-106.69716, 35.17942],
           [-106.78059, 35.14574]]]
               },
"properties": {
      "name": "My Polygon",
      "title": "Balloon Fiesta Park"
                  }
 }];</pre></div><p>To create different geometries in a single GeoJSON file, you just need to specify the type and include the proper coordinates, as<a id="id141" class="indexterm"/> shown in the preceding code. For a line string, you must include at least two points. In Leaflet.js, polygons do not require you to close them by including the starting coordinates at the end of the list. GeoJSON does require you to close the polygon. The polygon in the preceding code starts and ends with <code class="literal">[-106.78059, 35.14574]</code>. The preceding code will produce the map shown in the following screenshot:</p><div><img src="img/4812OS_02_02.jpg" alt="Multiple geometries in GeoJSON"/></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec03"/>Polygons with holes</h3></div></div></div><p>A polygon in GeoJSON can be a donut, that is, you can cut a polygon out of the middle of another polygon. The following<a id="id142" class="indexterm"/> code shows you a polygon feature with two polygons, the outer and inner polygons:</p><div><pre class="programlisting">vargeojson = [{
"type": "Feature",
  "geometry": {
      "type": "Polygon",
       "coordinates":[
           [[-106.875, 35.20074],
            [-106.82281, 34.9895],
            [-106.50146, 35.00525],
            [-106.47949, 35.1985],
            [-106.875, 35.20074]],
  [[-106.6745, 35.1463],
 [-106.70403, 35.05192],
 [-106.55296, 35.05979],
 [-106.53854, 35.17212],
 [-106.6745, 35.1463]]
   ]
               },
"properties": {
      "name": "My Polygon with a hole",
       "title": "Donut"
                  }
            }];</pre></div><p>In the preceding code, the first set of points creates a four-sided polygon. The second set of points—the next level <a id="id143" class="indexterm"/>of indentation—creates a four-sided polygon in the middle of the first polygon. The result is shown in the following screenshot:</p><div><img src="img/4812OS_02_03.jpg" alt="Polygons with holes"/></div><p>The middle of the polygon in the preceding screenshot is hollow. If you add a pop up to the polygon, it will only open when you click on the blue ring.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec25"/>GeoJSON from Leaflet.js objects</h2></div></div></div><p>Each of the geometries you learned about in <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>, have a <code class="literal">toGeoJson()</code> <a id="id144" class="indexterm"/>method. This method will convert the geometry to a GeoJSON object that can be added to the map. The following code shows you how to convert a <a id="id145" class="indexterm"/>marker to a GeoJSON layer:</p><div><pre class="programlisting">varmyMarker=L.marker([35.10418, -106.62987]);
varmarkerAsGeoJSON = myMarker.toGeoJSON();
vargeoJsonLayer = L.geoJson(markerAsGeoJSON).addTo(map);</pre></div><p>The preceding code creates a marker, as you did in the <em>Adding data to your map</em> section in <a class="link" href="ch01.html" title="Chapter 1. Creating Maps with Leaflet">Chapter 1</a>, <em>Creating Maps with Leaflet</em>. Secondly, it calls the <code class="literal">.toGeoJSON()</code> method, which returns a GeoJSON object and stores it as <code class="literal">markerAsGeoJSON</code>. Lastly, <code class="literal">markerAsGeoJSON</code> is added<a id="id146" class="indexterm"/> to the map as GeoJSON.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Styling GeoJSON layers</h2></div></div></div><p>GeoJSON layers have a <code class="literal">style</code> option and a <code class="literal">setStyle()</code> method. Using the <code class="literal">style</code> option, you specify a<a id="id147" class="indexterm"/> function that will style the layer. The following <a id="id148" class="indexterm"/>code shows you how to style a GeoJSON layer with the <code class="literal">style</code> option:</p><div><pre class="programlisting">functionstyleFunction(feature){
switch (feature.properties.type) {
case 'LineString': return {color: "red"}; break;
case 'Polygon':   return {color: "purple"}; break;
        }
}
vargeoJsonLayer = L.geoJson(geojson,{style:styleFunction}).addTo(map);</pre></div><p>The preceding code creates a style function that returns a color based on the GeoJSON feature names. If it is a line string, it is colored red, and if it is a polygon, it is colored purple.</p><div><div><h3 class="title"><a id="note14"/>Note</h3><p>You can also style the GeoJSON data using other options such as <code class="literal">stroke</code>, <code class="literal">weight</code>, <code class="literal">opacity</code>, and <code class="literal">fillColor</code>. The full list is available at <a class="ulink" href="http://leafletjs.com/reference.html#path-options">http://leafletjs.com/reference.html#path-options</a>.</p></div></div><p>The last line creates the GeoJSON layer, calls the style function, and then adds it to the map. The result is seen in the following screenshot:</p><div><img src="img/4812OS_02_05.jpg" alt="Styling GeoJSON layers"/></div><p>The <code class="literal">setStyle()</code> method <a id="id149" class="indexterm"/>allows you to change the style after one has already been applied or by using events. The<a id="id150" class="indexterm"/> following code shows you how an<a id="id151" class="indexterm"/> event can call the <code class="literal">setStyle()</code> method to update the color of the GeoJSON layer:</p><div><pre class="programlisting">functionstyleFunction(){return {color: "purple"}; }
functionnewStyle(){geoJsonLayer.setStyle({color:"green"});}

vargeoJsonLayer = L.geoJson(geojson,{style:styleFunction}).addTo(map);
geoJsonLayer.on('mouseover',newStyle);
geoJsonLayer.on('mouseout',function(e){geoJsonLayer.resetStyle(e.target);});</pre></div><p>The preceding code first creates a function called <code class="literal">styleFunction()</code>, which is called in the fourth line of code using the <code class="literal">style</code> option as shown in the previous example. It sets the color of the GeoJSON layer to <code class="literal">purple</code>. Next, there is another function, <code class="literal">newStyle()</code>, which sets the color to <code class="literal">green</code>. Lastly, there are two events: <code class="literal">mouseover</code> and <code class="literal">mouseout</code>. When the user hovers over the GeoJSON layer, the <code class="literal">newStyle()</code> function is called and the layer is colored green. As soon as the mouse moves off the layer, an anonymous function is called. This function uses the GeoJSON method, <code class="literal">resetStyle()</code>, to pass the target of the event—the GeoJSON layer—and changes the layer back to its original style.</p><p>Consider the following example code:</p><div><pre class="programlisting">function styleFunction(){return {color: "purple"}; }
function newStyle(){geoJsonLayer.setStyle({color:"green"});}
function oldStyle(){geoJsonLayer.setStyle({color:"purple"});}
var geoJsonLayer = L.geoJson(geojson,{style:styleFunction}).addTo(map);
geoJsonLayer.on('mouseover',newStyle);geoJsonLayer.on('mouseout',oldStyle);</pre></div><p>The preceding code first creates a function called <code class="literal">styleFunction()</code>, which is called in the fourth line of code using the <code class="literal">style</code> option as shown in the previous example. It sets the color of the GeoJSON layer to <code class="literal">purple</code>. Next, there are two other functions: <code class="literal">newStyle()</code> and <code class="literal">oldStyle()</code>. The former<a id="id152" class="indexterm"/> sets the color to <code class="literal">green</code> and the latter returns the color back to the original <code class="literal">purple</code>. Lastly, there are two events that call the<a id="id153" class="indexterm"/> style functions: <code class="literal">mouseover</code> and <code class="literal">mouseout</code>. When the user hovers over the GeoJSON layer, the <code class="literal">newStyle()</code> function is called and the layer is colored <code class="literal">green</code>. As soon as the mouse moves off the layer, <code class="literal">oldStyle()</code> is called and the color is set back to <code class="literal">purple</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Iterating through the features</h2></div></div></div><p>In Leaflet.js, you can iterate<a id="id154" class="indexterm"/> through the features in a<a id="id155" class="indexterm"/> GeoJSON file and perform actions on it before it is added to the map. This can be done with the <code class="literal">onEachFeature</code>, <code class="literal">pointToLayer</code>, or <code class="literal">filter</code> option.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Attaching pop ups with onEachFeature</h3></div></div></div><p>The GeoJSON layer in Leaflet.js has an<a id="id156" class="indexterm"/> <code class="literal">onEachFeature</code> option, which<a id="id157" class="indexterm"/> is called for every feature in the data. This can be used to bind a pop up to each feature as it is added to the map. The following code uses the onEachFeature option to bind a pop up:</p><div><pre class="programlisting">L.geoJson(geojson, {
onEachFeature: function(feature,layer) {
layer.bindPopup(feature.properties.title);
    }
}).addTo(map);</pre></div><p>In the preceding code, an anonymous function is called on each feature. The function binds a pop up in line three with the value of the feature's <code class="literal">title</code> property. You can select any one of a feature's properties using <code class="literal">feature.properties.NameOfProperty</code>. The result is shown in the following screenshot:</p><div><img src="img/4812OS_02_06.jpg" alt="Attaching pop ups with onEachFeature"/></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec05"/>Creating layers from points with pointToLayer</h3></div></div></div><p>The <code class="literal">pointToLayer</code> option works<a id="id158" class="indexterm"/> with points, as they<a id="id159" class="indexterm"/> are handled differently as compared to polylines and polygons. In the following code, a marker is created and styled for each feature based on the name of the feature:</p><div><pre class="programlisting">var options2 = {
draggable: false,
title: "A point near Moriarty and I40"
};
var x;
var y;
L.geoJson(geojsonFeature, {
pointToLayer: function(feature,latlng) {
switch (feature.properties.name) {
case "My Point": x = L.marker(latlng,{draggable:true,title:"A point at the
   Big I"}).bindPopup(feature.properties.name); return x;
case "My Other Point":  y = 
L.marker(latlng,options2).bindPopup(feature.properties.name); 
return y;
        }
    }
}).addTo(map); </pre></div><p>The preceding code starts by creating a JSON variable that holds the style information. Next, the layers on which the markers will be created are created as <code class="literal">x</code> and <code class="literal">y</code>. Then, the GeoJSON layer is created and the<a id="id160" class="indexterm"/> <code class="literal">pointToLayer</code> option is called with an anonymous function. The function has a <code class="literal">switch</code> statement that styles the markers based on their <code class="literal">name</code> property. The first <code class="literal">case</code> statement has the property information added at the creation of the marker. The<a id="id161" class="indexterm"/>  second <code class="literal">case</code> statement passes the JSON variable with the style information. Both work, so if you have a style that you want to apply to all your features, you can write it once in a variable and call it during the creation of the marker. Because the code assigned the layers to variables <code class="literal">x</code> and <code class="literal">y</code>, you can add or remove layers using <code class="literal">map.removeLayer(x)</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Displaying a subset of data with filter</h3></div></div></div><p>There might be times when you <a id="id162" class="indexterm"/>load in GeoJSON from an outside source and you do not want to display all the features in the data. Filtering will allow you to not display certain features based on<a id="id163" class="indexterm"/> criteria that you set. Modifying the <code class="literal">case</code> statement in the previous point-to-layer example, you will learn how to filter data based on the name of the feature. The following code shows you how to do this:</p><div><pre class="programlisting">L.geoJson(geojsonFeature, {
filter: function(feature,latlng) {
switch (feature.properties.name) {
case "My Point": return true;
case "My Other Point":  return false;
        }
    }
}).addTo(map);</pre></div><p>The preceding code should look similar to the previous examples. You create the GeoJSON layer and then pass the <code class="literal">filter</code> option. The option uses an anonymous function. The function, in this case, is a <code class="literal">switch</code> statement that takes the name of the feature as a parameter. Since the function is deciding on whether or not to display a feature, the return value is a Boolean. In this example, if the name of the feature is <code class="literal">My Other Point</code>, it will not be displayed. The following screenshot shows you the result; only one marker is added to the map:</p><div><img src="img/4812OS_02_07.jpg" alt="Displaying a subset of data with filter"/></div></div></div></div></div>


  <div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Summary</h1></div></div></div><p>In this chapter, you learned how to add and style a GeoJSON layer in Leaflet.js. Finally, you learned how to iterate through the features in a GeoJSON file and perform an action such as binding a pop up or applying a style based on a property in the feature. GeoJSON is a popular and common data format. Knowing how to use it in Leaflet.js is an important skill. This chapter gave you a solid foundation with which you can continue to learn about GeoJSON.</p><p>In the next chapter, you will learn how to create heatmaps using several available plugins.</p></div></div>
</body></html>