<html><head></head><body>
		<div><h1 id="_idParaDest-46" class="chapter-number"><a id="_idTextAnchor054"/>3</h1>
			<h1 id="_idParaDest-47"><a id="_idTextAnchor055"/>Cybernetic Enhancements – WebdriverIO Config and Debug Tips</h1>
			<p>In this chapter, we are going to cover the techniques for creating and debugging a custom WebdriverIO framework. This will take us through the services that help keep the project up to date. A lot of files get used and interact with each other in the project. Helpers and other features will be added to help enhance the framework as well as make debugging easier. We will cover the node files of the framework and demonstrate the differences between launching tests on Mac and Windows operating systems. We will also create our first hook customization for debugging on a single monitor. Lastly, we will write our first log wrapper to take more control over the output in the console window to improve debugging efficiency by customizing logging.</p>
			<p>Specifically, these are our main topics for this chapter:</p>
			<ul>
				<li>Main files of WebdriverIO node project</li>
				<li>Letting Yarn help keep files up to date</li>
				<li>Dynamic configuration</li>
				<li>The <code>global.log()</code> method</li>
				<li>Rules to enforce the coding standard</li>
			</ul>
			<h1 id="_idParaDest-48"><a id="_idTextAnchor056"/>The three main files of a WebdriverIO node project</h1>
			<p>A lot of<a id="_idIndexMarker125"/> files are added while following the WDIO configuration. This is a good time to walk through the project roadmap to get familiar with the features of and relationships between these files, beginning with these three:</p>
			<ul>
				<li><code>package.json</code></li>
				<li><code>yarn.lock</code></li>
				<li><code>wdio.config.ts</code></li>
			</ul>
			<p>Let’s look at each one in order of execution.</p>
			<h2 id="_idParaDest-49"><a id="_idTextAnchor057"/>The package.json file</h2>
			<p>The first configuration file we will<a id="_idIndexMarker126"/> discuss is<a id="_idIndexMarker127"/> the <code>package.json</code> file. It helps manage the project’s dependencies and provides a way to run scripts and access other information about the project. This file serves several purposes:</p>
			<ul>
				<li>It can specify scripts that can be run from the command line. For example, a WebdriverIO project might include a <code>wdio</code> script that starts the Webdriver server and a <code>wdio-docker</code> script configured specifically to run on a Docker container instance.</li>
				<li>It specifies the project’s dependencies, which are packages that the project needs to function properly. For example, a Webdriver project will depend on the <code>expect-wdio</code> package for validations. We won’t have to worry about dependency conflicts of all these packages. Yarn provides an interactive upgrade mode when you use the upgrade command with the --interactive or -i flag. The interactive upgrade mode allows you to select which packages to upgrade. When running &gt;yarn upgrade-interactive, Yarn will display a list of outdated packages and prompt to choose which ones to upgrade. Yarn respects the version ranges specified in your package.json file when determining the versions to be upgraded.</li>
				<li>It can specify <code>devDependencies</code>, which are packages that are needed for developers, but not necessarily for execution. For example, a WebdriverIO project will depend on the <code>@wdio/cli</code> package. Again, the <code>node-check-version</code> utility will keep the versions in sync.</li>
				<li>It can include<a id="_idIndexMarker128"/> metadata about the project, such as the project’s name, version, and authors:<pre class="source-code">
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    "wdio": "wdio run test/wdio.conf.ts",
    "debug": "cross-env set DEBUG=true &amp;&amp; wdio run test/wdio.conf.ts",
    "report": "cross-env DEBUG=false wdio run test/wdio.conf.ts &amp;&amp; allure generate report allure-results --clean &amp;&amp; allure open",
    "wdio-docker": "DEBUG=false wdio run test/wdio.conf.ts &amp;&amp; allure generate report allure-results --clean"
  },
  "devDependencies": {
    "@types/jasmine": "^4.3.0",
    "@wdio/allure-reporter": "^7.26.0",
    "@wdio/cli": "^7.27.0",
    "@wdio/jasmine-framework": "^7.26.0",
    "@wdio/local-runner": "^7.27.0",
    "@wdio/mocha-framework": "^7.26.0",
    "@wdio/spec-reporter": "^7.26.0",
    "ts-node": "^10.9.1",
    "typescript": "^4.9.3",
  },
  "dependencies": {
    "expect-webdriverio": "^3.0.0"
  }
}</pre></li>			</ul>
			<p>The <code>package.json</code> file <a id="_idIndexMarker129"/>also contains the <code>"scripts"</code> schema. This is where we can create custom-run <a id="_idIndexMarker130"/>configuration shortcuts. For example, to run a test at the<a id="_idIndexMarker131"/> command prompt, we can use <code>npx</code>) with the <code>wdio</code>) package and provide the path to the WebdriverIO configuration file:</p>
			<pre class="console">
&gt;npx wdio run ./wdio.conf.js</pre>			<p>At installation, WebdriverIO includes a <code>wdio run</code> configuration in the <code>scripts</code> package schema:</p>
			<pre class="source-code">
    "scripts": {
        "wdio": "wdio wdio.conf.ts"
    }</pre>			<p>We can implicitly run the <a id="_idIndexMarker132"/>node executor from the package manager with the <code>wdio</code> shortcut:</p>
			<pre class="source-code">
yarn wdio</pre>			<p>We can now add a shortcut for running the <code>A</code><code>llure</code> report from the previous chapter:</p>
			<pre class="source-code">
    "scripts": {
        "wdio": "wdio wdio.conf.ts"
   "report": "allure generate --clean allure-results &amp;&amp; allure open"
    }</pre>			<p>The command line to run the test and generate the report is now reduced to the following:</p>
			<pre class="source-code">
yarn wdio
yarn report</pre>			<p>In <a href="B19395_13.xhtml#_idTextAnchor247"><em class="italic">Chapter 13</em></a>, this will come into play again as we run tests on multiple browsers. For now, let’s take a look brief look at all the different packages.</p>
			<h2 id="_idParaDest-50"><a id="_idTextAnchor058"/>The yarn.lock file</h2>
			<p>This file tracks all the external supporting <a id="_idIndexMarker133"/>packages brought in by the <code>package.json</code> file that are stored in the <code>node_modules</code> folder. If the same version of a package has already been detected as downloaded, the node will skip it for efficiency. This file is extensive and since it is rebuilt each time <code>yarn add</code> is executed, it never needs to be modified manually.</p>
			<p>Next, we’ll cover the heart of WebdriverIO.</p>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor059"/>The wdio.conf.ts file and webhooks</h2>
			<p>This file is where all the WDIO package features are configured. It includes webhooks – code that executes <a id="_idIndexMarker134"/>automatically at certain points of the<a id="_idIndexMarker135"/> framework. This saves us from rewriting code repeatedly. This code can be injected before or after every session, suite, test, WebdriverIO command, or even every hook. All the default features are documented inside each hook, ready to be modified. Let’s take, for example, the <code>beforeTest</code> code:</p>
			<pre class="source-code">
  /**
   * Function to be executed before a test (in Mocha/Jasmine) starts.
   */
  // beforeTest: function (test, context) {
  // },</pre>			<p>By uncommenting the <code>beforeTest</code> hook function, we can customize the functionality of WebdriverIO. This is just for running on the local machine where there is limited space on a small monitor. For example, we can maximize the browser’s full screen before each test:</p>
			<pre class="source-code">
beforeTest: function (test, context) {
    browser.maximizeWindow();
},</pre>			<h1 id="_idParaDest-52"><a id="_idTextAnchor060"/>Rule of thumb – match your developer’s hardware</h1>
			<p>Here is a good reason to request a second monitor. We just expanded our browser at runtime to full screen. If we only have a single monitor, this will completely block our <strong class="bold">Visual Studio Code</strong> (<strong class="bold">VS Code</strong>) window from view. To be efficient, we need to see the Terminal<a id="_idIndexMarker136"/> window in VS Code on an external monitor while the test executes in full screen mode on the primary monitor.</p>
			<p>But if you only have a single monitor, this is a simple trick you can implement in the webhooks of the <code>wdio.config.ts</code> file: set the browser height to three-quarters of the display resolution. First, get the current display’s height and width by going to <strong class="bold">Settings</strong> and then <strong class="bold">Display</strong> on Windows:</p>
			<div><div><img src="img/B19395_Figure_3.1.jpg" alt="Figure 3.1 – Primary display resolution on Windows"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Primary display resolution on Windows</p>
			<p>On Mac, go to the <strong class="bold">Apple</strong> menu and select <strong class="bold">About this Mac</strong> &gt; <strong class="bold">Displays</strong>:</p>
			<div><div><img src="img/B19395_Figure_3.2.jpg" alt="Figure 3.2 – Primary display resolution on Mac"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – Primary display resolution on Mac</p>
			<p>Multiply the height of the display by 0.75. In the <code>wdio.conf.ts</code> file, uncomment the <code>beforeTest()</code> method. Enter the width and reduced height values (in this example, <code>970</code>) in the <code>browser.setWindow</code> method, as follows:</p>
			<pre class="source-code">
beforeTest: function (test, context) {
    // VS Code Terminal visible on the bottom of the screen
    browser.setWindowSize(1920, 970)
},</pre>			<p>This way, you can have the best of both worlds on a single monitor, as shown in the following screenshot:</p>
			<div><div><img src="img/B19395_Figure_3.3.jpg" alt="Figure 3.3 – Running a custom-sized browser with the Terminal log below on a single monitor"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Running a custom-sized browser with the Terminal log below on a single monitor</p>
			<p>You can read more about the hooks of WebdriverIO in the online documentation at <a href="https://webdriver.io/docs/options/#hooks">https://webdriver.io/docs/options/#hooks</a>. Since this is a TypeScript project, it requires some configuration as well.</p>
			<p>The <code>tsconfig.json</code> file<a id="_idIndexMarker137"/> configures TypeScript compiler options for the node. It includes the framework that will be used and includes the WebdriverIO <code>expect</code> library for assertions. This is where we can change the ECMAScript target version so that it matches the node version:</p>
			<pre class="source-code">
{
    "compilerOptions": {
        "moduleResolution": "node",
        "types": [
            "node",
            "webdriverio/async",
            "@wdio/jasmine-framework",
            "expect-webdriverio"
        ],
        "target": "es2022"
    }
}</pre>			<p>The <code>es2022</code> target is ECMAScript version 10. The correlation of ECMAScript version names and features can be found at <a href="https://en.wikipedia.org/wiki/ECMAScript">https://en.wikipedia.org/wiki/ECMAScript</a> and the correlation of <code>node</code> to ECMAScript versions is found at <a href="https://node.green/">https://node.green/</a>.</p>
			<p>The <code>test/spec</code> folder <a id="_idIndexMarker138"/>is the location of the test scripts to execute. Subfolders can help divide tests into categories. It is recommended not to get too deep with these folder structures as it makes relative paths difficult to keep track of.</p>
			<p>The <code>test/pageObjects</code> folder holds <a id="_idIndexMarker139"/>the page object module that’s used to find and populate elements.</p>
			<p>Finally, the <code>node_modules</code> folder keeps all the supporting packages that are downloaded to support the node project.</p>
			<p>The Chrome browser is always getting updated. Next, we need to ensure the project resources stay current. WebdriverIO has a service to do just that.</p>
			<h1 id="_idParaDest-53"><a id="_idTextAnchor061"/>Letting Yarn help keep files up to date</h1>
			<p>Just as the Yarn upgrade-interactive tool has<a id="_idIndexMarker140"/> to keep all the supporting packages current, WebdriverIO provides the ChromeDriver service to keep up with constant Chrome updates. We can install the service from the console by running this command:</p>
			<pre class="console">
yarn add wdio-chromedriver-service</pre>			<p>Then, it must be configured in the <code>wdio.config.ts</code> file. To do so, find the following:</p>
			<pre class="source-code">
    services: ['chromedriver'],</pre>			<p>Replace it with this:</p>
			<pre class="source-code">
    outputDir: 'all-logs',
    services: [
        ['chromedriver', {
            args: ['--silent']
        }]
    ],</pre>			<p>Finally, the <code>all-logs</code> folder should <a id="_idIndexMarker141"/>be added to the <code>.gitignore</code> file. Now, let’s cover some debugging tips.</p>
			<h1 id="_idParaDest-54"><a id="_idTextAnchor062"/>Configuring debugging with VS Code</h1>
			<p>VS Code supplies four <a id="_idIndexMarker142"/>command prompt shells to launch scripts. Which one you use depends on your operating system. For Windows, there is PowerShell, Git Bash, Command Prompt, and the JavaScript debug terminal. Mac includes the ZSH shell:</p>
			<div><div><img src="img/B19395_Figure_3.4.jpg" alt="Figure 3.4 – VS Code debugging controls and shell terminals on Windows"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – VS Code debugging controls and shell terminals on Windows</p>
			<p>Here’s how it look<a id="_idIndexMarker143"/>s on Mac:</p>
			<div><div><img src="img/B19395_Figure_3.5.jpg" alt="Figure 3.5 – VS Code debugging controls and shell Terminals on Mac"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – VS Code debugging controls and shell Terminals on Mac</p>
			<p>Script execution stops when a breakpoint is entered in the code by clicking in the gutter to the left of a line number, as seen on line 9. This will attach a debugger and a control panel. From the panel, the code execution can continue, step over a method call, step into the method, step out back up to the calling code, or restart or disconnect the debugging session.</p>
			<p>The JavaScript debug <a id="_idIndexMarker144"/>terminal always attaches the debugger. Debug mode slows the execution. So, for Mac, a practical choice would be to have two shells open: the JavaScript debug terminal and ZSH for faster non-debug execution. Any shell can have debugging activated with auto attach:</p>
			<p class="IMG---Figure"> </p>
			<div><div><img src="img/B19395_Figure_3.6.jpg" alt="Figure 3.6 – Command palette options to auto attach the debugger"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Command palette options to auto attach the debugger</p>
			<p>PowerShell, Git Bash, ZSH, and Command Prompt must have the debugging configuration enabled by setting <strong class="bold">Auto Attach</strong> to <strong class="bold">Always</strong> from the Command Palette. It can be disabled temporarily from the VS Code status bar:</p>
			<div><div><img src="img/B19395_Figure_3.7.jpg" alt="Figure 3.7 – Auto Attach mode can be temporarily disabled from the status bar at the bottom of VS Code"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – Auto Attach mode can be temporarily disabled from the status bar at the bottom of VS Code</p>
			<p>At this point, we<a id="_idIndexMarker145"/> can further customize our framework by passing <strong class="bold">environment variables</strong>. In Mac, this is easy with any Terminal:</p>
			<pre class="source-code">
&gt; DEBUG=true yarn wdio</pre>			<p>Windows makes this tricky. To add a variable such as <code>DEBUG</code>, each shell has a separate syntax for multiple-line execution. Here’s the list:</p>
			<ul>
				<li>Git Bash:<pre class="source-code">
&gt; set DEBUG=false &amp;&amp; yarn wdio</pre></li>				<li>PowerShell and JavaScript debug terminal:<pre class="source-code">
&gt; set DEBUG=false; yarn wdio</pre></li>				<li>Command Prompt and ZSH (Mac):<pre class="source-code">
&gt; DEBUG=true yarn wdio</pre></li>			</ul>
			<p>Furthermore, the syntax for this is different in package shortcuts:</p>
			<ul>
				<li>Mac:<pre class="source-code">
"debug": "DEBUG=true wdio run test/wdio.conf.ts",</pre></li>				<li>Windows:<pre class="source-code">
"debug": "set DEBUG=true &amp;&amp; wdio run test/wdio.conf.ts",</pre></li>			</ul>
			<p>If you have a mix of Mac <a id="_idIndexMarker146"/>and Windows team members, the situation may look dire. But superheroes have sidekicks and Node is no exception.</p>
			<p class="callout-heading">Rule of thumb – the cross-env node package</p>
			<p class="callout">To <a id="_idIndexMarker147"/>resolve all this, we will install the <code>cross-env</code> package:</p>
			<p class="callout"><code>yarn </code><code>add cross-env</code></p>
			<p class="callout">By adding the <code>cross-env</code> package, we now can create a new debug shortcut that runs with a common syntax on both Mac and Windows:</p>
			<p class="callout"><code>debug: cross-env DEBUG=true </code><code>wdio wdio.conf.ts</code></p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor063"/>browser.debug()</h2>
			<p>Another way to debug <a id="_idIndexMarker148"/>our code is to add the <code>browser.debug()</code> statement:</p>
			<div><div><img src="img/B19395_Figure_3.8.jpg" alt="Figure 3.8 – Pausing execution in VS Code with browser.debug()"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Pausing execution in VS Code with browser.debug()</p>
			<p>By default, WebdriverIO will pause the execution, but it is limited by the default timeout interval <a id="_idIndexMarker149"/>of our framework. For Jasmine, the default is about 1 minute. However, we need more time for debugging when an error occurs. By setting <code>defaultTimeoutInterval</code> to 15,000,000 milliseconds (about 4 hours), the script will have more time to debug any issues:</p>
			<pre class="source-code">
jasmineOpts: {
  defaultTimeoutInterval: 15_000_000,</pre>			<p>Of course, we do not want to change this value back and forth manually, particularly if we’re running in a cloud environment. This can be handled with our next superpower.</p>
			<h1 id="_idParaDest-56"><a id="_idTextAnchor064"/>Dynamic configuration</h1>
			<p>Dynamic configuration means we can change the way the framework behaves by assigning system variables and <a id="_idIndexMarker150"/>passing them to our framework. These variables follow the <code>ALL_CAPS</code> naming convention of a constant. Let’s begin by assigning a timeout based on the value of a <code>DEBUG</code> environment variable. At the top of the <code>config</code> file, we will capture the value of the <code>DEBUG</code> environment variable:</p>
			<pre class="source-code">
const DEBUG = (process.env.DEBUG<a id="_idTextAnchor065"/> === undefined) ? false : (process.env.DEBUG === `true`)</pre>			<p>This sets a default of <code>false</code> if <code>DEBUG</code> is not explicitly defined. Now, we can have a variable that extends the framework timeout when we explicitly execute a debug shortc<a id="_idTextAnchor066"/>ut:</p>
			<pre class="source-code">
let timeout = DEBUG ? 10_000 : 16_000_000</pre>			<p class="callout-heading">Rule of thumb</p>
			<p class="callout">Make your code readable with numeric separators. TypeScript supports underscores in place of commas with both integer and floating-point numbers. This makes <code>16_000_000</code> a valid integer while making the code more readable to humans.</p>
			<p>We can find the timeout under <code>jasmineOpts</code>. Let’s reference this new timeout variable. Find the following code:</p>
			<pre class="source-code">
jasmineOpts: {
defaultTimeoutInterval: 10000,</pre>			<p>Change it to the following:</p>
			<pre class="source-code">
jasmineOpts: {
defaultTimeoutInterval: timeout,</pre>			<p>You may consider setting the <code>DEBUG</code> default to <code>True</code> when it’s omitted in a shortcut, then explicitly turning it off when run in a CI/CD environment such as Docker from Jenkins:</p>
			<pre class="source-code">
const DEBUG = (process.env.DEBUG<a id="_idTextAnchor067"/> === undefined) ? true : (process.env.DEBUG === `true`)</pre>			<p>The reason is that we spend most of our time writing and debugging our code is spent running the test. This means <a id="_idIndexMarker151"/>we spend less time typing this over and over to launch a test:</p>
			<pre class="source-code">
DEBUG=true yarn wdio</pre>			<p>This just extend timeouts when run locally:</p>
			<pre class="source-code">
yarn wdio</pre>			<p>Then, we can have the <code>debug</code> switch implicit in the shortcut and explicit for CI/CD:</p>
			<pre class="source-code">
     "scripts": {
        "wdio": "wdio wdio.conf.ts"
        "debug": "DEBUG=true wdio wdio.conf.ts"
        "wdio-docker": "DEBUG=false wdio wdio.conf.ts"
    }</pre>			<p>In future chapters, we will execute tests in Docker. In those cases, we do not want our tests to wait several hours while we debug an error. In this script, we will change <code>DEBUG</code> to <code>false</code>; the test will use a short timeout specifically with that in mind:</p>
			<pre class="source-code">
yarn wdio-docker</pre>			<p>Question: who is the customer of the automation framework? You might think it is the stakeholders, but not really. The stakeholders are the beneficiaries with pretty alluring graphs. Your team is the one who works with the framework every day. This means you are the customer. Prioritize your framework features with standards that help you to be efficient in your day-to-day work, not the whims of your benefactors.</p>
			<p>You can read more about <a id="_idIndexMarker152"/>dynamic configurations here: <a href="https://webdriver.io/docs/debugging/#dynamic-configuration">https://webdriver.io/docs/debugging/#dynamic-configuration</a>.</p>
			<p>Whil<a id="_idTextAnchor068"/>e we are looking at the Jasmine options, we might consider automatically adding screen captures to the results if the test fails. These can be added to the following code:</p>
			<pre class="source-code">
expectationResultHandler
expectationResultHandler: function(passed, assertion) {
 /**
 * only take screenshot if assertion failed
 */
 if(passed) {
      return
 }
 browser.saveScreenshot(`assertionError_${assertion.error.message}.png`)
 }</pre>			<p>This will create a screen capture at the root of our project. Screen captures do not need to t<a id="_idTextAnchor069"/>ake up space in<a id="_idIndexMarker153"/> the Git repo. So, we will add them inside the <code>.gitIgnore</code> <code>*.</code><code>png</code> file.</p>
			<h2 id="_idParaDest-57"><a id="_idTextAnchor070"/>A note about template strings</h2>
			<p>You may <a id="_idIndexMarker154"/>have noticed that template <code>'strings'</code> with accent marks are being extensively used in these code examples. While <a id="_idIndexMarker155"/>TypeScript supports <code>'single'</code> quotes and <code>"double"</code> quotes for strings, template strings make more sense in a test automation project.</p>
			<p>Let’s say, for example, we wish to write this string to our console log:</p>
			<pre class="source-code">
Meet Dwane "The Rock" Johnson at Moe's tavern</pre>			<p>If we use quotes, we need to double escape the quotes in the string:</p>
			<pre class="source-code">
console.log("Meet ""Dwayne The Rock"" Johnson at Moe's  tavern")</pre>			<p>If we used single quotes, the apostrophe would need to be escaped with a backslash:</p>
			<pre class="source-code">
console.log('Meet Dwyane "The Rock" Johnson at Moe\'s  tavern')</pre>			<p>But with an accent template string, no escape is necessary:</p>
			<pre class="source-code">
console.log(`Meet Dwayne "The Rock" Johnson at Moe's tavern today`)</pre>			<p>Templated strings <a id="_idIndexMarker156"/>can also pass <code>${variables}</code> to make reporting far more flexible and descriptive:</p>
			<pre class="source-code">
let guest = `Dwayne "The Rock" Johnson`
let location = `Moe's tavern`</pre>			<p>Now, we can output <a id="_idIndexMarker157"/>a templated string to the console that is much easier to read than one with single or double quotes:</p>
			<pre class="source-code">
console.log(`Meet ${guest} at ${location} today`)</pre>			<p>Much of the purpose of custom reporting functions is to reduce noise during debugging.</p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor071"/>Reducing the signal-to-noise ratio</h2>
			<p>Now, we<a id="_idIndexMarker158"/> need to do some negative testing. Change the <code>ch3.ts</code> script so that it generates an error by adding <code>.not</code> to the <code>expect</code> validation chain:</p>
			<pre class="source-code">
await expect(SecurePage.flashAlert).not.toBeExisting();</pre>			<p>Now, when we run the code, we’ll get a lot of message details:</p>
			<pre class="source-code">
[0-0] 2022-11-28T09:14:03.160Z INFO webdriver: COMMAND findElements("css selector", "#flash")
[0-0] 2022-11-28T09:14:03.160Z INFO webdriver: [POST] http://localhost:9515/session/2e35b72bb526b5f0e346ba1379e4f5d9/elements
[0-0] 2022-11-28T09:14:03.161Z INFO webdriver: DATA { using: 'css selector', value: '#flash' }
[0-0] 2022-11-28T09:14:03.174Z INFO webdriver: RESULT [
[0-0]   {
[0-0]     'element-6066-11e4-a52e-4f735466cecf': 'd6b5d426-fbbb-4871-b190-94de4ef331cd'
[0-0]   }</pre>			<p>A lot of information is produced that is not all that insightful. Inside the  <code>wdio.config.ts</code> file, we can control how much detail is displayed in the console with <code>logLevel</code> settings:</p>
			<pre class="source-code">
// Level of logging verbosity: trace | debug | info | warn | error | silent
    logLevel: 'info',</pre>			<p>The order of options is listed<a id="_idIndexMarker159"/> in order of verbosity. The default of <code>'info'</code> can be overwhelming. Reducing it to <code>'warn'</code> is more adequate for our purposes.</p>
			<p>Our final debugging technique is to enhance the <code>console.log()</code> command with a wrapper.</p>
			<h1 id="_idParaDest-59"><a id="_idTextAnchor072"/>Our first custom wrapper method – global.log()</h1>
			<p>Question: what is a wrapper?</p>
			<p>A <a id="_idIndexMarker160"/>wrapper is a<a id="_idIndexMarker161"/> bespoke method or function that is almost identical in signature to an intrinsic <a id="_idIndexMarker162"/>method but with added functionality. In our first example, we will create a global wrapper for <code>console.log()</code>.</p>
			<p>While the <code>console.log()</code> method is good for outputting information to the console window, it can be enhanced and shortened. Let’s build our first <code>log()</code> wrapper at the end of the <code>wdio.config.ts</code> file:</p>
			<pre class="source-code">
/**
 * log wrapper
 * @param text to be output to the console window
 */
global.log = async (text: any) =&gt;  {
    console.log(`---&gt; ${text}`)
}</pre>			<p>This <code>global.log()</code> wrapper is almost identical to <code>console.log</code> except it has some text formatting that stands out. Let’s look at this by adding some examples to the test:</p>
			<pre class="source-code">
console.log (`Entering password`)
[0-0] Entering password
await global.log (`Entering password`)
[0-0] ---&gt; Entering password</pre>			<p>This way, we can separate the custom messages being added to the framework from what is being generated by the Jasmine and node reporting output.</p>
			<p class="callout-heading">Rule of thumb</p>
			<p class="callout">Even when a function has only one line, use curly brackets. There are two reasons for this. First, it makes logic branch issues easier to spot. Second, when adding brackets, there is a good chance you will soon add more lines of code.</p>
			<p>Let’s say we want to<a id="_idIndexMarker163"/> ignore empty strings and nulls passed to the log. When written as a single line of code, the intention is not very clear:</p>
			<pre class="source-code">
global.log = async (text: any) =&gt; {
    if (text) console.log(`---&gt; ${text}`)
}</pre>			<p>But with the brackets in place, the logic looks much clearer:</p>
			<pre class="source-code">
global.log = async (text: any) =&gt; {
    if (text) {
        console.log(`---&gt; ${text}`)
    }
}</pre>			<p>This follows the lines of the second reason we mentioned in the <em class="italic">Rule of thumb</em> box – you will soon add more lines of code. The preceding code would be better if we knew when an unresolved promise was passed to the log and what line had the issue. So, we will add an exception for <code>Promise</code> objects and display the console trace to show the line:</p>
			<pre class="source-code">
global.log = async (text: any) =&gt; {
    if (text) //truthy value check
    {
        if (text===Promise){
            console.log(`---&gt;     WARN: Log was passed a Promise object`)
            console.trace()
        }else{
            console.log(`---&gt; ${text}`)
        }
    }
}</pre>			<p>Question: why is the text assigned a type of <code>any</code> and not <code>string</code>?</p>
			<p>In most cases, we will declare the type of the argument in TypeScript. That’s the whole point of using it over<a id="_idIndexMarker164"/> JavaScript. But in this case, we want to have our debugging be a little more robust. We will add six log examples to the <code>ch3.ts</code> script:</p>
			<pre class="source-code">
describe(' Ch3: Cybernetic Enhancements', () =&gt; {
    it(should give detailed report and resize browser', async () =&gt; {
        await LoginPage.open();
        console.log (`Entering password`) // Intrinsic Log
        await global.log (`Entering password`) // Custom
        await global.log (``) // Does not print
        await global.log (null) // Does not print
        await global.log (Promise) // Adds trace
        await LoginPage.login('tomsmith', 'SuperSecretPassword!');
        await expect(SecurePage.flashAlert).toBeExisting();
        await expect(SecurePage.flashAlert).toHaveTextContaining(
            'You logged into a secure area!');
    });
});</pre>			<p>With that, we have added our own level of detail that stands out. It skips empty and null strings. It also gives line <a id="_idIndexMarker165"/>numbers of where issues such as unresolved <code>Promise</code> originated:</p>
			<pre class="source-code">
[0-0] Entering password
[0-0] ---&gt; Entering password
[0-0] ---&gt;     WARN: Log was passed a Promise object
[0-0] Trace
[0-0]     at global.log (D:\repos\Test-Automation-with-WebdriverIO\test\wdio.conf.ts:379:21)
[0-0]     at UserContext.&lt;anonymous&gt; (D:\repos\wdio\test\specs\ch3.ts:13:22)
...
[0-0] PASSED in chrome - D:\repos\wdio\test\specs\ch3.ts</pre>			<p>Running this code gives us more flexibility in logging what our framework is doing. We have one last topic to discuss to ensure we write good code.</p>
			<h1 id="_idParaDest-60"><a id="_idTextAnchor073"/>Rules to enforce coding standards</h1>
			<p>Every coding project <a id="_idIndexMarker166"/>should have a document that states what coding rules will be enforced during a code review. Tools called “linters” are good<a id="_idIndexMarker167"/> at detecting these rules. They need to be activated at the start of a project to ensure everyone is on the same page. Several rules can be activated in a TypeScript <a id="_idIndexMarker168"/>project. The first is called <strong class="bold">strict mode</strong>.</p>
			<h2 id="_idParaDest-61"><a id="_idTextAnchor074"/>Strict mode</h2>
			<p>JavaScript has a strict mode feature. Adding <code>"use strict"</code> as the first line of a JavaScript source file<a id="_idIndexMarker169"/> enables extra rules to ensure good coding practices are followed that avoid subtle code errors.</p>
			<p>This includes forcing variables to be explicitly declared with a <code>let</code>, <code>var</code>, or <code>const</code> keyword. TypeScript has a similar strict mode that can further force all variables to be assigned a type, such as <code>string</code>, <code>number</code>, or <code>boolean</code>. This is to avoid implicitly assigning a variable to the <code>any</code> type, which can lead to type coercion issues:</p>
			<div><div><img src="img/B19395_Figure_3.9.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> </p>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – A strict mode warning where text is implicitly declared to be of the any type</p>
			<p>In the preceding example, the <code>text</code> variable is implicitly assumed to be of the <code>any</code> type because no type assignment was provided for the <code>text</code> variable:</p>
			<pre class="source-code">
global.log = async (text) =&gt;</pre>			<p>With strict mode enabled, three dots appear under the <code>text</code> argument. Hovering the mouse over these dots reveals the issue description. It also includes the possibility for VS Code to suggest a quick fix that will infer the parameter type from usage:</p>
			<pre class="source-code">
global.log = async (text: any) =&gt;</pre>			<p>In a new TypeScript project, strict rules should be enabled from the start. These rules are enabled by adding them under the <code>"compiler options"</code> section of the <code>tsconfig.json</code> file. This rule enables all subset rules listed:</p>
			<pre class="source-code">
"compiler options": {
"strict": true,
...</pre>			<p>However, turning on all<a id="_idIndexMarker170"/> rules in an existing project will likely create<a id="_idIndexMarker171"/> so much code to refactor that it causes significant delays in test creation. In that case, subsets of strict rules can be enabled and refactored over time.</p>
			<h2 id="_idParaDest-62"><a id="_idTextAnchor075"/>Turning on individual TypeScript subset rule checks</h2>
			<p>Here is a list of the rules that can be enabled or disabled under the strict mode coding standards umbrella.</p>
			<h3>“noImplicitAny”: true</h3>
			<p>This rule raises an error on<a id="_idIndexMarker172"/> expressions and declarations with an implied <code>any</code> type. In the following example, the <code>x</code> and <code>y</code> variables are implicitly set to the <code>any</code> type. Thus, if a string is passed, the code will coerce the number into a string and concatenate values rather than adding them:</p>
			<pre class="source-code">
function add(x, y) {
  return x + y;
}
const result = add(10, '20');
console.log(result); // '1020'</pre>			<p>The following code resolves this issue by explicitly assigning the type of <code>x</code> and <code>y</code> to a <code>number</code> type. The only types of variables to be passed now are numbers, not strings:</p>
			<pre class="source-code">
function add(x: number, y: number) {
  return x + y;
}
const result = add(10, 20);
console.log(result); // 30</pre>			<h3>“strictNullChecks”: true</h3>
			<p>This rule raises an error when variables are implicitly assigned a <code>null</code> value. This can cause issues when an empty<a id="_idIndexMarker173"/> string is a valid variable but a <code>Null</code> value is passed, throwing an error.</p>
			<h3>“strictFunctionTypes”: true</h3>
			<p>This rule will enable strict checking of function parameter types. Take this code as an example:</p>
			<pre class="source-code">
const multiply = function(x: number, y: number) { return x * y; };</pre>			<p>To fix this error, you would need to annotate the type of the <code>multiply</code> function:</p>
			<pre class="source-code">
const multiply: (x: number, y: number) =&gt; number = function(x, y) {
  return x * y;
};</pre>			<h3>“strictBindCallApply”: true</h3>
			<p>This rule forces strict <code>bind</code>, <code>call</code>, and <code>apply</code> methods on functions. This is beyond the scope of the techniques that will be covered in this book.</p>
			<h4>bind()</h4>
			<p>The <code>bind()</code> function creates a<a id="_idIndexMarker174"/> new function with a specific value for this. It takes the value you want to use for this as the first argument; any additional arguments are passed to the original function when it is called. Here’s an example:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string = 'hello';
  public someMethod() {
    setTimeout(function() {
      console.log(this.myProperty); // 'this' is not properly bound to                                     // an object
    }, 1000);
  }
}</pre>			<p>In the <a id="_idIndexMarker175"/>preceding example, the <code>someMethod()</code> method contains an anonymous function <a id="_idIndexMarker176"/>that uses the <code>this</code> keyword to access a property on the current object. However, the <code>this</code> keyword is not properly bound to the object:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string = 'hello';
  public someMethod() {
    setTimeout(function() {
      console.log(this.myProperty);
    }.bind(this), 1000);
  }
}</pre>			<p>In the preceding code, the error has been resolved by binding the <code>this</code> keyword to the current object using the <code>bind()</code> function.</p>
			<h4>call()</h4>
			<p>The <code>call()</code> function<a id="_idIndexMarker177"/> is similar to <code>bind()</code>, but it calls the original function immediately, rather than creating a new function. It takes the value you want to use for <code>this</code> as the first argument; any additional arguments are passed to the original function when it is called:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string = 'hello';
  public someMethod() {
    const greeting = 'Hello';
    console.log(greeting.call(this, greeting)); // error: 'call' is                                                 // not a function
  }
}</pre>			<p>In this example, the <code>someMethod()</code> method calls the <code>call()</code> function on a<a id="_idIndexMarker178"/> string value (greeting). However, the <code>call()</code> function can only be called on functions, so this will cause an error when the code is executed.</p>
			<p>If you have the <code>strictBindCallApply</code> rule enabled, ESLint will catch this error and alert you to the issue. To fix the error, call the <code>call()</code> function on a function, rather than a string:</p>
			<pre class="source-code">
  public greet(greeting: string) {
    console.log(`${greeting}, ${this.name}`);
  }
  public someMethod() {
    const greeting = 'Hello';
    this.greet.call(this, greeting); // calls the greet() method with                                      // a specific value for 'this'
  }
}</pre>			<h4>apply()</h4>
			<p>The <code>apply()</code> function<a id="_idIndexMarker179"/> is similar to <code>call()</code>, but it takes the arguments to pass to the original function as an array<a id="_idIndexMarker180"/> rather than a list of separate arguments. It takes the value you want to use for <code>this</code> as the first argument, and the array of arguments as the second argument:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string = 'hello';
  public someMethod() {
    const greeting = 'Hello';
    console.log(greeting.apply(this, greeting)); // error: 'apply' is not a function
  }
}</pre>			<p>In the preceding example, the <code>someMethod()</code> method calls the <code>apply()</code> function on a <code>(`greeting`)</code> string value. However, the <code>apply()</code> function can only be called on functions, so this will cause an error when the code is executed:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string = 'hello';
  public greet(greeting: string) {
    console.log(`${greeting}, ${this.name}`);
  }
  public someMethod() {
    const greeting = 'Hello';
    this.greet.apply(this, [greeting]); // calls the greet() method with a specific value for 'this'
  }
}</pre>			<p>The preceding code shows<a id="_idIndexMarker181"/> how to fix the error by calling the <code>apply()</code> function on a function, rather than a string:</p>
			<pre class="source-code">
"strictPropertyInitialization": true,</pre>			<p>This <a id="_idIndexMarker182"/>ESLint rule checks for properties that are declared in classes but are not initialized in the constructor. This rule can be used to enforce that all properties in a class are properly initialized before they are used:</p>
			<pre class="source-code">
class MyClass {
  public myProperty: string;
  constructor() {
    // myProperty is not initialized in the constructor
  }
  public someMethod() {
    console.log(this.myProperty.toUpperCase());
  }
}</pre>			<p>ESLint will throw an error when you try to lint the code because <code>myProperty</code> is not initialized in the constructor. To resolve this, assign <code>myProperty</code> to a string:</p>
			<pre class="source-code">
  public myProperty: string = "";</pre>			<h3>“noImplicitThis”: true</h3>
			<p>This raises an error on expressions with an implied <code>any</code> type. In TypeScript, the <code>this</code> keyword refers to the current instance of a class, and it is often used inside class methods to access properties or methods on the current object:</p>
			<pre class="source-code">
class MyClass { public myProperty: string = 'hello';
  public someMethod() {
    setTimeout(function() {
      console.log(this.myProperty);
      // 'this' is not properly bound to an object
    }, 1000);
  }
}</pre>			<p>ESLint will <a id="_idIndexMarker183"/>throw an error because the <code>this</code> keyword inside the anonymous function is not properly bound to an object. To fix this error, use an arrow function to bind the function to an object:</p>
			<pre class="source-code">
      setTimeout(() =&gt; { console.log(this.myProperty);
      // 'this' is now properly bound to the current object</pre>			<h3>“alwaysStrict”: true</h3>
			<p>This final rule ensures the TypeScript files add <code>use strict</code> to the first line. In truth, this instructs the compiler to create TypeScript in strict mode, even if the command is missing from the TypeScript file.</p>
			<h3>@ts-ignore directive</h3>
			<p>At the end of the day, you may need to tell the compiler to ignore a warning. For example, the custom <code>log()</code> function intentionally has the message assigned to the <code>any</code> type instead of <code>string</code>. This is to ignore null strings and catch unwrapped promises that are passed that can be traced back to a specific line of code:</p>
			<pre class="source-code">
// @ts-ignore
global.log = async (text: any) =&gt;  {
    console.log(`---&gt; ${text}`)
}</pre>			<p>It’s important to note <a id="_idIndexMarker184"/>that the <code>@ts-ignore</code> directive is only meant to be used as a temporary measure to help get past an error or warning while you’re working on your code. It’s not a good idea to use this directive to suppress errors or warnings extensively as it can lead to unsafe or unreliable code.</p>
			<p>The next question is, when will we ever have the time to refactor and document our framework when we are spending all our time writing test scripts?</p>
			<p class="callout-heading">Tip – “get it done” Friday</p>
			<p class="callout">The best way is to plan for refactoring as part of sprint activities. Agile projects have a daily standup meeting. Some teams choose to eliminate the Friday standup and specifically dedicate additional time to code cleanup, refactoring, and documentation. The idea is that our weekends should be our own with our families and not dedicated to working.</p>
			<p class="callout-heading">Leverage artificial intelligence</p>
			<p class="callout"><strong class="bold">GitHub Copilot</strong>: Developed <a id="_idIndexMarker185"/>by GitHub and OpenAI, it provides AI-powered code suggestions right in the editor. It’s like a pair programmer that helps you write code faster and learn new APIs and languages along the way.</p>
			<p class="callout"><strong class="bold">Tabnine</strong>: An <a id="_idIndexMarker186"/>AI code-completion tool that works with popular IDEs. It predicts and suggests the next chunk of code you might write and supports multiple programming languages.</p>
			<p class="callout"><strong class="bold">CodeGPT</strong>: A <a id="_idIndexMarker187"/>powerful and innovative AI-driven coding assistant developed by OpenAI. It builds upon the foundation of GPT-3, a state-of-the-art language model, and is specifically tailored to assist developers and programmers in their coding tasks.</p>
			<h2 id="_idParaDest-63"><a id="_idTextAnchor076"/>CodeGPT</h2>
			<p>CodeGPT is a <a id="_idIndexMarker188"/>revolutionary AI-powered code generation tool developed by OpenAI. It leverages the GPT-3.5 architecture to assist developers in creating code snippets, functions, and even entire programs in various programming languages, including TypeScript. This technology is a game-changer for developers as it can accelerate the coding process, enhance code quality, and help with debugging and problem-solving. With CodeGPT, you can quickly generate code examples, write unit tests, or even get suggestions on how to implement specific features, making it an invaluable addition to any developer’s toolkit.</p>
			<p>Here’s an <a id="_idIndexMarker189"/>example of how CodeGPT can assist with TypeScript code generation. Suppose you want to create a TypeScript function that calculates the factorial of a number. With CodeGPT, you can request a code snippet like this:</p>
			<pre class="source-code">
```typescript
function factorial(n: number): number {
  if (n &lt;= 1) {
    return 1;
  }
  return n * factorial(n - 1);
}
```</pre>			<p>CodeGPT generates <a id="_idIndexMarker190"/>the TypeScript code for the factorial function, which takes an input number, <code>n</code>, and recursively calculates its factorial. This is just one example of how CodeGPT can simplify coding tasks by providing accurate and efficient code snippets.</p>
			<p>Here is a real-life example that I encountered while writing this book. We asked for an advanced function that parses values from a string in the <code>key=value</code> format that could be transposed into a dictionary object with some examples. GitHub Copilot already knew of the SwitchboardFactory SBF object and came up with this function with a header:</p>
			<pre class="source-code">
/**
 * Parses a string of key-value pairs and updates the SwitchBoard state with those values.
 * Each pair within the testData string should be separated by spaces, and
 * keys/values should be separated by an '=' character.
 *
 * For example, a string "guests=2 zipcode=12345" will result in SBF having
 * "guests" set to 2 and "zipcode" set to 12345.
 * @param {string} testData - The string containing key-value pairs to be parsed.
 */
export function parseToSBF(testData: string) {
  let parts = testData.split(" ");
  parts.forEach(part =&gt; {
    if (part.includes('=')) {
      let [key, value] = part.split("=");
      SBF.set(key, parseInt(value));
    }
  });
}</pre>			<p>Artificial intelligence is the<a id="_idIndexMarker191"/> way of the future. We are at a point in time similar to when sledgehammers were used to break up concrete at the moment that Charles Brady King invented the jackhammer. This is our jackhammer!</p>
			<h1 id="_idParaDest-64"><a id="_idTextAnchor077"/>Summary</h1>
			<p>In this chapter, we reviewed the node files of the Webdriver node framework. We showed you how to make launching tests common between Mac and Windows team members. We also showed you how to set up the environment to enable debugging and writing better code in TypeScript. Finally, we wrote our first custom log wrapper, which optimized the output to the console window.</p>
			<p>By taking control of logging, we can make our debugging process more productive by deciding how it’s formatted and what is sent to the Allure report. In upcoming chapters, we will even add color for visibility and apply this same wrapper concept to the most common WebdriverIO browser methods to make supercharged robust tests.</p>
			<p>But we do not want to get ahead of ourselves, Doc! Next, we will talk about the effects of time travel because TypeScript is a bit of a speedster!</p>
		</div>
	</body></html>