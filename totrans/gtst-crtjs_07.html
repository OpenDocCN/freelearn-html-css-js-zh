<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Developing a Painting Application</h1></div></div></div><p>In this chapter, we will create a simple painting application<a id="id132" class="indexterm"/> using almost all the EaselJS features that we have already discussed in the previous chapters. This chapter will be more interactive and challenging, as we need to wrap up everything that we have already learned. So let's get started.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Preparing the stage</li><li class="listitem" style="list-style-type: disc">Understanding the <code class="literal">mousemove</code>, <code class="literal">mouseup</code>, and <code class="literal">mousedown</code> events</li><li class="listitem" style="list-style-type: disc">Implementing each callback function</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec37"/>Preparing the stage</h1></div></div></div><p>The overall <a id="id133" class="indexterm"/>functionality of this application is almost the same as drag-and-drop applications; we will use the <code class="literal">mousedown</code>, <code class="literal">mouseup</code>, and <code class="literal">mousemove</code> events to handle the painting logic. First, we will create a <code class="literal">stage</code> object and then an array of colors that will be used for the color of brushes. We will enable the <em>touch feature</em> for web browsers and for devices that support touch events. Finally, we set callback functions for the <code class="literal">mousedown</code>, <code class="literal">mouseup</code>, and <code class="literal">mousemove</code> events to handle the drawing feature and draw the lines.</p><p>The following screenshot shows a preview of our painting application:</p><div><img src="img/0260OS_07_01.jpg" alt="Preparing the stage"/></div><p>The final source <a id="id134" class="indexterm"/>code consists of the following functions:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">init</code>: It is used to create the stage and prepare other objects.</li><li class="listitem" style="list-style-type: disc"><code class="literal">handleMouseDown</code>: It is used to handle the <code class="literal">mousedown</code> event and bind the <code class="literal">mousemove</code> event.</li><li class="listitem" style="list-style-type: disc"><code class="literal">handleMouseMove</code>: It is used to handle the <code class="literal">mousemove</code> event and draw the line.</li><li class="listitem" style="list-style-type: disc"><code class="literal">handleMouseUp</code>: It is used to handle the <code class="literal">mouseup</code> event and unbind the <code class="literal">mousemove</code> event to stop drawing.</li></ul></div><p>The following image illustrates how the events work together to draw a line:</p><div><img src="img/0260OS_07_02.jpg" alt="Preparing the stage"/></div><p>In further sections, we will discuss more about the source code and how it is created.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec38"/>Understanding the init function</h1></div></div></div><p>Inside the <code class="literal">init</code> function, <a id="id135" class="indexterm"/>we will setup the stage, declare the basic variables, and also attach functions to the main events like the <code class="literal">mousedown</code> event.</p><p>The following code is the source code of the <code class="literal">init</code> function:</p><div><pre class="programlisting">function init() {
  var canvas = document.getElementById("cvs");
  var index = 0;
  var colors = ["#828b20", "#b0ac31", "#cbc53d", "#fad779", "#f9e4ad", "#faf2db", "#563512", "#9b4a0b", "#d36600", "#fe8a00", "#f9a71f"];

  var stage = new createjs.Stage(canvas);
  stage.autoClear = false;
  stage.enableDOMEvents(true);

  createjs.Touch.enable(stage);
  createjs.Ticker.setFPS(24);
  drawingCanvas = new createjs.Shape();

  stage.addEventListener("stagemousedown", handleMouseDown);
  stage.addEventListener("stagemouseup", handleMouseUp);

  stage.addChild(drawingCanvas);
  stage.update();
}</pre></div><p>In the first line of the function's body, we have a global <code class="literal">canvas</code> variable, which refers to our <code class="literal">Canvas</code> element in the page. We have an <code class="literal">index</code> variable that holds a counter to choose a color for brushes while painting and the next line contains an array of colors. We choose one value from this array randomly using the <code class="literal">index</code> variable. After that, as seen in previous examples, we have to create a <code class="literal">stage</code> object; this is also a global variable.</p><p>After that, we set the <code class="literal">autoClear</code> property of <code class="literal">stage</code> to <code class="literal">false</code>. This property indicates whether the stage should clear the rendered elements on the canvas automatically or not. By setting this value to <code class="literal">false</code>, we can manually control the clearing.</p><p>Then, we <a id="id136" class="indexterm"/>enabled the <strong>DOM</strong> (<strong>Document Object Model</strong>) events using the <code class="literal">enableDOMEvents</code> method. This method actually enables or disables the event listener, which <code class="literal">stage</code> adds to DOM elements such as window, document, and canvas.</p><p>In the following lines, touch events and <strong>frames per second</strong> (<strong>FPS</strong>) are configured. The <code class="literal">setFPS</code> function sets the target frame rate in frames per second. This function is a member o f the <code class="literal">Ticker</code> class. The <code class="literal">Ticker</code> class is one of the major features of EaselJS that provides a centralized ticker or heartbeat and listeners can subscribe to the ticker event to be notified when time elapsed.</p><p>Then, the global variable <code class="literal">drawingCanvas</code> is initialized with a <code class="literal">Shape</code> object and it will be our painting shape. In the following events, we will use this variable to complete the drawing process.</p><p>Further, the <code class="literal">mousedown</code> and <code class="literal">mouseup</code> events are assigned to proper functions and then a painting shape is added to <code class="literal">stage</code>. There are some ways to add an event listener and one of them is using the <code class="literal">addEventListener</code> function. Pass the name of the event and the function to it. We used the <code class="literal">addEventListener</code> function in this example.</p><p>Similar to the previous examples, we have to add the shape to <code class="literal">stage</code> and update it using the <code class="literal">update</code> function. In the following lines, we added the shape to <code class="literal">stage</code> and updated it.</p><p>This is the definition of the <code class="literal">init</code> function. Actually, this function is a bootstrap function to start the painting application. Inside this function, all events to paint and draw are configured. In the following sections, we will discuss the event callback function.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec39"/>Implementing the handleMouseDown function</h1></div></div></div><p>The following <a id="id137" class="indexterm"/>code is <a id="id138" class="indexterm"/>the source code of the <code class="literal">handleMouseDown</code> function, which is used to handle the <code class="literal">mousedown</code> event:</p><div><pre class="programlisting">function handleMouseDown(event) {
  color = colors[(index++) % colors.length];
  stroke = Math.round(Math.random() * 30 + 10);
  oldPt = new createjs.Point(stage.mouseX, stage.mouseY);
  oldMidPt = oldPt;
  stage.addEventListener("stagemousemove", handleMouseMove);
}</pre></div><p>This function is used to handle the <code class="literal">mousedown</code> event and will be called after pressing the mouse button. Inside this function, we set the color and size of a stroke, and hold the current mouse position to use in the next function call.</p><p>All <a id="id139" class="indexterm"/>variables are global, so<a id="id140" class="indexterm"/> you can't see any <code class="literal">var</code> keyword before them in order to have the variables in the following function calls and other scopes. In the last line, a function also sets the <code class="literal">mousemove</code> event in order to manage the drawing lines. Actually, the <code class="literal">mousemove</code> event fires whenever the mouse cursor moves in <code class="literal">stage</code>.</p><p>The color of the brush is selected from the <code class="literal">colors</code> array that is defined in the <code class="literal">init</code> function, one after the other, using the <code class="literal">index</code> variable. What we do to select the next color from the array is increase the <code class="literal">index</code> variable and then calculate the division's remainder. With this simple hack, we can choose a value between zero and the length of the array.</p><p>The size of the brush is selected using the <code class="literal">random</code> function. The <code class="literal">random</code> function from the <code class="literal">Math</code> class in JavaScript returns a value between 0 and 1 (but not 1). By multiplying this value with 30, we can get a value between 0 and 30 (but not 30). The round function also rounds up a number in JavaScript.</p><p>And the important part of that code is that <code class="literal">stage.mouseX</code> and <code class="literal">stage.mouseY</code> return the current mouse coordinate on the Canvas element. We use those variables to get the mouse position and hold it in a global variable. These values will be used to draw the lines and the reason we save them in a global variable is to provide accessibility in other scopes and functions. As you can see, we used the <code class="literal">Point</code> class to collect the coordinate of the mouse cursor. The <code class="literal">Point</code> class represents a two-dimensional coordinate system in EaselJS and we use this class to save the cursor pointer.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec40"/>Using the handleMouseMove function</h1></div></div></div><p>This<a id="id141" class="indexterm"/> function actually draws the<a id="id142" class="indexterm"/> line and is used to handle the <code class="literal">mousemove</code> event. This is our main function to handle drawing.</p><p>The source code of the <code class="literal">mousemove</code> function is as follows:</p><div><pre class="programlisting">function handleMouseMove(event) {
  var midPt = new createjs.Point(oldPt.x + stage.mouseX&gt;&gt; 1,oldPt.y + stage.mouseY&gt;&gt; 1);

  drawingCanvas.graphics.clear().setStrokeStyle(stroke, 'round', 'round').beginStroke(color).moveTo(midPt.x, midPt.y).curveTo(oldPt.x, oldPt.y,oldMidPt.x, oldMidPt.y);

  oldPt.x = stage.mouseX;
  oldPt.y = stage.mouseY;

  oldMidPt.x = midPt.x;
  oldMidPt.y = midPt.y;

  stage.update();
}</pre></div><p>This <a id="id143" class="indexterm"/>function is called continuously<a id="id144" class="indexterm"/> while the mouse cursor is dragging over <code class="literal">stage</code>. In this function, we draw the line using the <code class="literal">beginStroke</code> function and then save the current mouse position again in order to use it in the following function calls; actually, the following mouse move. By each move of the mouse cursor, this function is called again, so we will have the line.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>In the first line you can see the right shift operator (the <code class="literal">&gt;&gt;</code> operator). We used this function to simplify the <code class="literal">Math.floor(num / 2)</code>operation.</p><p>Actually, <code class="literal">num&gt;&gt; 1</code> and <code class="literal">Math.floor(num / 2)</code> have the same result.</p></div></div><p>After that, we update the stage using the <code class="literal">update</code> function to apply changes to the stage and render everything to the canvas.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec41"/>Utilizing the handleMouseUp function</h1></div></div></div><p>This function is <a id="id145" class="indexterm"/>called when a user <a id="id146" class="indexterm"/>releases the mouse click and uses it to end the drawing lines and remove the event from <code class="literal">stage</code>. Its source code is as follows:</p><div><pre class="programlisting">function handleMouseUp(event) {
  stage.removeEventListener("stagemousemove", handleMouseMove);
}</pre></div><p>All we do in this function is call <code class="literal">removeEventListener</code> to remove the <code class="literal">mousemove</code> event and<a id="id147" class="indexterm"/> prevent calling the function anymore. After removing this event from <code class="literal">stage</code>, the <code class="literal">handleMouseMove</code> function won't call anymore. So, by moving the mouse cursor, EaselJS won't call our function until the next <code class="literal">mousedown</code> event. That's exactly what we want to handle in the painting logic.</p><p>In the<a id="id148" class="indexterm"/> following screenshot, you can see a preview of this application:</p><div><img src="img/0260OS_07_03.jpg" alt="Utilizing the handleMouseUp function"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec42"/>Downloading the source code</h1></div></div></div><p>This<a id="id149" class="indexterm"/> painting example is one of the basic EaselJS samples. You can download the complete source code of the project from EaselJS's GitHub:</p><p>
<a class="ulink" href="https://github.com/CreateJS/EaselJS/blob/master/examples/CurveTo.html">https://github.com/CreateJS/EaselJS/blob/master/examples/CurveTo.html</a>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec43"/>Summary</h1></div></div></div><p>In this chapter, we have discussed how to create a simple painting application from scratch using the <code class="literal">mousemove</code>, <code class="literal">mousedown</code>, and <code class="literal">mouseup</code> events, and it's a good exercise to understand the concept of those events. Then, we learned how to manage mouse events inside each other to draw a line. The <code class="literal">addEventListener</code> and <code class="literal">removeEventListener</code> functions were used to add and remove an event from an object.</p><p>Also, we learned how to use the stroke feature in EaselJS to draw lines with a specific color and size. We used the <code class="literal">beginStorke</code>, <code class="literal">curveTo</code>, and <code class="literal">moveTo</code> functions to draw the lines and handle the painting logic.</p><p>In the next chapter, we will talk about <em>vector mask</em> and how to create a mask layer in CreateJS.</p></div></body></html>