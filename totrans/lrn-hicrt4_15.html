<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch15"/>Chapter 15. Highcharts Online Services and Plugins</h1></div></div></div><p>In the previous chapter, you learned how to run Highcharts on the server side. This enables Highcharts to expand its reach to online services. We will visit these services in this chapter and explore what benefits we can gain from them. As well as that, we examine how we can extend Highcharts with plugins. In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">What service <a class="ulink" href="http://export.highcharts.com">export.highcharts.com</a> provides</li><li class="listitem" style="list-style-type: disc">A step-by-step exercise to create an online chart from the new cloud service—<a class="ulink" href="http://cloud.highcharts.com">cloud.highcharts.com</a></li><li class="listitem" style="list-style-type: disc">What a Highcharts plugin is</li><li class="listitem" style="list-style-type: disc">Two plugin examples – regression and draggable points</li><li class="listitem" style="list-style-type: disc">Creating a new user experience by interoperating both plugins</li><li class="listitem" style="list-style-type: disc">How to write a plugin – extend existing methods, export a new method, and handle events</li></ul></div><div><div><div><div><h1 class="title"><a id="ch15lvl1sec93"/>Highcharts export server – export.highcharts.com</h1></div></div></div><p>In the last chapter, we<a id="id1030" class="indexterm"/> looked into running Highcharts on the server side. However, some users may not want to set up their own server operations. This is<a id="id1031" class="indexterm"/> where <a class="ulink" href="http://export.highcharts.com">export.highcharts.com</a> comes in. Originally, it was only set up for the exporting module so that users running Highcharts on the Internet could export their charts freely. Later, the URL was expanded to support online services. This let users enter their own Highcharts configuration and download the resulting chart images.</p><p>The following is part of the  <a class="ulink" href="http://export.highcharts.com">export.highcharts.com</a> web page:</p><div><img src="img/7451OS_15_01.jpg" alt="Highcharts export server – export.highcharts.com"/></div><p>As we can see, the <a id="id1032" class="indexterm"/>user input indeed corresponds to the parameters of the server-side script, <code class="literal">highcharts_convert.js</code>, which we covered in a previous chapter. Both the web interface and server process are implemented in Java, which deliver the user's options to the PhantomJS/<code class="literal">highcharts_convert.js</code> process and exports it into SVG. Once the Java server receives the SVG result, it launches Batik to format into image files. The source for the whole web service solution is available in the <code class="literal">exporting-server/java/highcharts-export</code> directory.</p><p>The downside to the online export service is that it is not WYSIWYG, and so can be unintuitive to use. For this reason, a new web service with much richer user experience was born—<a id="id1033" class="indexterm"/>
<strong>Highcharts Cloud Service</strong>. We will take a ride in the next section and see what difference it brings.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch15lvl1sec94"/>Highcharts Cloud Service</h1></div></div></div><p>In this section, we will<a id="id1034" class="indexterm"/> review a brand new online chart service developed by the Highcharts team, Highcharts Cloud <a id="id1035" class="indexterm"/>Service (<a class="ulink" href="http://cloud.highcharts.com">http://cloud.highcharts.com</a>). The following screenshot shows the initial welcome screen:</p><div><img src="img/7451OS_15_02.jpg" alt="Highcharts Cloud Service"/></div><p>Highcharts Cloud Service is a major milestone in terms of expanding the product line. It is designed for users to:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create HTML5 charts even <a id="id1036" class="indexterm"/>without any JavaScript or Highcharts knowledge (in SIMPLE mode)</li><li class="listitem" style="list-style-type: disc">Prototype their charts interactively without any installation and setting up on the web server and Highcharts</li><li class="listitem" style="list-style-type: disc">Embed charts in online articles, applications, or web pages with a simple hyperlink</li><li class="listitem" style="list-style-type: disc">Store their charts in the cloud rather than locally</li><li class="listitem" style="list-style-type: disc">Share their charts easily with other people</li></ul></div><p>The following is a screenshot of a news website linking a chart created from the cloud service:</p><div><img src="img/7451OS_15_03.jpg" alt="Highcharts Cloud Service"/></div><p>Let's try to create our first chart<a id="id1037" class="indexterm"/> using the cloud service. The web interface is wizard-based and intuitive for any non-technical users. The following is the initial screen of the cloud service:</p><div><img src="img/7451OS_15_04.jpg" alt="Highcharts Cloud Service"/></div><p>There are three major sections in the interface: the left wizard panel, the top-right result chart panel, and the bottom-right series data editor. At the top of the left wizard panel, it shows which stage we are currently in. At the first stage (<strong>IMPORT</strong>), we can either paste our CSV data into the text area and click on upload or manually enter series data through the bottom-right editor.</p><p>In the <a id="id1038" class="indexterm"/>preceding screenshot, we have already pasted some data in the left panel. When we click on the <strong>Upload and Continue</strong> button, the application progresses to stage 2 (<strong>TEMPLATES</strong>). Here is the screenshot:</p><div><img src="img/7451OS_15_05.jpg" alt="Highcharts Cloud Service"/></div><p>First, we can see the top-right panel updated with the default line series and the bottom-right editor panel is populated with the series data. Although the top-right chart doesn't show anything meaningful, it will become clearer as we configure the chart in a later stage. At this point, we can further edit the series data in the editor panel if we need to. Let's select a series in the left panel, <strong>3D column chart</strong>, which immediately updates the top-right chart:</p><div><img src="img/7451OS_15_06.jpg" alt="Highcharts Cloud Service"/></div><p>A 3D column chart is displayed in<a id="id1039" class="indexterm"/> the top-right panel, but the axis and chart title are still incorrect. We can either click on the <strong>CONTINUE TO CUSTOMIZE</strong> button (shown in the preceding screenshot) or on <strong>CUSTOMIZE</strong> to go to the next stage and tune each component in the chart:</p><div><img src="img/7451OS_15_07.jpg" alt="Highcharts Cloud Service"/></div><p>As we can see, there are different <a id="id1040" class="indexterm"/>areas in the chart that we can choose to configure. In this example, we have changed the chart title, axis type, title, and label format. Note that at the <strong>CUSTOMIZE</strong> stage, there are three tabs shown underneath. This lets the user choose how to update the chart. <strong>SIMPLE</strong> is the most basic and is for non-technical users without any programming experience, or for quick simple changes. <strong>ADVANCED</strong> mode is for users who are familiar with Highcharts' options. The user interface is a simple properties update in name and value style. The <strong>CODE</strong> level is for users who wish to write JavaScript code for the chart, for example, the event handler. The following screenshot shows both the <strong>ADVANCED</strong> and <strong>CODE</strong> user interfaces:</p><div><img src="img/7451OS_15_08.jpg" alt="Highcharts Cloud Service"/></div><p>Once we are happy with our final chart, we can click on <strong>CONTINUE TO SHARE</strong> to generate a hyperlink for the chart.</p></div>
<div><div><div><div><h1 class="title"><a id="ch15lvl1sec95"/>Highcharts plugins</h1></div></div></div><p>Highcharts can be extended through <a id="id1041" class="indexterm"/>plugins that allow us to add functionality without disturbing the core layer of code and are easy to share. There is a library of plugins available online contributed by Highcharts staff and other users at<a id="id1042" class="indexterm"/> <a class="ulink" href="http://www.highcharts.com/plugin-registry">http://www.highcharts.com/plugin-registry</a>. One distinct advantage of developing features out of plugins is that we can pick and choose the plugin features and build a compressed JavaScript library from them. In fact, we can already do something similar with the Highcharts library on the download page.</p><p>In this section, we will take a tour of a couple of plugins that you may find handy.</p><div><div><div><div><h2 class="title"><a id="ch15lvl2sec112"/>The regression plot plugin</h2></div></div></div><p>When we create a<a id="id1043" class="indexterm"/> scatter plot with lots of data points, it is often worthwhile to <a id="id1044" class="indexterm"/>overlay them with a regression line. Of course, we can always achieve this by adding a line series manually. However, we still need to write the code for regression analysis. It is much more convenient to include a plugin. The Highcharts regression plugin created by Ignacio Vazquez does the job nicely. First, we include the plugin:</p><div><pre class="programlisting">&lt;script src="img/highcharts-regression.js"&gt; &lt;/script&gt;</pre></div><p>Then, we create our scatter chart as usual. Since we include the regression plugin, it provides additional regression options:</p><div><pre class="programlisting">            series: [{
                regression: true ,
                regressionSettings: {
                    type: 'linear',
                    color:  'rgba(223, 83, 83, .9)'
                },
                name: 'Female',
                color: 'rgba(223, 83, 83, .5)',
                data: [ [161.2, 51.6], [167.5, 59.0],
                        .... </pre></div><p>Here is the chart from the demo (<a class="ulink" href="http://www.highcharts.com/plugin-registry/single/22/Highcharts%20regression">http://www.highcharts.com/plugin-registry/single/22/Highcharts%20regression</a>):</p><div><img src="img/7451OS_15_09.jpg" alt="The regression plot plugin"/></div></div><div><div><div><div><h2 class="title"><a id="ch15lvl2sec113"/>The draggable points plugin</h2></div></div></div><p>Here is another<a id="id1045" class="indexterm"/> remarkable <a id="id1046" class="indexterm"/>plugin by Torstein that enables chart viewers to drag any series data points. We import the plugin with the following line:</p><div><pre class="programlisting">&lt;script src="img/draggable-points.js"&gt;&lt;/script&gt;</pre></div><p>This plugin brings two new point events, <code class="literal">drag</code> and <code class="literal">drop</code>, which we can define the handlers for via the <code class="literal">plotOptions.series.point.events</code> option (or the <code class="literal">events</code> option in a data point object). Here is the example code from the demo:</p><div><pre class="programlisting">events: {                    
     drag: function(e) {
         // Update new data value in 'drag' div box
         $('#drag').html(
             'Dragging &lt;b&gt;' + this.series.name + '&lt;/b&gt;, &lt;b&gt;' +
             this.category + '&lt;/b&gt; to &lt;b&gt;' + 
             Highcharts.numberFormat(e.newY, 2) + '&lt;/b&gt;'
         );
     },
     drop: function() {
         $('#drop').html(
              'In &lt;b&gt;' + this.series.name + '&lt;/b&gt;, &lt;b&gt;' +
               this.category + '&lt;/b&gt; was set to &lt;b&gt;' + 
               Highcharts.numberFormat(this.y, 2) + '&lt;/b&gt;'
         );
     }
 }</pre></div><p>When we select a data point and move the mouse, a drag event is triggered and the demo code will update the textbox below the chart, as seen in the following screenshot. The plugin provides several <a id="id1047" class="indexterm"/>new options to control how we can drag and drop the <a id="id1048" class="indexterm"/>data points. The following is a usage example:</p><div><pre class="programlisting">    series: [{
        data: [0, 71.5, 106.4, .... ],
        draggableY: true,
        dragMinY: 0,
        type: 'column',
        minPointLength: 2
    }, {
        data: [0, 71.5, 106.4, ....],
        draggableY: true,
        dragMinY: 0,
        type: 'column',
        minPointLength: 2
    }, {</pre></div><p>The Boolean option <code class="literal">draggableX/Y</code> notifies which direction the data points can be dragged in. Furthermore, the drag range can be limited by the <code class="literal">dragMinX/Y</code> and <code class="literal">dragMaxX/Y</code> options. The following screenshot shows a column being dragged:</p><div><img src="img/7451OS_15_10.jpg" alt="The draggable points plugin"/></div></div><div><div><div><div><h2 class="title"><a id="ch15lvl2sec114"/>Creating a new effect by combining plugins</h2></div></div></div><p>So far, we have seen the effect <a id="id1049" class="indexterm"/>of two individual plugins. It's time for us to create a new user experience by loading these two plugins and combining their effects. The idea is to create a regression chart with movable data points, so that the regression line automatically adjusts in real time as we drag a data point. When doing so, we need to slightly modify the regression plugin code. Here is part of the original code:</p><div><pre class="programlisting">(function (H) {
    
    H.wrap(H.Chart.prototype, 'init', function (proceed) {
       ....
       for (i = 0 ; i &lt; series.length ; i++){
            var s = series[i];
            if ( s.regression &amp;&amp; !s.rendered ) {
                 // Create regression series option
                 var extraSerie = {
                     ....
                 };
                 // Compute regression based on the type
                 if (regressionType == "linear") {
                    regression = _linear(s.data) ;
                    extraSerie.type = "line";
                 }
            }
      }
      // Append to series configuration array
      ....
   });
    
   function _linear(data) {
   ....
   }

   ....
})(Highcharts);</pre></div><p>Basically, before the chart is created and rendered, the plugin scans the series data, computes the regression result, and formats the result into a line series option. To do that, the regression implementation is included as part of the <code class="literal">init</code> method for the <code class="literal">Chart</code> class, which is called when a <code class="literal">Chart</code> object is created. To extend an existing function in Highcharts, we call the <code class="literal">wrap</code> function on a method inside the object's prototype. In other words, when a <code class="literal">Chart</code> object is created, it will call the <code class="literal">init</code> function, which executes each function stacked internally (closure). We will further investigate this subject later.</p><p>For the purpose of updating the regression line at runtime, we need the ability to call <code class="literal">_linear</code> from outside the plugin. Here is a pseudo code of the new modification to add a new method, <code class="literal">updateRegression</code>:</p><div><pre class="programlisting">(function (H) {    
    H.wrap(H.Chart.prototype, 'init', function (proceed) {
     ....
    });

    H.Chart.prototype.updateRegression = function(point) {
          // Get the series from the dragged data point
          var series = point.series;
          var chart = series.chart;
          // Get the regression series associated 
          // with this data series
          var regressSeries = chart.series[series.regressIdx];
           
          // Recompute based on the regression type and 
          // update the series
          if (series.regressionType == "linear") {
            regression = _linear(series.data) ;
          }
          regressSeries.update(regression, true);
    };

   function _linear(data) {
   ....
   }

   ....
})(Highcharts);</pre></div><p>Now we have a <a id="id1050" class="indexterm"/>regression plugin with an accessible method, <code class="literal">updateRegression</code>, to call the inner scope function <code class="literal">_linear</code>. With this new plugin function, we can link the functionality with the <code class="literal">drag</code> event exported by the draggable plugin:</p><div><pre class="programlisting">plotOptions: {
  series: {
    point: {
      events: {
          drag: function(e) {
             // Pass the dragged data point to the     
             // regression plugin and update the
             // regression line
             Highcharts.charts[0]
                          .updateRegression(e.target);
        }
      }
    }
  }
}    </pre></div><p>In order to observe the new effect more clearly, we use a smaller set of scatter plots. Here is the series configuration with both plugin options:</p><div><pre class="programlisting">    series: [{
        regression: true ,
        regressionSettings: {
            type: 'linear',
            color:  'rgba(223, 83, 83, .9)'
        },
        draggableX: true,
        draggableY: true,
        name: 'Female',
        color: 'rgba(223, 83, 83, .5)',
        data: [ [161.2, 51.6], [167.5, 59.0], [159.5, 49.2], 
                [157.0, 63.0], [155.8, 53.6], [170.0, 59.0],
                [159.1, 47.6], [166.0, 69.8], [176.2, 66.8],
                ....</pre></div><p>In the configuration, we <a id="id1051" class="indexterm"/>have the scatter points draggable in both x and y directions and the regression type is linear. Let's load our new improved chart. The following is the initial screen:</p><div><img src="img/7451OS_15_11.jpg" alt="Creating a new effect by combining plugins"/></div><p>Let's hypothetically assume<a id="id1052" class="indexterm"/> an overactive, unapproved slim-fast drug, "mouse down", has slipped onto the market, which has some unreported side effects. The unfortunate ones will shoot up and the really unfortunate ones have their heights gravitate. Here is the outcome of the new result:</p><div><img src="img/7451OS_15_12.jpg" alt="Creating a new effect by combining plugins"/></div><p>The regression line responds in real time as well as updating the top-left legend box as we mouse down those weights at the far-right data points.</p></div><div><div><div><div><h2 class="title"><a id="ch15lvl2sec115"/>Guidelines for creating a plugin</h2></div></div></div><p>Some users create a plugin <a id="id1053" class="indexterm"/>because certain tasks cannot be fulfilled by the API and<a id="id1054" class="indexterm"/> the task is generic enough that it will be beneficial to other chart users. However, there is no standard API to create a plugin; developers have to be hands-on with their knowledge of Highcharts code. Nonetheless, there are a few guidelines that we can generalize from existing plugins.</p><div><div><div><div><h3 class="title"><a id="ch15lvl3sec53"/>Implementing the plugin within a self-invoking anonymous function</h3></div></div></div><p>Always implement the plugin <a id="id1055" class="indexterm"/>within a self-invoking anonymous function with Highcharts as the parameter. A self-invoking anonymous function is a pretty common technique in JavaScript. All the Highcharts plugins are implemented in this style. The following code shows an example:</p><div><pre class="programlisting">(function (Highcharts) {
        ....
        // what happens in anonymous function, 
        // stays in anonymous function
        function hangoverIn(place) { 
           if (place === 'home') {
                return 'phew';
            } else if (place === 'hospital') {
                return 'ouch';
            } else if (place === 'vegas') {
                return 'aaahhhhh!!';
            }
        }
})(Highcharts);</pre></div><p>None of the named functions and variables declared in the plugin are accessible externally because they are declared within the scope of a self-invoking anonymous function (closure and module pattern). Hence, the implementation is private to the outside world unless we assign properties in the Highcharts namespace.</p></div><div><div><div><div><h3 class="title"><a id="ch15lvl3sec54"/>Using Highcharts.wrap to extend existing functions</h3></div></div></div><p>Depending on the plugin task, some plugins need to extend an existing function. For instance, the regression plugin calls <code class="literal">H.wrap</code> to extend the <code class="literal">init</code> function, which is called from the <code class="literal">Chart</code> constructor. See the following code:</p><div><pre class="programlisting">(function (H) {
    H.wrap(H.Chart.prototype, 'init', 
        function (proceed) {
            // Plugin specific code for processing 
            // chart configuration
            .... 
            // Must include this instruction for wrap 
            // method to work
            proceed.apply(this,
                 Array.prototype.slice.call(arguments, 1));
        }
    );
})(Highcharts);</pre></div><p><code class="literal">Highcharts.wrap</code> is a <a id="id1056" class="indexterm"/>commonly used function within plugins. The way <code class="literal">wrap</code> functions work is to overwrite the <code class="literal">init</code> function with a new function body that includes the previous implementation <code class="literal">proceed</code>. When we extend the method with our new plugin code in an anonymous function, we have to accept the <code class="literal">proceed</code> argument, which represents the parent function body. Before or after our plugin code, we must call <code class="literal">proceed.apply</code> on the same arguments in order to complete the chain of executions.</p><p>For reference, we can always extend methods for a particular series, for example, <code class="literal">Highcharts.seriesTypes.column.prototype</code>, where <code class="literal">seriesTypes</code> is an object containing all the series classes. Alternatively, if the plugin needs to be set up for all the series, we can invoke the <code class="literal">wrap</code> method on <code class="literal">Highcharts.Series.prototype</code> instead (all series classes are extended from <code class="literal">Highcharts.Series</code>).</p></div><div><div><div><div><h3 class="title"><a id="ch15lvl3sec55"/>Using a prototype to expose a plugin method</h3></div></div></div><p>Sometimes we may need to <a id="id1057" class="indexterm"/>export specific methods for a plugin. To do so, we should always define new methods inside the <code class="literal">prototype</code> property, such as:</p><div><pre class="programlisting">(function (H) {
     H.Chart.prototype.pluginMethod = function(x, y) {
        ....            
     };
})(Highcharts);</pre></div><p>This is because any code declared within the anonymous function is not accessible from the outside. Therefore, the only way to create a callable method is bound to the object passed to the anonymous function, which is the top level Highcharts object in this case. The <code class="literal">prototype</code> property is the standard way in JavaScript to inherit properties and methods from objects. The reason <a id="id1058" class="indexterm"/>for attaching the method within the <code class="literal">prototype</code> property is because we don't know how developers will use the plugin. For instance, they may decide to create a new <code class="literal">Chart</code> object and call the plugin method. In such cases, the plugin code will still work.</p></div><div><div><div><div><h3 class="title"><a id="ch15lvl3sec56"/>Defining a new event handler</h3></div></div></div><p>Another type of action for <a id="id1059" class="indexterm"/>plugins is to define new events, as we saw in the draggable plugin. Here is the problem: we need access to a chart element to bind the event handler, that is, after the chart is rendered. However, the class <code class="literal">init</code> method is executed prior to the chart being rendered. This is where the <code class="literal">Highcharts.Chart.prototype.callbacks</code> array comes in. It is a place designed to store external functions that require access to elements. For example, the exporting module uses this array to insert buttons into the chart. Here is some pseudo code to set up events:</p><div><pre class="programlisting">(function (H) {
    Highcharts.Chart.prototype.callbacks.push(function (chart) {
        // A DOM element, e.g. chart, container, document,
        var element = chart.container;
        // DOM event type: mousedown, touchstart, etc
        var eventName = 'mousedown';

        // We can call fireEvent to fire a new event 
        // defined in this plugin
        fireEvent(element, newEvent, evtArgs, 
                  function(args) {
                  ....
        });

        // Plugin event
        function handler(e) {
                // Plugin code
                ...
        }
        // Bind specific event to the defined handler
        Highcharts.addEvent(element, eventName, handler);
    });
})(Highcharts);</pre></div><p>Highcharts has two event-related methods: <code class="literal">addEvent</code> and <code class="literal">fireEvent</code>. The former method is to bind an event to a chart element with a handler, whereas <code class="literal">fireEvent</code> triggers an event on an element.</p><p>The preceding code basically <a id="id1060" class="indexterm"/>creates an anonymous function that organizes all the event(s) setup, such as defining the handler(s) and binding them to elements. The function must accept <code class="literal">chart</code> as the only parameter. Finally, we append the function into the <code class="literal">callbacks</code> array. The function will be automatically executed once the chart is fully rendered.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch15lvl1sec96"/>Summary</h1></div></div></div><p>In this chapter, we visited the Highcharts online export server and the new cloud service. We took a short tour of the cloud service and demonstrated how we can create a chart online without any prior knowledge of JavaScript and Highcharts. Another topic covered was the Highcharts plugin in which we experimented with two plugins: regression and draggable data points. We then demonstrated how to modify one plugin to make both plugins work together to provide a new user experience.</p><p>So far, all my knowledge and experience of Highcharts is enclosed in this journal. To achieve two editions in 3 years has been much tougher than I expected. Hence, my journey with Highcharts has come to an end, and I can put my time back to where it should always be, family. My utmost gratitude to you for purchasing and reading this book. My goal was to illustrate to you how dynamic and impressive Highcharts can be, and I hope I have achieved this and ended this book on a high note.</p></div></body></html>