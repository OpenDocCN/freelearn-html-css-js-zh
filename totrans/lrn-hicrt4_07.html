<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Bubble, Box Plot, and Error Bar Charts</h1></div></div></div><p>In this chapter, we will explore bubble charts by first studying how the bubble size is determined from various series options, and then familiarizing ourselves with it by replicating a real-life chart. After that, we will study the structure of the box plot chart and discuss an article converting an over-populated spider chart into a box plot. We will use that as an exercise to familiarize ourselves with box plot charts. Finally, we will move on to the error bar series to understand its structure and apply the series to some statistical data.</p><p>This chapter assumes that you have some basic knowledge of statistics, such as mean, percentile, standard error, and standard deviation. For readers needing to revise these topics, there are plenty of online materials covering them. Alternatively, the book <em>Statistics For Dummies</em> by Deborah J. Rumsey provides great explanations and covers some fundamental charts such as the box plot.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How bubble size is determined</li><li class="listitem" style="list-style-type: disc">Bubble chart options when reproducing a real-life chart in a step-by-step approach</li><li class="listitem" style="list-style-type: disc">Box plot structure and the series options when replotting data from a spider chart</li><li class="listitem" style="list-style-type: disc">Error bar charts with real-life data</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec49"/>The bubble chart</h1></div></div></div><p>The bubble series <a id="id472" class="indexterm"/>is an extension of the scatter series where each individual data point has a variable size. It is generally used for showing 3-dimensional data on a 2-dimensional chart, and the bubble size reflects the scale between z-values.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec54"/>Understanding how the bubble size is determined</h2></div></div></div><p>In Highcharts, bubble size is<a id="id473" class="indexterm"/> decided by associating the smallest z-value to the <code class="literal">plotOptions.bubble.minSize</code> option and the largest z-value to <code class="literal">plotOptions.bubble.maxSize</code>. By default, <code class="literal">minSize</code> is set to 8 pixels in diameter, whereas <code class="literal">maxSize</code> is set to 20 percent of the plot area size, which is the minimum value of width and height.</p><p>There is another option, <code class="literal">sizeBy</code>, which also affects the bubble size. The <code class="literal">sizeBy</code> option accepts string values: <code class="literal">'width'</code> or <code class="literal">'area'</code>. The width value means that the bubble width is decided by its z-value ratio in the series, in proportion to the <code class="literal">minSize</code> and <code class="literal">maxSize</code> range. As for <code class="literal">'area'</code>, the size of the<a id="id474" class="indexterm"/> bubble is scaled by taking the square root of the z-value ratio (see <a class="ulink" href="http://en.wikipedia.org/wiki/Bubble_chart">http://en.wikipedia.org/wiki/Bubble_chart</a> for more description on <code class="literal">'area'</code> implementation). This option is for viewers who have different perceptions when comparing the size of circles. To demonstrate this concept, let's take the <code class="literal">sizeBy</code> example (<a class="ulink" href="http://jsfiddle.net/ZqTTQ/">http://jsfiddle.net/ZqTTQ/</a>) from the Highcharts <a id="id475" class="indexterm"/>online API documentation. Here is the snippet of code from the example:</p><div><pre class="programlisting">        plotOptions: {
            series: { minSize: 8, maxSize: 40 }
        },
        series: [{
            data: [ [1, 1, 1], [2, 2, 2], 
                    [3, 3, 3], [4, 4, 4], [5, 5, 5] ],
            sizeBy: 'area', 
            name: 'Size by area'
        }, {
            data: [ [1, 1, 1], [2, 2, 2], 
                    [3, 3, 3], [4, 4, 4], [5, 5, 5] ],
           sizeBy: 'width',
            name: 'Size by width'
        }]</pre></div><p>Two sets of bubbles are set with different <code class="literal">sizeBy</code> schemes. The minimum and maximum bubble sizes are set to 8 and 40 pixels wide respectively. The following is the screen output of the example:</p><div><img src="img/7451OS_07_01.jpg" alt="Understanding how the bubble size is determined"/></div><p>Both series have the <a id="id476" class="indexterm"/>exact same x, y, and z values, so they have the same bubble sizes at the extremes (1 and 5). With the middle values 2 to 4, the <strong>Size by area</strong> bubbles start off with a larger area than the <strong>Size by width</strong>, and gradually both schemes narrow to the same size. The following is a table showing the final size values in different z-values for each method, whereas the associating value inside the bracket is the z-value ratio in the series:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p><strong>Z-Value</strong></p>
</td><td style="text-align: left" valign="top">
<p>1</p>
</td><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>4</p>
</td><td style="text-align: left" valign="top">
<p>5</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><strong>Size by width (Ratio)</strong></p>
</td><td style="text-align: left" valign="top">
<p>8 (0)</p>
</td><td style="text-align: left" valign="top">
<p>16 (0.25)</p>
</td><td style="text-align: left" valign="top">
<p>24 (0.5)</p>
</td><td style="text-align: left" valign="top">
<p>32 (0.75)</p>
</td><td style="text-align: left" valign="top">
<p>40 (1)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p><strong>Size by area (Ratio)</strong></p>
</td><td style="text-align: left" valign="top">
<p>8 (0)</p>
</td><td style="text-align: left" valign="top">
<p>24 (0.5)</p>
</td><td style="text-align: left" valign="top">
<p>31 (0.71)</p>
</td><td style="text-align: left" valign="top">
<p>36 (0.87)</p>
</td><td style="text-align: left" valign="top">
<p>40 (1)</p>
</td></tr></tbody></table></div><p>Let's see how the bubble sizes are computed in both approaches. The ratio in <strong>Size by width</strong> is calculated as <em>(Z - Zmin) / (Zmax - Zmin)</em>. So, for z-value 3, the ratio is computed as <em>(3 - 1) / (5 - 1) = 0.5</em>. To evaluate the ratio for the <strong>Size by area</strong> scheme, simply take the square root of the <strong>Size by width</strong> ratio. In this case, for z-value 3, it works out as <em>√0.5 ≈ 0.71</em>. We then convert the ratio value into the number of pixels based on the <code class="literal">minSize</code> and <code class="literal">maxSize</code> range. <strong>Size by width</strong> with z-value 3 is calculated as:</p><p><em>            ratio * (maxSize - minSize) + minSize = 0.5 * (40 - 8) + 8 = 24</em></p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec55"/>Reproducing a real-life chart</h2></div></div></div><p>In this section, we will examine <a id="id477" class="indexterm"/>bubble series options by replicating a real-life example (MLB Players <a id="id478" class="indexterm"/>Chart: <a class="ulink" href="http://fivethirtyeight.com/datalab/has-mike-trout-already-peaked/">http://fivethirtyeight.com/datalab/has-mike-trout-already-peaked/</a>). The following is a bubble chart of baseball players' milestones:</p><div><img src="img/7451OS_07_02.jpg" alt="Reproducing a real-life chart"/></div><p>First, there are two ways that we can list the data points (the values are derived from best estimations of the graph) in the series. The conventional way is an array of x, y, and z values where x is the age value starting from 21 in this example:</p><div><pre class="programlisting">            series: [{
                 type: 'bubble',
                 data: [ [ 21, 100, 1 ],
                         [ 22, 50, 5 ],
                         .... </pre></div><p>Alternatively, we can simply use the <code class="literal">pointStart</code> option as the initial age value and miss out the rest:</p><div><pre class="programlisting">            series: [{
                type: 'bubble',
                pointStart: 21,
                data: [ [ 100, 1 ],
                        [ 50, 5 ],
                        ....</pre></div><p>Then, we define the background color, axis titles, and rotate the <em>y </em>axis title to the top of the chart. The following is our first try:</p><div><img src="img/7451OS_07_03.jpg" alt="Reproducing a real-life chart"/></div><p>As we can see, there <a id="id479" class="indexterm"/>are a number of areas that are not quite right. Let's fix the bubble size and color first. Compared to the original chart, the preceding chart has a larger bubble size for the upper value and the bubbles should be solid red. We update the <code class="literal">plotOptions.bubble</code> series as follows:</p><div><pre class="programlisting">      plotOptions: {
           bubble: {
               minSize: 9,
               maxSize: 30,
               color: 'red'
           }
      },</pre></div><p>This changes the bubble size perspective to more closely resemble the original chart:</p><div><img src="img/7451OS_07_04.jpg" alt="Reproducing a real-life chart"/></div><p>The next step is to <a id="id480" class="indexterm"/>fix the y-axis range as we want it to be between 0 and 100 only. So, we apply the following config to the <code class="literal">yAxis</code> option:</p><div><pre class="programlisting">     yAxis: {
         endOnTick: false,
         startOnTick: false,
         labels: {
             formatter: function() {
                  return (this.value === 100) ? 
                       this.value + ' %' : this.value;
             }
         }
     },</pre></div><p>By setting the options <code class="literal">endOnTick</code> and <code class="literal">startOnTick</code> to <code class="literal">false</code>, we remove the extra interval at both ends. The label formatter only prints the <code class="literal">%</code> sign at the <code class="literal">100</code> interval. The following chart shows the improvement on the <em>y</em> axis:</p><div><img src="img/7451OS_07_05.jpg" alt="Reproducing a real-life chart"/></div><p>The next<a id="id481" class="indexterm"/> enhancement is to move the <em>x</em> axis up to the zero value level and refine the <em>x </em>axis into even number intervals. We also enable the grid lines on each major interval and increase the width of the axis line to resemble the original chart:</p><div><pre class="programlisting">     xAxis: {
         tickInterval: 2,
         offset: -27,
         gridLineColor: '#d1d1d1',
         gridLineWidth: 1,
         lineWidth: 2,
         lineColor: '#7E7F7E',
         labels: {
             y: 28
         },
         minPadding: 0.04,
         maxPadding: 0.15,
         title: ....
     },</pre></div><p>The <code class="literal">tickInterval</code> property sets the label interval to even numbers and the <code class="literal">offset</code> option pushes the <em>x</em> axis level upwards, in line with the zero value. The interval lines are enabled by setting the <code class="literal">gridLineWidth</code> option to a non-zero value. In the original chart, there are extra spaces at both extremes of the <em>x</em> axis for the data labels. We can achieve this by assigning both <code class="literal">minPadding</code> and <code class="literal">maxPadding</code> with the ratio values. The <em>x</em> axis labels are pushed further down by increasing the property of the <code class="literal">y</code> value. The following screenshot shows the improvement:</p><div><img src="img/7451OS_07_06.jpg" alt="Reproducing a real-life chart"/></div><p>The final<a id="id482" class="indexterm"/> enhancement is to put data labels next to the first and penultimate data points. In order to enable a data label for a particular point, we turn the specific point value into an object configuration with the <code class="literal">dataLabels</code> option as follows:</p><div><pre class="programlisting">     series: [{
         pointStart: 21,
         data: [{ 
             y: 100, 
             z: 1, 
             name: 'Alex Rodriguez &lt;br&gt;in Seattle at age 21', 
             dataLabels: {
                 enabled: true,
                 align: 'right',
                 verticalAlign: 'middle',
                 format: '{point.name}',
                 color: 'black',
                 x: 15
             }
         }, ....</pre></div><p>We use the <code class="literal">name</code> property for the data label content and set the <code class="literal">format</code> option pointing to the <code class="literal">name</code> property. We also position the label on the right-hand side of the data point and assign the label color.</p><div><img src="img/7451OS_07_07.jpg" alt="Reproducing a real-life chart"/></div><p>From the<a id="id483" class="indexterm"/> preceding observation, we notice that the font seems quite blurred. Actually, this is the default setting for <code class="literal">dataLabels</code> in the bubble series. (The default label color is white and the position inside the bubble is filled with the series color. As a result, the data label actually looks clear even when the text shadow effect is applied) Also, there is a connector between the bubble and data label in the original chart. Here is our second attempt to enhance the chart:</p><div><pre class="programlisting">         { y: 100, 
           z: 1, 
           name: 'Alex Rodriguez &lt;br&gt;in Seattle at age 21', 
           dataLabels: {
               enabled: true,
               align: 'right',
               verticalAlign: 'middle',
               format: '&lt;div style="float:left"&gt;' + 
                       '&lt;font size="5"&gt;∟&lt;/font&gt;&lt;/div&gt;' +
                       '&lt;/span&gt;&lt;div&gt;{point.name}&lt;/div&gt;',
               color: 'black',
               shadow: false,
               useHTML: true,
               x: -2,
               y: 18,
               style: {
                   fontSize: '13px',
                   textShadow: 'none'
               }
           }
         },</pre></div><p>To remove the blurred effect, we redefine the label style without CSS <code class="literal">textShadow</code>. As for the L-shaped connector, we use the trick of alt-code (alt-code: 28) with a larger font size. Then, we put the inline CSS style in the <code class="literal">format</code> option to make the two <code class="literal">DIV</code> boxes connector and text label adjacent to each other. The new arrangement looks considerably more polished:</p><div><img src="img/7451OS_07_08.jpg" alt="Reproducing a real-life chart"/></div><p>We apply the same<a id="id484" class="indexterm"/> trick to the other label; here is the final draft of our bubble chart:</p><div><img src="img/7451OS_07_09.jpg" alt="Reproducing a real-life chart"/></div><p>The only part left undone is the bubble size legend. Unfortunately, Highcharts currently doesn't offer such a feature. However, this can be accomplished by using the chart's Renderer engine to create a circle and text label. We will leave this as an exercise for readers.</p><p>Technically <a id="id485" class="indexterm"/>speaking, we can create the same chart with a scatter series instead, with each data point specified in object configuration, and assign a precomputed z-value ratio to the <code class="literal">data.marker.radius</code> option.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Understanding the box plot chart</h1></div></div></div><p>A box plot<a id="id486" class="indexterm"/> is a technical chart that shows data samples in terms of the shape of distribution. Before we can create a box plot chart, we need to understand the basic structure and concept. The following diagram illustrates the structure of a box plot:</p><div><img src="img/7451OS_07_10.jpg" alt="Understanding the box plot chart"/></div><p>In order to find out the percentile values, the entire data sample needs to be sorted first. Basically, a box plot is composed of top and bottom whisker values, first (Q1) and third (Q3) quartile values, and the median. The quartile Q1 represents the median value between the 50th percentile and the minimum data. Quartile Q3 works in a similar fashion but with maximum data. For data with a perfectly normal distribution, the box plot will have an equal distance between each section.</p><p>Strictly speaking, there are other types of box plot that differ in how much the percentiles of both whiskers cover. Some use the definition of 1.5 times the inter-quartile range, that is, <em>1.5 * (Q3 - Q1)</em>, or standard deviation. The purpose is to isolate the outlier data and plot them as separate points which can be put into scatter data points along with the box plot. Here, we use the simplest form of box plot: the maximum and minimum data points are regarded as the top <a id="id487" class="indexterm"/>and bottom whiskers respectively.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec56"/>Plotting the box plot chart</h2></div></div></div><p>In order to create a<a id="id488" class="indexterm"/> box plot chart, we need to load an additional library, <code class="literal">highcharts-more.js</code>:</p><div><pre class="programlisting">&lt;script src="img/highcharts-more.js"&gt;&lt;/script&gt;</pre></div><p>Highcharts offers a set of options to shape and style the box plot series, such as the line width, style, and color, which are shown in the following code snippet:</p><div><pre class="programlisting">          plotOptions: {
              boxplot: {
                  lineWidth: 2,
                  fillColor: '#808080',
                  medianColor: '#FFFFFF',
                  medianWidth: 2,
                  stemColor: "#808080",
                  stemDashStyle: 'dashdot',
                  stemWidth: 1,
                  whiskerColor: '#808080',
                  whiskerWidth: 2,
                  whiskerLength: '120%'
              }
          },</pre></div><p>The <code class="literal">lineWidth</code> option is the overall line width of the boxplot, and <code class="literal">fillColor</code> is for the color inside the box. The <code class="literal">median</code> options refer to the horizontal median line inside the box whereas the <code class="literal">stem</code> options are for the line between the quartile and whisker. The <code class="literal">whiskerLength</code> option is the ratio that corresponds to the width of the quartile box. In this example, we will enlarge the <code class="literal">whiskerLength</code> option for ease of visualization, as there are a number of box plots packed into the graph.</p><p>The series data values for a box plot are listed in array form in ascending order, so from the bottom to top whisker. The following shows a sample of series data:</p><div><pre class="programlisting">        series: [{
            type: 'boxplot',
            data: [
                   [16.855, 19.287, 26.537, 31.368, 33.035 ],
                   [16.139, 18.668, 25.33, 30.632, 32.385 ],
                   [12.589, 15.536, 23.5495, 28.960, 30.848 ],
                   [13.395, 16.399, 22.078, 27.013, 29.146 ],
                   ....
            ]
        }]</pre></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec57"/>Making sense with the box plot data</h2></div></div></div><p>Before we dive into an <a id="id489" class="indexterm"/>example with real-life data, it is worth looking at an excellent article (<a class="ulink" href="http://junkcharts.typepad.com/junk_charts/2014/04/an-overused-chart-why-it-fails-and-how-to-fix-it.html">http://junkcharts.typepad.com/junk_charts/2014/04/an-overused-chart-why-it-fails-and-how-to-fix-it.html</a>) by Kaiser <a id="id490" class="indexterm"/>Fund, a marketing analytics and data visualization expert who also authored a couple of books on big data crunching. In the article, Kaiser raises an observation of a spider chart from a <a id="id491" class="indexterm"/>video <em>Arctic Death Spiral</em> (<a class="ulink" href="http://youtu.be/20pjigmWwiw">http://youtu.be/20pjigmWwiw</a>), as follows:</p><div><img src="img/7451OS_07_11.jpg" alt="Making sense with the box plot data"/></div><p>The video demonstrates how the arctic sea ice volume (each month per series over the years) spirals towards the center at an alarming rate. He argues that using a spider chart doesn't do justice to the important message in the data. To summarize his arguments:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It is difficult for readers to comprehend the real downward trend scale in a circular chart.</li><li class="listitem" style="list-style-type: disc">Humans perceive time series data more naturally in a horizontal progression than in a circular motion.</li><li class="listitem" style="list-style-type: disc">If the movement of monthly data within a year fluctuates more than other years, we will have multiple line series crossing each other. As a result, we have a plateful of spaghetti instead of a comprehensible chart.</li></ul></div><p>In order to fix this, Kaiser suggests that a box plot is the best candidate. Instead of having 12 multiple series lines crammed together, he uses a box plot to represent the annual data distribution. The 12 months' data for each year are sorted and only the median, quartiles, and extreme values are substituted into the box plot. Although small details are lost due to less data, the range and scale of the downward trend over time are better represented in this case.</p><p>The following is the <a id="id492" class="indexterm"/>final box plot presentation in Highcharts:</p><div><img src="img/7451OS_07_12.jpg" alt="Making sense with the box plot data"/></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec58"/>The box plot tooltip</h2></div></div></div><p>Since the box plot series <a id="id493" class="indexterm"/>holds various values, the series has different property names—<code class="literal">low</code>, <code class="literal">q1</code>, <code class="literal">median</code>, <code class="literal">q3</code>, <code class="literal">high</code>—to refer to them. The following illustrates an example of <code class="literal">tooltip.formatter</code>:</p><div><pre class="programlisting">      chart: {
          ....
      },
      ....,
      tooltip: {
          formatter: function() {
              return "In year: " + this.x + ", &lt;br&gt;" +
                     "low: " + this.point.low + ", &lt;br&gt;" +
                     "Q1: " + this.point.q1 + ", &lt;br&gt;" +
                     "median: " + this.point.median + ", &lt;br&gt;" + 
                     "Q3: " + this.point.q3 + ", &lt;br&gt;" +
                     "high: " + this.point.high;
              }
          },
      series: [{
          ....
      }]</pre></div><p>Note that <code class="literal">formatter</code> should be<a id="id494" class="indexterm"/> added to the <code class="literal">tooltip</code> property of the main options object, and not in the <code class="literal">series</code> object. Here is what the box plot tooltip looks like:</p><div><img src="img/7451OS_07_13.jpg" alt="The box plot tooltip"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec51"/>The error bar chart</h1></div></div></div><p>An error bar is <a id="id495" class="indexterm"/>another technical chart that shows the standard error, which is the standard deviation divided by the square root of the sample size. It means that as the sample size increases, the variation from the sample mean diminishes. The error bar series has similar color and style options as the box plot but only applies to whisker and stem:</p><div><pre class="programlisting">               plotOptions: {
                   errorbar: {
                       stemColor: "#808080",
                       stemDashStyle: 'dashdot',
                       stemWidth: 2,
                       whiskerColor: '#808080',
                       whiskerWidth: 2,
                       whiskerLength: '20%'
                   }
               },</pre></div><p>The same also applies to the tooltip formatter, in which <code class="literal">low</code> and <code class="literal">high</code> refer to both ends of the error bar. As for the series data option, it takes an array of tuples of lower and upper values:</p><div><pre class="programlisting">        series: [{
            type: 'column',
            data: ....
        }, {
            name: 'error range',
            type: 'errorbar',
            data: [
                   [ 22.76, 23.404 ],
                   [ 25.316, 29.976 ],</pre></div><p>To demonstrate <a id="id496" class="indexterm"/>the error bar, we use the F1 pit stop times from all the teams in each circuit from <a class="ulink" href="http://www.formula1.com/results/season/2013">http://www.formula1.com/results/season/2013</a>. We plot the mean of each circuit in a column series. We then calculate the standard error and apply the result to the mean. Here is a screenshot of the error bar chart:</p><div><img src="img/7451OS_07_14.jpg" alt="The error bar chart"/></div><p>Note that when displaying an error bar series with a column series, the column series has to be specified before the error bar series in the series array. Otherwise, half of the error bar is blocked by the column, as in the following example:</p><div><img src="img/7451OS_07_15.jpg" alt="The error bar chart"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Summary</h1></div></div></div><p>In this chapter, we have learned about bubble charts and how bubble sizes are determined. We also tested the bubble chart series by recreating a real-life chart. We examined the box plot principle and structure, and practiced how to turn data samples into percentile data and layout into a box plot chart. Finally, we studied error bar charts by using some statistical data.</p><p>In the next chapter, we will investigate the properties of waterfall, funnel, pyramid, and heatmap charts and experiment with them.</p></div></body></html>