<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Working with Controls</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding and removing controls</li><li class="listitem" style="list-style-type: disc">Changing the position of controls</li><li class="listitem" style="list-style-type: disc">Creating and adding a geolocation control</li><li class="listitem" style="list-style-type: disc">Creating a table of contents control for layers</li><li class="listitem" style="list-style-type: disc">Adding your own logo as a control</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Introduction</h1></div></div></div><p>This chapter covers the controls that are found in the <a id="id288" class="indexterm"/>Google Maps JavaScript API. Generally speaking, controls are UI elements that interact with the user. At a very basic level, they comprise of simple HTML elements or a combination of them.</p><p>Controls <a id="id289" class="indexterm"/>enable the user to pan the map, zoom in or out, measure distances or areas, and so on. Complex controls involve the administration of multiple overlay layers (introduced in <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>) in the form of a <a id="id290" class="indexterm"/>
<strong>table of contents</strong> (<strong>ToC</strong>) control, or an editing toolbar for drawing vector features.</p><p>The Google Maps JavaScript API presents developers with the opportunity to use and customize built-in controls as well as build custom controls from the ground up.</p><p>This chapter will first focus on dealing with built-in controls and their configurations in detail, including the customization of the UI. Then, creating custom controls from very basic to complex ones (such as ToCs) will be covered.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec37"/>Adding and removing controls</h1></div></div></div><p>The Google Maps default UI<a id="id291" class="indexterm"/> has several controls that are displayed by default or if certain conditions are met. These include:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Zoom control</li><li class="listitem" style="list-style-type: disc">Pan control</li><li class="listitem" style="list-style-type: disc">MapType control</li><li class="listitem" style="list-style-type: disc">Scale control</li><li class="listitem" style="list-style-type: disc">Street View control</li><li class="listitem" style="list-style-type: disc">Rotate control</li><li class="listitem" style="list-style-type: disc">Overview Map control</li></ul></div><p>The <a id="id292" class="indexterm"/>Google Maps JavaScript <a id="id293" class="indexterm"/>API presents the opportunity for developers to opt in or out of these controls or customize them in terms of functionality or look.</p><p>In this recipe, we will cover ways to alter the UI by adding or removing built-in controls and how to change their properties through presented options.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec108"/>Getting ready</h2></div></div></div><p>The first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, will do our work. We will alter it for this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec109"/>How to do it…</h2></div></div></div><p>You will opt for the appearance of the built-in controls if you perform the following step:</p><div><ol class="orderedlist arabic"><li class="listitem">Alter the <code class="literal">mapOptions</code> object as follows:<div><pre class="programlisting">var mapOptions = {
  center: new google.maps.LatLng(43.771094,11.25033),
  zoom: 13,
  mapTypeId: google.maps.MapTypeId.ROADMAP,
  panControl: true,
  scaleControl: false,
  zoomControl: true,
  zoomControlOptions: {
    style: google.maps.ZoomControlStyle.SMALL
  },
  overviewMapControl: true,
  overviewMapControlOptions: {
    opened: true
  },
  mapTypeControl: false
}</pre></div><div><img src="img/8825OT_04_01.jpg" alt="How to do it…"/></div></li></ol></div><p>You can have your built-in controls On or Off according to your taste as displayed in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec110"/>How it works...</h2></div></div></div><p>You might have <a id="id294" class="indexterm"/>observed<a id="id295" class="indexterm"/> that we have added a lot to the <code class="literal">mapOptions</code> object. This is because you can make the controls visible or invisible in the <code class="literal">google.maps.mapOptions</code> object:</p><div><pre class="programlisting">panControl: true,
scaleControl: false,
zoomControl: true,
mapTypeControl: false,
overviewMapControl: true</pre></div><p>By assigning Boolean (true/false) values, you can display <code class="literal">panControl</code>, <code class="literal">zoomControl</code>, and <code class="literal">overviewMapControl</code>, while <code class="literal">scaleControl</code> and <code class="literal">mapTypeControl</code> are hidden.</p><p>Some controls appear by default. For instance, we have not mentioned <code class="literal">streetViewControl</code> in our<a id="id296" class="indexterm"/> <code class="literal">mapOptions</code> object; however, it is displayed in the interface because it is there by default. The built-in controls and their default presence in the UI are as follows:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Control name</p>
</th><th style="text-align: left" valign="bottom">
<p>Default presence</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Zoom control</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Pan control</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Scale control</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>MapType control</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Street View control</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rotate control</p>
</td><td style="text-align: left" valign="top">
<p>Yes (for oblique imagery)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Overview Map control</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td></tr></tbody></table></div><p>Although <code class="literal">rotateControl</code> is displayed by <a id="id297" class="indexterm"/>default, you might have noticed that it is not found in the <a id="id298" class="indexterm"/>interface because it appears only when oblique imagery is shown. Tweaking the <code class="literal">mapOptions</code> object as follows, we can view the control:</p><div><ol class="orderedlist arabic"><li class="listitem">Enable <code class="literal">mapTypeControl</code> so that you can select satellite imagery in the UI, as shown in the screenshot following the code:<div><pre class="programlisting">  mapTypeControl: true</pre></div><div><img src="img/8825OT_04_02.jpg" alt="How it works..."/></div></li></ol></div><p>You can see <code class="literal">mapTypeControl</code> in the preceding screenshot.</p><p>Oblique imagery (45 degree imagery) is served in certain locations, and wherever present, <code class="literal">mapTypeControl</code> updates itself to include a submenu toggle for displaying oblique imagery.</p><p>The <code class="literal">RotateControl</code> control<a id="id299" class="indexterm"/> is displayed between the Pan and Zoom controls. It allows users to rotate the oblique imagery at 90 degree intervals. Also, the Pan control is altered to have a ring, letting us change the heading of the oblique imagery when it is displayed:</p><div><img src="img/8825OT_04_03.jpg" alt="How it works..."/></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec111"/>There's more...</h2></div></div></div><p>The Google Maps JavaScript API<a id="id300" class="indexterm"/> allows us to not only toggle the built-in controls between On and Off, but also customize their properties and styles. For instance:</p><div><pre class="programlisting">overviewMapControlOptions: {
  opened: true
}</pre></div><p>This sets the Overview Map control in the <code class="literal">opened</code> state. Please remember that the Overview Map control's default state is collapsed, and this setting sets the control to <code class="literal">opened</code> at the start of your application. You can collapse or open the control whenever you want by pressing the small arrow in the lower-right corner of the control.</p><p>For the Zoom control, the options presented in the recipe are as follows:</p><div><pre class="programlisting">zoomControlOptions: {
  style: google.maps.ZoomControlStyle.SMALL
}</pre></div><p>This option sets the Zoom control to be styled as small, comprising of two small buttons, one for zoom in and the other for zoom out. Other options for the <code class="literal">style</code> property for <code class="literal">zoomControlOptions</code> are:</p><div><pre class="programlisting">google.maps.ZoomControlStyle.LARGE
google.maps.ZoomControlStyle.DEFAULT</pre></div><p>The <code class="literal">LARGE</code> option sets the <a id="id301" class="indexterm"/>Zoom control to be seen as a long stick where you can traverse between zoom levels. The <code class="literal">DEFAULT</code> option decides whether to display either the large Zoom controls or the small Zoom controls according to the screen size.</p><p>You might have noted that options for controls are handled by objects with the <code class="literal">Options</code> suffix. In the same manner, there are options for <code class="literal">mapTypeControl</code> as well within the <code class="literal">MapTypeControlOptions</code> object. Adding the following lines to the code will make some alterations:</p><div><pre class="programlisting">mapTypeControl: true,
mapTypeControlOptions: {
  mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.HYBRID],
  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
}</pre></div><p>The settings in the <code class="literal">mapTypeControlOptions</code> property make <code class="literal">mapTypeControl</code> offer only the <code class="literal">ROADMAP</code> and <code class="literal">HYBRID</code> map types, so you will not be able to select the <code class="literal">SATELLITE</code> and <code class="literal">TERRAIN</code> map types. As you would recall from <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>, the <code class="literal">mapTypeIds</code> property not only accepts built-in map types, but also styled map types through a <code class="literal">StyledMapType</code> object and any tiled image source—either as a base map or overlay map—through the <code class="literal">ImageMapType</code> object.</p><p>The second property, <code class="literal">style</code>, sets <code class="literal">mapTypeControl</code> to be displayed as a drop-down menu instead of a standard horizontal bar. The other options for the <code class="literal">style</code> property of <code class="literal">mapTypeControlOptions</code> are:</p><div><pre class="programlisting">google.maps.MapTypeControlStyle.HORIZONTAL_BAR
google.maps.MapTypeControlStyle.DEFAULT</pre></div><p>The <code class="literal">DEFAULT</code> option is for dynamically picking the Zoom control as either a horizontal bar or a drop-down menu according to the screen estate.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>
<strong>Complete options list for controls</strong>
</p><p>The complete options list for controls can be found at the Google Maps JavaScript API Reference documentation URL <a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference">https://developers.google.com/maps/documentation/javascript/reference</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec38"/>Changing the position of controls</h1></div></div></div><p>Google Maps controls<a id="id302" class="indexterm"/> have their default positions, and the Google Maps JavaScript <a id="id303" class="indexterm"/>API offers a level of flexibility over changing these default positions. You can also position your custom controls according to the places in the UI that are offered as in the following screenshot:</p><div><img src="img/8825OT_04_04.jpg" alt="Changing the position of controls"/></div><p>The preceding screenshot depicts the possible locations where you can place your controls. It is noteworthy that <strong>TOP_LEFT</strong> is not equal to <strong>LEFT_TOP</strong>, with <strong>TOP_LEFT</strong> the first one on the top.</p><p>In this recipe, we will describe how to specify the corresponding positions of controls in the Google Maps UI.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec112"/>Getting ready</h2></div></div></div><p>This recipe is based on the previous recipe's code; therefore, having that will do most of our work.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec113"/>How to do it…</h2></div></div></div><p>You can flush the <a id="id304" class="indexterm"/>positioning of <a id="id305" class="indexterm"/>the controls with the following step:</p><div><ol class="orderedlist arabic"><li class="listitem">Completely renew the <code class="literal">mapOptions</code> object as follows:<div><pre class="programlisting">var mapOptions = {
  center: new google.maps.LatLng(43.771094,11.25033),
  zoom: 13,
  mapTypeId: google.maps.MapTypeId.ROADMAP,
  panControl: true,
  panControlOptions: {
    position:google.maps.ControlPosition.TOP_RIGHT
  },
  zoomControl: true,
  zoomControlOptions: {
    style: google.maps.ZoomControlStyle.SMALL,
    position: google.maps.ControlPosition.BOTTOM_CENTER
  },
  mapTypeControl: true,
  mapTypeControlOptions: {
    position: google.maps.ControlPosition.LEFT_TOP
  },
  streetViewControlOptions: {
    position: google.maps.ControlPosition.LEFT_CENTER
  }
};</pre></div><div><img src="img/8825OT_04_05.jpg" alt="How to do it…"/></div></li></ol></div><p>You can change your <a id="id306" class="indexterm"/>controls' positions in the map UI as per your taste as you can observe in the <a id="id307" class="indexterm"/>preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec114"/>How it works...</h2></div></div></div><p>In the <code class="literal">mapOptions</code> object, we have specified each control's position by its <code class="literal">position</code> property in its own options as you can see in the following code snippet:</p><div><pre class="programlisting">mapTypeControlOptions: {
  position: google.maps.ControlPosition.LEFT_TOP
}</pre></div><p>The following code directs <code class="literal">mapTypeControl</code> to be placed in the left-top corner of the map's <code class="literal">div</code> element, while <code class="literal">panControl</code> is placed in the top-right corner:</p><div><pre class="programlisting">panControlOptions:{
  position: google.maps.ControlPosition.TOP_RIGHT
},</pre></div><div><div><h3 class="title"><a id="note10"/>Note</h3><p>
<strong>Complete listing for control positions</strong>
</p><p>The complete listing for control positions can be found at the Google Maps JavaScript API Reference documentation URL (<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#ControlPosition">https://developers.google.com/maps/documentation/javascript/reference#ControlPosition</a>).</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec39"/>Creating and adding a geolocation control</h1></div></div></div><p>The Google Maps UI<a id="id308" class="indexterm"/> has many built-in controls introduced in previous recipes. These controls serve numerous needs, such as panning, zooming, and changing the map type. However, the user needs are infinite, and the user might be very creative. It is impossible to present a built-in control for every need.</p><p>Instead, the Google Maps JavaScript API has presented a path for creating custom controls for every specific need. Custom controls are basically simple HTML elements wrapped in a single element, mostly the <code class="literal">&lt;div&gt;</code> element.</p><p>In this recipe, we will go over the basics of <a id="id309" class="indexterm"/>creating a custom control, placing it on the Google <a id="id310" class="indexterm"/>Maps UI, and using it through event-handling routines.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec115"/>Getting ready</h2></div></div></div><p>This recipe will be based on the <em>Moving from Web to mobile devices</em> recipe introduced in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>. Our recipe will utilize the geolocation code extract from this recipe; therefore, it will be helpful to revisit this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec116"/>How to do it…</h2></div></div></div><p>You will have a brand new custom geolocation control if you perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, create a JavaScript object that will be our custom control at the end (the constructor will take two parameters that will be explained in the later steps):<div><pre class="programlisting">function GeoLocationControl(geoLocControlDiv, map){
}</pre></div></li><li class="listitem">Inside the <code class="literal">GeoLocationControl</code> class, set the <code class="literal">class</code> property to contain the <code class="literal">div</code> element referenced as the first argument in the constructor:<div><pre class="programlisting">geoLocControlDiv.className = 'controlContainer';</pre></div></li><li class="listitem">Inside the<a id="id311" class="indexterm"/> <code class="literal">GeoLocationControl</code> class, set the internal HTML <code class="literal">div</code> element details, including its <code class="literal">class</code> attribute, so that this element looks like a button:<div><pre class="programlisting">var controlButton = document.createElement('div');
controlButton.className = 'controlButton';
controlButton.innerHTML = 'Geolocate';</pre></div></li><li class="listitem">Add this internal <code class="literal">div</code> element (<code class="literal">controlButton</code>) to the container <code class="literal">div</code> element as follows:<div><pre class="programlisting">geoLocControlDiv.appendChild(controlButton);</pre></div></li><li class="listitem">Add the <code class="literal">click</code> event listener for <code class="literal">controlButton</code> inside the <code class="literal">GeoLocationControl</code> class:<div><pre class="programlisting">google.maps.event.addDomListener(controlButton, 'click', function() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
        var lat = position.coords.latitude;
        var lng = position.coords.longitude;
        var devCenter = new google.maps.LatLng(lat, lng);
        map.setCenter(devCenter);
        map.setZoom(15);

        var marker = new google.maps.Marker({
          position: devCenter,
          map: map,
        });

    });
  }
});</pre></div></li><li class="listitem">Now, in the <a id="id312" class="indexterm"/>ordinary <code class="literal">initMap()</code> function that we<a id="id313" class="indexterm"/> have used over all the recipes, add the container HTML <code class="literal">div</code> element in addition to the standard definition of the <code class="literal">map</code> and <code class="literal">mapOptions</code> objects:<div><pre class="programlisting">var geoLocationControlDiv = document.createElement('div');</pre></div></li><li class="listitem">Instantiate the custom control class, the <code class="literal">GeoLocationControl</code> class inside <code class="literal">initMap()</code>, supplying two arguments: the container <code class="literal">div</code> element created in the previous step and the <code class="literal">map</code> object itself:<div><pre class="programlisting">var geoLocationControl = new GeoLocationControl(geoLocationControlDiv, map);</pre></div></li><li class="listitem">Place the custom control among other controls in the map UI:<div><pre class="programlisting">map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(geoLocationControlDiv);</pre></div></li></ol></div><div><img src="img/8825OT_04_06.jpg" alt="How to do it…"/></div><p>You should have a custom control functioning as a geolocation control as seen in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec117"/>How it works...</h2></div></div></div><p>This recipe might<a id="id314" class="indexterm"/> seem confusing compared to the preceding recipes, but in <a id="id315" class="indexterm"/>essence, there is just one important point to create custom controls in the Google Maps JavaScript API; you can utilize any HTML element to be used as a custom control. In fact, the following simple code extract is sufficient to have a custom control:</p><div><pre class="programlisting">var controlDiv = document.createElement('div');
map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(controlDiv);</pre></div><p>This code creates an HTML <code class="literal">div</code> element and then adds it to the controls array of the <code class="literal">map</code> object. The controls array is a two-dimensional array, the first dimension being the available positions defined in the <code class="literal">google.maps.ControlPosition</code> class and the second dimension being the controls. This transparent control with no label inside will do anything as there is no event-handling code for the <code class="literal">div</code> element; however, this reality does not change the fact that this is a custom control.</p><p>Other details, such as <a id="id316" class="indexterm"/>CSS styling, filling in attributes, and event <a id="id317" class="indexterm"/>handling, are necessary for a professional custom control to be used for map UI users.</p><p>In our recipe, we have chosen to create a JavaScript class to wrap all these details in order to be structural:</p><div><pre class="programlisting">function GeoLocationControl(geoLocControlDiv, map)
{
}</pre></div><p>Our class constructor makes use of two elements: the container <code class="literal">div</code> element and the <code class="literal">map</code> object. It needs the reference for the container <code class="literal">div</code> element to add the child element <code class="literal">controlButton</code> to it:</p><div><pre class="programlisting">geoLocControlDiv.appendChild(controlButton);</pre></div><p>The <code class="literal">controlButton</code> object (an HTML <code class="literal">div</code> element) has to respond to some user-originated events for the custom control to be useful and meaningful:</p><div><pre class="programlisting">google.maps.event.addDomListener(controlButton, 'click', 
function() {

});</pre></div><p>The <code class="literal">google.maps.event.addDomListener</code> method acts as an event handler registration, and it works in the same way on every browser. These method- and event-related subjects will be covered in <a class="link" href="ch05.html" title="Chapter 5. Understanding Google Maps JavaScript API Events">Chapter 5</a>, <em>Understanding Google Maps JavaScript API Events</em>. For now, it is alright to be aware of the <code class="literal">click</code> event, which will be listened to by the <code class="literal">controlButton</code> object.</p><p>The geolocation code extract from <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics,</em> resides inside the <code class="literal">addDomListener</code> method, making use of the Geolocation API of the browser. If there is support for the Geolocation API and if the location is retrieved, a marker is added to the map for this location:</p><div><pre class="programlisting">var marker = new google.maps.Marker({
  position: devCenter,
  map: map,
});</pre></div><p>This whole creation of child elements and event-handling logic is enveloped in one JavaScript class constructor, which is called by the following:</p><div><pre class="programlisting">var geoLocationControl = new GeoLocationControl(geoLocationControlDiv, map);</pre></div><p>The following <a id="id318" class="indexterm"/>is the<a id="id319" class="indexterm"/> only other code snippet required to accomplish this task:</p><div><pre class="programlisting">map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(geoLocationControlDiv);</pre></div><p>It is worth noting that the <code class="literal">controls</code> array takes the container <code class="literal">div</code> element as the custom control. Also, bear in mind that <code class="literal">controls[google.maps.ControlPosition.RIGHT_CENTER]</code> might already have other controls in other scenarios. We are using <code class="literal">push</code> so that the existing controls are not replaced.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Creating a table of contents control for layers</h1></div></div></div><p>Table of Contents (ToC) controls <a id="id320" class="indexterm"/>such as UI elements are very common in desktop GIS software, such as<a id="id321" class="indexterm"/> ArcGIS Desktop, <a id="id322" class="indexterm"/>Mapinfo, and<a id="id323" class="indexterm"/> Geomedia. Also, their web counterparts make use of ToCs intensively in their UI, including ArcGIS and .Net web components.</p><p>The main use of ToCs is <a id="id324" class="indexterm"/>to turn On and Off the various<a id="id325" class="indexterm"/> raster or vector layers so as to overlay and view multiple strata of data. For vector layers, the options might be enriched by allowing the users to change the symbology of the vector layer with respect to ToCs.</p><p>The Google Maps UI does not have a built-in ToC control; however, with the flexibility of building up a custom control, there are virtually infinite possibilities.</p><p>The Google Maps JavaScript API allows developers to utilize the third-party base maps such as OpenStreetMaps<a id="id326" class="indexterm"/> or display the overlay raster layers on top of base maps (discussed in detail in <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>). Also, in <a class="link" href="ch03.html" title="Chapter 3. Adding Vector Layers">Chapter 3</a>, <em>Adding Vector Layers</em>, various kinds of vector data has been overlaid in the respective recipes.</p><p>In this recipe, we will only take base maps to be shown on our ToC in order to have an understanding of the structure, including keeping the state of the control and having multiple event handlers for multiple HTML elements wrapped in one control. This structure might be, of course, enriched with the addition of overlay and vector layers.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec118"/>Getting ready</h2></div></div></div><p>This recipe will make use of the <em>Using different tile sources as base maps</em> recipe in <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>. It would be extremely helpful to review this recipe before beginning our current recipe. Also, to understand how a simple custom control is created, the previous recipe will be key.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec119"/>How to do it…</h2></div></div></div><p>The following <a id="id327" class="indexterm"/>are the steps to create a working ToC <a id="id328" class="indexterm"/>control inside the Google Maps UI:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a JavaScript class that will contain all our child controls and event handlers (up to step 12, all code will be embedded in this class constructor):<div><pre class="programlisting">function TableOfContentsControl(tocControlDiv, map){
}</pre></div></li><li class="listitem">Have <code class="literal">this</code> as a variable as it will be out of scope in the event handlers:<div><pre class="programlisting">var tocControl = this;</pre></div></li><li class="listitem">Set the CSS properties of the container <code class="literal">div</code> element inside the class constructor:<div><pre class="programlisting">tocControlDiv.className ='tocControl';</pre></div></li><li class="listitem">Set the title of the ToC:<div><pre class="programlisting">var tocLabel = document.createElement('label');
tocLabel.appendChild(document.createTextNode('Base Layers'));
tocControlDiv.appendChild(tocLabel);</pre></div></li><li class="listitem">Create a radio button for the <strong>OpenStreetMap Base Map</strong>:<div><pre class="programlisting">var osmStuffDiv = document.createElement('div');

var osmRadioButton = document.createElement('input');
osmRadioButton.type = 'radio';
osmRadioButton.name = 'BaseMaps';
osmRadioButton.id = 'OSM';
osmRadioButton.checked = false;

var osmLabel = document.createElement('label');
osmLabel.htmlFor = osmRadioButton.id;
osmLabel.appendChild(document.createTextNode('OpenStreetMap Base Map'));

osmStuffDiv.appendChild(osmRadioButton);
osmStuffDiv.appendChild(osmLabel);</pre></div></li><li class="listitem">Create a radio button for the <strong>Google Roadmap</strong> base map:<div><pre class="programlisting">var roadmapStuffDiv = document.createElement('div');

var roadmapRadioButton = document.createElement('input');
roadmapRadioButton.type = 'radio';
roadmapRadioButton.name = 'BaseMaps';
roadmapRadioButton.id = 'Roadmap';
roadmapRadioButton.checked = true;

var roadmapLabel = document.createElement('label');
roadmapLabel.htmlFor = roadmapRadioButton.id;
roadmapLabel.appendChild(document.createTextNode('Google Roadmap'));

roadmapStuffDiv.appendChild(roadmapRadioButton);
roadmapStuffDiv.appendChild(roadmapLabel);</pre></div></li><li class="listitem">Create a radio button for the <strong>Google Satellite</strong> base map:<div><pre class="programlisting">var satelliteStuffDiv = document.createElement('div');

var satelliteRadioButton = document.createElement('input');
satelliteRadioButton.type = 'radio';
satelliteRadioButton.name = 'BaseMaps';
satelliteRadioButton.id = 'Satellite';
satelliteRadioButton.checked = false;

var satelliteLabel = document.createElement('label');
satelliteLabel.htmlFor = roadmapRadioButton.id;
satelliteLabel.appendChild(document.createTextNode('Google Satellite'));

satelliteStuffDiv.appendChild(satelliteRadioButton);
satelliteStuffDiv.appendChild(satelliteLabel);</pre></div></li><li class="listitem">Put all the <a id="id329" class="indexterm"/>radio buttons and their<a id="id330" class="indexterm"/> labels in the parent <code class="literal">div</code> element:<div><pre class="programlisting">tocControlDiv.appendChild(osmStuffDiv);
tocControlDiv.appendChild(roadmapStuffDiv);
tocControlDiv.appendChild(satelliteStuffDiv);</pre></div></li><li class="listitem">Create the <code class="literal">click</code> event handler for <code class="literal">osmRadioButton</code> (the <code class="literal">setActiveBasemap</code> and <code class="literal">getActiveBasemap</code> methods will be clarified in the following code):<div><pre class="programlisting">google.maps.event.addDomListener(osmRadioButton, 'click', 
function() {
     if (osmRadioButton.checked) {
         tocControl.setActiveBasemap('OSM');
         map.setMapTypeId(tocControl.getActiveBasemap());
      }
});</pre></div></li><li class="listitem">Create the <code class="literal">click</code> event handler for <code class="literal">roadmapRadioButton</code> as follows:<div><pre class="programlisting">google.maps.event.addDomListener(roadmapRadioButton, 
'click', function() {
    if (roadmapRadioButton.checked){
        tocControl.setActiveBasemap
(google.maps.MapTypeId.ROADMAP);
        map.setMapTypeId(tocControl.getActiveBasemap());
     }
});</pre></div></li><li class="listitem">Create the <code class="literal">click</code> event handler for <code class="literal">satelliteRadioButton</code>:<div><pre class="programlisting">google.maps.event.addDomListener(satelliteRadioButton, 
'click', function() {
     if (satelliteRadioButton.checked) {
          tocControl.setActiveBasemap
(google.maps.MapTypeId.SATELLITE);
          map.setMapTypeId(tocControl.getActiveBasemap());
       }
});</pre></div></li><li class="listitem">Outside <a id="id331" class="indexterm"/>the <code class="literal">TableOfContentsControl</code> class <a id="id332" class="indexterm"/>constructor, define a property for keeping the active base map:<div><pre class="programlisting">TableOfContentsControl.prototype._activeBasemap = null;</pre></div></li><li class="listitem">Define the getter and setter methods for the <code class="literal">_activeBasemap</code> property:<div><pre class="programlisting">TableOfContentsControl.prototype.getActiveBasemap = 
function() {
  return this._activeBasemap;
};

TableOfContentsControl.prototype.setActiveBasemap = 
function(basemap) {
  this._activeBasemap = basemap;
};</pre></div></li><li class="listitem">In the <code class="literal">initMap()</code> function, define the <code class="literal">mapOptions</code> object as follows:<div><pre class="programlisting">var mapOptions = {
  center: new google.maps.LatLng(39.9078, 32.8252),
  zoom: 10,
  mapTypeControlOptions: {
    mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE, 'OSM']
  },
  mapTypeControl: false
};</pre></div></li><li class="listitem">Define the <code class="literal">osmMapType</code> object as <code class="literal">ImageMapType</code>:<div><pre class="programlisting">var osmMapType = new google.maps.ImageMapType({
  getTileUrl: function(coord, zoom) {
    return 'http://tile.openstreetmap.org/' + zoom + '/' + coord.x + '/' + coord.y + '.png';
  },
  tileSize: new google.maps.Size(256, 256),
  name: 'OpenStreetMap',
  maxZoom: 18
});</pre></div></li><li class="listitem">Relate<a id="id333" class="indexterm"/> the <code class="literal">'OSM' mapTypeId</code> object to the <code class="literal">osmMapType</code> <a id="id334" class="indexterm"/>object:<div><pre class="programlisting">map.mapTypes.set('OSM', osmMapType);</pre></div></li><li class="listitem">Set <code class="literal">mapTypeId</code> for startup:<div><pre class="programlisting">map.setMapTypeId(google.maps.MapTypeId.ROADMAP);</pre></div></li><li class="listitem">Create the container <code class="literal">div</code> element, instantiate the <code class="literal">TableOfContentsControl</code> class, and position the container <code class="literal">div</code> element as a custom control:<div><pre class="programlisting">var tableOfContentsControlDiv = document.createElement('div');

var tableOfContentsControl = new TableOfContentsControl(tableOfContentsControlDiv, map);

map.controls[google.maps.ControlPosition.TOP_RIGHT].push(tableOfContentsControlDiv);</pre></div><div><img src="img/8825OT_04_07.jpg" alt="How to do it…"/></div></li></ol></div><p>You should have<a id="id335" class="indexterm"/> your own ToC control as a custom<a id="id336" class="indexterm"/> control in your map's UI as observed in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec120"/>How it works...</h2></div></div></div><p>This recipe actually carries the same structure as the previous recipe; however, there are HTML elements in the custom control that make it seem more complex. We will take a look at the details bit by bit so that things will become clearer. As in the previous recipe, we have started by creating a JavaScript class constructor that embeds all the details, including the necessary radio buttons and their event handlers:</p><div><pre class="programlisting">function TableOfContentsControl(tocControlDiv, map){
}</pre></div><p>The radio button section for <code class="literal">osmRadioButton</code> embedded in <code class="literal">TableOfContentsControl</code> is as follows:</p><div><pre class="programlisting">var osmRadioButton = document.createElement('input');
osmRadioButton.type = 'radio';
osmRadioButton.name = 'BaseMaps';
osmRadioButton.id = 'OSM';
osmRadioButton.checked = false;

var osmLabel = document.createElement('label');
osmLabel.htmlFor = osmRadioButton.id;
osmLabel.appendChild(document.createTextNode('OpenStreetMap Base Map'));

tocControlDiv.appendChild(osmRadioButton);
tocControlDiv.appendChild(osmLabel);


google.maps.event.addDomListener(osmRadioButton, 'click', 
function() {
    if (osmRadioButton.checked) {
        tocControl.setActiveBasemap('OSM');
        map.setMapTypeId(tocControl.getActiveBasemap());
    }
});</pre></div><p>The <a id="id337" class="indexterm"/>preceding code extract for <code class="literal">osmRadioButton</code> is the <a id="id338" class="indexterm"/>same for <code class="literal">roadmapRadioButton</code> and <code class="literal">satelliteRadioButton</code>. The code creates the radio button and its associated label, adds it to the container <code class="literal">div</code> element (that is referenced as the first argument of the constructor), and then registers the <code class="literal">click</code> event for the radio button.</p><p>The <code class="literal">click</code> event checks whether the radio button is checked or not, then—if checked—it sets the active base map as an OSM base map. Then, it uses the active base map information to set <code class="literal">mapTypeId</code> for the map; this is referenced as the second argument of the constructor.</p><p>To set and get the active base map information, two methods are used:</p><div><pre class="programlisting">setActiveBasemap('OSM')
getActiveBasemap()</pre></div><p>These methods are defined outside the constructor as:</p><div><pre class="programlisting">TableOfContentsControl.prototype.getActiveBasemap = function() {
  return this._activeBasemap;
};

TableOfContentsControl.prototype.setActiveBasemap = 
function(basemap) {
     this._activeBasemap = basemap;
};</pre></div><p>Here, the <code class="literal">_activeBasemap</code> local variable is defined as:</p><div><pre class="programlisting">TableOfContentsControl.prototype._activeBasemap = null;</pre></div><p>There is just one tiny but important detail here. For the <code class="literal">click</code> event handler to see getter and setter methods of the <code class="literal">TableOfContentsControl</code> object, we have added a single line:</p><div><pre class="programlisting">var tocControl = this;</pre></div><p>Here, <code class="literal">this</code> would be out of scope inside the event handler.</p><p>The <a id="id339" class="indexterm"/>OpenStreetMap base map section is located in<a id="id340" class="indexterm"/> the <code class="literal">initMap()</code> function. The details of how to display external base maps are covered in <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>, so there is no need to go over specific bits and pieces on this.</p><p>The final piece of work is actually running the control in the UI. As we do not call the constructor of <code class="literal">TableOfContentsControl</code>, nothing will be shown as a custom ToC control. But, before having the ToC control, we have to reserve some estate in the <code class="literal">mapOptions</code> object:</p><div><pre class="programlisting">mapTypeControlOptions: {
  mapTypeIds: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE, 'OSM']
},
mapTypeControl:false</pre></div><p>In <code class="literal">mapTypeControlOptions</code>, we list the possible map type IDs for the map in the <code class="literal">mapTypeIds</code> property.</p><p>However, we do not need <code class="literal">maptypeControl</code> anymore as we would have a ToC control instead; therefore, we set the <code class="literal">mapTypeControl</code> property to <code class="literal">false</code>.</p><p>Then the last phase comes: placing the custom ToC control:</p><div><pre class="programlisting">var tableOfContentsControlDiv = document.createElement('div');

var tableOfContentsControl = new TableOfContentsControl(tableOfContentsControlDiv, map);

map.controls[google.maps.ControlPosition.TOP_RIGHT].push(tableOfContentsControlDiv);</pre></div><p>First, we create an arbitrary <code class="literal">div</code> that will act as a container <code class="literal">div</code> element for our custom control. Then, we call the constructor of the <code class="literal">TableOfContentsControl</code> class supplying the container <code class="literal">div</code> element and the <code class="literal">map</code> object as arguments. After that, the curtain closes with adding the <a id="id341" class="indexterm"/>container <code class="literal">div</code> element to the<a id="id342" class="indexterm"/> two-dimensional controls array that controls the <code class="literal">map</code> object in its default place in <code class="literal">mapTypeControl</code>; that is, <code class="literal">google.maps.ControlPosition.TOP_RIGHT</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Adding your own logo as a control</h1></div></div></div><p>The <a id="id343" class="indexterm"/>Google Maps JavaScript API<a id="id344" class="indexterm"/> has<a id="id345" class="indexterm"/> designed the addition of custom controls in a very flexible manner so that you can have a variable type of HTML elements in one HTML <code class="literal">div</code> element.</p><p>Adding your own logo of choice, such as adding your company's logo on top of the map UI in your own application, is a good sign for customization and shows off your work.</p><p>In this recipe, we will show a logo as a control in the map UI using the Google Maps JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec121"/>Getting ready</h2></div></div></div><p>This recipe will make use of the very first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, as we only need the basics to develop this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec122"/>How to do it…</h2></div></div></div><p>The following are the steps to display a logo as a custom control in the Google Maps UI:</p><div><ol class="orderedlist arabic"><li class="listitem">After creating the <code class="literal">map</code> object in the<a id="id346" class="indexterm"/> <code class="literal">initMap()</code> function, create the container <code class="literal">div</code> element:<div><pre class="programlisting">var logoDiv = document.createElement("div");</pre></div></li><li class="listitem">Then, create the HTML <code class="literal">img</code> element that contains your logo of preference:<div><pre class="programlisting">var logoPic = document.createElement("img");
logoPic.src = "ch04_logo.PNG";
logoPic.id = "CompanyLogo";</pre></div></li><li class="listitem">Insert the <code class="literal">img</code> element into the container <code class="literal">div</code> element:<div><pre class="programlisting">logoDiv.appendChild(logoPic);</pre></div></li><li class="listitem">Add the container <code class="literal">div</code> element to the <code class="literal">controls</code> array of the <code class="literal">map</code> object:<div><pre class="programlisting">map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(logoDiv);</pre></div><div><img src="img/8825OT_04_08.jpg" alt="How to do it…"/></div></li></ol></div><p>You can have<a id="id347" class="indexterm"/> the logo of your taste as a custom control in your map's UI as seen in the <a id="id348" class="indexterm"/>preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec123"/>How it works...</h2></div></div></div><p>The code of this recipe is actually the simplest form of custom controls in the Google Maps JavaScript API. There is no event handler for the control, and there is no state information in conjunction with the control. The only thing that exists is the control itself, which is the container div <code class="literal">logoDiv</code> element.</p><p>The <code class="literal">logoPic</code> element and the <code class="literal">img</code> element keep a reference to the logo file and are embedded in <code class="literal">logoDiv</code>:</p><div><pre class="programlisting">var logoPic = document.createElement("img");
logoPic.src = "ch04_logo.PNG";
logoDiv.appendChild(logoPic);</pre></div><p>Lastly, <code class="literal">logoDiv</code> is added to the <code class="literal">controls</code> array in the <strong>LEFT_BOTTOM</strong> position. When you open your application, you can see your logo in your map UI in its designated position.</p></div></div></body></html>