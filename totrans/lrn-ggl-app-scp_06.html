<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Creating Feed Reader and Translator Applications</h1></div></div></div><p>In the previous chapter, you learned to create Calendar events and Drive applications. You built many real-world applications.</p><p>In this chapter, you will learn to</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a Google search</li><li class="listitem" style="list-style-type: disc">Create a stock quote ticker</li><li class="listitem" style="list-style-type: disc">Create an RSS feed reader</li><li class="listitem" style="list-style-type: disc">Create an Atom feed reader</li><li class="listitem" style="list-style-type: disc">Create a language translator application</li><li class="listitem" style="list-style-type: disc">Creating a document reviewing and instant inline commenting application</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec57"/>The UrlFetchApp class</h1></div></div></div><p>The <code class="literal">UrlFetchApp</code> class can<a class="indexterm" id="id220"/> be used to issue HTTP/HTTPS request and get responses to/from any websites/URL. For example, the <code class="literal">UrlFetchApp.fetch ("https://ajax.googleapis.com/ajax/services/search/web?v=1.0&amp;q=PACKT")</code> code returns the search result with the search term <code class="literal">PACKT</code>. The response will be a raw content along with HTTP headers.</p><p>If the communication<a class="indexterm" id="id221"/> between the <code class="literal">UrlFetchApp</code> class's <code class="literal">fetch</code> method and the URL is okay then the URL should return a response code <code class="literal">200</code>. Otherwise, any other number corresponds to the type of error. We can check the response code before proceeding further using the <code class="literal">getResponseCode</code> method.</p><p>You can get the content text using the <code class="literal">getContentText</code> method and parsing it to JSON objects. The following code snippet pulls the content text and parses to JSON:</p><div><pre class="programlisting">var url = "https://ajax.googleapis.com/ajax/services/search /web?v=1.0&amp;q=PACKT";
try{
    var resp = UrlFetchApp.fetch(url);
    if(resp.getResponseCode() == 200){
      var text = resp.getContentText();
      var json = JSON.parse(text);
      Logger.log(json);
    }
  } catch(e){
    Logger.log(e);
  };</pre></div><p>For your understanding<a class="indexterm" id="id222"/> the logged output is furnished here (text might be truncated and formatted for brevity):</p><div><pre class="programlisting">{
  responseDetails=null,
  responseData={
    cursor={
      moreResultsUrl=http://www.google.com/search?oe=utf8&amp;ie=utf8
        &amp;source=uds&amp;start=0&amp;hl=en&amp;q=PACKT,
      resultCount=800,000,
      pages=[{start=0, label=1}, {start=4, label=2}, {start=8, 
        label=3}, {start=12, label=4}, {start=16, label=5}, 
        {start=20, label=6}, {start=24, label=7}, {start=28, 
        label=8}],
      searchResultTime=0.29,
      currentPageIndex=0,
      estimatedResultCount=800000
    },
    results=[
      {
        visibleUrl=www.packtpub.com,
        cacheUrl=http://www.google.com/search?q=cache:rbL6l6pFt8…,
        GsearchResultClass=GwebSearch,
        title=&lt;b&gt;Packt&lt;/b&gt; Publishing | Technology Books, eBook…,
        titleNoFormatting=Packt Publishing | Technology Books…,
        url=https://www.packtpub.com/,
        content=&lt;b&gt;Packt&lt;/b&gt; Publishing is the leading UK provid…,
        unescapedUrl=https://www.packtpub.com/
      }, {
        visibleUrl=www.packtpub.com,
        cacheUrl=http://www.google.com/search?q=cache:wo2TeIpsCG…,
        GsearchResultClass=GwebSearch,
        title=Free Learning | &lt;b&gt;PACKT&lt;/b&gt; Books - &lt;b&gt;Packt&lt;/b&gt; …,
        titleNoFormatting=Free Learning | PACKT Books - Packt Pu…,
        url=https://www.packtpub.com/packt/offers/free-learning,
        content=A new free programming tutorial book every day...,
      }, {
        visibleUrl=www.packtpub.com,
        cacheUrl=http://www.google.com/search?q=cache:D7qMTpx1Nu…,
        GsearchResultClass=GwebSearch,
        title=All Books and eBooks | &lt;b&gt;PACKT&lt;/b&gt; Books - &lt;b&gt;Pac…,
        titleNoFormatting=All Books and eBooks | PACKT Books – P…,
        url=https://www.packtpub.com/all,
        content=Packt Publishing provides technology eBooks, boo…,
        unescapedUrl=https://www.packtpub.com/all
      }
    ]
  },
  responseStatus=200
 }</pre></div><p>The top-level <a class="indexterm" id="id223"/>objects of the JSON are <code class="literal">responseDetails</code>, <code class="literal">responseData</code>, and <code class="literal">responseStatus</code>. If Google has returned the correct response, then the <code class="literal">responseStatus</code> value should be <code class="literal">200</code>. This is returned by the Google search service not the <code class="literal">UrlFetchApp</code> status. You can also check whether the <code class="literal">responseStatus</code> value equals to <code class="literal">200</code> or not, to confirm if the response content is okay.</p><p>You need to dig into the <code class="literal">responseData</code> object, which contains the result as an array of object. To get the array, use <code class="literal">json.responseData.results</code> and then cycle through the array to get the required result data. We will create an application to search Google and to populate the result in Sheet.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec26"/>Creating a Google search application</h2></div></div></div><p>Create a new Sheet, rename it<a class="indexterm" id="id224"/> as <code class="literal">Google</code> and<a class="indexterm" id="id225"/> create headers as shown in the following screenshot:</p><div><img alt="Creating a Google search application" src="img/B05010_06_01.jpg"/></div><p>Then, enter the following<a class="indexterm" id="id226"/> code in the <code class="literal">Code.gs</code> file:</p><div><pre class="programlisting">function searchGoogle(){

  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var SheetGoogle = ss.getSheetByName("Google");
  var kwd = SheetGoogle.getRange("B2").getValue();
  
  // Encode URI components if any in kwd
  kwd = encodeURIComponent(kwd);
  
  // Replace space with '+'
  kwd = kwd.replace(/%20/gi, "+");
  
  // Remove '?' marks
  kwd = kwd.replace(/%3F/gi, "");
  
  var url = "https://ajax.googleapis.com/ajax/services/ search/web?v=3.0&amp;q=" + kwd;

  try{
    var resp = UrlFetchApp.fetch(url).getContentText();
    var json = JSON.parse(resp);
    var result = json.responseData.results;
  } catch(e){
    Logger.log(e);
  };
  
  // We require a 2-dimensional array to store data in sheet
  var output = [];
  var visibleUrl,title,url,content;
  
  for(var i=0; i&lt;result.length; i++){
    visibleUrl = result[i].visibleUrl;
    title = result[i].title;
    url = result[i].url;
    content = result[i].content;

    output.push([visibleUrl,title,url,content]);
  };
  
  /*
   * output.length for number of rows and output[0].length for
   * number of columns
   *
   */
  SheetGoogle.getRange(5, 1, output.length, output[0].length)
    .setValues(output);
}</pre></div><p>A sample output of<a class="indexterm" id="id227"/> the application is shown in the<a class="indexterm" id="id228"/> following screenshot:</p><div><img alt="Creating a Google search application" src="img/B05010_06_02.jpg"/></div><p>You can test the code using other keywords in cell <em>B2</em>. You can create a button or custom menu for the <code class="literal">searchGoogle</code> function, so that you can search frequently.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec27"/>Creating a stock quote ticker application</h2></div></div></div><p>A simple function to <a class="indexterm" id="id229"/>get stock quotes from Google<a class="indexterm" id="id230"/> Finance is shown in the following screenshot. The query string (<code class="literal">q</code>) specifies <code class="literal">NASDAQ</code> as the stock exchange and <code class="literal">GOOG</code> (Google) as the scrip name.</p><div><pre class="programlisting">function getStockQuote1(){
  var url = "http://finance.google.com/finance/info?q=NASDAQ:GOOG";

  var resp = UrlFetchApp.fetch(url).getContentText();
  Logger.log(resp);
}</pre></div><p>In the preceding code, we are using the <code class="literal">UrlFetchApp</code> class's <code class="literal">fetch</code> method. The logged response is as follows:</p><div><pre class="programlisting"> // [
{
"id": "304466804484872"
,"t" : "GOOG"
,"e" : "NASDAQ"
,"l" : "717.00"
,"l_fix" : "717.00"
,"l_cur" : "717.00"
,"s": "0"
,"ltt":"4:00PM EST"
,"lt" : "Nov 13, 4:00PM EST"
,"lt_dts" : "2015-11-13T16:00:01Z"
,"c" : "-14.23"
,"c_fix" : "-14.23"
,"cp" : "-1.95"
,"cp_fix" : "-1.95"
,"ccol" : "chr"
,"pcls_fix" : "731.23"
}
]</pre></div><p>In the returned response text, you can see that the first four characters are a line break, two slashes (<code class="literal">//</code>), and a space character, so you have to remove them before parsing the required JSON object. Striping<a class="indexterm" id="id231"/> out the first four characters from the returned string makes things easier. You can use the <code class="literal">substr</code> method<a class="indexterm" id="id232"/> to strip the first four characters. The <code class="literal">parse</code> method of JavaScript JSON (JavaScript Object Notation) object parses the string to the JSON object.</p><p>The modified code to retrieve<a class="indexterm" id="id233"/> <strong>Last Traded Price</strong> (<strong>LTP</strong>) of Google scrip is:</p><div><pre class="programlisting">function getStockQuote2(){
  var url = "http://finance.google.com/finance/info?q=NASDAQ:GOOG";

  var resp = UrlFetchApp.fetch(url).getContentText().substr(4);
  var json = JSON.parse(resp);
  Logger.log(json[0].l);
}</pre></div><p>You can use multiple scrips (comma separated) in the query string. For example, <code class="literal">http://finance.google.com/finance/info?q=NASDAQ:GOOG,AMD,MCHP</code>. Then, the response would be an array of stock quote objects. You will have to cycle through the array to get each scrip data.</p><p>We will create a complete working stock quote application. Create or add a new Sheet and rename it as <code class="literal">Quotes</code>, populate the <code class="literal">SYMBOL</code> column, and format it as shown here:</p><div><img alt="Creating a stock quote ticker application" src="img/B05010_06_03.jpg"/></div><p>Edit the <code class="literal">getStockQuotes</code> function<a class="indexterm" id="id234"/> in the <code class="literal">Code.gs</code> file<a class="indexterm" id="id235"/> as listed here:</p><div><pre class="programlisting">function getStockQuotes(){
  var SheetQuotes = SpreadsheetApp.getActiveSpreadsheet()
                    .getSheetByName("Quotes");

  var data = SheetQuotes.getDataRange().getValues();
  
  // Remove the header from data.
  var header = data.shift();
  
  // Extracts all symbols from sheet data.
  var aScrips = [];
  for(var i in data) aScrips.push(data[i][0]);

  // Join all scrip names with comma.
  var sScrips = aScrips.join(",");
  
  // Fetch data with scrip names as query.
  var url = "http://finance.google.com/finance/info?q=NASDAQ:"+sScrips;
  
  // Send the request to the url
  try{
    var resp = UrlFetchApp.fetch(url).getContentText().substr(4);
    var json = JSON.parse(resp);
  } catch (e) {
    Logger.log(e.message);
    return;
  }
  
  // We require a 2-dimensional array to store data in sheet.
  var output = [];
  
  // Traverse through all JSON objects.
  for(var i in json){
    var q = json[i];

    // Symbol, price and traded time.
    output.push([q.t,q.l,q.ltt]);
  };

  // Restore the header again.
  output.unshift(header);

  // Save the output in sheet.
  SheetQuotes.getDataRange().setValues(output);
}</pre></div><p>The following is a sample<a class="indexterm" id="id236"/> output of the <a class="indexterm" id="id237"/>application:</p><div><img alt="Creating a stock quote ticker application" src="img/B05010_06_04.jpg"/></div><p>For a repeated quote tick, you can create a minutes trigger for the <code class="literal">getStockQuotes</code> function.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec28"/>Logging Bitcoin quotes</h2></div></div></div><p>Have you ever <a class="indexterm" id="id238"/>heard about Bitcoin, digital, or virtual currency, and ever watched Bitcoin price ticks to buy/sell Bitcoins? <strong>Bitcoin</strong> is a <a class="indexterm" id="id239"/>digital asset and trending a new payment system spreading all over the world. Here is an interesting application<a class="indexterm" id="id240"/> to log real-time Bitcoin prices. In<a class="indexterm" id="id241"/> this application, we will log prices from the Bitstamp trading platform. <a class="ulink" href="https://www.bitstamp.net">https://www.bitstamp.net</a> provides API to get Bitcoin real-time price ticks.</p><div><pre class="programlisting">function getBitCoinPrice(){
  // BitStamp api url
  var url = "https://www.bitstamp.net/api/ticker/";
  
  var resp = UrlFetchApp.fetch(url);
  
  if(resp.getResponseCode() == 200){
    var json = JSON.parse(resp);
    Logger.log(json);
  }
}</pre></div><p>The response from the Bitstamp API which is parsed as JSON is provided here:</p><div><pre class="programlisting">{volume=6209.19457553, high=422.00, last=420.39, low=414.00, vwap=419.15, ask=421.48, bid=420.23, open=421.15, timestamp=1455894447}</pre></div><p>The complete code to parse the said JSON objects to Sheet is provided here:</p><div><pre class="programlisting">/**
 *  Log bitcoin price ticks in sheet
 *
 */
function getBitCoinData(){
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var SheetBitCoin = ss.getSheetByName("Bitcoin");
  
  // Header labels at the top row of the sheet.
  var header = [
      "Timestamp",
      "High",
      "Low",
      "Volume",
      "Bid",
      "Ask"
    ];
  
  // Insert headers at the top row of the Bitcoin sheet.
  SheetBitCoin.getRange(1,1,1,6).setValues([header]);
  // setValues accept 2-dim array
  
  // BitStamp api url
  var url = "https://www.bitstamp.net/api/ticker/";
  
  try{
    var resp = UrlFetchApp.fetch(url);
    
    // Proceed if no errors returned.
    if(resp.getResponseCode() == 200){
      
      var json = JSON.parse(resp);
      
      var output = [];
      
      /*
       * Bitstamp returns timestamp in seconds
       * (elapsed since epoch), but JavaScript Date accepts in
       * milliseconds, so multiply by 1000.
       *
       */
      output.push( new Date(json.timestamp *= 1000) );
      
      // last 24 hours high.
      output.push(json.high);
      
      // last 24 hours low.
      output.push(json.low);
      
      // last 24 hours volume.
      output.push(json.volume);
      
      // highest buy order.
      output.push(json.bid);
      
      // lowest sell order.
      output.push(json.ask);
      
      // Append output to Bitcoin sheet.
      SheetBitCoin.appendRow(output);
    }
    
  } catch(e){
    // Log errors to examine and debug it later.
    Logger.log(e);
    
    throw e;
  }
};</pre></div><p>A sample logged Bitcoin data is given here. The <strong>High</strong>, <strong>Low</strong>, and <strong>Volume</strong> values are the highest price, lowest price, and<a class="indexterm" id="id242"/> total volume in the last 24 hours. The <strong>Bid</strong> and <strong>Ask</strong> values are real-time values. Create a trigger for the repeated execution of the <code class="literal">getBitCoinData</code> function.</p><div><img alt="Logging Bitcoin quotes" src="img/B05010_06_10.jpg"/></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec58"/>RSS and Atom feeds</h1></div></div></div><p>RSS stands for <strong>Rich Site Summary</strong>. It is used to publish frequently updated information. Users need standalone special software applications or browser add-ons called <strong>RSS readers</strong> to read information from any feeds.</p><p>Feed documents<a class="indexterm" id="id243"/> contain summarized or full text, metadata, publishing date, author name, and so on. Using feed, users can receive timely website updates or aggregate data from many <a class="indexterm" id="id244"/>websites. User need not check manually for any<a class="indexterm" id="id245"/> updates from those websites frequently, but subscribe for feeds. Feed reader checks the subscribed website frequently for any new data and retrieves them.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec29"/>Skeleton of a RSS feed document</h2></div></div></div><p>An <a class="indexterm" id="id246"/>example of a RSS feed <a class="indexterm" id="id247"/>document is listed here:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;rss version="2.0"&gt;
  &lt;channel&gt;
    &lt;title&gt;Title of the channel&lt;/title&gt;
    &lt;description&gt;A brief description of the channel&lt;/description&gt;
    &lt;language&gt;en-US&lt;/language&gt;
    &lt;item&gt;
      &lt;title&gt;Item title&lt;/title&gt;
      &lt;link&gt;Link to the item&lt;/link&gt;
      &lt;pubDate&gt;Fri, 30 Oct 2015 19:41:00 +0000&lt;/pubDate&gt;
      &lt;creator&gt;&lt;![CDATA[Author Name]]&gt;&lt;/creator&gt;
      &lt;category&gt;&lt;![CDATA[NEWS]]&gt;&lt;/category&gt;
      &lt;description&gt;&lt;![CDATA[encoded description…]]&gt;&lt;/description&gt;
    &lt;/item&gt;
    &lt;item&gt; … &lt;/item&gt;
    &lt;item&gt; … &lt;/item&gt;
    &lt;item&gt; … &lt;/item&gt;
  &lt;/channel&gt;
&lt;/rss&gt;</pre></div><p>The first line specifies the version, as this one is an XML document, to the processing software application.</p><p>All other elements are enclosed within the <code class="literal">rss</code> root element.</p><p>The <code class="literal">title</code>, <code class="literal">description</code>, and <code class="literal">language</code> elements inside the <code class="literal">channel</code> element specify the title, description, and in which language the channel is published, respectively.</p><p>The <code class="literal">item</code> element is a repeated one, and it contains the individual feed item information, such as <code class="literal">title</code> (title of the item), <code class="literal">link</code> (link to the item), <code class="literal">comments</code> (comment about the item), <code class="literal">pubDate</code> (item published date), <code class="literal">creator</code> (creator of the item), <code class="literal">category</code> (specifying to which <a class="indexterm" id="id248"/>category the item belongs), <code class="literal">description</code> (a brief description about the item), and many <a class="indexterm" id="id249"/>more.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec30"/>Creating an RSS reader application</h2></div></div></div><p>You have to parse<a class="indexterm" id="id250"/> the required content from the XML document returned by <code class="literal">UrlFetchApp</code> using <code class="literal">XmlService</code>. The <a class="indexterm" id="id251"/>actual code is furnished here:</p><div><pre class="programlisting">function readRssFeedContents(){
  var SheetData = SpreadsheetApp.getActiveSpreadsheet()
                    .getSheets()[0];
  
  var title, posturl, author, row, output = [];

  // Prefix namespace.
  var dc = XmlService.getNamespace('http://purl.org/dc/elements/1.1/');

  // Fetch feed document.
  var xml = UrlFetchApp.fetch("http://siliconangle.com/feed/")
            .getContentText();

  // Parse the response text from the URL.
  var doc = XmlService.parse(xml);
  
  // Get child elements from the root element.
  var items = doc.getRootElement().getChild('channel')
              .getChildren('item');

  // Process the required data.
  for(var i=0; i&lt;items.length; i++){
    title = items[i].getChild('title').getText();
    posturl = items[i].getChild('link').getText();
    author = items[i].getChild('creator', dc).getText();
    row = [title].concat(posturl, author);

    output.push(row);
  };

  // Write new data to sheet
  SheetData.getRange(2, 1, output.length, output[0].length)
    .setValues(output);
}</pre></div><p>In the preceding code, <code class="literal">XmlService</code> is used to parse any well-structured XML content. In the mentioned sample source, we concentrated on <code class="literal">channel</code> elements and one or more <code class="literal">item</code> elements. The <code class="literal">item</code> <a class="indexterm" id="id252"/>element itself contains more information. To get the required data, you have to dig into the contents in the order of <code class="literal">channel</code> | <code class="literal">item</code> | <code class="literal">title</code> | <code class="literal">link</code> | <code class="literal">creator</code>. The <code class="literal">creator</code> element is prefixed with <code class="literal">dc</code>, so we have to assign the <code class="literal">dc</code> namespace URL at the top<a class="indexterm" id="id253"/> lines of the code.</p><p>A sample output of this application is shown here:</p><div><img alt="Creating an RSS reader application" src="img/B05010_06_05.jpg"/></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec31"/>Skeleton of an Atom feed document</h2></div></div></div><p>Atom feeds are similar to<a class="indexterm" id="id254"/> RSS feeds with many advanced features. The<a class="indexterm" id="id255"/> <code class="literal">root</code> element is <code class="literal">feed</code> instead of <code class="literal">channel</code>. An example of an Atom feed document is shown here:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;feed &gt;
  &lt;title&gt;Atom Feed&lt;/title&gt;
  &lt;subtitle&gt;Subtitle of the feed&lt;/subtitle&gt;
  &lt;link href="http://example.com/" /&gt;
  &lt;updated&gt;2015-11-13T06:30:02Z&lt;/updated&gt;
  &lt;entry&gt;
    &lt;title&gt;Title of the item&lt;/title&gt;
    &lt;link href="http://example.com" /&gt;
    &lt;updated&gt;2015-11-13T06:30:22Z&lt;/updated&gt;
    &lt;summary&gt;Summary text of the item&lt;/summary&gt;
    &lt;author&gt;
      &lt;name&gt;Author name&lt;/name&gt;
      &lt;email&gt;example@example.com&lt;/email&gt;
    &lt;/author&gt;
  &lt;/entry&gt;
  &lt;entry&gt;...&lt;/entry&gt;
  &lt;entry&gt;...&lt;/entry&gt;
  &lt;entry&gt;...&lt;/entry&gt;
&lt;/feed&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec32"/>Creating an Atom feed reader application</h2></div></div></div><p>This application<a class="indexterm" id="id256"/> parses Google Hot Trends Atom Feed. The following is the code to read Google Trends Atom<a class="indexterm" id="id257"/> Feed content:</p><div><pre class="programlisting">function readAtomFeedContents(){
  // SheetData refers left most sheet.
  var SheetData = SpreadsheetApp.getActiveSpreadsheet()
                  .getSheets()[0];

  // Set column titles.
  var title, description, output = [["Trends", "Related Searches"]];
  
  // Fetch data from the feed url.
  var xml = UrlFetchApp.fetch("http://www.google.com/trends/ hottrends/atom/feed").getContentText();
  
  // Parse the result as xml content.
  var doc = XmlService.parse(xml);
  
  // Get item elements from the root element.
  var items = doc.getRootElement().getChild('channel')
              .getChildren('item');

  // Clear existing sheet data and sets new values.
  SheetData.clearContents();

  // Store new data.
  SheetData.getRange(1, 1, 1,output[0].length).setValues(output);

  /*
   * Dig into 'item' element and parse all the required data.
   * Get other related search terms.
   *
   */
  for(var i=0; i&lt;items.length; i++){
    title = items[i].getChild('title').getText();
    description = items[i].getChild('description').getText();
    output = [title].concat(description.split(','));
    
    // Sets output data in sheet.
    SheetData.getRange(i+2, 1, 1, output.length)
      .setValues([output]);
  }
};</pre></div><p>A sample<a class="indexterm" id="id258"/> output of the <a class="indexterm" id="id259"/>application is shown here:</p><div><img alt="Creating an Atom feed reader application" src="img/B05010_06_06.jpg"/></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec33"/>Using optional parameters with the UrlFetchApp class</h2></div></div></div><p>All foresaid applications<a class="indexterm" id="id260"/> fetch results from public URLs; this means that they do not require credentials. What if a website requires your credentials, such as username and password, before sending a response? You can provide credentials and other parameters as an optional parameter of the <code class="literal">UrlFetchApp</code> class, for example, <code class="literal">UrlFetchApp.fetch(url, params)</code>. The <code class="literal">params</code> parameter is similar to this:</p><div><pre class="programlisting">var params = {
  method: "GET",
  headers: headers
}</pre></div><p>The <code class="literal">headers</code> variable (the HTTP/HTTPS request headers) can be a JavaScript key/value map. You can provide your login credentials as headers:</p><div><pre class="programlisting">var headers = {
  // Basic authentication
  Authorization: "Basic "
    + Utilities.base64Encode("username:password");
}</pre></div><p>Your username and <a class="indexterm" id="id261"/>password will be encoded but not encrypted, so prefer HTTPS over HTTP.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>Not all websites support basic authentication; they mostly support OAuth. The <code class="literal">UrlFetchApp</code> class's built-in OAuth service is deprecated and moved to the open source library called the GAS library. More information on how to import the external library and use the OAuth2 open source library is provided in <a class="link" href="ch09.html" title="Chapter 9. More Tips and Tricks and Creating an Add-on">Chapter 9</a>, <em>More Tips and Tricks and Creating an Add-on</em>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec59"/>The LanguageApp class</h1></div></div></div><p>The <code class="literal">LanguageApp</code> class <a class="indexterm" id="id262"/>provides the <code class="literal">translate</code> method to translate any text from one language to another language.</p><p>For example, to translate <code class="literal">Google apps script for beginners</code> to French use the following code:</p><div><pre class="programlisting">function translateToFrench(){
  var text = "Google apps script for beginners";
  var sourceLanguage = "en";
  var targetLanguage = "fr";
  var french = LanguageApp
    .translate(text, sourceLanguage, targetLanguage);

  Logger.log(french);
}</pre></div><p>The logged output would be: <code class="literal">Google Apps Script pour les débutants</code>.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>Google Translate <a class="indexterm" id="id263"/>service supports many languages. For more information on supported languages, visit:</p><p>
<a class="ulink" href="https://cloud.google.com/translate/v2/using_rest#language-params">https://cloud.google.com/translate/v2/using_rest#language-params</a>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec34"/>Creating the language translator application</h2></div></div></div><p>This application translates text from one language to another. We will use one document as an origin/source<a class="indexterm" id="id264"/> document and the other <a class="indexterm" id="id265"/>one as a destination/target document. We are going to develop this application as an add-on. Although there is a built-in translate service available (in Docs application navigate to <strong>Tools</strong> | <strong>Translate document…)</strong>, we have provided the language translator application to explore the capabilities of GAS.</p><p>Enter the following code in the source document's (Docs) <code class="literal">Code.gs</code> file:</p><div><pre class="programlisting">/*
 * Replace with the id/key of the target document in which the
 * translated text to be saved.
 *
 */
var targetDocumentId = "Replace with target document id";</pre></div><p>The preceding code sets the target document's ID to the <code class="literal">targetDocumentId</code> global variable. The target document is the document to which you are going to transfer the translated text. Replace the text within double quotes with the target document's ID as a string:</p><div><pre class="programlisting">/**
 * Creates a menu entry in the Google Docs UI when the document
 * is opened.
 *
 */
function onOpen(e) {
  DocumentApp.getUi().createAddonMenu()
      .addItem('Start', 'showSidebar')
      .addToUi();
}</pre></div><p>The preceding <code class="literal">onOpen</code> function creates an <strong>Add-ons</strong> menu with a menu item called <strong>Start.</strong> It is associated with the <code class="literal">showSidebar</code> function:</p><div><pre class="programlisting">/**
 * Opens a sidebar in the document containing the add-on's user
 * interface.
 *
 */
function showSidebar() {
  var ui = HtmlService.createTemplateFromFile('Sidebar')
           .evaluate()
           .setTitle('Translate');

  DocumentApp.getUi().showSidebar(ui);
}</pre></div><p>The preceding <code class="literal">showSidebar</code> function creates the sidebar with the required control elements.</p><div><pre class="programlisting">/**
 * Gets the stored user preferences for the destination language,
 * if exist.
 *
 */
function getPreferences() {
  var userProperties = PropertiesService.getUserProperties();

  var languagePrefs = {
    destLang: userProperties.getProperty('destLang')
  };

  return languagePrefs;
};</pre></div><p>The <code class="literal">getPreferences</code> function gets and returns the user's language preferences. The <code class="literal">runTranslation</code> function shown here translates the text from the source language to the destination language. The<a class="indexterm" id="id266"/> languages are notated by their two-letter short form. For example, English is <code class="literal">en</code>, German is <code class="literal">de</code>, and the <a class="indexterm" id="id267"/>default is auto, which means the Google Translate service will detect the source language itself. If the <code class="literal">savePrefs</code> argument is <code class="literal">true</code>, then the user language preference will be saved:</p><div><pre class="programlisting">function runTranslation(dest, savePrefs) {
  if (savePrefs == true) {
    var userProperties = PropertiesService.getUserProperties();
    userProperties.setProperty('originLang', 'en');
    userProperties.setProperty('destLang', dest);
  }

  var srcFile = DocumentApp.getActiveDocument();
  var tgtFile = DocumentApp.openById(targetDocumentId);

  var srcBody = srcFile.getBody();
  var tgtBody = tgtFile.getBody();

  tgtBody.appendParagraph("");
  tgtBody.clear();
  
  var item = srcBody.getChild(0);

  while(item){
    var type = item.getType();

    if(type == "LIST_ITEM"){
      var attrib = item.getAttributes();  
var srcText = item.getText(); 
var transText = LanguageApp.translate(srcText, "en", dest); 
tgtBody.appendParagraph(transText).setAttributes(attrib);

    item = item.getNextSibling();
  };

  tgtBody.getChild(0).removeFromParent();
};</pre></div><p>The following <code class="literal">include</code> helper<a class="indexterm" id="id268"/> function puts<a class="indexterm" id="id269"/> external JS/CSS contents from other files (filename given as argument) into the HTML file:</p><div><pre class="programlisting">function include(filename) {
  return HtmlService.createHtmlOutputFromFile(filename)
    .getContent();
}</pre></div><p>Create a new HTML file (<code class="literal">Sidebar.html</code>) from the <strong>File</strong> menu and enter the following code:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    &lt;script src="img/webcomponents.js"&gt;&lt;/script&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/bower_components /polymer/polymer.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/font-roboto/roboto.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-input/paper-input.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-button/paper-button.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-checkbox/paper-checkbox.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-radio-group/paper-radio-group.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-radio-button/paper-radio-button.html"&gt;

    &lt;link rel="import" href="//polymerstaticfiles.appspot.com/ bower_components/paper-input/paper-input-decorator.html"&gt;

    &lt;!-- Insert CSS code --&gt;
    &lt;?!= include('Sidebar.css.html'); ?&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;div class="sidebar"&gt;
      &lt;h4&gt;Translate into&lt;/h4&gt;
      &lt;paper-radio-group id="dest"&gt;
        &lt;paper-radio-button name="en" id="radio-dest-en" label="English"&gt;&lt;/paper-radio-button&gt;

        &lt;paper-radio-button name="fr" id="radio-dest-fr" label="French"&gt;&lt;/paper-radio-button&gt;

        &lt;paper-radio-button name="de" id="radio-dest-de" label="German"&gt;&lt;/paper-radio-button&gt;

        &lt;paper-radio-button name="ja" id="radio-dest-ja" label="Japanese"&gt;&lt;/paper-radio-button&gt;

        &lt;paper-radio-button name="es" id="radio-dest-es" label="Spanish"&gt;&lt;/paper-radio-button&gt;
      &lt;/paper-radio-group&gt;

      &lt;br /&gt;&lt;br /&gt;
      &lt;hr /&gt;

      &lt;paper-checkbox id="save-prefs" label="Use this language by default"&gt;&lt;/paper-checkbox&gt;

      &lt;div id="button-bar"&gt;
        &lt;paper-button raised class="colored" id="run- translation"&gt;Translate&lt;/paper-button&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;!--  Insert JS code --&gt;
    &lt;?!= include('Sidebar.js.html'); ?&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>In the preceding code, Google's polymer components library is used. Although we could have used simple HTML elements, we used polymer components for an aesthetic look and feel of the sidebar. You need<a class="indexterm" id="id270"/> not worry about the<a class="indexterm" id="id271"/> functioning of that library, you just need to include the URLs as shown. The <code class="literal">include</code> helper function inserts the respective file, given as argument, contents.</p><p>Create another HTML file and name it as <code class="literal">Sidebar.css</code>, including <code class="literal">.css</code>. The script editor will add <code class="literal">.html</code> extension, so the filename will be <code class="literal">Sidebar.css.html</code>. Enter the following code in it:</p><div><pre class="programlisting">&lt;style&gt;
  body {
    font-family: 'RobotoDraft', sans-serif;
    margin: 0;
    padding: 0;
  }

  h4 {
    text-align: center;
    margin: 0;
  }

  paper-button {
    margin: 0;
    margin-top: 10px;
  }

  .sidebar {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    overflow-y: auto;
    padding: 12px;
    position: absolute;
    width: 100%;
  }

  #dest {
    margin-top: 5px;
  }

  .error {
    color: #dd4b39;
    font-size: small;
    margin-top: 8px;
  }

  .colored {
    background: #4285f4;
    color: #ffffff;
  }
&lt;/style&gt;</pre></div><p>The preceding CSS code defines styles for the HTML elements in the <code class="literal">Sidebar.html</code> file. CSS defines element<a class="indexterm" id="id272"/> styles within <a class="indexterm" id="id273"/>associated braces.</p><p>For example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">body</code> style name defines styles for the body element</li><li class="listitem" style="list-style-type: disc"><code class="literal">h4</code> defines styles for fourth-level heading elements</li><li class="listitem" style="list-style-type: disc">The style name prefixed with a dot (<code class="literal">.</code>) defines styles for the elements, which belong to that class</li><li class="listitem" style="list-style-type: disc">The name prefixed with the hash symbol (<code class="literal">#</code>) defines styles for element whose ID is same as the style name</li></ul></div><div><div><h3 class="title"><a id="tip18"/>Tip</h3><p>For further reading on <a class="indexterm" id="id274"/>CSS, refer to <a class="ulink" href="https://developer.mozilla.org/en-US/Learn/CSS">https://developer.mozilla.org/en-US/Learn/CSS</a>.</p></div></div><p>Create another HTML file <a class="indexterm" id="id275"/>and name it <code class="literal">Sidebar.js</code>. Enter the<a class="indexterm" id="id276"/> following code in the newly created <code class="literal">Sidebar.js.html</code> file:</p><div><pre class="programlisting">&lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;

&lt;script&gt;
  /**
   * On document load, assign click handlers to each button and
   * try to load the user's origin and destination language
   * preferences, if previously set.
   *
   */
  $(function() {
    $('#run-translation').click(runTranslation);

    google.script.run
      .withSuccessHandler(loadPreferences)
      .withFailureHandler(showError).getPreferences();
  });


  /**
   * Callback function that populates the origin and destination
   * selection boxes with user preferences from the server.
   *
   */
  function loadPreferences(languagePrefs) {
    if (languagePrefs.destLang){ 
      $('#dest').prop('selected', languagePrefs.destLang);
    }
  }


  /**
   * Runs a server-side function to translate the text.
   *
   */
  function runTranslation() {
    this.disabled = true;
    $('#error').remove();

    var dest = $('#dest').prop('selected');
    var savePrefs = $('#save-prefs').prop('checked');

    google.script.run
      .withSuccessHandler(
        function(msg, element) {
          element.disabled = false;
        })
      .withFailureHandler(
        function(msg, element) {
          showError(msg, $('#button-bar'));
          element.disabled = false;
        })
      .withUserObject(this)
      .runTranslation(dest, savePrefs);
  }


  /**
   * Inserts a div that contains an error message after a given
   * element.
   *
   */
  function showError(msg, element) {
    var div = $('&lt;div id="error" class="error"&gt;' + msg + '&lt;/div&gt;');

    $(element).after(div);
  }
&lt;/script&gt;</pre></div><p>After typing all the code without errors, reload the document. A new entry <strong>Translate</strong> under the <strong>Add-ons</strong> menu will appear. Click on <strong>start</strong> to open the sidebar, which will have all the controls you need to<a class="indexterm" id="id277"/> run the application. To test the application, enter some text in the source document (in which you <a class="indexterm" id="id278"/>have entered code). Select language into which you would like to translate the text, then click on the <strong>TRANSLATE</strong> button.</p><p>The translated text will be placed in the destination document whose ID you entered in the code. Open that document to see the translated text.</p><p>The following<a class="indexterm" id="id279"/> screenshot shows the sidebar:</p><div><img alt="Creating the language translator application" src="img/B05010_06_07.jpg"/></div><p>The following screenshot <a class="indexterm" id="id280"/>shows the source document text in English before translation:</p><div><img alt="Creating the language translator application" src="img/B05010_06_08.jpg"/></div><p>Now if you open the target document, then you can view the translated text saved in it. The sample text shown in the<a class="indexterm" id="id281"/> preceding screenshot is<a class="indexterm" id="id282"/> translated to Japanese as shown here:</p><div><img alt="Creating the language translator application" src="img/B05010_06_09.jpg"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Creating a document reviewing and instant inline commenting application</h1></div></div></div><p>We will create a document reviewing and commenting application. The document can be an article submission, a comprehension submitted by a student, a thesis paper submitted by a researcher, or anything else that<a class="indexterm" id="id283"/> should be reviewed before<a class="indexterm" id="id284"/> acceptance. The reviewer can review and insert predefined comments or his/her own custom comments, instantly. The reviewer selects some text in the document, and clicks on any one button (predefined comments) to highlight. Then, the script will highlight the text and insert the comment text inline along with creating an actual comment. You can see the created comments in the <strong>Comment</strong> panel (at the top right-hand side). Finally, the reviewer can insert score at the end of the document.</p><p>As usual, create the <code class="literal">onOpen</code> trigger function in the code file, and it will open the sidebar:</p><div><pre class="programlisting">function onOpen() {
  var ui = HtmlService.createHtmlOutputFromFile('Sidebar')
    .setTitle('Review and Comment');

  DocumentApp.getUi().showSidebar(ui);
}</pre></div><p>The <code class="literal">insertComment</code> function<a class="indexterm" id="id285"/> inserts the actual comment into the document. Drive is an advanced service, so you should enable the Drive API before <a class="indexterm" id="id286"/>using it. I hope you remember how to enable advanced services. If you don't, then revise from <a class="link" href="ch05.html" title="Chapter 5. Creating Google Calendar and Drive Applications">Chapter 5</a>, <em>Creating Google Calendar and Drive Applications</em>:</p><div><pre class="programlisting">function insertComment(comment, selectedText){
  // You should enable this advanced service (Drive API).
  Drive.Comments.insert(
    {
      "content": comment,
      "context": {"type":"text/html", "value":selectedText},
    },
    DocumentApp.getActiveDocument().getId()
  );
}</pre></div><p>The <code class="literal">insertText</code> function uses the selected text or the text where the cursor is pointed to as an argument:</p><div><pre class="programlisting">/**
 * Replaces the text of the current selection with the provided
 * text, or inserts text at the current cursor location.
 * (There will always be either a selection or a cursor.)
 * If multiple elements are selected, only inserts the text in the
 * first element that can contain text.
 *
 * @param {string} newText The text with which to replace the
 *                 current selection.
 *
 */
function insertText(newText) {
  var selection = DocumentApp.getActiveDocument().getSelection();

  // If any text selected then get selected text else cursor.
  if (selection) {
    var elements = selection.getRangeElements();
    for (var i = 0; i &lt; elements.length; i++) {
      var startIndex = elements[i].getStartOffset();
      var endIndex = elements[i].getEndOffsetInclusive();
      
      // If picture/image element selected.
      if(startIndex == endIndex) throw "Error: Select text only.";
      
      // Highlight the selected text.
      var element = elements[i].getElement()
         .setBackgroundColor(startIndex, endIndex, '#f6d2ab');
      
      // Insert selected comment next to the selected text.
      element.insertText(endIndex+1, '[' + newText +']')
         .setBackgroundColor(
            endIndex+1, endIndex+newText.length+2, '#bbffbb'
          );
      
      var text = element.getText()
         .substring(
            startIndex,endIndex+1
          );

      // Call insertComment function      
      insertComment(newText,text);
    }

  } else {

    var curr = DocumentApp.getActiveDocument().getCursor();

    // Exit if document not active or cursor not in document.
    if(!curr) return;
    
    // Insert comment and call insertComment function.
    curr.insertText('[' + newText +']')
      .setBackgroundColor('#bbffbb');
    
    insertComment(newText);
  }
}</pre></div><p>This<a class="indexterm" id="id287"/> <code class="literal">insertScore</code> function inserts a horizontal line at the end of the document, and it also inserts the score<a class="indexterm" id="id288"/> based on whether the document meets the expectation or not:</p><div><pre class="programlisting">function insertScore(newText){
  var doc = DocumentApp.getActiveDocument();
  var body = doc.getBody();

  body.appendHorizontalRule();
  body.appendParagraph(newText)
    .setAttributes({FONT_SIZE:24,FOREGROUND_COLOR:'#6aa84f'});
}</pre></div><p>Create the following <a class="indexterm" id="id289"/>code in the <code class="literal">Sidebar.html</code> <a class="indexterm" id="id290"/>file:</p><div><pre class="programlisting">&lt;!-- Sidebar.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
    
    &lt;!-- Google's add-on stylesheet --&gt;
    &lt;link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css" /&gt;
    
    &lt;!-- jQuery UI stylesheet --&gt;
    &lt;link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/ 1.10.4/themes/smoothness/jquery-ui.css" /&gt;
    
    &lt;!-- jQuery base library --&gt;
    &lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;
    
    &lt;!-- jQuery UI library --&gt;
    &lt;script src="img/jquery-ui.min.js"&gt;&lt;/script&gt;
    
    &lt;!-- Add additional styles --&gt;
    &lt;style&gt;
      select{ height:35px; }

      textarea{
        width:100%;
        margin-top: 3px;
        margin-bottom: 3px;
      }

      .blue{
        -moz-border-radius: 3px;
        -webkit-border-radius: 3px;
        border-radius: 3px;
      }

      .blue + .blue{
        margin: .5px -.5px;
      }

      .ui-accordion .ui-accordion-header {
        display: block;
        cursor: pointer;
        position: relative;
        margin-top: 1px;
        padding: .4em .25em .4em .25em;
        min-height: 0; /* support: IE7 */
      }

      .ui-accordion .ui-accordion-icons {
        padding-left: 2em;
      }

      .ui-accordion .ui-accordion-content {
        padding: .5em .5em;
        overflow: auto;
      }
    &lt;/style&gt;
  &lt;/head&gt;</pre></div><p>The <code class="literal">accordion</code> block's structure<a class="indexterm" id="id291"/> is provided in the code<a class="indexterm" id="id292"/> comment:</p><div><pre class="programlisting">  &lt;body&gt;
    &lt;!-- To comply with the jQuery UI library,
        The accordion should be in the form:
      &lt;div id="accordion"&gt;
        &lt;h3&gt;Section 1&lt;/h3&gt;
        &lt;div&gt;
          ...
        &lt;/div&gt;

        &lt;h3&gt;Section 2&lt;/h3&gt;
        &lt;div&gt;
          ...
        &lt;/div&gt;
      &lt;/div&gt;
    --&gt;
  
    &lt;div id="accordion"&gt;

      &lt;h3&gt;Comments&lt;/h3&gt;
      &lt;div&gt;
        &lt;b&gt;Highlight text and click the appropriate comment&lt;/b&gt;
        &lt;div id="button-bar"&gt;
          &lt;button class="blue comment-button"
            value = "Awkward"&gt;Awkward&lt;/button&gt;

          &lt;button class="blue comment-button"
            value = "Citation Needed"&gt;Citation Needed&lt;/button&gt;

          &lt;button class="blue comment-button"
            value="Improper Citation"&gt;Improper Citation&lt;/button&gt;

          &lt;button class="blue comment-button"
            value="Commonly Confused"&gt;Commonly Confused&lt;/button&gt;

          &lt;button class="blue comment-button"
            value="Delete"&gt;Delete&lt;/button&gt;

          &lt;button class="blue comment-button"
            value="Run-on"&gt;Run-on&lt;/button&gt;

          &lt;button class="blue comment-button"
            value="Vague"&gt;Vague&lt;/button&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;textarea rows="3" id="insert-text"
            placeholder="Type your comment here"&gt;&lt;/textarea&gt;
        &lt;/div&gt;

        &lt;div&gt;
          &lt;button class="blue" id="insert-button"&gt;Comment&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;h3&gt;Scores&lt;/h3&gt;
      &lt;div&gt;
        &lt;div id="score-bar"&gt;
          Does the document meet the expectation?
          &lt;br /&gt;
          &lt;button class="green insert-score" value="Meets"
            &gt;Yes&lt;/button&gt;

          &lt;button class="green insert-score" value="Not Yet"
            &gt;No&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script&gt;
      // On document load assign the events.
      $(function(){
      
        /**
         * Which accordion block should be active/expanded by
         * default, here the first one.
         *
         */
        $("#accordion").accordion({ active: 0 });
        
        // Assign a click event to buttons.
        $(".comment-button").click(insertButtonComment);
        $("#insert-button").click(insertCustomComment);
        $(".insert-score").click(insertScore);
        
      });
      
      
      /**
       *  Runs a server-side function to insert pre-defined
       *  comment into the document at the cursor *  or after the selection.
       *
       */
      function insertButtonComment() {
        this.disabled = true;
        $('#error').remove();
        
        google.script.run
          .withSuccessHandler(
            function(returnSuccess, element) {
              element.disabled = false;
            }
           )
          .withFailureHandler(
             function(msg, element) {
               showError(msg, $('#button-bar'));
               element.disabled = false;
             }
           )
          .withUserObject(this)
          .insertText($(this).val());
      }

      /**
       *  Runs a server-side function to insert custom comment
       *  into the document on pointing the cursor or 
       *  after the selection.
       *
       */
      function insertCustomComment() {
        this.disabled = true;
        $('#error').remove();
        
        google.script.run
          .withSuccessHandler(
             function(returnSuccess, element) {
               element.disabled = false;
             }
           )
          .withFailureHandler(
             function(msg, element) {
               showError(msg, $('#button-bar'));
               element.disabled = false;
             }
           )
          .withUserObject(this)
          .insertText($('#insert-text').val());
      }


      /**
       *  Runs a server-side function to insert the score
       *
       */
      function insertScore() {
      this.disabled = true;
      $('#error').remove();
      
      google.script.run
        .withSuccessHandler(
           function(returnSuccess, element) {
             element.disabled = false;
           }
         )
        .withFailureHandler(
           function(msg, element) {
             showError(msg, $('#score-bar'));
             element.disabled = false;
           }
         )
        .withUserObject(this)
        .insertScore($(this).val());
      }
        
      /**
       *  Inserts a div that contains an error message after a
       *  given element.
       *
       *  @param msg-The error message to display.
       *  @param element-The element after which to display the
       *                 error.
       *
       */
      function showError(msg, element) {
        var div = $('&lt;div id="error" class="error"&gt;'
            + msg + '&lt;/div&gt;');

        $(element).after(div);
      }
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>The following <a class="indexterm" id="id293"/>screenshot shows the sidebar and <a class="indexterm" id="id294"/>document:</p><div><img alt="Creating a document reviewing and instant inline commenting application" src="img/B05010_06_11.jpg"/></div><p>You can see the inserted<a class="indexterm" id="id295"/> comments by clicking on the <strong>Comment</strong> button at the<a class="indexterm" id="id296"/> top right-hand side corner of the document's window.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Summary</h1></div></div></div><p>In this chapter, you learned and created many useful applications, including an RSS/Atom reader, the language translator applications, and the document reviewing and commenting application. In the next chapter, you will learn to create interactive web pages, an RSS feed, a file upload, and a timesheet application.</p></div></body></html>