- en: Chapter 7. Fetching Resources
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Fetching remote resources
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching with `FetchEvent`
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching a JSON file during service worker installation
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Proxying
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Prefetching
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we will look at how to request files and resources from different
    sources, which in more technical terms perform fetch actions against different
    resources. We will look at fetching a JSON file during the service worker installation,
    using the service worker as a proxy middleware, and prefetching a list of specific
    resource URLs during the installation process, so that you have the resources
    handy before loading the page.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Let's start off this chapter by looking at a simple example of fetching a resource
    from two different resources.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: Fetching remote resources
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Fetching remote resources can be done in different ways. In this recipe, we
    are going to look at two standard ways of fetching a remote resource using a service
    worker, with and without **cross-origin HTTP requests** (**CORS**).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: 'You can learn more about CORS at the following link:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: '[https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with service workers, you will need to have the service worker
    experiment feature turned on in your browser settings. If you have not done this
    yet, refer to the first recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service
    Worker Basics"), *Learning Service Worker Basics*: *Setting up service workers*.
    Service workers only run across HTTPS. To find out how to set up a development
    environment to support this feature, refer to the *Setting up GitHub pages for
    SSL* recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service Worker Basics"),
    *Learning Service Worker Basics*.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-16
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these instructions to set up your file structure:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the `index.html`, `index.js`, `service-worker.js`, and `style.css` file
    from the following location:'
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/01/](https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/01/)'
  id: totrans-19
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Open up a browser and go to `index.html`. You will see two images fetched from
    two different protocols, `https` and `https-acao`:![How to do it...](img/B05381_07_01.jpg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'At the beginning of the `index.js` file, we are testing two different protocols
    for loading resources:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: '`https`: HTTP with **Secure Socket Layer** (**SSL**) protocol'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`https-acao`: SSL protocol with the `Access-Control-Origin=*` header'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'We will use two different URLs, which will be loaded multiple times:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'We will also use two different methods for fetching resources, with or without
    CORS:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, we will check to see whether the service worker is registered:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'If that is not the case, we register it and reload the page to ensure that
    the client is under the service worker''s control:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The two `for` loops go through the provided protocols array and make requests
    for each protocol. They also build a DOM image element with each URL and go through
    each mode of the `fetchModes` array.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: 'The `init` object contains any custom settings that you may want to apply to
    the request. Let''s look at the properties of the `init` object:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '`method`: The request method, for example, `GET`, and `POST`'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`mode`: The mode you want to use for the request, for example, `cors`, `no-cors`,
    or `same-origin`'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`cache`: The cache mode you want to use for the request, for example `default`,
    `no-store`, `reload`, `no-cache`, `force-cache`, or `only-if-cached`'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The `buildImage` function takes two arguments, `protocol` and `url`. It creates
    an image element on the fly and attaches the URL as the source of that image.
    Then it goes on to add that image to the DOM tree, where the ID is one of `https-acao-image`,
    `https-image`, or `http–image`. JavaScript has no control over the URL handling
    at this point; the browser handles the URLs:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Images will be rendered for HTTPS requests only, as service workers only support
    connections over SSL.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: The requests over SSL with the `Access-Control-Origin=*` header (Access Control
    Allow Origin) will return results successfully.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: By default, fetching a resource from a third-party URL will fail if CORS is
    not supported by it. You can add a non-CORS option to the Request to overcome
    this. However, this will cause an opaque response, which means that you won't
    be able to tell whether the response was successful or not.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: 'The `fireRequest` function takes three arguments, `fetchMode`, `protocol`,
    and `init`. This function returns another function, which we can call as a composition.
    We start with fetching the given resource directly from the remote resource:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If the fetch was successful, we print it into the console as well as log it
    on the web page. The same applies if the request fails, only this time we print
    the error.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: 'The helper function log finds the DOM element by the ID and adds a paragraph
    element, as well as a class attribute to depict the type of the message:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In the `index.html` file, we have style declarations in the head section:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: In our `log()` function, we set the undefined type to success so that it will
    display the color green when we add it to `classList`. The error type will display
    red, as declared in the preceding styles.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Fetching with FetchEvent
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The `FetchEvent` class is a fetch action dispatched on the service worker. It
    contains details about requests as well as responses. It provides all important
    `FetchEvent.reponseWith()` methods, which we can use to provide a response back
    to the page that is controlled by the service worker.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with service workers, you will need to have the service worker
    experiment feature turned on in your browser settings. If you have not done this
    yet, refer to the first recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service
    Worker Basics"), *Learning Service Worker Basics*: *Setting up service workers*.
    Service workers only run across HTTPS. To find out how to set up a development
    environment to support this feature, refer to the following recipes of [Chapter
    1](ch01.html "Chapter 1. Learning Service Worker Basics"), *Learning Service Worker
    Basics*: *Setting up GitHub pages for SSL*, *Setting up SSL for Windows*, and
    *Setting up SSL for Mac*.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these instructions to set up your file structure:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the `index.html`, `index.js`, `service-worker.js`, `adeobe-log.png`, and
    `style.css` files from the following location:'
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/02/](https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/02/)'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Open up a browser and go to `index.html`:![How to do it...](img/B05381_07_02.jpg)
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open up the Developer Toolbar (*Cmd* + *Alt* + *I* or *F12*). Now refresh the
    page and look at the messages in the console. You will see the fetch requests
    are logged in the console:![How to do it...](img/B05381_07_03.jpg)
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We are simply printing out different stages within the fetch event handler
    of the service worker to the console. The fetch method of our `service-worker.js`
    file looks like the following:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Let's discuss some of these API methods in more detail.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Cache.addAll()
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This method takes in a URL array, retrieves the response, and then adds that
    result to a specified cache. The specified cache in our example is `''fetch-event-cache''`:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: ExtendableEvent.waitUntil()
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This method extends the lifetime of an event. In our example, we are waiting
    until the resources are cached:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: FetchEvent.respondWith()
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This method resolves by returning a `Response` object or a network error to
    the `Fetch` object:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Fetching a JSON file during service worker installation
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, we are going to learn how to cache resource files using a JSON
    file by specifying the names of the resource files in it. Usually, this is done
    by keeping an array in the service worker JavaScript file, but you might want
    them in a separate location, for reasons such as versioning, for example.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with service workers, you will need to have the service worker
    experiment feature turned on in your browser settings. If you have not done this
    yet, refer to the first recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service
    Worker Basics"), *Learning Service Worker Basics*: *Setting up service workers*.
    Service workers only run across HTTPS. To find out how to set up a development
    environment to support this feature, refer to the following recipes of [Chapter
    1](ch01.html "Chapter 1. Learning Service Worker Basics"), *Learning Service Worker
    Basics*: *Setting up GitHub pages for SSL*, *Setting up SSL for Windows*, and
    *Setting up SSL for Mac*.'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these instructions to set up your file structure:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: 'Download all the files from the following location:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/03/](https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/03/)'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open up a browser and go to the `index.html` file:![How to do it...](img/B05381_07_04.jpg)
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now open up the DevTools (*Cmd* + *Alt* + *I* or *F12*) and make sure the **Preserve
    log** checkbox is clicked. Now refresh the page and you will see the log messages
    retrieving files from the cache:![How to do it...](img/B05381_07_05.jpg)
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you look at the **Resources** tab, you will see the cached resources:![How
    to do it...](img/B05381_07_06.jpg)
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We only require one action, which is at the time of the initial load for caching
    the assets and registering the service worker. So at the time of installation,
    we load the JSON file, parse JSON, and add the files to the cache. Our `service-worker.js`
    file looks like this:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Return a response from the cache if it was found:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The client claims the service worker:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We will list the resource file names in the `files.json` file:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We will add a section to our `index.html` file for the images:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Proxying
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A proxy is an intermediary between a web browser and the Internet. In this recipe,
    we will learn how to use the service worker as a proxy middleware.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with service workers, you will need to have the service worker
    experiment feature turned on in your browser settings. If you have not done this
    yet, refer to the first recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service
    Worker Basics"), *Learning Service Worker Basics*: *Setting up service workers*.
    Service workers only run across HTTPS. To find out how to set up a development
    environment to support this feature, refer to the following recipes: *Setting
    up GitHub pages for SSL*, *Setting up SSL for Windows*, and *Setting up SSL for
    Mac*.'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these instructions to set up your file structure:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: 'Download all the files from the following location:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/04/](https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/04/)'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Open up a browser and go to `index.html`:![How to do it...](img/B05381_07_07.jpg)
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now click on the first link to navigate to the `/hello` link:![How to do it...](img/B05381_07_08.jpg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now open up DevTools (*Cmd* + *Alt* + *I* or *F12*) to see the log messages
    on the **Console** tab:![How to do it...](img/B05381_07_09.jpg)
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now click on the first link to navigate to the `/hello/world` link:![How to
    do it...](img/B05381_07_10.jpg)
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-108
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We are adding two links to the `index.html` file where we are planning to create
    a proxy:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We create a proxy for requests to the local URLs, inside the `service-worker.js`
    file, containing a `hello` string as well as `hello/world`. The client will recognize
    this as a local resource:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We pass these handlers into the fetch event listener as callbacks:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Prefetching
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Prefetching resources during the service worker installation phase can easily
    enable offline viewing of a website. In this recipe, we will look into be prefetching
    resources including pages and images.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started with service workers, you will need to have the service worker
    experiment feature turned on in your browser settings. If you have not done this
    yet, refer to the first recipe of [Chapter 1](ch01.html "Chapter 1. Learning Service
    Worker Basics"), *Learning Service Worker Basics*: *Setting up service workers*.
    Service workers only run across HTTPS. To find out how to set up a development
    environment to support this feature, refer to the following recipes: *Setting
    up GitHub pages for SSL*, *Setting up SSL for Windows*, and *Setting up SSL for
    Mac*.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these instructions to set up your file structure:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: 'Download all the files from the following location:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/05/](https://github.com/szaranger/szaranger.github.io/blob/master/service-workers/07/05/)'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open up a browser and go to the `index.html` file:![How to do it...](img/B05381_07_11.jpg)
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open up the Developer Toolbar (*Cmd* + *Alt* + *I* or *F12*) and look at the
    messages in the console. You will see the resources have been successfully cached:![How
    to do it...](img/B05381_07_12.jpg)
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now go offline by selecting offline on the DevTools **Network** tab:![How to
    do it...](img/B05381_07_13.jpg)
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now click on the **prefetched.txt** link. The linked text file will open in
    a new tab:![How to do it...](img/B05381_07_14.jpg)
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **prefetched.html** link. The linked page will open in a new tab:![How
    to do it...](img/B05381_07_15.jpg)
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the **apple-log.png** link. The linked image will open in a new tab:![How
    to do it...](img/B05381_07_16.jpg)
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you examine the console, you will find the links have been served from the
    cache:![How to do it...](img/B05381_07_17.jpg)
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the `index.html` file, we are adding a section with links to the prefetched
    files:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'In the `service-worker.js` file, we start with declaring the cache version
    at the top in case you have to force pages controlled by the service worker to
    use a new cache:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `service-worker.js` 文件中，我们在顶部声明缓存版本，以防您需要强制服务工作者控制的页面使用新的缓存：
- en: '[PRE21]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'We also list the resources to be cached:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还列出了要缓存的资源：
- en: '[PRE22]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The following line will construct a new URL from the list we have given it,
    using the service worker''s script location as its base:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 以下行将根据我们提供的列表构建一个新的 URL，使用服务工作者脚本的当前位置作为其基础：
- en: '[PRE23]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Next, we add a cache busting timestamp to the query string:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们在查询字符串中添加一个缓存破坏时间戳：
- en: '[PRE24]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'We have to make sure to specify `{mode: ''no-cors''}` if there is a possibility
    that the server delivering the resource does not support CORS:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '如果有可能服务器不支持 CORS，则必须确保指定 `{mode: ''no-cors''}`：'
- en: '[PRE25]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Next, we fetch the resources and cache them:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们获取资源并将它们缓存起来：
- en: '[PRE26]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now let''s look at the activate event handler. We make sure to delete all the
    caches that aren''t in the `currentChaches` object we declared at the start:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看激活事件处理器。我们确保删除所有不在我们最初声明的 `currentChaches` 对象中的缓存：
- en: '[PRE27]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The fetch event listener is where the service worker looks for the cached resources:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 获取事件监听器是服务工作者查找缓存资源的地方：
- en: '[PRE28]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
