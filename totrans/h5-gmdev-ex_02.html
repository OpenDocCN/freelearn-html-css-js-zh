<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Getting Started with DOM-based Game Development"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Getting Started with DOM-based Game Development</h1></div></div></div><p>
<span class="emphasis"><em>We've got an idea about what we are going to learn in the whole book in <a class="link" href="ch01.html" title="Chapter 1. Introducing HTML5 Games">Chapter 1</a>, <span class="emphasis"><em>Introducing HTML5 Games</em></span>. From this chapter onwards, we will go through a lot of learning-by-doing sections, and we will focus on one topic in each section. Before digging deeply into the cutting-edge CSS3 animations and HTML5 Canvas game, let's start with traditional DOM-based game development. We will warm up with some basic techniques in this chapter.</em></span>
</p><p>In this chapter, we will be:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up our first game—Ping Pong</li><li class="listitem" style="list-style-type: disc">Learning basic positioning with the jQuery JavaScript library</li><li class="listitem" style="list-style-type: disc">Getting mouse inputs</li><li class="listitem" style="list-style-type: disc">Creating the Ping Pong game that displays the scores</li><li class="listitem" style="list-style-type: disc">Learning to separate data and view rendering logic</li></ul></div><p>We will create a Ping Pong game that a player plays against the computer via mouse input. You can try the <a id="id67" class="indexterm"/>game at <a class="ulink" href="http://makzan.net/html5-games/pingpong/">http://makzan.net/html5-games/pingpong/</a>.</p><p>The following screenshot shows the look of the game at the end of this chapter:</p><div class="mediaobject"><img src="graphics/B04290_02_01.jpg" alt="Getting Started with DOM-based Game Development"/></div><p>So, let's get on with making our Ping Pong game.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>At the time of writing the book, the jQuery version is 2.1.3. The jQuery functions that we used in the examples are basic functions that should work in future versions too.</p></div></div><div class="section" title="Preparing the HTML documents for a DOM-based game"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Preparing the HTML documents for a DOM-based game</h1></div></div></div><p>Every website, web page, and <a id="id68" class="indexterm"/>HTML5 game starts <a id="id69" class="indexterm"/>with a default HTML document. Moreover, the document starts with a basic HTML code. We will start our HTML5 game development journey with <code class="literal">index.html</code>.</p></div></div>
<div class="section" title="Time for action &#x2013; installing the jQuery library"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Time for action – installing the jQuery library</h1></div></div></div><p>We will create our HTML5 Ping <a id="id70" class="indexterm"/>Pong game from scratch. It may sound as if we are going to be preparing all the things ourselves. Luckily, we can use a JavaScript library to help us. <span class="strong"><strong>jQuery</strong></span>
<a id="id71" class="indexterm"/> is the <span class="strong"><strong>JavaScript library</strong></span>
<a id="id72" class="indexterm"/> that is designed to navigate the DOM elements easily, manipulate them, handle events, and create an asynchronous remote call. We will be using this library in the book to manipulate DOM elements. It will help us to simplify our JavaScript logic:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new folder named <code class="literal">pingpong</code> as our project directory.</li><li class="listitem">Inside the <code class="literal">pingpong</code> folder, we will create the following file structure, with three folders—<code class="literal">js</code>, <code class="literal">css</code>, and <code class="literal">images</code>—and an <code class="literal">index.html</code> file:<div class="informalexample"><pre class="programlisting">index.html
js/
  js/pingpong.js
css/
  css/pingpong.css
images/</pre></div></li><li class="listitem">Now, it's time to download the <a id="id73" class="indexterm"/>jQuery library. Go to <a class="ulink" href="http://jquery.com/">http://jquery.com/</a>.</li><li class="listitem">Select <span class="strong"><strong>Download jQuery</strong></span> and click on <span class="strong"><strong>Download the compressed, production jQuery 2.1.3</strong></span>.</li><li class="listitem">Save <code class="literal">jquery-2.1.3.min.js</code> within the <code class="literal">js</code> folder that we created in step 2.</li><li class="listitem">Open <code class="literal">index.html</code> in <a id="id74" class="indexterm"/>text editor and insert an empty HTML template:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Ping Pong&lt;/title&gt;
  &lt;link rel="stylesheet" href="css/pingpong.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header&gt;
    &lt;h1&gt;Ping Pong&lt;/h1&gt;
  &lt;/header&gt;
  &lt;div id="game"&gt;
    &lt;!-- game elements to be here --&gt;
  &lt;/div&gt;
  &lt;footer&gt;
    This is an example of creating a Ping Pong Game.
  &lt;/footer&gt;
  &lt;script src="js/jquery-2.1.3.min.js"&gt;&lt;/script&gt;
  &lt;script src="js/pingpong.js"&gt;&lt;/script&gt;&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Finally, we have to ensure that jQuery is loaded successfully. To do this, place the following code into the <code class="literal">js/pingpong.js</code> file:<div class="informalexample"><pre class="programlisting">(function($){
  $(function(){
    // alert a message
    alert("Welcome to the Ping Pong battle.");
  });
})(jQuery);</pre></div></li><li class="listitem">Save the <code class="literal">index.html</code> file and open it in the browser. You should see the following alert <a id="id75" class="indexterm"/>window showing our text. This means that our jQuery is correctly set up:<div class="mediaobject"><img src="graphics/B04290_02_02.jpg" alt="Time for action – installing the jQuery library"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We just created a basic HTML5 page with jQuery and ensured that the jQuery is loaded correctly.</p></div><div class="section" title="New HTML5 doctype"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>New HTML5 doctype</h2></div></div></div><p>The <code class="literal">DOCTYPE</code> and <code class="literal">meta</code> tags<a id="id76" class="indexterm"/> are simplified in HTML5.</p><p>In HTML 4.01, we declare<a id="id77" class="indexterm"/> doctype using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;</pre></div><p>This is a long<a id="id78" class="indexterm"/> line <a id="id79" class="indexterm"/>of code, right? While in HTML5, the doctype declaration couldn't have been more simpler:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;</pre></div><p>We do not even have the HTML version in the declaration. This is because HTML5 is now a living standard without a version number.</p></div><div class="section" title="Header and footer"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Header and footer</h2></div></div></div><p>HTML5 comes with many new features and improvements, and one of them is semantics. HTML5 adds new elements to improve<a id="id80" class="indexterm"/> <span class="strong"><strong>semantics</strong></span>. We just used two of the elements: <code class="literal">header</code> and <code class="literal">footer</code>. <span class="strong"><strong>Header</strong></span>
<a id="id81" class="indexterm"/> gives an introduction to the section or the entire page. Therefore, we put the <code class="literal">h1</code> title inside the header. <span class="strong"><strong>Footer</strong></span>, like<a id="id82" class="indexterm"/> the name suggests, contains the footer information of the section or the page.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>A semantic HTML means that the markup itself provides meaningful information to the content instead of only defining the visual outlook.</p></div></div></div><div class="section" title="The best practice to place the JavaScript code"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>The best practice to place the JavaScript code</h2></div></div></div><p>We put the JavaScript <a id="id83" class="indexterm"/>code right before the closing <code class="literal">&lt;/body&gt;</code> tag and after all the content in the page. There is a reason for putting the code there instead of putting it inside the <code class="literal">&lt;head&gt;&lt;/head&gt;</code> section.</p><p>Normally, browsers load content and render them from top to bottom. If the JavaScript code is put in the <code class="literal">head</code> section, then the content of the document will not be loaded until all the JavaScript code is loaded. Actually, all rendering and loading will be paused if the browsers load a JavaScript code in the middle of the page. This is the reason why we want to put the JavaScript code at the bottom, when possible. In this way, we can deliver the HTML content to our readers faster.</p><p>At the time of writing this book, the latest jQuery version is 2.1.3. This is why the jQuery file in our code examples is named <code class="literal">jquery-2.1.3.min.js</code>. The version number in the filename ensures that web developers don't get confused with different versions of the same filename in different projects. This version number will be different, but the usage should be the same, unless there is a big change in jQuery without backward compatibility.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Please note that a few JavaScript libraries have to put the <code class="literal">&lt;head&gt;</code> tag before loading any HTML elements. When you're using third-party libraries, please check whether they have such a requirement.</p></div></div></div><div class="section" title="Choosing the jQuery file"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Choosing the jQuery file</h2></div></div></div><p>For the<a id="id84" class="indexterm"/> jQuery library, there are currently two major versions; they are <span class="strong"><strong>1.x</strong></span> and <span class="strong"><strong>2.x</strong></span>. The 1.x version keeps backward compatibility to older browsers, mainly for IE versions 6, 7, and 8. Since our HTML5 games target modern browsers, we chose the 2.x version that has dropped support to IE 8 or the older versions.</p><p>There are two common ways to include the jQuery library. We can either download a <span class="strong"><strong>hosted</strong></span> version<a id="id85" class="indexterm"/> or use the <a id="id86" class="indexterm"/>
<span class="strong"><strong>CDN</strong></span> version. Hosted version means that we download the file, and we host the file ourselves. CDN stands for Content Delivery Network. The jQuery files are hosted in several central servers to improve the file downloading time. For the <a id="id87" class="indexterm"/>CDN version, we can find the URL at <a class="ulink" href="http://code.jquery.com">http://code.jquery.com</a>. We can directly include the file with the <code class="literal">&lt;script&gt;</code> tag in HTML as: <code class="literal">&lt;script src="http://code.jquery.com/jquery.min.js"&gt;&lt;/script&gt;</code>.</p><p>Otherwise, we can specify the <a id="id88" class="indexterm"/>version number in the filename as: <code class="literal">&lt;script src="http://code.jquery.com/jquery-2.1.3.min.js"&gt;&lt;/script&gt;</code>.</p></div><div class="section" title="Running jQuery inside a scope"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Running jQuery inside a scope</h2></div></div></div><p>We need to ensure<a id="id89" class="indexterm"/> that the page is ready before our JavaScript code is <a id="id90" class="indexterm"/>executed. Otherwise, we may get an error when we try to access an element that is not yet loaded. jQuery provides us with a way to execute the code after the page is ready by using the following code:</p><div class="informalexample"><pre class="programlisting">jQuery(document).ready(function(){
  // code here.
});</pre></div><p>Most of the time, we uses a <code class="literal">$</code> sign to represent jQuery. This is a shortcut that makes calling our jQuery functions much easier. So essentially, we use the following code:</p><div class="informalexample"><pre class="programlisting">$(function(){
  // code here.
});</pre></div><p>When we call <code class="literal">$(something)</code>, we are actually calling <code class="literal">jQuery(something)</code>.</p><p>There may be conflicts on the <code class="literal">$</code> variables if we use multiple JavaScript libraries in one project. For best practice, we use an <span class="strong"><strong>anonymous function</strong></span>
<a id="id91" class="indexterm"/> to pass the jQuery object into the function scope where it becomes a <code class="literal">$</code> sign:</p><div class="informalexample"><pre class="programlisting">(function($){
  // jQuery code here with $.
})(jQuery);</pre></div><p>An anonymous function is a function definition that has no name. That's why it's called anonymous. Since we cannot refer to this function anymore, the anonymous function always executes itself. JavaScript's variable scope is bound to the function scope. We often use anonymous function to control certain variables' availability. For instance, we passed the jQuery into the function as the <code class="literal">$</code> variable in our example.</p></div><div class="section" title="Running our code after the page is ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Running our code after the page is ready</h2></div></div></div><p>
<code class="literal">$(function_callback)</code> is another shortcut for the DOM elements' <code class="literal">ready</code> event. The reason we need jQuery <code class="literal">ready</code> function is to prevent the execution of JavaScript logic before the HTML DOM elements are loaded. Our function that is defined in the jQuery <code class="literal">ready</code> function is executed after all the HTML elements are loaded.</p><p>It is identical to the following line of code:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function_callback);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>Note that the jQuery <code class="literal">ready</code> event fires after the HTML structure (DOM tree) is loaded. However, this does not mean that the content, such as the actual image content, is loaded. The browser's <code class="literal">onload</code> event, on the other hands, fires after all the content including the images are loaded.</p></div></div></div><div class="section" title="Pop quiz"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Pop quiz</h2></div></div></div><p>Q1. Which is the best place to put JavaScript code?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Before the <code class="literal">&lt;head&gt;</code> tag</li><li class="listitem">Inside the <code class="literal">&lt;head&gt;&lt;/head&gt;</code> elements</li><li class="listitem">Right after the <code class="literal">&lt;body&gt;</code> tag</li><li class="listitem">Right before the <code class="literal">&lt;/body&gt;</code> tag</li></ol></div></div><div class="section" title="Downloading the image assets"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>Downloading the image assets</h2></div></div></div><p>We need some graphic files <a id="id92" class="indexterm"/>in this step. You can download the graphic files in the code bundle or from <a class="ulink" href="http://mak.la/book-assets/">http://mak.la/book-assets/</a>.</p><p>In the assets bundle, you will find image files for <code class="literal">Chapter 2</code>. After downloading them, put the files in the <code class="literal">images</code> folder. There should be four files, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/B04290_02_03.jpg" alt="Downloading the image assets"/></div></div></div>
<div class="section" title="Setting up the Ping Pong game elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Setting up the Ping Pong game elements</h1></div></div></div><p>We have made the <a id="id93" class="indexterm"/>preparations, and now it's time to set up the Ping Pong game. The following graph shows how we place the game elements. The game element contains our playground and later the scoreboard. Inside the playground, we place two decorative elements, namely <a id="id94" class="indexterm"/>
<span class="strong"><strong>paddle hand</strong></span>, which acts as the handle of the soccer machine. Then, we have two <a id="id95" class="indexterm"/>
<span class="strong"><strong>paddle</strong></span> elements—one on the left and one on the right.</p><div class="mediaobject"><img src="graphics/B04290_02_04.jpg" alt="Setting up the Ping Pong game elements"/></div></div>
<div class="section" title="Time for action &#x2013; placing Ping Pong game elements in the DOM"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Time for action – placing Ping Pong game elements in the DOM</h1></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will continue <a id="id96" class="indexterm"/>from our jQuery <a id="id97" class="indexterm"/>installation example, and open the <code class="literal">index.html</code> file in a text editor.</li><li class="listitem">Then, we will create the following playground and <code class="literal">game</code> objects with DIV nodes in the body. There are two paddles and one ball inside the playground, and the playground is placed inside the game:<div class="informalexample"><pre class="programlisting">&lt;div id="game"&gt;
  &lt;div id="playground"&gt;
    &lt;div class="paddle-hand right"&gt;&lt;/div&gt;
    &lt;div class="paddle-hand left"&gt;&lt;/div&gt;
    &lt;div id="paddleA" class="paddle"&gt;&lt;/div&gt;
    &lt;div id="paddleB" class="paddle"&gt;&lt;/div&gt;
    &lt;div id="ball"&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">We now have the structure of the <code class="literal">game</code> object ready, and it is time to apply styles to them. We will add the following styles to the <code class="literal">pingpong.css</code> file:<div class="informalexample"><pre class="programlisting">#game {
  position: relative;
  width: 400px;
  height: 200px;
}
#playground{
  background: url(../images/playground.png);
  background-size: contain;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  overflow: hidden;
  cursor: pointer;
}
#ball {
  background: #fbb;
  position: absolute;
  width: 20px;
  height: 20px;
  left: 150px;
  top: 100px;
  border-radius: 10px;
}</pre></div></li><li class="listitem">Then, we will define the dimensions and positions of the two paddles by appending the following code inside the <code class="literal">pingpong.css</code> file:<div class="informalexample"><pre class="programlisting">.paddle {
  background-size: contain;
  top: 70px;
  position: absolute;
  width: 30px;
  height: 70px;
}
  
#paddleA {
  left: 50px;
  background-image: url(../images/football-player-left.png);
}
#paddleB {
  right: 50px;
  background-image: url(../images/football-player.png);
}</pre></div></li><li class="listitem">We will <a id="id98" class="indexterm"/>continue with the styles in<a id="id99" class="indexterm"/> the <code class="literal">pingpong.css</code> file and define <code class="literal">paddle-hands</code>, which is the decoration for the paddles:<div class="informalexample"><pre class="programlisting">.paddle-hand {
  background: url(../images/football-player-hand.png) 50% 0 repeat-y;
  background-size: contain;
  width: 30px;
  height: 100%;
  position: absolute;
  top: 0;
}
.left.paddle-hand {
  left: 50px;
}
.right.paddle-hand {
  right: 50px;
}</pre></div></li><li class="listitem">Now that we are done with the CSS styles, let's move to the <code class="literal">js/pingpong.js</code> file for JavaScript's logic. We need a function to update the DOM elements of the paddles based on the position data. To do this, we will replace the current code with the following one:<div class="informalexample"><pre class="programlisting">(function($){
  // data definition
  var pingpong = {
    paddleA: {
      x: 50,
      y: 100,
      width: 20,
      height: 70
    },
    paddleB: {
      x: 320,
      y: 100,
      width: 20,
      height: 70
    },
  };

  // view rendering
  function renderPaddles() {
    $("#paddleB").css("top", pingpong.paddleB.y);
    $("#paddleA").css("top", pingpong.paddleA.y);
  }

  renderPaddles();

})(jQuery);</pre></div></li><li class="listitem">Now, we <a id="id100" class="indexterm"/>will test the setup in a <a id="id101" class="indexterm"/>browser. Open the <code class="literal">index.html</code> file in a browser; we should see a screen similar to the one shown in the following screenshot:<div class="mediaobject"><img src="graphics/B04290_02_05.jpg" alt="Time for action – placing Ping Pong game elements in the DOM"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>Let's take a look at the HTML code that we just used. The HTML page contains header, footer information, and a DIV element with the ID, <code class="literal">game</code>. The <code class="literal">game</code> node contains a child named <code class="literal">playground</code>, which in turn contains three children—two paddles and the ball.</p><p>We often start the<a id="id102" class="indexterm"/> HTML5 game development by <a id="id103" class="indexterm"/>preparing a well-structured HTML hierarchy. The HTML hierarchy helps us to group similar game objects (which are some DIV elements) together. It is a little like grouping assets into a movie clip in Adobe Flash, if you have ever made animations with it. We may also consider it as layers of game objects for us to select and style them easily.</p></div><div class="section" title="Using jQuery"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Using jQuery</h2></div></div></div><p>The jQuery command often contains<a id="id104" class="indexterm"/> two major parts: <span class="strong"><strong>selection</strong></span>
<a id="id105" class="indexterm"/> and <a id="id106" class="indexterm"/>
<span class="strong"><strong>modification</strong></span>. Selection uses CSS selector syntax to select all matched elements in the web page. Modification actions modify the selected elements, such as adding or removing children or style. Using jQuery often means chaining selection and modification actions together.</p><p>For example, the following code selects all elements with the <code class="literal">box</code> class and sets the CSS properties:</p><div class="informalexample"><pre class="programlisting">$(".box").css({"top":"100px","left":"200px"});</pre></div></div><div class="section" title="Understanding basic jQuery selectors"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>Understanding basic jQuery selectors</h2></div></div></div><p>jQuery is about selecting<a id="id107" class="indexterm"/> elements and performing actions on them. We need a method to select our required elements in the entire DOM tree. jQuery borrows the selectors from CSS. The selector provides a set of patterns to match elements. The following table lists the most common and useful selectors that we will use in this book:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Selector pattern</p>
</th><th style="text-align: left" valign="bottom">
<p>Meaning</p>
</th><th style="text-align: left" valign="bottom">
<p>Examples</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$("Element")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Selects all elements with the given tag name</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">$("p")</code> selects all the <code class="literal">p</code> tags.</p>
<p>
<code class="literal">$("body")</code> selects the <code class="literal">body</code> tag.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$("#id")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Selects the element with the given ID of the attribute</p>
</td><td style="text-align: left" valign="top">
<p>Consider the following code:</p>
<p>
</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;div id="box1"&gt;&lt;/div&gt;</strong></span>
 &lt;div id="box2"&gt;&lt;/div&gt;</pre></div><p>
</p>
<p>
<code class="literal">$("#box1")</code> selects the highlighted element.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$(".className")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Selects all elements with the given class attribute</p>
</td><td style="text-align: left" valign="top">
<p>Consider the following code:</p>
<p>
</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;div class="apple"&gt;&lt;/div&gt;</strong></span>
<span class="strong"><strong>&lt;div class="apple"&gt;&lt;/div&gt;</strong></span>
 &lt;div class="orange"&gt;&lt;/div&gt;
 &lt;div class="banana"&gt;&lt;/div&gt;</pre></div><p>
</p>
<p>
<code class="literal">$(".apple")</code> selects the highlighted elements with <code class="literal">class</code> set to <code class="literal">apple</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$("selector1, selector2, selectorN")</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Selects <a id="id108" class="indexterm"/>all elements that match the given selector</p>
</td><td style="text-align: left" valign="top">
<p>Consider the following code:</p>
<p>
</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;div class="apple"&gt;&lt;/div&gt;</strong></span>
<span class="strong"><strong>&lt;div class="apple"&gt;&lt;/div&gt;</strong></span>
<span class="strong"><strong>&lt;div class="orange"&gt;&lt;/div&gt;</strong></span>
 &lt;div class="banana"&gt;&lt;/div&gt;</pre></div><p>
</p>
<p>
<code class="literal">$(".apple,</code> <code class="literal">.orange")</code> selects the highlighted elements that <code class="literal">class</code> is set to, either <code class="literal">apple</code> or <code class="literal">orange</code>.</p>
</td></tr></tbody></table></div></div><div class="section" title="Understanding the jQuery CSS function"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>Understanding the jQuery CSS function</h2></div></div></div><p>The jQuery <code class="literal">css</code> function <a id="id109" class="indexterm"/>works to get and set the CSS properties of the selected elements. This is known as getting and setting pattern where many jQuery functions follow.</p><p>Here is a general definition of how to use the <code class="literal">css</code> function:</p><div class="informalexample"><pre class="programlisting">.css(propertyName)
.css(propertyName, value)</pre></div><p>The <code class="literal">css</code> function accepts several types of arguments as listed in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Function type</p>
</th><th style="text-align: left" valign="bottom">
<p>Arguments definitions</p>
</th><th style="text-align: left" valign="bottom">
<p>Discussion</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.css(propertyName)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">propertyName</code> is a CSS property</p>
</td><td style="text-align: left" valign="top">
<p>The function returns the value of the given CSS property of the selected element.</p>
<p>For example, the following code returns the value of the <code class="literal">background-color</code> property of the <code class="literal">body</code> element:</p>
<p>
<code class="literal">$("body").css("background-color")</code>
</p>
<p>It will only read the value and not modify the property value.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">css(propertyName,</code> <code class="literal">value)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">propertyName</code> is a CSS <a id="id110" class="indexterm"/>property, and <code class="literal">value</code> is a value to set for the property.</p>
</td><td style="text-align: left" valign="top">
<p>The function modifies the given CSS property to the given value.</p>
<p>For example, the following code sets the background color of all elements with the <code class="literal">box</code> class to red:</p>
<p>
<code class="literal">$(".box").css("background-color","#ff0000")</code>
</p>
</td></tr></tbody></table></div></div><div class="section" title="Manipulating game elements in DOM with jQuery"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Manipulating game elements in DOM with jQuery</h2></div></div></div><p>We initialized the paddles' game elements with <a id="id111" class="indexterm"/>jQuery. We<a id="id112" class="indexterm"/> will do an experiment on how we should use jQuery to place the game elements.</p></div><div class="section" title="Understanding the behavior of absolute position"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>Understanding the behavior of absolute position</h2></div></div></div><p>When a DOM node is set to <a id="id113" class="indexterm"/>be at the <code class="literal">absolute</code> position, the left and top properties can be treated as a<a id="id114" class="indexterm"/> <span class="strong"><strong>coordinate</strong></span>. We can treat the left/top properties into X/Y coordinates with Y positive pointing down. The following graphs show the relationship. The left side is the actual CSS value, and the right side is the coordinate system in our mind when programming the game:</p><div class="mediaobject"><img src="graphics/B04290_02_06.jpg" alt="Understanding the behavior of absolute position"/></div><p>By default, the left and top<a id="id115" class="indexterm"/> properties refer to the top-left edge of the web page. This reference point is different when any parent of this DOM node has a <code class="literal">position</code> style set explicitly to <code class="literal">relative</code> or <code class="literal">absolute</code>. The reference point of the left and top properties becomes the top-left edge of that parent.</p><p>This is why we need to set the game with a relative position and all game elements inside it with an absolute position. The following code snippet from our example shows the position values of the elements:</p><div class="informalexample"><pre class="programlisting">#game{
  position: relative;
}
#playground,
#ball,
#paddle {
  position: absolute;
}</pre></div></div><div class="section" title="Declaring global variables in a better way"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>Declaring global variables in a better way</h2></div></div></div><p>
<span class="strong"><strong>Global variables</strong></span> <a id="id116" class="indexterm"/>are variables that can be accessed globally in the entire <a id="id117" class="indexterm"/>document. Any variable that is declared outside any function is a global variable. For instance, in the following example code snippet, <code class="literal">a</code> and <code class="literal">b</code> are global variables, while <code class="literal">c</code> is a <span class="strong"><strong>local variable</strong></span>
<a id="id118" class="indexterm"/> that only exists inside the function:</p><div class="informalexample"><pre class="programlisting">var a = 0;
var b = "xyz";
function something(){
  var c = 1;
}</pre></div><p>Since global variables are available in the entire document, they may increase the chance of variable name conflicts if we integrate different JavaScript libraries into the same web page. As good practice, we should minimize the use of global variables.</p><p>In the preceding <span class="emphasis"><em>Time for action</em></span> section, we have an object to store the game data. Instead of just putting this object in the global scope, we created an object named <code class="literal">pingpong</code> and put the data inside it.</p><p>Moreover, when we <a id="id119" class="indexterm"/>put all our logic into a self-executing function, as we discussed in the last section, we make the game's data object locally inside the function scope.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Declaring variables without <code class="literal">var</code> puts the variables in the global scope even when they are defined inside a function scope. So, we always declare variables with <code class="literal">var</code>.</p></div></div></div><div class="section" title="Pop quiz"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>Pop quiz</h2></div></div></div><p>Q1. Which jQuery selector is to be used if you want to select all header elements?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">$("#header")</code></li><li class="listitem"><code class="literal">$(".header")</code></li><li class="listitem"><code class="literal">$("header")</code></li><li class="listitem"><code class="literal">$(header)</code></li></ol></div></div></div>
<div class="section" title="Getting mouse input"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Getting mouse input</h1></div></div></div><p>You learned how to display <a id="id120" class="indexterm"/>game objects with CSS and jQuery in the previous sections. The next thing we need to create in the game is a way to get input from the players. We will discuss about the mouse input in this section.</p></div>
<div class="section" title="Time for action &#x2013; moving DOM objects by mouse input"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Time for action – moving DOM objects by mouse input</h1></div></div></div><p>We are going to create a<a id="id121" class="indexterm"/> traditional Ping Pong game. There is a paddle<a id="id122" class="indexterm"/> on both the left and right sides of the playground. A ball is placed in the middle of the playground. Players can control the right paddle and move it up and down by using the mouse. We will focus on the mouse input and leave the ball movement for a later section:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's continue with our <code class="literal">pingpong</code> directory.</li><li class="listitem">Next, add a <code class="literal">playground</code> object inside the <code class="literal">pingpong</code> data object in the <code class="literal">js/pingpong.js</code> file. This stores variables that are related to <code class="literal">playground</code>:<div class="informalexample"><pre class="programlisting">// data definition
var pingpong = {
  paddleA: {
    x: 50,
    y: 100,
    width: 20,
    height: 70
  },
  paddleB: {
    x: 320,
    y: 100,
    width: 20,
    height: 70
  },
  playground: {
    offsetTop: $("#playground").offset().top,
  }
};</pre></div></li><li class="listitem">Then, create the<a id="id123" class="indexterm"/> following function that handles<a id="id124" class="indexterm"/> the mouse's enter, move, and leave events, and place it inside the <code class="literal">js/pingpong.js</code> file:<div class="informalexample"><pre class="programlisting">function handleMouseInputs() {
  // run the game when mouse moves in the playground.
  $('#playground').mouseenter(function(){
    pingpong.isPaused = false;
  });

  // pause the game when mouse moves out the playground.
  $('#playground').mouseleave(function(){
    pingpong.isPaused = true;
  });

  // calculate the paddle position by using the mouse position.
  $('#playground').mousemove(function(e){
    pingpong.paddleB.y = e.pageY - pingpong.playground.offsetTop;  
  });
}</pre></div></li><li class="listitem">We had the <code class="literal">renderPaddles</code> function in the previous section. In this section, we are defining a <code class="literal">render</code> function and calling the paddles rendering logic. We then call the <code class="literal">render</code> function on the next browser redraw via the <code class="literal">requestAnimationFrame</code> function.<div class="informalexample"><pre class="programlisting">function render() {
  renderPaddles();
  window.requestAnimationFrame(render);
}</pre></div></li><li class="listitem">Finally, we create an <code class="literal">init</code> function to execute the initial logic.<div class="informalexample"><pre class="programlisting">function init() {
  // view rendering
  window.requestAnimationFrame(render);

  // inputs
  handleMouseInputs();
}</pre></div></li><li class="listitem">Finally, you need to <a id="id125" class="indexterm"/>call the <code class="literal">init</code> function that starts <a id="id126" class="indexterm"/>our game logic:<div class="informalexample"><pre class="programlisting">(function($){
  // All our existing code

  // Execute the starting point
  init();
})(jQuery);</pre></div></li><li class="listitem">Let's test the <code class="literal">paddle</code> control of the game. Open the <code class="literal">index.html</code> page in the web browser. Try moving the mouse up and down within the playground area. The right paddle should follow your mouse's movement.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We handled the mouse events to move the paddle based on the mouse position. You can play the current work-in-progress version<a id="id127" class="indexterm"/> of the game at <a class="ulink" href="http://makzan.net/html5-games/pingpong-wip-step3/">http://makzan.net/html5-games/pingpong-wip-step3/</a>.</p></div><div class="section" title="Getting the mouse event"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>Getting the mouse event</h2></div></div></div><p>jQuery provides several handy <a id="id128" class="indexterm"/>mouse events, and the most basic ones are click, mouse down and mouse up. We track the mouse enter and mouse leave event to start and pause the game. We also use the mouse move event to get the mouse position and update the paddle position based on the mouse position on the playground section.</p><p>We need to get the <span class="emphasis"><em>y</em></span> position of the cursor based on the playground's top left edge. The value of <code class="literal">Y</code> in the mouse event is the mouse cursor from the page's top left edge. We then subtract the position of the playground via <code class="literal">$("#playground").offset().top</code>.</p><p>We update the data of<a id="id129" class="indexterm"/> paddle's <code class="literal">Y</code> value by using the mouse's <code class="literal">X</code> and <code class="literal">Y</code> values. This value will eventually reflect on the screen when the paddle view is updated in the <code class="literal">render</code> function during the browser redraw.</p></div><div class="section" title="RequestAnimationFrame"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>RequestAnimationFrame</h2></div></div></div><p>The time interval is used to<a id="id130" class="indexterm"/> execute the game loop. The <code class="literal">game</code> loop calculates the game logic, which calculates the movement of the game objects.</p><p>The <code class="literal">requestAnimationFrame</code> feature is used to update the view according to the data. We use the <code class="literal">requestAnimationFrame</code> feature to update the view because the view only needs to update in an optimal scenario, where the browser decides.</p><p>The interval of <code class="literal">requestAnimationFrame</code> is not fixed. When the browser is at the front end, the <code class="literal">requestAnimationFrame</code> feature would run often. When the battery is low or the browser is in the background, the browser would slow down the frequency of execution of the <code class="literal">requestAnimationFrame</code> feature.</p><p>We are using <code class="literal">RequestAnimationFrame</code> only on view-related logic. In a later section, we will need to handle game data calculation. For data calculation, we will use <code class="literal">setInterval</code> because the <code class="literal">setInterval</code> function always executes in a fixed time interval. That's why we use the <code class="literal">setInterval</code> function for the game logic calculation and animation frame for view rendering.</p></div><div class="section" title="Checking the console window"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>Checking the console window</h2></div></div></div><p>We are writing more complicated logic code now. It is good practice to keep an eye on the console of the <a id="id131" class="indexterm"/>
<span class="strong"><strong>Developers Tools</strong></span>. You may toggle between the developer <a id="id132" class="indexterm"/>tools by pressing <span class="emphasis"><em>F12</em></span> in Windows or <span class="emphasis"><em>command</em></span> + <span class="emphasis"><em>option</em></span> + <span class="emphasis"><em>I</em></span> on Mac OS. If the code contains any error or warning, the error message will appear there. It reports any found error and the line of code that contains the error. It is very useful and important to have the console window open when testing HTML5 games. I have often seen people get stuck and have no idea as to why the code is not working. The reason for this is that they have a typo or syntax error, and they did not check the console window before fighting with the code for hours.</p><p>The following screenshot shows that there is an error in the twenty-fifth line of the <code class="literal">js/pingpong.js</code> file. The error message is <span class="strong"><strong>Invalid left-hand side in assignment</strong></span>. After inspecting the code, I found that I wrongly used an equal sign (<code class="literal">=</code>) when setting the CSS <code class="literal">top</code> property in jQuery:</p><div class="informalexample"><pre class="programlisting">$("#paddleA").css("top"=top+5);

// instead of the correct code:
// $("#paddleA").css("top", top+5);</pre></div><p>The error is <a id="id133" class="indexterm"/>displayed as follows:</p><div class="mediaobject"><img src="graphics/B04290_02_07.jpg" alt="Checking the console window"/></div></div><div class="section" title="Moving a DOM object with JavaScript Interval"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>Moving a DOM object with JavaScript Interval</h2></div></div></div><p>Imagine now we can <a id="id134" class="indexterm"/>make the little red ball move <a id="id135" class="indexterm"/>around the playground. The ball will bounce away when it hits the paddles. The player will win a score when the ball passes the opponent's paddle and hits the playground edge behind the paddle. All these actions manipulate the position of the DIVs inside the HTML page by jQuery. To complete this Ping Pong game, our next step is to move the ball.</p></div></div>
<div class="section" title="Time for action &#x2013; Moving the ball with JavaScript Interval"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Time for action – Moving the ball with JavaScript Interval</h1></div></div></div><p>We will use the function<a id="id136" class="indexterm"/> to create a timer. The timer moves the<a id="id137" class="indexterm"/> ball a little bit every 30 milliseconds. We are going to also change the direction of the ball movement once it hits the playground edge. Let's make the ball move now:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We will use our last example, listening to multiple keyboard inputs, as the starting point.</li><li class="listitem">Open the <code class="literal">js/pingpong.js</code> file in the text editor.</li><li class="listitem">In the existing <code class="literal">pingpong.playground</code> object, we change to the following code that adds height and width to the playground.<div class="informalexample"><pre class="programlisting">playground: {
  offsetTop: $("#playground").offset().top,
  height: parseInt($("#playground").height()),
  width: parseInt($("#playground").width()),
},</pre></div></li><li class="listitem">We are now moving the ball, and we need to store the ball's status globally. We will put the ball-related variable inside the <code class="literal">pingpong</code> object:<div class="informalexample"><pre class="programlisting">var pingpong = {
  //existing data
  ball: {
    speed: 5,
    x: 150,
    y: 100,
    directionX: 1,
    directionY: 1
  }
}</pre></div></li><li class="listitem">We define a <code class="literal">gameloop</code> function and move the ball on each game loop iteration:<div class="informalexample"><pre class="programlisting">function gameloop() {
  moveBall();
}</pre></div></li><li class="listitem">We define the functions to check whether the ball is hitting the four boundary walls of the playground:<div class="informalexample"><pre class="programlisting">function ballHitsTopBottom() {
  var y = pingpong.ball.y + pingpong.ball.speed * pingpong.ball.directionY;
  return y &lt; 0 || y &gt; pingpong.playground.height;
}
function ballHitsRightWall() {
  return pingpong.ball.x + pingpong.ball.speed * pingpong.ball.directionX &gt; pingpong.playground.width;
}
function ballHitsLeftWall() {
  return pingpong.ball.x + pingpong.ball.speed * pingpong.ball.directionX &lt; 0;
}</pre></div></li><li class="listitem">Then, we define two<a id="id138" class="indexterm"/> functions that reset the game after <a id="id139" class="indexterm"/>either player wins.<div class="informalexample"><pre class="programlisting">function playerAWin() {
  // reset the ball;
  pingpong.ball.x = 250;
  pingpong.ball.y = 100;

  // update the ball location variables;
  pingpong.ball.directionX = -1;
}
function playerBWin() {
  // reset the ball;
  pingpong.ball.x = 150;
  pingpong.ball.y = 100;

  pingpong.ball.directionX = 1;
}</pre></div></li><li class="listitem">It is time to define the <code class="literal">moveBall</code> function. The function checks the boundaries of the playground, changes the direction of the ball when it hits the boundaries, and sets the new ball position after all these calculations. Let's put the following <code class="literal">moveBall</code> function definition in the JavaScript file:<div class="informalexample"><pre class="programlisting">function moveBall() {  
  // reference useful varaibles
  var ball = pingpong.ball;

  // check playground top/bottom boundary
  if (ballHitsTopBottom()) {
    // reverse direction
    ball.directionY *= -1;
  }
  // check right
  if (ballHitsRightWall()) {
    playerAWin();
  }
  // check left
  if (ballHitsLeftWall()) {
    playerBWin();
  }

  // check paddles here

  // update the ball position data
    ball.x += ball.speed * ball.directionX;
    ball.y += ball.speed * ball.directionY;
}</pre></div></li><li class="listitem">We have calculated<a id="id140" class="indexterm"/> the ball's movement. Next, we <a id="id141" class="indexterm"/>want to render the view to update the ball's position based on the data. To do this, define a new <code class="literal">renderBall</code> function with the following code.<div class="informalexample"><pre class="programlisting">function renderBall() {
  var ball = pingpong.ball;
  $("#ball").css({
    "left" : ball.x + ball.speed * ball.directionX,
    "top" : ball.y + ball.speed * ball.directionY
  });
}</pre></div></li><li class="listitem">Now, we need to update the <code class="literal">render</code> function to render the ball's update based on the updated game data:<div class="informalexample"><pre class="programlisting">function render() {
  renderBall();
  renderPaddles();
  window.requestAnimationFrame(render);
}</pre></div></li><li class="listitem">The following lines of code is the new <code class="literal">init</code> function where we added a <code class="literal">gameloop</code> logic with the <code class="literal">setInterval</code> function:<div class="informalexample"><pre class="programlisting">function init() {
  // set interval to call gameloop logic in 30 FPS
  pingpong.timer = setInterval(gameloop, 1000/30);

  // view rendering
  window.requestAnimationFrame(render);

  // inputs
  handleMouseInputs();
}</pre></div></li><li class="listitem">We have prepared the code to move the ball every 33.3 milliseconds. Save all the files and open <code class="literal">index.html</code> in the web browser to test it. The paddles work just as in the last example, and the ball should be moving around the playground.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We just successfully <a id="id142" class="indexterm"/>made the ball move around the playground. We <a id="id143" class="indexterm"/>have a loop to run routine game logic 30 times per second. Inside that game loop, we moved the ball five pixels at a time. You can try the game and view the code in progress at <a class="ulink" href="http://makzan.net/html5-games/pingpong-wip-step6/">http://makzan.net/html5-games/pingpong-wip-step6/</a>.</p><p>There are three properties of the ball: speed, and the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> directions. Speed defines how many pixels the ball moves in each step. The direction X/Y is either 1 or -1. We move the ball using the following equation:</p><div class="informalexample"><pre class="programlisting">new_ball_x = ball_x_position + speed * direction_x
new_ball_y = ball_y_position + speed * direction_y</pre></div><p>The direction value is multiplied by the movement. When the direction is 1, the ball moves to the positive direction of the axis. When the direction is <code class="literal">-1</code>, the ball moves to the negative direction. By toggling the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> directions, we can move the ball in four directions.</p><p>We compare the ball's <code class="literal">X</code> and <code class="literal">Y</code> values with the four edges of the playground DIV element. This checks whether the ball's next position is beyond the boundary, and then, we toggle the direction between 1 and -1 to create the bouncing effect.</p></div><div class="section" title="Creating a JavaScript timer with the setInterval function"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>Creating a JavaScript timer with the setInterval function</h2></div></div></div><p>We have a timer to loop and move <a id="id144" class="indexterm"/>the ball periodically. This<a id="id145" class="indexterm"/> can be done by the <code class="literal">setInterval</code> function in JavaScript.</p><p>Here is the general definition of the <code class="literal">setInterval</code> function:</p><div class="informalexample"><pre class="programlisting">setInterval(expression, milliseconds)</pre></div><p>The <code class="literal">setInterval</code> takes two required arguments. Additional arguments are passed into the function as parameters:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Definition</p>
</th><th style="text-align: left" valign="bottom">
<p>Discussion</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">expression</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The function callback or code expression to be executed</p>
</td><td style="text-align: left" valign="top">
<p>The expression can be a reference of a function callback or an inline code expression. The inline code expression is quoted and a reference of function callback is not.</p>
<p>For example, the following code calls the <code class="literal">hello</code> function every 100 milliseconds:</p>
<p>
</p><div class="informalexample"><pre class="programlisting">setInterval(hello, 100);</pre></div><p>
</p>
<p>The following code calls the <code class="literal">hi</code> function with parameters every 100 milliseconds:</p>
<p>
</p><div class="informalexample"><pre class="programlisting">setInterval("hi('Makzan')", 100);</pre></div><p>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">milliseconds</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The duration between every execution of the expression, in milliseconds</p>
</td><td style="text-align: left" valign="top">
<p>The unit of the interval is in milliseconds. Therefore, setting it to 1000 means running the expression every second.</p>
</td></tr></tbody></table></div></div><div class="section" title="Understanding the game loop"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>Understanding the game loop</h2></div></div></div><p>We have a timer to execute <a id="id146" class="indexterm"/>some game-related code every 33.3 milliseconds, so this code is executed 30 times per second. This frequency is known as frames per second, or FPS. In game development, this timer is called the <span class="strong"><strong>game loop</strong></span>.</p><p>There are several common things that we will execute inside a game loop:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Processing user input, which we just did</li><li class="listitem" style="list-style-type: disc">Updating game objects' status, including position and appearance</li><li class="listitem" style="list-style-type: disc">Checking game over</li></ul></div><p>What is actually executing in the game loop differs in different types of games, but the purpose is the same. The game loop is executed periodically to calculate the game data.</p></div><div class="section" title="Separating the data and the view logic"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>Separating the data and the view logic</h2></div></div></div><p>We have separated the data<a id="id147" class="indexterm"/> and the view logic. We used <code class="literal">setInterval</code> for data and <code class="literal">requestAnimationFrame</code> for view rendering. The data focuses on all the game data calculation, including an object's dimension and position based on the calculation. The <code class="literal">view</code> logic focuses on updating the interface based on the keep-updating game data.</p><p>In our render function, the view updates the CSS of the DOM elements. Imagine later if we are rendering the game in the Canvas, or using any other techniques, that our view rendering logic can use a specific method to render the view based on the same game data. The game data's calculation is independent to the techniques we use to render the game interface.</p></div></div>
<div class="section" title="Beginning collision detection"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Beginning collision detection</h1></div></div></div><p>We have checked the boundary <a id="id148" class="indexterm"/>of the playground when moving the ball in the previous section. Now, we can control the paddles with the keyboard and watch the ball move around the playground. What is missing now? We cannot interact with the ball. We control the paddles but the ball just passes through them as if they are not there. This is because we missed the collision detection between the paddles and the moving ball.</p></div>
<div class="section" title="Time for action &#x2013; hitting the ball with the paddles"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Time for action – hitting the ball with the paddles</h1></div></div></div><p>We will use an approach, <a id="id149" class="indexterm"/>similar to that of checking the boundary, to check the<a id="id150" class="indexterm"/> collision:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">js/pingpong.js</code> file that we used in the previous section.</li><li class="listitem">In the <code class="literal">moveBall</code> function, we have already reserved the place to put the collision detection code there. Find the line with <code class="literal">//</code> <code class="literal">check</code> <code class="literal">paddles</code> <code class="literal">here</code>.</li><li class="listitem">Let's put the following code there. The code checks whether the ball is overlapping with either paddle and bounces the ball away when they overlap:<div class="informalexample"><pre class="programlisting">// Variables for checking paddles
var ballX = ball.x + ball.speed * ball.directionX;
var ballY = ball.y + ball.speed * ball.directionY;
    
// check moving paddle here, later.
// check left paddle
if (ballX &gt;= pingpong.paddleA.x &amp;&amp; ballX &lt; pingpong.paddleA.x + pingpong.paddleA.width) {
  if (ballY &lt;= pingpong.paddleA.y + pingpong.paddleA.height &amp;&amp; ballY &gt;= pingpong.paddleA.y) {
    ball.directionX = 1;
  }
}

// check right paddle
if (ballX + pingpong.ball.radius &gt;= pingpong.paddleB.x &amp;&amp; ballX &lt; pingpong.paddleB.x + pingpong.paddleB.width) {
  if (ballY &lt;= pingpong.paddleB.y + pingpong.paddleB.height &amp;&amp; ballY &gt;= pingpong.paddleB.y) {
    ball.directionX = -1;
  }
}</pre></div></li><li class="listitem">Test the game in a browser and the ball will now bounce away after hitting the left or right paddle. It will also reset to the center of the playground when it hits the left or right edge of the playground.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have modified the ball by <a id="id151" class="indexterm"/>making it bounce away when it overlaps <a id="id152" class="indexterm"/>with the paddles. Let's see how we check the collision between the ball and the left paddle.</p><p>At first, we check whether the ball's <span class="emphasis"><em>x</em></span> position is less than the left paddle's right edge. The right edge is the <code class="literal">left</code> value plus the <code class="literal">width</code> of the paddle.</p><div class="mediaobject"><img src="graphics/B04290_02_08.jpg" alt="What just happened?"/></div><p>Then, we check whether the ball's <span class="emphasis"><em>y</em></span> position is between the top edge and bottom edge of the paddle. The top edge is the <code class="literal">top</code> value and the bottom edge is the <code class="literal">top</code> value plus the <code class="literal">height</code> of the paddle.</p><div class="mediaobject"><img src="graphics/B04290_02_09.jpg" alt="What just happened?"/></div><p>We bounce the ball away if the ball's position passes both the checks. This is how we check it, and it is just a basic collision detection.</p><p>We determine that the two <a id="id153" class="indexterm"/>objects are overlapped by checking their position and <a id="id154" class="indexterm"/>width/height. This type of collision detection works well in rectangle objects but is not good for circles and other shapes. The following screenshot illustrates the issue. The collision areas shown in the following graph are false positive. Their bounding box collides but the actual shapes do not overlap each other. This is a classic and efficient way to check for collisions. It may not be very accurate but its calculation is fast.</p><div class="mediaobject"><img src="graphics/B04290_02_10.jpg" alt="What just happened?"/></div><p>For special shapes, we will need more advanced collision detection techniques, which we will discuss later.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>Have a go hero</h2></div></div></div><p>We have placed two paddles on the playground. How about we make the game more challenging by having an alternative paddle in the middle field? It's like having the goalkeeper and forwards in a soccer machine.</p></div></div>
<div class="section" title="Controlling the left paddle movement"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Controlling the left paddle movement</h1></div></div></div><p>The computer controls the <a id="id155" class="indexterm"/>left paddle. We would like to create a function that makes the left paddle chase the ball.</p></div>
<div class="section" title="Time for action &#x2013; auto moving the left paddle"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Time for action – auto moving the left paddle</h1></div></div></div><p>Perform the following set of actions for<a id="id156" class="indexterm"/> automoving our paddle:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's continue with our <code class="literal">pingpong.js</code> JavaScript file. We create a function that follows the ball's <span class="emphasis"><em>y</em></span> position.<div class="informalexample"><pre class="programlisting">function autoMovePaddleA() {
  var speed = 4;
  var direction = 1;

  var paddleY = pingpong.paddleA.y + pingpong.paddleA.height/2;
  if (paddleY &gt; pingpong.ball.y) {
    direction = -1;
  }

  pingpong.paddleA.y += speed * direction;
}</pre></div></li><li class="listitem">Then, inside the game loop function, we call our <code class="literal">autoMovePaddleA</code> function.<div class="informalexample"><pre class="programlisting">autoMovePaddleA();</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>What just happened?</h2></div></div></div><p>We created a logic that moves the left paddle based on the ball's <span class="emphasis"><em>y</em></span> position. You may try the game with its current progress at <a class="ulink" href="http://makzan.net/html5-games/pingpong-wip-step6/">http://makzan.net/html5-games/pingpong-wip-step6/</a>.</p><p>Since we have already implemented the view rendering in the <code class="literal">renderPaddles</code> function, in this section, we only need to update the paddle's data and the view will get updated automatically.</p><p>We make the paddle speed slower than the ball's speed. Otherwise, the player can never win against the computer, because the computer-controlled paddle can always catch the ball and bounce it back if they have the same speed.</p></div></div>
<div class="section" title="Showing text dynamically in HTML"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Showing text dynamically in HTML</h1></div></div></div><p>We have implemented the basic game mechanics<a id="id157" class="indexterm"/> in the previous sections. Our <a id="id158" class="indexterm"/>Ping Pong game is missing a scoring board that shows both players' scores. We discussed how to use jQuery to modify the CSS styles of the selected elements. Can we also alter the content of the selected elements with jQuery? Yes, we can.</p></div>
<div class="section" title="Time for action &#x2013; Showing the score of both players"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Time for action – Showing the score of both players</h1></div></div></div><p>We are going to create a text-based scoreboard<a id="id159" class="indexterm"/> and update the scores when either player scores a goal:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We are making improvements on our existing game so that we can use the last example as the starting point.</li><li class="listitem">Open the <code class="literal">index.html</code> in the text editor. We are going to add the scoreboard's DOM elements.</li><li class="listitem">Add the <code class="literal">#scoreboard</code> HTML structure to our <code class="literal">#game</code> DIV inside index.html. The <code class="literal">#game</code> DIV becomes the following:<div class="informalexample"><pre class="programlisting">&lt;div id="game"&gt;
  &lt;div id="playground"&gt;
    &lt;div class="paddle-hand right"&gt;&lt;/div&gt;
    &lt;div class="paddle-hand left"&gt;&lt;/div&gt;
    &lt;div id="paddleA" class="paddle"&gt;&lt;/div&gt;
    &lt;div id="paddleB" class="paddle"&gt;&lt;/div&gt;
    &lt;div id="ball"&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;div id="scoreboard"&gt;
    &lt;div class="score"&gt; A : &lt;span id="score-a"&gt;0&lt;/span&gt;&lt;/div&gt;
    &lt;div class="score"&gt; B : &lt;span id="score-b"&gt;0&lt;/span&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Now, let's move onto the JavaScript part. Open the <code class="literal">js/pingpong.js</code> file.</li><li class="listitem">We need two more variables to store the players' scores. Add their score variables inside the existing <code class="literal">pingpong</code> data object:<div class="informalexample"><pre class="programlisting">var pingpong = {
  scoreA : 0,  // score for player A
  scoreB : 0,  // score for player B

  // existing pingpong data goes here.
}</pre></div></li><li class="listitem">Find the <code class="literal">playerAWin</code> function. We increment player A's score there and update the scoreboard with the following code:<div class="informalexample"><pre class="programlisting">// player B lost.
pingpong.scoreA += 1;
$("#score-a").text(pingpong.scoreA);</pre></div></li><li class="listitem">We can add a code similar to that in the previous step to update player B's score when player A is lost in the <code class="literal">playerBWin</code> function:<div class="informalexample"><pre class="programlisting">// player A lost.
pingpong.scoreB += 1;
$("#score-b").text(pingpong.scoreB);</pre></div></li><li class="listitem">Let's move onto the <code class="literal">css/pingpong.css</code> file. Put the following styles in the file to make the score board look nicer:<div class="informalexample"><pre class="programlisting">/* Score board */
#scoreboard {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 5px;
  color: lightgrey;
}</pre></div></li><li class="listitem">It is time to test <a id="id160" class="indexterm"/>our latest code. Open the <code class="literal">index.html</code> in a web browser. Try playing by controlling both paddles and lose some points. The scoreboard should be counting the scores correctly.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>What just happened?</h2></div></div></div><p>We just used another common jQuery function: <code class="literal">text()</code> to alter the content of the game on the fly.</p><p>The <code class="literal">text()</code> function gets or updates the text content of the selected element. Here is a general definition of the <code class="literal">text</code>() function:</p><div class="informalexample"><pre class="programlisting">.text()
.text(string)</pre></div><p>When we use the <code class="literal">text()</code> function without an argument, it returns the text content of the match elements. When we use it with an argument, it sets the text content to all the matched elements with the given string.</p><p>For example, provide the following HTML structure:</p><div class="informalexample"><pre class="programlisting">&lt;p&gt;My name is &lt;span id="myname" class="name"&gt;Makzan&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;My pet's name is &lt;span id="pet" class="name"&gt;
  Co-co&lt;/span&gt;.&lt;/p&gt;</pre></div><p>The following jQuery calls return Makzan:</p><div class="informalexample"><pre class="programlisting">$("#myname").text(); // returns Makzan</pre></div><p>However, in the following jQuery call, it sets all matched elements to the given HTML content:</p><div class="informalexample"><pre class="programlisting">$(".name").text("Mr. Mystery")</pre></div><p>Executing the jQuery command gives the following HTML result:</p><div class="informalexample"><pre class="programlisting">&lt;p&gt;My name is &lt;span id="myname" class="name"&gt;Mr. Mystery&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;My pet's name is &lt;span id="pet" class="name"&gt;Mr. Mystery&lt;/span&gt;&lt;/p&gt;</pre></div></div><div class="section" title="Have a go hero – winning the game"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec61"/>Have a go hero – winning the game</h2></div></div></div><p>Imagine that the game is an advertisement. We set the entire game playground with pointer cursor so that the user knows the game is clickable and links to some other place. Try to use jQuery's <code class="literal">click</code> event and handle the advertisement that's linked to the <code class="literal">handleMouseInputs</code> function.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec30"/>Summary</h1></div></div></div><p>You learned a lot in this chapter about the basic techniques of creating a simple Ping Pong game with HTML5 and JavaScript. Specifically, we created our first HTML5 game—Ping Pong. In the game, we used jQuery to manipulate DOM objects. We were able to use the mouse event to get the cursor position. We used a very simple method to detect collisions with the bounding box. In the logic, we separated data manipulation and view rendering. We also discussed how to create a game loop and move the ball and paddles.</p><p>Now that we've warmed up by creating a simple DOM-based game, we are ready to create more advanced DOM-based games with new features from CSS3. In the next chapter, we will create games with CSS3 transition and transformation.</p></div></body></html>