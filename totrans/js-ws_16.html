<html><head></head><body>
		<div>
			<div class="Content" id="_idContainer358">
			</div>
		</div>
		<div class="Content" id="_idContainer359">
			<h1 id="_idParaDest-572"><a id="_idTextAnchor634"/>Appendix</h1>
		</div>
		<div id="_idContainer360">
			<h2>About</h2>
			<p>This section is included to assist the students to perform the activities present in the book. It includes detailed steps that are to be performed by the students to complete and achieve the objectives of the book.</p>
		</div>
		<div class="Content" id="_idContainer380">
			<h1 id="_idParaDest-573"><a id="_idTextAnchor635"/>Chapter 1: Getting to Know JavaScript</h1>
			<h2 id="_idParaDest-574"><a id="_idTextAnchor636"/>Activity 1.01: Creating an Alert Box Popup in the Web Browser</h2>
			<h3 id="_idParaDest-575"><a id="_idTextAnchor637"/>Solution</h3>
			<ol>
				<li>Press <em class="italic">F12</em> to open the developer tools that are integrated within it. If this doesn't work, a right-click may expose a prompt so that you can do this as well:<div class="IMG---Figure" id="_idContainer361"><img alt="Figure 1.18: Choosing Inspect in Google Chrome&#13;&#10;" src="image/C14377_01_18.jpg"/></div><p class="figure-caption">Figure 1.18: Choosing Inspect in Google Chrome</p></li>
				<li>The developer tools may default to the console. If not, there is likely to be a <strong class="source-inline">Console</strong> tab you can click on to activate it. The console allows you to write JavaScript code directly within the web browser itself:<div class="IMG---Figure" id="_idContainer362"><img alt="Figure 1.19: The Developer Tools Console tab in Google Chrome&#13;&#10;" src="image/C14377_01_19.jpg"/></div><p class="figure-caption">Figure 1.19: The Developer Tools Console tab in Google Chrome</p></li>
				<li>Within the console, write the following command:<p class="source-code">var greeting = 'Hello from JavaScript!';</p><p class="source-code">alert(greeting);</p></li>
				<li>Hit <em class="italic">Return</em>/<em class="italic">Enter</em> to execute the code. The code will execute within the browser environment.<p>You should see an alert appear in the browser viewport displaying your message, as shown here:</p></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer363">
					<img alt="Figure 1.20: An alert appears with our message&#13;&#10;" src="image/C14377_01_20.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 1.20: An alert appears with our message</p>
			<p>What does that code do? It declares a variable, using the <strong class="source-inline">var</strong> keyword, with the <strong class="source-inline">greeting</strong> identifier on the first line. As part of this same line of code, we then use the <strong class="source-inline">=</strong> assignment operator to assign a <strong class="source-inline">'Hello from JavaScript!'</strong> text string value to our variable.</p>
			<p>On the second line, we use the <strong class="source-inline">alert()</strong> function and pass in our <strong class="source-inline">greeting</strong>  identifier as an argument. The result is that the web browser displays an alert overlay with the text value applied to the identifier we passed in. </p>
			<h1 id="_idParaDest-576"><a id="_idTextAnchor638"/>Chapter 2: Working with JavaScript</h1>
			<h2 id="_idParaDest-577">Activity 2.01: Add<a id="_idTextAnchor639"/>ing and Modifying an Item to/in the To-Do List</h2>
			<h3 id="_idParaDest-578"><a id="_idTextAnchor640"/>Solution</h3>
			<ol>
				<li value="1">Cr<a id="_idTextAnchor641"/>eate the HTML file yourself and paste in the HTML code to get started:<div class="IMG---Figure" id="_idContainer364"><img alt="Figure 2.28: The initial to-do list's appearance&#13;&#10;" src="image/C14377_02_28.jpg"/></div><p class="figure-caption">Figure 2.28: The initial to-do list's appearance</p></li>
				<li>The first thing we need to do is assign an ID to our list in order to identify it via code. To do this, add an <strong class="source-inline">id</strong> attribute to the <strong class="source-inline">ol</strong> element and give it a value of <strong class="source-inline">todo-list</strong>. With that complete, we can then address this element directly with JavaScript:<p class="source-code">&lt;ol id="todo-list"&gt;</p></li>
				<li>Using a bit of JavaScript code, we can now create a new variable named <strong class="source-inline">parentContainer</strong>. This will refer to the ordered list container element that holds all of our list items. We'll use the ID we assigned in the previous step to address this element directly via the use of the <strong class="source-inline">getElementById()</strong> method:<p class="source-code">var parentContainer = document.getElementById('todo-list');</p></li>
				<li>Create a new HTML <strong class="source-inline">&lt;li&gt;</strong> list item element via JavaScript. Right now, the element only exists in memory since we have to add it to a visual container. It also has no text content associated with it:<p class="source-code">var newItem = document.createElement('li');</p></li>
				<li>Now, let's populate the list item with a data value. Set the <strong class="source-inline">innerText</strong> of our <strong class="source-inline">newItem</strong> node to a string. The value of that string can be whatever you like, but it should fit within the concept of a to-do list:<p class="source-code">newItem.innerText = "Research Wines";</p></li>
				<li>Now that the new HTML element has been created and populated with text, we can add it to the visual document by appending it to a chosen parent container that already exists:<p class="source-code">parentContainer.appendChild(newItem);</p></li>
				<li>We t<a id="_idTextAnchor642"/>hen need to add an extra line of JavaScript below all the others that currently exist within our <strong class="source-inline">&lt;script&gt;</strong> tag to modify the element's appearance. We will reference the last child element within our ordered list and change the <strong class="source-inline">style</strong> attribute to add a CSS color rule. You can set the actual color of the text to whatever you like—I'm going to use <strong class="source-inline">crimson</strong>:<p class="source-code">parentContainer.lastChild.style.color = "crimson";</p></li>
				<li>Now,<a id="_idTextAnchor643"/> to verify the execution order through code, add the following line of JavaScript directly underneath the initial declaration of <strong class="source-inline">parentContainer</strong>: <p class="source-code">console.log('Beginning List Count: ' + parentContainer.children.length);</p></li>
				<li>Then, add the following line right before the closing <strong class="source-inline">&lt;script&gt;</strong> tag:<p class="source-code">console.log('End List Count: ' + parentContainer.children.length);</p></li>
				<li>With that completed, refresh your browser view and a seventh item should appear on your list. Do keep an eye on the developer tools console to verify the execution order of our code! Not only will the new item be added to the existing ordered list, but it will also display with crimson text instead of the usual white:<div class="IMG---Figure" id="_idContainer365"><img alt="Figure 2.29: A list item has been added to our to-do list and styled in crimson&#13;&#10;" src="image/C14377_02_29.jpg"/></div></li>
			</ol>
			<p class="figure-caption">Figure 2.29: A list item has been added to our to-do list and styled in crimson</p>
			<p>The complete code will be as follows:</p>
			<p class="source-code-heading">activity-complete.html</p>
			<p class="source-code">30    &lt;ol i<a id="_idTextAnchor644"/>d="todo-list"&gt;</p>
			<p class="source-code">31        &lt;li&gt;Wash Laundry&lt;/li&gt;</p>
			<p class="source-code">32        &lt;li&gt;Clean Silver&lt;/li&gt;</p>
			<p class="source-code">33        &lt;li&gt;Write Letters&lt;/li&gt;</p>
			<p class="source-code">34        &lt;li&gt;Purchase Groceries&lt;/li&gt;</p>
			<p class="source-code">35        &lt;li&gt;Retrieve Mail&lt;/li&gt;</p>
			<p class="source-code">36        &lt;li&gt;Prepare Dinner&lt;/li&gt;</p>
			<p class="source-code">37    &lt;/ol&gt;</p>
			<p class="source-code">38    &lt;script&gt;</p>
			<p class="source-code">39        var parentContainer = document.getElementById('todo-list');</p>
			<p class="source-code-link">The full code is available at: <a href="https://packt.live/2q8CGY1">https://packt.live/2q8CGY1</a></p>
			<p>This is just a simple example of how JavaScript can have a direct influence over other aspects of the environment it is run with.</p>
			<h1 id="_idParaDest-579"><a id="_idTextAnchor645"/>Chapter 3: Programming Fundamentals</h1>
			<h2 id="_idParaDest-580"><a id="_idTextAnchor646"/>Activity 3.01: The To-Do List Shuffle <span class="None">Program</span></h2>
			<h3 id="_idParaDest-581"><a id="_idTextAnchor647"/>Solution</h3>
			<ol>
				<li value="1"><span class="None">All the coding is done in the </span><strong class="source-inline">activity.js</strong><span class="None"> file. Add the code after the comment shown in each step. Create the array of </span><strong class="source-inline">todo</strong><span class="None"> items:</span><p class="source-code"><span class="None">// Declare and initialize the todo list array</span></p><p class="source-code"><span class="None">let todoList = [</span></p><p class="source-code"><span class="None"> "Wash Laundry",</span></p><p class="source-code"><span class="None"> "Clean Silver",</span></p><p class="source-code"><span class="None"> "Write Letters",</span></p><p class="source-code"><span class="None"> "Purchase Groceries",</span></p><p class="source-code"><span class="None"> "Retrieve Mail",</span></p><p class="source-code"><span class="None"> "Prepare Dinner"</span></p><p class="source-code"><span class="None">];</span></p></li>
				<li><span class="None">Examine the </span><strong class="source-inline">ol</strong><span class="None"> element in the HTML document file called </span><strong class="source-inline">activity.html</strong> and notice that it has an <strong class="source-inline">id</strong> attribute with the value of <strong class="source-inline">todo-list</strong>:<p class="source-code"><span class="None"> &lt;ol id="todo-list"&gt;</span></p><p class="source-code"><span class="None"> &lt;/ol&gt;</span></p></li>
				<li><span class="None">You can create an </span>object variable, referencing the <strong class="source-inline">ol</strong> element using the <strong class="source-inline">document.getElementById</strong> method:<p class="source-code">// The todo list element</p><p class="source-code"><span class="None">let todoEle = document.getElementById('todo-list');</span></p></li>
				<li><span class="None">Next, write a function that accepts a list element object and an array of values. The function removes the </span><strong class="source-inline">li</strong> elements<span class="None"> from the </span>list element and then loops through the array, creating new <strong class="source-inline">li</strong> elements for each value in the array<span class="None">:</span><p class="source-code"><span class="None">// Function to replace an HTML DOM list li elements with array items.</span></p><p class="source-code"><span class="None">function replaceListElements(listEle, listItems){</span></p><p class="source-code"><span class="None"> listEle.innerHTML = "";</span></p><p class="source-code"><span class="None"> for (let i= 0; i&lt;= listItems.length - 1; i++){</span></p><p class="source-code"><span class="None">  let liEle = document.createElement("li");</span></p><p class="source-code"><span class="None">  liEle.appendChild(document.createTextNode(listItems[i]));</span></p><p class="source-code"><span class="None">  listEle.appendChild(liEle);</span></p><p class="source-code"><span class="None"> }</span></p><p class="source-code"><span class="None">}</span></p><p><span class="None">The first line uses the </span><strong class="source-inline">innerHTML</strong><span class="None"> property to remove all the contents of the list element object. The </span><strong class="source-inline">for</strong><span class="None"> loop iterates through the array. The first line in the </span><strong class="source-inline">for</strong> loop<span class="None"> creates an </span><strong class="source-inline">li</strong> element object named <strong class="source-inline">liEle</strong>. The next line uses the <strong class="source-inline">liEle</strong> object's <strong class="source-inline">addChild</strong> method to append a text node to the <strong class="source-inline">liEle</strong> object. The <strong class="source-inline">document.createTextNode</strong> method provides the item in the array as a proper node object. The last line appends the <strong class="source-inline">liEle</strong> object to the <strong class="source-inline">listEle</strong> object.</p></li>
				<li><span class="None">The final step is to call the function:</span><p class="source-code"><span class="None">// Update the todo list view with initial list of items</span></p><p class="source-code"><span class="None">replaceListElements(todoEle, todoList);</span></p><p><span class="None">This function will execute when the </span><strong class="source-inline">activity.js</strong><span class="None"> file is loaded.</span></p></li>
				<li><span class="None">Save the </span><strong class="source-inline">activity.js</strong><span class="None"> file and reload the </span><strong class="source-inline">activity.html</strong> file in the web browser. It should appear as follows:<div class="IMG---Figure" id="_idContainer366"><img alt="Figure 3.24: activity.js and activity.html file output&#13;&#10;" src="image/C14377_03_24.jpg"/></div><p class="figure-caption">Figure 3.24: <strong class="source-inline">activity.js</strong><span class="None"> and </span><strong class="source-inline">activity.html</strong><span class="None"> file output</span></p></li>
				<li><span class="None">Examine the </span><strong class="source-inline">button</strong><span class="None"> element in the HTML document file called </span><strong class="source-inline">activity.html</strong> and notice that it has an <strong class="source-inline">id</strong> attribute with the value of <strong class="source-inline">shuffle-button</strong>:<p class="source-code"><span class="None"> &lt;button id="shuffle-button"&gt;Shuffle&lt;/button&gt;</span></p><p><span class="None">You can create an </span>object variable referencing the <strong class="source-inline">button</strong> element by using the <strong class="source-inline">document.getElementById</strong> method:</p><p class="source-code">// The shuffle button element.</p><p class="source-code">let shuffleButtonEle = document.getElementById('shuffle-button');</p></li>
				<li><span class="None">Next, you need to listen for click events and call a function that will handle the event. The </span><strong class="source-inline">shuffleButtonEle</strong> object's <strong class="source-inline">addEventListener</strong><span class="None"> method can do that for you. The first argument is the name of the event, and the second argument is the name of the function:</span><p class="source-code"><span class="None">// Add event listener function for the shuffle button element.</span></p><p class="source-code"><span class="None">shuffleButtonEle.addEventListener('click', shuffleButtonClicked);</span></p></li>
				<li><span class="None">Now, we need to write the </span><strong class="source-inline">shuffleButtonClicked</strong><span class="None"> function:</span><p class="source-code"><span class="None">// Function to handle click events for the Shuffle button</span></p><p class="source-code"><span class="None">function shuffleButtonClicked(e){</span></p><p class="source-code"><span class="None"> replaceListElements(todoEle, getNewShuffledArray(todoList));</span></p><p class="source-code"><span class="None">}</span></p><p><span class="None">The only line of code is used to call the </span><strong class="source-inline">replaceListElements</strong> function. The first argument is the <strong class="source-inline">todoEle</strong> object for the <strong class="source-inline">ol</strong> element. The second argument is the <strong class="source-inline">getNewShuffledArray</strong> function, which is using the <strong class="source-inline">todoList</strong> array as an argument. The <strong class="source-inline">getNewShuffledArray</strong> function returns an array that's been shuffled.</p></li>
				<li><span class="None">Save the </span><strong class="source-inline">activity.js</strong><span class="None"> file and reload the </span><strong class="source-inline">activity.html</strong> file in the web browser. Then, click the Shuffle button to see the list change.</li>
				<li>Take a moment to examine the comments in the <strong class="source-inline">getNewShuffledArray</strong> function to see how it works. It shuffles the array elements, and appears as follows:<p class="source-code"> function getNewShuffledArray(sourceArray){</p></li>
				<li>Now, make a copy of <strong class="source-inline">sourceArray</strong> and set the index to make a swap, starting with the last:<p class="source-code"> var newArray = [].concat(sourceArray);</p><p class="source-code"> let swapIndex = newArray.length;</p></li>
				<li>Create an index to make a swap with <strong class="source-inline">swapIndex</strong> and swap the value of <strong class="source-inline">swapIndex</strong>:<p class="source-code"> let swapWithIndex;</p><p class="source-code"> let swapIndexValue;</p></li>
				<li>Create a <strong class="source-inline">while</strong> loop called <strong class="source-inline">swapIndex</strong> that's not equal to <strong class="source-inline">0</strong> and pick an index to swap with the current index from <strong class="source-inline">0</strong> to the current <strong class="source-inline">swapIndex</strong>:<p class="source-code"> while (0 !== swapIndex) {</p><p class="source-code">  swapWithIndex = Math.floor(Math.random() * swapIndex);</p></li>
				<li>Now, reduce <strong class="source-inline">swapIndex</strong> by <strong class="source-inline">1</strong> and make a copy of the <strong class="source-inline">swapIndex</strong> value. Then, replace the <strong class="source-inline">swapIndex</strong> value with the <strong class="source-inline">swapWithIndex</strong> value, and replace the <strong class="source-inline">swapWithIndex</strong> value with the <strong class="source-inline">temporaryValue</strong> value:<p class="source-code">  swapIndex -= 1;</p><p class="source-code">  swapIndexValue = newArray[swapIndex];</p><p class="source-code">  newArray[swapIndex] = newArray[swapWithIndex];</p><p class="source-code">  newArray[swapWithIndex] = swapIndexValue;</p><p class="source-code"> }</p><p class="source-code"> return newArray;</p></li>
			</ol>
			<p>The shuffled To-Do list will look similar to something as follows:</p>
			<div>
				<div class="IMG---Figure" id="_idContainer367">
					<img alt="Figure 3.25: Shuffled list 1" src="image/C14377_03_25.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.25: Shuffled list 1</p>
			<p>Another example of a shuffled To-Do list is as follows:</p>
			<div>
				<div class="IMG---Figure" id="_idContainer368">
					<img alt="Figure 3.26: Shuffled list 2" src="image/C14377_03_26.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.26: Shuffled list 2</p>
			<h1 id="_idParaDest-582"><a id="_idTextAnchor648"/>Chapter 4: JavaScript Libraries and Frameworks</h1>
			<h2 id="_idParaDest-583"><a id="_idTextAnchor649"/>Activity 4.01: Adding an Animation to the Todo List Application</h2>
			<h3 id="_idParaDest-584"><a id="_idTextAnchor650"/>Solution:</h3>
			<ol>
				<li value="1">Go to <a href="http://cdnjs.com">cdnjs.com</a> and get the jQuery CDN URL.</li>
				<li>Load the library into the head tag of your existing Todo-List-HTML using a script tag. This will allow you to use jQuery within your code:<p class="source-code">&lt;head&gt;</p><p class="source-code">    // ... links and meta tags from the previous activity</p><p class="source-code">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"&gt;&lt;/script&gt;</p><p class="source-code">&lt;/head&gt;</p><p>Inside <strong class="source-inline">activity.js</strong>, you need to change the <strong class="source-inline">todoEle</strong> variable. Change it to a jQuery element:</p><p class="source-code">// The todo list element</p><p class="source-code">// let todoEle = document.getElementById('todo-list'); // old</p><p class="source-code">let todoEle = $('#todo-list'); // new</p><p>Inside the <strong class="source-inline">replaceListElements</strong> function, you can now use functions on the <strong class="source-inline">todoEle</strong> element that jQuery provides you with.</p></li>
				<li>Hide and clear what's inside the element using the necessary jQuery functions:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> // listEle.innerHTML = „"; // old</p><p class="source-code"> listEle.hide();</p><p class="source-code"> listEle.empty();</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  let liEle = document.createElement("li");</p><p class="source-code">  liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">  listEle.appendChild(liEle);</p><p class="source-code"> }</p><p class="source-code">}</p></li>
				<li>Inside the for loop, create the <strong class="source-inline">liEle</strong> list item element, set the text contest, and append it to the <strong class="source-inline">listEle</strong> list element:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> listEle.hide();</p><p class="source-code"> listEle.empty();</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  // let liEle = document.createElement("li");</p><p class="source-code">  // liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">  // listEle.appendChild(liEle);</p><p class="source-code">  let liEle = $(document.createElement("li"));</p><p class="source-code">  liEle.append(document.createTextNode(listItems[i]));</p><p class="source-code">  liEle.appendTo(listEle);</p><p class="source-code"> }</p><p class="source-code">}</p></li>
				<li>Finally, slowly fade in the new sorted todo list, that is, <strong class="source-inline">listEle</strong>:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> listEle.hide();</p><p class="source-code"> listEle.empty();</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  let liEle = $(document.createElement("li"));</p><p class="source-code">  liEle.append(document.createTextNode(listItems[i]));</p><p class="source-code">  liEle.appendTo(listEle)</p><p class="source-code"> }</p><p class="source-code"> listEle.fadeIn('slow');</p><p class="source-code">}</p></li>
				<li>Now, open the HTML in your browser and click the Shuffle button. The todo list should fade out, shuffle, and fade in again:<div class="IMG---Figure" id="_idContainer369"><img alt="Figure 4.17: Output Image&#13;&#10;" src="image/C14377_04_17.jpg"/></div><p class="figure-caption">Figure 4.17: Output Image</p><p>Now, let's go over the <strong class="source-inline">Velocity.js</strong> method. Go to <a href="http://cdnjs.com">cdnjs.com</a> and get the <strong class="source-inline">velocity.js</strong> CDN URL.</p><p>Load the library into the head tag of your existing Todo-List-HTML using a script tag. This will allow you to use velocity.js within your code:</p><p class="source-code">&lt;head&gt;</p><p class="source-code">    // ... previous links and meta tags</p><p class="source-code">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/2.0.5/velocity.min.js"&gt;&lt;/script&gt;</p><p class="source-code">&lt;/head&gt;</p></li>
				<li>Inside the <strong class="source-inline">replaceListElements</strong> function, you can now use Velocity to hide (by setting opacity to 0) the list element, <strong class="source-inline">listEle</strong>, and then empty the elements inside of it:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> Velocity(listEle, { opacity: 0 }, { duration: 0 })</p><p class="source-code"> listEle.innerHTML = "";</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  let liEle = document.createElement("li");</p><p class="source-code">  liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">  listEle.appendChild(liEle)</p><p class="source-code"> }</p><p class="source-code">}</p></li>
				<li> To fade the list element back in, animate <strong class="source-inline">listEle</strong> using Velocity and set the opacity to <strong class="source-inline">1</strong>. Set the code after the for loop:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> Velocity(listEle, { opacity: 0 }, { duration: 0 })</p><p class="source-code"> listEle.innerHTML = "";</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  let liEle = document.createElement("li");</p><p class="source-code">  liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">  listEle.appendChild(liEle)</p><p class="source-code"> }</p><p class="source-code"> Velocity(listEle, { opacity: 1 }, { duration: 500 })</p><p class="source-code">}</p></li>
				<li>Now, open the HTML in your browser and click the <em class="italic">Shuffle</em> button. The <strong class="source-inline">todo</strong> list should fade out, shuffle, and fade in again.</li>
				<li>Finally, using the Anime method, go to <a href="http://cdnjs.com">cdnjs.com</a> and get the <strong class="source-inline">Anime.js</strong> CDN URL. It will appear the same as the previous output.</li>
				<li>Load the library into the head tag of your existing Todo-List-HTML using a script tag. This will allow you to use <strong class="source-inline">Anime.js</strong> within your code:<p class="source-code">&lt;head&gt;</p><p class="source-code">    // ... previous links and meta tags</p><p class="source-code">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.2.0/anime.min.js"&gt;&lt;/script&gt;</p><p class="source-code">&lt;/head&gt;</p></li>
				<li> Inside the <strong class="source-inline">replaceListElements</strong> function, you can now use <strong class="source-inline">Anime.js</strong> to move (by using translateX = -1000) the list element, <strong class="source-inline">listEle</strong>, out of view and then empty the elements inside of it:<p class="source-code">function replaceListElements(listEle, listItems){</p><p class="source-code"> anime({</p><p class="source-code">  targets: listEle,</p><p class="source-code">  translateX: -1000</p><p class="source-code"> });</p><p class="source-code"> listEle.innerHTML = "";</p><p class="source-code"> for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">  let liEle = document.createElement("li");</p><p class="source-code">  liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">  listEle.appendChild(liEle)</p><p class="source-code"> }</p><p class="source-code">}</p></li>
				<li>To show the newly shuffled todo list, use <strong class="source-inline">Anime.js</strong> to animate the <strong class="source-inline">listEle</strong> list element back into view (by using translateX = 0). Do so inside a timeout to ensure that the shuffling has been done already:<p class="source-code-heading">activity.anime.js</p><p class="source-code">21 function replaceListElements(listEle, listItems){</p><p class="source-code">22  anime({</p><p class="source-code">23   // ANIME SOLUTION</p><p class="source-code">24   targets: listEle,</p><p class="source-code">25   translateX: -1000</p><p class="source-code">26  });</p><p class="source-code">27  listEle.innerHTML = "";</p><p class="source-code">28 </p><p class="source-code">29 </p><p class="source-code">30  for (let i= 0; i&lt;= listItems.length - 1; i++){</p><p class="source-code">31   let liEle = document.createElement("li");</p><p class="source-code">32   liEle.appendChild(document.createTextNode(listItems[i]));</p><p class="source-code">33   listEle.appendChild(liEle)</p><p class="source-code">34  }</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2Kd08dx">https://packt.live/2Kd08dx</a></p></li>
				<li>Now, open the HTML in your browser and click the <em class="italic">Shuffle</em> button. The <strong class="source-inline">todo</strong> list should fade out, shuffle, and fade in again. It will appear the same as the previous output.</li>
			</ol>
			<h1 id="_idParaDest-585"><a id="_idTextAnchor651"/>Chapter 5: Beyond the Fundamentals</h1>
			<h2 id="_idParaDest-586"><a id="_idTextAnchor652"/>Activity 5.01: Simple Number Comparison</h2>
			<h3 id="_idParaDest-587"><a id="_idTextAnchor653"/>Solution</h3>
			<ol>
				<li value="1">Create the function signature:<p class="source-code">function average_grade() {</p></li>
				<li>Copy the function arguments to a variable. This should be a new Array instance:<p class="source-code">    var args = Array.prototype.slice.call(arguments);</p></li>
				<li>Sum all the values of the arguments and store them in a variable:<p class="source-code">    var sum = 0;    for (let i=0; i&lt;args.length; i++) {</p><p class="source-code">        sum += Number(args[i]);</p><p class="source-code">    }</p><p>Remember to convert the grade values into a Number instance so that they can be correctly added together.</p></li>
				<li>Get the average of the sum and store it in a variable:<p class="source-code">    var average = sum / args.length;</p></li>
				<li>Using the average, calculate the student's grade and return it. This can simply be a list of conditionals:<p class="source-code">    if (average &lt; 35) {</p><p class="source-code">      return "F";</p><p class="source-code">    }</p><p class="source-code">    if (average &gt;= 35 &amp;&amp; average &lt; 45) {</p><p class="source-code">      return "D";</p><p class="source-code">    }</p><p class="source-code">    if (average &gt;= 45 &amp;&amp; average &lt; 60) {</p><p class="source-code">      return "C";</p><p class="source-code">    }</p><p class="source-code">    if (average &gt;= 60 &amp;&amp; average &lt; 75) {</p><p class="source-code">      return "B";</p><p class="source-code">    }</p><p class="source-code">    return "A";</p><p class="source-code">}</p></li>
			</ol>
			<p>The output will be visible as follows:</p>
			<div>
				<div class="IMG---Figure" id="_idContainer370">
					<img alt="Figure 5.26: Activity 5.01 output&#13;&#10;" src="image/C14377_05_26.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.26: Activity 5.01 output</p>
			<p class="callout-heading">Note </p>
			<p class="callout">The final condition will always be true if the others have failed, so the condition itself can be skipped. Each condition will not be evaluated if the previous condition has been returned from the function.</p>
			<h2 id="_idParaDest-588"><a id="_idTextAnchor654"/>Activity 5.02:  Creating a TODO Model</h2>
			<h3 id="_idParaDest-589"><a id="_idTextAnchor655"/>Solution</h3>
			<ol>
				<li value="1">The first step is to declare the state. It must be declared outside of any function so that it exists between function calls:<p class="source-code">let todos = [];</p></li>
				<li>Next, create the helper function that will be used to find a TODO by <strong class="source-inline">id</strong> from the <strong class="source-inline">state</strong> array. To do this, simply look through the array and return the index once it's been found. If it isn't found and the end of the array is reached, then return <strong class="source-inline">-1</strong> to denote that no TODO with the specific <strong class="source-inline">id</strong> exists:<p class="source-code">function modelFindIndex(state, id) {</p><p class="source-code">  for (let i=0; i&lt;state.length; i++) {</p><p class="source-code">    if (state[i].id == id) {</p><p class="source-code">      return i;</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">  return -1;</p><p class="source-code">}</p></li>
				<li>Now, create the function as described in the description of this activity:<p class="source-code">function modelStateChange(state, action, data) {</p></li>
				<li>The function will need to act differently, depending on the value of <strong class="source-inline">action</strong>. When modifying the data successfully, it should return the new state. First, handle adding a new TODO to the state for the <strong class="source-inline">CREATE</strong> action:<p class="source-code">  if (action == "CREATE") {</p><p class="source-code">    console.log("created:", data);</p><p class="source-code">    return state.concat(data);</p><p class="source-code">  }</p><p>Remember that the data needs to be written to the console with <strong class="source-inline">console.log</strong>.</p></li>
				<li>Next, handle the <strong class="source-inline">REMOVE</strong> functionality. This will utilize the <strong class="source-inline">modelFindIndex</strong> function to locate the <strong class="source-inline">TODO</strong> to remove:<p class="source-code">  if (action == "REMOVE") {</p><p class="source-code">   let data = modelFindIndex(todos, ev.detail);</p><p class="source-code">    if (i &gt; -1) {</p><p class="source-code">      state = state.splice(i, 1);</p><p class="source-code">      console.log("removed", data);</p><p class="source-code">      return state</p><p class="source-code">    }</p><p class="source-code">  }</p></li>
				<li>Finally, handle the <strong class="source-inline">MODIFY</strong> functionality. This step is a little more complex as the original data needs to be changed without changing the object reference:<p class="source-code">  if (action == "MODIFY") {</p><p class="source-code">    let data = modelFindIndex(todos, ev.detail);</p><p class="source-code">    if (i &gt; -1) {</p><p class="source-code">      state = state.splice(i, 1);</p><p class="source-code">      console.log("removed", data);</p><p class="source-code">      return state</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p></li>
			</ol>
			<h1 id="_idParaDest-590"><a id="_idTextAnchor656"/>Chapter 6: Understanding Core Concepts</h1>
			<h2 id="_idParaDest-591"><a id="_idTextAnchor657"/>Activity 6.01: Making Changes to the Model</h2>
			<h3 id="_idParaDest-592"><a id="_idTextAnchor658"/>Solution:</h3>
			<ol>
				<li value="1">The page the form is in has an area to display messages. The form itself contains the title <strong class="source-inline">textfield</strong> and a description for the <strong class="source-inline">textarea</strong> field.<p>The page loads in the model code from the previous chapter, but also a new script, which will be created shortly. The <strong class="source-inline">body</strong> tag has an in-page event handler assigned to its <strong class="source-inline">onload</strong> event, which will be included in the <strong class="source-inline">create_todos.js</strong> file.</p><p>In order to use the model's module with events, you will need to extend it by providing an event handler for each action type. Add the following code to the bottom of the <strong class="source-inline">model.js</strong> file:</p><p class="source-code">function modelInit() {</p><p class="source-code">  document.addEventListener("CREATE", modelCreateHandler);</p><p class="source-code">}</p><p class="source-code">function modelCreateHandler(ev) {</p><p class="source-code">  todos = modelStateChange(todos, "CREATE", ev.detail);</p><p class="source-code">  document.dispatchEvent(new Event("CHANGED", {detail: {type: "added", value: ev.detail}}));</p><p class="source-code">}</p></li>
				<li>In the <strong class="source-inline">create_todos.js</strong> file, add the <strong class="source-inline">loadHandler</strong> function:<p class="source-code">function loadHandler() {</p><p class="source-code">  model_init();</p><p class="source-code">  let form = document.getElementById("todo_form");</p><p class="source-code">  form.addEventListener("submit", createHandler);</p><p class="source-code">  document.addEventListener("CHANGED", changedHandler);</p><p class="source-code">}</p><p>This function will initialize the model and set up any necessary event handlers. As you can see, it assigns the <strong class="source-inline">CHANGED</strong> event to the <strong class="source-inline">changedHandler</strong> function. Let's create that next.</p></li>
				<li><strong class="source-inline">changedHandler</strong> is a simple affair. It simply waits for the <strong class="source-inline">CHANGED</strong> event to be raised and then updates the notifications area when it does:<p class="source-code">function changedHandler() {</p><p class="source-code">  let msg = document.getElementById("notifications");</p><p class="source-code">  msg.innerHTML = "The TOD<a id="_idTextAnchor659"/>O model has been updated";</p><p class="source-code">  setTimeout(() =&gt; {</p><p class="source-code">    msg.innerHTML = "";</p><p class="source-code">  }, 3000);</p><p class="source-code">}</p><p><strong class="source-inline">changedHandler</strong> clears the notifications area after three seconds to keep things clean.</p></li>
				<li>Finally, you need to add the <strong class="source-inline">createHandler</strong> function, which handles the form's submission:<p class="source-code-heading">create_todos.js</p><p class="source-code">16 function createHandler(ev) {</p><p class="source-code">17   ev.preventDefault();</p><p class="source-code">18   let title = document.getElementById("title").value,</p><p class="source-code">19       description = document.getElementById("description").value,</p><p class="source-code">20       msg = document.getElementById("notifications");</p><p class="source-code">21   let errors = [];</p><p class="source-code">22   if (title.trim() == "") {</p><p class="source-code">23     errors = errors.concat(["Title is not valid"]);</p><p class="source-code">24   }</p><p class="source-code">25   if (description.trim() == "") {</p><p class="source-code">26     errors = errors.concat(["Description is not valid"]);</p><p class="source-code">27   }</p><p class="source-code">28   if (errors.length &gt; 0) {</p><p class="source-code">29     msg.innerHTML = errors.join("/n");</p><p class="source-code">30     setTimeout(() =&gt; {</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2Xbd34R">https://packt.live/2Xbd34R</a></p><p>The majority of this code simply ensures that values are supplied to the form before submission and will alert the user if this is not the case.</p></li>
				<li>Now, give the application a spin. If all goes well, notifications should momentarily show when submitting the form, with different messages depending on whether the fields were populated. As an example, open the browser console and simply enter the following:<p class="source-code">todos;</p><p>You should see the submitted <strong class="source-inline">TODO</strong> objects presented there, like so:</p></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer371">
					<img alt="Figure 6.28: TODO submission form&#13;&#10;" src="image/C14377_06_27.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.28: TODO submission form</p>
			<p>Working with events provides a powerful means to keep your applications simple. What's more, it also empowers abstraction, allowing scripts to send data without them needing to know which other areas of your application are interested in those events. This promotes clean design and easier maintenance of your code.</p>
			<h1 id="_idParaDest-593"><a id="_idTextAnchor660"/>Chapter 7: Popping the Hood</h1>
			<h2 id="_idParaDest-594"><a id="_idTextAnchor661"/>Activity 7.01: Finding out the Number of Stack Frames</h2>
			<h3 id="_idParaDest-595"><a id="_idTextAnchor662"/>Solution</h3>
			<ul>
				<li>The function that establishes the call stack's limit is as follows:<p>var frameCount = 0;</p><p class="source-code">function stackOverflow() {</p><p class="source-code">  frameCount++;</p><p class="source-code">  stackOverflow();</p><p class="source-code">}</p><p>The solution starts out with the <strong class="source-inline">frameCount</strong> variable being initialized with the value <strong class="source-inline">0</strong>. The <strong class="source-inline">stackOverflow()</strong> function is declared, which will add 1 to the <strong class="source-inline">frameCount</strong> variable and then call itself, thus causing a stack overflow.</p></li>
				<li>Now, <strong class="source-inline">setTimout()</strong> function is initiated, which will log the value of <strong class="source-inline">frameCount</strong> to the console after a minimum of 500 milliseconds. Now, call the <strong class="source-inline">stackOverflow()</strong> function.<p class="source-code">setTimeout(() =&gt; console.log(frameCount), 500);</p><p class="source-code">stackOverflow();</p><p>This takes the <strong class="source-inline">console.log</strong> function out of the main execution thread, allowing it to be called after the stack overflow error is thrown:</p><div class="IMG---Figure" id="_idContainer372"><img alt="Figure 7.22: Showing the solution and number of stack frames being pushed before a stack overflow is triggered&#13;&#10;" src="image/C14377_07_22.jpg"/></div></li>
			</ul>
			<p class="figure-caption">Figure 7.22: Showing the solution and number of stack frames being pushed before a stack overflow is triggered</p>
			<h1 id="_idParaDest-596"><a id="_idTextAnchor663"/>Chapter 8: Browser APIs </h1>
			<h2 id="_idParaDest-597"><a id="_idTextAnchor664"/>Activity 8.01: Creating a Simple Fractal</h2>
			<h3 id="_idParaDest-598"><a id="_idTextAnchor665"/>Solution</h3>
			<ol>
				<li value="1">We initialize the canvas and context as we did previously, but this time we add a point variable that we initialize with the coordinates of the center of the canvas:<p class="source-code">let canvas = document.getElementById('canvas');</p><p class="source-code">const width = window.innerWidth;</p><p class="source-code">const height = window.innerHeight;</p><p class="source-code">canvas.width = width;</p><p class="source-code">canvas.height = height;</p><p class="source-code">let context = canvas.getContext('2d');</p><p class="source-code">// Set the starting point to the center of the canvas</p><p class="source-code">let point = [width / 2, height / 2];</p></li>
				<li>Then, we begin a new path and move the point to the coordinates that were assigned to the point variable:<p class="source-code">context.beginPath();</p><p class="source-code">context.moveTo(point[0], point[1]);</p></li>
				<li>We declare <strong class="source-inline">i</strong>, which we will use as a multiplier to tell the function how long a line should be. We also declare two constants to hold the values for a margin between the fractal that we're drawing and the edge of the canvas, as well as a multiplier, which is used to increase the line length that is drawn. Then, we start a while loop, which will keep going while the point remains inside the canvas' bounds (plus the margin on each side):<p class="source-code">let i = 1;</p><p class="source-code">const OFFSET = 10;</p><p class="source-code">const MARGIN = 5;</p><p class="source-code">while (</p><p class="source-code">  point[0] &gt; MARGIN &amp;&amp;</p><p class="source-code">  point[0] &lt; width - MARGIN &amp;&amp;</p><p class="source-code">  point[1] &gt; MARGIN &amp;&amp;</p><p class="source-code">  point[1] &lt; height - MARGIN</p><p class="source-code">) {</p></li>
				<li>Inside the while loop, the values inside the point array are increased or decreased, depending on which direction the line is being drawn and depending on the value of <strong class="source-inline">i</strong>:<p class="source-code">point[1] = point[1] - OFFSET * i;</p></li>
				<li>Then, the lineTo function is called with the values in the point variable. Every other time a line is drawn, <strong class="source-inline">i</strong> is incremented. This means that the line's length doubles after each second drawing of a line. You could also increase <strong class="source-inline">i</strong> each time a line is drawn, and the result would be greater spacing between the lines:<p class="source-code">context.lineTo(point[0], point[1]);</p><p class="source-code">  point[0] = point[0] + OFFSET * i;</p><p class="source-code">  i++;</p><p class="source-code">  context.lineTo(point[0], point[1]);</p><p class="source-code">  point[1] = point[1] + OFFSET * i;</p><p class="source-code">  context.lineTo(point[0], point[1]);</p><p class="source-code">  point[0] = point[0] - OFFSET * i;</p><p class="source-code">  i++;</p><p class="source-code">  context.lineTo(point[0], point[1]);</p><p class="source-code">}</p></li>
				<li>Finally, when the while loop's termination condition is met (when the point reaches within 5 pixels of one of the edges of the canvas), the stroke() method of the context is called to add a stroke to the lines we've described:<p class="source-code">context.stroke();</p><p>There are many more methods available in the Canvas API, and many possibilities for their use. You can draw complicated patterns, pictures, and graphs, and animate anything you draw. You should explore the Canvas API in more depth to find out what it can do. </p></li>
			</ol>
			<h2 id="_idParaDest-599"><a id="_idTextAnchor666"/>Activity 8.02: Playing Sound and Controlling Frequency Using Two Oscillators</h2>
			<h3 id="_idParaDest-600"><a id="_idTextAnchor667"/>Solution</h3>
			<ol>
				<li value="1">Initialize an audio context and a volume node:<p class="source-code">let context = new AudioContext();</p><p class="source-code">let volume = context.createGain();</p></li>
				<li>Create a gain node and connect it to the context's destination:<p class="source-code">volume.connect(context.destination);</p></li>
				<li>Initialize two oscillators (one for each coordinate of the cursor):<p class="source-code">let osciA = context.createOscillator();</p><p class="source-code">let osciB = context.createOscillator();</p></li>
				<li>Set the oscillator types (feel free to use any types you like), connect them to the volume node, and call their start() methods:<p class="source-code">osciA.type = 'sawtooth';</p><p class="source-code">osciB.type = 'square';</p><p class="source-code">osciA.connect(volume);</p><p class="source-code">osciB.connect(volume);</p><p class="source-code">osciA.start();</p><p class="source-code">osciB.start();</p></li>
				<li>Create an event listener that listens for the <strong class="source-inline">mousemove</strong> event on the <strong class="source-inline">document</strong> and set the oscillators' frequencies based on the cursor's position:<p class="source-code">document.addEventListener('mousemove', event =&gt; {</p><p class="source-code">  osciA.frequency.value = event.clientY;</p><p class="source-code">  osciB.frequency.value = event.clientX;</p><p class="source-code">});</p></li>
			</ol>
			<p>The callback function that's passed to the event listener assigns the cursor's x and y values to the two oscillator nodes' frequency values every time the 'mousemove' event is fired. This is a simple solution: it inherently limits the upper-frequency values for each oscillator depending on the width and height of the browser window. This is fine as a demonstration, but a better implementation would assign the same arbitrary upper-frequency value at the right-most and bottom-most parts of the document, no matter its dimensions.</p>
			<h2 id="_idParaDest-601"><a id="_idTextAnchor668"/>Activity 8.03: Audio Visualization </h2>
			<h3 id="_idParaDest-602"><a id="_idTextAnchor669"/>Solution</h3>
			<ol>
				<li value="1">Create a simple HTML file with a link to a JavaScript file called scripts.js (or anything you want to call it), with a &lt;canvas&gt; element in the body and with an ID of canvas in the DevTools console:<p class="source-code">&lt;!-- index.html --&gt;</p><p class="source-code">&lt;!DOCTYPE html&gt;</p><p class="source-code">&lt;html&gt;</p><p class="source-code">  &lt;head&gt;</p><p class="source-code">    &lt;script src='scripts.js'&gt;&lt;/script&gt;</p><p class="source-code">  &lt;/head&gt;</p><p class="source-code">  &lt;body&gt;</p><p class="source-code">    &lt;canvas id='canvas'&gt;&lt;/canvas&gt;</p><p class="source-code">  &lt;/body&gt;</p><p class="source-code">&lt;/html&gt;</p></li>
				<li>In the scripts.js file, we will add an event listener on the document listening for a click event. As we saw in the <em class="italic">Audio API</em> section of this chapter, in many modern browsers, audio is disabled until the user has interacted with the page, so waiting for the click event is an easy way to make sure we don't get any errors in this regard:<p class="source-code">// scripts.js</p><p class="source-code">document.addEventListener('click', () =&gt; {</p></li>
				<li>We then get hold of the canvas element, create a canvas context, set the canvas' width and height, and get its center x/y coordinates. We also instantiate a variable that will hold the Y value of the mouse's position:<p class="source-code">  // initialise canvas and related variables</p><p class="source-code">  let canvas = document.getElementById('canvas');</p><p class="source-code">  let canvasContext = canvas.getContext('2d');</p><p class="source-code">  let width = window.innerWidth;</p><p class="source-code">  let height = window.innerHeight;</p><p class="source-code">  canvas.width = width;</p><p class="source-code">  canvas.height = height;</p><p class="source-code">  let centerX = width / 2;</p><p class="source-code">  let centerY = height / 2;</p><p class="source-code">  let mouseY; // this will be set in the 'mousemove' event handler</p></li>
				<li>Then, we will create an audio context, a gain node, an oscillator node, and an analyzer node. We connect the oscillator to the volume node and the analyzer node, and then connect the volume node to the audio context's destination:<p class="source-code">  // initialise Audio context, nodes and related variables</p><p class="source-code">  let audioContect = new AudioContext();</p><p class="source-code">  let volume = audioContect.createGain();</p><p class="source-code">  let osciA = audioContect.createOscillator();</p><p class="source-code">  let analyser = audioContect.createAnalyser();</p><p class="source-code">  let waveform = new Float32Array(analyser.frequencyBinCount);</p><p class="source-code">  osciA.type = 'sine';</p><p class="source-code">  osciA.connect(volume);</p><p class="source-code">  osciA.connect(analyser);</p><p class="source-code">  volume.connect(audioContect.destination);</p><p class="source-code">  volume.gain.value = 1;</p><p class="source-code">  osciA.start();</p></li>
				<li>Next, we listen for mousemove events, and in the callback function for the event, we assign the cursor's X position to the oscillator's frequency value and the cursor's Y position to the mouseY variable. This means that the cursor's X position will control the frequency of the oscillation. We'll see what the mouseY variable is used for shortly:<p class="source-code">  // set oscillator frequency from mouse's x-position</p><p class="source-code">  document.addEventListener('mousemove', event =&gt; {</p><p class="source-code">    osciA.frequency.value = event.clientX;</p><p class="source-code">    mouseY = event.clientY;</p><p class="source-code">  });</p></li>
				<li>Now, we come to the meat of the application. We call the draw() function. This function tells the browser that we want to draw a frame of an animation, and by proving the draw() function as the callback, it repeats this function once for each time the page is rendered:<p class="source-code">// start drawing</p><p class="source-code">  draw();</p></li>
				<li>Next, we get the waveform data from the analyzer, which is copied to the waveform array. Then, we clear the canvas from any previous stroke() methods and begin a new path:<p class="source-code">  // the draw function</p><p class="source-code">  function draw() {</p><p class="source-code">    let drawing = window.requestAnimationFrame(draw); // Repeat the drawing function on every animation frame</p><p class="source-code">    analyser.getFloatTimeDomainData(waveform);</p><p class="source-code">    canvasContext.clearRect(0,0,canvas.width,canvas.height); // empty the canvas, so we don't get arcs drawn on top of each other</p><p class="source-code">    canvasContext.beginPath();</p></li>
				<li>Now, we come to looping through the waveform array. For each item in the array (which represents points of the waveform), we will plot a small section of a circle. The circle will be divided into as many sections as there are items in the array. Each section has a radius of half the width of the canvas, minus the mouse's Y position, plus the current chunk of the waveform's amplitude (multiplied by an arbitrary number, that is, 15). The result of this could be a negative number if the mouse is more than halfway across the screen, so we wrap the whole thing in Math.abs(), which returns the absolute value (no negatives!) of a number:<p class="source-code">    // plot a section of the circle for each part of the waveform</p><p class="source-code">    for(let i = 0; i&lt;waveform.length; i++) {</p><p class="source-code">      let radius = Math.abs(((width / 2) - mouseY) + (waveform[i] * 15));</p></li>
				<li>Next, we need to set the start angle and end angle of the arc in radians. A whole circle is 2*π radians, but we're dividing the circle into as many arcs as there are items in the waveform array. Therefore, we can calculate the starting angle as ((2 / waveform.length) * i) *π, where waveforms.length is how many items there are and i is the current chunk of the waveform/our circle we're on. We just add 1 to i for the end angle as each chunk's end angle is the same as the next one's starting angle:<p class="source-code">      let startAngle = ((2 / waveform.length) * i) * Math.PI;</p><p>      let endAngle = ((2 / waveform.length) * i) * Math.PI;</p></li>
				<li>After all that is done, and we call the arc() method of the canvas context, we can call the stroke() method to add a stroke to all the arcs we just plotted:<p class="source-code">      canvasContext.arc(centerX, centerY, radius, startAngle, endAngle);</p><p class="source-code">    }</p></li>
				<li>Put that all together, run it, and click on the page: we should get a very nice oscillating circle, whose diameter increases with the cursor's y-position, and the oscillation of which matches the sound of the sine wave coming from the speakers. This, incidentally, can be controlled with the cursor's x-position. Big fun:<p class="source-code">    canvasContext.stroke();</p><p class="source-code">  };</p><p class="source-code">})</p></li>
			</ol>
			<h1 id="_idParaDest-603"><a id="_idTextAnchor670"/>Chapter 9: Working with Node.js</h1>
			<h2 id="_idParaDest-604"><a id="_idTextAnchor671"/>Activity 9.01: Create a Web Application to Upload, Store, and Save Image Details</h2>
			<h3 id="_idParaDest-605"><a id="_idTextAnchor672"/>Solution</h3>
			<ol>
				<li value="1">Let's first go through the directory structure and define the folders to upload the images:<div class="IMG---Figure" id="_idContainer373"><img alt="Figure 9.22: Directory structure for this activity&#13;&#10;" src="image/C14377_09_22.jpg"/></div><p class="figure-caption">Figure 9.22: Directory structure for this activity</p><p>As you can see, in this project you will try to upload images in the <strong class="source-inline">public/images</strong> directory. This directory must be present at the root of the project and the current user should have read and write access to this directory. By defa<a id="_idTextAnchor673"/>ult, you will get both the permissions to this directory.</p><p class="callout-heading">Note </p><p class="callout">The source code will only contain two files (<strong class="source-inline">app.js</strong> and <strong class="source-inline">package.json</strong>). All the other files shown in the <strong class="source-inline">images</strong> directory in the preceding figure will not be present there. Once you start uploading files, you will see all the uploaded images there.</p><p>Before proceeding further, be sure to create a <strong class="source-inline">public/images</strong> directory in the root of this project that relates to <strong class="source-inline">app.js</strong> and <strong class="source-inline">package.json</strong>. The currently logged-in user of your machine must have the permissions to add files in this directory.</p></li>
				<li>The first step is to import all the dependencies:<p class="source-code">const express   = require('express');</p><p class="source-code">const multer            = require('multer');</p><p class="source-code">const MySQL             = require('MySQL');</p><p class="source-code">const morgan    = require('morgan')</p><p class="source-code">const app               = express();</p><p class="source-code">const port              = 3000;</p></li>
				<li>Then let's configure <strong class="source-inline">morgan</strong> to log each of our request details in the console. You can use <strong class="source-inline">morgan</strong> as a middleware:<p class="source-code">// Middleware for logging requests</p><p class="source-code">app.use(morgan(':method :status :url - :response-time ms'));</p></li>
				<li>Now let's configure the database. In this project, you will use a <strong class="source-inline">MySQL</strong> database:<p class="source-code">/*</p><p class="source-code">* Database</p><p class="source-code">*/</p><p class="source-code">// Creating MySQL Connection</p><p class="source-code">let connection = MySQL.createConnection({</p><p class="source-code">   host         : 'localhost',</p><p class="source-code">   user         : 'root',</p><p class="source-code">   password     : '12345678',</p><p class="source-code">   database     : 'packt_JavaScript'</p><p class="source-code">});</p><p class="source-code">       </p><p class="source-code">// Connection to db</p><p class="source-code">connection.connect();</p><p>Make sure you pass the credentials of the user you created earlier while going through the <em class="italic">Setting Up Databases</em> section.</p></li>
				<li>When your application has established a database connection, it's time to install <strong class="source-inline">multer</strong> by executing the following command through the terminal in the root of the project:<p class="source-code">npm i multer --save</p></li>
				<li>Now, let's configure <strong class="source-inline">multer</strong> by adding the code from the <strong class="source-inline">app.js</strong> file:<p class="source-code">/*</p><p class="source-code">* File Upload Settings</p><p class="source-code">*/</p><p class="source-code">let storage = multer.diskStorage({</p><p class="source-code">        destination: (req, file, cb) =&gt; {</p><p class="source-code">                  cb(null, 'public/images')</p><p class="source-code">        },</p><p class="source-code">        filename: (req, file, cb) =&gt; {</p><p class="source-code">                let ext = file.originalname.split('.').pop();</p><p class="source-code">                  cb(null, 'img_' + Date.now() + '.' + ext);</p><p class="source-code">        }</p><p class="source-code">});</p><p class="source-code">let upload = multer({storage: storage});    </p><p>This code will set the destination where all files will be uploaded, which is <strong class="source-inline">public/images</strong>, and you are also changing the <strong class="source-inline">filename</strong> after upload to avoid issues with duplicate filenames.</p></li>
				<li>Now let's configure some routes in your application:<p class="source-code-heading">app.js</p><p class="source-code">39 /*</p><p class="source-code">40 * Routing</p><p class="source-code">41 */</p><p class="source-code">42 // Landing route</p><p class="source-code">43 app.get('/', (req, res) =&gt; res.send('Hello World!'))</p><p class="source-code">44 </p><p class="source-code">45 // Upload image route</p><p class="source-code">46 app.post('/upload/image', upload.single('image'), function (req, re s) {</p><p class="source-code">47        // Column name: values</p><p class="source-code">48        let payload = {</p><p class="source-code">49                filename: req.file.filename,</p><p class="source-code">50                type: req.file.mimetype,</p><p class="source-code">51                original_name: req.file.originalname,</p><p class="source-code">52                path: req.file.path,</p><p class="source-code">53                size: req.file.size</p><p class="source-code">54 }</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2NIE6RR">https://packt.live/2NIE6RR</a></p></li>
				<li>The last step is to start the server:<p class="source-code">// Start listening to requests</p><p class="source-code">app.listen(port, () =&gt; console.log(`App listening on port http://localhost:${port}!`))</p></li>
				<li>That's it. The server is now up and running. The final thing is to send a request to upload the image on the server. For this, we will use Postman (the Chrome extension) as our client:</li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer374">
					<img alt="Figure 9.23: API response in Postman&#13;&#10;" src="image/C14377_09_23.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.23: API response in Postman</p>
			<h1 id="_idParaDest-606"><a id="_idTextAnchor674"/>Chapter 10: Accessing External Resources</h1>
			<h2 id="_idParaDest-607"><a id="_idTextAnchor675"/>Activity 10.01: Implement REST Service Calls Using Various Techniques</h2>
			<h3 id="_idParaDest-608"><a id="_idTextAnchor676"/>Solution:</h3>
			<ol>
				<li value="1">Use <strong class="source-inline">$.ajax()</strong> with <strong class="source-inline">method: 'post'</strong> and <strong class="source-inline">dataType: 'json'</strong>:<p class="source-code-heading">solution_using_jquery_ajax.html</p><p class="source-code">    $.ajax({</p><p class="source-code">        method: 'post',</p><p class="source-code">        dataType: 'json',</p><p class="source-code">        url: 'https://reqres.in/api/users',</p></li>
				<li>Enclose your data fields in an object, <strong class="source-inline">{}</strong>:<p class="source-code">        data: {</p><p class="source-code">            "name": "Beyonce Knowles",</p><p class="source-code">            "occupation": "artist"</p><p class="source-code">        },</p></li>
				<li>Create a <strong class="source-inline">success</strong> function to output the expected values:<p class="source-code">        success: function (data) {</p><p class="source-code">            console.log("Returned id " + data.id + </p><p class="source-code">                        ", createdAt " + data.createdAt);</p><p class="source-code">            console.log(data);</p><p class="source-code">            }</p><p class="source-code">        });</p><p>The boilerplate HTML is omitted and left as an exercise for you. The preceding code would result in something like the following in the JavaScript Console in Google Chrome. (All the solutions presented have similar output):</p><div class="IMG---Figure" id="_idContainer375"><img alt="Figure 10.17: JavaScript Console output&#13;&#10;" src="image/C14377_10_17.jpg"/></div><p class="figure-caption">Figure 10.17: JavaScript Console output</p></li>
				<li>Now, let's get the same output using the <strong class="source-inline">$.post()</strong> method and using the file <strong class="source-inline">solution_using_jquery_post.html</strong>:<p class="source-code">$.post('https://reqres.in/api/users',</p></li>
				<li>Enclose your data fields in an object, <strong class="source-inline">{}</strong>:<p class="source-code">{</p><p class="source-code">            "name": "Beyonce Knowles",</p><p class="source-code">            "occupation": "artist"</p><p class="source-code">        },</p></li>
				<li>Create a <strong class="source-inline">success</strong> function to output the expected values:<p class="source-code">function (data) {</p><p class="source-code">            console.log("Returned id " + data.id + </p><p class="source-code">                        ", createdAt " + data.createdAt);</p><p class="source-code">            console.log(data);</p><p class="source-code">        },</p></li>
				<li>As the last parameter to <strong class="source-inline">$.post()</strong>, use the <strong class="source-inline">'json'</strong> value to indicate the expected JSON return type:<p class="source-code">'json'</p><p class="source-code">    );</p><p>The output will be the same as is shown in <em class="italic">Figure 10.17</em>.</p></li>
				<li>Finally, create a new <strong class="source-inline">XMLHttpRequest</strong> object:<p class="source-code">const url = "https://reqres.in/api/users";</p><p class="source-code">var xhttp = new XMLHttpRequest();</p></li>
				<li>Call <strong class="source-inline">open('POST')</strong>:<p class="source-code">xhttp.open('POST', url);</p></li>
				<li>Set the <strong class="source-inline">Content-type</strong> and <strong class="source-inline">Accept</strong> request headers to the appropriate values:<p class="source-code">xhttp.setRequestHeader("Content-type", "application/json");</p><p class="source-code">xhttp.setRequestHeader('Accept', 'application/json');</p></li>
				<li>Create a function for <strong class="source-inline">onreadystatechange</strong> that checks for a status code of <strong class="source-inline">201 (Created)</strong> and parses the JSON data with <strong class="source-inline">JSON.parse()</strong>:<p class="source-code">xhttp.onreadystatechange = function() {</p><p class="source-code">    if (this.readyState == 4 &amp;&amp; this.status == 201) {</p><p class="source-code">        const data = JSON.parse(this.response);</p><p class="source-code">        console.log("Returned id " + data.id + </p><p class="source-code">                    ", createdAt " + data.createdAt);</p><p class="source-code">        console.log(data);</p><p class="source-code">    }</p><p class="source-code">}</p></li>
				<li>Call <strong class="source-inline">JSON.stringify()</strong> on the input data to convert it to JSON format:<p class="source-code">var data = JSON.stringify({</p><p class="source-code">    "name": "Beyonce Knowles",</p><p class="source-code">    "occupation": "artist"</p><p class="source-code">});</p></li>
				<li>Send the JSON data when calling <strong class="source-inline">send()</strong>:<p class="source-code">xhttp.send(data);</p><p>The output will be the same as is shown in <em class="italic">Figure 10.17</em>.</p></li>
			</ol>
			<h1 id="_idParaDest-609"><a id="_idTextAnchor677"/>Chapter 11: Creating Clean and Maintainable Code</h1>
			<h2 id="_idParaDest-610"><a id="_idTextAnchor678"/>Activity 11.01: Expanding Phone Number Matching Patterns to Accept Multiple Formats</h2>
			<h3 id="_idParaDest-611"><a id="_idTextAnchor679"/>Solution:</h3>
			<ol>
				<li value="1">Observe that only the characters at the beginning of each pattern differ, but the last characters, <strong class="source-inline">XXX-XXXX</strong>, are the same in both patterns.</li>
				<li>For the differing characters, for our regex to match either format correctly, you can specify the regex snippets that correspond to each format as alternate expressions of an alternation. Recall that alternations take the form of (<strong class="source-inline">expression1|expression2)</strong>:<p class="source-code">    <strong class="bold">(</strong>[2-9]\d{2}-<strong class="bold">|</strong>\([2-9]\d{2}\) )</p><p class="source-code">where Regex for XXX-\Regex for (XXX)</p></li>
				<li>Combine it with the rest of the original regex to get the complete regex:<p class="source-code">    ^([2-9]\d{2}-|\([2-9]\d{2}\) )\d{3}-\d{4}$</p></li>
				<li><a id="_idTextAnchor680"/>Remember that the original regex, <strong class="source-inline">\d{3}-\d{4}</strong>, matches <strong class="source-inline">XXX-XXXX,</strong> which is the same for both patterns. We only needed the alternation for the beginning parts of each pattern that differed. The <strong class="source-inline">^</strong> and <strong class="source-inline">$</strong> characters also enforce that there are no other characters before or after the acceptable ones.<p>Now, when you replace this correct regex into our tool, only the first two test strings match ( as expected)</p></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer376">
					<img alt="Figure 11.23: After using the correct regex, only the first two test strings match (as expected)&#13;&#10;" src="image/C14377_11_23.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 11.23: After using the correct regex, only the first two test strings match (as expected)</p>
			<p>In <em class="italic">Exercise 11.01, The Effect of the g Flag</em>, and this activity, we created regex expressions to accept US number formats. We will now modify the regex to accept non-US number formats.</p>
			<h2 id="_idParaDest-612"><a id="_idTextAnchor681"/>Activity 11.02: Expanding Phone Number Matching Patterns to Accept a Particular Format</h2>
			<h3 id="_idParaDest-613"><a id="_idTextAnchor682"/>Solution:</h3>
			<ol>
				<li value="1">Construct the regex for the <strong class="source-inline">+XXX</strong> pattern (where between 1-3 digits are acceptable):<p class="source-code">    (\+\d{1,3} )?</p><p>We need two things here:</p><p>The first <strong class="source-inline">+</strong> needs to be escaped due to it being a special character.</p><p>Notice the parenthesis with <strong class="source-inline">?</strong> after it. This specifies that whole expression within the parenthesis can occur 0 or 1 times. In other words, the characters in the expression are optional. The <strong class="source-inline">\d{1,3}</strong> expression is a range quantifier requiring between 1 and 3 digits.</p></li>
				<li>By prepending this to the regex from the previous activity, the whole regex is now as follows:<p class="source-code">    ^(\+\d{1,3} )?([2-9]\d{2}-|\([2-9]\d{2}\) )\d{3}-\d{4}$</p><p class="callout-heading">Note</p><p class="callout">See the previous activity for a full description of the latter parts of the regex.</p></li>
				<li>To kick it up one more notch, here are some of the changes we can make to the regex that allows us to use space or dot characters as digit separators rather than only dashes:<p class="source-code">    ^(\+\d{1,3} )?([2-9]\d{2}|\([2-9]\d{2}\))<strong class="bold">[-. ]</strong>\d{3}<strong class="bold">[-. ]</strong>\d{4}$</p><p>The <strong class="source-inline">[-. ]</strong> set allows a dash, dot, or space character to be used as the separator.</p><p>This modification now allows all the formats shown in the following screenshot to match:</p><p class="callout-heading">Note</p><p class="callout">One flaw with this regex is that it allows you to mix and match what characters are used as separators. For example, you can use a dash and dot, like so: 234-567.8910. It is possible to make the regex stronger, but the result will end up being very long and convoluted.</p></li>
			</ol>
			<h2 id="_idParaDest-614"><a id="_idTextAnchor683"/>Activity 11.03: Refactoring to Clean Code</h2>
			<h3 id="_idParaDest-615"><a id="_idTextAnchor684"/>Solution:<strong class="bold"> </strong></h3>
			<p class="callout-heading">Note</p>
			<p class="callout">There are many ways the code could be refactored. The following solution represents one way, along with explanatory comments.</p>
			<ol>
				<li value="1">Use the <strong class="source-inline">activity_solution.html</strong> file. The HTML code remains the same as the original code. Only the contents of the <strong class="source-inline">&lt;script&gt;</strong> section are replaced.</li>
				<li>We start refactoring the code by creating a function called <strong class="source-inline">processForm()</strong>:<p class="source-code">document.getElementById("calc_button").addEventListener("click ", processForm);</p><p class="source-code">function processForm() {</p><p class="source-code">    resetErrorsAndResults();</p><p class="source-code">    const formFields = getFormFields();</p><p class="source-code">    const validationError = formFields.validate();</p><p class="source-code">    if (validationError) {</p><p class="source-code">        displayError(validationError);</p><p class="source-code">        return;</p><p class="source-code">    }</p><p class="source-code">    const result = doCalculation(formFields);</p><p class="source-code">    displayResult(result);</p><p class="source-code">}</p><p>The original code had one very long method that did all the form field processing, validations, and calculations. The new code creates new methods for different concerns. These methods are short and mostly focused on just one task.</p><p>The code reads like a narrative story with paragraphs and sentences in mostly plain English. It is easy to see the logic and flow just by reading it, and there's not much clutter: reset the errors and results, get the form fields, validate the fields and show errors (if any), do the calculation, and display the results. The gory details of each of these are contained within other methods.</p></li>
				<li>We will also create a function called <strong class="source-inline">resetErrorsAndResults()</strong>. By the name and implementation, it is easy to tell what the purpose of this function is, and the function is limited to just that specific purpose:<p class="source-code">function resetErrorsAndResults() {</p><p class="source-code">    document.getElementById("error").innerHTML = "";</p><p class="source-code">    document.getElementById("result").innerHTML = "";</p><p class="source-code">}</p></li>
				<li>For the next refactoring, we have decided to create a class that holds form field values and performs validations:<p class="source-code-heading">activity_solution.html</p><p class="source-code">63 class FormFields {</p><p class="source-code">64     constructor(numHours, payRate, workerType) {</p><p class="source-code">65         this.numHours = numHours;</p><p class="source-code">66         this.payRate = payRate;</p><p class="source-code">67         this.workerType = workerType;</p><p class="source-code">68     }</p><p class="source-code">69</p><p class="source-code">70     validate() {</p><p class="source-code">71         let validationError = this.validateNumHours();</p><p class="source-code">72         if (validationError) {</p><p class="source-code">73             return validationError;</p><p class="source-code">74         }</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/372KXxp">https://packt.live/372KXxp</a></p><p>Validation methods are simple and only return a string with an error message if the regex test fails. Displaying error messages is a separate concern (unlike the original code, which combined the concerns). It contains a constructor where the form field values are passed in rather than us having to get the values directly from the form, thus allowing the class and validations to be tested independently of the form itself.</p></li>
				<li>Next, we create a function called <strong class="source-inline">getFormFields()</strong>. This function is limited to getting the values from the form and creating an instance of the <strong class="source-inline">FormFields</strong> class:<p class="source-code">function getFormFields() {</p><p class="source-code">    const numHours = document.getElementById("numHours").value;</p><p class="source-code">    const payRate = document.getElementById("payRate").value;</p><p class="source-code">    const workerType =</p><p class="source-code">        document.querySelector('input[name="workerType"]:checked').value;</p><p class="source-code">    return new FormFields(numHours, payRate, workerType);</p><p class="source-code">}</p><p>These methods have no side effects as they facilitate testing. This is because the return values are always predicable for a given set of input parameters.</p></li>
				<li>The <strong class="source-inline">displayError()</strong> and <strong class="source-inline">displayResult()</strong> functions are straightforward and do just one thing:<p class="source-code">function displayError(error) {</p><p class="source-code">    document.getElementById("error").innerHTML = error;</p><p class="source-code">}</p><p class="source-code">function displayResult(result) {</p><p class="source-code">    document.getElementById("result").innerHTML =</p><p class="source-code">        `Total pay check: ${result.toFixed(2)}`;</p><p class="source-code">}</p><p>The <strong class="source-inline">switch</strong> statement in the original code was just screaming out "refactor me" to separate functions for each case! We will refactor this so that it uses an associative array called <strong class="source-inline">calculateFunctions</strong>. The key of each entry in the array is <strong class="source-inline">workerType</strong> and the user that's selected from the radio buttons, along with a reference to the function that contains the corresponding calculation logic for the value. These are minimal comments since the method, object, and variable names are self-documenting.</p></li>
				<li>Also, the <strong class="source-inline">calculateStandardWorkerPay()</strong>, <strong class="source-inline">calculateNoOvertimeWorkerPay()</strong>, and <strong class="source-inline">calculateDoubleOvertimeWorkerPay()</strong> functions take the same two parameters and have the same return value definition, so they could be called abstractly in <strong class="source-inline">doCalculation()</strong>:</li>
			</ol>
			<p class="source-code-heading">activity_solution.html</p>
			<p class="source-code">108 const calculateFunctions = {</p>
			<p class="source-code">109     "standard": calculateStandardWorkerPay,</p>
			<p class="source-code">110     "no_overtime": calculateNoOvertimeWorkerPay,</p>
			<p class="source-code">111     "double_overtime": calculateDoubleOvertimeWorkerPay</p>
			<p class="source-code">112 };</p>
			<p class="source-code">113 </p>
			<p class="source-code">114 function doCalculation(formFields) {</p>
			<p class="source-code">115     // determine function to use for calculation based on worker type</p>
			<p class="source-code">116     const calculateFunction = calculateFunctions[formFields.workerType];</p>
			<p class="source-code">117     return calculateFunction(formFields.numHours, formFields.payRate);</p>
			<p class="source-code">118 }</p>
			<p class="source-code">119 </p>
			<p class="source-code">120 function calculateStandardWorkerPay(numHours, payRate) {</p>
			<p class="source-code">121     if (numHours &lt; 40) {</p>
			<p class="source-code">122         return numHours * payRate;</p>
			<p class="source-code">123     }</p>
			<p class="source-code-link">The full code is available at: <a href="https://packt.live/373ThN5">https://packt.live/373ThN5</a></p>
			<p>In a real application, you may consider using one of the many available validation frameworks rather than rolling your own. For calculation purposes, this implementation chose to use functions in an associative array. One alternative to consider is creating a class hierarchy where subclasses implement or override a calculation method in a base class.</p>
			<h1 id="_idParaDest-616"><a id="_idTextAnchor685"/>Chapter 12: Using Next-Generation JavaScript</h1>
			<h2 id="_idParaDest-617"><a id="_idTextAnchor686"/>Activity 12.01: Creating a Project to Recognize and Compile TypeScript Files</h2>
			<h3 id="_idParaDest-618"><a id="_idTextAnchor687"/>Solution:</h3>
			<ol>
				<li value="1">The first step is to create a new project directory, then <strong class="source-inline">cd</strong> into it, and initialize it for npm:<p class="source-code">mkdir my_app</p><p class="source-code">cd my_app</p><p class="source-code">npm init</p></li>
				<li>Next, install Parcel as a global library:<p class="source-code">npm install -g parcel</p></li>
				<li>Now, you will need to install TypeScript, which you can also save as a global library:<p class="source-code">npm install -g typescript</p></li>
				<li>To generate the configuration for TypeScript, you simply need to call the TypeScript CLI tool, <strong class="source-inline">tsc</strong>, and pass it the <strong class="source-inline">--init</strong> flag:<p class="source-code">tsc --init</p><p>If all went well, you should be presented with a message such as the following:</p><p class="source-code">message TS6071: Successfully created a tsconfig.json file.</p><p>You should also find a new <strong class="source-inline">tsconfig.json</strong> file in the root of your project folder.</p></li>
				<li>Next, create a directory called <strong class="source-inline">src</strong> and place an <strong class="source-inline">index.ts</strong> file within it. Add the following code as the file's content:<p class="source-code">const message:string = "Hello, World!";</p><p class="source-code">console.log(message);</p></li>
				<li>With everything in place, update the <strong class="source-inline">package.json</strong> file to include the following script:<p class="source-code">"build": "parcel build src/index.ts"</p></li>
				<li>Finally, run the script by invoking the <strong class="source-inline">npm</strong> executable:<p class="source-code">npm run build</p><p>You should see a successful <strong class="source-inline">Built</strong> message output onscreen, as well as the expected <strong class="source-inline">dist</strong> folder containing transpiled <strong class="source-inline">js</strong> files in the project root.</p></li>
			</ol>
			<h1 id="_idParaDest-619"><a id="_idTextAnchor688"/>Chapter 13: JavaScript Programming Paradigms</h1>
			<h2 id="_idParaDest-620"><a id="_idTextAnchor689"/>Activity 13.01: Creating a Calculator App</h2>
			<h3 id="_idParaDest-621"><a id="_idTextAnchor690"/>Solution</h3>
			<ol>
				<li value="1">Create an empty file and call it <strong class="source-inline">procedural.js</strong>.</li>
				<li>Initialize an array that will maintain the history of function calls:<p class="source-code">lethistoryList = [];</p></li>
				<li>Now, create simple addition, subtraction, multiplication, division, and power functions:<p class="source-code-heading">procedural.js</p><p class="source-code">3 function add(m, n){</p><p class="source-code">4 historyList.push(['ADD', m, n]);</p><p class="source-code">5 return m+n;</p><p class="source-code">6 }</p><p class="source-code">7 </p><p class="source-code">8 function subtract(m, n){</p><p class="source-code">9 historyList.push(['SUB', m, n]);</p><p class="source-code">10 return m-n;</p><p class="source-code">11 }</p><p class="source-code">12 </p><p class="source-code">13 function multiply(m, n){</p><p class="source-code">14 historyList.push(['MUL', m, n]);</p><p class="source-code">15 return m*n;</p><p class="source-code">16 }</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2Xf6kHk">https://packt.live/2Xf6kHk</a></p></li>
				<li>Create a <strong class="source-inline">history</strong> function, which will maintain the history of function calls:<p class="source-code">function history(){</p><p class="source-code"> historyList.map((command, index)=&gt;{</p><p class="source-code">  console.log(index+1+'.', command.join(' '));</p><p class="source-code"> })</p><p class="source-code">}Call all the functions one by one with some random numbers as parameters:</p><p class="source-code">console.log('ADD 2 3 :', add(2, 3));</p><p class="source-code">console.log('SUB 2 3 :', subtract(2, 3));</p><p class="source-code">console.log('MUL 2 3 :', multiply(2, 3));</p><p class="source-code">console.log('DIV 2 3 :', divide(2, 3));</p><p class="source-code">console.log('POW 2 3 :', pow(2, 3));</p></li>
				<li>Now, print the <strong class="source-inline">history</strong>:<p class="source-code">console.log('----------------HISTORY---------------');</p><p class="source-code">history();</p><p>The output of this code will be as follows:</p><div class="IMG---Figure" id="_idContainer377"><img alt="Figure 13.15: Output with the procedural approach&#13;&#10;" src="image/C14377_14_151.jpg"/></div><p class="figure-caption">Figure 13.15: Output with the procedural approach</p></li>
				<li>Now, create a class and call it <strong class="source-inline">calculator</strong>:<p class="source-code">class Calculator {}</p></li>
				<li>Then, initialize a <strong class="source-inline">historyList</strong> array, which will maintain the history of all function calls:<p class="source-code"> constructor() {</p><p class="source-code">  this.historyList = []</p><p class="source-code"> }</p></li>
				<li>Now, create simple <strong class="source-inline">add</strong>, <strong class="source-inline">subtract</strong>, <strong class="source-inline">multiply</strong>, <strong class="source-inline">divide</strong>, and <strong class="source-inline">pow</strong> methods:<p class="source-code-heading">oop.js</p><p class="source-code">6  add(m, n) {</p><p class="source-code">7   this.historyList.push(['ADD', m, n]);</p><p class="source-code">8   return m+n;</p><p class="source-code">9  }</p><p class="source-code">10 </p><p class="source-code">11  subtract(m, n) {</p><p class="source-code">12   this.historyList.push(['SUB', m, n]);</p><p class="source-code">13   return m-n;</p><p class="source-code">14  }</p><p class="source-code">15 </p><p class="source-code">16  multiply(m, n) {</p><p class="source-code">17   this.historyList.push(['MUL', m, n]);</p><p class="source-code">18   return m*n;</p><p class="source-code">19  }</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2O70oMi">https://packt.live/2O70oMi</a></p></li>
				<li>Add one more method, which will show the history of the operations:<p class="source-code"> history() {</p><p class="source-code">  this.historyList.map((command, index)=&gt;{</p><p class="source-code">   console.log(index+1+'.', command.join(' '));</p><p class="source-code">  })</p><p class="source-code"> }</p></li>
				<li>Lastly, create an instance of this class and call its method with simple numbers to perform mathematical operations:<p class="source-code">let calc = new Calculator();</p><p class="source-code">console.log('ADD 2 3 :', calc.add(2, 3));</p><p class="source-code">console.log('SUB 2 3 :', calc.subtract(2, 3));</p><p class="source-code">console.log('MUL 2 3 :', calc.multiply(2, 3));</p><p class="source-code">console.log('DIV 2 3 :', calc.divide(2, 3));</p><p class="source-code">console.log('POW 2 3 :', calc.pow(2, 3));</p></li>
				<li>To check its history, call the <strong class="source-inline">history</strong> method of the <strong class="source-inline">calculator</strong> class:<p class="source-code">calc.history();</p><p>The output of this code will be as follows:</p></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer378">
					<img alt="Figure 13.16: Output with the object-oriented approach&#13;&#10;" src="image/C14377_14_161.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 13.16: Output with the object-oriented approach</p>
			<h1 id="_idParaDest-622"><a id="_idTextAnchor691"/>Chapter 14: Understanding Functional Programming</h1>
			<h2 id="_idParaDest-623"><a id="_idTextAnchor692"/>Activity 14.01: Blackjack Card Functions</h2>
			<h3 id="_idParaDest-624"><a id="_idTextAnchor693"/>Solution:</h3>
			<ol>
				<li value="1">In the <strong class="source-inline">blackjack/start.html</strong> file, find the opening script tag and add some functions for defining the elements of a deck and creating an ordered deck:<p class="source-code-heading">solution.html</p><p class="source-code">88 const suits =</p><p class="source-code">89     () =&gt; [</p><p class="source-code">90        { suit: "hearts", symbol: '&amp;#9829;' },    // symbol: '♥'</p><p class="source-code">91        { suit: 'diamonds', symbol: '&amp;#9830;' },  // symbol: '♦'</p><p class="source-code">92        { suit: 'spades', symbol: '&amp;#9824;' },    // symbol: '♠'</p><p class="source-code">93        { suit: 'clubs', symbol: '&amp;#9827;' }      // symbol: '♣'</p><p class="source-code">94     ];</p><p class="source-code">95 const rankNames =</p><p class="source-code">96     () =&gt; ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];</p><p class="source-code">97 </p><p class="source-code">98 const ranks =</p><p class="source-code">99     rankNames =&gt; rankNames.map(</p><p class="source-code">100         (rank, index) =&gt; ({ rank, value: Math.min(10, index + 1) 101 }));</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2QgJ0Y2">https://packt.live/2QgJ0Y2</a></p></li>
				<li>Below this code, define how to create a deck by adding the core functional programming methods:<p class="source-code">const compose =</p><p class="source-code">    (...fns) =&gt; input =&gt; fns.reduceRight((prev, fn) =&gt; fn(prev), input);</p><p class="source-code">const pipe = (...fns) =&gt; input =&gt; fns.reduce((prev, fn) =&gt; fn(prev), input);</p><p class="source-code">const map = fx =&gt; arr =&gt; arr.map(fx);</p></li>
				<li>Next, add the functions for shuffling a deck, as we did in <em class="italic">Exercise 14.09: Using the pipe Method to Create a Card Shuffling Function</em>:<p class="source-code-heading">solution.html</p><p class="source-code">117 const addRandom =</p><p class="source-code">118     randomizer =&gt; deck =&gt; deck.map(card =&gt; ({</p><p class="source-code">119         random: randomizer(),</p><p class="source-code">120         card</p><p class="source-code">121     }));</p><p class="source-code">122 </p><p class="source-code">123 const sortByRandom =</p><p class="source-code">124     deck =&gt; [...deck].sort((a, b) =&gt; a.random - b.random);</p><p class="source-code">125 </p><p class="source-code">126 const shuffle =</p><p class="source-code">127     (deck, randomizer) =&gt; {</p><p class="source-code">128         const doShuffle = pipe(</p><p class="source-code">129             addRandom(randomizer),</p><p class="source-code">130             sortByRandom,</p><p class="source-code">131             map(card =&gt; card.card)</p><p class="source-code">132         );</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2QlDGCZ">https://packt.live/2QlDGCZ</a></p></li>
				<li>Now, we will add functions for drawing a card, getting the sum of a player's cards, checking whether a hand is over 21 points, and checking whether the game is over:<p class="source-code">const draw =</p><p class="source-code">    (deck, n = 1) =&gt; [deck.slice(0, n), deck.slice(n)];</p><p class="source-code">const sumCards =</p><p class="source-code">    cards =&gt; cards.reduce((total, card) =&gt; total + card.value, 0);</p><p class="source-code">const isBust =</p><p class="source-code">    total =&gt; total &gt; 21;</p><p class="source-code">const isGameOver =</p><p class="source-code">    (bust, stay) =&gt; bust || stay;</p></li>
				<li>Next, we need to add a way to update the visual display and the cards shown to the user. One way this can be done is as follows:<p class="source-code">const updateCardDisplay =</p><p class="source-code">    ({ updateHTML }, hand) =&gt; {</p><p class="source-code">        const cardHtml = hand.map((card, index) =&gt; </p><p class="source-code">            `&lt;div class="card ${card.suit}"</p><p class="source-code">                style="top: -${index * 120}px; </p><p class="source-code">                       left: ${index * 100}px;"&gt;</p><p class="source-code">                &lt;div class="top rank"&gt;${card.rank}&lt;/div&gt;</p><p class="source-code">                &lt;div class="bigsuit"&gt;${card.symbol}&lt;/div&gt;</p><p class="source-code">                &lt;div class="bottom rank"&gt;${card.rank}&lt;/div&gt;</p><p class="source-code">             &lt;/div&gt;`);</p><p class="source-code">        updateHTML("cards", cardHtml.join(""));</p><p class="source-code">    };</p></li>
				<li>The next part of the visual display is the status display, which tells the user the sum of their hand and whether the game is over. The implementation that will be used in this solution consists of the two functions shown in the following code:<p class="source-code">const showOrHide =</p><p class="source-code">    (updateStyle, element, hide) =&gt;</p><p class="source-code">        updateStyle(element, "display", hide ? "none" : "");</p><p class="source-code">const updateStatusDisplay =</p><p class="source-code">    ({ updateStyle, updateHTML }, hand, stay) =&gt; {</p><p class="source-code">        const total = sumCards(hand);</p><p class="source-code">        updateHTML("totalSpan", total);</p><p class="source-code">        const bust = isBust(total);</p><p class="source-code">        const gameover = isGameOver(bust, stay);</p><p class="source-code">        showOrHide(updateStyle, "playBtn", !gameover);</p><p class="source-code">        showOrHide(updateStyle, "hitBtn", gameover);</p><p class="source-code">        showOrHide(updateStyle, "stayBtn", gameover);</p><p class="source-code">        let statusMsg = gameover ?</p><p class="source-code">            "Game over.  Press New Game button to start again." :</p><p class="source-code">            "Select Hit or Stay";</p><p class="source-code">        statusMsg = bust ? "You went bust!!! " + statusMsg : statusMsg;</p><p class="source-code">        updateHTML("statusMsg", statusMsg);</p><p class="source-code">    };</p></li>
				<li>Now, we're going to add functions for each action a user can take, such as <strong class="source-inline">play</strong>, <strong class="source-inline">stay</strong>, and <strong class="source-inline">hit</strong>. We will call these handlers:<p class="source-code">const playHandler = (randomizer, { getState, setState }) =&gt; () =&gt; {</p><p class="source-code">     const orderedDeck = createOrderedDeck(suits(), ranks(rankNames()));</p><p class="source-code">     let gameDeck = shuffle(orderedDeck, randomizer);</p><p class="source-code">     [hand, gameDeck] = draw(gameDeck, 2);</p><p class="source-code">     setState(hand, gameDeck);</p><p class="source-code"> };</p><p class="source-code"> </p><p class="source-code">const hitHandler = ({ getState, setState }) =&gt; () =&gt; {</p><p class="source-code">     [hand, gameDeck] = getState();</p><p class="source-code">     [card, gameDeck] = draw(gameDeck, 1);</p><p class="source-code">     setState(hand.concat(card), gameDeck);</p><p class="source-code"> };</p><p class="source-code"> </p><p class="source-code">const stayHandler = ({ getState, setState }) =&gt; () =&gt; {</p><p class="source-code">     [hand, gameDeck] = getState();</p><p class="source-code">setState(hand, gameDeck, true);</p><p class="source-code">};</p></li>
				<li>You may have noticed that, in the solution steps, there are some variables that haven't been defined. We've saved these for a section at the end that includes all non-purely functional code:<p class="source-code-heading">Solution.html</p><p class="source-code">206 // impure functions</p><p class="source-code">207 </p><p class="source-code">208 const byId =</p><p class="source-code">209     elementId =&gt; document.getElementById(elementId);</p><p class="source-code">210 </p><p class="source-code">211 const updateHTML =</p><p class="source-code">212     (elementId, html) =&gt; byId(elementId).innerHTML = html;</p><p class="source-code">213 </p><p class="source-code">214 const updateStyle =</p><p class="source-code">215     (elementId, style, value) =&gt; byId(elementId).style[style] = value;</p><p class="source-code">216 </p><p class="source-code">217 const randomizer =</p><p class="source-code">218     Math.random;</p><p class="source-code-link">The full code is available at: <a href="https://packt.live/2FnuFCH">https://packt.live/2FnuFCH</a></p></li>
				<li>We now have almost a completely working game. All we need to do is set the state and call that to tell the game to start:<p class="source-code">const createState = (dom) =&gt; {</p><p class="source-code">    let _state;</p><p class="source-code">    const getState = () =&gt; [..._state];</p><p class="source-code">    const setState =</p><p class="source-code">        (hand, gameDeck, stay = false) =&gt; {</p><p class="source-code">            _state = [hand, gameDeck];</p><p class="source-code">            updateCardDisplay(dom, hand);</p><p class="source-code">            updateStatusDisplay(dom, hand, stay);</p><p class="source-code">        };</p><p class="source-code">    return { getState, setState };</p><p class="source-code">}</p><p class="source-code">startGame(createState(dom));</p></li>
			</ol>
			<p>With these steps done, you should now be able to open the HTML file in a browser and have a running version of the game, as shown in the following screenshot:</p>
			<div>
				<div class="IMG---Figure" id="_idContainer379">
					<img alt="Figure 14.17: Screenshot of the Blackjack game&#13;&#10;" src="image/C14377_15_17.jpg"/>
				</div>
			</div>
			<p class="figure-caption">Figure 14.17: Screenshot of the Blackjack game</p>
			<p>If you're unsure about whether you followed the solution steps correctly, feel free to take a look at the <strong class="source-inline">blackjack/solution.html</strong> file and compare it with your own implementation. </p>
			<h1 id="_idParaDest-625"><a id="_idTextAnchor694"/>Chapter 15: Asynchronous Tasks</h1>
			<h2 id="_idParaDest-626"><a id="_idTextAnchor695"/>Activity 15.01: Refactoring Promise Code to await/async Syntax</h2>
			<h3 id="_idParaDest-627"><a id="_idTextAnchor696"/>Solution</h3>
			<p>Here's one implementation of equivalent code that uses <strong class="source-inline">async/await</strong>:</p>
			<ol>
				<li value="1">Define the promise variables as follows:<p class="source-code">(async () =&gt; {  </p><p class="source-code">    let p1 = use1(); </p><p class="source-code">    let p2 = use2(); </p><p class="source-code">    let p3 = use3(); </p></li>
				<li>It would not have been correct to place the <strong class="source-inline">await</strong> keyword in the initial block when calling each function like this:<p class="source-code">    let p1 = await use1();</p><p class="source-code">    let p2 = await use2();</p><p class="source-code">    let p3 = await use3();</p><p>This is because each of the use cases has a different timeout defined. If you used <strong class="source-inline">await</strong> when calling <strong class="source-inline">use1()</strong>, it would have caused a delay of 3 seconds until it completed before <strong class="source-inline">use2()</strong> was even initiated, which is not what you want. Rather, our desire is for all three use cases to trigger one right after the other with no delay, so they execute concurrently.</p></li>
				<li>You then have the three <strong class="source-inline">await</strong> keywords:<p class="source-code">    await p1;</p><p class="source-code">    await p2;</p><p class="source-code">    await p3;</p></li>
				<li>It made sense to refactor each case into its own asynchronous functions: <strong class="source-inline">use1()</strong>, <strong class="source-inline">use2()</strong>, and <strong class="source-inline">use3()</strong>. The <strong class="source-inline">async</strong> keyword indicates that these functions are asynchronous ones (you could have used inline <strong class="source-inline">async</strong> functions, but this would have made for rather confusing and awkward syntax):</li>
			</ol>
			<p class="source-code-heading">activity1_solution.js</p>
			<p class="source-code">31     console.log("All done!");</p>
			<p class="source-code">32 })();</p>
			<p class="source-code">33 </p>
			<p class="source-code">34 async function use1() {</p>
			<p class="source-code">35     let response = await addDelay(3000, fetch(nextEventUrl));</p>
			<p class="source-code">36     let nextEvents = await response.json();</p>
			<p class="source-code">37     console.log("Use case 1: " + nextEvents.events[0].strEvent);</p>
			<p class="source-code">38 }</p>
			<p class="source-code">39 </p>
			<p class="source-code">40 async function use2() {</p>
			<p class="source-code">41     let response = await fetch(nextEventUrl);</p>
			<p class="source-code">42     await addDelay(1000);</p>
			<p class="source-code">43     let nextEvents = await response.json();</p>
			<p class="source-code">44     console.log("Use case 2: " + nextEvents.events[1].strEvent);</p>
			<p class="source-code-link">The full code is available at: <a href="https://packt.live/32JulHw">https://packt.live/32JulHw</a></p>
			<p>In this activity, the order in which you wait for promises does not matter. Even though <strong class="source-inline">await use1</strong> will end up waiting 3 seconds, by the time <strong class="source-inline">await use2</strong> and <strong class="source-inline">await use3</strong> are called, both of those promises would have already been completed a second or two before, so they would just move on right away.</p>
			<h2 id="_idParaDest-628"><a id="_idTextAnchor697"/>Activity 15.02: Further Simplifying Promise Code to Remove Function Parameters</h2>
			<h3 id="_idParaDest-629"><a id="_idTextAnchor698"/>Solution</h3>
			<p>Here's one possible implementation. The two functions are very similar and have been refactored using two different styles for demonstration purposes. However, it is perfectly acceptable to solve the challenge using one or the other technique for both of the functions:</p>
			<ol>
				<li value="1">In technique #1, refactor <strong class="source-inline">getTeamsInLeague</strong> so that it now only takes one parameter, <strong class="source-inline">(leagueName)</strong>, rather than two parameters that are actually needed to determine the full result <strong class="source-inline">(leagueData, leagueName)</strong>. The other parameter is deferred until later:<p class="source-code">function getTeamsInLeague(leagueName) {</p></li>
				<li>In technique #1, instead of returning the promise from <strong class="source-inline">myFetch</strong> directly, you return another curried function that takes <strong class="source-inline">leagueData</strong> as its parameter (the parameter you deferred in the last step). It is only a partially applied function at this point:<p class="source-code">return leagueData =&gt; {</p><p class="source-code">    const leagueId = findLeagueId(leagueData, leagueName);</p><p class="source-code">        return myFetch(ALL_TEAMS_URL, {id: leagueId});</p><p class="source-code">    }</p><p class="source-code">}</p></li>
				<li>Technique #2 is really the same idea, but uses a function variable and multiple levels of arrow functions rather than a regular function:<p class="source-code">// technique #2 – use a function variable and multiple arrow functions</p><p class="source-code">const getPlayersOnTeam = teamName =&gt; teamData =&gt; {</p><p class="source-code">    const teamId = findTeamId(teamData, teamName);</p><p class="source-code">    return myFetch(ALL_PLAYERS_URL, {id: teamId});</p><p class="source-code">}</p></li>
				<li>Finally, when <strong class="source-inline">getTeamsInLeague(LEAGUE_NAME)</strong> is invoked in the <strong class="source-inline">then()</strong> clause, the function returned above would be fully applied, with the resolved value from the previous promise passed in as the implied <strong class="source-inline">leagueData</strong> parameter:<p class="source-code">myFetch(ALL_LEAGUES_URL)</p><p class="source-code">  .then(getTeamsInLeague(LEAGUE_NAME))</p><p class="source-code">  .then(getPlayersOnTeam(TEAM_NAME))</p><p class="source-code">  .then(getPlayerHonors)</p><p class="source-code">  .catch(console.log)</p></li>
				<li>To perhaps make this plainer, let's consider this as if it were written with <strong class="source-inline">async/await</strong> syntax. Refer to the following code. On the second line, the process when calling <strong class="source-inline">getTeamsInLeague(LEAGUE_NAME)</strong> is incomplete at that point and returns another function to complete it. Only when calling this partially applied function on the third line would you finally have the desired result:<p class="source-code">const allLeagueData = await myFetch(ALL_LEAGUES_URL);</p><p class="source-code">const partiallyAppliedFunction = getTeamsInLeague(LEAGUE_NAME);</p><p class="source-code">const league = await partiallyAppliedFunction(allLeagueData);</p></li>
			</ol>
		</div>
	</body></html>