<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Pie Charts</h1></div></div></div><p>In this chapter, you will learn how to plot pie charts and explore their various options. We will then examine how to put multiple pies inside a chart. After that, we will find out how to create a donut chart. We will then end the chapter by sketching a chart that contains all the series types that we have learned so far—column, line, and pie. In this chapter, we will be covering the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding the relationship between chart, pie, and series</li><li class="listitem" style="list-style-type: disc">Plotting simple pie charts – single series</li><li class="listitem" style="list-style-type: disc">Plotting multiple pies in a chart – multiple series</li><li class="listitem" style="list-style-type: disc">Preparing a donut chart – multiple series</li><li class="listitem" style="list-style-type: disc">Building a chart with multiple series types</li><li class="listitem" style="list-style-type: disc">Understanding the <code class="literal">startAngle</code> and <code class="literal">endAngle</code> options</li><li class="listitem" style="list-style-type: disc">Creating a simplified version of the stock picking wheel chart</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Understanding the relationship between chart, pie, and series</h1></div></div></div><p>Pie charts are simple to plot: they have no axes to configure and all they need is data with categories. Generally, the term <strong>pie chart</strong><a id="id327" class="indexterm"/> refers to a chart with a single pie series. In Highcharts, a chart can handle multiple pie series. In this case, a chart can display more than one pie: each pie<a id="id328" class="indexterm"/> is associated with a series of data. Instead of showing multiple pies, Highcharts can display a donut chart<a id="id329" class="indexterm"/> that is basically a pie chart with multiple concentric rings lying on top of each other. Each concentric ring is a<a id="id330" class="indexterm"/> pie series, similar to a stacked pie chart. We will first learn how to plot a chart with a single pie, and then later on in the chapter we will explore plotting with multiple pie series in separate pies and a donut chart.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Plotting simple pie charts – single series</h1></div></div></div><p>In this chapter, we are going to use video gaming data supplied by <a id="id331" class="indexterm"/>
<strong>vgchartz</strong><a id="id332" class="indexterm"/> (<a class="ulink" href="http://www.vgchartz.com">www.vgchartz.com</a>). The following is the pie chart configuration, and the data is the number of games sold in 2011 according to publishers, based on the top 100 games sold. Wii <a id="id333" class="indexterm"/>Sports is taken out of the dataset because it is free with the Wii console:</p><div><pre class="programlisting">      chart: {
        renderTo: 'container',
        type: 'pie',
        borderWidth: 1,
        borderRadius: 5
      },
      title: {
        text: 'Number of Software Games Sold in 2011 Grouped by Publishers',
      },
      credits: { 
        ...
      },
      series: [{
        data: [ [ 'Nintendo', 54030288 ], 
            [ 'Electronic Arts', 31367739 ],
            ... ]
      }]</pre></div><p>Here is a simple pie chart screenshot with the first data point (Nintendo) starting at the 12 o'clock position. The first slice always starts at the 12 o'clock position unless we specify a different start point with the <code class="literal">startAngle</code> option, which we will explore later in the chapter.</p><div><img src="img/7451OS_05_01.jpg" alt="Plotting simple pie charts – single series"/></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec44"/>Configuring the pie with sliced off sections</h2></div></div></div><p>We can improve the <a id="id334" class="indexterm"/>previous pie chart to include values<a id="id335" class="indexterm"/> in the labels and word wrap some of the long names of the publishers. The following is the configuration code for the pie series. The <code class="literal">allowPointSelect</code> option<a id="id336" class="indexterm"/> allows the users to interact with the chart by clicking on the data points. As for the pie series, this is used for slicing off a section of the pie chart (see the following screenshot). The <code class="literal">slicedOffset</code> option<a id="id337" class="indexterm"/> is used to adjust how far the section is sliced off from the pie chart. For word wrap labels, we set the labels style, <code class="literal">dataLabels.style.width</code>, to 140 pixels wide:</p><div><pre class="programlisting">   plotOptions: {
     pie: {
       slicedOffset: 20,
       allowPointSelect: true,
       dataLabels: {
         style: {
              width: '140px'
         },
         formatter: function() {
           var str = this.point.name + ': ' +          
             Highcharts.numberFormat(this.y, 0);
           return str;
         }
       }
     }
   },</pre></div><p>Additionally, we would like<a id="id338" class="indexterm"/> to slice off the largest section in the <a id="id339" class="indexterm"/>initial display; its label is shown in bold type font. To do that, we will need to change the largest data point into object configuration as shown in the following screenshot. Then we put the <code class="literal">sliced</code> property into the object and change from the default, <code class="literal">false</code>, to <code class="literal">true</code>, which forces the slice to part from the center. Furthermore, we set <code class="literal">dataLabels</code> with the assignment of the <code class="literal">fontWeight</code> option to overwrite the default settings:</p><div><pre class="programlisting">    series: [{
      data: [ { 
        name: 'Nintendo', 
        y: 54030288, 
        sliced: true, 
        dataLabels: { 
          style: { 
          fontWeight: 'bold' 
          } 
        } 
       }, [ 'Electronic Arts', 31367739 ], 
        [ 'Activision', 30230170 ], .... ]
    }]</pre></div><p>The following is the chart with the refined labels:</p><div><img src="img/7451OS_05_02.jpg" alt="Configuring the pie with sliced off sections"/></div><p>As mentioned<a id="id340" class="indexterm"/> earlier, the <code class="literal">slicedOffset</code> option <a id="id341" class="indexterm"/>has also pushed the sliced off section further than the default distance, which is 10 pixels. The <code class="literal">slicedOffset</code> option applies to all the sliced off sections, which means that we cannot control the distance of individually parted sections. It is also worth noticing that the connectors (the lines between the slice and the data label) become crooked as a result of that. In the next example, we demonstrate that the <code class="literal">sliced</code> property can be applied to as many data points as we want, and remove the <code class="literal">slicedOffset</code> option to resume the default settings to show the difference. The following chart illustrates this with three parted slices, by repeating the data object settings (Nintendo) for two other points:</p><div><img src="img/7451OS_05_08.jpg" alt="Configuring the pie with sliced off sections"/></div><p>Notice that the <a id="id342" class="indexterm"/>connectors go back to being <a id="id343" class="indexterm"/>smooth lines. However, there is another interesting behavior for the <code class="literal">sliced</code> option. For those slices with <code class="literal">sliced</code> as the default setting (<code class="literal">false</code>), only one of them can be sliced off. For instance, the user clicks on the <strong>Others</strong> section and it moves away from the chart. Then, clicking on <strong>Activision</strong> will slice off the section and the <strong>Others</strong> section moves back towards the center, whereas the three configured <code class="literal">sliced: true</code> sections maintain their parted positions. In other words, with the <code class="literal">sliced</code> option set to <code class="literal">true</code>, this enables its state to be independent of others with the <code class="literal">false</code> setting.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec45"/>Applying a legend to a pie chart</h2></div></div></div><p>So far, the chart<a id="id344" class="indexterm"/> contains large numbers, and it is difficult to really<a id="id345" class="indexterm"/> comprehend how much larger one section is than the other. We can print all the labels in percentages. Let's put all the publisher names inside a legend box and print the percentage values inside each slice.</p><p>The plotting configuration is redefined as follows. To enable the legend box, we set <code class="literal">showInLegend</code> to <code class="literal">true</code>. Then, we set the data labels' font color and style to bold and white respectively, and change the <code class="literal">formatter</code> function slightly to use the <code class="literal">this.percentage</code> variable that is only available for the pie series. The <code class="literal">distance</code> option is the distance between the data label and the outer edge of the pie. A positive value will shift the data label outside of the edge and a negative value will do the same in the opposite direction:</p><div><pre class="programlisting">      plotOptions: {
        pie: {
          showInLegend: true,
          dataLabels: {
            distance: -24,
            color: 'white',
            style: {
              fontWeight: 'bold'
            },
            formatter: function() {
              return Highcharts.numberFormat(this.percentage) + '%';
            }          
          }
        }
      },</pre></div><p>Then, for the legend<a id="id346" class="indexterm"/> box, we add in some padding as there are more than a few <a id="id347" class="indexterm"/>legend items, and set the legend box closer to the pie, as follows:</p><div><pre class="programlisting">      legend: {
        align: 'right',
        layout: 'vertical',
        verticalAlign: 'middle',
        itemMarginBottom: 4,
        itemMarginTop: 4,
        x: -40
      },</pre></div><p>The following is another presentation of the chart:</p><div><img src="img/7451OS_05_03.jpg" alt="Applying a legend to a pie chart"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Plotting multiple pies in a chart – multiple series</h1></div></div></div><p>With pie charts, we can do <a id="id348" class="indexterm"/>something more informative by displaying <a id="id349" class="indexterm"/>another pie chart side by side to compare data. This can be done by simply specifying two series configurations in the series array.</p><p>We can continue to use the previous example for the chart on the left-hand side and we create a new category series from the same dataset, but this time grouped by platforms. The following is the series configuration for doing so:</p><div><pre class="programlisting">      plotOptions:{
        pie: {
           ....,
           size: '75%'
        }
      },
      series: [{
        center: [ '25%', '50%' ],
        data: [ [ 'Nintendo', 54030288 ], 
                [ 'Electronic Arts', 31367739 ], 
                .... ]
      }, {
        center: [ '75%', '50%' ],
        dataLabels: {
          formatter: function() {
            var str = this.point.name + ': ' +                    Highcharts.numberFormat(this.percentage, 0) + '%';
            return str;
          }
        },
        data: [ [ 'Xbox', 80627548 ], 
                [ 'PS3', 64788830 ], 
                   ....  ]
      }]</pre></div><p>As we can see, we use a <a id="id350" class="indexterm"/>new option, <code class="literal">center</code>, to position the pie chart. The<a id="id351" class="indexterm"/> option contains an array of two percentage values—the first is the ratio of the x position to the whole container width, whereas the second percentage value is the y ratio. The default value is <code class="literal">['50%', '50%']</code>, which is in the middle of the container. In this example, we specify the first percentage values as <code class="literal">'25%'</code> and <code class="literal">'75%'</code>, which are in the middle of the left- and the right-hand halves respectively. We set the size for the pie series to 75 percent with <code class="literal">plotOptions.pie.size</code>. This ensures that both pies are the same size, otherwise the left hand pie will appear smaller.</p><p>In the second series, we will choose to display the pie chart with percentage data labels instead of unit values. The following is the screenshot of a chart with double pies:</p><div><img src="img/7451OS_05_04.jpg" alt="Plotting multiple pies in a chart – multiple series"/></div><p>On the surface, this is not much different to plotting two separate pie charts in an individual <code class="literal">&lt;div&gt;</code> tag, apart from sharing the same title. The main benefit is that we can combine different series type presentations under the same chart. For instance, let's say we want to present the distribution in ratio in pie series directly above each group of multiple column series. We will<a id="id352" class="indexterm"/> learn how to<a id="id353" class="indexterm"/> do this later in the chapter.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Preparing a donut chart – multiple series</h1></div></div></div><p>Highcharts offers another type of pie chart, a <a id="id354" class="indexterm"/>
<strong>donut chart</strong>. It has the effect of drilling down on a category to create subcategories, and is a convenient way of viewing data in greater<a id="id355" class="indexterm"/> detail. This drill-down effect can be applied on multiple levels. In this section, we will create a simple donut chart that has an outer ring of subcategories (game titles) that align with the inner categories (publishers).</p><p>For the sake of simplicity, we will only use the top three games publishers for the inner pie chart. The following is the series array configuration for the donut chart:</p><div><pre class="programlisting">      series: [{
        name: 'Publishers',
        dataLabels : {
          distance: -70,
          color: 'white',
          formatter: function() {
             return this.point.name + ':&lt;br/&gt; ' +
 Highcharts.numberFormat(this.y / 1000000, 2);
          },
          style: {
             fontWeight: 'bold'
          }
        },
        data: [ [ 'Nintendo', 54030288 ], 
                [ 'Electronic Arts', 31367739 ],
                [ 'Activision', 30230170 ] ]
      }, {
        name: 'Titles',
        innerSize: '60%',
        dataLabels: {
          formatter: function() {
            var str = '&lt;b&gt;' + this.point.name + '&lt;/b&gt;: ' + 
                 Highcharts.numberFormat(this.y / 1000000, 2);
            return str;
          }
        },
        data: [ // Nintendo
            { name: 'Pokemon B&amp;W', y: 8541422,
             color: colorBrightness("#4572A7",
                        0.05) }, 
            { name: 'Mario Kart', y: 5349103,
             color: colorBrightness('#4572A7',
                        0.1) },
            ....
 
            // EA
            { name: 'Battlefield 3', y: 11178806,
             color: colorBrightness('#AA4643',
                        0.05) }, 
            .... 

            // Activision
            { name: 'COD: Modern Warfare 3', 
             y: 23981182, 
             color: colorBrightness('#89A54E',
                        0.1) },
            ....
        }]
      }]</pre></div><p>First, we have two<a id="id356" class="indexterm"/> series—the inner pie series, or the <strong>Publishers</strong>, and the outer ring series, or the <strong>Titles</strong>. The <strong>Titles</strong> series has all the data for the subcategories together, and it aligns with the <strong>Publisher</strong> series. The order is such that the values of the subcategories for the <strong>Nintendo</strong> category are before the subcategory data for <strong>Electronic Arts,</strong> and so on (see the order of data arrays in the <strong>Title</strong> series).</p><p>Each data point in the subcategories series is declared as a data point object for assigning the color in a similar range to their main category. This can be achieved by following the Highcharts demo to fiddle with the color brightness:</p><div><pre class="programlisting">color: Highcharts.Color(color).brighten(brightness).get()</pre></div><p>Basically, what this does is to use the main category color value to create a <code class="literal">Color</code> object and then adjust the color code with the brightness parameter. This parameter is derived from the ratio of the subcategory value. We rewrite this example into a function known as <code class="literal">colorBrightness</code>, and call it in the chart configuration:</p><div><pre class="programlisting"> function colorBrightness(color, brightness) {
   return   
     Highcharts.Color(color).brighten(brightness).get();
 }</pre></div><p>The next part is to specify which series goes to the inner pie and which goes to the outer ring. The <code class="literal">innerSize</code> option is used by the outer series, <strong>Title</strong>, to create an inner circle. As a result, the <strong>Title</strong> series forms a donut/concentric ring. The value for the <code class="literal">innerSize</code> option can be either in pixels or percentage values of the plot area size.</p><p>The final part is to decorate the chart with data labels. Obviously, we want to position the data labels of the inner charts to be over the inner pie, so we assign a negative value to the <code class="literal">dataLabels.distance</code> option. Instead of printing long values, we define <code class="literal">formatter</code> to convert them into units of millions.</p><p>The following is the display of <a id="id357" class="indexterm"/>the donut chart:</p><div><img src="img/7451OS_05_05.jpg" alt="Preparing a donut chart – multiple series"/></div><p>Note that it is not mandatory to put a pie chart in the center of a donut chart. It is just the presentation style of this example. We can have multiple concentric rings instead. The following chart is exactly the same example as mentioned earlier, with the addition of the <code class="literal">innerSize</code> option to the inner series of <strong>Publishers</strong>:</p><div><img src="img/7451OS_05_09.jpg" alt="Preparing a donut chart – multiple series"/></div><p>We can even further<a id="id358" class="indexterm"/> complicate the donut chart by introducing a third series. We plot the following chart in three layers. The code is simply extended from the example with another series and includes more data. The source code and the demo are <a id="id359" class="indexterm"/>available at <a class="ulink" href="http://joekuan.org/Learning_Highcharts/">http://joekuan.org/Learning_Highcharts/</a>. The two outer series use the <code class="literal">innerSize</code> option. As the inner pie will become even smaller and will not have enough space for the labels, we therefore enable the legend box for the innermost series with the <code class="literal">showInLegend</code> option.</p><div><img src="img/7451OS_05_06.jpg" alt="Preparing a donut chart – multiple series"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Building a chart with multiple series types</h1></div></div></div><p>So far, we have learned <a id="id360" class="indexterm"/>about the line, column, and pie series types. It's<a id="id361" class="indexterm"/> time to bring all these different series presentations together in a single chart. In this section, we will use the annual data from 2008 through 2011 to plot three different kinds of series type: column, line, and pie. The column type represents the yearly number of games sold for each type of gaming console. The pie series shows the annual number of gaming consoles sold for each vendor. The last one is the spline series type that discloses how many new game titles there are released in total for all the consoles each year.</p><p>In order to ensure the whole graph uses the same color scheme for each type of gaming console, we have to manually assign a color code for each data point in the pie charts and the columns series:</p><div><pre class="programlisting">    var wiiColor = '#BBBBBB',
        x360Color = '#89A54E',
        ps3Color = '#4572A7',
        splineColor = '#FF66CC';</pre></div><p>We then decorate the chart in a more funky way. First, we give the chart a dark background with a color gradient:</p><div><pre class="programlisting">    var chart = new Highcharts.Chart({
      chart: {
        renderTo: 'container',        
        borderWidth: 1,
        spacingTop: 40,
        backgroundColor: {
          linearGradient: { x1: 0, y1: 0, 
                            x2: 0, y2: 1 },
          stops: [ [ 0, '#0A0A0A' ],
                   [ 1, '#303030' ] ]
        }
      },
      subtitle: {
          floating: true,
          text: 'Number of consoles sold (in millions)',
          y: -5
      },</pre></div><p>Then, we need to shift the columns to the right-hand side, so that we have enough room for an image (described later) that we are going to put in the top left-hand corner:</p><div><pre class="programlisting">      xAxis: {
        minPadding: 0.2,
        tickInterval: 1,
        labels: {
          formatter: function() {            
            return this.value;
            },  
          style: {
           color: '#CFCFCF'
          } 
        }
      },</pre></div><p>The next task is to make<a id="id362" class="indexterm"/> enough space for the pie charts to locate <a id="id363" class="indexterm"/>them above the columns. This can be accomplished by introducing the <code class="literal">maxPadding</code> option on both y axes:</p><div><pre class="programlisting">      yAxis: [{
        title: {
          text: 'Number of games sold',
          align: 'low',
          style: {           
            color: '#CFCFCF'
          }
        },
        labels: {
          style: {
           color: '#CFCFCF'
          }
        },
        maxPadding: 0.5
      }, {
        title: {
          text: 'Number of games released',
          style: {           
           color: splineColor
          } 
        },
        labels: {
          style: {
           color: splineColor
          } 
        },
        maxPadding: 0.5,
        opposite: true
      }],</pre></div><p>Each pie series is <a id="id364" class="indexterm"/>displayed separately and aligned to the top of the<a id="id365" class="indexterm"/> columns, as well as with the year category. This is done by adjusting the pie chart's <code class="literal">center</code> option in the series array. We also want to reduce the display size for the pie series, as there are other types of series to share within the chart. We will use the <code class="literal">size</code> option and set the value in percentages. The percentage value is the diameter of the pie series compared to the size of the plot area:</p><div><pre class="programlisting">      series:[{
        type: 'pie',
        name: 'Hardware 2011',
        size: '25%',
        center: [ '88%', '5%' ],
        data: [{ name: 'PS3', y: 14128407, 
             color: ps3Color }, 
            { name: 'X360', y: 13808365, 
             color: x360Color }, 
            { name: 'Wii', y: 11567105, 
             color: wiiColor } ],
        .....</pre></div><p>The spline series is defined to correspond to the opposite y axis. To make the series clearly associated with the second axis, we apply the same color scheme for the line, axis title, and labels:</p><div><pre class="programlisting">      {  name: "Game released",
        type: 'spline',
        showInLegend: false,
        lineWidth: 3,
        yAxis: 1,
        color: splineColor,
        pointStart: 2008, 
        pointInterval: 1,
        data: [ 1170, 2076, 1551, 1378 ]
      }, </pre></div><p>We use the <code class="literal">renderer.image</code> method to insert the image into the chart and make sure that the image has a<a id="id366" class="indexterm"/> higher <code class="literal">zIndex</code>, so that the axis line does not lie <a id="id367" class="indexterm"/>at the top of the image. Instead of including a PNG image, we use an SVG image. This way the image stays sharp and avoids the pixelation effect when the chart is resized:</p><div><pre class="programlisting">    chart.renderer.image('./pacman.svg', 0,
               0, 200, 200).attr({
       'zIndex': 10 
    }).add();</pre></div><p>The following is the final look of the graph with a Pac-Man SVG image to give a gaming theme to the chart:</p><div><img src="img/7451OS_05_07.jpg" alt="Building a chart with multiple series types"/></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec46"/>Creating a stock picking wheel</h2></div></div></div><p>A stock picking wheel chart<a id="id368" class="indexterm"/> is a designer financial chart created by <a id="id369" class="indexterm"/>Investors Intelligence (<a class="ulink" href="http://www.investorsintelligence.co.uk/wheel/">http://www.investorsintelligence.co.uk/wheel/</a>), and the chart provides an interactive way to visualize <a id="id370" class="indexterm"/>both the overall and detailed performance of major shares from a market index. The following is a screenshot of the chart:</p><div><img src="img/7451OS_05_10.jpg" alt="Creating a stock picking wheel"/></div><p>Basically, it is an open-ended donut chart. Each slice represents a blue chip company and all the slices have equal width. The slices are divided into different color bands (from red, to orange, green, and blue) based on the share performance score. When the user hovers the mouse over a company name, a bigger slice appears at the gap of the donut chart with the company name and detailed performance information. Although this impressive chart is implemented in Adobe Flash, we are going to push our luck to see whether Highcharts can produce a lookalike cousin in this section. We will focus on the donut chart and leave the middle charts as an exercise for you later.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec47"/>Understanding startAngle and endAngle</h2></div></div></div><p>Before we start plotting a <a id="id371" class="indexterm"/>Stock Picking Wheel chart, we need to know how to create an<a id="id372" class="indexterm"/> open-ended donut chart. The options <code class="literal">startAngle</code> and <code class="literal">endAngle</code> can make a pie chart split open in any size and direction. However, we need to familiarize ourselves with these options before plotting the actual chart. By default, the starting position for the first slice is at 12 o'clock, which is regarded as 0 degrees for the <code class="literal">startAngle</code> option. The <code class="literal">startAngle</code> option starts from the origin and moves in a clockwise direction to <code class="literal">endAngle</code>. Let's make a simple pie chart with <code class="literal">startAngle</code> and <code class="literal">endAngle</code> assigned to <code class="literal">30</code> and <code class="literal">270</code> respectively:</p><div><pre class="programlisting">            plotOptions: {
               pie: {
                   startAngle: 30,
                   endAngle: 270 
               }
            },</pre></div><p>The preceding code produces the following chart. Note that although the pie area for the series data becomes smaller, the data will still be proportionally adjusted:</p><div><img src="img/7451OS_05_11.jpg" alt="Understanding startAngle and endAngle"/></div><p>In order to display a gap at the right-hand side of the pie, the <code class="literal">endAngle</code> option needs to be handled slightly differently. For <code class="literal">endAngle</code> to end up above the <code class="literal">startAngle</code> option, that is, the <code class="literal">endAngle</code> option goes round and passes the origin at 0 degrees, the <code class="literal">endAngle</code> value has to exceed 360, not start from 0 degrees again. Let's set the <code class="literal">startAngle</code> and <code class="literal">endAngle</code> values to 120 and 420 respectively and increase the <code class="literal">innerSize</code> value to form a donut chart. Here is the new configuration:</p><div><pre class="programlisting">            plotOptions: {
                pie: {
                    startAngle: 120,
                    endAngle: 420,
                    innerSize: 110,
                    ....
                }
           } </pre></div><p>We can see the <code class="literal">endAngle</code> option goes past the origin and ends above the <code class="literal">startAngle</code> option. See the following screenshot:</p><div><img src="img/7451OS_05_12.jpg" alt="Understanding startAngle and endAngle"/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec48"/>Creating slices for share symbols</h2></div></div></div><p>So far, we have successfully <a id="id373" class="indexterm"/>created the general shape of the stock picking <a id="id374" class="indexterm"/>wheel chart. The next task is to populate financial data labels on each slice with equal size. Instead of having a hundred shares from the FTSE index like the original chart, we will use the Dow Jones Industrial Average instead, which is composed of 30 major shares. First, we generate a series data array with share symbols in descending order of percentage change:</p><div><pre class="programlisting">          var data = [{
               name: 'MCD 0.96%',
               y: 1,
               dataLabels: { rotation: 35 },
               color: colorBrightness('#365D97', ratio1)
          }, {
              name: 'HD 0.86%',
              y: 1,
              dataLabels: { rotation: 45 },
              color: colorBrightness('#365D97', ratio2)
          }, {
              ....
          }]</pre></div><p>We set the y-axis value to 1 for each share symbol in order to make it the same size for all the slices. Then, we evaluate the positive and negative gradual color change based on the ratio between the percentage change of those shares and the overall maximum and minimum values respectively. We then apply this ratio value to the <code class="literal">colorBrightness</code> method (which we have discussed previously) to achieve the gradual change effect.</p><p>As for the label rotation, since <a id="id375" class="indexterm"/>we know where to put each share symbol and what<a id="id376" class="indexterm"/> rotation to apply in advance, we can compute the label rotation based on the company's share symbol position from the <code class="literal">startAngle</code>. The orientation for the <code class="literal">dataLabel</code> is different to the <code class="literal">startAngle</code>, which starts with the 3 o'clock position as 0 degrees (because we read text horizontally). With the <code class="literal">startAngle</code> as 120 degrees, we can easily calculate the <code class="literal">dataLabel</code> rotation for the first slice as 30 degrees (we add another 5 degrees for the <code class="literal">dataLabel</code> to appear in the middle of the slice) and each slice is another 10 degrees of rotation more than the previous slice. The following illustrates the logic of this computation:</p><div><img src="img/7451OS_05_13.jpg" alt="Creating slices for share symbols"/></div><p>Our next task is to remove the connector and move the default <code class="literal">dataLabel</code> position (which is outside the slice) towards the center of the pie chart. We achieve that by setting the <code class="literal">connectorWidth</code> value to zero and assigning the <code class="literal">distance</code> option to a negative value to drag the <code class="literal">dataLabel</code> towards the center of the chart, such that the label is placed inside the slice. Here is the <code class="literal">plotOptions.pie</code> config:</p><div><pre class="programlisting">       plotOptions: {
           pie: {
               size: '100%',
               startAngle: 120,
               endAngle: 420,
               innerSize: 110,
               dataLabels: {
                   connectorWidth: 0,
                   distance: -40,
                   color: 'white',
                   y: 15
               }
    },</pre></div><p>The following screenshot <a id="id377" class="indexterm"/>shows the result of rotating labels along the slice's<a id="id378" class="indexterm"/> orientation for a stock picking wheel effect:</p><div><img src="img/7451OS_05_14.jpg" alt="Creating slices for share symbols"/></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec49"/>Creating shapes with Highcharts' renderer</h2></div></div></div><p>The final missing piece for this<a id="id379" class="indexterm"/> experiment is to display an arc showing share symbol<a id="id380" class="indexterm"/> details when users hover the pointer over a slice. To do that, we make use of the Highcharts renderer engine, which provides a set of APIs to draw various shapes and text in the chart. In this exercise, we call the method <code class="literal">arc</code> to create a dynamic slice and position it inside the gap.</p><p>Since this is triggered by a user action, the process has to be performed inside an event handler. The following is the event handler code:</p><div><pre class="programlisting">  var mouseOver = function(event) {
         // 'this' keyword in this handler represents 
         // the triggered object, i.e. the data point
         // being hovered over 
         var point = this;

         // retrieve the renderer object from the 
         // chart hierarchy
         var renderer = point.series.chart.renderer;

         // Initialise the SVG elements group
         group = renderer.g().add();

         // Calculate the x and y coordinate of the 
         // pie center from the plot dimension
         var arcX = c.plotWidth/2 - c.plotLeft;
         var arcY = c.plotHeight/2 + c.plotTop;
 
         // Create and display the SVG arc with the 
         // same color hovered slice and add the arc 
         // into the group
         detailArc = 
             renderer.arc(arcX, arcY, 230, 70, -0.3, 0.3)
                      .css({
                           fill: point.options.color
                       }).add(group);

         // Create and display the text box with stock
         // detail and add into the group
         detailBox = renderer.text(sharePrice, 
                                   arcX + 80, arcY - 5)
                             .css({
                                   color: 'white',
                                   fontWeight: 'bold',
                                   fontSize: '15px'
                             }).add(group);
  };

  plotOptions: {
      pie: {
          ....
          point: {
              events: {
                  mouseOver: mouseOver,
                  mouseOut: function(event) {
                      group &amp;&amp; (group = group.destroy());
                  }
          }</pre></div><p>In the mouse over event, we<a id="id381" class="indexterm"/> first extract the triggered data point object from <a id="id382" class="indexterm"/>the <code class="literal">'this'</code> keyword inside the handler according to the Highcharts API documentation. From that, we can propagate down to restore the <code class="literal">renderer</code> object. Then, we create a group object with the renderer call <code class="literal">g( )</code> and then call the object method <code class="literal">add</code> to insert it into the chart. This group handling object enables us later to gather multiple SVG elements into one group for easier handling.</p><p>We then call the arc method to generate a slice with the chart's x and y center location evaluated from the chart plot dimension. We also specify the <code class="literal">innerRadius</code> parameter with a nonzero value (70) to make the arc emerge as a donut chart slice. Then, we chain the call with <code class="literal">css</code> for the same color as the point object and chain the <code class="literal">add</code> method to the group. Then, we create a textbox with stock details inside the new arc; the call is chained in the same manner with <code class="literal">css</code> and <code class="literal">add</code> to the same group.</p><p>For the mouse out event, we can take advantage of the group object. Instead of removing each element individually, we can simply call the <code class="literal">destroy</code> method on the group object. The following screenshot shows the new slice in display:</p><div><img src="img/7451OS_05_15.jpg" alt="Creating shapes with Highcharts' renderer"/></div><p>So we have created a <a id="id383" class="indexterm"/>Highcharts look-alike of the stock picking wheel, and this<a id="id384" class="indexterm"/> proves how versatile Highcharts can be. However, for the sake of simplicity, this exercise omits some complexity, which compromises the finished look. In fact, if we push Highcharts hard enough, we can finish with a chart that looks even closer to the original. The following is such an example, with several color bands and color gradients on each slice:</p><div><img src="img/7451OS_05_16.jpg" alt="Creating shapes with Highcharts' renderer"/></div><p>The online demo can be<a id="id385" class="indexterm"/> found at <a class="ulink" href="http://joekuan.org/demos/ftse_donut">http://joekuan.org/demos/ftse_donut</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec41"/>Summary</h1></div></div></div><p>In this chapter, we have learned how to outline a pie chart and its variant, the donut chart. We also sketched a chart that included all the series types we have learned so far.</p><p>In the next chapter, we will explore the Highcharts APIs that are responsible for making a dynamic chart, such as using AJAX queries to update the chart content, accessing components in Highcharts objects, exporting charts to SVG, and so on.</p></div></body></html>