<html><head></head><body><div><div><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with D3.js</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up a simple D3 development environment</li><li class="listitem" style="list-style-type: disc">Setting up an NPM-based D3 development environment</li><li class="listitem" style="list-style-type: disc">Understanding D3-style functional JavaScript</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec8"/>Introduction</h1></div></div></div><p>This chapter is designed to get you up and running with D3.js and covers fundamental aspects, such as what D3.js is and how to set up a typical D3.js data visualization environment. One particular section is also devoted to covering some lesser known areas of JavaScript that D3.js relies heavily on.</p><p>What is D3? D3 refers to <em>Data-Driven Documents</em>, and according to the official D3 Wiki:</p><div><blockquote class="blockquote"><p>
<em>
<strong>D3</strong> (<strong>Data-Driven Documents</strong> or D3.js) is a JavaScript library for visualizing data using web standards. D3 helps you bring data to life using SVG, Canvas and HTML. D3 combines powerful visualization and interaction techniques with a data-driven approach to DOM manipulation, giving you the full capabilities of modern browsers and the freedom to design the right visual interface for your data.</em>
</p></blockquote></div><div><blockquote class="blockquote"><p>
<em>-D3 Github Wiki (2016, August)</em>
</p></blockquote></div><p>In a sense, D3 is a specialized JavaScript library that allows you to create amazing data visualizations using a simple (data driven) approach by leveraging the existing Web standards. D3.js was created by Mike Bostock (<a class="ulink" href="https://bost.ocks.org/mike/">https://bost.ocks.org/mike/
</a>) and superseded his previous work on a different JavaScript data visualization library called Protovis. For more information on how D3 was created and on the theory that influenced both Protovis and D3.js, please check out the links in the following information box. Here, in this book, we will focus more on how to use D3.js to power your visualization. Initially, some aspects of D3 maybe a bit confusing due to its different approach for data visualization. I hope that over the course of this book, a large number of topics, both basic and advanced, will make you comfortable and effective with D3. Once it is properly understood, D3 can improve your productivity and expressiveness with data visualizations by orders of magnitude.</p><div><div><h3 class="title"><a id="note3"/>Note</h3><p>For a more formal introduction to the idea behind D3, refer to the <em>Declarative Language Design for Interactive Visualization</em> paper published by <em>Mike Bostock</em> on <em>IEEE InfoVis 2010</em> at <a class="ulink" href="http://vis.stanford.edu/papers/protovis-design">http://vis.stanford.edu/papers/protovis-design
</a>.
If you are interested to know how D3 came about, I recommend that you check out the <em>D3: Data-Driven Document</em> paper published by <em>Mike Bostock</em>, <em>Vadim Ogievestsky</em>, and <em>Jeffery Heer</em> on <em>IEEE InfoVis 2011</em> at <a class="ulink" href="http://vis.stanford.edu/papers/d3">http://vis.stanford.edu/papers/d3
</a>.
Protovis, the predecessor of D3.js, also created by <em>Mike Bostock</em> and <em>Jeff Heer</em> of the Stanford Visualization Group can be found at <a class="ulink" href="https://mbostock.github.io/protovis/">https://mbostock.github.io/protovis/
</a>.</p></div></div></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Setting up a simple D3 development environment</h1></div></div></div><p>The first thing you will need when you start a D3-powered data visualization project is a working development environment. In this recipe, we will show you how a simple D3 development environment can be set up within minutes.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Getting ready</h2></div></div></div><p>Before we start, make sure that you have your favorite text editor installed and ready on your computer.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>How to do it...</h2></div></div></div><p>We''ll start by downloading D3.js through the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the latest stable version of D3.js from <a class="ulink" href="https://d3js.org/">https://d3js.org/
</a>. You can download the archived, older releases from <a class="ulink" href="https://github.com/d3/d3/tags">https://github.com/d3/d3/tags
</a>. Additionally, if you are interested in trying out the bleeding edge D3 build on master branch, then you can fork <a class="ulink" href="https://github.com/d3/d3">https://github.com/d3/d3
</a>.</li><li class="listitem">Once it is downloaded and unzipped, you will find two D3 JavaScript files, <code class="literal">d3.js</code> and <code class="literal">d3.min.js</code>, and other informational files in the extracted folder. For development purpose, it is recommended that you use the <code class="literal">d3.js</code> file, the <em>non-uglified</em> (minimized) version, since it can help you trace and debug JavaScript inside the D3 library. Once extracted, place the <code class="literal">d3.js</code> file in the same folder with an <code class="literal">index.html</code> file containing the following HTML:<pre class="programlisting">    &lt;!-- index.html --&gt; 
     &lt;!DOCTYPE html&gt; 
     &lt;html&gt; 
     &lt;head&gt; 
         &lt;meta charset=""utf-8""&gt; 
         &lt;title&gt;Simple D3 Dev Env&lt;/title&gt; 
         &lt;script type=""text/javascript"" src="img/"d3.js""&gt;&lt;/script&gt; 
     &lt;/head&gt; 
     &lt;body&gt; 
 
     &lt;/body&gt; 
     &lt;/html&gt; 
</pre></li></ol></div><p>This is all you need to create, in its simplest form, a D3-powered data visualization development environment. With this setup, you can essentially open the HTML file using your favorite text editor to start your development and also to view your visualization by opening the file in your browser.</p><div><div><h3 class="title"><a id="note4"/>Note</h3><p>The source code for this recipe can be found at <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/simple-dev-env">https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/simple-dev-env
</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How it works...</h2></div></div></div><p>D3 JavaScript library is very self-sufficient. It has no dependency on any other JavaScript library except what your browser already provides.</p><div><div><h3 class="title"><a id="note5"/>Note</h3><p>If your visualization's target browser environment includes Internet Explorer 9, it is recommended that you use the compatibility library <strong>Aight</strong>, which can be found at <a class="ulink" href="https://github.com/shawnbot/aight">https://github.com/shawnbot/aight
</a>, and <strong>Sizzle selector engine</strong>, which can be found at <a class="ulink" href="http://sizzlejs.com/">http://sizzlejs.com/
</a>.</p></div></div><p>Having the following character encoding instruction in the header section was critical before D3 v4 release since the older version of D3 used UTF-8 symbols, such as π, in its source; however, with D3 v4.x, it is no longer necessary. It is still considered a good practice however, since other JavaScript libraries you will include might be using UTF-8 symbols, as shown in the following example:</p><pre class="programlisting">    &lt;meta charset=""utf-8""&gt; 
</pre><div><div><h3 class="title"><a id="note6"/>Note</h3><p>D3 is <em>completely open source</em> under a custom license agreement created by its author Michael Bostock. This license is pretty similar to the popular MIT license, with only one exception where it explicitly states that Michael Bostock's name cannot be used to endorse or promote products derived from this software without his permission.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>There's more...</h2></div></div></div><p>Throughout this cookbook, numerous recipe code examples will be provided. All example source code is provided and hosted on GitHub (<a class="ulink" href="https://github.com/">https://github.com/
</a>), a popular open source social coding repository platform.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec0"/>How to get source code</h3></div></div></div><p>The easiest way to get all the recipe source code that you will need is to clone the Git repository (<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2">https://github.com/NickQiZhu/d3-cookbook-v2
</a>) for this book. If you are not planning to set up a development environment for the recipes, then you can safely skip this section.</p><div><div><h3 class="title"><a id="note7"/>Note</h3><p>In case you are not familiar with Git, its clone concept is similar to the checkout concept in other version control software. However, cloning does a lot more than simply checking out the files. It also copies all branches and histories to your local machine, effectively cloning the entire repository to your local machine so you can work even when you are completely offline with this cloned repository in your own environment.</p></div></div><p>First, install a Git client on your computer. You can find a list of Git client software at <a class="ulink" href="https://git-scm.com/downloads">https://git-scm.com/downloads
</a>, and a detailed guide on how to install it on different operating systems at <a class="ulink" href="https://git-scm.com/book/en/Getting-Started-Installing-Git">https://git-scm.com/book/en/Getting-Started-Installing-Git
</a>.</p><div><div><h3 class="title"><a id="note8"/>Note</h3><p>Another popular way to get Git and GitHub working is to install the GitHub client, which gives you a richer set of features than simply Git. However, at the time of writing this book, GitHub only offered client software for Windows and Mac OS; refer to <a class="ulink" href="https://desktop.github.com/">https://desktop.github.com/
</a>.</p></div></div><p>Once the Git client is installed, simply issuing the following command will download all recipe source code to your computer:</p><pre class="programlisting">
<strong>&gt; git clone git@github.com:NickQiZhu/d3-cookbook-v2.git</strong>
</pre></div></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Setting up an NPM-based development environment</h1></div></div></div><p>The simple setup demonstrated in the previous recipe is enough for implementing most recipes in this book. However, when you work on a more complex data visualization project that requires the use of a number of JavaScript libraries, the simple solution we discussed before might become a bit clumsy and unwieldy. In this section, we will demonstrate an improved setup using <strong>Node Packaged Modules</strong> (<strong>NPM</strong>), a de facto JavaScript library repository management system. If you are as impatient as me and want to get to the meaty part of the book, the recipes, you can safely skip this section and come back when you need to set up a more production-ready environment for your project.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Getting ready</h2></div></div></div><p>Before we start, please make sure that you have NPM properly installed. NPM comes as part of the Node.js installation. You can download Node.js from <a class="ulink" href="https://nodejs.org/">https://nodejs.org/
</a>. Select the correct Node.js binary build for your OS. Once installed, the following <code class="literal">npm</code> command will become available in your terminal console:</p><pre class="programlisting">
<strong>&gt; npm -v </strong>
<strong>2.15.8</strong>
</pre><p>The preceding command prints out the version number of your NPM client to indicate that the installation is successful.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it...</h2></div></div></div><p>With the NPM installed, we can now create a package descriptor file to automate some of the manual setup steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, under your project folder, create a file named <code class="literal">package.json</code> that contains the following code:<pre class="programlisting">     { 
       ""name": "d3-project-template", 
       ""version": "0.1.0", 
       "description": "Ready to go d3 data visualization project template", 
       "keywords": [ 
         "data visualization", 
         "d3" 
       ], 
       "homepage": "&lt;project home page&gt;", 
       "author": { 
         "name": "&lt;your name&gt;", 
         "url": "&lt;your url&gt;" 
       }, 
       "repository": { 
         "type": "git", 
         "url": "&lt;source repo url&gt;" 
       }, 
       "dependencies": { 
           "d3":"4.x" 
       }, 
       "devDependencies": { 
           "uglify-js": "2.x" 
       } 
     } 
</pre></li><li class="listitem">Once the <code class="literal">package.json</code> file is defined, you can simply run the following:<pre class="programlisting">         <strong>&gt; npm install</strong>
</pre></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works...</h2></div></div></div><p>Most of the fields in the <code class="literal">package.json</code> file are for informational purpose only, such as its name, description, home page, author, and the repository. The name and the version fields will be used if you decide to publish your library into an NPM repository in the future. What we really care about, at this point, are the <code class="literal">dependencies</code> and <code class="literal">devDependencies</code> fields:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">dependencies</code> field describes the runtime library dependencies that your project has, that is, the libraries your project will need to run properly in a browser.</li><li class="listitem" style="list-style-type: disc">In this simple example, we only have one dependency on D3. <code class="literal">d3</code> is the name of the D3 library that is published in the NPM repository. The version number <code class="literal">4.x</code> signifies that this project is compatible with any of the version 4 releases, and NPM should retrieve the latest stable version 4 build to satisfy this dependency.</li></ul></div><div><div><h3 class="title"><a id="note9"/>Note</h3><p>D3 is a self-sufficient library with zero external runtime dependency. However, this does not mean that it cannot work with other popular JavaScript libraries. I regularly use D3 with other libraries to make my job easier, for example, JQuery, Zepto.js, Underscore.js, and ReactJs to name a few.</p></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">devDependencies</code> field describes development time (compile time) of library dependencies. What this means is that libraries specified under this category are only required in order to build this project, and not required to run your JavaScript project.</li></ul></div><div><div><h3 class="title"><a id="note10"/>Note</h3><p>Detailed NPM package JSON file documentation can be found at <a class="ulink" href="https://docs.npmjs.com/files/package.json">https://docs.npmjs.com/files/package.json
</a>.</p></div></div><p>Executing the <code class="literal">npm install</code> command will automatically trigger NPM to download all dependencies that your project requires, including your dependencies' dependencies recursively. All dependency libraries will be downloaded into the <code class="literal">node_modules</code> folder under your project's root folder. When this is done, you can just simply create your HTML file as shown in the previous recipe, and load your D3 JavaScript library directly from <code class="literal">node_modules/d3/build/d3.js</code>.</p><p>The source code for this recipe with an automated build script can be found at <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/npm-dev-env">https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/npm-dev-env
</a>.</p><p>Relying on NPM is a simple and yet more effective way to save yourself from all the trouble of downloading JavaScript libraries manually and the constant need for keeping them up to date. However, an astute reader may have already noticed that with this power we can easily push our environment setup to the next level. What if you are building a large visualization project where thousands of lines of JavaScript code will be created? Then obviously, our simple setup described here will no longer be sufficient. However, modular JavaScript development by itself can fill an entire book; therefore, we will not try to cover this topic since our focus is on data visualization and D3. In later chapters, when unit test-related recipes is discussed, we will expand the coverage on this topic to show how our setup can be enhanced to run automated build and unit tests.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>D3 v4.x is very modular; so if you only need a part of the D3 library for your project, you can also selectively include D3 submodule as your dependency. For example, if you only need <code class="literal">d3-selection</code> module in your project, then you can use the following dependency declaration in your <code class="literal">package.json</code> file:
<code class="literal">"dependencies": {</code>
<code class="literal">      "d3-selection":"1.x"</code>
<code class="literal">}</code>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>There's more...</h2></div></div></div><p>Although in previous sections it was mentioned that you can just open the HTML page that you have created using your browser to view your visualization result directly, this approach does have its limitations. This simple approach stops working once we  need to load data from a separate data file (this is what we will do in later chapters, and it is also the most likely case in your daily working environment) due to the browser's built-in security policy. To get around this security constraint, it is highly recommended that you set up a local HTTP server so your HTML page and the data file can be accessed from this server instead of being loaded from a local file system directly.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec1"/>Setting up a local HTTP server</h3></div></div></div><p>There are probably more than a dozen different ways to set up an HTTP server on your computer based on the operating system you use and the software package you decide to use to act as an HTTP server. Here, I will attempt to cover some of the most popular setups.</p><div><div><div><div><h4 class="title"><a id="ch01lvl4sec0"/>Python Simple HTTP server</h4></div></div></div><p>This is my favorite for development and fast prototyping. If you have Python installed on your OS, which is usually the case with any Unix/Linux/Mac OS distribution, then you can simply type the following command in your terminal with Python 2:</p><pre class="programlisting">
<strong>&gt; python -m SimpleHTTPServer 8888</strong>
</pre><p>Alternatively, type the following command with Python 3 distribution:</p><pre class="programlisting">
<strong>&gt; python -m http.server 8888</strong>
</pre><p>This little python program will launch an HTTP server and start serving any file right from the folder where this program is launched. This is by far the easiest way to get an HTTP server running on any OS.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>If you don't have python installed on your computer yet, you can get it from <a class="ulink" href="https://www.python.org/getit/">https://www.python.org/getit/
</a>. It works on all modern OS, including Windows, Linux, and Mac.</p></div></div></div><div><div><div><div><h4 class="title"><a id="ch01lvl4sec1"/>Node.js HTTP server</h4></div></div></div><p>If you have Node.js installed, perhaps as part of the development environment setup exercise we did in the previous section, then you can simply install the <code class="literal">http-server</code> module. Similar to the Python Simple HTTP Server, this module will allow you to launch a lightweight HTTP server from any folder and start serving pages right away.</p><p>First, you need to install the <code class="literal">http-server</code> module using the following command:</p><pre class="programlisting">
<strong>&gt; npm install http-server -g</strong>
</pre><p>The <code class="literal">-g</code> option in this command will install <code class="literal">http-server</code> module globally, so it will become available in your command-line terminal automatically. Once this is done, you can launch the server from any folder you are in by simply issuing the following command:</p><pre class="programlisting">
<strong>&gt; http-server -p 8888</strong>
</pre><p>This command will launch a Node.js-powered HTTP server on the default port <code class="literal">8080</code>, or if you want, you can use the <code class="literal">-p</code> option to provide a custom port number for it.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>If you are running the <code class="literal">npm install</code> command on Linux, Unix, or Mac OS, you may need to run the command in the <code class="literal">sudo</code> mode or as root in order to use the <code class="literal">-g</code> global installation option.</p></div></div></div></div></div></div></div></div>
<div><div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Understanding D3-style JavaScript</h1></div></div></div><p>D3 is designed and built using functional style JavaScript, which might come as a bit unfamiliar or even alien to someone who is more comfortable with the procedural or object-oriented JavaScript styles. This recipe is designed to cover some of the most fundamental concepts in functional JavaScript required to make sense of D3, and furthermore enable you to write your visualization code in the D3 style.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Getting ready</h2></div></div></div><p>Open your local copy of the following file in your web browser: <a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter1/functional-js.html">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter1/functional-js.html
</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How to do it...</h2></div></div></div><p>Let's dig a little deeper into the good part of JavaScript, the more functional side. Take a look at the following code snippet:</p><pre class="programlisting">     function SimpleWidget(spec) { 
       var instance = {}; // &lt;-- A 
      
       var headline, description; // &lt;-- B 
 
       instance.render = function () { 
         var div = d3.select('body').append("div"); 
 
         div.append("h3").text(headline); // &lt;-- C 
      
         div.attr("class", "box") 
         .attr("style", "color:" + spec.color) // &lt;-- D 
           .append("p") 
           .text(description); // &lt;-- E 
 
         return instance; // &lt;-- F 
       }; 
 
       instance.headline = function (h) { 
         if (!arguments.length) return headline; // &lt;-- G 
         headline = h; 
         return instance; // &lt;-- H 
       }; 
                
       instance.description = function (d) { 
         if (!arguments.length) return description; 
         description = d; 
         return instance; 
       }; 
 
       return instance; // &lt;-- I 
     } 
      
       var widget = SimpleWidget({color: "#6495ed"}) 
         .headline("Simple Widget") 
         .description("This is a simple widget demonstrating
           functional      javascript."); 
       widget.render(); 
</pre><p>The preceding code snippet generates the following simple widget on your web page:</p><p>
</p><div><img src="img/image_01_001.jpg" alt="How to do it..."/></div><p>
</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec22"/>How it works...</h2></div></div></div><p>Despite its simplicity, the interface of this widget has this undeniable similarity to the D3 style of JavaScript. This is not by coincidence but rather by leveraging a JavaScript programming paradigm called functional objects. Like many interesting topics, this is another topic that can fill an entire book by itself; nevertheless, I will try to cover the most important and useful aspects of this particular paradigm in this section, so you can not only understand D3's syntax but you'll also be able to create your code in this fashion. As stated on D3's project Wiki, this functional programming style gives D3 much of its flexibility:</p><div><blockquote class="blockquote"><p>
<em>D3's functional style allows code reuse through a diverse collection of components and plugins.
                                                                                                                                                                              -D3 Wiki (2016, August)</em>
</p></blockquote></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec2"/>Functions are objects</h3></div></div></div><p>Functions in JavaScript are objects. Like any other object in JavaScript, function object is just a collection of name and value pair. The only difference between a function object and a regular object is that function can be invoked and additionally associated with the following two hidden properties: function context and function code. This might come as a surprise and seem unnatural, especially if you come from a more procedural programming background. Nevertheless, this is the critical insight most of us need in order to make sense of some of the <em>strange</em> ways that D3 uses functions.</p><div><div><h3 class="title"><a id="note14"/>Note</h3><p>JavaScript in its pre-ES6 form is generally not considered very object oriented; however, function object is probably one aspect where it outshines some of its other more object-oriented cousins.</p></div></div><p>Now, with this insight in mind, let's take a look at the following code snippet again:</p><pre class="programlisting">  var instance = {}; // &lt;-- A 
 
  var headline, description; // &lt;-- B 
 
  instance.render = function () { 
    var div = d3.select('body').append("div"); 
 
    div.append("h3").text(headline); // &lt;-- C 
 
    div.attr("class", "box") 
      .attr("style", "color:" + spec.color) // &lt;-- D 
      .append("p") 
      .text(description); // &lt;-- E 
 
    return instance; // &lt;-- F 
  }; 
</pre><p>At the lines marked as <code class="literal">A</code>, <code class="literal">B</code>, and <code class="literal">C</code>, we can clearly see that <code class="literal">instance</code>, <code class="literal">headline</code>, and <code class="literal">description</code> are all internal private variables belonging to the <code class="literal">SimpleWidget</code> function object. While the <code class="literal">render</code> function is a function associated with the <code class="literal">instance</code> object which itself is defined as an object literal. Since functions are just objects, they can also be stored in an object/function, referred to by variables, contained in an array, and being passed as function arguments. The result of the execution of the <code class="literal">SimpleWidget</code> function is the returning of object instance at line <code class="literal">I</code> as follows:</p><pre class="programlisting">function SimpleWidget(spec) { 
... 
  return instance; // &lt;-- I 
} 
</pre><div><div><h3 class="title"><a id="note15"/>Note</h3><p>The <code class="literal">render</code> function uses some of the D3 functions that we have not covered yet, but let's not pay too much attention to them for now since we will cover each of them in depth in the next couple of chapters. Also, they basically just render the visual representation of this widget and do not have much to do with our topic on hand.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec3"/>Static variable scoping</h3></div></div></div><p>Curious readers will probably be asking by now how the variable scoping is resolved in this example since the render function has seemingly strange access to not only the <code class="literal">instance</code>, <code class="literal">headline</code>, and <code class="literal">description</code> variables but also the <code class="literal">spec</code> variable that is passed into the base <code class="literal">SimpleWidget</code> function. This seemingly strange variable scoping is actually determined by a simple static scoping rule. This rule can be thought as the following: whenever the runtime searches for a variable reference, the search will be first performed locally. When a variable declaration is not found (as in the case of <code class="literal">headline</code> on line <code class="literal">C</code>), the search continues toward the parent object (in this case, the <code class="literal">SimpleWidget</code> function is its static parent and the <code class="literal">headline</code> variable declaration is found at line <code class="literal">B</code>). If still not found, then this process will continue recursively to the next static parent, so on and so forth, till it reaches a global variable definition; if it is still not found, then a reference error will be generated for this variable. This scoping behavior is very different from variable resolution rules in some of the most popular languages, such as Java and C#.</p><p>It might take some time to get used to; however, don't worry too much about it if you still find it confusing. With more practice and by keeping the static scoping, rule in mind, you will be comfortable with this kind of scoping in no time.</p><div><div><h3 class="title"><a id="note16"/>Note</h3><p>One word of caution here, again for folks from Java and C# backgrounds, is that JavaScript does not implement block scoping. The static scoping rule we described only applies to function/object but not at the block level, as shown in the following code:
<code class="literal">for(var i = 0; i &lt; 10; i++){</code>
<code class="literal">  for(var i = 0; i &lt; 2; i++){</code>
<code class="literal">    console.log(i);</code>
<code class="literal">  }</code>
<code class="literal">}</code>
You might be inclined to think this code should produce 20 numbers. However, in JavaScript, this code creates an infinite loop. This is because JavaScript does not implement block scoping, so the variable <code class="literal">i</code> in the inner loop is the same variable <code class="literal">i</code> used by the outer loop. Therefore, it gets reset by the inner loop and can never end the outer loop.</p></div></div><p>This pattern is usually referred as functional when compared with the more popular prototype-based <strong>Pseudo-classical pattern</strong>. The advantage of the functional pattern is that it provides a much better mechanism for information hiding and encapsulation since the private variables, in our case, the <code class="literal">headline</code> and <code class="literal">description</code> variables, are only accessible by nested functions through the static scoping rule; therefore, the object returned by the <code class="literal">SimpleWidget</code> function is flexible yet more tamper-proof and durable.</p><div><blockquote class="blockquote"><p>
<em>If we create an object in the functional style, and if all of the methods of the object make no use of this, then the object is durable. A durable object is simply a collection of functions that act as capabilities.</em>
</p></blockquote></div><div><blockquote class="blockquote"><p>
<em>-Crockfort D. 2008</em>
</p></blockquote></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec4"/>Getter-setter function</h3></div></div></div><p>Let's take a look at the following code; something strange has happened on line <code class="literal">G</code>:</p><pre class="programlisting">instance.headline = function (h) { 
  if (!arguments.length) return headline; // &lt;-- G 
  headline = h; 
  return instance; // &lt;-- H 
}; 
</pre><p>You might be asking where this <code class="literal">arguments</code> variable on line <code class="literal">G</code> came from. It was never defined anywhere in this example. The <code class="literal">arguments</code> variable is a built-in hidden parameter that is available to functions when they are invoked. The <code class="literal">arguments</code> variable contains all arguments for a function invocation in an array.</p><div><div><h3 class="title"><a id="note17"/>Note</h3><p>In fact, <code class="literal">arguments</code> is not really a JavaScript array object. It has <em>length</em> and can be accessed using an index; however, it does not have many of the methods associated with a typical JavaScript array object, such as <code class="literal">slice</code> or <code class="literal">concat</code>. When you need to use a standard JavaScript array method on <code class="literal">arguments</code>, you will need to use the following apply invocation pattern:
<code class="literal">var newArgs = Array.prototype.slice.apply(arguments);</code>
</p></div></div><p>This hidden parameter when combined with the ability to omit function argument in JavaScript allows you to write a function such as <code class="literal">instance.headline</code> with unspecified number of parameters. In this case, we can either have one argument <code class="literal">h</code> or none. Because <code class="literal">arguments.length</code> returns <code class="literal">0</code> when no parameter is passed, the <code class="literal">headline</code> function returns <code class="literal">headline</code> if no parameter is passed, otherwise it turns into a setter if parameter <code class="literal">h</code> is provided. To clarify this explanation, let's take a look at the following code snippet:</p><pre class="programlisting">var widget = SimpleWidget({color: "#6495ed"}) 
    .headline("Simple Widget"); // set headline 
console.log(widget.headline()); // prints "Simple Widget" 
</pre><p>Here, you can see how the headline function can be used as both setter and getter with different parameters.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec5"/>Function chaining</h3></div></div></div><p>The next interesting aspect of this particular example is the capability of chaining functions to each other. This is also the predominant function invocation pattern that the D3 library deploys since most of the D3 functions are designed to be chainable to provide a more concise and contextual programming interface. This is actually quite simple once you understand the variable, parameter function concept. Since a variable-parameter function, such as the <code class="literal">headline</code> function, can serve as setter and getter at the same time, returning the <code class="literal">instance</code> object when it's acting as a setter allows you to immediately invoke another function on the invocation result, hence the chaining.</p><p>Let's take a look at the following code:</p><pre class="programlisting">var widget = SimpleWidget({color: "#6495ed"}) 
  .headline("Simple Widget") 
  .description("This is ...") 
  .render(); 
</pre><p>In this example, the <code class="literal">SimpleWidget</code> function returns the <code class="literal">instance</code> object (as on line <code class="literal">I</code>).</p><pre class="programlisting">function SimpleWidget(spec) { 
... 
    instance.headline = function (h) { 
        if (!arguments.length) return headline; // &lt;-- G 
        headline = h; 
       return instance; // &lt;-- H 
    }; 
... 
    return instance; // &lt;-- I 
} 
</pre><p>Then, the <code class="literal">headline</code> function is invoked as a setter, which also returns the <code class="literal">instance</code> object (as on line <code class="literal">H</code>). The <code class="literal">description</code> function can then be invoked directly on its return, which again returns the <code class="literal">instance</code> object. Finally, the <code class="literal">render</code> function can be called.</p><p>Now, with the knowledge of functional JavaScript and a working ready-to-go D3 data visualization development environment, we are ready to dive into the rich concepts and techniques that D3 has to offer. However, before we take off, I would like to cover a few more important areas, how to find and share code and how to get help when you are stuck.</p></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec23"/>There's more...</h2></div></div></div><p>Let's take a look at some additional helpful resources.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec6"/>Finding and sharing code</h3></div></div></div><p>One of the great things about D3 when compared with other visualization options is that it offers a wealth of examples and tutorials that you can draw your inspiration from. During the course of creating my own open source visualization charting library and the creation of this book, I had relied heavily on these resources. I will list some of the most popular options available in this aspect. This list is by no means a comprehensive directory, but rather a starting place for you to explore:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The D3 gallery (<a class="ulink" href="https://github.com/d3/d3/wiki/Gallery">https://github.com/d3/d3/wiki/Gallery
</a>) contains some of the most interesting examples that you can find online regarding D3 usage. It contains examples on different visualization charts, specific techniques, and some interesting visualization implementations in the wild, among others.</li><li class="listitem" style="list-style-type: disc">Christophe Viau's D3 Gallery (<a class="ulink" href="http://christopheviau.com/d3list/gallery.html">http://christopheviau.com/d3list/gallery.html
</a>) is another D3 gallery with categorization that helps you find your desired visualization example online quickly.</li><li class="listitem" style="list-style-type: disc">The D3 tutorials page (<a class="ulink" href="https://github.com/d3/d3/wiki/Tutorials">https://github.com/d3/d3/wiki/Tutorials
</a>) contains a collection of tutorials, talks, and slides created by various contributors over time that demonstrates in detail how to use different D3 concepts and techniques.</li><li class="listitem" style="list-style-type: disc">D3 plugins can be found at <a class="ulink" href="https://github.com/d3/d3-plugins">https://github.com/d3/d3-plugins
</a>. Maybe some features are missing in D3 for your visualization needs? Before you decide to implement your own, make sure that you check out the D3 plugin repository. It contains a wide variety of plugins that provide some of the common and, sometimes, uncommon features in the visualization world.</li><li class="listitem" style="list-style-type: disc">The D3 API (<a class="ulink" href="https://github.com/d3/d3/blob/master/API.md">https://github.com/d3/d3/blob/master/API.md
</a>) is very well documented. This is where you can find detailed explanations for every function and property that the D3 library has to offer.</li><li class="listitem" style="list-style-type: disc">Mike Bostok's Blocks (<a class="ulink" href="http://bl.ocks.org/mbostock">http://bl.ocks.org/mbostock
</a>) is a D3 example site, where some of the more intriguing visualization examples can be found and is maintained by its author Mike Bostock.</li><li class="listitem" style="list-style-type: disc">JS Bin (<a class="ulink" href="http://jsbin.com/ugacud/1/edit">http://jsbin.com/ugacud/1/edit
</a>) is a prebuilt D3 test and experiment environment completely hosted online. You can easily prototype a simple script using this tool or share your creation with other members in the community.</li><li class="listitem" style="list-style-type: disc">JS Fiddle (<a class="ulink" href="http://jsfiddle.net/qAHC2/">http://jsfiddle.net/qAHC2/
</a>) is similar to JS Bin; it also is a hosted-online JavaScript code prototyping and sharing platform.</li></ul></div><div><div><div><div><h4 class="title"><a id="ch01lvl4sec2"/>How to get help</h4></div></div></div><p>Even with all the examples, tutorial, and cookbook such as this, you might still run into challenges when you create your own visualization. The good news here is that D3 has a broad and active support community. Simply <em>googling</em> your question can most often yield a satisfying answer. Even if it doesn't, don't worry; D3 has a robust community-based support as the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">D3.js on Stack Overflow (<a class="ulink" href="http://stackoverflow.com/questions/tagged/d3.js">http://stackoverflow.com/questions/tagged/d3.js
</a>): Stack Overflow is the most popular community-based free Q&amp;A site for technologists. D3 is a specific category on the Stack Overflow site to help you reach the experts and get an answer to your question quickly.</li><li class="listitem" style="list-style-type: disc">The D3 Google group (<a class="ulink" href="https://groups.google.com/forum/?fromgroups#!forum/d3-js">https://groups.google.com/forum/?fromgroups#!forum/d3-js
</a>): This is the official user group for not just D3 but also other related libraries in its ecosystem.</li></ul></div></div></div></div></div></div></div></body></html>