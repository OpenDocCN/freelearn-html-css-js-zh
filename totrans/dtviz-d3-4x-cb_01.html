<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 1. Getting Started with D3.js"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/><span class="koboSpan" id="kobo.1.1">Chapter 1. Getting Started with D3.js</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Setting up a simple D3 development environment</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Setting up an NPM-based D3 development environment</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Understanding D3-style functional JavaScript</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec8"/><span class="koboSpan" id="kobo.6.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.7.1">This chapter is designed to get you up and running with D3.js and covers fundamental aspects, such as what D3.js is and how to set up a typical D3.js data visualization environment. </span><span class="koboSpan" id="kobo.7.2">One particular section is also devoted to covering some lesser known areas of JavaScript that D3.js relies heavily on.</span></p><p><span class="koboSpan" id="kobo.8.1">What is D3? </span><span class="koboSpan" id="kobo.8.2">D3 refers to </span><span class="emphasis"><em><span class="koboSpan" id="kobo.9.1">Data-Driven Documents</span></em></span><span class="koboSpan" id="kobo.10.1">, and according to the official D3 Wiki:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em>
<span class="strong"><strong><span class="koboSpan" id="kobo.11.1">D3</span></strong></span><span class="koboSpan" id="kobo.12.1"> (</span><span class="strong"><strong><span class="koboSpan" id="kobo.13.1">Data-Driven Documents</span></strong></span><span class="koboSpan" id="kobo.14.1"> or D3.js) is a JavaScript library for visualizing data using web standards. </span><span class="koboSpan" id="kobo.14.2">D3 helps you bring data to life using SVG, Canvas and HTML. </span><span class="koboSpan" id="kobo.14.3">D3 combines powerful visualization and interaction techniques with a data-driven approach to DOM manipulation, giving you the full capabilities of modern browsers and the freedom to design the right visual interface for your data.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.15.1">-D3 Github Wiki (2016, August)</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.16.1">In a sense, D3 is a specialized JavaScript library that allows you to create amazing data visualizations using a simple (data driven) approach by leveraging the existing Web standards. </span><span class="koboSpan" id="kobo.16.2">D3.js was created by Mike Bostock (</span><a class="ulink" href="https://bost.ocks.org/mike/"><span class="koboSpan" id="kobo.17.1">https://bost.ocks.org/mike/
</span></a><span class="koboSpan" id="kobo.18.1">) and superseded his previous work on a different JavaScript data visualization library called Protovis. </span><span class="koboSpan" id="kobo.18.2">For more information on how D3 was created and on the theory that influenced both Protovis and D3.js, please check out the links in the following information box. </span><span class="koboSpan" id="kobo.18.3">Here, in this book, we will focus more on how to use D3.js to power your visualization. </span><span class="koboSpan" id="kobo.18.4">Initially, some aspects of D3 maybe a bit confusing due to its different approach for data visualization. </span><span class="koboSpan" id="kobo.18.5">I hope that over the course of this book, a large number of topics, both basic and advanced, will make you comfortable and effective with D3. </span><span class="koboSpan" id="kobo.18.6">Once it is properly understood, D3 can improve your productivity and expressiveness with data visualizations by orders of magnitude.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note3"/><span class="koboSpan" id="kobo.19.1">Note</span></h3><p><span class="koboSpan" id="kobo.20.1">For a more formal introduction to the idea behind D3, refer to the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.21.1">Declarative Language Design for Interactive Visualization</span></em></span><span class="koboSpan" id="kobo.22.1"> paper published by </span><span class="emphasis"><em><span class="koboSpan" id="kobo.23.1">Mike Bostock</span></em></span><span class="koboSpan" id="kobo.24.1"> on </span><span class="emphasis"><em><span class="koboSpan" id="kobo.25.1">IEEE InfoVis 2010</span></em></span><span class="koboSpan" id="kobo.26.1"> at </span><a class="ulink" href="http://vis.stanford.edu/papers/protovis-design"><span class="koboSpan" id="kobo.27.1">http://vis.stanford.edu/papers/protovis-design
</span></a><span class="koboSpan" id="kobo.28.1">.
</span><span class="koboSpan" id="kobo.28.2">If you are interested to know how D3 came about, I recommend that you check out the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.29.1">D3: Data-Driven Document</span></em></span><span class="koboSpan" id="kobo.30.1"> paper published by </span><span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">Mike Bostock</span></em></span><span class="koboSpan" id="kobo.32.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.33.1">Vadim Ogievestsky</span></em></span><span class="koboSpan" id="kobo.34.1">, and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.35.1">Jeffery Heer</span></em></span><span class="koboSpan" id="kobo.36.1"> on </span><span class="emphasis"><em><span class="koboSpan" id="kobo.37.1">IEEE InfoVis 2011</span></em></span><span class="koboSpan" id="kobo.38.1"> at </span><a class="ulink" href="http://vis.stanford.edu/papers/d3"><span class="koboSpan" id="kobo.39.1">http://vis.stanford.edu/papers/d3
</span></a><span class="koboSpan" id="kobo.40.1">.
</span><span class="koboSpan" id="kobo.40.2">Protovis, the predecessor of D3.js, also created by </span><span class="emphasis"><em><span class="koboSpan" id="kobo.41.1">Mike Bostock</span></em></span><span class="koboSpan" id="kobo.42.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.43.1">Jeff Heer</span></em></span><span class="koboSpan" id="kobo.44.1"> of the Stanford Visualization Group can be found at </span><a class="ulink" href="https://mbostock.github.io/protovis/"><span class="koboSpan" id="kobo.45.1">https://mbostock.github.io/protovis/
</span></a><span class="koboSpan" id="kobo.46.1">.</span></p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Setting up a simple D3 development environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec9"/><span class="koboSpan" id="kobo.1.1">Setting up a simple D3 development environment</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">The first thing you will need when you start a D3-powered data visualization project is a working development environment. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will show you how a simple D3 development environment can be set up within minutes.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Before we start, make sure that you have your favorite text editor installed and ready on your computer.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/><span class="koboSpan" id="kobo.5.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">We''ll start by downloading D3.js through the following steps:</span></p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="koboSpan" id="kobo.7.1">Download the latest stable version of D3.js from </span><a class="ulink" href="https://d3js.org/"><span class="koboSpan" id="kobo.8.1">https://d3js.org/
</span></a><span class="koboSpan" id="kobo.9.1">. </span><span class="koboSpan" id="kobo.9.2">You can download the archived, older releases from </span><a class="ulink" href="https://github.com/d3/d3/tags"><span class="koboSpan" id="kobo.10.1">https://github.com/d3/d3/tags
</span></a><span class="koboSpan" id="kobo.11.1">. </span><span class="koboSpan" id="kobo.11.2">Additionally, if you are interested in trying out the bleeding edge D3 build on master branch, then you can fork </span><a class="ulink" href="https://github.com/d3/d3"><span class="koboSpan" id="kobo.12.1">https://github.com/d3/d3
</span></a><span class="koboSpan" id="kobo.13.1">.</span></li><li class="listitem"><span class="koboSpan" id="kobo.14.1">Once it is downloaded and unzipped, you will find two D3 JavaScript files, </span><code class="literal"><span class="koboSpan" id="kobo.15.1">d3.js</span></code><span class="koboSpan" id="kobo.16.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.17.1">d3.min.js</span></code><span class="koboSpan" id="kobo.18.1">, and other informational files in the extracted folder. </span><span class="koboSpan" id="kobo.18.2">For development purpose, it is recommended that you use the </span><code class="literal"><span class="koboSpan" id="kobo.19.1">d3.js</span></code><span class="koboSpan" id="kobo.20.1"> file, the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.21.1">non-uglified</span></em></span><span class="koboSpan" id="kobo.22.1"> (minimized) version, since it can help you trace and debug JavaScript inside the D3 library. </span><span class="koboSpan" id="kobo.22.2">Once extracted, place the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">d3.js</span></code><span class="koboSpan" id="kobo.24.1"> file in the same folder with an </span><code class="literal"><span class="koboSpan" id="kobo.25.1">index.html</span></code><span class="koboSpan" id="kobo.26.1"> file containing the following HTML:</span><pre class="programlisting"><span class="koboSpan" id="kobo.27.1">    &lt;!-- index.html --&gt; 
     &lt;!DOCTYPE html&gt; 
     &lt;html&gt; 
     &lt;head&gt; 
         &lt;meta charset=""utf-8""&gt; 
         &lt;title&gt;Simple D3 Dev Env&lt;/title&gt; 
         &lt;script type=""text/javascript"" src=""d3.js""&gt;&lt;/script&gt; 
     &lt;/head&gt; 
     &lt;body&gt; 
 
     &lt;/body&gt; 
     &lt;/html&gt; 
</span></pre></li></ol></div><p><span class="koboSpan" id="kobo.28.1">This is all you need to create, in its simplest form, a D3-powered data visualization development environment. </span><span class="koboSpan" id="kobo.28.2">With this setup, you can essentially open the HTML file using your favorite text editor to start your development and also to view your visualization by opening the file in your browser.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note4"/><span class="koboSpan" id="kobo.29.1">Note</span></h3><p><span class="koboSpan" id="kobo.30.1">The source code for this recipe can be found at </span><a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/simple-dev-env"><span class="koboSpan" id="kobo.31.1">https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/simple-dev-env
</span></a><span class="koboSpan" id="kobo.32.1">.</span></p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/><span class="koboSpan" id="kobo.33.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.34.1">D3 JavaScript library is very self-sufficient. </span><span class="koboSpan" id="kobo.34.2">It has no dependency on any other JavaScript library except what your browser already provides.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note5"/><span class="koboSpan" id="kobo.35.1">Note</span></h3><p><span class="koboSpan" id="kobo.36.1">If your visualization's target browser environment includes Internet Explorer 9, it is recommended that you use the compatibility library </span><span class="strong"><strong><span class="koboSpan" id="kobo.37.1">Aight</span></strong></span><span class="koboSpan" id="kobo.38.1">, which can be found at </span><a class="ulink" href="https://github.com/shawnbot/aight"><span class="koboSpan" id="kobo.39.1">https://github.com/shawnbot/aight
</span></a><span class="koboSpan" id="kobo.40.1">, and </span><span class="strong"><strong><span class="koboSpan" id="kobo.41.1">Sizzle selector engine</span></strong></span><span class="koboSpan" id="kobo.42.1">, which can be found at </span><a class="ulink" href="http://sizzlejs.com/"><span class="koboSpan" id="kobo.43.1">http://sizzlejs.com/
</span></a><span class="koboSpan" id="kobo.44.1">.</span></p></div></div><p><span class="koboSpan" id="kobo.45.1">Having the following character encoding instruction in the header section was critical before D3 v4 release since the older version of D3 used UTF-8 symbols, such as π, in its source; however, with D3 v4.x, it is no longer necessary. </span><span class="koboSpan" id="kobo.45.2">It is still considered a good practice however, since other JavaScript libraries you will include might be using UTF-8 symbols, as shown in the following example:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.46.1">    &lt;meta charset=""utf-8""&gt; 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note6"/><span class="koboSpan" id="kobo.47.1">Note</span></h3><p><span class="koboSpan" id="kobo.48.1">D3 is </span><span class="emphasis"><em><span class="koboSpan" id="kobo.49.1">completely open source</span></em></span><span class="koboSpan" id="kobo.50.1"> under a custom license agreement created by its author Michael Bostock. </span><span class="koboSpan" id="kobo.50.2">This license is pretty similar to the popular MIT license, with only one exception where it explicitly states that Michael Bostock's name cannot be used to endorse or promote products derived from this software without his permission.</span></p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/><span class="koboSpan" id="kobo.51.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.52.1">Throughout this cookbook, numerous recipe code examples will be provided. </span><span class="koboSpan" id="kobo.52.2">All example source code is provided and hosted on GitHub (</span><a class="ulink" href="https://github.com/"><span class="koboSpan" id="kobo.53.1">https://github.com/
</span></a><span class="koboSpan" id="kobo.54.1">), a popular open source social coding repository platform.</span></p><div class="section" title="How to get source code"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec0"/><span class="koboSpan" id="kobo.55.1">How to get source code</span></h3></div></div></div><p><span class="koboSpan" id="kobo.56.1">The easiest way to get all the recipe source code that you will need is to clone the Git repository (</span><a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2"><span class="koboSpan" id="kobo.57.1">https://github.com/NickQiZhu/d3-cookbook-v2
</span></a><span class="koboSpan" id="kobo.58.1">) for this book. </span><span class="koboSpan" id="kobo.58.2">If you are not planning to set up a development environment for the recipes, then you can safely skip this section.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note7"/><span class="koboSpan" id="kobo.59.1">Note</span></h3><p><span class="koboSpan" id="kobo.60.1">In case you are not familiar with Git, its clone concept is similar to the checkout concept in other version control software. </span><span class="koboSpan" id="kobo.60.2">However, cloning does a lot more than simply checking out the files. </span><span class="koboSpan" id="kobo.60.3">It also copies all branches and histories to your local machine, effectively cloning the entire repository to your local machine so you can work even when you are completely offline with this cloned repository in your own environment.</span></p></div></div><p><span class="koboSpan" id="kobo.61.1">First, install a Git client on your computer. </span><span class="koboSpan" id="kobo.61.2">You can find a list of Git client software at </span><a class="ulink" href="https://git-scm.com/downloads"><span class="koboSpan" id="kobo.62.1">https://git-scm.com/downloads
</span></a><span class="koboSpan" id="kobo.63.1">, and a detailed guide on how to install it on different operating systems at </span><a class="ulink" href="https://git-scm.com/book/en/Getting-Started-Installing-Git"><span class="koboSpan" id="kobo.64.1">https://git-scm.com/book/en/Getting-Started-Installing-Git
</span></a><span class="koboSpan" id="kobo.65.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note8"/><span class="koboSpan" id="kobo.66.1">Note</span></h3><p><span class="koboSpan" id="kobo.67.1">Another popular way to get Git and GitHub working is to install the GitHub client, which gives you a richer set of features than simply Git. </span><span class="koboSpan" id="kobo.67.2">However, at the time of writing this book, GitHub only offered client software for Windows and Mac OS; refer to </span><a class="ulink" href="https://desktop.github.com/"><span class="koboSpan" id="kobo.68.1">https://desktop.github.com/
</span></a><span class="koboSpan" id="kobo.69.1">.</span></p></div></div><p><span class="koboSpan" id="kobo.70.1">Once the Git client is installed, simply issuing the following command will download all recipe source code to your computer:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.71.1">&gt; git clone git@github.com:NickQiZhu/d3-cookbook-v2.git</span></strong></span>
</pre></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Setting up an NPM-based development environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/><span class="koboSpan" id="kobo.1.1">Setting up an NPM-based development environment</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">The simple setup demonstrated in the previous recipe is enough for implementing most recipes in this book. </span><span class="koboSpan" id="kobo.2.2">However, when you work on a more complex data visualization project that requires the use of a number of JavaScript libraries, the simple solution we discussed before might become a bit clumsy and unwieldy. </span><span class="koboSpan" id="kobo.2.3">In this section, we will demonstrate an improved setup using </span><span class="strong"><strong><span class="koboSpan" id="kobo.3.1">Node Packaged Modules</span></strong></span><span class="koboSpan" id="kobo.4.1"> (</span><span class="strong"><strong><span class="koboSpan" id="kobo.5.1">NPM</span></strong></span><span class="koboSpan" id="kobo.6.1">), a de facto JavaScript library repository management system. </span><span class="koboSpan" id="kobo.6.2">If you are as impatient as me and want to get to the meaty part of the book, the recipes, you can safely skip this section and come back when you need to set up a more production-ready environment for your project.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Before we start, please make sure that you have NPM properly installed. </span><span class="koboSpan" id="kobo.8.2">NPM comes as part of the Node.js installation. </span><span class="koboSpan" id="kobo.8.3">You can download Node.js from </span><a class="ulink" href="https://nodejs.org/"><span class="koboSpan" id="kobo.9.1">https://nodejs.org/
</span></a><span class="koboSpan" id="kobo.10.1">. </span><span class="koboSpan" id="kobo.10.2">Select the correct Node.js binary build for your OS. </span><span class="koboSpan" id="kobo.10.3">Once installed, the following </span><code class="literal"><span class="koboSpan" id="kobo.11.1">npm</span></code><span class="koboSpan" id="kobo.12.1"> command will become available in your terminal console:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.13.1">&gt; npm -v </span></strong></span>
<span class="strong"><strong><span class="koboSpan" id="kobo.14.1">2.15.8</span></strong></span>
</pre><p><span class="koboSpan" id="kobo.15.1">The preceding command prints out the version number of your NPM client to indicate that the installation is successful.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/><span class="koboSpan" id="kobo.16.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">With the NPM installed, we can now create a package descriptor file to automate some of the manual setup steps:</span></p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="koboSpan" id="kobo.18.1">First, under your project folder, create a file named </span><code class="literal"><span class="koboSpan" id="kobo.19.1">package.json</span></code><span class="koboSpan" id="kobo.20.1"> that contains the following code:</span><pre class="programlisting"><span class="koboSpan" id="kobo.21.1">     { 
       ""name": "d3-project-template", 
       ""version": "0.1.0", 
       "description": "Ready to go d3 data visualization project template", 
       "keywords": [ 
         "data visualization", 
         "d3" 
       ], 
       "homepage": "&lt;project home page&gt;", 
       "author": { 
         "name": "&lt;your name&gt;", 
         "url": "&lt;your url&gt;" 
       }, 
       "repository": { 
         "type": "git", 
         "url": "&lt;source repo url&gt;" 
       }, 
       "dependencies": { 
           "d3":"4.x" 
       }, 
       "devDependencies": { 
           "uglify-js": "2.x" 
       } 
     } 
</span></pre></li><li class="listitem"><span class="koboSpan" id="kobo.22.1">Once the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">package.json</span></code><span class="koboSpan" id="kobo.24.1"> file is defined, you can simply run the following:</span><pre class="programlisting"><span class="koboSpan" id="kobo.25.1">         </span><span class="strong"><strong><span class="koboSpan" id="kobo.26.1">&gt; npm install</span></strong></span>
</pre></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/><span class="koboSpan" id="kobo.27.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.28.1">Most of the fields in the </span><code class="literal"><span class="koboSpan" id="kobo.29.1">package.json</span></code><span class="koboSpan" id="kobo.30.1"> file are for informational purpose only, such as its name, description, home page, author, and the repository. </span><span class="koboSpan" id="kobo.30.2">The name and the version fields will be used if you decide to publish your library into an NPM repository in the future. </span><span class="koboSpan" id="kobo.30.3">What we really care about, at this point, are the </span><code class="literal"><span class="koboSpan" id="kobo.31.1">dependencies</span></code><span class="koboSpan" id="kobo.32.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.33.1">devDependencies</span></code><span class="koboSpan" id="kobo.34.1"> fields:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.35.1">The </span><code class="literal"><span class="koboSpan" id="kobo.36.1">dependencies</span></code><span class="koboSpan" id="kobo.37.1"> field describes the runtime library dependencies that your project has, that is, the libraries your project will need to run properly in a browser.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.38.1">In this simple example, we only have one dependency on D3. </span><code class="literal"><span class="koboSpan" id="kobo.39.1">d3</span></code><span class="koboSpan" id="kobo.40.1"> is the name of the D3 library that is published in the NPM repository. </span><span class="koboSpan" id="kobo.40.2">The version number </span><code class="literal"><span class="koboSpan" id="kobo.41.1">4.x</span></code><span class="koboSpan" id="kobo.42.1"> signifies that this project is compatible with any of the version 4 releases, and NPM should retrieve the latest stable version 4 build to satisfy this dependency.</span></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note9"/><span class="koboSpan" id="kobo.43.1">Note</span></h3><p><span class="koboSpan" id="kobo.44.1">D3 is a self-sufficient library with zero external runtime dependency. </span><span class="koboSpan" id="kobo.44.2">However, this does not mean that it cannot work with other popular JavaScript libraries. </span><span class="koboSpan" id="kobo.44.3">I regularly use D3 with other libraries to make my job easier, for example, JQuery, Zepto.js, Underscore.js, and ReactJs to name a few.</span></p></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.45.1">The </span><code class="literal"><span class="koboSpan" id="kobo.46.1">devDependencies</span></code><span class="koboSpan" id="kobo.47.1"> field describes development time (compile time) of library dependencies. </span><span class="koboSpan" id="kobo.47.2">What this means is that libraries specified under this category are only required in order to build this project, and not required to run your JavaScript project.</span></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/><span class="koboSpan" id="kobo.48.1">Note</span></h3><p><span class="koboSpan" id="kobo.49.1">Detailed NPM package JSON file documentation can be found at </span><a class="ulink" href="https://docs.npmjs.com/files/package.json"><span class="koboSpan" id="kobo.50.1">https://docs.npmjs.com/files/package.json
</span></a><span class="koboSpan" id="kobo.51.1">.</span></p></div></div><p><span class="koboSpan" id="kobo.52.1">Executing the </span><code class="literal"><span class="koboSpan" id="kobo.53.1">npm install</span></code><span class="koboSpan" id="kobo.54.1"> command will automatically trigger NPM to download all dependencies that your project requires, including your dependencies' dependencies recursively. </span><span class="koboSpan" id="kobo.54.2">All dependency libraries will be downloaded into the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">node_modules</span></code><span class="koboSpan" id="kobo.56.1"> folder under your project's root folder. </span><span class="koboSpan" id="kobo.56.2">When this is done, you can just simply create your HTML file as shown in the previous recipe, and load your D3 JavaScript library directly from </span><code class="literal"><span class="koboSpan" id="kobo.57.1">node_modules/d3/build/d3.js</span></code><span class="koboSpan" id="kobo.58.1">.</span></p><p><span class="koboSpan" id="kobo.59.1">The source code for this recipe with an automated build script can be found at </span><a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/npm-dev-env"><span class="koboSpan" id="kobo.60.1">https://github.com/NickQiZhu/d3-cookbook-v2/tree/master/src/chapter1/npm-dev-env
</span></a><span class="koboSpan" id="kobo.61.1">.</span></p><p><span class="koboSpan" id="kobo.62.1">Relying on NPM is a simple and yet more effective way to save yourself from all the trouble of downloading JavaScript libraries manually and the constant need for keeping them up to date. </span><span class="koboSpan" id="kobo.62.2">However, an astute reader may have already noticed that with this power we can easily push our environment setup to the next level. </span><span class="koboSpan" id="kobo.62.3">What if you are building a large visualization project where thousands of lines of JavaScript code will be created? Then obviously, our simple setup described here will no longer be sufficient. </span><span class="koboSpan" id="kobo.62.4">However, modular JavaScript development by itself can fill an entire book; therefore, we will not try to cover this topic since our focus is on data visualization and D3. </span><span class="koboSpan" id="kobo.62.5">In later chapters, when unit test-related recipes is discussed, we will expand the coverage on this topic to show how our setup can be enhanced to run automated build and unit tests.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip11"/><span class="koboSpan" id="kobo.63.1">Tip</span></h3><p><span class="koboSpan" id="kobo.64.1">D3 v4.x is very modular; so if you only need a part of the D3 library for your project, you can also selectively include D3 submodule as your dependency. </span><span class="koboSpan" id="kobo.64.2">For example, if you only need </span><code class="literal"><span class="koboSpan" id="kobo.65.1">d3-selection</span></code><span class="koboSpan" id="kobo.66.1"> module in your project, then you can use the following dependency declaration in your </span><code class="literal"><span class="koboSpan" id="kobo.67.1">package.json</span></code><span class="koboSpan" id="kobo.68.1"> file:
</span><code class="literal"><span class="koboSpan" id="kobo.69.1">"dependencies": {</span></code>
<code class="literal"><span class="koboSpan" id="kobo.70.1">      "d3-selection":"1.x"</span></code>
<code class="literal"><span class="koboSpan" id="kobo.71.1">}</span></code>
</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/><span class="koboSpan" id="kobo.72.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.73.1">Although in previous sections it was mentioned that you can just open the HTML page that you have created using your browser to view your visualization result directly, this approach does have its limitations. </span><span class="koboSpan" id="kobo.73.2">This simple approach stops working once we  need to load data from a separate data file (this is what we will do in later chapters, and it is also the most likely case in your daily working environment) due to the browser's built-in security policy. </span><span class="koboSpan" id="kobo.73.3">To get around this security constraint, it is highly recommended that you set up a local HTTP server so your HTML page and the data file can be accessed from this server instead of being loaded from a local file system directly.</span></p><div class="section" title="Setting up a local HTTP server"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec1"/><span class="koboSpan" id="kobo.74.1">Setting up a local HTTP server</span></h3></div></div></div><p><span class="koboSpan" id="kobo.75.1">There are probably more than a dozen different ways to set up an HTTP server on your computer based on the operating system you use and the software package you decide to use to act as an HTTP server. </span><span class="koboSpan" id="kobo.75.2">Here, I will attempt to cover some of the most popular setups.</span></p><div class="section" title="Python Simple HTTP server"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec0"/><span class="koboSpan" id="kobo.76.1">Python Simple HTTP server</span></h4></div></div></div><p><span class="koboSpan" id="kobo.77.1">This is my favorite for development and fast prototyping. </span><span class="koboSpan" id="kobo.77.2">If you have Python installed on your OS, which is usually the case with any Unix/Linux/Mac OS distribution, then you can simply type the following command in your terminal with Python 2:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.78.1">&gt; python -m SimpleHTTPServer 8888</span></strong></span>
</pre><p><span class="koboSpan" id="kobo.79.1">Alternatively, type the following command with Python 3 distribution:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.80.1">&gt; python -m http.server 8888</span></strong></span>
</pre><p><span class="koboSpan" id="kobo.81.1">This little python program will launch an HTTP server and start serving any file right from the folder where this program is launched. </span><span class="koboSpan" id="kobo.81.2">This is by far the easiest way to get an HTTP server running on any OS.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/><span class="koboSpan" id="kobo.82.1">Note</span></h3><p><span class="koboSpan" id="kobo.83.1">If you don't have python installed on your computer yet, you can get it from </span><a class="ulink" href="https://www.python.org/getit/"><span class="koboSpan" id="kobo.84.1">https://www.python.org/getit/
</span></a><span class="koboSpan" id="kobo.85.1">. </span><span class="koboSpan" id="kobo.85.2">It works on all modern OS, including Windows, Linux, and Mac.</span></p></div></div></div><div class="section" title="Node.js HTTP server"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec1"/><span class="koboSpan" id="kobo.86.1">Node.js HTTP server</span></h4></div></div></div><p><span class="koboSpan" id="kobo.87.1">If you have Node.js installed, perhaps as part of the development environment setup exercise we did in the previous section, then you can simply install the </span><code class="literal"><span class="koboSpan" id="kobo.88.1">http-server</span></code><span class="koboSpan" id="kobo.89.1"> module. </span><span class="koboSpan" id="kobo.89.2">Similar to the Python Simple HTTP Server, this module will allow you to launch a lightweight HTTP server from any folder and start serving pages right away.</span></p><p><span class="koboSpan" id="kobo.90.1">First, you need to install the </span><code class="literal"><span class="koboSpan" id="kobo.91.1">http-server</span></code><span class="koboSpan" id="kobo.92.1"> module using the following command:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.93.1">&gt; npm install http-server -g</span></strong></span>
</pre><p><span class="koboSpan" id="kobo.94.1">The </span><code class="literal"><span class="koboSpan" id="kobo.95.1">-g</span></code><span class="koboSpan" id="kobo.96.1"> option in this command will install </span><code class="literal"><span class="koboSpan" id="kobo.97.1">http-server</span></code><span class="koboSpan" id="kobo.98.1"> module globally, so it will become available in your command-line terminal automatically. </span><span class="koboSpan" id="kobo.98.2">Once this is done, you can launch the server from any folder you are in by simply issuing the following command:</span></p><pre class="programlisting">
<span class="strong"><strong><span class="koboSpan" id="kobo.99.1">&gt; http-server -p 8888</span></strong></span>
</pre><p><span class="koboSpan" id="kobo.100.1">This command will launch a Node.js-powered HTTP server on the default port </span><code class="literal"><span class="koboSpan" id="kobo.101.1">8080</span></code><span class="koboSpan" id="kobo.102.1">, or if you want, you can use the </span><code class="literal"><span class="koboSpan" id="kobo.103.1">-p</span></code><span class="koboSpan" id="kobo.104.1"> option to provide a custom port number for it.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/><span class="koboSpan" id="kobo.105.1">Note</span></h3><p><span class="koboSpan" id="kobo.106.1">If you are running the </span><code class="literal"><span class="koboSpan" id="kobo.107.1">npm install</span></code><span class="koboSpan" id="kobo.108.1"> command on Linux, Unix, or Mac OS, you may need to run the command in the </span><code class="literal"><span class="koboSpan" id="kobo.109.1">sudo</span></code><span class="koboSpan" id="kobo.110.1"> mode or as root in order to use the </span><code class="literal"><span class="koboSpan" id="kobo.111.1">-g</span></code><span class="koboSpan" id="kobo.112.1"> global installation option.</span></p></div></div></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Understanding D3-style JavaScript"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/><span class="koboSpan" id="kobo.1.1">Understanding D3-style JavaScript</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">D3 is designed and built using functional style JavaScript, which might come as a bit unfamiliar or even alien to someone who is more comfortable with the procedural or object-oriented JavaScript styles. </span><span class="koboSpan" id="kobo.2.2">This recipe is designed to cover some of the most fundamental concepts in functional JavaScript required to make sense of D3, and furthermore enable you to write your visualization code in the D3 style.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser: </span><a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter1/functional-js.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter1/functional-js.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Let's dig a little deeper into the good part of JavaScript, the more functional side. </span><span class="koboSpan" id="kobo.8.2">Take a look at the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.9.1">     function SimpleWidget(spec) { 
       var instance = {}; // &lt;-- A 
      
       var headline, description; // &lt;-- B 
 
       instance.render = function () { 
         var div = d3.select('body').append("div"); 
 
         div.append("h3").text(headline); // &lt;-- C 
      
         div.attr("class", "box") 
         .attr("style", "color:" + spec.color) // &lt;-- D 
           .append("p") 
           .text(description); // &lt;-- E 
 
         return instance; // &lt;-- F 
       }; 
 
       instance.headline = function (h) { 
         if (!arguments.length) return headline; // &lt;-- G 
         headline = h; 
         return instance; // &lt;-- H 
       }; 
                
       instance.description = function (d) { 
         if (!arguments.length) return description; 
         description = d; 
         return instance; 
       }; 
 
       return instance; // &lt;-- I 
     } 
      
       var widget = SimpleWidget({color: "#6495ed"}) 
         .headline("Simple Widget") 
         .description("This is a simple widget demonstrating
           functional      javascript."); 
       widget.render(); 
</span></pre><p><span class="koboSpan" id="kobo.10.1">The preceding code snippet generates the following simple widget on your web page:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.11.1"><img src="graphics/image_01_001.jpg" alt="How to do it..."/></span></div><p>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">Despite its simplicity, the interface of this widget has this undeniable similarity to the D3 style of JavaScript. </span><span class="koboSpan" id="kobo.13.2">This is not by coincidence but rather by leveraging a JavaScript programming paradigm called functional objects. </span><span class="koboSpan" id="kobo.13.3">Like many interesting topics, this is another topic that can fill an entire book by itself; nevertheless, I will try to cover the most important and useful aspects of this particular paradigm in this section, so you can not only understand D3's syntax but you'll also be able to create your code in this fashion. </span><span class="koboSpan" id="kobo.13.4">As stated on D3's project Wiki, this functional programming style gives D3 much of its flexibility:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.14.1">D3's functional style allows code reuse through a diverse collection of components and plugins.
</span><span class="koboSpan" id="kobo.14.2">                                                                                                                                                                              -D3 Wiki (2016, August)</span></em></span>
</p></blockquote></div><div class="section" title="Functions are objects"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec2"/><span class="koboSpan" id="kobo.15.1">Functions are objects</span></h3></div></div></div><p><span class="koboSpan" id="kobo.16.1">Functions in JavaScript are objects. </span><span class="koboSpan" id="kobo.16.2">Like any other object in JavaScript, function object is just a collection of name and value pair. </span><span class="koboSpan" id="kobo.16.3">The only difference between a function object and a regular object is that function can be invoked and additionally associated with the following two hidden properties: function context and function code. </span><span class="koboSpan" id="kobo.16.4">This might come as a surprise and seem unnatural, especially if you come from a more procedural programming background. </span><span class="koboSpan" id="kobo.16.5">Nevertheless, this is the critical insight most of us need in order to make sense of some of the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.17.1">strange</span></em></span><span class="koboSpan" id="kobo.18.1"> ways that D3 uses functions.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/><span class="koboSpan" id="kobo.19.1">Note</span></h3><p><span class="koboSpan" id="kobo.20.1">JavaScript in its pre-ES6 form is generally not considered very object oriented; however, function object is probably one aspect where it outshines some of its other more object-oriented cousins.</span></p></div></div><p><span class="koboSpan" id="kobo.21.1">Now, with this insight in mind, let's take a look at the following code snippet again:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.22.1">  var instance = {}; // &lt;-- A 
 
  var headline, description; // &lt;-- B 
 
  instance.render = function () { 
    var div = d3.select('body').append("div"); 
 
    div.append("h3").text(headline); // &lt;-- C 
 
    div.attr("class", "box") 
      .attr("style", "color:" + spec.color) // &lt;-- D 
      .append("p") 
      .text(description); // &lt;-- E 
 
    return instance; // &lt;-- F 
  }; 
</span></pre><p><span class="koboSpan" id="kobo.23.1">At the lines marked as </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1">, </span><code class="literal"><span class="koboSpan" id="kobo.26.1">B</span></code><span class="koboSpan" id="kobo.27.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.28.1">C</span></code><span class="koboSpan" id="kobo.29.1">, we can clearly see that </span><code class="literal"><span class="koboSpan" id="kobo.30.1">instance</span></code><span class="koboSpan" id="kobo.31.1">, </span><code class="literal"><span class="koboSpan" id="kobo.32.1">headline</span></code><span class="koboSpan" id="kobo.33.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.34.1">description</span></code><span class="koboSpan" id="kobo.35.1"> are all internal private variables belonging to the </span><code class="literal"><span class="koboSpan" id="kobo.36.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.37.1"> function object. </span><span class="koboSpan" id="kobo.37.2">While the </span><code class="literal"><span class="koboSpan" id="kobo.38.1">render</span></code><span class="koboSpan" id="kobo.39.1"> function is a function associated with the </span><code class="literal"><span class="koboSpan" id="kobo.40.1">instance</span></code><span class="koboSpan" id="kobo.41.1"> object which itself is defined as an object literal. </span><span class="koboSpan" id="kobo.41.2">Since functions are just objects, they can also be stored in an object/function, referred to by variables, contained in an array, and being passed as function arguments. </span><span class="koboSpan" id="kobo.41.3">The result of the execution of the </span><code class="literal"><span class="koboSpan" id="kobo.42.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.43.1"> function is the returning of object instance at line </span><code class="literal"><span class="koboSpan" id="kobo.44.1">I</span></code><span class="koboSpan" id="kobo.45.1"> as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.46.1">function SimpleWidget(spec) { 
... 
  </span><span class="koboSpan" id="kobo.46.2">return instance; // &lt;-- I 
} 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/><span class="koboSpan" id="kobo.47.1">Note</span></h3><p><span class="koboSpan" id="kobo.48.1">The </span><code class="literal"><span class="koboSpan" id="kobo.49.1">render</span></code><span class="koboSpan" id="kobo.50.1"> function uses some of the D3 functions that we have not covered yet, but let's not pay too much attention to them for now since we will cover each of them in depth in the next couple of chapters. </span><span class="koboSpan" id="kobo.50.2">Also, they basically just render the visual representation of this widget and do not have much to do with our topic on hand.</span></p></div></div></div><div class="section" title="Static variable scoping"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec3"/><span class="koboSpan" id="kobo.51.1">Static variable scoping</span></h3></div></div></div><p><span class="koboSpan" id="kobo.52.1">Curious readers will probably be asking by now how the variable scoping is resolved in this example since the render function has seemingly strange access to not only the </span><code class="literal"><span class="koboSpan" id="kobo.53.1">instance</span></code><span class="koboSpan" id="kobo.54.1">, </span><code class="literal"><span class="koboSpan" id="kobo.55.1">headline</span></code><span class="koboSpan" id="kobo.56.1">, and </span><code class="literal"><span class="koboSpan" id="kobo.57.1">description</span></code><span class="koboSpan" id="kobo.58.1"> variables but also the </span><code class="literal"><span class="koboSpan" id="kobo.59.1">spec</span></code><span class="koboSpan" id="kobo.60.1"> variable that is passed into the base </span><code class="literal"><span class="koboSpan" id="kobo.61.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.62.1"> function. </span><span class="koboSpan" id="kobo.62.2">This seemingly strange variable scoping is actually determined by a simple static scoping rule. </span><span class="koboSpan" id="kobo.62.3">This rule can be thought as the following: whenever the runtime searches for a variable reference, the search will be first performed locally. </span><span class="koboSpan" id="kobo.62.4">When a variable declaration is not found (as in the case of </span><code class="literal"><span class="koboSpan" id="kobo.63.1">headline</span></code><span class="koboSpan" id="kobo.64.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.65.1">C</span></code><span class="koboSpan" id="kobo.66.1">), the search continues toward the parent object (in this case, the </span><code class="literal"><span class="koboSpan" id="kobo.67.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.68.1"> function is its static parent and the </span><code class="literal"><span class="koboSpan" id="kobo.69.1">headline</span></code><span class="koboSpan" id="kobo.70.1"> variable declaration is found at line </span><code class="literal"><span class="koboSpan" id="kobo.71.1">B</span></code><span class="koboSpan" id="kobo.72.1">). </span><span class="koboSpan" id="kobo.72.2">If still not found, then this process will continue recursively to the next static parent, so on and so forth, till it reaches a global variable definition; if it is still not found, then a reference error will be generated for this variable. </span><span class="koboSpan" id="kobo.72.3">This scoping behavior is very different from variable resolution rules in some of the most popular languages, such as Java and C#.</span></p><p><span class="koboSpan" id="kobo.73.1">It might take some time to get used to; however, don't worry too much about it if you still find it confusing. </span><span class="koboSpan" id="kobo.73.2">With more practice and by keeping the static scoping, rule in mind, you will be comfortable with this kind of scoping in no time.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/><span class="koboSpan" id="kobo.74.1">Note</span></h3><p><span class="koboSpan" id="kobo.75.1">One word of caution here, again for folks from Java and C# backgrounds, is that JavaScript does not implement block scoping. </span><span class="koboSpan" id="kobo.75.2">The static scoping rule we described only applies to function/object but not at the block level, as shown in the following code:
</span><code class="literal"><span class="koboSpan" id="kobo.76.1">for(var i = 0; i &lt; 10; i++){</span></code>
<code class="literal"><span class="koboSpan" id="kobo.77.1">  for(var i = 0; i &lt; 2; i++){</span></code>
<code class="literal"><span class="koboSpan" id="kobo.78.1">    console.log(i);</span></code>
<code class="literal"><span class="koboSpan" id="kobo.79.1">  }</span></code>
<code class="literal"><span class="koboSpan" id="kobo.80.1">}</span></code><span class="koboSpan" id="kobo.81.1">
You might be inclined to think this code should produce 20 numbers. </span><span class="koboSpan" id="kobo.81.2">However, in JavaScript, this code creates an infinite loop. </span><span class="koboSpan" id="kobo.81.3">This is because JavaScript does not implement block scoping, so the variable </span><code class="literal"><span class="koboSpan" id="kobo.82.1">i</span></code><span class="koboSpan" id="kobo.83.1"> in the inner loop is the same variable </span><code class="literal"><span class="koboSpan" id="kobo.84.1">i</span></code><span class="koboSpan" id="kobo.85.1"> used by the outer loop. </span><span class="koboSpan" id="kobo.85.2">Therefore, it gets reset by the inner loop and can never end the outer loop.</span></p></div></div><p><span class="koboSpan" id="kobo.86.1">This pattern is usually referred as functional when compared with the more popular prototype-based </span><span class="strong"><strong><span class="koboSpan" id="kobo.87.1">Pseudo-classical pattern</span></strong></span><span class="koboSpan" id="kobo.88.1">. </span><span class="koboSpan" id="kobo.88.2">The advantage of the functional pattern is that it provides a much better mechanism for information hiding and encapsulation since the private variables, in our case, the </span><code class="literal"><span class="koboSpan" id="kobo.89.1">headline</span></code><span class="koboSpan" id="kobo.90.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.91.1">description</span></code><span class="koboSpan" id="kobo.92.1"> variables, are only accessible by nested functions through the static scoping rule; therefore, the object returned by the </span><code class="literal"><span class="koboSpan" id="kobo.93.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.94.1"> function is flexible yet more tamper-proof and durable.</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.95.1">If we create an object in the functional style, and if all of the methods of the object make no use of this, then the object is durable. </span><span class="koboSpan" id="kobo.95.2">A durable object is simply a collection of functions that act as capabilities.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.96.1">-Crockfort D. </span><span class="koboSpan" id="kobo.96.2">2008</span></em></span>
</p></blockquote></div></div><div class="section" title="Getter-setter function"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec4"/><span class="koboSpan" id="kobo.97.1">Getter-setter function</span></h3></div></div></div><p><span class="koboSpan" id="kobo.98.1">Let's take a look at the following code; something strange has happened on line </span><code class="literal"><span class="koboSpan" id="kobo.99.1">G</span></code><span class="koboSpan" id="kobo.100.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.101.1">instance.headline = function (h) { 
  if (!arguments.length) return headline; // &lt;-- G 
  headline = h; 
  return instance; // &lt;-- H 
}; 
</span></pre><p><span class="koboSpan" id="kobo.102.1">You might be asking where this </span><code class="literal"><span class="koboSpan" id="kobo.103.1">arguments</span></code><span class="koboSpan" id="kobo.104.1"> variable on line </span><code class="literal"><span class="koboSpan" id="kobo.105.1">G</span></code><span class="koboSpan" id="kobo.106.1"> came from. </span><span class="koboSpan" id="kobo.106.2">It was never defined anywhere in this example. </span><span class="koboSpan" id="kobo.106.3">The </span><code class="literal"><span class="koboSpan" id="kobo.107.1">arguments</span></code><span class="koboSpan" id="kobo.108.1"> variable is a built-in hidden parameter that is available to functions when they are invoked. </span><span class="koboSpan" id="kobo.108.2">The </span><code class="literal"><span class="koboSpan" id="kobo.109.1">arguments</span></code><span class="koboSpan" id="kobo.110.1"> variable contains all arguments for a function invocation in an array.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/><span class="koboSpan" id="kobo.111.1">Note</span></h3><p><span class="koboSpan" id="kobo.112.1">In fact, </span><code class="literal"><span class="koboSpan" id="kobo.113.1">arguments</span></code><span class="koboSpan" id="kobo.114.1"> is not really a JavaScript array object. </span><span class="koboSpan" id="kobo.114.2">It has </span><span class="emphasis"><em><span class="koboSpan" id="kobo.115.1">length</span></em></span><span class="koboSpan" id="kobo.116.1"> and can be accessed using an index; however, it does not have many of the methods associated with a typical JavaScript array object, such as </span><code class="literal"><span class="koboSpan" id="kobo.117.1">slice</span></code><span class="koboSpan" id="kobo.118.1"> or </span><code class="literal"><span class="koboSpan" id="kobo.119.1">concat</span></code><span class="koboSpan" id="kobo.120.1">. </span><span class="koboSpan" id="kobo.120.2">When you need to use a standard JavaScript array method on </span><code class="literal"><span class="koboSpan" id="kobo.121.1">arguments</span></code><span class="koboSpan" id="kobo.122.1">, you will need to use the following apply invocation pattern:
</span><code class="literal"><span class="koboSpan" id="kobo.123.1">var newArgs = Array.prototype.slice.apply(arguments);</span></code>
</p></div></div><p><span class="koboSpan" id="kobo.124.1">This hidden parameter when combined with the ability to omit function argument in JavaScript allows you to write a function such as </span><code class="literal"><span class="koboSpan" id="kobo.125.1">instance.headline</span></code><span class="koboSpan" id="kobo.126.1"> with unspecified number of parameters. </span><span class="koboSpan" id="kobo.126.2">In this case, we can either have one argument </span><code class="literal"><span class="koboSpan" id="kobo.127.1">h</span></code><span class="koboSpan" id="kobo.128.1"> or none. </span><span class="koboSpan" id="kobo.128.2">Because </span><code class="literal"><span class="koboSpan" id="kobo.129.1">arguments.length</span></code><span class="koboSpan" id="kobo.130.1"> returns </span><code class="literal"><span class="koboSpan" id="kobo.131.1">0</span></code><span class="koboSpan" id="kobo.132.1"> when no parameter is passed, the </span><code class="literal"><span class="koboSpan" id="kobo.133.1">headline</span></code><span class="koboSpan" id="kobo.134.1"> function returns </span><code class="literal"><span class="koboSpan" id="kobo.135.1">headline</span></code><span class="koboSpan" id="kobo.136.1"> if no parameter is passed, otherwise it turns into a setter if parameter </span><code class="literal"><span class="koboSpan" id="kobo.137.1">h</span></code><span class="koboSpan" id="kobo.138.1"> is provided. </span><span class="koboSpan" id="kobo.138.2">To clarify this explanation, let's take a look at the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.139.1">var widget = SimpleWidget({color: "#6495ed"}) 
    .headline("Simple Widget"); // set headline 
console.log(widget.headline()); // prints "Simple Widget" 
</span></pre><p><span class="koboSpan" id="kobo.140.1">Here, you can see how the headline function can be used as both setter and getter with different parameters.</span></p></div><div class="section" title="Function chaining"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec5"/><span class="koboSpan" id="kobo.141.1">Function chaining</span></h3></div></div></div><p><span class="koboSpan" id="kobo.142.1">The next interesting aspect of this particular example is the capability of chaining functions to each other. </span><span class="koboSpan" id="kobo.142.2">This is also the predominant function invocation pattern that the D3 library deploys since most of the D3 functions are designed to be chainable to provide a more concise and contextual programming interface. </span><span class="koboSpan" id="kobo.142.3">This is actually quite simple once you understand the variable, parameter function concept. </span><span class="koboSpan" id="kobo.142.4">Since a variable-parameter function, such as the </span><code class="literal"><span class="koboSpan" id="kobo.143.1">headline</span></code><span class="koboSpan" id="kobo.144.1"> function, can serve as setter and getter at the same time, returning the </span><code class="literal"><span class="koboSpan" id="kobo.145.1">instance</span></code><span class="koboSpan" id="kobo.146.1"> object when it's acting as a setter allows you to immediately invoke another function on the invocation result, hence the chaining.</span></p><p><span class="koboSpan" id="kobo.147.1">Let's take a look at the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.148.1">var widget = SimpleWidget({color: "#6495ed"}) 
  .headline("Simple Widget") 
  .description("This is ...") 
  .render(); 
</span></pre><p><span class="koboSpan" id="kobo.149.1">In this example, the </span><code class="literal"><span class="koboSpan" id="kobo.150.1">SimpleWidget</span></code><span class="koboSpan" id="kobo.151.1"> function returns the </span><code class="literal"><span class="koboSpan" id="kobo.152.1">instance</span></code><span class="koboSpan" id="kobo.153.1"> object (as on line </span><code class="literal"><span class="koboSpan" id="kobo.154.1">I</span></code><span class="koboSpan" id="kobo.155.1">).</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.156.1">function SimpleWidget(spec) { 
... 
    </span><span class="koboSpan" id="kobo.156.2">instance.headline = function (h) { 
        if (!arguments.length) return headline; // &lt;-- G 
        headline = h; 
       return instance; // &lt;-- H 
    }; 
... 
    </span><span class="koboSpan" id="kobo.156.3">return instance; // &lt;-- I 
} 
</span></pre><p><span class="koboSpan" id="kobo.157.1">Then, the </span><code class="literal"><span class="koboSpan" id="kobo.158.1">headline</span></code><span class="koboSpan" id="kobo.159.1"> function is invoked as a setter, which also returns the </span><code class="literal"><span class="koboSpan" id="kobo.160.1">instance</span></code><span class="koboSpan" id="kobo.161.1"> object (as on line </span><code class="literal"><span class="koboSpan" id="kobo.162.1">H</span></code><span class="koboSpan" id="kobo.163.1">). </span><span class="koboSpan" id="kobo.163.2">The </span><code class="literal"><span class="koboSpan" id="kobo.164.1">description</span></code><span class="koboSpan" id="kobo.165.1"> function can then be invoked directly on its return, which again returns the </span><code class="literal"><span class="koboSpan" id="kobo.166.1">instance</span></code><span class="koboSpan" id="kobo.167.1"> object. </span><span class="koboSpan" id="kobo.167.2">Finally, the </span><code class="literal"><span class="koboSpan" id="kobo.168.1">render</span></code><span class="koboSpan" id="kobo.169.1"> function can be called.</span></p><p><span class="koboSpan" id="kobo.170.1">Now, with the knowledge of functional JavaScript and a working ready-to-go D3 data visualization development environment, we are ready to dive into the rich concepts and techniques that D3 has to offer. </span><span class="koboSpan" id="kobo.170.2">However, before we take off, I would like to cover a few more important areas, how to find and share code and how to get help when you are stuck.</span></p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/><span class="koboSpan" id="kobo.171.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.172.1">Let's take a look at some additional helpful resources.</span></p><div class="section" title="Finding and sharing code"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec6"/><span class="koboSpan" id="kobo.173.1">Finding and sharing code</span></h3></div></div></div><p><span class="koboSpan" id="kobo.174.1">One of the great things about D3 when compared with other visualization options is that it offers a wealth of examples and tutorials that you can draw your inspiration from. </span><span class="koboSpan" id="kobo.174.2">During the course of creating my own open source visualization charting library and the creation of this book, I had relied heavily on these resources. </span><span class="koboSpan" id="kobo.174.3">I will list some of the most popular options available in this aspect. </span><span class="koboSpan" id="kobo.174.4">This list is by no means a comprehensive directory, but rather a starting place for you to explore:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.175.1">The D3 gallery (</span><a class="ulink" href="https://github.com/d3/d3/wiki/Gallery"><span class="koboSpan" id="kobo.176.1">https://github.com/d3/d3/wiki/Gallery
</span></a><span class="koboSpan" id="kobo.177.1">) contains some of the most interesting examples that you can find online regarding D3 usage. </span><span class="koboSpan" id="kobo.177.2">It contains examples on different visualization charts, specific techniques, and some interesting visualization implementations in the wild, among others.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.178.1">Christophe Viau's D3 Gallery (</span><a class="ulink" href="http://christopheviau.com/d3list/gallery.html"><span class="koboSpan" id="kobo.179.1">http://christopheviau.com/d3list/gallery.html
</span></a><span class="koboSpan" id="kobo.180.1">) is another D3 gallery with categorization that helps you find your desired visualization example online quickly.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.181.1">The D3 tutorials page (</span><a class="ulink" href="https://github.com/d3/d3/wiki/Tutorials"><span class="koboSpan" id="kobo.182.1">https://github.com/d3/d3/wiki/Tutorials
</span></a><span class="koboSpan" id="kobo.183.1">) contains a collection of tutorials, talks, and slides created by various contributors over time that demonstrates in detail how to use different D3 concepts and techniques.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.184.1">D3 plugins can be found at </span><a class="ulink" href="https://github.com/d3/d3-plugins"><span class="koboSpan" id="kobo.185.1">https://github.com/d3/d3-plugins
</span></a><span class="koboSpan" id="kobo.186.1">. </span><span class="koboSpan" id="kobo.186.2">Maybe some features are missing in D3 for your visualization needs? </span><span class="koboSpan" id="kobo.186.3">Before you decide to implement your own, make sure that you check out the D3 plugin repository. </span><span class="koboSpan" id="kobo.186.4">It contains a wide variety of plugins that provide some of the common and, sometimes, uncommon features in the visualization world.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.187.1">The D3 API (</span><a class="ulink" href="https://github.com/d3/d3/blob/master/API.md"><span class="koboSpan" id="kobo.188.1">https://github.com/d3/d3/blob/master/API.md
</span></a><span class="koboSpan" id="kobo.189.1">) is very well documented. </span><span class="koboSpan" id="kobo.189.2">This is where you can find detailed explanations for every function and property that the D3 library has to offer.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.190.1">Mike Bostok's Blocks (</span><a class="ulink" href="http://bl.ocks.org/mbostock"><span class="koboSpan" id="kobo.191.1">http://bl.ocks.org/mbostock
</span></a><span class="koboSpan" id="kobo.192.1">) is a D3 example site, where some of the more intriguing visualization examples can be found and is maintained by its author Mike Bostock.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.193.1">JS Bin (</span><a class="ulink" href="http://jsbin.com/ugacud/1/edit"><span class="koboSpan" id="kobo.194.1">http://jsbin.com/ugacud/1/edit
</span></a><span class="koboSpan" id="kobo.195.1">) is a prebuilt D3 test and experiment environment completely hosted online. </span><span class="koboSpan" id="kobo.195.2">You can easily prototype a simple script using this tool or share your creation with other members in the community.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.196.1">JS Fiddle (</span><a class="ulink" href="http://jsfiddle.net/qAHC2/"><span class="koboSpan" id="kobo.197.1">http://jsfiddle.net/qAHC2/
</span></a><span class="koboSpan" id="kobo.198.1">) is similar to JS Bin; it also is a hosted-online JavaScript code prototyping and sharing platform.</span></li></ul></div><div class="section" title="How to get help"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec2"/><span class="koboSpan" id="kobo.199.1">How to get help</span></h4></div></div></div><p><span class="koboSpan" id="kobo.200.1">Even with all the examples, tutorial, and cookbook such as this, you might still run into challenges when you create your own visualization. </span><span class="koboSpan" id="kobo.200.2">The good news here is that D3 has a broad and active support community. </span><span class="koboSpan" id="kobo.200.3">Simply </span><span class="emphasis"><em><span class="koboSpan" id="kobo.201.1">googling</span></em></span><span class="koboSpan" id="kobo.202.1"> your question can most often yield a satisfying answer. </span><span class="koboSpan" id="kobo.202.2">Even if it doesn't, don't worry; D3 has a robust community-based support as the following:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.203.1">D3.js on Stack Overflow (</span><a class="ulink" href="http://stackoverflow.com/questions/tagged/d3.js"><span class="koboSpan" id="kobo.204.1">http://stackoverflow.com/questions/tagged/d3.js
</span></a><span class="koboSpan" id="kobo.205.1">): Stack Overflow is the most popular community-based free Q&amp;A site for technologists. </span><span class="koboSpan" id="kobo.205.2">D3 is a specific category on the Stack Overflow site to help you reach the experts and get an answer to your question quickly.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.206.1">The D3 Google group (</span><a class="ulink" href="https://groups.google.com/forum/?fromgroups#!forum/d3-js"><span class="koboSpan" id="kobo.207.1">https://groups.google.com/forum/?fromgroups#!forum/d3-js
</span></a><span class="koboSpan" id="kobo.208.1">): This is the official user group for not just D3 but also other related libraries in its ecosystem.</span></li></ul></div></div></div></div></div></div></div></body></html>