<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Charting and Documents"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Charting and Documents</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Opening PDF documents</li><li class="listitem" style="list-style-type: disc">Using an iPad for document signatures</li><li class="listitem" style="list-style-type: disc">Creating PDF documents from images or screenshots</li><li class="listitem" style="list-style-type: disc">Generating PDF documents using jsPDF</li><li class="listitem" style="list-style-type: disc">Creating a scheduling chart using RGraph</li><li class="listitem" style="list-style-type: disc">Displaying information with Google gauges</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec32"/>Introduction</h1></div></div></div><p>Through the convenience of a mobile device, your customers and employees have the ability to access data, documents, and related information, wherever and whenever needed. This chapter provides recipes to assist with the development of at-a-glance and portable information.</p><p>Depending on your industry, an innovative mobile-document strategy can provide a key competitive advantage. Forms, contracts, recipes, and invoices are all examples of areas a mobile document strategy can reduce costs while better engaging your users. In this chapter, we will cover several strategies to deal with documents in a cross-platform fashion.</p><p>The creation of dashboards using charts and graphs to paint a compelling picture is a common management-team request, and is a powerful way to harness mobile technology to provide business value. An example of this value proposition is mobility, enabling your marketing, sales, or operations teams with current market data in an at-a-glance format, allowing the management team to make faster decisions. In this chapter, we demonstrate how to use Titanium to create powerful, interactive charting experiences.</p></div></div>
<div class="section" title="Opening PDF documents"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec33"/>Opening PDF documents</h1></div></div></div><p>The ability <a id="id434" class="indexterm"/>to open, view, and exchange PDF documents <a id="id435" class="indexterm"/>is a common requirement in Enterprise app development. This recipe discusses how to use the openPDF <code class="literal">CommonJS</code> module<a id="id436" class="indexterm"/> to view PDF documents in a cross-platform manner.</p><p>The following screenshots illustrate this recipe running on both an iPhone and an Android device:</p><div class="mediaobject"><img src="graphics/5343OT_05_01.jpg" alt="Opening PDF documents"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec69"/>Getting ready</h2></div></div></div><p>The recipe uses both a <code class="literal">CommonJS</code> and an Android native module. These can be downloaded <a id="id437" class="indexterm"/>from the source code provided by the book, or<a id="id438" class="indexterm"/> individually through the links provided in the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. Installing these in your project is straightforward. Simply copy the <code class="literal">openPDF.js</code> file and the <code class="literal">bencoding.android.tools</code> folder into your Titanium project, as shown highlighted in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_02.jpg" alt="Getting ready"/></div><p>After copying the module folder, you will need to click on your <code class="literal">tiapp.xml</code> file in Titanium Studio and add a reference to the <code class="literal">bencoding.android.tools</code> module, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_03.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec70"/>How to do it…</h2></div></div></div><p>Once you have <a id="id439" class="indexterm"/>added <code class="literal">openPDF.js</code> and the native android module to your project, you need to create your application namespaces and use <code class="literal">require</code> to import the module into your code, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
  pdfOpener : require('openPDF'),
  isAndroid : (Ti.Platform.osname === 'android')
};</pre></div><div class="section" title="Creating a link to the PDF file"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec132"/>Creating a link to the PDF file</h3></div></div></div><p>The next <a id="id440" class="indexterm"/>step in this recipe is to create a variable with the path to our PDF file. For example purposes, we are using a PDF file called <code class="literal">w4.pdf</code> located in our project's <code class="literal">resources</code> directory. The following snippet demonstrates how to create this path variable:</p><div class="informalexample"><pre class="programlisting">my.pdfFile = Ti.Filesystem.resourcesDirectory + 'w4.pdf';</pre></div></div><div class="section" title="Creating our example UI"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec133"/>Creating our example UI</h3></div></div></div><p>This recipe<a id="id441" class="indexterm"/> provides a basic UI to help illustrate how to use the <code class="literal">openPDF</code> module. This straightforward screen contains a button that opens a dialog providing different options the user can select to open a PDF file. If this recipe is running on an iOS device, the user will have a second button demonstrating how to open the PDF file inside the app.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We first create a <code class="literal">Ti.UI.Window</code> window to attach all UI elements onto:<div class="informalexample"><pre class="programlisting">var win = Ti.UI.createWindow({
    exitOnClose: true, title:"Open PDF Example", backgroundColor:'#fff' 
});</pre></div></li><li class="listitem">Next, <a id="id442" class="indexterm"/>we add a label instructing the user which button to press:<div class="informalexample"><pre class="programlisting">var infoLabel = Ti.UI.createLabel({
    text:'Press the button to open a PDF file', top:10, left:10, right:10, height:40, textAlign:'center'
});
win.add(infoLabel);</pre></div></li><li class="listitem">Next, the button that will launch our first example is added to the <code class="literal">Ti.UI.Window</code> window:<div class="informalexample"><pre class="programlisting">var goButton = Ti.UI.createButton({
    title: 'open pdf', height: '60dp', width: '150dp', top: '140dp'
});
win.add(goButton);</pre></div></li></ol></div></div><div class="section" title="Opening a PDF file on the click of a button"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec134"/>Opening a PDF file on the click of a button</h3></div></div></div><p>The first example <a id="id443" class="indexterm"/>of how to use the <code class="literal">openPDF</code> module is shown in the following <code class="literal">goButton</code> click-event snippet:</p><div class="informalexample"><pre class="programlisting">goButton.addEventListener('click', function(e) {</pre></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, the <code class="literal">isSupported</code> method is called to determine if the device supports PDF files. This method will return a <code class="literal">true</code> if supported, or a <code class="literal">false</code> if no support is available.<div class="informalexample"><pre class="programlisting">  if(my.pdfOpener.isSupported()){</pre></div></li><li class="listitem">Next, the file path to our PDF is provided to the <code class="literal">open</code> method. This will then present the user with an <code class="literal">options</code> dialog on how they wish to view the file:<div class="informalexample"><pre class="programlisting">    my.pdfOpener.open(my.pdfFile);
  }else{</pre></div></li><li class="listitem">If the <code class="literal">isSupported</code> method results a <code class="literal">false</code>, you can then call the <code class="literal">isSupportedDetail</code> method for more information on why. As the following snippet shows, you can use the <code class="literal">reason</code> property returned by the <code class="literal">isSupportedDetail</code> method to alert your user to the specific issue. You can also use the <code class="literal">code</code> property to create your own customized messages.<div class="informalexample"><pre class="programlisting">    alert(my.pdfOpener.isSupportedDetail().reason);
  }
});</pre></div></li></ol></div></div><div class="section" title="Opening a PDF file within your iOS app"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec135"/>Opening a PDF file within your iOS app</h3></div></div></div><p>The iOS platform <a id="id444" class="indexterm"/>has built-in support for working with PDF files. The <code class="literal">openPDF</code> module leverages this platform to provide the ability to create a PDF dialog viewer within your app, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_04.jpg" alt="Opening a PDF file within your iOS app"/></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In this section, a check is performed to ensure that the recipe is running on an iOS device. If so, the button <code class="literal">goButton2</code> is added to our <code class="literal">Ti.UI.Window</code> window:<div class="informalexample"><pre class="programlisting">if(!my.isAndroid){
    var goButton2 = Ti.UI.createButton({
    title: 'open pdf menu', height: 60, width: 150d, bottom: 140
  });
  win.add(goButton2);</pre></div></li><li class="listitem">The <code class="literal">goButton2</code> click event demonstrates how to open a PDF file in a dialog window:<div class="informalexample"><pre class="programlisting">  goButton2.addEventListener('click', function(e) {</pre></div></li><li class="listitem">Next, the <code class="literal">isSupported</code> method is called to verify whether the device can read a PDF file:<div class="informalexample"><pre class="programlisting">    if(!my.pdfOpener.isSupported()){</pre></div></li><li class="listitem">If the device does not support the displaying of PDF files, the <code class="literal">isSupportDetail</code> method is called to return the reason why PDF files cannot be displayed:<div class="informalexample"><pre class="programlisting">      alert(my.pdfOpener.isSupportedDetail().reason);
      return;
    }</pre></div></li><li class="listitem">Finally,<a id="id445" class="indexterm"/> the <code class="literal">openDialog</code> method is called to display the PDF file. The <code class="literal">openDialog</code> method<a id="id446" class="indexterm"/> requires two arguments. The first is a path to the PDF file that is to be displayed. The second is a configuration object containing a UI object that specifies the view relative to where the viewer should be displayed. In the following example, we provide the <code class="literal">infoLabel</code> label created earlier as our <code class="literal">view</code> object:<div class="informalexample"><pre class="programlisting">    my.pdfOpener.openDialog(my.pdfFile,
      {view:infoLabel, animated:true}
    );
  });
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>Additional elements can be added to the configuration object, such as the <code class="literal">animated</code> property to determine if an animation should be applied while opening and closing a PDF file.</p></div></div></li></ol></div><p>To close the PDF dialog programmatically,<a id="id447" class="indexterm"/> use the <code class="literal">closeDialog</code> method, as shown in the following snippet:</p><div class="informalexample"><pre class="programlisting">my.pdfOpener.closeDialog();</pre></div></div><div class="section" title="File clean-up on closing a window"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec136"/>File clean-up on closing a window</h3></div></div></div><p>The <code class="literal">openPDF</code> module<a id="id448" class="indexterm"/> creates cache objects and temporary files to assist in the display process. It is important to call the <code class="literal">dispose</code> method<a id="id449" class="indexterm"/> when PDF operations are no longer needed:</p><div class="informalexample"><pre class="programlisting">win.addEventListener('close', function(e) {
  my.pdfOpener.dispose();
});</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip29"/>Tip</h3><p>If you are using the <code class="literal">openDialog</code> option on iOS, calling <code class="literal">dispose</code> will close the PDF dialog as well.</p></div></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec71"/>See also</h2></div></div></div><p>To learn more about the libraries and frameworks used in this recipe, please visit the following links:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iOS DocumentViewer</strong></span>: The <code class="literal">openPDF</code> module <a id="id450" class="indexterm"/>uses the <code class="literal">Ti.UI.iOS.DocumentViewer</code> object to work with PDF files on the iOS platform. For additional details, please review Titanium's online documentation at <a class="ulink" href="http://docs.appcelerator.com">http://docs.appcelerator.com</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Working with Android Intents</strong></span>: The <code class="literal">openPDF</code> module uses the <code class="literal">Ti.Android.intent</code> object to launch a PDF viewer on the user's device. For additional information about working with <code class="literal">Ti.Android.intent</code><a id="id451" class="indexterm"/>, visit this Appcelerator blog entry at <a class="ulink" href="http://developer.appcelerator.com/blog/2011/09/sharing-project-assets-with-android-intents.html">http://developer.appcelerator.com/blog/2011/09/sharing-project-assets-with-android-intents.html</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Android Intent Supported</strong></span>: The <code class="literal">openPDF</code> library uses the <code class="literal">bencoding.android.tools</code> module's <a id="id452" class="indexterm"/>project to check if there is an available intent to open a PDF document on user's device. To learn more about this project, please visit <a class="ulink" href="https://github.com/benbahrenburg/benCoding.Android.Tools">https://github.com/benbahrenburg/benCoding.Android.Tools</a>.</li></ul></div></div></div>
<div class="section" title="Using an iPad for document signatures"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec34"/>Using an iPad for document signatures</h1></div></div></div><p>Tablets and <a id="id453" class="indexterm"/>other touch devices provide a naturally immersive environment for working with documents. Through the use of several open source <a id="id454" class="indexterm"/>modules and our example PDF, <a id="id455" class="indexterm"/>this recipe illustrates how to create a document-signing app for your organization.</p><p>The following screenshot demonstrates this recipe running on an iPad:</p><div class="mediaobject"><img src="graphics/5343OT_05_05.jpg" alt="Using an iPad for document signatures"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip30"/>Tip</h3><p>This recipe is designed to run only on an iPad.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec72"/>Getting ready</h2></div></div></div><p>This<a id="id456" class="indexterm"/> recipe uses both <code class="literal">CommonJS</code> and native modules. These modules can be downloaded from the source code provided by the book, or individually <a id="id457" class="indexterm"/>through the links provided in <a id="id458" class="indexterm"/>the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. The installation process is straightforward and requires only copying a few folders and files. Simply copy the <code class="literal">library.js</code> file and the <code class="literal">modules</code> folder into your Titanium Project, as highlighted in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_06.jpg" alt="Getting ready"/></div><p>After copying the <code class="literal">modules</code> folder, you will need to click on your <code class="literal">tiapp.xml</code> file in Titanium <a id="id459" class="indexterm"/>Studio<a id="id460" class="indexterm"/> and <a id="id461" class="indexterm"/>add a reference to <code class="literal">ti.paint</code> module, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_07.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec73"/>How to do it…</h2></div></div></div><p>Once you have added <code class="literal">library.js</code> and the native modules to your project, you need to create<a id="id462" class="indexterm"/> your <a id="id463" class="indexterm"/>application <a id="id464" class="indexterm"/>namespaces and use <code class="literal">require</code> to import the module into your <code class="literal">app.js</code> file, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
  paint : require('ti.paint'),
  library : require('library')
};</pre></div><div class="section" title="Creating a window for the recipe"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec137"/>Creating a window for the recipe</h3></div></div></div><p>The following<a id="id465" class="indexterm"/> snippet demonstrates how to create a <code class="literal">Ti.UI.Window</code> window to hold all the controls used in this recipe:</p><div class="informalexample"><pre class="programlisting">  var win = Ti.UI.createWindow({
    title:"iPad Signature Recipe", backgroundColor:'#fff' 
  });</pre></div></div><div class="section" title="Adding a document view"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec138"/>Adding a document view</h3></div></div></div><p>The first UI element<a id="id466" class="indexterm"/> added to <code class="literal">Ti.UI.Window</code> is used to display the recipe's document. On iOS, the <code class="literal">Ti.UI.WebView</code> object has built-in support for displaying PDF files. This sample demonstrates how to load a single PDF document from the <code class="literal">Resources</code> folder of your Titanium project.</p><div class="informalexample"><pre class="programlisting">  var docView = Ti.UI.createWebView({
    top:60, bottom:250, left:10, right:20, url:'w4.pdf'
  });
  win.add(docView);</pre></div></div><div class="section" title="Adding a signature view"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec139"/>Adding a signature view</h3></div></div></div><p>The <a id="id467" class="indexterm"/>next UI element added to the <code class="literal">Ti.UI.Window</code> window is <code class="literal">PaintView</code>. This <code class="literal">UIView</code> is provided by the <code class="literal">Ti.Paint</code> module added during the setup process. This view allows the user to draw on the screen using touch. The following snippet demonstrates how to set up this view to allow the user to draw using a black hue with a stroke size of 10 points:</p><div class="informalexample"><pre class="programlisting">  var vwSign = my.paint.createPaintView({
      bottom:60, left:10, right:10, height:140, strokeColor:'#000', strokeAlpha:255, strokeWidth:10, eraseMode:false, borderColor:'#999'
  });
  win.add(vwSign);</pre></div></div><div class="section" title="Adding buttons"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec140"/>Adding buttons</h3></div></div></div><p>The <a id="id468" class="indexterm"/>next step is to create buttons to save or clear a signature. The <code class="literal">bClear</code> button is added to the lower-left section of the screen. This button will provide the ability for the user to clear the signature area. This button can also be used to remove a saved signature.</p><div class="informalexample"><pre class="programlisting">  var bClear = Ti.UI.createButton({
      title:'Remove Signature', left:10, bottom:10, width:150, height:45
  });
  win.add(bClear);</pre></div><p>When the click event is fired on the <code class="literal">bClear</code> button, the signature is cleared and any saved signature files are removed:</p><div class="informalexample"><pre class="programlisting">  bClear.addEventListener('click',function(e){</pre></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Call the <code class="literal">clear</code> method on <code class="literal">vwSign</code>. This will remove all the contents of <code class="literal">PaintView</code>.<div class="informalexample"><pre class="programlisting">    vwSign.clear();</pre></div></li><li class="listitem">Next, the <code class="literal">deleteSignature</code> method is called on the library <code class="literal">CommonJS</code> module. This removes the stored signature image.<div class="informalexample"><pre class="programlisting">    my.library.deleteSignature();</pre></div></li><li class="listitem">Then, <code class="literal">vwSign</code> is touch-enabled, and the user is alerted that their signature has been removed. After this is completed, the user will be able to create a new document signature.<div class="informalexample"><pre class="programlisting">    vwSign.touchEnabled = true;
    alert("Signature has been reset.");
  });</pre></div></li><li class="listitem">Next, the <code class="literal">bSave</code> button is added to the lower-right side of the iPad screen. This button allows the user to save a copy of their signature for later use.<div class="informalexample"><pre class="programlisting">  var bSave = Ti.UI.createButton({
    title:'Save Signature', right:10, bottom:10, width:150, height:45
  });
  win.add(bSave);</pre></div></li><li class="listitem">When the click event on the <code class="literal">bSave</code> button is fired, an image of the user's signature is saved to a library folder on the device.<div class="informalexample"><pre class="programlisting">  bSave.addEventListener('click',function(e){</pre></div></li></ol></div><p>Perform the <a id="id469" class="indexterm"/>following steps to complete the saving process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Convert the contents of the signature view into an image blob. This blob is then provided to the library <code class="literal">CommonJS</code> module's <code class="literal">saveSignature</code> method to be persisted to the device's documents folder.<div class="informalexample"><pre class="programlisting">    my.library.saveSignature(vwSign.toImage());</pre></div></li><li class="listitem">Once the signature image has been saved to disk, the signature surface is made read-only so no additional updates can be performed:<div class="informalexample"><pre class="programlisting">    vwSign.touchEnabled = false;
    alert("You have successfully signed this document.");
  });</pre></div></li></ol></div></div><div class="section" title="Reloading a saved signature"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec141"/>Reloading a saved signature</h3></div></div></div><p>The last <a id="id470" class="indexterm"/>section of this recipe describes how, on opening a window, to check if the document has been signed and loads the stored signature for display.</p><div class="informalexample"><pre class="programlisting">  win.addEventListener('open',function(e){</pre></div><p>First the <code class="literal">isSigned</code> method is called on the <code class="literal">library</code> module. This method will check if the signature file is present within the device's <code class="literal">library</code> folder.</p><div class="informalexample"><pre class="programlisting">    if(my.library.isSigned()){</pre></div><p>The <code class="literal">signatureUrl</code> method is used to provide the signature's image path to the view for display:</p><div class="informalexample"><pre class="programlisting">      vwSign.image = my.library.signatureUrl();</pre></div><p>Since the document has already been signed, the signature view is then disabled so no additional updates can be made without clearing the existing signature first.</p><div class="informalexample"><pre class="programlisting">      vwSign.touchEnabled = false;
    }
  });

  win.open({modal:true});</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec74"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This recipe uses the <code class="literal">Ti.Paint</code> open source module. The <code class="literal">Ti.Paint</code> module was used in this recipe to provide the user with the ability to sign a document. To learn more about this project, please visit <a class="ulink" href="https://github.com/appcelerator/titanium_modules/tree/master/paint/mobile/ios">https://github.com/appcelerator/titanium_modules/tree/master/paint/mobile/ios</a>.</li></ul></div></div></div>
<div class="section" title="Creating PDF documents from images or screenshots"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Creating PDF documents from images or screenshots</h1></div></div></div><p>Mobile devices<a id="id471" class="indexterm"/> are wonderful consumers of PDF documents. But, what about creating them? Many scenarios, such as issuing recipes or invoices, require a PDF file to be created by the device. One easy approach for doing this<a id="id472" class="indexterm"/> is to convert an image into a PDF file. This approach works well with Titanium's robust image creation and maintenance functionality.</p><p>This recipe demonstrates how to convert a <code class="literal">Ti.UI.View</code> into a PDF document. Also demonstrated is how to use Titanium's <code class="literal">Ti.Media.takeScreenshot</code> API to convert a fullscreen image of your app into a PDF file. This could be helpful for consumers looking to "print" their screen.</p><div class="mediaobject"><img src="graphics/5343OT_05_08.jpg" alt="Creating PDF documents from images or screenshots"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec75"/>Getting ready</h2></div></div></div><p>This recipe leverages the <code class="literal">bencoding.pdf</code> native module. This module and supporting source code can<a id="id473" class="indexterm"/> be downloaded from the source code provided by the book, or individually through the links provided in the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. The installation process for this recipe is straightforward and only requires copying the two <code class="literal">bencoding.pdf</code> folders into their appropriate <code class="literal">modules</code> folder, as highlighted in the screenshot at the end of this section. If your Titanium project does not currently have a <code class="literal">modules</code> folder, you can simply copy the complete <code class="literal">modules</code> folder from this recipe into your project. In addition to the two native modules, you will need to copy the <code class="literal">sampleUI.js</code> file, shown the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_09.jpg" alt="Getting ready"/></div><p>After copying the <code class="literal">modules</code> folder, you will need to click on your <code class="literal">tiapp.xml</code> file in Titanium Studio, and add a reference to the <code class="literal">bencoding.pdf</code> modules, as shown in the following screenshot. Please note only one module entry will appear for <code class="literal">bencoding.pdf</code>, but both iOS and Android will be added to your <code class="literal">tiapp.xml</code> file, once selected.</p><div class="mediaobject"><img src="graphics/5343OT_05_10.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec76"/>How to do it…</h2></div></div></div><p>Once you have added the <code class="literal">sampleUI.js</code> file and native modules to your project, you need to create your <a id="id474" class="indexterm"/>application namespaces in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
    PDF : require('bencoding.pdf'),sampleUI : require('sampleUI'),isAndroid : Ti.Platform.osname === 'android'
};</pre></div><div class="section" title="Creating a UI for the recipe"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec142"/>Creating a UI for the recipe</h3></div></div></div><p>Now, we<a id="id475" class="indexterm"/> create a <code class="literal">Ti.UI.Window</code> window to host the recipe's UI elements:</p><div class="informalexample"><pre class="programlisting">var win = Ti.UI.createWindow({
  title:'PDF Screenshot', backgroundColor:'#fff'
});</pre></div><p>Once <code class="literal">Ti.UI.Window</code> has been created, the contents of the sample invoice is provided by our <code class="literal">sampleUI</code> module. The <code class="literal">sampleUI</code> module uses several <code class="literal">Ti.UI.View</code> and <code class="literal">Ti.UI.Label</code> controls to generate a sample invoice layout.</p><div class="informalexample"><pre class="programlisting">var vwContent = my.sampleUI.fetchInvoiceUI();
win.add(vwContent);</pre></div></div><div class="section" title="Creating a PDF from a view"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec143"/>Creating a PDF from a view</h3></div></div></div><p>Next, <a id="id476" class="indexterm"/>the <code class="literal">makeImageButton</code> button is added to the recipe's <code class="literal">Ti.UI.Window</code>. This button will later be used to create a PDF sample invoice.</p><div class="informalexample"><pre class="programlisting">var makeImageButton = Ti.UI.createButton({
    title:'Invoice PDF', bottom:5, left:10, width:135, height:50	
});
win.add(makeImageButton);</pre></div><p>When the click event on the <code class="literal">makeImageButton</code> button is fired, a PDF is generated with the contents from the <code class="literal">Ti.UI.View</code> containing our sample invoice.</p><div class="informalexample"><pre class="programlisting">makeImageButton.addEventListener('click',function(e){</pre></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first step in generating a PDF is to create an image from the <code class="literal">Ti.UI.View</code> containing the invoice layout. The following snippet demonstrates how to do this on both iOS and Android:<div class="informalexample"><pre class="programlisting">  var image = ((my.isAndroid)? vwContent.toImage().media : vwContent.toImage());</pre></div></li><li class="listitem">The image blob for the invoice <code class="literal">Ti.UI.View</code> is then provided to the <code class="literal">convertImageToPDF</code> method in the <code class="literal">PDF Converters</code> module. This method converts the provided image into a PDF <code class="literal">Ti.File</code> blob. In addition to the image on iOS, you can provide a resolution to be used in the conversion process. The following sample uses a resolution of 100:<div class="informalexample"><pre class="programlisting">  var pdfBlob = my.PDF.createConverters().convertImageToPDF(image,100);</pre></div></li><li class="listitem">The invoice PDF <code class="literal">Ti.File</code> blob can then be saved using the standard <code class="literal">Ti.FileSystem</code> method, as the following snippet shows:<div class="informalexample"><pre class="programlisting">  var pdfFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, 'invoice.pdf'
  );
  pdfFile.write(pdfBlob);
});</pre></div></li></ol></div></div><div class="section" title="Creating a PDF document from a screenshot"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec144"/>Creating a PDF document from a screenshot</h3></div></div></div><p>A similar<a id="id477" class="indexterm"/> technique can be used to create a PDF document containing a screenshot of the app. The first step in doing this is to add a button named <code class="literal">ssButton</code> to the recipe's <code class="literal">Ti.UI.Window</code>:</p><div class="informalexample"><pre class="programlisting">var ssButton = Ti.UI.createButton({
    title:'Screen to PDF', bottom:5, right:10, width:135, height:50
});
win.add(ssButton);</pre></div><p>When we click on the <code class="literal">ssButton</code> button, a screenshot will be taken and converted into a PDF file:</p><div class="informalexample"><pre class="programlisting">ssButton.addEventListener('click',function(e){</pre></div><p>The first step in this process is to use the <code class="literal">Ti.Media.takeScreenshot</code> API to take a screenshot of the app:</p><div class="informalexample"><pre class="programlisting">  Ti.Media.takeScreenshot(function(event){</pre></div><p>The screenshot API returns an image blob of the device's screen:</p><div class="informalexample"><pre class="programlisting">    var image = event.media;</pre></div><p>The screenshot<a id="id478" class="indexterm"/> image blob is then provided to the <code class="literal">convertImageToPDF</code> method in the <code class="literal">PDF Converters</code> module. This method converts the provided image into a PDF <code class="literal">Ti.File</code> blob. In addition to the image on iOS, you can provide a resolution to be used in the conversion process. This sample uses a resolution of 96 points:</p><div class="informalexample"><pre class="programlisting">    var pdfBlob = my.PDF.createConverters().convertImageToPDF(image,96);</pre></div><p>The screenshot PDF <code class="literal">Ti.File</code> blob can then be saved using the standard <code class="literal">Ti.FileSystem</code> methods:</p><div class="informalexample"><pre class="programlisting">    var pdfFile = Ti.Filesystem.getFile(
      Ti.Filesystem.applicationDataDirectory, 'screenshot.pdf'
);
    pdfFile.write(pdfBlob);
  });
});</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec77"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To learn more about the modules used in this recipe, please visit <a class="ulink" href="https://github.com/benbahrenburg/benCoding.PDF">https://github.com/benbahrenburg/benCoding.PDF</a>.</li></ul></div></div></div>
<div class="section" title="Generating PDF documents using jsPDF"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Generating PDF documents using jsPDF</h1></div></div></div><p>Creating formatted PDF documents <a id="id479" class="indexterm"/>on a mobile device can be difficult. Adding cross-platform to the equation only compounds this challenge. The jsPDF JavaScript library and the associated jsPDF Titanium module provide a robust and pure JavaScript cross-platform approach.</p><p>This recipe <a id="id480" class="indexterm"/>demonstrates<a id="id481" class="indexterm"/> how to create formatted PDF documents, similar to the following screenshot, using a powerful JavaScript API:</p><div class="mediaobject"><img src="graphics/5343OT_05_11.jpg" alt="Generating PDF documents using jsPDF"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec78"/>Getting ready</h2></div></div></div><p>This recipe uses the <code class="literal">jsPDF</code> module for Titanium to create PDF files. This module and supporting source code can be downloaded from the source code provided by the book, or individually through the links provided in the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. The installation process for this recipe is straightforward and only requires copying the <code class="literal">jsPDFMod</code> folder into the <code class="literal">Resources</code> folder of your Titanium project, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_12.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec79"/>How to do it…</h2></div></div></div><p>Once you have <a id="id482" class="indexterm"/>added the <code class="literal">jsPDFMod</code> folder to your <a id="id483" class="indexterm"/>project, you will need to create your application namespaces in the <code class="literal">app.js</code> file, and use <code class="literal">require</code> to import the module into your code, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
    jsPDF : require('./jsPDFMod/TiJSPDF'),isAndroid : Ti.Platform.osname === 'android'
};</pre></div><div class="section" title="Creating a UI for the recipe"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec145"/>Creating a UI for the recipe</h3></div></div></div><p>This recipe contains a basic UI that allows the user to generate a recipe PDF and open an e-mail dialog.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a <code class="literal">Ti.UI.Window</code> window to hold all UI controls:<div class="informalexample"><pre class="programlisting">    var win = Ti.UI.createWindow({
        backgroundColor: '#eee', title: 'jsPDF Sample',layout:'vertical'
    });</pre></div></li><li class="listitem">Next, the <code class="literal">goButton</code> button is added to the recipe's <code class="literal">Ti.UI.Window</code>:<div class="informalexample"><pre class="programlisting">    var goButton = Ti.UI.createButton({
      height: '50dp', title: 'Email a receipt', left:'20dp', right:'20dp', top:'40dp'
    });
    win.add(goButton);</pre></div></li><li class="listitem">The <code class="literal">goButton</code> button's click event launches the PDF creation process by calling the <code class="literal">generatePDFExample</code> method:<div class="informalexample"><pre class="programlisting">    goButton.addEventListener('click', function (e) {
      generatePDFExample();
    });</pre></div></li></ol></div></div><div class="section" title="Creating a PDF document using jsPDF"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec146"/>Creating a PDF document using jsPDF</h3></div></div></div><p>The following <a id="id484" class="indexterm"/>snippet describes how to use <code class="literal">generatePDFExample</code> to create a PDF document using the <code class="literal">jsPDF</code> module:</p><div class="informalexample"><pre class="programlisting">    function generatePDFExample(){</pre></div><p>The next line demonstrates how to create a new instance of the <code class="literal">jsPDF</code> module. This creates a new virtual PDF document.</p><div class="informalexample"><pre class="programlisting">        var doc = new my.jsPDF();</pre></div><p>The following snippet demonstrates how to add document properties to the PDF document object:</p><div class="informalexample"><pre class="programlisting">        doc.setProperties({
            title: 'Title', subject: 'This is the subject', author: 'add author', keywords: 'one, two, three', creator: 'your organization'
        });</pre></div><p>The following <a id="id485" class="indexterm"/>snippet demonstrates how to embed an image into a PDF document. It is important that the images contain a full native path as shown here, otherwise the document will generate errors on saving:</p><div class="informalexample"><pre class="programlisting">        var imgSample1 = Ti.Filesystem.resourcesDirectory + 'sample_logo.jpg';
        doc.addImage(imgSample1, 'JPEG', 10, 20, 35, 17);</pre></div><p>We then create a header using <code class="literal">Helvetica</code> <code class="literal">bold</code> and a font size of <code class="literal">32</code>:</p><div class="informalexample"><pre class="programlisting">        doc.setFont("helvetica");
        doc.setFontType("bold");
        doc.setFontSize(32);
        doc.text(20, 50, 'Your Receipt);</pre></div><p>The following code snippet creates the itemized recipe section with <code class="literal">normal</code> font and a size of <code class="literal">18</code>:</p><div class="informalexample"><pre class="programlisting">        doc.setFontType("normal");
        doc.setFontSize(18);
        doc.text(20, 70, '1. Cargo Container $2399.99');
        doc.text(20, 80, '2. Storage (5 days) $1299.99');
        doc.text(20, 90, '3. Loading Fee $699.99');
        doc.text(20, 100, '4. Transport Insurance $399.99');</pre></div><p>A <code class="literal">Ti.File</code>
<a id="id486" class="indexterm"/> object <a id="id487" class="indexterm"/>is created to the location where we wish to save <code class="literal">recipe.pdf</code>:</p><div class="informalexample"><pre class="programlisting">        var myFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,'recipe.pdf');</pre></div><p>The <code class="literal">Ti.File</code> object is then passed into the <code class="literal">jsPDF</code> module's <code class="literal">save</code> method. The <code class="literal">save</code> method will generate a PDF file with the attributes created earlier:</p><div class="informalexample"><pre class="programlisting">        doc.save(myFile);</pre></div><p>The <code class="literal">Ti.File</code> reference for the saved PDF file is then provided to <code class="literal">Ti.UI.EmailDialog</code> as an attachment and opened, so the user can compose an e-mail:</p><div class="informalexample"><pre class="programlisting">        var emailDialog = Ti.UI.createEmailDialog();
        emailDialog.addAttachment(myFile);
        emailDialog.open();
      };</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec80"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To learn more about the jsPDF project created by James Hall, please visit the Github repository at <a class="ulink" href="https://github.com/MrRio/jsPDF">https://github.com/MrRio/jsPDF</a>.</li><li class="listitem" style="list-style-type: disc">This recipe uses the a Titanium module for jsPDF. Please refer to the following links for additional documentation, samples, and guidance with the module:<p>Author: Malcolm Hollingsworth</p><p>Repository: <a class="ulink" href="https://github.com/Core-13">https://github.com/Core-13</a>
</p><p>Sponsoring organization: Core13; website: <a class="ulink" href="http://core13.co.uk">core13.co.uk</a>
</p></li></ul></div></div></div>
<div class="section" title="Creating a scheduling chart using RGraph"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Creating a scheduling chart using RGraph</h1></div></div></div><p>A picture<a id="id488" class="indexterm"/> can be worth a thousand words, and in today's fast-paced business environments, using graphics to display information can be a competitive <a id="id489" class="indexterm"/>advantage. This recipe demonstrates how you can use the popular RGraph JavaScript library to create a chart reflecting project scheduling. The following screenshots illustrate what this recipe will look like when completed:</p><div class="mediaobject"><img src="graphics/5343OT_05_13.jpg" alt="Creating a scheduling chart using RGraph"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec81"/>Getting ready</h2></div></div></div><p>This recipe uses RGraph and several non-native components to display the chart. These components can be downloaded from the source code provided by the book, or individually through the links provided in the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. </p><p>The first step in setting up this recipe is to copy the <code class="literal">web</code> folder (highlighted in the following screenshot) into the <code class="literal">Resources</code> folder of your project folder. After copying the <code class="literal">web</code> folder, you will need to then copy the <code class="literal">teamBuilder.js</code>, <code class="literal">chartLauncher.js</code>, <code class="literal">sampleUI.js</code>, and <code class="literal">scheduleBuilder.js</code> files into the <code class="literal">Resources</code> folder of your Titanium project, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_14.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec82"/>How to do it…</h2></div></div></div><p>After adding <a id="id490" class="indexterm"/>the <code class="literal">web</code> folder and CommonJS modules, <a id="id491" class="indexterm"/>as discussed earlier, you will need to create your application namespaces in the <code class="literal">app.js</code> file and use <code class="literal">require</code> to import the module into your code, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
    schedule : require('scheduleBuilder'),team : require('teamBuilder'),chartDisplay : require('chartLauncher'),sampleUI : require('sampleUI')
};</pre></div><div class="section" title="Creating a UI for the recipe"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec147"/>Creating a UI for the recipe</h3></div></div></div><p>The next <a id="id492" class="indexterm"/>step in this recipe is to create the main <code class="literal">Ti.UI.Window</code> window. This <code class="literal">Ti.UI.Window</code> will be used to launch the recipe's functionality.</p><div class="informalexample"><pre class="programlisting">var win = Ti.UI.createWindow({
  backgroundColor: '#fff', title: 'RGraph Sample'
});</pre></div><p>After the <code class="literal">Ti.UI.Window</code> window is created, the <code class="literal">fetchDemoView</code> method is called on our <code class="literal">sampleUI</code> module. <a id="id493" class="indexterm"/>This displays the recipe's instructions to the user:</p><div class="informalexample"><pre class="programlisting">win.add(my.sampleUI.fetchDemoView());</pre></div></div><div class="section" title="Creating schedules and assigning tasks"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec148"/>Creating schedules and assigning tasks</h3></div></div></div><p>This section<a id="id494" class="indexterm"/> of the recipe demonstrates how to create schedules, and assign<a id="id495" class="indexterm"/> tasks to individuals on your project.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first step is to create a schedule for a team member. This is done by creating a new schedule object and providing the individual's name. The following line demonstrates how to create a schedule for Richard:<div class="informalexample"><pre class="programlisting">var richard = new my.schedule('Richard');</pre></div></li><li class="listitem">Next, the <code class="literal">createTask</code> method is used to create a task for the individual.<div class="informalexample"><pre class="programlisting">richard.addTask({
    taskName:'Website',startDay:15,
    duration:28,percentageComplete:67,
    comment:'Work on website'
});
richard.addTask({
    taskName:'Fix Web Servers',startDay:40,
    duration:15,percentageComplete:50,
    comment:'Work with vendor'
});</pre></div><p>The <code class="literal">createTask</code> method has the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Task name</strong></span>: A string containing the name of the task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Start on day</strong></span>: This is the position (day) the task is to start</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Duration</strong></span>: The number of days the task will take</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Percentage complete</strong></span>: The percentage completion of the task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Comment</strong></span>: The comment for the task</li></ul></div></li><li class="listitem">Finally, the team member's schedule is added to the team:<div class="informalexample"><pre class="programlisting">my.team.add(richard);</pre></div></li></ol></div><p>The next snippet demonstrates how to perform the steps discussed earlier, for another team member:</p><div class="informalexample"><pre class="programlisting">var rachel = new my.schedule('Rachel');
rachel.addTask({
    taskName:'Mock-up',startDay:0, 
    duration:28, percentageComplete:50,
    comment:'Create initial product mock-ups'
});
rachel.addTask({
    taskName:'Mobile Images',startDay:40,
    duration:25, percentageComplete:74,
    comment:'Create mobile assets'
});
my.team.add(rachel);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip31"/>Tip</h3><p>You can add additional individuals by following the pattern detailed here.</p></div></div></div><div class="section" title="Launching the example"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec149"/>Launching the example</h3></div></div></div><p>Perform the<a id="id496" class="indexterm"/> following steps to launch the example we created in the previous section:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The first step is to add the <code class="literal">goButton</code> button to the <code class="literal">Ti.UI.Window</code> window to allow the user to launch the chart sample:<div class="informalexample"><pre class="programlisting">var goButton = Ti.UI.createButton({
    title:'View schedule', bottom:'40dp',left:'25dp',right:'25dp', width:Ti.UI.FILL, height:'60dp'
});
win.add(goButton);</pre></div></li><li class="listitem">The click event of the <code class="literal">goButton</code> button launches the chart example by using the <code class="literal">openDialog</code> method on the <code class="literal">chartLauncher</code> module. The <code class="literal">openDialog</code> method uses the <code class="literal">my.team</code> object created previously to generate a Gantt chart containing a team schedule.<div class="informalexample"><pre class="programlisting">    goButton.addEventListener('click',function(e){</pre></div><p>Calling the <code class="literal">openDialog</code> method is demonstrated in the following snippet:</p><div class="informalexample"><pre class="programlisting">      my.chartDisplay.openDialog(my.team);
    });</pre></div></li></ol></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec83"/>How it works…</h2></div></div></div><p>The <code class="literal">chartLauncher</code> module<a id="id497" class="indexterm"/> (<code class="literal">chartLauncher.js</code>) is used to display the team's scheduled tasks. The following line demonstrates how this module uses RGraph to create a Gantt chart with the results. First, the <code class="literal">openDialog</code> method is added to the <code class="literal">exports</code> object:</p><div class="informalexample"><pre class="programlisting">exports.openDialog = function(team){</pre></div><p>The next step in this part of the recipe is to create a window to display to the user:</p><div class="informalexample"><pre class="programlisting">  var win = Ti.UI.createWindow({
      backgroundColor: '#fff', title: 'Sample Chart',barColor:'#000'
  });</pre></div><p>After <code class="literal">Ti.UI.Window</code> is created, a <code class="literal">Ti.UI.WebView</code> object is attached. The RGraph chart information is contained in the <code class="literal">index.html</code> file that <code class="literal">Ti.UI.WebView</code> displays:</p><div class="informalexample"><pre class="programlisting">  var webView = Ti.UI.createWebView({
    height:Ti.UI.FILL, width:Ti.UI.FILL, url:'web/index.html'
  });
  win.add(webView)</pre></div><p>On the <code class="literal">Ti.UI.Window</code> open <a id="id498" class="indexterm"/>event, the team's schedule information is passed into the <code class="literal">index.html</code> file containing the RGraph methods:</p><div class="informalexample"><pre class="programlisting">  win.addEventListener('open',function(e){</pre></div><p>The <code class="literal">createSchedules</code> and <code class="literal">createComments</code> methods are called on the team object. These format the schedule and comment information so that RGraph can display the details.</p><div class="informalexample"><pre class="programlisting">    var schedules = JSON.stringify(team.createSchedule());
    var comments = JSON.stringify(team.createComments());</pre></div><p>A load event listener is added to <code class="literal">Ti.UI.WebView</code> after the <code class="literal">Ti.UI.Window</code> window is opened. This allows for the contents of <code class="literal">Ti.UI.WebView</code> to be fully loaded before the information is injected.</p><div class="informalexample"><pre class="programlisting">    webView.addEventListener('load',function(x){</pre></div><p>The <code class="literal">evalJS</code> method is used to pass the formatted team information to the <code class="literal">addGraph</code> method currently being displayed in <code class="literal">Ti.UI.WebView</code>. You can view the contents of the <code class="literal">addGraph</code> method by opening the <code class="literal">index.html</code> file supported with this recipe.</p><div class="informalexample"><pre class="programlisting">      webView.evalJS('addGraph(' + schedules + ',' + comments  + ')');
    });
    win.open({modal:true});
  };</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec84"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This recipe uses the powerful RGraph HTML5/JavaScript canvas library to create the Gantt chart displayed. I encourage you to visit their website, <a class="ulink" href="https://rgraph.net">https://rgraph.net</a>, to learn more about RGraph and the different charting options provided.</li></ul></div></div></div>
<div class="section" title="Displaying information with Google gauges"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Displaying information with Google gauges</h1></div></div></div><p>Gauges<a id="id499" class="indexterm"/> are a powerful way to display velocity, status, or simple measurements. This recipe<a id="id500" class="indexterm"/> demonstrates how<a id="id501" class="indexterm"/> to use the Google gauge chart control to display progress towards meeting monthly sales targets. The following screenshots show this completed recipe running on both iOS and Android:</p><div class="mediaobject"><img src="graphics/5343OT_05_15.jpg" alt="Displaying information with Google gauges"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip32"/>Tip</h3><p>When running this recipe on Android, please note Android 4.0 or higher is required.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec85"/>Getting ready</h2></div></div></div><p>This recipe uses<a id="id502" class="indexterm"/> Google Charts to display the gauge. When adding this recipe to your app, you will need to design for a network dependency as Google Charts requires a connection to render chart information. These components can be downloaded from the source code provided by the book, or individually through the links provided in the <span class="emphasis"><em>See also</em></span> section at the end of this recipe. The first step in setting up this recipe is to copy the <code class="literal">web</code> folder highlighted in the following screenshot into the <code class="literal">Resources</code> folder of your project folder. After copying the <code class="literal">web</code> folder, you will need to copy the <code class="literal">persist.js</code> file into the <code class="literal">Resources</code> folder of your Titanium project as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5343OT_05_16.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec86"/>How to do it…</h2></div></div></div><p>After adding the <code class="literal">web</code> folder and <code class="literal">persist.js</code> CommonJS module as discussed in he previous section, <a id="id503" class="indexterm"/>you will need to create your application namespaces and use <code class="literal">require</code> to import the module into your code, as the following snippet demonstrates:</p><div class="informalexample"><pre class="programlisting">//Create our application namespace
var my = {
  persist : require('persist'),
  session:{},
  isAndroid : Ti.Platform.osname === 'android'
};</pre></div><div class="section" title="Loading saved sales information"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec150"/>Loading saved sales information</h3></div></div></div><p>After<a id="id504" class="indexterm"/> our namespace has been created, the first step is to load our saved sales information. If no prior sales data has been saved, a default of 10 is provided.</p><div class="informalexample"><pre class="programlisting">my.session.sales = my.persist.load();</pre></div></div><div class="section" title="Creating a UI for the recipe"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec151"/>Creating a UI for the recipe</h3></div></div></div><p>Now we <a id="id505" class="indexterm"/>create the UI to display our sales data.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, a <code class="literal">Ti.UI.Window</code> window is created to host all of our UI elements:<div class="informalexample"><pre class="programlisting">var win = Ti.UI.createWindow({
    backgroundColor: '#fff', title: 'Sales Gauge', barColor:'#000', layout:'vertical',fullscreen:false
});</pre></div></li><li class="listitem">Next, a <code class="literal">Ti.UI.WebView</code> is created to display the Google gauge. This <code class="literal">Ti.UI.WebView</code> is used to display a local html page that hosts the Google Chart control. The following snippet demonstrates how to load a local html page (<code class="literal">index.html</code>) from the project's <code class="literal">web</code> folder:<div class="informalexample"><pre class="programlisting">var webView = Ti.UI.createWebView({
  top:10, height:200, width:200, url:'web/index.html'
});
win.add(webView)</pre></div></li><li class="listitem">Finally, a <code class="literal">Ti.UI.Slider</code> is added to the recipe's <code class="literal">Ti.UI.Window</code>. The user can use this slider to adjust their monthly sales.<div class="informalexample"><pre class="programlisting">var slider = Ti.UI.createSlider({
    min:0, max:100, value:my.session.sales, left:10, right:10, height:'30dp', top:10
});
win.add(slider);</pre></div></li></ol></div></div><div class="section" title="Adjusting sales"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec152"/>Adjusting sales</h3></div></div></div><p>As the <a id="id506" class="indexterm"/>user adjusts the <code class="literal">Ti.UI.Slider</code>, the following methods are used to update the Google gauge with the new sales numbers. The <code class="literal">updateSales</code> method updates the contents of <code class="literal">Ti.UI.WebView</code> with the new sales number:</p><div class="informalexample"><pre class="programlisting">function updateSales(sales){</pre></div><p>The passed-in <code class="literal">sales</code> value is placed into the session's <code class="literal">my.session.sales</code> property for later use:</p><div class="informalexample"><pre class="programlisting">  my.session.sales = sales;</pre></div><p>The <code class="literal">evalJS</code> method is called on <code class="literal">Ti.UI.WebView</code> to provide the new sales information to the <code class="literal">updateGauge</code> method contained within the example <code class="literal">index.html</code> file. This method is used to update the Google gauge. For more details, please see the contents of this recipe's <code class="literal">index.html</code> file.</p><div class="informalexample"><pre class="programlisting">  webView.evalJS('updateGauge(' + my.session.sales + ')');</pre></div><p>After updating <code class="literal">Ti.UI.WebView</code>, the new sales value is saved into <code class="literal">Ti.App.Properties</code> for later use:</p><div class="informalexample"><pre class="programlisting">  my.persist.save(my.session.sales);
};</pre></div><p>The change <a id="id507" class="indexterm"/>event on the recipe's <code class="literal">Ti.UI.Slider</code> method adjusts the Google gauge as the user moves the slider:</p><div class="informalexample"><pre class="programlisting">  slider.addEventListener('change',function(e){</pre></div><p>Each time the change event is fired, the new <code class="literal">Ti.UI.Slider</code> value is provided to the <code class="literal">updateSales</code> method, to be reflected by the Google gauge hosted in the recipe's <code class="literal">Ti.Ui.WebView</code>.</p><div class="informalexample"><pre class="programlisting">  updateSales(Math.round(e.value));
});</pre></div></div><div class="section" title="Reloading saved sales"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec153"/>Reloading saved sales</h3></div></div></div><p>Each<a id="id508" class="indexterm"/> time <code class="literal">Ti.Ui.Window</code> is loaded, the following code is use to display the saved sales values and initialize the Google gauge. The next snippet demonstrates how the recipe reloads the sales information on opening <code class="literal">Ti.UI.Window</code>:</p><div class="informalexample"><pre class="programlisting">win.addEventListener('open',function(e){</pre></div><p>First, a network connection is performed. Since the recipe uses Google Charts, a network connection is required to display this information:</p><div class="informalexample"><pre class="programlisting">  if(!Ti.Network.online){
    alert('Network connection required.');
    return;
  }</pre></div><p>Finally, a load event listener is added to <code class="literal">Ti.UI.WebView</code>. Once loaded, the <code class="literal">updateSales</code> function is called to initialize any previously saved sales information:</p><div class="informalexample"><pre class="programlisting">  webView.addEventListener('load',function(x){
    assist.updateSales(my.session.sales); 
  });</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec87"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This recipe uses Google Charts to provide the gauges displayed. To learn more about Google's charting tools, please visit their developer site, <a class="ulink" href="https://google-developers.appspot.com/chart/">https://google-developers.appspot.com/chart/</a>.</li></ul></div></div></div></body></html>