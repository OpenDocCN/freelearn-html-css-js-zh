<html><head></head><body>
<div id="_idContainer029">
<h1 class="chapter-number" id="_idParaDest-137"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.1.1">11</span></h1>
<h1 id="_idParaDest-138"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.2.1">Modules and Secrets</span></h1>
<p><span class="koboSpan" id="kobo.3.1">While routing is certainly important to SvelteKit, there is far more to it than just that. </span><span class="koboSpan" id="kobo.3.2">Throughout this book, we’ve utilized multiple different SvelteKit modules. </span><span class="koboSpan" id="kobo.3.3">For instance, we’ve imported bindings from </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1">$app/forms</span></strong><span class="koboSpan" id="kobo.5.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.6.1">$app/environment</span></strong><span class="koboSpan" id="kobo.7.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.8.1">$app/stores</span></strong><span class="koboSpan" id="kobo.9.1">, to name a few. </span><span class="koboSpan" id="kobo.9.2">But we have yet to explore what these modules are or how they work. </span><span class="koboSpan" id="kobo.9.3">In this chapter, we’ll give a brief overview of some of the modules we’ve seen previously as well as some we have not yet seen. </span><span class="koboSpan" id="kobo.9.4">We’ll also cover some of the modules used for managing secrets and when to use </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">which ones.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">In this chapter, we’ll examine </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">SvelteKit </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">Module Summaries</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Keeping </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">Secrets Safe</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1">Having covered various modules, as well as examining our previous example of storing GitHub API secrets, we’ll have a clear understanding of when best to harness the power of each </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">individual module.</span></span></p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.20.1">The complete code for this chapter is available on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">at: </span></span><a href="https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter11"><span class="No-Break"><span class="koboSpan" id="kobo.22.1">https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter11</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.23.1">.</span></span></p>
<h1 id="_idParaDest-140"><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.24.1">SvelteKit Module Summaries</span></h1>
<p><span class="koboSpan" id="kobo.25.1">In previous chapters, we’ve used several different modules but only provided short explanations. </span><span class="koboSpan" id="kobo.25.2">While the analysis in this section will also be brief, it should provide a broad enough insight that prospective SvelteKit developers feel familiar with the workings of available modules. </span><span class="koboSpan" id="kobo.25.3">We have encountered a few listed here but there are some that we are yet to cover. </span><span class="koboSpan" id="kobo.25.4">For more in-depth explanations, see the resources at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">this chapter.</span></span></p>
<h2 id="_idParaDest-141"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.27.1">$app/environment</span></h2>
<p><span class="koboSpan" id="kobo.28.1">To begin</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.29.1"> our analysis of modules, let’s start with one that we have used relatively recently. </span><span class="koboSpan" id="kobo.29.2">In </span><a href="B19024_09_Final_AM.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.30.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.31.1">, while attempting to throw an error in the client, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.32.1">$app/environment</span></strong><span class="koboSpan" id="kobo.33.1"> module and imported </span><strong class="source-inline"><span class="koboSpan" id="kobo.34.1">browser</span></strong><span class="koboSpan" id="kobo.35.1">. </span><span class="koboSpan" id="kobo.35.2">As we’ve come to expect with SvelteKit naming conventions, all of the bindings exported from this module pertain to the application environment. </span><span class="koboSpan" id="kobo.35.3">This makes it trivial to identify the purpose of each of the bindings by their names. </span><span class="koboSpan" id="kobo.35.4">For instance, we saw that </span><strong class="source-inline"><span class="koboSpan" id="kobo.36.1">browser</span></strong><span class="koboSpan" id="kobo.37.1"> returns a Boolean value based on whether or not the environment it is being run in is the client. </span><span class="koboSpan" id="kobo.37.2">Likewise, </span><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">building</span></strong><span class="koboSpan" id="kobo.39.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.40.1">dev</span></strong><span class="koboSpan" id="kobo.41.1"> will return Boolean values based on whether or not the code is being run during the build process or in our development environment, respectively. </span><span class="koboSpan" id="kobo.41.2">The final export from </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">$app/environment</span></strong><span class="koboSpan" id="kobo.43.1"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">version</span></strong><span class="koboSpan" id="kobo.45.1">. </span><span class="koboSpan" id="kobo.45.2">While </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">version</span></strong><span class="koboSpan" id="kobo.47.1"> is still appropriately named, it’s important to note that it doesn’t refer to the version of SvelteKit. </span><span class="koboSpan" id="kobo.47.2">Rather, it refers to the version of the application build. </span><span class="koboSpan" id="kobo.47.3">The value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">version</span></strong><span class="koboSpan" id="kobo.49.1"> is determined by the Unix timestamp at the time of building. </span><span class="koboSpan" id="kobo.49.2">SvelteKit uses this string value to check for a new version when client-side navigation encounters an error and defaults to standard navigation practices by making a </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">full-page load.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.51.1">$app/forms</span></h2>
<p><span class="koboSpan" id="kobo.52.1">When we</span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.53.1"> utilized </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">enhance</span></strong><span class="koboSpan" id="kobo.55.1"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">$app/forms</span></strong><span class="koboSpan" id="kobo.57.1"> in </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.58.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.59.1">, we saw how it could </span><em class="italic"><span class="koboSpan" id="kobo.60.1">progressively enhance</span></em><span class="koboSpan" id="kobo.61.1"> our form submissions by sending data in the background instead of requiring our entire page to be reloaded when submitting the form. </span><span class="koboSpan" id="kobo.61.2">If the default behavior of </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">enhance</span></strong><span class="koboSpan" id="kobo.63.1"> has not quite satisfied our needs, it can be customized. </span><span class="koboSpan" id="kobo.63.2">If we decide to change its default behavior and provide it with a custom callback function, </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">applyAction</span></strong><span class="koboSpan" id="kobo.65.1"> can be used to update the data within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">form</span></strong><span class="koboSpan" id="kobo.67.1"> property of our components. </span><span class="koboSpan" id="kobo.67.2">The final binding we can import from </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">$app/forms</span></strong><span class="koboSpan" id="kobo.69.1"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">deserialize</span></strong><span class="koboSpan" id="kobo.71.1">, which is a helpful function when deserializing response data from a </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">form submission.</span></span></p>
<h2 id="_idParaDest-143"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.73.1">$app/navigation</span></h2>
<p><span class="koboSpan" id="kobo.74.1">As</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.75.1"> expected, </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">$app/navigation</span></strong><span class="koboSpan" id="kobo.77.1"> provides tools pertaining to navigation. </span><span class="koboSpan" id="kobo.77.2">We previously used </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">invalidateAll</span></strong><span class="koboSpan" id="kobo.79.1"> in </span><a href="B19024_05_Final_AM.xhtml#_idTextAnchor072"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.80.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.81.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.82.1">invalidate</span></strong><span class="koboSpan" id="kobo.83.1"> in </span><a href="B19024_09_Final_AM.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.84.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.85.1"> from this module. </span><span class="koboSpan" id="kobo.85.2">In both of those instances, we did so to force </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">load()</span></strong><span class="koboSpan" id="kobo.87.1"> to run again. </span><span class="koboSpan" id="kobo.87.2">Some other helpful bindings from this module are </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">afterNavigate</span></strong><span class="koboSpan" id="kobo.89.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">beforeNavigate</span></strong><span class="koboSpan" id="kobo.91.1">. </span><span class="koboSpan" id="kobo.91.2">Both of these bindings run callback functions at specific timings within the SvelteKit life cycle. </span><span class="koboSpan" id="kobo.91.3">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">afterNavigate</span></strong><span class="koboSpan" id="kobo.93.1">, the provided callback is executed once the current component has mounted and after the user has navigated to a new URL. </span><span class="koboSpan" id="kobo.93.2">The callback function for </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">beforeNavigate</span></strong><span class="koboSpan" id="kobo.95.1"> is run just before navigating to a </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">new URL.</span></span></p>
<p><span class="koboSpan" id="kobo.97.1">Some</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.98.1"> other bindings available from this particular module include </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">disableScrollHandling</span></strong><span class="koboSpan" id="kobo.100.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">goto</span></strong><span class="koboSpan" id="kobo.102.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">preloadCode</span></strong><span class="koboSpan" id="kobo.104.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">preloadData</span></strong><span class="koboSpan" id="kobo.106.1">. </span><span class="koboSpan" id="kobo.106.2">If we wanted to change how SvelteKit manages the browser window scrolling position, we could disable it entirely by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">disableScrollHandling()</span></strong><span class="koboSpan" id="kobo.108.1">. </span><span class="koboSpan" id="kobo.108.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">goto()</span></strong><span class="koboSpan" id="kobo.110.1"> function provides developers with the ability to navigate to another URL while also including options that allow for the management browser history, keeping focus applied to a particular element, and even triggering the rerun of </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">load()</span></strong><span class="koboSpan" id="kobo.112.1"> functions. </span><span class="koboSpan" id="kobo.112.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">preloadCode()</span></strong><span class="koboSpan" id="kobo.114.1"> function allows developers to import the code for a particular route before that route has been navigated to, while </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">preloadData()</span></strong><span class="koboSpan" id="kobo.116.1"> will do the same as well as calling the route’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">load()</span></strong><span class="koboSpan" id="kobo.118.1"> function. </span><span class="koboSpan" id="kobo.118.2">The same behavior of </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">preloadData()</span></strong><span class="koboSpan" id="kobo.120.1"> is found when </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">&lt;a&gt;</span></strong><span class="koboSpan" id="kobo.122.1"> elements are given the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">data-sveltekit-preload-data</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.124.1"> attribute.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.125.1">$app/paths</span></h2>
<p><span class="koboSpan" id="kobo.126.1">When</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.127.1"> we need to manipulate file paths or create links to routes for our application that reside in a sub-directory, we can rely on </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">$app/paths</span></strong><span class="koboSpan" id="kobo.129.1">. </span><span class="koboSpan" id="kobo.129.2">Both </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">assets</span></strong><span class="koboSpan" id="kobo.131.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">base</span></strong><span class="koboSpan" id="kobo.133.1"> will return a string value that can be customized in </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">svelte.config.js</span></strong><span class="koboSpan" id="kobo.135.1"> under </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">config.kit.paths</span></strong><span class="koboSpan" id="kobo.137.1">. </span><span class="koboSpan" id="kobo.137.2">If the application is being served from a subdirectory, we can prepend manually written routes with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">{base}</span></strong><span class="koboSpan" id="kobo.139.1"> text to ensure our application serves the route from the correct directory and does not attempt to serve the route from the domain root directory. </span><span class="koboSpan" id="kobo.139.2">The value provided by </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">base</span></strong><span class="koboSpan" id="kobo.141.1"> must always be a root-relative path that begins with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">/</span></strong><span class="koboSpan" id="kobo.143.1"> but never ends with one. </span><span class="koboSpan" id="kobo.143.2">Conversely, </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">assets</span></strong><span class="koboSpan" id="kobo.145.1"> will always be an absolute path to the </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">application files.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.147.1">$app/stores</span></h2>
<p><span class="koboSpan" id="kobo.148.1">The</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.149.1"> SvelteKit developers were kind enough to provide developers with a few readable stores that can supply us with helpful information. </span><span class="koboSpan" id="kobo.149.2">When importing from </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">$app/stores</span></strong><span class="koboSpan" id="kobo.151.1">, we’ll have access to </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">navigating</span></strong><span class="koboSpan" id="kobo.153.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">page</span></strong><span class="koboSpan" id="kobo.155.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">updated</span></strong><span class="koboSpan" id="kobo.157.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">getStores</span></strong><span class="koboSpan" id="kobo.159.1">. </span><span class="koboSpan" id="kobo.159.2">During navigation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">navigating</span></strong><span class="koboSpan" id="kobo.161.1"> will be populated with an object consisting of metadata such as where the navigation event started, where it is going, and the type of navigation. </span><span class="koboSpan" id="kobo.161.2">The type can range from a form submission to a link click, or even a browser back-and-forward event. </span><span class="koboSpan" id="kobo.161.3">Once navigation has been completed, the value of this store will return to </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">null</span></strong><span class="koboSpan" id="kobo.163.1">. </span><span class="koboSpan" id="kobo.163.2">Meanwhile, </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">page</span></strong><span class="koboSpan" id="kobo.165.1"> serves as a store that</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.166.1"> contains information related to the currently viewed page. </span><span class="koboSpan" id="kobo.166.2">We used it back in </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.167.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.168.1"> to display the current page’s error message. </span><span class="koboSpan" id="kobo.168.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">updated</span></strong><span class="koboSpan" id="kobo.170.1"> store will return a Boolean value after SvelteKit has checked whether or not a new version of the application has been detected. </span><span class="koboSpan" id="kobo.170.2">All of these stores can be retrieved by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">getStores()</span></strong><span class="koboSpan" id="kobo.172.1">but doing so is not recommended and should only be done when the store subscription needs to be paused until after a component has mounted. </span><span class="koboSpan" id="kobo.172.2">Otherwise, all store values can be accessed by prefixing the store name with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">$</span></strong><span class="koboSpan" id="kobo.174.1"> symbol, which will automatically handle the </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">subscription process.</span></span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.176.1">$service-worker</span></h2>
<p><span class="koboSpan" id="kobo.177.1">When</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.178.1"> building a </span><strong class="bold"><span class="koboSpan" id="kobo.179.1">PWA</span></strong><span class="koboSpan" id="kobo.180.1">, we will inevitably find ourselves configuring a service worker. </span><span class="koboSpan" id="kobo.180.2">For these cases, we’re provided with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">$service-worker</span></strong><span class="koboSpan" id="kobo.182.1"> module, which can only be used within a service worker. </span><span class="koboSpan" id="kobo.182.2">When importing bindings, we’ll have access to </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">base</span></strong><span class="koboSpan" id="kobo.184.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">build</span></strong><span class="koboSpan" id="kobo.186.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">files</span></strong><span class="koboSpan" id="kobo.188.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">prerendered</span></strong><span class="koboSpan" id="kobo.190.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">version</span></strong><span class="koboSpan" id="kobo.192.1">. </span><span class="koboSpan" id="kobo.192.2">Again, sane naming conventions come to our rescue and mostly explain the type of data returned from each of these bindings. </span><span class="koboSpan" id="kobo.192.3">We can receive a string value from </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">base</span></strong><span class="koboSpan" id="kobo.194.1">, which works similarly to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">base</span></strong><span class="koboSpan" id="kobo.196.1"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">$app/paths</span></strong><span class="koboSpan" id="kobo.198.1">. </span><span class="koboSpan" id="kobo.198.2">It will provide us with the base path to the application even if the application exists in a subdirectory. </span><span class="koboSpan" id="kobo.198.3">The array of strings from </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">build</span></strong><span class="koboSpan" id="kobo.200.1"> will consist of URLs generated by Vite during the build process. </span><span class="koboSpan" id="kobo.200.2">Another array of strings, </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">files</span></strong><span class="koboSpan" id="kobo.202.1">, will provide details on static files or those included in </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">config.kit.files.assets</span></strong><span class="koboSpan" id="kobo.204.1">. </span><span class="koboSpan" id="kobo.204.2">For prerendered path names, we can retrieve the strings from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">prerendered</span></strong><span class="koboSpan" id="kobo.206.1"> array. </span><span class="koboSpan" id="kobo.206.2">And finally, we can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">version</span></strong><span class="koboSpan" id="kobo.208.1"> to determine the application version within our service </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">worker code.</span></span></p>
<p><span class="koboSpan" id="kobo.210.1">This list of modules is by no means comprehensive. </span><span class="koboSpan" id="kobo.210.2">Before leaning on them too heavily, it’s recommended to read the official SvelteKit documentation listed at the end of this chapter. </span><span class="koboSpan" id="kobo.210.3">Now that we’ve examined some of these modules, let’s move on to the modules that help us keep sensitive </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">information safe.</span></span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.212.1">Keeping secrets safe</span></h1>
<p><span class="koboSpan" id="kobo.213.1">When it comes to keeping secrets </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.214.1">such as API keys or database credentials safe, SvelteKit has us covered. </span><span class="koboSpan" id="kobo.214.2">As we saw in </span><a href="B19024_09_Final_AM.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.215.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.216.1">, we can import </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">.env</span></strong><span class="koboSpan" id="kobo.218.1"> secrets from </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">$env/static/private</span></strong><span class="koboSpan" id="kobo.220.1">. </span><span class="koboSpan" id="kobo.220.2">But this is not the only module that allows us to import environment variables. </span><span class="koboSpan" id="kobo.220.3">In this section, we’ll examine more modules and how they all can help us import environment variables as well </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">as secrets.</span></span></p>
<h2 id="_idParaDest-148"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.222.1">$env/static/private</span></h2>
<p><span class="koboSpan" id="kobo.223.1">Beginning</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.224.1"> with the module we’ve already used, </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">$env/static/private</span></strong><span class="koboSpan" id="kobo.226.1"> is great for importing environment variables like those specified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">.env</span></strong><span class="koboSpan" id="kobo.228.1"> files or those set when starting the runtime. </span><span class="koboSpan" id="kobo.228.2">For instance, if we were to start our application with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">API_KEY="" node index.js</span></strong><span class="koboSpan" id="kobo.230.1"> command, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">API_KEY</span></strong><span class="koboSpan" id="kobo.232.1"> variable would be available, just as </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">GITHUB</span></strong><span class="koboSpan" id="kobo.234.1"> was available after we imported </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">$env/static/private</span></strong><span class="koboSpan" id="kobo.236.1"> in </span><a href="B19024_09_Final_AM.xhtml#_idTextAnchor116"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.237.1">Chapter 9</span></em></span></a><span class="koboSpan" id="kobo.238.1">. </span><span class="koboSpan" id="kobo.238.2">Any environment variables provided when starting the application will override the value of those provided in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">.env</span></strong><span class="koboSpan" id="kobo.240.1"> file. </span><span class="koboSpan" id="kobo.240.2">The variables from this module are statically bundled within the application code at build time by Vite. </span><span class="koboSpan" id="kobo.240.3">This means less bundled code but also means that secrets will be included in the application build. </span><span class="koboSpan" id="kobo.240.4">We can confirm this by building the </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">following commands:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.242.1">
npm run build
grep -r 'YOUR_API_KEY' .svelte-kit/</span></pre>
<p><span class="koboSpan" id="kobo.243.1">Substituting </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">YOUR_API_KEY</span></strong><span class="koboSpan" id="kobo.245.1"> with your personal access token provided by GitHub will show the text and the file in our build where our API key has been injected. </span><span class="koboSpan" id="kobo.245.2">As such, we should be cautious not to commit builds to version control as doing so could then expose secrets. </span><span class="koboSpan" id="kobo.245.3">Fortunately for us, this module will only work with server-side code and will cause a build to fail if we attempt to import it into </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">client-side code.</span></span></p>
<h2 id="_idParaDest-149"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.247.1">$env/static/public</span></h2>
<p><span class="koboSpan" id="kobo.248.1">We</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.249.1"> can consider </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">$env/static/public</span></strong><span class="koboSpan" id="kobo.251.1"> a sibling to </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">$env/static/private</span></strong><span class="koboSpan" id="kobo.253.1">. </span><span class="koboSpan" id="kobo.253.2">The major difference is that this module will only import variables that begin with the value set in </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">config.kit.env.publicPrefix</span></strong><span class="koboSpan" id="kobo.255.1">. </span><span class="koboSpan" id="kobo.255.2">By default, this value is </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">PUBLIC_</span></strong><span class="koboSpan" id="kobo.257.1">. </span><span class="koboSpan" id="kobo.257.2">This allows us to keep our secrets all in the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">.env</span></strong><span class="koboSpan" id="kobo.259.1"> file while allowing us to specify which are safe to expose to clients and which are not. </span><span class="koboSpan" id="kobo.259.2">For example, the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">.env</span></strong><span class="koboSpan" id="kobo.261.1"> file would allow for </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">PUBLIC_GITHUB_USER</span></strong><span class="koboSpan" id="kobo.263.1"> to be imported into client-side code but not </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">GITHUB_TOKEN</span></strong><span class="koboSpan" id="kobo.265.1">. </span><span class="koboSpan" id="kobo.265.2">Even though both values exist in the same file, we can rest assured knowing that </span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.266.1">SvelteKit won’t tell our secrets to anyone other than the server we know we </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">can trust:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.268.1">.env</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.269.1">
GITHUB_TOKEN=YOUR_GITHUB_PERSONAL_ACCESS_TOKEN
PUBLIC_GITHUB_USER=YOUR_USERNAME_HERE</span></pre>
<h2 id="_idParaDest-150"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.270.1">$env/dynamic/private</span></h2>
<p><span class="koboSpan" id="kobo.271.1">Just </span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.272.1">as we cannot import </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">$env/static/private</span></strong><span class="koboSpan" id="kobo.274.1"> into client-side code, we cannot import </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">$env/dynamic/private</span></strong><span class="koboSpan" id="kobo.276.1"> into client-side code either. </span><span class="koboSpan" id="kobo.276.2">The difference between these two modules is that while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.277.1">$env/static</span></strong><span class="koboSpan" id="kobo.278.1"> modules have access to </span><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">.env</span></strong><span class="koboSpan" id="kobo.280.1"> files, </span><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">$env/dynamic</span></strong><span class="koboSpan" id="kobo.282.1"> has access to the environment variables specified by the adapter. </span><span class="koboSpan" id="kobo.282.2">Think back to </span><a href="B19024_08_Final_AM.xhtml#_idTextAnchor106"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.283.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.284.1"> when we deployed our application to Cloudflare. </span><span class="koboSpan" id="kobo.284.2">When we did that, we specified the environment variable </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">NODE_VERSION</span></strong><span class="koboSpan" id="kobo.286.1">. </span><span class="koboSpan" id="kobo.286.2">Obtaining the Node version likely isn’t very useful to us but using </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">$env/dynamic/private</span></strong><span class="koboSpan" id="kobo.288.1"> allows us to access other secrets set in our Cloudflare Pages project settings. </span><span class="koboSpan" id="kobo.288.2">This can be helpful when working in a team as sharing secrets can be done on the platform rather than passing around </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">.env</span></strong><span class="koboSpan" id="kobo.290.1"> files. </span><span class="koboSpan" id="kobo.290.2">When the platform the project will be deployed to has its own means of setting environment variables, it’s very likely you’ll be relying on </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">$env/dynamic</span></strong><span class="koboSpan" id="kobo.292.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">access them.</span></span></p>
<h2 id="_idParaDest-151"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.294.1">$env/dynamic/public</span></h2>
<p><span class="koboSpan" id="kobo.295.1">By following </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.296.1">the established pattern, this module should need little explanation. </span><span class="koboSpan" id="kobo.296.2">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">$env/dynamic/public</span></strong><span class="koboSpan" id="kobo.298.1">, we will only be able to import environment variables that begin with </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">PUBLIC_</span></strong><span class="koboSpan" id="kobo.300.1"> or whatever value has been specified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">config.kit.env.publicPrefix</span></strong><span class="koboSpan" id="kobo.302.1">. </span><span class="koboSpan" id="kobo.302.2">This works in the same way as </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">$env/static/public</span></strong><span class="koboSpan" id="kobo.304.1">. </span><span class="koboSpan" id="kobo.304.2">Of course, it differs from </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">$env/static/public</span></strong><span class="koboSpan" id="kobo.306.1"> because this is another dynamic module, which means it is specific to the configured environment adapter. </span><span class="koboSpan" id="kobo.306.2">For instance, if we were to add </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">PUBLIC_GITHUB_USER</span></strong><span class="koboSpan" id="kobo.308.1"> to our Cloudflare Pages environment variables, we would then be able to access the value of that environment variable using </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">this module.</span></span></p>
<h1 id="_idParaDest-152"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.310.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.311.1">There are a great many modules available within SvelteKit. </span><span class="koboSpan" id="kobo.311.2">Hopefully, this brief overview has given enough insight so that we know where to start with each of them. </span><span class="koboSpan" id="kobo.311.3">In the next chapter, we’ll examine some best practices for enhancing accessibility, which can come with the added benefit of improving </span><strong class="bold"><span class="koboSpan" id="kobo.312.1">Search Engine </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.313.1">Optimization</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.314.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.315.1">SEO</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">).</span></span></p>
<h1 id="_idParaDest-153"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.317.1">Resources</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.318.1">SvelteKit Module Documentation – </span><a href="https://kit.svelte.dev/docs/modules"><span class="No-Break"><span class="koboSpan" id="kobo.319.1">https://kit.svelte.dev/docs/modules</span></span></a></li>
</ul>
</div>
</body></html>