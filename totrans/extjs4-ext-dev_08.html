<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Message Bar</h1></div></div></div><p>In this chapter, we are going to develop an Ext JS extension, which will be a fancy animated message bar. The message bar will provide the facility for having a configurable duration timer for showing the message, a close button, and also will be able to customize the look and <a id="id327" class="indexterm"/>can provide optional icons for different types of states such as valid, invalid, or information during runtime.</p><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Functional requirements</li><li class="listitem" style="list-style-type: disc">Planning and coding the message bar</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec46"/>Functional requirements</h1></div></div></div><p>We are targeting to develop an Ext JS extension that can be used to show messages. This extension can be <a id="id328" class="indexterm"/>used within a container as a docked item to show messages. The message bar will be closed automatically when the configured timer is completed. This message bar will also provide a close button and on clicking on this button the message bar will be closed. The opening and closing of the message bar will be in a smooth animated form. This message bar can also accept configuration at runtime to show several types of state that it can change its look to, and can show a proper icon.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec47"/>Planning and coding the message bar</h1></div></div></div><p>To develop this <a id="id329" class="indexterm"/>extension, we can use the Ext JS toolbar and dock it to the <a id="id330" class="indexterm"/>bottom of the container. Then we can add a functionality where this toolbar can show the message text. Then we need to add a functionality when the message bar is called to show the message; the message bar appears and disappears when the close button is clicked upon or when the configured timer is completed. As per our functional requirement, we can see that the Ext JS library provided <code class="literal">StatusBar</code> extension is doing a lot that we needed to provide functionality for this message bar extension. So, we can modify that extension and add our own functionality and CSS styles to fulfill our requirement. Now let us start coding:</p><div><pre class="programlisting">Ext.define('Examples.ux.MessageBar', {
  extend: 'Ext.toolbar.Toolbar',
  alias: 'widget.ux-msgbar',
  activeThreadId: 0,
  dock: 'bottom',
  config: {
    cls: 'x-messagebar',
    emptyText: '',
    defaultText: '',
    autoClear: 5000
  },


  initComponent: function () {
    this.callParent(arguments);
  },
…</pre></div><p>After defining<a id="id331" class="indexterm"/> the class configuration, now let us create the element<a id="id332" class="indexterm"/> where the message text will be shown—the icon and the <a id="id333" class="indexterm"/>close button. Now let us define the <code class="literal">afterRender</code> handler<a id="id334" class="indexterm"/> where we will create those elements:</p><div><pre class="programlisting">afterRender: function () {

  this.el.addCls('x-message-msgbar-body');

  this.currIconCls = this.iconCls || this.defaultIconCls;
  var me = this;

  setTimeout(function () {

    var tpl = new Ext.XTemplate(
      '&lt;div id="{id}-bar" class="{bodyCls}"',
      ' style="width: {width}px; {left}"&gt;',
      '&lt;div class="{msgCls}"&gt;&lt;/div&gt;',
      '&lt;div style="float:right" class="{closeCls}"&gt;X&lt;/div&gt;',
      '&lt;/div&gt;'
    );

    tpl = tpl.apply({
      id: me.id,
      bodyCls: 'x-message-msgbar-body',
      width: me.ownerCt.getWidth() - 10,
      left: Ext.isIE8 ? 'left:5px' : '',
      msgCls: 'x-message-bar-msg',
      closeCls: 'x-message-bar-close'
    });

    me.ownerCt.el.createChild(tpl);

    Ext.select('.x-message-bar-close').on('click', function () {
      me.clearMessage();
    });

  }, 500);

  this.hide();
  this.callParent(arguments);
}</pre></div><p>You can see how we are creating those elements. We have also defined the click handler for the <a id="id335" class="indexterm"/>close button. We are calling the <code class="literal">clearMessage</code> function<a id="id336" class="indexterm"/> whenever the close button is clicked. We will define this <a id="id337" class="indexterm"/>function later in this chapter. We need to take care that <a id="id338" class="indexterm"/>whenever the container is resized, we also need to resize the message bar element. So, now let us add some code to handle this within the <a id="id339" class="indexterm"/>
<code class="literal">afterRender</code> handler:</p><div><pre class="programlisting">this.ownerCt.on('resize', function (ownerContainer, width, height) {
  if (width == this.parentWidth &amp;&amp; height == this.parentHeight) {
    return;
  }

  var bar = Ext.get(this.id + '-bar');

  if (bar) {
    bar.setStyle('width', (this.ownerCt.getWidth()-10)  + 'px');
  }
}, this);</pre></div><p>Now let us define the <a id="id340" class="indexterm"/>
<code class="literal">showMessage</code> function, which will be called to show the message with the provided configuration:</p><div><pre class="programlisting">showMessage: function (msg) {

  if (Ext.isString(msg)) {
    msg = {
      text: msg
    }
  }

  this.setMessage({
    text: msg.text,
    iconCls: 'x-message-'
    + (msg.type || '') + ' ',
    clear: Ext.isDefined(msg.clear) ? msg.clear : true
  });

}</pre></div><p>Within this<a id="id341" class="indexterm"/> function, we are checking the provided configuration<a id="id342" class="indexterm"/> and preparing the configuration properly and sending<a id="id343" class="indexterm"/> that to the <code class="literal">setMessage</code> function. Now let us define <a id="id344" class="indexterm"/>the <code class="literal">setMessage</code> function:</p><div><pre class="programlisting">setMessage: function (o) {
  if (o &amp;&amp; (o.text == '' || o.text == '&amp;nbsp;')) {
    return;
  } else {
    var cmp = Ext.get(this.id + '-bar');
    if (cmp) {
      cmp.slideIn('b', {
        duration: 300,
        easing: 'easeIn',
        callback: function () {
          this.setMessageData(o);
        },
        scope: this
      });
    }
  }
}</pre></div><p>In this function, we are checking whether the message text is empty or not, and if it is not empty, we are opening <a id="id345" class="indexterm"/>the message bar and calling the <code class="literal">setMessageData</code> function to set the message text, UI, and proper icon for the message bar. Let us now define the <code class="literal">setMessageData</code> function:</p><div><pre class="programlisting">setMessageData: function (o) {
  o = o || {};
  if (o.text !== undefined) {
    this.setText(o.text);
  }
  if (o.iconCls !== undefined) {
    var bar = Ext.get(this.id + '-bar');
    if (o.iconCls == 'x-message-error ') {
      bar.removeCls('x-message-msg-body');
      bar.addCls('x-message-error-body');
    } else {
      bar.removeCls('x-message-error-body');
      bar.addCls('x-message-msg-body');
    }
    this.setIcon(o.iconCls);
  }
  if (o.clear) {
    var c = o.clear, wait = this.autoClear, defaults = {
      useDefaults: true,
      anim: true
    };
    if (Ext.isObject(c)) {
      c = Ext.applyIf(c, defaults);
      if (c.wait) {
        wait = c.wait;
      }
    } else if (Ext.isNumber(c)) {
      wait = c;
      c = defaults;
    } else if (Ext.isBoolean(c)) {
      c = defaults;
    }
    c.threadId = this.activeThreadId;
    if (this.clearTimer) {
      clearTimeout(this.clearTimer);
    }
    this.clearTimer = Ext.defer(this.clearMessage, wait, this, [c]);
  }
}</pre></div><p>You can see that<a id="id346" class="indexterm"/> within this function we are setting the message <a id="id347" class="indexterm"/>text, icon, and UI. To set the message text we are calling the <code class="literal">setText</code> function<a id="id348" class="indexterm"/>, to change the UI we are adding and removing the corresponding CSS classes, and to set the icon we are calling the <code class="literal">setIcon</code> function<a id="id349" class="indexterm"/>. Also, when the <a id="id350" class="indexterm"/>clear configuration option is set to <code class="literal">true</code>, we are applying the configured timer to <a id="id351" class="indexterm"/>hide the message bar when the timer is completed. Now let us define the <code class="literal">clearMessage</code> function:</p><div><pre class="programlisting">clearMessage: function (o) {
  o = o || {};
  if (o.threadId &amp;&amp; o.threadId !== this.activeThreadId) {
    return this;
  }
  var bar = Ext.get(this.id + '-bar');
  if (bar) {
    Ext.get(this.id + '-bar').slideOut('b', {
      duration: 300,
      easing: 'easeOut',
      callback: function () {
        var text = o.useDefaults ? this.defaultText : this.emptyText,
        iconCls = o.useDefaults ? (this.defaultIconCls ? this.defaultIconCls : '') : '';
        this.setMessage({
          text: text,
          iconCls: iconCls
        });
      },
      scope: this
    });
  }
  return this;
}</pre></div><p>And here in <a id="id352" class="indexterm"/>this <code class="literal">clearMessage</code> function we are hiding the message bar.</p><p>Now let us have<a id="id353" class="indexterm"/> some test with this extension. Here in the following<a id="id354" class="indexterm"/> screenshot you can see our message bar extension in action. We <a id="id355" class="indexterm"/>have created an Ext JS window and added the message bar as a docked item.</p><div><img src="img/3725OS_08_01.jpg" alt="Planning and coding the message bar"/></div><p>You can see that the message bar appears with the configured data when you click on the <strong>Show message</strong> button. And <a id="id356" class="indexterm"/>when we choose the <strong>Invalid icon</strong> option, we <a id="id357" class="indexterm"/>can see how the message bar changes its look. Here you <a id="id358" class="indexterm"/>can see the result when we choose the <strong>Invalid icon</strong>:</p><div><img src="img/3725OS_08_02.jpg" alt="Planning and coding the message bar"/></div><p>From the preceding screenshots we can see that our extension is working exactly the way we wanted.</p></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec48"/>Summary</h1></div></div></div><p>In this chapter, we've developed an Ext JS extension, a fancy animated message bar. Throughout this chapter we've learned how easily we can create our own customized control. As we've already learned about the power of Ext JS extension and how easily we can create Ext JS extensions, we can see that it is really easy to create our own control, which helps to fulfill our custom requirements.</p><p>In the next chapter, we will go through another Ext JS extension <code class="literal">BoxSelect</code>, which was originally developed by Kevin Vaughan. This extension is really very useful and provides a friendlier combobox for multiple selections that create removable labels for each selection easily and individually.</p></div></body></html>