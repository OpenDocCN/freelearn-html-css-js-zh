<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Adding Raster Layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Adding Raster Layers</h1></div></div></div><p>In this chapter we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using Google Maps imagery</li><li class="listitem" style="list-style-type: disc">Using Bing imagery</li><li class="listitem" style="list-style-type: disc">Adding WMS layer</li><li class="listitem" style="list-style-type: disc">Wrapping the date line options</li><li class="listitem" style="list-style-type: disc">Changing the zoom effect</li><li class="listitem" style="list-style-type: disc">Changing the layer opacity</li><li class="listitem" style="list-style-type: disc">Using WMS with single tile mode</li><li class="listitem" style="list-style-type: disc">Buffering the layer data to improve the map navigation</li><li class="listitem" style="list-style-type: disc">Creating an image layer</li><li class="listitem" style="list-style-type: disc">Setting the tile size in WMS layers</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec01"/>Introduction</h1></div></div></div><p>This chapter is all about working with raster layers. We have tried to summarize, with a set of recipes, the most common and important use cases you can find day-to-day when working with OpenLayers.<a class="indexterm" id="id36"/>
</p><p>Imagery is one of the most important kinds of data to work with in a GIS system.</p><p>OpenLayers offers several classes to integrate with different imagery providers, from proprietary providers such as Google Maps and Bing Maps, to Open Source ones such as OpenStreetMap or even any WMS service provider.</p><p>The base class for any layer type is the<code class="literal"> OpenLayers.Layer</code> class, which offers a set of common properties and defines the common behavior for any other classes.</p><p>In addition, many layers inherit from the<code class="literal"> OpenLayers.Layer.Grid</code> class, which divides the layer into zoom levels. This way each zoom level covers the same area but uses a greater set of tiles. For example, at level zero a grid with one tile covers the whole world, at level one a grid with four tiles covers the whole world, and so on. As we can see, on each level, the number of tiles and their resolution increases.</p><p>This chapter introduces you to the use of raster layers, with special attention to the WMS layers, and how to manage the most common properties.</p></div></div>
<div class="section" title="Using Google Maps imagery"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec02"/>Using Google Maps imagery</h1></div></div></div><p>Google Maps is probably the most known web map application around the world. Their imageries, in the way of tiled layers, are well known by people; they are accustomed to their layer style and because of this you may be interested in using them in your own web mapping project.<a class="indexterm" id="id37"/>
</p><div class="mediaobject"><img alt="Using Google Maps imagery" src="graphics/7843_02_01.jpg"/></div><p>OpenLayers counts with the<code class="literal"> OpenLayers.Layer.Google</code> class, which is in fact a wrapper code around the Google Maps API, that allows us to use the Google Maps tiles in a homogeneous way within the OpenLayers API.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note14"/>Note</h3><p>Do not confuse Google Maps API with the Google Maps imagery. Google Maps API is a bunch of JavaScript code, which is free to use, while the access to the Google Maps imagery has some usage restrictions and, depending on the number of hits, will be subject to some payments.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec01"/>How to do it...</h2></div></div></div><p>To use Google Maps imagery, perform the following steps:<a class="indexterm" id="id38"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependencies.</li><li class="listitem">Include the Google Maps API as follows:<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"&gt;&lt;/script&gt;
</pre></div></li><li class="listitem">Add a<code class="literal"> div</code> element to hold the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- Map DOM element --&gt;
&lt;div id="ch2_google" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Within a<code class="literal"> script</code> element, add the code to create the map instance and add a layer switcher control, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- The magic comes here --&gt; 
&lt;script type="text/javascript"&gt; 

    // Create the map using the specified DOM element 
    var map = new OpenLayers.Map("ch2_google"); 
    map.addControl(new OpenLayers.Control.LayerSwitcher()); 
</pre></div></li><li class="listitem">Create some Google based maps and add to the map, as follows:<div class="informalexample"><pre class="programlisting">    var streets = new OpenLayers.Layer.Google("Google Streets", { 
        numZoomLevels: 20 
    }); 
    var physical = new OpenLayers.Layer.Google("Google Physical", { 
        type: google.maps.MapTypeId.TERRAIN 
    }); 
    var hybrid = new OpenLayers.Layer.Google("Google Hybrid", { 
        type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20 
    }); 
    var satellite = new OpenLayers.Layer.Google("Google Satellite", { 
        type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22 
    }); 
    map.addLayers([physical, streets, hybrid, satellite]); 
<a class="indexterm" id="id39"/>
</pre></div></li><li class="listitem">Finally, center the map on a desired location, as follows:<div class="informalexample"><pre class="programlisting">    map.setCenter(new OpenLayers.LonLat(0, 0), 2); 
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec02"/>How it works...</h3></div></div></div><p>As you can see, the code has three main sections. First we have placed a<code class="literal"> div</code> element, which will be used for the map, as follows:<a class="indexterm" id="id40"/>
</p><div class="informalexample"><pre class="programlisting">&lt;div id="ch2_google" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div><p>Next, we have included the Google Maps API code, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"&gt;&lt;/script&gt;
</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note15"/>Note</h3><p>Remember that OpenLayers simply acts as a wrapper, so we need the real Google Maps API code in our application.</p></div><p>Within a<code class="literal">&lt;script type="text/javascript"&gt; &lt;/script&gt;</code> element, we have added the code necessary to initialize the map and add a layer switcher control, as follows:</p><div class="informalexample"><pre class="programlisting">    var map = new OpenLayers.Map("ch2_google"); 
    map.addControl(new OpenLayers.Control.LayerSwitcher()); 
</pre></div><p>Finally, we have added some well known Google Maps layers and centered the map's viewport, as follows:</p><div class="informalexample"><pre class="programlisting">    var streets = new OpenLayers.Layer.Google("Google Streets", { 
        numZoomLevels: 20 
    }); 
    var physical = new OpenLayers.Layer.Google("Google Physical", { 
        type: google.maps.MapTypeId.TERRAIN 
    }); 
    var hybrid = new OpenLayers.Layer.Google("Google Hybrid", { 
        type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20 
    }); 
    var satellite = new OpenLayers.Layer.Google("Google Satellite", { 
        type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22 
    }); 
    map.addLayers([physical, streets, hybrid, satellite]); 
    map.setCenter(new OpenLayers.LonLat(0, 0), 2); 
</pre></div><p>The type of the layers are defined by the Google Maps API class<code class="literal"> google.maps.MapTypeId</code>, which you can find at<a class="ulink" href="http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId"> http://code.google.com/apis/maps/documentation/javascript/reference.html#MapTypeId</a>.<a class="indexterm" id="id41"/>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note16"/>Note</h3><p>Note that we are working with two APIs, OpenLayers and Google Maps API, so it would be good to take a look at the Google Maps API to better understand its capabilities.</p><p>Documentation can be found at<a class="ulink" href="http://https://developers.google.com/maps/documentation/javascript/tutorial"> https://developers.google.com/maps/documentation/javascript/tutorial</a>.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec03"/>There's more...</h3></div></div></div><p>In this recipe, we have shown you how to use the Google Maps API Version 3 to add the Google imagery to your OpenLayers projects.</p><p>For the previous version 2, Google requires you to register as a user and obtain an API key that you need to use to initialize the<code class="literal"> OpenLayers.Layer.Google</code> instance. The key is later used on every tile request to identify you, so Google can know about your usage.</p><p>As you have seen, version 3 is much more simple to use within OpenLayers.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec04"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using Bing imagery</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Understanding base and non-base layers</em></span> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <span class="emphasis"><em> Web Mapping Basics</em></span><a class="indexterm" id="id42"/></li></ul></div></div></div></div>
<div class="section" title="Using Bing imagery"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec03"/>Using Bing imagery</h1></div></div></div><p>Bing Maps, previously known as Virtual Earth, is the mapping service provided by Microsoft.<a class="indexterm" id="id43"/>
</p><p>In the same way as Google Maps, OpenLayers offers an<code class="literal"> OpenLayers.Layer.Bing</code> class, which brings us the possibility to add Bing imagery in our projects.</p><div class="mediaobject"><img alt="Using Bing imagery" src="graphics/7843_02_02.jpg"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec05"/>Getting ready</h2></div></div></div><p>Bing Maps requires you to register as a consumer user. Once registered, you will get an API key needed to initialize the<code class="literal"> OpenLayers.Layer.Bing</code> layer and that will be used with every request to authenticate you against the Bing Maps service.</p><p>Opposite to Google Maps, Bing does not require any JavaScript code and the<code class="literal"> OpenLayers.Layer.Bing</code> class does not act as a wrapper. Bing Maps offer a REST service to directly access tiles using your API key.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note17"/>Note</h3><p>You can find out how to register as a user at<a class="ulink" href="http://msdn.microsoft.com/en-us/library/ff428642.aspx"> http://msdn.microsoft.com/en-us/library/ff428642.aspx</a>.</p><p>In addition you can learn about Bing Maps REST Services at<a class="ulink" href="http://msdn.microsoft.com/en-us/library/ff701713.aspx"> http://msdn.microsoft.com/en-us/library/ff701713.aspx</a>.</p></div><p>At this point, it is assumed that you have an API key to be used in the next code.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec06"/>How to do it...</h2></div></div></div><p>In this section we will see how to use Bing imagery. To use Bing imagery, perform the following steps:<a class="indexterm" id="id44"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependencies.</li><li class="listitem">Add a<code class="literal"> DOM</code> element to place the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;div id="ch2_bing" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Within a<code class="literal"> script</code> element create the map instance and add a layer switcher control, as follows:<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt; 
    // Create the map using the specified DOM element 
    var map = new OpenLayers.Map("ch2_bing"); 
    map.addControl(new OpenLayers.Control.LayerSwitcher()); 
</pre></div></li><li class="listitem">Create some Bing layers, add to the map and center the map's viewport, as follows:<div class="informalexample"><pre class="programlisting">    var bingApiKey = "your_bing_API_must_be_put_here"; 
    var road = new OpenLayers.Layer.Bing({ 
        name: "Road", 
        type: "Road", 
        key: bingApiKey 
    }); 
    var hybrid = new OpenLayers.Layer.Bing({ 
        name: "Hybrid",        
        type: "AerialWithLabels", 
        key: bingApiKey 
    }); 
    var aerial = new OpenLayers.Layer.Bing({ 
        name: "Aerial", 
        type: "Aerial", 
        key: bingApiKey 
    }); 
    map.addLayers([road, hybrid, aerial]); 
    
    map.setCenter(new OpenLayers.LonLat(0, 0), 2); 
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec07"/>How it works...</h3></div></div></div><p>The main point to take into account in this recipe is that we are using Microsoft services. We request an URL using our API key and get a tile. Because of this, every Bing layer must include a<code class="literal"> key</code> parameter while instantiating, as follows:<a class="indexterm" id="id45"/>
</p><div class="informalexample"><pre class="programlisting">var bingApiKey = "your_bing_API_must_be_put_here"; 
var road = new OpenLayers.Layer.Bing({ 
    name: "Road", 
    type: "Road", 
    key: bingApiKey 
}); 
</pre></div><p>We know about the<code class="literal"> name</code> parameter as it is common in all layers. The<code class="literal"> name</code> parameter is used to put a descriptive name for the layer and it will be used by switcher control.</p><p>As previously mentioned, the<code class="literal"> key</code> parameter is used on every tile request and identifies us as registered Bing consumer users.</p><p>The<code class="literal"> type</code> parameter is necessary to specify the kind of tile we want to get from Bing Maps. Bing offers Road, Aerial, or AerialWithLabels among other types.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note18"/>Note</h3><p>You can find more information about Bing Maps layer types at<a class="ulink" href="http://msdn.microsoft.com/en-us/library/ff701716.aspx"> http://msdn.microsoft.com/en-us/library/ff701716.aspx</a>.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec08"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using Google Maps imagery</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Understanding base and non-base layers</em></span> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <span class="emphasis"><em> Web Mapping Basics</em></span></li></ul></div></div></div></div>
<div class="section" title="Adding WMS layer"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec04"/>Adding WMS layer</h1></div></div></div><p>
<span class="strong"><strong>Web Map Service (WMS)</strong></span> ,is a standard developed by the<span class="strong"><strong> Open Geospatial Consortium (OGC)</strong></span>  implemented by many geospatial servers, among which we can find the free and open source projects GeoServer (<a class="ulink" href="http://geoserver.org">http://geoserver.org</a>) and MapServer (<a class="ulink" href="http://mapserver.org">http://mapserver.org</a>). More information on WMS can be found at<a class="ulink" href="http://en.wikipedia.org/wiki/Web_Map_Service"> http://en.wikipedia.org/wiki/Web_Map_Service</a>.<a class="indexterm" id="id46"/>
</p><p>As a very basic summary, you can understand a WMS server as a normal HTTP web server that accepts request with some GIS-related parameters (such as projection, bounding box, and so on) and returns a map similar to the following screenshot:<a class="indexterm" id="id47"/>
</p><div class="mediaobject"><img alt="Adding WMS layer" src="graphics/7843_02_03.jpg"/></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note19"/>Note</h3><p>We are going to work with remote WMS servers, so it is not necessary you have one installed. As an advise, note that we are not responsible for these servers and that they may have problems, or are not available when you read this section.</p><p>Any other WMS server can be used, but the URL and layer name must be known.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec09"/>How to do it...</h2></div></div></div><p>To add a WMS layer, perform the following steps:<a class="indexterm" id="id48"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependencies.</li><li class="listitem">Add a<code class="literal"> div</code> element to hold the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;div id="ch2_wms_layer" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Create the map instance as follows:<div class="informalexample"><pre class="programlisting">// Create the map using the specified DOM element
var map = new OpenLayers.Map("ch2_wms_layer");
</pre></div></li><li class="listitem">Now, add two WMS layers. The first will be the base layer and the second will be an overlay, as follows:<div class="informalexample"><pre class="programlisting">// Add a WMS layer 
var wms = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 

// Add Nexrad WMS layer 
var nexrad = new OpenLayers.Layer.WMS("Nexrad", "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", 
{ 
    layers: "nexrad-n0r", 
    transparent: "true", 
    format: 'image/png' 
}, 
{ 
    isBaseLayer: false 
}); 

map.addLayers([wms, nexrad]); 
</pre></div></li><li class="listitem">Finally, we add a layer switcher control and center the view, as follows:<div class="informalexample"><pre class="programlisting">// Add layer switcher control 
map.addControl(new OpenLayers.Control.LayerSwitcher()); 
// Set the center of the view 
map.setCenter(new OpenLayers.LonLat(-90,40), 4);
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec10"/>How it works...</h3></div></div></div><p>The<code class="literal"> OpenLayers.Layer.WMS</code> class constructor requires four arguments to be instantiated (actually the fourth is optional), which are:<a class="indexterm" id="id49"/>
</p><div class="informalexample"><pre class="programlisting">new OpenLayers.Layer.WMS(name, url, params, options)
</pre></div><p>The parameters are as follows:<a class="indexterm" id="id50"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<code class="literal"> name</code> is common to all layers and is used as a user-friendly description</li><li class="listitem" style="list-style-type: disc">The<code class="literal"> url</code> is a string that must point to the WMS server</li><li class="listitem" style="list-style-type: disc">The<code class="literal"> params</code> parameter is an object and can contain any parameters used in a WMS request: layers, format, styles, and so on</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note20"/>Note</h3><p>Check the WMS standard to know which parameters you can use within the<code class="literal"> params</code>.</p><p>The use of layers is mandatory, so you always need to specify this value. In addition, if using the SRS WMS request parameter, take into account that it is always ignored, because it is taken from the projection of the base layer or the map's projection.</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<code class="literal"> options</code> parameter is an optional object that contains specific properties for the layer object:<code class="literal"> opacity, isBaseLayer</code>, among others</li></ul></div><p>In this recipe, we have added one base layer as follows:</p><div class="informalexample"><pre class="programlisting">var wms = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
</pre></div><p>It makes use of the<code class="literal"> name, url</code>, and<code class="literal"> params</code> parameters, indicating the<code class="literal"> basic</code> is the only layer to be requested.</p><p>Later, we have added a second overlay layer with weather radar information from NEXRAD (<a class="ulink" href="http://en.wikipedia.org/wiki/NEXRAD">http://en.wikipedia.org/wiki/NEXRAD</a>), at the Iowa State University servers (you can find more information at<a class="ulink" href="http://mesonet.agron.iastate.edu/ogc)"> http://mesonet.agron.iastate.edu/ogc)</a> as follows:</p><div class="informalexample"><pre class="programlisting">var nexrad = new OpenLayers.Layer.WMS("Nexrad", "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", 
{ 
    layers: "nexrad-n0r", 
    transparent: "true", 
    format: 'image/png' 
}, 
{ 
    isBaseLayer: false 
}); 
</pre></div><p>In this case, in addition to the<code class="literal"> layers</code> parameter, we have used the<code class="literal"> transparent</code> and<code class="literal"> format</code> parameters.<a class="indexterm" id="id51"/>
</p><p>The<code class="literal"> format</code> parameter is used in a WMS request to specify what image format we want to receive the images in.</p><p>The<code class="literal"> transparent</code> property is set to<code class="literal"> true</code>. If it were not set, we would get white tiles with some colored radar data that will hide the base layer. Make the test using<code class="literal"> transparent: "false"</code>.</p><p>For this layer, we have also set the layer parameter<code class="literal"> isBaseLayer</code> to<code class="literal"> false</code>, to indicate we want it to act as an overlay.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec11"/>There's more...</h3></div></div></div><p>WMS servers returns images no matter whether there is information in the bounding box we are requesting or not.</p><p>The previously mentioned Nexrad WMS layer, showing the tile images with a white background was not desirable, so we used the<code class="literal"> transparent</code> parameter to fix the issue.</p><p>When you set the<code class="literal"> transparent</code> parameter to<code class="literal"> true</code>, no matter which format you specify, internally the WMS class ensures the requests are made using the<code class="literal"> format image/png</code> or<code class="literal"> image/gif</code> to guarantee the transparency of those pixels that have no data.</p><p>Finally, remember we can pass any parameter defined by WMS standard in the requests, by just specifying them in the<code class="literal"> params</code> parameter.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec12"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using Google Maps imagery</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Changing the layer opacity</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Buffering the layer data to improve the map navigation</em></span> recipe</li></ul></div></div></div></div>
<div class="section" title="Wrapping the date line options"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec05"/>Wrapping the date line options</h1></div></div></div><p>There might be situations where you do not want your map ends at -180 or +180 longitude degrees as you are working in that area and need a continuous map. For example, imagine a map where on the left you can see the end of Russia and at the right Alaska, as shown in the following screenshot:<a class="indexterm" id="id52"/>
</p><div class="mediaobject"><img alt="Wrapping the date line options" src="graphics/7843_02_05.jpg"/></div><p>This property is a common attribute from base class<code class="literal"> OpenLayers.Layer</code> and is called the<code class="literal"> wrapDateLine</code>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec13"/>How to do it...</h2></div></div></div><p>To wrap the date line options, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependency.</li><li class="listitem">In the beginning, we have put a checkbox to activate/deactivate the wrap data line feature, as follows:<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title">Note</h3><p>Do not worry about the<code class="literal"> dojoType="dijit.form.CheckBox"</code> attribute, it is because the Dojo Toolkit (<a class="ulink" href="http://dojotoolkit.org">http://dojotoolkit.org</a>) is used in the sample.</p><p>Think of it as a normal HTML input element.</p></div></li><li class="listitem">Next, we have added the<code class="literal"> DOM</code> element used to render the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;div id="ch2_wrapdataline" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Within a<code class="literal"> script</code> element, create the map instance, as follows:<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt;
    // Create the map using the specified DOM element
    var map = new OpenLayers.Map("ch2_wrapdataline");
</pre></div></li><li class="listitem">Now, create a WMS layer specifying the<code class="literal"> wrapDateLine</code> property, as follows:<a class="indexterm" id="id53"/><div class="informalexample"><pre class="programlisting">    // Add a WMS layer
    var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://labs.metacarta.com/wms/vmap0",
    {
        layers: 'basic'
    },
    {
        wrapDateLine: true
    });
    map.addLayer(wms);   
    
    // Center map view
    map.setCenter(new OpenLayers.LonLat(-110,0), 2);
</pre></div></li><li class="listitem">Finally, implement the function that will change the<code class="literal"> wrapDateLine</code> property value, as follows:<div class="informalexample"><pre class="programlisting">    function wrapDateLine(checked) {
        wms.wrapDateLine = checked;
        wms.redraw();
    }
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec14"/>How it works...</h3></div></div></div><p>All the magic of this recipe is in the<code class="literal"> wrapDateLine</code> property in the<code class="literal"> OpenLayers.Layer</code> class. You need to set it to<code class="literal"> true</code> to wrap and create a continuous layer on their longitudinal axes.<a class="indexterm" id="id54"/>
</p><p>In addition, we have created a function that reacts to changes in the checkbox to activate/deactivate the<code class="literal"> wrapDateLine</code> property, as in the following code:</p><div class="informalexample"><pre class="programlisting">    function wrapDateLine(checked) {
        wms.wrapDateLine = checked;
        wms.redraw();
    }
</pre></div><p>Note that after changing the property value we need to redraw the layer so that it takes effect. This is done using the<code class="literal"> redraw()</code> method inherited from the<code class="literal"> OpenLayers.Layer</code> base class.<a class="indexterm" id="id55"/>
</p><p>The<code class="literal"> wrapDateLine</code> property is not a property of the map but a property of every layer; so if you want the whole map to have the same behavior, you need to set it to<code class="literal"> true</code> in all layers.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li></ul></div></div></div></div>
<div class="section" title="Changing the zoom effect"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec06"/>Changing the zoom effect</h1></div></div></div><p>The panning and zoom effects are very important actions related to the user navigation experience.<a class="indexterm" id="id56"/>
</p><p>In<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>,<span class="emphasis"><em> Web Mapping Basics</em></span>, the recipe<span class="emphasis"><em> Moving around the map view</em></span> shows how you can control and create the way the map can be panned.</p><p>In the same way you can control the transition effect between two zoom levels on the layers.<a class="indexterm" id="id57"/>
</p><p>The<code class="literal"> OpenLayers.Layer</code> class has a<code class="literal"> transitionEffect</code> property, which determines the effect applied to the layer when the zoom level is changed. For the moment only two values are allowed:<code class="literal"> null</code> and<code class="literal"> resize</code>.</p><p>The<code class="literal"> null</code> value means no transition effect will be applied, because when you change the zoom level you probably see how the layer disappears until the tiles at the new zoom level are loaded.</p><p>With the<code class="literal"> resize</code> value when we zoom into a level, the current tiles are resized, adapting to the new zoom, until the tiles at the new level are loaded in background. This way images are always visible and we avoid the ugly effect of seeing a blank map for a few seconds.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec16"/>How to do it...</h2></div></div></div><p>To change the zoom level, perform the following steps:<a class="indexterm" id="id58"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and include the required OpenLayers dependencies.</li><li class="listitem">For this recipe, we are going to add a checkbox button that allows us to change between the transition effects on a single layer, as follows:<div class="informalexample"><pre class="programlisting">Transition effect: &lt;input dojoType="dijit.form.CheckBox" checked onChange="transitionEffect" /&gt; Resize
</pre></div></li><li class="listitem">Next, add the<code class="literal"> div</code> element, which holds the map as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- Map DOM element --&gt;
&lt;div id="ch2_transition_effect" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Add the JavaScript that initializes the map and creates one WMS layer, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- The magic comes here --&gt;
&lt;script type="text/javascript"&gt;

    // Create the map using the specified DOM element
    var map = new OpenLayers.Map("ch2_transition_effect");
    
    // Add a WMS layer
    var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
    {
        layers: 'basic'
    },
    {
        wrapDateLine: true,
        transitionEffect: 'resize'
    });
    map.addLayer(wms);   
    
    // Center map view
    map.setCenter(new OpenLayers.LonLat(0,0), 3);
</pre></div></li><li class="listitem">Finally, put the function that will toggle the<code class="literal"> transitionEffect</code> property value, as follows:<div class="informalexample"><pre class="programlisting">    function transitionEffect(checked) {
        if(checked) {
            wms.transitionEffect = 'resize';
        } else {
            wms.transitionEffect = null;
        }
    }
&lt;/script&gt;
<a class="indexterm" id="id59"/>
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec17"/>How it works...</h3></div></div></div><p>As explained at the beginning of the recipe, all the magic is in the<code class="literal"> transitionEffect</code> property.</p><p>As the property is specific to a layer and not an<code class="literal"> OpenLayers.Map</code> property, if you want to apply the same effect to the whole map, you need to set it on all its contained layers.<a class="indexterm" id="id60"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec18"/>There's more...</h3></div></div></div><p>One or more<code class="literal"> OpenLayers.Tile.Image</code> forms a raster layer, so when it is rendered the real work to draw the tiles is made easy by the tiles themselves.</p><p>Although the<code class="literal"> transitionEffect</code> is defined in the<code class="literal"> OpenLayers.Layer</code> class (or subclasses), each individual tile is responsible for drawing the transition effect.</p><p>If you plan to create a new zoom transition effect, you will need to take a look at the<code class="literal"> OpenLayers.Tile.Image</code> code as well.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec19"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Changing the layer opacity</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li></ul></div></div></div></div>
<div class="section" title="Changing the layer opacity"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec07"/>Changing the layer opacity</h1></div></div></div><p>When you are working with many layers—both raster and vector layers—you will probably find situations where a layer that is on top of another layer hides the one below it. This is more common when working with raster WMS layers without the<code class="literal"> transparent</code> property set to<code class="literal"> true</code> or tiled layers such as, OpenStreetMaps, Google, and Bing. The layer opacity is set to<span class="strong"><strong> 50%</strong></span> in the following screenshot:<a class="indexterm" id="id61"/>
</p><div class="mediaobject"><img alt="Changing the layer opacity" src="graphics/7843_02_07.jpg"/></div><p>The<code class="literal"> OpenLayers.Layer</code> base class has an<code class="literal"> opacity</code> property, implemented by concrete subclasses, that allows us to modify the opacity of the layers. It is a float value that can range from<code class="literal"> 0.0</code> (completely transparent) to<code class="literal"> 1.0</code> (completely opaque).</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>How to do it...</h2></div></div></div><p>The opacity of the layers can be changed. To change the opacity of the layer, perform the following steps:<a class="indexterm" id="id62"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file adding the required OpenLayers dependencies.<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note21"/>Note</h3><p>We have intentionally omitted the HTML code required for the slider control. Here, we have focused on the code for OpenLayers. If interested in knowing more about the code for the slider, it can be found in the recipe's source code.</p></div></li><li class="listitem">Add a<code class="literal"> div</code> element to hold the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;div id="ch2_opacity" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Next, create a map instance and add two layers, as follows:<div class="informalexample"><pre class="programlisting">// Create the map using the specified DOM element 
var map = new OpenLayers.Map("ch2_opacity"); 

// Add a WMS layer 
var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
map.addLayer(wms);  

// Add coast line layer 
var wms2 = new OpenLayers.Layer.WMS("Coast Line", "http:// vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'coastline_01,coastline_02' 
}, 
{ 
    isBaseLayer: false 
}); 
map.addLayer(wms2); 
</pre></div></li><li class="listitem">Add a layer switcher control and center the map's viewport, as follows:<div class="informalexample"><pre class="programlisting">map.addControl(new OpenLayers.Control.LayerSwitcher()); 

// Center map view 
map.setCenter(new OpenLayers.LonLat(0,0), 3);
</pre></div></li><li class="listitem">Finally, implement the function that receives the changes on the slider control and changes the layer opacity, as follows:<a class="indexterm" id="id63"/><div class="informalexample"><pre class="programlisting">function opacity(value) { 
    wms2.setOpacity(value/100); 
}
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec21"/>How it works...</h3></div></div></div><p>As we have commented that the<code class="literal"> opacity</code> property is the key in this recipe, the way to modify it is not by changing the attribute value directly but by using the<code class="literal"> setOpacity()</code> method.<a class="indexterm" id="id64"/>
</p><p>The<code class="literal"> setOpacity()</code> method is responsible for modifying the<code class="literal"> opacity</code> property in addition to modifying any<code class="literal"> DOM</code> element (for example, the images of the tiles) and emitting a<code class="literal"> changelayer</code> event, which notifies any listener interested in knowing about any layer changes.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec22"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Wrapping the date line options</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Understanding base and non-base layers</em></span> recipe in<a class="link" href="ch01.html" title="Chapter 1. Web Mapping Basics"> Chapter 1</a>, <span class="emphasis"><em> Web Mapping Basics</em></span></li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Buffering the layer data to improve the map navigation</em></span> recipe<a class="indexterm" id="id65"/></li></ul></div></div></div></div>
<div class="section" title="Using WMS with single tile mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec08"/>Using WMS with single tile mode</h1></div></div></div><p>
<span class="strong"><strong>Web Map Service (WMS)</strong></span>  is a protocol to serve georeferenced map images.<a class="indexterm" id="id66"/>
</p><p>The basic idea is that, given a bounding box and some other parameters, such as a layer name, the client makes an HTTP request to the WMS server, which computes and returns an image with all the data for the specified layers and within the specified bounding box.<a class="indexterm" id="id67"/>
</p><p>In OpenLayers, when you add a WMS layer to your map, the<code class="literal"> OpenLayers.Layer.WMS</code> instance is provided with some parameters, such as resolutions and tile size. The WMS server computes the right number of tiles for each zoom level and divides the layer in that number of tiles.</p><p>This way, when you add a WMS layer to the map, there is not only one request to the server, but one by each tile that forms the current zoom level.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note22"/>Note</h3><p>Dividing the WMS layer in tiles can be better from the server-side point of view when it is configured with a cache system. This way tiles are generated once and served many times.</p><p>If you have more than one web mapping application using WMS layers that point to the same WMS server, all the tiles can be served from the cache and the load on the server would drastically reduce.</p></div><p>Dividing the layer in tiles isn't the only way you can work with WMS layers; if you need to, you can work in the so-called single tile mode.</p><p>In this mode, only one image is used to cover the whole view—the map's bounding box, instead of using a bunch of tiles required for the tiled mode.</p><p>Every time the layer must be refreshed (as you move the map or change the zoom level) one request is made to the WMS server requesting data for the new map's bounding box.</p><p>As you can see, in single tile mode, the number of requests to the server are much less than those in tiled mode. In contrast, working in tiled mode, each tile request is easy to cache as the tile's bounding boxes are fixed for each zoom level; while in single tile mode each request is usually slightly different than the other (as little changes in the bounding box) and will result in a request to the WMS server, with the consequent computation time.<a class="indexterm" id="id68"/>
</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>How to do it...</h2></div></div></div><p>Follow through the steps to use WMS in single tile mode:<a class="indexterm" id="id69"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and add the OpenLayers dependencies.</li><li class="listitem">Now, we are going to create two maps side by side, each one with a WMS layer, as follows:<div class="informalexample"><pre class="programlisting">&lt;table style="width: 100%; height: 95%;"&gt; 
    &lt;tr&gt; 
        &lt;td style="width: 50%;"&gt; 
            &lt;p&gt;WMS layer:&lt;/p&gt; 
            &lt;div id="ch02_wms_non_singleTile" style="width: 100%; height: 100%;"&gt;&lt;/div&gt; 
        &lt;/td&gt; 
        &lt;td style="width: 50%;"&gt; 
            &lt;p&gt;WMS using &lt;em&gt;singleTile&lt;/em&gt; property:&lt;/p&gt; 
            &lt;div id="ch02_wms_singleTile" style="width: 100%; height: 100%;"&gt;&lt;/div&gt; 
        &lt;/td&gt; 
    &lt;/tr&gt; 
&lt;/table&gt;
</pre></div></li><li class="listitem">Next, write the required JavaScript code to initialize both maps. The first one will contain a normal WMS layer, as follows :<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt; 

    // Create the map using the specified DOM element 
    var map_a = new OpenLayers.Map("ch02_wms_non_singleTile");    
    
    // Add a WMS layer 
    var wms = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
    { 
        layers: 'basic' 
    }); 
    map_a.addLayer(wms); 
    
    // Set the center of the view 
    map_a.setCenter(new OpenLayers.LonLat(-90,0), 2);
</pre></div></li><li class="listitem">The second map will contain a WMS layer pointing to the same server but working in single tile mode, as follows:<a class="indexterm" id="id70"/><div class="informalexample"><pre class="programlisting">    // Create the map using the specified DOM element 
    var map_b = new OpenLayers.Map("ch02_wms_singleTile");    
    
    // Add a WMS layer 
    var wms = new OpenLayers.Layer.WMS("Basic", "http:// vmap0.tiles.osgeo.org/wms/vmap0", 
    { 
        layers: 'basic' 
    }, 
    { 
        singleTile: true 
    }); 
    map_b.addLayer(wms); 
    
    // Set the center of the view 
    map_b.setCenter(new OpenLayers.LonLat(-90,0), 2); 
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec24"/>How it works...</h3></div></div></div><p>The recipe code is pretty easy. The long explanation at the beginning, on how WMS layers can work in single tile mode, is simply achieved in practice using the<code class="literal"> singleTile</code> property of the<code class="literal"> OpenLayers.Layer</code> class. Pan or zoom the maps to see how differently it works.<a class="indexterm" id="id71"/>
</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec25"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Buffering the layer data to improve the map navigation</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Changing the layer opacity</em></span> recipe<a class="indexterm" id="id72"/></li></ul></div></div></div></div>
<div class="section" title="Buffering the layer data to improve the map navigation"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec09"/>Buffering the layer data to improve the map navigation</h1></div></div></div><p>Map navigation is an important factor to take into account to make the user experience better.<a class="indexterm" id="id73"/>
</p><p>When we pan the map, many times we get to see blank areas (meaning that the content is loading) and after a few seconds the image appears.<a class="indexterm" id="id74"/>
</p><p>On gridded layers and WMS layers working in single tile mode, we can improve this at the cost of increasing the requests number or increasing the computation time at the server side.<a class="indexterm" id="id75"/>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note23"/>Note</h3><p>Most of the raster layers inherit from the base class<code class="literal"> OpenLayers.Layer.Grid</code>, which is responsible for dividing each zoom level into tiles.</p><p>For WMS layers working in single tile mode, the grid is formed only by one tile, which fills the whole map view.</p></div><p>The idea behind improving map navigation is simple; load the tiles outside the map view so that they are loaded before the user pans the map view in that direction.</p><p>This recipe shows you how to preload content outside the map view, both for gridded layers and also for WMS layers working in single tile mode, so that you can improve the navigation experience of the users.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file and include the OpenLayers dependencies.<a class="indexterm" id="id76"/></li><li class="listitem">We are going to create two maps side by side and on top of each one we are going to add a spinner control, from the Dojo Toolkit framework (<a class="ulink" href="http://dojotoolkit.org">http://dojotoolkit.org</a>), to control the properties<code class="literal"> buffer</code> and<code class="literal"> singleTile</code> values:<div class="informalexample"><pre class="programlisting">&lt;table style="width: 100%; height: 95%;"&gt; 
    &lt;tr&gt; 
        &lt;td style="width: 50%;"&gt; 
            &lt;p&gt; 
                WMS layer with &lt;em&gt;buffer&lt;/em&gt;: &lt;input id="buffer_a" dojoType="dijit.form.NumberSpinner" onChange="changeBufferA" 
                                                       intermediateChanges="true" style="width:100px" value="0" smallDelta="1" constraints="{min:0,max:5}" /&gt; 
            &lt;/p&gt; 
            &lt;div id="ch02_wms_buffer" style="width: 100%; height: 100%;"&gt;&lt;/div&gt; 
        &lt;/td&gt; 
        &lt;td style="width: 50%;"&gt; 
            &lt;p&gt; 
                WMS using &lt;em&gt;singleTile&lt;/em&gt; property and &lt;em&gt;ratio&lt;/em&gt;: &lt;input id="buffer_b" dojoType="dijit.form.NumberSpinner" onChange="changeBufferB" 
                                                                                  intermediateChanges="true" style="width:100px" value="1.0" smallDelta="0.1" constraints="{min:0.0,max:2.0}" /&gt; 
            &lt;/p&gt; 
            &lt;div id="ch02_wms_ratio" style="width: 100%; height: 100%;"&gt;&lt;/div&gt; 
        &lt;/td&gt; 
    &lt;/tr&gt; 
&lt;/table&gt;
</pre></div></li><li class="listitem">The left-hand side panel will show how to control the number of tiles that can be loaded outside the map view:<div class="informalexample"><pre class="programlisting">&lt;script type="text/javascript"&gt; 
    // Create the map using the specified DOM element 
    var map_a = new OpenLayers.Map("ch02_wms_buffer");    
    
    // Add a WMS layer 
    var wms_a = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
    { 
        layers: 'basic' 
    }, 
    { 
        buffer: 0 
    }); 
    map_a.addLayer(wms_a); 
    
    // Set the center of the view 
    map_a.setCenter(new OpenLayers.LonLat(-90,0), 3);
</pre></div></li><li class="listitem">The right-hand side panel shows how to control the amount of data you can preload in a WMS layer working in single tile mode.<a class="indexterm" id="id78"/><div class="informalexample"><pre class="programlisting">    // Create the map using the specified DOM element 
    var map_b = new OpenLayers.Map("ch02_wms_ratio");    
    
    // Add a WMS layer 
    var wms_b = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
    { 
        layers: 'basic' 
    }, 
    { 
        singleTile: true, 
        ratio: 1 
    }); 
    map_b.addLayer(wms_b); 
    
    // Set the center of the view 
    map_b.setCenter(new OpenLayers.LonLat(-90,0), 3);
</pre></div></li><li class="listitem">Finally, there is the code responsible for changes on the spinner controls, shown as follows:<div class="informalexample"><pre class="programlisting">    // Handle events 
    function changeBufferA(value) { 
        wms_a.addOptions({buffer: value}); 
    } 
    function changeBufferB(value) { 
        map_b.removeLayer(wms_b); 
        wms_b.destroy(); 
        wms_b = new OpenLayers.Layer.WMS("Basic", "http:// vmap0.tiles.osgeo.org/wms/vmap0", 
        { 
            layers: 'basic' 
        }, 
        { 
            singleTile: true, 
            ratio: value 
        }); 
        map_b.addLayer(wms_b); 
    } 
&lt;/script&gt;
<a class="indexterm" id="id79"/>
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec27"/>How it works...</h3></div></div></div><p>The left-hand side map contains a WMS layer working in the default tiled mode. In this mode, the<code class="literal"> buffer</code> property from the base class<code class="literal"> OpenLayers.Layer.Grid</code> specifies how many tiles must be loaded outside the map view.<a class="indexterm" id="id80"/>
</p><p>When a user changes the spinner value for the<code class="literal"> buffer</code> property, we simply update it with the following line of code:</p><div class="informalexample"><pre class="programlisting">    function changeBufferA(value) { 
        wms_a.addOptions({buffer: value}); 
    } 
</pre></div><p>The right-hand side map, on the other hand, has a WMS layer working in single tile mode (see the<code class="literal"> singleTile</code> property set to<code class="literal"> true)</code>. In this mode, only one request is made to get an image, which fills the whole map view.</p><p>We can control the size of the image with the<code class="literal"> ratio</code> property, which belongs to the<code class="literal"> OpenLayers.Layer.WMS</code> class. A ratio of value 1.0 means an image with exact dimensions of the map view. By default the ratio value is 1.5, which means we are requesting an image with the map view dimensions plus a half.</p><p>In this case, the ratio value is set once while creating the layer and to update it we need to delete the previous layer and create a new one with the new value. This is done as follows:</p><div class="informalexample"><pre class="programlisting">    function changeBufferB(value) { 
        map_b.removeLayer(wms_b); 
        wms_b.destroy(); 
        wms_b = new OpenLayers.Layer.WMS("Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
        { 
            layers: 'basic' 
        }, 
        { 
            singleTile: true, 
            ratio: value 
        }); 
        map_b.addLayer(wms_b); 
    } 
</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note24"/>Note</h3><p>We first remove the layer from the map and later invoke the<code class="literal"> destroy()</code> method to free internal resources used by the layer and avoid memory leaks.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec28"/>There's more...</h3></div></div></div><p>Remember, the more tiles we load the more requests to the server. The same goes for a WMS layer in single tile mode; the greater the bounding box you request, the greater the computation time on the server results.</p><p>Because of this, increasing the<code class="literal"> buffer</code> or<code class="literal"> ratio</code> values too much is not always the best solution.</p><p>Think about your data and how the user will explore it. If your data is probably better to explore in its extension—a great area in the same zoom level—then a buffer of one or two can be a good idea. If your data is mainly zoomed but the user is not interested in exploring large areas, then the default values are fine.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec29"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Setting the tile size in WMS layers</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li></ul></div></div></div></div>
<div class="section" title="Creating an image layer"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec10"/>Creating an image layer</h1></div></div></div><p>Sometimes a tiled layer, such as Google Maps, OpenStreetMap, or WMS, is not what you need. It is quite possible that you have a georeferenced image, knowing its projection and bounding box, and want to render it on the map.<a class="indexterm" id="id81"/>
</p><p>In these cases, OpenLayers offers the<code class="literal"> OpenLayers.Layer.Image</code> class that allows us to create a layer based on a simple image. A georeferenced image is shown in the following screenshot:<a class="indexterm" id="id82"/>
</p><div class="mediaobject"><img alt="Creating an image layer" src="graphics/7843_02_08.jpg"/></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How to do it...</h2></div></div></div><p>To create an image layer, perform the following steps:<a class="indexterm" id="id83"/>
</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's go and create an HTML file with the OpenLayers dependencies.</li><li class="listitem">First, add the<code class="literal"> div</code> element that will hold the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- Map DOM element --&gt;
&lt;div id="ch2_image" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Next, initialize the map and add a WMS base layer, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- The magic comes here --&gt;
&lt;script type="text/javascript"&gt;
    // Create the map using the specified DOM element
    var map = new OpenLayers.Map("ch2_image", {
        allOverlays: true
    });
    map.addControl(new OpenLayers.Control.LayerSwitcher());
    
    // Add WMs layer
    var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
    {
        layers: 'basic'
    });
    map.addLayer(wms);
</pre></div></li><li class="listitem">Now, define the image URL, its extent and size, and create an image layer as follows:<div class="informalexample"><pre class="programlisting">    // Add an Image layer
    var img_url = "http://localhost:8080/openlayers-cookbook/data/nexrad.png";
    var img_extent = new OpenLayers.Bounds(-131.0888671875, 30.5419921875, -78.3544921875, 53.7451171875);
    var img_size = new OpenLayers.Size(780, 480);
        
    var image = new OpenLayers.Layer.Image("Image Layer", img_url, img_extent, img_size, {
        isBaseLayer: false,
        alwaysInRange: true // Necessary to always draw the image
    });
    map.addLayer(image);
    
    // Center the view
    map.setCenter(new OpenLayers.LonLat(-85, 40), 3);
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec31"/>How it works...</h3></div></div></div><p>The<code class="literal"> OpenLayers.Layer.Image</code> class constructor needs five parameters, as follows:<a class="indexterm" id="id85"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>name:</strong></span> This is the desired descriptive name for the layer<a class="indexterm" id="id86"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>url:</strong></span> This is the URL for the image</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>extent:</strong></span> This is an instance of the<code class="literal"> OpenLayers.Bounds</code> class with the bounding box of the image</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>size:</strong></span> This is an instance of the<code class="literal"> OpenLayers.Size</code> with the image dimensions in pixels</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>options:</strong></span> This indicates a JavaScript object with different options for the layer</li></ul></div><p>The image used in this recipe was previously obtained from NEXRAD (see<a class="ulink" href="http://mesonet.agron.iastate.edu/current/mcview.phtml)"> http://mesonet.agron.iastate.edu/current/mcview.phtml)</a> so we know the exact coordinates of their bounding box. They are:<a class="indexterm" id="id87"/>
</p><div class="informalexample"><pre class="programlisting">var img_extent = new OpenLayers.Bounds(-131.0888671875, 30.5419921875, -78.3544921875, 53.7451171875);
</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;" title="Note"><h3 class="title"><a id="note25"/>Note</h3><p>It is important to note that the bounds must be expressed in the same projection as the map, in this case EPSG:4326.</p></div><p>We also know the image size in pixels:</p><div class="informalexample"><pre class="programlisting">var img_size = new OpenLayers.Size(780, 480);
</pre></div><p>Given the image extent and size, OpenLayers computes the appropriate resolutions (think of it as zoom levels) where the image must be shown.</p><p>In this case, we always want to show the image on the map, no matter at which zoom level we are, and because of this we have used the<code class="literal"> alwaysInRange</code> property set to<code class="literal"> true</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec32"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Adding WMS layer</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Buffering the layer data to improve the map navigation</em></span> recipe</li></ul></div></div></div></div>
<div class="section" title="Setting the tile size in WMS layers"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec11"/>Setting the tile size in WMS layers</h1></div></div></div><p>The<code class="literal"> OpenLayers.Layer.Grid</code> class is a special kind of layer, which divides the layer in different zoom levels composed of a grid of tiles.<a class="indexterm" id="id88"/>
</p><p>The<code class="literal"> OpenLayers.Layer.WMS</code> class is a subclass of the preceding one and, in addition to working in single tile mode, it can work in tiled mode as well.<a class="indexterm" id="id89"/>
</p><p>Of course, controlling the size of the tiles of the WMS request can affect the performance. By default, the tile size is 256 x 256 pixels, but we can set this to any desired value. Bigger tile sizes means less request to the server but more computation time to generate a bigger image. On the contrary, smaller tile sizes means more server requests and less time to compute smaller images.<a class="indexterm" id="id90"/>
</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>How to do it...</h2></div></div></div><p>To set the tile size, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create an HTML file with OpenLayers library dependency.</li><li class="listitem">Add a<code class="literal"> div</code> element that will hold the map, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- Map DOM element --&gt;
&lt;div id="ch2_tilesize" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Next, initialize the map and add two layers, as follows:<div class="informalexample"><pre class="programlisting">&lt;!-- The magic comes here --&gt;
&lt;script type="text/javascript"&gt;
    // Create the map using the specified DOM element
    var map = new OpenLayers.Map("ch2_tilesize", {
        allOverlays: true,
        tileSize: new OpenLayers.Size(256, 256)
    });
    map.addControl(new OpenLayers.Control.LayerSwitcher());
    
    // Add WMs layer
    var wms1 = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
    {
        layers: 'basic'
    });
    map.addLayer(wms1);
</pre></div></li><li class="listitem">For the second layer, specify the size of the tiles as follows:<div class="informalexample"><pre class="programlisting">    var wms2 = new OpenLayers.Layer.WMS("Coast Line", "http://vmap0.tiles.osgeo.org/wms/vmap0",
    {
        layers: 'coastline_01,coastline_02'
    },
    {
        tileSize: new OpenLayers.Size(512, 512),
        opacity: 0.65
    });
    map.addLayer(wms2); 
    
    // Center the view
    map.setCenter(new OpenLayers.LonLat(-85, 40), 3);
&lt;/script&gt;
</pre></div></li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec34"/>How it works...</h3></div></div></div><p>There is not much mystery in this recipe. The<code class="literal"> tileSize</code> property is available both for<code class="literal"> OpenLayers.Map</code> and<code class="literal"> OpenLayers.Layer.Grid</code> subclasses.<a class="indexterm" id="id91"/>
</p><p>The<code class="literal"> tileSize</code> must be an instance of<code class="literal"> OpenLayers.Size</code> class, indicating the width and height in pixels.<a class="indexterm" id="id92"/>
</p><p>When the tile size is set in the map instance all layers use this value unless you specify another value for each individual layer.</p><p>By default, the OpenLayers.Map instance is configured to use 256 x 256 size tiles. Because of this, the first layer makes requests to the WMS server using a tile size of 256 x 256 pixels.</p><p>On the other hand, we have specified a 512 x 512 tile size value for the second layer, so the requests against the WMS are made waiting for tiles with 512 x 512 size.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec35"/>There's more...</h3></div></div></div><p>For tiled services, such as Google Maps or OpenStreetMap, the<code class="literal"> tileSize</code> property is simply ignored because these services have precomputed the images in a fixed 256 x 256 size.</p><p>The reason for the tile size value being 256 x 256 pixels is because the size (in bytes) of each image file is optimum for bandwidth use.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec36"/>See also</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Using WMS with single tile mode</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The<span class="emphasis"><em> Buffering the layer data to improve the map navigation</em></span> recipe</li></ul></div></div></div></div></body></html>