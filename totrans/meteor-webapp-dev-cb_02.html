<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Customizing with Packages" id="aid-QMFO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Customizing with Packages</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Adding Meteor packages</li><li class="listitem">Removing Meteor packages</li><li class="listitem">Discovering new packages with Atmosphere</li><li class="listitem">Creating a multipage application with Iron Router</li><li class="listitem">Building a custom package</li><li class="listitem">Using npm modules</li><li class="listitem">Publishing custom packages to Atmosphere</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Introduction</h1></div></div></div><p>The package system in Meteor makes your development life much easier. It also speaks to one of Meteor's core principles—modular development. If you want to use the entire default Meteor stack, great! If you don't like a particular part and want to swap it out with a third-party package, great! It's completely up to you. Meteor allows you to quickly add and remove functionality, use the latest code shared by others, and create your own reusable code segments. This chapter will provide you with the recipes needed to take full advantage of the Meteor packages system.</p></div></div>
<div class="section" title="Adding Meteor packages" id="aid-RL0A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Adding Meteor packages</h1></div></div></div><p>The<a id="id85" class="indexterm"/> core <a id="id86" class="indexterm"/>
<span class="strong"><strong>Meteor Development Group</strong></span> (<span class="strong"><strong>MDG</strong></span>) have developed over 140 packages for you to use. These packages provide features and functionality ranging from simple display tweaks, to fully integrated account management. Not only are these packages useful, but they're extremely easy to add to your project. In addition to the core MDG packages, there are hundreds of third-party packages available, all of which are free and could be just as easily added. This recipe will show you how to add Meteor packages to your project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec63"/>Getting ready</h2></div></div></div><p>You will <a id="id87" class="indexterm"/>need Meteor installed and have a project created. Any project will do. You should also have a terminal window open and navigate to the root folder of your project, for example, if the name of your project is <code class="literal">packagesTest</code>, located in the <code class="literal">~/Documents/MeteorProjects</code> folder, you would enter the following command in a terminal window:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/Documents/MeteorProjects/packagesTest</strong></span>
</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec64"/>How to do it...</h2></div></div></div><p>Let's install the <code class="literal">fastclick</code> package as an example. This package removes the 300 ms delay for mobile/touchscreens.</p><p>In your terminal window, in the root folder, enter the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add fastclick</strong></span>
</pre></div><p>This will install the bootstrap package into your project, with a message similar to the following:</p><div class="mediaobject"><img src="../Images/image00330.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec65"/>How it works...</h2></div></div></div><p>The <code class="literal">meteor add [package name]</code> command tells Meteor to find the named package in the Meteor packages registry and copy the appropriate files over to your project. In addition, the package name is added to the declaration files of your project so that when Meteor starts up your project, the appropriate files for the named project are added and executed.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec66"/>There's more…</h2></div></div></div><p>As mentioned, you can install third-party packages using the same <code class="literal">meteor add</code> command. The difference between a core MDG package and a third-party package is that third-party packages have the creator's account ID as a prefix, for example, to add the excellent HammerJS package to your app, you need to enter the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add chriswessels:hammer</strong></span>
</pre></div><p>Other recipes<a id="id88" class="indexterm"/> in this chapter will walk you through discovering and implementing third-party packages, so stay tuned!</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec67"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Discovering new packages with Atmosphere</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Removing Meteor packages" id="aid-SJGS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Removing Meteor packages</h1></div></div></div><p>Removing <a id="id89" class="indexterm"/>Meteor packages is just as easy as adding them. This recipe will show you how to quickly remove a Meteor package.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec68"/>Getting ready</h2></div></div></div><p>You will need Meteor installed and have a project created. You should also have a terminal window open and navigate to the root folder of your project. For example, if the name of your project is <code class="literal">packagesTest</code>, located in the <code class="literal">~/Documents/MeteorProjects</code> folder, enter the following command in a terminal window:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/Documents/MeteorProjects/packagesTest</strong></span>
</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec69"/>How to do it…</h2></div></div></div><p>Let's remove the <code class="literal">insecure</code> Meteor package. In your terminal window, enter the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor remove insecure</strong></span>
</pre></div><p>This will remove the <code class="literal">insecure</code> package.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec70"/>How it works…</h2></div></div></div><p>The <code class="literal">meteor remove [package name]</code> command will direct Meteor to look for the named package in your project declaration files and remove the declaration and source files for the package from your project.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec71"/>There's more…</h2></div></div></div><p>It's sometimes very helpful to check and see which packages you have added to your project. To see this list, enter the following command in your terminal window:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor list</strong></span>
</pre></div><p>This will give you a quick list of all the packages contained in your project.</p></div></div>
<div class="section" title="Discovering new packages with Atmosphere"><div class="titlepage" id="aid-TI1E2"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Discovering new packages with Atmosphere</h1></div></div></div><p>Meteor <a id="id90" class="indexterm"/>is an emerging platform, growing in popularity every day. The Meteor community is coming up with new packages <a id="id91" class="indexterm"/>and integrations with existing JavaScript libraries on almost a daily basis. Because the core Meteor team doesn't have time to test and apply every new package made by the community, a package registry, with a streamlined installation process, has been created. This package registry is called Atmosphere. Atmosphere has a clean, simple UI, which allows you to search for, rate, and discover new packages by popularity. This recipe will show you how to use Atmosphere to find and implement both Meteor and third-party packages.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec72"/>Getting ready</h2></div></div></div><p>There's nothing really to do here, but you'll definitely want to have Meteor installed and a project created to start using the packages listed on Atmosphere right away!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec73"/>How to do it…</h2></div></div></div><p>To discover new packages with <a id="id92" class="indexterm"/>Atmosphere, proceed with the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In a browser, navigate to <a class="ulink" href="https://atmospherejs.com">https://atmospherejs.com</a>. You should see a very simple page with a centered search input box. Let's look for the official Twitter <code class="literal">bootstrap</code> package.</li><li class="listitem">Type in the word <code class="literal">bootstrap</code> and watch the search results appear as you type. You should see something similar to the following screenshot:<div class="mediaobject"><img src="../Images/image00331.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>You'll notice that each card in the search results has some statistics at the bottom. The down arrow statistic is the number of downloads, which (with the age of the package) is the primary statistic in the search results ranking. You will see a star, which represents the number of developers that have favorited/starred the package. Finally, you will see a gray line in the background, indicating popularity over time.</p><div class="note" title="Note"><h3 class="title"><a id="note04"/>Note</h3><p>The second result (<code class="literal">twbs:bootstrap</code>) is the official Twitter Bootstrap package.</p></div></li><li class="listitem">Click <a id="id93" class="indexterm"/>on the <code class="literal">twbs:bootstrap</code> card and an overview of the package will appear. You will see additional<a id="id94" class="indexterm"/> information about the package. This includes usage instructions, a link to the GitHub repository (if available), an expanded history of the package, related packages, dependants, and dependencies. At the very top of the page will be the instructions to add the package to your project:<div class="mediaobject"><img src="../Images/image00332.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You can copy the text and execute it in a terminal window, in your root project folder, as shown in the following code:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add twbs:bootstrap</strong></span>
</pre></div><p>After a brief download process, the official Bootstrap package will be installed in your project.</p><p>As mentioned in the previous example, Atmosphere has several additional discovery options. There are links to the package contributors' profiles (so you can see other packages they may have contributed to), as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00333.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>There <a id="id95" class="indexterm"/>are <a id="id96" class="indexterm"/>links to related packages, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00334.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>There are links to dependants and dependencies as well, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00335.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>Any of these links<a id="id97" class="indexterm"/> will help you to discover other packages that will complement the original package and could be useful in your application.</p><p>Yet even more options <a id="id98" class="indexterm"/>exist for discovering packages in Atmosphere. If you navigate back to the home page at <a class="ulink" href="https://atmospherejs.com/">https://atmospherejs.com/</a> and scroll down, you will see sections for <span class="strong"><strong>Trending</strong></span>, <span class="strong"><strong>Most Used</strong></span>, <span class="strong"><strong>Recent</strong></span>, and <span class="strong"><strong>Top Searches</strong></span>. All of these are worth perusing to discover some of the latest and greatest packages available for use:</p><div class="mediaobject"><img src="../Images/image00336.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Feel free to explore and discover. You'll find some hidden gems in Atmosphere, and more than anything else, you'll <a id="id99" class="indexterm"/>come to realize that a Meteor package exists for almost everything. If it doesn't, create one yourself, with the <span class="emphasis"><em>Building a custom package</em></span> recipe found later in this chapter.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec74"/>How it works…</h2></div></div></div><p>The Atmosphere site simply puts a user-friendly wrapper on top of the Meteor package repository. It does this very well, and the contributors/creators of the site are to be commended. Atmosphere is improving over time, and you can contribute to its success if you are so inclined. You can check out what's coming down the pipe by visiting the Atmosphere FAQ, found<a id="id100" class="indexterm"/> at <a class="ulink" href="https://atmospherejs.com/i/faq">https://atmospherejs.com/i/faq</a>.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec75"/>There's more…</h2></div></div></div><p>If you're in a hurry <a id="id101" class="indexterm"/>or really really love the command line, you can perform searches in a terminal window, in the root folder of your project. Here's an example of a CLI-based search:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor search bootstrap</strong></span>
</pre></div><p>The results will be listed, with a brief explanation for each result, in alphabetical order:</p><div class="mediaobject"><img src="../Images/image00337.jpeg" alt="There's more…"/></div><p style="clear:both; height: 1em;"> </p><p>Be sure to note that the results from this can be pretty hefty (there's no prioritization of results), so the effectiveness in using a CLI-based search will vary.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec76"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Building a custom package</em></span> and <span class="emphasis"><em>Publishing custom packages to Atmosphere</em></span> recipes in this chapter</li></ul></div></div></div>
<div class="section" title="Creating a multipage application with Iron Router"><div class="titlepage" id="aid-UGI02"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Creating a multipage application with Iron Router</h1></div></div></div><p>Iron Router<a id="id102" class="indexterm"/> is an extremely useful <a id="id103" class="indexterm"/>Atmosphere package. It allows you to quickly and easily add <a id="id104" class="indexterm"/>multiple server pages to your Meteor project. This recipe will show you how to configure your project to use Iron Router.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec77"/>Getting ready</h2></div></div></div><p>You need to have Meteor installed. You will also need a blank Meteor project (see the <span class="emphasis"><em>Setting up your project file structure</em></span> recipe in <a class="link" title="Chapter 1. Optimizing Your Workflow" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>
,  <span class="emphasis"><em>Optimizing Your Workflow</em></span>).</p><p>Finally, you will need to add the Iron Router package to your Meteor project. You can reference the <span class="emphasis"><em>Adding Meteor packages</em></span> recipe found previously in this chapter, or enter the following command in your terminal window, in the root folder of your project:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add iron:router</strong></span>
</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec78"/>How to do it…</h2></div></div></div><p>We are going to create a very simple example of multiple pages and we will use a fresh blank project to do so.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, set up the route paths for the multiple pages. Create a subfolder called <code class="literal">router</code> in the <code class="literal">both</code> subfolder of your project. This can be done in a terminal window with the following command after navigating to the root folder of your project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mkdir both/router</strong></span>
</pre></div></li><li class="listitem">Now, create <a id="id105" class="indexterm"/>a new file named <code class="literal">router.js</code> in the <code class="literal">router</code> folder. Open the <code class="literal">router.js</code> file in a text editor, add the following code, and save your changes:<div class="informalexample"><pre class="programlisting">Router.configure({ layout:'routeexample' });

Router.map(function (){ this.route('thing1', { path: '/' });
  this.route('thing2', { path: '/second' });
});</pre></div></li><li class="listitem">Next, open <a id="id106" class="indexterm"/>your <code class="literal">main.html</code> file, located in the <code class="literal">client</code> subfolder, in an editor. Add the following template declarations to the bottom of the file and save your changes:<div class="informalexample"><pre class="programlisting">&lt;template name="routeexample"&gt;
{{yield}}
&lt;/template&gt;

&lt;template name="thing1"&gt;
&lt;div&gt; I am the FIRST page&lt;/div&gt;
&lt;/template&gt;

&lt;template name="thing2"&gt;
&lt;div&gt; I am the SECOND page&lt;/div&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">Now, open the <code class="literal">main.js</code> file found at <code class="literal">[project folder]/client/scripts/main.js</code> in an editor. Locate the <code class="literal">Template.hello.events</code> method and change the '<code class="literal">click button'</code> function body to the following:<div class="informalexample"><pre class="programlisting">Template.hello.events({
    'click button' : function () {
      Router.current().route.getName()=='thing1'? Router.go('thing2'): Router.go('thing1');
    }
  });</pre></div></li><li class="listitem">Save<a id="id107" class="indexterm"/> your changes to all the files and run your application using the <code class="literal">meteor</code> command.<p>When you navigate to your project's home page in a browser (<code class="literal">http://localhost:3000/</code>), you should see something similar to the following screenshot:</p><div class="mediaobject"><img src="../Images/image00338.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click <a id="id108" class="indexterm"/>on the button marked <span class="strong"><strong>Click Me</strong></span>, or navigate to <code class="literal">http://localhost:3000/second/</code> and the screen should change to the following:<div class="mediaobject"><img src="../Images/image00339.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">You can continue to toggle between the two pages by clicking on the onscreen button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec79"/>How it works…</h2></div></div></div><p>Iron Router uses<a id="id109" class="indexterm"/> the path in your URL to invoke events in both the client and server. In most cases (unless you explicitly set the Iron Router path to render on the server, using the <code class="literal">where</code> parameter) the events and subsequent rendering happen in the client only.</p><p>In essence, Iron Router <a id="id110" class="indexterm"/>uses the path as an arguments list, invoking functions and rendering appropriate templates based on the information contained in the path.</p><p>Let's break down the code we just entered to get Iron Router up and running, starting with <code class="literal">router.js</code>:</p><div class="informalexample"><pre class="programlisting">Router.configure({
     layout:'routeexample'
});</pre></div><p>This code snippet tells Iron Router to use the <code class="literal">&lt;template&gt;</code> tag named <code class="literal">routeexample</code> as the main/default template for the page.</p><p>We created the <code class="literal">routeexample</code> template in <code class="literal">main.html</code>, like so:</p><div class="informalexample"><pre class="programlisting">&lt;template name="routeexample"&gt;
{{yield}}
&lt;/template&gt;</pre></div><p>The <code class="literal">yield</code> statement found in this template is known as the main yield. It is a placeholder for other templates that will be rendered once Iron Router completes its mapping process.</p><p>Continuing, in <code class="literal">router.js</code>, we have the <code class="literal">Router.map</code> function:</p><div class="informalexample"><pre class="programlisting">Router.map(function (){
  this.route('thing1', {
    path: '/'
  });
  this.route('thing2', {
    path: '/second'
  });
});</pre></div><p>This creates two mapped routes, using the <code class="literal">this.route</code> function. In each function call, the first parameter specifies the name of the route, and because we didn't specify a specific template, it also implies the name of the template to use. In this case, we used the <code class="literal">thing1</code> and <code class="literal">thing2</code> templates, which we created in <code class="literal">main.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;template name="thing1"&gt;
&lt;div&gt; I am the FIRST page&lt;/div&gt;
&lt;/template&gt;

&lt;template name="thing2"&gt;
&lt;div&gt; I am the SECOND page&lt;/div&gt;
&lt;/template&gt;</pre></div><p>These are very <a id="id111" class="indexterm"/>simple templates, and this is what makes them easy to understand for our example. Each template renders a simple <code class="literal">div</code> element with a message inside of it, indicating what page the user is on.</p><p>Going back to <code class="literal">router.js</code>, each <code class="literal">this.route</code> function call has a path argument inside of it. This path argument tells Iron Router what to look for in the URL to determine mapping. In the case of our first page (rendering the <code class="literal">thing1</code> template), the <code class="literal">path</code> element was set to "/", or the root path. In the case of our second page (rendering the <code class="literal">thing2</code> template), the <code class="literal">path</code> was set to "/second".</p><p>At this point, Iron Router <a id="id112" class="indexterm"/>was properly mapped, meaning this will have rendered the appropriate template based on the mapped routes. We wanted to make switching back and forth between the two routes easy, so we modified the <code class="literal">main.js</code> script as follows:</p><div class="informalexample"><pre class="programlisting">Template.hello.events({
    'click button' : function () {
      Router.current().route.getName()=='thing1'? Router.go('thing2'): Router.go('thing1');
    }
  });</pre></div><p>Now, when our button is clicked, we are checking to see whether the name of the currently mapped route (found using <code class="literal">Router.current().route.getName()</code>) is <code class="literal">thing1</code>. If it is, we tell Iron Router to change the currently rendered template (and the URL path) to our second template, named <code class="literal">thing2</code>, with a <code class="literal">path</code> value set to "/second". If the currently mapped route isn't <code class="literal">thing1</code>, then we toggle back to the original mapped route.</p><p>The <code class="literal">Router.go</code> statement changes the URL path, thereby setting events in motion to render the appropriate template and insert it into the main yield.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec80"/>There's more…</h2></div></div></div><p>Iron Router is a <a id="id113" class="indexterm"/>very sophisticated and powerful package, with many helpful features including pre-rendering events, setting data context, and access to server-side functions. If you are looking to build a multipage Meteor application, you<a id="id114" class="indexterm"/> will want to peruse the full documentation, found at <a class="ulink" href="https://github.com/EventedMind/iron-router">https://github.com/EventedMind/iron-router</a>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec81"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Creating a complete app with Iron Router</em></span> recipe in <a class="link" title="Chapter 12. Creating Useful Projects" href="part0088.xhtml#aid-2JTHG1">Chapter 12</a>, <span class="emphasis"><em>Creating Useful Projects</em></span></li></ul></div></div></div>
<div class="section" title="Building a custom package"><div class="titlepage" id="aid-VF2I2"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Building a custom package</h1></div></div></div><p>As you become<a id="id115" class="indexterm"/> more familiar with Meteor, you will want to start creating your own custom package, which consolidates the code you may find useful in multiple projects. This recipe will walk you through the basics of creating your own personal Meteor package.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec82"/>Getting ready</h2></div></div></div><p>The only thing you need for this recipe is Meteor and a text editor.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec83"/>How to do it…</h2></div></div></div><p>We will create a package that will allow us to easily write to the console in not only the client web console, but also in the server terminal console.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To create a new baseline package, open a terminal window and navigate to where you would like your package to reside. Once there, execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor create --package [myMeteorID]:testpack</strong></span>
</pre></div><p>Make sure you replace <code class="literal">[myMeteorID]</code> with your own Meteor Developer Account ID or with the ID of the Meteor organization you belong to, for example (and for the rest of this chapter), we will use the <code class="literal">packtmeteor</code> organization. So our command will look like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor create --package packtmeteor:testpack</strong></span>
</pre></div></li><li class="listitem">We will now add the code for our package. Open the file named <code class="literal">testpack.js</code> and add the following code:<div class="informalexample"><pre class="programlisting">TestPack = {
  log: function(msg){
    console.log(msg);
    Meteor.call('serverlog',msg);
  }
};</pre></div><p>Save your changes and create a new file in the same folder named <code class="literal">servertestpack.js</code>. Open this file for editing and add the following code:</p><div class="informalexample"><pre class="programlisting">Meteor.methods({
  serverlog : function(msg){
    console.log(msg);
  }
});</pre></div></li><li class="listitem">We <a id="id116" class="indexterm"/>now need to make a few modifications to <code class="literal">package.js</code>, to make sure our package will work properly. Open <code class="literal">package.js</code> and modify the <code class="literal">Package.onUse()</code> method to look like the following:<div class="informalexample"><pre class="programlisting">Package.onUse(function(api) {
  api.versionsFrom('1.0.3.2');
  api.addFiles(<span class="strong"><strong>'testpack.js', 'client'</strong></span>);
<span class="strong"><strong>  api.addFiles('servertestpack.js', 'server');</strong></span>
});</pre></div><p>Next, add the following code inside the <code class="literal">Package.onUse()</code> method, just after the last <code class="literal">api.AddFiles()</code> call:</p><div class="informalexample"><pre class="programlisting">Package.onUse(function(api) {

  api.addFiles('servertestpack.js', 'server');

<span class="strong"><strong>  if (api.export){</strong></span>
<span class="strong"><strong>    api.export('TestPack');</strong></span>
<span class="strong"><strong>  }</strong></span>
});</pre></div><p>Finally, modify the <code class="literal">Package.onTest()</code> method by removing the prefix from the test's filename, like so:</p><div class="informalexample"><pre class="programlisting">Package.onTest(function(api) {
  api.use('tinytest');
  api.use('packtmeteor:testpack');
  api.addFiles(<span class="strong"><strong>'testpack-tests.js'</strong></span>);
});</pre></div></li><li class="listitem">Save all your changes, <a id="id117" class="indexterm"/>and your package will be ready to be used in an application. Select a project you have underway, or create a default Meteor project using the <code class="literal">meteor create</code> command, and add a subfolder named <code class="literal">[project root]/packages/</code>. Copy the <code class="literal">testpack/</code> folder and paste it into the <code class="literal">[project root]/packages/</code> folder. Then, in a terminal window, execute the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor add packtmeteor:testpack</strong></span>
</pre></div><p>Your custom package will be registered for use in your project, and you can now start your application:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor</strong></span>
</pre></div><p>Open a browser, navigate to <code class="literal">http://localhost:3000</code> and open the web console. In the web console, enter the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; TestPack.log('my package is worky!')</strong></span>
</pre></div><p>You should see the following screen in the browser console:</p><div class="mediaobject"><img src="../Images/image00340.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>You should see the following in the server terminal console:</p><div class="mediaobject"><img src="../Images/image00341.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div><p>Congratulations! You've just created your own personal package.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec84"/>How it works…</h2></div></div></div><p>Packages in Meteor <a id="id118" class="indexterm"/>are really just collections of organized files, with a configuration file that tells Meteor how to use those files.</p><p>In this case, we created a default package template using the <code class="literal">meteor create --package</code> command. Note that we followed the <code class="literal">[owner]:[package name]</code> naming convention, which Meteor requires if we want to publish this package on Atmosphere for others to use (refer to the <span class="emphasis"><em>Publishing custom packages to Atmosphere</em></span> recipe in this chapter for details).</p><p>Once created, we added our functionality, which was very simple. We just called <code class="literal">console.log()</code> on the client and on the server.</p><p>Then, we modified the configuration file, which is always named <code class="literal">package.js</code>. The following table shows the three sections that this file contains:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td valign="top">
<p><code class="literal">Package.describe()</code></p>
</td><td valign="top">
<p>This contains the name, summary, and version number of our package.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">Package.onUse()</code></p>
</td><td valign="top">
<p>This lists dependencies and exposes the methods available in our package.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">Package.onTest()</code></p>
</td><td valign="top">
<p>This lists dependencies and test methods to be run during testing.</p>
</td></tr></tbody></table></div><p>For this recipe, we didn't modify the <code class="literal">Package.describe()</code> method. Meteor autocreated this section for us and gave us a <span class="emphasis"><em>version number</em></span>, which is required.</p><div class="note" title="Note"><h3 class="title"><a id="tip19"/>Tip</h3><p>Version numbers for packages follow the <span class="strong"><strong>Semantic Versioning Specification (SemVer)</strong></span> specification (3 digits + an optional wrap, such as <code class="literal">1.0.2-rc_beta</code>). More information on the SemVer specification<a id="id119" class="indexterm"/> can be found at <a class="ulink" href="http://semver.org/">http://semver.org/</a></p></div><p>The bulk of our changes occurred in <code class="literal">Package.onUse()</code>, so we'll go through each item in this method.</p><p>The <code class="literal">api.versionsFrom()</code> method specifies which version of Meteor the core packages used in your package should come from. This comes in handy because Meteor is updated pretty regularly, and some of the dependencies needed to run your package may change in later versions. This method allows you to <span class="emphasis"><em>freeze</em></span> the release versions of the dependency packages you use in your app to prevent compatibility issues.</p><p>The <code class="literal">api.addFiles()</code> method <a id="id120" class="indexterm"/>allows us to include files found in our package directory and to specify whether they are client or server-specific. In our case, we used <code class="literal">api.addFiles()</code> with a <code class="literal">client</code> parameter to tell Meteor that the <code class="literal">testpack.js</code> file was client-specific. We then used a <code class="literal">server</code> parameter to tell Meteor that the <code class="literal">servertestpack.js</code> file was server-specific.</p><p>We then used the <code class="literal">api.export()</code> method to declare/expose the <code class="literal">TestPack</code> object. This is what enabled us to use the <code class="literal">TestPack.log()</code> call in the browser's web console.</p><p>Finally, we have the <code class="literal">Package.onTest()</code> method. It contains two <code class="literal">api.use()</code> method calls, which declare the package dependencies needed to run the <code class="literal">testpack-test.js</code> file during testing.</p><div class="note" title="Note"><h3 class="title"><a id="tip20"/>Tip</h3><p>The <code class="literal">api.use()</code> method isn't exclusive to testing. You can use it in the <code class="literal">Package.onUse()</code> method as well to include the <a id="id121" class="indexterm"/>MDG core or third-party packages.</p></div><p>After completing our modifications, we copied our entire package over to the <code class="literal">packages/</code> subfolder in our project. This is necessary for any non-deployed package. When you use the <code class="literal">meteor add</code> command to add a package, Meteor checks for the package in two places: in the online Meteor package repository (Atmosphere) and in the <code class="literal">[project root]/packages/</code> subfolder. In this case, because our package isn't deployed to Atmosphere, we had a copy of our package in the <code class="literal">packages/</code> subfolder.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec85"/>There's more…</h2></div></div></div><p>Several other options exist for configuring packages (some of which are included in other recipes in this chapter). A complete list of these can be found in the Meteor documentation, found at <a class="ulink" href="http://docs.meteor.com/#/full/packagejs">http://docs.meteor.com/#/full/packagejs</a>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec86"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Using npm modules</em></span> and <span class="emphasis"><em>Publishing custom packages to Atmosphere</em></span> recipes in this chapter</li><li class="listitem">The <span class="emphasis"><em>Building custom server methods</em></span> recipe in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <span class="emphasis"><em>Leveraging Advanced Features</em></span></li></ul></div></div></div>
<div class="section" title="Using npm modules" id="aid-10DJ41"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Using npm modules</h1></div></div></div><p><span class="strong"><strong>Node Package Manager</strong></span> (<span class="strong"><strong>NPM</strong></span>) has <a id="id122" class="indexterm"/>thousands of modules available. Knowing<a id="id123" class="indexterm"/> how to add an npm module for use in your Meteor project gives you access to all of those modules. This recipe will show you how to do this.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec87"/>Getting ready</h2></div></div></div><p>You will need to make sure that you have Meteor and Node/npm installed.</p><p>You will also need a project that makes use of a custom-built package. We will be using the project from the <span class="emphasis"><em>Building a custom package</em></span> recipe, found in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec88"/>How to do it…</h2></div></div></div><p>We first need to add a reference to the npm package that we would like to add, which in this case is going to be the <code class="literal">colors</code> module.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Inside <a id="id124" class="indexterm"/>your custom package (the one in the <code class="literal">packages/</code> subfolder of your app), in the <code class="literal">package.js</code> file, add an <code class="literal">Npm.depends</code> statement to the end of the file, as shown in the following example:<div class="informalexample"><pre class="programlisting">Npm.depends({
    "colors": "0.6.2"
});</pre></div></li><li class="listitem">Now we need to add an <code class="literal">Npm.require</code> reference to the <code class="literal">colors</code> module and change our <code class="literal">console.log()</code> command to use a rainbow of fruit flavors. Change your <code class="literal">server-test.js</code> file so it looks like the following example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>var colors = Npm.require('colors');</strong></span>

Meteor.methods({
  serverlog : function(msg,warn){
    console.log(msg<span class="strong"><strong>.rainbow</strong></span>);
  }
});</pre></div></li><li class="listitem">Save your changes and we are ready to test our updated package. Navigate to <code class="literal">http://localhost:3000</code> in a browser, open the browser web console, and execute the following command a few times:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; TestPack.log('rainbows and unicorns')</strong></span>
</pre></div></li><li class="listitem">If you switch to your console window, you should see a multicolored response, as shown in the following screenshot:<div class="mediaobject"><img src="../Images/image00342.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec89"/>How it works…</h2></div></div></div><p>The <a id="id125" class="indexterm"/>
<code class="literal">Npm.depends</code> declaration<a id="id126" class="indexterm"/> in <code class="literal">package.js</code> tells Meteor that whenever it starts, it needs to go and install the npm modules listed. In this case, we are telling Meteor to go and fetch the <code class="literal">colors</code> module, version <code class="literal">0.6.2</code>, from the npm registry.</p><p>The <code class="literal">Npm.require</code> function<a id="id127" class="indexterm"/>
<a id="id128" class="indexterm"/> call in <code class="literal">server-test.js</code> makes the <code class="literal">colors</code> module functionality available on the server. Now, any time we make a <code class="literal">console.log()</code> call, the string passed into the call can have a <code class="literal">.color</code> reference added to it. In our case, we chose <code class="literal">.rainbow</code>, which makes every letter from the string printed out to the console appear in a different color.</p><div class="note" title="Note"><h3 class="title"><a id="tip21"/>Tip</h3><p>To see all the various options available in the npm <code class="literal">colors</code> module<a id="id129" class="indexterm"/>, visit <a class="ulink" href="https://npmjs.org/package/colors">https://npmjs.org/package/colors</a>.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec90"/>There's more…</h2></div></div></div><p>You can use any npm module you would like in a custom Meteor package. Some of them rely on asynchronous methods and events, so you will have to wrap those modules with specific asynchronous Meteor methods. You can read more about these methods in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <span class="emphasis"><em>Leveraging Advanced Features</em></span>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec91"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Using npm packages directly</em></span> recipe in <a class="link" title="Chapter 8. Integrating Third-party Libraries" href="part0069.xhtml#aid-21PMQ1">Chapter 8</a>, <span class="emphasis"><em>Integrating Third-party Libraries</em></span></li><li class="listitem">The <span class="emphasis"><em>Handling asynchronous methods and using asynchronous functions</em></span> recipe in <a class="link" title="Chapter 11. Leveraging Advanced Features" href="part0083.xhtml#aid-2F4UM1">Chapter 11</a>, <span class="emphasis"><em>Leveraging Advanced Features</em></span></li></ul></div></div></div>
<div class="section" title="Publishing custom packages to Atmosphere"><div class="titlepage" id="aid-11C3M2"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Publishing custom packages to Atmosphere</h1></div></div></div><p>When <a id="id130" class="indexterm"/>you've created a useful package and want to share it with the world, Atmosphere is the way to go. This recipe will show you how to <a id="id131" class="indexterm"/>upload your custom package to Atmosphere and provides some best practices for maintaining your package moving forward.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec92"/>Getting ready</h2></div></div></div><p>To create a quick Atmosphere package, please complete the <span class="emphasis"><em>Using npm modules</em></span> recipe found in this chapter.</p><p>You will also need to create a blank repository on GitHub. Assuming you have a <a id="id132" class="indexterm"/>GitHub login, navigate to the home page (<a class="ulink" href="https://github.com">https://github.com</a>) and create a new repository:</p><div class="mediaobject"><img src="../Images/image00343.jpeg" alt="Getting ready"/></div><p style="clear:both; height: 1em;"> </p><p>Add a title and description to your repository and click on the button marked <span class="strong"><strong>Create repository</strong></span>.</p><p>To populate your new<a id="id133" class="indexterm"/> Git repository, you will need the Git URL, which can be copied from the home page of your new Git project. It should look something like <a class="ulink" href="https://github.com/strack/packt-testpack.git">https://github.com/strack/packt-testpack.git</a>.</p><p>Remember this URL, as you will be using it to populate the content of your new repository.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec93"/>How to do it…</h2></div></div></div><p>To register and <a id="id134" class="indexterm"/>upload our package, we need to check our configuration file, upload our code to GitHub, and then deploy our package.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To configure <code class="literal">package.js</code>, open the <code class="literal">package.js</code> file found in the root folder of your package. In our case, the file is located at <code class="literal">[project root]/packages/testpack/package.js</code>. We will first modify the summary, as shown in the following example:<div class="informalexample"><pre class="programlisting">  // Brief, one-line summary of the package.
  summary: <span class="strong"><strong>'Demonstration of an Atmosphere Package'</strong></span>,</pre></div><p>Next, we will add the GitHub URL to the <code class="literal">git</code> property:</p><div class="informalexample"><pre class="programlisting">  // URL to the Git repository...
  git: <span class="strong"><strong>'https://github.com/strack/packt-testpack.git'</strong></span>,</pre></div><p>You will notice that the documentation property references the <code class="literal">README.md</code> file, which means that our GitHub documentation will serve a dual purpose. Open <code class="literal">README.md</code> and add the following line:</p><div class="informalexample"><pre class="programlisting">Demonstration of an Atmosphere Package, deployed to Atmosphere</pre></div></li><li class="listitem">To push the code to GitHub, save all of your files and navigate to the root folder of your package (not the root folder of your application) in a terminal window. In our case, the root folder is <code class="literal">[project root]/packages/testpack/</code>. Enter the following lines to populate the GitHub repository:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git init</strong></span>
<span class="strong"><strong>$ git add -A</strong></span>
<span class="strong"><strong>$ git commit -m "Created color server console"</strong></span>
<span class="strong"><strong>$ git remote add origin https://github.com/strack/packt-testpack.git</strong></span>
<span class="strong"><strong>$ git pull origin master –m "initial pull"</strong></span>
<span class="strong"><strong>$ git push origin master</strong></span>
</pre></div></li><li class="listitem">To <a id="id135" class="indexterm"/>publish<a id="id136" class="indexterm"/> to Atmosphere, call <code class="literal">meteor publish</code> with the following command once it is completed:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ meteor publish --create</strong></span>
</pre></div><p>Voila! You have added your package to Atmosphere.</p></li></ol><div style="height:10px; width: 1px"/></div><div class="note" title="Note"><h3 class="title"><a id="tip22"/>Tip</h3><p>We deployed all packages directly from the <code class="literal">packages</code> subfolder of an application. A best practice is to develop and deploy your package on its own, independent of any application. Refer to the <span class="emphasis"><em>Building a custom package</em></span> recipe.</p></div><p>You can see your package live on Atmosphere by navigating to <a class="ulink" href="https://atmospherejs.com">https://atmospherejs.com</a> and searching for it by name, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00344.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>As with any <a id="id137" class="indexterm"/>other Meteor package found in Atmosphere, you can add it to any of your projects using the <code class="literal">meteor add</code> command in the terminal.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec94"/>How it works…</h2></div></div></div><p>Atmosphere reads<a id="id138" class="indexterm"/> the <code class="literal">package.js</code> file for the data that needs to be published, checks to make sure all information is accurate, and then publishes a link to your project from a GitHub repository. In this specific case, we added a summary to our file, specified the GitHub URL in the <code class="literal">git</code> property, and (after creating the GitHub repository) called <code class="literal">meteor publish</code> to deploy packages.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec95"/>There's more…</h2></div></div></div><p>More instructions on how to publish to <a id="id139" class="indexterm"/>Atmosphere can be found at <a class="ulink" href="https://atmospherejs.com/i/publishing">https://atmospherejs.com/i/publishing</a>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec96"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">The <span class="emphasis"><em>Adding Meteor packages</em></span> and <span class="emphasis"><em>Discovering new packages with Atmosphere</em></span> recipes in this chapter</li></ul></div></div></div></body></html>