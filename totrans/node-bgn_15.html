<html><head></head><body>
		<div><h1 id="_idParaDest-386" class="chapter-number"><a id="_idTextAnchor394"/>15</h1>
			<h1 id="_idParaDest-387"><a id="_idTextAnchor395"/> Securing Web Applications</h1>
			<p>In this chapter, we are going to explore how to improve the security of our web applications. We will start by discussing the impact of a security incident on businesses and how to get started with security<a id="_idIndexMarker879"/> in our day-to-day work. Then we will explore key resources such as the OWASP Top 10, the <strong class="bold">Common Weakness Enumeration</strong> (<strong class="bold">CWE</strong>), and the <strong class="bold">Common Vulnerabilities and Exposures</strong> (<strong class="bold">CVE</strong>) to improve our understanding of security<a id="_idIndexMarker880"/> in modern web applications.</p>
			<p>Then, we will explore the Node.js threat model and the official Node.js best practices to improve the security of our applications. We will apply this knowledge to create a checklist that we can use to improve the security of our existing applications.</p>
			<p>Finally, we will explore how to take advantage of our security knowledge to become an ethical hacker and how to skill up while participating in community events and bug bounty programs.</p>
			<p>To sum up, here are the main topics that we will explore in this chapter:</p>
			<ul>
				<li>The importance of security</li>
				<li>Where to start with security</li>
				<li>Improving the security of our applications</li>
				<li>Becoming an ethical hacker</li>
			</ul>
			<h1 id="_idParaDest-388"><a id="_idTextAnchor396"/>Technical requirements</h1>
			<p>The code files for the chapter can be found at <a href="https://github.com/PacktPublishing/NodeJS-for-Beginners">https://github.com/PacktPublishing/NodeJS-for-Beginners</a>.</p>
			<h1 id="_idParaDest-389"><a id="_idTextAnchor397"/>The importance of security</h1>
			<p>Historically, the security of applications <a id="_idIndexMarker881"/>was not considered a priority by developers. The main reason was that the security culture was not present in the developers’ mindset as the main goal was to deliver features as soon as possible and, historically, the systems that we built were not critical for the business or exposed to the internet 24/7 as they are today.</p>
			<p class="author-quote">“There are only two types of companies: those that have been hacked, and those that will be.”</p>
			<p class="author-quote">– Robert Mueller, FBI Director, 2012</p>
			<p>Nowadays, we depend on a lot of third-party libraries and services that we don’t control, and we don’t know whether they are secure or not. We build very complex systems with many layers beyond our own business logic, and we need to be aware of the risks that we are taking and how to mitigate them.</p>
			<p>At the end of the day, it is up to us as individuals to be aware of the risks, and the security of our applications is our responsibility. Quite often, we assume that security is someone else’s responsibility but that is not true. Even in organizations with a security team, developers are the first line of defense and the ones that need to be aware of the risks and how to mitigate them.</p>
			<h2 id="_idParaDest-390"><a id="_idTextAnchor398"/>Social engineering</h2>
			<p>I love Hollywood hacker movies<a id="_idIndexMarker882"/> that use super sophisticated tools<a id="_idIndexMarker883"/> to hack fictional systems, but the reality is that the most common attack vector is social engineering. It is easier to trick a human than to hack a system, which is why social engineering is the most common attack vector. There are many techniques (phishing, pretexting, baiting, and so on) and they evolve and get more sophisticated over time. All these types of attacks have psychological manipulation in common. This can include the use of authoritative roles (such as the attacker pretending to be a police officer), or the attacker using scarcity tactics (such as saying there are only five devices left at an ultra-cheap price in a special offer, which is a scam offer). These are just two examples but many more tactics use the weaknesses/desires that we all share as human beings.</p>
			<p class="author-quote">“Social engineering bypasses all technologies, including firewalls.”</p>
			<p class="author-quote">– Kevin Mitnick</p>
			<p>We all have received emails that claim to be from our bank or from a service that we use, asking us to click on a very suspicious link or to download a file. Most of these emails are phishing attacks that your email provider will detect and classify as spam. As technologists, we think that we are not going to fall for these kinds of attacks but the reality is that there are more and more sophisticated attacks that are targeting developers and that are very difficult to detect.</p>
			<p>Let me introduce to you the <code>lodash</code> package but you make a typo and instead install the <code>lodahs</code> package.</p>
			<p>Two of the malicious activities that this can do are search for <code>.env</code> files in your project and send them to the attacker’s server or install a backdoor in your application. There are many more activities, too.</p>
			<p>We have seen this kind<a id="_idIndexMarker885"/> of attack in the<a id="_idIndexMarker886"/> past; for example, the<a id="_idIndexMarker887"/> popular <code>cross-env</code> package (<a href="https://www.npmjs.com/package/cross-env">https://www.npmjs.com/package/cross-env</a>), which is used to set environment variables in a cross-platform way, has a malicious version called <code>crossenv</code> (<a href="https://snyk.io/advisor/npm-package/crossenv">https://snyk.io/advisor/npm-package/crossenv</a>) that contains a malicious payload.</p>
			<p>You can find more details about this kind of attack at <a href="https://snyk.io/blog/typosquatting-attacks/">https://snyk.io/blog/typosquatting-attacks/</a>.</p>
			<p class="callout-heading">Information</p>
			<p class="callout">Currently, npm has policies that prevent you from publishing packages with similar names to ones that have been previously<a id="_idIndexMarker888"/> published in order to prevent this kind of attack (<a href="https://docs.npmjs.com/threats-and-mitigations#by-typosquatting--dependency-confusion">https://docs.npmjs.com/threats-and-mitigations#by-typosquatting--dependency-confusion</a>).</p>
			<h2 id="_idParaDest-391"><a id="_idTextAnchor399"/>Risks in the supply chain</h2>
			<p>For many years, I was evangelizing <a id="_idIndexMarker889"/>about the importance of security<a id="_idIndexMarker890"/> in the supply chain. It is sometimes hard to understand the risks because the supply chain is not visible to us and the impact on our code is not as clear as a SQL injection or a memory leak.</p>
			<p>In 2020, I wrote a blog post discussing how we can build a backdoor in a Node.js application using a malicious package from npm (<a href="https://snyk.io/blog/what-is-a-backdoor/">https://snyk.io/blog/what-is-a-backdoor/</a>). A backdoor is a piece of code that will allow us to take control of the application remotely. Basically, we have remote access to the operating system terminal to execute any command that we want with the privileges of the user who is running the application.</p>
			<p>To make it more realistic, I created a malicious Express middleware that allows us to execute any command that we want in the operating system terminal. Then, I published the package in npm to make it available to the community. The package was called <code>browser-redirect</code> and the expected<a id="_idIndexMarker891"/> behavior was to redirect any user who was not using a Chromium-based browser to <a href="https://browsehappy.com/">https://browsehappy.com/</a>. To do that, you only need to use the package as a middleware in your Express application. The package performed the expected behavior but it also did more malicious things in the background, including adding specific headers to the HTTP response that helps find infected<a id="_idIndexMarker892"/> servers across the internet with tools such as Shodan (<a href="https://www.shodan.io/">https://www.shodan.io/</a>) and executing commands in the operating system terminal when certain conditions were met. This code didn’t require any external library to perform any of the malicious activities, so the malicious payload<a id="_idIndexMarker893"/> was not easily recognizable when<a id="_idIndexMarker894"/> running scanning tools.</p>
			<p class="callout-heading">Information</p>
			<p class="callout">You can find the blog post in the Snyk blog (<a href="https://snyk.io/blog/what-is-a-backdoor/">https://snyk.io/blog/what-is-a-backdoor/</a>) with a detailed explanation of the code execution, mitigation strategies, and much more.</p>
			<h2 id="_idParaDest-392"><a id="_idTextAnchor400"/>The business impact</h2>
			<p>Any security incident has a direct<a id="_idIndexMarker895"/> impact on the business. We can lose our reputation and the trust of our customers. Also, the incident can directly affect our clients; for example, if we suffer a ransomware attack and we cannot provide the service to our customers or, even worse, if we lose the data of our customers, that can lead to legal problems and additional attacks directly targeting our customers.</p>
			<p>Data breaches are so common that we don’t even pay attention to them in the mass media. However, the impact on users can be very high. In recent years, we have seen many data breaches that have affected millions of users, providing access to information such as passwords, credit card details, payment logs, sexual orientation, criminal records, geolocation records, and so on. You can find a detailed ranking at <a href="https://www.upguard.com/blog/biggest-data-breaches">https://www.upguard.com/blog/biggest-data-breaches</a>.</p>
			<p>In 2013, Troy Hunt (<a href="https://www.troyhunt.com/about/">https://www.troyhunt.com/about/</a>) created the website <a href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a> where you can check whether <a id="_idIndexMarker896"/>your email address has been compromised in a data breach. You can also set up an alert to be notified if your email address appears <a id="_idIndexMarker897"/>in a new data breach.</p>
			<p>Now that we have seen the importance of security in the business, let’s see where we can start to learn more about security in the next section.</p>
			<h1 id="_idParaDest-393"><a id="_idTextAnchor401"/>Where to start with security</h1>
			<p>Security is a vast topic, and it will require several<a id="_idIndexMarker898"/> books to cover all the aspects; even then, it will require more resources to keep it up to date. In this section, we will explore some resources to start learning but with a limited scope to the Node.js ecosystem and web application development.</p>
			<p>We will learn about the OWASP Top 10, CVE, and CWE so we can have a clear compass to navigate through the security world as beginners.</p>
			<h2 id="_idParaDest-394"><a id="_idTextAnchor402"/>OWASP Top 10 overview</h2>
			<p>Many possible attacks<a id="_idIndexMarker899"/> can affect our applications and we cannot<a id="_idIndexMarker900"/> cover all of them, so the task becomes overwhelming. To prioritize the most common attacks, the <strong class="bold">Open Web Application Security Project</strong> (<strong class="bold">OWASP</strong>) foundation created a list<a id="_idIndexMarker901"/> of the 10 most common attacks that affect web applications, and this is<a id="_idIndexMarker902"/> updated every few years. You can find the list at <a href="https://owasp.org/www-project-top-ten">https://owasp.org/www-project-top-ten</a>.</p>
			<p>Let’s see the list of the OWASP Top 10 for 2021:</p>
			<ul>
				<li><strong class="bold">A01:2021 Broken </strong><strong class="bold">Access Control</strong></li>
				<li><strong class="bold">A02:2021 </strong><strong class="bold">Cryptographic Failures</strong></li>
				<li><strong class="bold">A03:2021 Injection</strong></li>
				<li><strong class="bold">A04:2021 </strong><strong class="bold">Insecure Design</strong></li>
				<li><strong class="bold">A05:2021 </strong><strong class="bold">Security Misconfiguration</strong></li>
				<li><strong class="bold">A06:2021 Vulnerable and </strong><strong class="bold">Outdated Components</strong></li>
				<li><strong class="bold">A07:2021 Identification and </strong><strong class="bold">Authentication Failures</strong></li>
				<li><strong class="bold">A08:2021 Software and Data </strong><strong class="bold">Integrity Failures</strong></li>
				<li><strong class="bold">A09:2021 Security Logging and </strong><strong class="bold">Monitoring Failures</strong></li>
				<li><strong class="bold">A10:2021 Server Side Request </strong><strong class="bold">Forgery (SSRF)</strong></li>
			</ul>
			<p>I suggest you read the OWASP Top 10 carefully and try to find what the attacks have in common so you can understand the root cause of the attacks to help you define better strategies to mitigate them.</p>
			<p>As an example, we can see that <strong class="bold">A05 Security Misconfiguration</strong> and <strong class="bold">A06 - Vulnerable and Outdated Components</strong> have a relationship with how we install and configure dependencies and how we keep them up to date. So, we can start to think about how to improve our CI/CD pipeline to automate the installation and updating of the dependencies and we can discuss whether we need a deeper understanding of the dependencies that we rely on. In a very specific case, this can be that we have an NGINX (reverse proxy) instance that is not properly configured and is outdated, and we need to put some effort into improving the configuration and updating the NGINX version regularly.</p>
			<p>Another good way to understand<a id="_idIndexMarker903"/> the OWASP Top 10 is to compare the list<a id="_idIndexMarker904"/> over the years. For example, let’s compare the OWASP Top 10 for 2017 with the OWASP Top 10 for 2021:</p>
			<div><div><img src="img/B21678_15_ForCEing_FS_1.jpg" alt="Figure 15.1 – Comparing OWASP TOP 10 from 2017 with 2021 (source: OWASP)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.1 – Comparing OWASP TOP 10 from 2017 with 2021 (source: OWASP)</p>
			<p>As you can see, there are some additions, deletions, and merges but, overall, the list is very similar with some changes in the order. This makes it easier to refresh your knowledge every few years<a id="_idIndexMarker905"/> when the list<a id="_idIndexMarker906"/> is updated.</p>
			<h2 id="_idParaDest-395"><a id="_idTextAnchor403"/>CWE</h2>
			<p>The Owasp Top 10 includes<a id="_idIndexMarker907"/> references<a id="_idIndexMarker908"/> to the CWE, which is a community-developed list of common software and hardware weaknesses. You can find the list at <a href="https://cwe.mitre.org/data/definitions/699.html">https://cwe.mitre.org/data/definitions/699.html</a>.</p>
			<p>The CWE is a very extensive list and covers a lot of topics, so it is very difficult to read it all. However, it is a great resource to find more information about a specific topic. For example, let’s look at <strong class="bold">CWE-798: Use of Hard-coded Credentials</strong> at <a href="https://cwe.mitre.org/data/definitions/798.html">https://cwe.mitre.org/data/definitions/798.html</a>, which will show us a description, relationship with other CWEs, consequences, and much more.</p>
			<h2 id="_idParaDest-396"><a id="_idTextAnchor404"/>CVE</h2>
			<p>The CVE is a list of publicly<a id="_idIndexMarker909"/> disclosed cybersecurity<a id="_idIndexMarker910"/> vulnerabilities. You can find the list at <a href="https://cve.mitre.org/">https://cve.mitre.org/</a>. This list is different from<a id="_idIndexMarker911"/> the CWE as it is a list of vulnerabilities that have been discovered in specific software products and not a list of possible weaknesses.</p>
			<p>In simple words, the CWE is a list of possible weaknesses, and the CVE is a list of vulnerabilities that have been discovered in the wild. We need to be very aware of the CVE that can potentially affect our applications and mitigate them as soon as possible. One common strategy is to subscribe to the security mailing list of the dependencies that we use in our applications so we can be notified when a new CVE is discovered, or use an automated<a id="_idIndexMarker912"/> tool such as Snyk (<a href="https://snyk.io/">https://snyk.io/</a>) that will notify us when a new CVE is discovered in our dependencies.</p>
			<p>If we don’t have a clear strategy to mitigate the CVE, we will feel overwhelmed very easily by the number of CVE<a id="_idIndexMarker913"/> that are discovered every day, especially in the Node.js <a id="_idIndexMarker914"/>ecosystem, where it is very common to have a lot of dependencies in our applications.</p>
			<h3>CVE in Node.js</h3>
			<p>If we visit <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-12113/Nodejs.html">https://www.cvedetails.com/vulnerability-list/vendor_id-12113/Nodejs.html</a>, we can see the list of CVE<a id="_idIndexMarker915"/> that have been discovered in Node.js<a id="_idIndexMarker916"/> over the years.</p>
			<div><div><img src="img/B21678_15_ForCEing_FS_2.jpg" alt="Figure 15.2 – CVE list"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.2 – CVE list</p>
			<p>As you can see, we are going to pick the most recent one (<strong class="bold">CVE-2023-45143</strong>) and we are going to explore it in detail at <a href="https://www.cvedetails.com/cve/CVE-2023-45143/">https://www.cvedetails.com/cve/CVE-2023-45143/</a>:</p>
			<div><div><img src="img/B21678_15_ForCEing_FS_3.jpg" alt="Figure 15.3 – CVE details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.3 – CVE details</p>
			<p>We should find a clear description of the vulnerability and references to the publication date. This will help us to determine whether we are affected by the vulnerability or not. Also, we can see the vulnerability category (in this case, <strong class="bold">Information leak</strong>) and the probability of exploitation activity in the next 30 days (in this case, <strong class="bold">1.37%</strong>). This will help us prioritize the mitigation of vulnerability, and the overall score will help us to determine the severity of the vulnerability.</p>
			<p>With these things in mind, we can<a id="_idIndexMarker917"/> make a fast decision about the need for mitigation. Also, we can<a id="_idIndexMarker918"/> find a list of references that will help us to understand the vulnerability in more detail and also the CWEs that are related to the vulnerability.</p>
			<p>It is up to us to decide how to mitigate the vulnerability. In some cases, we can just update the dependency to include the fix; in other cases, there is no fix available, and we need to find a workaround or remove the dependency. In other cases, we can just ignore the vulnerability as it is not relevant to our application because it has no impact.</p>
			<p>As a recommendation, I suggest you perform the analysis with more colleagues so you can have different points of view and you can make a solid team decision.</p>
			<p class="callout-heading">Information</p>
			<p class="callout">Node.js is doing a great job of keeping the CVE under control. You can find more information about each CVE in the Node.js blog. For example, <strong class="bold">CVE-2023-45143</strong> is described at <a href="https://nodejs.org/en/blog/vulnerability/october-2023-security-releases">https://nodejs.org/en/blog/vulnerability/october-2023-security-releases</a>.</p>
			<p>If you are developing modern <a id="_idIndexMarker919"/>frontend applications, you will probably use several libraries to build<a id="_idIndexMarker920"/> the application. Commonly, this becomes a great source of CVE because we have many transitive dependencies that we don’t control. Also, it is not easy to upgrade the dependencies because we need to wait for the maintainers to update them and the compatibility with other dependencies. So, please evaluate carefully the dependencies that you use in your applications and divide them between the ones that are part of the running application and the ones that are part of the build process only. This will simplify the review process a lot.</p>
			<h2 id="_idParaDest-397"><a id="_idTextAnchor405"/>Node.js threat model</h2>
			<p>Node.js has a threat<a id="_idIndexMarker921"/> model that is a great resource to understand how Node.js assesses the review of the vulnerabilities reported by the community. You can find the threat model at <a href="https://github.com/nodejs/node/blob/main/SECURITY.md#the-nodejs-threat-model">https://github.com/nodejs/node/blob/main/SECURITY.md#the-nodejs-threat-model</a>, which we elaborated on in the Node.js Security Working Group (<a href="https://github.com/nodejs/security-wg">https://github.com/nodejs/security-wg</a>).</p>
			<p>One clear idea that we can extract from the threat model is that the Node.js project trusts many things by default, such as the dependencies that we use in our applications, our own code, or the infrastructure that we use to run our applications. This means that we are responsible for knowing what code is running in our applications (ours or from third parties) and ensuring that the infrastructure is secure.</p>
			<h2 id="_idParaDest-398"><a id="_idTextAnchor406"/>The Node.js official recommendations</h2>
			<p>Aside from the threat model, in the Node.js Security Working<a id="_idIndexMarker922"/> Group, we have created a reference document that intends to extend the current threat model and provide extensive guidelines on how to secure a Node.js application. It includes a list of best practices that we recommend following to improve the security of your Node.js applications. We used a list of CWEs as the starting point with detailed mitigation strategies and recommendations:</p>
			<ul>
				<li><strong class="bold">Denial of Service of HTTP </strong><strong class="bold">Server (CWE-400)</strong></li>
				<li><strong class="bold">DNS </strong><strong class="bold">Rebinding (CWE-346)</strong></li>
				<li><strong class="bold">HTTP Request </strong><strong class="bold">Smuggling (CWE-444)</strong></li>
				<li><strong class="bold">Information Exposure through Timing </strong><strong class="bold">Attacks (CWE-208)</strong></li>
				<li><strong class="bold">Malicious Third-Party </strong><strong class="bold">Modules (CWE-1357)</strong></li>
				<li><strong class="bold">Memory Access </strong><strong class="bold">Violation (CWE-284)</strong></li>
				<li><strong class="bold">Monkey </strong><strong class="bold">Patching (CWE-349)</strong></li>
				<li><strong class="bold">Prototype Pollution </strong><strong class="bold">Attacks (CWE-1321)</strong></li>
				<li><strong class="bold">Uncontrolled Search Path </strong><strong class="bold">Element (CWE-427)</strong></li>
			</ul>
			<p>You can find the list at <a href="https://nodejs.org/en/guides/security/">https://nodejs.org/en/guides/security/</a>.</p>
			<p>You can also find other popular<a id="_idIndexMarker923"/> community-built resources to get a better understanding of security in Node.js:</p>
			<ul>
				<li><em class="italic">Node.js Best Practices</em> by Yoni Goldberg (<a href="https://github.com/goldbergyoni/nodebestpractices">https://github.com/goldbergyoni/nodebestpractices</a>)</li>
				<li><em class="italic">Awesome Node.js Security resources</em> by Liran Tal (<a href="https://github.com/lirantal/awesome-nodejs-security">https://github.com/lirantal/awesome-nodejs-security</a>)</li>
			</ul>
			<p>Now that we have a better understanding of security in Node.js, let’s see how to improve the security of our web applications in more detail in the next section.</p>
			<h1 id="_idParaDest-399"><a id="_idTextAnchor407"/>Improving the security of our applications</h1>
			<p>The tools and techniques that<a id="_idIndexMarker924"/> we are going to explore in this section are evolving very quickly, so I suggest you keep an eye on the Node.js Security Working Group (<a href="https://github.com/nodejs/security-wg">https://github.com/nodejs/security-wg</a>) and the community to be aware of the latest trends. However, here is a solid checklist that you can use to improve the security<a id="_idIndexMarker925"/> of your applications:</p>
			<ul>
				<li><code>bcrypt</code> library (<a href="https://www.npmjs.com/package/bcrypt">https://www.npmjs.com/package/bcrypt</a>) to encrypt the user’s password in our project:<pre class="source-code">
userSchema.pre('save', async function (next) {
  const user = this
  if (user.isModified('password')) {
    const salt = await bcrypt.genSalt()
    user.password = await bcrypt.hash(
user.password, salt
    )
  }
  next()
})</pre></li>				<li><code>validator</code> (<a href="https://www.npmjs.com/package/validator">https://www.npmjs.com/package/validator</a>) or <code>joi</code> (<a href="https://www.npmjs.com/package/joi">https://www.npmjs.com/package/joi</a>) to validate the <a id="_idIndexMarker927"/>data. For example, you can validate an email easily as follows:<pre class="source-code">
import validator from 'validator';
validator.isEmail('foo@bar.com'); //=&gt; true
validator.isEmail('&lt;script&gt;alert("XSS")&lt;/script&gt;'); //=&gt; false</pre></li>				<li><code>helmet</code> (<a href="https://helmetjs.github.io/">https://helmetjs.github.io/</a>) to increase the security of our applications. You can find a great guide on how to implement <code>helmet</code> at <a href="https://blog.ulisesgascon.com/how-to-use-helmet-in-express">https://blog.ulisesgascon.com/how-to-use-helmet-in-express</a>.</li>
				<li><code>pino</code> (<a href="https://getpino.io/">https://getpino.io/</a>) to keep logs securely and we can use this information to audit the application and abuse from third parties. You can find a great guide on how to implement <code>pino</code> with Express in the official documentation (<a href="https://getpino.io/#/docs/web?id=pino-with-express">https://getpino.io/#/docs/web?id=pino-with-express</a>).</li>
				<li><strong class="bold">Monitor</strong>: We need to understand<a id="_idIndexMarker929"/> what is going on with the application once it is deployed and exposed to the internet. Monitoring the application will help us detect downtimes, performance issues, and much more. We can include alerts to understand whether we are having issues<a id="_idIndexMarker930"/> in real time. We<a id="_idIndexMarker931"/> can use New Relic (<a href="https://newrelic.com/">https://newrelic.com/</a>), Datadog (<a href="https://www.datadoghq.com/">https://www.datadoghq.com/</a>), or Sentry (<a href="https://sentry.io/welcome/">https://sentry.io/welcome/</a>). You can find a great<a id="_idIndexMarker932"/> guide on how to implement Sentry with Express in the official<a id="_idIndexMarker933"/> documentation (<a href="https://docs.sentry.io/platforms/node/guides/express/">https://docs.sentry.io/platforms/node/guides/express/</a>).</li>
				<li><strong class="bold">Track your dependencies</strong>: You need to know your dependencies and keep them up to date. You can<a id="_idIndexMarker934"/> use Snyk (<a href="https://snyk.io/">https://snyk.io/</a>) or Socket (<a href="https://socket.dev/">https://socket.dev/</a>) to monitor the <a id="_idIndexMarker935"/>dependencies, be notified when a new CVE is discovered, and even automate the update of the dependencies.</li>
				<li><strong class="bold">Backup and recovery</strong>: You need to have a backup for your critical information and to have a recovery plan in case of a disaster. Even if you don’t suffer from a security incident, you could suffer from a natural disaster such as a fire or a flood in the data center where your information is stored. If you are depending on a cloud provider, you need to understand how multi-region replication works and how to recover the data in the case of a disaster.</li>
				<li><strong class="bold">Reduce the attack surface</strong>: Sometimes, we code much more than is required by the business logic inside the core of our business. Each line of code that we write is a potential risk, so we can reduce the attack surface by using APIs in the areas that are security-critical. For<a id="_idIndexMarker936"/> example, we can use Auth0 (<a href="https://auth0.com/">https://auth0.com/</a>) to handle the authentication and authorization for us or Stripe (<a href="https://stripe.com/">https://stripe.com/</a>) to handle the<a id="_idIndexMarker937"/> payments. This will reduce the amount of code that we need to write and maintain, and sensitive information such as credit card numbers will be handled by a third party that is an expert in the area. Of course, we need to trust the third party and understand the cost of the service.</li>
				<li><strong class="bold">Enforce Two-factor authentication (2FA) in your services</strong>: We need to enforce 2FA in all the services<a id="_idIndexMarker938"/> that we use to run our company activities (Slack, GSuite, and so on) and the infrastructure that we use to run our applications (Github, AWS, Azure, and so on). This will reduce the risk of a social engineering attack. Also, it would be great if we could implement 2FA in our own applications to mitigate the risk of a stolen password from a user.</li>
				<li><strong class="bold">Review the secrets</strong>: Leaking secrets is a very common mistake that we can make. We can use tools<a id="_idIndexMarker939"/> such as GitGuardian (<a href="https://www.gitguardian.com/">https://www.gitguardian.com/</a>) to scan our repositories and be notified if we have leaked secrets.</li>
				<li><strong class="bold">Implement good practices</strong>: There are many good practices that we can follow as a team to improve the security of our applications. For example, use a control version, use pull requests to review the changes, use a CI/CD tool to automate the review of the code, and so on.</li>
				<li><strong class="bold">Automation</strong>: Once you have a CI/CD tool in place, you can automate many tasks, even those related to infrastructure. For example, you<a id="_idIndexMarker940"/> can use Terraform (<a href="https://www.terraform.io/">https://www.terraform.io/</a>) to automate the creation of the infrastructure and to reduce human errors.</li>
				<li><strong class="bold">Keep learning</strong>: Security is no different from any other technical topic; it is evolving very fast and we need to keep learning.</li>
				<li><strong class="bold">Use a secure protocol</strong>: We need to use secure<a id="_idIndexMarker941"/> protocols such as HTTPS to protect the communication between the client and the server.</li>
			</ul>
			<h2 id="_idParaDest-400"><a id="_idTextAnchor408"/>Put it into practice</h2>
			<p>Now that we have a checklist<a id="_idIndexMarker942"/> and a better understanding of security in Node.js, I suggest you go through the application that we built in the previous chapters and review the application to find possible improvements to make it more secure.</p>
			<p>Here are some ideas to get started:</p>
			<ul>
				<li>Review the dependencies and check whether there are any known vulnerabilities</li>
				<li>Use a linter to enforce the code style</li>
				<li>Use a static code analysis tool to find possible bugs, such as SonarQube or CodeQL</li>
				<li>Add key libraries to improve security, such as <code>helmet</code> or <code>validator</code></li>
				<li>Add a control version system and use a CI/CD tool to automate the review of the code, such as Github Actions</li>
				<li>Add a control version<a id="_idIndexMarker943"/> system to review the changes in pull requests</li>
			</ul>
			<p>In the next section, we will explore how we can take advantage of our security knowledge to become an ethical hacker.</p>
			<h1 id="_idParaDest-401"><a id="_idTextAnchor409"/>Becoming an ethical hacker</h1>
			<p>When we think about <a id="_idIndexMarker944"/>hackers, we tend to think about cyber criminals who are trying to steal our data or take control of our systems. In reality, it is not that simple. Let’s read the definition of a hacker from the paper <em class="italic">How Hackers Think: A Study of Cybersecurity Experts and Their Mental </em><em class="italic">Models</em> (<a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2326634">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2326634</a>):</p>
			<p class="author-quote">“Regardless of what type of hacker a person is, identifying system weaknesses requires logical reasoning and the ability to systematically think through possible actions, alternatives, and potential conclusions. This combination of reasoning and systematic thinking implies the use of mental models. Hacking is a cognitive activity that requires exceptional technical and reasoning abilities.”</p>
			<p>So, basically, we are talking about a person with high technical skills who is doing things by thinking out of the box. The problem is not the activity itself but the intention behind the activity.</p>
			<p>Today, we define an ethical hacker as a hacker who does things with good intentions. For example, when you are doing a penetration test on your own application to find possible vulnerabilities, you are doing ethical hacking. Sometimes, you end up discovering vulnerabilities in other<a id="_idIndexMarker945"/> applications/libraries/services that you don’t own. In those<a id="_idIndexMarker946"/> cases, we can face two<a id="_idIndexMarker947"/> different scenarios: doing a <strong class="bold">coordinated vulnerability disclosure</strong> (previously known as a <strong class="bold">responsible disclosure</strong>) or trying a <strong class="bold">bug </strong><strong class="bold">bounty program</strong>.</p>
			<h2 id="_idParaDest-402"><a id="_idTextAnchor410"/>Coordinated vulnerability disclosure (CVD)</h2>
			<p>When you discover a vulnerability<a id="_idIndexMarker948"/> in a third-party application/library/service, you<a id="_idIndexMarker949"/> can contact the owner of the application/library/service and explain the vulnerability and how to mitigate it. While the process seems simple, it is not always easy.</p>
			<p>First of all, an unknown vulnerability can affect many users, companies, and services. So, you need to be very careful about how you communicate the vulnerability and to whom. Also, this will require a validation process to ensure that the vulnerability is real and that it is not a false positive. Then, it is expected that a patch will be developed and made available to the affected services before the public disclosure is done.</p>
			<p>To make the process easier, many companies and open source projects have a security policy that explains how to report a vulnerability and what to expect from the process. For example, you can find the<a id="_idIndexMarker950"/> Node.js security policy at <a href="https://nodejs.org/en/security/">https://nodejs.org/en/security/</a>:</p>
			<p class="author-quote">“Normally your report will be acknowledged within 5 days, and you’ll receive a more detailed response to your report within 10 days indicating the next steps in handling your submission. These timelines may extend when our triage volunteers are away on holiday, particularly at the end of the year.</p>
			<p class="author-quote">After the initial reply to your report, the security team will endeavor to keep you informed of the progress being made towards a fix and full announcement, and may ask for additional information or guidance surrounding the reported issue.”</p>
			<p>Other companies, such as Google, have<a id="_idIndexMarker951"/> a dedicated website to report vulnerabilities in their products (<a href="https://www.google.com/about/appsecurity/">https://www.google.com/about/appsecurity/</a>).</p>
			<h2 id="_idParaDest-403"><a id="_idTextAnchor411"/>Bounty programs</h2>
			<p>Some companies and open<a id="_idIndexMarker952"/> source projects have a bounty program<a id="_idIndexMarker953"/> that will reward you for finding vulnerabilities in their applications/libraries/services. Actually, the scenario is very similar to CVD but, in this case, you have clear rules regarding engagement and boundaries.</p>
			<p>Let’s see the Node.js bounty<a id="_idIndexMarker954"/> program at <a href="https://hackerone.com/nodejs">https://hackerone.com/nodejs</a> to get a better understanding of the process. We also have<a id="_idIndexMarker955"/> a hacktivity page (<a href="https://hackerone.com/nodejs/hacktivity">https://hackerone.com/nodejs/hacktivity</a>) where we can see the reports that have been submitted and the status of the reports with plenty of details, including the rewards.</p>
			<div><div><img src="img/B21678_15_ForCEing_FS_4.jpg" alt="Figure 15.4 – Node.js bug bounty program"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.4 – Node.js bug bounty program</p>
			<p>As you can see in the figure, there is a list of disclosure information that leads, in many cases, to security patches. Feel free to explore them and see how the communication was made and how the process <a id="_idIndexMarker956"/>worked in each case. You can learn a lot from these disclosed<a id="_idIndexMarker957"/> reports.</p>
			<h2 id="_idParaDest-404"><a id="_idTextAnchor412"/>Getting the skills</h2>
			<p>Building software is different from breaking<a id="_idIndexMarker958"/> software. The are many skills that you need to learn and some tools to get familiar with. One great overview <a id="_idIndexMarker959"/>of the skills that you need to learn is <a href="https://roadmap.sh/">https://roadmap.sh/</a>, which has a section dedicated<a id="_idIndexMarker960"/> to cybersecurity (<a href="https://roadmap.sh/cyber-security">https://roadmap.sh/cyber-security</a>).</p>
			<p>In order to get more practical skills, you can use<a id="_idIndexMarker961"/> the <em class="italic">Hack the Box</em> platform (<a href="https://www.hackthebox.eu/">https://www.hackthebox.eu/</a>), which will allow you to practice your skills in a safe environment. The challenges in <em class="italic">Hack the Box</em> are used as a learning tool by many hackers and security professionals in the community, so you can find a lot of write-ups on the internet that will help you to solve the challenges when you get stuck.</p>
			<h1 id="_idParaDest-405"><a id="_idTextAnchor413"/>Summary</h1>
			<p>In this chapter, we explored the importance of security in modern web applications and the impact that a security incident can have on the business. Then, we learned how to get started with security in our day-to-day work by using OWASP, CWE, CVE, the Node.js threat model, and the official Node.js best practices.</p>
			<p>Additionally, we learned how we can raise the security of our applications by using a simple checklist and how to apply it in our application.</p>
			<p>Finally, we learned how to take advantage of our security knowledge to become an ethical hacker.</p>
			<p>In the next chapter, we are going to learn how to deploy our application to the internet and local devices in a different way.</p>
			<h1 id="_idParaDest-406"><a id="_idTextAnchor414"/>Further reading</h1>
			<ul>
				<li><em class="italic">CVE-2020-19909 is everything that is wrong with </em><em class="italic">CVEs</em>: <a href="https://daniel.haxx.se/blog/2023/08/26/cve-2020-19909-is-everything-that-is-wrong-with-cves/">https://daniel.haxx.se/blog/2023/08/26/cve-2020-19909-is-everything-that-is-wrong-with-cves/</a></li>
				<li><em class="italic">Auditing package dependencies for security </em><em class="italic">vulnerabilities</em>: <a href="https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities">https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities</a></li>
				<li><em class="italic">OWASP NPM Security best </em><em class="italic">practices</em>: <a href="https://cheatsheetseries.owasp.org/cheatsheets/NPM_Security_Cheat_Sheet.html#npm-security-best-practices">https://cheatsheetseries.owasp.org/cheatsheets/NPM_Security_Cheat_Sheet.html#npm-security-best-practices</a></li>
				<li><em class="italic">DEFCON – The Full </em><em class="italic">Documentary</em>: <a href="https://www.youtube.com/watch?v=3ctQOmjQyYg">https://www.youtube.com/watch?v=3ctQOmjQyYg</a></li>
				<li><em class="italic">State of Open Source Security </em><em class="italic">2023</em>: <a href="https://snyk.io/reports/open-source-security/">https://snyk.io/reports/open-source-security/</a></li>
				<li><em class="italic">Threats and </em><em class="italic">Mitigations</em>: <a href="https://docs.npmjs.com/threats-and-mitigations#by-typosquatting--dependency-confusion">https://docs.npmjs.com/threats-and-mitigations#by-typosquatting--dependency-confusion</a></li>
			</ul>
		</div>
	

		<div><h1 id="_idParaDest-407" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor415"/>Part 5: Mastering Node.js Deployment and Portability</h1>
			<p>
In <em class="italic">Part 5</em>, we will deploy our application to the public internet. We will learn how to decide the best approach based on our requirements, then we will use virtual machines in DigitalOcean to deploy the application using PM2, and we will also learn how to dockerize our application for better portability.</p>
			<p>We will use GitHub to store our application code, and we will learn how to create a continuous deployment pipeline for our projects.</p>
			<p>Our last step in the journey will be to use Cloudflare to manage our domain and the SSL certificates and we will explore the Twelve-Factor App principles.</p>
			<p>This part has the following chapters:</p>
			<ul>
				<li><a href="B21678_16.xhtml#_idTextAnchor416"><em class="italic">Chapter 16</em></a>, <em class="italic">Deploying Node.js Applications</em></li>
				<li><a href="B21678_17.xhtml#_idTextAnchor436"><em class="italic">Chapter 17</em></a>, <em class="italic">Dockerizing a Node.js Application</em></li>
			</ul>
		</div>
		<div><div></div>
		</div>
	</body></html>