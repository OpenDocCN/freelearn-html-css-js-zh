<html><head></head><body>
  <div id="_idContainer038">
   <h1 class="chapter-number" id="_idParaDest-236">
    <a id="_idTextAnchor243">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     8
    </span>
   </h1>
   <h1 id="_idParaDest-237">
    <a id="_idTextAnchor244">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Testing with Node.js
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Testing enables you to identify bugs in your code quickly and efficiently.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Test cases should be written to verify that each piece of code yields the expected output or results.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     The added benefit is that these tests can act as a form of documentation for the expected behaviors of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      your applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     Unit testing is a type of testing where individual units of code are tested.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     Small unit tests provide a granular specification for your program to test against.
    </span>
    <span class="koboSpan" id="kobo.5.3">
     Ensuring your code base is covered by unit tests aids the development, debugging, and refactoring process by providing a baseline measure of behavior and quality.
    </span>
    <span class="koboSpan" id="kobo.5.4">
     Having a comprehensive test suite can lead to identifying bugs sooner, which can save time and money since the earlier a bug is found, the cheaper it is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      to fix.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     This chapter will start by introducing some key techniques with the test runner built into recent versions of Node.js.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     We’ll also explore some popular testing frameworks.
    </span>
    <span class="koboSpan" id="kobo.7.3">
     Testing frameworks provide components and utilities such as test runners for running automated tests.
    </span>
    <span class="koboSpan" id="kobo.7.4">
     The later recipes in this chapter will introduce other testing concepts – including
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      stubbing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     ,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.10.1">
      user interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.11.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.12.1">
      UI
     </span>
    </strong>
    <span class="koboSpan" id="kobo.13.1">
     ) testing, and how to configure
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.14.1">
      continuous integration
     </span>
    </strong>
    <span class="koboSpan" id="kobo.15.1">
     (
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.16.1">
       CI
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.17.1">
      ) testing.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.18.1">
     This chapter will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.19.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.20.1">
      Testing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.21.1">
       with
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.22.1">
        node:test
       </span>
      </strong>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.23.1">
      Testing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.24.1">
       with Jest
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.25.1">
      Stubbing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.26.1">
       HTTP requests
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.27.1">
       Using Puppeteer
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.28.1">
      Configuring
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.29.1">
       CI tests
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-238">
    <a id="_idTextAnchor245">
    </a>
    <span class="koboSpan" id="kobo.30.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.31.1">
     This chapter assumes that you have Node.js installed, preferably the latest version of Node.js 22.
    </span>
    <span class="koboSpan" id="kobo.31.2">
     You’ll also need access to an editor and browser of your choice.
    </span>
    <span class="koboSpan" id="kobo.31.3">
     Throughout the recipes, we’ll be installing modules from the public
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.32.1">
       npm
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.33.1">
      registry.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     The code for the recipes is available in the book’s GitHub repository (
    </span>
    <a href="https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition">
     <span class="koboSpan" id="kobo.35.1">
      https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.36.1">
     ) in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.37.1">
       Chapter08
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.38.1">
      directory.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-239">
    <a id="_idTextAnchor246">
    </a>
    <span class="koboSpan" id="kobo.39.1">
     Testing with node:test
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.40.1">
     Node.js introduced a built-in test runner
    </span>
    <a id="_idIndexMarker609">
    </a>
    <span class="koboSpan" id="kobo.41.1">
     in version 18 as an experimental feature, subsequently making it stable in version 20.
    </span>
    <span class="koboSpan" id="kobo.41.2">
     This addition marked a significant shift in the Node.js runtime development philosophy away from the “small core” to adding more utilities into the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.42.1">
      runtime itself.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.43.1">
     The decision to include a built-in test runner was influenced by a broader industry trend toward including more built-in tooling in programming languages and runtimes.
    </span>
    <span class="koboSpan" id="kobo.43.2">
     This shift is partly in response to concerns about security, such as the risks associated with dependency vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.43.3">
     By providing a native test solution, Node.js aims to make testing a first-class citizen within its environment, reducing the potential attack surface provided by third-party
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      test runners.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.45.1">
     The built-in test runner in Node.js does not have as extensive an API as is provided by the many common and popular test frameworks, such as Jest.
    </span>
    <span class="koboSpan" id="kobo.45.2">
     It was designed to be a minimal and lightweight, yet functional, testing utility without the overhead of additional features
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.46.1">
      and configurations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.47.1">
     This tutorial will guide you through the basics of using the Node.js built-in test runner, demonstrating how it can be leveraged to perform effective testing in your projects without the need for a third-party
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.48.1">
      test framework.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-240">
    <a id="_idTextAnchor247">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.50.1">
     In this recipe, we’ll create and use a basic calculator application to demonstrate the fundamentals of unit testing with the built-in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.51.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.52.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.52.2">
     Throughout
    </span>
    <a id="_idIndexMarker610">
    </a>
    <span class="koboSpan" id="kobo.53.1">
     the recipe, we’ll be using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.54.1">
      ECMAScript Module
     </span>
    </strong>
    <span class="koboSpan" id="kobo.55.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.56.1">
      ESM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.57.1">
     ) syntax covered in
    </span>
    <a href="B19212_05.xhtml#_idTextAnchor139">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.58.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.59.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.60.1">
      Let’s first create a directory to work in and initialize our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.61.1">
       project directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.62.1">$ mkdir testing-with-node</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.63.1">$ cd testing-with-node</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.64.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.65.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.66.1">
        calculator.mjs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.67.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.68.1">$ touch calculator.mjs</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.69.1">
      Now, we can add
     </span>
     <a id="_idIndexMarker611">
     </a>
     <span class="koboSpan" id="kobo.70.1">
      the following to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.71.1">
       calculator.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.72.1">
      to create our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.73.1">
       calculator program:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.74.1">
export const add = (number1, number2) =&gt; {
    return number1 + number2;
};
export const subtract = (number1, number2) =&gt; {
    return number1 - number2;
};
export const multiply = (number1, number2) =&gt; {
    return number1 * number2;
};
export const divide = (number1, number2) =&gt; {
    return number1 / number2;
};</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.75.1">
     Now that we have our project directory set up and an application ready to test, we can move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.76.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-241">
    <a id="_idTextAnchor248">
    </a>
    <span class="koboSpan" id="kobo.77.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.78.1">
     In this recipe, we will be adding
    </span>
    <a id="_idIndexMarker612">
    </a>
    <span class="koboSpan" id="kobo.79.1">
     unit tests using the built-in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.80.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.81.1">
     module for the small calculator application we created in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.82.1">
      Getting
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.83.1">
       ready
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.84.1">
      section.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.85.1">
      The first step is to ensure we’re using a version of Node.js where the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.86.1">
       node --test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.87.1">
      command is available.
     </span>
     <span class="koboSpan" id="kobo.87.2">
      Enter the following command in your terminal and expect to see the test
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.88.1">
       runner execute:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.89.1">$ node --test</span></strong><span class="koboSpan" id="kobo.90.1">
ℹ tests 0
ℹ suites 0
ℹ pass 0
ℹ fail 0
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 3.212584</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.91.1">
      Now, we should create a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.92.1">
       calculator.test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.93.1">
      , which will contain
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.94.1">
       our tests:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.95.1">$ touch calculator.test.mjs</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.96.1">
      In
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.97.1">
       calculator.test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.98.1">
      , we first need to import the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.99.1">
        node:test
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.100.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.101.1">
import test from 'node:test';
import assert from 'node:assert';</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.102.1">
      Next, we can import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.103.1">
       add()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.104.1">
      function from our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.105.1">
       calculator.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.106.1">
      program.
     </span>
     <span class="koboSpan" id="kobo.106.2">
      We’ll only import and test the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.107.1">
       add()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.108.1">
      function as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.109.1">
       an example:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.110.1">
import { add } from './calculator.mjs';</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.111.1">
      It can be useful to organize our tests with subtests.
     </span>
     <span class="koboSpan" id="kobo.111.2">
      To demonstrate this, we’ll create a test parent for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.112.1">
       add()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.113.1">
      function, which we’ll later add our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.114.1">
       subtests to:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.115.1">
test('add', async (t) =&gt; {
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.116.1">
      Now, we can write our first test case
     </span>
     <a id="_idIndexMarker613">
     </a>
     <span class="koboSpan" id="kobo.117.1">
      as a subtest.
     </span>
     <span class="koboSpan" id="kobo.117.2">
      Our first test will pass integer test values to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.118.1">
       add()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      function and confirm that we get the expected results.
     </span>
     <span class="koboSpan" id="kobo.119.2">
      Add
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.120.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.121.1">
test('add', async (t) =&gt; {
</span><strong class="bold"><span class="koboSpan" id="kobo.122.1">  await t.test('add integers', () =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.123.1">    assert.equal(add(1, 2), 3);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.124.1">    assert.equal(add(2, 3), 5);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.125.1">    assert.equal(add(3, 4), 7);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.126.1">  });</span></strong><span class="koboSpan" id="kobo.127.1">
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.128.1">
      Run the tests with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.129.1">
       node --test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.130.1">
      command in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.131.1">
       your terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.132.1">$ node --test</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.133.1">
      Next, we can add a second subtest.
     </span>
     <span class="koboSpan" id="kobo.133.2">
      This time, we’ll pass the numbers as strings rather than integers.
     </span>
     <span class="koboSpan" id="kobo.133.3">
      This test is expected to fail as our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.134.1">
       calculator.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.135.1">
      program does not contain logic to transform string input into integers.
     </span>
     <span class="koboSpan" id="kobo.135.2">
      Add the following beneath the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       first subtest:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.137.1">
await t.test('add strings', () =&gt; {
  assert.equal(add('1', '2'), 3);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.138.1">
      Now, we can run the tests by entering the following command in our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.139.1">
       terminal window:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.140.1">$ node --test</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Expect to see the following
     </span>
     <a id="_idIndexMarker614">
     </a>
     <span class="koboSpan" id="kobo.142.1">
      output indicating that the first test passed and the second
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.143.1">
       test failed:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.144.1">
▶ add
  ✔ add integers (0.442953ms)
  ✖ add strings (1.909008ms)
    AssertionError [ERR_ASSERTION]: '12' == 3
        at TestContext.&lt;anonymous&gt; (file:///Users/beth/Node.js-Cookbook/testing-with-node/calculator.test.mjs:14:12)
        at Test.runInAsyncScope (node:async_hooks:206:9)
        at Test.run (node:internal/test_runner/test:639:25)
        at Test.start (node:internal/test_runner/test:550:17)
...</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.145.1">
     We’ve learned how we can write unit tests for our application using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.146.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.147.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.147.2">
     We’ve executed
    </span>
    <a id="_idIndexMarker615">
    </a>
    <span class="koboSpan" id="kobo.148.1">
     these tests and produced a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.149.1">
      Test Anything Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.150.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.151.1">
      TAP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.152.1">
     ) summary of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.153.1">
      test results.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-242">
    <a id="_idTextAnchor249">
    </a>
    <span class="koboSpan" id="kobo.154.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.155.1">
     In the provided example utilizing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.156.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.157.1">
     built-in module for Node.js, we start by importing the necessary modules using the ESM syntax.
    </span>
    <span class="koboSpan" id="kobo.157.2">
     This includes
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.158.1">
      test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.159.1">
     from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.160.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.161.1">
     for testing framework functionalities,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.162.1">
      assert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.163.1">
     from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.164.1">
      node:assert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.165.1">
     for assertions, and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.166.1">
      add()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.167.1">
     function from a local module,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.168.1">
      calculator.mjs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.169.1">
     , which is the function
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.170.1">
      under test.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.171.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.172.1">
     It’s crucial to import the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.173.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.174.1">
     module by using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.175.1">
      node:
     </span>
    </strong>
    <span class="koboSpan" id="kobo.176.1">
     scheme prefix, like this:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.177.1">
      const test = require('node:test');
     </span>
    </strong>
    <span class="koboSpan" id="kobo.178.1">
     .
    </span>
    <span class="koboSpan" id="kobo.178.2">
     This module is one of the first to only be exposed via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.179.1">
      node:
     </span>
    </strong>
    <span class="koboSpan" id="kobo.180.1">
     prefix.
    </span>
    <span class="koboSpan" id="kobo.180.2">
     Attempting to import it without the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.181.1">
      node:
     </span>
    </strong>
    <span class="koboSpan" id="kobo.182.1">
     prefix, as in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      const test = require('test');
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     , will result in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.185.1">
      an error.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.186.1">
     The tests are structured
    </span>
    <a id="_idIndexMarker616">
    </a>
    <span class="koboSpan" id="kobo.187.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.188.1">
      test()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.189.1">
     function, where each test case is encapsulated within an asynchronous function.
    </span>
    <span class="koboSpan" id="kobo.189.2">
     Within each test, subtests are defined using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.190.1">
      await t.test(...)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.191.1">
     , which helps organize the tests hierarchically and manage multiple assertions or setup processes cleanly within one test block.
    </span>
    <span class="koboSpan" id="kobo.191.2">
     For asserting conditions,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.192.1">
      assert.strictEqual()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.193.1">
     is employed to compare the expected and actual outcomes, ensuring that both type and value
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.194.1">
      are equal.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.195.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.196.1">
      node:assert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.197.1">
     module in Node.js provides a set of assertion functions for verifying invariants, primarily used for writing tests.
    </span>
    <span class="koboSpan" id="kobo.197.2">
     Key assertions include
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.198.1">
      assert.strictEqual()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.199.1">
     , which checks for strict equality between the expected and actual values, and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.200.1">
      assert.deepStrictEqual()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.201.1">
     , which performs a deep equality comparison of objects and arrays.
    </span>
    <span class="koboSpan" id="kobo.201.2">
     The module also offers
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.202.1">
      assert.ok()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.203.1">
     to test if a value is
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.204.1">
      truthy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.205.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.206.1">
      assert.rejects()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.207.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.208.1">
      assert.doesNotReject()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.209.1">
     for handling promises that should or should not reject.
    </span>
    <span class="koboSpan" id="kobo.209.2">
     This suite of assertions allows developers to enforce expected behaviors and values in code.
    </span>
    <span class="koboSpan" id="kobo.209.3">
     A full list of available assertions is detailed
    </span>
    <a id="_idIndexMarker617">
    </a>
    <span class="koboSpan" id="kobo.210.1">
     in the Node.js assert module
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.211.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest/api/assert.html#assert">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.212.1">
       https://nodejs.org/docs/latest/api/assert.html#assert
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.213.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.214.1">
     To run these tests, the script is executed directly with Node.js by running
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.215.1">
      node --test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     in the command line.
    </span>
    <span class="koboSpan" id="kobo.216.2">
     This approach directly outputs the test results to the console, indicating which tests have passed or failed.
    </span>
    <span class="koboSpan" id="kobo.216.3">
     This method of using Node.js’s built-in testing tools simplifies the testing process by eliminating the need for external libraries – reducing overhead and minimizing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.217.1">
      third-party dependencies.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.218.1">
     In the recipe, our test results were output using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.219.1">
      spec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     format.
    </span>
    <span class="koboSpan" id="kobo.220.2">
     When
    </span>
    <a id="_idIndexMarker618">
    </a>
    <span class="koboSpan" id="kobo.221.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.222.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.223.1">
     module with a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.224.1">
      terminal interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.225.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.226.1">
      TTY
     </span>
    </strong>
    <span class="koboSpan" id="kobo.227.1">
     ), the default output reporter is set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.228.1">
      spec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.229.1">
     .
    </span>
    <span class="koboSpan" id="kobo.229.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.230.1">
      spec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.231.1">
     reporter formats test results in a human-readable manner.
    </span>
    <span class="koboSpan" id="kobo.231.2">
     If the standard output is not a TTY, the module defaults to using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.232.1">
      tap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.233.1">
     reporter, which outputs the test results in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.234.1">
      TAP format.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.235.1">
     It’s possible to specify alternate test reporter output using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.236.1">
      --test-reporter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.237.1">
     command-line flag.
    </span>
    <span class="koboSpan" id="kobo.237.2">
     Details of the available reporters
    </span>
    <a id="_idIndexMarker619">
    </a>
    <span class="koboSpan" id="kobo.238.1">
     can be found in the Node.js
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.239.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest-v22.x/api/test.html#test-reporters">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.240.1">
       https://nodejs.org/docs/latest-v22.x/api/test.html#test-reporters
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.241.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-243">
    <a id="_idTextAnchor250">
    </a>
    <span class="koboSpan" id="kobo.242.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.243.1">
     To further enhance your understanding of the core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.244.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.245.1">
     module, let’s explore the default file patterns the test runner uses to locate and execute tests, along with additional features that streamline the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.246.1">
      testing process.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.247.1">
     Understanding Node.js default test file patterns
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.248.1">
     The Node.js test runner
    </span>
    <a id="_idIndexMarker620">
    </a>
    <span class="koboSpan" id="kobo.249.1">
     automatically finds and runs test files based on their names by looking for files that match specific patterns – essentially, indicators that a file is a test.
    </span>
    <span class="koboSpan" id="kobo.249.2">
     The patterns use wildcards (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.250.1">
      *
     </span>
    </strong>
    <span class="koboSpan" id="kobo.251.1">
     ) and optional groups (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.252.1">
      ?(...)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.253.1">
     ) to include various filenames and extensions.
    </span>
    <span class="koboSpan" id="kobo.253.2">
     The double asterisk (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.254.1">
      **
     </span>
    </strong>
    <span class="koboSpan" id="kobo.255.1">
     ) means that Node.js searches all directories and subdirectories, so no matter where your test files are, they’ll be found as long as they match
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.256.1">
      the patterns.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.257.1">
     Here are common patterns the Node.js test runner searches for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.258.1">
      by default:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.259.1">
       **/*.test.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.260.1">
      : This finds files ending with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.261.1">
       .test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.262.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.263.1">
       .test.cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.264.1">
      , or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.265.1">
       .test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.266.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.267.1">
       any directory
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.268.1">
       **/*-test.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.269.1">
      : Like the first pattern, but for files ending with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.270.1">
       -test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.271.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.272.1">
       -test.cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.273.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.274.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.275.1">
        -test.mjs
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.276.1">
       **/*_test.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.277.1">
      catches files ending with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.278.1">
       _test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.279.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.280.1">
       _test.cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.281.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.282.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.283.1">
        _test.mjs
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.284.1">
       **/test-*.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.285.1">
      looks for files starting with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.286.1">
       test-
      </span>
     </strong>
     <span class="koboSpan" id="kobo.287.1">
      and ending with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.288.1">
       .js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.289.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.290.1">
       .cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.291.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.292.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.293.1">
        .mjs
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.294.1">
       **/test.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.295.1">
      matches files named exactly
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.296.1">
       test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.297.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.298.1">
       test.cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.299.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.300.1">
       or
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.301.1">
        test.mjs
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.302.1">
       **/test/**/*.?(c|m)js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.303.1">
      digs into any
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.304.1">
       test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.305.1">
      directory and finds files with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.306.1">
       .js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.307.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.308.1">
       .cjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.309.1">
      , or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.310.1">
       .mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.311.1">
      extensions in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.312.1">
       any subdirectory
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.313.1">
     To make sure Node.js can find and run your tests without extra configuration, it is advisable to name your test files
    </span>
    <a id="_idIndexMarker621">
    </a>
    <span class="koboSpan" id="kobo.314.1">
     following these patterns.
    </span>
    <span class="koboSpan" id="kobo.314.2">
     It keeps your project organized and aligns with common
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.315.1">
      Node.js practices.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.316.1">
     Filtering tests
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.317.1">
     With the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.318.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.319.1">
     module, there
    </span>
    <a id="_idIndexMarker622">
    </a>
    <span class="koboSpan" id="kobo.320.1">
     are several options for filtering tests to manage which ones are executed during a test run.
    </span>
    <span class="koboSpan" id="kobo.320.2">
     This flexibility is useful for focusing on specific tests during development
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.321.1">
      or debugging:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.322.1">
       Skipping tests
      </span>
     </strong>
     <span class="koboSpan" id="kobo.323.1">
      : Tests can be skipped
     </span>
     <a id="_idIndexMarker623">
     </a>
     <span class="koboSpan" id="kobo.324.1">
      using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.325.1">
       skip
      </span>
     </strong>
     <span class="koboSpan" id="kobo.326.1">
      option or the test contexts
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.327.1">
       skip()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.328.1">
      method.
     </span>
     <span class="koboSpan" id="kobo.328.2">
      This is useful for temporarily disabling a test without removing it from the code base.
     </span>
     <span class="koboSpan" id="kobo.328.3">
      For example, marking a test with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.329.1">
       { skip: true }
      </span>
     </strong>
     <span class="koboSpan" id="kobo.330.1">
      or using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.331.1">
       t.skip()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.332.1">
      within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.333.1">
       test()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.334.1">
      function will prevent
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.335.1">
       its execution:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.336.1">
test('add strings', { skip : true }, () =&gt; {
  assert.equal(add('1', '2'), 3);
});</span></pre>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.337.1">
       Marking tests as todo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.338.1">
      : When a test is not yet implemented
     </span>
     <a id="_idIndexMarker624">
     </a>
     <span class="koboSpan" id="kobo.339.1">
      or if it’s known to be flaky, it can be marked as
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.340.1">
       todo
      </span>
     </strong>
     <span class="koboSpan" id="kobo.341.1">
      .
     </span>
     <span class="koboSpan" id="kobo.341.2">
      These tests will still run, but their failures won’t count against the test suite’s success.
     </span>
     <span class="koboSpan" id="kobo.341.3">
      Using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.342.1">
       { todo: true }
      </span>
     </strong>
     <span class="koboSpan" id="kobo.343.1">
      option or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.344.1">
       t.todo()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.345.1">
      can annotate these
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.346.1">
       tests effectively.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.347.1">
       Focusing on specific tests
      </span>
     </strong>
     <span class="koboSpan" id="kobo.348.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.349.1">
       { only: true }
      </span>
     </strong>
     <span class="koboSpan" id="kobo.350.1">
      option is used
     </span>
     <a id="_idIndexMarker625">
     </a>
     <span class="koboSpan" id="kobo.351.1">
      to focus on running specific tests, skipping all others not marked with this option.
     </span>
     <span class="koboSpan" id="kobo.351.2">
      This is particularly useful when needing to isolate a test for scrutiny without running the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.352.1">
       entire suite.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.353.1">
       Filtering by test name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.354.1">
      : Using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.355.1">
       --test-name-pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.356.1">
      command-line option, tests can
     </span>
     <a id="_idIndexMarker626">
     </a>
     <span class="koboSpan" id="kobo.357.1">
      be filtered by their names.
     </span>
     <span class="koboSpan" id="kobo.357.2">
      This is useful when you want to run a subset of tests that match a specific naming pattern or convention.
     </span>
     <span class="koboSpan" id="kobo.357.3">
      Patterns are treated as regular expressions.
     </span>
     <span class="koboSpan" id="kobo.357.4">
      For example, running the test suite with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.358.1">
       --test-name-pattern="add"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.359.1">
      would only execute tests with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.360.1">
       "add"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.361.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.362.1">
       their name.
      </span>
     </span>
    </li>
   </ul>
   <h3>
    <span class="koboSpan" id="kobo.363.1">
     Collecting code coverage
    </span>
   </h3>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.364.1">
      Code coverage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.365.1">
     is a key metric used to evaluate
    </span>
    <a id="_idIndexMarker627">
    </a>
    <span class="koboSpan" id="kobo.366.1">
     the extent to which
    </span>
    <a id="_idIndexMarker628">
    </a>
    <span class="koboSpan" id="kobo.367.1">
     source code is executed during testing, helping developers identify untested parts of their code base.
    </span>
    <span class="koboSpan" id="kobo.367.2">
     In Node.js, enabling code coverage is straightforward, but it’s important to note that this feature is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.368.1">
      currently experimental.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.369.1">
     You can enable it by launching
    </span>
    <a id="_idIndexMarker629">
    </a>
    <span class="koboSpan" id="kobo.370.1">
     Node.js with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.371.1">
      --experimental-test-coverage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.372.1">
     command-line flag.
    </span>
    <span class="koboSpan" id="kobo.372.2">
     This setup automatically collects coverage statistics, which are reported after all tests are completed.
    </span>
    <span class="koboSpan" id="kobo.372.3">
     Coverage for Node.js core modules and files within
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.373.1">
      node_modules
     </span>
    </strong>
    <span class="koboSpan" id="kobo.374.1">
     directories is not included in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.375.1">
      the report.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.376.1">
     It’s possible to control which lines are included for code coverage by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.377.1">
      using annotations:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.378.1">
       /* node:coverage disable */
      </span>
     </strong>
     <span class="koboSpan" id="kobo.379.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.380.1">
       /* node:coverage enable */
      </span>
     </strong>
     <span class="koboSpan" id="kobo.381.1">
      , which exclude specific lines or blocks of code from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.382.1">
       being counted
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.383.1">
       /* node:coverage ignore next */
      </span>
     </strong>
     <span class="koboSpan" id="kobo.384.1">
      to exclude the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.385.1">
       following line
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.386.1">
       /* node:coverage ignore next n */
      </span>
     </strong>
     <span class="koboSpan" id="kobo.387.1">
      to exclude the following
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.388.1">
        n
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.389.1">
       lines
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.390.1">
     Coverage results can be summarized by built-in reporters such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.391.1">
      tap
     </span>
    </strong>
    <span class="koboSpan" id="kobo.392.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.393.1">
      spec
     </span>
    </strong>
    <span class="koboSpan" id="kobo.394.1">
     , or detailed through the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.395.1">
      lcov
     </span>
    </strong>
    <span class="koboSpan" id="kobo.396.1">
     reporter, which generates a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.397.1">
      lcov
     </span>
    </strong>
    <span class="koboSpan" id="kobo.398.1">
     file suitable for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.399.1">
      in-depth analysis.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.400.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.401.1">
     The current implementation of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.402.1">
      --experimental-test-coverage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.403.1">
     has limitations, such as the absence of source map support and the inability to exclude specific files or directories from the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.404.1">
      coverage report.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.405.1">
     To collect code coverage in the example from the recipe, you can run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.406.1">
      following command:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.407.1">$ node --test --experimental-test-coverage</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.408.1">
     Expect to see output like
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.409.1">
      the following:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer032">
     <span class="koboSpan" id="kobo.410.1">
      <img alt="Figure 8.1 – Terminal window showing a node:test code coverage report" src="image/B19212_08_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.411.1">
     Figure 8.1 – Terminal window showing a node:test code coverage report
    </span>
   </p>
   <h2 id="_idParaDest-244">
    <a id="_idTextAnchor251">
    </a>
    <span class="koboSpan" id="kobo.412.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.413.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.414.1">
       Testing with Jest
      </span>
     </em>
     <span class="koboSpan" id="kobo.415.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.416.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.417.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.418.1">
       Configuring Continuous Integration tests
      </span>
     </em>
     <span class="koboSpan" id="kobo.419.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.420.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.421.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.422.1">
       Writing module code
      </span>
     </em>
     <span class="koboSpan" id="kobo.423.1">
      recipe in
     </span>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.424.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
   <h1 id="_idParaDest-245">
    <a id="_idTextAnchor252">
    </a>
    <span class="koboSpan" id="kobo.425.1">
     Testing with Jest
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.426.1">
     Jest is a widely adopted open source JavaScript
    </span>
    <a id="_idIndexMarker630">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     testing framework developed by Facebook.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     It is particularly favored for testing React applications, though its versatility extends to Node.js
    </span>
    <a id="_idIndexMarker631">
    </a>
    <span class="koboSpan" id="kobo.428.1">
     environments.
    </span>
    <span class="koboSpan" id="kobo.428.2">
     Jest is an opinionated testing framework with a host of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.429.1">
      bundled features.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.430.1">
     In this guide, we will explore how to effectively write and structure tests using Jest.
    </span>
    <span class="koboSpan" id="kobo.430.2">
     You’ll learn the key principles of Jest and how to set up your testing environment.
    </span>
    <span class="koboSpan" id="kobo.430.3">
     Additionally, we’ll explore Jest’s capabilities in measuring and reporting test coverage to help you understand how well your code base is covered
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.431.1">
      by tests.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-246">
    <a id="_idTextAnchor253">
    </a>
    <span class="koboSpan" id="kobo.432.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.433.1">
     We will be using Jest to test a program
    </span>
    <a id="_idIndexMarker632">
    </a>
    <span class="koboSpan" id="kobo.434.1">
     that provides some text
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.435.1">
      utility functions.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.436.1">
      First, let’s create and initialize our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.437.1">
       project directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.438.1">$ mkdir testing-with-jest</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.439.1">$ cd testing-with-jest</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.440.1">$ npm init --yes</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.441.1">
      We need a program to test.
     </span>
     <span class="koboSpan" id="kobo.441.2">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.442.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.443.1">
        textUtils.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.444.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.445.1">$ touch textUtils.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.446.1">
      Add the following code
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.447.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.448.1">
        textUtils.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.449.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.450.1">
function lowercase (str) {
  return str.toLowerCase();
}
function uppercase (str) {
  return str.toUpperCase();
}
function capitalize (str) {
  if (!str) return str;
  return str.charAt(0).toUpperCase() +
    str.slice(1).toLowerCase();
}
module.exports = { lowercase, uppercase, capitalize };</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.451.1">
      We’ll also create a test file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.452.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.453.1">
        textUtils.test.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.454.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.455.1">$ touch textUtils.test.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.456.1">
     Now that we’ve got our directory
    </span>
    <a id="_idIndexMarker633">
    </a>
    <span class="koboSpan" id="kobo.457.1">
     and files initialized, we’re ready to move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.458.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-247">
    <a id="_idTextAnchor254">
    </a>
    <span class="koboSpan" id="kobo.459.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.460.1">
     In this recipe, we will learn how to write and structure various tests
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.461.1">
      with Jest.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.462.1">
      First, we need to install Jest as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.463.1">
       development dependency:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.464.1">$ npm install --save-dev jest</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.465.1">
      We’ll also update our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.466.1">
       npm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.467.1">
      test script in our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.468.1">
       package.json
      </span>
     </strong>
     <span class="koboSpan" id="kobo.469.1">
      file to call the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.470.1">
       jest
      </span>
     </strong>
     <span class="koboSpan" id="kobo.471.1">
      test runner.
     </span>
     <span class="koboSpan" id="kobo.471.2">
      Change the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.472.1">
       "test"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.473.1">
      script field to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.474.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.475.1">
  "scripts": {
    "test": </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">"jest"</span></strong><span class="koboSpan" id="kobo.477.1">
  }</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.478.1">
      In
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.479.1">
       textUtils.test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.480.1">
      , we first need to import our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.481.1">
       textUtils.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.482.1">
      module to enable us to test it.
     </span>
     <span class="koboSpan" id="kobo.482.2">
      Add the following line to the top of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.483.1">
       test file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.484.1">
const { lowercase, uppercase, capitalize } =
  require('./textUtils');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.485.1">
      Add a Jest
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.486.1">
       describe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.487.1">
      block.
     </span>
     <span class="koboSpan" id="kobo.487.2">
      Jest
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.488.1">
       describe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.489.1">
      blocks are used to group and structure our tests.
     </span>
     <span class="koboSpan" id="kobo.489.2">
      Add
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.490.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.491.1">
describe('textUtils', () =&gt; {
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.492.1">
      Within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.493.1">
       describe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.494.1">
      block, we can start adding our test cases.
     </span>
     <span class="koboSpan" id="kobo.494.2">
      We use Jest’s
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.495.1">
       test()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.496.1">
      syntax to define each test.
     </span>
     <span class="koboSpan" id="kobo.496.2">
      Our test will use Jest’s assertion syntax to verify that when we call our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.497.1">
       lowercase()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.498.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.499.1">
       uppercase()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.500.1">
      functions they produce the expected results.
     </span>
     <span class="koboSpan" id="kobo.500.2">
      Add the following code within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.501.1">
       describe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.502.1">
      block to create
     </span>
     <a id="_idIndexMarker634">
     </a>
     <span class="koboSpan" id="kobo.503.1">
      the three
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.504.1">
       test cases:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.505.1">
  test('converts "HELLO WORLD" to all lowercase', ()
    =&gt; {
      expect(lowercase('HELLO WORLD')).toBe('hello
        world');
  });
  test('converts "hello world" to all uppercase', ()
    =&gt; {
      expect(uppercase('hello world')).toBe('HELLO
        WORLD');
  });
  test('capitalizes the first letter of "hello"', ()
    =&gt; {
      expect(capitalize('hello')).toBe('Hello');
  });</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.506.1">
      Now, we can run our tests.
     </span>
     <span class="koboSpan" id="kobo.506.2">
      We can run the test by entering the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.507.1">
       npm test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.508.1">
      command in our terminal.
     </span>
     <span class="koboSpan" id="kobo.508.2">
      Jest will print a summary of our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.509.1">
       test results:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.510.1">$ npm test</span></strong><span class="koboSpan" id="kobo.511.1">
&gt; testing-with-jest@1.0.0 test
&gt; jest
 PASS  ./textUtils.test.js
  textUtils
    ✓ converts "HELLO WORLD" to all lowercase (2 ms)
    ✓ converts "hello world" to all uppercase (1 ms)
    ✓ capitalizes the first letter of "hello"
Test Suites: 1 passed, 1 total
Tests:       3 passed, 3 total
Snapshots:   0 total
Time:        0.342 s, estimated 1 s
Ran all test suites.</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.512.1">
      Jest provides a built-in code coverage
     </span>
     <a id="_idIndexMarker635">
     </a>
     <span class="koboSpan" id="kobo.513.1">
      feature.
     </span>
     <span class="koboSpan" id="kobo.513.2">
      Running this will show us which lines of our program have been covered by the test case.
     </span>
     <span class="koboSpan" id="kobo.513.3">
      You can enable coverage reporting by passing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.514.1">
       --coverage
      </span>
     </strong>
     <span class="koboSpan" id="kobo.515.1">
      flag to the Jest executable.
     </span>
     <span class="koboSpan" id="kobo.515.2">
      Enter the following command in your terminal to reference the installed Jest executable and report
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.516.1">
       code coverage:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.517.1">$ ./node_modules/jest/bin/jest.js --coverage</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.518.1">
       Expect to see the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.519.1">
        following output:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer033">
     <span class="koboSpan" id="kobo.520.1">
      <img alt="Figure 8.2 – Terminal window showing a Jest code coverage report" src="image/B19212_08_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.521.1">
     Figure 8.2 – Terminal window showing a Jest code coverage report
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.522.1">
     Note that the code coverage
    </span>
    <a id="_idIndexMarker636">
    </a>
    <span class="koboSpan" id="kobo.523.1">
     report states we’ve not covered line 8 in textUtils.js.
    </span>
    <span class="koboSpan" id="kobo.523.2">
     Note that depending on your code formatting, the specific line number may change.
    </span>
    <span class="koboSpan" id="kobo.523.3">
     With this information, we can add a test case to satisfy
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.524.1">
      this line.
     </span>
    </span>
   </p>
   <ol>
    <li value="8">
     <span class="koboSpan" id="kobo.525.1">
      Add the following test case to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.526.1">
       textUtils.test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.527.1">
      to cover the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.528.1">
       missing line:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.529.1">
  test('return empty string as it is', () =&gt; {
    expect(capitalize('')).toBe('');
  });</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.530.1">
      Now, you can rerun the code coverage report with the following command and expect to see our code is now
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.531.1">
       100% covered:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.532.1">$ ./node_modules/jest/bin/jest.js --coverage</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.533.1">
     We’ve now created a test for our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.534.1">
      textUtils.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.535.1">
     module using Jest and learned how to generate code
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.536.1">
      coverage reports.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-248">
    <a id="_idTextAnchor255">
    </a>
    <span class="koboSpan" id="kobo.537.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.538.1">
     The first line of our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.539.1">
      textUtils.test.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.540.1">
     file imports our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.541.1">
      textUtils.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.542.1">
     module, allowing
    </span>
    <a id="_idIndexMarker637">
    </a>
    <span class="koboSpan" id="kobo.543.1">
     us to call it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.544.1">
      when testing.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.545.1">
     We organized our tests using Jest’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.546.1">
      describe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.547.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.548.1">
      test()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.549.1">
     functions.
    </span>
    <span class="koboSpan" id="kobo.549.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.550.1">
      describe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.551.1">
     function is used to define a collection of tests.
    </span>
    <span class="koboSpan" id="kobo.551.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      describe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     method takes two parameters.
    </span>
    <span class="koboSpan" id="kobo.553.2">
     The first is a name for the test group, and the second parameter is a callback function, which can contain test cases or nested
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.554.1">
       describe()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.555.1">
      blocks.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.556.1">
     Jest’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.557.1">
      test()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.558.1">
     syntax is used to define a test case.
    </span>
    <span class="koboSpan" id="kobo.558.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.559.1">
      test()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.560.1">
     method accepts two parameters.
    </span>
    <span class="koboSpan" id="kobo.560.2">
     The first is the test name, and the second is a callback function that contains the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.561.1">
      test logic.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.562.1">
     The test logic for this program had just one line, which asserts that when we call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.563.1">
      uppercase('hello world')
     </span>
    </strong>
    <span class="koboSpan" id="kobo.564.1">
     , a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.565.1">
      HELLO WORLD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.566.1">
     value is returned as expected.
    </span>
    <span class="koboSpan" id="kobo.566.2">
     The assertion uses Jest’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.567.1">
      Expect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.568.1">
     bundled assertion library (
    </span>
    <a href="https://www.npmjs.com/package/expect">
     <span class="koboSpan" id="kobo.569.1">
      https://www.npmjs.com/package/expect
     </span>
    </a>
    <span class="koboSpan" id="kobo.570.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.570.2">
     We used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.571.1">
      toBe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.572.1">
     assertion from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.573.1">
      Expect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.574.1">
     library to equate the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.575.1">
      two values.
     </span>
    </span>
   </p>
   <p>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.576.1">
      Expect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.577.1">
     exposes many assertion methods, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.578.1">
      toBe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.579.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.580.1">
      toContain()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.581.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.582.1">
      toThrow()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.583.1">
     , and others.
    </span>
    <span class="koboSpan" id="kobo.583.2">
     A full list of assertions is defined in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.584.1">
      Expect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.585.1">
     section of Jest’s API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.586.1">
      documentation
     </span>
    </span>
    <a href="https://jestjs.io/docs/en/expect.html#methods">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.587.1">
       https://jestjs.io/docs/en/expect.html#methods
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.588.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.589.1">
     It’s also possible to invert assertions by adding
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.590.1">
      .not
     </span>
    </strong>
    <span class="koboSpan" id="kobo.591.1">
     to our statements, as in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.592.1">
      following example:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.593.1">
  expect(uppercase('hello')).not.toBe('hello');</span></pre>
   <p>
    <span class="koboSpan" id="kobo.594.1">
     To run our test cases, we call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.595.1">
      jest
     </span>
    </strong>
    <span class="koboSpan" id="kobo.596.1">
     test runner, which is located within our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.597.1">
      node_modules
     </span>
    </strong>
    <span class="koboSpan" id="kobo.598.1">
     directory.
    </span>
    <span class="koboSpan" id="kobo.598.2">
     The Jest executable runs the tests, automatically looking for files containing
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.599.1">
      test.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.600.1">
     .
    </span>
    <span class="koboSpan" id="kobo.600.2">
     The runner executes our tests and then generates an output summary of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.601.1">
      the results.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.602.1">
     In the final step of the recipe, we enabled Jest’s code coverage reporting.
    </span>
    <span class="koboSpan" id="kobo.602.2">
     Code coverage is a measure of how many lines of our program code are touched when executing our tests.
    </span>
    <span class="koboSpan" id="kobo.602.3">
     100% code coverage means that every line of your program is covered by the test suite.
    </span>
    <span class="koboSpan" id="kobo.602.4">
     This helps you easily detect bugs introduced by code changes.
    </span>
    <span class="koboSpan" id="kobo.602.5">
     Some developers and organizations set acceptable thresholds for code coverage and put restrictions in place so that the code coverage
    </span>
    <a id="_idIndexMarker638">
    </a>
    <span class="koboSpan" id="kobo.603.1">
     percentage cannot
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.604.1">
      be regressed.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-249">
    <a id="_idTextAnchor256">
    </a>
    <span class="koboSpan" id="kobo.605.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.606.1">
     Jest provides more features
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.607.1">
      out of the box
     </span>
    </strong>
    <span class="koboSpan" id="kobo.608.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.609.1">
      OOTB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.610.1">
     ) than some of the other popular Node.js test libraries.
    </span>
    <span class="koboSpan" id="kobo.610.2">
     Let’s look at a couple
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.611.1">
      of them.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.612.1">
     Setup and teardown
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.613.1">
     Jest provides setup
    </span>
    <a id="_idIndexMarker639">
    </a>
    <span class="koboSpan" id="kobo.614.1">
     and teardown functionality for tests.
    </span>
    <span class="koboSpan" id="kobo.614.2">
     Setup steps can be run before each or all tests using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.615.1">
      beforeEach()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.616.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.617.1">
      beforeAll()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.618.1">
     functions respectively.
    </span>
    <span class="koboSpan" id="kobo.618.2">
     Similarly, teardown steps can be run after each or all tests with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.619.1">
      afterEach()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.620.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.621.1">
      afterAll()
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.622.1">
      functions respectively.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.623.1">
     The following pseudocode demonstrates how these functions can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.624.1">
      be used:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.625.1">
describe('test', () =&gt; {
  beforeAll(() =&gt; {
    // Runs once before all tests
  });
  beforeEach(() =&gt; {
    // Runs before each test
  });
  afterEach(() =&gt; {
    // Runs after each test
  });
  afterAll(() =&gt; {
    // Runs after all tests
  });
});</span></pre>
   <h3>
    <span class="koboSpan" id="kobo.626.1">
     Mocking with Jest
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.627.1">
     Mocks enable you to test
    </span>
    <a id="_idIndexMarker640">
    </a>
    <span class="koboSpan" id="kobo.628.1">
     the interaction of your code or functions without having to execute the code.
    </span>
    <span class="koboSpan" id="kobo.628.2">
     Mocks are often used in cases where your tests rely on third-party services or APIs, and you do not want to send real requests to these services when running
    </span>
    <a id="_idIndexMarker641">
    </a>
    <span class="koboSpan" id="kobo.629.1">
     your test suite.
    </span>
    <span class="koboSpan" id="kobo.629.2">
     There are benefits to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.630.1">
      mocking
     </span>
    </strong>
    <span class="koboSpan" id="kobo.631.1">
     , including faster execution of test suites and ensuring your tests are not going to be impacted by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.632.1">
      network conditions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.633.1">
     Jest provides mocking functionality OOTB.
    </span>
    <span class="koboSpan" id="kobo.633.2">
     We can use a mock to verify that our function has been called with the correct parameters, without executing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.634.1">
      the function.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.635.1">
     For example, we could change the test from the recipe to mock the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.636.1">
      uppercase()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.637.1">
     module with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.638.1">
      following code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.639.1">
describe('uppercase', () =&gt; {
  test('uppercase hello returns HELLO', () =&gt; {
    uppercase = jest.fn(() =&gt; 'HELLO');
    const result = uppercase('hello');
    expect(uppercase).toHaveBeenCalledWith('hello');
    expect(result).toBe('HELLO');
  });
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.640.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.641.1">
      jest.fn(() =&gt; 'HELLO');
     </span>
    </strong>
    <span class="koboSpan" id="kobo.642.1">
     method returns a new mock function.
    </span>
    <span class="koboSpan" id="kobo.642.2">
     We assign this to a variable named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.643.1">
      uppercase
     </span>
    </strong>
    <span class="koboSpan" id="kobo.644.1">
     .
    </span>
    <span class="koboSpan" id="kobo.644.2">
     The parameter is a callback function that returns the string
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.645.1">
      'HELLO'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.646.1">
     – this is to demonstrate how we can simulate a function’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.647.1">
      return value.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.648.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.649.1">
      .toHaveBeenCalled()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.650.1">
     method from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.651.1">
      Expect
     </span>
    </strong>
    <span class="koboSpan" id="kobo.652.1">
     verifies that our mock function was called with the correct parameter.
    </span>
    <span class="koboSpan" id="kobo.652.2">
     If, for some reason, you cannot execute a function in your test suite, you can use mocks to validate that the function
    </span>
    <a id="_idIndexMarker642">
    </a>
    <span class="koboSpan" id="kobo.653.1">
     is being called with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.654.1">
      correct parameters.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.655.1">
     Testing asynchronous code
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.656.1">
     Testing asynchronous code
    </span>
    <a id="_idIndexMarker643">
    </a>
    <span class="koboSpan" id="kobo.657.1">
     is essential in ensuring that Node.js applications
    </span>
    <a id="_idIndexMarker644">
    </a>
    <span class="koboSpan" id="kobo.658.1">
     perform as expected, especially when dealing with operations such as API calls, database transactions, or any processes that depend on promise resolution or callbacks.
    </span>
    <span class="koboSpan" id="kobo.658.2">
     Jest provides a clear and straightforward way to handle these asynchronous operations in your tests, ensuring they complete before
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.659.1">
      making assertions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.660.1">
     One of the most common methods to test asynchronous code in Jest is by using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.661.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.662.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.663.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.664.1">
     syntax along with Jest’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.665.1">
      .resolves
     </span>
    </strong>
    <span class="koboSpan" id="kobo.666.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.667.1">
      .rejects
     </span>
    </strong>
    <span class="koboSpan" id="kobo.668.1">
     matchers.
    </span>
    <span class="koboSpan" id="kobo.668.2">
     For example, consider a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.669.1">
      fetchData()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.670.1">
     function that returns a promise resolving to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.671.1">
      some data:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.672.1">
function fetchData() {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; resolve('hello'), 1000);
    });
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.673.1">
     You can write a Jest test to verify that
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.674.1">
      fetchData()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.675.1">
     resolves to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.676.1">
      expected value:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.677.1">
test('data is hello', async () =&gt; {
    await expect(fetchData()).resolves.toBe('hello');
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.678.1">
     This test will wait for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.679.1">
      fetchData()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.680.1">
     promise to resolve, thanks to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.681.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.682.1">
     keyword, and then check that the resolved value
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.683.1">
      matches
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.684.1">
       'hello'
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.685.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.686.1">
     Alternatively, if you’re working with asynchronous code that uses callbacks, you can use Jest’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.687.1">
      done()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.688.1">
     callback to handle
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.689.1">
      this pattern:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.690.1">
function fetchDataCallback(callback) {
    setTimeout(() =&gt; { callback('hello');  }, 1000);
}
test('the data is hello', done =&gt; {
    function callback(data) {
        try {
            expect(data).toBe('hello');
            done();
        } catch (error) {
            done(error);
        }
    }
    fetchDataCallback(callback);
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.691.1">
     In this test,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.692.1">
      done()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.693.1">
     is called once the callback receives data, signaling to Jest that the test is complete.
    </span>
    <span class="koboSpan" id="kobo.693.2">
     If there is an error in your expectation, calling
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.694.1">
      done()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.695.1">
     with an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.696.1">
      error
     </span>
    </strong>
    <span class="koboSpan" id="kobo.697.1">
     argument
    </span>
    <a id="_idIndexMarker645">
    </a>
    <span class="koboSpan" id="kobo.698.1">
     allows Jest to handle
    </span>
    <a id="_idIndexMarker646">
    </a>
    <span class="koboSpan" id="kobo.699.1">
     the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.700.1">
      error properly.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-250">
    <a id="_idTextAnchor257">
    </a>
    <span class="koboSpan" id="kobo.701.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.702.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.703.1">
       Configuring Continuous Integration tests
      </span>
     </em>
     <span class="koboSpan" id="kobo.704.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.705.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.706.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.707.1">
       Writing module code
      </span>
     </em>
     <span class="koboSpan" id="kobo.708.1">
      recipe in
     </span>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.709.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
   <h1 id="_idParaDest-251">
    <a id="_idTextAnchor258">
    </a>
    <span class="koboSpan" id="kobo.710.1">
     Stubbing HTTP requests
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.711.1">
     It is common for the Node.js applications
    </span>
    <a id="_idIndexMarker647">
    </a>
    <span class="koboSpan" id="kobo.712.1">
     you’re building to rely on and consume an external service or API.
    </span>
    <span class="koboSpan" id="kobo.712.2">
     When unit testing, you do not typically want your test to send a request to an external service.
    </span>
    <span class="koboSpan" id="kobo.712.3">
     Requests to the external service you’re consuming are metered or rate-limited, and you do not want your test cases to consume
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.713.1">
      the allowance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.714.1">
     It’s also possible that your tests would require access to service credentials.
    </span>
    <span class="koboSpan" id="kobo.714.2">
     This means every developer on the project would need access to those credentials before they could run the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.715.1">
      test suite.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.716.1">
     To be able to unit test your code
    </span>
    <a id="_idIndexMarker648">
    </a>
    <span class="koboSpan" id="kobo.717.1">
     without sending a request to an external service, you can fake a request and response.
    </span>
    <span class="koboSpan" id="kobo.717.2">
     This concept is known as stubbing.
    </span>
    <span class="koboSpan" id="kobo.717.3">
     Stubbing can be used
    </span>
    <a id="_idIndexMarker649">
    </a>
    <span class="koboSpan" id="kobo.718.1">
     to mimic API calls, without sending the request.
    </span>
    <span class="koboSpan" id="kobo.718.2">
     Stubbing comes with the additional benefit of reducing any request latency, potentially making the tests run faster than if they were to send
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      real requests.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.720.1">
     The test concepts of stubbing and mocking are often confused.
    </span>
    <span class="koboSpan" id="kobo.720.2">
     Stubbing provides predefined responses to isolate the unit under test, while mocking also verifies interactions by ensuring methods are called with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.721.1">
      certain parameters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.722.1">
     In the recipe, we will be using Sinon.js, which is a library that provides
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.723.1">
      stubbing functionality.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-252">
    <a id="_idTextAnchor259">
    </a>
    <span class="koboSpan" id="kobo.724.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.725.1">
     To get started, let’s set up our directories and files for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.726.1">
      this recipe.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.727.1">
      Create a directory and initialize
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.728.1">
       the project:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.729.1">$ mkdir stubbing-http-requests</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.730.1">$ cd stubbing-http-requests</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.731.1">$ npm init --yes</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.732.1">
      Now, we’ll create a program that sends a request to a third-party service.
     </span>
     <span class="koboSpan" id="kobo.732.2">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.733.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.734.1">
        github.mjs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.735.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.736.1">$ touch github.mjs</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.737.1">
      In our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.738.1">
       github.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.739.1">
      file, we’ll send an HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.740.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.741.1">
      request to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.742.1">
       https://api.github.com/users/
      </span>
     </strong>
     <span class="koboSpan" id="kobo.743.1">
      endpoint.
     </span>
     <span class="koboSpan" id="kobo.743.2">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.744.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.745.1">
        github.mjs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.746.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.747.1">
export async function getGitHubUser(username) {
  const response = await
    fetch(`https://api.github.com/users/${username}`);
  return response.json();
}</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.748.1">
     Now that we have a program that sends an HTTP request to the GitHub API, we can move on to the recipe steps, where we’ll learn how to stub
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.749.1">
      the request.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-253">
    <a id="_idTextAnchor260">
    </a>
    <span class="koboSpan" id="kobo.750.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.751.1">
     In this recipe, we’re going
    </span>
    <a id="_idIndexMarker650">
    </a>
    <span class="koboSpan" id="kobo.752.1">
     to learn how to stub an HTTP request within our tests.
    </span>
    <span class="koboSpan" id="kobo.752.2">
     But we first need to create a test case.
    </span>
    <span class="koboSpan" id="kobo.752.3">
     We’ll use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.753.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.754.1">
     to save having to install an additional
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.755.1">
      test framework.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.756.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.757.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.758.1">
        github.test.mjs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.759.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.760.1">$ touch github.test.mjs</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.761.1">
      Add the following to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.762.1">
       github.test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.763.1">
      to create a test case using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.764.1">
       node:test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.765.1">
      for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.766.1">
       getGithubUser()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.767.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.767.2">
      This will send a real request to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.768.1">
       GitHub API:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.769.1">
import * as assert from 'node:assert';
import { test } from 'node:test';
import { getGitHubUser } from './github.mjs';
test('Get GitHub user by username', async (t) =&gt; {
  const githubUser = await getGitHubUser('octokit');
  assert.strictEqual(githubUser.id, 3430433);
  assert.strictEqual(githubUser.login, 'octokit');
  assert.strictEqual(githubUser.name, 'Octokit');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.770.1">
      We can run the test to check that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.771.1">
       it passes:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.772.1">$ node --test --test-reporter=tap</span></strong><span class="koboSpan" id="kobo.773.1">
TAP version 13
# Subtest: Get GitHub user by username
ok 1 - Get GitHub user by username
  ---
  duration_ms: 279.80306
  ...
</span><span class="koboSpan" id="kobo.773.2">1..1
# tests 1
# suites 0
# pass 1
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 426.372579</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.774.1">
      Now, we can move
     </span>
     <a id="_idIndexMarker651">
     </a>
     <span class="koboSpan" id="kobo.775.1">
      on to the
     </span>
     <a href="https://www.npmjs.com/package/sinon">
      <span class="koboSpan" id="kobo.776.1">
       stubbing.
      </span>
      <span class="koboSpan" id="kobo.776.2">
       We first
      </span>
      <span id="_idIndexMarker652">
      </span>
      <span class="koboSpan" id="kobo.777.1">
       need to instal
      </span>
     </a>
     <span class="koboSpan" id="kobo.778.1">
      l
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.779.1">
       sinon
      </span>
     </strong>
     <span class="koboSpan" id="kobo.780.1">
      (
     </span>
     <a href="https://www.npmjs.com/package/sinon">
      <span class="koboSpan" id="kobo.781.1">
       https://www.npmjs.com/package/sinon
      </span>
     </a>
     <span class="koboSpan" id="kobo.782.1">
      ) as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.783.1">
       development dependency:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.784.1">$ npm install --save-dev sinon</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.785.1">
      Then, in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.786.1">
       github.test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.787.1">
      , we need to import
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.788.1">
       sinon
      </span>
     </strong>
     <span class="koboSpan" id="kobo.789.1">
      .
     </span>
     <span class="koboSpan" id="kobo.789.2">
      Add the following just below the line where the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.790.1">
       node:test
      </span>
     </strong>
     <span class="koboSpan" id="kobo.791.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.792.1">
       is imported:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.793.1">
import sinon from 'sinon';</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.794.1">
      To be able to stub the request, we need to store the output from the real request to the GitHub API.
     </span>
     <span class="koboSpan" id="kobo.794.2">
      In this case, we’ll create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.795.1">
       fakeResponse
      </span>
     </strong>
     <span class="koboSpan" id="kobo.796.1">
      constant to return just the values
     </span>
     <a id="_idIndexMarker653">
     </a>
     <span class="koboSpan" id="kobo.797.1">
      we’re verifying.
     </span>
     <span class="koboSpan" id="kobo.797.2">
      Add the following to the start of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.798.1">
       test case:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.799.1">
  const fakeResponse = Promise.resolve({
    json: () =&gt; Promise.resolve({
      id: 3430433,
      login: 'octokit',
      name: 'Octokit'
    })
  });</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.800.1">
      Next, we need to add a line that instructs the test to use the stubbed
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.801.1">
       fetch()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.802.1">
      function instead of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.803.1">
       real function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.804.1">
  sinon.stub(global, 'fetch').returns(fakeResponse);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.805.1">
      After we’ve made our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.806.1">
       getGitHubUser('octokit')
      </span>
     </strong>
     <span class="koboSpan" id="kobo.807.1">
      call in the test case, we should restore the original
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.808.1">
       fetch()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.809.1">
      method so that it can be used by other tests or code.
     </span>
     <span class="koboSpan" id="kobo.809.2">
      We can do this using
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.810.1">
       sinon.restore();
      </span>
     </strong>
     <span class="koboSpan" id="kobo.811.1">
      .
     </span>
     <span class="koboSpan" id="kobo.811.2">
      Add this below the line where we
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.812.1">
       call
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.813.1">
        getGitHubUser('octokit')
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.814.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.815.1">
      Your full
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.816.1">
       github.test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.817.1">
      file should now look like
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.818.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.819.1">
import * as assert from 'node:assert';
import { test } from 'node:test';
</span><strong class="bold"><span class="koboSpan" id="kobo.820.1">import sinon from 'sinon';</span></strong><span class="koboSpan" id="kobo.821.1">
import { getGitHubUser } from './github.mjs';
test('Get GitHub user by username', async (t) =&gt; {
</span><strong class="bold"><span class="koboSpan" id="kobo.822.1">  const fakeResponse = Promise.resolve({</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.823.1">    json: () =&gt; Promise.resolve({</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.824.1">      id: 3430433,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.825.1">      login: 'octokit',</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.826.1">      name: 'Octokit'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.827.1">    })</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.828.1">  });</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.829.1">  sinon.stub(global, 'fetch').returns(fakeResponse);</span></strong><span class="koboSpan" id="kobo.830.1">
  const githubUser = await getGitHubUser('octokit');
</span><strong class="bold"><span class="koboSpan" id="kobo.831.1">  sinon.restore();</span></strong><span class="koboSpan" id="kobo.832.1">
  assert.strictEqual(githubUser.id, 3430433);
  assert.strictEqual(githubUser.login, 'octokit');
  assert.strictEqual(githubUser.name, 'Octokit');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.833.1">
      Let’s rerun the tests
     </span>
     <a id="_idIndexMarker654">
     </a>
     <span class="koboSpan" id="kobo.834.1">
      and check whether they still pass now that we’re mocking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.835.1">
       the request:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.836.1">$ node --test --test-reporter=tap</span></strong><span class="koboSpan" id="kobo.837.1">
TAP version 13
# Subtest: Get GitHub user by username
ok 1 - Get GitHub user by username
  ---
  duration_ms: 2.510738
  ...
</span><span class="koboSpan" id="kobo.837.2">1..1
# tests 1
# suites 0
# pass 1
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 129.078933</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.838.1">
     Note the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.839.1">
      duration_ms
     </span>
    </strong>
    <span class="koboSpan" id="kobo.840.1">
     value of this test
    </span>
    <a id="_idIndexMarker655">
    </a>
    <span class="koboSpan" id="kobo.841.1">
     run is reduced – this is because we are not sending a real request over
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.842.1">
      the network.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.843.1">
     We’ve now learned how to stub an API request
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.844.1">
      using Sinon.js.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-254">
    <a id="_idTextAnchor261">
    </a>
    <span class="koboSpan" id="kobo.845.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.846.1">
     In the recipe, Sinon.js is used to simulate the behavior of a function that fetches user data from GitHub’s API.
    </span>
    <span class="koboSpan" id="kobo.846.2">
     Instead of executing an actual network request, which can be slow and consume limited API request quotas, we substitute the global
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.847.1">
      fetch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.848.1">
     method with a “stub.”
    </span>
    <span class="koboSpan" id="kobo.848.2">
     This
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.849.1">
      stub()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.850.1">
     function is designed to resolve with a predetermined object that represents a GitHub
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.851.1">
      user’s data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.852.1">
     Initially, the necessary modules and utilities are imported:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.853.1">
      node:assert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.854.1">
     for assertions,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.855.1">
      node:test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.856.1">
     to define the test case, and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.857.1">
      sinon
     </span>
    </strong>
    <span class="koboSpan" id="kobo.858.1">
     for creating a stub.
    </span>
    <span class="koboSpan" id="kobo.858.2">
     We also import the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.859.1">
      getGitHubUser()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.860.1">
     function we plan
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.861.1">
      to test.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.862.1">
     Sinon.js is used to create a stub for the global
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.863.1">
      fetch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.864.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.864.2">
     The stub is designed to return a fake response that resembles what would be expected from the actual GitHub API.
    </span>
    <span class="koboSpan" id="kobo.864.3">
     This fake response is a
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.865.1">
      promise
     </span>
    </em>
    <span class="koboSpan" id="kobo.866.1">
     that resolves to an object with a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.867.1">
      json()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.868.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.868.2">
     This, in turn, returns a promise that resolves to an object containing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.869.1">
      id
     </span>
    </strong>
    <span class="koboSpan" id="kobo.870.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.871.1">
      login
     </span>
    </strong>
    <span class="koboSpan" id="kobo.872.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.873.1">
      name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.874.1">
     properties of our test GitHub user – mimicking the format of the GitHub
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.875.1">
      API response.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.876.1">
     When
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.877.1">
      getGitHubUser()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.878.1">
     is invoked with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.879.1">
      octokit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.880.1">
     username, the stubbed
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.881.1">
      fetch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.882.1">
     function intercepts the call and returns a fake response.
    </span>
    <span class="koboSpan" id="kobo.882.2">
     As a result,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.883.1">
      getGitHubUser
     </span>
    </strong>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.884.1">
      ()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.885.1">
     processes this response as if it were a real one from the API but without incurring network latency.
    </span>
    <span class="koboSpan" id="kobo.885.2">
     After the simulated API call, the actual
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.886.1">
      user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.887.1">
     object is awaited and then checked against the expected values to confirm that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.888.1">
      getGitHubUser()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.889.1">
     function handles the response
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.890.1">
      as expected.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.891.1">
     After the assertions,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.892.1">
      sinon.restore()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.893.1">
     is called, which reinstates the original
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.894.1">
      fetch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.895.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.895.2">
     This ensures that subsequent tests or other parts of the code base are not affected by the stubbing of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.896.1">
      fetch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.897.1">
     method in this test.
    </span>
    <span class="koboSpan" id="kobo.897.2">
     This practice ensures the isolation of the test and prevents side effects on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.898.1">
      other tests.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.899.1">
     This recipe provided a high-level view
    </span>
    <a id="_idIndexMarker656">
    </a>
    <span class="koboSpan" id="kobo.900.1">
     of the stubbing process by demonstrating how to stub a single method with Sinon.js.
    </span>
    <span class="koboSpan" id="kobo.900.2">
     Stubbing can be used to replace any part of the system under test, from individual functions to entire modules, which can be particularly useful in a microservice architecture where services may depend on responses from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.901.1">
      other services.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-255">
    <a id="_idTextAnchor262">
    </a>
    <span class="koboSpan" id="kobo.902.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.903.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.904.1">
       Testing with Jest
      </span>
     </em>
     <span class="koboSpan" id="kobo.905.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.906.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.907.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.908.1">
       Configuring Continuous Integration tests
      </span>
     </em>
     <span class="koboSpan" id="kobo.909.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.910.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-256">
    <a id="_idTextAnchor263">
    </a>
    <span class="koboSpan" id="kobo.911.1">
     Using Puppeteer
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.912.1">
     UI testing is a technique
    </span>
    <a id="_idIndexMarker657">
    </a>
    <span class="koboSpan" id="kobo.913.1">
     used to identify issues with
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.914.1">
      graphical UIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.915.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.916.1">
      GUIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.917.1">
     ), particularly in web
    </span>
    <a id="_idIndexMarker658">
    </a>
    <span class="koboSpan" id="kobo.918.1">
     applications.
    </span>
    <span class="koboSpan" id="kobo.918.2">
     Although Node.js is primarily a server-side platform, it is frequently used to develop web applications, where UI testing plays a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.919.1">
      critical role.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.920.1">
     For example, if you have an application containing an HTML form, you could use UI testing to validate that the HTML form contains the correct set of input fields.
    </span>
    <span class="koboSpan" id="kobo.920.2">
     UI testing can also validate interactions with the interface – such as simulating button clicks or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.921.1">
      hyperlink activations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.922.1">
     Puppeteer is an open source library that provides a headless Chromium instance, which can be programmatically interacted with to automate UI tests.
    </span>
    <span class="koboSpan" id="kobo.922.2">
     It is particularly useful for Node.js environments because of its native support and ease
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.923.1">
      of integration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.924.1">
     n the recipe, we will
    </span>
    <a id="_idIndexMarker659">
    </a>
    <span class="koboSpan" id="kobo.925.1">
     use Puppeteer (
    </span>
    <a href="https://pptr.dev/">
     <span class="koboSpan" id="kobo.926.1">
      https://pptr.dev/
     </span>
    </a>
    <span class="koboSpan" id="kobo.927.1">
     ) to perform UI testing on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.928.1">
      http://example.com/
     </span>
    </strong>
    <span class="koboSpan" id="kobo.929.1">
     website.
    </span>
    <span class="koboSpan" id="kobo.929.2">
     However, other popular alternatives for UI testing in Node.js include Selenium, Cypress, and Playwright.
    </span>
    <span class="koboSpan" id="kobo.929.3">
     While the high-level principle and purpose of each of these tools are similar, each tool has its strengths and can be chosen based on specific needs such as cross-browser testing, ease of setup, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.930.1">
      integration capabilities.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-257">
    <a id="_idTextAnchor264">
    </a>
    <span class="koboSpan" id="kobo.931.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.932.1">
     Prepare your development
    </span>
    <a id="_idIndexMarker660">
    </a>
    <span class="koboSpan" id="kobo.933.1">
     environment for Puppeteer by setting up a new project directory and creating an initial
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.934.1">
      test file.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.935.1">
      Create a directory and initialize our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.936.1">
       project directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.937.1">$ mkdir using-puppeteer</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.938.1">$ cd using-puppeteer</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.939.1">$ npm init --yes</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.940.1">
      Next, we’ll create our UI
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.941.1">
       test file:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.942.1">$ touch test.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.943.1">
     Now that we have our project directory initialized, we’re ready to move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.944.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-258">
    <a id="_idTextAnchor265">
    </a>
    <span class="koboSpan" id="kobo.945.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.946.1">
     In this recipe, we’ll learn how to test a web page using Puppeteer.
    </span>
    <span class="koboSpan" id="kobo.946.2">
     We’re going to verify that we receive the expected content from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.947.1">
      https://example.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.948.1">
     .
    </span>
    <span class="koboSpan" id="kobo.948.2">
     We’ll use the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.949.1">
      assert
     </span>
    </strong>
    <span class="koboSpan" id="kobo.950.1">
     library for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.951.1">
      assertion logic.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.952.1">
      The first step is to install the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.953.1">
       puppeteer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.954.1">
      module.
     </span>
     <span class="koboSpan" id="kobo.954.2">
      We’ll install the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.955.1">
       puppeteer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.956.1">
      module as a development dependency as it’ll only be used
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.957.1">
       for testing:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.958.1">$ npm install --save-dev puppeteer</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.959.1">
       Note that this may take a long time as it is downloading the Chromium
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.960.1">
        headless browser.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.961.1">
      Next, we’ll open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.962.1">
       test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.963.1">
      and add the following lines to import both the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.964.1">
       assert
      </span>
     </strong>
     <span class="koboSpan" id="kobo.965.1">
      and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.966.1">
        puppeteer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.967.1">
       modules:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.968.1">
const assert = require('node:assert');
const puppeteer = require('puppeteer');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.969.1">
      Next, we’ll create an asynchronous function named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.970.1">
       runTest()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.971.1">
      , which will hold all our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.972.1">
       test logic:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.973.1">
async function runTest() {
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.974.1">
      Within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.975.1">
       runTest()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.976.1">
      function, we need to launch Puppeteer.
     </span>
     <span class="koboSpan" id="kobo.976.2">
      Do this by adding the following line, which calls Puppeteer’s
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.977.1">
        launch()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.978.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.979.1">
  const browser = await puppeteer.launch();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.980.1">
      Next, also inside the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.981.1">
       runTest()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.982.1">
      function, we need to create a new Puppeteer
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.983.1">
       browser page:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.984.1">
  const page = await browser.newPage();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.985.1">
      We can now instruct Puppeteer to load a URL.
     </span>
     <span class="koboSpan" id="kobo.985.2">
      We do this by calling the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.986.1">
       goto()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.987.1">
      function on the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.988.1">
        page
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.989.1">
       object:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.990.1">
  await page.goto('https://example.com');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.991.1">
      Now that we’ve got a handle to the web page (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.992.1">
       https://example.com
      </span>
     </strong>
     <span class="koboSpan" id="kobo.993.1">
      ), we can extract values from the web page by calling Puppeteer’s
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.994.1">
       $eval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.995.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.995.2">
      We supply the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.996.1">
       $eval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.997.1">
      function the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.998.1">
       h1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.999.1">
      tag, indicating that we want to abstract the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1000.1">
       h1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1001.1">
      element and a callback function.
     </span>
     <span class="koboSpan" id="kobo.1001.2">
      The callback function will return the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1002.1">
       innerText
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1003.1">
      value of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1004.1">
       h1
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1005.1">
      element.
     </span>
     <span class="koboSpan" id="kobo.1005.2">
      Add the following line to extract the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1006.1">
        h1
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1007.1">
       value:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1008.1">
  const title = await page.$eval('h1', (el) =&gt;
    el.innerText);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1009.1">
      Now, we can add our assertion.
     </span>
     <span class="koboSpan" id="kobo.1009.2">
      We expect the title to be
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1010.1">
       "Example Domain"
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1011.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1011.2">
      Add the following assertion statement.
     </span>
     <span class="koboSpan" id="kobo.1011.3">
      We’ll also add a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1012.1">
       console.log()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1013.1">
      statement to output the value – you wouldn’t typically do this in a real test case to avoid noise in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1014.1">
       STDOUT
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1015.1">
      , but it will help us see what
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1016.1">
       is happening:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1017.1">
  console.log('Title value:', title);
  assert.equal(title, 'Example Domain');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1018.1">
      We need to call
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1019.1">
       browser.close()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1020.1">
      ; otherwise, Puppeteer
     </span>
     <a id="_idIndexMarker661">
     </a>
     <span class="koboSpan" id="kobo.1021.1">
      will continue emulating, and the Node.js process will never exit.
     </span>
     <span class="koboSpan" id="kobo.1021.2">
      Within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1022.1">
       runTest()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1023.1">
      function, add the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1024.1">
       following line:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1025.1">
  browser.close();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1026.1">
      Finally, we just need to call our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1027.1">
       runTest()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1028.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.1028.2">
      Add the following to the bottom of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1029.1">
       test.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1030.1">
      , outside of the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1031.1">
        runTest()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1032.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1033.1">
 runTest();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1034.1">
      We’re now ready to run the test.
     </span>
     <span class="koboSpan" id="kobo.1034.2">
      Enter the following command in your terminal to run
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1035.1">
       the test:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1036.1">$ node test.js</span></strong><span class="koboSpan" id="kobo.1037.1">
Title value: Example Domain</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1038.1">
     We’ve now created our first UI test
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1039.1">
      using Puppeteer.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-259">
    <a id="_idTextAnchor266">
    </a>
    <span class="koboSpan" id="kobo.1040.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1041.1">
     In the recipe, we used Puppeteer to create a test that verifies that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1042.1">
      https://example.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1043.1">
     web page returns the heading
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1044.1">
      'Example Domain'
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1045.1">
     within an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1046.1">
      h1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1047.1">
     HTML element tag.
    </span>
    <span class="koboSpan" id="kobo.1047.2">
     Most of the Puppeteer APIs are asynchronous, so we used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1048.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1049.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1050.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1051.1">
     syntax throughout
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1052.1">
      the recipe.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1053.1">
     When we call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1054.1">
      puppeteer.launch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1055.1">
     , Puppeteer initializes a new headless Chrome instance that we can interact with via JavaScript.
    </span>
    <span class="koboSpan" id="kobo.1055.2">
     As testing with Puppeteer has the overhead of a headless Chrome instance, using it for testing can be less performant than other types of tests.
    </span>
    <span class="koboSpan" id="kobo.1055.3">
     However, as Puppeteer is interacting with Chrome under the hood, it provides a very close simulation of how end users interact with a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1056.1">
      web application.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1057.1">
     Once Puppeteer was launched, we initialized a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1058.1">
      page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1059.1">
     object by calling the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1060.1">
      newPage()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1061.1">
     method on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1062.1">
      browser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1063.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.1063.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1064.1">
      page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1065.1">
     object is used to represent a web page.
    </span>
    <span class="koboSpan" id="kobo.1065.2">
     On the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1066.1">
      page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1067.1">
     object, we then called the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1068.1">
      goto()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1069.1">
     method, which is used to tell Puppeteer which URL should be loaded for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1070.1">
      that object.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1071.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1072.1">
      $eval()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1073.1">
     method is called on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1074.1">
      page
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1075.1">
     object to extract values from the web page.
    </span>
    <span class="koboSpan" id="kobo.1075.2">
     In the recipe, we passed the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1076.1">
      $eval()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1077.1">
     method
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1078.1">
      h1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1079.1">
     as the first parameter.
    </span>
    <span class="koboSpan" id="kobo.1079.2">
     This instructs Puppeteer to identify and extract the HTML
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1080.1">
      &lt;h1&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1081.1">
     element.
    </span>
    <span class="koboSpan" id="kobo.1081.2">
     The second parameter is a callback function, which extracts the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1082.1">
      innerText
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1083.1">
     value of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1084.1">
      &lt;h1&gt;
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1085.1">
     element.
    </span>
    <span class="koboSpan" id="kobo.1085.2">
     For
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1086.1">
      http://example.com
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1087.1">
     , this extracted the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1088.1">
      'Example
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1089.1">
       Domain'
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1090.1">
      value.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1091.1">
     At the end of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1092.1">
      runTest()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1093.1">
     function, we called the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1094.1">
      browser.close()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1095.1">
     method to instruct Puppeteer to end the Chrome emulation.
    </span>
    <span class="koboSpan" id="kobo.1095.2">
     This was necessary since Puppeteer will continue emulating Chrome with the Node.js process
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1096.1">
      never exiting.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1097.1">
     This is a simplistic example, but it serves
    </span>
    <a id="_idIndexMarker662">
    </a>
    <span class="koboSpan" id="kobo.1098.1">
     as a foundation for understanding how UI testing automation works.
    </span>
    <span class="koboSpan" id="kobo.1098.2">
     This test script is easily extendable, allowing the simulation of more complex user interactions such as form submissions, navigation, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1099.1">
      error handling.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-260">
    <a id="_idTextAnchor267">
    </a>
    <span class="koboSpan" id="kobo.1100.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1101.1">
     It’s also possible to run Puppeteer in non-headless mode.
    </span>
    <span class="koboSpan" id="kobo.1101.2">
     You can do this by passing a parameter to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1102.1">
       launch()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1103.1">
      method:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1104.1">
   const browser = await puppeteer.launch({
        headless: false
    });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1105.1">
     In this mode, when you run your tests, you will see the Chromium UI and can follow your tests while they are executing.
    </span>
    <span class="koboSpan" id="kobo.1105.2">
     This can be useful when debugging your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1106.1">
      Puppeteer tests.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-261">
    <a id="_idTextAnchor268">
    </a>
    <span class="koboSpan" id="kobo.1107.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1108.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1109.1">
       Testing with Jest
      </span>
     </em>
     <span class="koboSpan" id="kobo.1110.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1111.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1112.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1113.1">
       Configuring Continuous Integration tests
      </span>
     </em>
     <span class="koboSpan" id="kobo.1114.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1115.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-262">
    <a id="_idTextAnchor269">
    </a>
    <span class="koboSpan" id="kobo.1116.1">
     Configuring Continuous Integration tests
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1117.1">
     CI is a development practice
    </span>
    <a id="_idIndexMarker663">
    </a>
    <span class="koboSpan" id="kobo.1118.1">
     where developers regularly merge their code to a source repository.
    </span>
    <span class="koboSpan" id="kobo.1118.2">
     To maintain the integrity of the source code, automated tests will often be run before each code change
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1119.1">
      is accepted.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1120.1">
     GitHub is one of the most widely used source code repository hosts.
    </span>
    <span class="koboSpan" id="kobo.1120.2">
     With GitHub, when you wish to merge a change into the main Git
    </span>
    <a id="_idIndexMarker664">
    </a>
    <span class="koboSpan" id="kobo.1121.1">
     branch or repository, you open a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1122.1">
      pull request
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1123.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1124.1">
      PR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1125.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.1125.2">
     GitHub provides features for you to configure checks that should run on each PR.
    </span>
    <span class="koboSpan" id="kobo.1125.3">
     It’s common, and good practice, to require a PR to have a passing run of the application’s or module’s unit tests before it can
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1126.1">
      be accepted.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1127.1">
     There are many CI products that can enable the execution of your unit tests (GitHub Actions, Travis CI, and many others).
    </span>
    <span class="koboSpan" id="kobo.1127.2">
     Most of these programs come with a limited free tier for casual developers and paid commercial plans for businesses
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1128.1">
      and enterprises.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1129.1">
     In this recipe, we will learn how to configure GitHub Actions to run our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1130.1">
      Node.js tests.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-263">
    <a id="_idTextAnchor270">
    </a>
    <span class="koboSpan" id="kobo.1131.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1132.1">
     For this recipe, you’ll need a GitHub account.
    </span>
    <span class="koboSpan" id="kobo.1132.2">
     If you’re unfamiliar with Git and GitHub, refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1133.1">
      Scaffolding a module
     </span>
    </em>
    <span class="koboSpan" id="kobo.1134.1">
     recipe in
    </span>
    <a href="B19212_05.xhtml#_idTextAnchor139">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1135.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1136.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1137.1">
     To be able to configure GitHub Actions to run unit tests, we first need to create a GitHub repository and some example
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1138.1">
      unit tests.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1139.1">
      Create a new GitHub repository via
     </span>
     <a href="https://github.com/new">
      <span class="koboSpan" id="kobo.1140.1">
       https://github.com/new
      </span>
     </a>
     <span class="koboSpan" id="kobo.1141.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1141.2">
      Name the new repository
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1142.1">
       enabling-actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1143.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1143.2">
      Also, add the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1144.1">
       Node
      </span>
     </em>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1145.1">
       .gitignore
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1146.1">
      template via the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1147.1">
       drop-down menu.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1148.1">
      Clone your GitHub repository with the following command, replacing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1149.1">
       &lt;username&gt;
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1150.1">
      with your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1151.1">
       GitHub username:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1152.1">$ git clone https://github.com/&lt;username&gt;/enabling-actions.git</span></strong><span class="koboSpan" id="kobo.1153.1">
Cloning into 'enabling-actions'...
</span><span class="koboSpan" id="kobo.1153.2">remote: Enumerating objects: 3, done.
</span><span class="koboSpan" id="kobo.1153.3">remote: Counting objects: 100% (3/3), done.
</span><span class="koboSpan" id="kobo.1153.4">remote: Compressing objects: 100% (2/2), done.
</span><span class="koboSpan" id="kobo.1153.5">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (3/3), done.</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1154.1">
      We now need to initialize
     </span>
     <a id="_idIndexMarker665">
     </a>
     <span class="koboSpan" id="kobo.1155.1">
      our project with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1156.1">
       npm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1157.1">
      and install the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1158.1">
       tape
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1159.1">
       test library:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1160.1">$ cd enabling-actions</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1161.1">
      We also need to create a test.
     </span>
     <span class="koboSpan" id="kobo.1161.2">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1162.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1163.1">
        test.mjs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1164.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1165.1">$ touch test.mjs</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1166.1">
      Add the following to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1167.1">
       test.mjs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1168.1">
      to create our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1169.1">
       unit tests:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1170.1">
import { strictEqual } from 'node:assert';
import { test } from 'node:test';
test('test integer addition', async (t) =&gt; {
  strictEqual(1 + 1, 2, '1 + 1 should equal 2');
});
test('test string addition', async (t) =&gt; {
  // This test is expected to fail because "11" is not numerically 2
  strictEqual('1' + '1', 2, 'Concatenation of "1" and
    "1" does not equal 2');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1171.1">
      Now that we have our project initialized and some unit tests, we can move on to configuring
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1172.1">
       GitHub Actions.
      </span>
     </span>
    </li>
   </ol>
   <h2 id="_idParaDest-264">
    <a id="_idTextAnchor271">
    </a>
    <span class="koboSpan" id="kobo.1173.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1174.1">
     In this recipe, we’re going to learn
    </span>
    <a id="_idIndexMarker666">
    </a>
    <span class="koboSpan" id="kobo.1175.1">
     how to configure CI to run our unit tests when a new change is pushed to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1176.1">
      GitHub repository.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1177.1">
      We need to create a GitHub Actions workflow file in our repository.
     </span>
     <span class="koboSpan" id="kobo.1177.2">
      Create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1178.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1179.1">
        github/workflows
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1180.1">
       directory:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1181.1">
$ mkdir -p .github/workflows
$ touch .github/workflows/test.yml</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1182.1">
      Add the following to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1183.1">
       test.yml
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1184.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.1184.2">
      This will instruct GitHub Actions to run our tests using Node.js 20.
     </span>
     <span class="koboSpan" id="kobo.1184.3">
      Be aware that YAML files are sensitive to both whitespace
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1185.1">
       and indentation:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1186.1">
name: Node.js CI
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [ 20.x ]
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
    - run: node --test</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1187.1">
      Now, we’re ready to commit
     </span>
     <a id="_idIndexMarker667">
     </a>
     <span class="koboSpan" id="kobo.1188.1">
      our code.
     </span>
     <span class="koboSpan" id="kobo.1188.2">
      Enter the following in your terminal to commit
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1189.1">
       the code:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1190.1">$ git add .github/ test.mjs</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1191.1">$ git commit --message "add workflows and test"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1192.1">$ git push origin main</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1193.1">
      Navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1194.1">
       https://github.com/&lt;username&gt;/enabling-actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1195.1">
      in your browser and confirm your code has been pushed to the repository.
     </span>
     <span class="koboSpan" id="kobo.1195.2">
      Expect it to look like
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1196.1">
       the following:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer034">
     <span class="koboSpan" id="kobo.1197.1">
      <img alt="Figure 8.3 – GitHub UI showing the code in the enabling-actions repository" src="image/B19212_08_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1198.1">
     Figure 8.3 – GitHub UI showing the code in the enabling-actions repository
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.1199.1">
      Once the test run
     </span>
     <a id="_idIndexMarker668">
     </a>
     <span class="koboSpan" id="kobo.1200.1">
      has completed, GitHub Actions will indicate that the build is failing.
     </span>
     <span class="koboSpan" id="kobo.1200.2">
      This is intentional, as we purposely created a test case that is expected to fail.
     </span>
     <span class="koboSpan" id="kobo.1200.3">
      This is indicated by a red cross icon.
     </span>
     <span class="koboSpan" id="kobo.1200.4">
      When clicking this icon, we’ll see more details about the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1201.1">
       test run:
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer035">
     <span class="koboSpan" id="kobo.1202.1">
      <img alt="Figure 8.4 – Failed GitHub Actions build modal" src="image/B19212_08_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1203.1">
     Figure 8.4 – Failed GitHub Actions build modal
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.1204.1">
      Click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1205.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1206.1">
      , and it’ll take you to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1207.1">
       Actions
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1208.1">
      tab for that
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1209.1">
       test run:
      </span>
     </span>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer036">
     <span class="koboSpan" id="kobo.1210.1">
      <img alt="Figure 8.5 – GitHub Actions build log" src="image/B19212_08_05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1211.1">
     Figure 8.5 – GitHub Actions build log
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1212.1">
     Observe that we can see the specific
    </span>
    <a id="_idIndexMarker669">
    </a>
    <span class="koboSpan" id="kobo.1213.1">
     step that failed,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1214.1">
      Run node --test
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1215.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1215.2">
     You should be able to click on each step to expand and view
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1216.1">
      the logs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1217.1">
     We’ve successfully enabled GitHub Actions CI on our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1218.1">
      GitHub repository.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-265">
    <a id="_idTextAnchor272">
    </a>
    <span class="koboSpan" id="kobo.1219.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1220.1">
     In the GitHub Actions workflow configuration for a Node.js application, we outlined a specific CI process designed to automate testing upon commits and PRs to the main branch.
    </span>
    <span class="koboSpan" id="kobo.1220.2">
     Here’s a detailed breakdown of how the workflow functions, illustrated with code snippets from the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1221.1">
       test.yml
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1222.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1223.1">
     The workflow starts with the definition of event triggers under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1224.1">
      on
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1225.1">
     key in the YAML file.
    </span>
    <span class="koboSpan" id="kobo.1225.2">
     It is set to activate on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1226.1">
      push
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1227.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1228.1">
      pull_request
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1229.1">
     events specifically targeting the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1230.1">
       main
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1231.1">
      branch:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1232.1">
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1233.1">
     This snippet ensures that any code pushed to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1234.1">
      main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1235.1">
     or any PRs made to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1236.1">
      main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1237.1">
     will initiate the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1238.1">
      CI process.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1239.1">
     Next, we define the job environment
    </span>
    <a id="_idIndexMarker670">
    </a>
    <span class="koboSpan" id="kobo.1240.1">
     and specify the Node.js versions to test against using a matrix strategy.
    </span>
    <span class="koboSpan" id="kobo.1240.2">
     This approach allows testing across multiple versions, enhancing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1241.1">
      compatibility verification:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1242.1">
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        </span><strong class="bold"><span class="koboSpan" id="kobo.1243.1">node-version: [20.x, 22.x]</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.1244.1">
     When we use the test matrix to test across multiple versions, we can expect to see an interface similar to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1245.1">
      the following:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer037">
     <span class="koboSpan" id="kobo.1246.1">
      <img alt="Figure 8.6 – GitHub Actions jobs showing builds on Node.js 20 and 22" src="image/B19212_08_06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1247.1">
     Figure 8.6 – GitHub Actions jobs showing builds on Node.js 20 and 22
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1248.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1249.1">
      runs-on: ubuntu-latest
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1250.1">
     step specifies that the job should run on the latest available version of Ubuntu.
    </span>
    <span class="koboSpan" id="kobo.1250.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1251.1">
      matrix.node-version
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1252.1">
     is initially set to test on Node.js 20, but it’s extended to also include Node.js 22, demonstrating how easily additional versions can be incorporated into the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1253.1">
      testing strategy.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1254.1">
     Following the environment
    </span>
    <a id="_idIndexMarker671">
    </a>
    <span class="koboSpan" id="kobo.1255.1">
     setup, the workflow includes steps to check out the code, setup Node.js, install dependencies, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1256.1">
      run tests:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1257.1">
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
    - run: node --test</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1258.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1259.1">
      actions/checkout@v4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1260.1">
     step checks out the repository contents into the GitHub Actions runner, allowing the workflow to access the code.
    </span>
    <span class="koboSpan" id="kobo.1260.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1261.1">
      actions/setup-node@v4
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1262.1">
     step configures the runner to use a specific version of Node.js as defined by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1263.1">
      the matrix.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1264.1">
     By integrating these steps, the GitHub Actions
    </span>
    <a id="_idIndexMarker672">
    </a>
    <span class="koboSpan" id="kobo.1265.1">
     workflow automates the testing process, ensuring that all new code integrated into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1266.1">
      main
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1267.1">
     branch has passed through a rigorous testing process.
    </span>
    <span class="koboSpan" id="kobo.1267.2">
     This not only ensures code quality but also helps in identifying issues early in the development cycle, making it easier to manage and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1268.1">
      fix them.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1269.1">
     GitHub branch protection
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1270.1">
     It’s possible to configure GitHub to block PRs until they have a passing build/CI run.
    </span>
    <span class="koboSpan" id="kobo.1270.2">
     This can be configured in the settings of your GitHub repository.
    </span>
    <span class="koboSpan" id="kobo.1270.3">
     For information
    </span>
    <a id="_idIndexMarker673">
    </a>
    <span class="koboSpan" id="kobo.1271.1">
     on how to configure branch protection, refer
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1272.1">
      to
     </span>
    </span>
    <a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1273.1">
       https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1274.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1275.1">
     GitHub Actions, as with the alternative CI providers, offers a powerful and flexible platform for automating workflows across a wide range of development tasks.
    </span>
    <span class="koboSpan" id="kobo.1275.2">
     While this tutorial focused on setting up a CI workflow for a typical Node.js application, the scope of GitHub Actions extends far beyond this, allowing for a multitude of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1276.1">
      complex workflows.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-266">
    <a id="_idTextAnchor273">
    </a>
    <span class="koboSpan" id="kobo.1277.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1278.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1279.1">
       Testing with node:test
      </span>
     </em>
     <span class="koboSpan" id="kobo.1280.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1281.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1282.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1283.1">
       Scaffolding a module
      </span>
     </em>
     <span class="koboSpan" id="kobo.1284.1">
      recipe in
     </span>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1285.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
  </div>
 </body></html>