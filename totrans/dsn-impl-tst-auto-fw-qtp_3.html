<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Basic Building Blocks for Creating Frameworks</h1></div></div></div><p>In the previous chapter, we have seen which QTP features are required to create scripts. To design a framework and its components we need to design reusable code blocks, apart from QTP features. The key features of code blocks are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Manual checkpoint</strong>: This is a reusable function that <a id="id177" class="indexterm"/>checks whether the property is matching as expected at runtime</li><li class="listitem" style="list-style-type: disc"><strong>Manual synchronization</strong>: This is a reusable function that waits up to a specified time for the property to change</li><li class="listitem" style="list-style-type: disc"><strong>Descriptive programming</strong>: This provides the object identification property in test scripts to create the object description or creates the description itself</li><li class="listitem" style="list-style-type: disc"><strong>Regular expression</strong>: This is a text string for matching a pattern and allows us to define objects that follow the pattern</li><li class="listitem" style="list-style-type: disc"><strong>Error handling with Err object and Exit statements</strong>: Also known as exception handling, it guides us on how to come out of exceptional events and gracefully exit these conditions</li><li class="listitem" style="list-style-type: disc"><strong>Functions, subroutines, and procedures</strong>: Functions and subprocedures allow  us to make scripts modular and reusable</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec17"/>VBScript – key features for creating code blocks</h1></div></div></div><p>VBScript is<a id="id178" class="indexterm"/> an easy-to-learn yet powerful scripting language. It is used to develop scripts to perform both simple and complex object-based tasks, even without previous programming experience. While working in the <strong>Expert</strong> view, use the following general VBScript syntax rules and guidelines:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Case sensitivity</strong>: VBScript does<a id="id179" class="indexterm"/> not differentiate between uppercased and lowercased words. It is not case sensitive by default, for example, in constant, variable, object, and method names. The<a id="id180" class="indexterm"/> following two statements are identical:<div><pre class="programlisting">Browser("Customer").page("Customer").weblist("date").select "31"
Browser("Customer").page("Customer").WebList("date").Select "31"</pre></div></li><li class="listitem" style="list-style-type: disc"><strong>Text strings</strong>: We can define a string <a id="id181" class="indexterm"/>by adding double quotes<a id="id182" class="indexterm"/> before and after the text string.<a id="id183" class="indexterm"/> In the following example, the string value is assigned using double quotes:<div><pre class="programlisting">Dim objtype= "WinButton" or objtype= "WinButton"</pre></div><p>
<strong>Date strings</strong>: We can define the date by adding hash marks before and after the date value; for example:</p><div><pre class="programlisting">today = #7/10/2013#   or  Dim today = #7/10/2013#</pre></div></li><li class="listitem" style="list-style-type: disc"><strong>Variables</strong>: Variables are used to store strings, integers, dates, arrays, and objects. We can specify <a id="id184" class="indexterm"/>variables to refer to test objects or store simple values with or without using <code class="literal">Dim</code>. If used, the <code class="literal">Option Explicit</code> statement must appear in a script before any other statements. When the <a id="id185" class="indexterm"/>Option Explicit statement is declared, it forces us to explicitly declare variables using the <code class="literal">Dim</code>, <code class="literal">Private</code>, <code class="literal">Public</code>, or <code class="literal">ReDim</code> statements; otherwise, an error occurs.<p>To specify a variable to refer to an object, use the <code class="literal">Set</code> statement with the following syntax:</p><div><pre class="programlisting">
<strong>Set</strong> ObjectVar = ObjectHierarchy 
Set UserEditBox = Browser("email").Page("email").WebEdit("username") 
UserEditBox.Set "John" </pre></div><p>Don't use the <code class="literal">Set</code> statement to specify a variable that contains a simple value (such as a string or number). The example that follows shows us how to define a variable for a simple value:</p><div><pre class="programlisting">MyVar = Browser("email").Page("email").WebEdit("username").GetTOProperty("text")  </pre></div><p>Or it can also be defined as:</p><div><pre class="programlisting">Dim Myvar = Browser("email").Page("email").WebEdit("username").GetTOProperty("text")  </pre></div></li><li class="listitem" style="list-style-type: disc"><strong>Comments</strong>: Type <code class="literal">rem</code> or use<a id="id186" class="indexterm"/> an apostrophe (<code class="literal">'</code>) to add <a id="id187" class="indexterm"/>comments.</li><li class="listitem" style="list-style-type: disc"><strong>Spaces</strong>: Spaces are ignored by <a id="id188" class="indexterm"/>VBScript; they just<a id="id189" class="indexterm"/> enhance the clarity and readability of the code.</li><li class="listitem" style="list-style-type: disc"><strong>Parentheses</strong>: If the called function<a id="id190" class="indexterm"/> returns a value, use parentheses around the arguments.<p>The following<a id="id191" class="indexterm"/> example requires parentheses around the method arguments since it returns a value:</p><div><pre class="programlisting">Set WebEditObj = Browser("Mercury").Page("Mercury").WebTable("table").ChildItem (8, 2, "WebEdit", 0) 
WebEditObj.Set "name" </pre></div><p>The following example requires parentheses around method arguments, since <strong>Call</strong> is being used:</p><div><pre class="programlisting">Call RunAction("BookFlight", oneIteration) </pre></div><p>The following example requires parentheses around the method arguments since they return the value of the checkpoint:</p><div><pre class="programlisting">result = Browser("Customer").Page("Customer").Check (CheckPoint("MyProperty")) </pre></div><p>The following example does not require parentheses around the <code class="literal">Click</code> method arguments since they don't return any values:</p><div><pre class="programlisting">Browser("Mercury Tours").Page("Method of Payment").WebTable("FirstName").Click </pre></div></li></ul></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec26"/>VBScript procedures</h2></div></div></div><p>In VBScript,<a id="id192" class="indexterm"/> there are two types of procedures:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Subprocedures</li><li class="listitem" style="list-style-type: disc">Function procedures</li></ul></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec28"/>Subprocedures</h3></div></div></div><p>A subprocedure<a id="id193" class="indexterm"/> starts with the <code class="literal">Sub</code> statement and ends <a id="id194" class="indexterm"/>with the <code class="literal">End Sub</code> statement. <code class="literal">Sub</code> accepts arguments and does not return a value. An example is shown in the following code snippet:</p><div><pre class="programlisting">Sub subSUM(a,b)
  print a+b
End Sub</pre></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec29"/>Function procedures</h3></div></div></div><p>A function procedure<a id="id195" class="indexterm"/> starts with the <code class="literal">Function</code> statement and ends with the <code class="literal">End Function</code> statement. It can return a value; the return value is always a variant. To return the value, assign it to the function name. An example of the<a id="id196" class="indexterm"/> function procedure is shown as follows:</p><div><pre class="programlisting">Function funcSUM(a,b)
FuncSUM = a+b
End Function</pre></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec18"/>Checkpoints</h1></div></div></div><p>A checkpoint<a id="id197" class="indexterm"/> checks the specific values or characteristics of a page, object, or text string and enables the test object to identify whether the AUT is functioning correctly. A checkpoint compares the expected value (captured at the time of recording or creating the checkpoint) with the actual value (captured at runtime).</p><p>The following script creates the order using the Flight application; after selecting the <code class="literal">FlyFrom insert</code> checkpoint, we need to verify whether the <strong>FLIGHT</strong> button's <strong>enabled</strong> property is set to <strong>True</strong>:</p><div><img src="img/1027EN_03_01.jpg" alt="Checkpoints"/></div><div><pre class="programlisting">Window("WinFlight").Activate
Window("WinFlight").ActiveX("MaskEdBox").Type "111114"
Window("WinFlight").WinComboBox("FlyFrom:").Select "Frankfurt"
'Insert a checkpoint to verify if button is enabled or not
Window("WinFlight").WinButton("FLIGHT").Check CheckPoint("WINFLIGHT")
'In the preceding checkpoint verify if button is enabled or not
isChkPointPass= Window("WinFlight").WinButton("FLIGHT").Check (CheckPoint("FLIGHT"))
'Note: We have used the bracket around Checkpoint to get the outcome
If isChkPointPass = True Then
  'Continue with order of creation
  Window("WinFlight").WinComboBox("FlyTo:").Select "Paris"
Window("WinFlight").WinButton("FLIGHT").Click
Window("WinFlight").Dialog("FlightsTable").WinButton("WinOK").Click
Window("WinFlight").WinEdit("Name:").Set "ashish"
Window("WinFlight").WinButton("Insert Order").Click
  Else
      'Leave the action if a checkpoint fails
  ExitAction
End If</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Output value</h1></div></div></div><p>An <strong>output value</strong> is a <a id="id198" class="indexterm"/>value that is<a id="id199" class="indexterm"/> retrieved during the test execution from DataTable or saved in a variable or parameter. When the output value is executed, the <code class="literal">Output</code> method places the object's property value into the prespecified column (which is defined when the test was created) and is retrieved through the DataTable. Later, this value is used to verify the expected and actual value; thus, we can use the output value as a checkpoint.</p><p>The following code snippet creates a checkpoint using the output values:</p><div><pre class="programlisting">Window("WinFlight").Activate
Window("WinFlight").ActiveX("MaskEdBox").Type "111114"
Window("WinFlight").WinComboBox("FlyFrom:").Select "Frankfurt"
'Insert an output value to verify if button is enabled or not
Window("WinFlight").WinButton("FLIGHT"). Output CheckPoint("FLIGHT")
'The first column represents from where value is retrieved and the second column represents sheet Global/local
outval= Datatable("WINFLIGHT_Button",dtGlobalSheet)
'Verify the expected and actual values and report them in test results using reporter.reportevent
If   outval = True Then
  Reporter.ReportEvent micPass,"Verify WinFlight Button", "Match"
  else
  Reporter.ReportEvent micFail,"Verify WinFlight Button", "The property value does not match with the expected value"
ExitAction
End If</pre></div><p>We can create a manual checkpoint using the <code class="literal">CheckProperty</code> method as well. <code class="literal">CheckProperty</code> allows us to use various options, and we can check the not equal condition as well.</p><p>How to check an equal condition using <code class="literal">CheckProperty</code>:</p><div><pre class="programlisting">Window("WinFlight").WinButton("FLIGHT").CheckProperty( "enabled", True, 10000)</pre></div><p>Checkpoints allow the following options to<a id="id200" class="indexterm"/> ascertain various unequal options:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">micGreaterThan</code>: This option verifies<a id="id201" class="indexterm"/> whether the value of the property is greater than the expected value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">micLessThan</code>: This option verifies <a id="id202" class="indexterm"/>whether the value of the property is less than the expected value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">micGreaterThanOrEqual</code>: This <a id="id203" class="indexterm"/>option verifies whether the value of the property is greater than or equal to the expected value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">micLessThanOrEqual</code>: This option verifies<a id="id204" class="indexterm"/> whether the value of the property is less than or equal to the expected value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">micNotEqual</code>: This <a id="id205" class="indexterm"/>option verifies whether the value of the property is not equal to the expected value.<p>The following example demonstrates how to use the not equal option:</p><div><pre class="programlisting">Window("WinFlight").WinComboBox("FlyTo:").CheckProperty("items count", micGreaterThanOrEqual(10), 10000)</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">micRegExpMatch</code>: The <code class="literal">CheckProperty</code> also allows us to use regular expressions. The <code class="literal">micRegExpMatch</code> option verifies if the property value matches with the regular expression, <a id="id206" class="indexterm"/>as shown in the following example, and how to use the regular expression with <code class="literal">CheckProperty</code>:<div><pre class="programlisting">Window("WinFlight").WinEdit("Order No:").CheckProperty ("text",micRegExpMatch("\d{1,3}"),10000) 
Creating checkpoint using GetROProperty</pre></div><p>
<code class="literal">GetROProperty</code> returns the current value of the specified identification property from the runtime object in the AUT. We can use the <code class="literal">GetROProperty</code> to create the checkpoint. Using this checkpoint, we will get the runtime property, and we can compare it with the expected<a id="id207" class="indexterm"/> value as shown in the following example:</p><div><pre class="programlisting">Required. A String value. Property to retrieve from the object. Required. A String value. Property to retrieve from the object. 
'We are retrieving the value of enable property of the FLIGHT Button and comparing it with expected value thus serves as a check to take a further action
Pvalue =Window("WinFlight").WinButton("FLIGHT").GetRoProperty("enabled")
If Pvalue = True Then
  'Create the order
  Else
'Exit the Test 
  ExitTest
End If</pre></div></li></ul></div><p>When we<a id="id208" class="indexterm"/> design the framework and its components, we need to create manual checkpoints for reusability; a good practice is to create them as reusable functions.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Synchronization</h1></div></div></div><p>QTP and AUT join or handshake at a certain point to match up their speeds for the event to occur in order to accomplish a certain sequence of action.</p><p>Speed mismatch, delays, <a id="id209" class="indexterm"/>the wait for property to change, change of object, and occurrence of an event causes mismatch in the speed of execution of scripts, and AUT causes synchronization issues, for example, script has to wait until the page is loaded. The default object synchronization is 20 seconds but we can change it by navigating to <strong>File</strong> | <strong>Test Settings</strong> | <strong>Run</strong> | <strong>Object synchronization timeout</strong>.</p><p>Change the <strong>Object synchronization timeout</strong> from <strong>20</strong> seconds to <strong>2</strong> seconds as shown in the following screenshot:</p><div><img src="img/1027EN_03_02.jpg" alt="Synchronization"/></div><p>Now that we<a id="id210" class="indexterm"/> have changed the <strong>Object synchronization timeout</strong> value, we will run the following script:</p><div><pre class="programlisting">'Open the Flight Reservation login window and create the script
Dialog("DialogLogin").WinEdit("AgentName").Set "ashish"
Dialog("DialogLogin").WinEdit("AgentPassword").SetSecure "51d84ff2108dc473a416b19e1fed478fab95ca75"
Dialog("DialogLogin").WinButton("WinOK").Click
'The script will fail at this step, the object synchronization is 2 seconds but window takes more time to open; hence script fails
Window("WinFlight").Activate</pre></div><p>To achieve synchronization, we introduce some wait scripts that wait for the specified time. Refer to the following code snippet:</p><div><pre class="programlisting">Dialog("DialogLogin").Activate
Dialog("DialogLogin").WinEdit("AgentName").Set "ashish"
Dialog("DialogLogin").WinEdit("AgentPassword").SetSecure "51d84ff2108dc473a416b19e1fed478fab95ca75"
Dialog("DialogLogin").WinButton("WinOK").Click
'The script will fail at this step. To avoid this, insert a wait statement
wait 10'Window("WinFlight").Activate</pre></div><p>The <code class="literal">wait</code> statement tells QTP to wait for a predefined amount of time, for example, 10 seconds. Here, the following situations can arise:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The AUT is ready to perform the next step, but the script is still waiting till the specified time</li><li class="listitem" style="list-style-type: disc">The wait time is over and the AUT is still not ready for the next step to be executed</li></ul></div><p>In both of these<a id="id211" class="indexterm"/> conditions, static wait is not a good option. Waiting for an appropriate amount of time based on some property or event that has to be completed is called dynamic synchronization.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec27"/>Dynamic synchronization</h2></div></div></div><p>Dynamic synchronization<a id="id212" class="indexterm"/> allows waiting till <a id="id213" class="indexterm"/>the object property is changed or till time out, as shown in the following example:</p><div><pre class="programlisting">Window("WinFlight").ActiveX("MaskEdBox").Type "111114"
Window("WinFlight").WinComboBox("FlyFrom:").Select "Frankfurt"
Window("WinFlight").WinComboBox("FlyTo:").Select "Los Angeles"
Window("WinFlight").WinButton("FLIGHT").Click
Window("WinFlight").Dialog("FlightsTable").WinButton("WinOK").Click
Window("WinFlight").WinEdit("Name:").Set "ashish"
Window("WinFlight").WinButton("Insert Order").Click
'Window("WinFlight").WinButton("Button").Click
'When QTP tries to execute the following statement, application will not allow to click on the button since it is waiting for progress bar to reach 100% and display the message Insert Done...
'Here script will fail
'We need  to insert the dynamic synchronization point; this waits until the text changes to Insert Done...
'Window("WinFlight").ActiveX("ThreedPanelControl").WaitProperty "text", "Insert Done...", 10000</pre></div><p>The <code class="literal">WaitProperty</code>
<a id="id214" class="indexterm"/> can be inserted using Insert synchronization point or we can manually add the <code class="literal">WaitProperty</code> method by typing it.</p><p>Apart from using <code class="literal">WaitProperty</code>, we can also create synchronization points using the following code:</p><div><pre class="programlisting">Set Object = Window("WinFlight").ActiveX("ThreedPanelControl")
Set WinsObject = Window("WinFlight")
'It accepts the object with its property and value. You have to wait along with timeout
Function ManualSyncPoint (Object,propertyname, propertyval,timeout )
   Do 
  If Object.GetROProperty(propertyname)  =propertyval then
'if propertyname and propertyval match, come out of the loop and execute next step
      Exit Do
  else
       wait(1)
end if 
   Loop While (i &lt;= timeout)
End Function
'In the preceding method we have used the static wait; we can implement it without using wait statement as well
Example 2:
Function ManualSyncPoint2(Object ,propertyname, propertyval, timeout )
   sttimer = Timer
'Timer allows to get the number of seconds elapsed since midnight (12:00 AM)
   Do 
   If Object.GetROProperty(propertyname)  = propertyval then
Exit Do
  else
      end if 
        endtimer = Timer
    'The difference between the two timer objects provides the number of seconds we need to determine for timeout
   Loop While ( int (endtimer-sttimer) &lt;= -timeout)
 End Function
'Function that allows to wait till object exists
Function WaitTillExists(Object, timeout )
loadtimer = Timer
 Do
      isObjectExists = Object.Exist
  If isObjectExists = true Then
  Exit Do
    else
  End If
    completetimer = Timer
 Loop While(completetimer-loadtimer  &lt;= timeout)
End Function
'Now we will use these functions in our scripts; refer to the following script
Dialog("DialogLogin").Activate
Dialog("DialogLogin").WinEdit("AgentName").Set "ashish"
Dialog("DialogLogin").WinEdit("Password").SetSecure "51d84ff2108dc473a416b19e1fed478fab95ca75"
Dialog("DialogLogin").WinButton("WinOK").Click
' wait
'Go to the test settings and make object synchronization time to 2 sec
WaitTillExists WinsObject, 10
Window("WinFlight").Activate
Window("WinFlight").ActiveX("MaskEdBox").Type "111114"
Window("WinFlight").WinComboBox("FlyFrom:").Select "Frankfurt"
Window("WinFlight").WinComboBox("FlyTo:").Select "Los Angeles"
Window("WinFlight").WinButton("FLIGHT").Click
Window("WinFlight").Dialog("FlightsTable").WinButton("WinOK").Click
Window("WinFlight").WinEdit("Name:").Set "ashish"
Window("WinFlight").WinButton("Insert Order").Click
Window("WinFlight").WinButton("Button").Click
'When QTP tries to execute the following statement, the application will not allow to click on the button since it is waiting for progress bar to reach 100% and display the message Insert Done...
'Here script will fail
'We need to insert the dynamic synchronization point
Window("WinFlight").ActiveX("ThreedPanelControl").WaitProperty "text", "Insert Done...", 5000

'The preceding statement waits till the text property changes to Insert Done... and waits for upto 10 secs
 If ManualSyncPoint1(Object ,"text","Insert Done…",10)  = true then
   'do nothing
  else 
  ExitTest
  end if
Window("WinFlight").WinButton("Button").Click</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Descriptive programming</h1></div></div></div><p>QTP identifies<a id="id215" class="indexterm"/> an object by its properties<a id="id216" class="indexterm"/> that are stored in the OR. When the object description is created in the test script, the approach is called descriptive programming. In this method of script<a id="id217" class="indexterm"/> creation, objects are not stored in the OR.</p><p>Descriptive programming can be achieved in two ways:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Static programming</strong>: The object's <a id="id218" class="indexterm"/>description is directly provided into the script</li><li class="listitem" style="list-style-type: disc"><strong>Dynamic programming</strong>: The<a id="id219" class="indexterm"/> object's description is created using QTP's description object</li></ul></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Static programming</h2></div></div></div><p>Examples of static<a id="id220" class="indexterm"/> descriptive programming are shown as follows:</p><div><pre class="programlisting">'Add object description as property value pair
Dialog("regexpwndclass:=Login").Activate
Dialog("regexpwndclass:=Login").WinEdit("regexpwndclass:=Edit","attached text:=AgentName").Set "ashish"
Dialog("regexpwndclass:=Login").WinEdit("regexpwndclass:=Edit","attached text:=AgentPassword").Set "mercury"
Dialog("regexpwndclass:=Login").WinButton("regexpwndtitle:=OK").Click
'The multiple property and value pair is provided in the object description; property value pair should be comma separated

Method 2: Define Description as constant
Note:
Constant represents the literal value and gives it a name that is not allowed to change at time of script execution. Declare constants for use in place of literal values. For example, Const Env = "QA"
Define Constant
Name of the constant and expression; expression is Literal or another constant, or any combination that includes all arithmetic or logical operators
Constant can be declared as Public or Private. A variable that is declared as a constant is available to all procedures in all scripts. Not allowed in procedures. The Private keyword is used at script level to declare constants available only within the script where the declaration is made. Not allowed in procedures
Const Dailoglogin ="regexpwndtitle:=Login"
Const agent = "attached text:=AgentName"
Const password = "attached text:=Password:"
Const okButton ="text:=OK"

Dialog(Dialoglogin).Activate
Dialog(Dialoglogin).WinEdit(agent).Set "ashish"
Dialog(Dialoglogin).WinButton(okButton).Click

Method 3: Substitution of property values shown as follows

dialogname ="login"
agentname ="AgentName"
passwdname ="Password:"
buttonlabel="OK"

Dialog("regexpwndtitle:="&amp;dialogname).Activate
Dialog("regexpwndtitle:="&amp;dialogname).WinEdit("attached text:="&amp;agentname).Set "ashish"
Dialog("regexpwndtitle:="&amp;dialogname).WinEdit("attached text:="&amp;passwdname).Set "mercury"
Dialog("regexpwndtitle:="&amp;dialogname).WinButton("text:="&amp; buttonlabel).Click</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec29"/>Dynamic programming</h2></div></div></div><p>QTP allows the<a id="id221" class="indexterm"/> use of the <code class="literal">Description</code> object and its <code class="literal">Create</code> method to create the object description and pass it as an argument to create the scripts.</p><p>The following is an example of the same:</p><div><pre class="programlisting">Set diaDesc = Description.Create()
diaDesc("micclass").value="Dialog"
diaDesc("regexpwndtitle").Value ="Login"

Set btnDesc=Description.Create()
btnDesc("micclass").value="WinButton"
btnDesc("text").value="OK"

Set txtDesc = Description.Create()
txtDesc("micclass").value="WinEdit"
txtDesc("attached text").Value ="AgentName"

Set pwdDesc = Description.Create()
pwdDesc("micclass").value="WinEdit"
pwdDesc("attached text").Value ="Password:"

'Use these objects into the scripts shown as follows

Dialog(diaDesc).Activate
Dialog(diaDesc).WinEdit(txtDesc).Set "ashish"
Dialog(diaDesc).WinEdit(pwdDesc).Set "mercury"
Dialog(diaDesc).WinButton(btnDesc).Click</pre></div><p>The test objects that have the same identification properties are called <strong>duplicate objects</strong>
<a id="id222" class="indexterm"/>. Ordinal identifiers allow us to identify duplicate objects using the <code class="literal">index</code> and <code class="literal">location</code> properties. <code class="literal">index</code> represents the order of the objects from left to right and top to bottom. <code class="literal">location</code> represents the objects from top-left to bottom and top-right to bottom.</p><div><pre class="programlisting">'Ordinal Identifier stats with 0
Browser("email").Page("email").WebEdit("name:=FNAME", "index:=0").Set "Ashish1"
Browser("email").Page("email").WebEdit("name:=FNAME", "index:=1").Set "Ashish2"
Browser("email").Page("email").WebEdit("name:=FNAME", "index:=2").Set "Ashish3"
Browser("email").Page("email").WebEdit("name:=FNAME", "index:=3").Set "Ashish4"
</pre></div><p>The outcome after we run the script is as follows:</p><div><img src="img/1027EN_03_03.jpg" alt="Dynamic programming"/></div><div><pre class="programlisting">Browser("email").Page("email").WebEdit("name:=FNAME", "location:=0").Set "Ashish1"
Browser("email").Page("email").WebEdit("name:=FNAME", "location:=1").Set "Ashish2"
Browser("email").Page("email").WebEdit("name:=FNAME", "location:=2").Set "Ashish3"
Browser("email").Page("email").WebEdit("name:=FNAME", "location:=3").Set "Ashish4"
</pre></div><p>The outcome after we run the script is as follows</p><div><img src="img/1027EN_03_04.jpg" alt="Dynamic programming"/></div><p>Descriptive programming allows us to deal with dynamic objects; this is a situation where the test object<a id="id223" class="indexterm"/> does not exist till runtime, so we cannot store the dynamic objects in the OR. For example, a textbox is generated based on the user ID in the web page at runtime and the name of the object follows the convention edit_xxx, that is, edit_123455. </p><p>The code is provided on the preceding page; now we will write the code to set the value as shown in the following code snippet:</p><div><pre class="programlisting">Code = getCode() ' getCode is a function that's return the code given in previous page, we can use that code to create the object description for webEdit
Browser("email").Page("email").WebEdit("name:=text_"&amp;Code).Set "jonh"</pre></div><p>One use of descriptive programming is that it allows us to find the object(s) at runtime and performs the<a id="id224" class="indexterm"/> following operations on it/them:</p><div><pre class="programlisting">Set buttonDesc=Description.Create()
buttonDesc("micclass").value="WinButton"
Set winAll=Window("regexpwndtitle:=Flight Reservation").ChildObjects(buttonDesc)
cnt=winAll.count
MsgBox "Total number of Buttons: "&amp;cnt
For i=0 to cnt-1
  MsgBox winAll(i).getroproperty("text")
   If  winAll(i).Getroproperty("text")="FLIGHT" Then
  winAll(i).Click
    End If
Next</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Regular expressions</h1></div></div></div><p>A regular expression (abbreviated regex or regexp) is a sequence of text characters, some of which are understood to be meta characters with symbolic meaning and some of which have their literal meaning, that together automatically identify a given pattern.</p><p>A regular expression <a id="id225" class="indexterm"/>is very useful when the objects are dynamic in nature and we cannot store each and every object which follows a pattern in the OR. In the Flight Reservation application, we can open any existing order by the order number and send the fax. When the <strong>Fax</strong> window is opened, the title of the window contains the order number; this will cause an issue when we want to open the fax window with a different order number as the window is no longer the same. In this condition, we can use regular expression. Refer to the following screenshot; the identification property of the object is <strong>Fax Order No. 11</strong>. Here we convert the <strong>text</strong> property into a regular expression to identify the property as a pattern and not a fixed value. </p><p>The regular expression shown in the following screenshot matches a pattern where the number of digits may vary from <strong>1</strong> to <strong>3</strong>. This means that it is used to verify the <strong>Fax</strong> window title from 0 to 999.</p><div><img src="img/1027EN_03_05.jpg" alt="Regular expressions"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec30"/>Regular expressions in descriptive programming</h2></div></div></div><p>In the earlier<a id="id226" class="indexterm"/> screenshot, we have seen that once we change the <strong>text</strong> property to the regular expression, QTP is able to identify <a id="id227" class="indexterm"/>objects with order numbers from 0 to 999. We can use the regular expression in object description as shown in the following code:</p><div><pre class="programlisting">Window("WinFlight").Dialog("regexpwndclass:=#32770", "text:=Fax Order No\. \d{1,3}").Activex("progid:=MSMask.MaskEdBox.1").Type "1111111111"</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec31"/>Regular expressions in checkpoints</h2></div></div></div><p>A checkpoint allows us to <a id="id228" class="indexterm"/>use the regular expression<a id="id229" class="indexterm"/> for matching the pattern. To use the regular expression in a checkpoint, do the following:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on <strong>Parameter Options</strong> in the <strong>Text Checkpoint Properties</strong> window.</li><li class="listitem">
Click on <img src="img/1027EN_03_icon.jpg" alt="Regular expressions in checkpoints"/>.
</li><li class="listitem">Check the <strong>Regular expression</strong> option in <strong>Parameter Options</strong>.</li><li class="listitem">Click on <strong>OK</strong> and change the parameter to regular expressions (in <strong>DataTable</strong>) <a id="id230" class="indexterm"/>as shown in the following<a id="id231" class="indexterm"/> screenshot.</li></ol></div><div><img src="img/1027EN_03_06.jpg" alt="Regular expressions in checkpoints"/></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec32"/>Regular expressions in CheckProperty</h2></div></div></div><p>
<code class="literal">CheckProperty</code> allows us to compare the values using regular expressions and <code class="literal">micRegExpMatch</code> as shown in the following code snippet:</p><div><pre class="programlisting">'Verify whether the order number is numeric
Window("WinFlight").WinEdit("Order No:").CheckProperty ("text",micRegExpMatch("\d{1,3}"),10000) </pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Error handling</h1></div></div></div><p>Exception <a id="id232" class="indexterm"/>handling is the way to deal with abnormal or exceptional events that interrupt the normal flow of test execution. For example, when<a id="id233" class="indexterm"/> a floating point number is divided by zero (0), it stops execution and an error message is displayed as shown in the following piece of code:</p><div><pre class="programlisting">Type in the QTP editor   
Result = 5 / 0
'When test runs the preceding line, it will display Error Division by zero</pre></div><p>The <code class="literal">Err</code> object in VBScript holds the details of the runtime errors, allowing continued execution despite a runtime error.</p><p>If the <code class="literal">On Error Resume Next</code> statement is absent in the script, any runtime error will stop execution and display the error message as shown:</p><div><pre class="programlisting">On Error Resume Next
Result = 5 / 0 
'The above line will not display any error</pre></div><p>Using the <code class="literal">On Error Resume Next</code> statement allows us to continue with the exception, but it is<a id="id234" class="indexterm"/> necessary to deal with the error using the <code class="literal">Err</code> object and come out clean from the erroneous condition.</p><p>The properties <a id="id235" class="indexterm"/>of the <code class="literal">Err</code> object are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Description</code> <a id="id236" class="indexterm"/>property</li><li class="listitem" style="list-style-type: disc"><code class="literal">HelpContext</code> property</li><li class="listitem" style="list-style-type: disc"><code class="literal">HelpFile</code> property</li><li class="listitem" style="list-style-type: disc"><code class="literal">Number</code> property</li><li class="listitem" style="list-style-type: disc"><code class="literal">Source</code> property</li></ul></div><p>The methods of the <code class="literal">Err</code> object are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Clear</code> method</li><li class="listitem" style="list-style-type: disc"><code class="literal">Raise</code> method</li></ul></div><div><pre class="programlisting">On Error Resume Next 'Enables the Err object to deal with error
'Raise an overflow error.
Err.Raise 6   
MsgBox "Error number is" &amp; CStr(Err.Number) &amp; "--" &amp; Cstr(Err.Description))
'Clear the error.
Err.Clear   </pre></div><p>Use <code class="literal">On Error GoTo 0</code> to disable error handling if <code class="literal">On Error Resume Next</code> has been used.</p><p>Examples are shown in the following code snippet of how to use the <code class="literal">Err</code> object for error handling:</p><div><pre class="programlisting">On Error Resume Next
Const ForReading = 1
Dim fso, theFile, retstring
   Set fileso = CreateObject("Scripting.FileSystemObject")
   Set theFile = fileso.OpenTextFile("c:\FilenotFound.txt", ForReading)
'Verify if error number of the Err object using its property number
   If Err.number &lt;&gt; 0 then
   'Error send there is no file exists by FilenotFound.txt   
  MsgBox Cstr(Err.number &amp; "--"&amp;  Cstr(Err.Description)
   ExitAction(-1)
else
  'Do While   theFile.AtEndOfStream &lt;&gt; True
Do until   theFile.AtEndOfStream 
      str = theFile.ReadLine()
      MsgBox str
  Loop
   theFile.Close
  end if</pre></div><p>The <code class="literal">Exit</code>
<a id="id237" class="indexterm"/> statements in QTP are very important; they allow us to gracefully exit from loops, actions, iterations, components, and tests.</p><p>The<a id="id238" class="indexterm"/> different types of <code class="literal">Exit</code> statements are shown as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Exit Do</code>: This statement allows us to exit a <code class="literal">Do</code> loop statement.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Exit For</code>: This statement allows us to exit a <code class="literal">For</code> loop.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Exit Function</code>: This statement allows us to exit the <code class="literal">Function</code> procedure in which it is called.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Exit Property</code>: This statement allows us to exit the <code class="literal">Property</code> procedure.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Exit Sub</code>: This allows statement us to exit the <code class="literal">Sub</code> procedure in which it is called.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ExitAction</code>: This statement allows us to exit from the current iteration of an action.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ExitTest</code>: This statement allows us to exit the entire QTP or<a id="id239" class="indexterm"/> <strong>Quality Centre</strong> (<strong>QC</strong>) business process test, regardless of the runtime iteration settings.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ExitTestIteration</code>: This statement allows us to exit the test iteration or QC's business process test and moves on to the next iteration. If there is no next iteration, it stops execution.</li></ul></div><p>The return value of <code class="literal">ExitActionIteration</code> is displayed in the <strong>Run Result</strong> window.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ExitComponent</code>: This statement allows us to exit the current component run.<p>In <a id="id240" class="indexterm"/>
<strong>Business Process Testing</strong> (<strong>BPT</strong>), each component (scripted or business) is the same as a QTP Test with a single action. A business process runs each component one by one. QC loads the component in QTP and starts the run. Once the run is complete, the next component in the test is loaded, and all the results are collated into a single test result summary.</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">ExitComponentIteration</code>: This statement allows<a id="id241" class="indexterm"/> us to exit the current component iteration.</li></ul></div><p>The following example demonstrates the use of the <code class="literal">Exit</code> statement(s) if the checkpoint fails:</p><div><pre class="programlisting">res = Browser("Mercury").Page("Mercury").WebEdit("userName").Check ( CheckPoint("Name") ) 
If res = False Then 
'ExitActionIteration /ExitAction / /ExitTestIteration /ExitTest /ExitComponentIteration /ExitComponent
'We can use any one of them to gracefully exit based on how test is executing.
End If </pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Recovery scenarios – an overview</h1></div></div></div><p>Any unexpected event or erroneous condition that crashes the AUT during execution needs to be recovered. To handle these situations, QTP allows us to define the recovery scenarios and associates them with the test. Recovery scenarios activate specific recovery operations when trigger events occur.</p><p>The recovery scenario manager allows us to define the recovery scenario, that includes an unexpected event and the operations to recover during a run session. For example, an unexpected pop-up message appears and the recovery scenario is recovered from it by clicking on the <strong>OK</strong> <a id="id242" class="indexterm"/>button in the pop up.</p><p>A recovery scenario has the following elements:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Trigger event</strong>: Any event that<a id="id243" class="indexterm"/> abruptly interferes with the normal flow of the test runs, for example, a dialog pops up during test execution.</li><li class="listitem" style="list-style-type: disc"><strong>Recovery operations</strong>: The recovery<a id="id244" class="indexterm"/> option allows QTP to continue running the test or its components after the trigger event hampers test execution. For example, closing the pop-up window or a call to restart the window.</li><li class="listitem" style="list-style-type: disc"><strong>Post</strong>-<strong>recovery option</strong>: QTP provide<a id="id245" class="indexterm"/> options after the recovery operations have been executed, for example, calling a custom function, executing the same step, or executing the next step in the test or component.</li></ul></div><p>After recovery scenarios are created, we can associate them with selected components/tests. So, QTP will perform the appropriate scenarios during the run sessions if a trigger event occurs.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Summary</h1></div></div></div><p>In this chapter we have gone through various concepts and code blocks. The key is to understand that apart from the QTP features, we need other components that support the entire design and architecture of the framework. One of the key aspects for creating code blocks is to enhance the reusability and create an impact on every feature of designing the framework. The next chapter will talk about designing and implementing the test automation framework.</p></div></body></html>