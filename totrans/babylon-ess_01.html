<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Babylon.js and the TypeScript Language"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Babylon.js and the TypeScript Language</h1></div></div></div><p>Babylon.js is a framework that allows you to create complete 3D applications and 3D video games for the Web. Babylon.js has a community that grows day after day; a community that actively contributes to the project, adding more and more features. This chapter gives you a brief introduction to the framework's vision and the TypeScript language as, Babylon.js was developed using this.</p><p>The Babylon.js framework embeds all the necessary tools to handle specific 3D applications. It allows you to load and draw 3D objects, manage these 3D objects, create and manage special effects, play and manage spatialized sounds, create gameplays, and more. Babylon.js is an easy-to-use framework as you can set up (you'll see this later) these things with the minimum lines of code.</p><p>Babylon.js is a JavaScript framework developed using TypeScript. TypeScript is a compiled and multiplatform language that generates pure JavaScript files.</p><p>We will cover the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An introduction to Babylon.js</li><li class="listitem" style="list-style-type: disc">The reason Babylon.js has been developed using TypeScript</li><li class="listitem" style="list-style-type: disc">An introduction to TypeScript</li></ul></div><div class="section" title="The creators"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec7"/>The creators</h1></div></div></div><p>Babylon.js was created by David Catuhe (<code class="literal">@deltakosh</code>), David Rousset (<code class="literal">@davrous</code>), Pierre Lagarde (<code class="literal">@pierlag</code>), and Michel Rousseau (<code class="literal">@rousseau_michel</code>). It's an open source project essentially developed in their spare time. When they started Babylon.js, they wanted it to be designed as <span class="emphasis"><em>easy-to-use</em></span> and then get an accessible 3D engine for everyone. The official web site (<a class="ulink" href="http://www.babylonjs.com/">http://www.babylonjs.com/</a>) contains a lot of tutorials for beginners (even in 3D) to more advanced users with examples for each feature and scenes as examples.</p><div class="section" title="Online tools provided by the Babylon.js solution"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec7"/>Online tools provided by the Babylon.js solution</h2></div></div></div><p>Babylon.js provides you with several online tools to help developers and artists experiment and try their productions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For developers, the Playground (<a class="ulink" href="http://www.babylonjs-playground.com/">http://www.babylonjs-playground.com/</a>) allows you to experiment and train. It shows a code editor with autocompletion (Monaco) and canvas to see the results. It also provides some examples of code to train with.</li><li class="listitem" style="list-style-type: disc">For artists, the Sandbox (<a class="ulink" href="http://www.babylonjs.com/sandbox/">http://www.babylonjs.com/sandbox/</a>) allows you to drag and drop exported Babylon.js scenes (Blender and 3ds Max) to the browser to see the results in real time. The Sandbox provides you with debugging tools to activate/deactivate features and see the impact on real-time performances.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Create Your Own Shader</strong></span> (<span class="strong"><strong>CYOS</strong></span>) allows developers to develop shaders and see the results in real time. There are also several shaders already available to train and experiment with.</li></ul></div></div></div></div>
<div class="section" title="Why is Babylon.js developed using TypeScript?"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec8"/>Why is Babylon.js developed using TypeScript?</h1></div></div></div><p>Babylon.js is a big project with increasing contributions since its creation on GitHub. It provides you with a lot of functions and, sometimes, with a lot of parameters for more flexibility. The TypeScript language is useful for robust code as its goal is to improve and secure the production of JavaScript code.</p><div class="section" title="The TypeScript language"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec8"/>The TypeScript language</h2></div></div></div><p>
TypeScript (<span class="strong"><strong>TS</strong></span>) is a free and open source language developed by Microsoft. It is a compiled language to produce JavaScript (the TS code is, in fact, transcompiled) and provides a static typing system, which is optional. The typing system is used in Babylon.js in order to get a cleaner and more descriptive code. It means that if a function has a lot of parameters, it's easier to fill and understand them instead of always using the documentation as a reference. Moreover, it allows developers to declare classes (as the ECMAScript 6 specifications do) and interfaces for a better understandable architecture and structure of code.</p></div><div class="section" title="The TypeScript features"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec9"/>The TypeScript features</h2></div></div></div><p>The typing system is powerful as it allows developers to create interfaces, enumerated types, and classes and handle generics and union typing. Overall, developers use the typing system for a better understanding and security of the libraries that they are building and using.</p><p>The TS language supports inheritance (classes) and also provides access specifiers (private / public / protected) to modify the access rights for the classes' members. Then, developers can see at a glance the members that they can use and modify.</p></div></div>
<div class="section" title="Introduction to TypeScript - what you have to know"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Introduction to TypeScript - what you have to know</h1></div></div></div><p>Let's introduce TypeScript with some feature examples and configurations: how to compile TS files to JS files, work with classes / types / union types, functions, inheritance, and interfaces.</p><div class="section" title="Compilation using Gulp"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Compilation using Gulp</h2></div></div></div><p>Gulp is a task runner available as an npm package. It provides a plugin to handle the TypeScript compilation. The only thing to do is to configure a task using gulp with gulp-typescript.</p><p>To download the gulp packages, you have to install Node.js (<a class="ulink" href="https://nodejs.org/">https://nodejs.org/</a>) to get access to the npm packages:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Install Gulp using the following command line:<pre class="programlisting">    npm install gulp</pre></li><li class="listitem">Install Gulp-Typescript using the following command lines:     
<pre class="programlisting">    npm install gulp-typescript</pre></li><li class="listitem">To configure the Gulp task, just provide a JS file named <code class="literal">gulpfile.js</code> containing the task description.</li><li class="listitem">Import Gulp and Gulp-TypeScript:<pre class="programlisting">    var gulp = require("gulp"); &#13;
    var ts = require("gulp-typescript");</pre></li><li class="listitem">Define the default task to transcompile your TS files:<pre class="programlisting">    gulp.task('default', function() { // Default task &#13;
      var result = gulp.src([ // Sources &#13;
          "myScript1.ts", &#13;
          "myScript2.ts", &#13;
          // Other files here &#13;
        ]) &#13;
        .pipe(ts({ // Trans-compile &#13;
          out: "outputFile.js" // Merge into one output file &#13;
        })); &#13;
      return result.js.pipe(gulp.dest("./")); // output file desti        nation&#13;
    });</pre></li><li class="listitem">Once the default task lists all the TS files to transcompile, just call Gulp using the following command line:<pre class="programlisting">    gulp</pre></li></ol></div></div><div class="section" title="Working with typed variables"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Working with typed variables</h2></div></div></div><p>Working with TypeScript is really similar to JS as the typing system is optional. Nevertheless, the common types in TS are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">String</li><li class="listitem" style="list-style-type: disc">Number</li><li class="listitem" style="list-style-type: disc">Boolean</li><li class="listitem" style="list-style-type: disc">Any</li><li class="listitem" style="list-style-type: disc">Void</li><li class="listitem" style="list-style-type: disc">Enum</li><li class="listitem" style="list-style-type: disc">Array</li></ul></div><p>With JS, you should write the following:</p><pre class="programlisting">var myVar = 1.0;// or &#13;
var myVar = "hello !"; &#13;
</pre><p>Here, you can write exactly the same with TS. The TS compiler will process the type inference and guess the variable type for you:</p><pre class="programlisting">var myVar = 1.0; // Which is a number &#13;
// or &#13;
var myVar = "hello !"; // Which is a string &#13;
</pre><p>To specify the type of a variable with TS, type the following command:</p><pre class="programlisting">    var myVar: type = value;&#13;
</pre><p>Then, with the previous example, add the following code:</p><pre class="programlisting">var myVar: number = 1.0; &#13;
// or &#13;
var myVar: string = "hello !"; &#13;
// etc. &#13;
</pre><p>However, it's forbidden to assign a new value with a different type even if you don't mention the type as follows:</p><pre class="programlisting">var myVar = 1.0; // Now, myVar is a number &#13;
// and &#13;
myVar = "hello !"; // Forbidden, "hello" is a string and not a number &#13;
</pre><p>To get the JS flexibility with variables, let's introduce the <code class="literal">any</code> type. The <code class="literal">any</code> type allows developers to create variables without any static type. The following is an example:</p><pre class="programlisting">var myVar: any = 1.0; // Is a number but can be anything else &#13;
myVar = "Hello !"; // Allowed, myVar's type is "any" &#13;
</pre><p>The following is the screenshot of the <code class="literal">types.ts</code> file:</p><p>
</p><div class="mediaobject"><img src="graphics/image_01_001.png" alt="Working with typed variables"/></div><p>
</p><p>Let's introduce some specific types. It's the occasion to introduce the generics using TypeScript and enumerated types. The usage of numbers, Booleans, and strings is the same in TypeScript and JavaScript. So, no need to learn more.</p><div class="section" title="Enumerated types"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec0"/>Enumerated types</h3></div></div></div><p>Working with enumerated types (<code class="literal">enum</code>) is like working with numbers. The syntax is as follows:</p><pre class="programlisting">enum FileAccess {Read, Write}; &#13;
</pre><p>This generates the following JS code:</p><pre class="programlisting">var FileAccess; &#13;
(function (FileAccess) { &#13;
    FileAccess[FileAccess["Read"] = 0] = "Read"; &#13;
    FileAccess[FileAccess["Writer"] = 1] = "Writer"; &#13;
})(FileAccess || (FileAccess = {})); &#13;
</pre><p>Access to an enumerated type in both the languages is as follows:</p><pre class="programlisting">var myVar: FileAccess = FileAccess.Read; // Equivalent to 0 &#13;
</pre></div><div class="section" title="Array"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec1"/>Array</h3></div></div></div><p>Defining an array with TS is also similar to JS. The following is an example:</p><pre class="programlisting">// In both languages &#13;
var myArray = []; &#13;
// or &#13;
var myArray = new Array(); &#13;
</pre><p>With TS, array is a generic class. Then, you can specify the item's type contained in the array as follows:</p><pre class="programlisting">var myArray = new Array&lt;number&gt;(); &#13;
</pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note3"/>Note</h3><p>Note: With TS, typing new <code class="literal">Array()</code> is equivalent to new <code class="literal">Array&lt;any&gt;()</code>.</p></div></div><p>You can now access the common functions as follows:</p><pre class="programlisting">var myArray = new Array&lt;any&gt;(); &#13;
myArray.push("Hello !");   &#13;
myArray.push("1"); &#13;
myArray.splice(0, 1); &#13;
console.log(myArray); // "[1]" &#13;
</pre></div></div><div class="section" title="Working with classes and interfaces"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Working with classes and interfaces</h2></div></div></div><p>Classes and interfaces allow you to build types just as the <code class="literal">Array</code> class does. Once you create a class, you can create instances using the keyword <code class="literal">new</code>, which creates an object in the memory.</p><p>The following is an example:</p><pre class="programlisting">var myArray = new Array&lt;any&gt;(); // Creates a new instance &#13;
</pre><div class="section" title="Creating a class"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec2"/>Creating a class</h3></div></div></div><p>The syntax in TS to define a class is as follows:</p><pre class="programlisting">class Writer { &#13;
  constructor() { &#13;
    // initialize some things here &#13;
  } &#13;
} &#13;
</pre><p>This generates the following in JS:</p><pre class="programlisting">var Writer = (function () { &#13;
    function Writer() { &#13;
    } &#13;
    return Writer; &#13;
})(); &#13;
</pre><p>In both languages, you can create an instance of <code class="literal">Writer</code>:</p><pre class="programlisting">var myInstance = new Writer(); &#13;
</pre><p>You can also use modules that work as namespaces:</p><pre class="programlisting">module MY_MODULE { &#13;
  class Writer { &#13;
    ... &#13;
  } &#13;
} &#13;
</pre><p>Access:</p><pre class="programlisting">var writer = new MY_MODULE.Writer(...); &#13;
</pre></div><div class="section" title="Creating class members"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec3"/>Creating class members</h3></div></div></div><p>With JS and the conventions, you can write the following:</p><pre class="programlisting">function Writer() { &#13;
  this.myPublicMember = 0.0; // A public member &#13;
  this._myPrivateMember = 1.0; // A member used as private &#13;
} &#13;
</pre><p>With TS, you can explicitly specify the access specifier of a member (public, private, and protected), which has been explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Public</strong></span>: Any block of code can access the member to read and write</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Private</strong></span>: Only this can access this member to read and write</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Protected</strong></span>: External blocks of code cannot access the member; only this and specializers (inheritance) can access this member to read and write</li></ul></div><p>Let's experiment using the Writer class:</p><pre class="programlisting">// declare class &#13;
class Writer { &#13;
  // Union types. Can be a "string" or &#13;
// an array of strings "Array&lt;string&gt;" &#13;
  public message: string|string[]; &#13;
  private _privateMessage: string = "private message"; &#13;
  protected _protectedMessage: string; &#13;
 &#13;
  // Constructor. Called by the "new" keyword &#13;
  constructor(message: string|string[]) { &#13;
    this.message = message; &#13;
    this._protectedMessage = "Protected message !"; // Allowed &#13;
} &#13;
 &#13;
// A public function accessible from everywhere. &#13;
// Returns nothing. Then, its return type is "void". &#13;
public write(): void { &#13;
  console.log(this.message); // Allowed &#13;
  console.log(this._privateMessage); // Allowed &#13;
  console.log(this._protectedMessage); // Allowed &#13;
} &#13;
} &#13;
 &#13;
var writer = new Writer("My Public Message !"); &#13;
console.log(writer.message); // Allowed &#13;
console.log(writer._privateMessage); // Not allowed &#13;
console.log(writer._protectedMessage); // Not allowed &#13;
</pre></div><div class="section" title="Working with inheritance"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec4"/>Working with inheritance</h3></div></div></div><p>Let's create a new class that specializes the <code class="literal">Writer</code> class. The specialized classes can access all the public and protected members of the base class thanks to the inheritance. The <code class="literal">extends</code> keyword represents the inheritance.</p><p>Let's create a new class named <code class="literal">BetterWriter</code> that specializes (extends) the <code class="literal">Writer</code> class:</p><pre class="programlisting">// The base class is "Writer" &#13;
class BetterWriter extends Writer { &#13;
  constructor(message: string|string[]) { &#13;
    // Call the base class' constructor &#13;
    super(message); &#13;
} &#13;
 &#13;
// We can override the "write" function &#13;
public write(): void { &#13;
  if (typeof this.message === "string") { &#13;
    // Call the function "write" of the base class &#13;
    // which is the "Writer" class &#13;
    super.write(); &#13;
  } &#13;
  else { &#13;
    for (var i=0; i &lt; this.message.length; i++) { &#13;
      console.log(this.message[i]); // Allowed &#13;
      console.log(this._privateMessage); // Not allowed &#13;
      console.log(this._protectedMessage); // Allowed &#13;
    } &#13;
  } &#13;
} &#13;
} &#13;
</pre></div><div class="section" title="Using interfaces"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec5"/>Using interfaces</h3></div></div></div><p>Interfaces are used to create contracts. It means that if a class implements an interface, the class must provide all the functions and members defined in the interface. If not, it doesn't respect the contract, and the compiler will output an error.</p><p>All the defined functions are public and all the defined members are public.</p><p>With Babylon.js, a good example is to use the <code class="literal">IDisposable</code> interface. It means that the users can call the method named <code class="literal">dispose()</code>. This function's job is to deactivate and/or deallocate the systems used.</p><p>The following is an example:</p><pre class="programlisting">interface IWriter { &#13;
  // The class "Writer" must have the "message" member &#13;
  message: string|string[]; &#13;
  // The class "Writer" must provide the "resetMessages" function. &#13;
  resetMessages(): void; &#13;
} &#13;
 &#13;
class Writer implements IWriter { &#13;
  public message: string|string[]; &#13;
... &#13;
  constructor(...) { &#13;
    ... &#13;
} &#13;
... &#13;
// All functions declared in the interface are public. &#13;
public resetMessages(): void { &#13;
  this.message = this._privateMessage = this._protectedMessage = ""; &#13;
} &#13;
} &#13;
</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Summary</h1></div></div></div><p>In this chapter, you obtained the necessary knowledge to develop programs using TypeScript with Babylon.js. You'll see that working with TypeScript can be more productive and secure in most cases. Additionally, some developers will be more comfortable when using types as they are used to development with typing.</p><p>Don't hesitate to manipulate TypeScript with the attached example files. Don't forget to install gulp and run the command lines.</p><p>You can also run the following command line:</p><pre class="programlisting">    gulp watch&#13;
</pre><p>This will track and recompile the TS files at each modification automatically.</p><p>In the next chapter, let's get straight to the heart of the matter with an introduction to the Babylon.js framework, and how to create an engine and scene entities such as lights, cameras, and meshes (3D objects). You'll build your first 3D scene with Babylon.js and understand the architecture of the framework really quickly!</p></div></body></html>