<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch14"/>Chapter 14. Preparing for the Future</h1></div></div></div><p>Mastering CSS is an essential skill—the technology is continually evolving, so in order to succeed, we must keep abreast of changes. PostCSS is a great tool that allows us to not only use CSS rules of today, but work with rules of the future. In this chapter, we'll take a look at some of the CSS syntax that makes up what is frequently referred to as CSS4, and how we can provide equivalent support using current CSS3 classes.</p><p>We will cover a number of topics throughout this chapter, which will include the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding some of the risks of supporting future CSS standards today</li><li class="listitem" style="list-style-type: disc">Exploring using <code class="literal">cssnext</code> to provide support for future CSS syntax</li><li class="listitem" style="list-style-type: disc">Working with some of the existing plugins to convert CSS4 standards into current CSS3 code</li><li class="listitem" style="list-style-type: disc">Examining how we can change existing plugins to add more support for new CSS4 selectors</li></ul></div><p>Let's make a start!</p><div><div><div><div><h1 class="title"><a id="ch14lvl1sec112"/>Supporting CSS4 styles today</h1></div></div></div><p>Style sheets have been in existence for over 35 years, with the original version of what we now know as CSS dating from the days of SGML in the 1980s.</p><p>We have come a long<a id="id839" class="indexterm"/> way since the original CSS standard was released in 1996—over the last few years, the standard for CSS4 has been developed, with new features such as <code class="literal">:not</code> or <code class="literal">:matches</code> pseudo-classes to better target elements, custom properties (or variables), and location-based links, such as <code class="literal">local-link</code>. Over the course of the next few pages, we're going to explore a few of these CSS4 features, and see how we can introduce support for them using current CSS3 equivalent code.</p><p>There is one small thing that we need to clear up first—CSS4…does not exist. What? I hear you say. Surely it must, I've seen plenty online about it! Yes, it is true: CSS4 as a standard does exist, but <em>not as a single unique entity</em>. Let me explain.</p><p>Previous iterations of CSS have been based around creating a single global standard, irrespective of how browser manufacturers decide to support elements that make up standard. It's for this reason that we had to rely heavily on vendor prefixes for some years, we still do, but most vendors have since removed prefixes from many of the more common attributes such as <code class="literal">border-radius</code> or <code class="literal">box-shadow</code>.</p><p>The key difference <a id="id840" class="indexterm"/>here, though, is that a decision was taken to deliver CSS4 as a series of modules—CSS as a standard has become very heavy, with the resulting increase in time required for development becoming unsustainable. This is why we will see talk of CSS Modules, such as Custom Properties or Selectors—these can evolve as independent standards to a point that we may no longer refer to CSS as version X, but just CSS.</p><div><div><h3 class="title"><a id="note64"/>Note</h3><p>Any reference to CSS4 within this chapter is purely to identify next generation styles we can implement using PostCSS plugins and CSS3 current standards.</p></div></div><p>Okay, this aside, it's time to get stuck in: PostCSS offers good support for some of the more common elements of we collectively call CSS4. Let's take a look to see what is available.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch14lvl1sec113"/>Converting CSS4 styles for use</h1></div></div></div><p>The idea behind <a id="id841" class="indexterm"/>basing CSS4 around a series of modules was aimed at making it easier (and ultimately quicker) to update each standard; it does mean that modules will be in a state of flux, at least for the time being!</p><p>This said, there are some clear styles we can recreate using current CSS3 styles—one such example is CSS4 Selectors. Even though it is still in draft at the time of writing, a PostCSS plugin is available in the<a id="id842" class="indexterm"/> form of <code class="literal">postcss-selector-not</code> (from <a class="ulink" href="https://github.com/postcss/postcss-selector-not">https://github.com/postcss/postcss-selector-not</a>). A sister style that is also available as a<a id="id843" class="indexterm"/> PostCSS plugin is <code class="literal">postcss-selector-matches</code> (available from <a class="ulink" href="https://github.com/postcss/postcss-selector-matches">https://github.com/postcss/postcss-selector-matches</a>)—these two are intended to replicate the <code class="literal">:not</code> negation and <code class="literal">:matches</code> pseudo-selectors that are coming as part of the new CSS4 standard.</p><div><div><h3 class="title"><a id="note65"/>Note</h3><p>For more information on<a id="id844" class="indexterm"/> individual CSS4 selectors, take a look at the full list available at <a class="ulink" href="http://css4-selectors.com/selectors/">http://css4-selectors.com/selectors/</a>. This will also give you an indication of available browser support—this list will be updated with changes as selectors are ratified for use.</p></div></div><p>Looking further afield, there are a small handful of plugins that provide support for upcoming CSS4<a id="id845" class="indexterm"/> standards—in addition to the <code class="literal">:matches</code> and <code class="literal">:not</code> plugins, we can use any of the following:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name of plugin</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose of plugin</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">mq4-hover-shim</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Currently in <a id="id846" class="indexterm"/>beta, this plugin <a id="id847" class="indexterm"/>provides limited support for the Media Queries Level 4 hover media feature—it is available from <a class="ulink" href="https://github.com/twbs/mq4-hover-shim">https://github.com/twbs/mq4-hover-shim</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">host</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Working <a id="id848" class="indexterm"/>with the Shadow DOM? If you need to make <code class="literal">:host</code> selectors<a id="id849" class="indexterm"/> work properly with pseudo-classes, then this plugin is for you—the source is available at <a class="ulink" href="https://github.com/vitkarpov/postcss-host">https://github.com/vitkarpov/postcss-host</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">pseudo-class-any-link</code>
</p>
</td><td style="text-align: left" valign="top">
<p>How many<a id="id850" class="indexterm"/> times have you <a id="id851" class="indexterm"/>had to add pseudo-selectors such as <code class="literal">:link</code> or <code class="literal">:visited</code> to your code? This PostCSS plugin fixes that—we can now use the proposed <code class="literal">:any-link</code> pseudo-class in CSS.</p>
<p>Head over to <a class="ulink" href="https://github.com/jonathantneal/postcss-pseudo-class-any-link">https://github.com/jonathantneal/postcss-pseudo-class-any-link</a> for more details.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">postcss-initial</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The PostCSS<a id="id852" class="indexterm"/> Initial plugin resets a specified <a id="id853" class="indexterm"/>property's value to what it was initially set in code (and not by the browser). For more details, head over to <a class="ulink" href="https://github.com/maximkoretskiy/postcss-initial">https://github.com/maximkoretskiy/postcss-initial</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">font-variant</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This plugin<a id="id854" class="indexterm"/> transforms <code class="literal">font-variant</code> settings to the<a id="id855" class="indexterm"/> equivalent <code class="literal">font-feature-settings value</code>—it is designed for special cases, when it is not possible to reproduce using normal means, for example, a slashed zero to differentiate between a 0 and an O—the former equates to zero.</p>
<p>The source for the plugin is available at <a class="ulink" href="https://github.com/postcss/postcss-font-variant">https://github.com/postcss/postcss-font-variant</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">postcss-input-range</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This plugin allows us to style input range elements. We need to provide unprefixed CSS styles, and the plugin will automatically handle support for<a id="id856" class="indexterm"/> all of the various prefixes required to allow this element to be styled across different browsers.</p>
<p>The source<a id="id857" class="indexterm"/> for this plugin can be downloaded from <a class="ulink" href="https://github.com/jonathantneal/postcss-input-range">https://github.com/jonathantneal/postcss-input-range</a>.</p>
</td></tr></tbody></table></div><p>Okay, let's move on: I feel a demo coming! Let's take a look at using the <code class="literal">postcss-selector-matches</code> property, to see how we can use it in action.</p><div><div><div><div><h2 class="title"><a id="ch14lvl2sec144"/>Validating e-mail addresses</h2></div></div></div><p>How many times have <a id="id858" class="indexterm"/>you come across e-mail submissions from your site, where you aren't 100% sure your visitors have left a valid e-mail address?</p><p>If we leave aside exact numbers, it goes without saying that any requests submitted from any website must have a valid e-mail address; with the plethora of top level domains that are now available, it's even more critical that they be valid!</p><p>To help with this, we can use the <code class="literal">:invalid</code> and <code class="literal">:valid</code> attributes to style <code class="literal">&lt;input&gt;</code> fields—whilst they may not be able to tell if <code class="literal">.design</code> is a valid TLD (and yes, it is), they can at least cope with the basics of ensuring that you have a TLD present, an <code class="literal">@</code> symbol, and the name of a recipient.</p><div><div><h3 class="title"><a id="tip32"/>Tip</h3><p>You can perform a test in your<a id="id859" class="indexterm"/> browser to gauge support for these and other CSS4 selectors—check out the CSS4 Selectors site, at <a class="ulink" href="http://css4-selectors.com/">http://css4-selectors.com/</a>.</p></div></div><p>Let's knock up a simple example using the <code class="literal">postcss-selectors-matches</code> plugin for PostCSS, to see how we can style such fields:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start as always by firing up a Node.js command prompt session, then changing the working folder to our project area.</li><li class="listitem">At the prompt, go ahead and enter this command, then press <em>Enter</em>:<div><pre class="programlisting"><strong>npm install postcss-selector-matches --save-dev</strong>
</pre></div><p>Keep the window open, we will need it shortly. If all is well, we should see this appear:</p><div><img src="img/BO5194_14_01.jpg" alt="Validating e-mail addresses"/></div></li><li class="listitem">Next, extract a copy of the <code class="literal">T69 - matches pseudo-selector</code> folder from the code download that accompanies this book, and save it to the root of our project area.</li><li class="listitem">Copy <code class="literal">matches – pre-compile.css</code> from the <code class="literal">css</code>—completed version folder within <code class="literal">T69 - matches pseudo-selector</code>, and save it to the <code class="literal">src</code> folder at the root of our project area.</li><li class="listitem">Copy<a id="id860" class="indexterm"/> the <code class="literal">gulpfile.js</code> and <code class="literal">package.json</code> files from the <code class="literal">T69 - matches pseudo-selector</code> folder to the root of our project area, and rename it <code class="literal">matches.css</code></li><li class="listitem">Revert to the Node.js command prompt session from earlier, then at the prompt enter <code class="literal">gulp</code> and press <em>Enter</em>.</li><li class="listitem">If all is well, PostCSS will go away and compile our code into valid CSS—we should see the now familiar files appear in the <code class="literal">dest</code> folder.</li><li class="listitem">Copy the contents of this <code class="literal">dest</code> folder to the <code class="literal">css</code> folder underneath <code class="literal">T69 - matches pseudo-selector</code>, then try previewing the <code class="literal">matches.html</code> file in a browser. If all is well, we should see something akin to this:<div><img src="img/BO5194_14_02.jpg" alt="Validating e-mail addresses"/></div></li></ol></div><p>It's a simple demo, and yes, somewhat contrived. At this level, it wouldn't be necessary to use <code class="literal">:matches</code>, as it ends up generating more code than is necessary! But it does show how easy it is to apply the technique, and have it provide valid CSS, as in the case of our example:</p><div><img src="img/BO5194_14_03.jpg" alt="Validating e-mail addresses"/></div><p>Okay, let's change tack: we will stay with the range theme for our next demo, but this time look at a more stylish example, where we can really go to town on transforming the appearance of <a id="id861" class="indexterm"/>our selected element.</p><p>The range input element is one that has been traditionally hard to style, more often than not, we may end up resorting to using jQuery UI to change its appearance! Not so with CSS4—we can use a series of new CSS attributes to apply styles, without the use of any additional libraries. Let's take a look at this in more detail.</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec145"/>Supporting the new range input</h2></div></div></div><p>A quick question, how<a id="id862" class="indexterm"/> many times have you had to create a site where you needed to choose a value, say from 1 to 100? Or pick a specific opacity of color, from almost transparent to completely opaque?</p><p>Okay, perhaps they're an odd couple of questions to ask, but the eagle-eyed should spot that I am of course referring to using sliders, which we can adjust to select a specific value. There are different ways to add these to a page, but which in the main will require some help to style, perhaps the most recognizable tool being jQuery UI!</p><p>This is fine if we need to use jQuery UI in our pages to provide other functionality, but what if we only needed it for the slider? It's a bit of overkill—thankfully, we can fix that with the use of the <a id="id863" class="indexterm"/>
<code class="literal">postcss-input-range</code> plugin, available from <a class="ulink" href="https://github.com/jonathantneal/postcss-input-range">https://github.com/jonathantneal/postcss-input-range</a>. It's time for that demo, so let's knock up a quick example of how one can be styled to represent a progress bar:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the <code class="literal">postcss-input-range</code> plugin, for this, go ahead and fire up a Node.js command prompt, then change the working folder to our project area.</li><li class="listitem">At the prompt, enter the following command, then press <em>Enter</em>:<div><pre class="programlisting"><strong>npm install postcss-input-range --save-dev</strong>
</pre></div><p>If all is well, we should see something akin to this screenshot:</p><div><img src="img/BO5194_14_04.jpg" alt="Supporting the new range input"/></div></li><li class="listitem">Next, extract a copy of the <code class="literal">T70 - using range input </code>folder from the code download that accompanies this book. Go ahead and save it in our project area.</li><li class="listitem">In the <code class="literal">css</code> folder of <code class="literal">T70 - using range input</code>, copy the <code class="literal">range – pre-compile.css</code> file to the <code class="literal">src</code> folder of our project area, and rename it <code class="literal">range.css</code>.</li><li class="listitem">Copy the <code class="literal">gulpfile.js</code> and <code class="literal">package.json</code> files from the <code class="literal">T70 - using range input</code> folder to the root of our project area.</li><li class="listitem">Revert to the <a id="id864" class="indexterm"/>Node.js command prompt window, then at the prompt enter <code class="literal">gulp</code> and press <em>Enter</em>.</li><li class="listitem">Gulp will now run our compilation process, if all is well, we should see the now familiar style sheet files appear in the <code class="literal">dest</code> folder, along with a map file in the maps subfolder. Copy these to the <code class="literal">css</code> folder under <code class="literal">T70 - using range input</code>.</li><li class="listitem">If all is well, we should see something akin to this screenshot when previewing the results in a browser:<div><img src="img/BO5194_14_05.jpg" alt="Supporting the new range input"/></div></li></ol></div><p>There is nothing complicated in this demo, even though we've only scratched the surface of what is possible when styling the range element—for example, we can add datalists to define certain values to scroll through, such as specific times of the day.</p><p>Browser support is<a id="id865" class="indexterm"/> still limited, but for an idea of what is possible, check out <a class="ulink" href="http://demo.agektmr.com/datalist/">http://demo.agektmr.com/datalist/</a>; the CSS guru Chris Coyier also has a couple of articles <a id="id866" class="indexterm"/>on the use of range inputs on his site at <a class="ulink" href="http://www.css-tricks.com">http://www.css-tricks.com</a>.</p><p>The real magic in our demo appears when we take a look at the compiled code—one of the key elements for styling a range input is the <code class="literal">range-thumb</code> attribute, which is the knob we use to select a value on the slider. Here are two examples of how our code now looks, with support added for Firefox:</p><div><img src="img/BO5194_14_06.jpg" alt="Supporting the new range input"/></div><p>This has support for Internet Explorer (which has been superseded by Edge):</p><div><img src="img/BO5194_14_07.jpg" alt="Supporting the new range input"/></div><p>When using this plugin, we don't have to worry about adding vendor prefixes—our original code contains just the unprefixed versions; the relevant prefixes will be added at compilation, until such time as they are no longer needed for styling our input element.</p><div><div><h3 class="title"><a id="tip33"/>Tip</h3><p>If you would like help with styling the <a id="id867" class="indexterm"/>new range input element, then check out <a class="ulink" href="http://danielstern.ca/range.css/">http://danielstern.ca/range.css/</a>—it's a useful tool!</p></div></div><p>Over the course<a id="id868" class="indexterm"/> of the last two demos, we've briefly scratched the surface of what is possible when using PostCSS—we've used the same format of Gulp task file to incorporate support for each plugin, which when run, has produced the requisite CSS style sheet for each demo. Nothing outrageous here, right? After all, it's followed the same principles we covered earlier, such as one plugin for one task…or can we do better?</p><p>Yes, by now you should know that I always like to go one better if I can. Remember how I said it is preferable to create tasks in our runner that worked on a one-to-one basis? Was each task in our (Gulp) file related to a specific plugin? Well, as someone once said, rules are meant to be broken—it's time to throw out the rulebook, and consider a different approach, at least for future syntax…</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch14lvl1sec114"/>Supporting future syntax with cssnext</h1></div></div></div><p>A key part of supporting CSS4 is the constant state of flux that we must deal with, until such time as<a id="id869" class="indexterm"/> modules have been standardized. If we maintained our current approach, it would entail constant updates of any plugins we decided to use that relate to CSS4 attributes—this is clearly not sustainable!</p><p>Instead, we can use a single plugin pack, in this case <code class="literal">cssnext</code>, to manage support for a range of new features. The beauty, though, is that all of the features are enabled by default, and will only kick in when needed in the code. There will of course come a time when new features are supported natively, at this point, we can simply discard the compilation process without impacting the final result.</p><p>It's worth taking<a id="id870" class="indexterm"/> the time to get to know <code class="literal">cssnext</code>—let's dive in and take a look in more detail.</p><div><div><div><div><h2 class="title"><a id="ch14lvl2sec146"/>Creating a site template with cssnext</h2></div></div></div><p>The <code class="literal">cssnext</code> plugin is one of those exceptions to our guideline of one plugin per task; we call it using the plugin name, but in reality, it will perform a number of transformations at the same time.</p><p>The plugin is <a id="id871" class="indexterm"/>available from <a class="ulink" href="http://cssnext.io/">http://cssnext.io/</a>. It is worth noting that an older version exists; we're using the newer version in<a id="id872" class="indexterm"/> this demo. The <code class="literal">cssnext</code> plugin was originally a complete system in its own right, before PostCSS became as popular as it is now.</p><p>The plugin contained options which didn't really belong to a plugin focused on the future of CSS, so the developers rewrote it to make <code class="literal">cssnext</code> simpler. At the same time, it was designed to be integrated into PostCSS, where we can use it at the same time as other plugins within our processor.</p><div><div><h3 class="title"><a id="note66"/>Note</h3><p>The plugin even has its own playground, which we can use to test if changes will produce the desired effect—check it out at <a class="ulink" href="http://cssnext.io/playground/">http://cssnext.io/playground/</a>.</p></div></div><p>Let's explore this plugin in more detail—we'll begin by installing it, before setting up code for our next demo.</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec147"/>Setting up our demo</h2></div></div></div><p>For this next demo, we're <a id="id873" class="indexterm"/>going to set up a basic template that can be used for a site—it's not going to win any awards for style, but the aim here is to explore how easy it is to make the changes, not become top billing at the next awards ceremony! Let's dive in and take a look at what we need to do:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by firing up a Node.js command prompt session then changing the working folder to the root of our project area.</li><li class="listitem">At the prompt, enter this command, then press <em>Enter</em>:<div><pre class="programlisting"><strong>npm install postcss-cssnext --save-dev</strong>
</pre></div><p>If all is well, we should see something akin to this screenshot:</p><div><img src="img/BO5194_14_08.jpg" alt="Setting up our demo"/></div></li><li class="listitem">Next, go ahead and extract a copy of the <code class="literal">T71 - working with cssnext</code> folder from the <a id="id874" class="indexterm"/>code download that accompanies this book—save it to the root of our project area.</li><li class="listitem">From the <code class="literal">T71 - working with cssnext</code> folder, save copies of the <em>styles.css</em> file to the <code class="literal">src</code> folder at the root of our project area, then <code class="literal">package.json</code> and <code class="literal">gulpfile.js</code> to the root of our project area.</li><li class="listitem">Revert to the prompt we had open, then enter <code class="literal">gulp</code> and press <code class="literal">Enter</code>.</li><li class="listitem">Gulp will go away and compile our file, when it has completed, we will see the now familiar files appear in the <code class="literal">dest</code> folder at the root of our project area.</li><li class="listitem">Copy the contents of the <code class="literal">dest</code> folder at the root of our project area to the <code class="literal">css</code> folder within <code class="literal">T71 - working with cssnext</code> folder at the root of our project area.</li><li class="listitem">Go ahead and preview <code class="literal">sitepage.html</code> from within the <code class="literal">T71 - working with cssnext</code> folder in a browser—if all is well, we should see something akin to this screenshot:<div><img src="img/BO5194_14_09.jpg" alt="Setting up our demo"/></div></li></ol></div><p>We've now seen the template for our site—there are several places where we have made changes to take<a id="id875" class="indexterm"/> advantage of the power of <code class="literal">cssnext</code>. For this, go ahead and open up a copy of the file <code class="literal">stylescss </code>from within the<code class="literal"> css</code> folder of <code class="literal">T71 - working with cssnext</code> folder that we saved to our project area—let's explore what changes have been made:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Autoprefixer</strong>: The plugin<a id="id876" class="indexterm"/> covers support for providing vendor prefixes for any future styles; any in the base file have been removed, and will be added during compilation.</li><li class="listitem" style="list-style-type: disc"><strong>Media query ranges / custom queries</strong>: Instead of using the existing format, which isn't always<a id="id877" class="indexterm"/> clear, we can begin to use <code class="literal">&gt;=</code> or <code class="literal">&lt;=</code> to better express the range that we're applying as part of our query. At the same time, we can use a custom query to define preset ranges at the top of our file, which can be used throughout the style sheet.</li><li class="listitem" style="list-style-type: disc"><strong>Nesting</strong>: Fans of <a id="id878" class="indexterm"/>existing preprocessors such as SASS or Less will be familiar with the nesting principle; put simply, this allows us to nest styles inside each other. We can then adjust the selectors used for these rules, so that when compiled, each rule is transformed into valid CSS.</li><li class="listitem" style="list-style-type: disc"><strong>Custom selectors</strong>: Staying with the preprocessor theme, we can create custom values at the top<a id="id879" class="indexterm"/> of our code, and apply them as appropriate throughout.</li><li class="listitem" style="list-style-type: disc"><strong>#rrggbbaa colors</strong>: Traditionally, hex<a id="id880" class="indexterm"/> colors have been expressed as either three or six digit values; using <code class="literal">cssnext</code>, we can expand them to either four or eight digit values. The <code class="literal">cssnext</code> plugin will transpile them into standard RGBA values, with equivalent HEX values provided as a fallback mechanism.</li><li class="listitem" style="list-style-type: disc"><strong>rem units</strong>: Traditionally, developers<a id="id881" class="indexterm"/> have used pixel values to apply sizes to elements or fonts. Pixel values don't respect user settings in a browser, so may not resize as expected. To work around this, <code class="literal">em</code> units were introduced; the math behind calculating <code class="literal">em</code> values was simplified with the introduction of rem units. Today, some developers argue that pixel values should reign supreme; the <code class="literal">cssnext</code> plugin provides both pixel and rem units, which can be used where supported by browsers.</li></ul></div><p>At first thought, you might expect to have to include a number of plugins, or a detailed configuration object; not so! Instead, all we need in our Gulp task file is this:</p><div><img src="img/BO5194_14_10.jpg" alt="Setting up our demo"/></div><p>I've always been a keen fan of keeping things simple—the <code class="literal">cssnext</code> plugin is a perfect example! Whilst we may need to update the plugin regularly to keep abreast of changes, we don't need to change our Gulp file.</p><p>The plugin will <a id="id882" class="indexterm"/>simply transform those styles it finds that are supported by the plugin, and leave alone any not covered by the plugin. The beauty of this is that we can either let it run as is, or if we want disable functionality that is no longer needed, then we simply disable it within the configuration object:</p><div><pre class="programlisting">cssnext(input, { 
  features: { customProperties: false }
})</pre></div><p>To prove that the changes we made work, we've turned our (non-responsive) template from this:</p><div><img src="img/BO5194_14_11.jpg" alt="Setting up our demo"/></div><p>…to this view, where our content clearly fits the smaller screen better:</p><div><img src="img/BO5194_14_12.jpg" alt="Setting up our demo"/></div><p>Even though it's only a small part of the changes made, is directly responsible for making our template responsive, it goes to show that incorporating <code class="literal">cssnext</code> into our processes is easier than you <a id="id883" class="indexterm"/>might think!</p><p>Okay, let's move on: we're going to take a look at a couple more plugins, but with a twist. We'll first look at using a plugin to provide support for a new color being introduced as part of CSS4, before using it as a basis for fixing a keyword issue that should have been fixed a long time ago!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch14lvl1sec115"/>Creating plugins to provide extra CSS4 support</h1></div></div></div><p>Throughout the course of this chapter, we've covered a number of plugins that handle support for the upcoming CSS4 standards, and explored how we can use the <code class="literal">cssnext</code> plugin pack to<a id="id884" class="indexterm"/> manage the transition to using these new styles.</p><p>There is more out there that we can do—the great thing about PostCSS is that we can absolutely write our own plugins to help bolster support for CSS4 attributes. To help prove this, over the next few pages we'll work our way through fixing some issues in CSS, and altering an existing CSS4 color plugin to add support for a different color; we'll start with adding a little color to our next demo, if you pardon the pun!</p><div><div><div><div><h2 class="title"><a id="ch14lvl2sec148"/>Adding future color support to CSS</h2></div></div></div><div><blockquote class="blockquote"><p><em>"She made it to six. For almost twelve hours, she was six…"</em></p></blockquote></div><p>There is something<a id="id885" class="indexterm"/> of a poignant twist to this next demo—the color <code class="literal">rebeccapurple</code>, which forms the basis for this next exercise, came about as a tribute to Eric Meyer's daughter, Rebecca, who passed away on her sixth birthday in June 2014, due to cancer.</p><p>As anyone who spends any time developing CSS styles will know, Eric has been a major advocate of web standards, and in particular CSS—it is often said that one would be hard pushed not to read a book about CSS during their development that had not been written by Eric! The community proposed the addition of <code class="literal">rebeccapurple</code> as a color in Rebecca's memory (it was her favorite color), and in recognition of Eric's contribution. It was announced by the CSS Working Group that the change had been approved, to be added as part of the upcoming CSS4 standard.</p><p>To help support the change for browsers that have not yet caught up, the developer Maxime Thirouin created a PostCSS plugin to transform the <code class="literal">rebeccapurple</code> color to the more<a id="id886" class="indexterm"/> compatible format of <code class="literal">rgb(102, 51, 153)</code>—the source for this plugin is available at <a class="ulink" href="https://github.com/postcss/postcss-color-rebeccapurple">https://github.com/postcss/postcss-color-rebeccapurple</a>.</p><p>Let's take a look at the plugin in more detail:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the <code class="literal">postcss-color-rebeccapurple</code> plugin, so go ahead and fire up a Node.js command prompt, and change the working folder to our project root.</li><li class="listitem">At the prompt, go ahead and enter the following command:<div><pre class="programlisting"><strong>npm install postcss-color-rebeccapurple –save-dev </strong>
</pre></div><p>Then press <em>Enter</em>—if all is well, we should see something akin to this screenshot:</p><div><img src="img/BO5194_14_13.jpg" alt="Adding future color support to CSS"/></div><p>Keep the window open—we'll need it shortly.</p></li><li class="listitem">Next, go ahead and extract a copy of the <code class="literal">T72 - adding rebeccapurple color</code> folder from the code download that accompanies this book—save the folder to the root of our project area.</li><li class="listitem">Copy the <code class="literal">styles – pre-compile.css</code> from within the <code class="literal">T72 - adding rebeccapurple color</code> folder to the root <code class="literal">src</code> folder of our project area, and rename as <code class="literal">styles.css</code></li><li class="listitem">Copy the<a id="id887" class="indexterm"/> <code class="literal">gulpfile.js</code> and <code class="literal">package.json</code> files from the <code class="literal">T72 - adding rebeccapurple color</code> folder to the root of our project area.</li><li class="listitem">Revert to the Node.js command prompt session, then enter <code class="literal">gulp</code> at the prompt and press <em>Enter</em>.</li><li class="listitem">When compilation has finished, copy the contents of the <code class="literal">dest</code> folder from the root of our project area to the <code class="literal">css</code> folder under <code class="literal">T72 - adding rebeccapurple color</code>.</li><li class="listitem">Try previewing the results—if all is well, we should see this simple box, which has been backfilled with the color <code class="literal">rebeccapurple</code>:<div><img src="img/BO5194_14_14.jpg" alt="Adding future color support to CSS"/></div></li></ol></div><p>To prove it works, have a look at the <code class="literal">.css</code> file from within the <code class="literal">css</code> folder under <code class="literal">T72 - adding rebeccapurple color</code>—we should see the compiled RGB value within:</p><div><img src="img/BO5194_14_15.jpg" alt="Adding future color support to CSS"/></div><p>We can also <a id="id888" class="indexterm"/>validate this with a quick check using a site such as <em>ColorHexa.com</em>—check out <a class="ulink" href="http://www.colorhexa.com/663399">http://www.colorhexa.com/663399</a>; searching for <code class="literal">rebecca purple</code> will show the same page.</p><p>There is a perfect opportunity here—I believe that there is always something good that can come from<a id="id889" class="indexterm"/> something tragic. Leaving aside the <em>raison d'être</em> for this plugin, we can use it as a basis for adding support for additional colors from the CSS4 Color Module standard.</p><p>The changes we need to make are relatively straightforward, and can easily form the basis for a new plugin. Let's take a look at what's involved; for this demo we will use <code class="literal">burlywood</code>, which is a light shade of brown:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by editing our CSS file—open up <code class="literal">styles.css</code> in the <code class="literal">src</code> folder under the root of our project area and change the highlighted line as indicated:<div><pre class="programlisting">      #box {
        background-color: <strong>burlywood;</strong>
        height: 10rem;</pre></div></li><li class="listitem">Next, we need to update the <code class="literal">rebeccapurple</code> plugin file to change existing color references to use the new color—we'll start with the initial declaration:<div><pre class="programlisting">      var postcss = require("postcss")
      var color = require("color")(<strong>"burlywood</strong>").rgbString()</pre></div><div><div><h3 class="title"><a id="note67"/>Note</h3><p>The plugin <code class="literal">index.js</code> file can be found within the <code class="literal">node_modules\postcss-color-rebeccapurple\</code> folder.</p></div></div></li><li class="listitem">We then need to change the check made in the code that changes each instance of the color:<div><pre class="programlisting">      if (value &amp;&amp; value.indexOf("<strong>burlywood</strong>") !== -1) {
        decl.value = value.replace(/(<strong>burlywood</strong>)\b/gi, color)
      }
    })</pre></div></li><li class="listitem">For now, go ahead and save the file—yes, the plugin name doesn't represent the color, but this is only a test, so it won't matter.</li><li class="listitem">Fire up a Node.js command prompt, then change the working folder to our project area. At the prompt, enter <code class="literal">gulp</code> then press <em>Enter</em>.</li><li class="listitem">Copy the contents of the root <code class="literal">dest</code> folder to the <code class="literal">css</code> folder in the <code class="literal">T73 - adding support for new color</code> folder.</li><li class="listitem">Run <code class="literal">testpage.html</code>—if all is well, we can see the compiled RGB value within, as before:<div><img src="img/BO5194_14_16.jpg" alt="Adding future color support to CSS"/></div></li><li class="listitem">Try re-running<a id="id890" class="indexterm"/> the <code class="literal">testpage.html</code> file from within the <code class="literal">T73 - adding support for new color</code> folder; we should see the change in color (and yes, it's definitely not purple!):<div><img src="img/BO5194_14_17.jpg" alt="Adding future color support to CSS"/></div></li></ol></div><p>We can verify that the color displayed is indeed <code class="literal">burleywood</code>, using the same principle as before. This time check <a id="id891" class="indexterm"/>out <a class="ulink" href="http://www.colorhexa.com/deb887">http://www.colorhexa.com/deb887</a>, which clearly shows the HEX and RGB values:</p><div><img src="img/BO5194_14_18.jpg" alt="Adding future color support to CSS"/></div><p>All that remains for you now is to convert this into a plugin. This should be easy to do: try taking a copy of the existing <code class="literal">rebeccapurple</code> plugin, then performing a search and replace with the color of your choice. It's not perfect, but will give you a head start—the next part will be to use what we learnt back in <a class="link" href="ch08.html" title="Chapter 8. Creating PostCSS Plugins">Chapter 8</a>, <em>Creating PostCSS Plugins</em>, to turn it into a fully-fledged plugin available in the NPM repository.</p><div><div><h3 class="title"><a id="tip34"/>Tip</h3><p>To get a list of the <a id="id892" class="indexterm"/>CSS4 Module colors, have a look on Google—there are plenty of links; try this as a start: <a class="ulink" href="https://github.com/segundofdez/css4-colors/blob/master/less/colors.less">https://github.com/segundofdez/css4-colors/blob/master/less/colors.less</a>.</p></div></div><p>Okay, time to<a id="id893" class="indexterm"/> change focus: although this chapter is meant to be about looking forward, we're going to change direction and look backwards for a moment.</p><p>The reason for this? A number of mistakes in the design of CSS have been acknowledged by the CSS Working Group. A PostCSS plugin by Jonathan Neal provides a short-term fix for a number of these issues—some which could well be fixed properly in a future version of CSS!</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec149"/>Going back in time</h2></div></div></div><p>When developing code, I'm a great fan of only developing for modern browsers as a rule—ideally <em>n-1</em>, or current plus one previous version. In the main, this isn't an issue for the likes of Firefox or Chrome, but it's a different story for IE. Where possible, older versions of IE will very likely be left by the wayside…but that's another story!</p><p>The one exception we<a id="id894" class="indexterm"/> can make though is not around browser support, but trying to correct some issues with attribute naming. The CSS Working Group have<a id="id895" class="indexterm"/> acknowledged that some of the attribute names weren't defined correctly when they were released—you can see a complete list at <a class="ulink" href="https://wiki.csswg.org/ideas/mistakes">https://wiki.csswg.org/ideas/mistakes</a>, which is regularly updated.</p><p>To help with this, and as a precursor to the second demo in this section, we're going to install the Time Machine plugin for PostCSS (hence the title of this section!). This provides a short-term fix for some of the bugs in CSS. We will then use this as inspiration to design a quick and dirty plugin to fix another bug that is listed on the CSSWG site, but which is not fixed by the Time Machine plugin.</p><div><div><h3 class="title"><a id="note68"/>Note</h3><p>The source<a id="id896" class="indexterm"/> for this plugin is available from <a class="ulink" href="https://github.com/jonathantneal/postcss-time-machine">https://github.com/jonathantneal/postcss-time-machine</a>.</p></div></div><p>For this demo, we will reuse the simple demo created to display the <code class="literal">rebeccapurple</code> color from <em>Adding future color support to CSS</em>. The compiled results from that demo use an RGBA function—the CSSWG have stated that RGBA should not exist, and instead the alpha channel should have been added as the fourth channel for the <code class="literal">RGB()</code> function. We'll fix that as part of our demo—the plugin will allow us to write what was intended, whilst compiling it to code that can be understood by any browser.</p><p>Let's make a start on installing the plugin for use in our demo:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by<a id="id897" class="indexterm"/> installing the plugin, so go ahead and fire up a Node.js command prompt session, then change the working folder to our project area.</li><li class="listitem">At the prompt, enter this command and press <em>Enter</em>:<div><pre class="programlisting"><strong>npm install postcss-time-machine --save-dev</strong>
</pre></div><p>If all is well, we should see something akin to this screenshot—keep the session open, as we will need it shortly:</p><div><img src="img/BO5194_14_19.jpg" alt="Going back in time"/></div></li><li class="listitem">Next, go ahead and extract a copy of the <code class="literal">T74 - going back in time</code> folder from the code download that accompanies this book—save the folder to the root of our project area.</li><li class="listitem">Copy the <code class="literal">styles – pre-compile.css</code> from within the <code class="literal">T74 - going back in time </code>folder to the root <code class="literal">src</code> folder of our project area, and rename it <code class="literal">styles.css</code>.</li><li class="listitem">Copy the <code class="literal">gulpfile.js</code> and <code class="literal">package.json</code> files from the same <code class="literal">T74 - going back in time</code> folder to the root folder of our project area.</li><li class="listitem">Revert to the Node.js command prompt, then at the prompt, enter <code class="literal">gulp</code> and press <em>Enter</em>.</li><li class="listitem">If all is well, we should see our usual compiled files appear in the <code class="literal">dest</code> folder—copy these to the <code class="literal">css</code> folder under <code class="literal">T74 - going back in time</code>.<div><img src="img/BO5194_14_20.jpg" alt="Going back in time"/></div></li></ol></div><p>At this point, try previewing the results of our demo, if all is well, we should see the same box as before, but this time with a slightly lighter shade of <code class="literal">rebecca purple</code> as its color:</p><p>If we take a look at the CSS styles though, the keen-eyed may spot something—how come we're using <code class="literal">194</code> as our alpha value, yet the code shows <code class="literal">0.8</code>? The answer is simple: this plugin was designed to use <code class="literal">0</code> to<code class="literal"> 255</code> for each value, including the alpha channel. Simply divide <code class="literal">194</code> by<code class="literal"> 255</code>:</p><div><img src="img/BO5194_14_21.jpg" alt="Going back in time"/></div><p>The<a id="id898" class="indexterm"/> answer is <code class="literal">0.8</code>. Okay, you will actually get something like <code class="literal">0.76078</code>, but if we round up to one decimal place, this will become <code class="literal">0.8</code>:</p><div><img src="img/BO5194_14_22.jpg" alt="Going back in time"/></div><p>Now, before we continue, there is something we should consider: the practical application of this plugin. It's not meant to pour cold water on a nice idea, but adoption may take a little time—developers in a team will be used to writing styles that include functions such as <code class="literal">rgba()</code>, <code class="literal">background-blend-mode</code>, or <code class="literal">hsla()</code>, so it may take some time to change the mindset!</p><p>This said, it is a useful fix if we want to adhere to the intended standards, and can manage the change of mindset to not type function names that we may have been doing for some time. We can even take things a step further and create our own plugin—Time Machine doesn't include fixes for all of the attributes, so let's take a look at creating one to manage the bug that surrounds the <code class="literal">background-blend-mode</code> attribute in CSS.</p></div><div><div><div><div><h2 class="title"><a id="ch14lvl2sec150"/>Creating our own plugin</h2></div></div></div><p>One of the attributes not fixed by the Time Machine plugin is the <code class="literal">background-blend-mode</code> function—this is normally used to calculate the final color pixel when layers overlap each other.</p><p>The bug that was<a id="id899" class="indexterm"/> introduced relates to the name—the <strong>CSS Working Group</strong> (<strong>CSSWG</strong>) have <a id="id900" class="indexterm"/>acknowledged that all blend-mode variants should be written without -mode in the name, so that in our case, background-blend-mode would be written as <code class="literal">background-blend</code>.</p><p>It's an easy fix to make, here's a perfect opportunity for you to try creating your own plugin! We're going to take a different route at this point—time for some audience participation, so to speak!</p><p>To help you <a id="id901" class="indexterm"/>along the way, it's worth taking another look at <a class="link" href="ch08.html" title="Chapter 8. Creating PostCSS Plugins">Chapter 8</a>, <em>Creating PostCSS Plugins</em>; when creating the plugin, we can use this code:</p><div><pre class="programlisting">var postcss = require('postcss');
 
module.exports = postcss.plugin('backgroundblend', function backgroundblend(options) {
  return function (css) {
    options = options || {};
         
    // Processing code will be added here
    css.eachDecl('background-blend', function (decl) {
      if (decl.prop.indexOf('background-blend') !== -1) {
        decl.prop  = 'background-blend-mode';
      }
    });
  };
});</pre></div><p>Most of this code is boilerplate, but the key to making this work is this excerpt:</p><div><pre class="programlisting">    css.eachDecl('background-blend', function (decl) {
      if (decl.prop.indexOf('background-blend') !== -1) {
        decl.prop = 'background-blend-mode';
      }
    });</pre></div><p>In a nutshell, we parse each CSS rule in turn—if any contain background-blend, we simply replace each instance with background-blend-mode.</p><p>To prove it works, we can use the following code to test if our plugin works:</p><div><pre class="programlisting">&lt;!DOCType html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Demo: Creating new plugin to change blend-mode&lt;/title&gt;
  &lt;link rel="stylesheet" type="text/css" href="css/styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="div"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>If all is well, we should get something akin to this screenshot:</p><div><img src="img/BO5194_14_23.jpg" alt="Creating our own plugin"/></div><p>If you get stuck, then a completed version is available in the code download that accompanies this book; a quick peek in the <code class="literal">T75 - back in time change </code>folder for <code class="literal">styles – pre-compile.css</code> will show this:</p><div><img src="img/BO5194_14_24.jpg" alt="Creating our own plugin"/></div><p>When compiled, we can clearly see it shows the version we will be used to seeing:</p><div><img src="img/BO5194_14_25.jpg" alt="Creating our own plugin"/></div><p>It's a quick and <a id="id902" class="indexterm"/>dirty plugin, which will likely need a little more development before putting it into production use—for example, it caters purely for background-blend-mode, whereas we should support any attribute that contains blend-mode within the name!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch14lvl1sec116"/>Summary</h1></div></div></div><p>Creating CSS styles opens up a world of possibilities: we are only limited by what we must support! Throughout the course of this chapter, we've explored some of the possible options we can use when working with the newer CSS4 styles—let's take a moment to review what we have learnt.</p><p>We kicked off with a quick introduction to what we know as CSS4—we then moved on to explore some of the plugins that cater for supporting newer styles with more compatible CSS equivalent code.</p><p>Up next came a simple demo that explored some of the new CSS4 pseudo-classes, and how we might use them in a (theoretical) context. We then moved onto something more practical, in the form of styling the new range input using just CSS.</p><p>Moving swiftly on, we then took a look at the cssnext plugin pack, which provides an abstract layer for supporting CSS4; we saw how easy it is to implement, and that we can easily switch off functionality if it is no longer needed in our projects.</p><p>Our next demo came in the form of working with color—we used the <code class="literal">rebeccapurple</code> plugin to show firstly how easy it is to add support for one of the new colors within CSS4, then to modify it to provide support for other colors as needed in our projects. We then rounded out the chapter with a look back in time at some of the mistakes made when CSS was released, and how (with a little imagination), we might provide a temporary workaround until such time as these mistakes are fixed in a future version of CSS.</p><p>We've now come to the end of the book - I hope you've enjoyed our journey through the world of PostCSS, and that hopefully this book will help improve your skills as a future developer or user of PostCSS.</p></div></body></html>