<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Manage Audio in Babylon.js</h1></div></div></div><p>In the last chapter, you started adding dynamism to your scenes by adding collisions checks and physics simulations. Another important feature is handling sounds in your scenes and finally making it more alive. This chapter not only explains sound management with Babylon.js in order to create soundtrack sounds, but also spatialized sounds (3D). In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Playing 2D sounds</li><li class="listitem" style="list-style-type: disc">Playing 3D sounds</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec26"/>Playing 2D sounds</h1></div></div></div><p>The Babylon.js framework provides an audio engine based on WebAudio. It allows you to easily add 2D and 3D sounds using the provided tools that are developed for you by the Babylon.js team.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec47"/>Creating 2D sounds</h2></div></div></div><p>The Babylon.js framework provides a <code class="literal">BABYLON.Sound</code> class. This class allows you to create and manage 2D and 3D sounds for your scene. To add a sound, the only thing you need to do is to create a new <code class="literal">BABYLON.Sound</code> object, as follows:</p><pre class="programlisting">var sound = new BABYLON.Sound("sound_name", "sound_file", scene); &#13;
</pre><p>You can now get access to methods such as <code class="literal">.play</code>, <code class="literal">.pause</code>, and <code class="literal">.stop</code>.</p><p>In fact, the sounds are loaded asynchronously so that you cannot call <code class="literal">sound.play()</code> right after creating the new sound object. This is why the <code class="literal">BABYLON.Sound</code> constructor provides a <code class="literal">readyToPlayCallback</code> parameter after the scene in order to handle the loading process. To play the sound when loaded, simply set the <code class="literal">readyToPlayCallback</code> parameter, as follows:</p><pre class="programlisting">var sound = new BABYLON.Sound("sound_name", "sound_file", scene, () =&gt; { &#13;
   sound.play(); &#13;
}); &#13;
</pre><p>Fortunately, the developers thought about this behavior and provided a last parameter named <code class="literal">options</code>. This parameter allows you to automatically set the default behaviors instead of managing them in the ready-to-play callback. The <code class="literal">options</code> parameter is optional and is an object that looks similar to the following:</p><pre class="programlisting">var sound = new BABYLON.Sound("sound_name", "sound_file", scene, () =&gt; { &#13;
}, { &#13;
   loop: true, // [Boolean] plays sounds in loop mode &#13;
   autoPlay: true, // [Boolean] plays the sound after loading &#13;
   volume: 1.0, // Between [Number [0, 1]] volume of sound &#13;
   playbackRate: 1.0 // [Number 1.0] playing speed &#13;
   spatialSound: false, [Boolean] is a 3D sound &#13;
   maxDistance: 100, [Boolean] maximum distance of 3D sound &#13;
}); &#13;
</pre><p>The <code class="literal">autoPlay</code> parameter will automatically play the sound when loaded and you don't have to manage the sound in the ready-to-play callback.</p><p>The Babylon.js framework still keeps things simple as you already added an audio track to your scene only by calling a <code class="literal">new</code> statement on the <code class="literal">BABYLON.Sound</code> class.</p><p>Of course, you can play several sounds in a single scene, as shown in the following code:</p><pre class="programlisting">var options = { &#13;
   loop: true, &#13;
   autoPlay: true &#13;
};  &#13;
var sound1 = new BABYLON.Sound("sound1", "sound1.mp3", scene, null, options); &#13;
var sound2 = new BABYLON.Sound("sound2", "sound2.mp3", scene, null, options); &#13;
</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec48"/>Managing 2D sounds</h2></div></div></div><p>There are several properties to manipulate a sound in 2D , such as the volume, whether the sound is playing or not, and so on.</p><p>To set the sound's volume, just call the <code class="literal">.setVolume</code> function of the sound. The new volume is set in the [0, 1] interval, as shown in the following code:</p><pre class="programlisting">sound.setVolume(0.5); &#13;
</pre><p>You can also get the volume, as shown in the following code:</p><pre class="programlisting">var currentVolume = sound.getVolume(); &#13;
</pre><p>You can check the current state of a sound any time, as follows:</p><pre class="programlisting">    sound.isPlaying; // true if the sound is playing&#13;
    sound.isPaused // true if the sound was paused&#13;
</pre><p>You can also set the sound's state any time, as follows:</p><pre class="programlisting">    sound.play(); // Plays the sound&#13;
    sound.pause(); // Pauses the sound&#13;
    sound.stop(); // Stops the sound&#13;
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec27"/>Playing 3D sounds</h1></div></div></div><p>In the previous topic, you added and played 2D sounds in a scene. These 2D sounds can be easily used as soundtracks for your games. To add dynamism to your scenes, as physics and collisions do, you can configure the sounds to be spatialized in a scene. The spatialized sounds, which are called 3D sounds, give give the notion of distance and orientation between the player and the sound. In other words, more the player is far from the sound, more the sound will be attenuated. Also, if the sound position is rather on the right of the player, the right speaker will generate more sound than the left speaker and vice versa.</p><p>For example, if the sound is emitted on your right, only the right speaker(s) should play it and the farther you are from the sound, the lower the sound's volume should be.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec49"/>Creating 3D sounds</h2></div></div></div><p>You can imagine that, as for the 2D sounds, you can create a spatialized sound using the same <code class="literal">BABYLON.Sound</code> constructor. Only the <code class="literal">options</code> parameter will change as you have to set <code class="literal">spatialSound</code> to <code class="literal">true</code>, as follows:</p><pre class="programlisting">    var sound = new BABYLON.Sound("sound", "sound_file", scene, () =&gt; {&#13;
       sound.play();&#13;
    }, { spatialSound: true });&#13;
</pre><p>Once you have created the spatialized sound, you can set its 3D position in the scene's world using a <code class="literal">BABYLON.Vector3</code>, as follows:</p><pre class="programlisting">    sound.setPosition(new BABYLON.Vector3(0, 0, 50)); // For example&#13;
</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec50"/>Managing 3D sounds</h2></div></div></div><p>In contrast to the 2D sounds, you can customize more properties with 3D sounds. Spatialized sounds provide properties to configure the attenuation and panning model.</p><p>For example, the default distance model (attenuation) is set to be linear. Two other models such as <code class="literal">exponential</code> and <code class="literal">inverse</code> exist, as follows:</p><pre class="programlisting">    sound.distanceModel = "exponential";&#13;
</pre><p>As for the fog (<a class="link" href="ch04.html" title="Chapter 4. Using Materials to Customize 3D Objects Appearance">Chapter 4</a>, <em>Using Materials to Customize 3D Objects Appearance</em>), the linear model says that the farther away the player is from the sound source, the lower the sound will be following a linear function (the threshold of 0 volume is set by the <code class="literal">maxDistance</code> property). The exponential model is a variant of the linear model by following an exponential function.</p><p>The <code class="literal">maxDistance</code> property can be set only if the distance model is linear, as follows:</p><pre class="programlisting">sound.updateOptions({&#13;
maxDistance: 10 // If the player's distance to the sound is &gt;= 10 then the volume will be 0&#13;
});</pre><p>As for the <code class="literal">maxDistance</code> property, you can set the <code class="literal">rolloffFactor</code> property if you're using an exponential model, as shown in the following code:</p><pre class="programlisting">sound.updateOptions({&#13;
rolloffFactor: 2&#13;
});</pre><p>Of course, you can update multiple values at the same time. Just configure the <code class="literal">.updateOptions</code> parameter with the values. Consider the following as an example:</p><pre class="programlisting">sound.updateOptions({&#13;
maxDistance: 10,&#13;
rolloffFactor: 2&#13;
});</pre><p>The last useful function for spatialized sounds is to directly attach a sound to a mesh. Then, it is not required to update the sound's position manually to set it to the mesh's position, as follows:</p><pre class="programlisting">sound.attachToMesh(myMesh);</pre><p>Now, the sound and mesh share the same position and are updated together by the scene when you call <code class="literal">scene.render()</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec51"/>Creating a directional spatialized sound</h2></div></div></div><p>The previous spatialized sounds that you created were omnidirectional. This means that if you are behind a speaker, you'll hear the sound as loud as when you are in front of the speaker. Something that does not happen in real life. The Babylon.js audio engine provides a way to create directional sounds that are easily configurable.</p><div><div><h3 class="title"><a id="note10"/>Note</h3><p>Note that direction-spatialized sounds work only when the sound is attached to a mesh.</p></div></div><p>Let's start with the following sound reference:</p><pre class="programlisting">var sound = new BABYLON.Sound("sound", "sound_file", scene, () =&gt; {&#13;
}, { loop: true, autoplay: true });</pre><p>You can configure it to be directional by calling only three functions.</p><p>First, the direction of the sound is represented by a cone. Just set the direction cone, as follows:</p><pre class="programlisting">sound.setDirectionalCone(90, 180, 0.1); // Values are in degree</pre><p>There are three parameters, which are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The size of the inner cone (in degrees) should be smaller than the outer cone</li><li class="listitem" style="list-style-type: disc">The size of the outer cone (in degrees) should be larger than the inner cone</li><li class="listitem" style="list-style-type: disc">The volume of the spatialized sound when the player is outside the outer cone</li></ul></div><p>For a perfect directional sound, the sizes of the inner and outer cone should be equal.</p><p>Once the directional cone is set, just set the direction of the sound according to the mesh rotation. The parameter is local to the mesh. Then, if you rotate the speaker, for example, the sound will always follow the speaker's rotation, depending on the parameter. Consider the following example:</p><pre class="programlisting">sound.setLocalDirectionToMesh(new BABYLON.Vector3(0, 0, 1)); // Always speak ahead (Z is the forward axis)</pre><p>Finally, don't forget to attach the sound to the mesh, as follows:</p><pre class="programlisting">sound.attachToMesh(myMesh); // myMesh should be the speaker in the example</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec28"/>Summary</h1></div></div></div><p>This quick chapter demonstrates that using sounds (2D and 3D) in a 3D engine can be easy when powerful tools are provided to the developer. The example files create a 2D sound that is played as a soundtrack and a 3D sound located at the box's position. Do not hesitate to play with the distance models and check the effects using your headphones.</p><p>In the next chapter, we'll try to automate some things using the <code class="literal">ActionManager </code>class of Babylon.js. This class is useful for executing actions on objects when a trigger is raised. For example, if the player left-clicks on the box, it plays the sound named <code class="literal">my_sound.wav</code>. It's also the time to introduce 
<strong>Actions Builder</strong>, which is a part of the Babylon.js 3ds Max exporter. Actions Builder allows artists (and developers) to create actions on their objects without any lines of code.</p></div></body></html>