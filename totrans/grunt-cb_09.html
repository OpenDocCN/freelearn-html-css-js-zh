<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Authoring Plugins" id="aid-2PKKS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Authoring Plugins</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Finding plugins</li><li class="listitem">Contributing to a plugin</li><li class="listitem">Setting up a basic plugin project</li><li class="listitem">Creating a plugin task</li><li class="listitem">Writing tests for a plugin task</li><li class="listitem">Adding documentation for a plugin</li><li class="listitem">Publishing a plugin</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Introduction</h1></div></div></div><p>For the most part, Grunt<a id="id436" class="indexterm"/> is a framework that allows developers to package and configure the various tools available to web application developers in a uniform fashion. In the Grunt sphere, tools are packaged into what are called plugins, and these plugin packages all conform to Grunt operation and configuration conventions.</p><p>Some of the more popular plugins are provided by the Grunt core team, but all the others are contributed by the community of developers that use Grunt in their projects. Now that we're making use of Grunt in our project, we are part of this community, and we can take it upon ourselves to assist in the creation and maintenance of these plugins.</p></div></div>
<div class="section" title="Finding plugins" id="aid-2QJ5E1"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Finding plugins</h1></div></div></div><p>Before we <a id="id437" class="indexterm"/>even consider creating a plugin of our own, we should first determine whether there isn't already a plugin out there that will satisfy our requirements. In most cases, you will find that someone else has already ventured to solve the problems you are faced with now, and has done most if not all the work for you.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec206"/>Getting ready</h2></div></div></div><p>The most obvious place to start looking for a plugin would be on the Internet. So the first thing we'll need to do is open our favorite web browser and get ready to navigate.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec207"/>How to do it...</h2></div></div></div><p>The following <a id="id438" class="indexterm"/>steps will take us through navigating to the Grunt project's website and using it to search for a plugin that we can use to run tasks concurrently.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll navigate to the official Grunt plugin listing page by entering the following URL in our<a id="id439" class="indexterm"/> web browser: <a class="ulink" href="http://gruntjs.com/plugins">http://gruntjs.com/plugins</a>.</li><li class="listitem">Next, we'll select the search input textbox that should look something like the following:<div class="mediaobject"><img src="../Images/image00277.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">With the textbox selected, we can now proceed to type the term we wish to search for; in this case we'll be entering <code class="literal">concurrent</code> as our search term:<div class="mediaobject"><img src="../Images/image00278.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Once we've finished typing, we should see the list automatically loading for a little while and then display the search results:<div class="mediaobject"><img src="../Images/image00279.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now that <a id="id440" class="indexterm"/>we see a plugin listed that looks like it might be what we're looking for, we can click on the list item to review its documentation. The installation instructions for the plugin should usually be somewhere near the top of the documentation page.<div class="mediaobject"><img src="../Images/image00280.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Contributing to a plugin" id="aid-2RHM01"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Contributing to a plugin</h1></div></div></div><p>Once you've <a id="id441" class="indexterm"/>found a plugin that closely matches your needs, you might find that some aspect of it is either broken, incomplete, or missing. This is where you can step in and contribute to the project in a variety of ways.</p><p>Contributing to a plugin project provides you with the advantage of getting exactly what you want from it, without having to create the entire project yourself. It's also beneficial to others, such as yourself, who have encountered the issue you face or require the same additional features.</p><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec208"/>Getting started</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">A <span class="strong"><strong>GitHub</strong></span> account is <a id="id442" class="indexterm"/>required to make any of the contributions mentioned in this recipe. If you don't already have an account, creating one is as simple as visiting GitHub's home page and filling out the registration form there at <a class="ulink" href="https://github.com/">https://github.com/</a>.<div class="note" title="Note"><h3 class="title"><a id="tip109"/>Tip</h3><p>The following URL provides another good all-round introduction to Git and GitHub:</p><p><a class="ulink" href="https://guides.github.com/activities/hello-world/">https://guides.github.com/activities/hello-world/</a></p></div></li><li class="listitem">Familiarize <a id="id443" class="indexterm"/>yourself with the practice of creating <span class="strong"><strong>issues</strong></span> in the GitHub Issues section. The mechanism to create and manage issues is quite simple, but it's very important to apply good practices when making use of it. Well-written issues make all the difference and will help you get what you need in a shorter period of time. You can find out more about good issue-writing practices at the following location:<p><a class="ulink" href="http://wiredcraft.com/posts/2014/01/08/how-we-write-our-github-issues.html">http://wiredcraft.com/posts/2014/01/08/how-we-write-our-github-issues.html</a></p></li><li class="listitem">In order to retrieve the code and documentation for any of the plugin projects, you will need to have the Git version control software installed. You can find out more about the various installation options for Git at the following URL:<p><a class="ulink" href="http://git-scm.com/book/en/v1/Getting-Started-Installing-Git">http://git-scm.com/book/en/v1/Getting-Started-Installing-Git</a></p></li><li class="listitem">If you'd like to contribute the changes to code or documentation that you've made to a project hosted on GitHub, you will have to familiarize yourself with the pull request workflow. More information on the pull request workflow can be found at the following URL:<p><a class="ulink" href="https://help.github.com/articles/using-pull-requests/">https://help.github.com/articles/using-pull-requests/</a></p></li><li class="listitem">To get the best out of your contribution efforts to the Grunt project and its plugins, be sure to familiarize yourself with the Grunt contribution guide, which can be found at the following URL:<p><a class="ulink" href="http://gruntjs.com/contributing">http://gruntjs.com/contributing</a></p></li><li class="listitem">Be sure to carefully study the documentation of the project that 're considering contributing to ensure that you are using it correctly, and that the feature that you're looking for is not already available. The documentation of a Grunt plugin project should always be found in the <code class="literal">README.md</code> file in the root of the project's repository.<div class="note" title="Note"><h3 class="title"><a id="tip110"/>Tip</h3><p>GitHub will display the <code class="literal">README.md</code> document located in the repository root as the repository's home page by default.</p></div></li><li class="listitem">Each project might also have its own specific contribution guidelines that need to be followed. These are usually found either at the end of <code class="literal">README.md</code> or in the <code class="literal">CONTRIBUTING.md</code> document at the root of the project's repository.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec209"/>How to do it...</h2></div></div></div><p>There are many <a id="id444" class="indexterm"/>ways to contribute to an existing plugin. Let's list them according to their difficulty, starting with the simplest one:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Helping with an existing issue by commenting on it's contents, reproducing it's error, or providing a resolution to the stated problem.</li><li class="listitem">Adding issues for faults as you encounter them. Keep in mind that a new issue is only helpful if you clearly state the context and problem. What's even more helpful is to provide a potential solution to the problem if you can think of one.<div class="note" title="Note"><h3 class="title"><a id="tip111"/>Tip</h3><p>Be sure to check for existing issues with a similar subject. If the issue focuses on the same subject, it is usually better to just add to it. However, if it slightly differs from the existing one, it might be a good idea to refer to it in a new issue.</p><p>It's also recommended to review the documentation of a plugin before submitting an issue. This is to ensure that the issue or behavior you experience is not expected and that you are actually using the plugin as intended by its authors.</p></div></li><li class="listitem">Adding issues for possible improvements. As always, it's important to clearly state the context and concept of the improvement.<div class="note" title="Note"><h3 class="title"><a id="tip112"/>Tip</h3><p>Be sure to check issues and pull requests to see whether the feature has not been requested or developed yet. Also, review the documentation to ensure that it is not yet available in some other form.</p></div></li><li class="listitem">Submitting updates and improvements to the documentation of the plugin. This requires forking the plugin project and submitting a pull request that contains the changes.</li><li class="listitem">Resolving issues and submitting the changes to the code base. This requires forking the project and submitting a pull request. If the reported issue is not breaking tests yet, it's essential to add a test for the specific use case that was causing the error.</li><li class="listitem">Implementing <a id="id445" class="indexterm"/>new features and submitting the changes to the code base. This requires forking the plugin project and submitting a pull request. Keep in mind that adding a feature requires the documentation for the project to be updated and tests to be created that ensure that the new feature behaves as documented.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Setting up a basic plugin project" id="aid-2SG6I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Setting up a basic plugin project</h1></div></div></div><p>At the base <a id="id446" class="indexterm"/>of every Grunt plugin lies a Node.js project that contains information about its purpose, version, dependencies, and so forth. Due to the basic project structure for all Grunt plugins being pretty much the same, we'll make use of a project generator to provide us with a starting point.</p><p>In this recipe, we'll make use of the <a id="id447" class="indexterm"/>
<span class="strong"><strong>Yeoman</strong></span> project's scaffolding tool to generate our basic Grunt plugin project. It provides generators for a large variety of project setups, all of which have Grunt as their core automation tool.</p><div class="note" title="Note"><h3 class="title"><a id="tip113"/>Tip</h3><p>You can learn more about the <a id="id448" class="indexterm"/>Yeoman project at the following URL:</p><p><a class="ulink" href="http://yeoman.io/">http://yeoman.io/</a></p></div><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec210"/>Getting started</h2></div></div></div><p>The only requirement for this recipe is a global installation of Node.js, with Grunt installed into it as per the <span class="emphasis"><em>Installing the Grunt CLI</em></span> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <span class="emphasis"><em>Getting Started with Grunt</em></span>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec211"/>How to do it...</h2></div></div></div><p>The following steps take us through installing the Yeoman tool and using it to generate a basic Grunt plugin project.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we'll need to install the Yeoman tool globally using the <a id="id449" class="indexterm"/><span class="strong"><strong>npm</strong></span> utility. This is done by entering the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm install --global yo</strong></span>
</pre></div></li><li class="listitem">We'll also need to install the Yeoman generator that is specifically geared toward generating a Grunt plugin project. This is done by entering the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm install --global generator-gruntplugin</strong></span>
</pre></div></li><li class="listitem">Next, we'll create a directory called <code class="literal">grunt-myplugin</code>, which will contain our plugin project, and navigate to it using a command similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mkdir grunt-myplugin &amp;&amp; cd grunt-myplugin</strong></span>
</pre></div></li><li class="listitem">With<a id="id450" class="indexterm"/> Yeoman and the required generator installed, we can now use it to generate our plugin project by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ yo gruntplugin</strong></span>
</pre></div></li><li class="listitem">After running the previous command, you will be presented with a series of questions that will assist the generator in creating the project. This interaction should look something like the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>? Plugin Name: grunt-myplugin</strong></span>
<span class="strong"><strong>? Description: The best Grunt plugin ever.</strong></span>
<span class="strong"><strong>? Version: 0.0.1</strong></span>
<span class="strong"><strong>? Project git repository: git://github.com/me/grunt-myplugin</strong></span>
<span class="strong"><strong>? Project homepage: http://github.com/me/grunt-myplugin</strong></span>
<span class="strong"><strong>? License: MIT</strong></span>
<span class="strong"><strong>? Author name: Me</strong></span>
<span class="strong"><strong>? Author email: me@example.com</strong></span>
<span class="strong"><strong>? Author url: http://me.example.com/</strong></span>
<span class="strong"><strong>? What versions of node does it run on? &gt;= 0.8.0</strong></span>
<span class="strong"><strong>? What version of grunt does it need? ~0.4.2</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip114"/>Tip</h3><p>All the references to 'me' in the previous example are where you should enter your own name, account name, and credentials.</p></div></li><li class="listitem">After all the questions have been answered, the generator will create all the files required for a simple plugin with a single functioning task. The output, which is similar to the following, will inform us of these actions:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>   create tasks/myplugin.js</strong></span>
<span class="strong"><strong>   create test/expected/custom_options</strong></span>
<span class="strong"><strong>   create test/expected/default_options</strong></span>
<span class="strong"><strong>   create test/fixtures/123</strong></span>
<span class="strong"><strong>   create test/fixtures/testing</strong></span>
<span class="strong"><strong>   create test/myplugin_test.js</strong></span>
<span class="strong"><strong>   create .jshintrc</strong></span>
<span class="strong"><strong>   create .gitignore</strong></span>
<span class="strong"><strong>   create .editorconfig</strong></span>
<span class="strong"><strong>   create README.md</strong></span>
<span class="strong"><strong>   create Gruntfile.js</strong></span>
</pre></div></li><li class="listitem">With <a id="id451" class="indexterm"/>all the necessary files created, we now need to install the dependencies required for the project to function. These dependencies are listed in the generated <code class="literal">package.json</code> file and can be installed using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm install</strong></span>
</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip115"/>Tip</h3><p>This command uses the <code class="literal">package.json</code> file, which is found in the current directory, so be sure to have navigated to the <code class="literal">grunt-myplugin</code> directory we created earlier, if you have not done so already.</p></div></li><li class="listitem">The best way to confirm that the project has been successfully set up (apart from actually using it in a Grunt project) would be to run the generated tests. This can be done using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm test</strong></span>
</pre></div></li><li class="listitem">Successfully running the tests should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&gt; grunt-myplugin@0.0.1 test /home/me/projects/grunt-myplugin</strong></span>
<span class="strong"><strong>&gt; grunt test</strong></span>

<span class="strong"><strong>Running "clean:tests" (clean) task</strong></span>

<span class="strong"><strong>Running "myplugin:default_options" (myplugin) task</strong></span>
<span class="strong"><strong>File "tmp/default_options" created.</strong></span>

<span class="strong"><strong>Running "myplugin:custom_options" (myplugin) task</strong></span>
<span class="strong"><strong>File "tmp/custom_options" created.</strong></span>

<span class="strong"><strong>Running "nodeunit:tests" (nodeunit) task</strong></span>
<span class="strong"><strong>Testing myplugin_test.js..OK</strong></span>
<span class="strong"><strong>&gt;&gt; 2 assertions passed (18ms)</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Creating a plugin task" id="aid-2TEN41"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Creating a plugin task</h1></div></div></div><p>The functionality <a id="id452" class="indexterm"/>of Grunt plugins are mostly contained inside the tasks they provide. The plugin project scaffolding provided by the Yeoman tool creates one such task for us to work from or use as a reference when creating our own.</p><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec212"/>Getting started</h2></div></div></div><p>In this recipe, we'll work with the basic project structure we created in the <span class="emphasis"><em>Setting up a basic plugin project</em></span> recipe earlier in this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p><p>This recipe also contains concepts that are introduced in the <span class="emphasis"><em>Creating a multi task</em></span>, <span class="emphasis"><em>Using options in a task</em></span> and <span class="emphasis"><em>Using files in a task</em></span> recipes that can be found at the end of <a class="link" title="Chapter 8. Creating Custom Tasks" href="part0081.xhtml#aid-2D7TI1">Chapter 8</a>, <span class="emphasis"><em>Creating Custom Tasks</em></span>. Be sure to refer to these recipes if you'd like to gain a deeper understanding of the concepts they introduced.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec213"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a task that concatenates all the indicated source files, and then prepends a comment containing a timestamp and location to the result.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We'll start by creating a new file called <code class="literal">timestamp.js</code> in the <code class="literal">tasks</code> directory that will contain our task code. It's good practice to have the file that contains a task named after the task itself.</li><li class="listitem">Next, we'll set up the code module that will contain our task code and register the new task inside it by filling the new file with the following code:<div class="informalexample"><pre class="programlisting">module.exports = function (grunt) {
  grunt.registerMultiTask(
    'timestamp',
    'Perpends a files contents with a timestamp.',
    function () {
    }
  );
};</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip116"/>Tip</h3><p>The <code class="literal">module.exports</code> object<a id="id453" class="indexterm"/> is automatically made available by Node.js for each file. Whatever gets assigned to it is what will be made available when the file is imported into another file. You can read more about <code class="literal">module.exports</code> at the following URL:</p><p><a class="ulink" href="https://nodejs.org/api/modules.html#modules_module_exports">https://nodejs.org/api/modules.html#modules_module_exports</a></p></div></li><li class="listitem">The first thing we'll need to do inside our task is retrieve the options for the task target and store it in the <code class="literal">options</code> variable. We'll also provide some default values for the available options to be sure that our task works even without any options being provided. The following code takes care of this and can be added at the top of the task function:<div class="informalexample"><pre class="programlisting">var options = this.options({
  datetime: new Date(0),
  location: 'London'
});</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip117"/>Tip</h3><p>The default for the <code class="literal">datetime</code> option is the very earliest available value in the Unix time range. This value is determined by creating a standard JavaScript <code class="literal">Date</code> object and providing <code class="literal">0</code> as its only parameter.</p></div></li><li class="listitem">The <a id="id454" class="indexterm"/>next thing we'll do is create a <code class="literal">comment</code> variable that contains an empty string, and then add the contents of our comment to it piece by piece. The following code does this for us:<div class="informalexample"><pre class="programlisting">var comment = '';
comment += '// ' + options.datetime.toGMTString();
comment += ' at ' + options.location + '\n';</pre></div></li><li class="listitem">With our comment string ready, we can now concatenate all the source files, and write the comment and result to the indicated destination file. The following code does this for all files indicated in the task configuration:<div class="informalexample"><pre class="programlisting">this.files.forEach(function(file) {
  var src = file.src.map(function (path) {
    return grunt.file.read(path);
  }).join('');
  grunt.file.write(file.dest, comment + src);
});</pre></div></li><li class="listitem">Now that we've got our task registered and functional, we can add some configurations that we can test it with. Let's add two targets: one called <code class="literal">default_options</code> that tests the task without any options provided and another called <code class="literal">custom_options</code> that tests the task with all the possible options provided. We can do this by adding the following configuration in our Gruntfile:<div class="informalexample"><pre class="programlisting">timestamp: {
  default_options: {
    options: {}
  },
  custom_options: {
    options: {
      datetime: new Date(Date.UTC(2014, 0, 1)),
      location: 'New York'
    }
  }
}</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip118"/>Tip</h3><p>We're making use of the <code class="literal">Date.UTC</code> function here to ensure that the behavior of this code doesn't differ between the various time zones. Setting the date in this way will always amount to a date and time value in the GMT time zone.</p></div></li><li class="listitem">In order <a id="id455" class="indexterm"/>for these task targets to work, they will also have to indicate the source files they would like to read from and the destination file they would like the result to be written to. For our test, we'll use the files that were created by the project generator in the <code class="literal">test/fixtures</code> directory as sources, and write the result to the <code class="literal">tmp/timestamp</code> directory. This can be done by adding the following <code class="literal">files</code> configurations:<div class="informalexample"><pre class="programlisting">default_options: {
  options: {},
  <span class="strong"><strong>files: {</strong></span>
<span class="strong"><strong>    'tmp/timestamp/default_options': [</strong></span>
<span class="strong"><strong>      'test/fixtures/testing',</strong></span>
<span class="strong"><strong>      'test/fixtures/123'</strong></span>
<span class="strong"><strong>    ]</strong></span>
<span class="strong"><strong>  }</strong></span>
},
custom_options: {
  options: {
    datetime: new Date(Date.UTC(2014, 0, 1)),
    location: 'New York'
  },
  <span class="strong"><strong>files: {</strong></span>
<span class="strong"><strong>    'tmp/timestamp/custom_options': [</strong></span>
<span class="strong"><strong>      'test/fixtures/testing',</strong></span>
<span class="strong"><strong>      'test/fixtures/123'</strong></span>
<span class="strong"><strong>    ]</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div></li><li class="listitem">Finally, we can run our task using the <code class="literal">grunt timestamp</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">Running "timestamp:default_options" (timestamp) task
Running "timestamp:custom_options" (timestamp) task</pre></div></li><li class="listitem">To confirm that the tasks ran correctly, we can check the contents of the files created in the <code class="literal">tmp/timestamp</code> directory. The <code class="literal">custom_options</code> file, for example, should <a id="id456" class="indexterm"/>have content similar to the following:<div class="informalexample"><pre class="programlisting">// Wed Jan 01 2014 00:00:00 GMT (SAST) at New York
Testing1 2 3</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Writing tests for a plugin task"><div class="titlepage" id="aid-2UD7M2"><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Writing tests for a plugin task</h1></div></div></div><p>The creation <a id="id457" class="indexterm"/>of tests forms an essential part of the development of all programming modules, which includes Grunt plugins. Tests provide a way for us to confirm that our tasks work and keep working as expected in a variety of situations.</p><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec214"/>Getting started</h2></div></div></div><p>In this recipe, we'll continue to work on the project we created in the <span class="emphasis"><em>Creating a plugin task</em></span> recipe earlier in this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec215"/>How to do it...</h2></div></div></div><p>The following steps take us through creating expected output files and a test suite that checks that the actual output files from the task match them.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Before we get started on creating the actual test suite, we'll create a file called <code class="literal">default_options</code> in the <code class="literal">test/expected/timestamp</code> directory that contains the expected output of running the task with the <code class="literal">default_options</code> target:<div class="informalexample"><pre class="programlisting">// Thu, 01 Jan 1970 00:00:00 GMT at London
Testing1 2 3</pre></div></li><li class="listitem">Next, we'll create another file called <code class="literal">custom_options</code> in the same directory that contains the expected output of running the file with the <code class="literal">custom_options</code> target:<div class="informalexample"><pre class="programlisting">// Wed, 01 Jan 2014 00:00:00 GMT at New York
Testing1 2 3</pre></div></li><li class="listitem">Now that we've got the files containing the expected output ready, we can begin to set up the test suite that will actually compare their contents with the task's results. We'll start by creating a file called <code class="literal">timestamp_test.js</code> in the <code class="literal">test</code> directory and fill it with the following code:<div class="informalexample"><pre class="programlisting">var grunt = require('grunt');

module.exports.timestamp = {
};</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip119"/>Tip</h3><p>The Grunt library is imported and assigned to the <code class="literal">grunt</code> variable at the beginning of the file for later use in the tests.</p><p>We also assign an empty object to a property named after the task in the <code class="literal">module.exports</code> object. We'll add our test functions to this object.</p></div></li><li class="listitem">With the <a id="id458" class="indexterm"/>basic framework for our test suite in place, we can now add a test for each of our expected results. We'll name the tests after the targets that they'll be testing, just like the expected result files we created earlier. The tests are added by adding the following properties to the exported object in the <code class="literal">timestamp_test.js</code> file:<div class="informalexample"><pre class="programlisting">module.exports.timestamp = {
  <span class="strong"><strong>default_options: function (test) {</strong></span>
<span class="strong"><strong>    test.expect(1);</strong></span>
<span class="strong"><strong>    var actual = grunt.file.read(</strong></span>
<span class="strong"><strong>      'tmp/timestamp/default_options'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    var expected = grunt.file.read(</strong></span>
<span class="strong"><strong>      'test/expected/timestamp/default_options'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    test.equal(</strong></span>
<span class="strong"><strong>      actual,</strong></span>
<span class="strong"><strong>      expected,</strong></span>
<span class="strong"><strong>      'should work without specifying options.'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    test.done();</strong></span>
<span class="strong"><strong>  },</strong></span>
<span class="strong"><strong>  custom_options: function (test) {</strong></span>
<span class="strong"><strong>    test.expect(1);</strong></span>
<span class="strong"><strong>    var actual = grunt.file.read(</strong></span>
<span class="strong"><strong>      'tmp/timestamp/custom_options'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    var expected = grunt.file.read(</strong></span>
<span class="strong"><strong>      'test/expected/timestamp/custom_options'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    test.equal(</strong></span>
<span class="strong"><strong>      actual,</strong></span>
<span class="strong"><strong>      expected,</strong></span>
<span class="strong"><strong>      'should work with custom options.'</strong></span>
<span class="strong"><strong>    );</strong></span>
<span class="strong"><strong>    test.done();</strong></span>
<span class="strong"><strong>  }</strong></span>
};</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip120"/>Tip</h3><p>The format of tests is usually determined by the framework that runs them. In the case of our example, which is based on the generated Grunt plugin project, we use the <a id="id459" class="indexterm"/>
<span class="strong"><strong>nodeunit</strong></span> framework. You can read more about the framework at the following URL:</p><p><a class="ulink" href="https://github.com/caolan/nodeunit">https://github.com/caolan/nodeunit</a></p></div></li><li class="listitem">Now that we <a id="id460" class="indexterm"/>have our test suite set up, we need to indicate to the <code class="literal">test</code> alias task that it should run the timestamp task before running the tests. This causes the task to produce the resulting files that can then be tested against files that have been set up as the expected results. This is done by adding the <code class="literal">timestamp</code> task to the <code class="literal">test</code> alias task before the <code class="literal">nodeunit</code> task that runs the tests:<div class="informalexample"><pre class="programlisting">grunt.registerTask('test', [
  'clean',
  'myplugin',
  <span class="strong"><strong>'timestamp',</strong></span>
  'nodeunit'
]);</pre></div></li><li class="listitem">Finally, we can run the tests using either the <code class="literal">npm test</code> or <code class="literal">grunt test</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Running "clean:tests" (clean) task</strong></span>
<span class="strong"><strong>Cleaning tmp...OK</strong></span>

<span class="strong"><strong>Running "myplugin:default_options" (myplugin) task</strong></span>
<span class="strong"><strong>File "tmp/default_options" created.</strong></span>

<span class="strong"><strong>Running "myplugin:custom_options" (myplugin) task</strong></span>
<span class="strong"><strong>File "tmp/custom_options" created.</strong></span>

<span class="strong"><strong>Running "timestamp:default_options" (timestamp) task</strong></span>

<span class="strong"><strong>Running "timestamp:custom_options" (timestamp) task</strong></span>

<span class="strong"><strong>Running "nodeunit:tests" (nodeunit) task</strong></span>
<span class="strong"><strong>Testing myplugin_test.js..OK</strong></span>
<span class="strong"><strong>Testing timestamp_test.js..OK</strong></span>
<span class="strong"><strong>&gt;&gt; 4 assertions passed (73ms)</strong></span>
</pre></div></li><li class="listitem">We can now<a id="id461" class="indexterm"/> see by the output near the end that our tests have run successfully and we can keep running them during development to make sure we haven't broken anything with our latest changes.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Adding documentation for a plugin" id="aid-2VBO81"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Adding documentation for a plugin</h1></div></div></div><p>High-quality <a id="id462" class="indexterm"/>documentation is essential for the success of most software development projects. In the context of a Grunt plugin, its main purpose is to <a id="id463" class="indexterm"/>provide instructions and information on the usage of the plugin and its tasks. As with most projects hosted on GitHub, the documentation for a plugin is located in the <code class="literal">README.md</code> file, and written in the <a id="id464" class="indexterm"/>
<span class="strong"><strong>Markdown</strong></span> format.</p><div class="note" title="Note"><h3 class="title"><a id="tip121"/>Tip</h3><p>For more information on the<a id="id465" class="indexterm"/> general Markdown format, you can visit the following URLs:</p><p><a class="ulink" href="http://daringfireball.net/projects/markdown/">http://daringfireball.net/projects/markdown/</a></p><p><a class="ulink" href="https://help.github.com/articles/github-flavored-markdown/">https://help.github.com/articles/github-flavored-markdown/</a></p></div><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec216"/>Getting started</h2></div></div></div><p>In this recipe, we'll continue to work on the project we created in the <span class="emphasis"><em>Creating a plugin task</em></span> recipe earlier in this chapter. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec217"/>How to do it...</h2></div></div></div><p>The following steps take us through reviewing and adding to the documentation generated by Yeoman and the <code class="literal">gruntplugin</code> generator we used earlier.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's start by using our favorite editor to open the <code class="literal">README.md</code> file located in our project root.</li><li class="listitem">First, we'll check the title and description right at the beginning of the documentation file. As per our initial generation of the project, the title <code class="literal">grunt-myplugin</code> is probably still fine for us. We do, however, have a new task in this plugin that we should probably mention in the description. Let's change it to the following:<div class="informalexample"><pre class="programlisting">&gt; Our very first plugin with our very first "timestamp" task.</pre></div></li><li class="listitem">Next, we can review the <code class="literal">Getting Started</code> section to ensure that it still suits our project. In this case, the generated instructions should still be sufficient.</li><li class="listitem">Going <a id="id466" class="indexterm"/>further along in the documentation, we should now see the tasks contained in the plugin being listed. The <a id="id467" class="indexterm"/>first and only task currently listed is the <code class="literal">myplugin</code> task that we generated along with the project. Let's begin writing the documentation for our <code class="literal">timestamp</code> task by adding the following header after the <code class="literal">myplugin</code> tasks section:<div class="informalexample"><pre class="programlisting">## The "timestamp" task</pre></div></li><li class="listitem">The first part we'll add to our new task's section will be the overview. This should provide a basic explanation of the goal and operation of the task. The following should be sufficient for our new task:<div class="informalexample"><pre class="programlisting">### Overview
The `timestamp` task can be used to concatenate files and prepend the result with the a comment containing the provided time and location.</pre></div></li><li class="listitem">Now we should probably provide instructions with regard to the options that are available to tweak the task. Let's add the following to explain the <code class="literal">datetime</code> and <code class="literal">location</code> options:<div class="informalexample"><pre class="programlisting">### Options

#### options.datetime
Type: 'Date'
Default value: Minimum Unix time value

A Date object that contains the date and time you'd like to print out in the prepended comment.

#### options.location
Type: 'String'
Default: 'London'

A string value that contains the location that you'd like to print out in the prepended comment.</pre></div></li><li class="listitem">Next, we'll add some usage examples for our task. The following examples illustrate using task with the default options, and with all the available options set:<div class="informalexample"><pre class="programlisting">### Usage Examples

#### Default Options
In this example we make use of all the default values of the options. This should concatenate the provided files and prepend the result with a comment containing the minimum Unix time, along with the location as 'Earth'.

```js
grunt.initConfig({
  timestamp: {
    options: {},
    files: {
      'dest/default_options': [
        'src/foo',
        'src/bar'
      ]
    },
  },
})
```

#### Custom Options
In this example we set all possible options. The `datetime` options is set to the first day in 2014 and the location is set to 'New York'.

```js
grunt.initConfig({
  timestamp: {
    options: {
      datetime: new Date(2014, 0, 1),
      location: 'New York'
    },
    files: {
      'dest/default_options': [
        'src/foo',
        'src/bar'
      ]
    },
  },
})
```

This should produce a comment of the following form:
```js
// Wed, 01 Jan 2014 00:00:00 GMT at New York
```</pre></div></li><li class="listitem">Finally, we<a id="id468" class="indexterm"/> can review the contents of the <code class="literal">Contributing</code>, <code class="literal">Release History</code> and <code class="literal">License</code> sections to ensure there isn't <a id="id469" class="indexterm"/>anything we'd like to change in, or add to, our project.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Publishing a plugin" id="aid-30A8Q1"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Publishing a plugin</h1></div></div></div><p>Having a <a id="id470" class="indexterm"/>plugin published could be your introduction to the world of open source development and collaboration. As a project gains traction in the community and becomes useful to others, you may begin to see contributions being made to the project; contributions such as the fixing of issues and implementing of features that you may or may not have had on your roadmap.</p><div class="section" title="Getting started"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec218"/>Getting started</h2></div></div></div><p>In this recipe, we'll publish the project that we've been creating throughout this chapter, culminating with the project from the <span class="emphasis"><em>Adding documentation for a plugin</em></span> recipe. Be sure to refer to it and its preceding recipes if you'd like to see how we got to this point.</p><p>Before we can publish anything to the <a id="id471" class="indexterm"/>
<span class="strong"><strong>node package manager</strong></span> registry, we'll need to register as a user with the package hosting service. This can be done at <a class="ulink" href="https://www.npmjs.com/signup">https://www.npmjs.com/signup</a>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec219"/>How to do it...</h2></div></div></div><p>The following steps take us through publishing our plugin project to the node package manager registry:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To start with, we'll need to identify ourselves to the NPM service by entering the <code class="literal">npm adduser</code> command in the command line and entering the user credentials we registered with at the <a class="ulink" href="http://www.npmjs.com">www.npmjs.com</a> website.</li><li class="listitem">Next, we should make sure that we are in the root directory of the plugin project we wish to publish. If we are not yet there, we should navigate to it before we continue.</li><li class="listitem">Once we're in the appropriate directory, publishing our plugin is as simple as running the <code class="literal">npm publish</code> command, which should produce output similar to the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>+ grunt-myplugin@0.0.1</strong></span>
</pre></div></li><li class="listitem">For the sake of this example, we'll also remove our plugin from the registry using the <code class="literal">npm unpublish --force</code> command, which should produce output similar to <a id="id472" class="indexterm"/>the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>npm WARN using --force I sure hope you know what you are doing.</strong></span>
<span class="strong"><strong>- grunt-myplugin@0.0.1</strong></span>
</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div></div></body></html>