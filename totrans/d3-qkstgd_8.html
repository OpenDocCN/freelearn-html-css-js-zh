<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Mapping</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>D3 is a great tool for generating maps. To do so, we use specially formatted JSON data to generate <kbd>&lt;path&gt;</kbd> SVG elements. This specially formatted JSON data is called <strong>GeoJSON</strong>, and in this chapter, we'll use it to create a map of the world.</span></p>
<p class="mce-root"><span><span>In this chapter, we will</span></span> cover the following topics: </p>
<ul>
<li>Creating a map</li>
<li>Defining GeoJSON</li>
<li>Using a projection</li>
<li>Generating a<span> </span><kbd>&lt;path&gt;</kbd><span> </span>using a projection and GeoJSON data</li>
</ul>
<p><span>The complete code for this chapter can be found at</span><span> https: <a href="https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter08">https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter08</a>.<br/></span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining GeoJSON</h1>
                </header>
            
            <article>
                
<p>GeoJSON is just JSON data that has specific properties that are assigned specific data types. The following is an example of GeoJSON:</p>
<div class="highlight highlight-source-js">
<pre>{
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Feature<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>geometry<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [<span class="pl-c1">125.6</span>, <span class="pl-c1">10.1</span>]
    },
    <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Dinagat Islands<span class="pl-pds">"</span></span>
    }
}</pre></div>
<p class="mce-root"/>
<p>In this example, we have one<span> </span><kbd>Feature</kbd><span>, </span>the <kbd>geometry</kbd> of which is a<span> </span><kbd>Point</kbd><span> </span>with the coordinates<span> </span><kbd>[125.6, 10.1]</kbd>. Its name is <kbd>Dinagat Islands</kbd>. Each <kbd>Feature</kbd><span> will </span>follow this general structure. An example, with the type as <kbd>STRING</kbd>, is as follows:</p>
<div class="highlight highlight-source-js">
<pre>{
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">STRING</span>,
    <span class="pl-s"><span class="pl-pds">"</span>geometry<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">STRING</span>,
        <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">ARRAY</span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">OBJECT</span>
}</pre></div>
<p>We can also have a<span> </span><kbd>FeatureCollection</kbd><span>, </span>which includes many<span> f</span>eatures<span> </span>grouped together in a <kbd>features</kbd> array. In the following code snippet, you can see an example of <kbd>FeatureCollection</kbd> with different <kbd>geometry</kbd>:</p>
<div class="highlight highlight-source-js">
<pre>{
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>FeatureCollection<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>features<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
        {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Feature<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>geometry<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Point<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [<span class="pl-c1">102.0</span>, <span class="pl-c1">0.5</span>]
            },
            <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>prop0<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>value0<span class="pl-pds">"</span></span>
            }
        },
        {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Feature<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>geometry<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>LineString<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
                    [<span class="pl-c1">102.0</span>, <span class="pl-c1">0.0</span>], [<span class="pl-c1">103.0</span>, <span class="pl-c1">1.0</span>], [<span class="pl-c1">104.0</span>,   <br/>                     <span class="pl-c1">0.0</span>], [<span class="pl-c1">105.0</span>, <span class="pl-c1">1.0</span>]
                ]
            },
            <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>prop0<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>value0<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>prop1<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">0.0</span>
            }
        },
        {
            <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Feature<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>geometry<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Polygon<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>coordinates<span class="pl-pds">"</span></span><span class="pl-k">:</span> [
                    [
                       [<span class="pl-c1">100.0</span>, <span class="pl-c1">0.0</span>], [<span class="pl-c1">101.0</span>, <span class="pl-c1">0.0</span>], <br/>                       [<span class="pl-c1">101.0</span>, <span class="pl-c1">1.0</span>], [<span class="pl-c1">100.0</span>, <span class="pl-c1">1.0</span>], <br/>                        [<span class="pl-c1">100.0</span>, <span class="pl-c1">0.0</span>]
                    ]
                ]
            },
            <span class="pl-s"><span class="pl-pds">"</span>properties<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
                <span class="pl-s"><span class="pl-pds">"</span>prop0<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>value0<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>prop1<span class="pl-pds">"</span></span><span class="pl-k">:</span> { <span class="pl-s"><span class="pl-pds">"</span>this<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>that<span class="pl-pds">"</span></span> }
            }
        }
    ]
}</pre></div>
<p><span><span>Here's the general form</span></span>:</p>
<div class="highlight highlight-source-js">
<pre>{
    <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>FeatureCollection<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>features<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">ARRAY</span>
}</pre></div>
<p>The<span> </span><kbd>features</kbd><span> </span>property is an array of<span> </span>feature<span> </span>objects that were defined previously.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up the HTML</h1>
                </header>
            
            <article>
                
<p>Let's set up a basic D3 page, using the following code:</p>
<div class="highlight highlight-text-html-basic">
<pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span> <span class="pl-e">lang</span>=<span class="pl-s"><span class="pl-pds">"</span>en<span class="pl-pds">"</span></span> <span class="pl-e">dir</span>=<span class="pl-s"><span class="pl-pds">"</span>ltr<span class="pl-pds">"</span></span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">title</span>&gt;&lt;/<span class="pl-ent">title</span>&gt;
    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>https://d3js.org/d3.v5.min.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<br/>    <span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>https://cdn.rawgit.com/mahuntington/mapping-demo/master/map_data3.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<br/>    <span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span>&gt;</pre>
<pre>    &lt;<span class="pl-ent">svg</span>&gt;&lt;/<span class="pl-ent">svg</span>&gt;
    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>app.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>
<p><span>The only thing different than the setup we've used in previous chapters is the following line:</span></p>
<div class="highlight highlight-text-html-basic">
<pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>https://cdn.rawgit.com/mahuntington/mapping-demo/master/map_data3.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<br/>&lt;/<span class="pl-ent">script</span>&gt;</pre></div>
<p>The preceding line just loads an external JavaScript file, which sets our GeoJSON data to a variable.  The beginning of the code looks as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> map_json <span class="pl-k">=</span> {
    type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>FeatureCollection<span class="pl-pds">"</span></span>,
    features<span class="pl-k">:</span> [
        {
            type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Feature<span class="pl-pds">"</span></span>,
            id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>AFG<span class="pl-pds">"</span></span>,
            properties<span class="pl-k">:</span> {
                name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Afghanistan<span class="pl-pds">"</span></span>
            },
            geometry<span class="pl-k">:</span> {
                type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Polygon<span class="pl-pds">"</span></span>,
                coordinates<span class="pl-k">:</span> [
                    <span class="pl-c">//lots of coordinates</span>
                ]
            }
        }
        <span class="pl-c">// lots of other countries</span>
    ]
}</pre></div>
<p>Note that the<span> </span><kbd>map_json</kbd><span> </span>variable is just a JavaScript object that adheres to the GeoJSON structure (it adds an<span> </span><kbd>idproperty</kbd>, which is optional). This is very important. If the object didn't adhere to the GeoJSON structure, D3 would not work as it should.</p>
<p>In production, you would probably make an AJAX call to get this data or, at the very least, create your own GeoJSON file, similar to the one being hosted on <a href="https://rawgit.com/" target="_blank">https://rawgit.com/</a>. The preceding setup was created to make learning easier, by decreasing the complexity associated with AJAX.</p>
<p><a href="https://rawgit.com/"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using a projection</h1>
                </header>
            
            <article>
                
<p>Now, let's start on our<span> </span><kbd>app.js</kbd><span> </span>file, as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> width <span class="pl-k">=</span> <span class="pl-c1">960</span>;
<span class="pl-k">var</span> height <span class="pl-k">=</span> <span class="pl-c1">490</span>;

<span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>, width)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, height);</pre></div>
<p>At the bottom of<span> </span><kbd>app.js</kbd>,<span> </span>let's add the following code:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> worldProjection <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">geoEquirectangular</span>();</pre></div>
<p>This generates a projection, which governs how we're going to display a round world on a flat screen. There are lots of different types of projections that we can use, which can be seen at<span> </span><a href="https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections">https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections</a>.<a href="https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections"/></p>
<p>The preceding line tells D3 to create an <kbd>equirectangular</kbd> projection (<a href="https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular">https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular</a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Generating a path using a projection and GeoJSON data</h1>
                </header>
            
            <article>
                
<p>Now that we have our projection, we're going to generate <kbd>&lt;path&gt;</kbd> elements for each data element in the <kbd>map_json.features</kbd> array. Then, we will set the fill of each element to <kbd>#099</kbd>. Add the following to the end of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">data</span>(<span class="pl-smi">map_json</span>.<span class="pl-smi">features</span>)
    .<span class="pl-en">enter</span>()
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>#099<span class="pl-pds">'</span></span>);</pre>
<p>The following screenshot shows what it should look if we open <kbd>index.html</kbd> in Chrome and view the <span class="packt_screen">Elements</span> tab in the Developer tools:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-447 image-border" src="assets/ea2b7f42-906a-4d42-855a-aa40375ff33e.png" style=""/></div>
</div>
<p>We created the<span> </span>path<span> </span>elements, but they each need a<span> </span><kbd>d</kbd><span> </span>attribute, which will determine how they will be drawn (that is, their shapes).</p>
<p>We want something like the following:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-c">//use datum to generate the value for the 'd' attributes</span>
});</pre></div>
<p>Writing the kind of code described in the preceding comment would be very difficult. Luckily, D3 can generate that entire function for us. All we need to do is specify the projection that we created earlier. At the bottom of<span> </span><kbd>app.js</kbd>,<span> </span>add the following code:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> dAttributeFunction <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">geoPath</span>()
    .<span class="pl-en">projection</span>(worldProjection);

<span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>d<span class="pl-pds">'</span></span>, dAttributeFunction);</pre></div>
<p><kbd>geoPath()</kbd><span> </span>generates the function that we'll use for the<span> </span><kbd>d</kbd><span> </span>attribute, and the<span> </span>projection (<kbd>worldProjection</kbd>)<span> </span>tells it to use the<span> </span><kbd>worldProjection</kbd><span> </span>variable created earlier, so that the<span> </span>path<span> </span>elements appear as an equirectangular projection, as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6ec85faf-009b-43d9-a0f4-36ca5b3c655f.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we discussed GeoJSON, what it's used for, and why it differs from more general JSON data.  We've also covered how to use D3 to create a projection and render GeoJSON data as a map.  Using this information, we can create all sorts of interesting maps of countries, cities, towns, or any area that we have GeoJSON data for.  We can use different projections to view this data in interesting ways</p>
<p>Congratulations! You've made it to the end of the book. Now, go and create amazing visualizations.</p>


            </article>

            
        </section>
    </body></html>