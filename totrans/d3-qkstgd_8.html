<html><head></head><body>
        

                            
                    <h1 class="header-title">Mapping</h1>
                
            
            
                
<p class="mce-root">D3 is a great tool for generating maps. To do so, we use specially formatted JSON data to generate <kbd>&lt;path&gt;</kbd> SVG elements. This specially formatted JSON data is called <strong>GeoJSON</strong>, and in this chapter, we'll use it to create a map of the world.</p>
<p class="mce-root">In this chapter, we will cover the following topics: </p>
<ul>
<li>Creating a map</li>
<li>Defining GeoJSON</li>
<li>Using a projection</li>
<li>Generating a <kbd>&lt;path&gt;</kbd> using a projection and GeoJSON data</li>
</ul>
<p>The complete code for this chapter can be found at https: <a href="https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter08">https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter08</a>.<br/></p>


            

            
        
    

        

                            
                    <h1 class="header-title">Defining GeoJSON</h1>
                
            
            
                
<p>GeoJSON is just JSON data that has specific properties that are assigned specific data types. The following is an example of GeoJSON:</p>
<div><pre>{
    "type": "Feature",
    "geometry": {
        "type": "Point",
        "coordinates": [125.6, 10.1]
    },
    "properties": {
        "name": "Dinagat Islands"
    }
}</pre></div>
<p class="mce-root"/>
<p>In this example, we have one <kbd>Feature</kbd>, the <kbd>geometry</kbd> of which is a <kbd>Point</kbd> with the coordinates <kbd>[125.6, 10.1]</kbd>. Its name is <kbd>Dinagat Islands</kbd>. Each <kbd>Feature</kbd> will follow this general structure. An example, with the type as <kbd>STRING</kbd>, is as follows:</p>
<div><pre>{
    "type": STRING,
    "geometry": {
        "type": STRING,
        "coordinates": ARRAY
    },
    "properties": OBJECT
}</pre></div>
<p>We can also have a <kbd>FeatureCollection</kbd>, which includes many features grouped together in a <kbd>features</kbd> array. In the following code snippet, you can see an example of <kbd>FeatureCollection</kbd> with different <kbd>geometry</kbd>:</p>
<div><pre>{
    "type": "FeatureCollection",
    "features": [
        {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [102.0, 0.5]
            },
            "properties": {
                "prop0": "value0"
            }
        },
        {
            "type": "Feature",
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [102.0, 0.0], [103.0, 1.0], [104.0,   <br/>                     0.0], [105.0, 1.0]
                ]
            },
            "properties": {
                "prop0": "value0",
                "prop1": 0.0
            }
        },
        {
            "type": "Feature",
            "geometry": {
                "type": "Polygon",
                "coordinates": [
                    [
                       [100.0, 0.0], [101.0, 0.0], <br/>                       [101.0, 1.0], [100.0, 1.0], <br/>                        [100.0, 0.0]
                    ]
                ]
            },
            "properties": {
                "prop0": "value0",
                "prop1": { "this": "that" }
            }
        }
    ]
}</pre></div>
<p>Here's the general form:</p>
<div><pre>{
    "type": "FeatureCollection",
    "features": ARRAY
}</pre></div>
<p>The <kbd>features</kbd> property is an array of feature objects that were defined previously.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up the HTML</h1>
                
            
            
                
<p>Let's set up a basic D3 page, using the following code:</p>
<div><pre>&lt;!DOCTYPE html&gt;
&lt;html lang="en" dir="ltr"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;script src="img/d3.v5.min.js" charset="utf-8"&gt;<br/>    &lt;/script&gt;
    &lt;script src="img/map_data3.js" charset="utf-8"&gt;<br/>    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;svg&gt;&lt;/svg&gt;
    &lt;script src="img/app.js" charset="utf-8"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div>
<p>The only thing different than the setup we've used in previous chapters is the following line:</p>
<div><pre>&lt;script src="img/map_data3.js" charset="utf-8"&gt;<br/>&lt;/script&gt;</pre></div>
<p>The preceding line just loads an external JavaScript file, which sets our GeoJSON data to a variable.  The beginning of the code looks as follows:</p>
<div><pre>var map_json = {
    type: "FeatureCollection",
    features: [
        {
            type: "Feature",
            id: "AFG",
            properties: {
                name: "Afghanistan"
            },
            geometry: {
                type: "Polygon",
                coordinates: [
                    //lots of coordinates
                ]
            }
        }
        // lots of other countries
    ]
}</pre></div>
<p>Note that the <kbd>map_json</kbd> variable is just a JavaScript object that adheres to the GeoJSON structure (it adds an <kbd>idproperty</kbd>, which is optional). This is very important. If the object didn't adhere to the GeoJSON structure, D3 would not work as it should.</p>
<p>In production, you would probably make an AJAX call to get this data or, at the very least, create your own GeoJSON file, similar to the one being hosted on <a href="https://rawgit.com/" target="_blank">https://rawgit.com/</a>. The preceding setup was created to make learning easier, by decreasing the complexity associated with AJAX.</p>
<p><a href="https://rawgit.com/"/></p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using a projection</h1>
                
            
            
                
<p>Now, let's start on our <kbd>app.js</kbd> file, as follows:</p>
<div><pre>var width = 960;
var height = 490;

d3.select('svg')
    .attr('width', width)
    .attr('height', height);</pre></div>
<p>At the bottom of <kbd>app.js</kbd>, let's add the following code:</p>
<div><pre>var worldProjection = d3.geoEquirectangular();</pre></div>
<p>This generates a projection, which governs how we're going to display a round world on a flat screen. There are lots of different types of projections that we can use, which can be seen at <a href="https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections">https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections</a>.<a href="https://github.com/d3/d3-geo/blob/master/README.md#azimuthal-projections"/></p>
<p>The preceding line tells D3 to create an <kbd>equirectangular</kbd> projection (<a href="https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular">https://github.com/d3/d3-geo/blob/master/README.md#geoEquirectangular</a>).</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Generating a path using a projection and GeoJSON data</h1>
                
            
            
                
<p>Now that we have our projection, we're going to generate <kbd>&lt;path&gt;</kbd> elements for each data element in the <kbd>map_json.features</kbd> array. Then, we will set the fill of each element to <kbd>#099</kbd>. Add the following to the end of <kbd>app.js</kbd>:</p>
<div><pre>d3.select('svg').selectAll('path')
    .data(map_json.features)
    .enter()
    .append('path')
    .attr('fill', '#099');</pre>
<p>The following screenshot shows what it should look if we open <kbd>index.html</kbd> in Chrome and view the Elements tab in the Developer tools:</p>
<div><img class="aligncenter size-full wp-image-447 image-border" src="img/ea2b7f42-906a-4d42-855a-aa40375ff33e.png" style=""/></div>
</div>
<p>We created the path elements, but they each need a <kbd>d</kbd> attribute, which will determine how they will be drawn (that is, their shapes).</p>
<p>We want something like the following:</p>
<div><pre>d3.selectAll('path').attr('d', function(datum, index){
    //use datum to generate the value for the 'd' attributes
});</pre></div>
<p>Writing the kind of code described in the preceding comment would be very difficult. Luckily, D3 can generate that entire function for us. All we need to do is specify the projection that we created earlier. At the bottom of <kbd>app.js</kbd>, add the following code:</p>
<div><pre>var dAttributeFunction = d3.geoPath()
    .projection(worldProjection);

d3.selectAll('path').attr('d', dAttributeFunction);</pre></div>
<p><kbd>geoPath()</kbd> generates the function that we'll use for the <kbd>d</kbd> attribute, and the projection (<kbd>worldProjection</kbd>) tells it to use the <kbd>worldProjection</kbd> variable created earlier, so that the path elements appear as an equirectangular projection, as follows:</p>
<div><img src="img/6ec85faf-009b-43d9-a0f4-36ca5b3c655f.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we discussed GeoJSON, what it's used for, and why it differs from more general JSON data.  We've also covered how to use D3 to create a projection and render GeoJSON data as a map.  Using this information, we can create all sorts of interesting maps of countries, cities, towns, or any area that we have GeoJSON data for.  We can use different projections to view this data in interesting ways</p>
<p>Congratulations! You've made it to the end of the book. Now, go and create amazing visualizations.</p>


            

            
        
    </body></html>