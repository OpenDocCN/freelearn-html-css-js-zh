<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch09" class="calibre1"/>Chapter 9. Connecting to Firebase</h1></div></div></div><p class="calibre10">In this chapter, we are going to focus solely on learning how to use Firebase to integrate a backend with our Ionic application. Firebase is a real-time data store technology that uses JSON-style database structure to let you store your data in the cloud. We will also be using the <code class="email">tabs-app</code> app that we created in <a class="calibre1" title="Chapter 8. Building a Simple Social App" href="part0035_split_000.html#11C3M2-798adc86542b445d8a1bb648e10b6714">Chapter 8</a>, <em class="calibre14">Building a Simple Social App,</em> to learn to integrate Firebase into our application.</p></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch09lvl1sec31" class="calibre1"/>Extending our tabs-app Ionic app</h1></div></div></div><p class="calibre10">In <a class="calibre1" title="Chapter 8. Building a Simple Social App" href="part0035_split_000.html#11C3M2-798adc86542b445d8a1bb648e10b6714">Chapter 8</a>, <em class="calibre14">Building a Simple Social App,</em> we created <code class="email">tabs-app</code>. If you recall correctly, we added a new tab called <code class="email">walls</code>.</p><p class="calibre10">The basic idea we had for the <code class="email">wall</code> tab we added was that it would be like a message board <a id="id291" class="calibre1"/>where a user could type a post and then tap the button labeled <strong class="calibre11">Post</strong> to see it on the message board, as shown in the following screenshot:</p><div><img src="img/00075.jpeg" alt="Extending our tabs-app Ionic app" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">The first thing we need to<a id="id292" class="calibre1"/> do is to implement our mechanism to allow users to post, as this does not currently work in our <code class="email">tab-app</code> application.</p></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch09lvl2sec38" class="calibre1"/>Implementing the post wall feature</h2></div></div></div><p class="calibre10">To recap what <a id="id293" class="calibre1"/>we want from our <code class="email">wall</code> tab, we <a id="id294" class="calibre1"/>want to be able to enter message in the message box, as seen in the preceding screenshot, and have the message appear like the sample message post. To begin, we start by implementing the code for adding a post in our controller.</p><p class="calibre10">This code is provided in the following code block:</p><div><pre class="programlisting">$scope.post = {
      message : ''
    };

    $scope.posts = [];

    $scope.addPost = function () {
      $scope.posts.unshift($scope.post);
      
      $scope.post = {
        message: ''
      };
    };</pre></div><p class="calibre10">You will need to replicate the <a id="id295" class="calibre1"/>code provided in<a id="id296" class="calibre1"/> the preceding block within your <code class="email">WallController</code> controller. This <code class="email">WallController</code> controller can be found within the <code class="email">controller.js</code> file of your <code class="email">tabs-app</code> application. The <code class="email">WallController</code> controller can be found in the path <code class="email">www/js/controller.js</code>.</p><p class="calibre10">If you have done this correctly, your <code class="email">WallController</code> controller will look like what we have in the following screenshot:</p><div><img src="img/00076.jpeg" alt="Implementing the post wall feature" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">Let's understand what<a id="id297" class="calibre1"/> this code is doing. We are simply<a id="id298" class="calibre1"/> attaching a <code class="email">post</code> object to the controller. We are also declaring a <code class="email">posts</code> array where all our posts will be stored.</p><p class="calibre10">Lastly, we have a function called <code class="email">addPost()</code> which will add a new post to the <code class="email">posts</code> array every time it is fired.</p><p class="calibre10">The next step is to wire this controller into the view of our <code class="email">Wall</code> tab. The markup for this view is located in the <code class="email">tab-wall.html</code> file. Now, this file looks like what we have in the following screenshot:</p><div><img src="img/00077.jpeg" alt="Implementing the post wall feature" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">You will need to completely<a id="id299" class="calibre1"/> replace the<a id="id300" class="calibre1"/> markup found within <code class="email">&lt;ion-content&gt;</code> with the markup provided in the following code block:</p><div><pre class="programlisting">&lt;div class="list"&gt;
      &lt;div class="item item-input-inset"&gt;
        &lt;label class="item-input-wrapper"&gt;
          &lt;input type="text" placeholder="enter your message" ng-model="post.message"&gt;
        &lt;/label&gt;
        &lt;button class="button button-small" on-tap="addPost()"&gt;
          Post
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="card" ng-repeat="post in posts"&gt;
      &lt;div class="item item-text-wrap"&gt;
        {{post.message}}
      &lt;/div&gt;
    &lt;/div&gt;</pre></div><p class="calibre10">If you have done this <a id="id301" class="calibre1"/>correctly, your <code class="email">tab-wall.html</code> file will have a markup that looks like the following screenshot:</p><div><img src="img/00078.jpeg" alt="Implementing the post wall feature" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">By doing this, we have<a id="id302" class="calibre1"/> completed the process of implementing and wiring our wall post feature on the <code class="email">Wall</code> tab. The next step is to test it using the <code class="email">ionic serve</code> technique. Go ahead and run your app using the <code class="email">ionic serve</code> technique and you should see your app running in the browser.</p><p class="calibre10">If you try to add a message in the text box found in the <code class="email">Wall</code> tab and click the <strong class="calibre11">Post</strong> button, you will see a message appear, like what we have in the following screenshot:</p><div><img src="img/00079.jpeg" alt="Implementing the post wall feature" class="calibre12"/></div><p class="calibre13"> </p><div><div><div><div><h3 class="title2"><a id="ch09lvl3sec28" class="calibre1"/>The backend challenge</h3></div></div></div><p class="calibre10">The one problem or challenge<a id="id303" class="calibre1"/> we have with our current application is that it does not persist. By this, we mean that once we refresh the browser, all our data is gone and we have to start again. How cool would it be if we could enter a post and when we revisited our app, we could carry on from where we left off just like every other message board in other applications? Well, we can achieve this thanks to a great technology called Firebase. The first thing we will do is try to understand Firebase and what exactly it is.</p></div></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec32" class="calibre1"/>Firebase</h1></div></div></div><p class="calibre10">Before we begin this<a id="id304" class="calibre1"/> chapter, it is very important that we understand the technology we are going to be using to integrate our backend. The technology in question is called Firebase. Firebase is a technology that lets us store real-time data. Unlike traditional backend databases where you need a server running, you do not need to have a hosted server with Firebase.</p><p class="calibre10">All you need to get going with Firebase is an active Google account and you are good to go. Let's set up a new Firebase account.</p><p class="calibre10">If you do not have a Google<a id="id305" class="calibre1"/> account, you can create one by visiting <a class="calibre1" href="http://www.gmail.com">http://www.gmail.com</a>.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch09lvl2sec39" class="calibre1"/>Setting up a new Firebase account</h2></div></div></div><p class="calibre10">The <a id="id306" class="calibre1"/>first thing you<a id="id307" class="calibre1"/> need to do to set up your Firebase account is go to<a id="id308" class="calibre1"/> the Firebase website, which is <a class="calibre1" href="http://www.firebase.com">http://www.firebase.com</a>.</p><p class="calibre10">You should see a screen that looks like what we have in the following screenshot:</p><div><img src="img/00080.jpeg" alt="Setting up a new Firebase account" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">Once this is done, you should see a button labeled <strong class="calibre11">Sign Up With Google</strong> on the top right-hand corner.</p><p class="calibre10">When you click this button, you should see a Gmail window asking you to select or log in to a Google<a id="id309" class="calibre1"/> account. After you select the Google account you want to use, you should be redirected to your brand new Firebase account. The window you will be redirected to should look like what we have in the following <a id="id310" class="calibre1"/>screenshot:</p><div><img src="img/00081.jpeg" alt="Setting up a new Firebase account" class="calibre12"/></div><p class="calibre13"> </p><div><h3 class="title2"><a id="note14" class="calibre1"/>Note</h3><p class="calibre10">All the examples we have here are based on our sample account. You should not use the URLs from the preceding screenshot but instead use the ones you see in your own window. If you do not, your sample will not work.</p></div><p class="calibre10">You will see that there is a Firebase app created for you called <strong class="calibre11">MY FIRST APP</strong>. When using Firebase, for each app we create we also create an app for it on our Firebase dashboard. This is because Firebase uses a distinct URL to provide you access to the data of each unique application you create. So, think of this <strong class="calibre11">MY FIRST APP</strong> Firebase app as a database.</p><p class="calibre10">Now, let's take a closer look at <strong class="calibre11">MY FIRST APP</strong>:</p><div><img src="img/00082.jpeg" alt="Setting up a new Firebase account" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">You should see something very similar to the preceding screenshot. You can access the URL for your Firebase <a id="id311" class="calibre1"/>database by clicking on the post fixed with the <code class="email">.firebaseIO.com</code> URL. Remember that the URL you see on the screenshots will be different from the ones you see on your dashboard, and you are to use the ones on your <a id="id312" class="calibre1"/>dashboard.</p><p class="calibre10">You can see that the URL we have here for <a id="id313" class="calibre1"/>demonstration is <a class="calibre1" href="http://luminous-inferno-8905.firebaseIO.com">luminous-inferno-8905.firebaseIO.com</a>.</p><p class="calibre10">Click the URL you have on your dashboard and that should take you to your Firebase database, which should look similar to the following screenshot:</p><div><img src="img/00083.jpeg" alt="Setting up a new Firebase account" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">Just to clarify once again, Firebase uses URLs to access databases. What you see in the preceding screenshot is the dashboard for your database. You can also see the same database URL in the <a id="id314" class="calibre1"/>browser's address bar. Firebase uses JSON-style data structure, so basically what we send to it is JSON, and what we store is JSON too.</p><p class="calibre10">When we add data<a id="id315" class="calibre1"/> to our database, we will be able to see it in this dashboard.</p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch09lvl2sec39_a" class="calibre1"/>Integrate Firebase into tabs-app application</h2></div></div></div><p class="calibre10">Now that we have our<a id="id316" class="calibre1"/> Firebase account and know how to get the URL of our Firebase database, the next step is to integrate it into our application.</p><div><div><div><div><h3 class="title2"><a id="ch09lvl3sec29" class="calibre1"/>Adding Firebase and Angular-Fire scripts</h3></div></div></div><p class="calibre10">The first thing we <a id="id317" class="calibre1"/>need to do is to add the scripts we will need. We will need two scripts. The<a id="id318" class="calibre1"/> first is the Firebase library. The second script is the Angular-Fire library. Angular-Fire is an Angular library that makes working with Firebase in an AngularJS application much simpler.</p><p class="calibre10">The simplest way is to use the hosted library references. To add this to our app, open your <code class="email">index.html</code> file and add the following script references within <code class="email">&lt;head&gt;</code> of your application:</p><div><pre class="programlisting">&lt;!-- Firebase --&gt;
&lt;script src="img/firebase.js"&gt;&lt;/script&gt;
&lt;!-- AngularFire --&gt;
&lt;script src="img/ angularfire.min.js"&gt;&lt;/script&gt;</pre></div><p class="calibre10">If you have done this<a id="id319" class="calibre1"/> correctly, the <code class="email">head</code> part of your <code class="email">index.html</code> should<a id="id320" class="calibre1"/> look like the following screenshot:</p><div><img src="img/00084.jpeg" alt="Adding Firebase and Angular-Fire scripts" class="calibre12"/></div><p class="calibre13"> </p><div><h3 class="title2"><a id="note15" class="calibre1"/>Note</h3><p class="calibre10">Make sure your references are below the Ionic bundle as seen in the preceding screenshot. This is very important or else your app will not work properly.</p></div><p class="calibre10">The next step is to reference <a id="id321" class="calibre1"/>your Angular-Fire module. This step will ensure that we can use Angular-Fire within our application. The name of this module is <code class="email">firebase</code>. This will be added to the root module of your application, called <code class="email">starter</code> in your <code class="email">app.js</code> file.</p><p class="calibre10">Currently, this<a id="id322" class="calibre1"/> module's declaration looks something like what we have in the following screenshot:</p><div><img src="img/00085.jpeg" alt="Adding Firebase and Angular-Fire scripts" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">You will need to add the <code class="email">firebase</code> module as a dependent module. Doing this will make the module declaration to look something like what we have in the following screenshot:</p><div><img src="img/00086.jpeg" alt="Adding Firebase and Angular-Fire scripts" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">You can see that the<a id="id323" class="calibre1"/> <code class="email">firebase</code> module is now added to the module declaration as a dependency. By doing this, we have successfully integrated Firebase into the skin of our app. The next step is to actually implement it to save our data.</p></div><div><div><div><div><h3 class="title2"><a id="ch09lvl3sec30" class="calibre1"/>Implementing Firebase to our app</h3></div></div></div><p class="calibre10">To implement Firebase in <a id="id324" class="calibre1"/>our app, we will need to do some work within our <code class="email">WallController</code> controller. The first thing we need to code for is the ability to pull items from the database. The second thing we need to code for is the ability to add items to the database.</p></div><div><div><div><div><h3 class="title2"><a id="ch09lvl3sec31" class="calibre1"/>Pulling from database</h3></div></div></div><p class="calibre10">The first thing we need to<a id="id325" class="calibre1"/> do is to add the <code class="email">$firebaseArray</code> service <a id="id326" class="calibre1"/>dependency into our <code class="email">WallController</code> controller. This service is part of the Angular-Fire library and makes it easy for us to work with arrays in Firebase.</p><p class="calibre10">Adding the service dependency correctly should make your <code class="email">WallController</code> controller definition look like what we have in the following screenshot:</p><div><img src="img/00087.jpeg" alt="Pulling from database" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">The next step is to actually write code to pull the data from the database. Replicate the code provided in the following code block in your <code class="email">WallController</code> controller:</p><div><pre class="programlisting">        var postsDatabaseRef = new Firebase("https://&lt;YOUR- FIREBASE-APP&gt;.firebaseio.com").child('posts');
    var postsData = $firebaseArray(postsDatabaseRef);</pre></div><p class="calibre10">This piece of code creates a new Firebase reference at first. We passed in the URL of the Firebase database that<a id="id327" class="calibre1"/> we created earlier. Make sure you change the placeholder text (<code class="email">YOUR-FIREBASE-APP</code>) to reflect the URL of your Firebase<a id="id328" class="calibre1"/> database.</p><p class="calibre10">After this, we used the <code class="email">$firebase</code> service that we added earlier to create a path called <code class="email">postData</code>. The last step we need to do is to allow our app to load data from this <code class="email">postData</code> path and use it. To do this, we need to edit the code of our <code class="email">WallController</code> slightly. Currently, our <code class="email">WallController</code> controller's code looks like what we have in the following screenshot:</p><div><img src="img/00088.jpeg" alt="Pulling from database" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">Pay close attention to the piece of code highlighted in the preceding screenshot. We need to edit this piece of code <a id="id329" class="calibre1"/>such that instead of equating to<a id="id330" class="calibre1"/> an empty array, it should equate to our <code class="email">postData</code> variable. Doing this correctly should make us end up with a <code class="email">WallController</code> controller that looks like the following screenshot:</p><div><img src="img/00089.jpeg" alt="Pulling from database" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">By doing this, we have implemented the first part; our Firebase implementation and our app now loads data from our database. The next step is to implement the code to add our posts to our database.</p><div><div><div><div><h4 class="title3"><a id="ch09lvl4sec19" class="calibre1"/>Adding to database</h4></div></div></div><p class="calibre10">Adding to the <a id="id331" class="calibre1"/>database is actually pretty easy. All we need to do is slightly edit our <code class="email">addPost()</code> function. Currently, our <code class="email">addPost()</code> function looks like what we have in the following screenshot:</p><div><img src="img/00090.jpeg" alt="Adding to database" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">To make our data<a id="id332" class="calibre1"/> persist in our database, we only <a id="id333" class="calibre1"/>need to replace the code highlighted in the preceding screenshot with the following code block:</p><div><pre class="programlisting">      $scope.posts.$add($scope.post);</pre></div><p class="calibre10">Now, your <code class="email">addPost()</code> function should look like what we have in the following screenshot:</p><div><img src="img/00091.jpeg" alt="Adding to database" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre10">All we did was just change the <code class="email">unshift()</code> method to the <code class="email">$add()</code> method. The <code class="email">$add()</code> method is a method from Firebase that adds items to a Firebase database. At this point, we have completed the implementation of our backend. As easy as that was, we have a working database<a id="id334" class="calibre1"/> in just a few short steps and <a id="id335" class="calibre1"/>can now test this live. Your final <code class="email">WallController</code> controller should look like the following code block:</p><div><pre class="programlisting">.controller('WallController', function($scope, $firebaseArray) {
    var postsDatabaseRef = new Firebase("https://&lt;YOUR-FIREBASE- APP&gt;.firebaseio.com").child('posts');
    var postsData = $firebaseArray(postsDatabaseRef);

    $scope.post = {
      message : ''
    };

    $scope.posts = postsData;

    $scope.addPost = function () {
      $scope.posts.$add($scope.post);

      $scope.post = {
        message: ''
      };
    };

  })</pre></div><p class="calibre10">To test your application, simply run your app using the <code class="email">ionic serve</code> technique. When you do this, you should be able to enter messages in your application, and even after you refresh your browser, the data that you have already posted will still exist. Also, if you have a look at the Firebase dashboard for your database, you will see that the data you entered in the app is present there.</p></div></div></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch09lvl1sec33" class="calibre1"/>Summary</h1></div></div></div><p class="calibre10">In this chapter, we learned some really cool ways of using Firebase to easily add a backend to our Ionic app. We only touched upon what Firebase lets us do, and you can look at the Firebase documentation available at <a class="calibre1" href="https://www.firebase.com/docs/">https://www.firebase.com/docs/</a> to see the full features of Firebase.</p><p class="calibre10">At this point, we have almost come to the end of our book. The next chapter will be the final one, and it is one you should definitely read. It contains some very useful information on how to harness skills learned in this book to get even better at using Ionic.</p></div></body></html>