- en: Animating SVG Elements to Create an Interactive Pie Chart
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we'll be use animation to make our graphs move. This can give
    your visualizations a more polished and professional feel.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this section, we will cover the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Creating an ordinal scale
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a color scale
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adding paths for each pie segment
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Generating an arc creating function
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Formatting the data for the arc
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Adjusting the position of the pie
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Making a donut graph
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Removing parts of the pie
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The complete code for this section can be found at [https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter06](https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter06).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the application
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As always, we''ll need an `index.html` file to house our SVG code. Let''s create
    the file and add the following code to it:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Create data/configuration variables
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'At the bottom of the `<body>` tag, we''re referencing an `app.js` file. Let''s
    create that file and add the following code to it:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To be sure that it''s working and linked up properly, we''ve added `console.log(dataset)`
    to the bottom. Let''s open `index.html` in Chrome and view the developer console,
    to make sure that everything is hooked up the way it should be:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/614496bf-68b5-46c3-a3f7-8987be6399ac.png)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
- en: 'Once we''re sure that it''s working, we can remove `console.log(dataset)`;,
    as follows:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Creating an ordinal scale
  id: totrans-22
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: An ordinal scale maps a discrete value to some other value. A discrete value
    is something that can't be divided. Previously, we've used values such as numbers
    that can be divided up and interpolated. Interpolated just means that for any
    two numbers, we can find other numbers in between them. For instance, given 10
    and 5, we can find values between them (6, 8.2, 7, 9.9, and so on). Now, we want
    to map values that can't be interpolated—the label properties in our dataset (Bob,
    Sally, Matt, and Jane). What values lie between Bob and Sally? What about between
    Bob and Matt? There are none. These are just strings, not numerical values that
    can be divided up and interpolated.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: 'What we want to do is map these discrete values to other values. The following
    is an example of how to do this with an ordinal scale. Add the following to the
    bottom of `app.js`:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The previous code should produce the following:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6119e550-d852-4c66-b6d4-0826bb07ea53.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
- en: Note that when you are working with ordinal scales, you'll need to list all
    of the values for both the domain and range. Even if one set is numerical (in
    the previous case, the range), you'll still have to list each value. If we just
    listed the min/max for the range, omitting63, D3 would have no idea what value
    to map Sally to. After all, how close is Sally to Bob,as a value? How close is
    Sally to Zagth or, as a value? There's no way to calculate that distance, since
    they're all strings of text, not numbers.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: 'One thing that''s surprising is that you can''t invert ordinal scales. Remove
    the previous three `console.log()` statements and temporarily add the following
    to the bottom of `app.js`:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The following will be displayed:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3dcec0f1-1823-421c-a200-03442ae29824.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
- en: 'D3 can only go in one direction: from domain to range. You can now remove the
    `console.log()` statement.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: Creating the color scale to map labels to colors
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now, we want to map the label properties of our dataset to colors, instead of
    random numbers, like in the previous section. We can come up with our own color
    scheme, or we choose one of D3's sets of colors from [https://github.com/d3/d3-scale-chromatic#categorical](https://github.com/d3/d3-scale-chromatic#categorical).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'If we want to, we can see that these color schemes are just arrays. Temporarily,
    add the following to the bottom of `app.js`:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'The following content will be displayed:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/7408b48d-b675-4f6f-8ef1-6ad550d96e00.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
- en: 'Consequently, we can use a color scheme when setting a range. Replace the previous
    `console.log()` statement with the following:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We can generate an array of labels for the domain by using JavaScript''s native
    `map` function. Add the following to the bottom of `app.js`:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The following is our code, so far:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Setting up the SVG
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The next code block is pretty standard. Add the following code to the bottom
    of `app.js`:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Adding paths for each pie segment
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Let''s add path elements for each element in our dataset. Add the following
    code to the bottom of `app.js`:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'If we examine our elements in the developer tools, we''ll see that the paths
    were added, and each path has a fill value, as determined by `colorScale(d.label)`,
    which is mapping the label of each data object to a color:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/44c97e7f-30fd-4b1e-9c1d-3382e11fbc2d.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
- en: Generating an arc creating function
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The paths have fill colors, but no shapes. If you''ll recall, the `<path>`
    elements take a `d=` attribute, which determines how they''re drawn. We want to
    set up something that will somehow map data to a `d=` string, such as the following
    code (you don''t have to add the next code snippet; it''s only there for reference):'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Fortunately, D3 can generate the anonymous function that we need for the second
    parameter of `.attr()` in the previous code snippet. Add the following to `app.js`,
    just before our previous code for `var path = d3.select(''g'').selectAll(''path'')...`:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Let''s plug this function into its correct place in our previous `var path
    = d3.select(''g'').selectAll(''path'')...` code (it won''t work yet, though):'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Formatting the data for the arc
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The reason that our `arc()` function won''t work is the data isn''t formatted
    properly for the function. The arc function that we generated expects the data
    object to have things like a start angle, an end angle, and so on. Fortunately,
    D3 can reformat our data so that it will work with our generated `arc()` function.
    To do this, we''ll generate a `pie` function that will take a dataset and add
    the necessary attributes to it for the start angle, end angle, and so on. Add
    the following just before the code for `var path =d3.select(''g'').selectAll(''path'')...`:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Our `pie` variable is a function that takes an array of values as a parameter
    and returns an array of objects that are formatted for our `arc` function. Temporarily
    add the following code to the bottom of `app.js`, and take a look at the console
    in Chrome''s Developer tools:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The following content will be displayed:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ce1dd5be-eba8-4b98-b307-a240815fa091.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
- en: 'You can now remove the `console.log(pie(dataset))` call. We can use this `pie()`
    function when attaching data to our paths. Adjust the previous `var path = d3.select(''g'').selectAll(''path'')`
    code, as follows:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Unfortunately, now, each object from the data array that''s been attached to
    our path elements doesn''t have a `.label` property, so our code for `.attr(''fill'',
    function(d) {})`is broken. Fortunately, our data does have a `.data` attribute
    that mirrors what the data looked like before we passed it to the `pie()` function.
    Let''s adjust our `var path = d3.select(''g'').selectAll(''path'')` code to use
    that code, instead, as follows:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'So far, our code is as follows:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The preceding code produces the following result:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/817b382e-5517-4c82-88e1-63ef00034860.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
- en: Adjusting the position of the pie
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Currently, we can only see the lower-right quarter of the pie graph. This is
    because the pie starts at (`0,0`), but we can move the `group` element containing
    the pie by adjusting our `d3.select(''svg'')` code, as follows:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'The pie graph now looks as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/39092768-e765-496e-a7b7-a452e7c3700b.png)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
- en: Making a donut graph
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'If you want the pie to have a hole in the center, just adjust the inner radius
    of the `arc()` function, as follows:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The graph will now look as follows:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c024f1ea-ae2a-4f3a-b0ab-1286566a5108.png)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
- en: Removing parts of the pie
  id: totrans-86
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We want to make it possible to click on a section of the pie to remove it.
    First, let''s add IDs to our data, to make the removal easier. Adjust the `var
    dataset` code at the top of `app.js`:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Now, let''s use those IDs when we map data to paths. Adjust the `.data()` portion
    of our `var path =d3.select(''g'').selectAll(''path'')`code at the bottom of `app.js`,
    as follows:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Let''s save a record of the current data for each element by adding a `_current`
    property to each element (we''ll use this later). Add `.each(function(d) { this._current
    = d; });`to the end of our `var path =d3.select(''g'')` code, at the bottom of
    `app.js`:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Create the click handler by adding the following code to the bottom of `app.js`:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Remove the selected data from the dataset array, using JavaScript''s native
    `filter` function. Adjust the code that we just added, as follows:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 JavaScript 的原生 `filter` 函数从数据集中移除选定的数据。调整我们刚刚添加的代码，如下所示：
- en: '[PRE25]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Remove the `path` elements from the SVG by adding the following to our click
    handler function:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 通过在我们的点击处理函数中添加以下内容，从 SVG 中移除 `path` 元素：
- en: '[PRE26]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now, if we click on the orange segment, we should get the following result:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们点击橙色部分，我们应该得到以下结果：
- en: '![](img/86789fa3-405b-4ffb-9a98-89f744dd1b2c.png)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](img/86789fa3-405b-4ffb-9a98-89f744dd1b2c.png)'
- en: 'Let''s close the donut and add a transition. Add the following to the bottom
    of our click handler. Check out the comments in the following code to see what
    each line does:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们关闭甜甜圈并添加一个过渡效果。将以下内容添加到我们的点击处理函数的底部。查看以下代码中的注释，以了解每一行的作用：
- en: '[PRE27]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now, when we click on the orange segment, the donut closes smoothly, as follows:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我们点击橙色部分时，甜甜圈会平滑地关闭，如下所示：
- en: '![](img/acd510e8-3252-44b5-bd20-2cdddca0ecce.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![](img/acd510e8-3252-44b5-bd20-2cdddca0ecce.png)'
- en: Summary
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we created a pie chart that animates when you remove sections
    from it. You learned how to generate paths from data, so that you can get different
    parts of the pie without having to specify the drawing commands directly in the
    path elements. You also learned how to use animation to make visualizations look
    more professional. Finally, you learned how to remove sections of the pie and
    have the other path elements redraw themselves, so that the result will be a full
    pie.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们创建了一个饼图，当你从其中移除部分时，它会动画显示。你学习了如何从数据生成路径，这样你就可以在不直接在路径元素中指定绘图命令的情况下获取饼图的不同部分。你还学习了如何使用动画使可视化看起来更专业。最后，你学习了如何移除饼图的部分，并让其他路径元素重新绘制自己，从而使结果是一个完整的饼图。
- en: In the next chapter, we will use D3 to create a graph that visualizes the relationships
    between various nodes of data.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将使用 D3 创建一个可视化数据中各个节点之间关系的图表。
