<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Visualizing Your Application's Data</h1></div></div></div><p>This chapter will demonstrate how to visualize your data with charts and graphs. It will focus on the most popular types of graphs and how your data sources can be integrated with them. We will also discuss how to integrate visualizations into other components, such as grids.</p><p>We will cover the most common topics relating to charts. These are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding visualization technologies and how charting works in Ext JS</li><li class="listitem" style="list-style-type: disc">Examples and explanations of how to work with common charts, namely:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Line</li><li class="listitem" style="list-style-type: disc">Bar</li><li class="listitem" style="list-style-type: disc">Pie</li></ul></div></li><li class="listitem" style="list-style-type: disc">Integrating these visualizations into other components, such as a grid</li></ul></div><div><div><div><div><h1 class="title"><a id="ch09lvl1sec68"/>Anatomy of chart components</h1></div></div></div><p>Ext JS <a id="id388" class="indexterm"/>provides a very flexible and feature-rich charting toolkit to visually represent data to users. To get the most out of the chart's package, it is worthwhile to have an understanding of the anatomy of the chart.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec110"/>Series</h2></div></div></div><p>In Ext JS, the<a id="id389" class="indexterm"/> series is essentially the chart type. The series is the most complicated part of the chart and handles how the elements are animated, shown, or hidden. In addition to this, the series handles how the data is labeled.</p><p>If, for example, the application requires a bar chart, then it's the Bar or Bar3D series classes you need to look out for.</p><p>Out of the <a id="id390" class="indexterm"/>box, Ext JS 5 offers the following charts:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bar (and a 3D variant)</li><li class="listitem" style="list-style-type: disc">OHCL/Candlestick</li><li class="listitem" style="list-style-type: disc">Area</li><li class="listitem" style="list-style-type: disc">Pie (and a 3D variant)</li><li class="listitem" style="list-style-type: disc">Line</li><li class="listitem" style="list-style-type: disc">Gauge</li><li class="listitem" style="list-style-type: disc">Scatter</li><li class="listitem" style="list-style-type: disc">Radar</li><li class="listitem" style="list-style-type: disc">Polar</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec111"/>Axes</h2></div></div></div><p>As with any other chart, you'll typically be required to define axes for your chart components. The<a id="id391" class="indexterm"/> numeric and category axes are the most commonly used. The framework comes with a number of layouts and a method to segment data if you require something that's not necessarily out of the box.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec112"/>Labels</h2></div></div></div><p>Chart labels <a id="id392" class="indexterm"/>are simply a way to display the label for the data point. Ext JS enables us to customize how these are displayed and animated.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec113"/>Interactions</h2></div></div></div><p>Interactions <a id="id393" class="indexterm"/>simply refer to how the user interfaces with the chart. For example, using an interaction might allow the user to click and drag a part of the chart to zoom into the data.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec69"/>Creating a line chart</h1></div></div></div><p>Line <a id="id394" class="indexterm"/>charts are one of the most commonly used types of graphs and are most suited to representing trending data, which is often regularly updated and required to be analyzed in real time.</p><p>One of the great advantages of the Ext JS charting package is that we can work with the data in real time. It's possible to do this a number of ways:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Simply poll periodically for updates</li><li class="listitem" style="list-style-type: disc">Bind the store to a <code class="literal">WebSocket</code> and push updates from the server side</li></ul></div><p>To continue the running theme of our BizDash business dashboard, we will create a line chart that<a id="id395" class="indexterm"/> shows how many people are currently visiting our website.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec114"/>Creating the store and model</h2></div></div></div><p>As <a id="id396" class="indexterm"/>we saw in <a class="link" href="ch05.html" title="Chapter 5. Modeling Data Structures for Your UI">Chapter 5</a>, <em>Modeling Data Structures for Your UI</em>, we <a id="id397" class="indexterm"/>need to start by defining a model to represent an individual record being retrieved by the store.</p><p>Before we get into the details of creating the line chart, we need to create a store and a model. We don't yet have a <code class="literal">WebSiteVisitor</code> model in our application. So, let's create one:</p><div><pre class="programlisting">// app/model/WebSiteVisitor.js
Ext.define('BizDash.model.WebSiteVisitor', {
  extend: 'Ext.data.Model',
  fields: [
    {
      name: 'Time',
      type: 'int'
    },
    {
      name: 'Visitors',
      type: 'int'
    }
  ]
});

// app/store/WebSiteVisitors.js
Ext.define('BizDash.store.WebSiteVisitors', {
  extend: 'Ext.data.Store',
  model: 'BizDash.model.WebSiteVisitor',
  proxy: {
    type : 'ajax',
    url : 'visitors.json',
    reader: {
      type : 'json',
      rootProperty: 'rows'
    }
  }
});</pre></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec115"/>Polling the server for new data</h2></div></div></div><p>It would <a id="id398" class="indexterm"/>be straightforward to have our store poll the server every 10 seconds and plot the number of visits at that moment in time with a <code class="literal">setInterval</code> or similar:</p><div><pre class="programlisting">setInterval(function(){
  store.load({
    addRecords: true
  });
}, 10000);</pre></div><p>The <code class="literal">addRecords</code> configuration is passed into the store's <code class="literal">load</code> method. By setting this property to <code class="literal">true</code>, any new records retrieved by the load operation are appended to the existing dataset rather than replacing what is already there, which is the default behavior.</p><p>The configuration of the chart itself is surprisingly straightforward. We'll do this in a new view to remain in keeping with the rest of our application:</p><div><pre class="programlisting">Ext.define('BizDash.view.chart.SiteVisits', {
  extend: 'Ext.chart.CartesianChart',
  xtype: 'chart-SiteVisits',
  config: {
    animate: true,
    store : 'WebSiteVisitors',
    series : [
      {
        type : 'line',
        smooth: false,
        axis : 'left',
        xField: 'Time',
        yField: 'Visitors'
      }
    ],
    axes : [
      {
        type : 'numeric',
        grid : true,
        position : 'left',
        fields : ['Visitors'],
        title : 'Visitors',
        minimum : 0,
        maximum : 200,
        majorTickSteps: 5
      },
      {
        type : 'numeric',
        position : 'bottom',
        fields : 'Time',
        title : 'Time',
        minimum : 0,
        maximum : 20,
        decimals : 0,
        constrain : true,
        majorTickSteps: 20
      }
    ]
  }
});</pre></div><p>Here is how it will look:</p><div><img src="img/3717_09_01.jpg" alt="Polling the server for new data"/></div><p>The line<a id="id399" class="indexterm"/> chart we have created is set up in a fairly standard way. The two numeric axes bind to the integer fields within the <code class="literal">WebSiteVisitor</code> model. The line itself is displayed by the <code class="literal">Ext.chart.series.Line</code> class where it is tied to the data via the <code class="literal">xField</code> and <code class="literal">yField</code> properties.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec70"/>Presenting data in a bar chart</h1></div></div></div><p>A bar <a id="id400" class="indexterm"/>chart is an incredibly useful way of presenting quantitative<a id="id401" class="indexterm"/> data to users. We will quickly demonstrate how to create a bar chart and have it load data asynchronously from the server.</p><p>As with the line chart, we're going to require a model and store to get things started:</p><div><pre class="programlisting">// app/model/BarChart.js
Ext.define('BizDash.model.BarChart', {
  extend: 'Ext.data.Model',
  fields: [
    {
      name: 'name',
      type: 'string'
    },
    {
      name: 'value',
      type: 'int'
    }
  ]
});

// app/store/BarChart.js
Ext.define('BizDash.store.BarChart', {
  extend: 'Ext.data.Store',
  model: 'BizDash.model.BarChart',
  proxy: {
    type : 'ajax',
    url : 'path/to/your/datasource',
    reader: {
      type : 'json',
      rootProperty: 'data'
    }
  },
  autoLoad: true
});</pre></div><p>In this contrived example, the data we return from the server must have a <code class="literal">name</code> and <code class="literal">value</code> property, as we have defined these as fields in our model.</p><p>The <a id="id402" class="indexterm"/>store we defined in this example is used as the client-side <a id="id403" class="indexterm"/>cache for our data. By associating the <code class="literal">BarChart</code> model to the store, we ensure that the data is correctly represented in the chart component.</p><p>Now that the store is ready, we just need a component to bind it to. We will now create a new view called <code class="literal">BizDash.view.chart.BarChart</code> containing a Cartesian chart with a bar series. This gives us basic charting functionality to which we can add axes and series and bind our store to it.</p><p>The axes are used to define the boundaries of the chart and, in this instance, create the horizontal and vertical axes. The series handles the rendering of the data points across the chart. Here, we've used the <code class="literal">Ext.chart.series.Bar</code> class to create a simple bar chart. In the bar configuration, <code class="literal">xField</code> and <code class="literal">yField</code> must contain the same name fields we defined in our model.</p><div><pre class="programlisting">Ext.define('BizDash.view.chart.BarChart', {
  extend: 'Ext.chart.Chart',
  xtype: 'chart-BarChart',
  config: {
    animate: true,
    store : 'BarChart',
    axes : [
      {
        type : 'numeric',
        position: 'left',
        fields : ['value'],
        title : 'Value'
      },
      {
        type : 'category',
        position: 'bottom',
        fields : ['name'],
        title : 'Name'
      }
    ],
    series : [
      {
        type : 'bar',
        axis : 'bottom',
        xField: 'name',
        yField: 'value'
      }
    ]
  }
});</pre></div><p>This is how the graph will now look:</p><div><img src="img/3717_09_02.jpg" alt="Presenting data in a bar chart"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec71"/>Creating a pie chart in Ext JS</h1></div></div></div><p>The<a id="id404" class="indexterm"/> pie chart is a very common chart type and is excellent<a id="id405" class="indexterm"/> at representing proportional data, where each slice of the pie equates to the percentage that particular slice holds against the sum of the entire dataset.</p><p>In this section, we will demonstrate how to create a pie chart representing the distribution of products (by stock level) we have in our warehouse.</p><p>We already have a products store and model defined earlier in the book (<a class="link" href="ch05.html" title="Chapter 5. Modeling Data Structures for Your UI">Chapter 5</a>, <em>Modeling Data Structures for Your UI</em>, and <a class="link" href="ch07.html" title="Chapter 7. Constructing Common UI Widgets">Chapter 7</a>, <em>Constructing Common UI Widgets</em>). As a reminder, here's what we defined:</p><div><pre class="programlisting">Ext.define('BizDash.model.Product', {
  extend: 'Ext.data.Model',
  fields: [
    {
      name: 'Name',
      type: 'string'
    },
    {
      name: 'Description',
      type: 'string'
    },
    {
      name: 'Quantity',
      type: 'int'
    },
    {
      name: 'Price',
      type: 'float'
    }
  ]
});
Ext.define('BizDash.store.Products', {
  extend: 'Ext.data.Store',
  model: 'BizDash.model.Product',
  autoLoad: true,
  proxy: {
    type : 'ajax',
    url : 'products.json',
    reader: {
      type : 'json',
      rootProperty: 'rows'
    }
  }
});</pre></div><p>Now that we have the store and model organized, we need to create a new view for our pie chart:</p><div><pre class="programlisting">Ext.define('BizDash.view.chart.StockLevelPie', {
  extend: 'Ext.chart.PolarChart',
  xtype: 'chart-StockLevelPie',
  config: {
    animate : true,
    store : 'Products',
    interactions: 'rotate',
    series : {
      type : 'pie',
      label : {
        field : 'Name',
        display: 'rotate'
      },
      xField: 'Quantity',
      donut : 30
    }
  }
});</pre></div><p>Amazingly, it's<a id="id406" class="indexterm"/> as simple as that. You can see the output in <a id="id407" class="indexterm"/>the following image:</p><div><img src="img/3717_09_03.jpg" alt="Creating a pie chart in Ext JS"/></div><p>As with other charts that have polar coordinates, the <code class="literal">Ext.chart.PolarChart</code> class provides the infrastructure and canvas for our specific chart type to be rendered.</p><p>We use the pie series type to have the <code class="literal">Ext.chart.series.Pie</code> class process the records contained in the bound store and turn it into a series of sprites to form a chart. This series will convert each of the records in the store into a slice of the pie.</p><p>The most important configuration of this series type is <code class="literal">xField</code>. This tells the series which of our model fields holds the numeric value that will be used when calculating the size of each record's slice.</p><p>We add labels to the chart by using the <code class="literal">labels</code> property to configure the <code class="literal">Ext.chart.Label</code> mixin, which is applied to the <code class="literal">Ext.chart.series.Pie</code> class. These options allow us to configure how the labels are positioned and styled. By choosing the rotate value <a id="id408" class="indexterm"/>for the <code class="literal">display</code> property, the labels are positioned <a id="id409" class="indexterm"/>along the length of the slice. While discussing the look of the chart, it's perhaps worth highlighting that the <code class="literal">donut</code> config is the radius of the hole (as a percentage) that's cut out in the middle of the pie chart.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec72"/>Integrating visualizations in grids</h1></div></div></div><p>The grid <a id="id410" class="indexterm"/>widget is one of the best known features<a id="id411" class="indexterm"/> of Ext JS and the framework now supports the concept of widget columns. The widget column lets you embed a widget which, unlike a standard component, is a lightweight component that is quick to render and update. Widgets are suited perfectly to grids, where you may be displaying dozens of them at the same time.</p><p>Ext JS 5 introduces a number of lightweight widgets for grids, but the sparkline widget is without doubt the perfect widget to show a chart in a grid. It is an ultra-lightweight chart designed to represent a series of values with minimum real estate.</p><p>There are a <a id="id412" class="indexterm"/>number of different sparklines to work with:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Bar</li><li class="listitem" style="list-style-type: disc">Line</li><li class="listitem" style="list-style-type: disc">Pie</li><li class="listitem" style="list-style-type: disc">Bullet</li><li class="listitem" style="list-style-type: disc">Range map</li><li class="listitem" style="list-style-type: disc">TriState</li><li class="listitem" style="list-style-type: disc">Box plot</li></ul></div><p>To demonstrate a sparkline in action, we're going to go back to <a class="link" href="ch07.html" title="Chapter 7. Constructing Common UI Widgets">Chapter 7</a>, <em>Constructing Common UI Widgets</em>, and make use of our <code class="literal">product</code> grid:</p><div><pre class="programlisting">Ext.define('BizDash.view.product.ProductGrid', {
  extend: 'Ext.grid.Panel',
  xtype: 'product-ProductGrid',
  store: 'Products',
  columns: [
    {
      text: 'Name',
      dataIndex: 'Name'
    },
    {
      text: 'Description',
      dataIndex: 'Description',
      flex: 1
    },
    {
      text: 'Quantity',
      dataIndex: 'Quantity'
    },
    {
      text: 'Price ',
      dataIndex: 'Price'
    }
  ]
});</pre></div><p>A sparkline graph must be attached to a single data field, which contains an array of points that will be plotted. To demonstrate this feature, we will add a <code class="literal">HistoricSales</code> field to our Product model which will hold the data that we will plot:</p><div><pre class="programlisting">Ext.define('BizDash.model.Product', {
  extend: 'Ext.data.Model',
  ...
  fields: [
    ...
    {
      name: 'HistoricSales',
      type: 'auto',
      defaultValue: [4, 9, 12, 66, 9]
    }
  ]
});</pre></div><p>This grid <a id="id413" class="indexterm"/>already has a store and model bound to it, so it's <a id="id414" class="indexterm"/>simply a case of adding a new <code class="literal">widgetcolumn</code> to the <code class="literal">columns</code> array as follows:</p><div><pre class="programlisting">Ext.define('BizDash.view.product.ProductGrid', {
  extend: 'Ext.grid.Panel',
  columns: [
    ...
    {
      text : 'Historic Sales',
      xtype : 'widgetcolumn',
      dataIndex: 'HistoricSales',
      widget : {
        xtype: 'sparklineline'
      }
    }
  ]
});</pre></div><p>The <code class="literal">widget</code> config allows us to specify the xtype of the sparkline that will be rendered in the column (possible values include <code class="literal">sparklinebar</code>, <code class="literal">sparklinepie</code>, <code class="literal">sparklinebullet</code>, and <code class="literal">sparklinediscrete</code>). The following screenshot shows how this line graph is rendered:</p><div><img src="img/3717_09_04.jpg" alt="Integrating visualizations in grids"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec73"/>Summary</h1></div></div></div><p>Throughout this chapter, we have explored the details of adding charting visualizations to our Ext JS application. We have:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Covered the basics on how charts are created</li><li class="listitem" style="list-style-type: disc">Understood the components of a chart</li><li class="listitem" style="list-style-type: disc">Built a line chart</li><li class="listitem" style="list-style-type: disc">Built a bar chart</li><li class="listitem" style="list-style-type: disc">Built a pie chart</li><li class="listitem" style="list-style-type: disc">Integrated a visualization into a grid</li></ul></div><p>The next chapter dives into testing your Ext JS application by teaching you how to write testable JavaScript and unit tests for your Ext JS application.</p></div></body></html>