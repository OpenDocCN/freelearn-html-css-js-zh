<html><head></head><body>
        

                            
                    <h1 class="header-title">Working with Maps and Symbols</h1>
                
            
            
                
<p>In this chapter, we will cover the following recipes:</p>
<ul>
<li>Using Symbol to create a local instance</li>
<li>Using Symbol.for to create a global instance</li>
<li>Using Symbol to simulate enums</li>
<li>Setting and deleting entries from Map</li>
<li>Creating a Map from the existing data</li>
<li>Creating a class that wraps Map to work with specific complex types</li>
<li>Setting and deleting entries from WeakMap</li>
<li>Creating a WeakMap from existing data</li>
<li>Creating a class that uses WeakMap to work with specific complex types</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction</h1>
                
            
            
                
<p>We saw how to use ECMAScript classical semantics to concisely express more sophisticated relationships between data and operations. We also saw how to take advantage of expanded APIs for existing types (object and array). However, ECMAScript has more to offer. Among the new types are <kbd>Symbol</kbd>, <kbd>Map</kbd>, and cousin of <kbd>Map</kbd>, that is, <kbd>WeakMap</kbd>. These types, to some extent, could be simulated in earlier versions of JavaScript, but now are readily available and have native support.</p>
<p>The recipes in this chapter will illustrate some uses of these types, both together and in isolation.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Symbol to create a local instance</h1>
                
            
            
                
<p>Symbols on their own aren't particularly useful, but they are very useful as keys for other data structures. They are well suited as keys because it is possible to restrict the access to their values. There are two ways these comparisons can work. We can create local symbols, which are unique and can be recreated after initialization, and global symbols, which can be referenced by their constructor value.</p>
<p>In this recipe, we'll take a look at how to use <kbd>Symbol</kbd> as a function to create local symbols. This means that each instance will be new, even if the same arguments are used.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-01-local-symbols</kbd>.</li>
<li>Copy or create an <kbd>index.html</kbd> that loads and runs a <kbd>main</kbd> function from <kbd>main.js</kbd>.</li>
</ol>
<ol start="4">
<li>Create a <kbd>main.js</kbd> file that defines a <kbd>main</kbd> function that creates a couple of sets of symbols using the same arguments. Print out their equality as follows:</li>
</ol>
<pre style="padding-left: 90px">// main.js <br/>export function main() {<br/>    const usLaunchLocation = Symbol.for('Kennedy Space Center');<br/>    const duplicateLaunchLocation = Symbol.for('Kennedy Space <br/>    Center');<br/>    console.log(usLaunchLocation, duplicateLaunchLocation);<br/>    console.log('Identical launch locations: ', usLaunchLocation <br/>    === duplicateLaunchLocation);<br/>    const rocketNumber = Symbol.for(5);<br/>    const duplicateRocketNumber = Symbol.for(5);<br/>    const stringDuplicateRocketNumber = Symbol.for("5");<br/>    console.log(rocketNumber, duplicateRocketNumber, <br/>    stringDuplicateRocketNumber);<br/>    console.log('Identical rocket numbers: ', rocketNumber === <br/>    duplicateRocketNumber);<br/>    console.log(<br/>        'Identical string rocket numbers: ',<br/>        rocketNumber ===    stringDuplicateRocketNumber<br/>    );<br/>}</pre>
<ol start="5">
<li>
<p>Use <kbd>Symbol.keyFor</kbd> to note the <kbd>key</kbd> for the rocket number <kbd>Symbol</kbd>:</p>
</li>
</ol>
<pre style="padding-left: 90px">// main.js<br/>export function main() {<br/>    // ...<br/>    console.log(Symbol.keyFor(rocketNumber), <br/>    Symbol.keyFor(stringDuplicateRocketNumber));<br/>    // print type<br/>    console.log(<br/>        typeof Symbol.keyFor(rocketNumber),<br/>        typeof Symbol.keyFor(stringDuplicateRocketNumber)<br/>    )<br/>}</pre>
<ol start="6">
<li>
<p>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</p>
</li>
</ol>
<ol start="7">
<li class="mce-root">You should see the following output:</li>
</ol>
<div><img src="img/da7eb419-3f68-40b9-8f51-8ef7b9006292.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>When creating a <kbd>Symbol</kbd> with the <kbd>Symbol.for</kbd> method, the instance returned may be a preexisting instance. We can see this when we create a <kbd>Symbol</kbd> with the same string and number values. We can even see the same instance when a number is provided as a string.</p>
<p>When printing out the types for the keys, we can see why the numbers match, even when the argument is a string. When we retrieve a key for a numeric value, it is converted to a string, and thus is equivalent to the string representation of the number.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Symbol.for to create a global instance</h1>
                
            
            
                
<p>We've seen how to create unique symbols to use as keys in a local context. However, sometimes, we want to be able to interact with a data structure. Symbols can be made to work in this case as well.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-02-symbol-for-global</kbd>.</li>
<li>Copy or create an <kbd>index.html</kbd> that loads and runs a <kbd>main</kbd> function from <kbd>main.js</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a <kbd>main</kbd> function that creates a couple of sets of Symbols, using <kbd>Symbol.for</kbd>, with string and number arguments. Compare the numeric symbols with a number as string:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const usLaunchLocation = Symbol.for('Kennedy Space Center'); 
  const duplicateLaunchLocation = Symbol.for('Kennedy Space <br/>  Center'); 
  console.log(usLaunchLocation, duplicateLaunchLocation); 
  console.log('Identical launch locations: ', usLaunchLocation <br/>  === duplicateLaunchLocation); 
 
  const rocketNumber = Symbol.for(5); 
  const duplicateRocketNumber = Symbol.for(5); 
  const badDuplicateRocketNumber = Symbol.for('5'); 
  console.log(rocketNumber, duplicateRocketNumber, <br/>  badDuplicateRocketNumber); 
  console.log('Identical rocket numbers: ', rocketNumber === <br/>  duplicateRocketNumber); 
  console.log('Identical bad rocket numbers: ', rocketNumber <br/>  === duplicateRocketNumber); 
}  </pre>
<ol start="5">
<li>
<p>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</p>
</li>
<li>
<p>You should see the following output:</p>
</li>
</ol>
<div><img src="img/f3698b84-3f5f-4bc7-b59c-fa364b3a05c4.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The <kbd>slice</kbd> method takes two parameters, a start index and an end index. The end index is noninclusive. This means that the new set will include the elements between the start and end index, including the element at the start index, but not the element at the end index.</p>
<p>This might seem a bit confusing, but think of it this way, consider that the start index is two and the end index is three. The difference between those two numbers is one, and there is a single element in the resulting subset. For indices <em>0</em> and <em>2</em>, the difference is two and there will be two elements in the resulting subset.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Using Symbol to simulate enums</h1>
                
            
            
                
<p>We've seen how to create <kbd>Symbol</kbd> that can be accessed globally, and those that can't be accessed outside of their initial context. Now, we'll see how to use them to create something that wasn't really possible in earlier versions of JavaScript.</p>
<p>In this recipe, we'll use local <kbd>Symbol</kbd> to simulate a type that is available in many other languages, enums.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-03-symbols-simulate-enums</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>object</kbd> named <kbd>LaunchSite</kbd> , property values of the object should be local <kbd>Symbols</kbd>:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  WHITE_SANDS: Symbol('White Sands Missile Range'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome'), 
  BROGLIO: Symbol('Broglio Space Center'), 
  VIKRAM_SARABHAI: Symbol('Vikram Sarabhai Space Centre') 
}   </pre>
<ol start="4">
<li>Create a <kbd>main</kbd> function and compare the value of an enum entry to different values:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  console.log("Kennedy Space Center Site: ", LaunchSite.KENNEDY_SPACE_CENTER); 
  console.log("Duplicate String: ", LaunchSite.KENNEDY_SPACE_CENTER === 'Kennedy Space Center'); 
  console.log("Duplicate Symbol: ", LaunchSite.KENNEDY_SPACE_CENTER === Symbol('Kennedy Space Center')); 
  console.log("Duplicate Global Symbol: ", LaunchSite.KENNEDY_SPACE_CENTER === Symbol.for('kennedy Space Center')); 
}  </pre>
<ol start="5">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.<br/></li>
<li>You should see the following output:</li>
</ol>
<div><img src="img/fd2e2e79-dfba-49c0-a596-8ef555ccc571.png" style="width:55.67em;height:34.83em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>As mentioned before, the local <kbd>Symbol</kbd> instances will be unique every time they are created. Thus, we aren't able to recreate the <kbd>Symbol</kbd><strong> </strong>value in the <kbd>main</kbd> function. This means that any code expecting a value from that enum can't be coerced with an equivalent value.</p>
<p>One use in which enum types are valuable is as options. Imagine an options object, one of the options needs to be able to take multiple values (say animation tweening). A string value would get the job done but can easily be miss-typed. With an enum, the user of a function must reference that enum; this is less brittle and clearer when reading afterward.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting and deleting entries from Map</h1>
                
            
            
                
<p>The rest of this chapter will focus on new data structures added in ECMAScript. To some extent, they can be simulated in ES5. However, native support and explicit naming make code that utilizes these features more efficient and clearer.</p>
<p>In this recipe, we'll take a look at the basics of adding and removing entries from a <kbd>Map</kbd> using the <kbd>set</kbd> and <kbd>delete</kbd> methods.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-04-set-and-delete-from-map</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>class</kbd> named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
   } </pre>
<ol start="4">
<li class="mce-root">Create an enum of different launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
}  </pre>
<ol start="5">
<li>Create a <kbd>main</kbd> function. In that function, use the <kbd>set</kbd> and <kbd>delete</kbd> methods to manipulate entries of launch site to rocket:</li>
</ol>
<pre style="padding-left: 60px">// main.js 
export function main() { 
  const rocketSiteMap = new Map(); 
 
  rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, new Rocket('US: <br/>  Saturn V')); 
  const falconHeavy = new Rocket('US: Falcon Heavy'); 
  rocketSiteMap.set(LaunchSite.WHITE_SANDS, falconHeavy); 
  console.log(rocketSiteMap.get(LaunchSite.KENNEDY_SPACE_CENTER)); 
  console.log(rocketSiteMap.get(LaunchSite.WHITE_SANDS)); 
   
  rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, new Rocket('US: <br/>  Space Shuttle')); 
  rocketSiteMap.delete(LaunchSite.WHITE_SANDS); 
  console.log(rocketSiteMap.get(LaunchSite.KENNEDY_SPACE_CENTER)); 
  console.log(rocketSiteMap.get(LaunchSite.WHITE_SANDS));} 
 </pre>
<ol start="6">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
</ol>
<ol start="7">
<li>You should see the following output:</li>
</ol>
<div><img src="img/3f14a616-0c75-4b91-b8d2-50c5de97d59f.png" style="width:53.50em;height:33.50em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>The map is a pairing between a <kbd>key</kbd> and <kbd>value</kbd>. The keys reference the values when calling the instance of <kbd>Map</kbd>  methods. This pairing is one-to-one; this means that there can only be one value per key. Thus, when we set another rocket to the <kbd>KENNEDY_SPACE_CENTER</kbd> key, the old value is replaced.</p>
<p>The <kbd>delete</kbd> method removes the entry corresponding to the <kbd>key</kbd>. Thus, after <kbd>delete</kbd>, that particular entry is undefined.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a Map from the existing data</h1>
                
            
            
                
<p>We just saw how to add values individually to maps. This can be tedious, however. For example, if we are working with a dataset that might be very large or unknown ahead of time, it would be nice to initialize a map with a function call rather than hundreds or thousands.</p>
<p>In this recipe, we'll take a look at how to create a new Map with the preexisting data.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-05-create-map-from-data</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>class</kbd> named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
   } </pre>
<ol start="4">
<li>Create an enum of various launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
}  </pre>
<ol start="5">
<li>Create a <kbd>main</kbd> function. In that function, create a map with launch site and rocket key value pairs:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const rocketSites = [ 
    [ LaunchSite.KENNEDY_SPACE_CENTER, new Rocket('US: Saturn <br/>    V'),], 
    [ LaunchSite.WHITE_SANDS, new Rocket('US: Falcon Heavy') ], 
    [ LaunchSite.BAIKONUR, new Rocket('USSR: Soyuz') ], 
    [ LaunchSite.JUIQUAN, new Rocket('CN: Long March') ] ] 
 
  const rocketSiteMap = new Map(rocketSites); 
  console.log(rocketSiteMap) 
} </pre>
<ol start="6">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
<li>You should see the following output:</li>
</ol>
<div><img src="img/fc38f3a1-5497-4768-82ee-91df9ff7b27e.png" style="width:45.67em;height:31.67em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>As said before, the map is a pairing between a <kbd>key</kbd> and <kbd>value</kbd>. The <kbd>Map</kbd> constructor expects an <kbd>iterable</kbd> collection of key-value pairs. In the preceding recipe, we've passed a two-dimensional array. The outer dimension is the <kbd>iterable</kbd> that contains multiple entries.</p>
<p>The inner dimension is the key-value pair. The first member of the key-value is the launch site. The second member is the <kbd>value</kbd> (in our case, a <kbd>Rocket</kbd>). The <kbd>Map</kbd> constructor iterates over the entries provided and creates a pairing between each.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a class that wraps Map to work with specific complex types</h1>
                
            
            
                
<p>When working with a large collection, it can be nice to know what kind of object to expect when picking out on a member. Normally, JavaScript collections are heterogeneous, meaning that any type can be used. In the case of <kbd>Map</kbd>, this means that either <kbd>key</kbd> or <kbd>value</kbd> can take on any type.</p>
<p>In this recipe, we'll take a look at how to create a wrapper class for <kbd>Map</kbd> in order to control what types are used in the <kbd>Map</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-06-create-class-to-wrap-map</kbd>.</li>
</ol>
<ol start="3">
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>class</kbd> named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
   } </pre>
<ol start="4">
<li>Create a class named <kbd>RocketSiteMap</kbd> file that creates a new map and assigns it as an instance property in the constructor:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
  constructor () { 
    this.map = new Map(); 
     }    
   } </pre>
<ol start="5">
<li>Add the <kbd>set</kbd> method that checks the type of the <kbd>key</kbd> and <kbd>value</kbd> arguments. This method should throw an error if the argument types are incorrect, otherwise set the pair as an entry on the map:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
  set (site, rocket) { 
    if (!(rocket instanceof Rocket)) { 
      throw new Error('Value of `RocketMap` must be of type <br/>      `Rocket`'); 
    } 
    else if (typeof site !== 'symbol') { 
      throw new Error('Key of `RocketMap` must be of type <br/>      `Symbol`'); 
    } 
       
    this.map.set(site, rocket); 
  }   
   } </pre>
<ol start="6">
<li>Add a <kbd>get</kbd> method that returns the entry for <kbd>key</kbd> from the map:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
  get (key) { 
    return this.get(key); 
   } </pre>
<ol start="7">
<li>Create an enum of various launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
}  </pre>
<ol start="8">
<li>Create a <kbd>main</kbd> function. Attempt to set various <kbd>key</kbd> and <kbd>value</kbd> pairs to an instance of <kbd>RocketMap</kbd>:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const rocketSiteMap = new RocketSiteMap(); 
  rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, new Rocket('US: <br/>  Saturn V')); 
  rocketSiteMap.set(LaunchSite.WHITE_SANDS, new Rocket('US: Falcon <br/>  Heavy')); 
  console.log(rocketSiteMap) 
 
  try { 
    rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, 'Buzz <br/>    Lightyear'); 
  } catch (e) { 
    console.error(e); 
  } 
 
  try { 
    rocketSiteMap.set('Invalid Lanch Site', new Rocket('Long <br/>    March')); 
  } catch (e) { 
    console.error(e); 
  } 
} </pre>
<ol start="9">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
</ol>
<ol start="10">
<li>You should see the following output:</li>
</ol>
<div><img src="img/8f50eb6b-b852-4fca-9bbd-dd2a8f998f54.png" style="width:51.58em;height:35.75em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>From the implementation of the <kbd>set</kbd> method, we can see where the types of the arguments are being checked. <kbd>Symbol</kbd>, as a type, doesn't have a constructor, so we can't use the <kbd>instanceof</kbd> operator, but the <kbd>typeof</kbd> operator returns a <kbd>symbol</kbd> string we can check against. The <kbd>Rocket</kbd> instances behave like other instances we've seen in other recipes, and can be checked like the others.</p>
<p>When the incorrect type is passed as an argument to <kbd>set</kbd>, one of the conditionals will trigger and an error will be thrown.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting and deleting entries from WeakMap</h1>
                
            
            
                
<p>We've seen how to use Maps in a variety of situations. There is another new class in ECMAScript that behaves in a very similar way, but has some helpful properties. The <kbd>WeakMap</kbd>, like <kbd>Map</kbd>, is a key-value data structure.</p>
<p>In this recipe, we'll take a look at how to add and remove elements from a <kbd>WeakMap</kbd> with the <kbd>set</kbd> and <kbd>delete</kbd> methods. And we'll also see how they differ from the <kbd>Map</kbd> class.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-07-set-and-delete-from-weakmap</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>class</kbd> named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
   } </pre>
<ol start="4">
<li>Create an <kbd>enum</kbd> of various launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
} </pre>
<ol start="5">
<li>Create a <kbd>main</kbd> function. In that function, use the <kbd>set</kbd> and <kbd>delete</kbd> methods to manipulate entries of launch site to rocket. Try to use a <kbd>Symbol</kbd> as a key:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const falconHeavy = new Rocket('US: Falcon Heavy'); 
  const rocketSiteMap = new WeakMap(); 
 
  rocketSiteMap.set(new Rocket('US: Saturn V'), <br/>  LaunchSite.KENNEDY_SPACE_CENTER); 
  rocketSiteMap.set(falconHeavy, <br/>  LaunchSite.KENNEDY_SPACE_CENTER); 
  console.log(rocketSiteMap) 
 
  rocketSiteMap.delete(falconHeavy); 
  console.log(rocketSiteMap) 
 
  // try to set with a symbol; expect error 
  rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, falconHeavy); 
} </pre>
<ol start="6">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
</ol>
<ol start="7">
<li>You should see the following output:</li>
</ol>
<div><img src="img/27900186-3882-45ef-b827-33a0e363e680.png" style="width:46.00em;height:31.92em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>Like instances of <kbd>Map</kbd>, the <kbd>WeakMap</kbd> instance is a pairing between a <kbd>key</kbd> and <kbd>value</kbd>. However, crucially, they differ in what types can be used as keys. <kbd>Map</kbd> can use any type for keys. <kbd>WeakMap</kbd> can only have values of the <kbd>Object</kbd> type as keys. This helps <kbd>WeakMap</kbd> to be more efficient.</p>
<p>The reason that <kbd>WeakMap</kbd> can be more efficient has to do with memory management and garbage collection. Consider that Map entries have to be kept around for the lifetime of the program. Since they can use primitive types as keys (Booleans, strings, numbers, and Symbols), these values could be recreated, and those Map entries can be referenced at any time.</p>
<p><kbd>WeakMap</kbd> keys, by contrast, can only be of the <kbd>Object</kbd> type. The <kbd>Object</kbd> values cannot be recreated; objects with the same values are still different instances. This means that an entry to a <kbd>WeakMap</kbd> can only be accessed as long as a reference to the key is available; once that reference is lost, the entry can no longer be accessed.</p>
<p>The entries are no long accessible because the key value doesn't have any existing references to them. This means that the entry can be released from memory (no sense in keeping unused values around). This allows the garbage collector to free up that memory.</p>
<p>Refer to the Mozilla documentation for more information on <kbd>WeakMap</kbd>:<br/>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a WeakMap from existing data  </h1>
                
            
            
                
<p>We just saw how to add values individually to a <kbd>WeakMap</kbd> and why it is different from a <kbd>Map</kbd>. However, it can be tedious to create a <kbd>WeakMap</kbd> one entry at a time.</p>
<p>In this recipe, we'll take a look at how to create a new <kbd>Map</kbd> with the preexisting data.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>
<p>If you are unfamiliar with the <kbd>WeakMap</kbd> class, refer to the <em>Setting and deleting entries from WeakMap</em> recipe.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-08-create-weakmap-from-data</kbd>.</li>
</ol>
<ol start="3">
<li>Create a <kbd>main.js</kbd> file that defines a new class named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
   } </pre>
<ol start="4">
<li>Create an enum of various launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
}  </pre>
<ol start="5">
<li>Create a <kbd>main</kbd> function. In that function, create a map with launch site and rocket key value pairs:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const rocketSites = [ 
    [ new Rocket('US: Saturn V'), LaunchSite.KENNEDY_SPACE_CENTER <br/>    ], 
    [ new Rocket('US: Falcon Heavy'), LaunchSite.WHITE_SANDS ], 
    [ new Rocket('USSR: Soyuz'), LaunchSite.BAIKONUR ], 
    [ new Rocket('CN: Dong Feng'), LaunchSite.JUIQUAN ], 
    [ new Rocket('CN: Long March'), LaunchSite.JUIQUAN ] ]; 
 
  const rocketSiteMap = new WeakMap(rocketSites); 
  console.log(rocketSiteMap); 
} </pre>
<ol start="6">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
</ol>
<ol start="7">
<li>You should see the following output:</li>
</ol>
<div><img src="img/d3a0a127-9c6b-4f0e-9d02-73d4cee16809.png" style="width:51.25em;height:37.83em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>No surprises here, the <kbd>WeakMap</kbd> constructor adheres to the same interface as <kbd>Map</kbd>. The only difference is the type restriction on <kbd>key</kbd>. The argument for the constructor is a two-dimensional array, where the outer dimension is the list of entries. The inner dimension represents the key-value pairs. The first member of the inner dimension is the <kbd>key</kbd>, and the second is the <kbd>value</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a class that uses WeakMap to work with specific complex types</h1>
                
            
            
                
<p>Just as with <kbd>Map</kbd>, knowing what type to expect from the <kbd>WeakMap</kbd> collection can be valuable. The <kbd>key</kbd> types are very slightly restricted, but still pretty loose, and there is no restriction on what type the values can be.</p>
<p>In this recipe, we'll take a look at how to create a wrapper class for <kbd>WeakMap</kbd> in order to control what types are used in the <kbd>WeakMap</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>This recipe assumes that you already have a workspace that allows you to create and run ES modules in your browser. If you don't, refer to the first two chapters.</p>
<p>If you are unfamiliar with the <kbd>WeakMap</kbd> class, refer to the <em>Setting and deleting entries from WeakMap</em> recipe.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">How to do it...</h1>
                
            
            
                
<ol>
<li>Open your command-line application and navigate to your workspace.</li>
<li>Create a new folder named <kbd>11-09-create-class-to-wrap-weakmap</kbd>.</li>
<li>Create a <kbd>main.js</kbd> file that defines a new <kbd>class</kbd> named <kbd>Rocket</kbd> that takes a constructor argument <kbd>name</kbd> and assigns it to an instance property:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class Rocket { 
  constructor(name) { 
    this.name = name; 
  } 
} </pre>
<ol start="4">
<li>Create a class named  <kbd>RocketSiteMap</kbd> file that creates a new map and assigns it as an instance property in the constructor:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
  constructor () { 
    this.map = new WeakMap(); 
     }    
   } </pre>
<ol start="5">
<li>Add the <kbd>set</kbd> method that checks the type of the <kbd>key</kbd> and <kbd>value</kbd> arguments. This method should throw if the argument types are incorrect, otherwise set the pair as an entry on the map:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
set (rocket, site) { 
    if (!(rocket instanceof Rocket)) { 
      throw new Error('Key of `RocketMap` must be of type <br/>      `Rocket`'); 
    } 
    else if (typeof site !== 'symbol') { 
      throw new Error('Values of `RocketMap` must be of type <br/>      `Symbol`'); 
    } 
       
    this.map.set(rocket, site); 
  } 
 
  get (key) { 
    return this.get(key); 
     } 
   } </pre>
<ol start="6">
<li>Add a <kbd>get</kbd> method that returns the entry for <kbd>key</kbd> from the map:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
class RocketSiteMap { 
  get (key) { 
    return this.get(key); 
   } </pre>
<ol start="7">
<li>Create an enum of various launch sites:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
const LaunchSite = { 
  KENNEDY_SPACE_CENTER: Symbol('Kennedy Space Center'), 
  JUIQUAN: Symbol('Jiuquan Satellite Launch Center'), 
  WHITE_SANDS: Symbol('Jiuquan Satellite Launch Center'), 
  BAIKONUR: Symbol('Baikonur Cosmodrome') 
}  </pre>
<ol start="8">
<li>Create a <kbd>main</kbd> function. Attempt to set various <kbd>key</kbd> and <kbd>value</kbd> pairs to an instance of <kbd>RocketMap</kbd>:</li>
</ol>
<pre style="padding-left: 90px">// main.js 
export function main() { 
  const rocketSiteMap = new RocketSiteMap(); 
  rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, new <br/>  Rocket('US: <br/>  Saturn V')); 
  rocketSiteMap.set(LaunchSite.WHITE_SANDS, new Rocket('US: <br/>  Falcon <br/>  Heavy')); 
  console.log(rocketSiteMap) 
 
  try { 
    rocketSiteMap.set(LaunchSite.KENNEDY_SPACE_CENTER, 'Buzz <br/>    Lightyear'); 
  } catch (e) { 
    console.error(e); 
  } 
 
  try { 
    rocketSiteMap.set('Invalid Lanch Site', new Rocket('Long <br/>    March')); 
  } catch (e) { 
    console.error(e); 
  } 
} </pre>
<ol start="9">
<li>Start your Python web server and open the following link in your browser:<br/>
<kbd>http://localhost:8000/</kbd>.</li>
</ol>
<ol start="10">
<li>You should see the following output:</li>
</ol>
<div><img src="img/785eef62-189a-4cb1-b69b-620af63886de.png" style="width:49.92em;height:36.83em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">How it works...</h1>
                
            
            
                
<p>From the implementation of the <kbd>set</kbd> method, we can see where types of the arguments are being checked. <kbd>Symbol</kbd>, as a type, doesn't have a constructor, so we can't use the <kbd>instanceof</kbd> operator, but the <kbd>typeof</kbd> operator returns a symbol string we can check against. The <kbd>Rocket</kbd> instances behave like other instances we've seen in other recipes, and can be checked like the others.</p>
<p>When the incorrect type is passed as an argument to <kbd>set</kbd>, one of the conditionals will trigger, and an error will be thrown.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            

            
        
    </body></html>