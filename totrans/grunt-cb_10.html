<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Static Sites</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem">Setting up a basic site project</li><li class="listitem">Adding a page to the site</li><li class="listitem">Adding content to the site</li><li class="listitem">Adding data to the site</li><li class="listitem">Creating and using a site layout</li><li class="listitem">Generating pages from a collection</li><li class="listitem">Creating a template helper</li><li class="listitem">Using a plugin</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec96"/>Introduction</h1></div></div></div><p>One of the areas where Grunt really shines is in the management of static website projects. Using Grunt for generating a static website can result in a fast and easily modifiable site, replacing the complexity and cost of building a traditional server-generated site when its advantages would not be useful to the situation.</p><p>In this chapter we'll be focusing on making use of the <strong>Assemble</strong> framework<a id="id473" class="indexterm"/> to build a static website. At its core, Assemble is a Grunt plugin, but it also uses Grunt to bring together all its other related tools.</p><p>As an example, we'll build a simple <a id="id474" class="indexterm"/>static website to represent us on the Internet in an individual capacity. Think of it as a résumé made available to the public via the <strong>World Wide Web</strong> (<strong>WWW</strong>).</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec97"/>Setting up a basic site project</h1></div></div></div><p>To speed up <a id="id475" class="indexterm"/>the process of starting a new project based on the <strong>Assemble</strong> framework, we'll <a id="id476" class="indexterm"/>make use of a <strong>Yeoman</strong> generator<a id="id477" class="indexterm"/> provided by the developer community. The generator will produce a minimal project setup, with everything we'll need to get started.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec220"/>Getting started</h2></div></div></div><p>The only requirement for this recipe is a global installation of Node.js, with Grunt installed on top of it as per the <em>Installing the Grunt CLI</em> recipe in <a class="link" title="Chapter 1. Getting Started with Grunt" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <em>Getting Started with Grunt</em>. Be sure to refer to it if you are not yet familiar with its contents.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec221"/>How to do it...</h2></div></div></div><p>The following steps take us through installing the Yeoman tool and using it to generate a basic Assemble project.</p><div><ol class="orderedlist arabic"><li class="listitem">First we'll need to install the Yeoman tool globally using the <code class="literal">npm</code> utility. This is done by entering the following command:<div><pre class="programlisting">
<strong>$ npm install --global yo</strong>
</pre></div></li><li class="listitem">We'll also need to install the Yeoman generator that is specifically geared toward generating an Assemble project. This is done by entering the following command:<div><pre class="programlisting">
<strong>$ npm install --global generator-assemble</strong>
</pre></div></li><li class="listitem">Next we'll create a directory called <code class="literal">mysite</code> that will contain our static website project, and navigate into it using a command similar to the following:<div><pre class="programlisting">
<strong>$ mkdir mysite &amp;&amp; cd mysite</strong>
</pre></div></li><li class="listitem">With Yeoman and the required generator installed, we can now use it to generate our plugin project by running the following command:<div><pre class="programlisting">
<strong>$ yo assemble</strong>
</pre></div></li><li class="listitem">After running the previous command, we will be presented with a series of questions that will assist the generator in creating the project. This interaction should look something like the following:<div><pre class="programlisting">
<strong>? Your project name: mysite</strong>
<strong>? Your project description: The best project ever.</strong>
<strong>? Would you mind telling me your username on Github? me</strong>
<strong>? Do you want to install Ass</strong>
<strong>emble plugins? No</strong>
</pre></div><div><h3 class="title"><a id="tip122"/>Tip</h3><p>Be sure you replace the example <code class="literal">me</code> GitHub username with your own, and to opt-out of installing any extra Assemble plugins. Making use of extra plugins will be discussed later in this chapter.</p></div></li><li class="listitem">After the <a id="id478" class="indexterm"/>questions have been answered, the generator will create the files required for a simple static website project. Output similar to the following will inform us of these actions:<div><pre class="programlisting">
<strong>create AUTHORS</strong>
<strong>create CHANGELOG</strong>
<strong>create LICENSE-MIT</strong>
<strong>create Gruntfile.js</strong>
<strong>create package.json</strong>
<strong>create .editorconfig</strong>
<strong>create README.md</strong>
<strong>create .gitignore</strong>
<strong>create .gitattributes</strong>
<strong>create bower.json</strong>
<strong>create src/data/site.yml</strong>
<strong>create src/assets/theme.css</strong>
<strong>create src/content/markdown.md</strong>
<strong>create src/templates/pages/blog.hbs</strong>
<strong>create src/templates/pages/index.hbs</strong>
<strong>create src/templates/layouts/default.hbs</strong>
<strong>create src/templates/partials/navbar-fixed-top.hbs</strong>
</pre></div></li><li class="listitem">After creating the aforementioned files the generator should also automatically install the required dependencies mentioned in the newly created <code class="literal">package.json</code> and <code class="literal">bower.json</code> files. If however it appears that the dependencies have not been installed, you can try to do so manually using the following command:<div><pre class="programlisting">
<strong>$ bower install &amp; npm install</strong>
</pre></div></li><li class="listitem">With the necessary files created and dependencies installed, we can now build our site and have it locally hosted, using the <code class="literal">grunt server</code> command. This should produce output similar to the following:<div><pre class="programlisting">
<strong>Running "clean:0" (clean) task</strong>
<strong>&gt;&gt; 0 paths cleaned.</strong>

<strong>Running "copy:bootstrap" (copy) task</strong>
<strong>Created 4 directories, copied 12 files</strong>

<strong>Running "copy:theme" (copy) task</strong>
<strong>Created 1 directories, copied 1 files</strong>

<strong>Running "assemble:pages" (assemble) task</strong>
<strong>Assembling dist/blog.html OK</strong>
<strong>Assembling dist/index.html OK</strong>
<strong>&gt;&gt; 2 pages assembled.</strong>

<strong>Running "connect:livereload" (connect) task</strong>
<strong>Started connect web server on http://localhost:9000</strong>

<strong>Running "watch" task</strong>
<strong>Waiting...</strong>
</pre></div></li><li class="listitem">Once <a id="id479" class="indexterm"/>the <code class="literal">server</code> task has completed, it should automatically open your default browser on <code class="literal">http://localhost:9000/</code>, which should show you the standard generated site. At the time of writing, it looked something like the following:<div><img src="img/image00281.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec98"/>Adding a page to the site</h1></div></div></div><p>As its core, a <a id="id480" class="indexterm"/>static website is just a collection of pages. With our basic<a id="id481" class="indexterm"/> setup in place we can look at adding a page that contains some biographical information about us.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec222"/>Getting started</h2></div></div></div><p>In this recipe we'll work with the basic project structure that we created in the <em>Setting up a basic site project</em> recipe earlier in this chapter. Be sure to refer to it if you are not yet familiar with it's content. Before we start we should also make sure that the site builder and server are running. If they aren't yet running, they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec223"/>How to do it...</h2></div></div></div><p>The following steps take us through adding a page to our static site that will contain our simple <a id="id482" class="indexterm"/>biography:</p><div><ol class="orderedlist arabic"><li class="listitem">First we'll create a file called <code class="literal">bio.hbs</code> in the <code class="literal">src/templates/pages</code> directory and fill it with some information about our new page:<div><pre class="programlisting">---
title: Bio
heading: 'Biography'
---</pre></div><div><h3 class="title"><a id="tip123"/>Tip</h3><p>The initial part of the file is called<a id="id483" class="indexterm"/> the <strong>YAML front matter</strong> section which can be used to provide metadata about a page to the site building tool. You can read more about it at the following URL:</p><p><a class="ulink" href="http://assemble.io/docs/YAML-front-matter.html">http://assemble.io/docs/YAML-front-matter.html</a></p></div></li><li class="listitem">With our <a id="id484" class="indexterm"/>page information added to the file, we can proceed to add the HTML content of the page. Let's do that by adding the following after the front matter section:<div><pre class="programlisting">&lt;div class="jumbotron"&gt;
  &lt;h1&gt;{{ heading }}&lt;/h1&gt;
  &lt;p&gt;Building awesome sites since 2014.&lt;/p&gt;
&lt;/div&gt;</pre></div><p>The default template language provided by the Assemble project generator is Handlebars, which was used in the preceding code. You can read more about <a id="id485" class="indexterm"/>Handlebars at the following URL:</p><p><a class="ulink" href="http://handlebarsjs.com/">http://handlebarsjs.com/</a></p><p>Also be sure to observe that the metadata provided in the front matter section can be used in the page templates. An example of this can be seen with the usage of the <code class="literal">heading</code> variable in the preceding code.</p></li><li class="listitem">After saving our newly created page file, the site builder that we initially started up should automatically detect that it has been added and proceed to recompile our site, producing output similar to the following:<div><pre class="programlisting">
<strong>&gt;&gt; File "src/templates/pages/bio.hbs" added.</strong>
<strong>Running "assemble:pages" (assemble) task</strong>
<strong>Assembling dist/bio.html OK</strong>
<strong>Assembling dist/blog.html OK</strong>
<strong>Assembling dist/index.html OK</strong>
<strong>&gt;&gt; 3 pages assembled.</strong>
</pre></div></li><li class="listitem">Once it <a id="id486" class="indexterm"/>has finished with the compilation it should refresh our browser view of <code class="literal">http://localhost:9000/</code>, after which we should now <a id="id487" class="indexterm"/>see a new <code class="literal">Bio</code> item in our navigation bar at the top of the site. If we select this item we should be presented with our new page that should look something like the following:<div><img src="img/image00282.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec99"/>Adding content to the site</h1></div></div></div><p>When <a id="id488" class="indexterm"/>developing a website it is usually recommended that <a id="id489" class="indexterm"/>the structure and content of a site remain separated. Having it organized in this fashion makes it easy for us to edit the ever changing content of a site, without having to get involved with it's relatively static structure every time we do so.</p><p>The <strong>Assemble</strong> framework comes bundled with a library that implements the <a id="id490" class="indexterm"/>
<strong>Markdown</strong> text formatting syntax; this allows us to easily create content documents with a minimal structure that is rendered to well-formed HTML.</p><p>You can read more about the <a id="id491" class="indexterm"/>Markdown syntax at following the URL:</p><p><a class="ulink" href="http://daringfireball.net/projects/markdown/">http://daringfireball.net/projects/markdown/</a></p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec224"/>Getting started</h2></div></div></div><p>In this recipe we'll continue <a id="id492" class="indexterm"/>working on the project from the <em>Adding a page to the site</em> recipe in this chapter. Be sure to refer to it if you are not yet familiar with its contents. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec225"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a markdown document to contain our biography and using it in a page.</p><div><ol class="orderedlist arabic"><li class="listitem">First, we'll create a new file called <code class="literal">bio.md</code> in the <code class="literal">src/content</code> directory and fill it with the contents of our biography in Markdown format:<div><pre class="programlisting">## Achievements

* Built this awesome site
* Mastered Grunt
* Explored Assemble

## History

Born in a galaxy far, far away.</pre></div><div><h3 class="title"><a id="tip124"/>Tip</h3><p>A handy cheatsheet for the Markdown syntax supported by Assemble can be found at the following URL:</p><p><a class="ulink" href="http://assemble.io/docs/Cheatsheet-Markdown.html">http://assemble.io/docs/Cheatsheet-Markdown.html</a></p></div></li><li class="listitem">With our content file created we now need to use it on our site. We'll do that by changing the contents of the <code class="literal">src/templates/pages/bio.hbs</code> file to the following:<div><pre class="programlisting">---
title: Bio
heading: 'Biography'
---
&lt;div class="jumbotron"&gt;
  &lt;h1&gt;{{ heading }}&lt;/h1&gt;
  {{md 'src/content/bio.md'}}
&lt;/div&gt;</pre></div><div><h3 class="title"><a id="tip125"/>Tip</h3><p>The <code class="literal">md</code> <strong>Handlebars</strong> helper<a id="id493" class="indexterm"/> is provided by the <code class="literal">handlebars-helpers</code> package that comes bundled with Assemble. It can be used to render a Markdown file by providing either a string or a variable that contains a file path.</p></div></li><li class="listitem">After saving<a id="id494" class="indexterm"/> the altered <code class="literal">bio.hbs</code> file, the site builder that we initially started up should automatically detect that it has been modified and proceed to recompile our site, producing output similar to the following:<div><pre class="programlisting">
<strong>&gt;&gt; File "src/templates/pages/bio.hbs" changed.</strong>
<strong>Running "assemble:pages" (assemble) task</strong>
<strong>Assembling dist/bio.html OK</strong>
<strong>Assembling dist/blog.html OK</strong>
<strong>Assembling dist/index.html OK</strong>
<strong>&gt;&gt; 3 pages assembled.</strong>
</pre></div></li><li class="listitem">If we now have a look at our biography page at <code class="literal">http://localhost:9000/bio.html</code> we'll see that our new content is now displayed on it; it should look something like the following:<div><img src="img/image00283.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec100"/>Adding data to the site</h1></div></div></div><p>Quite often <a id="id495" class="indexterm"/>we'll find that the majority of the content on a site repeats a pattern, and that only certain parts of the content differ from page to page. A site that displays articles for instance, will display each article using the same layout, and also have them listed in a repetitive manner. As developers, we'd probably like to avoid having to create each of these similar structured pages or items by hand.</p><p>For this purpose it's usually recommended to store the content we like to display in this fashion as data, which we can then render using a template or layout that will present each of them with the same template.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec226"/>Getting started</h2></div></div></div><p>In this recipe we'll continue working with the project from the <em>Adding content to the site </em>recipe found earlier in this chapter. Be sure to refer to it if you are not yet familiar with its contents. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec227"/>How to do it...</h2></div></div></div><p>The following <a id="id496" class="indexterm"/>steps take us through adding data that represents the items in our navigation bar and using that data to customize the rendering of the navigation bar.</p><div><ol class="orderedlist arabic"><li class="listitem">Due to there only being one navigation bar for our site, we might as well just add it to the existing <code class="literal">site.yml</code> file located in the <code class="literal">src/data</code> directory. This file is used for storing data related to the site itself. Let's add the following <code class="literal">sections</code> collection to its contents:<div><pre class="programlisting">title: Mysite
sections:
  - title: Home
    dest: 'dist/index.html'
  - title: Bio
    dest: 'dist/bio.html'
  - title: Blog
    dest: 'dist/blog.html'</pre></div><div><h3 class="title"><a id="tip126"/>Tip</h3><p>The preceding file has its data stored in the <a id="id497" class="indexterm"/>YAML format. The following URL provides more information about the YAML format <a id="id498" class="indexterm"/>at <a class="ulink" href="http://yaml.org/">http://yaml.org/</a>.</p></div></li><li class="listitem">Next we'll be altering the template of the navigation bar to use the <code class="literal">sections</code> data we've provided in the <code class="literal">site.yml</code> file. To do this we will first need to find the following block of code in the <code class="literal">navbar-fixed-top.hbs</code> file located in the <code class="literal">src/templates/partials</code> directory:<div><pre class="programlisting">{{#each pages}}
&lt;li{{#if this.isCurrentPage}} class="active"{{/if}}&gt;
  &lt;a href="{{relative dest this.dest}}"&gt;{{data.title}}&lt;/a&gt;
&lt;/li&gt;
{{/each}}</pre></div></li><li class="listitem">Once we've found the aforementioned block of code, we can replace the it with the code that will list navigation items according to the <code class="literal">sections</code> data. This is done by replacing it with the following code:<div><pre class="programlisting">{{#each site.sections}}
&lt;li {{#is dest ../page.dest}} class="active"{{/is}}&gt;
  &lt;a href="{{relative ../page.dest dest}}"&gt;{{title}}&lt;/a&gt;
&lt;/li&gt;
{{/each}}</pre></div><div><h3 class="title"><a id="tip127"/>Tip</h3><p>Here, the <code class="literal">#is</code> helper<a id="id499" class="indexterm"/> is used to check that the full path name of the page is the same as the one that should be linked to by the navigation bar item. If they match, then the item should be rendered as the currently activated one.</p><p>The <code class="literal">relative</code> helper<a id="id500" class="indexterm"/> is used here to determine the relative path from the current page to the one that the navigation item should be linked to.</p><p>Both the helpers mentioned here are provided by the <code class="literal">handlebars-helpers</code> library bundled along with Assemble.</p><p>The Assemble framework makes the data contained in the <code class="literal">src/data</code> directory available according to variables with the same names as the filenames the directory contains. This is how we can use the <code class="literal">site</code> variable name in the previous example to access the data contained in the <code class="literal">site.yml</code> file</p></div></li><li class="listitem">After<a id="id501" class="indexterm"/> saving the altered <code class="literal">navbar-fixed-top.hbs</code> file the site builder that we initially started up should automatically detect that it has been modified, and proceed to recompile our site, producing output similar to the following:<div><pre class="programlisting">&gt;&gt; File "src/templates/partials/navbar-fixed-top.hbs" changed.
Running "assemble:pages" (assemble) task
Assembling dist/bio.html OK
Assembling dist/blog.html OK
Assembling dist/index.html OK
&gt;&gt; 3 pages assembled.</pre></div></li><li class="listitem">If we now have a look at any of the pages at <code class="literal">http://localhost:9000/</code> we'll see that the items in the navigation bar are now ordered according to the order of the items in the <code class="literal">sections</code> data:<div><img src="img/image00284.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec101"/>Creating and using a site layout</h1></div></div></div><p>Having a <a id="id502" class="indexterm"/>consistent layout across a site can drastically improve its <a id="id503" class="indexterm"/>usability and also save time in its development. The Assemble framework allows us to easily create and use layouts in various ways.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec228"/>Getting ready</h2></div></div></div><p>In this recipe we'll continue working on the project from the <em>Adding data to the site</em> recipe in this chapter. Be sure to refer to it if you are not yet familiar with it's contents. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec229"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a new layout template and setting up some sample blog pages that use it.</p><div><ol class="orderedlist arabic"><li class="listitem">First, we'll <a id="id504" class="indexterm"/>create a new layout template that will provide <a id="id505" class="indexterm"/>the layout for our sample blog post pages. Let's create a file called <code class="literal">post.hbs</code> in the <code class="literal">src/templates/layouts</code> directory and fill it with the following contents:<div><pre class="programlisting">---
layout: src/templates/layouts/default.hbs
---
&lt;div class="row"&gt;
  &lt;div class="col-xs-3"&gt;
    &lt;ul class="nav nav-pills nav-stacked"&gt;
      {{#each pages}}
        &lt;li{{#if this.isCurrentPage}} class="active"{{/if}}&gt;
          &lt;a href="{{relative dest this.dest}}"&gt;
            {{data.title}}
          &lt;/a&gt;
        &lt;/li&gt;
      {{/each}}
    &lt;/ul&gt;
  &lt;/div&gt;
  &lt;div class="col-xs-9"&gt;
    &lt;h1&gt;{{title}}&lt;/h1&gt;
    {{&gt; body}}
  &lt;/div&gt;
&lt;/div&gt;</pre></div><div><h3 class="title"><a id="tip128"/>Tip</h3><p>At the top of the file in the YAML front matter section, we made use of the special <code class="literal">layout</code> property to indicate the parent template that should be used for this template. You can<a id="id506" class="indexterm"/> read more about how template inheritance works in Assemble at the following web address:</p><p><a class="ulink" href="http://assemble.io/docs/Layouts.html">http://assemble.io/docs/Layouts.html</a></p><p>The combination of HTML and CSS used to build this layout is provided by the <strong>Bootstrap</strong> project that is included by default when using the Assemble Yeoman generator we used to set up this project. You can read more about <a id="id507" class="indexterm"/>Bootstrap at the following web address:</p><p><a class="ulink" href="http://getbootstrap.com/">http://getbootstrap.com/</a></p></div></li><li class="listitem">Now we'll create some sample blog pages that will be making use of our newly created layout. We'll do this by creating three files called in the <code class="literal">src/templates/pages/posts</code> directory with the following names: <code class="literal">one.hbs</code>, <code class="literal">two.hbs</code>, and <code class="literal">three.hbs</code>. Each of these should contain something similar to the following:<div><pre class="programlisting">---
title: One
---
&lt;p&gt;This is post one.&lt;/p&gt;</pre></div><div><h3 class="title"><a id="tip129"/>Tip</h3><p>The content of these pages can be pretty much anything, as long as there is at least a front matter section containing a <code class="literal">title</code> and some HTML content after that.</p></div></li><li class="listitem">In<a id="id508" class="indexterm"/> order <a id="id509" class="indexterm"/>for our newly created pages to be rendered we will have to add a new <code class="literal">assemble</code> task target. This target will however be sharing many of the options of the existing <code class="literal">pages</code> target, so what we'll do next is move the <code class="literal">options</code> of the <code class="literal">pages</code> target into the <code class="literal">assemble</code> task configuration itself, so that it can be shared across all the targets in the <code class="literal">assemble</code> task:<div><pre class="programlisting">assemble: {
  options: {
    flatten: true,
    assets: '&lt;%= config.dist %&gt;/assets',
    layout: '&lt;%= config.src %&gt;/templates/layouts/default.hbs',
    data: '&lt;%= config.src %&gt;/data/*.{json,yml}',
    partials: '&lt;%= config.src %&gt;/templates/partials/*.hbs'
  },
  pages: {
    files: {
      '&lt;%= config.dist %&gt;/': [
        '&lt;%= config.src %&gt;/templates/pages/*.hbs'
      ]
    }
  }
}</pre></div></li><li class="listitem">With the options shared across all targets now, we can add the <code class="literal">task</code> target that will be rendering our sample post pages for us. Let's add the following task target called <code class="literal">posts</code> to the assemble task:<div><pre class="programlisting">posts: {
  options: {
    layout: '&lt;%= config.src %&gt;/templates/layouts/post.hbs',
  },
  files: {
    '&lt;%= config.dist %&gt;/posts/': [
      '&lt;%= config.src %&gt;/templates/pages/posts/*.hbs'
    ]
  }
}</pre></div></li><li class="listitem">In order <a id="id510" class="indexterm"/>for <a id="id511" class="indexterm"/>us to reach these newly generated pages to make some changes to the blog post listing page. This can be done by changing the contents of the <code class="literal">blog.hbs</code> file in the <code class="literal">src/templates/pages</code> directory to the following:<div><pre class="programlisting">---
title: Blog
---
&lt;h1&gt;Posts&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/posts/one.html"&gt;One&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/posts/two.html"&gt;Two&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/posts/three.html"&gt;Three&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</pre></div></li><li class="listitem">Before we continue we'll also have to take care of a slight side effect we caused when placing our sample page templates in the <code class="literal">src/templates/pages/posts</code> directory. The default <code class="literal">watch</code> task setup that triggers automatic compilation of changed templates isn't configured to look for changes deeper than the <code class="literal">src/templates/pages</code> directory itself. This means that changes to our sample page templates won't trigger a re-compilation. Let's take care of this problem by changing the <code class="literal">files</code> configuration of the <code class="literal">assemble</code> target of the <code class="literal">watch</code> task to the following:<div><pre class="programlisting">assemble: {
  files: [
    '&lt;%= config.src %&gt;' +
    '/{content,data,templates}/**/*.{md,hbs,yml}'
  ],
  tasks: ['assemble']
}</pre></div></li><li class="listitem">Finally, we can restart our server that was running so that the configuration changes may take effect. After restarting, we should see some extra output with regards to the rendering of our sample post pages:<div><pre class="programlisting">
<strong>Running "assemble:posts" (assemble) task</strong>
<strong>Assembling dist/posts/one.html OK</strong>
<strong>Assembling dist/posts/three.html OK</strong>
<strong>Assembling dist/posts/two.html OK</strong>
<strong>&gt;&gt; 3 pages assembled.</strong>
</pre></div></li><li class="listitem">If <a id="id512" class="indexterm"/>we now navigate <a id="id513" class="indexterm"/>to the blog section of our site at <code class="literal">http://localhost:9000/blog.html</code> and follow one of the listed links we should now see the selected post page rendered using our new layout template:<div><img src="img/image00285.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec102"/>Generating pages from a collection</h1></div></div></div><p>In case<a id="id514" class="indexterm"/> we've got a collection of items in our site<a id="id515" class="indexterm"/> data, we might very well want to generate some pages using that collection. A site that displays blog posts, for instance, would probably want an individual page generated for each post in the collection of posts.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec230"/>Getting started</h2></div></div></div><p>In <a id="id516" class="indexterm"/>this recipe we'll be continuing work on the project from the <em>Creating and using a site layout</em> recipe<a id="id517" class="indexterm"/> in this chapter. Be sure to refer to it if you are not yet familiar with it's content. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec231"/>How to do it...</h2></div></div></div><p>The following steps take us through creating a data file that contains a collection of our blog posts, and configuring our project to generate pages using that collection.</p><div><ol class="orderedlist arabic"><li class="listitem">Let's start with creating the collection data that we'll be generating pages from. We can do this by creating a file called <code class="literal">posts.yml</code> in the <code class="literal">src/data</code> directory and giving it the following content:<div><pre class="programlisting">
<strong>- filename: one</strong>
<strong>  data:</strong>
<strong>    title: One</strong>
<strong>  content: &lt;p&gt;This is post one.&lt;/p&gt;</strong>
<strong>- filename: two</strong>
<strong>  data:</strong>
<strong>    title: Two</strong>
<strong>  content: &lt;p&gt;This is post two.&lt;/p&gt;</strong>
<strong>- filename: three</strong>
<strong>  data:</strong>
<strong>    title: Three</strong>
<strong>  content: &lt;p&gt;This is post three.&lt;/p&gt;</strong>
</pre></div><div><h3 class="title"><a id="tip130"/>Tip</h3><p>In each of the page objects, the <code class="literal">filename</code> property indicates the filename of the page that is to be generated, the <code class="literal">data</code> property can be used to send any kind of metadata to the page, and the <code class="literal">content</code> property can be used to provide the content that should be rendered by the <code class="literal">body</code> tag.</p><p>The aforementioned format is determined by the <code class="literal">pages</code> option for the <code class="literal">assemble</code> task that will be used later in this recipe.</p></div></li><li class="listitem">Now that we've got the out blog posts in a data collection, we can remove the page templates we previously used to represent them. This can be done by simply deleting the entire <code class="literal">src/templates/pages/posts</code> directory.</li><li class="listitem">With <a id="id518" class="indexterm"/>our collection ready and the old page templates removed, we can now alter our configuration to render the <a id="id519" class="indexterm"/>post pages from the collection. We'll do this by making the following changes to the <code class="literal">posts</code> target in the <code class="literal">assemble</code> task:<div><pre class="programlisting">Posts: {
  options: {
    layout: '&lt;%= config.src %&gt;/templates/layouts/post.hbs',
    <strong>pages: grunt.file.readYAML('src/data/posts.yml')</strong>
  },
  <strong>files: {'&lt;%= config.dist %&gt;/posts/': []}</strong>
}</pre></div><div><h3 class="title"><a id="tip131"/>Tip</h3><p>The collection that should be used to generate the new pages from is indicated using the pages option. As can be seen in the preceding example, we're also making use of the <code class="literal">grunt.file.readYAML</code> utility to load the collection from the <code class="literal">src/data/posts.yml</code> file we created earlier.</p><p>The destination in the files object no longer indicates specific <code class="literal">files</code> that should be rendered, but now indicates the directory into which newly generated pages should be saved to.</p></div></li><li class="listitem">Finally, we can restart our server that was running in the background for the configuration changes may take effect. After restarting, we should see some extra output with regards to the rendering of our post pages from the provided collection:<div><pre class="programlisting">
<strong>Running "assemble:posts" (assemble) task</strong>
<strong>Assembling dist/posts/one.html OK</strong>
<strong>Assembling dist/posts/two.html OK</strong>
<strong>Assembling dist/posts/three.html OK</strong>
<strong>&gt;&gt; 3 pages assembled.</strong>
</pre></div></li><li class="listitem">If we now navigate around the blog post items in our site, we should see that they now reflect the data that is being provided by the posts collection.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec232"/>Creating a template helper</h2></div></div></div><p>In the process <a id="id520" class="indexterm"/>of building page templates, we often come across patterns that are repeated in their rendering logic. Template helpers allow us to wrap one of these identified patterns in such a way that it can be easily reused in our templates across our site.</p><p>Arguments can be passed to template helpers, and the logic of the helpers themselves are implemented using a regular programming language, making the possibilities of what can be achieved with them quite numerous.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec233"/>Getting started</h2></div></div></div><p>In this recipe we'll be continuing work on the project from the <em>Generating pages from a collection</em> recipe. Be sure to refer to it if you are not yet familiar with it's content. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec234"/>How to do it...</h2></div></div></div><p>The following <a id="id521" class="indexterm"/>steps take us through creating a template tag for automatically listing our posts on our blog page using the data in the posts collection.</p><div><ol class="orderedlist arabic"><li class="listitem">Let's start by creating the <code class="literal">lib/helpers</code> directory, which is used to contain the source files that contain the code for our helpers.</li><li class="listitem">With our directory ready now, we can create a file called <code class="literal">pages.js</code> in the <code class="literal">lib/helpers</code> directory and fill it with the following code:<div><pre class="programlisting">module.exports.register = function(
  Handlebars, options, params
) {
  Handlebars.registerHelper(
    'pages',
    function(target, options) {
      var config = params.grunt.config;
      var pages = config.get('assemble')[target].options.pages;
      var result = '';
      for(var i = 0; i &lt; pages.length; i++) {
        result = result + options.fn(pages[i]);
      }
      return result;
    }
  );
};</pre></div><div><h3 class="title"><a id="tip132"/>Tip</h3><p>The preceding helper uses the name of the task target, provided by the <code class="literal">target</code> argument, to find the appropriate target configuration. It then extracts the <code class="literal">pages</code> collection from it and loops over this collection to render the helper's body, with each item as the context.</p><p>You can read more about the structure of this file and registering custom helpers at the<a id="id522" class="indexterm"/> following URL:</p><p><a class="ulink" href="http://assemble.io/docs/Custom-Helpers.html">http://assemble.io/docs/Custom-Helpers.html</a></p></div></li><li class="listitem">To keep with the convention of our Grunt configuration file, we'll add a property to the <code class="literal">config</code> task that indicates the name of the directory that will contain reusable libraries. After adding the property, the task should look similar to the following:<div><pre class="programlisting">config: {
  lib: 'lib',
  src: 'src',
  dist: 'dist'
}</pre></div></li><li class="listitem">Since we've <a id="id523" class="indexterm"/>added more code to our project in the form of the template helpers, we should probably alter our <code class="literal">watch</code> task so that changes to the template helper code would also trigger a rebuild of our site. This can be done by making the following changes to the <code class="literal">assemble</code> target in the <code class="literal">watch</code> task:<div><pre class="programlisting">assemble: {
  files: [
    '&lt;%= config.src %&gt;' +
      '/{content,data,templates}/**/*.{md,hbs,yml}',
    '&lt;%= config.lib %&gt;/helpers/*.js'
  ],
  tasks: ['assemble']
}</pre></div></li><li class="listitem">Next we'll alter our configuration to load the helpers in our <code class="literal">lib/helpers</code> directory, making them available for use in all our templates. This can be done by adding the following <code class="literal">helpers</code> option to the collection of options for the <code class="literal">assemble</code> task:<div><pre class="programlisting">options: {
  flatten: true,
  assets: '&lt;%= config.dist %&gt;/assets',
  layout: '&lt;%= config.src %&gt;/templates/layouts/default.hbs',
  data: '&lt;%= config.src %&gt;/data/*.{json,yml}',
  partials: '&lt;%= config.src %&gt;/templates/partials/*.hbs',
  helpers: '&lt;%= config.lib %&gt;/helpers/*.js'
}</pre></div></li><li class="listitem">With our template helpers loaded and ready to be used, we can make use of it on our site's blog page to list links to all the posts in our posts collection. We do this by changing the contents of <code class="literal">src/templates/pages/blog.hbs</code> to the following:<div><pre class="programlisting">---
title: Blog
---
&lt;h1&gt;Posts&lt;/h1&gt;
&lt;ul&gt;
  {{#pages 'posts'}}
    &lt;li&gt;
     &lt;a href="/posts/{{filename}}.html"&gt;
      {{data.title}}
     &lt;/a&gt;
    &lt;/li&gt;
  {{/pages}}
&lt;/ul&gt;</pre></div></li><li class="listitem">Finally we<a id="id524" class="indexterm"/> can restart <code class="literal">server</code> that was running in the background so that the configuration changes can take effect. After restarting we should see that the list rendered on the blog page of the site at <code class="literal">http://localhost:9000/blog.html</code> now reflects the items in the posts collection:<div><img src="img/image00286.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec103"/>Using a plugin</h1></div></div></div><p>For the <a id="id525" class="indexterm"/>purpose of extending its core functionality, the Assemble framework provides a plugin system. There are currently only a handful of plugins available for Assemble, but having the plugin system available makes it easy for us to create and reuse extensions of our own, and perhaps even share them with the community.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec235"/>Getting ready</h2></div></div></div><p>In this recipe we'll be continuing working on the project from the <em>Creating a template helper</em> recipe. Be sure to refer to it if you are not yet familiar with it's content. Before we start we should also make sure that the site builder and server are running. If they aren't yet running they can be started using the <code class="literal">grunt server</code> command.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec236"/>How to do it...</h2></div></div></div><p>The following <a id="id526" class="indexterm"/>steps take us through making use of the <code class="literal">assemble-middleware-sitemap</code> plugin to generate a well-formed <strong>sitemap</strong><a id="id527" class="indexterm"/> that can be used by web crawlers to navigate and index the site.</p><div><ol class="orderedlist arabic"><li class="listitem">First, we need to install the package that contains the <code class="literal">assemble-middleware-sitemap</code> plugin, and save it to our package dependencies. The following command does this for us:<div><pre class="programlisting">
<strong>$ npm install assemble-middleware-sitemap</strong>
</pre></div></li><li class="listitem">Next we'll need to indicate that the plugin should be used by all the targets of the <code class="literal">assemble</code> tasks. This can be done by adding <code class="literal">plugins</code> configuration options to the <code class="literal">assemble</code> task in the Grunt configuration, indicating the name of the newly installed plugin package:<div><pre class="programlisting">options: {
  flatten: true,
  assets: '&lt;%= config.dist %&gt;/assets',
  layout: '&lt;%= config.src %&gt;/templates/layouts/default.hbs',
  data: '&lt;%= config.src %&gt;/data/*.{json,yml}',
  partials: '&lt;%= config.src %&gt;/templates/partials/*.hbs',
  helpers: '&lt;%= config.lib %&gt;/helpers/*.js',
  plugins: ['assemble-middleware-sitemap']
}</pre></div></li><li class="listitem">Finally, we can restart our server that was running in the background so that the configuration changes may take effect. After restarting we should see that the <code class="literal">robots.txt</code> and <code class="literal">site.xml</code> files have been generated in the <code class="literal">dist</code> directory.</li></ol><div></div></div></div></body></html>