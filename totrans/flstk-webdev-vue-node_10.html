<html><head></head><body>
        

                            
                    <h1 class="header-title">Going Live</h1>
                
            
            
                
<p class="mce-root">In the previous chapter, we learned how to write tests for the Node.js and Vue.js components for our application. We learned what technologies we can use for testing MEVN applications.</p>
<p class="mce-root">In this chapter, we will learn about what <strong>Continuous Integration</strong> (<strong>CI</strong>) is, how it makes our lives easier, and how we can deploy our application in Heroku.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Continuous integration</h1>
                
            
            
                
<p>CI is a practice in the software development process where each member of the team is makes continuous small changes in the code and integrates them back into the original codebase. After each change, the developer pushes it to GitHub and the tests run automatically in that change. This helps to check whether there are any bugs or issues in the changed code.</p>
<p>Consider a scenario where multiple developers are working on the same application. Each developer is working on a different feature on separate branches. They all build the features and write the test code for the features they build. Everything is going well. Then when the features are completed, they try to integrate all the features, and all of a sudden everything breaks. The tests also fail and many bugs start to creep out.</p>
<p>If the application is small, it wouldn't be a very big deal because the bugs could be fixed easily. But if it's a large project, then it would be very hard just to figure out what went wrong, let alone fix it all. That is where CI originated.</p>
<p>CI came into practice to mitigate such risks while integrating software. The rule for CI is to integrate early and often, which helps to identify the bugs and problems early in the process of adding new functionalities to the existing codebase. So instead of waiting for the completion of every component, CI encourages us to build the codebase and run the test suites on every single change that is committed to the codebase.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Workflow for CI</h1>
                
            
            
                
<p>Here is a diagram that explains how CI works:</p>
<div><img class="alignnone size-full wp-image-580 image-border" src="img/8af5c4d7-a178-4509-9323-836971059b9f.jpg" style="width:24.75em;height:26.33em;"/></div>
<p>In a real-world scenario, multiple developers work on the same application. They work separately on their own machines. When they make changes to the codebase, they push it to the repository in the version control system that they are using.</p>
<p>Now, this change triggers the CI process that we have integrated into our application to run the test suites automatically and do the quality checks for the code that we have changed.</p>
<p>If the test suite passes, then it goes to the further process for testing the full application and is handed over to the QAs.</p>
<p>But, if the tests fail, then the developers or the whole team working on that application are notified. Then the developer working on that change makes the necessary changes to fix the bug, makes a commit, and pushes the fixed code changes to the repository. Again, the same process is repeated until the tests pass. Hence, if there are any bugs, they are identified early on and fixed early on.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Benefits of CI</h1>
                
            
            
                
<p>Now that we are aware of what CI is and why we should use it, let's look into some of the benefits it gives:</p>
<ul>
<li><strong>Build and test applications automatically</strong>: While it is expected that a developer builds the application and runs the tests before pushing the changed code into the repository, sometimes the developer might just forget. In such cases, integrating a Continuous Integration process helps make the process automatic.</li>
<li><strong>Gives the confidence to deploy</strong>: Since CI checks the test suites and we can configure it to check the quality of the code in our codebase, we don't need to worry about forgetting to run the tests before pushing the code to GitHub.</li>
<li><strong>Easy configuration</strong>: CI is very easy to configure. We only need to create a single file with all the configurations.</li>
<li><strong>Error reporting</strong>: This is one of the powerful features of CI. When something breaks while building or running the tests, the team gets a notification. It can also provide information about who made what changes, which is awesome.</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction to Travis CI</h1>
                
            
            
                
<p>Now that we know about CI, we need to start using it in our application as well. There are several technologies that can be used to follow the CI process for any application. There are a lot of tools and each has their own benefits of use; the one that we are going to choose for our application is <strong>Travis CI</strong>.</p>
<p>Travis CI is a technology used to build a CI server. Travis CI is used heavily with GitHub. There are a few other tools as well. Some of them are:</p>
<ul>
<li>Circle CI</li>
<li>Jenkins</li>
<li>Semaphore CI</li>
<li>Drone</li>
</ul>
<p>If you want to learn more about each of the options, here is a good read for that:<br/>
<a href="https://blog.github.com/2017-11-07-github-welcomes-all-ci-tools/">https://blog.github.com/2017-11-07-github-welcomes-all-ci-tools/.</a></p>
<p>Travis CI is used to build for every push that is made to GitHub and it is very easy to set up.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up Travis in the app</h1>
                
            
            
                
<p>Let's move on to the setup part. The first thing to do here is to check out the official website for Travis CI at <a href="https://travis-ci.org/">https://travis-ci.org/</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Activating the repository</h1>
                
            
            
                
<p>We need to sign up first, which can be done easily using Sign in with GitHub. When you are done, you should see the list of your existing repositories. Select the application that you want to set up the Travis CI with and you will be able to see the following page:</p>
<div><img class="alignnone size-full wp-image-581 image-border" src="img/b30e6d08-74fb-4d0f-a31a-a2383b362d25.png" style="width:162.50em;height:85.58em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Specifying the Node.js version</h1>
                
            
            
                
<p>Now, activate the repository in which you want to add Travis CI. We can see the list of our repositories in our profile. Select the application and click on the check mark to activate Travis CI in the repository. Now the next part is to add the configuration details. The first thing is to specify the <kbd>node</kbd> version that we will be using for the application.</p>
<p>Create <kbd>.travis.yml</kbd> file in the application in the root:</p>
<pre>// travis.yml<br/><strong>language: node_js</strong><br/><strong>node_js:</strong><br/><strong>  - "10.0.0"</strong></pre>
<p>Now, this code block tells that this is a Node.js project and that the version of Node.js for this project is <kbd>10.0.0</kbd>. You have to specify the Node.js that is installed in your application. You can check the version with the following:</p>
<pre><strong>$ node -v<br/></strong></pre>
<p>You can specify the same version in the .<kbd>travis.yml</kbd> file as well.</p>
<p>If the specified version is not a standard or available version of Node.js, then an error is raised.</p>
<p>We can also specify the version of Node.js that we want to use to build the project in a file called <kbd>.nvmrc</kbd>. The <kbd>travis.yml</kbd> file reads the content of this file if the version is not specified in the <kbd>.travis.yml</kbd> file itself.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Building the script</h1>
                
            
            
                
<p>Now the next part is to tell Travis to run the test suites. This part is specified in the <kbd>script</kbd> key in the <kbd>.travis.yml</kbd> file. The default build script for a Node.js project is <kbd>npm test</kbd>. But let's first start with adding a single command to run in a single file so that it's quick. Update the content of the .<kbd>travis.yml</kbd> file with the following:</p>
<pre>language: node_js<br/>node_js:<br/>  - "10.0.0"<br/><strong>script: npm run unit</strong></pre>
<p>This tells the <kbd>script</kbd> to run the unit tests when any change is made to the repository.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Managing the dependencies</h1>
                
            
            
                
<p>The next part is to install the dependencies. By default, no dependencies are added by Travis CI. The following command tells Travis CI to download the dependencies before building the <kbd>script</kbd>. It uses <kbd>npm</kbd> to install the dependencies, so let's add a <kbd>script</kbd> to install such dependencies:</p>
<pre>language: node_js<br/>node_js:<br/>  - "10.0.0"<br/><strong>before_script:</strong><br/><strong>  - npm install</strong><br/>script: npm run unit</pre>
<p>That's it. We have successfully configured Travis CI for our application.</p>
<p>Now, let's commit and push this file to GitHub. When you do, check the branches on <kbd>travis.org</kbd> to view all the builds:</p>
<div><img class="alignnone size-full wp-image-582 image-border" src="img/95cbafc8-b06a-4641-ad29-a5b134ca4ee3.png" style="width:162.50em;height:79.08em;"/></div>
<p>Here, the master is the branch where we added the Travis CI build and the build is passing. You can view the details for for <kbd>master</kbd> branch by clicking on the build.</p>
<p>While this is a good approach to view the builds, the best approach is to create a pull request for each branch and see the build pass or fail in that pull request itself. So, let's create a new pull request to see how we can make the best use of Travis CI to make our lives easier.</p>
<p>Let's create a branch called <kbd>setup_travis</kbd> (you can name your branch anything, but make sure it indicates a particular change so that it's easier to identify what changes that branch can expect) with the following command:</p>
<pre><strong>$ git checkout -b setup_travis<br/></strong></pre>
<p>Let's make a simple change to the application so that our pull request contains some differences.</p>
<p>Update the <kbd>README.md</kbd> file with the following content:</p>
<pre><strong># movie_rating_app</strong><br/><br/><strong>&gt; A Vue.js project</strong><br/><br/><strong>## Build Setup</strong><br/><br/><strong>``` bash</strong><br/><strong># install dependencies</strong><br/><strong>npm install</strong><br/><br/><strong># serve with hot reload at localhost:8080</strong><br/><strong>npm run dev</strong><br/><br/><strong># build for production with minification</strong><br/><strong>npm run build</strong><br/><br/><strong># build for production and view the bundle analyzer report</strong><br/><strong>npm run build --report</strong><br/><br/><strong># run unit tests</strong><br/><strong>npm run unit</strong><br/><br/><strong># run e2e tests</strong><br/><strong>npm run e2e</strong><br/><br/><strong># run all tests</strong><br/><strong>npm test</strong><br/><strong>```</strong></pre>
<p>Then, make a <kbd>commit</kbd> for the changes with the following command:</p>
<pre><strong>$ git add README.md</strong><br/><strong>$ git commit -m 'Update readme'</strong></pre>
<p>Finally, push the changes to GitHub with the following command:</p>
<pre><strong>$ git push origin setup_travis</strong></pre>
<p>Now, if we go to our GitHub repository page for this application, we should be able to see the following:</p>
<div><img class="alignnone size-full wp-image-583 image-border" src="img/827bc17c-f9de-44ec-bc0f-75421894291a.png" style="width:162.50em;height:72.17em;"/></div>
<p>Click on the Compare &amp; pull request button. Then add the necessary description and hit the Create pull request button.</p>
<div><img class="alignnone size-full wp-image-584 image-border" src="img/86f73e47-7c07-408e-8bbd-fd8d672f0084.png" style="width:52.25em;height:43.58em;"/></div>
<p>As soon as you create a pull request, Travis CI will start to build the application, and as you go on to add more commits and push changes to, Travis CI will build the application for every commit.</p>
<p>While it is a good practice to run the tests before we push any changes to GitHub, Travis CI build helps to notify if something breaks by building the application for every single commit.</p>
<p>We can also add settings to notify us via email or any other mechanism when the build fails or succeeds as well. By default, Travis CI will notify us via email notifications, as in the following screenshot:</p>
<div><img class="alignnone size-full wp-image-585 image-border" src="img/2e2dc45f-4a5e-4c6a-b9b9-9dddd6e98882.png" style="width:162.50em;height:28.67em;"/></div>
<p>You can see here that Travis CI has been successfully integrated and that the tests are also passing:</p>
<div><img class="alignnone size-full wp-image-586 image-border" src="img/5af4bbac-399e-49cc-9b8f-68fa4117efb7.png" style="width:152.00em;height:105.25em;"/></div>
<p>When we click on Details, we can see the detailed log for the build as well:</p>
<div><img class="alignnone size-full wp-image-588 image-border" src="img/3d247e17-4aca-4929-8b2e-cfe8a2ce4072.png" style="width:147.17em;height:79.67em;"/></div>
<p>Once we are confident with the changes, we can merge the pull request to the master branch:</p>
<div><img class="alignnone size-full wp-image-587 image-border" src="img/ec72e221-f298-4441-bcd3-f1f33d39832d.png" style="width:51.92em;height:38.00em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Introduction to Heroku</h1>
                
            
            
                
<p>The last and most important part of developing an application is to deploy it. Heroku is a cloud platform as a service. It is a cloud platform where we can host our applications. Heroku is an easy and elegant way to deploy and manage our applications.</p>
<p>With Heroku, we can deploy our applications written in Node.js, and many other programming languages as well, such as Ruby, Java, and Python. Regardless of the programming language, the setup required for the Heroku application is the same across all languages.</p>
<p>There are several ways to deploy our application using Heroku, such as using Git, GitHub, Dropbox, or via API. We will be focusing on deploying our application with a Heroku client in this chapter.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Setting up a Heroku account</h1>
                
            
            
                
<p>To get started with app deployment in Heroku, we first need to create an account. You can create yours directly from <a href="https://www.heroku.com/">https://www.heroku.com/</a>. If you want to learn more about different types of apps, you can check out the official documentation at <a href="https://devcenter.heroku.com/">https://devcenter.heroku.com/</a>.</p>
<p>Once you create your account, you should be able to see your own dashboard:</p>
<div><img class="alignnone size-full wp-image-589 image-border" src="img/30d6ccf6-84b5-4d3b-b947-787319f4b488.png" style="width:162.50em;height:84.58em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Creating a Node.js app</h1>
                
            
            
                
<p>Heroku provides a lot of options for the application that we will build. It supports Node.js, Ruby, Java, PHP, Python, Go, Scala, and Clojure. Let's go ahead and choose Node.js from the dashboard.</p>
<p>This documentation itself will guide you when you follow each step. Let's go ahead and deploy our own app in Heroku.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Heroku</h1>
                
            
            
                
<p>The first and foremost thing to do is to install Heroku.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Heroku in Windows</h1>
                
            
            
                
<p>We can install Heroku in Windows simply by downloading the installer from the official page, <a href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install">https://devcenter.heroku.com/articles/heroku-cli#download-and-install</a>, and running the installer.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Heroku in Linux</h1>
                
            
            
                
<p>Heroku can be installed in Linux with just a single command:</p>
<pre><strong>$ wget -qO- https://cli-assets.heroku.com/install-ubuntu.sh | sh</strong></pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Heroku in macOS X </h1>
                
            
            
                
<p>We can install Heroku in macOS using <kbd>homebrew</kbd>:</p>
<pre><strong>$ brew install heroku/brew/heroku</strong></pre>
<p>We can check whether <kbd>Heroku</kbd> is installed using the following command:</p>
<pre><strong>$ heroku -v</strong></pre>
<p>This should print the version of Heroku that we just installed.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Deploying to Heroku</h1>
                
            
            
                
<p>Once Heroku is installed, let's go to <kbd>https://dashboard.heroku.com/apps</kbd>, where we will be creating a Heroku application for our project. Click on the Create New App button and enter the application name that you want to provide to your application. We will be naming it <kbd>movie-rating-app-1</kbd> for our application:</p>
<div><img class="alignnone size-full wp-image-590 image-border" src="img/f4721c0e-7c82-4e5b-83e0-d0cf45af189d.png" style="width:43.67em;height:27.92em;"/></div>
<p>This will create a Heroku application. Now, let's switch to our application in the Terminal and run the following:</p>
<pre><strong>$ cd movie_rating_app<br/>$ heroku login</strong></pre>
<p>This command will prompt you to enter your email and password:</p>
<div><img class="alignnone size-full wp-image-591 image-border" src="img/fee4b358-df38-4a65-a9be-02ff0a82c01b.png" style="width:40.83em;height:7.08em;"/></div>
<p>Now, if you have already initialized a Git repository in your application, you can skip the <kbd>git init</kbd> part in the following code snippet:</p>
<pre><strong>$ git init
$ heroku git:remote -a movie-rating-app-1</strong></pre>
<p>This command will link our application to the Heroku application that we just created.</p>
<p>The setup part is done. Now, we can go ahead and make some changes in our application. Commit to the GitHub repo the way we have been doing so far and push the changes.</p>
<p>Now, the simple command to deploy to the Heroku app is to run the following command:</p>
<pre><strong>$ git push heroku master</strong></pre>
<p>There are a couple of things that we need to take care of here.</p>
<p>Since we are serving the Vue.js components by converting them to static files using the <kbd>serve-static</kbd> package in <kbd>server.js</kbd>, we need to update the start script in <kbd>package.json</kbd> to run the <kbd>node</kbd> server. Let's update the start  script with the following line in <kbd>package.json</kbd>:</p>
<pre>"scripts": {<br/>    "dev": "webpack-dev-server --inline --progress --config build/webpack.dev.conf.js",<br/>    <strong>"start": "nodemon server.js",</strong><br/>    "unit": "cross-env BABEL_ENV=test karma start test/unit/karma.conf.js --single-run",<br/>    "e2e": "node test/e2e/runner.js",<br/>    "test": "npm run unit &amp;&amp; npm run e2e",<br/>    "lint": "eslint --ext .js,.vue src test/unit test/e2e/specs",<br/>    "build": "node build/build.js"<strong>,</strong><br/>    <strong>"heroku-postbuild": "npm install --only=dev --no-shrinkwrap &amp;&amp; npm run build"</strong><br/>  },</pre>
<p>Also, in the <kbd>config/Config.js</kbd> file we have the following:</p>
<pre>module.exports = {<br/>  DB: 'mongodb://localhost/movie_rating_app',<br/>  SECRET: 'movieratingappsecretkey',<br/>  FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,<br/>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;,<br/>  TWITTER_APP_ID: &lt;twitter_consumer_id&gt;,<br/>  TWITTER_APP_SECRET: &lt;twitter_consumer_secret&gt;,<br/>  GOOGLE_APP_ID: &lt;google_consumer_id&gt;,<br/>  GOOGLE_APP_SECRET: &lt;google_consumer_secret&gt;,<br/>  LINKEDIN_APP_ID: &lt;linkedin_consumer_id&gt;,<br/>  LINKEDIN_APP_SECRET: &lt;linkedin_consumer_secret&gt;<br/>}</pre>
<p>Here, we are specifying the local MongoDB URL that will not work when we host our application in Heroku. For this, we can use a tool called <strong>mLab</strong>. mLab is a Database as a service tool for MongoDB. mLab allows us to create as many databases as we want for a sandbox database.</p>
<p>Let's go ahead and create an account on <a href="https://mlab.com/">https://mlab.com/</a>. Once you are logged in, click on the Create new button to create a new database:</p>
<div><img class="alignnone size-full wp-image-592 image-border" src="img/aca147de-3bfd-4f55-8ec2-12b01c69f427.png" style="width:162.50em;height:48.08em;"/></div>
<p>We can choose any cloud provider we want. Choose the plan type as Sandbox and click on CONTINUE. Choose any region and then click on CONTINUE and add the database name you want for the application. Finally, click on Submit Order:</p>
<div><img class="alignnone size-full wp-image-593 image-border" src="img/ca4e7127-ac66-42e8-86d1-ff23d3a18294.png" style="width:162.50em;height:80.00em;"/></div>
<p>Now, if we click on the database name, we can see the link to the MongoDB URL provided by mLab. We also need to create a database user to be able to authenticate the database.</p>
<p>Go to the Users tab, click on Add Database User, provide the username and password, and hit Create.</p>
<p>We should be able to see the MongoDB URL in the database profile page:</p>
<div><img class="alignnone size-full wp-image-594 image-border" src="img/d14a44ce-c38e-431b-ab91-86317ebcdf25.png" style="width:153.08em;height:44.92em;"/></div>
<p>Let's update the MongoDB URL in our <kbd>config/Config.js</kbd>:</p>
<pre>module.exports = {<br/>  <strong>mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds251849.mlab.com:51849/movie_rating_app</strong><br/>  SECRET: 'movieratingappsecretkey',<br/>  FACEBOOK_APP_ID: &lt;facebook_client_id&gt;,<br/>  FACEBOOK_APP_SECRET: &lt;facebook_client_secret&gt;,<br/>  TWITTER_APP_ID: &lt;twitter_consumer_id&gt;,<br/>  TWITTER_APP_SECRET: &lt;twitter_consumer_secret&gt;,<br/>  GOOGLE_APP_ID: &lt;google_consumer_id&gt;,<br/>  GOOGLE_APP_SECRET: &lt;google_consumer_secret&gt;,<br/>  LINKEDIN_APP_ID: &lt;linkedin_consumer_id&gt;,<br/>  LINKEDIN_APP_SECRET: &lt;linkedin_consumer_secret&gt;<br/>}</pre>
<p>The last thing we need to change is the port of the application. The Heroku application automatically assigns a port when deploying an application. We should only be using port <kbd>8081</kbd> of the development environment only. So, let's verify that our <kbd>server.js</kbd> has the following code:</p>
<pre><strong>const port = process.env.PORT || 8081;</strong><br/>app.use('/', router);<br/>var server = app.listen(port, function() {<br/>  console.log(`api running on port ${port}`);<br/>});<br/><br/>module.exports = server</pre>
<p>Now, let's commit and push the changes to the <kbd>master</kbd> and then deploy again:</p>
<pre><strong>$ git add package.json config/Config.js server.js<br/>$ git commit 'Update MongoDB url and app port'<br/>$ git push origin master<br/>$ git push heroku master</strong></pre>
<p>The application should be successfully deployed to Heroku and we should be able to view our application at <a href="https://movie-rating-app-1.herokuapp.com/">https://movie-rating-app-1.herokuapp.com/</a>:</p>
<div><img class="alignnone size-full wp-image-595 image-border" src="img/3e799d4c-c59c-4581-9810-b444da6c59c4.png" style="width:162.50em;height:85.58em;"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Heroku error logs</h1>
                
            
            
                
<p>If something goes wrong when we are deploying in Heroku, we can also look into the error logs that Heroku provides with the following command:</p>
<pre><strong>$ heroku logs -t</strong></pre>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we learned what CI is and how to use it to make the build automatic in the application. We also learned about how to deploy apps using Heroku integration. Overall, we learned how to build a full-stack web application using the Vue.js and Node.js technologies, we integrated a different authentication mechanism, and we also learned how to write tests for the application and make deployments for the application. Congratulations!</p>
<p>This is just the beginning of the journey that you will be taking forward. You should now be able to make small-to-large scale applications with all the technologies that we have learned about here. </p>
<p>This book has provided you with the skills to build an application using JavaScript as the sole programming language using the MEVN stack. This can be a great start if you are planning on building your own complete application. I hope you enjoyed reading the book and that you continue building awesome applications!</p>


            

            
        
    </body></html>