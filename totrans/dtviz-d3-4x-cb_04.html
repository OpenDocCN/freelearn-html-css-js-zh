<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 4. Tipping the Scales"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/><span class="koboSpan" id="kobo.1.1">Chapter 4. Tipping the Scales</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Using continuous scales</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Using the time scale</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Using the ordinal scale</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Interpolating a string</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.7.1">Interpolating colors</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.8.1">Interpolating compound objects</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/><span class="koboSpan" id="kobo.9.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.10.1">As a data visualization developer, one of the key tasks that you will need to perform over and over is to map values from your data domain to your visual domain; for example, mapping your most recent purchase of a fancy tablet of $453.00 to a 653-px-long bar, and your last night's pub bill of $23.59 to a 34-px-long bar. </span><span class="koboSpan" id="kobo.10.2">In a sense, this is what data visualization is all about, mapping data elements to their visual metaphor in an efficient and accurate manner. </span><span class="koboSpan" id="kobo.10.3">Because this is an absolutely essential task in data visualization and animation (animation will be discussed in </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.11.1">Chapter 6</span></a><span class="koboSpan" id="kobo.12.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.13.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.14.1">, in detail), D3 provides rich and robust support on this topic, which is the focus of this chapter.</span></p><div class="section" title="What are scales?"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec69"/><span class="koboSpan" id="kobo.15.1">What are scales?</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">D3 provides various constructs called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.17.1">scales</span></em></span><span class="koboSpan" id="kobo.18.1"> to help you perform this kind of mapping. </span><span class="koboSpan" id="kobo.18.2">A proper understanding of these constructs conceptually is crucial to become an effective visualization developer. </span><span class="koboSpan" id="kobo.18.3">This is because scales are used not only to perform the mapping we mentioned previously, but also to serve as fundamental building blocks for many other D3 constructs, such as transition and axes.</span></p><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.19.1">What are these scales anyway?</span></em></span><span class="koboSpan" id="kobo.20.1"> In short, scales can be thought of as mathematical </span><span class="emphasis"><em><span class="koboSpan" id="kobo.21.1">functions</span></em></span><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">Mathematical functions differ from functions defined in imperative programming languages, such as JavaScript functions. </span><span class="koboSpan" id="kobo.22.3">In mathematics, a function is defined as mapping between two sets:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.23.1">Let A and B be nonempty sets. </span><span class="koboSpan" id="kobo.23.2">A function f from A to B is an assignment of exactly one element of B to each element of A. </span><span class="koboSpan" id="kobo.23.3">We write f(a) = b if b is the unique element of B assigned by the function f to the element a of A.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.24.1"> -Rosen K. </span><span class="koboSpan" id="kobo.24.2">H. </span><span class="koboSpan" id="kobo.24.3">2007</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.25.1">Despite the dryness of this definition, you still can not help but notice how nicely it fits the task we need to perform, mapping elements from the data domain to the visual domain.</span></p><p><span class="koboSpan" id="kobo.26.1">Another fundamentally important concept we will need to illustrate here is the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.27.1">domain</span></em></span><span class="koboSpan" id="kobo.28.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.29.1">range</span></em></span><span class="koboSpan" id="kobo.30.1"> of a given function.</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">If f is a function from A to B, we say that A is the domain of f and B is the codomain of f. </span><span class="koboSpan" id="kobo.31.2">If f(a) = b, we say that b is the image of a and a is a preimage of b. </span><span class="koboSpan" id="kobo.31.3">The range, or image, of f is the set of all images of elements of A. </span><span class="koboSpan" id="kobo.31.4">Also, if f is a function from A to B, we say that f maps A to B.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.32.1">-Rosen K. </span><span class="koboSpan" id="kobo.32.2">H. </span><span class="koboSpan" id="kobo.32.3">2007</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.33.1">To help us understand this concept, let's take a look at the following illustration:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.34.1"><img src="graphics/image_04_001.jpg" alt="What are scales?"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.35.1">Function f maps A to B</span></p><p><span class="koboSpan" id="kobo.36.1">As we can clearly see now, in the preceding illustration for function </span><span class="strong"><strong><span class="koboSpan" id="kobo.37.1">f</span></strong></span><span class="koboSpan" id="kobo.38.1">, the domain is set </span><span class="strong"><strong><span class="koboSpan" id="kobo.39.1">A</span></strong></span><span class="koboSpan" id="kobo.40.1"> and the range is set </span><span class="strong"><strong><span class="koboSpan" id="kobo.41.1">B</span></strong></span><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">Imagine if set </span><span class="strong"><strong><span class="koboSpan" id="kobo.43.1">A</span></strong></span><span class="koboSpan" id="kobo.44.1"> represents our data domain and </span><span class="strong"><strong><span class="koboSpan" id="kobo.45.1">B</span></strong></span><span class="koboSpan" id="kobo.46.1"> represents the visual domain, then a function </span><span class="strong"><strong><span class="koboSpan" id="kobo.47.1">f</span></strong></span><span class="koboSpan" id="kobo.48.1"> defined here is essentially a scale in D3 that maps elements from set </span><span class="strong"><strong><span class="koboSpan" id="kobo.49.1">A</span></strong></span><span class="koboSpan" id="kobo.50.1"> to set </span><span class="strong"><strong><span class="koboSpan" id="kobo.51.1">B</span></strong></span><span class="koboSpan" id="kobo.52.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note42"/><span class="koboSpan" id="kobo.53.1">Note</span></h3><p><span class="koboSpan" id="kobo.54.1">For the mathematically inclined readers, scale functions in data visualization are usually one-to-one, but not </span><span class="emphasis"><em><span class="koboSpan" id="kobo.55.1">onto</span></em></span><span class="koboSpan" id="kobo.56.1"> functions. </span><span class="koboSpan" id="kobo.56.2">This is a useful insight to know but not critical to the purpose of this book. </span><span class="koboSpan" id="kobo.56.3">Therefore, we will not discuss it further here.</span></p></div></div><p><span class="koboSpan" id="kobo.57.1">Now that we discussed the conceptual definition of scale functions in D3, let's take a look at how it can be used to help us develop our visualization project.</span></p></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using continuous scales"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/><span class="koboSpan" id="kobo.1.1">Using continuous scales</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this recipe, we will examine the most commonly used scales provided by D3: the continuous scales that map a continuous quantitative domain to a continuous range, including linear, power, logarithmic, and time scales.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec70"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/continuous-scales.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/continuous-scales.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec71"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Let's take a look at the following code example:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.9.1">&lt;div id="linear" class="clear"&gt;&lt;span&gt;n&lt;/span&gt;&lt;/div&gt; 
&lt;div id="linear-capped" class="clear"&gt; 
    &lt;span&gt;1 &amp;lt;= a*n + b &amp;lt;= 20&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="pow" class="clear"&gt;&lt;span&gt;n^2&lt;/span&gt;&lt;/div&gt; 
&lt;div id="pow-capped" class="clear"&gt; 
    &lt;span&gt;1 &amp;lt;= a*n^2 + b &amp;lt;= 10&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="log" class="clear"&gt;&lt;span&gt;log(n)&lt;/span&gt;&lt;/div&gt; 
&lt;div id="log-capped" class="clear"&gt; 
    &lt;span&gt;1 &amp;lt;= a*log(n) + b &amp;lt;= 10&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var max = 11, data = []; 
    for (var i = 1; i &lt; max; ++i) data.push(i); 
 
    var linear = d3.scaleLinear() // &lt;-A 
        .domain([1, 10]) // &lt;-B 
        .range([1, 10]); // &lt;-C         
    var linearCapped = d3.scaleLinear() 
        .domain([1, 10])         
        .range([1, 20]); // &lt;-D 
         
    var pow = d3.scalePow().exponent(2); // &lt;-E 
    var powCapped = d3.scalePow() // &lt;-F 
        .exponent(2) 
        .domain([1, 10]) 
        .rangeRound([1, 10]); // &lt;-G 
         
    var log = d3.scaleLog(); // &lt;-H 
    var logCapped = d3.scaleLog() // &lt;-I 
        .domain([1, 10]) 
        .rangeRound([1, 10]); 
 
 
    function render(data, scale, selector) { 
        d3.select(selector).selectAll("div") 
                    .data(data) 
                .enter() 
                .append("div") 
                    .classed("cell", true) 
                    .style("display", "inline-block") 
                    .text(function (d) { 
                        return d3.format(".2")(scale(d), 2); 
                    }); 
    } 
 
    render(data, linear, "#linear"); 
    render(data, linearCapped, "#linear-capped"); 
    render(data, pow, "#pow"); 
    render(data, powCapped, "#pow-capped"); 
    render(data, log, "#log"); 
    render(data, logCapped, "#log-capped"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.10.1">The preceding code generates the following output in your browser:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.11.1"><img src="graphics/image_04_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.12.1">Quantitative scale output</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec72"/><span class="koboSpan" id="kobo.13.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.14.1">In this recipe, we demonstrated some of the most common scales provided by D3.</span></p><div class="section" title="Linear scale"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec7"/><span class="koboSpan" id="kobo.15.1">Linear scale</span></h3></div></div></div><p><span class="koboSpan" id="kobo.16.1">In the preceding code example, we have our data array filled with integers from </span><code class="literal"><span class="koboSpan" id="kobo.17.1">1</span></code><span class="koboSpan" id="kobo.18.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.19.1">10</span></code><span class="koboSpan" id="kobo.20.1">, as shown by the for loop above line </span><code class="literal"><span class="koboSpan" id="kobo.21.1">A</span></code><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">We created a </span><span class="emphasis"><em><span class="koboSpan" id="kobo.23.1">linear scale</span></em></span><span class="koboSpan" id="kobo.24.1"> by calling the </span><code class="literal"><span class="koboSpan" id="kobo.25.1">d3.scaleLinear()</span></code><span class="koboSpan" id="kobo.26.1"> function. </span><span class="koboSpan" id="kobo.26.2">This returns a linear quantitative scale function with the default domain set to </span><code class="literal"><span class="koboSpan" id="kobo.27.1">[0, 1]</span></code><span class="koboSpan" id="kobo.28.1"> and the default range set to </span><code class="literal"><span class="koboSpan" id="kobo.29.1">[0, 1]</span></code><span class="koboSpan" id="kobo.30.1">. </span><span class="koboSpan" id="kobo.30.2">Thus, the default scale is essentially the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">identity function</span></em></span><span class="koboSpan" id="kobo.32.1"> for numbers. </span><span class="koboSpan" id="kobo.32.2">Therefore, this default function is not that useful to us, but typically needs to be further customized using its </span><code class="literal"><span class="koboSpan" id="kobo.33.1">domain</span></code><span class="koboSpan" id="kobo.34.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.35.1">range</span></code><span class="koboSpan" id="kobo.36.1"> functions on lines </span><code class="literal"><span class="koboSpan" id="kobo.37.1">B</span></code><span class="koboSpan" id="kobo.38.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.39.1">C</span></code><span class="koboSpan" id="kobo.40.1">. </span><span class="koboSpan" id="kobo.40.2">In this case, we set them both to </span><code class="literal"><span class="koboSpan" id="kobo.41.1">[1, 10]</span></code><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">This scale basically defines the function </span><span class="emphasis"><em><span class="koboSpan" id="kobo.43.1">f(n) = n </span></em></span><span class="koboSpan" id="kobo.44.1">as shown in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.45.1">    var linear = d3.scaleLinear() // &lt;-A 
        .domain([1, 10]) // &lt;-B 
        .range([1, 10]); // &lt;-C         
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.46.1"><img src="graphics/image_04_003.jpg" alt="Linear scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.47.1">Identity scale</span></p><p><span class="koboSpan" id="kobo.48.1">The second linear scale is a little bit more interesting and illustrates the mapping between the two sets better. </span><span class="koboSpan" id="kobo.48.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.49.1">D</span></code><span class="koboSpan" id="kobo.50.1">, we set the range as </span><code class="literal"><span class="koboSpan" id="kobo.51.1">[1, 20]</span></code><span class="koboSpan" id="kobo.52.1">, which is different from its domain. </span><span class="koboSpan" id="kobo.52.2">Hence, now this function essentially represents the following equations:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em><span class="koboSpan" id="kobo.53.1">f(n) = a * n + b</span></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em><span class="koboSpan" id="kobo.54.1">1 &lt;= f(n) &lt;= 20</span></em></span></li></ul></div><p><span class="koboSpan" id="kobo.55.1">This is by far the most common case when using D3 scales because your dataset will be an identical match of your visual set:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.56.1">    var linearCapped = d3.scaleLinear() 
        .domain([1, 10])         
        .range([1, 20]); // &lt;-D 
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.57.1"><img src="graphics/image_04_004.jpg" alt="Linear scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.58.1">Linear scale</span></p><p><span class="koboSpan" id="kobo.59.1">In this second scale, D3 will automatically calculate and assign the value of constants </span><code class="literal"><span class="koboSpan" id="kobo.60.1">a</span></code><span class="koboSpan" id="kobo.61.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.62.1">b</span></code><span class="koboSpan" id="kobo.63.1"> to satisfy the equation.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note43"/><span class="koboSpan" id="kobo.64.1">Note</span></h3><p><span class="koboSpan" id="kobo.65.1">Some basic algebraic calculation will tell you that </span><code class="literal"><span class="koboSpan" id="kobo.66.1">a</span></code><span class="koboSpan" id="kobo.67.1"> is approximately 2.11 and </span><code class="literal"><span class="koboSpan" id="kobo.68.1">b</span></code><span class="koboSpan" id="kobo.69.1"> is -1.11, as in the previous example.</span></p></div></div></div><div class="section" title="Power scale"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec8"/><span class="koboSpan" id="kobo.70.1">Power scale</span></h3></div></div></div><p><span class="koboSpan" id="kobo.71.1">The second scale we created is a </span><span class="emphasis"><em><span class="koboSpan" id="kobo.72.1">power scale</span></em></span><span class="koboSpan" id="kobo.73.1">. </span><span class="koboSpan" id="kobo.73.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.74.1">E</span></code><span class="koboSpan" id="kobo.75.1">, we defined a power scale with </span><code class="literal"><span class="koboSpan" id="kobo.76.1">exponent</span></code><span class="koboSpan" id="kobo.77.1"> of </span><code class="literal"><span class="koboSpan" id="kobo.78.1">2</span></code><span class="koboSpan" id="kobo.79.1">. </span><span class="koboSpan" id="kobo.79.2">The </span><code class="literal"><span class="koboSpan" id="kobo.80.1">d3.scalePow()</span></code><span class="koboSpan" id="kobo.81.1"> function returns a default power scale function with its </span><code class="literal"><span class="koboSpan" id="kobo.82.1">exponent</span></code><span class="koboSpan" id="kobo.83.1"> set as </span><code class="literal"><span class="koboSpan" id="kobo.84.1">1</span></code><span class="koboSpan" id="kobo.85.1">. </span><span class="koboSpan" id="kobo.85.2">This scale effectively defines the function </span><span class="emphasis"><em><span class="koboSpan" id="kobo.86.1">f(n) = n^2</span></em></span><span class="koboSpan" id="kobo.87.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.88.1">    var pow = d3.scalePow().exponent(2); // &lt;-E 
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.89.1"><img src="graphics/image_04_005.jpg" alt="Power scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.90.1">Simple power scale</span></p><p><span class="koboSpan" id="kobo.91.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.92.1">F</span></code><span class="koboSpan" id="kobo.93.1">, a second power scale was defined, this time with a different range set on line </span><code class="literal"><span class="koboSpan" id="kobo.94.1">G</span></code><span class="koboSpan" id="kobo.95.1"> with rounding; the </span><code class="literal"><span class="koboSpan" id="kobo.96.1">rangeRound()</span></code><span class="koboSpan" id="kobo.97.1"> function works pretty much the same as the </span><code class="literal"><span class="koboSpan" id="kobo.98.1">range()</span></code><span class="koboSpan" id="kobo.99.1"> function, which sets the range for a scale. </span><span class="koboSpan" id="kobo.99.2">However, the </span><code class="literal"><span class="koboSpan" id="kobo.100.1">rangeRound</span></code><span class="koboSpan" id="kobo.101.1"> function rounds the output number so that there are no decimal fractions. </span><span class="koboSpan" id="kobo.101.2">This is very handy since scales are commonly used to map elements from the data domain to the visual domain. </span><span class="koboSpan" id="kobo.101.3">So, the output of a scale is very likely to be a number that describes some visual characteristics, for example, the number of pixels. </span><span class="koboSpan" id="kobo.101.4">Avoiding sub-pixel numbers is a useful technique that prevents anti-alias in rendering.</span></p><p><span class="koboSpan" id="kobo.102.1">The second power scale defines the following function, which is demonstrated in the code after the function:</span></p><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.103.1">f(n) = a*n^2 + b, 1 &lt;= f(n) &lt;= 10</span></em></span>
</p><pre class="programlisting"><span class="koboSpan" id="kobo.104.1">    var powCapped = d3.scalePow() // &lt;-F 
        .exponent(2) 
        .domain([1, 10]) 
        .rangeRound([1, 10]); // &lt;-G 
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.105.1"><img src="graphics/image_04_006.jpg" alt="Power scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.106.1">Power scale</span></p><p><span class="koboSpan" id="kobo.107.1">Similar to the linear scale, D3 will automatically find the suitable constants </span><code class="literal"><span class="koboSpan" id="kobo.108.1">a</span></code><span class="koboSpan" id="kobo.109.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.110.1">b</span></code><span class="koboSpan" id="kobo.111.1"> to satisfy the constraints defined by </span><code class="literal"><span class="koboSpan" id="kobo.112.1">domain</span></code><span class="koboSpan" id="kobo.113.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.114.1">range</span></code><span class="koboSpan" id="kobo.115.1"> on a power scale.</span></p></div><div class="section" title="Log scale"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec9"/><span class="koboSpan" id="kobo.116.1">Log scale</span></h3></div></div></div><p><span class="koboSpan" id="kobo.117.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.118.1">H</span></code><span class="koboSpan" id="kobo.119.1">, a third kind of quantitative scale was created using the </span><code class="literal"><span class="koboSpan" id="kobo.120.1">d3.scaleLog()</span></code><span class="koboSpan" id="kobo.121.1"> function. </span><span class="koboSpan" id="kobo.121.2">The default log scale has a </span><code class="literal"><span class="koboSpan" id="kobo.122.1">base</span></code><span class="koboSpan" id="kobo.123.1"> of </span><code class="literal"><span class="koboSpan" id="kobo.124.1">10</span></code><span class="koboSpan" id="kobo.125.1">. </span><span class="koboSpan" id="kobo.125.2">Line </span><code class="literal"><span class="koboSpan" id="kobo.126.1">H</span></code><span class="koboSpan" id="kobo.127.1"> essentially defines the following mathematical function </span><span class="emphasis"><em><span class="koboSpan" id="kobo.128.1">f(n) = log(n)</span></em></span><span class="koboSpan" id="kobo.129.1">, as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.130.1">    var log = d3.scale.log(); // &lt;-H 
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.131.1"><img src="graphics/image_04_007.jpg" alt="Log scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.132.1">Simple log scale</span></p><p><span class="koboSpan" id="kobo.133.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.134.1">I</span></code><span class="koboSpan" id="kobo.135.1">, we customized the log scale to have a domain of </span><code class="literal"><span class="koboSpan" id="kobo.136.1">[1, 10]</span></code><span class="koboSpan" id="kobo.137.1"> and a rounded range of </span><code class="literal"><span class="koboSpan" id="kobo.138.1">[1, 10]</span></code><span class="koboSpan" id="kobo.139.1">, which defines the following constrained mathematical function </span><span class="emphasis"><em><span class="koboSpan" id="kobo.140.1">f(n) = a*log(n) + b, 1 &lt;= f(n) &lt;= 10</span></em></span><span class="koboSpan" id="kobo.141.1">.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.142.1">    var logCapped = d3.scaleLog() // &lt;-I 
        .domain([1, 10]) 
        .rangeRound([1, 10]); 
</span></pre><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.143.1"><img src="graphics/image_04_008.jpg" alt="Log scale"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.144.1">Log scale</span></p></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using the time scale"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec30"/><span class="koboSpan" id="kobo.1.1">Using the time scale</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Often, we will need to create visualization on a dataset that has time and date dimensions; therefore, D3 provides a built-in time scale to help perform this type of mapping. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will learn how to use the D3 time scale.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec73"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/time-scale.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/time-scale.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec74"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">First, let's take a look at the following code example:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.9.1">&lt;div id="time" class="clear"&gt; 
    &lt;span&gt;Linear Time Progression&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [01/01/2016, 12/31/2016] to [0, 1200]&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var start = new Date(2016, 0, 1), // &lt;-A 
        end = new Date(2016, 11, 31), 
        range = [0, 1200], 
        time = d3.scaleTime().domain([start, end]) // &lt;-B 
            .rangeRound(range), // &lt;-C 
        max = 12, 
        data = []; 
 
    for (var i = 0; i &lt; max; ++i){ // &lt;-D 
        var date = new Date(start.getTime()); 
        date.setMonth(start.getMonth() + i); 
        data.push(date); 
    } 
 
    function render(data, scale, selector) { // &lt;-E 
        d3.select(selector).selectAll("div.fixed-cell") 
                    .data(data) 
                .enter() 
                    .append("div") 
                        .classed("fixed-cell", true) 
                        .style("margin-left", function(d){ // &lt;-F 
                            return scale(d) + "px"; 
                        }) 
                        .html(function (d) { // &lt;-G 
                            var format = d3.timeFormat("%x"); // &lt;-H 
                            return format(d) + "&lt;br&gt;" + scale(d) + "px"; 
                        }); 
    } 
 
    render(data, time, "#time"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.10.1">This recipe generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.11.1"><img src="graphics/image_04_009.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.12.1">Time scale</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec75"/><span class="koboSpan" id="kobo.13.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.14.1">In this recipe, we have a </span><code class="literal"><span class="koboSpan" id="kobo.15.1">Date</span></code><span class="koboSpan" id="kobo.16.1"> range between January 1, 2016 and December 31, 2016 defined on line </span><code class="literal"><span class="koboSpan" id="kobo.17.1">A</span></code><span class="koboSpan" id="kobo.18.1">.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.19.1">var start = new Date(2016, 0, 1), // &lt;-A 
        end = new Date(2016, 11, 31), 
        range = [0, 1200], 
        time = d3.scaleTime().domain([start, end]) // &lt;-B 
            .rangeRound(range), // &lt;-C 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note44"/><span class="koboSpan" id="kobo.20.1">Note</span></h3><p><span class="koboSpan" id="kobo.21.1">The JavaScript </span><code class="literal"><span class="koboSpan" id="kobo.22.1">Date</span></code><span class="koboSpan" id="kobo.23.1"> object starts its month from </span><code class="literal"><span class="koboSpan" id="kobo.24.1">0</span></code><span class="koboSpan" id="kobo.25.1"> and day from </span><code class="literal"><span class="koboSpan" id="kobo.26.1">1</span></code><span class="koboSpan" id="kobo.27.1">. </span><span class="koboSpan" id="kobo.27.2">Therefore, </span><code class="literal"><span class="koboSpan" id="kobo.28.1">new Date(2016, 0, 1)</span></code><span class="koboSpan" id="kobo.29.1"> will present January 1, 2016, while </span><code class="literal"><span class="koboSpan" id="kobo.30.1">new Date(2016, 0, 0)</span></code><span class="koboSpan" id="kobo.31.1"> actually will present December 31, 2015.</span></p></div></div><p><span class="koboSpan" id="kobo.32.1">This range was then used to create a D3 </span><span class="emphasis"><em><span class="koboSpan" id="kobo.33.1">time scale</span></em></span><span class="koboSpan" id="kobo.34.1"> on line </span><code class="literal"><span class="koboSpan" id="kobo.35.1">B</span></code><span class="koboSpan" id="kobo.36.1"> using the </span><code class="literal"><span class="koboSpan" id="kobo.37.1">d3.scaleTime</span></code><span class="koboSpan" id="kobo.38.1"> function. </span><span class="koboSpan" id="kobo.38.2">Similar to other continuous scales, time scale also supports separate </span><code class="literal"><span class="koboSpan" id="kobo.39.1">domain</span></code><span class="koboSpan" id="kobo.40.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.41.1">range</span></code><span class="koboSpan" id="kobo.42.1"> definition, which is used to map date- and time-based data points to visual range. </span><span class="koboSpan" id="kobo.42.2">In this example, we set the range of the scale to </span><code class="literal"><span class="koboSpan" id="kobo.43.1">[0, 900]</span></code><span class="koboSpan" id="kobo.44.1">. </span><span class="koboSpan" id="kobo.44.2">This effectively defines a mapping from any date and time value in the time range between January 1, 2016 and December 31, 2016 to a number between 0 and 900.</span></p><p><span class="koboSpan" id="kobo.45.1">With the time scale defined, we can now map any given </span><code class="literal"><span class="koboSpan" id="kobo.46.1">Date</span></code><span class="koboSpan" id="kobo.47.1"> object by calling the scale function, for example, </span><code class="literal"><span class="koboSpan" id="kobo.48.1">time(new Date(2016, 4, 1))</span></code><span class="koboSpan" id="kobo.49.1"> will return </span><code class="literal"><span class="koboSpan" id="kobo.50.1">395</span></code><span class="koboSpan" id="kobo.51.1">, </span><code class="literal"><span class="koboSpan" id="kobo.52.1">time(new Date(2016, 11, 15))</span></code><span class="koboSpan" id="kobo.53.1"> will return </span><code class="literal"><span class="koboSpan" id="kobo.54.1">1147</span></code><span class="koboSpan" id="kobo.55.1">, and so on.</span></p><p><span class="koboSpan" id="kobo.56.1">In the following code, on line </span><code class="literal"><span class="koboSpan" id="kobo.57.1">D</span></code><span class="koboSpan" id="kobo.58.1">, we created our data array that consists of 12 months from January to December in 2013, as shown in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.59.1">    for (var i = 0; i &lt; max; ++i){ // &lt;-D 
        var date = new Date(start.getTime()); 
        date.setMonth(start.getMonth() + i); 
        data.push(date); 
    } 
</span></pre><p><span class="koboSpan" id="kobo.60.1">Then we created 12 cells that represent each month in a year using the </span><code class="literal"><span class="koboSpan" id="kobo.61.1">render</span></code><span class="koboSpan" id="kobo.62.1"> function.</span></p><p><span class="koboSpan" id="kobo.63.1">To spread the cells horizontally, line </span><code class="literal"><span class="koboSpan" id="kobo.64.1">F</span></code><span class="koboSpan" id="kobo.65.1"> performs a mapping from the month to the </span><code class="literal"><span class="koboSpan" id="kobo.66.1">margin-left</span></code><span class="koboSpan" id="kobo.67.1"> CSS style using the time scale we defined:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.68.1">.style("margin-left", function(d){ // &lt;-F 
    return scale(d) + "px"; 
}) 
</span></pre><p><span class="koboSpan" id="kobo.69.1">Line </span><code class="literal"><span class="koboSpan" id="kobo.70.1">G</span></code><span class="koboSpan" id="kobo.71.1"> generates the label that demonstrates what the scale-based mapping produces in this example:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.72.1">.html(function (d) { // &lt;-G 
    var format = d3.timeFormat("%x"); // &lt;-H 
    return format(d) + "&lt;br&gt;" + scale(d) + "px"; 
}); 
</span></pre><p><span class="koboSpan" id="kobo.73.1">To generate human-readable strings from a JavaScript </span><code class="literal"><span class="koboSpan" id="kobo.74.1">Date</span></code><span class="koboSpan" id="kobo.75.1"> object, we used a D3 time formatter on line </span><code class="literal"><span class="koboSpan" id="kobo.76.1">H</span></code><span class="koboSpan" id="kobo.77.1">, which is an alias to the </span><code class="literal"><span class="koboSpan" id="kobo.78.1">d3.locale.format</span></code><span class="koboSpan" id="kobo.79.1"> function. </span><span class="koboSpan" id="kobo.79.2">D3 ships with a powerful and flexible time-formatting library as part of locale format libraries, which is extremely useful when dealing with the </span><code class="literal"><span class="koboSpan" id="kobo.80.1">Date</span></code><span class="koboSpan" id="kobo.81.1"> object.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec76"/><span class="koboSpan" id="kobo.82.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.83.1">The following are some of the most useful </span><code class="literal"><span class="koboSpan" id="kobo.84.1">d3.locale.format</span></code><span class="koboSpan" id="kobo.85.1"> patterns:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.86.1">%a</span></code><span class="koboSpan" id="kobo.87.1">: This is the abbreviated weekday name</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.88.1">%A</span></code><span class="koboSpan" id="kobo.89.1">: This is the full weekday name</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.90.1">%b</span></code><span class="koboSpan" id="kobo.91.1">: This is the abbreviated month name</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.92.1">%B</span></code><span class="koboSpan" id="kobo.93.1">: This is the full month name</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.94.1">%d</span></code><span class="koboSpan" id="kobo.95.1">: This is the zero-padded day of the month as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.96.1">[01</span></code><code class="literal"><span class="koboSpan" id="kobo.97.1">,31]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.98.1">%e</span></code><span class="koboSpan" id="kobo.99.1">: This is the space-padded day of the month as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.100.1">[1,31]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.101.1">%H</span></code><span class="koboSpan" id="kobo.102.1">: This is the hour (24-hour clock) as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.103.1">[00,23]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.104.1">%I</span></code><span class="koboSpan" id="kobo.105.1">: This is the hour (12-hour clock) as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.106.1">[01,12]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.107.1">%j</span></code><span class="koboSpan" id="kobo.108.1">: This is the day of the year as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.109.1">[001,366]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.110.1">%m</span></code><span class="koboSpan" id="kobo.111.1">: This is the month as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.112.1">[01,12]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.113.1">%M</span></code><span class="koboSpan" id="kobo.114.1">: This is the minute as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.115.1">[00,59]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.116.1">%L</span></code><span class="koboSpan" id="kobo.117.1">: This is the milliseconds as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.118.1">[000, 999]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.119.1">%p</span></code><span class="koboSpan" id="kobo.120.1">: This is either AM or PM</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.121.1">%S</span></code><span class="koboSpan" id="kobo.122.1">: This is the time in seconds as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.123.1">[00,61]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.124.1">%x</span></code><span class="koboSpan" id="kobo.125.1">: This is the date, as </span><code class="literal"><span class="koboSpan" id="kobo.126.1">%m/%d/%Y</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.127.1">%X</span></code><span class="koboSpan" id="kobo.128.1">: This is the time, as </span><code class="literal"><span class="koboSpan" id="kobo.129.1">%H:%M:%S</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.130.1">%y</span></code><span class="koboSpan" id="kobo.131.1">: This is the year without century as a decimal number </span><code class="literal"><span class="koboSpan" id="kobo.132.1">[00,99]</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.133.1">%Y</span></code><span class="koboSpan" id="kobo.134.1">: This is the year with century as a decimal number</span></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec77"/><span class="koboSpan" id="kobo.135.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.136.1">For the complete reference on D3 locale format pattern, visit the following link - </span><a class="ulink" href="https://github.com/d3/d3-time-format/blob/master/README.md#locale_format"><span class="koboSpan" id="kobo.137.1">https://github.com/d3/d3-time-format/blob/master/README.md#locale_format
</span></a><span class="koboSpan" id="kobo.138.1">.</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using the ordinal scale"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec31"/><span class="koboSpan" id="kobo.1.1">Using the ordinal scale</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In some cases, we may need to map our data to some ordinal values, for example, </span><code class="literal"><span class="koboSpan" id="kobo.3.1">["a", "b", "c"]</span></code><span class="koboSpan" id="kobo.4.1"> or </span><code class="literal"><span class="koboSpan" id="kobo.5.1">["#1f77b4", "#ff7f0e", "#2ca02c"]</span></code><span class="koboSpan" id="kobo.6.1">. </span><span class="koboSpan" id="kobo.6.2">So, how can we perform this kind of mapping using D3 scales? </span><span class="koboSpan" id="kobo.6.3">This recipe is dedicated to answer this question.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec78"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/ordinal-scale.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/ordinal-scale.html
</span></a><span class="koboSpan" id="kobo.10.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec79"/><span class="koboSpan" id="kobo.11.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">This kind of ordinal mapping is quite common in data visualization. </span><span class="koboSpan" id="kobo.12.2">For example, you may want to map certain data points through categorization into some textual value or perhaps into RGB color code, which in turn can be used in CSS styling. </span><span class="koboSpan" id="kobo.12.3">D3 offers a specialized scale implementation to handle this kind of mapping. </span><span class="koboSpan" id="kobo.12.4">We will explore its usage here. </span><span class="koboSpan" id="kobo.12.5">The following is the code of the </span><code class="literal"><span class="koboSpan" id="kobo.13.1">ordinal-scale.html</span></code><span class="koboSpan" id="kobo.14.1"> file:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.15.1">&lt;div id="alphabet" class="clear"&gt; 
    &lt;span&gt;Ordinal Scale with Alphabet&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [1..10] to ["a".."j"]&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="category10" class="clear"&gt; 
    &lt;span&gt;Ordinal Color Scale Category 10&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [1..10] to category 10 colors&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="category20" class="clear"&gt; 
    &lt;span&gt;Ordinal Color Scale Category 20&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [1..10] to category 20 colors&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="category20b" class="clear"&gt; 
    &lt;span&gt;Ordinal Color Scale Category 20b&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [1..10] to category 20b colors&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="category20c" class="clear"&gt; 
    &lt;span&gt;Ordinal Color Scale Category 20c&lt;br&gt;&lt;/span&gt; 
    &lt;span&gt;Mapping [1..10] to category 20c colors&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var max = 10, data = []; 
 
    for (var i = 1; i &lt;= max; ++i) data.push(i); // &lt;-A 
     
    var alphabet = d3.scaleOrdinal() // &lt;-B 
        .domain(data) 
        .range(["a", "b", "c", "d", "e", "f", "g", "h", "i", "j"]); 
         
    function render(data, scale, selector) { // &lt;-C 
        var cells  = d3.select(selector).selectAll("div.cell") 
                .data(data); 
 
        cells.enter() 
                .append("div") 
                    .classed("cell", true) 
                    .style("display", "inline-block") 
                    .style("background-color", function(d){  // &lt;-D 
                        return scale(d).indexOf("#") &gt;=0 ?  
                                             </span><span class="koboSpan" id="kobo.15.2">scale(d) : "white"; 
                    }) 
                    .text(function (d) { // &lt;-E 
                        return scale(d); 
                    }); 
    } 
 
    render(data, alphabet, "#alphabet"); // &lt;-F 
render(data, d3.scaleOrdinal(d3.schemeCategory10),  
                                      "#category10"); 
render(data, d3.scaleOrdinal(d3.schemeCategory20),  
                                      "#category20"); 
render(data, d3.scaleOrdinal(d3.schemeCategory20b),  
                                      "#category20b"); 
render(data, d3.scaleOrdinal(d3.schemeCategory20c),  
                                      "#category20c"); // &lt;-G 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.16.1">The preceding code outputs the following in your browser:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.17.1"><img src="graphics/image_04_010.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.18.1">Ordinal scale</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec80"/><span class="koboSpan" id="kobo.19.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.20.1">In the preceding code example, a simple data array containing integers from </span><code class="literal"><span class="koboSpan" id="kobo.21.1">0</span></code><span class="koboSpan" id="kobo.22.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.23.1">9</span></code><span class="koboSpan" id="kobo.24.1"> was defined on line </span><code class="literal"><span class="koboSpan" id="kobo.25.1">A</span></code><span class="koboSpan" id="kobo.26.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.27.1">for (var i = 0; i &lt; max; ++i) data.push(i); // &lt;-A     
var alphabet = d3.scaleOrdinal() // &lt;-B 
    .domain(data) 
.range(["a", "b", "c", "d", "e", "f", "g", "h", "i", "j"]); 
</span></pre><p><span class="koboSpan" id="kobo.28.1">Then, an ordinal scale was created using the </span><code class="literal"><span class="koboSpan" id="kobo.29.1">d3.scaleOrdinal</span></code><span class="koboSpan" id="kobo.30.1"> function on line </span><code class="literal"><span class="koboSpan" id="kobo.31.1">B</span></code><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">The domain of this scale was set to our integer array data, whereas range was set to a list of alphabets from </span><code class="literal"><span class="koboSpan" id="kobo.33.1">a</span></code><span class="koboSpan" id="kobo.34.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.35.1">j</span></code><span class="koboSpan" id="kobo.36.1">.</span></p><p><span class="koboSpan" id="kobo.37.1">With this scale defined, we can perform the mapping by simply invoking the scale function, for example, </span><code class="literal"><span class="koboSpan" id="kobo.38.1">alphabet(0)</span></code><span class="koboSpan" id="kobo.39.1"> will return </span><code class="literal"><span class="koboSpan" id="kobo.40.1">a</span></code><span class="koboSpan" id="kobo.41.1">, </span><code class="literal"><span class="koboSpan" id="kobo.42.1">alphabet(4)</span></code><span class="koboSpan" id="kobo.43.1"> will return </span><code class="literal"><span class="koboSpan" id="kobo.44.1">e</span></code><span class="koboSpan" id="kobo.45.1">, and so on.</span></p><p><span class="koboSpan" id="kobo.46.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.47.1">C</span></code><span class="koboSpan" id="kobo.48.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.49.1">render</span></code><span class="koboSpan" id="kobo.50.1"> function was defined to generate a number of </span><code class="literal"><span class="koboSpan" id="kobo.51.1">div</span></code><span class="koboSpan" id="kobo.52.1"> elements on the page to represent the 10 elements in a data array. </span><span class="koboSpan" id="kobo.52.2">Each </span><code class="literal"><span class="koboSpan" id="kobo.53.1">div</span></code><span class="koboSpan" id="kobo.54.1"> element has its </span><code class="literal"><span class="koboSpan" id="kobo.55.1">background-color</span></code><span class="koboSpan" id="kobo.56.1"> attribute set to the scale function's output or </span><code class="literal"><span class="koboSpan" id="kobo.57.1">white</span></code><span class="koboSpan" id="kobo.58.1"> if the output is not an RGB color string:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.59.1">.style("background-color", function(d){  // &lt;-D 
    return scale(d).indexOf("#")&gt;=0 ? </span><span class="koboSpan" id="kobo.59.2">scale(d) : "white"; 
}) 
</span></pre><p><span class="koboSpan" id="kobo.60.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.61.1">E</span></code><span class="koboSpan" id="kobo.62.1">, we also set the text of each cell to display the scale function's output:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.63.1">.text(function (d) { // &lt;-E 
    return scale(d); 
}); 
</span></pre><p><span class="koboSpan" id="kobo.64.1">Now, with all the structures in place, from line </span><code class="literal"><span class="koboSpan" id="kobo.65.1">F</span></code><span class="koboSpan" id="kobo.66.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.67.1">G</span></code><span class="koboSpan" id="kobo.68.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.69.1">render</span></code><span class="koboSpan" id="kobo.70.1"> function was repetitively called with different ordinal scales to produce different visual outputs. </span><span class="koboSpan" id="kobo.70.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.71.1">F</span></code><span class="koboSpan" id="kobo.72.1">, calling </span><code class="literal"><span class="koboSpan" id="kobo.73.1">render</span></code><span class="koboSpan" id="kobo.74.1"> with the </span><code class="literal"><span class="koboSpan" id="kobo.75.1">alphabet</span></code><span class="koboSpan" id="kobo.76.1"> ordinal scale produces the following output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.77.1"><img src="graphics/image_04_011.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.78.1">Alphabetic ordinal scale</span></p><p><span class="koboSpan" id="kobo.79.1">While on line </span><code class="literal"><span class="koboSpan" id="kobo.80.1">G</span></code><span class="koboSpan" id="kobo.81.1">, calling the </span><code class="literal"><span class="koboSpan" id="kobo.82.1">render</span></code><span class="koboSpan" id="kobo.83.1"> function with the built-in </span><code class="literal"><span class="koboSpan" id="kobo.84.1">d3.scaleOrdinal(d3.schemeCategory20c)</span></code><span class="koboSpan" id="kobo.85.1"> ordinal color category scheme produces the following output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.86.1"><img src="graphics/image_04_012.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.87.1">Color ordinal scale</span></p><p><span class="koboSpan" id="kobo.88.1">As assigning different colors to different elements in visualization is a common task, for example, assigning different colors in pie and bubble charts, D3 provides a number of different built-in ordinal color scales as we saw in this recipe.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip45"/><span class="koboSpan" id="kobo.89.1">Tip</span></h3><p><span class="koboSpan" id="kobo.90.1">It is quite easy to build your own simple custom ordinal color scale. </span><span class="koboSpan" id="kobo.90.2">Just create an ordinal scale with the range set to the colors you want to use, as shown in the following example:
</span><code class="literal"><span class="koboSpan" id="kobo.91.1">d3.scaleOrdinal()</span></code>
<code class="literal"><span class="koboSpan" id="kobo.92.1">.range(["#1f77b4", "#ff7f0e", "#2ca02c"]);</span></code>
</p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Interpolating a string"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec32"/><span class="koboSpan" id="kobo.1.1">Interpolating a string</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In some cases, you might need to interpolate numbers embedded in a string; perhaps a CSS style for font, for example.</span></p><p><span class="koboSpan" id="kobo.3.1">In this recipe, we will examine how you can do that using D3 scale and interpolation. </span><span class="koboSpan" id="kobo.3.2">However, before we jump right into string interpolation, a bit of background knowledge on interpolator is due, and the following section will cover the basics of what interpolation is and how D3 implements interpolator functions.</span></p><div class="section" title="Interpolator"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec81"/><span class="koboSpan" id="kobo.4.1">Interpolator</span></h2></div></div></div><p><span class="koboSpan" id="kobo.5.1">In the first three recipes, we went over three different D3 scale implementations; now it is time to delve a little deeper into D3 scales. </span><span class="koboSpan" id="kobo.5.2">You are probably already asking the question, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.6.1">How do different scales know what value to use for different inputs?</span></em></span><span class="koboSpan" id="kobo.7.1"> In fact, this question can be generalized through the following definition of interpolator:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.8.1">We are given the values of a function f(x) at different points x0, x1, ... </span><span class="koboSpan" id="kobo.8.2">,xn. </span><span class="koboSpan" id="kobo.8.3">We want to find approximate values of the function f(x) for "new" x's that lie between these points. </span><span class="koboSpan" id="kobo.8.4">This process is called interpolation.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.9.1">-Kreyszig E and Kreyszig H, and Norminton E. </span><span class="koboSpan" id="kobo.9.2">J. </span><span class="koboSpan" id="kobo.9.3">(2010)</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.10.1">Interpolation is not only important in scale implementation but also essential to many other core D3 capabilities, for example, animation and layout management. </span><span class="koboSpan" id="kobo.10.2">It is because of this essential role that D3 has designed a separate and reusable construct called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.11.1">interpolator</span></em></span><span class="koboSpan" id="kobo.12.1"> so that this common cross-functional concern can be addressed in a centralized and consistent fashion. </span><span class="koboSpan" id="kobo.12.2">Let's take a simple interpolator as an example:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">var interpolate = d3.interpolateNumber(0, 100); 
interpolate(0.1); // =&gt; 10 
interpolate(0.99); //=&gt; 99 
</span></pre><p><span class="koboSpan" id="kobo.14.1">In this simple example, we created a D3 number interpolator with a range of </span><code class="literal"><span class="koboSpan" id="kobo.15.1">[0, 100]</span></code><span class="koboSpan" id="kobo.16.1">. </span><span class="koboSpan" id="kobo.16.2">The </span><code class="literal"><span class="koboSpan" id="kobo.17.1">d3.interpolateNumber</span></code><span class="koboSpan" id="kobo.18.1"> function returns an interpolate function, which we can use to perform number-based interpolations. </span><span class="koboSpan" id="kobo.18.2">The interpolate function is equivalent to the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.19.1">function interpolate(t) { 
    return a * (1 - t) + b * t; 
} 
</span></pre><p><span class="koboSpan" id="kobo.20.1">In this function, </span><code class="literal"><span class="koboSpan" id="kobo.21.1">a</span></code><span class="koboSpan" id="kobo.22.1"> represents the start of the range and </span><code class="literal"><span class="koboSpan" id="kobo.23.1">b</span></code><span class="koboSpan" id="kobo.24.1"> represents the end of the range. </span><span class="koboSpan" id="kobo.24.2">The parameter </span><code class="literal"><span class="koboSpan" id="kobo.25.1">t</span></code><span class="koboSpan" id="kobo.26.1"> passed into the </span><code class="literal"><span class="koboSpan" id="kobo.27.1">interpolate()</span></code><span class="koboSpan" id="kobo.28.1"> function is a float-point number, ranging from 0 to 1, and it signifies how far the return value is from </span><code class="literal"><span class="koboSpan" id="kobo.29.1">a</span></code><span class="koboSpan" id="kobo.30.1">.</span></p><p><span class="koboSpan" id="kobo.31.1">D3 provides a number of built-in interpolators. </span><span class="koboSpan" id="kobo.31.2">Due to limited scope in this book, we will focus on some of the more interesting interpolators for the next few recipes; we will end our discussion on simple number interpolation here. </span><span class="koboSpan" id="kobo.31.3">Nevertheless, the fundamental approach and mechanism will remain the same, whether it is a number or an RGB color code interpolator.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note46"/><span class="koboSpan" id="kobo.32.1">Note</span></h3><p><span class="koboSpan" id="kobo.33.1">For more details on number and round interpolation, please refer to the D3 reference documents at </span><a class="ulink" href="https://github.com/d3/d3/blob/master/API.md#interpolators-d3-interpolate"><span class="koboSpan" id="kobo.34.1">https://github.com/d3/d3/blob/master/API.md#interpolators-d3-interpolate
</span></a><span class="koboSpan" id="kobo.35.1">.</span></p></div></div><p><span class="koboSpan" id="kobo.36.1">Now, with general interpolation concepts behind us, let's take a look at how string interpolator works in D3.</span></p></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec82"/><span class="koboSpan" id="kobo.37.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.38.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/string-interpolation.html"><span class="koboSpan" id="kobo.39.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/string-interpolation.html
</span></a><span class="koboSpan" id="kobo.40.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec83"/><span class="koboSpan" id="kobo.41.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.42.1">String interpolator finds the numbers embedded in the string, and then performs interpolation using D3 number interpolator:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.43.1">&lt;div id="font" class="clear"&gt; 
    &lt;span&gt;Font Interpolation&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var max = 11, data = []; 
 
    var sizeScale = d3.scaleLinear() // &lt;-A 
        .domain([0, max]) 
        .range([  // &lt;-B 
            "italic bold 12px/30px Georgia, serif",  
            "italic bold 120px/180px Georgia, serif" 
        ]); 
 
    for (var i = 0; i &lt; max; ++i) data.push(i); 
 
    function render(data, scale, selector) { // &lt;-C 
        var cells = d3.select(selector).selectAll("div.cell") 
                .data(data); 
 
        cells.enter() 
            .append("div") 
                .classed("cell", true) 
                .style("display", "inline-block") 
            .append("span") 
                .style("font", function(d,i){ 
                    return scale(d); // &lt;-D 
                }) 
                .text(function(d,i){return i;}); // &lt;-E 
    } 
 
    render(data, sizeScale, "#font"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.44.1">The preceding code produces the following output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.45.1"><img src="graphics/image_04_013.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.46.1">String interpolation</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec84"/><span class="koboSpan" id="kobo.47.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.48.1">In this example, we created a linear scale on line </span><code class="literal"><span class="koboSpan" id="kobo.49.1">A</span></code><span class="koboSpan" id="kobo.50.1"> with a range specified between two strings that represent the start and end </span><code class="literal"><span class="koboSpan" id="kobo.51.1">font</span></code><span class="koboSpan" id="kobo.52.1"> styles:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.53.1">var sizeScale = d3.scale.linear() // &lt;-A 
        .domain([0, max]) 
        .range([  // &lt;-B 
            "italic bold 12px/30px Georgia, serif",  
            "italic bold 120px/180px Georgia, serif" 
        ]); 
</span></pre><p><span class="koboSpan" id="kobo.54.1">As you can see in the code of the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">string-interpolation.html</span></code><span class="koboSpan" id="kobo.56.1"> file, the </span><code class="literal"><span class="koboSpan" id="kobo.57.1">font</span></code><span class="koboSpan" id="kobo.58.1"> style strings contain </span><code class="literal"><span class="koboSpan" id="kobo.59.1">font-size</span></code><span class="koboSpan" id="kobo.60.1"> numbers </span><code class="literal"><span class="koboSpan" id="kobo.61.1">12px/30px</span></code><span class="koboSpan" id="kobo.62.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.63.1">120px/180px</span></code><span class="koboSpan" id="kobo.64.1">, which we want to interpolate in this recipe. </span><span class="koboSpan" id="kobo.64.2">At this point, you might be asking how the linear scale function can map a number domain to these arbitrary font CSS styles. </span><span class="koboSpan" id="kobo.64.3">By default, linear scale uses the </span><code class="literal"><span class="koboSpan" id="kobo.65.1">d3.interpolateString</span></code><span class="koboSpan" id="kobo.66.1"> function to handle string-based range. </span><span class="koboSpan" id="kobo.66.2">The </span><code class="literal"><span class="koboSpan" id="kobo.67.1">d3.interpolateString</span></code><span class="koboSpan" id="kobo.68.1"> function will try to identify embedded numbers in a given string, in our case, the font-size numbers, and apply interpolation on those numbers only. </span><span class="koboSpan" id="kobo.68.2">Therefore, in this recipe, we essentially mapped our domain to the font sizes using a linear scale.</span></p><p><span class="koboSpan" id="kobo.69.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.70.1">C</span></code><span class="koboSpan" id="kobo.71.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.72.1">render()</span></code><span class="koboSpan" id="kobo.73.1"> function simply creates 10 cells containing each cell's index numbers (line </span><code class="literal"><span class="koboSpan" id="kobo.74.1">E</span></code><span class="koboSpan" id="kobo.75.1">) styled using the interpolated </span><code class="literal"><span class="koboSpan" id="kobo.76.1">font</span></code><span class="koboSpan" id="kobo.77.1"> style string calculated on line </span><code class="literal"><span class="koboSpan" id="kobo.78.1">D</span></code><span class="koboSpan" id="kobo.79.1">.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.80.1">.style("font", function(d,i){  
    return scale(d); // &lt;-D 
}) 
.text(function(d,i){return i;}); // &lt;-E 
</span></pre><p><span class="koboSpan" id="kobo.81.1">As we can see, simply setting the font style to the output of </span><code class="literal"><span class="koboSpan" id="kobo.82.1">scale(d)</span></code><span class="koboSpan" id="kobo.83.1"> is enough since the function output is a complete font CSS style string with transformed embedded numbers.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note47"/><span class="koboSpan" id="kobo.84.1">Note</span></h3><p><span class="koboSpan" id="kobo.85.1">If you inspect the output of this recipe, you will notice the output CSS style is actually longer than the original style string we used. </span><span class="koboSpan" id="kobo.85.2">The output looks like this:
</span><code class="literal"><span class="koboSpan" id="kobo.86.1">font-style: italic; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 90.5455px; line-height: 139.091px; font-family: Georgia, serif;</span></code><span class="koboSpan" id="kobo.87.1">
This is because D3 CSS transformation parses CSS styles first and then uses browser-computed fully qualified CSS string for interpolation. </span><span class="koboSpan" id="kobo.87.2">This is done to avoid some subtle bugs that could otherwise be caused by direct interpolation.</span></p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec85"/><span class="koboSpan" id="kobo.88.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.89.1">Though we demonstrated string interpolation in D3 using a CSS font style as an example, D3 string interpolator is not only limited to handling CSS styles. </span><span class="koboSpan" id="kobo.89.2">It can basically handle any string and interpolates the embedded number as long as the number matches the following </span><span class="strong"><strong><span class="koboSpan" id="kobo.90.1">Regex</span></strong></span><span class="koboSpan" id="kobo.91.1"> pattern:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.92.1">/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note48"/><span class="koboSpan" id="kobo.93.1">Note</span></h3><p><span class="koboSpan" id="kobo.94.1">When you generate a string using interpolation, very small values, when stringified, may get converted to scientific notation, for example, 1e-7. </span><span class="koboSpan" id="kobo.94.2">To avoid this particular conversion, you will need to keep your value larger than 1e-6</span></p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Interpolating colors"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec33"/><span class="koboSpan" id="kobo.1.1">Interpolating colors</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">It is sometimes necessary to interpolate colors when you interpolate values that do not contain numbers but rather RGB or HSL color code. </span><span class="koboSpan" id="kobo.2.2">This recipe addresses the question </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">how can you define scales for color codes and perform interpolation on them?</span></em></span>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec86"/><span class="koboSpan" id="kobo.4.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.5.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/color-interpolation.html"><span class="koboSpan" id="kobo.6.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/color-interpolation.html
</span></a><span class="koboSpan" id="kobo.7.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec87"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">Color interpolation is such a common operation in visualization that D3 actually provides a number of different kinds of interpolators dedicated to color supporting, for example, </span><span class="strong"><strong><span class="koboSpan" id="kobo.10.1">RGB</span></strong></span><span class="koboSpan" id="kobo.11.1">, </span><span class="strong"><strong><span class="koboSpan" id="kobo.12.1">HSL</span></strong></span><span class="koboSpan" id="kobo.13.1">, </span><span class="strong"><strong><span class="koboSpan" id="kobo.14.1">L*a*b*</span></strong></span><span class="koboSpan" id="kobo.15.1">, </span><span class="strong"><strong><span class="koboSpan" id="kobo.16.1">HCL</span></strong></span><span class="koboSpan" id="kobo.17.1">, and </span><span class="strong"><strong><span class="koboSpan" id="kobo.18.1">Cubehelix</span></strong></span><span class="koboSpan" id="kobo.19.1"> color space. </span><span class="koboSpan" id="kobo.19.2">In this recipe, we will demonstrate how color interpolation can be performed in RGB color space. </span><span class="koboSpan" id="kobo.19.3">However, all other color interpolators work in the same way.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note49"/><span class="koboSpan" id="kobo.20.1">Note</span></h3><p><span class="koboSpan" id="kobo.21.1">D3 color interpolate function always returns the interpolated color in RGB space, no matter what the original color space is, since not all browsers support HSL or L*a*b* color spaces.</span></p></div></div><p><span class="koboSpan" id="kobo.22.1">Here is what the code for this recipe looks like:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.23.1">&lt;div id="color" class="clear"&gt; 
    &lt;span&gt;Linear Color Interpolation&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
&lt;div id="color-diverge" class="clear"&gt; 
    &lt;span&gt;Poly-Linear Color Interpolation&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var max = 21, data = []; 
 
    var colorScale = d3.scaleLinear() // &lt;-A 
        .domain([0, max]) 
        .range(["white", "#4169e1"]); 
 
    var divergingScale = function(pivot) { // &lt;-B 
        return d3.scaleLinear() 
                .domain([0, pivot, max]) // &lt;-C 
                .range(["white", "#4169e1", "white"]) 
    }; 
 
    for (var i = 0; i &lt; max; ++i) data.push(i); 
 
    function render(data, scale, selector) { // &lt;-D 
        var cells = d3.select(selector).selectAll("div.cell") 
                .data(data); 
 
        cells.enter() 
            .append("div").merge(cells) 
                .classed("cell", true) 
                .style("display", "inline-block") 
                .style("background-color", function(d){ 
                    return scale(d); // &lt;-E 
                }) 
                .text(function(d,i){return i;}); 
    } 
 
    render(data, colorScale, "#color"); 
    render(data, divergingScale(5), "#color-diverge"); 
&lt;/script&gt; 
 
&lt;div class="control-group clear"&gt; 
    &lt;button onclick="render(data, divergingScale(5), '#color-diverge')"&gt;Pivot at 5&lt;/button&gt; 
    &lt;button onclick="render(data, divergingScale(10), '#color-diverge')"&gt;Pivot at 10&lt;/button&gt; 
    &lt;button onclick="render(data, divergingScale(15), '#color-diverge')"&gt;Pivot at 15&lt;/button&gt; 
    &lt;button onclick="render(data, divergingScale(20), '#color-diverge')"&gt;Pivot at 20&lt;/button&gt; 
&lt;/div&gt; 
</span></pre><p><span class="koboSpan" id="kobo.24.1">The preceding code produces the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.25.1"><img src="graphics/image_04_014.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.26.1">Color interpolation</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec88"/><span class="koboSpan" id="kobo.27.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.28.1">The first step in this recipe is to define a linear color scale on line </span><code class="literal"><span class="koboSpan" id="kobo.29.1">A</span></code><span class="koboSpan" id="kobo.30.1"> with its range set as </span><code class="literal"><span class="koboSpan" id="kobo.31.1">["white", "#4169e1"]</span></code><span class="koboSpan" id="kobo.32.1">:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.33.1">var colorScale = d3.scaleLinear() // &lt;-A 
    .domain([0, max]) 
    .range(["white", "#4169e1"]); 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note50"/><span class="koboSpan" id="kobo.34.1">Note</span></h3><p><span class="koboSpan" id="kobo.35.1">As we demonstrated earlier, D3 color interpolator is pretty smart when it comes to color space. </span><span class="koboSpan" id="kobo.35.2">Similar to your browser, it understands both color keywords and hexadecimal values.</span></p></div></div><p><span class="koboSpan" id="kobo.36.1">One new technique used in this recipe, that we haven't encountered yet, is the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.37.1">poly-linear scale</span></em></span><span class="koboSpan" id="kobo.38.1">, which is defined in the </span><code class="literal"><span class="koboSpan" id="kobo.39.1">divergingScale</span></code><span class="koboSpan" id="kobo.40.1"> function on line </span><code class="literal"><span class="koboSpan" id="kobo.41.1">B</span></code><span class="koboSpan" id="kobo.42.1">, as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.43.1">var divergingScale = function(pivot) { // &lt;-B 
    return d3.scaleLinear() 
            .domain([0, pivot, max]) // &lt;-C 
            .range(["white", "#4169e1", "white"]) 
}; 
</span></pre><p><span class="koboSpan" id="kobo.44.1">A poly-linear scale is a scale with a non-uniformed linear progression. </span><span class="koboSpan" id="kobo.44.2">It is achieved by providing a poly-linear domain on a linear scale as we can see on line </span><code class="literal"><span class="koboSpan" id="kobo.45.1">C</span></code><span class="koboSpan" id="kobo.46.1">. </span><span class="koboSpan" id="kobo.46.2">You can think of a poly-linear scale as a scale that stitches two linear scales with different domains together. </span><span class="koboSpan" id="kobo.46.3">Hence, this poly-linear color scale is effectively the two following linear scales combined together:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.47.1">d3.scaleLinear() 
    .domain([0, pivot]).range(["white", "#4169e1"]); 
d3.scaleLinear() 
.domain([pivot, max]).range(["#4169e1", "white "]); 
</span></pre><p><span class="koboSpan" id="kobo.48.1">No surprise in the rest of the recipe. </span><span class="koboSpan" id="kobo.48.2">The </span><code class="literal"><span class="koboSpan" id="kobo.49.1">render()</span></code><span class="koboSpan" id="kobo.50.1"> function defined on line </span><code class="literal"><span class="koboSpan" id="kobo.51.1">D</span></code><span class="koboSpan" id="kobo.52.1"> generates 20 cells that are numbered by its index and colored using the output of two color scales we defined earlier. </span><span class="koboSpan" id="kobo.52.2">Clicking on the buttons on the web page (such as </span><span class="strong"><strong><span class="koboSpan" id="kobo.53.1">Pivot at 5</span></strong></span><span class="koboSpan" id="kobo.54.1">) will show you the effect of pivoting at different positions in a poly-linear color scale.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec89"/><span class="koboSpan" id="kobo.55.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.56.1">For a complete list of supported color keywords in CSS3, please refer to the W3C official reference at </span><a class="ulink" href="https://www.w3.org/TR/css3-color/#html4"><span class="koboSpan" id="kobo.57.1">https://www.w3.org/TR/css3-color/#html4
</span></a><span class="koboSpan" id="kobo.58.1">.</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Interpolating compound objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/><span class="koboSpan" id="kobo.1.1">Interpolating compound objects</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">There will be cases when what you need to interpolate in your visualization is not a simple value but rather an object consisting of multiple and different values, for example, a rectangular object with width, height, and color attributes. </span><span class="koboSpan" id="kobo.2.2">Fortunately, D3 has a built-in support for this type of compound object interpolation.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec90"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/compound-interpolation.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter4/compound-interpolation.html
</span></a><span class="koboSpan" id="kobo.6.1">.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec91"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">In this recipe, we will examine how compound object interpolation is performed in D3. </span><span class="koboSpan" id="kobo.8.2">The code for the </span><code class="literal"><span class="koboSpan" id="kobo.9.1">compound-interpolation.html</span></code><span class="koboSpan" id="kobo.10.1"> file is as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.11.1">&lt;div id="compound" class="clear"&gt; 
    &lt;span&gt;Compound Interpolation&lt;br&gt;&lt;/span&gt; 
&lt;/div&gt; 
 
&lt;script type="text/javascript"&gt; 
    var max = 21, data = []; 
 
    var compoundScale = d3.scalePow() 
            .exponent(2) 
            .domain([0, max]) 
            .range([ 
                {color:"#add8e6", height:"15px"}, // &lt;-A 
                {color:"#4169e1", height:"150px"} // &lt;-B 
            ]); 
 
    for (var i = 0; i &lt; max; ++i) data.push(i); 
 
    function render(data, scale, selector) { // &lt;-C 
        var bars = d3.select(selector).selectAll("div.v-bar") 
                .data(data); 
        bars.enter() 
                .append("div") 
                .classed("v-bar", true) 
                .style("height", function(d){ // &lt;-D 
                        return scale(d).height; 
                    }) 
                .style("background-color", function(d){ // &lt;-E 
                    return scale(d).color; 
                }) 
                .text(function(d,i){return i;}); 
    } 
 
    render(data, compoundScale, "#compound"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.12.1">The preceding code generates the following visual output:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.13.1"><img src="graphics/image_04_015.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.14.1">Compound object interpolation</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec92"/><span class="koboSpan" id="kobo.15.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.16.1">This recipe is different from the previous recipes in this chapter by the fact that the scale we will use in this recipe has a range defined using two objects rather than simple primitive data types:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.17.1">var compoundScale = d3.scalePow() 
            .exponent(2) 
            .domain([0, max]) 
            .range([ 
                {color:"#add8e6", height:"15px"}, // &lt;-A 
                {color:"#4169e1", height:"150px"} // &lt;-B 
            ]); 
</span></pre><p><span class="koboSpan" id="kobo.18.1">We can see on lines </span><code class="literal"><span class="koboSpan" id="kobo.19.1">A</span></code><span class="koboSpan" id="kobo.20.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.21.1">B</span></code><span class="koboSpan" id="kobo.22.1"> that the start and the end of the scale range are two objects that contain two different kinds of values: one for RGB color and the other one for CSS height style. </span><span class="koboSpan" id="kobo.22.2">When you interpolate this kind of a scale containing compound range, D3 will iterate through each of the fields inside an object and recursively apply interpolation rules on each one of them. </span><span class="koboSpan" id="kobo.22.3">In other words, for this example, D3 will interpolate the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">color</span></code><span class="koboSpan" id="kobo.24.1"> field using color interpolation from </span><code class="literal"><span class="koboSpan" id="kobo.25.1">#add8e6</span></code><span class="koboSpan" id="kobo.26.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.27.1">#4169e1</span></code><span class="koboSpan" id="kobo.28.1"> while using string interpolation on height field from </span><code class="literal"><span class="koboSpan" id="kobo.29.1">15px</span></code><span class="koboSpan" id="kobo.30.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.31.1">150px</span></code><span class="koboSpan" id="kobo.32.1">.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note51"/><span class="koboSpan" id="kobo.33.1">Note</span></h3><p><span class="koboSpan" id="kobo.34.1">Internally, D3 uses the </span><code class="literal"><span class="koboSpan" id="kobo.35.1">d3.interpolateObject</span></code><span class="koboSpan" id="kobo.36.1"> function to recursively interpolate an object; the recursive nature of this algorithm allows D3 to interpolate even on nested objects. </span><span class="koboSpan" id="kobo.36.2">Therefore, you can interpolate on an object like this:
</span><code class="literal"><span class="koboSpan" id="kobo.37.1">{</span></code>
<code class="literal"><span class="koboSpan" id="kobo.38.1">  color:"#add8e6",</span></code>
<code class="literal"><span class="koboSpan" id="kobo.39.1">  size{</span></code>
<code class="literal"><span class="koboSpan" id="kobo.40.1">    height:"15px",</span></code>
<code class="literal"><span class="koboSpan" id="kobo.41.1">    width: "25px"</span></code>
<code class="literal"><span class="koboSpan" id="kobo.42.1">  }</span></code>
<code class="literal"><span class="koboSpan" id="kobo.43.1">}</span></code>
</p></div></div><p><span class="koboSpan" id="kobo.44.1">A compound scale function, when invoked, returns a compound object that matches the given range definition:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.45.1">.style("height", function(d){ 
  return scale(d).height; // &lt;-D 
})  
.style("background-color", function(d){ 
  return scale(d).color; // &lt;-E 
}) 
</span></pre><p><span class="koboSpan" id="kobo.46.1">As we can see on lines </span><code class="literal"><span class="koboSpan" id="kobo.47.1">D</span></code><span class="koboSpan" id="kobo.48.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.49.1">E</span></code><span class="koboSpan" id="kobo.50.1">, the returned value is a compound object, and this is why, we can access its attribute to retrieve the interpolated values.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note52"/><span class="koboSpan" id="kobo.51.1">Note</span></h3><p><span class="koboSpan" id="kobo.52.1">Though it is not a common case, if the start and end of your compound scale range do not have identical attributes, D3 won't complain but rather it will just treat the missing attribute as a constant. </span><span class="koboSpan" id="kobo.52.2">The following scale will render the height to be </span><code class="literal"><span class="koboSpan" id="kobo.53.1">15px</span></code><span class="koboSpan" id="kobo.54.1"> for all the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">div</span></code><span class="koboSpan" id="kobo.56.1"> elements:
</span><code class="literal"><span class="koboSpan" id="kobo.57.1">var compoundScale = d3.scalePow()</span></code>
<code class="literal"><span class="koboSpan" id="kobo.58.1">            .exponent(2)</span></code>
<code class="literal"><span class="koboSpan" id="kobo.59.1">            .domain([0, max])</span></code>
<code class="literal"><span class="koboSpan" id="kobo.60.1">                 range([</span></code>
<code class="literal"><span class="koboSpan" id="kobo.61.1">                 {color:"#add8e6", height:"15px"}, // &lt;-A</span></code>
<code class="literal"><span class="koboSpan" id="kobo.62.1">                 {color:"#4169e1"} // &lt;-B</span></code>
<code class="literal"><span class="koboSpan" id="kobo.63.1">            ]);</span></code>
</p></div></div><p><span class="koboSpan" id="kobo.64.1">In this chapter we have covered an important fundamental concept in D3 - scales. </span><span class="koboSpan" id="kobo.64.2">In next chapter we will move on to the first visualization component in this book that is actually built on top of scales - Axes.</span></p></div></div></div></div></body></html>