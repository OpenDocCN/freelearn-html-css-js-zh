<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Developing Your First CreateJS Application</h1></div></div></div><p>In our previous chapters, you learned everything you need to know about building impressive web applications using CreateJS. In this chapter, we will wrap up everything and learn to build an actual application using CreateJS from scratch. We will develop a simple painting application with options such as the ability to change the background color, brush color, brush style, brush size, and so on. Also, you will learn about the tricks and tips that will help you develop better JavaScript libraries and applications.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Conceptualizing the application</li><li class="listitem" style="list-style-type: disc">Explaining the structure of the application</li><li class="listitem" style="list-style-type: disc">Implementing every part of the application</li><li class="listitem" style="list-style-type: disc">Getting an image exported from the <code class="literal">Canvas</code> element</li></ul></div><div><div><div><div><h1 class="title"><a id="ch09lvl1sec48"/>Understanding your application structure</h1></div></div></div><p>To demonstrate<a id="id165" class="indexterm"/> the application development with <a id="id166" class="indexterm"/>CreateJS, we will build a painting application. In this application, we will use the EaselJS module and some pure JavaScript snippets to get an image exported from the <code class="literal">Canvas</code> element. As you know, EaselJS renders all outputs into a <code class="literal">Canvas</code> element; there are some JavaScript functions to get an image output from the <code class="literal">Canvas</code> element.</p><p>This application contains three files:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">index.html</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">app.js</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">style.css</code></li></ul></div><p>In the <code class="literal">index.html</code> file, we create the HTML elements and link external files to it. <code class="literal">app.js</code> is the main JavaScript file that contains almost all JavaScript code to run an application, and <code class="literal">style.css</code> is used to style the page, drop-down menus, and other minor elements.</p><div><img src="img/0260OS_09_01.jpg" alt="Understanding your application structure"/></div><p>We split the dependencies into different files to manage them better and provide better performance while loading the application. External static files will be cached in browsers, so users will not require to download them every time the page is refreshed.</p><p>Our painting <a id="id167" class="indexterm"/>application mainly works with EaselJS features, such as the <code class="literal">curveTo</code> and <code class="literal">beginStroke</code> functions. In order to control the application's global settings such as the background color and brush color, we have global variables that hold the settings. We will be using them in other events or functions. These variables are changed when the user clicks on the different options and menus present on the page.</p><p>The preview of the application interface is as follows:</p><div><img src="img/0260OS_09_02.jpg" alt="Understanding your application structure"/></div><p>The application has a navigation bar that consists of four drop-down menus and a title. With the drop-down menus, users can change the brush style, brush size, background color, and brush color. Also, there is an <strong>Export</strong> link that converts the <code class="literal">Canvas</code> element to a PNG image, and gives a download link to the user from where the user can download the image.</p><p>Our drop-down<a id="id168" class="indexterm"/> menus work with pure CSS code so we don't need any JavaScript code for them. In the next section, we will explain each part in detail.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec49"/>Developing the index.html file</h1></div></div></div><p>Our main HTML page <a id="id169" class="indexterm"/>has a simple structure. Following is a <code class="literal">head</code> tag in an HTML page:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
   &lt;meta http-equiv="content-type" content="text/html; charset=UTF-8"&gt;
   &lt;title&gt;Painting&lt;/title&gt;
   &lt;link rel="stylesheet" type="text/css" href="style.css"&gt;
&lt;/head&gt;</pre></div><p>In the <code class="literal">head</code> tag, <a id="id170" class="indexterm"/>we only link the CSS file to the page. Other JavaScript files will be connected to the page at the end of the file and the reason is to provide better performance while loading the page. When we add stylesheets in the <code class="literal">head</code> tag and JavaScript files at the end of the HTML file (before closing the <code class="literal">body</code> tag), our page interface will appear to work faster because the browser doesn't wait to load all JavaScript and CSS files. The web browser loads CSS files because they are in the <code class="literal">head</code> tag, and after rendering all the HTML elements, it loads the JavaScript files. This trick gives a better feeling about the application's performance to users.</p><p>In the following lines, we have the <code class="literal">body</code> and <code class="literal">wrapper</code> elements:</p><div><pre class="programlisting">&lt;body&gt;
   &lt;div id="wrapper"&gt;
       &lt;div id="header"&gt;
           &lt;h1&gt;Painting&lt;/h1&gt;</pre></div><p>The <code class="literal">wrapper</code> layer is the container for all other elements. Also the <code class="literal">div</code> header is the container for the black-colored header at the top of the page, as seen on the output screen. This section also contains the drop-down menus and export links.</p><p>The source code for one of the drop-down menus to choose the color of the brushes is as follows:</p><div><pre class="programlisting">&lt;div id="colorPicker" class="pickerDropDown"&gt;
   &lt;span class="hex"&gt;Brush color&lt;/span&gt;
   &lt;span class="fill" style="background-color: #004358;"&gt;&lt;/span&gt;
   &lt;div class="sub"&gt;
       &lt;ul&gt;
           &lt;li&gt;
               &lt;a href="javascript:void(0);" class="sphexbrushColor" style="background: #FD7400;"&gt;
                  #FD7400
               &lt;/a&gt;
           &lt;/li&gt;
           &lt;li&gt;
               &lt;a href="javascript:void(0);" class="sphexbrushColor" style="background: #FFE11A;"&gt;
                   #FFE11A
               &lt;/a&gt;
           &lt;/li&gt;
           &lt;li&gt;
               &lt;a href="javascript:void(0);" class="sphexbrushColor" style="background: #BEDB39;"&gt;
                   #BEDB39
               &lt;/a&gt;
           &lt;/li&gt;
           &lt;li&gt;
               &lt;a href="javascript:void(0);" class="sphexbrushColor" style="background: #1F8A70;"&gt;
                   #1F8A70
               &lt;/a&gt;
           &lt;/li&gt;
           &lt;li&gt;
               &lt;a href="javascript:void(0);" class="sphexbrushColor" style="background: #004358;"&gt;
                   #004358
               &lt;/a&gt;
           &lt;/li&gt;
       &lt;/ul&gt;
   &lt;/div&gt;
&lt;/div&gt;</pre></div><p>Each drop-down menu has a <code class="literal">div</code> element with a subclass. Inside the <code class="literal">div</code> element, we have some <code class="literal">ul</code> and <code class="literal">li</code> elements that define the drop-down menu. For color pickers, we have a circle that <a id="id171" class="indexterm"/>shows the current color. <a id="id172" class="indexterm"/>Other drop-down menus have the same structure. After drop-down menus, we have a link to export the image.</p><p>The source code for the same is as follows:</p><div><pre class="programlisting">&lt;div id="exportToImage" class="pickerDropDown"&gt;
   &lt;span class="hex"&gt;
       &lt;a href="javascript:void(0)" onclick="exportToImage(this);"&gt;Export&lt;/a&gt;
   &lt;/span&gt;
&lt;/div&gt;</pre></div><p>As you can see, we have a function call when a user clicks on the <code class="literal">Export</code> link. We call the <code class="literal">exportToImage</code> function, which converts the <code class="literal">Canvas</code> element to a PNG image.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>We will explain this function better in the next sections.</p></div></div><p>Finally, we have the definition of the <code class="literal">Canvas</code> element:</p><div><pre class="programlisting">&lt;div id="main"&gt;
   &lt;canvas id="pStage"&gt;&lt;/canvas&gt;
&lt;/div&gt;</pre></div><p>The <code class="literal">canvas id</code> object is assigned with the <code class="literal">pStage</code> value and is placed inside a <code class="literal">div</code> element. After that, we link our two JavaScript files. The first file is the CreateJS library with all subsets in a combined file and the second is the <code class="literal">app.js</code> file as shown:</p><div><pre class="programlisting">&lt;script type='text/javascript' src="img/createjs-2013.12.12.min.js"&gt;&lt;/script&gt;
&lt;script type='text/javascript' src="img/app.js"&gt;&lt;/script&gt;</pre></div><p>We use CreateJS CDN servers to load the main library file. This file is already minified and we can use it in the production environment.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec50"/>Implementing the app.js file</h1></div></div></div><p>The <code class="literal">app.js</code> file is<a id="id173" class="indexterm"/> the main <a id="id174" class="indexterm"/>JavaScript file that contains all functionality and logic for the painting application. This file consists of five functions; one of them is the main function that performs the set up of other events and configures and creates the stage. The next three functions are the callback functions for different mouse events, and the last function is used to create a PNG image from the <code class="literal">Canvas</code> element. But before everything else, we have the global variable's declaration shown as follows:</p><div><pre class="programlisting">var canvas, stage, drawingCanvas, oldPt, oldMidPt, bgLayer, brushColor, brushSize, bgColor, brushStyle, mouseMoveFn;</pre></div><div><div><h3 class="title"><a id="note10"/>Note</h3><p>We will explain more about the usage of each variable in the next sections.</p></div></div><p>After that, we have the <code class="literal">init</code> function, which is the main function for the application.</p><div><pre class="programlisting"> canvas = document.getElementById("pStage");

 canvas.width = window.innerWidth;
 canvas.height = window.innerHeight - 73;

 //set default colors
 brushColor = "#004358";
 bgColor = "#FCFFF5";
 brushSize = 12;
 brushStyle = "round";</pre></div><p>In the first line,<a id="id175" class="indexterm"/> we get the <code class="literal">Canvas</code> element using the <code class="literal">getElementById</code> function<a id="id176" class="indexterm"/>. Then we set the width and height of the <code class="literal">Canvas</code> element to the window's width and height to fit the canvas to the page. The reason we use <code class="literal">-73</code> for the <code class="literal">innerHeight</code> value is to prevent vertical scrolling of the page as our header height is about 73 pixels. After that, default options are set. You can change them with to do your preferred options.</p><p>In order to bind the <code class="literal">onclick</code> events to the drop-down menus, we have a simple <code class="literal">for</code> loop that iterates over the <code class="literal">ul</code> items and binds the <code class="literal">onclick</code> event to the links:</p><div><pre class="programlisting"> //bind onclick event to the brush color picker
 for (var i = document.getElementsByClassName("brushColor").length - 1; i&gt;= 0; i--) {
    var item = document.getElementsByClassName("brushColor")[i];

    item.onclick = function () {
        brushColor = document.querySelector("#colorPicker .fill").style.backgroundColor = this.style.backgroundColor;
    }
 };</pre></div><p>In the first line, we have a <code class="literal">for</code> loop that iterates over the drop-down items, and then binds an <code class="literal">onclick</code> event to each item. The same code is also used for other drop-down menus. Finally, we end the file with the following code:</p><div><pre class="programlisting"> stage = new createjs.Stage(canvas);
 stage.autoClear = false;

 createjs.Touch.enable(stage);

 stage.on("stagemousedown", mouseDownCallback);
 stage.on("stagemouseup", mouseUpCallback);

 bgLayer = new createjs.Shape();
 bgLayer.graphics.beginFill(bgColor).drawRect(0, 0, canvas.width, canvas.height);
 stage.addChild(bgLayer);

 drawingCanvas = new createjs.Shape();
 stage.addChild(drawingCanvas);
 stage.update();</pre></div><p>In the first line, <a id="id177" class="indexterm"/>like our previous <a id="id178" class="indexterm"/>examples, <code class="literal">Stage</code> is the object that is created. After that, we set the <code class="literal">autoClear</code> property to <code class="literal">false</code> in order to manage the <code class="literal">stage</code> object getting cleared manually. Then, we set the <code class="literal">touch</code> feature to <code class="literal">enable</code>.</p><p>We are developing a painting application so we need to bind callback functions to the <code class="literal">mousedown</code>, <code class="literal">mouseup</code>, and <code class="literal">mousemove</code> events in order to manage and control mouse events. In the next lines, we bind callback functions to the <code class="literal">stagemousedown</code> and <code class="literal">stagemouseup</code> events, which are used to handle the mouse-click events.</p><div><div><h3 class="title"><a id="note11"/>Note</h3><p>In the painting application, we have a background layer where the user can change the color using the drop-down menu.</p></div></div><p>In the next lines, we create a <code class="literal">Shape</code> object that is used for the background layer and then we create the next shape to draw the painting lines. Both of these shapes are added to the stage using the <a id="id179" class="indexterm"/>
<code class="literal">addChild</code> function.</p><p>The source code for the <code class="literal">mouseDownCallback</code> event is as follows:</p><div><pre class="programlisting">oldMidPt = oldPt = new createjs.Point(stage.mouseX, stage.mouseY);
mouseMoveFn = stage.on("stagemousemove", mouseMoveCallback);</pre></div><p>Inside this <a id="id180" class="indexterm"/>function, we collect the current mouse cursor's coordinates and also add a callback function to the <code class="literal">stagemousemove</code> event.</p><p>The <code class="literal">mouseMoveCallback</code> function source code is shown as follows:</p><div><pre class="programlisting">Var midPt = new createjs.Point(Math.floor((oldPt.x + stage.mouseX) / 2), Math.floor((oldPt.y + stage.mouseY) / 2));

drawingCanvas.graphics.setStrokeStyle(brushSize, brushStyle).beginStroke(brushColor).moveTo(midPt.x, midPt.y).curveTo(oldPt.x, oldPt.y, oldMidPt.x, oldMidPt.y);

oldPt.x = stage.mouseX;
oldPt.y = stage.mouseY;

oldMidPt.x = midPt.x;
oldMidPt.y = midPt.y;

stage.update();</pre></div><p>In the first line, <a id="id181" class="indexterm"/>we calculate the next point that we need for the <code class="literal">moveTo</code> function<a id="id182" class="indexterm"/> using the current mouse position and the old mouse position. In the next line, we create a stroke with the current options and move the point to the new coordinates that we have calculated in the first line. After that, old positions are updated and finally the <code class="literal">update</code> function is called from the <code class="literal">stage</code> object.</p><p>Our last callback function for events is the <code class="literal">mouseUpCallback</code> function<a id="id183" class="indexterm"/>. Inside this function, we unbind the callback function from <code class="literal">stagemousemove</code> to stop drawing, which is shown as follows:</p><div><pre class="programlisting">stage.off("stagemousemove", mouseMoveFn);</pre></div><p>The last function is the <code class="literal">exportToImage</code> function<a id="id184" class="indexterm"/>, which is used to get a PNG image exported from the <code class="literal">Canvas</code> element. In this function, we convert the <code class="literal">Canvas</code> element to a PNG image format with base 64 and set the output to the link's <code class="literal">href</code> object. There is a function called <code class="literal">toDataUrl</code> that converts the contents from the <code class="literal">Canvas</code> element to an image. The <code class="literal">exportToImage</code> function is called when the <strong>Export</strong> link is clicked by a user. The following code explains the same:</p><div><pre class="programlisting">var dateTime = new Date();

obj.href = canvas.toDataURL();
obj.download = "paint_" + dateTime.getHours() + "-" + dateTime.getMinutes() + "-" + dateTime.getSeconds();</pre></div><p>At the end of the file, we call the <code class="literal">init</code> function to start the application:</p><div><pre class="programlisting">init();</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec51"/>Preview of the final application</h1></div></div></div><p>Once the code is run, <a id="id185" class="indexterm"/>our painting application will be ready for use. The preview of our final application is as shown in the following screenshot:</p><div><img src="img/0260OS_09_03.jpg" alt="Preview of the final application"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec52"/>Summary</h1></div></div></div><p>In this chapter, we learned to create an actual web application using CreateJS from scratch and use the different features offered by this library. We gained experience on how to declare global options and change them using user inputs, and apply the changes in the application. Also, we learned how to export images from the <code class="literal">Canvas</code> element using the powerful JavaScript API.</p><p>Furthermore, we discussed how to include static files such as JavaScript and CSS to provide better performance while loading the application.</p><p>Every new beginning is some beginning's end and as you turn the last pages of this intuitive guide, you are empowered to explore, discover, develop, and build astounding web applications using CreateJS. In this age of the Internet citizenship, HTML5 has emerged as a powerful platform, where you can make your mark with compelling web applications. So go ahead, create the next amazing web app, and thrill the world!</p></div></body></html>