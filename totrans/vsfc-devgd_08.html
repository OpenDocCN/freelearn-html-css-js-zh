<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Best Practices for Visualforce Developments</h1></div></div></div><p>Visualforce pages<a id="id285" class="indexterm"/> are the replacement for Salesforce standard pages. When we use Visualforce pages, the delay experiences and unexpected behaviors must not be there. Therefore, we have to follow the best practices to improve the user experience and coding standards during the Visualforce developments, in order to improve the user experience. There are some situations and components where we can apply some best practices. This chapter will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Accessing component IDs</li><li class="listitem" style="list-style-type: disc">Page block components</li><li class="listitem" style="list-style-type: disc">Controllers and controller extensions</li><li class="listitem" style="list-style-type: disc">Improving Visualforce's performance</li><li class="listitem" style="list-style-type: disc">Static resources</li><li class="listitem" style="list-style-type: disc">Rendering PDFs</li><li class="listitem" style="list-style-type: disc">Using component facets</li></ul></div><p>Let's build Visualforce pages with super performance…</p><div><div><div><div><h1 class="title"><a id="ch08lvl1sec43"/>Accessing component IDs</h1></div></div></div><p>When we refer Visualforce<a id="id286" class="indexterm"/> components in JavaScript, the ID attribute plays a major role. Every Visualforce component has an ID attribute. The ID attribute must be specified to a particular component in order to refer to it in JavaScript and it is used to bind the two components together. When the page is rendered, this ID attribute is a part of DOM ID of the particular component. The ID attribute must be unique as well. The following best practices are applied for accessing component IDs:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the <code class="literal">$Component</code> global variable<a id="id287" class="indexterm"/> to simplify access. For an example, when we have an input field with <code class="literal">id="inputOne"</code> within a page block with <code class="literal">id="blockOne"</code>, we can access the input field with the <code class="literal">$Component.blockOne.inputOne</code> expression.</li><li class="listitem" style="list-style-type: disc">No need to <a id="id288" class="indexterm"/>specify an ID for a component you want to access if it is an ancestor or sibling to the <code class="literal">$Component</code> variable in the Visualforce component's hierarchy.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec44"/>Page block components</h1></div></div></div><p>The <code class="literal">&lt;apex:pageBlockSectionItem&gt;</code> component<a id="id289" class="indexterm"/> can have<a id="id290" class="indexterm"/> only two child components. With the customer requirements and the developing requirements, there can be more than two child elements inside <code class="literal">&lt;apex:pageBlockSectionItem&gt;</code>. Using <code class="literal">&lt;apex:outputPanel&gt;</code> <a id="id291" class="indexterm"/>we can add more than two elements in <code class="literal">&lt;apex:pageBlockSectionItem&gt;</code> <a id="id292" class="indexterm"/>as follows:</p><div><pre class="programlisting">&lt;apex:pageBlock&gt;
  &lt;apex:pageBlockSection&gt;
    &lt;apex:pageBlockSectionItem&gt;
      &lt;apex:outputLabel value="LabelName"/&gt; 
      &lt;apex:outputPanel&gt;
&lt;!—We can add our extra child components here within the apex:outputPanel --&gt; 
      &lt;/apex:outputPanel&gt;
    &lt;/apex:pageBlockSectionItem&gt;
  &lt;/apex:pageBlockSection&gt;
&lt;/apex:pageBlock&gt;</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec45"/>Controllers and controller extensions</h1></div></div></div><p>When we are developing controllers and controller extensions that are associated to Visualforce pages, we need to adhere to the following <a id="id293" class="indexterm"/>best <a id="id294" class="indexterm"/>practices:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">By using the<a id="id295" class="indexterm"/> <code class="literal">with sharing</code> keyword, we can enforce the sharing rules in controllers. Then the code will execute in the user mode instead of the system mode.</li><li class="listitem" style="list-style-type: disc">We must not depend on the setter method to be executed before the constructor.</li><li class="listitem" style="list-style-type: disc">We must not depend on the execution order or side effects while creating custom methods in a custom controller or a controller extension.</li><li class="listitem" style="list-style-type: disc">Do not use DML operations inside a loop.</li><li class="listitem" style="list-style-type: disc">While<a id="id296" class="indexterm"/> performing record filtering, add<a id="id297" class="indexterm"/> filters in the following order:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In SOQL</li><li class="listitem" style="list-style-type: disc">In Apex</li><li class="listitem" style="list-style-type: disc">In Visualforce</li></ul></div></li><li class="listitem" style="list-style-type: disc">If possible, calculations must be performed in SOQL instead of Apex.</li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec46"/>Improving Visualforce's performance</h1></div></div></div><p>The performance of a <a id="id298" class="indexterm"/>Visualforce page is a key factor to consider in <a id="id299" class="indexterm"/>development because performance is a reason that effects the end user's satisfaction of the application. The following are the best practices to improve Visualforce's performance:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use only one <code class="literal">&lt;apex:form&gt;</code> tag<a id="id300" class="indexterm"/> per Visualforce page because each <code class="literal">&lt;apex:form&gt;</code> tag adds a view state to the page. A Visualforce page has a limit for view state size that is 135 KB. We can decrease the loading time of a Visualforce page by reducing the view state size.</li><li class="listitem" style="list-style-type: disc">Try to use the transient keyword in custom controller as much as possible. The state is not maintained for transient instance variables. If a particular instance is used only in the page request, then it must not be a part of view state. It will help to reduce the view state size.</li><li class="listitem" style="list-style-type: disc">When using an SOQL query to refer data of a particular object, use only the relevant data in the SOQL query.</li><li class="listitem" style="list-style-type: disc">When designing the Visualforce page, do not overload the page with excessive functionality and more data. Overloaded pages will increase the view state, page size, heap size, and risk hitting the governor limits for the view state.</li><li class="listitem" style="list-style-type: disc">To decrease the loading time of a Visualforce page:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Do not use SOQL queries in getter methods</li><li class="listitem" style="list-style-type: disc">Frequently-used or global data must be cached</li><li class="listitem" style="list-style-type: disc">Reduce the number of records displayed in the page by using the built-in pagination of <code class="literal">standardSetControllers</code> or limiting the data in SOQL queries</li></ul></div></li><li class="listitem" style="list-style-type: disc">We can increase the time interval for calling the Apex controller by using the <code class="literal">&lt;apex:actionPoller&gt;</code> component<a id="id301" class="indexterm"/> to reduce the delays in multiple concurrent requests.</li><li class="listitem" style="list-style-type: disc">Use the SOQL <code class="literal">OFFSET</code> to implement the pagination of a specific subset of results within SOQL.</li><li class="listitem" style="list-style-type: disc">If we have large quantities of read-only data in an organization, then we must use a custom object or custom setting to store that data.</li><li class="listitem" style="list-style-type: disc">Use <code class="literal">&lt;apex:repeat&gt;</code> to <a id="id302" class="indexterm"/>iterate over large collections.</li><li class="listitem" style="list-style-type: disc">Do not hardcode pick list values in the Visualforce page, and use the controller to add them to a <code class="literal">selectOption</code> list.</li><li class="listitem" style="list-style-type: disc">Use the <a id="id303" class="indexterm"/>lazy loading approach to reduce or delay the<a id="id304" class="indexterm"/> loading of data according to the essentiality. In lazy loading, the essential features will be loaded first and others will be delayed until the user's action. To lazy load, we can:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the <code class="literal">rerender</code> attribute to perform a partial page load</li><li class="listitem" style="list-style-type: disc">Use JavaScript remoting to call actions in the controller</li></ul></div></li><li class="listitem" style="list-style-type: disc">When using CSS in Visualforce pages, we have to be careful. The performance of Visualforce is directly affected by the optimization of the Visualforce. Here are some tips to increase the performance of CSS:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use separate CSS files and refer to them in the Visualforce page (instead of writing the CSS code in the page itself). This will reduce the file size.</li><li class="listitem" style="list-style-type: disc">Use a single CSS file instead of using multiple CSS files. This will reduce the number of HTTP requests.</li><li class="listitem" style="list-style-type: disc">Refer to CSS files via static resources because it has a in-built caching mechanism.</li><li class="listitem" style="list-style-type: disc">When creating pages that have totally customized CSS (not using Salesforce CSS), do not forget to set the attribute of <code class="literal">showHeaders</code> and <code class="literal">standardStylesheets</code> of the <code class="literal">&lt;apex:page&gt;</code> tag to <code class="literal">false</code>.</li></ul></div></li></ul></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">When using JavaScript in Visualforce pages, we have to optimize them to increase the performance of Visualforce. Here are some tips to increase the performance of JavaScript:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use separate JavaScript files and refer to them in the Visualforce page (instead of writing JavaScript in the page itself). This will reduce the size of individual pages taking advantage of browser caching.</li><li class="listitem" style="list-style-type: disc">Use a single JavaScript file instead of using multiple JavaScript files. This will reduce the number of HTTP requests and remove duplicate functions.</li><li class="listitem" style="list-style-type: disc">Use customized versions of JavaScript libraries which include only the required functions. This will reduce the file size.</li><li class="listitem" style="list-style-type: disc">If possible, use the <code class="literal">&lt;script&gt;</code> tag to include JavaScript in the Visualforce page and place it right before the <code class="literal">&lt;/apex:page&gt;</code> closing tag. This will avoid loading of JavaScript before any other content in the Visualforce page.</li><li class="listitem" style="list-style-type: disc">Eliminate unwanted comments and whitespaces to reduce the file size and for faster downloads.</li></ul></div></li><li class="listitem" style="list-style-type: disc">Use<a id="id305" class="indexterm"/> the <code class="literal">escapeSingleQuotes</code> method<a id="id306" class="indexterm"/> to avoid <a id="id307" class="indexterm"/>SOQL and SOSL injection attacks.</li><li class="listitem" style="list-style-type: disc">Images frequently play a major role in a Visualforce page. Therefore we have to optimize the usage of images in Visualforce pages using the following tips:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use the CSS sprites instead of individual images. Using sprites, we can combine images (similar sized) into a single file. This will reduce the number of images used in the page and reduce the number of HTTP requests.</li><li class="listitem" style="list-style-type: disc">If possible, try to reduce the use of images and motivate the use of CSS.</li><li class="listitem" style="list-style-type: disc">Use static resources to refer to images in a Visualforce page.</li></ul></div></li></ul></div><div><div><h3 class="title"><a id="tip37"/>Tip</h3><p>View state cannot be viewed with tools such as Firebug because the view state data is encrypted.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec47"/>Static resources</h1></div></div></div><p>Static resources<a id="id308" class="indexterm"/> have an in-built caching feature and use the content distribution network built into Salesforce. The following are the advantages of using static resources to refer to CSS files, images, and JavaScript:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use a static resource to display the content of another static resource with the action attribute of the<a id="id309" class="indexterm"/> <code class="literal">&lt;apex:page&gt;</code> tag. By doing this we can redirect from a Visualforce page to a static resource. Suppose we have a PDF as a static resource (named as <code class="literal">helpPdf</code>) and we use that static resource in the action attribute of the <code class="literal">&lt;apex:page&gt;</code> tag as follows:<div><pre class="programlisting">&lt;apex:page sidebar="false" showHeader="false" standardStylesheets="false" action="{!URLFOR($Resource.helpPdf)}"&gt;
&lt;/apex:page&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">URLFOR</code> function<a id="id310" class="indexterm"/> plays a major role here. The redirection <a id="id311" class="indexterm"/>will not work properly without the <code class="literal">URLFOR</code> function. This is not limited to PDF; we can use any static resource to redirect.<div><pre class="programlisting">&lt;apex:page sidebar="false" showHeader="false" standardStylesheets="false" action="{!URLFOR($Resource.helpStaticResource, 'index.htm')}"&gt;
&lt;/apex:page&gt;</pre></div></li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec48"/>Rendering PDFs</h1></div></div></div><p>When we use components in a Visualforce page and the page is rendered as a PDF, these components do not always work. We must not use components that depend on JavaScript actions and Salesforce standard stylesheets.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The following components are safe to use in <a id="id312" class="indexterm"/>PDF rendering:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:composition&gt;</code> (as long as the page contains PDF-safe components)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:facet&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:dataList&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:define&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:include&gt;</code> (as long as the page contains PDF-safe components)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:insert&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:image&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:repeat&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:outputLabel&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:outputLink&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:outputPanel&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:outputText&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:page&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:panelGrid&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:panelGroup&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:param&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:stylesheet&gt;</code> (as long as the URL isn't directly referencing Salesforce stylesheets)</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:variable&gt;</code></li></ul></div></li><li class="listitem" style="list-style-type: disc">The following <a id="id313" class="indexterm"/>components can be used with caution in rendering PDF (others are not safe to be used in PDF rendering):<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:attribute&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:column&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:component&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:componentBody&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;apex:dataTable&gt;</code></li></ul></div></li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec49"/>Using component facets</h1></div></div></div><p>The <code class="literal">&lt;apex:facet&gt;</code> component<a id="id314" class="indexterm"/> is used to<a id="id315" class="indexterm"/> specify content in an area of a Visualforce page and it provides information about the data in the parent component. For example, we can use a facet component in the header or footer of a <code class="literal">&lt;apex:dataTable&gt;</code>. We can override the default facet of a Visualforce component by using the <code class="literal">&lt;apex:facet&gt;</code> component. The advantages and disadvantages of the facet component are as follows with an example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;apex:facet&gt;</code> component cannot be used directly in Apex; it must be a child component of another Visualforce component. We can use that in a dynamic component.</li><li class="listitem" style="list-style-type: disc">Facets only allow a single child within the start and close tags.</li><li class="listitem" style="list-style-type: disc">The following is an example of the <code class="literal">&lt;apex:facet&gt;</code> component that is used with the<a id="id316" class="indexterm"/> <code class="literal">&lt;apex:dataTable&gt;</code> component:<div><pre class="programlisting">&lt;apex:page standardController="Item__c"&gt;
  &lt;apex:pageBlock&gt;
    &lt;apex:dataTable value="{!item}" var="i"&gt;
      &lt;apex:facet name="caption"&gt;&lt;h1&gt;This is {!item.Item_Name__c}&lt;/h1&gt;&lt;/apex:facet&gt;      
      &lt;apex:column&gt;
      &lt;apex:facet name="header"&gt;Name&lt;/apex:facet&gt;
      &lt;apex:outputText value="{!i.Item_Name__c}"/&gt;
      &lt;/apex:column&gt;
      &lt;apex:column&gt;
      &lt;apex:facet  name="header"&gt;Unit Price&lt;/apex:facet&gt;
        &lt;apex:outputText value="{!i.Unit_Price__c }"/&gt;
      &lt;/apex:column&gt;
    &lt;/apex:dataTable&gt;
  &lt;/apex:pageBlock&gt;
&lt;/apex:page&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">We can use the facet <a id="id317" class="indexterm"/>component with <code class="literal">&lt;apex:actionSatus&gt;</code>. It <a id="id318" class="indexterm"/>is used to extend the displaying status indicator. This is explained in the following example:<div><pre class="programlisting">&lt;apex:page&gt;
  &lt;apex:form &gt;
    &lt;apex:commandButton value="Facet with action Status" status="Status" rerender="rerenderBlock"/&gt;
    &lt;apex:pageBlock id="rerenderBlock"&gt;
    &lt;/apex:pageBlock&gt;
    &lt;apex:actionStatus id="Status"&gt;
      &lt;apex:facet name="start"&gt;
        &lt;img src="img/{!$Resource.LoadingAnimation}"/&gt; 
      &lt;/apex:facet&gt;
    &lt;/apex:actionStatus&gt;
  &lt;/apex:form&gt;
&lt;/apex:page&gt;</pre></div></li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec50"/>Summary</h1></div></div></div><p>This chapter was dedicated for explaining the best practices of Visualforce developments. In this chapter we became familiar with the best practices to follow in order to avoid unexpected behaviors, reduce the delay experience for accessing component IDs, page block components, controllers and controller extensions, improving Visualforce performance, static resources, rendering PDFs, and using component facets. We have seen the way to improve user experience and coding standards.</p></div></body></html>