<html><head></head><body><div class="appendix" title="Appendix&#xA0;C.&#xA0;Organizing Templates with AMD and Require.js"><div class="titlepage"><div><div><h1 class="title"><a id="appC"/>Appendix C. Organizing Templates with AMD and Require.js</h1></div></div></div><p>
<span class="strong"><strong>Asynchronous Module Definition</strong></span> (<span class="strong"><strong>AMD</strong></span>)<a id="id342" class="indexterm"/> is a JavaScript API used to define modules and load module dependencies asynchronously. It is a fairly new yet very robust concept that many developers are adopting nowadays. In <a class="link" href="ch07.html" title="Chapter 7. Organizing Backbone Applications – Structure, Optimize, and Deploy">Chapter 7</a>, <span class="emphasis"><em>Organizing Backbone Applications – Structure, Optimize, and Deploy</em></span>, we covered AMD with Require.js in detail. If you need more details on this library, we recommend you visit <a class="ulink" href="http://requirejs.org/">http://requirejs.org/</a> to get a complete overview and then come back to this section.</p><p>In general, Require.js <a id="id343" class="indexterm"/>treats every file's content as JavaScript. So, we cannot load our template files, if they aren't JavaScript files, in the same manner as JavaScript files. Fortunately for templates, there is a <code class="literal">text</code> plugin that allows us to load text-based dependencies. Any file that we load using this file will be treated as a text file and the content that we receive will be a string; it can be used easily with your template methods. To use this plugin, just prepend <code class="literal">text!</code> to the file path and the file contents will be retrieved as plain text; to do this, follow this example:</p><div class="informalexample"><pre class="programlisting">// AMD Module definition with dependencies
define([
    'backbone',
    'underscore',

    // text plugin that gets any file content as text
    'text!../templates/userLogin.html'
  ],
  function (Backbone, _, userLoginTpl) {
    'use strict';

    var UserLogin = Backbone.View.extend({
      // Compile the template string that we received 
      template: _.template(userLoginTpl),
      render: function () {
        this.$el.html(this.template({
          username: 'johndoe',
          password: 'john'
        }));

        return this;
      }
    });

    return UserLogin;
  });</pre></div><p>The benefit of using<a id="id344" class="indexterm"/> this mechanism is that you can organize your templates by creating separate template files and they are automatically included in your modules. Since this involves asynchronous loading, the files are downloaded via AJAX requests, something we already decided as being a bad idea. However, Require.js comes with an <code class="literal">r.js</code> optimization tool that builds the modules and can save these extra AJAX requests by inlining these templates with their respective modules.</p><div class="section" title="Precompiling with the requirejs-tpl plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec51"/>Precompiling with the requirejs-tpl plugin</h1></div></div></div><p>With AMD, we <a id="id345" class="indexterm"/>simplified the template <a id="id346" class="indexterm"/>organization process, but the end result still remains an uncompiled template string. In <a class="link" href="ch02.html" title="Chapter 2. Working with Views">Chapter 2</a>, <span class="emphasis"><em>Working with Views</em></span>, we saw how template compilation affects application performance every time and we also analyzed the benefits of precompiling templates. Won't it be useful if we have something that will load these template files and provide us with an already-compiled template string instead? Fortunately, there are multiple <code class="literal">tpl</code> plugins available for Require.js that automate template compilation, and you can use these plugins directly in your module definition. Let us look at a similar plugin (<a class="ulink" href="https://github.com/ZeeAgency/requirejs-tpl">https://github.com/ZeeAgency/requirejs-tpl</a>) developed by ZeeAgency. Dependency loading is exactly the same as it is for the <code class="literal">text</code> plugin, you just need to use the <code class="literal">tpl!</code> plugin prefix instead of <code class="literal">text!</code>:</p><div class="informalexample"><pre class="programlisting"> define(['tpl!your-template-path.tpl'], function (template) { 
  return template ({
    your: 'data'
  });
});</pre></div><p>Now, <code class="literal">r.js</code> provides optimized and packaged precompiled templates. The <code class="literal">tpl!</code> plugin is surely more handy and useful than the <code class="literal">text!</code> plugin.</p><p>Template organization <a id="id347" class="indexterm"/>with Require.js is one of the best ways to maintain templates; a lot of JavaScript developers are opting for it nowadays. If you are using AMD for your Backbone application, go for it without any hesitation.</p></div></div></body></html>