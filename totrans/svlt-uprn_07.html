<html><head></head><body>
<div id="_idContainer021">
<h1 class="chapter-number" id="_idParaDest-93"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-94"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.2.1">Advanced Routing Techniques</span></h1>
<p><span class="koboSpan" id="kobo.3.1">With everything we’ve covered so far, you could set this book down now and go build a simple website using SvelteKit. </span><span class="koboSpan" id="kobo.3.2">But if you wanted to build more advanced functionality into your application, you might find yourself struggling to come up with the proper hierarchies for routes. </span><span class="koboSpan" id="kobo.3.3">That’s because when it comes to dynamic routing, we’ve only scratched the surface. </span><span class="koboSpan" id="kobo.3.4">In </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.4.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.5.1">, we discussed creating dynamic pages with parameters passed to our routes. </span><span class="koboSpan" id="kobo.5.2">In that example, we loaded articles by using the provided slug and matching it with those found in our demonstration database. </span><span class="koboSpan" id="kobo.5.3">We had no way of knowing what the slug would be ahead of time and it would have been needlessly complicated to create a new route for each article. </span><span class="koboSpan" id="kobo.5.4">Instead, we looked at the slug parameter that was received based on the URL </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">being accessed.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">This was only a brief introduction to dynamic routing. </span><span class="koboSpan" id="kobo.7.2">In this chapter, we’ll look at some more advanced techniques that can help you supercharge your routing logic. </span><span class="koboSpan" id="kobo.7.3">We’ll examine routing with optional parameters, parameters of unknown lengths, how to match parameters with regular expressions, which routes will take precedence in instances of routing logic collisions, and more advanced layout techniques, including methodologies for breaking out </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">of them.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">This chapter will be broken into the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Using </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">optional parameters</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.13.1">Rest parameters</span></span></li>
<li><span class="koboSpan" id="kobo.14.1">Matching, sorting, and encoding – </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">oh, my!</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.16.1">Advanced layouts</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1">By the end of this chapter, you will have a mastery of the various routing techniques available to you in SvelteKit. </span><span class="koboSpan" id="kobo.17.2">No matter your next SvelteKit project’s requirements, you will have the knowledge required for solving and tackling any complex </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">routing dilemmas.</span></span></p>
<h1 id="_idParaDest-95"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.20.1">The complete code for this chapter is available on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">at: </span></span><a href="https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter07"><span class="No-Break"><span class="koboSpan" id="kobo.22.1">https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter07</span></span></a></p>
<h1 id="_idParaDest-96"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.23.1">Using optional parameters</span></h1>
<p><span class="koboSpan" id="kobo.24.1">Since we teased</span><a id="_idIndexMarker150"/><span class="koboSpan" id="kobo.25.1"> optional parameters in the </span><em class="italic"><span class="koboSpan" id="kobo.26.1">Creating Dynamic Pages</span></em><span class="koboSpan" id="kobo.27.1"> section of </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.28.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.29.1">, let’s start there. </span><span class="koboSpan" id="kobo.29.2">When creating optional parameters in a route, there are some things to keep in mind. </span><span class="koboSpan" id="kobo.29.3">For instance, they cannot exist alongside another route as this would cause a collision in the routing rules. </span><span class="koboSpan" id="kobo.29.4">When creating an optional route, it works best for instances where the final portion of the route can have a default option. </span><span class="koboSpan" id="kobo.29.5">Many applications will change the URL based on a language selected by the user. </span><span class="koboSpan" id="kobo.29.6">For our example, we’ll illustrate how to create an optional parameter by selecting a country in North America that our demonstration store operates in. </span><span class="koboSpan" id="kobo.29.7">We won’t actually build an entire store but rather use it to illustrate the advanced routing concepts in </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.31.1">To begin, let’s create a new route in our navigation just like we have for </span><span class="No-Break"><span class="koboSpan" id="kobo.32.1">previous examples:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.33.1">src/lib/Nav.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.34.1">
&lt;nav&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;a href='/'&gt;Home&lt;/a&gt;&lt;/li&gt;
    ...
</span><span class="koboSpan" id="kobo.34.2">    &lt;li&gt;&lt;a href='/login'&gt;Login&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href='/store'&gt;Store&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/nav&gt;</span></pre>
<p><span class="koboSpan" id="kobo.35.1">All we need to do is add another list item with a link to our new route in the navigation menu. </span><span class="koboSpan" id="kobo.35.2">After</span><a id="_idIndexMarker151"/><span class="koboSpan" id="kobo.36.1"> doing that, we can create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.37.1">store</span></strong><span class="koboSpan" id="kobo.38.1"> directory, which is where all of the examples for this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">will exist:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.40.1">src/routes/store/+layout.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.41.1">
&lt;h2&gt;Store&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/store/locations/"&gt;Locations&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/products/"&gt;Products&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;slot /&gt;</span></pre>
<p><span class="koboSpan" id="kobo.42.1">This simple layout will allow us to navigate the various concepts covered in this chapter. </span><span class="koboSpan" id="kobo.42.2">After adding links, we use the Svelte </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">&lt;slot&gt;</span></strong><span class="koboSpan" id="kobo.44.1"> element referenced in earlier chapters. </span><span class="koboSpan" id="kobo.44.2">Take a moment to go and create all of the necessary directories. </span><span class="koboSpan" id="kobo.44.3">Next, we’ll also create a simple landing page for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">store</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.47.1"> route:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.48.1">src/routes/store/+page.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.49.1">
&lt;h3&gt;Welcome to the Store!&lt;/h3&gt;</span></pre>
<p><span class="koboSpan" id="kobo.50.1">Having created the files necessary for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">/store</span></strong><span class="koboSpan" id="kobo.52.1"> route as well as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">locations</span></strong><span class="koboSpan" id="kobo.54.1"> directory, we’ll now create yet another directory. </span><span class="koboSpan" id="kobo.54.2">The major difference with this one will be that it uses double square brackets (</span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">[[country]]</span></strong><span class="koboSpan" id="kobo.56.1">) in the name. </span><span class="koboSpan" id="kobo.56.2">This is how SvelteKit differentiates optional routes from those that are not. </span><span class="koboSpan" id="kobo.56.3">Because we’re creating a page with an optional parameter, we don’t need to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.58.1"> inside of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">locations</span></strong><span class="koboSpan" id="kobo.60.1"> directory. </span><span class="koboSpan" id="kobo.60.2">Rather, we’ll add that inside of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">[[country]]</span></strong><span class="koboSpan" id="kobo.62.1"> directory. </span><span class="koboSpan" id="kobo.62.2">To proceed, we’ll create the appropriate </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.64.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">+</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">page.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.67.1"> files:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.68.1">src/routes/store/locations/[[country]]/+page.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.69.1">
&lt;script&gt;
  export let data;
&lt;/script&gt;
&lt;h2&gt;You're viewing the {data.country.toUpperCase()} store.&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/store/locations"&gt;North America&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/locations/ca"&gt;Canada&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/locations/me"&gt;Mexico&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/locations/us"&gt;United States&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</span></pre>
<p><span class="koboSpan" id="kobo.70.1">By now, this</span><a id="_idIndexMarker152"/><span class="koboSpan" id="kobo.71.1"> should look all too familiar. </span><span class="koboSpan" id="kobo.71.2">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">export let data;</span></strong><span class="koboSpan" id="kobo.73.1"> so that we may access the information provided by </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">load()</span></strong><span class="koboSpan" id="kobo.75.1"> in the next file. </span><span class="koboSpan" id="kobo.75.2">We use that data to inform the user which country’s store locations they are viewing and display the abbreviation in uppercase. </span><span class="koboSpan" id="kobo.75.3">We then create an unordered list populated with links to the various allowed routes we will provide in the </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">next file.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">[[country]]/+page.js</span></strong><span class="koboSpan" id="kobo.79.1">, we need to check the provided parameters of the route against the list of countries our store operates in. </span><span class="koboSpan" id="kobo.79.2">We can do so with the </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">following code:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.81.1">src/routes/store/locations/[[country]]/+page.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.82.1">
export function load({ params }) {
  const codes = [
    'na',
    'ca',
    'me',
    'us'
  ];
  const found = codes.filter(country_code =&gt; country_code === params.country);
  return {country: found[0] ?? </span><span class="koboSpan" id="kobo.82.2">'na'};
}</span></pre>
<p><span class="koboSpan" id="kobo.83.1">Exporting </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">load()</span></strong><span class="koboSpan" id="kobo.85.1"> functions should also feel familiar to you at this point. </span><span class="koboSpan" id="kobo.85.2">In this particular function, we only need access to </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">params</span></strong><span class="koboSpan" id="kobo.87.1"> and so we destructure the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">RequestEvent</span></strong><span class="koboSpan" id="kobo.89.1"> object passed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">load()</span></strong><span class="koboSpan" id="kobo.91.1">. </span><span class="koboSpan" id="kobo.91.2">We’ve then declared a </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">codes</span></strong><span class="koboSpan" id="kobo.93.1"> array that works as a list of approved routes. </span><span class="koboSpan" id="kobo.93.2">On the next line, we check if the provided route is in the array of approved routes by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">filter()</span></strong><span class="koboSpan" id="kobo.95.1"> on </span><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">codes</span></strong><span class="koboSpan" id="kobo.97.1">. </span><span class="koboSpan" id="kobo.97.2">Then </span><strong class="source-inline"><span class="koboSpan" id="kobo.98.1">filter()</span></strong><span class="koboSpan" id="kobo.99.1"> returns an array containing all of the matches and assigns it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">found</span></strong><span class="koboSpan" id="kobo.101.1"> constant. </span><span class="koboSpan" id="kobo.101.2">We can then return an object containing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">country</span></strong><span class="koboSpan" id="kobo.103.1"> property, which is assigned the first value inside of </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">found</span></strong><span class="koboSpan" id="kobo.105.1">. </span><span class="koboSpan" id="kobo.105.2">If the first value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">found</span></strong><span class="koboSpan" id="kobo.107.1"> is empty, we’ll default to the value that shows all of North America. </span><span class="koboSpan" id="kobo.107.2">In this </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">case, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">na</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.111.1">Once we’ve </span><a id="_idIndexMarker153"/><span class="koboSpan" id="kobo.112.1">done all of this, we can open our application, click </span><strong class="bold"><span class="koboSpan" id="kobo.113.1">store</span></strong><span class="koboSpan" id="kobo.114.1">, click </span><strong class="bold"><span class="koboSpan" id="kobo.115.1">locations</span></strong><span class="koboSpan" id="kobo.116.1">, and view the various North American countries our store operates in. </span><span class="koboSpan" id="kobo.116.2">When clicking each of the options from the unordered list, notice how the text on our page changes as well as the route in the URL. </span><span class="koboSpan" id="kobo.116.3">When we select </span><strong class="bold"><span class="koboSpan" id="kobo.117.1">North America</span></strong><span class="koboSpan" id="kobo.118.1">, the text shown reflects the abbreviation </span><strong class="bold"><span class="koboSpan" id="kobo.119.1">NA</span></strong><span class="koboSpan" id="kobo.120.1"> due to the ternary logic used in the return of </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">load()</span></strong><span class="koboSpan" id="kobo.122.1">. </span><span class="koboSpan" id="kobo.122.2">When selecting any of the other options, the abbreviation is updated accordingly. </span><span class="koboSpan" id="kobo.122.3">As mentioned previously, optional parameters work best when the final section of the route can have a default option. </span><span class="koboSpan" id="kobo.122.4">If the optional parameter were to be included somewhere in the middle of the route, then any subsequent portions of the route would be understood by the routing mechanism as the </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">optional parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.124.1">In this example, we created a new route using double square brackets </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">[[ ]]</span></strong><span class="koboSpan" id="kobo.126.1">. </span><span class="koboSpan" id="kobo.126.2">While this example has a long way to go before functioning as a complete store, it should illuminate how to use optional parameters in routes. </span><span class="koboSpan" id="kobo.126.3">Now that you understand optional parameters, let’s see how we can wrangle routes of </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">unknown lengths.</span></span></p>
<h1 id="_idParaDest-97"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.128.1">Rest parameters</span></h1>
<p><span class="koboSpan" id="kobo.129.1">Just as</span><a id="_idIndexMarker154"/><span class="koboSpan" id="kobo.130.1"> JavaScript functions can accept rest parameters using the rest operator (</span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">…</span></strong><span class="koboSpan" id="kobo.132.1">), so too can our routes. </span><span class="koboSpan" id="kobo.132.2">By using a rest operator inside of single square brackets, we can allow a variable length on the specified route. </span><span class="koboSpan" id="kobo.132.3">This feature comes in handy when creating something like a file browser where the URL should match a path that then makes the page content shareable via </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">the URL.</span></span></p>
<p><span class="koboSpan" id="kobo.134.1">To see this concept in action, let’s create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">products</span></strong><span class="koboSpan" id="kobo.136.1"> route in our store. </span><span class="koboSpan" id="kobo.136.2">Start by adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">src/routes/store/products/+layout.svelte</span></strong><span class="koboSpan" id="kobo.138.1"> so that we may navigate </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">products easily:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.140.1">src/routes/store/products/+layout.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.141.1">
&lt;h3&gt;Products&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href="/store/products/shirts"&gt;Shirts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/products/shirts/mens"&gt;Mens Shirts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/products/shirts/mens/tshirts"&gt;Men's T-shirts
    &lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/products/shirts/mens/tshirts/cotton"&gt;Men's 
    Cotton T-shirts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href="/store/products/shirts/mens/tshirts/cotton/
    graphic"&gt;Men's Graphic Cotton T-shirts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;slot /&gt;</span></pre>
<p><span class="koboSpan" id="kobo.142.1">This </span><a id="_idIndexMarker155"/><span class="koboSpan" id="kobo.143.1">Svelte component is rather simple. </span><span class="koboSpan" id="kobo.143.2">It consists of a title, an unordered list, list items, and links to various products. </span><span class="koboSpan" id="kobo.143.3">Again, we’ve used the Svelte </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">&lt;slot /&gt;</span></strong><span class="koboSpan" id="kobo.145.1"> element to keep the navigation on our page as we click around. </span><span class="koboSpan" id="kobo.145.2">Next, let’s create an endpoint that can handle the varying lengths of products we’ve just provided. </span><span class="koboSpan" id="kobo.145.3">To do so, we’ll create a folder using square brackets and prefix the directory name with the rest operator. </span><span class="koboSpan" id="kobo.145.4">For this example, we’ll use </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">[...details]</span></strong><span class="koboSpan" id="kobo.147.1"> as the directory name. </span><span class="koboSpan" id="kobo.147.2">Let’s look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">+page.js</span></strong><span class="koboSpan" id="kobo.149.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">+page.svelte</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.151.1">files now:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.152.1">src/routes/store/products/[...details]/+page.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.153.1">
export function load({ params }) {
  return params;
}</span></pre>
<p><span class="koboSpan" id="kobo.154.1">Since we’re not building out an entire store, we can keep this one incredibly simple. </span><span class="koboSpan" id="kobo.154.2">As we’re attempting to showcase how rest parameters work within SvelteKit’s routing mechanism, we’ll simply return </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">params</span></strong><span class="koboSpan" id="kobo.156.1"> from </span><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">load()</span></strong><span class="koboSpan" id="kobo.158.1">. </span><span class="koboSpan" id="kobo.158.2">A more robust and practical example might take the value from </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">params</span></strong><span class="koboSpan" id="kobo.160.1"> and use it to filter a list of products retrieved from the database. </span><span class="koboSpan" id="kobo.160.2">That data could then be returned from </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">load()</span></strong><span class="koboSpan" id="kobo.162.1"> for each product to be rendered in the </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">next file.</span></span></p>
<p><span class="koboSpan" id="kobo.164.1">Now, to </span><a id="_idIndexMarker156"/><span class="koboSpan" id="kobo.165.1">show how the rest parameter value changes, we’ll add the </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">following </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">+page.svelte</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.169.1">src/routes/store/products/[...details]/+page.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.170.1">
&lt;script&gt;
  export let data;
&lt;/script&gt;
&lt;h4&gt;Product page&lt;/h4&gt;
{#if data.details}
  &lt;p class='red'&gt;{data.details}&lt;/p&gt;
{:else}
  &lt;p&gt;No product selected! </span><span class="koboSpan" id="kobo.170.2">Try clicking one or adding your own URL.
</span><span class="koboSpan" id="kobo.170.3">{/if}
&lt;style&gt;
  .red {
    color: red;
    font-weight: bold;
  }
&lt;/style&gt;</span></pre>
<p><span class="koboSpan" id="kobo.171.1">Again, we’re keeping things simple. </span><span class="koboSpan" id="kobo.171.2">Instead of showing all of the products that could be available in </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">data</span></strong><span class="koboSpan" id="kobo.173.1">, we’re simply using the Svelte </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">{#if}</span></strong><span class="koboSpan" id="kobo.175.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">{:else}</span></strong><span class="koboSpan" id="kobo.177.1"> directives to demonstrate how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">details</span></strong><span class="koboSpan" id="kobo.179.1"> parameter changes. </span><span class="koboSpan" id="kobo.179.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">data.details</span></strong><span class="koboSpan" id="kobo.181.1"> is empty, we show a default message. </span><span class="koboSpan" id="kobo.181.2">If it has a value, we show it in bold red text. </span><span class="koboSpan" id="kobo.181.3">Had we given the directory a different name, that name would be how we accessed the parameter. </span><span class="koboSpan" id="kobo.181.4">Try clicking some of the links to the various products and notice how the URL changes in the browser but so too does the value in red. </span><span class="koboSpan" id="kobo.181.5">What happens if you add your own values to the URL </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">after </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">/store/products/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">?</span></span></p>
<p><span class="koboSpan" id="kobo.185.1">With these </span><a id="_idIndexMarker157"/><span class="koboSpan" id="kobo.186.1">advanced routing techniques, we have to consider some implications. </span><span class="koboSpan" id="kobo.186.2">For instance, just as optional parameters work best when at the end section of the URL, rest parameters cannot be followed by an optional parameter. </span><span class="koboSpan" id="kobo.186.3">If we attempt to provide optional routing sections after the rest parameter, they will be consumed by the rest parameter. </span><span class="koboSpan" id="kobo.186.4">To see the error thrown by the Vite development server, try creating an optional directory inside of </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">/[...details]/</span></strong><span class="koboSpan" id="kobo.188.1">. </span><span class="koboSpan" id="kobo.188.2">You won’t have to worry about accidentally doing this since Vite will be watching out for you, but it’s still good to know about it when planning routes for </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.190.1">If you find yourself building routes of an unknown length into your application, consider creating them using SvelteKit’s rest parameters. </span><span class="koboSpan" id="kobo.190.2">Not only do they handle those indeterminate lengths, but the logic is easily incorporated into the existing flow of </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">SvelteKit apps.</span></span></p>
<h1 id="_idParaDest-98"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.192.1">Matching, sorting, and encoding – oh, my!</span></h1>
<p><span class="koboSpan" id="kobo.193.1">If you’re unfamiliar with the ins and outs of SvelteKit’s more advanced routing techniques, it can quickly become unwieldy. </span><span class="koboSpan" id="kobo.193.2">To get ahead of the unexpected, we’re going to look at a few more strategies you can use to ensure your application’s routing works as you intend it to. </span><span class="koboSpan" id="kobo.193.3">In this section, we will cover how you can ensure that parameters are of the type you’re expecting them to be. </span><span class="koboSpan" id="kobo.193.4">We’ll then examine how SvelteKit handles URLs that can resolve to multiple routes. </span><span class="koboSpan" id="kobo.193.5">We’ll wrap it up with a bit of information about encoding URLs. </span><span class="koboSpan" id="kobo.193.6">You can expect to see the </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">following sub-sections:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.195.1">Matching</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.196.1">Sorting</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.197.1">Encoding</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.198.1">Once finished, you’ll be one step closer to mastering the routing of </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">SvelteKit apps.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.200.1">Matching</span></h2>
<p><span class="koboSpan" id="kobo.201.1">We’ve </span><a id="_idIndexMarker158"/><span class="koboSpan" id="kobo.202.1">looked at how we can use optional and rest parameters in our routes. </span><span class="koboSpan" id="kobo.202.2">But think back to the example we created in </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.203.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.204.1"> dealing with dynamic routes. </span><span class="koboSpan" id="kobo.204.2">In the news section, we only checked whether the provided </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">[slug]</span></strong><span class="koboSpan" id="kobo.206.1"> parameter existed in our database. </span><span class="koboSpan" id="kobo.206.2">If we wanted to ensure that the value being passed to our database was in fact a slug, we could create a custom matcher to do </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">just that.</span></span></p>
<p><span class="koboSpan" id="kobo.208.1">To create a</span><a id="_idIndexMarker159"/><span class="koboSpan" id="kobo.209.1"> matcher with SvelteKit, we add a JS file with a descriptive name to </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">src/params/</span></strong><span class="koboSpan" id="kobo.211.1">. </span><span class="koboSpan" id="kobo.211.2">If the directory doesn’t exist yet, don’t fret! </span><span class="koboSpan" id="kobo.211.3">You can simply go ahead and create it now. </span><span class="koboSpan" id="kobo.211.4">The files here export a single function: </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">match()</span></strong><span class="koboSpan" id="kobo.213.1">. </span><span class="koboSpan" id="kobo.213.2">That function accepts one string parameter and returns a boolean value. </span><span class="koboSpan" id="kobo.213.3">Because the value passed to the function is a string, we’ll </span><a id="_idIndexMarker160"/><span class="koboSpan" id="kobo.214.1">use </span><strong class="bold"><span class="koboSpan" id="kobo.215.1">regular expressions</span></strong><span class="koboSpan" id="kobo.216.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.217.1">regex</span></strong><span class="koboSpan" id="kobo.218.1">) to ensure the parameter passed in is of the type we want enforced on our route. </span><span class="koboSpan" id="kobo.218.2">Regex may seem daunting at first but there exist plenty of tools online to assist in the creation and learning of regex rules. </span><span class="koboSpan" id="kobo.218.3">See the end of this chapter for more resources. </span><span class="koboSpan" id="kobo.218.4">Now let’s create a matcher for our news articles to ensure they are being passed a proper slug before we perform our </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">database lookup:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.220.1">src/params/slug.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.221.1">
export function match(str) {
  return /^[a-z0-9]+(?:-[a-z0-9]+)*$/gim.test(str);
}</span></pre>
<p><span class="koboSpan" id="kobo.222.1">As is clear, matchers need not be overly complicated. </span><span class="koboSpan" id="kobo.222.2">It simply needs to export the </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">match()</span></strong><span class="koboSpan" id="kobo.224.1"> function, which accepts a string parameter. </span><span class="koboSpan" id="kobo.224.2">This matcher then tests that string against a regex literal, returning true for a match and false for a mismatch. </span><span class="koboSpan" id="kobo.224.3">This regex tests for one or more string or number characters followed by a </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">–</span></strong><span class="koboSpan" id="kobo.226.1"> character, which must be followed by one or more string or number characters. </span><span class="koboSpan" id="kobo.226.2">A string ending with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">–</span></strong><span class="koboSpan" id="kobo.228.1"> character is </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">considered invalid.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.230.1">Applying matchers</span></p>
<p class="callout"><span class="koboSpan" id="kobo.231.1">When </span><a id="_idIndexMarker161"/><span class="koboSpan" id="kobo.232.1">applying a matcher to a specific route, the value following the </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">=</span></strong><span class="koboSpan" id="kobo.234.1"> character is the name of the given matcher. </span><span class="koboSpan" id="kobo.234.2">Another example may include creating a matcher that tests for integers. </span><span class="koboSpan" id="kobo.234.3">That rule could be enforced on a dynamic route by setting the parameter like so: </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">[param=integer]</span></strong><span class="koboSpan" id="kobo.236.1"> where </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">params/integer.js</span></strong><span class="koboSpan" id="kobo.238.1"> is the name of the </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">matcher file.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">To apply the matcher we just created to our news articles, we need to rename </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">src/routes/news/[slug]</span></strong><span class="koboSpan" id="kobo.242.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">src/routes/news/[slug=slug]</span></strong><span class="koboSpan" id="kobo.244.1">. </span><span class="koboSpan" id="kobo.244.2">Once we have adjusted the parameter in our route accordingly, we can go back and view our news articles just as we did before. </span><span class="koboSpan" id="kobo.244.3">Of course, the existing articles will match just fine as they contain valid slugs. </span><span class="koboSpan" id="kobo.244.4">To test that this matcher is being applied before we run our database lookup, we can create a new article in </span><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">src/lib/articles.json</span></strong><span class="koboSpan" id="kobo.246.1">. </span><span class="koboSpan" id="kobo.246.2">The content and </span><a id="_idIndexMarker162"/><span class="koboSpan" id="kobo.247.1">title of the new article object are irrelevant but by creating an article with an invalid slug, we can confirm the matcher is working. </span><span class="koboSpan" id="kobo.247.2">Once you have created an article with a bad slug, attempt to view it. </span><span class="koboSpan" id="kobo.247.3">You should receive a </span><strong class="bold"><span class="koboSpan" id="kobo.248.1">404 Not Found</span></strong><span class="koboSpan" id="kobo.249.1"> error even though the article exists. </span><span class="koboSpan" id="kobo.249.2">This is because the dynamic parameter passed in did not match our provided </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">regular expression.</span></span></p>
<p><span class="koboSpan" id="kobo.251.1">While regular expressions can be intimidating to work with, it’s comforting to know that SvelteKit empowers developers to harness the power behind them. </span><span class="koboSpan" id="kobo.251.2">Being able to do so ensures our applications work as we intend them to. </span><span class="koboSpan" id="kobo.251.3">However, there may still be instances where SvelteKit routes to an endpoint in an unexpected way. </span><span class="koboSpan" id="kobo.251.4">To avoid these situations, let’s take a look at which routing rules take precedence </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">over others.</span></span></p>
<h2 id="_idParaDest-100"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.253.1">Sorting</span></h2>
<p><span class="koboSpan" id="kobo.254.1">Since it is</span><a id="_idIndexMarker163"/><span class="koboSpan" id="kobo.255.1"> entirely possible for a URL to match multiple routes, it’s important to understand which routing rules will be executed in which order. </span><span class="koboSpan" id="kobo.255.2">Similar to how CSS rules are given different weights, so too are the rules in SvelteKit’s routing. </span><span class="koboSpan" id="kobo.255.3">So which routing rules will be executed when and how do we </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">avoid collisions?</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.257.1">More specific routes will always take precedence over less specific routes. </span><span class="koboSpan" id="kobo.257.2">A route without a parameter is considered the highest level. </span><span class="koboSpan" id="kobo.257.3">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">src/routes/about/+page.svelte</span></strong><span class="koboSpan" id="kobo.259.1"> will be executed </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">before </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">src/routes/[param]/+page.svelte</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.263.1">Applying a matcher to a dynamic parameter will give it a higher priority than those without a matcher. </span><span class="koboSpan" id="kobo.263.2">Calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">src/routes/news/[slug=slug]/+page.svelte</span></strong><span class="koboSpan" id="kobo.265.1"> will be given priority </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">over </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">src/routes/news/[slug]/+page.svelte</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.269.1">Optional and rest parameters are given the least preference. </span><span class="koboSpan" id="kobo.269.2">If they are not the final section of the route, they are ignored. </span><span class="koboSpan" id="kobo.269.3">For instance, </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">src/routes/[x]/+page.svelte</span></strong><span class="koboSpan" id="kobo.271.1"> will execute </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">before </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">src/routes/[...rest]/+page.svelte</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.275.1">Tiebreakers are determined by alphabetical order of the parameters. </span><span class="koboSpan" id="kobo.275.2">That is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">src/routes/[x]/+page.svelte</span></strong><span class="koboSpan" id="kobo.277.1"> will execute </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">before </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.279.1">src/routes/[z]/+page.svelte</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.281.1">If you’re</span><a id="_idIndexMarker164"/><span class="koboSpan" id="kobo.282.1"> planning to leverage the more advanced routing features of SvelteKit, then understanding these rules is an absolute must. </span><span class="koboSpan" id="kobo.282.2">Try customizing the routes created in your project and adjusting them to create collisions. </span><span class="koboSpan" id="kobo.282.3">See if you can resolve the collisions yourself or predict which pages will be called before others. </span><span class="koboSpan" id="kobo.282.4">Next, we’ll look at how to manage special characters in URLs </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">via encoding.</span></span></p>
<h2 id="_idParaDest-101"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.284.1">Encoding</span></h2>
<p><span class="koboSpan" id="kobo.285.1">At some</span><a id="_idIndexMarker165"/><span class="koboSpan" id="kobo.286.1"> point in their career, every developer has encountered issues with encoding, yet no one ever takes the time to fully understand them. </span><span class="koboSpan" id="kobo.286.2">Since you’re a busy developer, eager to get started building, and you probably didn’t pick up this book to get lectured about encoding, we’ll keep this short. </span><span class="koboSpan" id="kobo.286.3">To prevent serious frustration when building routes that make use of special characters, SvelteKit lets us encode the routes so they may be used in URLs. </span><span class="koboSpan" id="kobo.286.4">Of course, some characters such as </span><strong class="bold"><span class="koboSpan" id="kobo.287.1">[</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.288.1">]</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.289.1">(</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.290.1">)</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.291.1">#</span></strong><span class="koboSpan" id="kobo.292.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">%</span></strong><span class="koboSpan" id="kobo.294.1"> have special meanings either in SvelteKit or the browser and so they are mostly off limits. </span><span class="koboSpan" id="kobo.294.2">However, they can still be used when properly encoded in the routing mechanism and URL encoded for </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">When creating routes with special characters in SvelteKit, the special characters are written inside of square brackets </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">[ ]</span></strong><span class="koboSpan" id="kobo.298.1"> similar to how dynamic parameters are. </span><span class="koboSpan" id="kobo.298.2">However, they are then prefixed by </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">x+</span></strong><span class="koboSpan" id="kobo.300.1"> and followed by the hexadecimal value of the character. </span><span class="koboSpan" id="kobo.300.2">An example of this is when creating a route to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">/.well-known/</span></strong><span class="koboSpan" id="kobo.302.1"> directory, which could be represented like so: </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">src/routes/[x+2e]well-known/+page.svelte</span></strong><span class="koboSpan" id="kobo.304.1">. </span><span class="koboSpan" id="kobo.304.2">In most cases, there should be no issues with this route and encoding won’t be necessary, but we’re using it for demonstration purposes. </span><span class="koboSpan" id="kobo.304.3">Go ahead and create it in your project. </span><span class="koboSpan" id="kobo.304.4">In the browser, navigate to the development site and append the </span><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">/.well-known/</span></strong><span class="koboSpan" id="kobo.306.1"> route to confirm it works. </span><span class="koboSpan" id="kobo.306.2">Now try to create the route </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">/?-help/</span></strong><span class="koboSpan" id="kobo.308.1">. </span><span class="koboSpan" id="kobo.308.2">Because </span><strong class="bold"><span class="koboSpan" id="kobo.309.1">?</span></strong><span class="koboSpan" id="kobo.310.1"> is a special character in the browser, it must be encoded to properly execute. </span><span class="koboSpan" id="kobo.310.2">We can create the route using the hexadecimal values like this: </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">src/routes/[x+3f]-help/+page.svelte</span></strong><span class="koboSpan" id="kobo.312.1">. </span><span class="koboSpan" id="kobo.312.2">But we won’t be able to access the web page at </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">/?-help/</span></strong><span class="koboSpan" id="kobo.314.1">. </span><span class="koboSpan" id="kobo.314.2">Instead, we’ll need to access that particular route at </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">/%3f%-help/</span></strong><span class="koboSpan" id="kobo.316.1">. </span><span class="koboSpan" id="kobo.316.2">Whenever using a special character in routes, consider encoding it with the hexadecimal </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">values beforehand.</span></span></p>
<p><span class="koboSpan" id="kobo.318.1">To obtain</span><a id="_idIndexMarker166"/><span class="koboSpan" id="kobo.319.1"> the hexadecimal value of a character, you can use the following JS snippet: </span><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">':'.charCodeAt(0).toString(16);</span></strong><span class="koboSpan" id="kobo.321.1"> where </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">:</span></strong><span class="koboSpan" id="kobo.323.1"> is the special character you’d like to retrieve the hexadecimal value for. </span><span class="koboSpan" id="kobo.323.2">We’re not limited to only using hexadecimal values for simple text either. </span><span class="koboSpan" id="kobo.323.3">SvelteKit’s routing</span><a id="_idIndexMarker167"/><span class="koboSpan" id="kobo.324.1"> also supports </span><strong class="bold"><span class="koboSpan" id="kobo.325.1">Unicode</span></strong><span class="koboSpan" id="kobo.326.1"> standards. </span><span class="koboSpan" id="kobo.326.2">As such, we could use an emoji directly within our routes. </span><span class="koboSpan" id="kobo.326.3">If we needed to work around encoding with Unicode, we could use </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">[u+xxxx]</span></strong><span class="koboSpan" id="kobo.328.1"> where </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">xxxx</span></strong><span class="koboSpan" id="kobo.330.1"> is the Unicode </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">code point.</span></span></p>
<p><span class="koboSpan" id="kobo.332.1">To ensure our application behaves as expected, it’s essential to know how to properly encode special characters. </span><span class="koboSpan" id="kobo.332.2">We also looked at how we can apply matchers to routes so that we can ensure dynamic parameters are of the type we’re expecting them to be. </span><span class="koboSpan" id="kobo.332.3">And with our cursory glance at how routes are given precedence over others, you should feel comfortable exploring even more advanced techniques in your </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">application’s routing.</span></span></p>
<h1 id="_idParaDest-102"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.334.1">Advanced layouts</span></h1>
<p><span class="koboSpan" id="kobo.335.1">The more</span><a id="_idIndexMarker168"/><span class="koboSpan" id="kobo.336.1"> complex the application, the more complex the structure becomes. </span><span class="koboSpan" id="kobo.336.2">To keep application logic organized we can utilize more advanced routing mechanisms such as layout groups and breakouts. </span><span class="koboSpan" id="kobo.336.3">By using layout groups, we can organize various layout components without cluttering the application URL. </span><span class="koboSpan" id="kobo.336.4">And by inserting simple syntax into pages and templates, we can break a layout or page out from its hierarchy while keeping the structure of our </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">application intact.</span></span></p>
<p><span class="koboSpan" id="kobo.338.1">Since we organize our application components into logical groupings, it makes sense to organize application functionality into logical groupings as well. </span><span class="koboSpan" id="kobo.338.2">To demonstrate using a real-world example, consider interface components that are available to logged-in users but not available to anonymous users. </span><span class="koboSpan" id="kobo.338.3">When logged in, users can interact with other users through comments, change their profile information, or view their own notifications. </span><span class="koboSpan" id="kobo.338.4">A user of the site that is not logged in should not see any of these components. </span><span class="koboSpan" id="kobo.338.5">With what we’ve learned so far about layouts, creating different layouts for each type of user could potentially run us into the issue of affecting our application’s clean URL. </span><span class="koboSpan" id="kobo.338.6">This is where we can harness SvelteKit’s </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">layout groups.</span></span></p>
<p><span class="koboSpan" id="kobo.340.1">When creating a layout group, use parenthesis </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">( )</span></strong><span class="koboSpan" id="kobo.342.1"> to surround the directory name. </span><span class="koboSpan" id="kobo.342.2">All content inside of that layout group will then be included in the group and slotted in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">+layout.svelte</span></strong><span class="koboSpan" id="kobo.344.1"> file found there. </span><span class="koboSpan" id="kobo.344.2">To demonstrate layout groups, we’ll create two groups: </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">(app)</span></strong><span class="koboSpan" id="kobo.346.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">(site)</span></strong><span class="koboSpan" id="kobo.348.1">. </span><span class="koboSpan" id="kobo.348.2">Inside of </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">(app)</span></strong><span class="koboSpan" id="kobo.350.1">, we’ll move logic related to the application features, and inside of </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">(site)</span></strong><span class="koboSpan" id="kobo.352.1">, we’ll move logic commonly found in basic websites. </span><span class="koboSpan" id="kobo.352.2">Our</span><a id="_idIndexMarker169"/><span class="koboSpan" id="kobo.353.1"> new </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">routes</span></strong><span class="koboSpan" id="kobo.355.1"> directory structure should look similar </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">to this:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.357.1">src/routes/</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.358.1">
src/
|_routes/
   |_(app)/
   |  |_comment/
   |  |_login/
   |  |_notifications/
   |  |_store/
   |
   |_(site)/
   |  |_about/
   |  |_fetch/
   |  |_news/
   |
   |_api/
   |_+layout.server.js
   |_+layout.svelte
   |_+page.svelte</span></pre>
<p><span class="koboSpan" id="kobo.359.1">After shuffling our folders around, we can create a layout for each of our new </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">layout groups:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.361.1">src/routes/(app)/+layout.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.362.1">
&lt;div class='app_layout'&gt;
  &lt;slot /&gt;
&lt;/div&gt;
&lt;style&gt;
  .app_layout {
    background: #cac4c4;
    padding: 1rem;
  }
&lt;/style&gt;</span></pre>
<p><span class="koboSpan" id="kobo.363.1">In this layout file, we’re</span><a id="_idIndexMarker170"/><span class="koboSpan" id="kobo.364.1"> wrapping all of the content that will be rendered in the Svelte </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">&lt;slot /&gt;</span></strong><span class="koboSpan" id="kobo.366.1"> directive with another </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">&lt;div&gt;</span></strong><span class="koboSpan" id="kobo.368.1"> element that will apply a background color. </span><span class="koboSpan" id="kobo.368.2">For simplicity’s sake, we’re only attempting to demonstrate how different layout groups work. </span><span class="koboSpan" id="kobo.368.3">The next file does exactly the same thing but applies a </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">different color:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.370.1">src/routes/(site)/+layout.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.371.1">
&lt;div class='site_layout'&gt;
  &lt;slot /&gt;
&lt;/div&gt;
&lt;style&gt;
  .site_layout {
    background: #83a8ee;
    padding: 1rem;
  }
&lt;/style&gt;</span></pre>
<p><span class="koboSpan" id="kobo.372.1">After saving these layouts, you’ll notice the application shows different background colors when navigating the browser to </span><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">comment/</span></strong><span class="koboSpan" id="kobo.374.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">login/</span></strong><span class="koboSpan" id="kobo.376.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">notifications/</span></strong><span class="koboSpan" id="kobo.378.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">store/</span></strong><span class="koboSpan" id="kobo.380.1"> than it does for </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">about/</span></strong><span class="koboSpan" id="kobo.382.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">fetch/</span></strong><span class="koboSpan" id="kobo.384.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">news/</span></strong><span class="koboSpan" id="kobo.386.1">. </span><span class="koboSpan" id="kobo.386.2">However, our URLs remain exactly </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">the same!</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">For cases where </span><a id="_idIndexMarker171"/><span class="koboSpan" id="kobo.389.1">want to break a particular layout or page out of the existing hierarchy, we can append the </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">@</span></strong><span class="koboSpan" id="kobo.391.1"> character to the filename. </span><span class="koboSpan" id="kobo.391.2">For example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">+page@</span></strong><span class="koboSpan" id="kobo.393.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">+layout@</span></strong><span class="koboSpan" id="kobo.395.1">. </span><span class="koboSpan" id="kobo.395.2">We can then follow it up with the name of the directory we would like it to inherit directly from. </span><span class="koboSpan" id="kobo.395.3">If no name is provided after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">@</span></strong><span class="koboSpan" id="kobo.397.1"> character, then the root layout will be utilized. </span><span class="koboSpan" id="kobo.397.2">We can see this in action by renaming </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">src/routes/(app)/store/products/[...details]/+page.svelte</span></strong><span class="koboSpan" id="kobo.399.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">src/routes/(app)/store/products/[...details]/+page@(app).svelte</span></strong><span class="koboSpan" id="kobo.401.1">. </span><span class="koboSpan" id="kobo.401.2">Doing so moves the product page out of the product and store layouts. </span><span class="koboSpan" id="kobo.401.3">Try renaming it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">+page@store.svelte</span></strong><span class="koboSpan" id="kobo.403.1"> to keep the store layout or </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">+page@.svelte</span></strong><span class="koboSpan" id="kobo.405.1"> to take it all the way back to the root layout. </span><span class="koboSpan" id="kobo.405.2">Of course, our product links are no longer visible as the markup to show them was included in </span><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">src/routes/(app)/store/products/+layout.svelte</span></strong><span class="koboSpan" id="kobo.407.1">, but we’re only trying to demonstrate how you can break a page out of its immediate layouts. </span><span class="koboSpan" id="kobo.407.2">This functionality can be useful for separating your application logic into administrative or authenticated sections while keeping the </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">URL unaffected.</span></span></p>
<p><span class="koboSpan" id="kobo.409.1">We’ve just seen how we can break out of layouts using </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">@</span></strong><span class="koboSpan" id="kobo.411.1"> symbols in the Svelte component naming conventions. </span><span class="koboSpan" id="kobo.411.2">When we include </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">@</span></strong><span class="koboSpan" id="kobo.413.1"> followed by the name of our desired layout, the file will inherit directly from the named layout instead of all layouts between. </span><span class="koboSpan" id="kobo.413.2">We’ve also seen how we can create layout groups to keep our project structured without disrupting the application URL. </span><span class="koboSpan" id="kobo.413.3">With everything we’ve covered, you should be capable of meeting even the most complex routing requirements for any </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">SvelteKit project.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.415.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.416.1">In the chapters leading up to this, we covered core routing concepts. </span><span class="koboSpan" id="kobo.416.2">In this chapter, we looked at the more advanced techniques available in SvelteKit. </span><span class="koboSpan" id="kobo.416.3">These techniques can help us further customize our application and address edge cases. </span><span class="koboSpan" id="kobo.416.4">When it comes to routing, we now have an understanding of how we can create optional parameters with default values. </span><span class="koboSpan" id="kobo.416.5">We’ve also seen how rest parameters can be used to create a shareable URL of unknown lengths. </span><span class="koboSpan" id="kobo.416.6">Matching was shown to be useful for ensuring our application is receiving parameters of the expected types. </span><span class="koboSpan" id="kobo.416.7">We also saw how SvelteKit prioritizes certain routing rules over others, which is helpful for understanding the order of execution when a URL matches multiple routes. </span><span class="koboSpan" id="kobo.416.8">After covering how to encode special characters in routes, we looked at how we can create layout groups and even break out of the layout hierarchies while keeping application logic intact. </span><span class="koboSpan" id="kobo.416.9">If you’ve finished this chapter and feel comfortable with everything learned, you’ll be able to handle even the strangest of edge cases encountered while building the routing of your </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">SvelteKit application.</span></span></p>
<p><span class="koboSpan" id="kobo.418.1">In the next chapter, we’ll take a short break from routing to analyze various SvelteKit adapters and the environments they are used in. </span><span class="koboSpan" id="kobo.418.2">We’ll also take a closer look at page options and attempt to build our application for a production environment for the </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">first time.</span></span></p>
<h1 id="_idParaDest-104"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.420.1">Resources</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.421.1">RegExr – a great site for practicing and learning </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">regex: </span></span><a href="https://regexr.com/"><span class="No-Break"><span class="koboSpan" id="kobo.423.1">https://regexr.com/</span></span></a></li>
<li><span class="koboSpan" id="kobo.424.1">Unicode </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">standards: </span></span><a href="https://www.unicode.org/standard/standard.html"><span class="No-Break"><span class="koboSpan" id="kobo.426.1">https://www.unicode.org/standard/standard.html</span></span></a></li>
<li><span class="koboSpan" id="kobo.427.1">Programming with </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">Unicode: </span></span><a href="https://unicodebook.readthedocs.io/index.html"><span class="No-Break"><span class="koboSpan" id="kobo.429.1">https://unicodebook.readthedocs.io/index.html</span></span></a></li>
</ul>
</div>


<div class="Content" id="_idContainer022">
<h1 id="_idParaDest-105"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.1.1">Part 3 – Supplemental Concepts</span></h1>
<p><span class="koboSpan" id="kobo.2.1">This part aims to cover the additional requisite concepts of SvelteKit. </span><span class="koboSpan" id="kobo.2.2">It begins by showing you how to produce a build for a production environment with resources showing how easily it can be done using SvelteKit’s adapter system. </span><span class="koboSpan" id="kobo.2.3">It then covers how hooks can be used to manipulate data flowing in and out of a SvelteKit application. </span><span class="koboSpan" id="kobo.2.4">From there, it addresses how to best import static assets by leveraging Vite. </span><span class="koboSpan" id="kobo.2.5">Then, it explains the various modules available in SvelteKit that make the entire framework possible. </span><span class="koboSpan" id="kobo.2.6">The section then covers how to ensure that a SvelteKit application can be made available to as many users as possible while boosting search engine rankings. </span><span class="koboSpan" id="kobo.2.7">Finally, it wraps up with various resources that will prove invaluable to any developer attempting to power their next project </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">with SvelteKit.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19024_08_Final_AM.xhtml#_idTextAnchor106"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 8</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Builds and Adapters</span></em></li>
<li><a href="B19024_09_Final_AM.xhtml#_idTextAnchor116"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 9</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Hooks and Error Handling</span></em></li>
<li><a href="B19024_10_Final_MA.xhtml#_idTextAnchor125"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Managing Static Assets</span></em></li>
<li><a href="B19024_11_Final_AM.xhtml#_idTextAnchor137"><em class="italic"><span class="koboSpan" id="kobo.15.1">Chapter 11</span></em></a><span class="koboSpan" id="kobo.16.1">, </span><em class="italic"><span class="koboSpan" id="kobo.17.1">Modules and Secrets</span></em></li>
<li><a href="B19024_12_Final_AM.xhtml#_idTextAnchor154"><em class="italic"><span class="koboSpan" id="kobo.18.1">Chapter 12</span></em></a><span class="koboSpan" id="kobo.19.1">, </span><em class="italic"><span class="koboSpan" id="kobo.20.1">Enhancing Accessibility and Optimizing SEO</span></em></li>
<li><a href="B19024_13_Final_AM.xhtml#_idTextAnchor163"><em class="italic"><span class="koboSpan" id="kobo.21.1">Appendix</span></em></a> <em class="italic"><span class="koboSpan" id="kobo.22.1">Examples and Support</span></em></li>
</ul>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer023">
</div>
</div>
<div>
<div id="_idContainer024">
</div>
</div>
</body></html>