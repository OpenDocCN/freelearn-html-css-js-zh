<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Building Great User Interfaces</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Inserting templates with Spacebars</li><li class="listitem">Inserting raw HTML using triple braces</li><li class="listitem">Creating dynamic lists</li><li class="listitem">Building a smooth interface with Bootstrap</li><li class="listitem">Creating customized global helpers</li><li class="listitem">Creating custom components</li><li class="listitem">Using reactivity with HTML attributes</li><li class="listitem">Using dynamic templates</li><li class="listitem">Animating DOM elements</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Introduction</h1></div></div></div><p>Like everything else in Meteor, UI development is designed to be simple, elegant, and powerful. With just a few imperative commands, you can create sophisticated and dynamic user interfaces, significantly speeding up your prototyping/wireframing efforts.</p><p>The recipes in this chapter will walk you through the most common UI- and template-building techniques, which will form the foundation for your Meteor apps moving forward.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Inserting templates with Spacebars</h1></div></div></div><p><strong>Spacebars</strong> <a id="id140" class="indexterm"/>is Meteor's templating language. All <strong>Document </strong><a id="id141" class="indexterm"/>
<strong>Object Model</strong> (<strong>DOM</strong>) elements in <a id="id142" class="indexterm"/>Meteor are created programmatically using Meteor's default templating engine, <strong>Blaze</strong>. Elements can therefore be created using pure JavaScript. Using JavaScript to create HTML elements, however, isn't exactly quick and easy.</p><p>Inspired by the popular HTML templating language <strong>Handlebars</strong>, Spacebars makes it incredibly easy to structure and declare your HTML elements using templates. And, it gives you access to all the reactive and dynamic features of Meteor. This recipe will show you how to create templates using the Spacebars syntax.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec97"/>Getting ready</h2></div></div></div><p>You will need Meteor installed and have a project created. We recommend that you have a simple project, similar to the one found in the <em>Setting up your project file structure</em> recipe in <a class="link" title="Chapter 1. Optimizing Your Workflow" href="part0015.xhtml#aid-E9OE1">Chapter 1</a>, <em>Optimizing Your Workflow</em>, but any project will do. You will need to locate your <code class="literal">&lt;body&gt;</code> tag, which is usually found inside your <code class="literal">main.html</code> file.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec98"/>How to do it...</h2></div></div></div><p>To make this recipe just a little bit more useful, we are going to create two templates and nest one inside of the other, using the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, create <a id="id143" class="indexterm"/>a file named <code class="literal">templates.html</code> <a id="id144" class="indexterm"/>and add it to your <code class="literal">client</code> folder:<div><img src="img/image00345.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Open <code class="literal">templates.html</code> in an editor, add the following code, and save your changes:<div><pre class="programlisting">&lt;template name="firstTemplate"&gt;
    &lt;div id="title"&gt;This is my first ever template&lt;/div&gt;
    &lt;svg height="200" width="100%" id="shapes"&gt;
        {{&gt; one}}
    &lt;/svg&gt;
&lt;/template&gt;


&lt;template name="one"&gt;
    &lt;circle cx="100" cy="50" r="40" stroke="#ffc348" stroke-width="3" fill="#31be4f" /&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">Next, open your <code class="literal">main.html</code> file (or the <code class="literal">.html</code> file that contains your <code class="literal">&lt;body&gt;</code> tag) and edit your <code class="literal">body</code> tag by adding the following code:<div><pre class="programlisting">&lt;body&gt;
  {{&gt; firstTemplate}}
&lt;/body&gt;</pre></div></li><li class="listitem">Save the changes, start Meteor if it isn't already running, and navigate to your Meteor-hosted page in a browser (usually <code class="literal">http://localhost:3000</code>):<div><img src="img/image00346.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec99"/>How it works...</h2></div></div></div><p>We created two <a id="id145" class="indexterm"/>templates, with the first one being a very <a id="id146" class="indexterm"/>simple <code class="literal">svg</code> element:</p><div><pre class="programlisting">&lt;template name="one"&gt;
    &lt;circle cx="100" cy="50" r="40" stroke="#ffc348" stroke-width="3" fill="#31be4f" /&gt;
&lt;/template&gt;</pre></div><p>We gave the template a <code class="literal">name</code> attribute value as <code class="literal">"one"</code> and added the well-formed HTML <code class="literal">&lt;circle&gt;</code> element with position and appearance attributes. We also created a parent template, as follows:</p><div><pre class="programlisting">&lt;template name="firstTemplate"&gt;
    &lt;div id="title"&gt;This is my first ever template&lt;/div&gt;
    &lt;svg height="200" width="100%"&gt;
        {{&gt; one}}
    &lt;/svg&gt;
&lt;/template&gt;</pre></div><p>This template also has a name (<code class="literal">"firstTemplate"</code>) and contains a <code class="literal">&lt;div&gt;</code> element, containing the title of our template. We declared an <code class="literal">&lt;svg&gt;</code> element, and we inserted our template named <code class="literal">one</code> between the <code class="literal">&lt;svg&gt;</code> and <code class="literal">&lt;/svg&gt;</code> tags using the <code class="literal">{{&gt;}}</code> command.</p><p>Finally, in <code class="literal">main.html</code>, we inserted the <code class="literal">firstTemplate</code> template between the main <code class="literal">&lt;body&gt;</code> and <code class="literal">&lt;/body&gt;</code> tags, again using the <code class="literal">{{&gt;}}</code> command, which is also known as <strong>template inclusion</strong>.</p><p>As you can see, the content of our templates consists primarily of HTML tags. This is the fundamental building block of our UI, and it's how we've been creating templates from the very beginning. Anything contained inside double braces (<code class="literal">{{…}}</code>) is a command meant for Blaze, Meteor's templating engine. In this case, we told Blaze to:</p><div><ol class="orderedlist arabic"><li class="listitem">Insert the <a id="id147" class="indexterm"/><code class="literal">firstTemplate</code> template into our <code class="literal">&lt;body&gt;</code> element.</li><li class="listitem">Insert the <code class="literal">one</code> <a id="id148" class="indexterm"/>template into our <code class="literal">&lt;svg&gt;</code> element, inside <code class="literal">firstTemplate</code>.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec100"/>There's more…</h2></div></div></div><p>You can read all about <a id="id149" class="indexterm"/>templates in the official Meteor documentation, found at <a class="ulink" href="http://docs.meteor.com/#/full/templates">http://docs.meteor.com/#/full/templates</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Inserting raw HTML using triple braces</h1></div></div></div><p>Occasionally, you <a id="id150" class="indexterm"/>will want to insert raw HTML <a id="id151" class="indexterm"/>into your Meteor page. This is typically done when you have HTML generated by another process or library. This recipe will show you how to render your raw HTML inside a Meteor template.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec101"/>Getting ready</h2></div></div></div><p>You will need Meteor installed and have a project created with at least one template in it. We recommend that you use the files created in the <em>Inserting templates with Spacebars</em> recipe found in this chapter.</p><p>If you don't have a <code class="literal">templates.js</code> file in your <code class="literal">client</code> folder already, you should create one to keep your template <code class="literal">helpers</code> and <code class="literal">events</code> logic separate from other JavaScript you may be running.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec102"/>How to do it…</h2></div></div></div><p>Identify the name of your root template and open the file containing your template definition. In our case, the root template is named <code class="literal">firstTemplate</code>, which can be found in our <code class="literal">templates.html</code> file, which is in our <code class="literal">[project root]/client</code> folder. Proceed with the following steps to insert raw HTML using triple braces:</p><div><ol class="orderedlist arabic"><li class="listitem">Insert the following line, just before the <code class="literal">&lt;/template&gt;</code> tag, and save your changes:<div><pre class="programlisting">&lt;template name="firstTemplate"&gt;
    ...
<strong>    {{{rawInsert}}}</strong>
&lt;/template&gt;</pre></div><p>Now, open your <code class="literal">templates.js</code> file and add the following helper function:</p><div><pre class="programlisting">Template.firstTemplate.helpers({ rawInsert: function () { return "&lt;div&gt;&lt;strong&gt;Raw HTML!&lt;/strong&gt;&lt;/div&gt;";
  }
});</pre></div></li><li class="listitem">Save your <a id="id152" class="indexterm"/>changes, start Meteor if <a id="id153" class="indexterm"/>it isn't already running, and navigate to your Meteor-hosted page in a browser (usually <code class="literal">http://localhost:3000</code>). You should see the rendered HTML at the bottom of your screen, as shown in the following screenshot:<div><img src="img/image00347.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec103"/>How it works…</h2></div></div></div><p>We created and then called our <code class="literal">Template.firstTemplate.rawInsert</code> helper function by adding the <code class="literal">{{{rawInsert}}}</code> tag at the bottom of our template and declaring the <code class="literal">rawInsert</code> helper in our <code class="literal">templates.js</code> file.</p><p>The triple-braced tag informs Blaze that the object returned from the helper will be raw HTML and needs to be rendered as such. Accordingly, Blaze expects a string and will attempt to render it.</p><p>To see how <a id="id154" class="indexterm"/>Blaze would normally treat raw HTML, change <a id="id155" class="indexterm"/>the triple-braced tag to a double-braced tag <code class="literal">( {{rawInsert}})</code> save your file, and view the result in your browser, as shown in the following screenshot:</p><div><img src="img/image00348.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec104"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Creating dynamic graphs with SVG and Ajax</em> recipe in <a class="link" title="Chapter 7. Using Client Methods" href="part0065.xhtml#aid-1TVKI1">Chapter 7</a>, <em>Using Client Methods</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Creating dynamic lists</h1></div></div></div><p>The Meteor <a id="id156" class="indexterm"/>Spacebars syntax supports the rapid development of lists, tables, and other displays of data through the use of template block tags. Used within templates, block tags can quickly add dynamic lists and even customize the look and feel of each element, based on its unique attributes. This recipe will show you how to use the <code class="literal">#each</code> block tag to display multiple elements of a collection inside a Blaze template.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec105"/>Getting ready</h2></div></div></div><p>We will use the code from the <em>Inserting templates with Spacebars</em> recipe, found in this chapter, as our baseline project.</p><p>If you haven't already done so, create and save a new file in your <code class="literal">[project root]/client</code> folder called <code class="literal">templates.js</code>.</p><p>Create and save a new file in your <code class="literal">[project root]/both</code> folder called <code class="literal">collections.js</code>.</p><p>We will want to make one modification to the HTML in the <code class="literal">templates.html</code> file. We will change the height of our <code class="literal">&lt;svg&gt;</code> element from <code class="literal">200</code> to <code class="literal">800</code>:</p><div><pre class="programlisting">&lt;svg height=<strong>"800"</strong> width="100%" id="shapes"&gt;</pre></div><p>Finally, we want to add the <code class="literal">random</code> package to our project to help us generate some random colors and positions. In a terminal window, navigate to your project root and enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor add random</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec106"/>How to do it…</h2></div></div></div><p>To create a <a id="id157" class="indexterm"/>dynamic list, proceed with the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, let's declare a <code class="literal">shapes</code> collection. Open <code class="literal">collections.js</code>, add the following code, and save your changes:<div><pre class="programlisting">Shapes = new Mongo.Collection('shapes');</pre></div></li><li class="listitem">Now, let's add shapes to the page dynamically. Open your <code class="literal">templates.html</code> file, make the following changes to the <code class="literal">one</code> template, and save your changes:<div><pre class="programlisting">&lt;template name="one"&gt;
<strong>    {{#each svgShapes}}</strong>
    &lt;circle cx="<strong>{{x}}</strong>" cy="<strong>{{y}}</strong>" r="40" stroke="<strong>{{border}}</strong>" stroke-width="3" fill="<strong>{{color}}</strong>" /&gt;
<strong>    {{/each}}</strong>
&lt;/template&gt;</pre></div></li><li class="listitem">We will now create the template helper, which returns our dynamic collection. Open <code class="literal">templates.js</code>, add the following helper function, and then close and save your changes:<div><pre class="programlisting">Template.one.helpers({
  svgShapes: function () {
    return Shapes.find();
  }
});</pre></div></li><li class="listitem">We can now dynamically add shapes to the <code class="literal">shape</code> collection, and they will be rendered on our page. Open the JavaScript console in your browser and enter the following command:<div><pre class="programlisting">
<strong>&gt; Shapes.insert({x:200,y:50,border:'#123456',color:'#bada55'})</strong>
</pre></div><p>You should see a green circle with a dark border appear on the screen, similar to the following screenshot:</p><div><img src="img/image00349.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>Let's add <a id="id158" class="indexterm"/>more circles to prove that our template is rendering all the shapes in the <code class="literal">Shapes</code> collection.</p></li><li class="listitem">In <code class="literal">templates.js</code>, add the following code:<div><pre class="programlisting">Template.firstTemplate.events({ 'click svg': function (e,t){ var xpos,ypos;
    if(e.offsetX==undefined)
    {
      xpos = e.pageX-$('#shapes').offset().left;
      ypos = e.pageY-$('#shapes').offset().top;
    }
    else
    {
      xpos = e.offsetX;
      ypos = e.offsetY;
    }
        choices = ['#bada55','#B43831', '783BA3', '#00AB1B', '#143275', '#FFA700'],
        color = Random.choice(choices),
        border = Random.choice(choices);
    Shapes.insert({x:xpos,y:ypos,border:border,color:color});
    },
    'dblclick': function(e,t){ Meteor.call('resetShapes');
    }
});</pre></div></li><li class="listitem">We now want to display the total number of shapes, so we need to add a <code class="literal">shapeCount</code> function to the <code class="literal">Template.firstTemplate.helpers</code> method call:<div><pre class="programlisting">Template.firstTemplate.helpers({
  shapeCount: function () {
    return Shapes.find().count();
  },
  rawInsert: function () {...
We will also need to Modify templates.html to display a count of the shapes collection:
&lt;template name="firstTemplate"&gt;
    &lt;div id="title"&gt;shapes collection count: {{shapeCount}}&lt;/div&gt;</pre></div></li><li class="listitem">Let's add a <code class="literal">resetShapes</code> method for good measure. Open/create the <code class="literal">server.js</code> file, found in your <code class="literal">[project root]/server</code> folder, and add the following code:<div><pre class="programlisting">Meteor.methods({
    resetShapes: function(){
        Shapes.remove({});
    }
});</pre></div></li><li class="listitem">Save all your <a id="id159" class="indexterm"/>changes, start Meteor if it isn't already running, and navigate to your Meteor-hosted page in a browser (usually <code class="literal">http://localhost:3000</code>).<p>Now, as you click in your browser, new circles will appear and the upper-left part of the screen will display your <code class="literal">shapes</code> collection count:</p><div><img src="img/image00350.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>Feel free to add as many shapes as you would like or reset back to zero by double-clicking anywhere on the screen.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec107"/>How it works…</h2></div></div></div><p>We created the <code class="literal">Template.one.svgShapes</code> helper in <code class="literal">templates.js</code>, which returns a cursor to the <code class="literal">shapes</code> collection. This sets the data context for our template and is accessible using the <code class="literal">{{#each svgShapes}}</code> block tag, which we added to our <code class="literal">one</code> template in <code class="literal">templates.html</code>.</p><p>Because templates and <a id="id160" class="indexterm"/>template helpers are reactive computations, they react when the collection is updated. This reaction causes Blaze to re-render the page, using the dynamic template found within the <code class="literal">#each</code> block tag.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec108"/>There's more…</h2></div></div></div><p>Other block helpers <a id="id161" class="indexterm"/>exist and they are just as easy to use. Refer to the Spacebars documentation on GitHub for a more detailed explanation, which is available at <a class="ulink" href="https://github.com/meteor/meteor/blob/devel/packages/spacebars/README.md">https://github.com/meteor/meteor/blob/devel/packages/spacebars/README.md</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec109"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Implementing a simple collection</em> recipe in <a class="link" title="Chapter 4. Creating Models" href="part0046.xhtml#aid-1BRPS1">Chapter 4</a>, <em>Creating Models</em></li><li class="listitem">The <em>Creating dynamic graphs with SVG and Ajax</em> recipe in <a class="link" title="Chapter 7. Using Client Methods" href="part0065.xhtml#aid-1TVKI1">Chapter 7</a>, <em>Using Client Methods</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Building a smooth interface with Bootstrap</h1></div></div></div><p>As a web <a id="id162" class="indexterm"/>developer, one of the biggest drains on <a id="id163" class="indexterm"/>your time comes from styling your pages. Bootstrap offers an elegant, simple design with enough ready-to-use component styles to get you up and running quickly, without having to get bogged down writing CSS. This recipe will walk you through a few of the Bootstrap component styles and give you a sampling of how easy they are to use.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec110"/>Getting ready</h2></div></div></div><p>We will be using the <em>Creating dynamic lists</em> recipe found in this chapter as a baseline for our code.</p><p>We will also need to add the official Bootstrap package to our Meteor project using Meteor's package repository. Open a terminal window, navigate to the root folder of your project, and enter the following command:</p><div><pre class="programlisting">
<strong>$ meteor add twbs:bootstrap</strong>
</pre></div><div><h3 class="title"><a id="tip23"/>Tip</h3><p>There are <a id="id164" class="indexterm"/>other packages that are complementary to the official Bootstrap package. You can find a complete list of these at <a class="ulink" href="https://atmospherejs.com/?q=bootstrap">https://atmospherejs.com/?q=bootstrap</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec111"/>How to do it…</h2></div></div></div><p>We will make our title and collection count presentable using the <code class="literal">btn</code> and <code class="literal">navbar</code> styles built in to Bootstrap. Proceed with the following steps to build a smooth interface with Bootstrap:</p><div><ol class="orderedlist arabic"><li class="listitem">First, let's modify our title, adding a sub<code class="literal"> &lt;div&gt;</code> tag and styling it like a Bootstrap button. Open <code class="literal">templates.html</code>, make the following code changes, and save your file:<div><pre class="programlisting">&lt;div id="title"&gt;<strong>Shapes Collection Count:</strong>
<strong>    &lt;div id="resetShapes" class="btn btn-warning"&gt;</strong>
       {{shapeCount}}
<strong>       &lt;/div&gt;</strong>
   &lt;/div&gt;</pre></div></li><li class="listitem">After this change, your title should look much more presentable, as shown in the following screenshot:<div><img src="img/image00351.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We will now add the <code class="literal">navbar</code> style to the entire title, giving it a distinct, intentional <a id="id165" class="indexterm"/>look. Open <code class="literal">templates.html</code> again and replace the title<code class="literal"> &lt;div&gt;</code> tag with the following code:<div><pre class="programlisting">    &lt;nav class="navbar navbar-default"&gt;
        &lt;div class="container-fluid"&gt;
            &lt;div class="navbar-header"&gt;
                &lt;div id="title" class="navbar-brand"&gt;Shapes Collection Count&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class="nav navbar-left"&gt;
                &lt;div id="resetShapes" class="btn btn-warning navbar-btn"&gt;
                    {{shapeCount}}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/nav&gt;</pre></div></li><li class="listitem">Save these <a id="id166" class="indexterm"/>changes and your page should be updated. The <strong>Shapes Collection Count</strong> section should now appear in a distinct <code class="literal">navbar</code> style, similar to the following screenshot:<div><img src="img/image00352.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Lastly, let's turn our count button into an actual button. Open <code class="literal">templates.js</code> and change <a id="id167" class="indexterm"/>the <code class="literal">dblclick</code> event to a <a id="id168" class="indexterm"/>specific <code class="literal">click</code> event. This event is placed at the bottom of the <code class="literal">Template.firstTemplate.events</code> function:<div><pre class="programlisting">Template.firstTemplate.events({
    …
<strong>    'click #resetShapes'</strong>: function(e,t){
        Meteor.call('resetShapes');
    }
})</pre></div><p>We have now disabled double-click as the method of resetting our <code class="literal">shapes</code> collection and transferred it to the <strong>Shapes Collection Count</strong> total. By clicking on the orange button, the collection will reset to zero:</p><div><img src="img/image00353.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec112"/>How it works…</h2></div></div></div><p>Changing the look and feel of a page using Bootstrap is simply a matter of adding the correct CSS <code class="literal">class</code> declarations and structuring our HTML appropriately.</p><p>To style the <code class="literal">shapes</code> collection count, we added the <code class="literal">btn</code> and <code class="literal">btn-warning</code> value to the <code class="literal">class</code> attribute. This allows the Bootstrap CSS to appropriately style the <code class="literal">&lt;div&gt;</code> tag, making it appear as an orange button.</p><p>To style our title, we <a id="id169" class="indexterm"/>had to first create the scaffolding for <a id="id170" class="indexterm"/>the <code class="literal">navbar</code> tag. We did this by essentially wrapping our <code class="literal">&lt;div&gt;</code> tag with a <code class="literal">&lt;nav&gt;</code> tag. We then appropriately structured the containing tags by adding <code class="literal">nav</code>, <code class="literal">navbar</code>, <code class="literal">navbar-header</code>, and <code class="literal">navbar-left</code> to the <code class="literal">class</code> attributes. The other <code class="literal">class</code> declarations (<code class="literal">navbar-default</code>, <code class="literal">navbar-brand</code>, and <code class="literal">navbar-btn</code>) are strictly style declarations, changing the color/shape but not affecting the overall structure or layout.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec113"/>There's more…</h2></div></div></div><p>Bootstrap is very robust and <a id="id171" class="indexterm"/>comes with excellent documentation. You can learn more about Bootstrap at <a class="ulink" href="http://getbootstrap.com/">http://getbootstrap.com/</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec114"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Adding Meteor packages</em> and <em>Discovering new packages with Atmosphere</em> recipes in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Creating customized global helpers</h1></div></div></div><p>As you begin to <a id="id172" class="indexterm"/>really dig into templates, you'll soon discover how truly great template helpers are. You can access data inline and drastically reduce the amount of code you need to write.</p><p>You will, however, eventually run into a situation where you find yourself repeating the same logic in multiple, in-template helpers. Wouldn't it be great if there was a way to create global helpers accessible from any template? Well, Meteor has a solution for this too! This recipe will show you how to create global template helpers using the <code class="literal">Template.registerHelper</code> function.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec115"/>Getting ready</h2></div></div></div><p>We will use the codebase from the <em>Building a smooth interface with Bootstrap</em> recipe, found in this chapter. Please follow that recipe first or download the corresponding codebase.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec116"/>How to do it…</h2></div></div></div><p>We're going to make a global random color generator and add random colors to all the objects on the <a id="id173" class="indexterm"/>screen by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">templates.html</code>, found in your <code class="literal">[project root]/client</code> folder, and make the following changes to the color attributes of the <code class="literal">one</code> template:<div><pre class="programlisting">&lt;template name="one"&gt;
    {{#each svgShapes}}
    &lt;circle cx="{{x}}" cy="{{y}}" r="40" stroke="{{<strong>randColor</strong>}}" stroke-width="3" fill="{{<strong>randColor</strong>}}" /&gt;{{/each}}
&lt;/template&gt;</pre></div></li><li class="listitem">We will also use the <code class="literal">randColor</code> helper in our <code class="literal">&lt;div&gt;</code> title to give it a bit of (random) color. Inside the <code class="literal">firstTemplate</code> template, look for and modify the <code class="literal">&lt;div&gt;</code> title as follows:<div><pre class="programlisting">&lt;div class="navbar-header"&gt;
                &lt;div id="title" class="navbar-brand" <strong>style="color:{{randColor}}</strong>"&gt;Shapes Collection Count&lt;/div&gt;</pre></div></li><li class="listitem">Save your changes and start your Meteor app if it isn't already started. As you view your Meteor page in your browser, you will notice that the circles have all turned black. This is because although we are referencing the global helper, we haven't actually created it yet.</li><li class="listitem">So, let's take care of that. Open <code class="literal">templates.js</code>, found in your <code class="literal">[project root]/client</code> folder, and add the following function at the bottom:<div><pre class="programlisting">Template.registerHelper('randColor',function(){
    choices = ['#bada55','#B43831', '783BA3', '#00AB1B', '#143275', '#FFA700'];
    return Random.choice(choices);
});</pre></div></li><li class="listitem">Once you save the changes, your page will refresh and the circles will now have a random color, as will the title bar of your app. To prove that it is indeed using the global <code class="literal">randColor</code> helper, open another browser window, navigate to your page (usually <code class="literal">http://localhost:3000</code>), and view the results side by side. As you click on the page to add circles or refresh the page, the colors will change at random and will be different from one browser window to the next, as shown in the following screenshot:<div><img src="img/image00354.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec117"/>How it works…</h2></div></div></div><p>The <code class="literal">Template.registerHelper</code> function declares a helper that can be seen in context with any template. Think of it as a way to declare global functions, accessible within the Spacebars syntax.</p><p>The first argument of <code class="literal">Template.registerHelper</code> is a string value, which contains the name of our helper (the name to be used to reference it inline, inside our templates). When deciding on a name for a global helper, keep in mind that it is indeed global. It should therefore be <a id="id174" class="indexterm"/>unique, to prevent conflicts, or the value could be overridden by a template-specific helper. Our example is very simple, so we can get away with <code class="literal">randColor</code>; however, as you build more sophisticated templates, it's a good idea to give your helpers more distinct names. The value returned is obviously a randomly selected color, using the same technique that we used in the original <code class="literal">firstTemplate</code> click event handler.</p><p>We then used the global helper in two different templates. First, we replaced <code class="literal">{{color}}</code> and <code class="literal">{{border}}</code> in the circle's <code class="literal">svg</code> declaration with <code class="literal">{{randColor}}</code>, causing our circles to appear with a random color every time. Finally, we added a <code class="literal">style="color:{{randColor}}"</code> attribute to our <code class="literal">&lt;div&gt;</code> title, which randomly assigns a text color upon page refresh.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec118"/>There's more…</h2></div></div></div><p>There are obviously some very advanced techniques you can accomplish with global helpers, using other template-related methods such as <code class="literal">Template.instance()</code> and <code class="literal">Template.currentData</code>. All of these can't be covered in this recipe, but we encourage you to explore the <a id="id175" class="indexterm"/>Meteor documentation to familiarize yourself with what global helpers can do.</p><div><h3 class="title"><a id="tip24"/>Tip</h3><p>For a good overview of the <a id="id176" class="indexterm"/>available template utilities, consult the Meteor documentation at <a class="ulink" href="http://docs.meteor.com/#/full/templates_api">http://docs.meteor.com/#/full/templates_api</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec119"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Inserting templates with Spacebars</em> and <em>Using reactivity with HTML attributes</em> recipes in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Creating custom components</h1></div></div></div><p>Adding and using <a id="id177" class="indexterm"/>templates in Meteor is a great way to speed up your workflow. Using Meteor's built-in content block helpers can further streamline your workflow by allowing nested and deferred template calls. In essence, you can combine and nest templates to create your own "components". This recipe will show you how to build a basic Spacebars custom block helper using <code class="literal">Template.contentBlock</code>.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec120"/>Getting ready</h2></div></div></div><p>We will use the codebase from the <em>Building a smooth interface with Bootstrap</em> recipe found in this chapter. Please follow that recipe first, or download the corresponding codebase.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec121"/>How to do it…</h2></div></div></div><p>Proceed with the following steps to create custom components:</p><div><ol class="orderedlist arabic"><li class="listitem">We need to make the template-specific <code class="literal">shapeCount</code> helper global so we can use it inside our component. In <code class="literal">templates.js</code>, delete the <code class="literal">shapeCount</code> function found in the <code class="literal">Template.firstTemplate.helpers()</code> method call, and add the following function to the bottom of the page:<div><pre class="programlisting">Template.registerHelper('shapeCount',function (){
  return Shapes.find().count();
});</pre></div></li><li class="listitem">Now, we will create our component. We will first create a <code class="literal">navbutton</code> template, which will use the newly created <code class="literal">shapeCount</code> helper. Create a new template file, named <code class="literal">navbar.html</code>, in your <code class="literal">[project_root]/client</code> folder. Open this <a id="id178" class="indexterm"/>file in a text editor and add the following template code:<div><pre class="programlisting">&lt;template name="navbutton"&gt;
    &lt;div class="nav navbar-left"&gt;
        &lt;div id="resetShapes" class="btn btn-warning navbar-btn"&gt;
            {{shapeCount}}
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">To create a custom <code class="literal">navbar</code> block tag, add the <code class="literal">navbar</code> template in the same file, complete with a <code class="literal">Template.contentBlock</code> reference, as follows:<div><pre class="programlisting">&lt;template name="navbar"&gt;
    &lt;nav class="navbar navbar-default"&gt;
        &lt;div class="container-fluid"&gt;
            &lt;div class="navbar-header"&gt;
                &lt;div id="title" class="navbar-brand"&gt;Shapes Collection Count&lt;/div&gt;
            &lt;/div&gt;
            {{&gt; Template.contentBlock}}
        &lt;/div&gt;
    &lt;/nav&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">Our component is now complete! Let's use it in our code. Open <code class="literal">templates.html</code> and completely remove the <code class="literal">&lt;nav&gt;</code> element block, including the code inside the <code class="literal">firstTemplate</code> template. The only element left after this change will be the <code class="literal">&lt;svg&gt;</code> element. Just above the <code class="literal">&lt;svg&gt;</code> element, we are going to call our <code class="literal">navbar</code> template using the <code class="literal">{{#[template name]}}</code> block tag, as follows:<div><pre class="programlisting">&lt;template name="firstTemplate"&gt;
<strong>    {{#navbar}}</strong>
<strong>      {{&gt; navbutton}}</strong>
<strong>    {{/navbar}}</strong>
    &lt;svg&gt;</pre></div></li><li class="listitem">Save all your changes, start your Meteor instance if it isn't already running, and view the results in your browser. You will notice that nothing has changed. We have the same functionality as before; only now, we have created a custom Spacebars component (formally, a custom block helper), and we could add more components to the <code class="literal">navbar</code> tag as needed or enter explicit HTML, for example, replacing <code class="literal">{{&gt; navbutton}}</code> with <code class="literal">&lt;div&gt;{{shapeCount}}&lt;/div&gt;</code> will display the <strong>Shapes collection count</strong> without the use of the <code class="literal">navbutton</code> template, similar to the following screenshot (not very pretty, but you <a id="id179" class="indexterm"/>get the point):<div><img src="img/image00355.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>If you inspect the element in your browser, you will notice that manually entered <code class="literal">&lt;div&gt;…&lt;/div&gt;</code> has been inserted in the placeholder block, similar to the following example:</p><div><pre class="programlisting">&lt;nav class="navbar navbar-default"&gt;
  ...
<strong>    &lt;div&gt;15&lt;/div&gt;</strong>
  ...
&lt;/nav&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec122"/>How it works…</h2></div></div></div><p>The key to building block helpers resides in the <code class="literal">Template.contentBlock</code> function. We created a new <code class="literal">navbar</code> template and used <code class="literal">{{&gt; Template.contentBlock}}</code> inside that template to specify a placeholder. This placeholder (called a <strong>content</strong> <strong>block</strong>) can be specified later, rather than having to be specified explicitly inside the <code class="literal">navbar</code> template. This simple addition of a content block turns our <code class="literal">navbar</code> template into a <em>component</em>.</p><p>Once we created our block helper, along with the template meant to go inside the block helper, we added a <code class="literal">Spacebars</code> block tag with <code class="literal">{{#navbar}}</code> and the ending <code class="literal">{{/navbar}}</code> calls. Inside this block, we called our new <code class="literal">navbutton</code> template using <code class="literal">{{&gt; navbutton}}</code>, which is inserted in the <code class="literal">{{&gt; Template.contentBlock}}</code> placeholder. At runtime, all these template functions get executed in order, and Blaze renders the actual HTML DOM elements.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec123"/>There's more…</h2></div></div></div><p>Custom block helpers can also utilize the <code class="literal">#if</code>, <code class="literal">#else</code>, and <code class="literal">#unless</code> logic through the use of <code class="literal">UI.elseBlock</code>. Using <a id="id180" class="indexterm"/>these commands, you can create reusable, dynamic block helpers and templates, further streamlining your development process.</p><div><h3 class="title"><a id="tip25"/>Tip</h3><p>For a thorough walkthrough of all the options available, see the GitHub documentation on <a id="id181" class="indexterm"/>Spacebars, found at <a class="ulink" href="https://github.com/meteor/meteor/blob/devel/packages/spacebars/README.md">https://github.com/meteor/meteor/blob/devel/packages/spacebars/README.md</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec124"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Inserting templates with Spacebars</em> and <em>Creating customized global helpers</em> recipes in this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Using reactivity with HTML attributes</h1></div></div></div><p>One of the hidden <a id="id182" class="indexterm"/>gems in Meteor is the extremely <a id="id183" class="indexterm"/>granular control you have over how HTML is rendered. Blaze was designed in such a way that you can modify, add, or remove HTML element attributes dynamically without affecting anything else in the DOM! This recipe will walk you through the use of dynamic, reactive data inside element attributes.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec125"/>Getting ready</h2></div></div></div><p>We will use the codebase from the <em>Creating custom components</em> recipe, the previous recipe in this chapter. Please follow that recipe first or download the corresponding codebase.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec126"/>How to do it…</h2></div></div></div><p>Proceed with the following steps to use reactivity with HTML attributes:</p><div><ol class="orderedlist arabic"><li class="listitem">We first need to create a new <code class="literal">navcolor</code> template. Open <code class="literal">navbar.html</code> in your <code class="literal">[project root]/client</code> folder and add the following code:<div><pre class="programlisting">&lt;template name="navcolor"&gt;
    &lt;div class="nav navbar-form navbar-right"&gt;
        &lt;input type="checkbox" id='bgCheck' checked="{{useBG}}"/&gt;
        &lt;input type="text" id='bgColor' placeholder="#bgcolor" value="{{bgColor}}" /&gt;
    &lt;/div&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">We now need to add our new template to our <code class="literal">navbar</code> content block so that we can input a new background color and turn it on and off. Open <code class="literal">templates.html</code> (also in the <code class="literal">client</code> folder) and modify the <code class="literal">firstTemplate</code> template, adding a template call just below the <code class="literal">{{&gt; navbutton}}</code> call, similar to the following:<div><pre class="programlisting">{{#navbar this}}
<strong>      {{&gt; navbutton}}</strong>
<strong>      {{&gt; navcolor}}</strong>
    {{/navbar}}</pre></div></li><li class="listitem">On the very next line, add a <code class="literal">style</code> attribute to the <code class="literal">&lt;svg&gt;</code> element so that we can change the background color, like so:<div><pre class="programlisting">&lt;svg height="800" width="100%" id="shapes" <strong>style="background-color:{{bgColor}}</strong>"&gt;</pre></div></li><li class="listitem">In the <a id="id184" class="indexterm"/>preceding code, we have set up <a id="id185" class="indexterm"/>references to two helper functions: <code class="literal">bgColor</code> and <code class="literal">useBG</code>. We will now create these global template helpers. Open <code class="literal">templates.js</code> and append the following two functions:<div><pre class="programlisting">Template.registerHelper('bgColor', function () { if (Session.equals('useBG', true)) {return Session.get('bgColor');
    } else return null;
});

Template.registerHelper('useBG', function(){return Session.get('useBG');
});</pre></div></li><li class="listitem">If we save these changes and open the web console in your browser, we can now programmatically change and toggle the background color. In the web console, execute the following two lines:<div><pre class="programlisting">
<strong>&gt; Session.set('bgColor','lig</strong>
<strong>htgrey')</strong>
<strong>&gt; Session.set('useBG',true)</strong>
</pre></div><p>These three things should have changed on your screen:</p><div><ul class="itemizedlist"><li class="listitem">The background should now be light grey in color</li><li class="listitem">The checkbox to the top-right of your <code class="literal">navbar</code> tag should be checked</li><li class="listitem">The word <strong>lightgrey</strong> should now appear in the top-right text box</li></ul></div><p>Your screen should now look similar to the following screenshot:</p><div><img src="img/image00356.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">All that's <a id="id186" class="indexterm"/>left is to hook up events to the <a id="id187" class="indexterm"/>checkbox's and textbox's <code class="literal">&lt;input&gt;</code> elements. Create a new file named <code class="literal">navbar.js</code> in your <code class="literal">[project_root]/client</code> folder and add the following <code class="literal">events</code> handler declarations:<div><pre class="programlisting">Template.navcolor.events({ 'click #bgCheck': function (e, c) { Session.set('useBG', e.currentTarget.checked);
  }, 'change #bgColor, keyup #bgColor': function (e, c) { if (!Session.equals('bgColor', e.currentTarget.value)) { Session.set('bgColor', e.currentTarget.value);
    }
  }
});</pre></div></li><li class="listitem">Save your changes and your elements will now affect the background. Checking/unchecking the checkbox will toggle the background color, and changing the value in the textbox will dynamically change the displayed background.</li><li class="listitem">We want to observe the effect this has on the DOM. Open the <code class="literal">developer</code> panel in your browser and locate the <code class="literal">&lt;svg&gt;</code> element. As you toggle the background on and off using the checkbox, observe the attribute list inside the top <code class="literal">&lt;svg&gt;</code> tag. You'll notice that the <code class="literal">style</code> attribute appears and disappears, depending on the state of the checkbox, similar to the following screenshot:<div><img src="img/image00357.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div><p>As you can see, the attribute doesn't just become empty. It is removed altogether. You will also notice that when this happens, neither the screen nor the elements view are refreshing. That's because the DOM is not being rebuilt. The attribute is being added and removed, according <a id="id188" class="indexterm"/>to the state of <code class="literal">{{bgColor}}</code>. Similarly, when you modify the value in the textbox, nothing else is affected (no screen <a id="id189" class="indexterm"/>refreshes, or lost states).</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec127"/>How it works…</h2></div></div></div><p>With the introduction of the Blaze templating engine, Meteor stopped manipulating strings and started interacting with DOM trees / DOM elements directly. This change simplifies the development process in comparison to other templating libraries because DOM elements don't have to be re-rendered every time there is a change to the HTML.</p><p>In the case of the <code class="literal">style</code> attribute, the only argument inside the attribute is a reference to the <code class="literal">bgColor</code> helper function. If the value from a helper function or data context is <code class="literal">null</code>/<code class="literal">undefined</code>, and if that value is the only value in an attribute, Blaze automatically removes the attribute, rather than rendering it with no value in it.</p><p>So, in this case, when the <code class="literal">{{bgColor}}</code> helper function returned <code class="literal">null</code> (when <code class="literal">Session.useBG</code> is <code class="literal">false</code> or <code class="literal">undefined</code>), Blaze was removing the <code class="literal">style</code> attribute from the <code class="literal">&lt;svg&gt;</code> element.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec128"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Inserting templates with Spacebars</em> recipe in this chapter</li><li class="listitem">The <em>Using the Session object</em> recipe in <a class="link" title="Chapter 4. Creating Models" href="part0046.xhtml#aid-1BRPS1">Chapter 4</a>, <em>Creating Models</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Using dynamic templates</h1></div></div></div><p>Meteor has <a id="id190" class="indexterm"/>yet another templating trick up its sleeve! In addition to custom code blocks, reactive data contexts, and all the other various template niceties, Meteor also allows you to dynamically switch between rendered templates. This recipe will show you how to dynamically render templates, using the <code class="literal">Template.dynamic</code> helper.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec129"/>Getting ready</h2></div></div></div><p>We will use the codebase from the <em>Creating custom components</em> recipe found in this chapter. Please follow that recipe first or download the corresponding codebase.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec130"/>How to do it...</h2></div></div></div><p>We will add a dynamic template that will switch our shapes from circles to squares, when rendered. Proceed with the following steps to use dynamic templates:</p><div><ol class="orderedlist arabic"><li class="listitem">First, we need to create our alternate template. Inside <code class="literal">templates.html</code>, located in your <code class="literal">[project root]/client</code> folder, add the following template, just below the declaration for the existing <code class="literal">one</code> template:<div><pre class="programlisting">&lt;template name="two"&gt;
    {{#each svgShapes}}
        &lt;rect x="{{x}}" y="{{y}}" width="80" height="80" stroke="{{border}}" stroke-width="3" fill="{{color}}" /&gt;
    {{/each}}
&lt;/template&gt;</pre></div></li><li class="listitem">We will need a data context for this template. Fortunately, we can reuse the <code class="literal">Shapes</code> collection. Open <code class="literal">templates.js</code>, make a copy of the <code class="literal">svgShapes</code> function, and add it to a new <code class="literal">Template.two.helpers()</code> method call, as follows:<div><pre class="programlisting">Template.two.helpers({ svgShapes: function () { return Shapes.find();
  }
});</pre></div><p>Now, we will add logic to toggle between the <code class="literal">one</code> and <code class="literal">two</code> templates, based on the <code class="literal">Session.curTemplate</code> variable. At the bottom of <code class="literal">templates.js</code>, add the following <code class="literal">helpers()</code> method call:</p><div><pre class="programlisting">Template.firstTemplate.helpers({ <strong>  curTemplate: function () { var curTempl = Session.get('curTemplate');</strong>
<strong>    if (!curTempl) { curTempl = 'one';</strong>
<strong>      Session.set('curTemplate', curTempl);</strong>
<strong>    }</strong>
<strong>    return curTempl;</strong>
<strong>  }</strong>
});</pre></div></li><li class="listitem">All that's left to do is to add the dynamic template declaration and create an easy way to toggle between the templates. Let's take care of the declaration first. Open <code class="literal">templates.html</code> and modify the double brackets inside the <code class="literal">&lt;svg&gt;</code> element as follows:<div><pre class="programlisting">&lt;svg height="800" width="100%" id="shapes"&gt;
    {{<strong>&gt; Template.dynamic template = curTemplate</strong>}}
&lt;/svg&gt;</pre></div></li><li class="listitem">Now, we will <a id="id191" class="indexterm"/>add some toggle buttons and hook up the events to change the value of the <code class="literal">Session.curTemplate</code> variable. Open <code class="literal">navbar.html</code> and add the following template at the bottom:<div><pre class="programlisting">&lt;template name="navshapes"&gt;
    &lt;div class="nav navbar-right"&gt;
        &lt;button id="btnCircles" class="btn btn-success navbar-btn"&gt;one&lt;/button&gt;
        &lt;button id="btnSquares" class="btn btn-danger navbar-btn"&gt;two&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">We need to include the <code class="literal">navshapes</code> template in our block helper. Open <code class="literal">templates.html</code> and add the following template inclusion just before the <code class="literal">{{/navbar}}</code> block tag:<div><pre class="programlisting">{{#navbar}}
  ...
<strong>  {{&gt; navshapes}}</strong>
{{/navbar}}</pre></div></li><li class="listitem">One last addition, to hook up the events, and we're ready to roll. Create a <code class="literal">navbar.js</code> file in your <code class="literal">[project root]/client</code> folder and add the following code:<div><pre class="programlisting">Template.navshapes.events({ 'click button.btn': function(e,c){ Session.set('curTemplate',e.currentTarget.textContent);
  }
});</pre></div></li><li class="listitem">Save all your changes, start your Meteor project if it isn't already running, and navigate to your project in a browser (usually <code class="literal">http://localhost:3000</code>). You will see two buttons at the top-right corner of the screen. Click on them, back and forth, to see the shapes on the screen toggle between circles and squares, similar to the following screenshot:<div><img src="img/image00358.jpeg" alt="How to do it..."/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec131"/>How it works…</h2></div></div></div><p><code class="literal">Template.dynamic</code> takes a <code class="literal">template</code> argument and renders the template with the appropriate name. Because we make the template argument dynamic and reactive, using the <code class="literal">curTemplate</code> helper, the rendered template will change as the value of <code class="literal">Session.curTemplate</code> <a id="id192" class="indexterm"/>changes. This ability to dynamically render templates is the basis for the popular Meteor package <code class="literal">iron:router</code>. It can be used in multiple situations where you would like to switch out templates, based on reactive data sources.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec132"/>There's more…</h2></div></div></div><p>Iron Router takes dynamic <a id="id193" class="indexterm"/>templates to an entirely new level. The documentation for Iron Router can be found at <a class="ulink" href="https://github.com/iron-meteor/iron-router/blob/devel/Guide.md">https://github.com/iron-meteor/iron-router/blob/devel/Guide.md</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec133"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Creating a multipage application with Iron Router</em> recipe in <a class="link" title="Chapter 2. Customizing with Packages" href="part0028.xhtml#aid-QMFO1">Chapter 2</a>, <em>Customizing with Packages</em></li><li class="listitem">The <em>Creating custom components </em>recipe in this chapter</li><li class="listitem">The <em>Using the Session object recipe</em> in <a class="link" title="Chapter 4. Creating Models" href="part0046.xhtml#aid-1BRPS1">Chapter 4</a>, <em>Creating Models</em></li><li class="listitem">The <em>Creating a complete app with Iron Router</em> recipe in <a class="link" title="Chapter 12. Creating Useful Projects" href="part0088.xhtml#aid-2JTHG1">Chapter 12</a>, <em>Creating Useful Projects</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Animating DOM elements</h1></div></div></div><p>Meteor has a <a id="id194" class="indexterm"/>very elegant way of rendering DOM elements in our web apps, but until now, this hasn't included animations. Fortunately for us, Meteor now supports animations, including animations when an element is first added to the DOM. This recipe will walk you through how to use standard CSS animation techniques inside Meteor.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec134"/>Getting ready</h2></div></div></div><p>We will use the codebase from the <em>Using dynamic templates</em> recipe found in this chapter. Please follow that recipe first or download the corresponding codebase.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec135"/>How to do it...</h2></div></div></div><p>We will animate the shapes from our previous recipe, demonstrating animation both before and after the elements are first created and rendered.</p><p>Because we used SVG elements instead of DOM elements, we need to modify jQuery to be able to use <code class="literal">.addClass</code> and <code class="literal">.removeClass</code>. Fortunately, there is a custom package available that will add SVG support and add Meteor UI event support at the same time.</p><div><ol class="orderedlist arabic"><li class="listitem">In a terminal window, navigate to the root folder of your project and execute the following line:<div><pre class="programlisting">
<strong>$ meteor add appmill:animation-hooks</strong>
</pre></div><p>This will install the <code class="literal">animation-hooks</code> package, which includes support for SVG in jQuery.</p></li><li class="listitem">We will now add a very simple hover animation effect. Open or create a <code class="literal">style.css</code> file in your <code class="literal">[project root]/client/lib/styles</code> folder and add the following code:<div><pre class="programlisting">circle,rect {
    opacity:1;
    transition:all 500ms 0ms ease-in;
}

circle:hover, rect:hover{
    opacity:0;
}</pre></div></li><li class="listitem">Save your changes, start your Meteor project if it isn't already started, and navigate to your project URL in a browser (usually <code class="literal">http://localhost:3000</code>). If you don't have shapes on your screen, click to add some and then hover over the shapes. As you hover, you will notice that the shapes will fade out slowly, and as you move the mouse away, the shapes will fade in slowly until they return to full opacity. Now we will use jQuery to move all the shapes on the screen at once. Inside <code class="literal">navbar.html</code>, add the following template at the bottom:<div><pre class="programlisting">&lt;template name="navoffset"&gt;
    &lt;div class="nav navbar-right"&gt;
        &lt;button id="btnNegative" class="btn btn-danger navbar-btn" data-offset="-"&gt;red&lt;/button&gt;
        &lt;button id="btnPositive" class="btn btn-info navbar-btn" data-offset=""&gt;blue&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;</pre></div></li><li class="listitem">Inside <code class="literal">templates.html</code>, add a call to the new <code class="literal">navoffset</code> template, just before the <a id="id195" class="indexterm"/><code class="literal">navshapes</code> declaration:<div><pre class="programlisting">    {{#navbar this}}
     {{&gt; navbutton}}
<strong>     {{&gt; navoffset}}</strong>
     {{&gt; navshapes}}
    {{/navbar}}</pre></div><p>We now add the code for the <code class="literal">button</code> events by modifying <code class="literal">navbar.js</code>, adding the following function at the bottom:</p><div><pre class="programlisting">Template.navoffset.events({
  'click button.btn': function(e,c){
    var shapes = ($('rect').length)? $('rect'):$('circle');
    if (shapes.length==0) return;
    var offset = e.currentTarget.dataset.offset;
    _.each(shapes,function(d,i){
      var randVal = Math.ceil(Math.random()*200)+'px';
      var randOffset = offset+randVal;
      var translate = ('translate('+randOffset+','+randOffset+')');
      $(d).css('transform',translate);
    });
  }
});</pre></div></li><li class="listitem">We also want to add a little bit of polish to our <code class="literal">nav</code> buttons, so add the following CSS to the <code class="literal">style.css</code> file, at the bottom:<div><pre class="programlisting">div.nav {
    margin-left: 20px;
}</pre></div></li><li class="listitem">Save all these changes and your web page should now contain two new buttons, labeled <strong>red</strong> and <strong>blue</strong>. As you click on these buttons alternately, all the shapes on the screen will move their location randomly, back and forth diagonally across your screen.</li><li class="listitem">We will now use the built-in animation hooks, called <code class="literal">_uihooks</code>, to animate shapes as they are <a id="id196" class="indexterm"/>added dynamically to the DOM. Open <code class="literal">templates.html</code> and make the following modifications to both the <code class="literal">one</code> and <code class="literal">two</code> templates:<div><pre class="programlisting">{{#each svgShapes}}
<strong>  {{#Animate}}</strong>
<strong>    &lt;circle class="shape animate" ...</strong>
<strong>  {{/Animate}}</strong>
{{/each}
...
{{#each svgShapes}}
<strong>  {{#Animate}}</strong>
<strong>    &lt;rect class="shape animate" ...</strong>
<strong>  {{/Animate}}</strong>
{{/each}}</pre></div></li><li class="listitem">We have one final step and that is to add the initial <em>before</em> state to the shapes, via our <code class="literal">.animate</code> CSS declaration. Open <code class="literal">style.css</code> and add the following declaration at the bottom:<div><pre class="programlisting">rect.animate, circle.animate {
    transform: translate(-300px,-100px);
    opacity:0;
}</pre></div></li><li class="listitem">Save your changes and test out the new animations functionality by either adding new shapes to the screen (clicking anywhere), or by changing the shapes from circles to squares, and back again (clicking on the <strong>one</strong> and <strong>two</strong> buttons). As you click, you will see the shape(s) fade in and move into place from the left.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec136"/>How it works…</h2></div></div></div><p>Because Blaze now renders objects according to the DOM, rather than rendering according to text-based HTML tags, it is aware of the styles and conditions of the created elements, for example, because we added the <code class="literal">opacity:0</code> style to our <code class="literal">:hover</code> shape elements in <code class="literal">style.css</code>, elements underneath the mouse will fade out and stay faded out, even when we click on / add new shapes. Using jQuery, we can programmatically add styles and transformations, as we did in <code class="literal">navbar.js</code> with the <code class="literal">.css()</code> functions. Blaze will respect these changes as well because programmatic changes to the CSS/DOM are remembered, even when new elements are added.</p><p>The <code class="literal">_uihooks</code> declaration contains three event handlers:</p><div><table border="1"><colgroup><col/><col/></colgroup><tbody><tr><td valign="top">
<p><code class="literal">insertElement</code></p>
</td><td valign="top">
<p>This is fired before a DOM node is rendered so that we can manipulate its position, map where the node will go when animated, and then animate the node as it is rendered.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">removeElement</code></p>
</td><td valign="top">
<p>This is fired before a DOM node is removed. We check to see whether there is an outgoing animation and animate the node if so. Otherwise, we just remove it.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">moveElement</code></p>
</td><td valign="top">
<p>This is fired when a DOM node changes the indexed position in the DOM. We can add any animations before, and then during the index change, to create an animation effect.</p>
</td></tr></tbody></table></div><p>For our sample, we only need to worry about inserting and removing elements. Each element has the CSS <code class="literal">animate</code> class assigned to it, by virtue of the template, which offsets the intended position by (-300,-100). The way we animate is by having the element appear on the screen in the offset position (with the <code class="literal">animate</code> class in effect), and then by removing the <code class="literal">animate</code> class, which triggers a transition/animation because the element moves to its intended position. Thanks to <code class="literal">_uihooks</code> and the <code class="literal">insertElement</code> event handler, we can <a id="id197" class="indexterm"/>programmatically remove <code class="literal">class</code> declarations to elements, right after they are initially rendered, causing them to animate. This makes the shapes seem to fade in from the top-left. Similarly, we can then add them back right before the elements are removed in order to perform an outgoing animation.</p><p>We declare which elements will be affected by wrapping the elements in the <code class="literal">{{#Animate}}…{{/Animate}}</code> block helpers, which causes the <code class="literal">insertElement</code> and <code class="literal">removeElement</code> handlers to fire on the wrapped elements.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec137"/>There's more…</h2></div></div></div><p>We expect some changes as Meteor continues to improve animation support, although the major functionality is already there. Meanwhile, you can walk through how <code class="literal">_uihooks</code> works by adding breakpoints to the client source, in the <code class="literal">packages/appmill:animations-hooks/animation-hooks.js</code> file, similar to the following screenshot:</p><div><img src="img/image00359.jpeg" alt="There's more…"/></div><p style="clear:both; height: 1em;"> </p><p>You can also get <a id="id198" class="indexterm"/>a (slightly) more thorough explanation at <a class="ulink" href="https://github.com/strack/meteor-animation-hooks">https://github.com/strack/meteor-animation-hooks</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec138"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">The <em>Using reactivity with HTML attributes</em> recipe in this chapter</li></ul></div></div></div></body></html>