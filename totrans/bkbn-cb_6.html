<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Templates and UX sugar</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using templates in a view</li><li class="listitem" style="list-style-type: disc">Implementing a template loader</li><li class="listitem" style="list-style-type: disc">Using Mustache templates</li><li class="listitem" style="list-style-type: disc">Defining a form</li><li class="listitem" style="list-style-type: disc">Adding validation to a form</li><li class="listitem" style="list-style-type: disc">Handling form events</li><li class="listitem" style="list-style-type: disc">Customizing a form with the Bootstrap framework</li><li class="listitem" style="list-style-type: disc">Assembling layouts with LayoutManager</li><li class="listitem" style="list-style-type: disc">Building a semantic and an easily styleable data grid</li><li class="listitem" style="list-style-type: disc">Drawing on the HTML5 canvas</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Introduction</h1></div></div></div><p>This chapter introduces you to templates, which are used to separate HTML markup from the application code. Thus, the application becomes more structured and clean. We will discuss the templating engine provided by Underscore.js and learn how to integrate Backbone with third-party templating engines, such as Mustache.js.</p><p>Also, we will discuss useful Backbone extensions, which allows the use of forms, layouts, and grids.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Using templates in a view</h1></div></div></div><p>In this recipe, you are <a class="indexterm" id="id487"/>going to <a class="indexterm" id="id488"/>learn how to use templates in the Backbone view. By default, Backbone.js is integrated with templating engine provided by Underscore.js.</p><p>Let's take an example of the <em>Rendering a collection in a view</em> recipe in <a class="link" href="ch04.html" title="Chapter 4. Views">Chapter 4</a>, <em>Views</em>, where we rendered a <a class="indexterm" id="id489"/>collection with a view and updated the code using Underscore's templating engine. The result will look like the following image:</p><div><img alt="Using templates in a view" src="img/2728OS_06_01.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec165"/>How to do it...</h2></div></div></div><p>Follow these steps to <a class="indexterm" id="id490"/>use templates in a view:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure you have models and collection objects defined.<div><pre class="programlisting">  var InvoiceItemModel = Backbone.Model.extend({

  });

  var InvoiceItemCollection = Backbone.Collection.extend({
    model: InvoiceItemModel
  });</pre></div></li><li class="listitem">Define a view with the <code class="literal">template</code> property which contains a template. Then, when rendering a view, use <code class="literal">template()</code> to return rendered HTML.<div><pre class="programlisting">  var InvoiceItemListView = Backbone.View.extend({

    // HTML element name, where to render a view.
    tagName: 'ul',
    // Define template.
    template: _.template(
      '&lt;% _.each(items, function(item) { %&gt;' + 
      '   &lt;li&gt;' + 
      '      Description: &lt;%= item.description %&gt;.' +
      '      Price: &lt;%= item.price %&gt;.' +
      '      Quantity: &lt;%= item.quantity %&gt;.' +
      '   &lt;/li&gt;' +
      '&lt;% }); %&gt;'
    ),

    // Render view.
    render: function() {

      // Render template and set html for the view element 
      // using jQuery.
      this.$el.html(this.template({
        items: this.collection.toJSON()
      }));

      return this;
    }
  });</pre></div></li><li class="listitem">Create a<a class="indexterm" id="id491"/> collection instance.<div><pre class="programlisting">var invoiceItemCollection = new InvoiceItemCollection([
  { description: 'Wooden Toy House', price: 22, quantity: 3 },
  { description: 'Farm Animal Set', price: 17, quantity: 1 },
  { description: 'Farmer Figure', price: 8, quantity: 1 },
  { description: 'Toy Tractor', price: 15, quantity: 1 }
]);</pre></div></li><li class="listitem">Create a <a class="indexterm" id="id492"/>view instance, render it, and set the result to the value of <code class="literal">body</code>.<div><pre class="programlisting">$('body').html(new InvoiceItemListView({
  collection: invoiceItemCollection
}).render().el);</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec166"/>How it works...</h2></div></div></div><p>With the help of the <code class="literal">_.template()</code> method<a class="indexterm" id="id493"/> provided by Underscore.js, we can define an HTML template where we can include JavaScript code inside the <code class="literal">&lt;% … %&gt;</code> brackets. To output a variable into the template, we need to use the <code class="literal">&lt;%= … %&gt;</code> syntax, and to output an HTML escaped variable, we can use the <code class="literal">&lt;%- … %&gt;</code> syntax.</p><p>Further, in the <code class="literal">render()</code> method<a class="indexterm" id="id494"/>, we pass the collection items in the JSON format into a template.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec167"/>There's more...</h2></div></div></div><p>In this section, we are going to learn how to split a template into partials.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec54"/>Splitting a template into partials</h3></div></div></div><p>Partial is a template that <a class="indexterm" id="id495"/>can be called from other templates as a function.</p><p>In case we want to reuse parts of the existing templates, we can split one template into different parts. To do so, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Define the template part.<div><pre class="programlisting">itemTemplate: _.template(
  'Description: &lt;%= description %&gt;.' + 
  'Price: &lt;%= price %&gt;.' +
  'Quantity: &lt;%= quantity %&gt;.'
),</pre></div></li><li class="listitem">Define the main template.<div><pre class="programlisting">template: _.template(
  '&lt;% _.each(items, function(item) { %&gt;' +
  '  &lt;li&gt;' +
  '    &lt;%= itemTemplate(item) %&gt;' +
  '  &lt;/li&gt;' +
  '&lt;% }); %&gt;'
),</pre></div></li><li class="listitem">When rendering a template, pass a partial method as a setting.<div><pre class="programlisting">this.$el.html(this.template({
  items: this.collection.toJSON(),
  itemTemplate: this.itemTemplate
}));</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec168"/>See also</h2></div></div></div><p>To get more information about templates in Underscore.js, you can refer to the official docs at <a class="ulink" href="http://underscorejs.org/#template">http://underscorejs.org/#template</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Implementing a template loader</h1></div></div></div><p>In a large application, <a class="indexterm" id="id496"/>which follows separation of concerned paradigm, it is important to store templates apart from views, so the web designer can modify them easily without harming views. Such a practice also provides template reusability within the application.</p><div><div><h3 class="title"><a id="tip13"/>Tip</h3><p><strong>Store all your templates in a single HTML file</strong></p><p>For server-side applications, developers typically store templates in separate files, achieving a convenient way for accessing and editing them. However, this can hardly be applied to client-side applications, because it makes a browser download multiple small files from a server, delaying an application start.</p></div></div><p>In this recipe we will store <a class="indexterm" id="id497"/>our templates apart from views in a single HTML file. Also, we will write a template loader, which will load those templates into the memory, allowing them to be accessed from all over the application.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec169"/>How to do it...</h2></div></div></div><p>Follow these steps to implement the template loader:</p><div><ol class="orderedlist arabic"><li class="listitem">Add templates enclosed in the <code class="literal">script</code> tag to the header of the <code class="literal">index.html</code> file. Set the <code class="literal">id</code> attribute to distinguish one template from another.<div><pre class="programlisting">&lt;head&gt;

  …
  
  &lt;script type="text/html" class="template" id="items"&gt;
    &lt;% _.each(items, function(item) { %&gt;
      &lt;li&gt;
        &lt;%= itemTemplate(item) %&gt;
      &lt;/li&gt;
    &lt;% }); %&gt;
  &lt;/script&gt;

  &lt;script type="text/html" class="template" id="item"&gt;
    Description: &lt;%= description %&gt;.
    Price: &lt;%= price %&gt;.
    Quantity: &lt;%= quantity %&gt;
  &lt;/script&gt;

&lt;/head&gt;</pre></div></li><li class="listitem">Create a template loading utility and place it into the <code class="literal">js/template-loader.js</code> file.<div><pre class="programlisting">(function($){

  $(document).ready(function () {

  	 // Store variable within global jQuery object.
    $.tpl = {}

    $('script.template').each(function(index) {

      // Load template from DOM.
      $.tpl[$(this).attr('id')] = _.template($(this).html());

      // Remove template from DOM.
      $(this).remove();
    });
  });

})(jQuery);</pre></div></li><li class="listitem">Include the<a class="indexterm" id="id498"/> template loader into the <code class="literal">index.html</code> file.<div><pre class="programlisting">&lt;head&gt;
  ...
  &lt;script src="img/template-loader.js"&gt;&lt;/script&gt;
  …
&lt;/head&gt;</pre></div></li><li class="listitem">When rendering a view, use templates defined in the global <code class="literal">$.tpl</code> array.<div><pre class="programlisting">this.$el.html($.tpl['items']({
  items: this.collection.toJSON(),
  itemTemplate: $.tpl['item']
}));</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec170"/>How it works...</h2></div></div></div><p>Because we defined our templates in <code class="literal">index.html</code>, they are loaded instantaneously. Then, in the template loader, when the document is fully loaded, we move them into the global variable <code class="literal">$.tpl</code> and remove templates from the DOM. This should speed up further usage of our templates as if we defined them in the JS file. Now, we can use those templates in different views of our application.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Using Mustache templates</h1></div></div></div><p>Mustache is a<a class="indexterm" id="id499"/> beautiful, logicless template syntax. It can be used for HTML, config files, source code, and so on. There are various implementations of Mustache that exist for different languages, such as JavaScript, PHP, Ruby, Python, and many others.</p><p>In this chapter, we are going to learn how to use Mustache.js, which is the implementation of Mustache for JavaScript, with Backbone.js.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec171"/>Getting ready</h2></div></div></div><p>You can download <a class="indexterm" id="id500"/>Mustache.js from its GitHub page at <a class="ulink" href="https://github.com/janl/mustache.js">https://github.com/janl/mustache.js</a>. To include Mustache.js into your project, save the <code class="literal">mustache.js</code> file into the <code class="literal">lib</code> folder, and include a reference to it in <code class="literal">index.html</code>.</p><p>Including the Backbone extension into your project is described in detail in the <em>Extending an application with plugins</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec172"/>How to do it...</h2></div></div></div><p>Follow these steps to use a Mustache template:</p><div><ol class="orderedlist arabic"><li class="listitem">Define a Mustache template in the view.<div><pre class="programlisting">// Define template.
template: '{{#items}}&lt;li&gt;' +
          '  Description: {{description}}' +
          '  Price: {{price}}.' +
          '  Quantity: {{quantity}}.' +
          '&lt;/li&gt;{{/items}}',</pre></div></li><li class="listitem">Run the <code class="literal">Mustache.render()</code> method to render a template.<div><pre class="programlisting">this.$el.html(
  Mustache.render(this.template, {
    items: this.collection.toJSON()
  })
);</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec173"/>How it works...</h2></div></div></div><p><code class="literal">Mustache.render()</code><a class="indexterm" id="id501"/> compiles <a class="indexterm" id="id502"/>a template string into a JavaScript code, and then executes it. A template string contains placeholders like <code class="literal">{{placeholder}}</code>, which are replaced with values provided in the second parameter.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec174"/>There's more...</h2></div></div></div><p>This section describes how to use compiled templates and partials in Mustache.js.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec55"/>Using compiled templates</h3></div></div></div><p>To improve the<a class="indexterm" id="id503"/> performance of your application, you can compile the template before using it by calling <code class="literal">Mustache.compile()</code>. This method accepts the template string as a single parameter and returns a JavaScript function, which can be called to return HTML code. The following example demonstrates how to do it:</p><div><pre class="programlisting">  var InvoiceItemListView = Backbone.View.extend({
    tagName: 'ul',

    template: Mustache.compile(
                '{{#items}}&lt;li&gt;' + 
                '  Description: {{description}}' +
                '  Price: {{price}}.' +
                '  Quantity: {{quantity}}.' +
                '&lt;/li&gt;{{/items}}'
              ),

    render: function() {
      this.$el.html(this.template({
        items: this.collection.toJSON()
      }));

      return this;
    }
  });</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec56"/>Using partials</h3></div></div></div><p>As in Underscore <a class="indexterm" id="id504"/>templates, Mustache.js allows partials to be used. To call a partial template, use the <code class="literal">&gt;</code> syntax.</p><div><pre class="programlisting">{{#items}}
  &lt;li&gt;{{&gt; item }}&lt;/li&gt;
{{/items}}</pre></div><p>The partial template will look like this:</p><div><pre class="programlisting">  Description: {{description}}
  Price: {{price}}.
  Quantity: {{quantity}}.</pre></div><p>You can pass the partial template in several ways, as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An object of partials, which are strings as well, may be passed as the third argument to <code class="literal">Mustache.render()</code>. The object should be keyed by the name of the partial, and its value should be the partial text.<div><pre class="programlisting">Mustache.render(
  this.template,
  { items: this.collection.toJSON() },
  { item: this.itemTemplate }
);</pre></div></li><li class="listitem" style="list-style-type: disc">Template partials can also be compiled using the <code class="literal">Mustache.compilePartial()</code> function<a class="indexterm" id="id505"/>. The first parameter of this function is the name of the partial as it is named within a parent template. The second parameter is a partial template string.<div><pre class="programlisting">Mustache.compilePartial(
  'item', 
  'Description: {{description}}. Price: {{price}}.\
   Quantity: {{quantity}}.'
);</pre></div></li></ul></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec175"/>See also</h2></div></div></div><p>To learn more about the Mustche.js syntax<a class="indexterm" id="id506"/>, you can visit its official GitHub page at <a class="ulink" href="https://github.com/janl/mustache.js">https://github.com/janl/mustache.js</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Defining a form</h1></div></div></div><p>Almost any <a class="indexterm" id="id507"/>web application requires an HTML form for user input. In the previous chapters, we learned how to render a form manually and bind it to the view model.</p><p>However, we should look for backbone-forms extensions, which allow us to deal with forms more easily by writing less code. In this recipe and in further recipes, we are going to learn how to use this extension.</p><p>Let's create a simple form for <code class="literal">BuyerModel</code>, which will look like the following screenshot:</p><div><img alt="Defining a form" src="img/2728OS_06_02.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec176"/>Getting ready</h2></div></div></div><p>To include <a class="indexterm" id="id508"/>backbone-forms into your project, download the entire extension archive from the GitHub page (<a class="ulink" href="https://github.com/powmedia/backbone-forms">https://github.com/powmedia/backbone-forms</a>), and extract it into the <code class="literal">lib/backbone-forms</code> directory. Then include a reference to the extension files into <code class="literal">index.html</code>.</p><div><pre class="programlisting">&lt;link href="lib/backbone-forms/distribution/templates/default.css" rel="stylesheet" /&gt;

&lt;script src="img/backbone-forms.min.js"&gt;&lt;/script&gt;</pre></div><p>Including the Backbone extension into your project is described in detail in the <em>Extending an application with plugins</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec177"/>How to do it...</h2></div></div></div><p>Follow these steps to define a form:</p><div><ol class="orderedlist arabic"><li class="listitem">Define a form schema definition inside the model object.<div><pre class="programlisting">var BuyerModel = Backbone.Model.extend({
  schema: {
    title:   { type: 'Select', options: ['Mr', 'Mrs', 'Ms'] },
    name:    'Text',
    email:   { validators: ['required', 'email'] },
    birthday:'Date',
  }
});</pre></div></li><li class="listitem">Create a view which should render a form with the help of the <code class="literal">Backbone.Form</code> object.<div><pre class="programlisting">  var BuyerFormView = Backbone.View.extend({
    render: function() {
      this.form = new Backbone.Form({ model: this.model });

      this.$el.html('&lt;h3&gt;Enter buyer details below&lt;/h3&gt;');
      this.$el.append(this.form.render().el);
      this.$el.append('&lt;button&gt;Submit&lt;/button&gt;');

      return this;
    },
  });</pre></div></li><li class="listitem">Add a <code class="literal">submit</code> callback to the view. In this, the callback form is validated, and its values are passed to a <a class="indexterm" id="id509"/>model through the <code class="literal">commit()</code> method of the form.<div><pre class="programlisting">    events: {
      'click button': 'submit'
    },

    submit: function() {
      this.form.commit();

      console.log(this.model.toJSON());
      // Object { title: "Mr", name: "John Doe",
      // email: "john.doe@example.com",
      // birthday: Thu Mar 20 1986 00:00:00 GMT+0200 (EET) }
    }</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec178"/>How it works...</h2></div></div></div><p>The <code class="literal">Backbone.Form</code> object extends <code class="literal">Backbone.Views</code> by overriding the <code class="literal">render()</code> method, where it builds a form based on the schema definition we pass along with the model. If the model has initial values, then those values will be assigned to the form elements.</p><p>By executing the <code class="literal">commit()</code> method<a class="indexterm" id="id510"/>, form validation is performed and form values are assigned to the model properties. If the <code class="literal">{validate: true}</code> option is passed to this method, then both form validation and model validation are performed.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec179"/>There's more...</h2></div></div></div><p>This section describes how to build a form without a model.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec57"/>Using a form without a model</h3></div></div></div><p>We can create a<a class="indexterm" id="id511"/> form without tying a schema definition to a model. The following example shows how to do it:</p><div><pre class="programlisting">var form = new Backbone.Form({
  data: {
    title: 'Mr',
    name: 'John Doe',
    email: 'john.doe@example.com',
    birthday: '1986-03-20'
  },

  schema: {
    title:   { type: 'Select', options: ['Mr', 'Mrs', 'Ms'] },
    name:    'Text',
    email:   { validators: ['required', 'email'] },
    birthday:'Date',
  }
}).render();</pre></div><p>To get form values, use the <code class="literal">getValue()</code> method.</p><div><pre class="programlisting">var this.data = this.getValue();</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec180"/>See also</h2></div></div></div><p>To learn more about schema definition<a class="indexterm" id="id512"/>, you can check their official docs at <a class="ulink" href="https://github.com/powmedia/backbone-forms#schema-definition">https://github.com/powmedia/backbone-forms#schema-definition</a>. In the later recipes, we will continue learning backbone-forms extension.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Adding validation to a form</h1></div></div></div><p>In this recipe, we<a class="indexterm" id="id513"/> will continue to learn backbone-forms extension, and we <a class="indexterm" id="id514"/>will talk about form validation, which is quite a useful functionality and required by almost any web application which leverages backbone-forms extensions.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec181"/>How to do it...</h2></div></div></div><p>Follow these steps to add validation to a form:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure you have model schema defined.<div><pre class="programlisting">  var BuyerModel = Backbone.Model.extend({
    schema: {
      email: 'Text',
    }
  });</pre></div></li><li class="listitem">Add validators.<div><pre class="programlisting">  var BuyerModel = Backbone.Model.extend({
    schema: {
      email: {
        type: 'Text',
        validators: ['required', 'email']
      }
    }
  });</pre></div></li><li class="listitem">Set a validation message.<div><pre class="programlisting">  var BuyerModel = Backbone.Model.extend({
    schema: {
      email: {
        type: 'Text',
        validators: [
          {
            type: 'required',
            message: 'Email field is required'
          },
          'email'
        ],
      }
    }
  });</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec182"/>How it works...</h2></div></div></div><p>To enable validation,<a class="indexterm" id="id515"/> we need to pass the <code class="literal">validators</code> array to a schema field definition. A validator can be a string, an object, a regexp (regular expression), or a function.</p><p>A string is used to set <a class="indexterm" id="id516"/>built-in validators, which do not require additional parameters. These validators are <code class="literal">required</code>, <code class="literal">email</code>, and <code class="literal">url</code>. If a validator requires an additional parameter (for example, <code class="literal">match</code> and <code class="literal">regexp</code>), or if we want to override an error message, we need to use an object to define a validator.</p><div><pre class="programlisting">password: {
  validators: [ {
    type: 'match',
    field: 'passwordConfirm', 
    message: 'Passwords must match!'
  }]
}</pre></div><p>To perform a custom validator, we need to pass a validation function with two parameters: <code class="literal">value</code>, which is a form element value, and <code class="literal">formValues</code>, which is a hash of all form values.</p><div><pre class="programlisting">//Custom function 
username: { validators: [ 
  function checkUsername(value, formValues) { 
    var err = { 
      type: 'username', 
      message: 'Usernames must be at least 3 characters long' 
    }; 

    if (value.length &lt; 3) return err; 
  } 
] }</pre></div><p>Validation is performed when the <code class="literal">form.validate()</code> or <code class="literal">form.commit()</code> method is called.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec183"/>There's more...</h2></div></div></div><p>This section describes more about form validation.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec58"/>Customizing error messages</h3></div></div></div><p>It can be useful<a class="indexterm" id="id517"/> to override an error message for all built-in validators of a specific type at once. It is quite easy to do this by overriding values in <code class="literal">Backbone.Form.validators.errMessages</code> (the configuration object). We can use Mustache tags. Here is how it is done:</p><div><pre class="programlisting">Backbone.Form.validators.errMessages.required =
  'Please enter a value for this field.';

Backbone.Form.validators.errMessages.match =
  'This value must match the value of {{field}}';

Backbone.Form.validators.errMessages.email =
  '{{value}} is an invalid email address.';</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec59"/>Performing a model validation</h3></div></div></div><p>If you want to <a class="indexterm" id="id518"/>perform a model validation when committing or validating a form, you need to make sure that the model's <code class="literal">validate()</code> method returns an object of error messages keyed by the field names.</p><div><pre class="programlisting">    validate: function(attrs) {
      var errs = {};

      if (this.usernameTaken(attrs.username)) {
        errs.username = 'The username is taken'
      }

      if (!_.isEmpty(errs)) return errs;
    },</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec184"/>See also</h2></div></div></div><p>To learn more about form validation, you can refer to the docs at <a class="ulink" href="https://github.com/powmedia/backbone-forms#validation">https://github.com/powmedia/backbone-forms#validation</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Handling form events</h1></div></div></div><p>The <code class="literal">Backbone.Form</code> extension <a class="indexterm" id="id519"/>provides several events that we can use in our application. For example, by leveraging such events, we can implement specific functionalities where the value of one field depends on the value of another field.</p><p>In this recipe, we are going to create a form for the <code class="literal">InvoiceModel</code> model, where the <strong>Paid Date</strong> field will be shown only if the <strong>Paid</strong> option is selected as the <strong>Status</strong> field value. Our form will look like the following screenshot:</p><div><img alt="Handling form events" src="img/2728OS_06_03.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec185"/>How to do it...</h2></div></div></div><p>Follow these steps to<a class="indexterm" id="id520"/>handle form events:</p><div><ol class="orderedlist arabic"><li class="listitem">Define the model and the form schema.<div><pre class="programlisting">  var InvoiceModel = Backbone.Model.extend({
    schema: {
      referenceNumber: { type: 'Text'},

      date: { type: 'Date'},

      status: {
        type: 'Select',
        options: [
          { val: 'draft', label: 'Draft' },
          { val: 'issued', label: 'Issued' },
          { val: 'paid', label: 'Paid' },
          { val: 'canceled', label: 'Canceled' }
        ]
      }

      paidDate: { type: 'Date' },
    }
  });</pre></div></li><li class="listitem">Create <code class="literal">InvoiceForm</code> based on <code class="literal">Backbone.Form</code>.<div><pre class="programlisting">  var InvoiceForm = Backbone.Form.extend({

  }</pre></div></li><li class="listitem">Override <a class="indexterm" id="id521"/>parent's <code class="literal">initialize()</code> method<a class="indexterm" id="id522"/> to bind the <code class="literal">status</code> field's <code class="literal">change</code> event to the callback, which will update dependent fields.<div><pre class="programlisting">    initialize: function() {

      // Call parent method.
      InvoiceForm.__super__.initialize.apply(this, arguments);

      // Bind change status change event to the
      // update callback.
      this.on('status:change', this.update);
    }</pre></div></li><li class="listitem">Implement the <code class="literal">update</code> method for the form, which will update dependent fields.<div><pre class="programlisting">    update: function(form, editor) {
      if (form.fields.status.editor.getValue() == 'paid') {
        form.fields.paidDate.$el.show();
      }
      else {
        form.fields.paidDate.$el.hide();  
      }
    }</pre></div></li><li class="listitem">Override the <code class="literal">render</code> method of the form, where we need to run the <code class="literal">update</code> method to ensure dependent fields are shown properly.<div><pre class="programlisting">    render: function() {

      // Call parent method. 
      InvoiceForm.__super__.render.apply(this, arguments);
      // Esnure dependent are shown properly.
      this.update(this);

      return this;
    }</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec186"/>How it works...</h2></div></div></div><p><code class="literal">Backbone.Form</code> provides<a class="indexterm" id="id523"/> several form events, which we can bind to our callbacks using the <code class="literal">on()</code> method<a class="indexterm" id="id524"/>. They are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">change</code>: This event is triggered whenever something happens that affects the result of <code class="literal">form.getValue()</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">focus</code>: This event is triggered whenever this form gains focus, that is, when the input of an editor within this form becomes <code class="literal">document.activeElement</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">blur</code>: This event is triggered whenever this form loses focus, that is, when the input of an editor within this form stops being <code class="literal">document.activeElement</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;key&gt;:&lt;event&gt;</code>: the <code class="literal">change</code>, <code class="literal">focus</code>, or <code class="literal">blur</code> event is triggered for the form element specified by <code class="literal">key</code>.</li></ul></div><p><code class="literal">Backbone.Form</code> extends <code class="literal">Backbone.Views</code> and implements <code class="literal">initialize()</code> and <code class="literal">render()</code> methods. In our child object, we need to use these methods, and so we need to make sure parent methods are executed, which is possible because of JavaScript's <code class="literal">__super__</code> keyword. Then, apply the method.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec187"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Handling events of Backbone objects</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Events and Bindings">Chapter 5</a>, <em>Events and Bindings</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Customizing a form with the Bootstrap framework</h1></div></div></div><p>Default <a class="indexterm" id="id525"/>backbone-form's styles look pretty boring, and we may<a class="indexterm" id="id526"/> want to replace them with something cool like Bootstrap. In this case, our form will look much better, as shown in the following screenshot:</p><div><img alt="Customizing a form with the Bootstrap framework" src="img/2728OS_06_04.jpg"/></div><p>Here we<a class="indexterm" id="id527"/> also use a List element (aka editor) to allow the user to input invoice item details. When <a class="indexterm" id="id528"/>user clicks on the <strong>Add</strong> button, the following popup is generated and shown to the user:</p><div><img alt="Customizing a form with the Bootstrap framework" src="img/2728OS_06_05.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec188"/>Getting ready</h2></div></div></div><p>Follow<a class="indexterm" id="id529"/> these <a class="indexterm" id="id530"/>steps to be prepared to use Bootstrap.js:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the <a class="indexterm" id="id531"/>Bootstrap framework archive from its GitHub page at <a class="ulink" href="http://twitter.github.com/bootstrap">http://twitter.github.com/bootstrap</a>, and extract it into the <code class="literal">lib</code> folder of the application.</li><li class="listitem">Remove the <code class="literal">default.css</code> style's reference from <code class="literal">index.html</code>.</li><li class="listitem">Include links to the Bootstrap files into <code class="literal">index.html</code>.<div><pre class="programlisting">&lt;link rel="stylesheet" href="lib/bootstrap/css/bootstrap.css" /&gt;

&lt;script src="img/bootstrap.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Include links to the <code class="literal">Backbone.Forms</code> extension, List editor, Bootstrap modal adapter, Bootstrap templates, and styles.<div><pre class="programlisting">&lt;script src="img/backbone-forms.js"&gt;
&lt;/script&gt;
  
&lt;script src="img/list.js"&gt;
&lt;/script&gt;

&lt;script src="img/backbone.bootstrap-modal.js"&gt;
&lt;/script&gt;

&lt;script src="img/bootstrap.js"&gt;
&lt;/script&gt;

&lt;link rel="stylesheet" href="lib/backbone-forms/distribution/templates/bootstrap.css" /&gt;</pre></div></li></ol></div><p>Including Backbone<a class="indexterm" id="id532"/> extension into your project is described in detail in the <em>Extending an application with plugins</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec189"/>How to do it...</h2></div></div></div><p>Follow these steps to customize a form with the Bootstrap framework:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following line of code into <code class="literal">main.js</code> in order to set default modal adapter:<div><pre class="programlisting">Backbone.Form.editors.List.Modal.ModalAdapter = Backbone.BootstrapModal;</pre></div></li><li class="listitem">Add invoice items field definitions into the Backbone schema.<div><pre class="programlisting">      items:    {
        type: 'List', itemType: 'Object', subSchema: {
          description: { validators: ['required'] },
          price: 'Number',
          quantity: 'Number',          
        }
      }</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec190"/>How it works...</h2></div></div></div><p>We included files which override default backbone-forms templates and styles in order to achieve integration with the Bootstrap framework. Also, we used List element, which makes a special call to the Bootstrap modal adapter to show a nice modal popup.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec191"/>There's more...</h2></div></div></div><p>This section describes how to override form templates.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec60"/>Overriding form templates</h3></div></div></div><p>In the <a class="indexterm" id="id533"/>previous example, we included <code class="literal">lib/backbone-forms/distribution/templates/bootstrap.js</code> into our project to make sure proper templates are used in order to provide integration with the Bootstrap engine. In this file, the <code class="literal">setTemplates()</code> method<a class="indexterm" id="id534"/> of the <code class="literal">Backbone.Form</code> object is called to override default templates.</p><div><pre class="programlisting">  var Form = Backbone.Form;
   
  Form.setTemplates({
    form:
      '&lt;form class="form-horizontal"&gt;{{fieldsets}}&lt;/form&gt;',

    // ...
    field:
      '&lt;div class="control-group field-{{key}}"&gt;' +
      '  &lt;label class="control-label" for="{{id}}"&gt;' +
      '    {{title}}' +
      '  &lt;/label&gt;' +
      '  &lt;div class="controls"&gt;' +
      '    {{editor}}' +
      '    &lt;div class="help-inline"&gt;{{error}}&lt;/div&gt;' +
      '    &lt;div class="help-block"&gt;{{help}}&lt;/div&gt;' +
      '  &lt;/div&gt;' +
      '&lt;/div&gt;',
  }, {
    error: 'error'
    // Set error class on the field tag when validation fails
  });</pre></div><p>Mustache syntax is used for template definition, and the templates that can be overridden are: <code class="literal">form</code>, <code class="literal">fieldset</code>, <code class="literal">field</code>, <code class="literal">nestedField</code>, <code class="literal">list</code>, <code class="literal">listItem</code>, <code class="literal">date</code>, <code class="literal">dateTime</code>, and <code class="literal">'list.Modal'</code>.</p><p>To use a specific template that is different from the one defined for the form element, add a template, and pass its name in the template parameter in the schema definition.</p><div><pre class="programlisting">title: { type: 'Select', options: ['Mr', 'Mrs', 'Ms'], template: 'customField'}</pre></div><p>To use a specific template for the form, pass its name when creating a new form.</p><div><pre class="programlisting">this.form = new Backbone.Form({
  model: this.model, template: 'customForm'
});</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec192"/>See also</h2></div></div></div><p>You can check the official Bootstrap.js docs to learn more about it at <a class="ulink" href="http://twitter.github.com/bootstrap">http://twitter.github.com/bootstrap</a>. Also, look at the <code class="literal">lib/backbone-forms/distribution/templates/default.js</code> file to find out all the available templates which can be overridden.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec68"/>Assembling layouts with LayoutManager</h1></div></div></div><p><strong>Backbone.LayoutManager</strong> is<a class="indexterm" id="id535"/> one of the most useful extensions for Backbone.js. It<a class="indexterm" id="id536"/> allows to build a layout out of panes easily and to get rid of many lines of code compared to using just Backbone views. LayoutManager also provides mechanisms to load templates from the main HTML file or external files.</p><p>Let's build an application <a class="indexterm" id="id537"/>which will have two panes. On the first pane, the user will see a list of invoices, and on the other pane he'll see invoice details.</p><div><img alt="Assembling layouts with LayoutManager" src="img/2728OS_06_06.jpg"/></div><p>By clicking on the invoice number from the first pane, our application will update the second pane immediately.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec193"/>Getting ready</h2></div></div></div><p>You can download <a class="indexterm" id="id538"/>Backbone.LayoutManager from its GitHub page at <a class="ulink" href="https://github.com/tbranyen/backbone.layoutmanager">https://github.com/tbranyen/backbone.layoutmanager</a>. To include LayoutManager into <a class="indexterm" id="id539"/>your project, save the <code class="literal">backbone.layoutmanager.js</code> file into the <code class="literal">lib</code> folder and include a reference to it in <code class="literal">index.html</code>.</p><p>Including Backbone extension into your project is described in detail in the <em>Extending an application with plugins</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec194"/>How to do it...</h2></div></div></div><p>Follow these steps to assemble layouts:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure you have model and collection objects defined.<div><pre class="programlisting">  var InvoiceModel = Backbone.Model.extend({

  });

  var InvoiceCollection = Backbone.Collection.extend({
    model: InvoiceModel
  });</pre></div></li><li class="listitem">Define the invoice list pane.<div><pre class="programlisting">  var InvoiceListPane = Backbone.Layout.extend({

    // Returns selector for template.
    template: "#invoice-list-pane",

    // Set selector for template.
    serialize: function() {
      return {
        // Wrap the collection.
        invoices: _.chain(this.collection.models)
      };
    }
  });</pre></div></li><li class="listitem">Define the invoice pane.<div><pre class="programlisting">  var InvoicePane = Backbone.Layout.extend({

    // Set selector for template.
    template: "#invoice-pane",

    // Returns data for template.
    serialize: function() {
      return {
        invoice: this.model
      };
    }
  });</pre></div></li><li class="listitem">Define a <a class="indexterm" id="id540"/>router with routes and create the collection instance in its <code class="literal">initialize()</code> method.<div><pre class="programlisting">  var Workspace = Backbone.Router.extend({
    routes: {
      '': 'page',
      'invoice/:id': 'page',
    },

    // Initialize function run when Router object instance// is created.
    initialize: function() {
      //  Create collection
      this.collection = new InvoiceCollection([
        {
          referenceNumber: 'AB 12345',
          date: new Date().toISOString(),
          status: 'draft'
        },
        {
          referenceNumber: 'ZX 98765',
          date: new Date().toISOString(),
          status: 'issued'
        },
      ]);
    },

  });</pre></div></li><li class="listitem">Add a page callback to the router, which creates a <code class="literal">Backbone.Layout</code> object and renders it.<div><pre class="programlisting">    page: function(id) {
      if (!id) {
        // Set default id.
        id = this.collection.at(0).cid;
      }

      
      var layout = new Backbone.Layout({
        // Attach the layout to the main container.
        el: "body",

        // Set template selector.
        template: "#layout",

        // Declaratively bind a nested View to the layout.
        views: {
          "#invoice-list-pane": new InvoiceListPane({
            collection: this.collection
          }),
          "#invoice-pane": new InvoicePane({
            model: this.collection.get(id)
          }),
        }
      });
      
      // Render the layout.
      layout.render();
    },</pre></div></li><li class="listitem">Add templates<a class="indexterm" id="id541"/> to the <code class="literal">&lt;head&gt;</code> tag of the page element.<div><pre class="programlisting">  &lt;script class="template" type="template" id="layout"&gt;
    &lt;h1&gt;Invoice application&lt;/h1&gt;
    &lt;div id="invoice-list-pane"&gt;&lt;/div&gt;
    &lt;div id="invoice-pane"&gt;&lt;/div&gt;
  &lt;/script&gt;

  &lt;script class="template"
      type="template"id="invoice-list-pane"&gt;
    &lt;h3&gt;Invoices:&lt;/h3&gt;
    &lt;ul&gt;
      &lt;% invoices.each(function(invoice) { %&gt;
        &lt;li&gt;
          &lt;a href="#invoice/&lt;%= invoice.cid %&gt;"&gt;
            &lt;%= invoice.get('referenceNumber') %&gt;
          &lt;/a&gt;
        &lt;/li&gt;
      &lt;% }); %&gt;
    &lt;/ul&gt;
  &lt;/script&gt;

  &lt;script class="template" type="template" id="invoice-pane"&gt;
    &lt;h3&gt;Invoice details:&lt;/h3&gt;
    Reference Number:
      &lt;%= invoice.get('referenceNumber') %&gt;&lt;br&gt;
    Date: &lt;%= invoice.get('date') %&gt;&lt;br&gt;
    Status: &lt;%= invoice.get('status') %&gt;&lt;br&gt;
  &lt;/script&gt;</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec195"/>How it works...</h2></div></div></div><p>The <code class="literal">Backbone.LayoutManager</code> object<a class="indexterm" id="id542"/> implements the template loader, the <code class="literal">render()</code> method, and provides many other cool features, which is typically done by the developer. In the views option, we can select which layout pane or Backbone view should be attached to the HTML elements that is specified in the main template for the layout.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec196"/>See also</h2></div></div></div><p>Please refer to the LayoutManager docs to learn more about the extension at <a class="ulink" href="https://github.com/tbranyen/backbone.layoutmanager/wiki">https://github.com/tbranyen/backbone.layoutmanager/wiki</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec69"/>Building a semantic and an easily styleable data grid</h1></div></div></div><p>In your application, you may want to output the data as a sortable, filterable, and editable grid, which is not an easy task to do<a class="indexterm" id="id543"/> from scratch. In this recipe, we will learn a quick solution for that task using Backgrid.js, a powerful extension for building data grids in Backbone applications.</p><p>In this application, we are going to create a simple grid using the Backgrid example<a class="indexterm" id="id544"/>. It will look like the following screenshot:</p><div><img alt="Building a semantic and an easily styleable data grid" src="img/2728OS_06_07.jpg"/></div><p>When a user clicks <a class="indexterm" id="id545"/>on the column header, the grid is sorted by this column.</p><div><img alt="Building a semantic and an easily styleable data grid" src="img/2728OS_06_17.jpg"/></div><p>If a user double-clicks on a specific cell, that cell is replaced by an input element, where a user can enter a new value.</p><div><img alt="Building a semantic and an easily styleable data grid" src="img/2728OS_06_19.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec197"/>Getting ready</h2></div></div></div><p>Follow these<a class="indexterm" id="id546"/> steps to be prepared to use Backgrid extension:</p><div><ol class="orderedlist arabic"><li class="listitem">Download Backgrid.js extension from its official web site at <a class="ulink" href="http://backgridjs.com/">http://backgridjs.com/</a>.</li><li class="listitem">Include Backgrid.js into your project by extracting this extension into the <code class="literal">lib/backgrid</code> folder.</li><li class="listitem">Include references to the extension files into <code class="literal">index.html</code>.<div><pre class="programlisting">&lt;link rel="stylesheet" href="lib/backgrid/lib/backgrid.css" /&gt;
&lt;script src="img/backgrid.js"&gt;&lt;/script&gt;</pre></div></li></ol></div><p>Including Backbone extension into your project is described in detail in the <em>Extending an application with plugins</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Understanding Backbone">Chapter 1</a>, <em>Understanding Backbone</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec198"/>How to do it...</h2></div></div></div><p>Follow these steps to build a grid:</p><div><ol class="orderedlist arabic"><li class="listitem">Make sure you have a model and collection objects defined.<div><pre class="programlisting">  var InvoiceModel = Backbone.Model.extend({

  });

  var InvoiceCollection = Backbone.Collection.extend({
    model: InvoiceModel
  });</pre></div></li><li class="listitem">Create a collection instance.<div><pre class="programlisting">    var invoiceCollection = new InvoiceCollection();</pre></div></li><li class="listitem">Define grid <a class="indexterm" id="id547"/>column settings.<div><pre class="programlisting">    var columns = [
      {
        name: "referenceNumber",
        label: "Ref #",
        editable: false,
        cell: 'string'
      },
      {
        name: "date",
        label: "Date",
        cell: "date"
      },
      {
        name: "status",
        label: "Status",
        cell: Backgrid.SelectCell.extend({
          optionValues: [
            ['Draft', 'draft'],
            ['Issued', 'issued']
          ]
        })
      }
    ];</pre></div></li><li class="listitem">Initialize a new grid instance.<div><pre class="programlisting">    var grid = new Backgrid.Grid({
      columns: columns,
      collection: invoiceCollection
    });

    $('body').append(grid.render().$el);

    invoiceCollection.add([
      {
        referenceNumber: 'AB 12345',
        date: new Date().toISOString(),
        status: 'draft'
      },
      {
        referenceNumber: 'ZX 98765',
        date: new Date().toISOString(),
        status: 'issued'
      },
    ]);</pre></div></li><li class="listitem">Add models <a class="indexterm" id="id548"/>into the collection.<div><pre class="programlisting">    invoiceCollection.add([
      {
        referenceNumber: 'AB 12345',
        date: new Date().toISOString(),
        status: 'draft'
      },
      {
        referenceNumber: 'ZX 98765',
        date: new Date().toISOString(),
        status: 'issued'
      },
    ]);</pre></div></li><li class="listitem">Start the application.<div><pre class="programlisting">  Backbone.history.start();</pre></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec70"/>How it works...</h1></div></div></div><p><code class="literal">Backgrid.Grid</code><a class="indexterm" id="id549"/> extends <code class="literal">Backbone.View</code><a class="indexterm" id="id550"/> so you can create its instance and pass column settings keyed by the <code class="literal">columns</code> parameter. Column settings are defined as an array, and each row has the following properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: It's the name of the model property.</li><li class="listitem" style="list-style-type: disc"><code class="literal">label</code>: It's the label of the heading column.</li><li class="listitem" style="list-style-type: disc"><code class="literal">sortable</code>: It returns a boolean value to check whether a column is sortable.</li><li class="listitem" style="list-style-type: disc"><code class="literal">editable</code>: It returns a boolean value to check whether a column is editable.</li><li class="listitem" style="list-style-type: disc"><code class="literal">cell</code>: It's the cell type, which could be one of these: <code class="literal">datetime</code>, <code class="literal">date</code>, <code class="literal">time</code>, <code class="literal">number</code>, <code class="literal">integer</code>, <code class="literal">string</code>, <code class="literal">uri</code>, <code class="literal">email</code>, <code class="literal">boolean</code>, and <code class="literal">select</code>.</li></ul></div><p>If you need to specify additional parameters for a cell type, you can extend the corresponding class and pass it to the <code class="literal">cell</code> property.</p><div><pre class="programlisting">Backgrid.SelectCell.extend({
  optionValues: [
    ['Draft', 'draft'],
    ['Issued', 'issued']
  ]
})</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec199"/>There's more...</h2></div></div></div><p>In this section, we are going to use several extensions for Backgrid, which can add extra features to our grid.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec61"/>Performing bulk operations on grid models</h3></div></div></div><p>We are going to add an extra column <a class="indexterm" id="id551"/>to our grid, which will contain checkboxes allowing users to select specific models in a grid and to perform bulk operations on them, for example, deleting. The following screenshot shows what our table will look like:</p><div><img alt="Performing bulk operations on grid models" src="img/2728OS_06_20.jpg"/></div><p>To complete this task, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Include the SelectAll extension files into <code class="literal">index.html</code>.<div><pre class="programlisting">&lt;link rel="stylesheet" href="lib/backgrid/lib/extensions/select-all/backgrid-select-all.css" /&gt;

&lt;script src="img/backgrid-select-all.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Wrap grid into <code class="literal">TableView</code>.<div><pre class="programlisting">  var TableView = Backbone.View.extend({
    initialize: function(columns, collection) {
      this.collection = collection;

      this.grid = new Backgrid.Grid({
        columns: columns,
        collection: this.collection
      });
    },

    render: function() {
      this.$el.html(this.grid.render().$el);

      return this;
    },
  });</pre></div></li><li class="listitem">Add the <a class="indexterm" id="id552"/>checkbox's column in the <code class="literal">initalize()</code> method.<div><pre class="programlisting">    initialize: function(columns, collection) {
      this.collection = collection;

      columns = [{
        name: "",
        cell: "select-row",
        headerCell: "select-all",
      }].concat(columns)

      this.grid = new Backgrid.Grid({
        columns: columns,
        collection: this.collection
      });
    },</pre></div></li><li class="listitem">Append the delete button in the <code class="literal">render()</code> method.<div><pre class="programlisting">    render: function() {
      this.$el.html(this.grid.render().$el);

      this.$el.append('&lt;button class="delete"&gt;Delete&lt;/button&gt;');

      return this;
    },</pre></div></li><li class="listitem">Handle the button click event.<div><pre class="programlisting">    events: {
      'click button.delete': 'delete'
    },

    delete: function() {
      _.each(this.grid.getSelectedModels(), function (model) {
        model.destroy();
      });
    }</pre></div></li><li class="listitem">Create a new <code class="literal">TableView</code> instance and append it into the <code class="literal">body</code> element.<div><pre class="programlisting">$('body').append(new TableView(columns, invoiceCollection).render().$el);</pre></div></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec62"/>Performing records filtering</h3></div></div></div><p>To allow users to filter<a class="indexterm" id="id553"/> records, we are going to use the Select extension and the Lunr.js library, which is shipped with the Backgrid package. Also, we will apply Bootstrap styles to make the search box look neat.</p><div><img alt="Performing records filtering" src="img/2728OS_06_11.jpg"/></div><p>Follow these steps to perform <a class="indexterm" id="id554"/>records filtering:</p><div><ol class="orderedlist arabic"><li class="listitem">Include Select extension, Lunr library, and Boostrap files into <code class="literal">index.html</code>.<div><pre class="programlisting">&lt;link rel="stylesheet" href="lib/backgrid/assets/css/bootstrap.css" /&gt;

&lt;link rel="stylesheet" href="lib/backgrid/lib/extensions/filter/backgrid-filter.css" /&gt;

&lt;script src="img/lunr.js"&gt;&lt;/script&gt;

&lt;script src="img/backgrid-filter.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Wrap grid into <code class="literal">TableView</code> as we did in the <em>Performing bulk operations on grid models</em> section.</li><li class="listitem">Initialize <code class="literal">ClientSideFilter</code> in the <code class="literal">TableView.initalize()</code> method.<div><pre class="programlisting">this.clientSideFilter =
      new Backgrid.Extension.ClientSideFilter({
        collection: collection,
        placeholder: "Search by Ref #",
        fields: ['referenceNumber'],
        wait: 150
      });</pre></div></li><li class="listitem">Prepend the table with <code class="literal">ClientSideFilter</code> in the <code class="literal">TableView.render()</code> method.<div><pre class="programlisting">      this.$el.prepend(this.clientSideFilter.render().$el);</pre></div></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec200"/>See also</h2></div></div></div><p>Backgrid extension<a class="indexterm" id="id555"/> is actually very vast to be fully considered in this recipe. So, you can check the official Backgrid documentation<a class="indexterm" id="id556"/> at <a class="ulink" href="http://backgridjs.com/">http://backgridjs.com/</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec71"/>Drawing on the HTML5 canvas</h1></div></div></div><p>Sometimes, we may<a class="indexterm" id="id557"/> want to render our view on the HTML5 canvas element, which can give more freedom and flexibility. The canvas can be used for rendering graphs as well as for creating an online game.</p><p>In this example, we are going to visualize the collection of models on the HTML5 canvas. The output of our code will look like the following screenshot:</p><div><img alt="Drawing on the HTML5 canvas" src="img/2728OS_06_12.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec201"/>Getting ready</h2></div></div></div><p>In this recipe, we are <a class="indexterm" id="id558"/>going to take an example from the <em>Splitting a view into subviews</em> recipe in <a class="link" href="ch04.html" title="Chapter 4. Views">Chapter 4</a>, <em>Views</em>, to change <code class="literal">InvoiceItemView</code> and <code class="literal">InvoiceItemListView</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec202"/>How to do it...</h2></div></div></div><p>Follow these steps:</p><div><pre class="programlisting">
InvoiceItemView  var InvoiceItemView = Backbone.View.extend({
  
});</pre></div><div><ol class="orderedlist arabic"><li class="listitem">Set box boundaries in the <code class="literal">initialize()</code> method<a class="indexterm" id="id559"/> of <code class="literal">InvoiceItemView</code>.<div><pre class="programlisting">  initialize: function() {
    // Set box size
    this.w = 100;
    this.h = 75;

    // Set random position
    this.x = Math.random() * (this.options.canvasW - this.w);
    this.y = Math.random() * (this.options.canvasH - this.h);
  }</pre></div></li><li class="listitem">Draw a box and output model values on <code class="literal">ctx</code>, the canvas context, in the <code class="literal">render()</code> method of <code class="literal">InvoiceItemView</code>.<div><pre class="programlisting">    render: function() {

      // Get canvas context from parameters.
      ctx = this.options.ctx;

      // Draw transparent box
      ctx.fillStyle = '#FF9000';
      ctx.globalAlpha = 0.1;
      ctx.fillRect(this.x, this.y, this.w, this.h);

      // Stroke the box
      ctx.strokeStyle = '#FF9900';
      ctx.globalAlpha = 1;
      ctx.lineWidth = 2;
      ctx.strokeRect(this.x, this.y, this.w, this.h);

      // Output text in the box
      ctx.fillStyle = '#009966';
      ctx.font = 'bold 12px Arial';
      var textX = this.x + 4,
          textY = this.y + 4,
          textMaxW = this.w - 8,
          lineHeight = 12;

      ctx.fillText(
        this.model.get('description'),
        textX,textY + lineHeight, textMaxW
      );
      ctx.fillText(
        'Price: $' + this.model.get('price'),
        textX, textY + lineHeight*3,
        textMaxW
      );
      ctx.fillText(
        'Quantity: ' + this.model.get('quantity'),
         textX, textY + lineHeight*4, textMaxW
      );
      ctx.fillText(
        'Total: $' + this.model.calculateAmount(),
         textX, textY + lineHeight*5, textMaxW
      );

      return this;
    }</pre></div></li><li class="listitem">Define <code class="literal">InvoiceItemListView</code>, which <a class="indexterm" id="id560"/>creates an empty canvas and triggers model view rendering iteratively, passing <code class="literal">ctx</code> as an option.<div><pre class="programlisting">  var InvoiceItemListView = Backbone.View.extend({

    // Set a canvas as element tag name and define it's size.
    tagName: 'canvas',
    attributes: {
      width: 400,
      height: 200
    },

    // Render view.
    render: function() {

      // Get canvas context and it's size.
      var ctx = this.el.getContext("2d")
          canvasW = this.el.width,
          canvasH = this.el.height;
      // Clear canvas.
      ctx.clearRect(0, 0, canvasW, canvasH);

      // Iterate through models in collection and render them.
      this.collection.each(function(model) {
        new InvoiceItemView({
          model: model,

          // Pass canvas context and it's size.
          ctx: ctx,
          canvasW: canvasW,
          canvasH: canvasH
        }).render();
      }, this);

      return this;
    }
  });</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec203"/>How it works...</h2></div></div></div><p><code class="literal">InvoiceItemListView</code> defines <a class="indexterm" id="id561"/>canvas as a main view element and sets its boundaries. In the <code class="literal">render()</code> method, we get <code class="literal">ctx</code>, the context object of the canvas, by calling the <code class="literal">getContext()</code> method<a class="indexterm" id="id562"/>. Context object allows us to draw on the canvas by running special HTML5 methods.</p><p>By passing <code class="literal">ctx</code> and canvas dimensions to the subview as options, we allow them to be used for text and shapes output to the canvas.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec204"/>See also</h2></div></div></div><p>HTML 5 canvas reference <a class="indexterm" id="id563"/>could be found at <a class="ulink" href="http://www.w3schools.com/html/html5_canvas.asp">http://www.w3schools.com/html/html5_canvas.asp</a>.</p></div></div></body></html>