<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08" class="calibre1"/>Chapter 8. Logging, Debugging, and Testing</h1></div></div></div><p class="calibre8">In this chapter, we'll cover the following recipes:</p><div><ul class="itemizedlist"><li class="listitem">Using Ember.Logger</li><li class="listitem">Using Ember Inspector</li><li class="listitem">Verifying deprecations and using advanced features of Ember Inspector</li><li class="listitem">Using acceptance testing</li><li class="listitem">Using unit tests</li><li class="listitem">Testing components</li><li class="listitem">Testing routes</li><li class="listitem">Testing models</li><li class="listitem">Testing controllers</li></ul></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch08lvl1sec59" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre8">Testing is an important part of the Ember framework. Ember allows three different classifications of tests—<strong class="calibre9">acceptance</strong>, <strong class="calibre9">unit</strong>, and <strong class="calibre9">integration</strong>.</p><p class="calibre8">Acceptance <a id="id386" class="calibre1"/>tests are used to test the application flow and interaction. It <a id="id387" class="calibre1"/>mimics the same actions that a user might have. For <a id="id388" class="calibre1"/>example, this could include filling out forms or navigating to different parts of an application.</p><p class="calibre8">Unit tests are <a id="id389" class="calibre1"/>used to test smaller chunks of functionality. This <a id="id390" class="calibre1"/>might include testing computed properties or checking fields for different element tags.</p><p class="calibre8">Integration tests <a id="id391" class="calibre1"/>are somewhere in between unit and acceptance tests. It's recommended to use them with component testing. For example, integration tests work <a id="id392" class="calibre1"/>well with testing UI and controls.</p><p class="calibre8">Creating test cases for your applications is a good practice, especially if this application will be used in production.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec60" class="calibre1"/>Using Ember.Logger</h1></div></div></div><p class="calibre8"><strong class="calibre9">Ember.Logger</strong> is a robust type of logging in Ember. It goes beyond the capabilities of <code class="email">imports.console</code>. In this recipe, we'll take a look at some examples on how to work with it in your <a id="id393" class="calibre1"/>application.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec110" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">In this project, we'll create a simple program that demonstrates how to use some of the <code class="email">Ember.logging</code> capabilities:</p><div><ol class="orderedlist"><li class="listitem" value="1">In a new program, add a new <code class="email">index</code> route:<div><pre class="programlisting">
<strong class="calibre9">$ ember g route index</strong>
</pre></div><p class="calibre14">This will create a new <code class="email">index</code> route.</p></li><li class="listitem" value="2">Edit the <code class="email">index.js</code> file in the <code class="email">routes</code> folder. Add some new logging:<div><pre class="programlisting">// app/routes/index.js
import Ember from 'ember';
const {Logger}= Ember;
export default Ember.Route.extend({
    model(){
      Logger.log('log');
      Logger.info('info', 'more stuff');
      Logger.error('error');
      Logger.debug('debug');
      Logger.warn('warn');
      Logger.assert(true === false);
      return {};
    }
});</pre></div><p class="calibre14"><code class="email">Ember.logging</code> gives us five different logging options. All these different types of <code class="email">log</code> methods accept one or more arguments. Each argument will be joined together and separated by a space when written to the browser console window:</p><div><pre class="programlisting">Logger.log('log');</pre></div></li><li class="listitem" value="3">This is the basic form of logging in Ember. It simply logs the values to the browser console:<div><pre class="programlisting">Logger.info('info', 'more stuff');</pre></div><p class="calibre14">The <code class="email">info</code> logger logs a message to the console as an <code class="email">info</code> message. In Firefox and Chrome, a small <strong class="calibre9">I</strong> icon is displayed next to the item:</p><div><pre class="programlisting">Logger.error('error');</pre></div><p class="calibre14">The <code class="email">error</code> log <a id="id394" class="calibre1"/>prints to the console with an <strong class="calibre9">error</strong> icon, red text, and stack trace.</p><div><pre class="programlisting">Logger.debug('debug');</pre></div><p class="calibre14">The <code class="email">debug</code> log prints to the console in blue text.</p><div><pre class="programlisting">Logger.warn('warn');</pre></div><p class="calibre14">The warning log will print to the console with a <strong class="calibre9">warning</strong> icon.</p><div><pre class="programlisting">Logger.assert(true === false);</pre></div><p class="calibre14">The <code class="email">assert</code> statement will return an error and stack trace if the value returns <code class="email">false</code>.</p></li><li class="listitem" value="4">Fire up the Ember server and open <strong class="calibre9">Console</strong>. This is a screenshot of how it looks in Chrome:<div><img src="img/00043.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec111" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">The Ember.Logger is a <a id="id395" class="calibre1"/>more powerful console logger. It's a robust logging tool to make debugging easier. Ember.Logger is built-in in the Ember CLI package.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec61" class="calibre1"/>Using Ember Inspector</h1></div></div></div><p class="calibre8">The Ember <a id="id396" class="calibre1"/>Inspector is an add-on for your browser that can help you debug your Ember app. In this recipe, we'll look at some examples on how to use it.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec112" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">Before beginning, you must install the add-on. It's available for Chrome, Firefox, or Opera. Other browsers such as Internet Explorer can also be used via <code class="email">bookmarklet</code>.</p><div><ol class="orderedlist"><li class="listitem" value="1">Install the browser add-on for Ember Inspector:<div><ul class="itemizedlist1"><li class="listitem">For <a id="id397" class="calibre1"/>Firefox, install the add-ons from the following website: <a class="calibre1" href="https://addons.mozilla.org/en-US/firefox/addon/ember-inspector/">https://addons.mozilla.org/en-US/firefox/addon/ember-inspector/</a></li><li class="listitem">On Chrome, install the add-on from the Chrome web store: <a class="calibre1" href="https://chrome.google.com/webstore/detail/ember-inspector/bmdblncegkenkacieihfhpjfppoconhi">https://chrome.google.com/webstore/detail/ember-inspector/bmdblncegkenkacieihfhpjfppoconhi</a></li><li class="listitem">All other <a id="id398" class="calibre1"/>browsers visit the Ember Inspector Github page for further instructions: <a class="calibre1" href="https://github.com/emberjs/ember-inspector">https://github.com/emberjs/ember-inspector</a></li></ul></div></li><li class="listitem" value="2">For the purposes of our recipe, we'll use Ember CLI Mirage to return a simple <code class="email">school</code> model. After creating a new project, run this command:<div><pre class="programlisting">
<strong class="calibre9">$ ember install ember-cli-mirage</strong>
<strong class="calibre9">$ ember g factory school</strong>
</pre></div><p class="calibre14">This will install all the necessary files so that we can mock an HTTP server.</p></li><li class="listitem" value="3">After the add-on for Ember CLI Mirage is installed, update the <code class="email">config.js</code> file in the <code class="email">mirage</code> folder:<div><pre class="programlisting">// app/mirage/config.js
export default function() {

    this.get('/schools');
}</pre></div><p class="calibre14">This will add an HTTP GET route that our Ember client will connect when retrieving the school information.</p></li><li class="listitem" value="4">Update the file for the school information in the <code class="email">mirage/factories/</code> folder called <code class="email">school.js</code>:<div><pre class="programlisting">// app/mirage/factories/school.js
import Mirage, {faker}  from 'ember-cli-mirage';

export default Mirage.Factory.extend({

    name:faker.name.firstName,       // using faker
    city: faker.address.city,
});</pre></div><p class="calibre14">This file will be used to generate fake names and city data for our fictitious school.</p></li><li class="listitem" value="5">Update the <code class="email">default.js</code> file:<div><pre class="programlisting">// app/mirage/scenarios/default.js
export default function( server ) {

    server.createList('school', 2);
}</pre></div><p class="calibre14">This will <a id="id399" class="calibre1"/>seed the data that we need from our factories for the application.</p></li><li class="listitem" value="6">Generate an <code class="email">index</code> <code class="email">route</code>, <code class="email">model</code>, and the REST <code class="email">adapter</code>:<div><pre class="programlisting">
<strong class="calibre9">$ ember g route index</strong>
<strong class="calibre9">$ ember g model school name:string city:string</strong>
<strong class="calibre9">$ ember g adapter application</strong>
</pre></div><p class="calibre14">These files will be used in our application, which we'll discuss in the next section.</p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec113" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">The purpose of this application is to return a list of schools. We'll be using the Ember Inspector to look at this data in more detail.</p><div><ol class="orderedlist"><li class="listitem" value="1">Open the <code class="email">application.js</code> file in the <code class="email">adapters</code> folder. Verify that the <code class="email">RESTAdapter</code> is set:<div><pre class="programlisting">// app/adapters/application.js
import DS from 'ember-data';

export default DS.RESTAdapter.extend({
});</pre></div><p class="calibre14">This tells Ember to use the REST adapter with Ember Data. Review <a class="calibre1" title="Chapter 7. Ember Models and Ember Data" href="part0059_split_000.html#1O8H61-d21a6ad8148a415181fa52c0043435bb">Chapter 7</a>, <em class="calibre13">Ember Models and Ember Data,</em> on Ember Data for a refresher.</p></li><li class="listitem" value="2">Edit the <code class="email">school.js</code> file in the <code class="email">models</code> folder:<div><pre class="programlisting">// app/models/school.js
import DS from 'ember-data';

export default DS.Model.extend({
    name: DS.attr('string'),
    city: DS.attr('string')
});</pre></div><p class="calibre14">This model has <a id="id400" class="calibre1"/>two properties, <code class="email">name</code> and <code class="email">city</code>.</p></li><li class="listitem" value="3">Update the <code class="email">index.hbs</code> file in the <code class="email">app/templates</code> folder:<div><pre class="programlisting">// app/templates/index.hbs
{{outlet}}

{{#each model as |schoolName|}}
    Name:{{schoolName.name}}&lt;br&gt;
    City:{{schoolName.city}}&lt;br&gt;
    &lt;br&gt;
{{/each}}</pre></div><p class="calibre14">The <code class="email">each</code> helper will iterate through every model returned and display the school information.</p></li><li class="listitem" value="4">Update the <code class="email">index.js</code> file in the <code class="email">app/routes</code> folder:<div><pre class="programlisting">// app/routes/index.js
import Ember from 'ember';

export default Ember.Route.extend({
    model() {
      return this.store.findAll('school');
    }
});</pre></div></li><li class="listitem" value="5">Run <code class="email">ember server</code> and you'll see a list of schools, as illustrated in the following image:<div><img src="img/00044.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="6">Let's open the <a id="id401" class="calibre1"/>Ember Inspector and see what it shows. In Chrome, you can access this by opening the console and clicking on the <strong class="calibre9">Ember</strong> tab:<p class="calibre14"> </p><div><img src="img/00045.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">The Ember Inspector shows <strong class="calibre9">View Tree</strong>, <strong class="calibre9">Routes</strong>, <strong class="calibre9">Data</strong>, <strong class="calibre9">Deprecations</strong>, and <strong class="calibre9">Info</strong>.</p></li><li class="listitem" value="7">Click on <strong class="calibre9">Info</strong> in the Ember Inspector:<div><img src="img/00046.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">Info displays all the library information loaded in this application. This can be really useful in finding out what version everything is using.</p></li><li class="listitem" value="8">Click on <strong class="calibre9">View </strong><a id="id402" class="calibre1"/><strong class="calibre9">Tree</strong> in the Ember Inspector:<div><img src="img/00047.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">The <strong class="calibre9">View Tree</strong> shows all sorts of information about the application. It shows the current routes, templates, models, and more. This can be helpful to figure out what's currently loaded on the screen.</p></li><li class="listitem" value="9">Click on <strong class="calibre9">Routes</strong> in the Ember Inspector:<div><img src="img/00048.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">The <strong class="calibre9">Routes</strong> show all the available routes, controllers, and templates. Some routes may not be defined but will be displayed, such as <strong class="calibre9">loading</strong>.</p></li><li class="listitem" value="10">Click on <strong class="calibre9">$E</strong> <a id="id403" class="calibre1"/>next to the <strong class="calibre9">index</strong> route:<div><img src="img/00049.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">In the Inspector, you can assign instance variables by clicking on <strong class="calibre9">$E</strong>.</p></li><li class="listitem" value="11">Open the console and add a new record using the instance variable, <strong class="calibre9">$E</strong>:<div><img src="img/00050.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="12">You can type the <a id="id404" class="calibre1"/>following in the console window in the browser:<div><pre class="programlisting">
<strong class="calibre9">$E.store.createRecord('school',{name: 'Test School', city: 'Reno'});</strong>
</pre></div><p class="calibre14">This will add a new record to your data store. The page will automatically update with this information. This is very valuable. You can use this anywhere to help troubleshoot issues.</p></li><li class="listitem" value="13">Click on <code class="email">Data</code> to see all the model data:<div><img src="img/00051.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">Optionally, you <a id="id405" class="calibre1"/>can click on any of this data and verify the attributes. You can make changes as well and it will automatically update to the screen.</p></li></ol><div></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec62" class="calibre1"/>Verifying deprecations and using advanced features of Ember Inspector</h1></div></div></div><p class="calibre8">In this <a id="id406" class="calibre1"/>recipe, we will explore deprecations using advanced <a id="id407" class="calibre1"/>features of Ember Inspector.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec114" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">Deprecation warnings will be displayed in deprecations. Check this to make sure that nothing in your application is deprecated. If deprecation is listed, it will have a link that you can click on to see what you need to do to fix it:</p><div><img src="img/00052.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre11"> </p></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec115" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">Ember Inspector was designed to make the creating and debugging of Ember applications easier. It was created as an add-on for most modern web browsers. It displays your current application information, routes, templates, data, and more.</p><p class="calibre8">It's an open <a id="id408" class="calibre1"/>source add-on and has an active developer community <a id="id409" class="calibre1"/>behind it. New features are being <a id="id410" class="calibre1"/>added all the time. To request your own, check out the Github page here: <a class="calibre1" href="https://github.com/emberjs/ember-inspector">https://github.com/emberjs/ember-inspector</a></p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec63" class="calibre1"/>Using acceptance testing</h1></div></div></div><p class="calibre8">Acceptance <a id="id411" class="calibre1"/>tests generally help test workflows and emulate user interactions. In this recipe, we'll look at creating a few simple acceptance tests.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec116" class="calibre1"/>How to do it...</h2></div></div></div><div><ol class="orderedlist"><li class="listitem" value="1">In a new application, create a new component called<code class="email"> book-shelf</code> and a new acceptance test called <code class="email">add-book-test.js</code>:<div><pre class="programlisting">
<strong class="calibre9">$ ember g component book-shelf</strong>
<strong class="calibre9">$ ember g acceptance-test add-book</strong>
</pre></div><p class="calibre14">This will create the code necessary for the <code class="email">book-shelf</code> component and the <code class="email">add-book</code> acceptance test. Keep in mind that an integration test will also be generated for the <code class="email">book-shelf</code> component. We will not be updating the integration test in this example.</p></li><li class="listitem" value="2">Update the component file with a new <code class="email">books</code> array and new action:<div><pre class="programlisting">// app/components/book-shelf.js
import Ember from 'ember';

export default Ember.Component.extend({
    books: Ember.A([{name: 'Moby Dick'}]),
    actions: {
      add(val) {
        this.get('books').addObject({name:val});
      }
    }
});</pre></div><p class="calibre14">This component uses the <code class="email">books</code> property to keep track of books on the book shelf. The <code class="email">books</code> property is an Ember array of objects. The <code class="email">add</code> action adds another object to the array. <code class="email">Ember.A</code> is used to declare an Ember array.</p></li><li class="listitem" value="3">Update the <a id="id412" class="calibre1"/><code class="email">book-shelf.hbs</code> component template file:<div><pre class="programlisting">// app/templates/components/book-shelf.hbs
{{input value=val}}
&lt;button {{action 'add' val}}&gt;Push Me&lt;/button&gt;&lt;br&gt;
&lt;ul&gt;
{{#each books as |book|}}
    &lt;li&gt;{{book.name}}&lt;br&gt;&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre></div><p class="calibre14">The component lists all the books. It also has an <code class="email">input</code> helper and <code class="email">button</code>. The button has an action called <code class="email">add</code> that gets triggered on the click event. It passes on the value from the <code class="email">input</code> helper as an argument to <code class="email">action</code>.</p></li><li class="listitem" value="4">Add the <code class="email">book-shelf</code> component to the application file:<div><pre class="programlisting">&lt;h2 id="title"&gt;Welcome to Ember&lt;/h2&gt;
{{book-shelf}}
{{outlet}}</pre></div><p class="calibre14">This code adds the <code class="email">book-shelf</code> component to the application template.</p></li><li class="listitem" value="5">Add the test code to the <code class="email">add-book-test.js</code> file:<div><pre class="programlisting">// app/tests/acceptance/add-book-test.js
import { test } from 'qunit';
import moduleForAcceptance from 'example3/tests/helpers/module-for-acceptance';

moduleForAcceptance('Acceptance | add book');

test('visiting / and adding book', function(assert) {
    visit('/');
    fillIn('input','My new book');
    click('button');
    andThen(function() {
      assert.equal(currentURL(), '/');
      assert.equal(find('li:last').text(),'My new book');

    });

});</pre></div><p class="calibre14">This acceptance test visits the root of the application at <code class="email">/</code>. It then adds new text to the <code class="email">input</code> helper and clicks the <code class="email">button</code>. It then checks the URL and template to make sure the text was added.</p><p class="calibre14">The code at the top is mostly boilerplate. The tests are at the bottom and can be followed step by step. The <code class="email">visit</code>, <code class="email">fillIn</code>, <code class="email">click</code>, and <code class="email">andThen</code> helpers are all asynchronous <a id="id413" class="calibre1"/>test helpers.</p><div><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre8">The following is a list of all the asynchronous and synchronous test helpers:</p><div><ul class="itemizedlist1"><li class="listitem"><code class="email">click(selector)</code>: This clicks an element and triggers the corresponding action, and returns a promise that fulfils when asynchronous behavior is complete</li><li class="listitem"><code class="email">fillIn(selector, value)</code>: This fills in the selected input with the values given, and returns a promise that fulfils when all asynchronous behavior is complete</li><li class="listitem"><code class="email">keyEvent(selector, type, keyCode)</code>: This simulates <code class="email">keypress</code>, <code class="email">keydown</code>, or <code class="email">keyup</code> on the element</li><li class="listitem"><code class="email">triggerEvent(selector, type, options)</code>: This triggers the given event on the element identified by the <code class="email">selector</code></li><li class="listitem"><code class="email">visit(url)</code>: This visits the route given by the URL, and returns a promise that is fulfilled when all asynchronous behavior is complete</li><li class="listitem"><code class="email">currentPath()</code>: This returns the current path</li><li class="listitem"><code class="email">currentRouteName()</code>: This returns the currently active route</li><li class="listitem"><code class="email">currentURL()</code>: This returns the current URL</li><li class="listitem"><code class="email">find(selector, context)</code>: This finds an element starting at the app's root element; optionally, you can add some context</li></ul></div></div></li><li class="listitem" value="6">Run <code class="email">ember server</code> and visit the <code class="email">/tests</code> URL. This URL will display all the tests running. Look for the acceptance test for add-book:<div><img src="img/00053.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p></li><li class="listitem" value="7">This acceptance test shows that everything passed. Alternatively, you can also run the tests on the command line:<div><pre class="programlisting">
<strong class="calibre9">$ ember test –server</strong>
</pre></div></li><li class="listitem" value="8">This will bring up a screen so that you can run tests in your console. To use this, you must first navigate to <code class="email">localhost</code> on port <code class="email">7357</code>. This screen will then refresh <a id="id414" class="calibre1"/>with the number of passed tests:<div><img src="img/00054.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">Each test will be checked, and any tests that fail will be shown on this screen. The test will be rerun after any file changes.</p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec117" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">Acceptance tests are used to test the user interaction and flow. This is done via Ember's QUnit testing framework, although other testing frameworks are supported using third-party add-ons. You can navigate to the <code class="email">/tests</code> URL or run <code class="email">ember test</code> on the server to execute test cases.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec64" class="calibre1"/>Using unit tests</h1></div></div></div><p class="calibre8">Unit tests are <a id="id415" class="calibre1"/>used to test smaller chunks of functionality. In this recipe, we'll see an example of this.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec118" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">In this example, we'll create a simple <code class="email">Ember.Object</code> with a computed property. We'll test this computed property and assert if the value returned is correct or not.</p><div><ol class="orderedlist"><li class="listitem" value="1">In a new <a id="id416" class="calibre1"/>project, create a new <code class="email">first-last.js</code> file in the <code class="email">models</code> folder:<div><pre class="programlisting">// app/models/first-last.js

import Ember from 'ember';

export default Ember.Object.extend({
    firstName: 'John',
    lastName: 'Smith',
    fullName: Ember.computed('firstName', 'lastName', function() {
      const firstName = this.get('firstName');
      const lastName= this.get('lastName');
      return `Full Name: ${firstName} ${lastName}`;
    })
});</pre></div><p class="calibre14">In this file, we have two properties, <code class="email">firstName</code> and <code class="email">lastName</code>. The <code class="email">fullName</code> computed property combines these two and returns a full name. If either of these properties change, the computed property will fire.</p></li><li class="listitem" value="2">Create a new unit test that checks <code class="email">Ember.Object</code> and <code class="email">computed</code> property:<div><pre class="programlisting">
<strong class="calibre9">$ ember g model-test first-last</strong>
</pre></div><p class="calibre14">The <code class="email">model-test</code> unit test generated will create a new test file in the <code class="email">/tests/unit/models</code> directory.</p></li><li class="listitem" value="3">Update the <code class="email">first-last-test.js</code> file with a new unit test that checks to see whether the computed property is returning the correct values:<div><pre class="programlisting">// tests/unit/models/first-last-test.js

import { moduleFor, test } from 'ember-qunit';

moduleFor('model:first-last', 'Unit | Model | fullName', {
    unit: true
});

test('check computed property fullName', function(assert) {
    const firstLast= this.subject();
    firstLast.set('firstName','Erik');
    firstLast.set('lastName','Hanchett');
    assert.equal(firstLast.get('fullName'), 'Full Name: Erik Hanchett');
});</pre></div><p class="calibre14">The <code class="email">moduleFor</code> is a unit test helper provided by <code class="email">ember-qunit</code>. This helps us get access to the model that we created for lookup and instantiation. The <code class="email">unit: true</code> property flags the test case as a unit test. As we are using <code class="email">moduleFor</code>, we can instantiate the <code class="email">firstLast</code> object using <code class="email">this.subject()</code>. The test then sets <code class="email">firstName</code> and <code class="email">lastName</code> of the computed <a id="id417" class="calibre1"/>properties and does <code class="email">assert</code> to make sure that they are equal.</p></li><li class="listitem" value="4">Run <code class="email">ember server</code> and check the output of the <code class="email">/tests</code> URL:<div><img src="img/00055.jpeg" alt="How to do it..." class="calibre10"/><div><p class="calibre27">The output shows that the unit tests passed</p></div></div><p class="calibre26"> </p></li><li class="listitem" value="5">Update the <code class="email">first-last-test.js</code> file with the wrong value:<div><pre class="programlisting">// tests/unit/models/first-last-test.js
…
test('check computed property fullName', function(assert) {
    const firstLast= this.subject();
    firstLast.set('firstName','Erik');
    firstLast.set('lastName','Hanchett');
    assert.equal(firstLast.get('fullName'),'Full Name: Erik wrong');
});</pre></div><p class="calibre14">We updated the code, so now the test will fail because the text does <em class="calibre13">NOT</em> match.</p></li><li class="listitem" value="6">Navigate to the <code class="email">/tests</code> folder and see the output:<div><img src="img/00056.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre26"> </p><p class="calibre14">Now the test fails because the text does not match. You can see this output by <a id="id418" class="calibre1"/>navigating to the <code class="email">/tests</code> folder or running <code class="email">ember test</code> from the command line.</p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec119" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">Unit tests are used to test small pieces of code or functionality. They are another part of the Ember QUnit library. Unit tests can run for virtually anything in your application, including models, components, or controllers.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec65" class="calibre1"/>Testing components</h1></div></div></div><p class="calibre8">Components <a id="id419" class="calibre1"/>should be tested using integration tests. In this recipe, we'll look at a simple example of a component that changes the size of the text.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec120" class="calibre1"/>How to do it...</h2></div></div></div><div><ol class="orderedlist"><li class="listitem" value="1">In a new application, create a new component called <code class="email">font-sizer</code>:<div><pre class="programlisting">
<strong class="calibre9">$ ember g component font-sizer</strong>
</pre></div><p class="calibre14">This will generate a new component called <code class="email">font-sizer</code>. This component will be used to resize text.</p></li><li class="listitem" value="2">Update the <code class="email">font-sizer.js</code> file in the <code class="email">components</code> folder:<div><pre class="programlisting">// app/components/font-sizer.js
import Ember from 'ember';

export default Ember.Component.extend({
    textInfo: 'Hello World',
    attributeBindings: ['style'],
    style: Ember.computed('size',function() {
      const size = this.get('size');
      return new Ember.Handlebars.SafeString("font-size: "+ size);
    })

});</pre></div><p class="calibre14">All components render as <code class="email">div</code> tags inside of templates. We can add different attributes to these <code class="email">div</code> tags if needed. In this case, the <code class="email">attributeBindings</code> property will add a <code class="email">style</code> tag. The <code class="email">style</code> tag will be a computed property that updates whenever a <code class="email">size</code> value changes. <code class="email">Ember.Handlebars.SafeString</code> lets Ember know that the string should be displayed without escaping and that it is safe.</p></li><li class="listitem" value="3">Update the <a id="id420" class="calibre1"/><code class="email">application.hbs</code> file with the new component:<div><pre class="programlisting">// app/templates/application.hbs
&lt;h2 id="title"&gt;Welcome to Ember&lt;/h2&gt;

{{#font-sizer size="38px" }}
    Test
{{/font-sizer }}
{{outlet}}</pre></div><p class="calibre14">The <code class="email">font-sizer</code> component is in block form. The test text will be in the <code class="email">div</code> block.</p></li><li class="listitem" value="4">Update the <code class="email">font-sizer-test.js</code> file so that we can check to make sure that the attribute was added:<div><pre class="programlisting">// tests/integration/components/font-sizer-test.js
import { moduleForComponent, test } from 'ember-qunit';
import hbs from 'htmlbars-inline-precompile';

moduleForComponent('font-sizer', 'Integration | Component | font sizer', {
    integration: true
});

test('check attributes', function(assert) {

    this.render(hbs`{{font-sizer size=val}}`);
    this.set('val','38px');
    assert.equal(this.$('div').attr('style'),'font-size: 38px', 'size is set to 38px');

});</pre></div><p class="calibre14">This code <a id="id421" class="calibre1"/>is automatically generated for us when we created the component. The <code class="email">moduleForComponent</code> helper is used for components. The <code class="email">integration</code>: <code class="email">true</code> tags this test as an integration test. By doing this, we have the ability to render the component and pass the <code class="email">size</code> property to it. The <code class="email">assert.equal</code> method is used to check whether <code class="email">font-size</code> is set correctly.</p></li><li class="listitem" value="5">Run <code class="email">ember server</code> and check <code class="email">/tests</code>:<div><img src="img/00057.jpeg" alt="How to do it..." class="calibre10"/><div><p class="calibre27">The test case passed</p></div></div><p class="calibre26"> </p></li></ol><div></div><div><div><div><div><h3 class="title2"><a id="ch08lvl3sec52" class="calibre1"/>Testing actions in the font-sizer component</h3></div></div></div><p class="calibre8">We can <a id="id422" class="calibre1"/>simulate actions and test the results to verify the expected results.</p><div><ol class="orderedlist"><li class="listitem" value="1">Using the existing application, update the <code class="email">font-sizer.js</code> file with a new action:<div><pre class="programlisting">// app/components/font-sizer.js
…
    textInfo: 'Hello World',
    }),
    actions: {
      updateText(){
        this.set('textInfo','Hi');
      }
    }

});</pre></div><p class="calibre14">This new action will set the <code class="email">textInfo</code> property to <code class="email">'Hi'</code>.</p></li><li class="listitem" value="2">Update the <a id="id423" class="calibre1"/><code class="email">font-sizer.js</code> file in the <code class="email">components</code> folder:<div><pre class="programlisting">// app/templates/components/font-sizer.hbs
&lt;div id='info'&gt;{{textInfo}}&lt;/div&gt;&lt;br&gt;
{{yield}}&lt;br&gt;
&lt;button {{action 'updateText'}}&gt;Update Text&lt;/button&gt;</pre></div><p class="calibre14">In this template, we created a new <code class="email">div</code> tag with an ID of <code class="email">info</code> surrounding the <code class="email">textInfo</code> property. A new <code class="email">updateText</code> action was added to the <code class="email">button</code> click. This action updates the <code class="email">textInfo</code> property.</p></li><li class="listitem" value="3">Add a new <a id="id424" class="calibre1"/>test to the <code class="email">font-sizer-test.js</code> file so that it can check the new action added:<div><pre class="programlisting">// tests/integration/components/font-sizer-test.js
…
test('check action', function(assert) {

    assert.expect(2);
    this.render(hbs`{{font-sizer}}`);
    assert.equal(this.$('#info').text(), 'Hello World', |'starting text is hello world');
    this.$('button').click();
    assert.equal(this.$('#info').text(),'Hi', 'text changed   to hi');

});</pre></div><p class="calibre14">By setting <code class="email">assert.expect(2)</code>, the test must have two asserts or it will fail. We first render the component using the <code class="email">this.render</code> helper. The next statement checks whether the value returned from <code class="email">this.$('#info').text()</code> equals <code class="email">Hello World</code>. We then simulate clicking the button. The last statement checks whether <code class="email">this.$('#info').text()</code> equals <code class="email">Hi</code>.</p></li><li class="listitem" value="4">Run <code class="email">ember server</code> and navigate to <code class="email">/tests</code>. All the tests will pass:<div><img src="img/00058.jpeg" alt="Testing actions in the font-sizer component" class="calibre10"/></div><p class="calibre26"> </p></li></ol><div></div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec121" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">Components use <a id="id425" class="calibre1"/>integration tests by way of the <code class="email">moduleForComponent</code> helper. This feature of Ember's QUnit takes advantage of how Ember actually sees your components. You can test bound values as well as the returning actions.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec66" class="calibre1"/>Testing routes</h1></div></div></div><p class="calibre8">Testing <a id="id426" class="calibre1"/>routes can be done either by acceptance tests or unit tests. In this example, we'll create a simple unit test for a route.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec122" class="calibre1"/>How to do it...</h2></div></div></div><div><ol class="orderedlist"><li class="listitem" value="1">In a new application, generate a new <code class="email">students</code> route:<div><pre class="programlisting">
<strong class="calibre9">$ ember g route students</strong>
</pre></div><p class="calibre14">This command will generate the route code for students.</p></li><li class="listitem" value="2">Edit the students route information and add a new property:<div><pre class="programlisting">// app/routes/students.js
import Ember from 'ember';

export default Ember.Route.extend({
    someText: 'someText'
});</pre></div><p class="calibre14">This route has a property called <code class="email">someText</code>.</p></li><li class="listitem" value="3">Edit the <code class="email">students-tests.js</code> file in the <code class="email">tests/unit/routes</code> folder:<div><pre class="programlisting">// tests/unit/routes/students-test.js
import { moduleFor, test } from 'ember-qunit';

moduleFor('route:students', 'Unit | Route | students', {
    // Specify the other units that are required for this test.
});

test('check prop and route exists', function(assert) {
    let route = this.subject();
    assert.expect(3);
    assert.equal(route.get('someText'),'someText');
    route.set('someText','otherText');
    assert.equal(route.get('someText'),'otherText');
    assert.ok(route);
});</pre></div><p class="calibre14">In this example, we are checking the output of the <code class="email">someText</code> property. The first <a id="id427" class="calibre1"/>
<code class="email">assert.equal</code> gets the property and checks it against the <code class="email">someText</code> value. The route instance can also set properties. The next assert checks to see whether the new value has been set. The final assert makes sure that the route is available.</p></li><li class="listitem" value="4">Run <code class="email">ember server</code> and navigate to <code class="email">/tests</code>:<div><img src="img/00059.jpeg" alt="How to do it..." class="calibre10"/><div><p class="calibre27">This shows all the tests passed</p></div></div><p class="calibre26"> </p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec123" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">The route in your Ember application has a few different functions. It can hold your model data and have properties and actions. When testing routes, we can use it with a more general acceptance test or as an individual unit test.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec67" class="calibre1"/>Testing models</h1></div></div></div><p class="calibre8">When testing <a id="id428" class="calibre1"/>models, you can use Ember Data to help. In this recipe, we'll create a model and test to make sure that it's creating data correctly.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec124" class="calibre1"/>How to do it...</h2></div></div></div><div><ol class="orderedlist"><li class="listitem" value="1">In a new application, generate a new student model:<div><pre class="programlisting">
<strong class="calibre9">$ ember g model student.js</strong>
</pre></div><p class="calibre14">This will generate the necessary files for the student model.</p></li><li class="listitem" value="2">Update the student model with two properties:<div><pre class="programlisting">// app/models/student.js
import DS from 'ember-data';

export default DS.Model.extend({
    firstName: DS.attr('string'),
    lastName: DS.attr('string')
});</pre></div><p class="calibre14">This model has two properties, <code class="email">firstName</code> and <code class="email">lastName</code>. Both hold <code class="email">string</code> values.</p></li><li class="listitem" value="3">Add a new unit test for the new model that tests the new properties:<div><pre class="programlisting">// tests/unit/models/student-test.js
import { moduleForModel, test } from 'ember-qunit';

moduleForModel('student', 'Unit | Model | student', {
    // Specify the other units that are required for this test.
    needs: []
});

test('it exists', function(assert) {
    let model = this.subject();
    assert.ok(!!model);
});

test('Test model data', function(assert) {
    assert.expect(2);
    let model = this.subject({firstName: 'Erik', lastName: 'Hanchett'});
    assert.equal(model.get('firstName'),'Erik', 'first Name is Erik');
    assert.equal(model.get('lastName'),'Hanchett', 'last Name is Erik');
});</pre></div></li><li class="listitem" value="4">This test uses the <code class="email">moduleForModel</code> helper. The first test checks whether the model is okay and it exists. The second test checks the properties:<div><pre class="programlisting">…
test('Test model data', function(assert) {
    assert.expect(2);
    let model = this.subject({firstName: 'Erik', lastName: 'Hanchett'});
    assert.equal(model.get('firstName'),'Erik', 'first Name is Erik');
    assert.equal(model.get('lastName'),'Hanchett', 'last Name is Erik');
});</pre></div><p class="calibre14">When creating <a id="id429" class="calibre1"/>the <code class="email">model</code> instance, you can pass in the values of the <code class="email">model</code> properties. In this case, the <code class="email">{firstName: 'Erik', lastName: 'Hanchett'}</code> object is created in the store. We can access these values using the <code class="email">model.get</code> method. The <code class="email">assert.equal</code> method checks against the model to make sure that the values match.</p></li><li class="listitem" value="5">Run <code class="email">ember server</code> and navigate to <code class="email">/tests</code>, and you'll see the passing tests:<div><img src="img/00060.jpeg" alt="How to do it..." class="calibre10"/><div><p class="calibre27">This shows that both tests passed</p></div></div><p class="calibre26"> </p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec125" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">The <code class="email">moduleForModel</code> helper is used to access Ember's model information. This is done with Ember Data so that models can be tested. Ember's QUnit provides a way to test the module completely.</p></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch08lvl1sec68" class="calibre1"/>Testing controllers</h1></div></div></div><p class="calibre8">Controllers should <a id="id430" class="calibre1"/>be tested in your application. In this recipe, we'll test some basic actions from a controller.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch08lvl2sec126" class="calibre1"/>How to do it...</h2></div></div></div><div><ol class="orderedlist"><li class="listitem" value="1">Create a new <code class="email">index</code> controller:<div><pre class="programlisting">
<strong class="calibre9">$ ember g controller index</strong>
</pre></div><p class="calibre14">This creates a new controller called <code class="email">index</code>.</p></li><li class="listitem" value="2">In the index controller, add a new property and action:<div><pre class="programlisting">// app/controllers/index.js
import Ember from 'ember';

export default Ember.Controller.extend({
    myValue: 'value',
    actions:{
      pressed(value){
        this.set('myValue',value);
      }
    }
});</pre></div><p class="calibre14">This controller has one property named <code class="email">myValue</code>. Another action called <code class="email">pressed</code> changes the value of <code class="email">myValue</code> to whatever value is passed in the function.</p></li><li class="listitem" value="3">Update the index unit test. Add a few tests for the action and property:<div><pre class="programlisting">// tests/unit/controllers/index-test.js
import { moduleFor, test } from 'ember-qunit';

moduleFor('controller:index', 'Unit | Controller | index', {
    // Specify the other units that are required for this test.
    // needs: ['controller:foo']
});

// Replace this with your real tests.
test('it exists', function(assert) {
    let controller = this.subject();
    assert.ok(controller);
});

test('check property', function(assert) {
    assert.expect(2);
    let controller = this.subject();
    assert.equal(controller.get('myValue'),'value');
    controller.send('pressed','newValue');
    assert.equal(controller.get('myValue'),'newValue');
});</pre></div></li><li class="listitem" value="4">The <code class="email">moduleFor</code> <a id="id431" class="calibre1"/>helper is used here for controllers. The first test checks to make sure that the controller exists:<div><pre class="programlisting">…
test('check property', function(assert) {
    assert.expect(2);
    let controller = this.subject();
    assert.equal(controller.get('myValue'),'value');
    controller.send('pressed','newValue');
    assert.equal(controller.get('myValue'),'newValue');
});</pre></div><p class="calibre14">This test creates an instance of the controller with <code class="email">this.subject</code>. The initial value is checked to make sure that it's correct. To send an action to the controller, the <code class="email">controller.send</code> method is called. The send method can take one or more parameters. The first is the name of the action to be triggered. This is followed by any values that should be passed in the method.</p></li><li class="listitem" value="5">Run <code class="email">ember server</code> and navigate to <code class="email">/tests</code>. This will display the passed tests:<div><img src="img/00061.jpeg" alt="How to do it..." class="calibre10"/><div><p class="calibre27">This message shows that all tests passed</p></div></div><p class="calibre26"> </p></li></ol><div></div></div></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch08lvl2sec127" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">Controller tests are <a id="id432" class="calibre1"/>very similar to the unit tests that we discussed before. They use QUnit's <code class="email">moduleFor</code> helper. In a controller, we can test the properties or actions and make sure that the results are as we expected.</p></div></div></body></html>