<html><head></head><body>
        

                            
                    <h1 class="header-title">Creating Images from Simple Text</h1>
                
            
            
                
<p>In this chapter, a high-level overview of <strong>Scalable Vector Graphics</strong> (<strong>SVG</strong>) will be presented by explaining how it operates and what elements it encompasses. In a browser context, SVG is very similar to HTML and is one of the means by which D3 expresses its power. Understanding the nodes and attributes of SVG will empower us to create many kinds of visualizations, not just maps. This chapter includes the following points:</p>
<ul>
<li>A general overview of SVG and its key elements</li>
<li>The SVG coordinate system</li>
<li>The primary elements of SVG (lines, rectangles, circles, polygons, and paths)</li>
</ul>
<p>SVG, an XML markup language, is designed to describe two-dimensional vector graphics. The SVG markup language resides in the DOM as a node that describes exactly how to draw a shape (a curve, line, circle, or polygon). Just like HTML, SVG tags can also be styled from standard CSS. Note that, because all commands reside in the DOM, the more shapes you have, the more nodes you have and the more work for the browser. This is important to remember because, as SVG visualizations become more complex, the less fluidly they will perform.</p>
<p>The main SVG node is declared as follows:</p>
<pre>&lt;svg width="200" height="200"&gt;&lt;/svg&gt; </pre>
<p>This node's basic properties are width and height; they provide the primary container for the other nodes that make up a visualization. For example, if you wanted to create 10 sequential circles in a <kbd>200</kbd> x <kbd>200</kbd> box, the tags would look like this:</p>
<pre>&lt;?xml version="1.0"?&gt; 
&lt;svg width="200" height="200"&gt; 
  &lt;circle cx="60" cy="60" r="50"/&gt; 
  &lt;circle cx ="5" cy="5" r="10"/&gt; 
  &lt;circle cx="25" cy="35" r="45"/&gt; 
  &lt;circle cx="180" cy="180" r="10"/&gt; 
  &lt;circle cx="80" cy="130" r="40"/&gt; 
  &lt;circle cx="50" cy="50" r="5"/&gt; 
  &lt;circle cx="2" cy="2" r="7"/&gt; 
  &lt;circle cx="77" cy="77" r="17"/&gt; 
  &lt;circle cx="100" cy="100" r="40"/&gt; 
  &lt;circle cx="146" cy="109" r="22"/&gt; 
&lt;/svg&gt; </pre>
<p>Note that 10 circles would need 10 nodes in the DOM, plus its container.</p>
<p>SVG contains several primitives that allow the developer to draw shapes quickly.<br/>
We will cover the following primitives throughout this chapter:</p>
<ul>
<li><kbd>circle</kbd>: A standard circle with a defined radius and position attributes</li>
<li><kbd>rect</kbd>: A standard rectangle with height, width, and position attributes</li>
<li><kbd>polygon</kbd>: Any polygon, described by a list of points</li>
<li><kbd>line</kbd>: A line with start and end points</li>
<li><kbd>path</kbd>: A complex line created through a series of drawing commands</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">The SVG coordinate system</h1>
                
            
            
                
<p>What about position? Where do these primitives draw inside the SVG element? What if you wanted to put a circle in the top-left and another one bottom-right? Where do you start?</p>
<p>SVG is positioned by a grid system, similar to the Cartesian coordinate system. However, in SVG (0,0) is the top-left corner. The <em>x</em> axis proceeds horizontally from left to right starting at 0. The <em>y</em> axis also starts at 0 and extends downward. See the following illustration:</p>
<div><img height="138" width="186" src="img/05846a5a-7c2f-4852-9a0c-fbec3565e9e8.png"/></div>
<p>What about drawing shapes on top of each other? How do you control the <em>z</em> index? In SVG, there is no <em>z</em> coordinate. Depth is determined by the order in which the shape is drawn. If you were to draw a circle with coordinates (10,10) and then another one with coordinates (10,10), you would see the second circle drawn on top of the first.</p>
<p>The following sections will cover the basic SVG primitives for drawing shapes and some of their most common attributes.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Line</h1>
                
            
            
                
<p>The SVG line is one of the simplest in the library. It draws a straight line from<br/>
one point to another. The syntax is very straightforward and can be experimented with at: <kbd>http://localhost:8080/chapter-2/line.html</kbd>, assuming the HTTP server is running:</p>
<pre>&lt;line x1="10" y1="10" x2="100" y2="100" stroke-width="1" <br/> stroke="red"/&gt;</pre>
<p>This will give you the following output:</p>
<div><img height="168" width="181" src="img/c26a89ed-8a23-4cf9-9378-40a79cd63e40.png"/></div>
<p>A description of the element's attributes is as follows:</p>
<ul>
<li><kbd>x1</kbd> and <kbd>y1</kbd>: The starting <em>x</em> and <em>y</em> coordinates</li>
<li><kbd>x2</kbd> and <kbd>y2</kbd>: The ending <em>x</em> and <em>y</em> coordinates</li>
<li><kbd>stroke</kbd>: This gives the line a red color</li>
<li><kbd>stroke-width</kbd>: This denotes the width of the line to be drawn in pixels </li>
</ul>
<p>The <kbd>line</kbd> tag also has the ability to change the style of the end of the line. For example, adding the following would change the image so it has round ends:</p>
<pre>stroke-linecap: round; </pre>
<p>As stated earlier, all SVG tags can also be styled with CSS elements. An alternative way of producing the same graphic would be to first create a CSS style, as shown in the following code:</p>
<pre>      line { 
        stroke: red; 
        stroke-linecap: round; 
        stroke-width: 5; 
      } </pre>
<p>Then you can create a very simple SVG tag using the following code:</p>
<pre>&lt;line x1="10" y1="10" x2="100" y2="100"&gt;&lt;/line&gt; </pre>
<p>More complex lines, as well as curves, can be achieved with the <kbd>path</kbd> tag; we will cover it in the <em>Path</em> section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Rectangle</h1>
                
            
            
                
<p>The basic HTML code to create a rectangle is as follows:</p>
<pre>&lt;rect width="100" height="20" x="10" y="10"&gt;&lt;/rect&gt; </pre>
<p>Let's apply the following style:</p>
<pre>      rect { 
        stroke-width: 1; 
        stroke:steelblue; 
        fill:#888; 
        fill-opacity: .5; 
      } </pre>
<p>We will create a rectangle that starts at the coordinates (<kbd>10</kbd>,<kbd>10</kbd>), and is <kbd>100</kbd> pixels wide and <kbd>20</kbd> pixels high. Based on the styling, it will have a blue outline, a gray interior, and will appear slightly opaque. See the following output and example<br/>
<kbd>http://localhost:8080/chapter-2/rectangle.html</kbd>:</p>
<div><img src="img/d87ddf47-9e5d-46ac-b040-892f972f4772.png"/></div>
<div><p>There are two more attributes that are useful when creating rounded borders<br/>
(<kbd>rx</kbd> and <kbd>ry</kbd>):</p>
<pre>&lt;rect with="100" height="20" x="10" y="10" rx="5" ry="5"&gt;&lt;/rect&gt; </pre>
<p>These attributes indicate that the <kbd>x</kbd> and <kbd>y</kbd> corners will have <kbd>5</kbd>-pixel curves.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Circle</h1>
                
            
            
                
<p>A circle is positioned with the <kbd>cx</kbd> and <kbd>cy</kbd> attributes. These indicate the <em>x</em> and <em>y</em> coordinates of the center of the circle. The radius is determined by the <kbd>r</kbd> attribute. The following is an example you can experiment with ( <kbd>http://localhost:8080/chapter-2/circle.html</kbd>):</p>
<div><img src="img/e95c09bf-ead3-4be7-bd3e-d45731843ac3.png"/></div>
<pre>&lt;circle cx="62" cy="62" r="50"&gt;&lt;/circle&gt; </pre>
<p>Now type in the following code:</p>
<pre>   circle { 
        stroke-width: 5; 
        stroke:steelblue; 
        fill:#888; 
        fill-opacity: .5; 
   } </pre>
<p>This will create a circle with the familiar blue outline, a gray interior, and half-way opaque.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Polygon</h1>
                
            
            
                
<p>To create a polygon, use the <kbd>polygon</kbd> tag. The best way to think about an SVG polygon is to compare it to a child's dot-to-dot game. You can imagine a series of dots and a pen connecting each (<em>x, y</em>) coordinate with a straight line. The series of <em>dots</em> is identified in the <kbd>points</kbd> attribute. Take the following as an example (<kbd>http://localhost:8080/chapter-2/polygon.html</kbd>):</p>
<div><img height="149" width="147" src="img/195bcc5f-d4c2-4654-94ec-e1f6a39bd853.png"/></div>
<pre>&lt;polygon points="60,5 10,120 115,120"/&gt; </pre>
<p>First, we start at <kbd>60,5</kbd> and we move to <kbd>10,120</kbd>. Then, we proceed to <kbd>115,120</kbd> and, finally, return to <kbd>60,5</kbd>.</p>
<p>The pen returns to the starting position automatically.</p>
<div><h1 class="header-title">Path</h1>
                
            
            
                
<p>When creating maps with D3, the <kbd>path</kbd> SVG tag is used most often. Using the definition from W3C, you can think of the <kbd>path</kbd> tag as a series of commands that explain how to draw any shape by moving a pen on a piece of paper. The <kbd>path</kbd> commands start with the location to place the pen and then a series of follow-up commands that tell the pen how to connect additional points with lines. The <kbd>path</kbd> shapes can also be filled or have their outline styled.</p>
<p>Let's look at a very simple example to replicate the triangle we created as a polygon.</p>
<p>Open your browser, go to <kbd>http://localhost:8080/chapter-2/path.html</kbd>, and you will see the following output on your screen:</p>
<div><img height="162" width="242" src="img/47939436-45b1-4655-8c89-7e6bcbfb3b4f.png"/></div>
<p>Right-click anywhere in the triangle and select Inspect element.</p>
<p>The <kbd>path</kbd> command for this shape is as follows:</p>
<pre>&lt;path d="M 120 120 L 220 220, 420 120 Z" stroke="steelblue" <br/> fill="lightyellow" stroke-width="2"&gt;&lt;/path&gt;</pre>
<p>The attribute that contains the path-drawing commands is <kbd>d</kbd>. The commands adhere to the following structure:</p>
<ul>
<li><kbd>M</kbd>: Put the pen down to start drawing at <kbd>x = 120 y = 120</kbd></li>
<li><kbd>L</kbd>: Draw a straight line that connects (<kbd>120</kbd>,<kbd>120</kbd>) to <kbd>x = 220 y = 220</kbd>, then draw another straight line that connects (<kbd>220</kbd>,<kbd>220</kbd>) to <kbd>x = 420 y = 120</kbd></li>
<li><kbd>Z</kbd>: Connect the last data point (<kbd>420</kbd>,<kbd>120</kbd>) to where we started (<kbd>120</kbd>,<kbd>120</kbd>)</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Experiment</h1>
                
            
            
                
<p>Let's try some experiments to reinforce what we just learned. From the Chrome developer tools, simply remove the <kbd>Z</kbd> at the end of the path, and hit <em>Enter</em>:</p>
<div><img src="img/af30d800-0ac2-4c5f-a940-f48ce2548d49.png"/></div>
<div><p>You should see the top line disappear. Try some other experiments with changing the data points in the <kbd>L</kbd> subcommand.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Paths with curves</h1>
                
            
            
                
<p>Paths can also have curves. The concept is still the same; you connect several data points with lines. The main difference is that now you apply a curve to each line as it connects the dots. There are three types of curve commands:</p>
<ul>
<li>Cubic Bézier</li>
<li>Quadratic Bézier</li>
<li>Elliptical arc</li>
</ul>
<p>Each command is explained in detail at <a href="http://www.w3.org/TR/SVG11/paths.html">http://www.w3.org/TR/SVG11/paths.html</a>. As an example, let's apply a cubic Bézier curve to the triangle. The format for the command is as follows:</p>
<pre>C x1 y1 x2 y2 x y </pre>
<p>This command can be inserted into the path structure at any point:</p>
<ul>
<li><kbd>C</kbd>: Indicates that we are applying a Cubic Bézier curve, just as <kbd>L</kbd> in the previous example indicates a straight line</li>
<li><kbd>x1</kbd> and <kbd>y1</kbd>: Adds a control point to influence the curve's tangent</li>
<li><kbd>x2</kbd> and <kbd>y2</kbd>: Adds a second control point after applying <kbd>x1</kbd> and <kbd>y1</kbd></li>
<li><kbd>x</kbd> and <kbd>y</kbd>: Indicates the final resting place of the line</li>
</ul>
<p>To apply this command to our previous triangle, we need to replace the second line command (<kbd>320 120</kbd>) with a cubic command (<kbd>C 200 70 480 290 320 120</kbd>).</p>
<p>Before, the statement was as follows:</p>
<pre>&lt;path d="M 120 120 L 220 220, 320 120 Z"&gt;&lt;/path&gt; </pre>
<p>After adding the cubic command, it will be as follows:</p>
<pre>&lt;path d="M 120 120 L 220 220, C 200 70 480 290 320 120 Z"&gt;&lt;/path&gt; </pre>
<p>This will produce the following shape:</p>
<div><img height="188" width="281" src="img/050d0d87-b973-4525-b2e4-ec5fdd827cf9.png"/></div>
<p>To illustrate how the cubic Bézier curve works, let's draw circles and lines to show the control points in the <kbd>C</kbd> command:</p>
<pre>&lt;svg  height="300" width="525"&gt; 
      &lt;path d="M 120 120 L 220 220 C 200 70 480 290 320 120 Z "&gt;<br/>       &lt;/path&gt; 
      &lt;line x1="220"  y1="220" x2="200" y2="70"&gt;&lt;/line&gt; 
      &lt;circle cx="200" cy="70" r="5" &gt;&lt;/circle&gt; 
      &lt;line x1="200"  y1="70"  x2="480" y2="290"&gt;&lt;/line&gt; 
      &lt;circle cx="480" cy="290"  r="5"&gt;&lt;/circle&gt; 
      &lt;line x1="480"  y1="290" x2="320" y2="120"&gt;&lt;/line&gt; 
&lt;/svg&gt; </pre>
<p>The output should look like the one shown in the following screenshot, and can be experimented with at <kbd>http://localhost:8080/chapter-2/curves.html</kbd>. You can see the angles created by the control points (indicated by circles in the output) and the cubic Bézier curves applied.</p>
<div><img height="192" width="331" src="img/31c59086-521c-469f-a270-fcd49fe4b1b2.png"/></div>
<p>SVG paths are the main tool leveraged when drawing geographic regions. However, imagine if you were to draw an entire map by hand using SVG paths; the task would become exhausting! For example, the command structure for the map of Europe in our first chapter has 3,366,121 characters in it! Even a simple state such as Colorado would be a lot of code if executed by hand:</p>
<pre>&lt;path  id="CO_1_" <br/> style="fill:#ff0000" d="M 115.25800,104.81000 L <br/> 116.51200,84.744000 L 117.00000,77.915000 L 106.82700,77.077000 L <br/> 99.371000,76.452000 L 88.014000,75.198000 L 81.709000,74.431000 L <br/> 80.907000,81.189000 L 79.932000,88.018000 L 78.788000,96.547000 L <br/> 78.329000,99.932000 L 78.154000,101.11800 L 88.641000,102.37200 L <br/> 99.898000,103.72200 L 109.88400,104.39200 L 111.91300,104.60300 L <br/> 115.39700,104.77700"/&gt;</pre>
<p>We will learn in later chapters how D3 will come to the rescue.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Transform</h1>
                
            
            
                
<p>The <kbd>transform</kbd> allows you to change your visualization dynamically and is one of the advantages of using SVG and commands to draw shapes. Transform is an additional attribute you can add to any of the elements we have discussed so far. Two important types of <kbd>transform</kbd> when dealing with our D3 maps are:</p>
<ul>
<li><strong>Translate</strong>: Move the element</li>
<li><strong>Scale</strong>: Adjust the coordinates for all attributes in the element</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Translate</h1>
                
            
            
                
<p>You will likely use this transformation in all of your cartography work and will see it in most D3 examples online. As a technique, it's often used with a margin object to shift the entire visualization. The following syntax can be applied to any element:</p>
<pre>transform="translate(x,y)" </pre>
<p>Here, <kbd>x</kbd> and <kbd>y</kbd> are the coordinates to move the element by.</p>
<p>For example, a translate <kbd>transform</kbd> can move our circle <kbd>50</kbd> pixels to the left and <kbd>50</kbd> pixels down by using the following code:</p>
<pre>&lt;circle cx="62" cy="62" r="50" transform="translate(50,50)"&gt;&lt;/circle&gt; </pre>
<p>Here is the output:</p>
<div><img src="img/2d8a8747-f164-4620-b4f7-ab3255e1f7d7.png"/></div>
<p>Note that the translucent image represents the original image and the location the shape moved from. The <kbd>translate</kbd> attribute is not an absolute position. It adjusts the origin of the circle relatively to <kbd>cx</kbd>, <kbd>cy</kbd> and adds <kbd>50</kbd> to those coordinates. If you were to move the circle to the top-left of the container, you would translate with negative values. For example:</p>
<pre>transform="translate(-10,-10)" </pre>
<p>Feel free to experiment with your Chrome developer tools or code editor at<br/>
<kbd>http://localhost:8080/chapter-2/translate.html</kbd>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Scale</h1>
                
            
            
                
<p>The scale transform is easy to understand but often creates undesired effects if you lose the focus of where the scaling originated.</p>
<p>Scale adjusts the (<em>x, y</em>) values across all attributes in the element. Using the earlier <kbd>circle</kbd> code, we have the following:</p>
<pre>&lt;circle cx="62" cy="62" r="50" stroke-width="5" fill="red"  <br/> transform="scale(2,2)"&gt;&lt;/circle&gt;</pre>
<p>The scale is going to double the <kbd>cx</kbd>, <kbd>cy</kbd>, radius, and <kbd>stroke-width</kbd>, producing the following output (<kbd>http://localhost:8080/chapter-2/scale.html</kbd>):</p>
<div><img height="208" width="210" src="img/4e572a01-dbbf-4105-b95a-1881943e5a7c.png"/></div>
<p>It is important to emphasize that, because we are using SVG commands to draw the shapes, there is no loss of quality as we scale the images, unlike raster images such as PNG or JPEG. The transform types can be combined to adjust for scale, altering the <em>x</em> and <em>y</em> position of the shape. Let's use the <kbd>path</kbd> example that we used earlier in the following code:</p>
<pre>&lt;path d="M 120 120 L 220 220 C 200 70 480 290 320 120 Z" <br/> stroke="steelblue" fill="lightyellow" stroke-width="2" <br/> transform="translate(-200,-200), scale(2,2)"&gt;&lt;/path&gt;</pre>
<p>The preceding code will produce the following output (<kbd>http://localhost:8080/chapter-2/scale_translate.html</kbd>):</p>
<div><img height="190" width="284" src="img/e185d2e3-7bc0-424c-a11f-bf728ad6da78.png"/></div>


            

            
        
    

        

                            
                    <h1 class="header-title">Grouping</h1>
                
            
            
                
<p>The group tag <kbd>&lt;g&gt;</kbd> is used often in SVG, especially in maps. It is used to group elements and then apply a set of attributes to that set. It provides the following benefits:</p>
<ul>
<li>It allows you to treat a set of shapes as a single shape for the purpose of scaling and translating.</li>
<li>It prevents code duplication by allowing you to set attributes at a higher level and have them inherit all the elements included.</li>
<li>Groups are essential for applying transformations to large sets of SVG nodes in a performant manner. Grouping offsets the parent group rather than modifying each of the attributes in every item of the group.</li>
</ul>
<p>Let's take the set of shapes used to explain Bézier curves and add all of them to a single group, combining everything we have learned so far, in the following code:</p>
<pre>    &lt;svg height="500" width="800"&gt; 
      &lt;g transform="translate(-200,-100), scale(2,2)"&gt; 
        &lt;path d="M 120 120 L 220 220 C 200 70 480 290 320 120 Z"&gt;<br/>         &lt;/path&gt; 
 
        &lt;line x1="220"  y1="220" x2="200" y2="70"&gt;&lt;/line&gt; 
        &lt;circle cx="200" cy="70"   r="5" &gt;&lt;/circle&gt; 
 
        &lt;line x1="200"  y1="70"  x2="480" y2="290"&gt;&lt;/line&gt; 
        &lt;circle cx="480" cy="290"  r="5" &gt;&lt;/circle&gt; 
 
        &lt;line x1="480"  y1="290" x2="320" y2="120"&gt;&lt;/line&gt; 
      &lt;/g&gt; 
    &lt;/svg&gt; </pre>
<p>The preceding code will produce the following image (<kbd>http://localhost:8080/chapter-2/group.html</kbd>):</p>
<div><img height="229" width="361" src="img/030af2bc-e3a6-49ad-8ac2-a2c856745710.png"/></div>
<p>Without using the group element, we would have had to apply a transform, translate, and scale to all six shapes in the set. Grouping helps us save time and allows us to make quick alignment tweaks in the future.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Text</h1>
                
            
            
                
<p>The text element, as its name describes, is used to display text in SVG. The basic HTML code to create a text node is as follows:</p>
<pre>&lt;text x="250" y="150"&gt;Hello world!&lt;/text&gt; </pre>
<p>It has an <kbd>x</kbd> and a <kbd>y</kbd> coordinate to tell it where to begin writing in the SVG coordinate system. Styling can be achieved with a CSS class in order to have a clear separation of concerns within our code base. For example, check out the following code:</p>
<pre>&lt;text x="250" y="150" class="myText"&gt;Hello world!&lt;/text&gt; 
 
.myText{ 
  font-size:22px; 
  font-family:Helvetica; 
  stroke-width:2; 
} </pre>
<p>Text also supports rotation in order to provide flexibility when positioning it on the visualization:</p>
<pre>&lt;svg width="600" height="600"&gt; 
        &lt;text x="250" y="150" class="myText" <br/>         transform="rotate(45,200,0)" font-family="Verdana" <br/>         font-size="100"&gt;Hello world!&lt;/text&gt; 
&lt;/svg&gt;; </pre>
<p>Some examples are located at <kbd>http://localhost:8080/chapter-2/text.html</kbd> and displayed as shown in the following image:</p>
<div><img height="204" width="347" src="img/ff32ab5f-9ddc-4554-ba6f-cbec8431f8ab.png"/></div>
<p>Keep in mind that, if you rotate the text, it will rotate relative to its origin (<em>x</em> and <em>y</em>). You can specify the origin of the translation via <kbd>cx</kbd> and <kbd>cy</kbd>, or in this case <kbd>250,150</kbd>. See the <kbd>transform</kbd> property in the code for more clarity.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>This chapter has given us a wealth of information regarding SVG. We explained paths, lines, circles, rectangles, text, and some of their attributes. We also covered transformation by scaling and translating shapes. Since this chapter has given us a solid baseline, we can now create complicated shapes. The next chapter will introduce us to D3 and how it is used to manage SVG programmatically. On we go!</p>


            

            
        
    </body></html>