<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;A Simple Task List"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. A Simple Task List</h1></div></div></div><p>At its core, most programming tasks fall into three <a id="id0" class="indexterm"/>categories: data display, data entry, and data storage. We will start our first project with the goal of covering how Sencha Touch handles each of these three basic categories. To do this, we will create a common programming application, the to-do list, or task list.</p><p>In this application, we will use the local storage available in HTML5 to store tasks including a name, description, creation date, completing date, and priority. We will then create a task list for displaying the current tasks as well as our completed tasks. We will discuss ways to test your display and to manage errors. We will then create the forms for entering in new tasks, editing existing tasks, and marking a task as complete.</p><p>Finally, we will explore some of the possible additional features for this type of application in our Extra Credit section.</p><div class="section" title="A brief overview of Sencha Architect"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>A brief overview of Sencha Architect</h1></div></div></div><p>Sencha Architect is a cross-platform <a id="id1" class="indexterm"/>visual development tool for Sencha Touch and Ext JS. Sencha Architect is available for Mac, Windows, and Linux, and it can be downloaded at the following <a id="id2" class="indexterm"/>link:</p><p>
<a class="ulink" href="http://www.sencha.com/products/architect">http://www.sencha.com/products/architect</a>
</p><p>For most of the chapters in this book we will be using a combination of Sencha Architect and standard coding to create our projects. This will give you an idea of some of the powerful advantages of the designer, while not hiding any of the actual code.</p><p>This is actually one of the key benefits of Sencha Architect; <a id="id3" class="indexterm"/>while it allows you to rapidly create interfaces and test them, behind the scenes the designer is generating standard JavaScript files, which you can edit with any text editor. This advantage allows you to quickly assemble the basic elements of your application, while maintaining the ability to tweak the code by hand as needed. We will cover this a bit more later on, but for now let's take a look at how Sencha Architect is set up.</p><p>When you first launch Sencha Architect, you are <a id="id4" class="indexterm"/>presented with a dialog box where you can choose to work on a new Ext JS project or a new Sencha Touch project, or you can choose from a list of existing projects:</p><div class="mediaobject"><img src="graphics/8901OS_01_01.jpg" alt="A brief overview of Sencha Architect"/></div><p>Since we are concerned with Sencha Touch in this book, you should select a <a id="id5" class="indexterm"/>new Sencha Touch 2.1 project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>The difference between Ext JS and Sencha Touch</strong></span>
</p><p>Both ExtJ S and Sencha Touch are products created by the company Sencha Inc. Where Sencha Touch is used to develop mobile <a id="id6" class="indexterm"/>
<a id="id7" class="indexterm"/>applications for various devices, Ext JS is used to create web applications for desktop browsers such as Firefox, Chrome, or Internet Explorer. For this book, we'll stick with Sencha Touch.</p></div></div><p>Once you have chosen your new project type, the Sencha Architect window will open. This window contains a visual display of the application and allows us to modify the application using drag-and-drop as well as directly entering code.</p><div class="mediaobject"><img src="graphics/8901OS_01_02_New.jpg" alt="A brief overview of Sencha Architect"/></div><div class="section" title="The Toolbox"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>The Toolbox</h2></div></div></div><p>The <span class="strong"><strong>Toolbox</strong></span> section of <a id="id8" class="indexterm"/>Sencha Architect is where you will find all of the components offered by Sencha Touch. These components are listed in alphabetical order on the right side of the <span class="strong"><strong>Toolbox</strong></span> section, while the basic types of components are listed on the left side. Clicking on one of these component types will limit the list to that particular type.</p><div class="mediaobject"><img src="graphics/8901OS_01_03.jpg" alt="The Toolbox"/></div><p>The following types are provided by default:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Behaviors</strong></span>: It provides empty <a id="id9" class="indexterm"/>containers for <a id="id10" class="indexterm"/>functions and controllers</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Charts</strong></span>: It is a collection of graphs and <a id="id11" class="indexterm"/>charts that can <a id="id12" class="indexterm"/>pull data directly from a store</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Containers</strong></span>: It contains elements such <a id="id13" class="indexterm"/>as <a id="id14" class="indexterm"/>panels, tab panels, carousels, and field sets</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Data</strong></span>: It contains data-driven <a id="id15" class="indexterm"/>pieces <a id="id16" class="indexterm"/>such as stores, proxies, readers, writers, and filters</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Forms</strong></span>: It contains basic <a id="id17" class="indexterm"/>form <a id="id18" class="indexterm"/>elements such as text fields, radio buttons, select fields, and buttons</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Models</strong></span>: It includes the basic <a id="id19" class="indexterm"/>data model, <a id="id20" class="indexterm"/>validations, fields, proxies, readers, and writers</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Resources</strong></span>: It allows you to add external <a id="id21" class="indexterm"/>files for <a id="id22" class="indexterm"/>JavaScript and CSS, as well as packaging files for compiled applications</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Trees</strong></span>: Trees are the store types needed for <a id="id23" class="indexterm"/>nested <a id="id24" class="indexterm"/>tree components</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Views</strong></span>: It contains all of the basic viewable <a id="id25" class="indexterm"/>components in <a id="id26" class="indexterm"/>Sencha Touch such as containers, form fields, media, pickers, toolbars, lists, and buttons</li></ul></div><p>There is also the <a id="id27" class="indexterm"/>
<span class="strong"><strong>Everything</strong></span> option to show all the types in the list.</p><p>You can also use the <a id="id28" class="indexterm"/>
<span class="strong"><strong>+</strong></span> button in the <a id="id29" class="indexterm"/>
<span class="strong"><strong>CUSTOM</strong></span> section to add your own custom types for limiting the list. This is very helpful for frequently used components, or simply for customizing the lists to fit your own personal habits.</p><p>Once a custom type is created, you can just drag components over from the list on the right, and drop them into your custom type.</p><p>Components can also be searched directly by name using the <span class="strong"><strong>Filter...</strong></span> field at the top of the toolbox area.</p></div><div class="section" title="The help section"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>The help section</h2></div></div></div><p>When any component is selected from the toolbox the <a id="id30" class="indexterm"/>help section directly below it will display <a id="id31" class="indexterm"/>information for the component.</p><p>There is also a blue link at the bottom of the help area that says <a id="id32" class="indexterm"/>
<span class="strong"><strong>See Class Documentation</strong></span>. Clicking on this link will take you to the Sencha website documentation for the specific component that you have selected. This documentation is an invaluable source of information and you should familiarize yourself with it as quickly as possible.</p></div><div class="section" title="The design area"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>The design area</h2></div></div></div><p>The design area is where we will begin creating our first <a id="id33" class="indexterm"/>application. By default, a Sencha <a id="id34" class="indexterm"/>Touch application starts out with an iPhone 320 x 480 layout. This layout can be changed to be displayed as an iPad, Nexus S, or Kindle Fire display size. This allows you to look at your design under multiple devices. You can also set the orientation of the device and zoom in and out of the design view area.</p><div class="mediaobject"><img src="graphics/8901OS_01_04_New.jpg" alt="The design area"/></div><p>The design area also offers an option to view and work with the code behind the design. This is a great learning tool if you're just getting into mobile programming. By switching between the <span class="strong"><strong>Design</strong></span> and <span class="strong"><strong>Code</strong></span> view, you can examine complex <a id="id35" class="indexterm"/>
<a id="id36" class="indexterm"/>layouts and see exactly how the JavaScript code is used to create them.</p></div><div class="section" title="The Project Inspector area"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>The Project Inspector area</h2></div></div></div><p>The <a id="id37" class="indexterm"/>Project Inspector area provides an alternative view to your project's code. As you drag components onto the design area they will also appear in <span class="strong"><strong>Project Inspector</strong></span>. The <a id="id38" class="indexterm"/>
<span class="strong"><strong>Project Inspection</strong></span> area will display these components as a hierarchical list. This is often very helpful in seeing which components are nested inside of other components.</p><div class="mediaobject"><img src="graphics/8901OS_01_05.jpg" alt="The Project Inspector area"/></div><p>Components can also be dragged from the <span class="strong"><strong>Toolbox</strong></span> list into <span class="strong"><strong>Project Inspector</strong></span>. It is often easier to manage certain components by dropping them into <span class="strong"><strong>Project Inspector</strong></span>, rather than the design area. This can ensure that you correctly position the <a id="id39" class="indexterm"/>
<a id="id40" class="indexterm"/>component within the required container.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>The <a id="id41" class="indexterm"/>
<span class="strong"><strong>Resources</strong></span> section is a new addition in Version 2.1, and it allows you to add external files to your project. If you have an older Version 2.0 Sencha Touch project, you can right-click on <span class="strong"><strong>Library</strong></span> and select <span class="strong"><strong>Upgrade</strong></span> to change the project to a newer Sencha Touch 2.1 project.</p></div></div></div><div class="section" title="The Config area"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>The Config area</h2></div></div></div><p>The <span class="strong"><strong>Config</strong></span> area will display all the configuration options <a id="id42" class="indexterm"/>for any component selected in the <a id="id43" class="indexterm"/>design area or in <span class="strong"><strong>Project Inspector</strong></span>. All of the typical configuration options, such as height, width, layout, ID, padding, margin, events, and functions can be accessed from the <span class="strong"><strong>Config</strong></span> area.</p><div class="mediaobject"><img src="graphics/8901OS_6.jpg" alt="The Config area"/></div><p>The configuration name is listed on the left and the value is on the right. Clicking on the value will allow you to edit it. You can also click on the <span class="strong"><strong>+</strong></span> next to <a id="id44" class="indexterm"/>
<a id="id45" class="indexterm"/>certain sections such as <span class="strong"><strong>Functions</strong></span> and <span class="strong"><strong>Events</strong></span> to add new items to <span class="strong"><strong>Config</strong></span>.</p></div></div></div>
<div class="section" title="Getting started with the task list"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Getting started with the task list</h1></div></div></div><p>To see how all of these pieces work together to create an application, let's start by creating our data store for the Task Manager application. <a id="id46" class="indexterm"/>Save the new file you have opened as <code class="literal">TaskList</code> and let's get to work on adding some components.</p><div class="section" title="Creating the data store"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Creating the data store</h2></div></div></div><p>To add a component to the project, we need to drag the component from the toolbox and drop it on the project or onto the proper section of the project <a id="id47" class="indexterm"/>inspector. For our first component, let's <a id="id48" class="indexterm"/>choose a plain data store.</p><p>From <span class="strong"><strong>Toolbox</strong></span>, select <span class="strong"><strong>Data</strong></span>, and then click on <a id="id49" class="indexterm"/>
<span class="strong"><strong>Store</strong></span> and drag it onto our iPhone in the design area. You should now see a store called <a id="id50" class="indexterm"/>
<span class="strong"><strong>MyStore</strong></span> appear in the <span class="strong"><strong>Property</strong></span> <span class="strong"><strong>Inspector</strong></span> under the <span class="strong"><strong>Stores</strong></span> list:</p><div class="mediaobject"><img src="graphics/8901OS_01_07.jpg" alt="Creating the data store"/></div><p>You will also notice that there is a red warning icon next to our store. This tells us that our store is missing a few of its required components. In this case, the store needs a proxy to control how the data is sent and received and it needs a model to tell it what data to expect.</p><p>From the <span class="strong"><strong>Toolbox</strong></span> list, select a <a id="id51" class="indexterm"/>
<span class="strong"><strong>LocalStorage Proxy</strong></span> object and drag it over onto our store.</p><p>You will probably notice that some components can only be placed within other components. For example, when you drag the proxy over, you can't just drop it into the iPhone diagram like we did before. A proxy component will only exist as part of a data store. This means that you have to drop a proxy component onto a <a id="id52" class="indexterm"/>
<a id="id53" class="indexterm"/>data store in <span class="strong"><strong>Property Inspector</strong></span> in order for it to correctly add itself to the store.</p><p>Once you have dropped the proxy onto the store, we need to add a model, and link it to our store.</p></div><div class="section" title="Adding a Model, Fields, and Field Types"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Adding a Model, Fields, and Field Types</h2></div></div></div><p>In the <span class="strong"><strong>Data</strong></span> section of our <span class="strong"><strong>Toolbox</strong></span>, scroll up to find the listing for <span class="strong"><strong>Model</strong></span>. Drag the <span class="strong"><strong>Model</strong></span> object over to the <span class="strong"><strong>Models</strong></span> section of our <span class="strong"><strong>Project Inspector</strong></span>. This will create a new model called <a id="id54" class="indexterm"/>
<span class="strong"><strong>MyModel</strong></span>.</p><p>Select <span class="strong"><strong>MyModel</strong></span> in <span class="strong"><strong>Project Inspector</strong></span> and look at the <a id="id55" class="indexterm"/>
<span class="strong"><strong>Config</strong></span> section. <a id="id56" class="indexterm"/>
<a id="id57" class="indexterm"/>
<a id="id58" class="indexterm"/>The first thing we probably want to change here is the name. Click on the value listed for <span class="strong"><strong>userClassName</strong></span>, <a id="id59" class="indexterm"/>change <span class="strong"><strong>MyModel</strong></span> to <code class="literal">Task</code> and press <span class="emphasis"><em>Enter</em></span> on your keyboard. The model should now be listed as <span class="strong"><strong>Task</strong></span> in both <span class="strong"><strong>Config</strong></span> and <span class="strong"><strong>Project Inspector</strong></span>.</p><p>Next, we need to add some fields to our model. With the <span class="strong"><strong>Task</strong></span> model selected, you should see a listing for <span class="strong"><strong>Fields</strong></span> in the <span class="strong"><strong>Config</strong></span> area. Click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Fields</strong></span> and enter <code class="literal">id</code> into the text area that appears. Click on <span class="strong"><strong>Finish</strong></span> on the screen or press <span class="emphasis"><em>Enter</em></span> on your keyboard.</p><p>Your <span class="strong"><strong>Config</strong></span> area should now look something like this:</p><div class="mediaobject"><img src="graphics/8901OS_01_08.jpg" alt="Adding a Model, Fields, and Field Types"/></div><p>Repeat the previous steps to add the following fields to the <a id="id60" class="indexterm"/>task model:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>name</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>description</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>create</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>completed</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>priority</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>isCompleted</strong></span></li></ul></div><p>Now that you have all of your fields, we need to define the data types for each field.</p><p>In <span class="strong"><strong>Project Inspector</strong></span>, click on the field called <span class="strong"><strong>id</strong></span>. <a id="id61" class="indexterm"/>
<a id="id62" class="indexterm"/>
<a id="id63" class="indexterm"/>This will open the configuration for that field and you should see that there is currently no value listed for <span class="strong"><strong>type</strong></span>. Click on the value next to <span class="strong"><strong>type. </strong></span>A drop-down menu will appear and you can select <span class="strong"><strong>int</strong></span> from the list.</p><p>Now we need to do the same thing for our other fields. Select each field in turn and set them as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>name</strong></span>: Set it as <span class="strong"><strong>string</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>description</strong></span>: Set it as <span class="strong"><strong>string</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>create</strong></span>: Set it as <span class="strong"><strong>date</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>completed</strong></span>: Set it as <span class="strong"><strong>date</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>priority</strong></span>: Set it as <span class="strong"><strong>int</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>isCompleted</strong></span>: Set it as <span class="strong"><strong>boolean</strong></span></li></ul></div><p>Now that you have all of the model fields and types <a id="id64" class="indexterm"/>
<a id="id65" class="indexterm"/>
<a id="id66" class="indexterm"/>defined, we need to add the model to the store.</p></div><div class="section" title="Adding the model to the store"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Adding the model to the store</h2></div></div></div><p>Click on <span class="strong"><strong>MyStore</strong></span> in <span class="strong"><strong>Project Inspector</strong></span>. As we <a id="id67" class="indexterm"/>
<a id="id68" class="indexterm"/>did with our model, we probably want to change the name of the store to make it easier to refer to and keep track of in our code. Click on the values next to <span class="strong"><strong>userClassName</strong></span> and <span class="strong"><strong>storeID</strong></span> and change both to say <span class="strong"><strong>taskStore</strong></span>.</p><p>Next, you will need to click on and edit the model <span class="strong"><strong>Config</strong></span> in the store to select our <span class="strong"><strong>Task</strong></span> model. Once complete, your store configuration should look something like this:</p><div class="mediaobject"><img src="graphics/8901OS_01_09.jpg" alt="Adding the model to the store"/></div></div><div class="section" title="Making copies"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Making copies</h2></div></div></div><p>Now that we have our store and model, we need to make a copy of it to hold our completed tasks. Both stores will use the same model and <a id="id69" class="indexterm"/>most of the same setup information. <a id="id70" class="indexterm"/>We only need to duplicate the store and change the <span class="strong"><strong>id</strong></span> and <span class="strong"><strong>userClassName</strong></span> values. Once we finish that, we will create filters for the store so that it only grabs the data we need.</p><p>To duplicate <span class="strong"><strong>TaskStore</strong></span>, right-click on it in <span class="strong"><strong>Project Inspector</strong></span> and select <span class="strong"><strong>Duplicate</strong></span>. A new store will appear called <span class="strong"><strong>MyStore2</strong></span>, with the same proxy and model information. Select <span class="strong"><strong>MyStore2</strong></span> in <span class="strong"><strong>Project Inspector</strong></span> and change both the <span class="strong"><strong>id</strong></span> and <span class="strong"><strong>userClassName</strong></span> values in the <span class="strong"><strong>Config</strong></span> section to <code class="literal">CompletedStore</code>.</p></div><div class="section" title="Adding filters"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Adding filters</h2></div></div></div><p>Now that we have our two stores, we need to set some filters to make sure that <span class="strong"><strong>TaskStore</strong></span> only loads current tasks and <span class="strong"><strong>CompletedStore</strong></span> only loads completed tasks.</p><p>You can add filters in the <span class="strong"><strong>Config</strong></span> section for each of our stores. <a id="id71" class="indexterm"/>
<a id="id72" class="indexterm"/>First, select <span class="strong"><strong>TaskStore</strong></span> and then click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Filters</strong></span> in the <span class="strong"><strong>Config</strong></span> section. This will add a new filter called <span class="strong"><strong>MyFilter</strong></span>. Click on the arrow next to <span class="strong"><strong>MyFilter</strong></span> to reveal its <span class="strong"><strong>Config</strong></span> options.</p><p>We need to add a function to this filter in order to tell it what records to grab. Click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>filterFn</strong></span> to add a new filter function. Up in the <span class="strong"><strong>Project Inspector</strong></span> area, <span class="strong"><strong>filterFn</strong></span> should appear beneath <span class="strong"><strong>MyFilter</strong></span>. Click on <span class="strong"><strong>filterFn</strong></span> in <span class="strong"><strong>Property Inspector</strong></span> to bring up the code editor for the function.</p><p>The editor should appear with the following code:</p><div class="informalexample"><pre class="programlisting">filterFn: function(item) {

}</pre></div><p>This sets up the basic function for the filter and passes us each record in the store as <span class="strong"><strong>item</strong></span>. If our function returns <code class="literal">true</code>, the record is included in the store and if it returns <code class="literal">false</code>, the record is ignored.</p><p>Our model has a Boolean value called <a id="id73" class="indexterm"/>
<code class="literal">isComplete</code>. We can check this value in our function like this:</p><div class="informalexample"><pre class="programlisting">return !item.data.isComplete;</pre></div><p>This takes the record we were passed as <code class="literal">item</code>, and checks the record's data for <code class="literal">isComplete</code>. If a task record is complete this will be <code class="literal">true</code>, so we put the <code class="literal">!</code> character in front to grab only the records where <code class="literal">isComplete</code> is <code class="literal">false</code>. The filter is now complete.</p><p>Take the same steps to add a filter to <code class="literal">CompletedStore</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a filter to <code class="literal">CompletedStore</code>.</li><li class="listitem">Add a function to the filter using <code class="literal">filterFn</code>.</li><li class="listitem">Add the code for the filter function.</li></ol></div><p>In this case, our function just needs to look for tasks where <code class="literal">isComplete</code> is <code class="literal">true</code> (just drop the <code class="literal">!</code> character this time):</p><div class="informalexample"><pre class="programlisting">return item.data.isComplete;</pre></div><p>Both stores will now correctly filter the tasks based on completion.</p><p>While we have been moving these components around on screen, Sencha Architect has been doing a bit of heavy lifting for us on the backend. Let's take a peek behind the curtain and see what's going on with the actual code.</p></div></div>
<div class="section" title="Pay attention to the man behind the curtain"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Pay attention to the man behind the curtain</h1></div></div></div><p>The first thing to look at is on your hard drive where you saved the Task Manager project file. You will notice that the designer has created a number of files here: <code class="literal">app.html</code>, <code class="literal">app.js</code>, and <code class="literal">TaskManager.xds</code>. We also have folders for app and metadata.</p><p>Sencha Architect uses both <code class="literal">TaskManager.xds</code> and the <code class="literal">metadata</code> folder. The <code class="literal">TaskManager.xds</code> file is the main project file you are currently working in and the <code class="literal">metadata</code> folder contains resources for that project file. We can ignore those files for now because the interesting stuff is in the other files.</p><p>Let's start with our <code class="literal">app.html</code> file. <a id="id74" class="indexterm"/>If you open this file in your favorite code editor, you should see something like this:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;

&lt;!-- Auto Generated with Sencha Architect --&gt;
&lt;!-- Modifications to this file will be overwritten. --&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;title&gt;Chapter1&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/touch/sencha-touch-2.1.0/resources/css/sencha-touch.css"/&gt;
    &lt;script type="text/javascript" src="http://extjs.cachefly.net/touch/sencha-touch-2.1.0/sencha-touch-all-debug.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="app.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        if (!Ext.browser.is.WebKit) {
            alert("The current browser is unsupported.\n\nSupported browsers:\n" +
                "Google Chrome\n" +
                "Apple Safari\n" +
                "Mobile Safari (iOS)\n" +
                "Android Browser\n" +
                "BlackBerry Browser"
            );
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;&lt;/body&gt;
&lt;/html&gt;</pre></div><p>This should look pretty familiar to anyone who is used to dealing with HTML and JavaScript. The file creates a basic HTML page, includes the JavaScript and CSS files for Sencha Touch, and also includes our <code class="literal">app.js</code> file (which we will get to in a second).</p><p>The file then sets up some browser detection so that if the user attempts to access the application with a non-WebKit browser, they will be <a id="id75" class="indexterm"/>told that their browser is incompatible and will be given a list of compatible browsers.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>Chrome and Safari are WebKit browsers and are available for Windows and Mac. Chrome is also available on Linux. In this book we will be using Safari for our testing, but the examples will work in Chrome as well.</p></div></div><p>One other thing to note is the message in the comments at the top of <code class="literal">app.html</code>. This particular file is autogenerated each time you save the TaskManager project. If you make changes to it in your code editor, they will be overwritten the next time you save.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>
<span class="strong"><strong>A word about CacheFly</strong></span>
</p><p>CacheFly <a id="id76" class="indexterm"/>is a <a id="id77" class="indexterm"/>
<span class="strong"><strong>CDN</strong></span> (<span class="strong"><strong>Content Delivery Network</strong></span>). They have computers all over the world, and can send files to your users from a server that's close to them, so that the files take less time to travel across the Internet, and therefore less time to load. That also means that you save on your own server bandwidth by not serving those files yourself.</p></div></div><p>Next, let's take a look at our <code class="literal">app.js</code> file:</p><div class="informalexample"><pre class="programlisting">/*
 * File: app.js
 *
 * This file was generated by Sencha Architect version 2.0.0.
 * http://www.sencha.com/products/designer/
 *
 * This file requires use of the Sencha Touch 2.0.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and every time you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.Loader.setConfig({
    enabled: true
});

Ext.application({
    models: [
        'Task'
    ],
    stores: [
        'TaskStore', 'CompletedStore'
    ],
    name: 'MyApp'
});</pre></div><p>Like our HTML file, we start out with a stern warning at the top about hand editing the file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>
<span class="strong"><strong>A word about hand editing</strong></span>
</p><p>Sencha Architect does a lot of <a id="id78" class="indexterm"/>work for you, but that means that it can also accidentally overwrite code that you've written by hand. Your best bet is to wait to add any code yourself until you've fully laid out and configured all of the components for your application with the Architect first.</p></div></div><p>If we skip down past that section, we have a setup function for the Ext.Loader followed by a definition of our application. This includes links to all of our models and stores, as well as the name of our application (which we should probably change once we finish snooping around in the code).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Ext.Loader is a <a id="id79" class="indexterm"/>special part of Sencha Touch that will load JavaScript files as they're needed. Rather than include all of your JavaScript files in the HTML file, Ext.Loader will only load them as they're needed. This drastically cuts down on your application's startup time. You can learn more about <a id="id80" class="indexterm"/>Ext.Loader at <a class="ulink" href="http://www.sencha.com/blog/using-ext-loader-for-your-application">http://www.sencha.com/blog/using-ext-loader-for-your-application</a>.</p></div></div><p>Close the <code class="literal">app.js</code> file and open up the <code class="literal">app</code> folder. As you can see we have two folders called <code class="literal">model</code> and <code class="literal">store</code>. These, of course, contain our code for the model and the store.</p><p>Open the <code class="literal">store/TaskStore.js</code> file first:</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.store.TaskStore', {
    extend: 'Ext.data.Store',
    requires: [
        'MyApp.model.Task'
    ],

    config: {
        autoLoad: true,
        model: 'MyApp.model.Task',
        storeId: 'TaskStore',
        proxy: {
            type: 'localstorage',
            id: 'Tasks'
        }
    },
        filters: {
            filterFn: function(item) {
                return !item.data.isComplete;
            }
        }
});</pre></div><p>Beyond the ever-present warning about hand editing, you will see our store definition written out in plain JavaScript. Note that the store definition not only contains the code for our proxy, it also includes the filter function and it lists our task model as the model for the store.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>
<span class="strong"><strong>Why is it "MyApp.model.Task"?</strong></span>
</p><p>Ext.Loader turns the name of your components into a <a id="id81" class="indexterm"/>filename by turning the periods into slashes. This means that if your component is <code class="literal">MyApp.model.Task</code> then Ext.Loader will look in your application folder for a folder called <code class="literal">MyApp</code>. It will look inside that <code class="literal">MyApp</code> folder for a <code class="literal">model</code> folder that has a <code class="literal">Task.js</code> file in it.</p><p>This is also a good way to keep your application folder organized. If you put all of your models in a <code class="literal">model</code> folder and all of your views in a <code class="literal">view</code> folder then you'll know where to find them when you need to find them later.</p></div></div><p>Close the <code class="literal">TaskStore.js</code> file and let's look at the last file, <code class="literal">model/Task.js</code>. This is the file for our model:</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.model.Task', {
    extend: 'Ext.data.Model',
    config: {
        fields: [
            {
                name: 'id',
                type: 'int'
            },
            {
                name: 'name',
                type: 'string'
            },
            {
                name: 'description',
                type: 'string'
            },
            {
                name: 'created',
                type: 'date'
            },
            {
                name: 'completed',
                type: 'date'
            },
            {
                name: 'isCompleted',
                type: 'boolean'
            }
        
        ]
    }
});</pre></div><p>Notice that there is a fair amount of overlap between what's in the store and what's in the model. This duplication allows the model and store to act independently of each other while still maintaining consistency for the data itself. We will look closer at that when we deal with the forms for our application.</p></div>
<div class="section" title="Architect versus coding by hand"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Architect versus coding by hand</h1></div></div></div><p>As you can see, Sencha Architect generates code for us, but we could also choose to create this exact same code by hand. Sencha Architect offers <a id="id82" class="indexterm"/>benefits to the novice coder by allowing applications to be built visually and allowing the coder to explore the code as needed. The designer also generates code according to Sencha Touch best practices. This keeps the novice user from learning bad habits and encourages cleaner code when the coder needs to begin programming by hand.</p><p>For the seasoned coder, Sencha Touch offers ways to rapidly prototype interfaces and create mockups for clients. The code behind these mockups can then be used outside the designer to create complex applications that might be problematic if not impossible for Sencha Architect to accomplish.</p><p>By using a combination of Sencha Architect and traditional text-based coding, <a id="id83" class="indexterm"/>we hope that this book will offer additional benefits to the reader both in terms of speed and consistency.</p></div>
<div class="section" title="Creating the views"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Creating the views</h1></div></div></div><p>So far, none of our code has actually created anything <a id="id84" class="indexterm"/>on the screen. Now we need to create some visual components for the user to interact with, starting with the main panel that will contain our application.</p><p>Drag a <a id="id85" class="indexterm"/>
<span class="strong"><strong>Tab Panel</strong></span> object out of the <span class="strong"><strong>Toolbox</strong></span> list on the left and drop it onto the iPhone screen in the designer. A <span class="strong"><strong>Panel</strong></span> option will now appear in <span class="strong"><strong>Project Inspector</strong></span>. Select <span class="strong"><strong>Tab Panel</strong></span> and add the following information to the <span class="strong"><strong>Config</strong></span> area:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Make sure the <a id="id86" class="indexterm"/><span class="strong"><strong>initialView</strong></span> checkbox is checked</li><li class="listitem" style="list-style-type: disc">Change <span class="strong"><strong>userClassName</strong></span> from <span class="strong"><strong>myTabPanel</strong></span> to <code class="literal">mainView</code></li><li class="listitem" style="list-style-type: disc">Delete the third tab by right-clicking on it and choosing <span class="strong"><strong>Delete</strong></span></li></ul></div><p>Save the project and let's take another look at the code for your project. In the <code class="literal">app.js</code> file, you will now see the following code:</p><div class="informalexample"><pre class="programlisting">Ext.Loader.setConfig({
    enabled: true
});

Ext.application({
    models: [
        'Task'
    ],
    stores: [
        'TaskStore'
    ],
    views: [
        'MainView'
    ],
    name: 'MyApp',
    launch: function() {
        Ext.create('MyApp.view.MainView', {fullscreen: true});
    }
});</pre></div><p>The designer has now added a <a id="id87" class="indexterm"/>
<code class="literal">launch</code> function that creates an instance of our <code class="literal">MainView</code> panel and sets it to <code class="literal">fullscreen</code>.</p><p>If we take a look in our <code class="literal">app</code> folder, we now see a folder called <code class="literal">view</code>. This folder contains our file for <code class="literal">MainView.js</code>:</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.view.MainView', {
    extend: 'Ext.tab.Panel',

   config: {
        items: [
            {
                xtype: 'container',
                title: 'Tab 1'
            },
            {
                xtype: 'container',
                title: 'Tab 2'
            }
        ]
    }
});</pre></div><p>Right now this file simply defines <code class="literal">MainView</code> as an extension of the standard <code class="literal">Ext.tab.Panel</code> <a id="id88" class="indexterm"/>function and sets the Config containing our two tabs. As we add additional pieces to the panel, they will appear here in the code. <a id="id89" class="indexterm"/>Let's head back to the designer and do just that.</p><div class="section" title="Configuring the Tab Panel"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Configuring the Tab Panel</h2></div></div></div><p>The first thing we should probably do is <a id="id90" class="indexterm"/>rename the tabs. Select <span class="strong"><strong>Tab 1</strong></span> in the <span class="strong"><strong>Project Inspector</strong></span> and then click on the value for <span class="strong"><strong>Title</strong></span> in the <span class="strong"><strong>Config</strong></span> section. Change the title from <span class="strong"><strong>Tab 1</strong></span> to <code class="literal">Current</code> and press <span class="emphasis"><em>Enter</em></span> on your keyboard. Do the same thing for <span class="strong"><strong>Tab 2</strong></span>, changing its title to <code class="literal">Completed</code>.</p><div class="mediaobject"><img src="graphics/8901OS_01_13.jpg" alt="Configuring the Tab Panel"/></div><p>One additional thing we should do is change the tabs to appear on the bottom. This will give our application a more classic iPhone look. To make this <a id="id91" class="indexterm"/>change, select <span class="strong"><strong>mainView</strong></span> in <span class="strong"><strong>Project Inspector</strong></span> and find the <span class="strong"><strong>Tab Bar Config</strong></span> listing in the <span class="strong"><strong>Config</strong></span> section. Click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Tab Bar Config</strong></span> and a new <span class="strong"><strong>Tab Bar</strong></span> option will appear below. Click on the arrow next to the new <span class="strong"><strong>Tab Bar</strong></span> option and the configuration options for it will appear.</p><p>Locate the docked <span class="strong"><strong>Config</strong></span> area and change it from top to bottom. The tabs should drop down to the bottom and give us the large icons familiar to most iPhone users. You can change these icons by clicking on the <span class="strong"><strong>Current</strong></span> or <span class="strong"><strong>Completed</strong></span> tab in <span class="strong"><strong>Project Inspector</strong></span> and changing the <span class="strong"><strong>Config</strong></span> value for <span class="strong"><strong>iconCls</strong></span>. Select the icons you like and save the project (I chose <span class="strong"><strong>organize</strong></span> for the <span class="strong"><strong>Current</strong></span> tab and <span class="strong"><strong>delete</strong></span> for the <span class="strong"><strong>Completed</strong></span> tab).</p><p>Once you are finished, select <span class="strong"><strong>MainView</strong></span> in <span class="strong"><strong>Property Inspector</strong></span> and then click on <span class="strong"><strong>Code</strong></span> in the upper-right side of the designer. This will change the designer over into code view, showing us the contents of our <code class="literal">MainView.js</code> file.</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.view.MainView', {
  extend: 'Ext.tab.Panel',
  config: {
  items: [
    {
        xtype: 'container',
        title: 'Current',
        iconCls: 'organize'
    },
    {
        xtype: 'container',
        title: 'Completed',
        iconCls: 'delete'
    }
  ],
  tabBar: {
    docked: 'bottom'
  }
  }
}); </pre></div><p>You can now see that the tab panel and its two tabs have been added to our <code class="literal">MainView.js</code> file. We also see our <a id="id92" class="indexterm"/>
<code class="literal">tabBar</code> configuration and the <code class="literal">iconCls</code> values we selected.</p></div><div class="section" title="Adding the lists and details"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Adding the lists and details</h2></div></div></div><p>Next, we want to add a list and a panel to each of our tabs. The <a id="id93" class="indexterm"/>
<a id="id94" class="indexterm"/>lists will display the names for our current and completed tasks. The panels will display details for the task when we click on it in the list.</p><p>Let's start by selecting each tab and setting the <span class="strong"><strong>layout</strong></span> property in <span class="strong"><strong>Config</strong></span> to <span class="strong"><strong>card</strong></span>. This will let us easily switch between the <span class="strong"><strong>List</strong></span> and <span class="strong"><strong>Details</strong></span> sections for each tab.</p><p>Next, take a <span class="strong"><strong>List</strong></span> component from the <span class="strong"><strong>Toolbox</strong></span> list and drop one on each tab in <span class="strong"><strong>Property Inspector</strong></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>
<span class="strong"><strong>Dropping items in Property Inspector</strong></span>
</p><p>While most components can be dropped directly onto the design area, it is often better to drop components into <a id="id95" class="indexterm"/>
<span class="strong"><strong>Project Inspector</strong></span>. It's much easier to ensure that you are putting the component within the correct container using <span class="strong"><strong>Property Inspector</strong></span>.</p></div></div><p>Next you will need to take a panel from <span class="strong"><strong>Toolbox</strong></span> and drop one onto each tab, just like we did with the list. This panel will be our details container and it will not appear in the design view because the list is in front. We will create <a id="id96" class="indexterm"/>
<a id="id97" class="indexterm"/>some code later on to swap the list and the container when the user clicks on a task in the list.</p><p>Your <span class="strong"><strong>Property Inspector</strong></span> area should now look something like this:</p><div class="mediaobject"><img src="graphics/8901OS_10.jpg" alt="Adding the lists and details"/></div><p>Notice that the tabs (<span class="strong"><strong>Current</strong></span> and <span class="strong"><strong>Completed</strong></span>) are both indented under the <span class="strong"><strong>mainView</strong></span> tab panel. Each tab also has a list and a panel beneath it. The tabs are children of the <span class="strong"><strong>mainView</strong></span> tab panel and <a id="id98" class="indexterm"/>each tab has two child items; a list and a panel.</p><p>Since we will need to address the lists and the panels in our code, we should probably name them something a bit more descriptive than <span class="strong"><strong>MyList</strong></span> and <span class="strong"><strong>MyPanel</strong></span>. In order to do this, you will need to select each of these items and <a id="id99" class="indexterm"/>
<a id="id100" class="indexterm"/>change the <a id="id101" class="indexterm"/>
<span class="strong"><strong>id</strong></span> property in <span class="strong"><strong>Config</strong></span>. Let's rename them as follows:</p><p>In the <span class="strong"><strong>Current</strong></span> tab, we will call them <code class="literal">CurrentList</code> and <code class="literal">CurrentDetails</code> and in the <span class="strong"><strong>Completed</strong></span> tab, we will call them <code class="literal">CompletedList</code> and <code class="literal">CompletedDetails</code>.</p></div><div class="section" title="Setting up the templates"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Setting up the templates</h2></div></div></div><p>Next we need to set up the templates (called <a id="id102" class="indexterm"/>
<span class="strong"><strong>itemTpl</strong></span> in the <span class="strong"><strong>Config</strong></span> area) for our lists and our details. These templates control how our data will <a id="id103" class="indexterm"/>be laid out on the screen. <a id="id104" class="indexterm"/>Remember that we have the following data items:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>id</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>name</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>description</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>created</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>completed</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>priority</strong></span></li></ul></div><p>We can use any of these values by including them in our template by placing them in curly braces like so:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;{name}&lt;/div&gt;</pre></div><p>We can also use any HTML styling or tags as part of our template. This gives us a great deal of flexibility in controlling the layout of our application.</p><p>To edit the template for our <a id="id105" class="indexterm"/>
<span class="strong"><strong>CurrentList</strong></span> component, select it in <span class="strong"><strong>Project Inspector</strong></span> and a gear icon will appear next to the list in our <span class="strong"><strong>Design</strong></span> view. Click on the gear and you will see a pop-up window with a few configuration options including <span class="strong"><strong>Edit Template</strong></span> at the bottom of the pop-up window. </p><p>When you click on <a id="id106" class="indexterm"/>
<span class="strong"><strong>Edit Template</strong></span>, a text area will appear over the list with the following text:</p><div class="informalexample"><pre class="programlisting">&lt;div&gt;List Item {string}&lt;/div&gt;</pre></div><p>Change this text to:</p><div class="informalexample"><pre class="programlisting">&lt;div class="priority_{priority}"&gt;{name}&lt;/div&gt; </pre></div><p>Click on <span class="strong"><strong>Done Editing</strong></span> when you are finished. The list items will appear empty for now, but we will fix that a bit later.</p><p>Next, click on the <a id="id107" class="indexterm"/>
<span class="strong"><strong>CurrentDetails</strong></span> panel in <span class="strong"><strong>Project Inspector</strong></span> and edit the template the same way you did for <span class="strong"><strong>CurrentList</strong></span>. Set the template for the <span class="strong"><strong>CurrentDetails</strong></span> to:</p><div class="informalexample"><pre class="programlisting">&lt;div class="taskName"&gt;{name}&lt;/div&gt; 
&lt;div class="taskDescription"&gt;{description}&lt;/div&gt; 
&lt;div class="taskCreated"&gt;Created: {created}&lt;/div&gt;</pre></div><p>Click on <span class="strong"><strong>Done Editing</strong></span> when you are finished.</p><p>When you are finished with the <span class="strong"><strong>CurrentDetails</strong></span>, we want to <a id="id108" class="indexterm"/>follow the same steps for <a id="id109" class="indexterm"/>
<span class="strong"><strong>CompletedList</strong></span> and <span class="strong"><strong>CompletedDetails</strong></span>. You can keep the list template the same but we should include the completed date on our details page like so:</p><div class="informalexample"><pre class="programlisting">&lt;div class="taskName"&gt;{name}&lt;/div&gt; 
&lt;div class="taskDescription"&gt;{description}&lt;/div&gt; 
&lt;div class="taskCreated"&gt;Created: {created}&lt;/div&gt;
&lt;div class="taskCompleted"&gt;Completed: {completed}&lt;/div&gt;</pre></div></div><div class="section" title="Testing with starter data"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Testing with starter data</h2></div></div></div><p>You will notice that since we have no records, we have nothing to display. This can make testing our application difficult, so we are going to add a few <a id="id110" class="indexterm"/>test records to our application using the <code class="literal">launch</code> method.</p><p>Select <span class="strong"><strong>Application</strong></span> in <span class="strong"><strong>Project Inspector</strong></span> and then locate <span class="strong"><strong>launch</strong></span> down in the <span class="strong"><strong>Config</strong></span> section. Click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>launch</strong></span> to add a new launch function, and then click on the arrow next to our new launch function to open it. This <a id="id111" class="indexterm"/>will open the code editor with:</p><div class="informalexample"><pre class="programlisting">launch: function() {

}</pre></div><p>Add the following code inside the <code class="literal">launch</code> function:</p><div class="informalexample"><pre class="programlisting">var TaskStore = Ext.data.StoreManager.lookup('TaskStore');
var CompletedStore = Ext.data.StoreManager.lookup('CompletedStore');
if(CompletedStore.getCount()+TaskStore.getCount() === 0) {
    console.log('we have no records');
    TaskStore.add({name: 'Here Is A Task', description: 'You can mark the task complete by clicking the Completed button below.', priority: 1, created: Date.now(), completed: '', isComplete: false});
    TaskStore.add({name: 'How To Edit A Task', description: 'You can edit the task by clicking the Edit button below.', priority: 2, created: Date.now(), completed: '', isCompleted: false});
    TaskStore.add({name: 'How To Add A Task', description: 'Add a task by clicking the Add button in the upper right corner.', priority: 3, created: Date.now(), completed: '', isComplete: false});
    TaskStore.sync();
} else {
    console.log('we have records');
}</pre></div><p>This code will grab our two stores, TaskStore and Completed Store, and check to see if there are any records. If there are no records, the function will add three new records, and then sync the store to save the records. These task records <a id="id112" class="indexterm"/>can also serve as a set of three instructions to new users opening the application for the <a id="id113" class="indexterm"/>first time.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>
<span class="strong"><strong>Console logs</strong></span>
</p><p>The <code class="literal">console.log</code> <a id="id114" class="indexterm"/>command is your best friend when programming. It will print text and objects to the error console in Safari or Chrome. This is critical for debugging any issues you have. In the previous code, the console logs will print based on whether we get back records or not. We could also use <code class="literal">console.log(TaskStore)</code> <a id="id115" class="indexterm"/>to get a display of every attribute of that store object. This is really handy for making sure you actually have the object you think you have.</p></div></div><p>Now when you open up the <code class="literal">app.html</code> file in your browser, you should see the following in the <span class="strong"><strong>TaskMaster</strong></span> application:</p><div class="mediaobject"><img src="graphics/8901OS_11.jpg" alt="Testing with starter data"/></div><p>We now have tasks to view, but we still can't get to the details. We need to add a function to switch the view between our list and our details.</p><p>Back in Sencha Architect, click on <span class="strong"><strong>CurrentList</strong></span> in <span class="strong"><strong>Project Inspector</strong></span> and then look for <span class="strong"><strong>Events</strong></span> at the top of the <span class="strong"><strong>Config</strong></span> section. Click on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Events</strong></span> to add a new event listener. Use the menu that appears to choose the <a id="id116" class="indexterm"/>
<span class="strong"><strong>select</strong></span> event. Click on the arrow next the new <span class="strong"><strong>select</strong></span> event to edit the code. The code editor will appear with the following code:</p><div class="informalexample"><pre class="programlisting">onCurrentListSelect: function(dataview, record, options) {

}</pre></div><p>Add the following code to the <code class="literal">select</code> event:</p><div class="informalexample"><pre class="programlisting">  var currentTab = this.getActiveItem();
  
  var currentDetails = currentTab.down('panel');
  
  currentDetails.setRecord(record);
  currentTab.setActiveItem(currentDetails);</pre></div><p>The first line grabs our <code class="literal">Current</code> tab and the second grabs our <a id="id117" class="indexterm"/>
<code class="literal">CurrentDetails</code> panel. We then set the record on the details panel to the record we are passed as part of the <code class="literal">select</code> function (the record from our list). Finally, we switch the card layout of our current tab to the <code class="literal">CurrentDetails</code> panel, hiding <code class="literal">CurrentList</code>.</p><p>We need to do the same thing with our <a id="id118" class="indexterm"/>
<code class="literal">CompletedList</code> component. Add the new <span class="strong"><strong>select</strong></span> event and set the code to:</p><div class="informalexample"><pre class="programlisting">var completedTab = this.getActiveItem();

var completedDetails = completedTab.down('panel');

completedDetails.setRecord(record);
completedTab.setActiveItem(completedDetails);</pre></div><p>If we test this in the browser we should be able to see our details panel when we click on an item in the list. This also brings us to our next challenge; we need a way to get back to our list.</p><p>In this chapter, we will create the back button manually and in the next chapter we will highlight a different approach to this same problem. For now, let's add a new button to our toolbar.</p></div><div class="section" title="Adding the back button"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Adding the back button</h2></div></div></div><p>Grab a <span class="strong"><strong>toolbar</strong></span> object from <span class="strong"><strong>Toolbox</strong></span> and drag it over <a id="id119" class="indexterm"/>onto the <span class="strong"><strong>mainView</strong></span> tab panel. Grab a <span class="strong"><strong>button</strong></span> <a id="id120" class="indexterm"/>object from <span class="strong"><strong>Toolbox</strong></span> and drag it onto the new <span class="strong"><strong>toolbar</strong></span> panel.</p><p>Next, we want to give our toolbar a title. Let's select the toolbar and change the title in the <span class="strong"><strong>Config</strong></span> section to <code class="literal">TaskMaster</code>.</p><p>Next we need to change a few things with our button. Select the <a id="id121" class="indexterm"/>
<span class="strong"><strong>Button</strong></span> object and make the following changes to its <span class="strong"><strong>Config</strong></span> section:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Change <span class="strong"><strong>text</strong></span> to <span class="strong"><strong>Back</strong></span></li><li class="listitem" style="list-style-type: disc">Change the <span class="strong"><strong>id</strong></span> to <span class="strong"><strong>backButton</strong></span></li><li class="listitem" style="list-style-type: disc">Change the <span class="strong"><strong>ui</strong></span> to <span class="strong"><strong>back</strong></span> (this will make it look like a typical back button)</li><li class="listitem" style="list-style-type: disc">Check the box next to the <span class="strong"><strong>hidden</strong></span> property (we want the button hidden by default)<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>
<span class="strong"><strong>I can't find one of the Config options</strong></span>
</p><p>If you are unable to find some of these properties, you may need to toggle the <span class="strong"><strong>Config</strong></span> section between <span class="strong"><strong>Show Common Configs</strong></span> and <span class="strong"><strong>Show All Configs</strong></span> using the two buttons in the upper-right corner of the <a id="id122" class="indexterm"/>
<span class="strong"><strong>Config</strong></span> section.</p></div></div></li></ul></div><p>Now that we have a back button, we need to make it do something. Add a tap listener by clicking on the <span class="strong"><strong>+</strong></span> button next to events in the button's <span class="strong"><strong>Config</strong></span> section. Select <span class="strong"><strong>tap</strong></span> and then click on the arrow next to the tap event that <a id="id123" class="indexterm"/>appears.</p><p>Edit the back button code to look like this:</p><div class="informalexample"><pre class="programlisting">onBackButtonTap: function(button, e, options) {
  var currentTab = this.getActiveItem();
  currentTab.setActiveItem(0);
  button.hide();
}</pre></div><p>By grabbing <a id="id124" class="indexterm"/>
<code class="literal">this.getActiveItem()</code> we grab the active tab in our <code class="literal">MainView</code> tab panel, which makes sure that the button will work correctly for both of our lists. We set the active item to the first item in the active tab. Finally, we hide the button so that it does not show up in our list view.</p><p>The last part we need to take care of is showing the button when we click an item in the list. Click on the <a id="id125" class="indexterm"/>
<span class="strong"><strong>select</strong></span> event for our current panel and add <a id="id126" class="indexterm"/>the following to our <a id="id127" class="indexterm"/>
<code class="literal">select</code> function:</p><div class="informalexample"><pre class="programlisting">var backButton = Ext.getCmp('backButton');
backButton.show();</pre></div><p>You will want to add the exact same button code to our <span class="strong"><strong>select</strong></span> event in the <span class="strong"><strong>CompletedList</strong></span> component. <a id="id128" class="indexterm"/>Just copy, open the select event for <span class="strong"><strong>CompletedList</strong></span>,and paste.</p><p>Our lists and details are now complete. Now we need to be able to add, edit, and mark tasks as complete.</p></div></div>
<div class="section" title="Creating the forms"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Creating the forms</h1></div></div></div><p>Before we start creating forms we need to add a <a id="id129" class="indexterm"/>button to our <span class="strong"><strong>MainView</strong></span> toolbar that will display the form for adding new tasks.</p><p>Drag a <span class="strong"><strong>Button</strong></span> object out from the <span class="strong"><strong>Toolbox</strong></span> list and drop it on the <span class="strong"><strong>TaskMaster</strong></span> toolbar. The new button should appear next to <span class="strong"><strong>backButton</strong></span>. We probably want to move that over to the other side of our title, so we need to drag a <span class="strong"><strong>Spacer</strong></span> out of <span class="strong"><strong>Toolbox</strong></span> and drop it between our new button and <span class="strong"><strong>backButton</strong></span>. <a id="id130" class="indexterm"/>
<span class="strong"><strong>Spacer</strong></span> will push the new button to the right side of the screen.</p><p>Next we need to change the following <span class="strong"><strong>Config</strong></span> properties for the new button:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>text</strong></span> to <span class="strong"><strong>Add</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>itemId</strong></span> to <span class="strong"><strong>addButton</strong></span></li></ul></div><p>We will come back and add a <code class="literal">tap</code> function once we <a id="id131" class="indexterm"/>complete our forms.</p><div class="section" title="Add Task form"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Add Task form</h2></div></div></div><p>To create our Add Task form we will add a new form panel to the <span class="strong"><strong>Current</strong></span> tab. Drag a <span class="strong"><strong>Form Panel</strong></span> from the toolbox and drop it on our <span class="strong"><strong>Current</strong></span> tab. <a id="id132" class="indexterm"/>The panel should appear below our <span class="strong"><strong>CurrentList</strong></span> and <span class="strong"><strong>CurrentDetails</strong></span> panels.</p><p>Next we need to drag some fields into our form so let's start with <a id="id133" class="indexterm"/>dropping a <a id="id134" class="indexterm"/>
<span class="strong"><strong>Text Field</strong></span> object on the <span class="strong"><strong>MyFormPanel</strong></span> panel and <a id="id135" class="indexterm"/>changing the following <span class="strong"><strong>Config</strong></span> properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>name</strong></span> to <span class="strong"><strong>name</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>label</strong></span> to <span class="strong"><strong>Name</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>id</strong></span> to <span class="strong"><strong>name</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>margin</strong></span> to <span class="strong"><strong>3</strong></span></li></ul></div><p>Next, add a <span class="strong"><strong>Text Area</strong></span> object to our <a id="id136" class="indexterm"/>
<span class="strong"><strong>MyFormPanel</strong></span> panel and set the following <span class="strong"><strong>Config</strong></span> properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>name</strong></span> to <span class="strong"><strong>description</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>label</strong></span> to <span class="strong"><strong>Description</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>id</strong></span> to <span class="strong"><strong>description</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>margin</strong></span> to <span class="strong"><strong>3</strong></span></li></ul></div><p>Now, we need to add a <a id="id137" class="indexterm"/>
<span class="strong"><strong>Select Field</strong></span> object to <span class="strong"><strong>MyFormPanel</strong></span> and set the following <span class="strong"><strong>Config</strong></span> properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>name</strong></span> to <span class="strong"><strong>priority</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>label</strong></span> to <span class="strong"><strong>Priority</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>id</strong></span> to <span class="strong"><strong>priority</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>margin</strong></span> to 3</li></ul></div><p>We also need to add some options for <span class="strong"><strong>Select Field</strong></span>. Locate <span class="strong"><strong>Options</strong></span> in the <span class="strong"><strong>Config</strong></span> properties and click to edit. The <a id="id138" class="indexterm"/>
<span class="strong"><strong>Options</strong></span> property expects an object as its value, in this case an array of name-value pairs like this:</p><div class="informalexample"><pre class="programlisting">[{text: 'High',  value: 1},
{text: 'Medium', value: 2},
{text: 'Low',  value: 3}]</pre></div><p>By default, the <span class="strong"><strong>Select Field</strong></span> uses text for display and value for the submitted value. You can change this by editing the <span class="strong"><strong>displayField</strong></span> and <span class="strong"><strong>valueFields</strong></span> in the <span class="strong"><strong>Config</strong></span> properties, but we can leave these as the defaults for our application.</p><p>We can save ourselves a lot of work if we use this form for both adding new tasks and editing existing ones. To do this we also need to add a hidden field to hold the ID value of any existing tasks that we edit.</p><p>Add a <a id="id139" class="indexterm"/>
<span class="strong"><strong>Hidden Field</strong></span> object to <span class="strong"><strong>MyFormPanel</strong></span> and set the <a id="id140" class="indexterm"/>properties for <span class="strong"><strong>id</strong></span> and <span class="strong"><strong>name</strong></span> to <span class="strong"><strong>id</strong></span> in the <span class="strong"><strong>Config</strong></span> section. We will use this later when saving the form.</p><p>The last thing we need in our form is two buttons; one for save <a id="id141" class="indexterm"/>and one for cancel. Add the buttons and make the <a id="id142" class="indexterm"/>following changes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>text</strong></span> for <span class="strong"><strong>button 1</strong></span> to <span class="strong"><strong>Save</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>itemID</strong></span> for <span class="strong"><strong>button 1</strong></span> to <span class="strong"><strong>SaveButton</strong></span> </li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>margin</strong></span> for <span class="strong"><strong>button 1</strong></span> to <span class="strong"><strong>10</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>text</strong></span> for <span class="strong"><strong>button 2</strong></span> to <span class="strong"><strong>Cancel</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>itemID</strong></span> for <span class="strong"><strong>button 2</strong></span> to <span class="strong"><strong>CancelButton</strong></span></li><li class="listitem" style="list-style-type: disc">Set <span class="strong"><strong>margin</strong></span> for <span class="strong"><strong>button 2</strong></span> to <span class="strong"><strong>10</strong></span></li></ul></div><p>The structure and the form should look something like this:</p><div class="mediaobject"><img src="graphics/8901OS_12.jpg" alt="Add Task form"/></div><p>Next, we will add a tap event handler to each button <a id="id143" class="indexterm"/>using the <span class="strong"><strong>Event</strong></span> section of the <span class="strong"><strong>Config</strong></span> as before.</p><p>For our <a id="id144" class="indexterm"/>
<span class="strong"><strong>Cancel</strong></span> button, set the <code class="literal">event</code> function to:</p><div class="informalexample"><pre class="programlisting">var currentTab = this.getActiveItem(); 
currentTab.setActiveItem(0);</pre></div><p>This code grabs our <span class="strong"><strong>Current</strong></span> tab and sets the active panel back to <span class="strong"><strong>CurrentList</strong></span>.</p><p>The <a id="id145" class="indexterm"/>
<span class="strong"><strong>Save</strong></span> button is a bit more complex. As we mentioned <a id="id146" class="indexterm"/>
<a id="id147" class="indexterm"/>earlier, we want to use this form for both adding new tasks and editing existing ones. This means we need to check to see if the <span class="strong"><strong>Hidden Field</strong></span> <a id="id148" class="indexterm"/>value of our <a id="id149" class="indexterm"/>form is set and save the task correctly.</p><p>Add the following code to the <a id="id150" class="indexterm"/>
<span class="strong"><strong>SaveButton</strong></span> tap event function:</p><div class="informalexample"><pre class="programlisting">var currentTab = this.getActiveItem();
var formPanel = currentTab.getActiveItem();

var values = formPanel.getValues();

var store = Ext.data.StoreManager.lookup('TaskStore');

if(values.id === null) {
    var record = Ext.ModelMgr.create(values, 'MyApp.model.Task');
    record.set('created', new Date());
    store.add(record);
} else {
    var record = store.getById(values.id);
    record.set('name', values.name);
    record.set('description', values.description);
    record.set('priority', values.priority);
}

store.sync();
formPanel.reset();
currentTab.setActiveItem(0);</pre></div><p>Our first two lines grab <code class="literal">currentTab</code> and <code class="literal">formPanel</code>. We then get the values from <code class="literal">formPanel</code> and <code class="literal">store</code> that we need to save our data to.</p><p>We check the value of our hidden field to see if it has been set. <a id="id151" class="indexterm"/>This will be <code class="literal">true</code> if we are editing, but not if we are adding a new task.</p><p>If we are adding a new task, we create a new <code class="literal">record</code> option using the <code class="literal">values</code> form in the form field, we set a create date, and add <code class="literal">record</code> to <code class="literal">store</code>.</p><p>If we are editing an existing record, we use the <code class="literal">id</code> value <a id="id152" class="indexterm"/>from our <code class="literal">store</code> to get the <code class="literal">record</code> from the <code class="literal">store</code>. We then set the <code class="literal">name</code>, <code class="literal">description</code>, and <code class="literal">priority</code> values of <code class="literal">record</code> from our form <code class="literal">values</code>.</p><p>Finally, we sync our <code class="literal">store</code> to save the <code class="literal">record</code>, clear out our form <code class="literal">values</code> and close the form by setting the active item back to our <code class="literal">CurrentList</code> view (<code class="literal">0</code>).</p></div><div class="section" title="Editing and completing a task"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Editing and completing a task</h2></div></div></div><p>For <a id="id153" class="indexterm"/>editing a task, we are going to use the form we just created, but we need to load it up with the currently selected record. <a id="id154" class="indexterm"/>For completing a task, we just need a button.</p><p>To do this we will add a toolbar with two buttons to our <span class="strong"><strong>CurrentDetails</strong></span> panel. We should probably add a <span class="strong"><strong>Spacer</strong></span> object between the two <a id="id155" class="indexterm"/>buttons like we did with our previous toolbar.</p><p>Each button also needs a <span class="strong"><strong>tap</strong></span> event added to it in the <span class="strong"><strong>Config</strong></span> section, <a id="id156" class="indexterm"/>under <span class="strong"><strong>Events</strong></span>.</p><p>For the <span class="strong"><strong>Edit</strong></span> button, set the <a id="id157" class="indexterm"/>
<span class="strong"><strong>tap</strong></span> function to:</p><div class="informalexample"><pre class="programlisting">var currentTab = this.getActiveItem();
var DetailsPanel = currentTab.getActiveItem();

currentTab.setActiveItem(2);
var formPanel = currentTab.getActiveItem();
formPanel.setRecord(DetailsPanel.getRecord());

this.setActiveItem(currentTab);

var backButton = Ext.getCmp('backButton');
backButton.hide();</pre></div><p>This code grabs <code class="literal">record</code> from the <a id="id158" class="indexterm"/>
<code class="literal">DetailsPanel</code> panel and loads this into <code class="literal">formPanel</code>. Setting this <code class="literal">record</code> on the form also sets the value of our hidden field to the correct <code class="literal">id</code> value for our record. We then display the form as before and hide the <span class="strong"><strong>Back</strong></span> button.</p><p>For our Complete Task button, we need to get <code class="literal">record</code> from <code class="literal">DetailsPanel</code> and set the values for <code class="literal">completed</code> (a date) and <a id="id159" class="indexterm"/>
<code class="literal">isCompleted</code> (a Boolean). We do that by setting the tap event function to this:</p><div class="informalexample"><pre class="programlisting">var currentTab = this.getActiveItem();
var detailsPanel = currentTab.getActiveItem();

var record = detailsPanel.getRecord();

record.set('completed', new Date());
record.set('isComplete', true);

var store = Ext.data.StoreManager.lookup('TaskStore');
store.sync();

this.setActiveItem(1);
var completedList = this.getActiveItem();
var completedStore = completedList.getActiveItem().getStore();
completedStore.add(record);
completedList.getActiveItem().refresh();

currentTab.setActiveItem(0);

var backButton = Ext.getCmp('backButton');
backButton.hide();</pre></div><p>This gets our <code class="literal">record</code> as before, sets our two values, and syncs <code class="literal">TaskStore</code>. This sync will also cause the filter on <code class="literal">TaskStore</code> to prevent the record from displaying in our <code class="literal">Current</code> list.</p><p>Next we add the record to <code class="literal">CompletedStore</code> and refresh the view for our <code class="literal">completed</code> list. We finish up by returning the user to the <span class="strong"><strong>Current</strong></span> list and <a id="id160" class="indexterm"/>
<a id="id161" class="indexterm"/>hiding the <span class="strong"><strong>Back</strong></span> button.</p></div><div class="section" title="Testing the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>Testing the application</h2></div></div></div><p>If we did everything correctly, you should be able to <a id="id162" class="indexterm"/>open the <code class="literal">app.html</code> file in Safari (or Chrome) and test the application. Try putting the editing and marking tasks as completed. Be sure to use the JavaScript console in your browser to track down issues and view errors.</p><div class="mediaobject"><img src="graphics/8901OS_13.jpg" alt="Testing the application"/></div></div></div>
<div class="section" title="Extra credit"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Extra credit</h1></div></div></div><p>Task managing applications come in a variety of designs, with a wide variety of features. Everyone seems to have their own preference for tracking tasks. You can use this application as a base for your own personal task management application. These are a few ideas for taking the application to the next level:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add styles in the CSS file based on the priority of the tasks in the list and details</li><li class="listitem" style="list-style-type: disc">Add a way to sort the tasks by date and priority</li><li class="listitem" style="list-style-type: disc">Customize the <code class="literal">CurrentDetails</code> and <code class="literal">CompletedDetails</code> templates to add icons for priority</li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Summary</h1></div></div></div><p>In this chapter we discussed the basic setup for an application using local storage, including:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The basics of the Sencha Architect application</li><li class="listitem" style="list-style-type: disc">Creating data stores to use local storage and a task model</li><li class="listitem" style="list-style-type: disc">Creating lists and details for our data stores to use</li><li class="listitem" style="list-style-type: disc">Creating events to switch between the <span class="strong"><strong>List</strong></span> and <span class="strong"><strong>Details</strong></span> views</li><li class="listitem" style="list-style-type: disc">Creating buttons to control navigation and launch our forms</li><li class="listitem" style="list-style-type: disc">Creating forms for editing and adding new tasks</li></ul></div><p>In the next chapter we will take a look at using layouts and templates to create a more complex and visually appealing application.</p></div></body></html>