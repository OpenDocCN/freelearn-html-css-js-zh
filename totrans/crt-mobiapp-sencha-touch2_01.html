<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. A Simple Task List</h1></div></div></div><p>At its core, most programming tasks fall into three <a id="id0" class="indexterm"/>categories: data display, data entry, and data storage. We will start our first project with the goal of covering how Sencha Touch handles each of these three basic categories. To do this, we will create a common programming application, the to-do list, or task list.</p><p>In this application, we will use the local storage available in HTML5 to store tasks including a name, description, creation date, completing date, and priority. We will then create a task list for displaying the current tasks as well as our completed tasks. We will discuss ways to test your display and to manage errors. We will then create the forms for entering in new tasks, editing existing tasks, and marking a task as complete.</p><p>Finally, we will explore some of the possible additional features for this type of application in our Extra Credit section.</p><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>A brief overview of Sencha Architect</h1></div></div></div><p>Sencha Architect is a cross-platform <a id="id1" class="indexterm"/>visual development tool for Sencha Touch and Ext JS. Sencha Architect is available for Mac, Windows, and Linux, and it can be downloaded at the following <a id="id2" class="indexterm"/>link:</p><p>
<a class="ulink" href="http://www.sencha.com/products/architect">http://www.sencha.com/products/architect</a>
</p><p>For most of the chapters in this book we will be using a combination of Sencha Architect and standard coding to create our projects. This will give you an idea of some of the powerful advantages of the designer, while not hiding any of the actual code.</p><p>This is actually one of the key benefits of Sencha Architect; <a id="id3" class="indexterm"/>while it allows you to rapidly create interfaces and test them, behind the scenes the designer is generating standard JavaScript files, which you can edit with any text editor. This advantage allows you to quickly assemble the basic elements of your application, while maintaining the ability to tweak the code by hand as needed. We will cover this a bit more later on, but for now let's take a look at how Sencha Architect is set up.</p><p>When you first launch Sencha Architect, you are <a id="id4" class="indexterm"/>presented with a dialog box where you can choose to work on a new Ext JS project or a new Sencha Touch project, or you can choose from a list of existing projects:</p><div><img src="img/8901OS_01_01.jpg" alt="A brief overview of Sencha Architect"/></div><p>Since we are concerned with Sencha Touch in this book, you should select a <a id="id5" class="indexterm"/>new Sencha Touch 2.1 project.</p><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>
<strong>The difference between Ext JS and Sencha Touch</strong>
</p><p>Both ExtJ S and Sencha Touch are products created by the company Sencha Inc. Where Sencha Touch is used to develop mobile <a id="id6" class="indexterm"/>
<a id="id7" class="indexterm"/>applications for various devices, Ext JS is used to create web applications for desktop browsers such as Firefox, Chrome, or Internet Explorer. For this book, we'll stick with Sencha Touch.</p></div></div><p>Once you have chosen your new project type, the Sencha Architect window will open. This window contains a visual display of the application and allows us to modify the application using drag-and-drop as well as directly entering code.</p><div><img src="img/8901OS_01_02_New.jpg" alt="A brief overview of Sencha Architect"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>The Toolbox</h2></div></div></div><p>The <strong>Toolbox</strong> section of <a id="id8" class="indexterm"/>Sencha Architect is where you will find all of the components offered by Sencha Touch. These components are listed in alphabetical order on the right side of the <strong>Toolbox</strong> section, while the basic types of components are listed on the left side. Clicking on one of these component types will limit the list to that particular type.</p><div><img src="img/8901OS_01_03.jpg" alt="The Toolbox"/></div><p>The following types are provided by default:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Behaviors</strong>: It provides empty <a id="id9" class="indexterm"/>containers for <a id="id10" class="indexterm"/>functions and controllers</li><li class="listitem" style="list-style-type: disc"><strong>Charts</strong>: It is a collection of graphs and <a id="id11" class="indexterm"/>charts that can <a id="id12" class="indexterm"/>pull data directly from a store</li><li class="listitem" style="list-style-type: disc"><strong>Containers</strong>: It contains elements such <a id="id13" class="indexterm"/>as <a id="id14" class="indexterm"/>panels, tab panels, carousels, and field sets</li><li class="listitem" style="list-style-type: disc"><strong>Data</strong>: It contains data-driven <a id="id15" class="indexterm"/>pieces <a id="id16" class="indexterm"/>such as stores, proxies, readers, writers, and filters</li><li class="listitem" style="list-style-type: disc"><strong>Forms</strong>: It contains basic <a id="id17" class="indexterm"/>form <a id="id18" class="indexterm"/>elements such as text fields, radio buttons, select fields, and buttons</li><li class="listitem" style="list-style-type: disc"><strong>Models</strong>: It includes the basic <a id="id19" class="indexterm"/>data model, <a id="id20" class="indexterm"/>validations, fields, proxies, readers, and writers</li><li class="listitem" style="list-style-type: disc"><strong>Resources</strong>: It allows you to add external <a id="id21" class="indexterm"/>files for <a id="id22" class="indexterm"/>JavaScript and CSS, as well as packaging files for compiled applications</li><li class="listitem" style="list-style-type: disc"><strong>Trees</strong>: Trees are the store types needed for <a id="id23" class="indexterm"/>nested <a id="id24" class="indexterm"/>tree components</li><li class="listitem" style="list-style-type: disc"><strong>Views</strong>: It contains all of the basic viewable <a id="id25" class="indexterm"/>components in <a id="id26" class="indexterm"/>Sencha Touch such as containers, form fields, media, pickers, toolbars, lists, and buttons</li></ul></div><p>There is also the <a id="id27" class="indexterm"/>
<strong>Everything</strong> option to show all the types in the list.</p><p>You can also use the <a id="id28" class="indexterm"/>
<strong>+</strong> button in the <a id="id29" class="indexterm"/>
<strong>CUSTOM</strong> section to add your own custom types for limiting the list. This is very helpful for frequently used components, or simply for customizing the lists to fit your own personal habits.</p><p>Once a custom type is created, you can just drag components over from the list on the right, and drop them into your custom type.</p><p>Components can also be searched directly by name using the <strong>Filter...</strong> field at the top of the toolbox area.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>The help section</h2></div></div></div><p>When any component is selected from the toolbox the <a id="id30" class="indexterm"/>help section directly below it will display <a id="id31" class="indexterm"/>information for the component.</p><p>There is also a blue link at the bottom of the help area that says <a id="id32" class="indexterm"/>
<strong>See Class Documentation</strong>. Clicking on this link will take you to the Sencha website documentation for the specific component that you have selected. This documentation is an invaluable source of information and you should familiarize yourself with it as quickly as possible.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>The design area</h2></div></div></div><p>The design area is where we will begin creating our first <a id="id33" class="indexterm"/>application. By default, a Sencha <a id="id34" class="indexterm"/>Touch application starts out with an iPhone 320 x 480 layout. This layout can be changed to be displayed as an iPad, Nexus S, or Kindle Fire display size. This allows you to look at your design under multiple devices. You can also set the orientation of the device and zoom in and out of the design view area.</p><div><img src="img/8901OS_01_04_New.jpg" alt="The design area"/></div><p>The design area also offers an option to view and work with the code behind the design. This is a great learning tool if you're just getting into mobile programming. By switching between the <strong>Design</strong> and <strong>Code</strong> view, you can examine complex <a id="id35" class="indexterm"/>
<a id="id36" class="indexterm"/>layouts and see exactly how the JavaScript code is used to create them.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>The Project Inspector area</h2></div></div></div><p>The <a id="id37" class="indexterm"/>Project Inspector area provides an alternative view to your project's code. As you drag components onto the design area they will also appear in <strong>Project Inspector</strong>. The <a id="id38" class="indexterm"/>
<strong>Project Inspection</strong> area will display these components as a hierarchical list. This is often very helpful in seeing which components are nested inside of other components.</p><div><img src="img/8901OS_01_05.jpg" alt="The Project Inspector area"/></div><p>Components can also be dragged from the <strong>Toolbox</strong> list into <strong>Project Inspector</strong>. It is often easier to manage certain components by dropping them into <strong>Project Inspector</strong>, rather than the design area. This can ensure that you correctly position the <a id="id39" class="indexterm"/>
<a id="id40" class="indexterm"/>component within the required container.</p><div><div><h3 class="title"><a id="note02"/>Note</h3><p>The <a id="id41" class="indexterm"/>
<strong>Resources</strong> section is a new addition in Version 2.1, and it allows you to add external files to your project. If you have an older Version 2.0 Sencha Touch project, you can right-click on <strong>Library</strong> and select <strong>Upgrade</strong> to change the project to a newer Sencha Touch 2.1 project.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>The Config area</h2></div></div></div><p>The <strong>Config</strong> area will display all the configuration options <a id="id42" class="indexterm"/>for any component selected in the <a id="id43" class="indexterm"/>design area or in <strong>Project Inspector</strong>. All of the typical configuration options, such as height, width, layout, ID, padding, margin, events, and functions can be accessed from the <strong>Config</strong> area.</p><div><img src="img/8901OS_6.jpg" alt="The Config area"/></div><p>The configuration name is listed on the left and the value is on the right. Clicking on the value will allow you to edit it. You can also click on the <strong>+</strong> next to <a id="id44" class="indexterm"/>
<a id="id45" class="indexterm"/>certain sections such as <strong>Functions</strong> and <strong>Events</strong> to add new items to <strong>Config</strong>.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Getting started with the task list</h1></div></div></div><p>To see how all of these pieces work together to create an application, let's start by creating our data store for the Task Manager application. <a id="id46" class="indexterm"/>Save the new file you have opened as <code class="literal">TaskList</code> and let's get to work on adding some components.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Creating the data store</h2></div></div></div><p>To add a component to the project, we need to drag the component from the toolbox and drop it on the project or onto the proper section of the project <a id="id47" class="indexterm"/>inspector. For our first component, let's <a id="id48" class="indexterm"/>choose a plain data store.</p><p>From <strong>Toolbox</strong>, select <strong>Data</strong>, and then click on <a id="id49" class="indexterm"/>
<strong>Store</strong> and drag it onto our iPhone in the design area. You should now see a store called <a id="id50" class="indexterm"/>
<strong>MyStore</strong> appear in the <strong>Property</strong> <strong>Inspector</strong> under the <strong>Stores</strong> list:</p><div><img src="img/8901OS_01_07.jpg" alt="Creating the data store"/></div><p>You will also notice that there is a red warning icon next to our store. This tells us that our store is missing a few of its required components. In this case, the store needs a proxy to control how the data is sent and received and it needs a model to tell it what data to expect.</p><p>From the <strong>Toolbox</strong> list, select a <a id="id51" class="indexterm"/>
<strong>LocalStorage Proxy</strong> object and drag it over onto our store.</p><p>You will probably notice that some components can only be placed within other components. For example, when you drag the proxy over, you can't just drop it into the iPhone diagram like we did before. A proxy component will only exist as part of a data store. This means that you have to drop a proxy component onto a <a id="id52" class="indexterm"/>
<a id="id53" class="indexterm"/>data store in <strong>Property Inspector</strong> in order for it to correctly add itself to the store.</p><p>Once you have dropped the proxy onto the store, we need to add a model, and link it to our store.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Adding a Model, Fields, and Field Types</h2></div></div></div><p>In the <strong>Data</strong> section of our <strong>Toolbox</strong>, scroll up to find the listing for <strong>Model</strong>. Drag the <strong>Model</strong> object over to the <strong>Models</strong> section of our <strong>Project Inspector</strong>. This will create a new model called <a id="id54" class="indexterm"/>
<strong>MyModel</strong>.</p><p>Select <strong>MyModel</strong> in <strong>Project Inspector</strong> and look at the <a id="id55" class="indexterm"/>
<strong>Config</strong> section. <a id="id56" class="indexterm"/>
<a id="id57" class="indexterm"/>
<a id="id58" class="indexterm"/>The first thing we probably want to change here is the name. Click on the value listed for <strong>userClassName</strong>, <a id="id59" class="indexterm"/>change <strong>MyModel</strong> to <code class="literal">Task</code> and press <em>Enter</em> on your keyboard. The model should now be listed as <strong>Task</strong> in both <strong>Config</strong> and <strong>Project Inspector</strong>.</p><p>Next, we need to add some fields to our model. With the <strong>Task</strong> model selected, you should see a listing for <strong>Fields</strong> in the <strong>Config</strong> area. Click on the <strong>+</strong> button next to <strong>Fields</strong> and enter <code class="literal">id</code> into the text area that appears. Click on <strong>Finish</strong> on the screen or press <em>Enter</em> on your keyboard.</p><p>Your <strong>Config</strong> area should now look something like this:</p><div><img src="img/8901OS_01_08.jpg" alt="Adding a Model, Fields, and Field Types"/></div><p>Repeat the previous steps to add the following fields to the <a id="id60" class="indexterm"/>task model:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>name</strong></li><li class="listitem" style="list-style-type: disc"><strong>description</strong></li><li class="listitem" style="list-style-type: disc"><strong>create</strong></li><li class="listitem" style="list-style-type: disc"><strong>completed</strong></li><li class="listitem" style="list-style-type: disc"><strong>priority</strong></li><li class="listitem" style="list-style-type: disc"><strong>isCompleted</strong></li></ul></div><p>Now that you have all of your fields, we need to define the data types for each field.</p><p>In <strong>Project Inspector</strong>, click on the field called <strong>id</strong>. <a id="id61" class="indexterm"/>
<a id="id62" class="indexterm"/>
<a id="id63" class="indexterm"/>This will open the configuration for that field and you should see that there is currently no value listed for <strong>type</strong>. Click on the value next to <strong>type. </strong>A drop-down menu will appear and you can select <strong>int</strong> from the list.</p><p>Now we need to do the same thing for our other fields. Select each field in turn and set them as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>name</strong>: Set it as <strong>string</strong></li><li class="listitem" style="list-style-type: disc"><strong>description</strong>: Set it as <strong>string</strong></li><li class="listitem" style="list-style-type: disc"><strong>create</strong>: Set it as <strong>date</strong></li><li class="listitem" style="list-style-type: disc"><strong>completed</strong>: Set it as <strong>date</strong></li><li class="listitem" style="list-style-type: disc"><strong>priority</strong>: Set it as <strong>int</strong></li><li class="listitem" style="list-style-type: disc"><strong>isCompleted</strong>: Set it as <strong>boolean</strong></li></ul></div><p>Now that you have all of the model fields and types <a id="id64" class="indexterm"/>
<a id="id65" class="indexterm"/>
<a id="id66" class="indexterm"/>defined, we need to add the model to the store.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Adding the model to the store</h2></div></div></div><p>Click on <strong>MyStore</strong> in <strong>Project Inspector</strong>. As we <a id="id67" class="indexterm"/>
<a id="id68" class="indexterm"/>did with our model, we probably want to change the name of the store to make it easier to refer to and keep track of in our code. Click on the values next to <strong>userClassName</strong> and <strong>storeID</strong> and change both to say <strong>taskStore</strong>.</p><p>Next, you will need to click on and edit the model <strong>Config</strong> in the store to select our <strong>Task</strong> model. Once complete, your store configuration should look something like this:</p><div><img src="img/8901OS_01_09.jpg" alt="Adding the model to the store"/></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Making copies</h2></div></div></div><p>Now that we have our store and model, we need to make a copy of it to hold our completed tasks. Both stores will use the same model and <a id="id69" class="indexterm"/>most of the same setup information. <a id="id70" class="indexterm"/>We only need to duplicate the store and change the <strong>id</strong> and <strong>userClassName</strong> values. Once we finish that, we will create filters for the store so that it only grabs the data we need.</p><p>To duplicate <strong>TaskStore</strong>, right-click on it in <strong>Project Inspector</strong> and select <strong>Duplicate</strong>. A new store will appear called <strong>MyStore2</strong>, with the same proxy and model information. Select <strong>MyStore2</strong> in <strong>Project Inspector</strong> and change both the <strong>id</strong> and <strong>userClassName</strong> values in the <strong>Config</strong> section to <code class="literal">CompletedStore</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Adding filters</h2></div></div></div><p>Now that we have our two stores, we need to set some filters to make sure that <strong>TaskStore</strong> only loads current tasks and <strong>CompletedStore</strong> only loads completed tasks.</p><p>You can add filters in the <strong>Config</strong> section for each of our stores. <a id="id71" class="indexterm"/>
<a id="id72" class="indexterm"/>First, select <strong>TaskStore</strong> and then click on the <strong>+</strong> button next to <strong>Filters</strong> in the <strong>Config</strong> section. This will add a new filter called <strong>MyFilter</strong>. Click on the arrow next to <strong>MyFilter</strong> to reveal its <strong>Config</strong> options.</p><p>We need to add a function to this filter in order to tell it what records to grab. Click on the <strong>+</strong> button next to <strong>filterFn</strong> to add a new filter function. Up in the <strong>Project Inspector</strong> area, <strong>filterFn</strong> should appear beneath <strong>MyFilter</strong>. Click on <strong>filterFn</strong> in <strong>Property Inspector</strong> to bring up the code editor for the function.</p><p>The editor should appear with the following code:</p><div><pre class="programlisting">filterFn: function(item) {

}</pre></div><p>This sets up the basic function for the filter and passes us each record in the store as <strong>item</strong>. If our function returns <code class="literal">true</code>, the record is included in the store and if it returns <code class="literal">false</code>, the record is ignored.</p><p>Our model has a Boolean value called <a id="id73" class="indexterm"/>
<code class="literal">isComplete</code>. We can check this value in our function like this:</p><div><pre class="programlisting">return !item.data.isComplete;</pre></div><p>This takes the record we were passed as <code class="literal">item</code>, and checks the record's data for <code class="literal">isComplete</code>. If a task record is complete this will be <code class="literal">true</code>, so we put the <code class="literal">!</code> character in front to grab only the records where <code class="literal">isComplete</code> is <code class="literal">false</code>. The filter is now complete.</p><p>Take the same steps to add a filter to <code class="literal">CompletedStore</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Add a filter to <code class="literal">CompletedStore</code>.</li><li class="listitem">Add a function to the filter using <code class="literal">filterFn</code>.</li><li class="listitem">Add the code for the filter function.</li></ol></div><p>In this case, our function just needs to look for tasks where <code class="literal">isComplete</code> is <code class="literal">true</code> (just drop the <code class="literal">!</code> character this time):</p><div><pre class="programlisting">return item.data.isComplete;</pre></div><p>Both stores will now correctly filter the tasks based on completion.</p><p>While we have been moving these components around on screen, Sencha Architect has been doing a bit of heavy lifting for us on the backend. Let's take a peek behind the curtain and see what's going on with the actual code.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Pay attention to the man behind the curtain</h1></div></div></div><p>The first thing to look at is on your hard drive where you saved the Task Manager project file. You will notice that the designer has created a number of files here: <code class="literal">app.html</code>, <code class="literal">app.js</code>, and <code class="literal">TaskManager.xds</code>. We also have folders for app and metadata.</p><p>Sencha Architect uses both <code class="literal">TaskManager.xds</code> and the <code class="literal">metadata</code> folder. The <code class="literal">TaskManager.xds</code> file is the main project file you are currently working in and the <code class="literal">metadata</code> folder contains resources for that project file. We can ignore those files for now because the interesting stuff is in the other files.</p><p>Let's start with our <code class="literal">app.html</code> file. <a id="id74" class="indexterm"/>If you open this file in your favorite code editor, you should see something like this:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;

&lt;!-- Auto Generated with Sencha Architect --&gt;
&lt;!-- Modifications to this file will be overwritten. --&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;title&gt;Chapter1&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/touch/sencha-touch-2.1.0/resources/css/sencha-touch.css"/&gt;
    &lt;script type="text/javascript" src="img/sencha-touch-all-debug.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript" src="img/app.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        if (!Ext.browser.is.WebKit) {
            alert("The current browser is unsupported.\n\nSupported browsers:\n" +
                "Google Chrome\n" +
                "Apple Safari\n" +
                "Mobile Safari (iOS)\n" +
                "Android Browser\n" +
                "BlackBerry Browser"
            );
        }
    &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;&lt;/body&gt;
&lt;/html&gt;</pre></div><p>This should look pretty familiar to anyone who is used to dealing with HTML and JavaScript. The file creates a basic HTML page, includes the JavaScript and CSS files for Sencha Touch, and also includes our <code class="literal">app.js</code> file (which we will get to in a second).</p><p>The file then sets up some browser detection so that if the user attempts to access the application with a non-WebKit browser, they will be <a id="id75" class="indexterm"/>told that their browser is incompatible and will be given a list of compatible browsers.</p><div><div><h3 class="title"><a id="note03"/>Note</h3><p>Chrome and Safari are WebKit browsers and are available for Windows and Mac. Chrome is also available on Linux. In this book we will be using Safari for our testing, but the examples will work in Chrome as well.</p></div></div><p>One other thing to note is the message in the comments at the top of <code class="literal">app.html</code>. This particular file is autogenerated each time you save the TaskManager project. If you make changes to it in your code editor, they will be overwritten the next time you save.</p><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>
<strong>A word about CacheFly</strong>
</p><p>CacheFly <a id="id76" class="indexterm"/>is a <a id="id77" class="indexterm"/>
<strong>CDN</strong> (<strong>Content Delivery Network</strong>). They have computers all over the world, and can send files to your users from a server that's close to them, so that the files take less time to travel across the Internet, and therefore less time to load. That also means that you save on your own server bandwidth by not serving those files yourself.</p></div></div><p>Next, let's take a look at our <code class="literal">app.js</code> file:</p><div><pre class="programlisting">/*
 * File: app.js
 *
 * This file was generated by Sencha Architect version 2.0.0.
 * http://www.sencha.com/products/designer/
 *
 * This file requires use of the Sencha Touch 2.0.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and every time you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.Loader.setConfig({
    enabled: true
});

Ext.application({
    models: [
        'Task'
    ],
    stores: [
        'TaskStore', 'CompletedStore'
    ],
    name: 'MyApp'
});</pre></div><p>Like our HTML file, we start out with a stern warning at the top about hand editing the file.</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p>
<strong>A word about hand editing</strong>
</p><p>Sencha Architect does a lot of <a id="id78" class="indexterm"/>work for you, but that means that it can also accidentally overwrite code that you've written by hand. Your best bet is to wait to add any code yourself until you've fully laid out and configured all of the components for your application with the Architect first.</p></div></div><p>If we skip down past that section, we have a setup function for the Ext.Loader followed by a definition of our application. This includes links to all of our models and stores, as well as the name of our application (which we should probably change once we finish snooping around in the code).</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>Ext.Loader is a <a id="id79" class="indexterm"/>special part of Sencha Touch that will load JavaScript files as they're needed. Rather than include all of your JavaScript files in the HTML file, Ext.Loader will only load them as they're needed. This drastically cuts down on your application's startup time. You can learn more about <a id="id80" class="indexterm"/>Ext.Loader at <a class="ulink" href="http://www.sencha.com/blog/using-ext-loader-for-your-application">http://www.sencha.com/blog/using-ext-loader-for-your-application</a>.</p></div></div><p>Close the <code class="literal">app.js</code> file and open up the <code class="literal">app</code> folder. As you can see we have two folders called <code class="literal">model</code> and <code class="literal">store</code>. These, of course, contain our code for the model and the store.</p><p>Open the <code class="literal">store/TaskStore.js</code> file first:</p><div><pre class="programlisting">Ext.define('MyApp.store.TaskStore', {
    extend: 'Ext.data.Store',
    requires: [
        'MyApp.model.Task'
    ],

    config: {
        autoLoad: true,
        model: 'MyApp.model.Task',
        storeId: 'TaskStore',
        proxy: {
            type: 'localstorage',
            id: 'Tasks'
        }
    },
        filters: {
            filterFn: function(item) {
                return !item.data.isComplete;
            }
        }
});</pre></div><p>Beyond the ever-present warning about hand editing, you will see our store definition written out in plain JavaScript. Note that the store definition not only contains the code for our proxy, it also includes the filter function and it lists our task model as the model for the store.</p><div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>
<strong>Why is it "MyApp.model.Task"?</strong>
</p><p>Ext.Loader turns the name of your components into a <a id="id81" class="indexterm"/>filename by turning the periods into slashes. This means that if your component is <code class="literal">MyApp.model.Task</code> then Ext.Loader will look in your application folder for a folder called <code class="literal">MyApp</code>. It will look inside that <code class="literal">MyApp</code> folder for a <code class="literal">model</code> folder that has a <code class="literal">Task.js</code> file in it.</p><p>This is also a good way to keep your application folder organized. If you put all of your models in a <code class="literal">model</code> folder and all of your views in a <code class="literal">view</code> folder then you'll know where to find them when you need to find them later.</p></div></div><p>Close the <code class="literal">TaskStore.js</code> file and let's look at the last file, <code class="literal">model/Task.js</code>. This is the file for our model:</p><div><pre class="programlisting">Ext.define('MyApp.model.Task', {
    extend: 'Ext.data.Model',
    config: {
        fields: [
            {
                name: 'id',
                type: 'int'
            },
            {
                name: 'name',
                type: 'string'
            },
            {
                name: 'description',
                type: 'string'
            },
            {
                name: 'created',
                type: 'date'
            },
            {
                name: 'completed',
                type: 'date'
            },
            {
                name: 'isCompleted',
                type: 'boolean'
            }
        
        ]
    }
});</pre></div><p>Notice that there is a fair amount of overlap between what's in the store and what's in the model. This duplication allows the model and store to act independently of each other while still maintaining consistency for the data itself. We will look closer at that when we deal with the forms for our application.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Architect versus coding by hand</h1></div></div></div><p>As you can see, Sencha Architect generates code for us, but we could also choose to create this exact same code by hand. Sencha Architect offers <a id="id82" class="indexterm"/>benefits to the novice coder by allowing applications to be built visually and allowing the coder to explore the code as needed. The designer also generates code according to Sencha Touch best practices. This keeps the novice user from learning bad habits and encourages cleaner code when the coder needs to begin programming by hand.</p><p>For the seasoned coder, Sencha Touch offers ways to rapidly prototype interfaces and create mockups for clients. The code behind these mockups can then be used outside the designer to create complex applications that might be problematic if not impossible for Sencha Architect to accomplish.</p><p>By using a combination of Sencha Architect and traditional text-based coding, <a id="id83" class="indexterm"/>we hope that this book will offer additional benefits to the reader both in terms of speed and consistency.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Creating the views</h1></div></div></div><p>So far, none of our code has actually created anything <a id="id84" class="indexterm"/>on the screen. Now we need to create some visual components for the user to interact with, starting with the main panel that will contain our application.</p><p>Drag a <a id="id85" class="indexterm"/>
<strong>Tab Panel</strong> object out of the <strong>Toolbox</strong> list on the left and drop it onto the iPhone screen in the designer. A <strong>Panel</strong> option will now appear in <strong>Project Inspector</strong>. Select <strong>Tab Panel</strong> and add the following information to the <strong>Config</strong> area:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Make sure the <a id="id86" class="indexterm"/><strong>initialView</strong> checkbox is checked</li><li class="listitem" style="list-style-type: disc">Change <strong>userClassName</strong> from <strong>myTabPanel</strong> to <code class="literal">mainView</code></li><li class="listitem" style="list-style-type: disc">Delete the third tab by right-clicking on it and choosing <strong>Delete</strong></li></ul></div><p>Save the project and let's take another look at the code for your project. In the <code class="literal">app.js</code> file, you will now see the following code:</p><div><pre class="programlisting">Ext.Loader.setConfig({
    enabled: true
});

Ext.application({
    models: [
        'Task'
    ],
    stores: [
        'TaskStore'
    ],
    views: [
        'MainView'
    ],
    name: 'MyApp',
    launch: function() {
        Ext.create('MyApp.view.MainView', {fullscreen: true});
    }
});</pre></div><p>The designer has now added a <a id="id87" class="indexterm"/>
<code class="literal">launch</code> function that creates an instance of our <code class="literal">MainView</code> panel and sets it to <code class="literal">fullscreen</code>.</p><p>If we take a look in our <code class="literal">app</code> folder, we now see a folder called <code class="literal">view</code>. This folder contains our file for <code class="literal">MainView.js</code>:</p><div><pre class="programlisting">Ext.define('MyApp.view.MainView', {
    extend: 'Ext.tab.Panel',

   config: {
        items: [
            {
                xtype: 'container',
                title: 'Tab 1'
            },
            {
                xtype: 'container',
                title: 'Tab 2'
            }
        ]
    }
});</pre></div><p>Right now this file simply defines <code class="literal">MainView</code> as an extension of the standard <code class="literal">Ext.tab.Panel</code> <a id="id88" class="indexterm"/>function and sets the Config containing our two tabs. As we add additional pieces to the panel, they will appear here in the code. <a id="id89" class="indexterm"/>Let's head back to the designer and do just that.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Configuring the Tab Panel</h2></div></div></div><p>The first thing we should probably do is <a id="id90" class="indexterm"/>rename the tabs. Select <strong>Tab 1</strong> in the <strong>Project Inspector</strong> and then click on the value for <strong>Title</strong> in the <strong>Config</strong> section. Change the title from <strong>Tab 1</strong> to <code class="literal">Current</code> and press <em>Enter</em> on your keyboard. Do the same thing for <strong>Tab 2</strong>, changing its title to <code class="literal">Completed</code>.</p><div><img src="img/8901OS_01_13.jpg" alt="Configuring the Tab Panel"/></div><p>One additional thing we should do is change the tabs to appear on the bottom. This will give our application a more classic iPhone look. To make this <a id="id91" class="indexterm"/>change, select <strong>mainView</strong> in <strong>Project Inspector</strong> and find the <strong>Tab Bar Config</strong> listing in the <strong>Config</strong> section. Click on the <strong>+</strong> button next to <strong>Tab Bar Config</strong> and a new <strong>Tab Bar</strong> option will appear below. Click on the arrow next to the new <strong>Tab Bar</strong> option and the configuration options for it will appear.</p><p>Locate the docked <strong>Config</strong> area and change it from top to bottom. The tabs should drop down to the bottom and give us the large icons familiar to most iPhone users. You can change these icons by clicking on the <strong>Current</strong> or <strong>Completed</strong> tab in <strong>Project Inspector</strong> and changing the <strong>Config</strong> value for <strong>iconCls</strong>. Select the icons you like and save the project (I chose <strong>organize</strong> for the <strong>Current</strong> tab and <strong>delete</strong> for the <strong>Completed</strong> tab).</p><p>Once you are finished, select <strong>MainView</strong> in <strong>Property Inspector</strong> and then click on <strong>Code</strong> in the upper-right side of the designer. This will change the designer over into code view, showing us the contents of our <code class="literal">MainView.js</code> file.</p><div><pre class="programlisting">Ext.define('MyApp.view.MainView', {
  extend: 'Ext.tab.Panel',
  config: {
  items: [
    {
        xtype: 'container',
        title: 'Current',
        iconCls: 'organize'
    },
    {
        xtype: 'container',
        title: 'Completed',
        iconCls: 'delete'
    }
  ],
  tabBar: {
    docked: 'bottom'
  }
  }
}); </pre></div><p>You can now see that the tab panel and its two tabs have been added to our <code class="literal">MainView.js</code> file. We also see our <a id="id92" class="indexterm"/>
<code class="literal">tabBar</code> configuration and the <code class="literal">iconCls</code> values we selected.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Adding the lists and details</h2></div></div></div><p>Next, we want to add a list and a panel to each of our tabs. The <a id="id93" class="indexterm"/>
<a id="id94" class="indexterm"/>lists will display the names for our current and completed tasks. The panels will display details for the task when we click on it in the list.</p><p>Let's start by selecting each tab and setting the <strong>layout</strong> property in <strong>Config</strong> to <strong>card</strong>. This will let us easily switch between the <strong>List</strong> and <strong>Details</strong> sections for each tab.</p><p>Next, take a <strong>List</strong> component from the <strong>Toolbox</strong> list and drop one on each tab in <strong>Property Inspector</strong>.</p><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>
<strong>Dropping items in Property Inspector</strong>
</p><p>While most components can be dropped directly onto the design area, it is often better to drop components into <a id="id95" class="indexterm"/>
<strong>Project Inspector</strong>. It's much easier to ensure that you are putting the component within the correct container using <strong>Property Inspector</strong>.</p></div></div><p>Next you will need to take a panel from <strong>Toolbox</strong> and drop one onto each tab, just like we did with the list. This panel will be our details container and it will not appear in the design view because the list is in front. We will create <a id="id96" class="indexterm"/>
<a id="id97" class="indexterm"/>some code later on to swap the list and the container when the user clicks on a task in the list.</p><p>Your <strong>Property Inspector</strong> area should now look something like this:</p><div><img src="img/8901OS_10.jpg" alt="Adding the lists and details"/></div><p>Notice that the tabs (<strong>Current</strong> and <strong>Completed</strong>) are both indented under the <strong>mainView</strong> tab panel. Each tab also has a list and a panel beneath it. The tabs are children of the <strong>mainView</strong> tab panel and <a id="id98" class="indexterm"/>each tab has two child items; a list and a panel.</p><p>Since we will need to address the lists and the panels in our code, we should probably name them something a bit more descriptive than <strong>MyList</strong> and <strong>MyPanel</strong>. In order to do this, you will need to select each of these items and <a id="id99" class="indexterm"/>
<a id="id100" class="indexterm"/>change the <a id="id101" class="indexterm"/>
<strong>id</strong> property in <strong>Config</strong>. Let's rename them as follows:</p><p>In the <strong>Current</strong> tab, we will call them <code class="literal">CurrentList</code> and <code class="literal">CurrentDetails</code> and in the <strong>Completed</strong> tab, we will call them <code class="literal">CompletedList</code> and <code class="literal">CompletedDetails</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Setting up the templates</h2></div></div></div><p>Next we need to set up the templates (called <a id="id102" class="indexterm"/>
<strong>itemTpl</strong> in the <strong>Config</strong> area) for our lists and our details. These templates control how our data will <a id="id103" class="indexterm"/>be laid out on the screen. <a id="id104" class="indexterm"/>Remember that we have the following data items:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>id</strong></li><li class="listitem" style="list-style-type: disc"><strong>name</strong></li><li class="listitem" style="list-style-type: disc"><strong>description</strong></li><li class="listitem" style="list-style-type: disc"><strong>created</strong></li><li class="listitem" style="list-style-type: disc"><strong>completed</strong></li><li class="listitem" style="list-style-type: disc"><strong>priority</strong></li></ul></div><p>We can use any of these values by including them in our template by placing them in curly braces like so:</p><div><pre class="programlisting">&lt;div&gt;{name}&lt;/div&gt;</pre></div><p>We can also use any HTML styling or tags as part of our template. This gives us a great deal of flexibility in controlling the layout of our application.</p><p>To edit the template for our <a id="id105" class="indexterm"/>
<strong>CurrentList</strong> component, select it in <strong>Project Inspector</strong> and a gear icon will appear next to the list in our <strong>Design</strong> view. Click on the gear and you will see a pop-up window with a few configuration options including <strong>Edit Template</strong> at the bottom of the pop-up window. </p><p>When you click on <a id="id106" class="indexterm"/>
<strong>Edit Template</strong>, a text area will appear over the list with the following text:</p><div><pre class="programlisting">&lt;div&gt;List Item {string}&lt;/div&gt;</pre></div><p>Change this text to:</p><div><pre class="programlisting">&lt;div class="priority_{priority}"&gt;{name}&lt;/div&gt; </pre></div><p>Click on <strong>Done Editing</strong> when you are finished. The list items will appear empty for now, but we will fix that a bit later.</p><p>Next, click on the <a id="id107" class="indexterm"/>
<strong>CurrentDetails</strong> panel in <strong>Project Inspector</strong> and edit the template the same way you did for <strong>CurrentList</strong>. Set the template for the <strong>CurrentDetails</strong> to:</p><div><pre class="programlisting">&lt;div class="taskName"&gt;{name}&lt;/div&gt; 
&lt;div class="taskDescription"&gt;{description}&lt;/div&gt; 
&lt;div class="taskCreated"&gt;Created: {created}&lt;/div&gt;</pre></div><p>Click on <strong>Done Editing</strong> when you are finished.</p><p>When you are finished with the <strong>CurrentDetails</strong>, we want to <a id="id108" class="indexterm"/>follow the same steps for <a id="id109" class="indexterm"/>
<strong>CompletedList</strong> and <strong>CompletedDetails</strong>. You can keep the list template the same but we should include the completed date on our details page like so:</p><div><pre class="programlisting">&lt;div class="taskName"&gt;{name}&lt;/div&gt; 
&lt;div class="taskDescription"&gt;{description}&lt;/div&gt; 
&lt;div class="taskCreated"&gt;Created: {created}&lt;/div&gt;
&lt;div class="taskCompleted"&gt;Completed: {completed}&lt;/div&gt;</pre></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Testing with starter data</h2></div></div></div><p>You will notice that since we have no records, we have nothing to display. This can make testing our application difficult, so we are going to add a few <a id="id110" class="indexterm"/>test records to our application using the <code class="literal">launch</code> method.</p><p>Select <strong>Application</strong> in <strong>Project Inspector</strong> and then locate <strong>launch</strong> down in the <strong>Config</strong> section. Click on the <strong>+</strong> button next to <strong>launch</strong> to add a new launch function, and then click on the arrow next to our new launch function to open it. This <a id="id111" class="indexterm"/>will open the code editor with:</p><div><pre class="programlisting">launch: function() {

}</pre></div><p>Add the following code inside the <code class="literal">launch</code> function:</p><div><pre class="programlisting">var TaskStore = Ext.data.StoreManager.lookup('TaskStore');
var CompletedStore = Ext.data.StoreManager.lookup('CompletedStore');
if(CompletedStore.getCount()+TaskStore.getCount() === 0) {
    console.log('we have no records');
    TaskStore.add({name: 'Here Is A Task', description: 'You can mark the task complete by clicking the Completed button below.', priority: 1, created: Date.now(), completed: '', isComplete: false});
    TaskStore.add({name: 'How To Edit A Task', description: 'You can edit the task by clicking the Edit button below.', priority: 2, created: Date.now(), completed: '', isCompleted: false});
    TaskStore.add({name: 'How To Add A Task', description: 'Add a task by clicking the Add button in the upper right corner.', priority: 3, created: Date.now(), completed: '', isComplete: false});
    TaskStore.sync();
} else {
    console.log('we have records');
}</pre></div><p>This code will grab our two stores, TaskStore and Completed Store, and check to see if there are any records. If there are no records, the function will add three new records, and then sync the store to save the records. These task records <a id="id112" class="indexterm"/>can also serve as a set of three instructions to new users opening the application for the <a id="id113" class="indexterm"/>first time.</p><div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>
<strong>Console logs</strong>
</p><p>The <code class="literal">console.log</code> <a id="id114" class="indexterm"/>command is your best friend when programming. It will print text and objects to the error console in Safari or Chrome. This is critical for debugging any issues you have. In the previous code, the console logs will print based on whether we get back records or not. We could also use <code class="literal">console.log(TaskStore)</code> <a id="id115" class="indexterm"/>to get a display of every attribute of that store object. This is really handy for making sure you actually have the object you think you have.</p></div></div><p>Now when you open up the <code class="literal">app.html</code> file in your browser, you should see the following in the <strong>TaskMaster</strong> application:</p><div><img src="img/8901OS_11.jpg" alt="Testing with starter data"/></div><p>We now have tasks to view, but we still can't get to the details. We need to add a function to switch the view between our list and our details.</p><p>Back in Sencha Architect, click on <strong>CurrentList</strong> in <strong>Project Inspector</strong> and then look for <strong>Events</strong> at the top of the <strong>Config</strong> section. Click on the <strong>+</strong> button next to <strong>Events</strong> to add a new event listener. Use the menu that appears to choose the <a id="id116" class="indexterm"/>
<strong>select</strong> event. Click on the arrow next the new <strong>select</strong> event to edit the code. The code editor will appear with the following code:</p><div><pre class="programlisting">onCurrentListSelect: function(dataview, record, options) {

}</pre></div><p>Add the following code to the <code class="literal">select</code> event:</p><div><pre class="programlisting">  var currentTab = this.getActiveItem();
  
  var currentDetails = currentTab.down('panel');
  
  currentDetails.setRecord(record);
  currentTab.setActiveItem(currentDetails);</pre></div><p>The first line grabs our <code class="literal">Current</code> tab and the second grabs our <a id="id117" class="indexterm"/>
<code class="literal">CurrentDetails</code> panel. We then set the record on the details panel to the record we are passed as part of the <code class="literal">select</code> function (the record from our list). Finally, we switch the card layout of our current tab to the <code class="literal">CurrentDetails</code> panel, hiding <code class="literal">CurrentList</code>.</p><p>We need to do the same thing with our <a id="id118" class="indexterm"/>
<code class="literal">CompletedList</code> component. Add the new <strong>select</strong> event and set the code to:</p><div><pre class="programlisting">var completedTab = this.getActiveItem();

var completedDetails = completedTab.down('panel');

completedDetails.setRecord(record);
completedTab.setActiveItem(completedDetails);</pre></div><p>If we test this in the browser we should be able to see our details panel when we click on an item in the list. This also brings us to our next challenge; we need a way to get back to our list.</p><p>In this chapter, we will create the back button manually and in the next chapter we will highlight a different approach to this same problem. For now, let's add a new button to our toolbar.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec21"/>Adding the back button</h2></div></div></div><p>Grab a <strong>toolbar</strong> object from <strong>Toolbox</strong> and drag it over <a id="id119" class="indexterm"/>onto the <strong>mainView</strong> tab panel. Grab a <strong>button</strong> <a id="id120" class="indexterm"/>object from <strong>Toolbox</strong> and drag it onto the new <strong>toolbar</strong> panel.</p><p>Next, we want to give our toolbar a title. Let's select the toolbar and change the title in the <strong>Config</strong> section to <code class="literal">TaskMaster</code>.</p><p>Next we need to change a few things with our button. Select the <a id="id121" class="indexterm"/>
<strong>Button</strong> object and make the following changes to its <strong>Config</strong> section:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Change <strong>text</strong> to <strong>Back</strong></li><li class="listitem" style="list-style-type: disc">Change the <strong>id</strong> to <strong>backButton</strong></li><li class="listitem" style="list-style-type: disc">Change the <strong>ui</strong> to <strong>back</strong> (this will make it look like a typical back button)</li><li class="listitem" style="list-style-type: disc">Check the box next to the <strong>hidden</strong> property (we want the button hidden by default)<div><div><h3 class="title"><a id="tip08"/>Tip</h3><p>
<strong>I can't find one of the Config options</strong>
</p><p>If you are unable to find some of these properties, you may need to toggle the <strong>Config</strong> section between <strong>Show Common Configs</strong> and <strong>Show All Configs</strong> using the two buttons in the upper-right corner of the <a id="id122" class="indexterm"/>
<strong>Config</strong> section.</p></div></div></li></ul></div><p>Now that we have a back button, we need to make it do something. Add a tap listener by clicking on the <strong>+</strong> button next to events in the button's <strong>Config</strong> section. Select <strong>tap</strong> and then click on the arrow next to the tap event that <a id="id123" class="indexterm"/>appears.</p><p>Edit the back button code to look like this:</p><div><pre class="programlisting">onBackButtonTap: function(button, e, options) {
  var currentTab = this.getActiveItem();
  currentTab.setActiveItem(0);
  button.hide();
}</pre></div><p>By grabbing <a id="id124" class="indexterm"/>
<code class="literal">this.getActiveItem()</code> we grab the active tab in our <code class="literal">MainView</code> tab panel, which makes sure that the button will work correctly for both of our lists. We set the active item to the first item in the active tab. Finally, we hide the button so that it does not show up in our list view.</p><p>The last part we need to take care of is showing the button when we click an item in the list. Click on the <a id="id125" class="indexterm"/>
<strong>select</strong> event for our current panel and add <a id="id126" class="indexterm"/>the following to our <a id="id127" class="indexterm"/>
<code class="literal">select</code> function:</p><div><pre class="programlisting">var backButton = Ext.getCmp('backButton');
backButton.show();</pre></div><p>You will want to add the exact same button code to our <strong>select</strong> event in the <strong>CompletedList</strong> component. <a id="id128" class="indexterm"/>Just copy, open the select event for <strong>CompletedList</strong>,and paste.</p><p>Our lists and details are now complete. Now we need to be able to add, edit, and mark tasks as complete.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Creating the forms</h1></div></div></div><p>Before we start creating forms we need to add a <a id="id129" class="indexterm"/>button to our <strong>MainView</strong> toolbar that will display the form for adding new tasks.</p><p>Drag a <strong>Button</strong> object out from the <strong>Toolbox</strong> list and drop it on the <strong>TaskMaster</strong> toolbar. The new button should appear next to <strong>backButton</strong>. We probably want to move that over to the other side of our title, so we need to drag a <strong>Spacer</strong> out of <strong>Toolbox</strong> and drop it between our new button and <strong>backButton</strong>. <a id="id130" class="indexterm"/>
<strong>Spacer</strong> will push the new button to the right side of the screen.</p><p>Next we need to change the following <strong>Config</strong> properties for the new button:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <strong>text</strong> to <strong>Add</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>itemId</strong> to <strong>addButton</strong></li></ul></div><p>We will come back and add a <code class="literal">tap</code> function once we <a id="id131" class="indexterm"/>complete our forms.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Add Task form</h2></div></div></div><p>To create our Add Task form we will add a new form panel to the <strong>Current</strong> tab. Drag a <strong>Form Panel</strong> from the toolbox and drop it on our <strong>Current</strong> tab. <a id="id132" class="indexterm"/>The panel should appear below our <strong>CurrentList</strong> and <strong>CurrentDetails</strong> panels.</p><p>Next we need to drag some fields into our form so let's start with <a id="id133" class="indexterm"/>dropping a <a id="id134" class="indexterm"/>
<strong>Text Field</strong> object on the <strong>MyFormPanel</strong> panel and <a id="id135" class="indexterm"/>changing the following <strong>Config</strong> properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <strong>name</strong> to <strong>name</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>label</strong> to <strong>Name</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>id</strong> to <strong>name</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>margin</strong> to <strong>3</strong></li></ul></div><p>Next, add a <strong>Text Area</strong> object to our <a id="id136" class="indexterm"/>
<strong>MyFormPanel</strong> panel and set the following <strong>Config</strong> properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <strong>name</strong> to <strong>description</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>label</strong> to <strong>Description</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>id</strong> to <strong>description</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>margin</strong> to <strong>3</strong></li></ul></div><p>Now, we need to add a <a id="id137" class="indexterm"/>
<strong>Select Field</strong> object to <strong>MyFormPanel</strong> and set the following <strong>Config</strong> properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <strong>name</strong> to <strong>priority</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>label</strong> to <strong>Priority</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>id</strong> to <strong>priority</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>margin</strong> to 3</li></ul></div><p>We also need to add some options for <strong>Select Field</strong>. Locate <strong>Options</strong> in the <strong>Config</strong> properties and click to edit. The <a id="id138" class="indexterm"/>
<strong>Options</strong> property expects an object as its value, in this case an array of name-value pairs like this:</p><div><pre class="programlisting">[{text: 'High',  value: 1},
{text: 'Medium', value: 2},
{text: 'Low',  value: 3}]</pre></div><p>By default, the <strong>Select Field</strong> uses text for display and value for the submitted value. You can change this by editing the <strong>displayField</strong> and <strong>valueFields</strong> in the <strong>Config</strong> properties, but we can leave these as the defaults for our application.</p><p>We can save ourselves a lot of work if we use this form for both adding new tasks and editing existing ones. To do this we also need to add a hidden field to hold the ID value of any existing tasks that we edit.</p><p>Add a <a id="id139" class="indexterm"/>
<strong>Hidden Field</strong> object to <strong>MyFormPanel</strong> and set the <a id="id140" class="indexterm"/>properties for <strong>id</strong> and <strong>name</strong> to <strong>id</strong> in the <strong>Config</strong> section. We will use this later when saving the form.</p><p>The last thing we need in our form is two buttons; one for save <a id="id141" class="indexterm"/>and one for cancel. Add the buttons and make the <a id="id142" class="indexterm"/>following changes:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <strong>text</strong> for <strong>button 1</strong> to <strong>Save</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>itemID</strong> for <strong>button 1</strong> to <strong>SaveButton</strong> </li><li class="listitem" style="list-style-type: disc">Set <strong>margin</strong> for <strong>button 1</strong> to <strong>10</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>text</strong> for <strong>button 2</strong> to <strong>Cancel</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>itemID</strong> for <strong>button 2</strong> to <strong>CancelButton</strong></li><li class="listitem" style="list-style-type: disc">Set <strong>margin</strong> for <strong>button 2</strong> to <strong>10</strong></li></ul></div><p>The structure and the form should look something like this:</p><div><img src="img/8901OS_12.jpg" alt="Add Task form"/></div><p>Next, we will add a tap event handler to each button <a id="id143" class="indexterm"/>using the <strong>Event</strong> section of the <strong>Config</strong> as before.</p><p>For our <a id="id144" class="indexterm"/>
<strong>Cancel</strong> button, set the <code class="literal">event</code> function to:</p><div><pre class="programlisting">var currentTab = this.getActiveItem(); 
currentTab.setActiveItem(0);</pre></div><p>This code grabs our <strong>Current</strong> tab and sets the active panel back to <strong>CurrentList</strong>.</p><p>The <a id="id145" class="indexterm"/>
<strong>Save</strong> button is a bit more complex. As we mentioned <a id="id146" class="indexterm"/>
<a id="id147" class="indexterm"/>earlier, we want to use this form for both adding new tasks and editing existing ones. This means we need to check to see if the <strong>Hidden Field</strong> <a id="id148" class="indexterm"/>value of our <a id="id149" class="indexterm"/>form is set and save the task correctly.</p><p>Add the following code to the <a id="id150" class="indexterm"/>
<strong>SaveButton</strong> tap event function:</p><div><pre class="programlisting">var currentTab = this.getActiveItem();
var formPanel = currentTab.getActiveItem();

var values = formPanel.getValues();

var store = Ext.data.StoreManager.lookup('TaskStore');

if(values.id === null) {
    var record = Ext.ModelMgr.create(values, 'MyApp.model.Task');
    record.set('created', new Date());
    store.add(record);
} else {
    var record = store.getById(values.id);
    record.set('name', values.name);
    record.set('description', values.description);
    record.set('priority', values.priority);
}

store.sync();
formPanel.reset();
currentTab.setActiveItem(0);</pre></div><p>Our first two lines grab <code class="literal">currentTab</code> and <code class="literal">formPanel</code>. We then get the values from <code class="literal">formPanel</code> and <code class="literal">store</code> that we need to save our data to.</p><p>We check the value of our hidden field to see if it has been set. <a id="id151" class="indexterm"/>This will be <code class="literal">true</code> if we are editing, but not if we are adding a new task.</p><p>If we are adding a new task, we create a new <code class="literal">record</code> option using the <code class="literal">values</code> form in the form field, we set a create date, and add <code class="literal">record</code> to <code class="literal">store</code>.</p><p>If we are editing an existing record, we use the <code class="literal">id</code> value <a id="id152" class="indexterm"/>from our <code class="literal">store</code> to get the <code class="literal">record</code> from the <code class="literal">store</code>. We then set the <code class="literal">name</code>, <code class="literal">description</code>, and <code class="literal">priority</code> values of <code class="literal">record</code> from our form <code class="literal">values</code>.</p><p>Finally, we sync our <code class="literal">store</code> to save the <code class="literal">record</code>, clear out our form <code class="literal">values</code> and close the form by setting the active item back to our <code class="literal">CurrentList</code> view (<code class="literal">0</code>).</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec23"/>Editing and completing a task</h2></div></div></div><p>For <a id="id153" class="indexterm"/>editing a task, we are going to use the form we just created, but we need to load it up with the currently selected record. <a id="id154" class="indexterm"/>For completing a task, we just need a button.</p><p>To do this we will add a toolbar with two buttons to our <strong>CurrentDetails</strong> panel. We should probably add a <strong>Spacer</strong> object between the two <a id="id155" class="indexterm"/>buttons like we did with our previous toolbar.</p><p>Each button also needs a <strong>tap</strong> event added to it in the <strong>Config</strong> section, <a id="id156" class="indexterm"/>under <strong>Events</strong>.</p><p>For the <strong>Edit</strong> button, set the <a id="id157" class="indexterm"/>
<strong>tap</strong> function to:</p><div><pre class="programlisting">var currentTab = this.getActiveItem();
var DetailsPanel = currentTab.getActiveItem();

currentTab.setActiveItem(2);
var formPanel = currentTab.getActiveItem();
formPanel.setRecord(DetailsPanel.getRecord());

this.setActiveItem(currentTab);

var backButton = Ext.getCmp('backButton');
backButton.hide();</pre></div><p>This code grabs <code class="literal">record</code> from the <a id="id158" class="indexterm"/>
<code class="literal">DetailsPanel</code> panel and loads this into <code class="literal">formPanel</code>. Setting this <code class="literal">record</code> on the form also sets the value of our hidden field to the correct <code class="literal">id</code> value for our record. We then display the form as before and hide the <strong>Back</strong> button.</p><p>For our Complete Task button, we need to get <code class="literal">record</code> from <code class="literal">DetailsPanel</code> and set the values for <code class="literal">completed</code> (a date) and <a id="id159" class="indexterm"/>
<code class="literal">isCompleted</code> (a Boolean). We do that by setting the tap event function to this:</p><div><pre class="programlisting">var currentTab = this.getActiveItem();
var detailsPanel = currentTab.getActiveItem();

var record = detailsPanel.getRecord();

record.set('completed', new Date());
record.set('isComplete', true);

var store = Ext.data.StoreManager.lookup('TaskStore');
store.sync();

this.setActiveItem(1);
var completedList = this.getActiveItem();
var completedStore = completedList.getActiveItem().getStore();
completedStore.add(record);
completedList.getActiveItem().refresh();

currentTab.setActiveItem(0);

var backButton = Ext.getCmp('backButton');
backButton.hide();</pre></div><p>This gets our <code class="literal">record</code> as before, sets our two values, and syncs <code class="literal">TaskStore</code>. This sync will also cause the filter on <code class="literal">TaskStore</code> to prevent the record from displaying in our <code class="literal">Current</code> list.</p><p>Next we add the record to <code class="literal">CompletedStore</code> and refresh the view for our <code class="literal">completed</code> list. We finish up by returning the user to the <strong>Current</strong> list and <a id="id160" class="indexterm"/>
<a id="id161" class="indexterm"/>hiding the <strong>Back</strong> button.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec24"/>Testing the application</h2></div></div></div><p>If we did everything correctly, you should be able to <a id="id162" class="indexterm"/>open the <code class="literal">app.html</code> file in Safari (or Chrome) and test the application. Try putting the editing and marking tasks as completed. Be sure to use the JavaScript console in your browser to track down issues and view errors.</p><div><img src="img/8901OS_13.jpg" alt="Testing the application"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Extra credit</h1></div></div></div><p>Task managing applications come in a variety of designs, with a wide variety of features. Everyone seems to have their own preference for tracking tasks. You can use this application as a base for your own personal task management application. These are a few ideas for taking the application to the next level:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add styles in the CSS file based on the priority of the tasks in the list and details</li><li class="listitem" style="list-style-type: disc">Add a way to sort the tasks by date and priority</li><li class="listitem" style="list-style-type: disc">Customize the <code class="literal">CurrentDetails</code> and <code class="literal">CompletedDetails</code> templates to add icons for priority</li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Summary</h1></div></div></div><p>In this chapter we discussed the basic setup for an application using local storage, including:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The basics of the Sencha Architect application</li><li class="listitem" style="list-style-type: disc">Creating data stores to use local storage and a task model</li><li class="listitem" style="list-style-type: disc">Creating lists and details for our data stores to use</li><li class="listitem" style="list-style-type: disc">Creating events to switch between the <strong>List</strong> and <strong>Details</strong> views</li><li class="listitem" style="list-style-type: disc">Creating buttons to control navigation and launch our forms</li><li class="listitem" style="list-style-type: disc">Creating forms for editing and adding new tasks</li></ul></div><p>In the next chapter we will take a look at using layouts and templates to create a more complex and visually appealing application.</p></div></body></html>