<html><head></head><body>
<div id="_idContainer026">
<h1 class="chapter-number" id="_idParaDest-106"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.1.1">8</span></h1>
<h1 id="_idParaDest-107"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.2.1">Builds and Adapters</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In the previous four chapters, we’ve spent a significant amount of time discussing various routing techniques. </span><span class="koboSpan" id="kobo.3.2">From simple routing to pages that can be rendered as static HTML and speed up our application, to more complex tactics where we ensure the data is of an expected type through the use of regular expressions. </span><span class="koboSpan" id="kobo.3.3">While these techniques represent core features of SvelteKit, they are not all there is to it. </span><span class="koboSpan" id="kobo.3.4">Another useful quality found in SvelteKit is its ability to run in nearly any environment through the use of adapters. </span><span class="koboSpan" id="kobo.3.5">Before we dive into various adapters and their configurations, we’ll analyze the process involved when creating a production build of a </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">SvelteKit application.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">Firstly, we’ll need to address how to build our application for a production environment. </span><span class="koboSpan" id="kobo.5.2">Vite makes this step simple, so we’ll then pivot to how we can use different adapters to adjust builds for various environments. </span><span class="koboSpan" id="kobo.5.3">While each adapter has its own requirements, it would quickly become repetitive to discuss them all. </span><span class="koboSpan" id="kobo.5.4">Instead, we’ll focus on three different adapters that are each suited to </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">unique environments.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.9.1">Creating </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">a Build</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Adapting </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">the App</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.13.1">Once complete, you’ll be able to build and deploy your very own applications to a multitude of platform types, including static hosts, Node.js, and a plethora of </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">serverless environments.</span></span></p>
<h1 id="_idParaDest-108"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.15.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.16.1">The complete code for this chapter is available on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">at: </span></span><a href="https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter08"><span class="No-Break"><span class="koboSpan" id="kobo.18.1">https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter08</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.19.1">.</span></span></p>
<h1 id="_idParaDest-109"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.20.1">Creating a Build</span></h1>
<p><span class="koboSpan" id="kobo.21.1">In other books about web development</span><a id="_idIndexMarker172"/><span class="koboSpan" id="kobo.22.1"> frameworks, a section related to creating a production build of the application usually doesn’t come until the very end. </span><span class="koboSpan" id="kobo.22.2">But because SvelteKit and Vite make it so simple, there’s really no reason to wait. </span><span class="koboSpan" id="kobo.22.3">I’m sure you’re eager to get your application available as soon as possible, so let’s get straight </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">to it.</span></span></p>
<p><span class="koboSpan" id="kobo.24.1">So far, we’ve only worked with our application in the development environment. </span><span class="koboSpan" id="kobo.24.2">In essence, Vite started a development server on the local machine when we ran the </span><strong class="source-inline"><span class="koboSpan" id="kobo.25.1">npm run dev</span></strong><span class="koboSpan" id="kobo.26.1"> command. </span><span class="koboSpan" id="kobo.26.2">To shut down the development server, we use </span><em class="italic"><span class="koboSpan" id="kobo.27.1">Ctrl</span></em><span class="koboSpan" id="kobo.28.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.29.1">C</span></em><span class="koboSpan" id="kobo.30.1">. </span><span class="koboSpan" id="kobo.30.2">To prepare a production build of our application, we can use the provided </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.31.1">npm</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.32.1"> script:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.33.1">
npm run build</span></pre>
<p><span class="koboSpan" id="kobo.34.1">If you open the project’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.35.1">package.json</span></strong><span class="koboSpan" id="kobo.36.1">, you’ll notice this particular script runs the </span><strong class="source-inline"><span class="koboSpan" id="kobo.37.1">vite build</span></strong><span class="koboSpan" id="kobo.38.1"> command. </span><span class="koboSpan" id="kobo.38.2">It does exactly what it sounds like by kicking off Vite’s build process, which involves the bundling process from Rollup, packaging static assets, and running the configured adapter. </span><span class="koboSpan" id="kobo.38.3">Upon completion of the command, you’ll notice the output in your terminal lists various files as well as their size. </span><span class="koboSpan" id="kobo.38.4">If there are any errors in the build, they will be </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">shown here.</span></span></p>
<p><span class="koboSpan" id="kobo.40.1">By default, the fully built application will be output to </span><strong class="source-inline"><span class="koboSpan" id="kobo.41.1">.svelte-kit/</span></strong><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">To change this directory, we can open </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">svelte.config.js</span></strong><span class="koboSpan" id="kobo.44.1"> and pass in the preferred directory name to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">config.kit.outDir</span></strong><span class="koboSpan" id="kobo.46.1"> option. </span><span class="koboSpan" id="kobo.46.2">When opening the </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">build</span></strong><span class="koboSpan" id="kobo.48.1"> folder, you’ll notice that the built application has a different structure compared to our source code. </span><span class="koboSpan" id="kobo.48.2">This is, of course, by design and varies based on the adapter we’re using. </span><span class="koboSpan" id="kobo.48.3">To confirm that our production build works, we can preview it using the </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.50.1">
npm run preview</span></pre>
<p><span class="koboSpan" id="kobo.51.1">Once run, Vite will alert us to the new URL and port that our application can be accessed from. </span><span class="koboSpan" id="kobo.51.2">We can view and use the application there just as we can when running our development server. </span><span class="koboSpan" id="kobo.51.3">What differs is that file changes will not be automatically updated, as the files being used to run this version of the application need to be regenerated on each build – that is, unless </span><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">build.watch</span></strong><span class="koboSpan" id="kobo.53.1"> has been set in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">vite.config.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.55.1"> project.</span></span></p>
<p><span class="koboSpan" id="kobo.56.1">Having run the first official build of our application, there are a few things to make note of before we begin discussing adapters. </span><span class="koboSpan" id="kobo.56.2">Firstly, think back to </span><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.57.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.58.1"> when we covered </span><strong class="bold"><span class="koboSpan" id="kobo.59.1">Page Options</span></strong><span class="koboSpan" id="kobo.60.1">. </span><span class="koboSpan" id="kobo.60.2">In that section, we looked </span><a id="_idIndexMarker173"/><span class="koboSpan" id="kobo.61.1">at how we can specify server-side rendering, client-side rendering, and prerendering on a per-route basis. </span><span class="koboSpan" id="kobo.61.2">We can also apply those options to layouts. </span><span class="koboSpan" id="kobo.61.3">In fact, if we intended to create a single-page application, we would achieve it by disabling </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">ssr</span></strong><span class="koboSpan" id="kobo.63.1"> in the root </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">+layout.js</span></strong><span class="koboSpan" id="kobo.65.1"> file. </span><span class="koboSpan" id="kobo.65.2">Just keep in mind that prerendering takes place during the build of the application. </span><span class="koboSpan" id="kobo.65.3">As such, any </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">fetch()</span></strong><span class="koboSpan" id="kobo.67.1"> requests that happen on prerendered pages will happen at build time. </span><span class="koboSpan" id="kobo.67.2">We can confirm this with a simple change to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">fetch</span></strong><span class="koboSpan" id="kobo.69.1"> example. </span><span class="koboSpan" id="kobo.69.2">Where we previously set </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">ssr = false</span></strong><span class="koboSpan" id="kobo.71.1">, change it now to </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">prerender = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">true;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.75.1">src/routes/(site)/fetch/+page.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.76.1">
const key = 'DEMO_KEY'; // your API key here
export const prerender = true; // change this line
export function load() {
  const pic = fetch(`https://api.nasa.gov/planetary/apod?api_key=${key}`)
    .then(response =&gt; {
      console.log('got response');
      return response.json();
    });
  return {pic};
}</span></pre>
<p><span class="koboSpan" id="kobo.77.1">Once we’ve enabled prerendering</span><a id="_idIndexMarker174"/><span class="koboSpan" id="kobo.78.1"> on this particular route, we can go ahead and rebuild the application. </span><span class="koboSpan" id="kobo.78.2">Now, when we open our </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">build</span></strong><span class="koboSpan" id="kobo.80.1"> folder, we should see the file at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">.svelte-kit/output/prerendered/pages/fetch.html</span></strong><span class="koboSpan" id="kobo.82.1"> path. </span><span class="koboSpan" id="kobo.82.2">Upon opening this file, we’ll see the image element as well as all of the other data pulled from the NASA API shown as static HTML. </span><span class="koboSpan" id="kobo.82.3">This confirms to us that prerendering happens during the build process. </span><span class="koboSpan" id="kobo.82.4">It is very much something developers need to be cognizant of when preparing their applications for </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">production environments.</span></span></p>
<p><span class="koboSpan" id="kobo.84.1">There are a few other idiosyncrasies</span><a id="_idIndexMarker175"/><span class="koboSpan" id="kobo.85.1"> to take note of when building </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">your application:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.87.1">Disabling </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">csr</span></strong><span class="koboSpan" id="kobo.89.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">ssr</span></strong><span class="koboSpan" id="kobo.91.1"> will result in an empty page </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">being rendered.</span></span></li>
<li><span class="koboSpan" id="kobo.93.1">It is not possible to prerender pages that rely on form actions as the page relies on HTTP </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">POST</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.95.1"> requests.</span></span></li>
<li><span class="koboSpan" id="kobo.96.1">It is also not possible to prerender pages that make use </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.98.1">url.searchParams.</span></strong></span></li>
<li><span class="koboSpan" id="kobo.99.1">It is possible to prerender pages that load data based on dynamic parameters in the route; however, SvelteKit will need to observe links to those endpoints to </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">do so.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.101.1">As demonstrated, preparing an application for production is quite simple. </span><span class="koboSpan" id="kobo.101.2">Vite bundles dependencies quickly and even provides a means to preview the application. </span><span class="koboSpan" id="kobo.101.3">That being said, there are a few things to keep in mind before packaging the application. </span><span class="koboSpan" id="kobo.101.4">In the next section, we’ll look at a few commonly used adapters and how they each produce builds specific to the </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">intended environment.</span></span></p>
<h1 id="_idParaDest-110"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.103.1">Adapting the app</span></h1>
<p><span class="koboSpan" id="kobo.104.1">Now that we know how to build </span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.105.1">our application, we can explore some of the adapters that transform it for specified environments. </span><span class="koboSpan" id="kobo.105.2">For the entire time we’ve worked on our project, we’ve been using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">@sveltejs/adapter-auto</span></strong><span class="koboSpan" id="kobo.107.1"> package. </span><span class="koboSpan" id="kobo.107.2">So far, we haven’t run into any issues, but if we want to build and deploy our application to a real production environment, we’ll need to get more specific. </span><span class="koboSpan" id="kobo.107.3">While </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">adapter-auto</span></strong><span class="koboSpan" id="kobo.109.1"> is great, it doesn’t accept any configuration options and only works with Cloudflare Pages, Vercel, Netlify, and Azure Static Web Apps. </span><span class="koboSpan" id="kobo.109.2">If we wanted to host our application on a Node.js server or elsewhere, we would need to use a different adapter. </span><span class="koboSpan" id="kobo.109.3">Let’s explore a few of the different options available in the following section. </span><span class="koboSpan" id="kobo.109.4">The adapters</span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.110.1"> we’ll look at are </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">as follows:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.112.1">adapter-node</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">adapter-cloudflare</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">adapter-static</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.115.1">This list is not comprehensive, as the SvelteKit project supports many more environments. </span><span class="koboSpan" id="kobo.115.2">Meanwhile, the SvelteKit community continues creating and releasing adapters for a variety of platforms. </span><span class="koboSpan" id="kobo.115.3">Be sure to check the Svelte community resources before building your </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">own adapter.</span></span></p>
<h2 id="_idParaDest-111"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.117.1">adapter-node</span></h2>
<p><span class="koboSpan" id="kobo.118.1">To begin, we’ll start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">adapter-node</span></strong><span class="koboSpan" id="kobo.120.1">, as most web developers</span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.121.1"> have at least some familiarity with Node.js environments. </span><span class="koboSpan" id="kobo.121.2">This adapter can be installed by running the </span><span class="No-Break"><span class="koboSpan" id="kobo.122.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.123.1">
npm install -D @sveltejs/adapter-node</span></pre>
<p><span class="koboSpan" id="kobo.124.1">Once installed, we can add it to our project by importing it into our </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">svelte.config.js</span></strong><span class="koboSpan" id="kobo.126.1"> and specifying the </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">adapter accordingly:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.128.1">svelte.config.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.129.1">
import adapter from '@sveltejs/adapter-node';
const config = {
    kit: {
        adapter: adapter(),
        alias: {
            db: '/src/db.js',
            img: '/src/lib/images'
        }
    },
};
export default config;</span></pre>
<p><span class="koboSpan" id="kobo.130.1">As before, this configuration only differs in that it imports </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">adapter-node</span></strong><span class="koboSpan" id="kobo.132.1"> instead </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">adapter-auto</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.136.1">Once the adapters have been switched out, we can build the application for a Node.js environment by running </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">npm run build</span></strong><span class="koboSpan" id="kobo.138.1"> in the terminal. </span><span class="koboSpan" id="kobo.138.2">By default, this adapter will output the built application to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">build/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.140.1"> directory.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">So far in this project, we’ve only</span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.142.1"> included one dependency, and that was </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">bcrypt</span></strong><span class="koboSpan" id="kobo.144.1">. </span><span class="koboSpan" id="kobo.144.2">If we hadn’t included that dependency, we wouldn’t even need to do this next step. </span><span class="koboSpan" id="kobo.144.3">But because it seems rare to find a project that’s not using other dependencies, we’d better cover it. </span><span class="koboSpan" id="kobo.144.4">To ensure our Node.js production environment has access to all the required dependencies, we’ll need to install them. </span><span class="koboSpan" id="kobo.144.5">We do this by copying </span><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">package.json</span></strong><span class="koboSpan" id="kobo.146.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">package-lock.json</span></strong><span class="koboSpan" id="kobo.148.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">build/</span></strong><span class="koboSpan" id="kobo.150.1"> directory. </span><span class="koboSpan" id="kobo.150.2">To ensure our build works successfully, we’ll simulate an automated deployment. </span><span class="koboSpan" id="kobo.150.3">We can do this by copying the entire </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">build/</span></strong><span class="koboSpan" id="kobo.152.1"> directory (which now also includes </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">package.json</span></strong><span class="koboSpan" id="kobo.154.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">package-lock.json</span></strong><span class="koboSpan" id="kobo.156.1">) to another location on our machine. </span><span class="koboSpan" id="kobo.156.2">Once done, we can use npm’s clean install command in the same directory to download the required production dependencies. </span><span class="koboSpan" id="kobo.156.3">This is the recommended installation method for automated deployments and continuous integration environments. </span><span class="koboSpan" id="kobo.156.4">We don’t need development dependencies, as SvelteKit is now bundled into pure JS so the command looks </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.158.1">
npm ci --omit dev</span></pre>
<p><span class="koboSpan" id="kobo.159.1">Running this command in the same directory as our build will download the </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">dependencies required.</span></span></p>
<p><span class="koboSpan" id="kobo.161.1">We can then launch the application with the </span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">following command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.163.1">
ORIGIN=http://0.0.0.0:3000 node build</span></pre>
<p><span class="koboSpan" id="kobo.164.1">In this instance, </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">build</span></strong><span class="koboSpan" id="kobo.166.1"> is the name of the directory we would like Node.js to target. </span><span class="koboSpan" id="kobo.166.2">We’ve also specified the </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">ORIGIN</span></strong><span class="koboSpan" id="kobo.168.1"> environment variable so that </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">adapter-node</span></strong><span class="koboSpan" id="kobo.170.1"> can correctly determine the URL of the application. </span><span class="koboSpan" id="kobo.170.2">Without</span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.171.1"> this, SvelteKit would block any </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">POST</span></strong><span class="koboSpan" id="kobo.173.1"> requests as a means of protection against </span><strong class="bold"><span class="koboSpan" id="kobo.174.1">Cross-Site Request Forgery</span></strong><span class="koboSpan" id="kobo.175.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.176.1">CSRF</span></strong><span class="koboSpan" id="kobo.177.1">) attacks. </span><span class="koboSpan" id="kobo.177.2">After running the command, we’ll see that the application is listening on </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">0.0.0.0:3000</span></strong><span class="koboSpan" id="kobo.179.1">. </span><span class="koboSpan" id="kobo.179.2">To change the IP address or listening port, we can set those environment variables before running </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">node build</span></strong><span class="koboSpan" id="kobo.181.1">. </span><span class="koboSpan" id="kobo.181.2">For instance, launching the application at </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">127.0.0.1:8000</span></strong><span class="koboSpan" id="kobo.183.1"> would look like </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">HOST=127.0.0.1 PORT=8000 ORIGIN=http://127.0.0.1:8000 </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">node build</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">To further customize your builds, this adapter provides the </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">following options:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">out</span></strong><span class="koboSpan" id="kobo.190.1"> – A string specifying the directory the build should be output to. </span><span class="koboSpan" id="kobo.190.2">It defaults to </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">build</span></strong><span class="koboSpan" id="kobo.192.1"> and should not have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">/</span></strong><span class="koboSpan" id="kobo.194.1"> character at </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">the end.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">precompress</span></strong><span class="koboSpan" id="kobo.197.1"> – A Boolean value that defaults to </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">false</span></strong><span class="koboSpan" id="kobo.199.1"> and controls whether or not assets and prerendered pages should be compressed using </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">gzip</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.201.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">brotli</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">envPrefix</span></strong><span class="koboSpan" id="kobo.205.1"> – A string value specifying a prefix applied to environment variables, which proves quite useful when your hosting provider doesn’t provide you with access to the standard environment variables such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">HOST</span></strong><span class="koboSpan" id="kobo.207.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">PORT</span></strong><span class="koboSpan" id="kobo.209.1">. </span><span class="koboSpan" id="kobo.209.2">Setting this will allow you to create your own </span><span class="No-Break"><span class="koboSpan" id="kobo.210.1">environment variables.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">polyfill</span></strong><span class="koboSpan" id="kobo.212.1"> – A Boolean value defaulting to </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">true</span></strong><span class="koboSpan" id="kobo.214.1"> that allows you to specify whether or not your build should include polyfills that add functionality not available in older </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">Node.js releases.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.216.1">After everything we’ve just covered, you should be able to deploy your own SvelteKit application to just about any Node.js environment. </span><span class="koboSpan" id="kobo.216.2">And if the destination environment limits your control, you should be able to customize the build using various options. </span><span class="koboSpan" id="kobo.216.3">Because Node.js environments</span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.217.1"> are so prevalent, it would have been a huge mistake to not explain some of the functionality behind </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">adapter-node</span></strong><span class="koboSpan" id="kobo.219.1"> and how it can streamline your </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">deployment process.</span></span></p>
<h2 id="_idParaDest-112"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.221.1">adapter-cloudflare</span></h2>
<p><span class="koboSpan" id="kobo.222.1">While </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">adapter-node</span></strong><span class="koboSpan" id="kobo.224.1"> is great for when</span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.225.1"> we’re running Node.js applications, there are adapters that allow us to deploy without needing to manage, configure, or maintain a server. </span><span class="koboSpan" id="kobo.225.2">Platforms such as Vercel, Netlify, and Cloudflare all provide these services and empower developers to ship their code faster than ever before. </span><span class="koboSpan" id="kobo.225.3">For demonstration purposes, let’s look at how easy it is to deploy to </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">Cloudflare Pages.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">To begin, we’ll install the adapter just like we have done with </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">other packages:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.229.1">
npm i -D @sveltejs/adapter-cloudflare</span></pre>
<p><span class="koboSpan" id="kobo.230.1">Once done, we can change our </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">svelte.config.js</span></strong><span class="koboSpan" id="kobo.232.1"> to reflect the new adapter. </span><span class="koboSpan" id="kobo.232.2">Again, we simply need to import the </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">new adapter:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.234.1">svelte.config.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.235.1">
import adapter from '@sveltejs/adapter-cloudflare';
const config = {
    kit: {
        adapter: adapter(),
    }
};
export default config;</span></pre>
<p><span class="koboSpan" id="kobo.236.1">Before delving too deep, it’s important to note that the application we have built thus far </span><strong class="bold"><span class="koboSpan" id="kobo.237.1">will not deploy to Cloudflare</span></strong><span class="koboSpan" id="kobo.238.1"> in its current state. </span><span class="koboSpan" id="kobo.238.2">Attempting to do so will result in many errors. </span><span class="koboSpan" id="kobo.238.3">In fact, you can see the errors for yourself by attempting to build the application using the Cloudflare adapter we just installed. </span><span class="koboSpan" id="kobo.238.4">The reason for this is quite simple. </span><span class="koboSpan" id="kobo.238.5">Cloudflare Workers and Pages do not run Node.js, which is required by one of our dependencies. </span><span class="koboSpan" id="kobo.238.6">While they are built off V8, which is the same engine that powers Node.js and Chromium-based browsers, they do not implement all of the APIs found in Node.js or those browsers. </span><span class="koboSpan" id="kobo.238.7">Instead, they exist as separate applications in their own right. </span><span class="koboSpan" id="kobo.238.8">And because we included the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">bcrypt</span></strong><span class="koboSpan" id="kobo.240.1"> package earlier, our application will fail to build as </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">bcrypt</span></strong><span class="koboSpan" id="kobo.242.1"> makes extensive use of Node.js APIs. </span><span class="koboSpan" id="kobo.242.2">To successfully build and deploy the application, we will need to make a couple </span><span class="No-Break"><span class="koboSpan" id="kobo.243.1">of changes.</span></span></p>
<p><span class="koboSpan" id="kobo.244.1">If you’d prefer not to make these</span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.245.1"> changes in your application, you can create a fork of this book’s code repository found under the </span><em class="italic"><span class="koboSpan" id="kobo.246.1">Technical requirements</span></em><span class="koboSpan" id="kobo.247.1"> section listed at the beginning of each chapter. </span><span class="koboSpan" id="kobo.247.2">In that repository, there is a branch labeled </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">cloudflare</span></strong><span class="koboSpan" id="kobo.249.1"> that has all of the necessary changes. </span><span class="koboSpan" id="kobo.249.2">When forking the repository, be sure to </span><strong class="bold"><span class="koboSpan" id="kobo.250.1">deselect the box</span></strong><span class="koboSpan" id="kobo.251.1"> that says </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">Copy the main branch only</span></strong><span class="koboSpan" id="kobo.253.1"> as you will need the </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">cloudflare</span></strong><span class="koboSpan" id="kobo.255.1"> branch. </span><span class="koboSpan" id="kobo.255.2">As for the necessary changes, let’s take a brief detour and examine </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">them now:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.257.1">Uninstall </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">bcrypt</span></strong><span class="koboSpan" id="kobo.259.1"> with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">npm uninstall </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">bcrypt</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.262.1"> command.</span></span></li>
<li><span class="koboSpan" id="kobo.263.1">Remove references to </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">bcrypt</span></strong><span class="koboSpan" id="kobo.265.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">src/routes/(app)/login/+page.server.js</span></strong><span class="koboSpan" id="kobo.267.1">, as shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">code snippet.</span></span></li>
<li><span class="koboSpan" id="kobo.269.1">Change </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">src/lib/users.json</span></strong><span class="koboSpan" id="kobo.271.1"> passwords to </span><span class="No-Break"><span class="koboSpan" id="kobo.272.1">plaintext values:</span></span></li>
</ol>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.273.1">src/routes/(app)/login/+page.server.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.274.1">
import users from '$lib/users.json';
export const actions = {
  login: async ({request, cookies}) =&gt; {
    const form = await request.formData();
    const exists = users.filter(user =&gt; user.username === form.get('username'));
    const auth = exists.filter(user =&gt; user.password === form.get('password'));
    if(!exists.length || !auth.length) {
      return {msg: 'Invalid login!'};
    }
    cookies.set('identity', auth[0].identity, {path: '/'});
    return {msg: 'success!'}
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.275.1">This new version of </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">+page.server.js</span></strong><span class="koboSpan" id="kobo.277.1"> simply removes references to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">bcrypt</span></strong><span class="koboSpan" id="kobo.279.1"> package and instead compares the text supplied in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">password</span></strong><span class="koboSpan" id="kobo.281.1"> field to the plain text values in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">src/lib/users.json</span></strong><span class="koboSpan" id="kobo.283.1"> file. </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">It cannot be stressed how terrible this is from a security standpoint and I am trusting you to never do this outside of this </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.285.1">particular demonstration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.287.1">Now that we have removed all dependencies</span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.288.1"> that require Node.js, we can proceed with our deployment to Cloudflare. </span><span class="koboSpan" id="kobo.288.2">Firstly, we should log in to a Cloudflare account, navigate to </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">Workers and</span></strong><strong class="bold"><span class="koboSpan" id="kobo.290.1"> Pages</span></strong><span class="koboSpan" id="kobo.291.1">, and click create application. </span><span class="koboSpan" id="kobo.291.2">From there, we can connect to a GitHub or GitLab account, and select a repository to connect with our Pages project. </span><span class="koboSpan" id="kobo.291.3">Cloudflare provides a few methods for moving your project to their platform, but we’ll only cover how to do so by connecting with a Git repository. </span><span class="koboSpan" id="kobo.291.4">Once a repository is selected, we then provide a project name, which defaults to the repository name, and select a branch to deploy from. </span><span class="koboSpan" id="kobo.291.5">If you are deploying from a fork of this book’s repository, you should specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">cloudflare</span></strong><span class="koboSpan" id="kobo.293.1"> here. </span><span class="koboSpan" id="kobo.293.2">Typically, this would be the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">main</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.295.1"> branch.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">From there, we can set up a few</span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.297.1"> options. </span><span class="koboSpan" id="kobo.297.2">Cloudflare makes this next step a breeze by asking whether we’re using a framework, which we are. </span><span class="koboSpan" id="kobo.297.3">Selecting </span><strong class="bold"><span class="koboSpan" id="kobo.298.1">SvelteKit</span></strong><span class="koboSpan" id="kobo.299.1"> from the </span><strong class="bold"><span class="koboSpan" id="kobo.300.1">Framework preset</span></strong><span class="koboSpan" id="kobo.301.1"> dropdown will auto-populate the </span><strong class="bold"><span class="koboSpan" id="kobo.302.1">Build command</span></strong><span class="koboSpan" id="kobo.303.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.304.1">Build output directory</span></strong><span class="koboSpan" id="kobo.305.1"> fields with the appropriate values. </span><span class="koboSpan" id="kobo.305.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.306.1">Figure 8</span></em></span><em class="italic"><span class="koboSpan" id="kobo.307.1">.1</span></em><span class="koboSpan" id="kobo.308.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">more information:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.310.1"><img alt="Figure 8.1 – Cloudflare Pages project settings" src="image/B19024_08_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.311.1">Figure 8.1 – Cloudflare Pages project settings</span></p>
<p><span class="koboSpan" id="kobo.312.1">Because the source code for the project we’re attempting to deploy from is in a subdirectory of the Git repository, we’ll have to specify that directory in the </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Path</span></strong><span class="koboSpan" id="kobo.314.1"> field. </span><span class="koboSpan" id="kobo.314.2">We then also need to specify </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">NODE_VERSION</span></strong><span class="koboSpan" id="kobo.316.1"> in the </span><strong class="bold"><span class="koboSpan" id="kobo.317.1">Environment variables</span></strong><span class="koboSpan" id="kobo.318.1"> section. </span><span class="koboSpan" id="kobo.318.2">Though SvelteKit only requires Node.js 16.14 or higher, we’ve specified version 18 as that is the current latest Long-Term</span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.319.1"> Support version of SvelteKit as well as the version used throughout the development of this book. </span><span class="koboSpan" id="kobo.319.2">Once everything has been filled out appropriately, you can save and deploy </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">the project!</span></span></p>
<p><span class="koboSpan" id="kobo.321.1">Cloudflare will then check out your code and attempt to build it. </span><span class="koboSpan" id="kobo.321.2">If everything is successful, you’ll be provided with a URL pointing to your application. </span><span class="koboSpan" id="kobo.321.3">For reference, a version of the application we’ve created thus far is live at </span><a href="https://sveltekit-up-and-running.pages.dev/"><span class="koboSpan" id="kobo.322.1">https://sveltekit-up-and-running.pages.dev/</span></a><span class="koboSpan" id="kobo.323.1">. </span><span class="koboSpan" id="kobo.323.2">Deploying an update to an application is as simple as pushing code to the appropriate branch in the </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">project repository.</span></span></p>
<p><span class="koboSpan" id="kobo.325.1">As you can see, deploying a SvelteKit application can be almost effortless once set up on serverless platforms such as Cloudflare Pages. </span><span class="koboSpan" id="kobo.325.2">The Vercel and Netlify adapters have similar processes, which you are encouraged</span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.326.1"> to explore at your leisure. </span><span class="koboSpan" id="kobo.326.2">While our particular project ran into a slight issue with an included dependency requiring Node.js, this example hopefully demonstrated how using the right adapter can </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">simplify deployments.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.328.1">adapter-static</span></h2>
<p><span class="koboSpan" id="kobo.329.1">While we only ran into</span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.330.1"> one minor problem with our previous adapter, we’ll most certainly run into problems with </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">adapter-static</span></strong><span class="koboSpan" id="kobo.332.1">. </span><span class="koboSpan" id="kobo.332.2">The reason for that is that this adapter is intended to only be used on platforms that can host static content – that is, platforms where no server backend logic exists. </span><span class="koboSpan" id="kobo.332.3">If you have a host that can serve static HTML, CSS, and JS, you can host an entire SvelteKit application there using this adapter. </span><span class="koboSpan" id="kobo.332.4">A common example is GitHub pages, but Cloudflare and many others also support this method. </span><span class="koboSpan" id="kobo.332.5">Hosting static applications has the added benefit of increased speed since no server backend exists to </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">communicate with.</span></span></p>
<p><span class="koboSpan" id="kobo.334.1">Since we won’t be able to get </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">adapter-static</span></strong><span class="koboSpan" id="kobo.336.1"> working with our project, we won’t attempt to install it on our existing project. </span><span class="koboSpan" id="kobo.336.2">But it is still an adapter worth discussing. </span><span class="koboSpan" id="kobo.336.3">Just like other adapters, it is easily installed via </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">this command:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.338.1">
npm install -D @sveltejs/adapter-static</span></pre>
<p><span class="koboSpan" id="kobo.339.1">And again, it can then be imported in </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">svelte.config.js</span></strong><span class="koboSpan" id="kobo.341.1">. </span><span class="koboSpan" id="kobo.341.2">This adapter varies from the others in that it prerenders the entire application. </span><span class="koboSpan" id="kobo.341.3">It is able to do this because we will insert </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">export let prerender = true;</span></strong><span class="koboSpan" id="kobo.343.1"> at the lowest level layout of our application. </span><span class="koboSpan" id="kobo.343.2">In each case, this will </span><span class="No-Break"><span class="koboSpan" id="kobo.344.1">be </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">src/routes/+layout.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.347.1">To customize the builds produced with this adapter, we’re provided with a few options. </span><span class="koboSpan" id="kobo.347.2">These options are passed to the adapter </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">svelte.config.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.350.1">:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">pages</span></strong><span class="koboSpan" id="kobo.352.1"> – A string value defaulting to </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">build</span></strong><span class="koboSpan" id="kobo.354.1"> that determines where prerendered pages will be </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">output to.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">assets</span></strong><span class="koboSpan" id="kobo.357.1"> – A string value defaulting to the value provided to </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">pages</span></strong><span class="koboSpan" id="kobo.359.1"> that determines where static assets should be </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">output to.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">fallback</span></strong><span class="koboSpan" id="kobo.362.1"> – A string value specifying</span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.363.1"> a fallback file to use when SSR has been disabled sitewide. </span><span class="koboSpan" id="kobo.363.2">Disabling SSR application-wide enables </span><strong class="bold"><span class="koboSpan" id="kobo.364.1">Single-Page App</span></strong><span class="koboSpan" id="kobo.365.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.366.1">SPA</span></strong><span class="koboSpan" id="kobo.367.1">) mode. </span><span class="koboSpan" id="kobo.367.2">Typically, this is </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">index.html</span></strong><span class="koboSpan" id="kobo.369.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">200.html</span></strong><span class="koboSpan" id="kobo.371.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.372.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">404.html</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">precompress</span></strong><span class="koboSpan" id="kobo.376.1"> – A Boolean value that determines whether files should be compressed using </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">brotli</span></strong><span class="koboSpan" id="kobo.378.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">gzip</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.380.1">compression algorithms.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">strict</span></strong><span class="koboSpan" id="kobo.382.1"> – A Boolean value that prevents the application from building if certain endpoints will not exist when prerendered. </span><span class="koboSpan" id="kobo.382.2">It can be useful to disable if your application makes use of pages that exist only in </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">specific circumstances.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.384.1">If you’re interested in trying </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">adapter-static</span></strong><span class="koboSpan" id="kobo.386.1"> for yourself, consider creating a new SvelteKit application using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">skeleton</span></strong><span class="koboSpan" id="kobo.388.1"> template. </span><span class="koboSpan" id="kobo.388.2">You can try with the </span><em class="italic"><span class="koboSpan" id="kobo.389.1">Demo App</span></em><span class="koboSpan" id="kobo.390.1">, but will run into issues</span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.391.1"> with server routes unable to be prerendered. </span><span class="koboSpan" id="kobo.391.2">These can be removed to get it working, but if your goal is to simply see how the static adapter works, it will likely be easier to deploy from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">skeleton</span></strong><span class="koboSpan" id="kobo.393.1"> template. </span><span class="koboSpan" id="kobo.393.2">Again, the steps for building a static application are </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">fairly straightforward:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.395.1">Install the adapter with </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">npm install -</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">D @sveltejs/adapter-static</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.399.1">Import the adapter </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">svelte.config.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.403.1">Ensure the application is entirely prerenderable by adding </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">export let prerender = true;</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.405.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">src/routes/+layout.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.408.1">Run the </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">npm run </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">build</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.411.1"> command!</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.412.1">Once your application has been built, you can simply copy it to anywhere that can serve static files. </span><span class="koboSpan" id="kobo.412.2">Of course, certain hosts may have their own requirements so be sure to read their documentation </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">A great way to learn about SvelteKit is by working with it. </span><span class="koboSpan" id="kobo.414.2">If you don’t already have a personal website, consider creating one using the SvelteKit static adapter. </span><span class="koboSpan" id="kobo.414.3">Not only does it not require a database or backend but it can also be deployed to almost any hosting provider. </span><span class="koboSpan" id="kobo.414.4">If you’re wondering where to start, Josh Collinsworth created a fantastic project using the static adapter. </span><span class="koboSpan" id="kobo.414.5">It enables users to add blog posts using Markdown while still existing as a static site. </span><span class="koboSpan" id="kobo.414.6">This means that hosting can be done for free on platforms such as GitHub Pages. </span><span class="koboSpan" id="kobo.414.7">You can find a link to Josh’s project in the </span><em class="italic"><span class="koboSpan" id="kobo.415.1">Resources</span></em><span class="koboSpan" id="kobo.416.1"> section at the end of this chapter. </span><span class="koboSpan" id="kobo.416.2">While our project and many others cannot make use of </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">adapter-static</span></strong><span class="koboSpan" id="kobo.418.1"> as they are not prerenderable, the value</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.419.1"> that this particular adapter provides for generating static sites </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">is clear.</span></span></p>
<h1 id="_idParaDest-114"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.421.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.422.1">Having covered how the SvelteKit build process works, we then observed how we can preview our builds locally. </span><span class="koboSpan" id="kobo.422.2">We also looked at how page options can affect our builds. </span><span class="koboSpan" id="kobo.422.3">We took what we learned about the build process and saw how we can tailor our application to various platforms by selecting the right adapter. </span><span class="koboSpan" id="kobo.422.4">The application we’ve built so far is best suited to Node.js environments but we’ve also seen how simple it is to deploy to Cloudflare Pages and platforms such as Netlify or Vercel. </span><span class="koboSpan" id="kobo.422.5">By using the correct adapter and development strategies, we can even turn our application into a static website. </span><span class="koboSpan" id="kobo.422.6">Now that you’ve seen how to prepare your application for different production environments, you can go forth and release your SvelteKit applications into </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">the wild.</span></span></p>
<p><span class="koboSpan" id="kobo.424.1">In the next chapter, we’ll learn how we can manipulate requests across our entire application through the use of hooks. </span><span class="koboSpan" id="kobo.424.2">We’ll also address how we can utilize these hooks to assist in managing errors. </span><span class="koboSpan" id="kobo.424.3">Because no application is perfect, we’ll address how SvelteKit lets us customize the user experience when issues </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">do arise.</span></span></p>
<h1 id="_idParaDest-115"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.426.1">Resources</span></h1>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.427.1">Svelte Society</span></em><span class="koboSpan" id="kobo.428.1"> – A central resource that provides many community-maintained Svelte-related projects including </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">adapters: </span></span><a href="https://sveltesociety.dev/"><span class="No-Break"><span class="koboSpan" id="kobo.430.1">https://sveltesociety.dev/</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.431.1">How Cloudflare Workers </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.432.1">Work</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">: </span></span><a href="https://developers.cloudflare.com/workers/learning/how-workers-works"><span class="No-Break"><span class="koboSpan" id="kobo.434.1">https://developers.cloudflare.com/workers/learning/how-workers-works</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.435.1">SvelteKit Blog Starter</span></em><span class="koboSpan" id="kobo.436.1"> by Josh </span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">Collinsworth: </span></span><a href="https://github.com/josh-collinsworth/sveltekit-blog-starter"><span class="No-Break"><span class="koboSpan" id="kobo.438.1">https://github.com/josh-collinsworth/sveltekit-blog-starter</span></span></a></li>
</ul>
</div>
</body></html>