<html><head></head><body><div class="chapter" title="Chapter&#xA0;13.&#xA0;Finishing Up: Performance"><div class="titlepage"><div><div><h1 class="title"><a id="ch13"/>Chapter 13. Finishing Up: Performance</h1></div></div></div><p>We will finish off by talking about performance and with good reason. While it is important to think about performance while developing your enterprise application, you may end up optimizing for things that do not exhibit any performance issues later on. This is often referred to as premature optimization and can end up wasting a lot of time. Although it is a good practice to understand performance implications of every decision of the development process, web performance optimization should not be conceived as a final goal; instead it is a constant tuning to improve and reach acceptable speed times for our enterprise application. Our real goal is to build our application and ensure that it functions correctly, then, if it is still necessary, improve the response times.</p><p>In this chapter we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Web Performance Optimization (WPO)</li><li class="listitem" style="list-style-type: disc">Following standards</li><li class="listitem" style="list-style-type: disc">Optimizing images</li><li class="listitem" style="list-style-type: disc">Optimizing CSS</li><li class="listitem" style="list-style-type: disc">JavaScript performance considerations</li><li class="listitem" style="list-style-type: disc">Additional page performance considerations</li><li class="listitem" style="list-style-type: disc">Performance analytics</li></ul></div><div class="section" title="Web Performance Optimization (WPO)"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec98"/>Web Performance Optimization (WPO)</h1></div></div></div><a id="id711" class="indexterm"/><p>Because an HTML5 enterprise application has many different moving parts, it is important to consider which parts you are optimizing. By and large, your HTML5 enterprise application will consist of HTML, images, and CSS and JavaScript code, and there are ways to optimize all three.</p></div></div>
<div class="section" title="Following standards"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec99"/>Following standards</h1></div></div></div><a id="id712" class="indexterm"/><p>HTML was developed to be a forgiving language; that is, mistakes in syntax rather than blowing up the page and causing endless debugging nightmares are dealt with in a more graceful manner. The rendering engine attempts to ascertain the intent of the markup and lays out the page accordingly. In essence, it stumbles but manages to keep its footing. Of course, a race run without hurdles goes faster than one run with hurdles. In addition, different web browsers will recover from such errors in different ways leading to inconsistent results when your HTML5 enterprise application is viewed in different browsers. That is why it is important to deliver clean, standards-compliant markup to the browser.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip69"/>Tip</h3><p>Despite the fact that following standards is a good base to start our optimizations, this could lead, in some cases, to more verbose code (increasing parsing time). Moreover, HTML5, unlike its previous versions, is not a finished standard yet and should be considered as a guidance more than as a set of rules.</p></div></div><p>Fortunately, there are many tools out there that will validate your markup for you. The <span class="strong"><strong>World Wide Web Consortium</strong></span>
<a id="id713" class="indexterm"/> (<span class="strong"><strong>W3C</strong></span>), which is the body that develops web standards, has its own validation tools that can be found at <a class="ulink" href="http://validator.w3.org/">http://validator.w3.org/</a>. There are also tools such as HTML Lint (<a class="ulink" href="http://lint.brihten.com/html/">http://lint.brihten.com/html/</a>) and HTML Tidy (<a class="ulink" href="http://infohound.net/tidy/">http://infohound.net/tidy/</a>) that will clean your markup for you. It is a good practice to validate your markup to make sure your enterprise applications behave quickly and consistently.</p></div>
<div class="section" title="Optimizing images"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec100"/>Optimizing images</h1></div></div></div><a id="id714" class="indexterm"/><p>Most websites these days embed images, and often these images are the biggest offenders when it comes to performance. Because of limited bandwidth and the large sizes of image files, your enterprise application could be in fact fairly snappy only to force users to wait while large images are delivered to their browsers. It is key to web optimize your images before using them in your web application.</p><p>There are two considerations for web optimization: size and type. With regard to size, while it is possible to set the width and height dimensions of an image in the <code class="literal">img</code> tag, it is a common mistake to take a single large image and use it for different purposes on a web application that calls for different sizes. For example, when displaying thumbnails, it is a bad practice to size a larger image down using only the <code class="literal">img</code> tag properties. Instead you should create different variants or renditions of the image for different purposes.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip70"/>Tip</h3><p>Specifying the <code class="literal">width</code> and <code class="literal">height</code> attributes on the <code class="literal">img</code> tag lets the browser know what real estate to allot an image before the image is actually downloaded, avoiding layout changes and undesired "jumps" in the UI. Be aware that this disagrees with the best practice of separate content and presentation layer to a great extent.</p></div></div><a id="id715" class="indexterm"/><p>With regard to type, there are indeed three types of images used on the web: GIF, JPEG, and PNG. These are based on different compression algorithms built for very different purposes. GIF images are optimized for low color palette images. They support 256 colors and are lossless and interlaced, which means they are rendered in layers rather than all at once (going from blurry to focused as you download and render them). They are ideal for logos and site graphics based on a lower color palette. JPEG images are ideal for high resolution photos as they support a higher color palette of 16 million colors. PNG images can support 256, 24 bit or 32 bit color palettes image formats with optional transparency, a very flexible and highly compressed lossless format, with superior transparency support and compression than GIF. The PNG algorithm was created as an open alternative to the GIF compression format, whose original creator, Unisys, announced in 1995 that it would be enforcing its patent on the algorithm.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip71"/>Tip</h3><p>Internet Explorer 6 and previous versions do not support PNG transparency based on HTML standards; instead it is necessary to use proprietary filters. For example, <code class="literal">filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='image.png' ,sizingMethod='crop');</code>.</p></div></div></div>
<div class="section" title="Optimizing CSS"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec101"/>Optimizing CSS</h1></div></div></div><a id="id716" class="indexterm"/><p>The best way to optimize your CSS is to reduce the file size. There are a number of things you can do to accomplish this. You can reduce whitespace by placing styles on a single line.</p><p>Implement the following line of code:</p><div class="informalexample"><pre class="programlisting">body {background-color:#fff;color:#000;font-size:1.0em;font-family:Arial;}</pre></div><p>Instead of this:</p><div class="informalexample"><pre class="programlisting">body 
{
  background-color:#ffffff;
  color:#000000;
  font-size:1.0em;
  font-family:Arial;
}</pre></div><p>You can use shorthand for many rules.</p><p>Implement the following line of code:</p><div class="informalexample"><pre class="programlisting">p {margin:10px 20px;}</pre></div><p>Instead of this:</p><div class="informalexample"><pre class="programlisting">p
{
  margin-top: 10px;
  margin-right: 20px;
  margin-bottom: 10px;
  margin-left: 20px;
}</pre></div><a id="id717" class="indexterm"/><p>It is also best to group similar styles as close together as possible and to combine duplicated styles wherever necessary.</p><p>Implement the following line of code:</p><div class="informalexample"><pre class="programlisting">p, ul {color:#efefef;}</pre></div><p>Instead of this:</p><div class="informalexample"><pre class="programlisting">p {color:#efefef;}
ul {color:#efefef;}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip72"/>Tip</h3><p>If you decide not to follow these recommendations to maintain readability, or even if you follow them, it is always possible to minify your code (as we explain in the following sections).</p></div></div><p>Another alternative is to use a dynamic stylesheet language such as<a id="id718" class="indexterm"/> <span class="strong"><strong>Less</strong></span> (<a class="ulink" href="http://lesscss.org">http://lesscss.org</a>). Less extends basic CSS functionality, allowing us to use more complex and elegant structures that will be translated in a standard CSS after a compilation process.</p><p>With normal CSS you need to repeat common properties such as colors:</p><div class="informalexample"><pre class="programlisting">p{color:#efefef}
div.box{border:1px solid #efefef}</pre></div><a id="id719" class="indexterm"/><p>Using Less you can define a variable <code class="literal">@active-color</code> and then use it through your styles, so you only need to change the value of those variables to change the color of multiple properties:</p><div class="informalexample"><pre class="programlisting">@active-color:#efefef;
p{color:@active-color }
div.box{border:1px solid @active-color}</pre></div><p>You can even create nested structures like so:</p><div class="informalexample"><pre class="programlisting">@active-color:#efefef;
.content{
  div.box{border:1px solid @active-color}
  p{color:@active-color }
}</pre></div><p>That will translate after compile in the following:</p><div class="informalexample"><pre class="programlisting">.content div.box{border:1px solid @active-color}
.content p{color:@active-color }</pre></div></div>
<div class="section" title="JavaScript performance considerations"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec102"/>JavaScript performance considerations</h1></div></div></div><a id="id720" class="indexterm"/><p>While writing JavaScript can be fraught with peril as it is very easy to introduce slow running code, keeping some simple guidelines in mind could keep your enterprise application from running too slow.</p><div class="mediaobject"><img src="graphics/5689_13_05.jpg" alt="JavaScript performance considerations"/></div><a id="id721" class="indexterm"/><p>First of all, traversing the DOM can be expensive. You want to minimize the number of times you invoke <code class="literal">document.getElementById</code> and, even worse, <code class="literal">document.getElementsByTagName</code>. Capturing a reference to a DOM element into a variable and using the variable can save on expensive calls to the DOM.</p><p>So instead of implementing the following code:</p><div class="informalexample"><pre class="programlisting">document.getElementsById("elementId").setAttribute("data-position", 1);
document.getElementsById("elementId").setAttribute("data-position", 1);</pre></div><p>Or implementing its equivalent in jQuery:</p><div class="informalexample"><pre class="programlisting">$("#elementId").attr("data-position", 1);
$("#elementId").attr("data-position", 1);</pre></div><p>You can implement the following code:</p><div class="informalexample"><pre class="programlisting">var element= document.getElementsById("elementId");
element.setAttribute("data-position", 1);
element.setAttribute("data-position", 1);</pre></div><p>Or you can implement its equivalent in jQuery:</p><div class="informalexample"><pre class="programlisting">var element= $("#elementId");
element.attr("data-position", 1);
element.attr("data-position", 1);</pre></div><p>Secondly, avoid constructs such as <code class="literal">with()</code> and <code class="literal">for-in</code>.</p><a id="id722" class="indexterm"/><p>Thirdly, remember that arrays can be slow. Traversing an array—especially a deep array—can be costly. If you are pulling the same element from an array many times, it is better to capture it in a variable first. That is, instead of the following code:</p><div class="informalexample"><pre class="programlisting">var array=[1,2,3,4,5];
console.log(array[3]+2);
console.log(array[3]*3);</pre></div><p>Or this:</p><div class="informalexample"><pre class="programlisting">var array=[1,2,3,4,5];
var elementSelected=array[3];
console.log(elementSelected+2);
console.log(elementSelected*3);</pre></div><p>Fourthly, arrays are not as slow as DOM collections. Looping over <code class="literal">document.getElementsByTagName('p')</code> is much slower than capturing the result in an array and looping over that.</p><p>Lastly, changing classes on a DOM element is less expensive than change styles. It is better to define multiple CSS classes and toggle between them than directly changing the style of an element.</p><p>So, instead of the following code:</p><div class="informalexample"><pre class="programlisting">domObject.style.display="none";</pre></div><p>Or its jQuery version:</p><div class="informalexample"><pre class="programlisting">$(domObject).css(display, "none");</pre></div><p>You can implement the following code:</p><div class="informalexample"><pre class="programlisting">domObject.setAttribute("class", "hideClass");</pre></div><p>Or this:</p><div class="informalexample"><pre class="programlisting">$(domObject.attr("class","hideClass");</pre></div><p>You can also benchmark your JavaScript using a tool called <a id="id723" class="indexterm"/>
<span class="strong"><strong>jsPerf</strong></span> (<a class="ulink" href="http://jsperf.com/">http://jsperf.com/</a>). It provides a way to create test cases for JavaScript code snippets so that you can benchmark their performance. If you are wondering which is faster, <code class="literal">document.getElementsByTagName</code> or <code class="literal">document.getElementsByClassName</code>, this tool will allow you to test your theory on your browser. Furthermore, it allows you to share your test cases so that others can test on different browsers giving you statistics across various browsers and platforms.<a id="id724" class="indexterm"/>
</p></div>
<div class="section" title="Additional page performance considerations"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec103"/>Additional page performance considerations</h1></div></div></div><a id="id725" class="indexterm"/><p>An enterprise application can be composed of many files including HTML, CSS, JavaScript, and images. Although for maintainability, it is proper to break out your CSS and JavaScript files. When deploying your code, combining and minifying your files leads to better performance.<a id="id726" class="indexterm"/> <span class="strong"><strong>Minification</strong></span> is a compression technique for code in which all unnecessary characters are removed while the behavior is preserved. There are a number of tools that will do this for you including the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a id="id727" class="indexterm"/>JSMin (<a class="ulink" href="http://www.crockford.com/javascript/jsmin.html">http://www.crockford.com/javascript/jsmin.html</a>)</li><li class="listitem" style="list-style-type: disc"><a id="id728" class="indexterm"/>Packer (<a class="ulink" href="http://dean.edwards.name/packer/">http://dean.edwards.name/packer/</a>)</li><li class="listitem" style="list-style-type: disc">YUI Compressor (<a class="ulink" href="http://developer.yahoo.com/yui/compressor/">http://developer.yahoo.com/yui/compressor/</a>)</li></ul></div><p>In the vein of reducing file size, minimizing requests, and in general using as little bandwidth as possible, the use of CSS sprites has become common these days wherein all of the static graphic elements for an application are combined into a single image, parts of which are displayed using CSS. This way only one image needs to be downloaded once instead of many.</p><div class="section" title="Server-side considerations"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec93"/>Server-side considerations</h2></div></div></div><a id="id729" class="indexterm"/><p>An enterprise application often has many static assets that are downloaded from the server with each page request. As this creates a lot of unnecessary traffic on the server, one way to offload the burden is to use a content delivery network or CDN. A CDN allows you to mirror your pages on a network of servers that are optimized for delivering static assets quickly. You can place your static assets on a CDN such as Akamai, Edgecast, or Cloudflare as well as use CDN-hosted versions of popular libraries. Google hosts a number of libraries for public consumption such as jQuery in its <a id="id730" class="indexterm"/>CDN (<a class="ulink" href="https://developers.google.com/speed/libraries/">https://developers.google.com/speed/libraries/</a>) as does cdnjs (<a class="ulink" href="http://cdnjs.com/">http://cdnjs.com/</a>).</p><a id="id731" class="indexterm"/><p>Many web servers such as Apache can be instructed to compress what they send to the browser before they send it. If you are able to, adding a <code class="literal">Content-Encoding</code> header set to <code class="literal">gzip</code> in your response can reduce the amount of data transferred by 70 percent.</p><p>It is important to consider caching in your enterprise application. If the same request is made over and over again, and the response is always the same or seldom changes, cache the response and send it back when subsequent requests are made. Browsers intrinsically support this with the <code class="literal">Cache-Control</code> header and the <code class="literal">Expires</code> header. While <code class="literal">Expires</code> tells the browser how long to keep content in the page cache, <code class="literal">Cache-Control</code> provides a set of rules for when to keep and when to invalidate the cache. Some useful parameters include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">max-age</code>: <a id="id732" class="indexterm"/>This indicates the maximum amount of time before a piece of content should be refreshed</li><li class="listitem" style="list-style-type: disc"><code class="literal">public</code>: <a id="id733" class="indexterm"/>This indicates that a piece of content is cacheable even though it requires authentication</li><li class="listitem" style="list-style-type: disc"><code class="literal">private</code>: <a id="id734" class="indexterm"/>This indicates that a piece of content is cacheable on a per-user basis</li><li class="listitem" style="list-style-type: disc"><code class="literal">no-cache</code>:<a id="id735" class="indexterm"/> This indicates that a piece of content can be cached but should be refreshed on every request</li><li class="listitem" style="list-style-type: disc"><code class="literal">no-store</code>:<a id="id736" class="indexterm"/> This indicates that a piece of content should not be kept in cache</li><li class="listitem" style="list-style-type: disc"><code class="literal">must-revalidate</code>: <a id="id737" class="indexterm"/>This indicates that the browser must check with the server first before serving a cached version</li></ul></div><p>Caching not only helps to improve response times, it relieves your server load and reduces network traffic.</p><p>Yahoo! has provided a number of useful guidelines for ensuring page performance. While many of these topics have already been covered, you are encouraged to check out the guidelines for yourself at <a class="ulink" href="http://developer.yahoo.com/performance/">http://developer.yahoo.com/performance/</a>.</p></div></div>
<div class="section" title="Performance analytics"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec104"/>Performance analytics</h1></div></div></div><a id="id738" class="indexterm"/><p>You may yet follow all of the rules for optimal performance and still find yourself with a slow application. When this happens, you need to become adept at assessing load times and profiling your application. Fortunately, there are many tools available to help pinpoint the bottlenecks; these tools are explained in the coming sections.<a id="id739" class="indexterm"/>
</p><div class="section" title="Load times"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec94"/>Load times</h2></div></div></div><a id="id740" class="indexterm"/><p>All of the major browsers include a network tab that will graphically display all of the requests and responses between the browser and the servers it contacts. Firefox includes a <a id="id741" class="indexterm"/>
<span class="strong"><strong>Net</strong></span> tab as part of the Firebug add-on as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/5689_13_06.jpg" alt="Load times"/></div><p>It displays a set of bars that indicate load time per request over time. Here you can see the web page loading piece-by-piece including how it loads the HTML first and then requests the ancillary assets afterward: image files, CSS files, JavaScript files, and even subsequent AJAX requests. As you can see in the following screenshot, when you hover over each bar, you will see statistics about that request including DNS lookup, connection time, the time to send the request, wait, and receive the response, and so on.</p><div class="mediaobject"><img src="graphics/5689_13_07.jpg" alt="Load times"/></div><a id="id742" class="indexterm"/><p>This is particularly helpful when attempting to debug a performance problem because it tells you very clearly whether slowness is due to a connection problem or a page load problem, for example, how the HTML is constructed and parsed. Knowing these finer details helps greatly to uncover and remove bottlenecks.</p><p>In addition to browser-based tools to assess load time, there are external services that allow you to assess load time. In particular, <a id="id743" class="indexterm"/>Pingdom (<a class="ulink" href="http://tools.pingdom.com/fpt/">http://tools.pingdom.com/fpt/</a>) provides a service that you can use to periodically test the load times of your web application. It provides a similar chart for determining where your bottlenecks are. Alternatives include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Google Speed <a id="id744" class="indexterm"/>(<a class="ulink" href="https://developers.google.com/speed/">https://developers.google.com/speed/</a>)</li><li class="listitem" style="list-style-type: disc">YSlow<a id="id745" class="indexterm"/> (<a class="ulink" href="http://developer.yahoo.com/yslow/">http://developer.yahoo.com/yslow/</a>)</li><li class="listitem" style="list-style-type: disc">Gomez(<a class="ulink" href="http://www.gomez.com/website-performance-test/">http://www.gomez.com/website-performance-test/</a>)</li></ul></div></div><div class="section" title="Profilers"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec95"/>Profilers</h2></div></div></div><a id="id746" class="indexterm"/><p>Profilers are another way to assess performance. Typically, they list JavaScript calls in order of execution time, which can be really helpful to pinpoint slow-running functions. Some browsers such as Google Chrome and Safari include a <a id="id747" class="indexterm"/>CSS selector profiler, which lists the slowest running CSS selectors.</p><p>Firefox has a profiler built into its Firebug add-on. Click on the<a id="id748" class="indexterm"/> <span class="strong"><strong>Console</strong></span> tab and click on <span class="strong"><strong>Profile</strong></span>.<a id="id749" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/5689_13_01.jpg" alt="Profilers"/></div><p>In Google Chrome's <span class="strong"><strong>Developer Tools</strong></span>, you will find a <span class="strong"><strong>Profiles</strong></span> tab.<a id="id750" class="indexterm"/>
</p><p>Safari provides an <span class="strong"><strong>Instrument</strong></span> tab.<a id="id751" class="indexterm"/>
</p><p>Internet Explorer 9 offers a profiler as well in its Developer Tools. Click on <span class="strong"><strong>Profiler</strong></span> and then the <a id="id752" class="indexterm"/>
<span class="strong"><strong>Start profiling</strong></span> button to get started.</p><p>Profilers will usually list out the slowest running functions, how many times they were invoked, and the amount of time they took to execute. They typically split the notion of execution time into two categories. Some call it exclusive time while others call it self or own time. This is the execution time while within a function, excluding the execution time of other functions invoked from within that function. The other category is referred to as inclusive time, total time, or just time. This is the execution time of a function including functions that are invoked from within it.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec105"/>Summary</h1></div></div></div><p>We covered ways to ensure performance of your enterprise application on many different levels. There are ways to ensure clean HTML that your browser will understand, and there are ways to ensure optimal CSS and JavaScript. There are ways to reduce the page footprint, decrease the number of requests, and place less of a burden on the browser. While each of these is important in their own way, real performance gains are not always apparent until you put them all together.</p><p>We have built our example application, MovieNow, including the most important steps to build any enterprise application; from the definition of a meaningful structure using semantic tags, to the styling and animations with CSS3, showing new and exciting features such as canvas 2D and WebGL, geolocation, video, audio, drag-and-drop, and web workers. We practised the use of real world APIs such as Twitter, and reviewed a set of tools and libraries to facilitate the process of development, testing, and performance improvement.</p><p>We encourage you to continue reading about new web technologies. As we speak, there are many developers who are creating not only new enterprise applications but new libraries, techniques, tools, and paradigms of thought that can redefine the web as we know it.</p><p>Finally, we hope you have enjoyed this journey as much as we have, and that the initial guidelines of this book lead you to many successful HTML5 projects.</p></div></body></html>