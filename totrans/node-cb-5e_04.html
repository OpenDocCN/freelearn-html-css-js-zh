<html><head></head><body>
  <div id="_idContainer021">
   <h1 class="chapter-number" id="_idParaDest-101">
    <a id="_idTextAnchor100">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     4
    </span>
   </h1>
   <h1 id="_idParaDest-102">
    <a id="_idTextAnchor101">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Using Web Protocols
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Node.js was built with web servers in mind.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Using Node.js, we can quickly create a web server with a few lines of code, allowing us to customize the behavior of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      our server.
     </span>
    </span>
   </p>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.5.1">
      HTTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.6.1">
     stands
    </span>
    <a id="_idIndexMarker180">
    </a>
    <span class="koboSpan" id="kobo.7.1">
     for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      HyperText Transfer Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     and is an application layer protocol that underpins the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.10.1">
      World Wide Web
     </span>
    </strong>
    <span class="koboSpan" id="kobo.11.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.12.1">
      WWW
     </span>
    </strong>
    <span class="koboSpan" id="kobo.13.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.13.2">
     HTTP is
    </span>
    <a id="_idIndexMarker181">
    </a>
    <span class="koboSpan" id="kobo.14.1">
     a stateless protocol that was originally designed to facilitate communication between web browsers and servers.
    </span>
    <span class="koboSpan" id="kobo.14.2">
     The recipes in this chapter will have a large emphasis on how to handle and send HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.14.3">
     Although the recipes do not require a deep understanding of how HTTP operates, it would be worthwhile reading a high-level overview if you’re completely new to the concept.
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.15.1">
      MDN Web Docs
     </span>
    </em>
    <span class="koboSpan" id="kobo.16.1">
     provides an overview of HTTP
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.17.1">
      at
     </span>
    </span>
    <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.19.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.20.1">
     This chapter will showcase the low-level core
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.21.1">
      application programming interfaces
     </span>
    </strong>
    <span class="koboSpan" id="kobo.22.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.23.1">
      APIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.24.1">
     ) that Node.js provides
    </span>
    <a id="_idIndexMarker182">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     for interacting with web protocols.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     We’ll start by making HTTP requests, creating an HTTP server, and learning how to handle
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.26.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.27.1">
     requests and file uploads.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     Later in the chapter, we will learn how to create a WebSocket server and how to create a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.28.1">
      Simple Mail Transfer Protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.29.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.30.1">
      SMTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.31.1">
     ) server
    </span>
    <a id="_idIndexMarker183">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.32.1">
      using Node.js.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.33.1">
     It’s important to understand how Node.js interacts with underlying web protocols, as these web protocols and fundamental concepts form the basis of most real-world web applications.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     Later, in
    </span>
    <a href="B19212_06.xhtml#_idTextAnchor178">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.34.1">
        Chapter 6
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.35.1">
     , we will learn how to use web frameworks that abstract web protocols into higher-level APIs, but understanding how Node.js interacts with web protocols at a low level
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      is important.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.37.1">
     This chapter will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.38.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.39.1">
      Making
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.40.1">
       HTTP requests
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.41.1">
      Creating an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.42.1">
       HTTP server
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.43.1">
      Receiving HTTP
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.44.1">
        POST
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.45.1">
       requests
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.46.1">
      Handling
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.47.1">
       file uploads
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.48.1">
      Creating a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.49.1">
       WebSocket server
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.50.1">
      Creating an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.51.1">
       SMTP server
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-103">
    <a id="_idTextAnchor102">
    </a>
    <span class="koboSpan" id="kobo.52.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.53.1">
     This chapter will require you to have Node.js installed – preferably, a recent version of Node.js 22.
    </span>
    <span class="koboSpan" id="kobo.53.2">
     Also, you will need access to both an editor and a browser of your choice.
    </span>
    <span class="koboSpan" id="kobo.53.3">
     The code samples used in this chapter are available on GitHub at
    </span>
    <a href="https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition">
     <span class="koboSpan" id="kobo.54.1">
      https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.55.1">
     in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.56.1">
       Chapter04
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.57.1">
      directory.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-104">
    <a id="_idTextAnchor103">
    </a>
    <span class="koboSpan" id="kobo.58.1">
     Making HTTP requests
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.59.1">
     Programs and applications
    </span>
    <a id="_idIndexMarker184">
    </a>
    <span class="koboSpan" id="kobo.60.1">
     often need to obtain data from another source or server.
    </span>
    <span class="koboSpan" id="kobo.60.2">
     In modern web development, this is commonly achieved by sending an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.61.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.62.1">
     request to the source or server.
    </span>
    <span class="koboSpan" id="kobo.62.2">
     Similarly, an application or program may also need to send data to other sources or servers.
    </span>
    <span class="koboSpan" id="kobo.62.3">
     This is often achieved by sending an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.63.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.64.1">
     request containing the data to the target source
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      or server.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.66.1">
     As well as being used to build HTTP servers, the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.67.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.68.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.69.1">
      https
     </span>
    </strong>
    <span class="koboSpan" id="kobo.70.1">
     modules expose APIs that can be used to send HTTP requests to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.71.1">
      other servers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.72.1">
     In this recipe, we’re going to use the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.73.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.74.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.75.1">
      https
     </span>
    </strong>
    <span class="koboSpan" id="kobo.76.1">
     modules to send both an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.77.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.78.1">
     request and an HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.79.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.80.1">
      request.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-105">
    <a id="_idTextAnchor104">
    </a>
    <span class="koboSpan" id="kobo.81.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.82.1">
     Start by creating a directory named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.83.1">
      making-requests
     </span>
    </strong>
    <span class="koboSpan" id="kobo.84.1">
     for this recipe.
    </span>
    <span class="koboSpan" id="kobo.84.2">
     We’ll also create a file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.85.1">
      called
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.86.1">
       requests.js
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.88.1">
$ mkdir making-requests
$ cd making-requests
$ touch requests.js</span></pre>
   <h2 id="_idParaDest-106">
    <a id="_idTextAnchor105">
    </a>
    <span class="koboSpan" id="kobo.89.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.90.1">
     We’re going to use the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.91.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.92.1">
     module to send an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.93.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.94.1">
     request and an HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.95.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.96.1">
      request.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.97.1">
      Start by importing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.98.1">
       http
      </span>
     </strong>
     <span class="koboSpan" id="kobo.99.1">
      module in your
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.100.1">
        requests.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.101.1">
       file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.102.1">
const http = require('node:http');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.103.1">
      Now, we can send an HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.104.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.105.1">
      request.
     </span>
     <span class="koboSpan" id="kobo.105.2">
      We’re going to send a request to
     </span>
     <a href="http://example.com">
      <span class="koboSpan" id="kobo.106.1">
       http://example.com
      </span>
     </a>
     <span class="koboSpan" id="kobo.107.1">
      .
     </span>
     <span class="koboSpan" id="kobo.107.2">
      This can be done with one line
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.108.1">
       of code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.109.1">
http.get('http://example.com', (res) =&gt;
  res.pipe(process.stdout));</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.110.1">
      Execute your Node.js script with the following command.
     </span>
     <span class="koboSpan" id="kobo.110.2">
      You should expect to see the HTML representation of
     </span>
     <a href="http://example.com">
      <span class="koboSpan" id="kobo.111.1">
       http://example.com
      </span>
     </a>
     <span class="koboSpan" id="kobo.112.1">
      printed
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.113.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.114.1">
        stdout
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.115.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.116.1">$ node requests.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.117.1">
      Now, we can look at how we send an HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.118.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      request.
     </span>
     <span class="koboSpan" id="kobo.119.2">
      Start by commenting out the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.120.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.121.1">
      request with
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.122.1">
       //
      </span>
     </strong>
     <span class="koboSpan" id="kobo.123.1">
      – leaving it in will make the output of later steps difficult
     </span>
     <a id="_idIndexMarker185">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.124.1">
       to read:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.125.1">
// http.get('http://example.com', (res) =&gt;
  res.pipe(process.stdout));</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.126.1">
      For our HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.127.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.128.1">
      request, we will first need to define the data that we want to send with the request.
     </span>
     <span class="koboSpan" id="kobo.128.2">
      To achieve this, we define a variable named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.129.1">
       payload
      </span>
     </strong>
     <span class="koboSpan" id="kobo.130.1">
      containing
     </span>
     <a id="_idIndexMarker186">
     </a>
     <span class="koboSpan" id="kobo.131.1">
      a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.132.1">
       JavaScript Object Notation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.133.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.134.1">
       JSON
      </span>
     </strong>
     <span class="koboSpan" id="kobo.135.1">
      ) representation of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       our data:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.137.1">
const payload = JSON.stringify({
    'name': 'Laddie',
    'breed': 'Rough Collie'
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.138.1">
      We also need to create a configuration object for the options we want to send with the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.139.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.140.1">
      request.
     </span>
     <span class="koboSpan" id="kobo.140.2">
      We’re going to send the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.141.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.142.1">
      request to
     </span>
     <a href="http://postman-echo.com">
      <span class="koboSpan" id="kobo.143.1">
       http://postman-echo.com
      </span>
     </a>
     <span class="koboSpan" id="kobo.144.1">
      .
     </span>
     <span class="koboSpan" id="kobo.144.2">
      This is a test endpoint that will return our HTTP headers, parameters, and content of our HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.145.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.146.1">
      request – mirroring
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.147.1">
       our request:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.148.1">
const opts = {
  method: 'POST',
  hostname: 'postman-echo.com',
  path: '/post',
  headers: {
    'Content-Type': 'application/json',
    'Content-Length': Buffer.byteLength(payload)
  }
};</span></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.149.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.150.1">
     Postman (
    </span>
    <a href="http://postman.com">
     <span class="koboSpan" id="kobo.151.1">
      http://postman.com
     </span>
    </a>
    <span class="koboSpan" id="kobo.152.1">
     ) is a platform for API development and provides a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.153.1">
      Representational State Transfer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.154.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.155.1">
      REST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.156.1">
     ) client application that you can download to use to
    </span>
    <a id="_idIndexMarker187">
    </a>
    <span class="koboSpan" id="kobo.157.1">
     send HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.157.2">
     Postman also provides a service named Postman Echo – this provides an endpoint that you can send your HTTP requests to for testing.
    </span>
    <span class="koboSpan" id="kobo.157.3">
     Refer to the Postman
    </span>
    <a id="_idIndexMarker188">
    </a>
    <span class="koboSpan" id="kobo.158.1">
     Echo documentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.159.1">
      here:
     </span>
    </span>
    <a href="https://docs.postman-echo.com/?version=latest">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.160.1">
       https://docs.postman-echo.com/?version=latest
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.161.1">
      .
     </span>
    </span>
   </p>
   <ol>
    <li value="7">
     <span class="koboSpan" id="kobo.162.1">
      To send the HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.163.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.164.1">
      request, add the following code.
     </span>
     <span class="koboSpan" id="kobo.164.2">
      This will write the responses of
     </span>
     <a id="_idIndexMarker189">
     </a>
     <span class="koboSpan" id="kobo.165.1">
      the HTTP status code and request body to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.166.1">
       stdout
      </span>
     </strong>
     <span class="koboSpan" id="kobo.167.1">
      once the response
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.168.1">
       is received:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.169.1">
const req = http.request(opts, (res) =&gt; {
  process.stdout.write('Status Code: ' +
    res.statusCode + '\n');
  process.stdout.write('Body: ');
  res.pipe(process.stdout);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.170.1">
      We should also catch any errors that occur on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.171.1">
       the request:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.172.1">
req.on('error', (err) =&gt; console.error('Error: ',
  err));</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.173.1">
      Finally, we need to send our request with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.174.1">
       the payload:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.175.1">
req.end(payload);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.176.1">
      Now, execute your program, and you should see that the Postman Echo API responds to
     </span>
     <a id="_idIndexMarker190">
     </a>
     <span class="koboSpan" id="kobo.177.1">
      our HTTP
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.178.1">
        POST
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.179.1">
       request:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.180.1">$ node requests.js</span></strong><span class="koboSpan" id="kobo.181.1">
Status Code: 200
Body: {
  "args": {},
  "data": {
    "name": "Laddie",
    "breed": "Rough Collie"
  },
  "files": {},
  "form": {},
  "headers": {
    "x-forwarded-proto": "http",
    "x-forwarded-port": "80",
    "host": "postman-echo.com",
    "x-amzn-trace-id": "Root=1-656ddcfe-
      52b1cf7a1671685c6985fa59",
    "content-length": "53",
    "content-type": "application/json"
  },
  "json": {
    "name": "Laddie",
    "breed": "Rough Collie"
  },
  "url": "http://postman-echo.com/post"
}%</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.182.1">
     We’ve learned how to use the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.183.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.184.1">
     module to send HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.185.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.186.1">
     and HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.187.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      requests.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-107">
    <a id="_idTextAnchor106">
    </a>
    <span class="koboSpan" id="kobo.189.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.190.1">
     In this recipe, we leveraged the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.191.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.192.1">
     module to send HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     and HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     requests.
    </span>
    <span class="koboSpan" id="kobo.196.2">
     The Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.197.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     module relies on the underlying Node.js core
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.199.1">
       net
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.200.1">
      module.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.201.1">
     For the HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.202.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.203.1">
     request, we call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.204.1">
      http.get()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.205.1">
     function with two parameters.
    </span>
    <span class="koboSpan" id="kobo.205.2">
     The first parameter is the endpoint that we wish to send the request to, and the second is the callback
    </span>
    <a id="_idIndexMarker191">
    </a>
    <span class="koboSpan" id="kobo.206.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.206.2">
     The callback function executes once the HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.207.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.208.1">
     request is complete, and in this recipe, our function forwards the response we receive from the endpoint
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.209.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.210.1">
       stdout
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.211.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.212.1">
     To make the HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.213.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.214.1">
     request, we use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.215.1">
      http.request()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.216.2">
     This function also takes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.217.1">
      two parameters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.218.1">
     The first parameter to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.219.1">
      request()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     function is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.221.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.222.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.222.2">
     In the recipe
    </span>
    <span class="Annotation-reference">
     <span class="koboSpan" id="kobo.223.1">
      ,
     </span>
    </span>
    <span class="koboSpan" id="kobo.224.1">
     we used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.225.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.226.1">
     object to configure which HTTP method to use, the hostname, the path the request should be sent to, and the headers to be set on the request.
    </span>
    <span class="koboSpan" id="kobo.226.2">
     A full list of configuration options that can be passed to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.227.1">
      request()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.228.1">
     function is viewable in the Node.js HTTP API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.229.1">
      documentation (
     </span>
    </span>
    <a href="https://nodejs.org/api/http.html#http_http_request_options_callback">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.230.1">
       https://nodejs.org/api/http.html#http_http_request_options_callback
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.231.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.232.1">
     The second parameter to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.233.1">
      request()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.234.1">
     function is the callback function to be executed upon completion of the HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.235.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     request.
    </span>
    <span class="koboSpan" id="kobo.236.2">
     Our request function writes the HTTP status code and forwards the request’s
    </span>
    <a id="_idIndexMarker192">
    </a>
    <span class="koboSpan" id="kobo.237.1">
     response to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.238.1">
      standard
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.239.1">
       output
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.240.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.241.1">
       stdout
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.242.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.243.1">
     An error event listener was added to the request object to capture and log any errors
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.244.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.245.1">
       stdout
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.246.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.247.1">
req.on('error', (err) =&gt; console.error('Error: ', err));</span></pre>
   <p>
    <span class="koboSpan" id="kobo.248.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.249.1">
      req.end(payload);
     </span>
    </strong>
    <span class="koboSpan" id="kobo.250.1">
     statement sends our request with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.251.1">
      the payload.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.252.1">
     It’s also possible to combine this
    </span>
    <a id="_idIndexMarker193">
    </a>
    <span class="koboSpan" id="kobo.253.1">
     API with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.254.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.255.1">
     syntax.
    </span>
    <span class="koboSpan" id="kobo.255.2">
     Add the following to a file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.256.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.257.1">
       requestPromise.js
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.258.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.259.1">
const http = require('node:http');
function httpGet (url) {
  return new Promise((resolve, reject) =&gt; {
    http
      .get(url, (res) =&gt; {
        let data = '';
        res.on('data', (chunk) =&gt; {
          data += chunk;
        });
        res.on('end', () =&gt; {
          resolve(data);
        });
      })
      .on('error', (err) =&gt; {
        reject(err);
      });
  });
}
const run = async () =&gt; {
  const res = await httpGet('http://example.com');
  console.log(res);
};
run();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.260.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.261.1">
      httpGet()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.262.1">
     function uses a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.263.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.264.1">
     to manage an asynchronous HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.265.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.266.1">
     request: it resolves with the full data on successful completion and rejects with an error if the request fails.
    </span>
    <span class="koboSpan" id="kobo.266.2">
     This setup allows for easy integration with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.267.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.268.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.269.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.270.1">
     for handling asynchronous
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.271.1">
      HTTP operations.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-108">
    <a id="_idTextAnchor107">
    </a>
    <span class="koboSpan" id="kobo.272.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.273.1">
     The recipe demonstrated how to send
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.274.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.275.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     requests over HTTP, but it is also worth considering how to send requests over HTTPS.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.278.1">
      HTTPS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.279.1">
     stands for
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.280.1">
      HyperText Transfer Protocol Secure
     </span>
    </strong>
    <span class="koboSpan" id="kobo.281.1">
     .
    </span>
    <span class="koboSpan" id="kobo.281.2">
     HTTPS is an extension of the HTTP protocol.
    </span>
    <span class="koboSpan" id="kobo.281.3">
     Communications
    </span>
    <a id="_idIndexMarker194">
    </a>
    <span class="koboSpan" id="kobo.282.1">
     over HTTPS are encrypted.
    </span>
    <span class="koboSpan" id="kobo.282.2">
     Node.js core provides an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.283.1">
      https
     </span>
    </strong>
    <span class="koboSpan" id="kobo.284.1">
     module, alongside the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.285.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.286.1">
     module, to be used when dealing with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.287.1">
      HTTPS communications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.288.1">
     It is possible to change the requests in the recipe to use HTTPS by importing the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.289.1">
      https
     </span>
    </strong>
    <span class="koboSpan" id="kobo.290.1">
     core module and changing any instances of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.291.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.292.1">
     to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.293.1">
      https
     </span>
    </strong>
    <span class="koboSpan" id="kobo.294.1">
     .
    </span>
    <span class="koboSpan" id="kobo.294.2">
     You also will need to send the request to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.295.1">
      HTTPS endpoint:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.296.1">
const https = require('node:https');
https.get('https://example.com', ...);
https.request('https://example.com', ...);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.297.1">
     Having covered the basics with the traditional HTTP and HTTPS modules for making requests, let’s pivot
    </span>
    <a id="_idIndexMarker195">
    </a>
    <span class="koboSpan" id="kobo.298.1">
     to explore how to use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.299.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.300.1">
     syntax and the more recently added
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.301.1">
      Fetch API.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.302.1">
     Using the Fetch API
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.303.1">
     Let’s explore
    </span>
    <a id="_idIndexMarker196">
    </a>
    <span class="koboSpan" id="kobo.304.1">
     the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.305.1">
      Fetch API
     </span>
    </strong>
    <span class="koboSpan" id="kobo.306.1">
     , a modern
    </span>
    <a id="_idIndexMarker197">
    </a>
    <span class="koboSpan" id="kobo.307.1">
     web API designed for making HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.307.2">
     While it has been available in browsers for some time, it has more recently become available by default in Node.js.
    </span>
    <span class="koboSpan" id="kobo.307.3">
     In Node.js, the Fetch API is a higher-level alternative to the core HTTP modules, offering a simplified and user-friendly abstraction over lower-level HTTP APIs.
    </span>
    <span class="koboSpan" id="kobo.307.4">
     It embraces a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.308.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.309.1">
     -based approach for handling
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.310.1">
      asynchronous operations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.311.1">
     Starting from Node.js version 18, the Fetch API is readily available as a global API.
    </span>
    <span class="koboSpan" id="kobo.311.2">
     The implementation in Node.js is powered by
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.312.1">
      undici
     </span>
    </strong>
    <span class="koboSpan" id="kobo.313.1">
     , an HTTP/1.1 client developed from scratch specifically for Node.js.
    </span>
    <span class="koboSpan" id="kobo.313.2">
     You can find more information about
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.314.1">
      undici
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.315.1">
      at
     </span>
    </span>
    <a href="https://undici.nodejs.org/#/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.316.1">
       https://undici.nodejs.org/#/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.317.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.318.1">
     The implementation was inspired by the frequently used
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.319.1">
      node-fetch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.320.1">
     (
    </span>
    <a href="https://npmjs.com/package/node-fetch">
     <span class="koboSpan" id="kobo.321.1">
      https://npmjs.com/package/node-fetch
     </span>
    </a>
    <span class="koboSpan" id="kobo.322.1">
     ) package.
    </span>
    <span class="koboSpan" id="kobo.322.2">
     The Node.js implementation of the Fetch API strives to be as close to specification-compliant as possible, but some aspects of the Fetch API specification are more browser-oriented and are therefore omitted in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.323.1">
      Node.js implementation.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.324.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.325.1">
     You can directly use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      undici
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     as a module for lower-level and more fine-grained control of handling HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.327.2">
     Read the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.328.1">
      undici
     </span>
    </strong>
    <span class="koboSpan" id="kobo.329.1">
     API documentation for more
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.330.1">
      information:
     </span>
    </span>
    <a href="https://undici.nodejs.org/#/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.331.1">
       https://undici.nodejs.org/#/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.332.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.333.1">
     Let us look at
    </span>
    <a id="_idIndexMarker198">
    </a>
    <span class="koboSpan" id="kobo.334.1">
     an example of making HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.335.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.336.1">
     and HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.337.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.338.1">
     requests using the Node.js
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.339.1">
      Fetch API:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.340.1">
      Create a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.341.1">
       fetchGet.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.342.1">
      and a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.343.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.344.1">
        fetchPost.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.345.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.346.1">
$ touch fetchGet.js fetchPost.js</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.347.1">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.348.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.349.1">
        fetchGet.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.350.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.351.1">
async function performGetRequest() {
  const url = 'https://api.github.com/orgs/nodejs';
  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`HTTP error! </span><span class="koboSpan" id="kobo.351.2">Status:
        ${response.status}`);
    }
    const data = await response.json();
    console.log('GET request successful:', data);
  } catch (error) {
    console.error('Error during GET request:',
      error);
  }
}
performGetRequest();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.352.1">
      You can run this example with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.353.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.354.1">$ node fetchGet.js</span></strong><span class="koboSpan" id="kobo.355.1">
GET request successful: {
  login: 'nodejs',
  id: 9950313,
  ...
</span><span class="koboSpan" id="kobo.355.2">}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.356.1">
      To
     </span>
     <a id="_idIndexMarker199">
     </a>
     <span class="koboSpan" id="kobo.357.1">
      demonstrate
     </span>
     <a id="_idIndexMarker200">
     </a>
     <span class="koboSpan" id="kobo.358.1">
      making an HTTP
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.359.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.360.1">
      request using the Node.js Fetch API, add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.361.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.362.1">
        fetchPost.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.363.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.364.1">
async function performPostRequest() {
  const url = 'https://postman-echo.com/post';
  const postData = {
    name: 'Laddie',
    breed: 'Rough Collie'
  };
  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(postData)
    });
    if (!response.ok) {
      throw new Error(`HTTP error! </span><span class="koboSpan" id="kobo.364.2">Status:
        ${response.status}`);
    }
    const data = await response.json();
    console.log('POST request successful:', data);
  } catch (error) {
    console.error('Error during POST request:',
      error);
  }
}
performPostRequest();</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.365.1">
       Note the use of
      </span>
      <a id="_idIndexMarker201">
      </a>
      <span class="koboSpan" id="kobo.366.1">
       the configuration object to set the HTTP method to
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.367.1">
        POST
       </span>
      </strong>
      <span class="koboSpan" id="kobo.368.1">
       and set the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.369.1">
        content type.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.370.1">
      Run the example with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.371.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.372.1">$ node fetchPost.js</span></strong><span class="koboSpan" id="kobo.373.1">
POST request successful: {
  args: {},
  data: { name: 'Laddie', breed: 'Rough Collie' },
...</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     As the implementation of the Fetch API in Node.js intends to be as compatible with the specification as
    </span>
    <a id="_idIndexMarker202">
    </a>
    <span class="koboSpan" id="kobo.375.1">
     possible, you can refer to
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.376.1">
      MDN Web Docs
     </span>
    </em>
    <span class="koboSpan" id="kobo.377.1">
     for more detailed usage information:
    </span>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">
     <span class="koboSpan" id="kobo.378.1">
      https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API
     </span>
    </a>
    <span class="koboSpan" id="kobo.379.1">
     .
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.380.1">
      MDN Web Docs
     </span>
    </em>
    <span class="koboSpan" id="kobo.381.1">
     provides
    </span>
    <a id="_idIndexMarker203">
    </a>
    <span class="koboSpan" id="kobo.382.1">
     a comprehensive
    </span>
    <a id="_idIndexMarker204">
    </a>
    <span class="koboSpan" id="kobo.383.1">
     and often considered canonical resource for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.384.1">
      web developers.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.385.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.386.1">
     It’s advisable to stay informed about updates and changes to its status as Node.js may release newer versions that refine the Fetch API implementation.
    </span>
    <span class="koboSpan" id="kobo.386.2">
     Refer to the API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.387.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/dist/latest-v22.x/docs/api/globals.html#fetch">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.388.1">
       https://nodejs.org/dist/latest-v22.x/docs/api/globals.html#fetch
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.389.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-109">
    <a id="_idTextAnchor108">
    </a>
    <span class="koboSpan" id="kobo.390.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.391.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.392.1">
       Creating an HTTP server
      </span>
     </em>
     <span class="koboSpan" id="kobo.393.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.394.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.395.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.396.1">
       Receiving HTTP POST requests
      </span>
     </em>
     <span class="koboSpan" id="kobo.397.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.398.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <em class="italic">
      <span class="koboSpan" id="kobo.399.1">
       Chapters 3
      </span>
     </em>
     <span class="koboSpan" id="kobo.400.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.401.1">
       6
      </span>
     </em>
     <span class="koboSpan" id="kobo.402.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.403.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.404.1">
        9
       </span>
      </em>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-110">
    <a id="_idTextAnchor109">
    </a>
    <span class="koboSpan" id="kobo.405.1">
     Creating an HTTP server
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.406.1">
     When building large
    </span>
    <a id="_idIndexMarker205">
    </a>
    <span class="koboSpan" id="kobo.407.1">
     complex applications, it is typical to implement HTTP servers using a higher-level web framework rather than interacting with core Node.js APIs.
    </span>
    <span class="koboSpan" id="kobo.407.2">
     However, understanding the underlying APIs is important, and in some cases, only interacting with the underlying Node.js APIs will provide you with the fine-grained control required in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.408.1">
      certain circumstances.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.409.1">
     In the previous section, we explored foundational concepts of HTTP and relevant Node.js core APIs.
    </span>
    <span class="koboSpan" id="kobo.409.2">
     In this tutorial, we’ll guide you through the process of building an HTTP server using Node.js where we’ll initially focus on handling
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.410.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.411.1">
     requests – fundamental functionality for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.412.1">
      web servers.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-111">
    <a id="_idTextAnchor110">
    </a>
    <span class="koboSpan" id="kobo.413.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.414.1">
     Start by creating a directory for this recipe and a file named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.415.1">
      server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.416.1">
     that will contain our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.417.1">
      HTTP server:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.418.1">
$ mkdir http-server
$ cd http-server
$ touch server.js</span></pre>
   <h2 id="_idParaDest-112">
    <a id="_idTextAnchor111">
    </a>
    <span class="koboSpan" id="kobo.419.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.420.1">
     For this recipe, we will be using the core Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.421.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.422.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.422.2">
     API documentation for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.423.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.424.1">
     module is available at
    </span>
    <a href="https://nodejs.org/api/http.html">
     <span class="koboSpan" id="kobo.425.1">
      https://nodejs.org/api/http.html
     </span>
    </a>
    <span class="koboSpan" id="kobo.426.1">
     .
    </span>
    <span class="koboSpan" id="kobo.426.2">
     In the recipe, we’ll create a “To Do”
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.427.1">
      task server.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.428.1">
      To start, we need to import the core Node.js
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.429.1">
       http
      </span>
     </strong>
     <span class="koboSpan" id="kobo.430.1">
      module by adding the following line
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.431.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.432.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.433.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.434.1">
const http = require('node:http');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.435.1">
      We’ll start by defining the hostname and port for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.436.1">
       our server:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.437.1">
const HOSTNAME = process.env.HOSTNAME || '0.0.0.0';
const PORT = process.env.PORT || 3000;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.438.1">
      Next, we can create the server and add some route handling.
     </span>
     <span class="koboSpan" id="kobo.438.2">
      Within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.439.1">
       createServer()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.440.1">
      function, we will reference the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.441.1">
       error()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.442.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.443.1">
       todo()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.444.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.445.1">
       index()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.446.1">
      functions that we’ll create in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.447.1">
       following steps:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.448.1">
const server = http.createServer((req, res) =&gt; {
  if (req.method !== 'GET') return error(res, 405);
  if (req.url === '/todo') return todo(res);
  if (req.url === '/') return index(res);
  error(res, 404);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.449.1">
      Now, let’s create our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.450.1">
       error()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.451.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.451.2">
      This function will take a parameter of the response object and a status code, where the code is expected to be an HTTP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.452.1">
       status
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker206">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.453.1">
       code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.454.1">
function error (res, code) {
  res.statusCode = code;
  res.end(`{"error":
    "${http.STATUS_CODES[code]}"}`);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.455.1">
      We will now create our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.456.1">
       todo()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.457.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.457.2">
      For now, this function will just return a static JSON string representing an item on the “To
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.458.1">
       Do” list:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.459.1">
function todo (res) {
  res.end('[{"task_id": 1, "description": "walk the
    dog"}]}');
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.460.1">
      The final function to create is an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.461.1">
       index()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.462.1">
      function, which will be called when we perform a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.463.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.464.1">
      request on the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.465.1">
       /
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.466.1">
       route:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.467.1">
function index (res) {
  res.end('{"name": "todo-server"}');
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.468.1">
      Finally, we need to call the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.469.1">
       listen()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.470.1">
      function on our server.
     </span>
     <span class="koboSpan" id="kobo.470.2">
      We’ll also pass a callback function to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.471.1">
       listen()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.472.1">
      function that will log out the address that the server is listening on once the server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.473.1">
       has started:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.474.1">
server.listen(PORT, HOSTNAME, () =&gt; {
  console.log(`Server listening on port
    ${server.address().port}`);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.475.1">
      It’s now possible to start our server from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.476.1">
       our terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.477.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.478.1">Server listening on port 3000</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.479.1">
      In a separate terminal window, we can either use cURL to send
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.480.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.481.1">
      requests to our server or
     </span>
     <a id="_idIndexMarker207">
     </a>
     <span class="koboSpan" id="kobo.482.1">
      access the various endpoints in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.483.1">
       our browser:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.484.1">
$ curl http://localhost:3000/
{"name": "todo-server"}%
$ curl http://localhost:3000/todo
[{"task_id": 1, "description": "walk the dog"}]}%
$ curl -X DELETE http://localhost:3000/
{"error": "Method Not Allowed"}%
$ curl http://localhost:3000/not-an-endpoint
{"error": "Not Found"}%</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.485.1">
     We’ve built a barebones “To Do” list server that we can send HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.486.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.487.1">
     requests to, and the server responds with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.488.1">
      JSON data.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-113">
    <a id="_idTextAnchor112">
    </a>
    <span class="koboSpan" id="kobo.489.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.490.1">
     The Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.491.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.492.1">
     module provides interfaces to the features of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.493.1">
      HTTP protocol.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.494.1">
     In the recipe, we created a server using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.495.1">
      createServer()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.496.1">
     function that is exposed by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.497.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.498.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.498.2">
     We passed the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.499.1">
      createServer()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.500.1">
     function a request listener function that is executed upon
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.501.1">
      each request.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.502.1">
     Each time a request is received to the specified route, the request listener function will execute.
    </span>
    <span class="koboSpan" id="kobo.502.2">
     The request listener function has two parameters,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.503.1">
      req
     </span>
    </strong>
    <span class="koboSpan" id="kobo.504.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.505.1">
      res
     </span>
    </strong>
    <span class="koboSpan" id="kobo.506.1">
     , where
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.507.1">
      req
     </span>
    </strong>
    <span class="koboSpan" id="kobo.508.1">
     is the request object and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.509.1">
      res
     </span>
    </strong>
    <span class="koboSpan" id="kobo.510.1">
     is the response object.
    </span>
    <span class="koboSpan" id="kobo.510.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.511.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.512.1">
     module creates the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.513.1">
      req
     </span>
    </strong>
    <span class="koboSpan" id="kobo.514.1">
     object based on the data in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.515.1">
      the request.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.516.1">
     It is possible to pass the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.517.1">
      createServer()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.518.1">
     function an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.519.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.520.1">
     object as the first parameter.
    </span>
    <span class="koboSpan" id="kobo.520.2">
     Refer to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.521.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.522.1">
     module Node.js API documentation to see which parameters and options can be passed to the various
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.523.1">
      http
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.524.1">
      functions:
     </span>
    </span>
    <a href="https://nodejs.org/api/http.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.525.1">
       https://nodejs.org/api/http.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.526.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.527.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.528.1">
      createServer()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.529.1">
     function returns an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.530.1">
      http.Server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.531.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.531.2">
     We start the server by calling the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.532.1">
      listen()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.533.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.533.2">
     We pass the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.534.1">
      listen()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.535.1">
     function our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.536.1">
      HOSTNAME
     </span>
    </strong>
    <span class="koboSpan" id="kobo.537.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.538.1">
      PORT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.539.1">
     parameters to instruct the server which hostname and port it should be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.540.1">
      listening on.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.541.1">
     Our request handler in the recipe is formed of three
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.542.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.543.1">
     statements.
    </span>
    <span class="koboSpan" id="kobo.543.2">
     The first
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.544.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.545.1">
     statement checks the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.546.1">
      req.method
     </span>
    </strong>
    <span class="koboSpan" id="kobo.547.1">
     property for which HTTP method the incoming request was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.548.1">
      sent with:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.549.1">
  if (req.method !== 'GET') return error(res, 405);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.550.1">
     In this recipe, we
    </span>
    <a id="_idIndexMarker208">
    </a>
    <span class="koboSpan" id="kobo.551.1">
     only allowed
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     requests.
    </span>
    <span class="koboSpan" id="kobo.553.2">
     When any other HTTP method is detected on the incoming request, we return and call our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.554.1">
      error function.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.555.1">
     The second two
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.556.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.557.1">
     statements inspect the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.558.1">
       req.url
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.559.1">
      value:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.560.1">
  if (req.url === '/todo') return todo(res);
  if (req.url === '/') return index(res);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.561.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.562.1">
      url
     </span>
    </strong>
    <span class="koboSpan" id="kobo.563.1">
     property on the request object informs us which route the request was sent to.
    </span>
    <span class="koboSpan" id="kobo.563.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.564.1">
      req.url
     </span>
    </strong>
    <span class="koboSpan" id="kobo.565.1">
     property does not provide
    </span>
    <a id="_idIndexMarker209">
    </a>
    <span class="koboSpan" id="kobo.566.1">
     the full
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.567.1">
      Uniform Resource Locator
     </span>
    </strong>
    <span class="koboSpan" id="kobo.568.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.569.1">
      URL
     </span>
    </strong>
    <span class="koboSpan" id="kobo.570.1">
     ), just the relative path or “route” segment.
    </span>
    <span class="koboSpan" id="kobo.570.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.571.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.572.1">
     statements in this recipe control which function is called upon each request to a specific URL – this forms
    </span>
    <a id="_idIndexMarker210">
    </a>
    <span class="koboSpan" id="kobo.573.1">
     a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.574.1">
      simple
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.575.1">
       route handler
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.576.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.577.1">
     The final line of our listener function calls our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.578.1">
      error()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.579.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.579.2">
     This line will only be reached if none of our conditional
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.580.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.581.1">
     statements are satisfied.
    </span>
    <span class="koboSpan" id="kobo.581.2">
     In our recipe, this will happen when a request is sent to any route other than
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.582.1">
      /
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.583.1">
      or
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.584.1">
       /todo
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.585.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.586.1">
     We pass the response object,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.587.1">
      res
     </span>
    </strong>
    <span class="koboSpan" id="kobo.588.1">
     , to each of our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.589.1">
      error()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.590.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.591.1">
      todo()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.592.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.593.1">
      index()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.594.1">
     functions.
    </span>
    <span class="koboSpan" id="kobo.594.2">
     This object is a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.595.1">
      Stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.596.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.596.2">
     We call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.597.1">
      res.end()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.598.1">
     to return the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.599.1">
      desired content.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.600.1">
     For the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.601.1">
      error()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.602.1">
     function, we pass an additional parameter,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.603.1">
      code
     </span>
    </strong>
    <span class="koboSpan" id="kobo.604.1">
     .
    </span>
    <span class="koboSpan" id="kobo.604.2">
     We use this to pass and then return HTTP status codes.
    </span>
    <span class="koboSpan" id="kobo.604.3">
     HTTP status codes are part of the HTTP protocol specification (
    </span>
    <a href="https://tools.ietf.org/html/rfc2616#section-10">
     <span class="koboSpan" id="kobo.605.1">
      https://tools.ietf.org/html/rfc2616#section-10
     </span>
    </a>
    <span class="koboSpan" id="kobo.606.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.606.2">
     The following table shows how HTTP response codes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.607.1">
      are grouped:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-2">
    <colgroup>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.608.1">
           Range
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.609.1">
           Use
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.610.1">
           1xx
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.611.1">
          Information
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.612.1">
           2xx
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.613.1">
          Success
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.614.1">
           3xx
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.615.1">
          Redirection
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.616.1">
           4xx
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.617.1">
          Client error
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.618.1">
           5xx
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.619.1">
          Server error
         </span>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.620.1">
     Table 4.1 – Table listing HTTP status codes and their use
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.621.1">
     In the recipe, we returned the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.622.1">
      error codes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.623.1">
      404 –
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.624.1">
       Not Found
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.625.1">
      405 – Method
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.626.1">
       Not Allowed
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.627.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.628.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.629.1">
     module
    </span>
    <a id="_idIndexMarker211">
    </a>
    <span class="koboSpan" id="kobo.630.1">
     exposes a constant object that stores all the HTTP response codes and their corresponding descriptions:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.631.1">
      http.STATUS_CODES
     </span>
    </strong>
    <span class="koboSpan" id="kobo.632.1">
     .
    </span>
    <span class="koboSpan" id="kobo.632.2">
     We used this to return the response message
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.633.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.634.1">
       http.STATUS_CODE
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.635.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-114">
    <a id="_idTextAnchor113">
    </a>
    <span class="koboSpan" id="kobo.636.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.637.1">
     In the recipe, we defined a constant for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.638.1">
      HOSTNAME
     </span>
    </strong>
    <span class="koboSpan" id="kobo.639.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.640.1">
      PORT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.641.1">
     values with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.642.1">
      following lines:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.643.1">
const HOSTNAME = process.env.HOSTNAME || '0.0.0.0';
const PORT = process.env.PORT || 3000;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.644.1">
     The use of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.645.1">
      process.env
     </span>
    </strong>
    <span class="koboSpan" id="kobo.646.1">
     allows the values to be set as environment variables.
    </span>
    <span class="koboSpan" id="kobo.646.2">
     If the environmental variables are not set, then our use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.647.1">
      OR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.648.1">
     logical operator (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.649.1">
      ||
     </span>
    </strong>
    <span class="koboSpan" id="kobo.650.1">
     ) will mean our hostname and port values default to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.651.1">
      0.0.0.0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.652.1">
     and
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.653.1">
       3000
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.654.1">
      respectively.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.655.1">
     It’s a good practice to allow the hostname and port values to be set via environment variables as this allows deployment orchestrators, such as Kubernetes, to inject these values
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.656.1">
      at runtime.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.657.1">
     It’s also possible to bind your HTTP server to a random free port.
    </span>
    <span class="koboSpan" id="kobo.657.2">
     To do this, we set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.658.1">
      PORT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.659.1">
     value to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.660.1">
      0
     </span>
    </strong>
    <span class="koboSpan" id="kobo.661.1">
     .
    </span>
    <span class="koboSpan" id="kobo.661.2">
     You can change our recipe code that assigns the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.662.1">
      PORT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.663.1">
     variable to the following to instruct the server to listen to a random
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.664.1">
      free port:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.665.1">
const PORT = process.env.PORT || 0;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.666.1">
     Binding to any random port in Node.js is useful when deploying on platforms that dynamically assign ports (for example, cloud services) or in scenarios with potential port conflicts (for example, multiple instances
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.667.1">
      running simultaneously).
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.668.1">
     Using --env-file
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.669.1">
     As of Node.js 20.6.0 and
    </span>
    <a id="_idIndexMarker212">
    </a>
    <span class="koboSpan" id="kobo.670.1">
     later, there is a new command-line option
    </span>
    <a id="_idIndexMarker213">
    </a>
    <span class="koboSpan" id="kobo.671.1">
     that can be used to load environment variables from files.
    </span>
    <span class="koboSpan" id="kobo.671.2">
     This provides similar functionality to the commonly used
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.672.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.673.1">
     package
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.674.1">
      dotenv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.675.1">
     (
    </span>
    <a href="https://www.npmjs.com/package/dotenv">
     <span class="koboSpan" id="kobo.676.1">
      https://www.npmjs.com/package/dotenv
     </span>
    </a>
    <span class="koboSpan" id="kobo.677.1">
     ) by loading environment variables
    </span>
    <a id="_idIndexMarker214">
    </a>
    <span class="koboSpan" id="kobo.678.1">
     into
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.679.1">
      process.env
     </span>
    </strong>
    <span class="koboSpan" id="kobo.680.1">
     from a file containing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.681.1">
      environment variables.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.682.1">
     Each line in the file should consist of a key-value pair representing an environment variable, with the name and value separated by an equals sign (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.683.1">
      =
     </span>
    </strong>
    <span class="koboSpan" id="kobo.684.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.684.2">
     For example, you would add the following to define the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.685.1">
      HOSTNAME
     </span>
    </strong>
    <span class="koboSpan" id="kobo.686.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.687.1">
      PORT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.688.1">
     variables to the default values used in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.689.1">
      the recipe:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.690.1">
HOSTNAME='0.0.0.0'
PORT=3000</span></pre>
   <p>
    <span class="koboSpan" id="kobo.691.1">
     Often, this file will be called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.692.1">
      .env
     </span>
    </strong>
    <span class="koboSpan" id="kobo.693.1">
     for local development, but it is also common to have multiple environment files representing different application environments, such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.694.1">
      .staging.env
     </span>
    </strong>
    <span class="koboSpan" id="kobo.695.1">
     for environment values that correspond to the staging application of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.696.1">
      your development.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.697.1">
     To load the values in the environment, you need to supply the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.698.1">
      --env-file
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.699.1">
      command-line option:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.700.1">
$ node --env-file=.env server.js</span></pre>
   <p>
    <span class="koboSpan" id="kobo.701.1">
     If the same variable is defined in the environment and the file, the value from the environment will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.702.1">
      take precedence.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.703.1">
     Note that at the time of writing, this feature is
    </span>
    <a id="_idIndexMarker215">
    </a>
    <span class="koboSpan" id="kobo.704.1">
     designated as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.705.1">
      Experimental
     </span>
    </strong>
    <span class="koboSpan" id="kobo.706.1">
     status, meaning the feature may be subject to breaking changes and/or removal.
    </span>
    <span class="koboSpan" id="kobo.706.2">
     More details can be
    </span>
    <a id="_idIndexMarker216">
    </a>
    <span class="koboSpan" id="kobo.707.1">
     found in the
    </span>
    <a id="_idIndexMarker217">
    </a>
    <span class="koboSpan" id="kobo.708.1">
     official API documentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.709.1">
      at
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest-v22.x/api/cli.html#--env-fileconfig">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.710.1">
       https://nodejs.org/docs/latest-v22.x/api/cli.html#--env-fileconfig
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.711.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-115">
    <a id="_idTextAnchor114">
    </a>
    <span class="koboSpan" id="kobo.712.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.713.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.714.1">
       Receiving HTTP POST requests
      </span>
     </em>
     <span class="koboSpan" id="kobo.715.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.716.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <em class="italic">
      <span class="koboSpan" id="kobo.717.1">
       Chapters 6
      </span>
     </em>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.718.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.719.1">
        11
       </span>
      </em>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-116">
    <a id="_idTextAnchor115">
    </a>
    <span class="koboSpan" id="kobo.720.1">
     Receiving HTTP POST requests
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.721.1">
     The HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.722.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.723.1">
     method is
    </span>
    <a id="_idIndexMarker218">
    </a>
    <span class="koboSpan" id="kobo.724.1">
     employed for transmitting data to the server, in contrast to the HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.725.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.726.1">
     method, which is utilized to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.727.1">
      retrieve data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.728.1">
     To be able to receive
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.729.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.730.1">
     data, we need to instruct our server on how to accept and handle
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.731.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.732.1">
     requests.
    </span>
    <span class="koboSpan" id="kobo.732.2">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.733.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.734.1">
     request typically contains data within the body of the request, which is sent to the server to be handled.
    </span>
    <span class="koboSpan" id="kobo.734.2">
     The submission of a web form is typically done via an HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.735.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.736.1">
      request.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.737.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.738.1">
     In PHP, it is possible to access
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.739.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.740.1">
     data via a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.741.1">
      $_POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.742.1">
     array.
    </span>
    <span class="koboSpan" id="kobo.742.2">
     PHP does not follow the non-blocking architecture that Node.js does, which means that the PHP program would wait or block until the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.743.1">
      $_POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.744.1">
     values are populated.
    </span>
    <span class="koboSpan" id="kobo.744.2">
     Node.js, however, provides asynchronous interaction with HTTP data at a lower level, which allows us to interface with the incoming message body as a stream.
    </span>
    <span class="koboSpan" id="kobo.744.3">
     This means that the handling of the incoming stream is within the developer’s control
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.745.1">
      and concern.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.746.1">
     In this recipe, we’re going to create a web server that accepts and handles HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.747.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.748.1">
      requests.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-117">
    <a id="_idTextAnchor116">
    </a>
    <span class="koboSpan" id="kobo.749.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.750.1">
     To prepare the groundwork for the recipe, we’ll start by setting up the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.751.1">
      project structure.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.752.1">
      Start by creating a directory for this recipe.
     </span>
     <span class="koboSpan" id="kobo.752.2">
      We’ll also need a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.753.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.754.1">
      that will contain our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.755.1">
       HTTP server:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.756.1">$ mkdir post-server</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.757.1">$ cd post-server</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.758.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.759.1">
      We also need to create a subdirectory called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.760.1">
       public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.761.1">
      , containing a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.762.1">
       form.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.763.1">
      that will contain an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.764.1">
       HTML form:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.765.1">$ mkdir public</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.766.1">$ touch public/form.html</span></strong></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-118">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.767.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.768.1">
     We’re going to create a server
    </span>
    <a id="_idIndexMarker219">
    </a>
    <span class="koboSpan" id="kobo.769.1">
     that accepts and handles both HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.770.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.771.1">
     and HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.772.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.773.1">
     requests using the Node.js core APIs provided by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.774.1">
       http
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.775.1">
      module.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.776.1">
      First, let’s set up an HTML form with input fields for forename and surname.
     </span>
     <span class="koboSpan" id="kobo.776.2">
      Open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.777.1">
       form.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.778.1">
      and add
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.779.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.780.1">
&lt;form method="POST"&gt;
    &lt;label for="forename"&gt;Forename:&lt;/label&gt;
    &lt;input id="forename" name="forename"&gt;
    &lt;label for="surname"&gt;Surname:&lt;/label&gt;
    &lt;input id="surname" name="surname"&gt;
    &lt;input type="submit" value="Submit"&gt;
&lt;/form&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.781.1">
      Next, open the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.782.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.783.1">
      file and import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.784.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.785.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.786.1">
       http
      </span>
     </strong>
     <span class="koboSpan" id="kobo.787.1">
      , and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.788.1">
       path
      </span>
     </strong>
     <span class="koboSpan" id="kobo.789.1">
      Node.js
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.790.1">
       core modules:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.791.1">
const http = require('node:http');
const fs = require('node:fs');
const path = require('node:path');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.792.1">
      On the next line, we’ll create a reference to our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.793.1">
        form.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.794.1">
       file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.795.1">
const form = fs.readFileSync(path.join(__dirname, 'public', 'form.html'));</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.796.1">
      Now, add the following lines of code to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.797.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.798.1">
      to set up the server.
     </span>
     <span class="koboSpan" id="kobo.798.2">
      We’ll also create a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.799.1">
       get()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.800.1">
      function to
     </span>
     <a id="_idIndexMarker220">
     </a>
     <span class="koboSpan" id="kobo.801.1">
      return the form and an error function
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.802.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.803.1">
        error()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.804.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.805.1">
http
  .createServer((req, res) =&gt; {
    if (req.method === 'GET') {
      get(res);
      return;
    }
    error(405, res);
  })
  .listen(3000, () =&gt; console.log('Server running on
    http://localhost:3000/'));
function get (res) {
  res.writeHead(200, {
    'Content-Type': 'text/html'
  });
  res.end(form);
}
function error (code, res) {
  res.statusCode = code;
  res.end(http.STATUS_CODES[code]);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.806.1">
      Start your server and confirm that you can view the form in your browser
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.807.1">
       at
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.808.1">
        http://localhost:3000
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.809.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.810.1">$ node server.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.811.1">
       Expect to see the
      </span>
      <a id="_idIndexMarker221">
      </a>
      <span class="koboSpan" id="kobo.812.1">
       following HTML form in
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.813.1">
        your browser:
       </span>
      </span>
     </p>
     <div class="IMG---Figure" id="_idContainer020">
      <span class="koboSpan" id="kobo.814.1">
       <img alt="Figure 4.1 – Browser window depicting an HTML form" src="image/B19212_04_01.jpg"/>
      </span>
     </div>
    </li>
   </ol>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.815.1">
     Figure 4.1 – Browser window depicting an HTML form
    </span>
   </p>
   <ol>
    <li value="6">
     <span class="koboSpan" id="kobo.816.1">
      In your browser, click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.817.1">
       Submit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.818.1">
      on the form.
     </span>
     <span class="koboSpan" id="kobo.818.2">
      Notice that you receive a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.819.1">
       Method Not Allowed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.820.1">
      error message.
     </span>
     <span class="koboSpan" id="kobo.820.2">
      This is because we do not yet have a conditional statement in our request listener function that handles
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.821.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.822.1">
      requests.
     </span>
     <span class="koboSpan" id="kobo.822.2">
      Let’s add one now.
     </span>
     <span class="koboSpan" id="kobo.822.3">
      Add the following code below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.823.1">
       if
      </span>
     </strong>
     <span class="koboSpan" id="kobo.824.1">
      statement that checks for
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.825.1">
        GET
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.826.1">
       requests:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.827.1">
  if (req.method === 'POST') {
      post(req, res);
      return;
    }</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.828.1">
      Now, we’ll also need to define our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.829.1">
       post()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.830.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.830.2">
      Add this below your
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.831.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.832.1">
      file, ideally
     </span>
     <a id="_idIndexMarker222">
     </a>
     <span class="koboSpan" id="kobo.833.1">
      just below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.834.1">
       get()
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.835.1">
       function definition:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.836.1">
function post (req, res) {
  if (req.headers['content-type'] !==
    'application/x-www-form-urlencoded') {
    error(415, res);
    return;
  }
  let input = '';
  req.on('data', (chunk) =&gt; {
    input += chunk.toString();
  });
  req.on('end', () =&gt; {
    console.log(input);
    res.end(http.STATUS_CODES[200]);
  });
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.837.1">
      Restart your server, return to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.838.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.839.1">
      in your browser, and submit the form.
     </span>
     <span class="koboSpan" id="kobo.839.2">
      You should see an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.840.1">
       OK
      </span>
     </strong>
     <span class="koboSpan" id="kobo.841.1">
      message returned.
     </span>
     <span class="koboSpan" id="kobo.841.2">
      If you look at the terminal window where you’re running your server, you can see that the server received
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.842.1">
       your data:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.843.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.844.1">forename=Ada&amp;surname=Lovelace</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.845.1">
     We’ve now created a server that accepts and handles both HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.846.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.847.1">
     and HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.848.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.849.1">
     requests using the Node.js
    </span>
    <a id="_idIndexMarker223">
    </a>
    <span class="koboSpan" id="kobo.850.1">
     core APIs provided by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.851.1">
       http
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.852.1">
      module.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-119">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.853.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.854.1">
     The Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.855.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.856.1">
     module is built on top of and interacts with the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.857.1">
      net
     </span>
    </strong>
    <span class="koboSpan" id="kobo.858.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.858.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.859.1">
      net
     </span>
    </strong>
    <span class="koboSpan" id="kobo.860.1">
     module interacts with an underlying C library built into Node.js, called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.861.1">
      libuv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.862.1">
     .
    </span>
    <span class="koboSpan" id="kobo.862.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.863.1">
      libuv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.864.1">
     C library handles network
    </span>
    <a id="_idIndexMarker224">
    </a>
    <span class="koboSpan" id="kobo.865.1">
     socket
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.866.1">
      input/output
     </span>
    </strong>
    <span class="koboSpan" id="kobo.867.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.868.1">
      I/O
     </span>
    </strong>
    <span class="koboSpan" id="kobo.869.1">
     ) and handles the passing of data between the C and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.870.1">
      JavaScript layers.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.871.1">
     As in previous recipes, we call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.872.1">
      createServer()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.873.1">
     function, which returns an HTTP server object.
    </span>
    <span class="koboSpan" id="kobo.873.2">
     Then, calling the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.874.1">
      listen()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.875.1">
     method on the server object instructs the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.876.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.877.1">
     module to start listening for incoming data on the specified address
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.878.1">
      and port.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.879.1">
     When the server receives an HTTP request, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.880.1">
      http
     </span>
    </strong>
    <span class="koboSpan" id="kobo.881.1">
     module will create objects representing the HTTP request (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.882.1">
      req
     </span>
    </strong>
    <span class="koboSpan" id="kobo.883.1">
     ) and the HTTP response (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.884.1">
      res
     </span>
    </strong>
    <span class="koboSpan" id="kobo.885.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.885.2">
     After this, our request handler is called with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.886.1">
      req
     </span>
    </strong>
    <span class="koboSpan" id="kobo.887.1">
     and
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.888.1">
       res
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.889.1">
      arguments.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.890.1">
     Our route handler has the following
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.891.1">
      if
     </span>
    </strong>
    <span class="koboSpan" id="kobo.892.1">
     statements, which inspect each request to see if it is an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.893.1">
      GET
     </span>
    </strong>
    <span class="koboSpan" id="kobo.894.1">
     request or an HTTP
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.895.1">
       POST
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.896.1">
      request:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.897.1">
http
  .createServer((req, res) =&gt; {
    if (req.method === 'GET') {
      get(res);
      return;
    }
    if (req.method === 'POST') {
      post(req, res);
      return;
    }
    error(405, res);
  })
  .listen(3000);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.898.1">
     Our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.899.1">
      get()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.900.1">
     function sets the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.901.1">
      Content-Type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.902.1">
     HTTP header to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.903.1">
      text/html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.904.1">
     , as we’re expecting to return an HTML form.
    </span>
    <span class="koboSpan" id="kobo.904.2">
     We call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.905.1">
      res.end()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.906.1">
     function to finish
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.907.1">
      WriteStream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.908.1">
     , write the response, and end the HTTP connection.
    </span>
    <span class="koboSpan" id="kobo.908.2">
     Refer to
    </span>
    <a href="B19212_03.xhtml#_idTextAnchor068">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.909.1">
        Chapter 3
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.910.1">
     for more information
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.911.1">
      on
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.912.1">
       WriteStream
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.913.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.914.1">
     Similarly, our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.915.1">
      post()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.916.1">
     function checks the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.917.1">
      Content-Type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.918.1">
     headers to determine whether we can support the supplied values.
    </span>
    <span class="koboSpan" id="kobo.918.2">
     In this instance, we only accept the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.919.1">
      Content-Type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.920.1">
     header of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.921.1">
      application/x-www-form-urlencode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.922.1">
     , and our error function will be called if the request is sent with any other
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.923.1">
      content type.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.924.1">
     Within our request handler function, we register a listener for the data event.
    </span>
    <span class="koboSpan" id="kobo.924.2">
     Each time a chunk of data is received, we convert it to a string using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.925.1">
      toString()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.926.1">
     method and append it to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.927.1">
      input variable.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.928.1">
     Once all the data is received from the client, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.929.1">
      end
     </span>
    </strong>
    <span class="koboSpan" id="kobo.930.1">
     event is triggered.
    </span>
    <span class="koboSpan" id="kobo.930.2">
     We pass a callback function to
    </span>
    <a id="_idIndexMarker225">
    </a>
    <span class="koboSpan" id="kobo.931.1">
     the end event listener, which gets called only once all data is received.
    </span>
    <span class="koboSpan" id="kobo.931.2">
     Our callback logs the data received and returns an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.932.1">
      HTTP
     </span>
    </strong>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.933.1">
      OK
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.934.1">
      status message.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-120">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.935.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.936.1">
     Node.js servers commonly
    </span>
    <a id="_idIndexMarker226">
    </a>
    <span class="koboSpan" id="kobo.937.1">
     allow interaction via JSON.
    </span>
    <span class="koboSpan" id="kobo.937.2">
     Let’s look at how we can
    </span>
    <a id="_idIndexMarker227">
    </a>
    <span class="koboSpan" id="kobo.938.1">
     handle HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.939.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.940.1">
     requests that are sending JSON data.
    </span>
    <span class="koboSpan" id="kobo.940.2">
     Specifically, this means accepting and handling content with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.941.1">
      application/json
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.942.1">
      content type.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.943.1">
     Let’s convert the server from this recipe to handle
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.944.1">
      JSON data.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.945.1">
      First, copy the existing
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.946.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.947.1">
      file to a new file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.948.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.949.1">
        json-server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.950.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.951.1">$ cp server.js json-server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.952.1">
      Then, we will change our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.953.1">
       post()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.954.1">
      function to check that the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.955.1">
       Content-Type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.956.1">
      header of the request is set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.957.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.958.1">
        application/json
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.959.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.960.1">
function post (req, res) {
  if (req.headers['content-type'] !==
    'application/json') {
      error(415, res);
      return;
    }
...</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.961.1">
      We also need to change our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.962.1">
       end
      </span>
     </strong>
     <span class="koboSpan" id="kobo.963.1">
      event listener function to parse and return the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.964.1">
       JSON data:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.965.1">
  req.on('end', () =&gt; {
    try {
      const parsed = JSON.parse(input);
      console.log('Received data: ', parsed);
      res.end('{"data": ' + input + '}');
    } catch (err) {
      error(400, res);
    }
  });</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.966.1">
      Let’s now test whether our server can handle the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.967.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.968.1">
      route.
     </span>
     <span class="koboSpan" id="kobo.968.2">
      We will do this using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.969.1">
       cURL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.970.1">
      command-line tool.
     </span>
     <span class="koboSpan" id="kobo.970.2">
      Start your server in one
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.971.1">
       terminal window:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.972.1">$ node json-server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.973.1">
      In a separate terminal window, enter the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.974.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.975.1">$ curl --header "Content-Type: application/json" \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.976.1">  --request POST \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.977.1">  --data '{"forename":"Ada","surname":"Lovelace"}' \</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.978.1">  http://localhost:3000/</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.979.1">{"data": {"forename":"Ada","surname":"Lovelace"}}%</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.980.1">
      Now, we can add the following script to our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.981.1">
       form.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.982.1">
      file, which will convert our HTML
     </span>
     <a id="_idIndexMarker228">
     </a>
     <span class="koboSpan" id="kobo.983.1">
      form
     </span>
     <a id="_idIndexMarker229">
     </a>
     <span class="koboSpan" id="kobo.984.1">
      data into JSON and send it via a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.985.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.986.1">
      request to the server.
     </span>
     <span class="koboSpan" id="kobo.986.2">
      Add the following after the closing form
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.987.1">
       tag (
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.988.1">
        &lt;/form&gt;
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.989.1">
       ):
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.990.1">
&lt;script&gt;
  document.forms[0].addEventListener("submit", (event) =&gt; {
    event.preventDefault();
    let data = {
      forename:
        document.getElementById("forename").value,
      surname:
        document.getElementById("surname").value,
    };
    console.log("data", data);
    fetch("http://localhost:3000", {
      method: "post",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    }).then(function (response) {
      console.log(response);
      return response.json();
    });
  });
&lt;/script&gt;</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.991.1">
     Restart your JSON server with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.992.1">
      $ node json-server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.993.1">
     and navigate to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.994.1">
      http://localhost:3000
     </span>
    </strong>
    <span class="koboSpan" id="kobo.995.1">
     in your browser.
    </span>
    <span class="koboSpan" id="kobo.995.2">
     If we now complete the input fields in our browser and submit the form, we should see in the server logs that the request has been successfully sent to the server.
    </span>
    <span class="koboSpan" id="kobo.995.3">
     Note that our use of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.996.1">
      event.preventDefault()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.997.1">
     will prevent the browser from redirecting the web page upon submission of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.998.1">
      the form.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.999.1">
     Our form and server behave
    </span>
    <a id="_idIndexMarker230">
    </a>
    <span class="koboSpan" id="kobo.1000.1">
     similarly to the server we created in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1001.1">
      Receiving HTTP POST requests
     </span>
    </em>
    <span class="koboSpan" id="kobo.1002.1">
     recipe, with the difference being that the frontend form interacts
    </span>
    <a id="_idIndexMarker231">
    </a>
    <span class="koboSpan" id="kobo.1003.1">
     with the backend via an HTTP
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1004.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1005.1">
     request that sends a JSON representation of the form data.
    </span>
    <span class="koboSpan" id="kobo.1005.2">
     The client frontend interacting with the backend server via JSON is typical of modern
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1006.1">
      web architectures.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-121">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.1007.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <em class="italic">
      <span class="koboSpan" id="kobo.1008.1">
       Chapters 3
      </span>
     </em>
     <span class="koboSpan" id="kobo.1009.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1010.1">
       6
      </span>
     </em>
     <span class="koboSpan" id="kobo.1011.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1012.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1013.1">
        11
       </span>
      </em>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-122">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.1014.1">
     Handling file uploads
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1015.1">
     Uploading a file to
    </span>
    <a id="_idIndexMarker232">
    </a>
    <span class="koboSpan" id="kobo.1016.1">
     the web is a common activity, be it an image, a video, or a document.
    </span>
    <span class="koboSpan" id="kobo.1016.2">
     Files require different handling compared to simple
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1017.1">
      POST
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1018.1">
     data.
    </span>
    <span class="koboSpan" id="kobo.1018.2">
     Browsers embed files being uploaded into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1019.1">
      multipart messages.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1020.1">
     Multipart messages allow multiple pieces of content to be combined into one payload.
    </span>
    <span class="koboSpan" id="kobo.1020.2">
     To handle multipart messages, we need to use a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1021.1">
      multipart parser.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1022.1">
     In this recipe, we will use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1023.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1024.1">
     module as our multipart parser to handle file uploads.
    </span>
    <span class="koboSpan" id="kobo.1024.2">
     The file uploads in this recipe will be stored
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1025.1">
      on disk.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.1026.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1027.1">
     To get started, let’s set up the foundation for our file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1028.1">
      upload recipe.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1029.1">
      First, let’s create a new folder called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1030.1">
       file-upload
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1031.1">
      and create a
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1032.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1033.1">
       file:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1034.1">$ mkdir file-upload</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1035.1">$ cd file-upload</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1036.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1037.1">
      As we will be using a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1038.1">
       npm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1039.1">
      module for this recipe, we need to initialize
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1040.1">
       our project:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1041.1">$ npm init --yes</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1042.1">
      We will also need to create two subdirectories: one named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1043.1">
       public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1044.1">
      to store our HTML form and another named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1045.1">
       uploads
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1046.1">
      to store our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1047.1">
       uploaded files:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1048.1">$ mkdir public</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1049.1">$ mkdir uploads</span></strong></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-124">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.1050.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1051.1">
     In this recipe, we will create a server that can handle file uploads and store the files on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1052.1">
      the server.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1053.1">
      First, we should create an HTML form with a file input field.
     </span>
     <span class="koboSpan" id="kobo.1053.2">
      Create a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1054.1">
       form.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1055.1">
      inside the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1056.1">
       public
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1057.1">
      directory.
     </span>
     <span class="koboSpan" id="kobo.1057.2">
      Add the following content
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1058.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1059.1">
        form.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1060.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1061.1">
&lt;form method="POST" enctype="multipart/form-data"&gt;
    &lt;label for="userfile"&gt;File:&lt;/label&gt;
    &lt;input type="file" id="userfile"
      name="userfile"&gt;&lt;br&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1062.1">
      Now, we should install our multipart parser
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1063.1">
       module,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1064.1">
        formidable
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1065.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1066.1">$ npm install formidable</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1067.1">
      Now, we can start creating our server.
     </span>
     <span class="koboSpan" id="kobo.1067.2">
      In
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1068.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1069.1">
      , we will import the required modules
     </span>
     <a id="_idIndexMarker233">
     </a>
     <span class="koboSpan" id="kobo.1070.1">
      and create a variable to store the path to our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1071.1">
        form.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1072.1">
       file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1073.1">
const fs = require('node:fs');
const http = require('node:http');
const path = require('node:path');
const form = fs.readFileSync(path.join(__dirname,
  'public', 'form.html'));
const { formidable } = require('formidable');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1074.1">
      Next, we’ll create our server with handlers for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1075.1">
       GET
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1076.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1077.1">
       POST
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1078.1">
      requests.
     </span>
     <span class="koboSpan" id="kobo.1078.2">
      This is like the server we built in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1079.1">
       Receiving HTTP POST
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1080.1">
        requests
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1081.1">
       recipe:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1082.1">
http
  .createServer((req, res) =&gt; {
    if (req.method === 'GET') {
      get(res);
      return;
    }
    if (req.method === 'POST') {
      post(req, res);
      return;
    }
    error(405, res);
  })
 .listen(3000, () =&gt; {
    console.log('Server listening on
      http://localhost:3000');
  });
function get (res) {
  res.writeHead(200, {
    'Content-Type': 'text/html'
  });
  res.end(form);
}
function error (code, res) {
  res.statusCode = code;
  res.end(http.STATUS_CODES[code]);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1083.1">
      Now, we’ll add our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1084.1">
       post()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1085.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.1085.2">
      This function will handle
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1086.1">
       file uploads:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1087.1">
function post (req, res) {
  if (!/multipart\/form-
    data/.test(req.headers['content-type'])) {
      error(415, res);
      return;
  }
  const form = formidable({
    keepExtensions: true,
    uploadDir: './uploads'
  });
  form.parse(req, (err, fields, files) =&gt; {
    if (err) return error(400, err);
    res.writeHead(200, {
      'Content-Type': 'application/json'
    });
    res.end(JSON.stringify({ fields, files }));
  });
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1088.1">
      Start the server
     </span>
     <a id="_idIndexMarker234">
     </a>
     <span class="koboSpan" id="kobo.1089.1">
      and navigate to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1090.1">
       http://localhost:3000
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1091.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1092.1">
       your browser:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1093.1">$ node server.js</span></strong><span class="koboSpan" id="kobo.1094.1">
Server listening on http://localhost:3000</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1095.1">
      Click the button to upload a file (it could be named
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1096.1">
       Choose File
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1097.1">
      ,
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1098.1">
       Browse
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1099.1">
      , or similar, depending on your browser and/or operating system) and select any file to upload in your File Explorer.
     </span>
     <span class="koboSpan" id="kobo.1099.2">
      You should see the file indicate it has been selected.
     </span>
     <span class="koboSpan" id="kobo.1099.3">
      Submit the file.
     </span>
     <span class="koboSpan" id="kobo.1099.4">
      Your server should have successfully received and stored the file and
     </span>
     <a id="_idIndexMarker235">
     </a>
     <span class="koboSpan" id="kobo.1100.1">
      responded with data about the stored file in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1101.1">
       JSON format:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1102.1">
{
  "fields": {
  },
  "files": {
    "userfile": [
      {
        "size": 21,
        "filepath": "/Users/beth/Node.js-
Cookbook/Chapter04/file-upload/uploads/ac36e936ec65f3b0699442f00.txt",
        "newFilename":
           "ac36e936ec65f3b0699442f00.txt",
        "mimetype": "text/plain",
        "mtime": "2024-04-15T02:52:18.886Z",
        "originalFilename": "file.txt"
      }
    ]
  }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1103.1">
      If we list out the contents of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1104.1">
       uploads
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1105.1">
      directory, we should see the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1106.1">
       uploaded file:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1107.1">$ ls uploads</span></strong><span class="koboSpan" id="kobo.1108.1">
ac36e936ec65f3b0699442f00.txt</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1109.1">
     We’ve created a server that can handle file uploads and tested this by uploading a file through
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1110.1">
      our browser.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-125">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.1111.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1112.1">
     In the first step in the recipe, we set up an HTML form with a file input.
    </span>
    <span class="koboSpan" id="kobo.1112.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1113.1">
      enctype="multipart/form-data"
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1114.1">
     property on the form element instructs the browser to set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1115.1">
      Content-Type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1116.1">
     header of the request to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1117.1">
      multipart/form-data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1118.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1118.2">
     This also instructs the browser to embed the files to be uploaded into a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1119.1">
      multipart message.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1120.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1121.1">
      post()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1122.1">
     function
    </span>
    <a id="_idIndexMarker236">
    </a>
    <span class="koboSpan" id="kobo.1123.1">
     checks that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1124.1">
      Content-Type
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1125.1">
     header is set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1126.1">
      multipart/form-data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1127.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1127.2">
     If this header isn’t set, we call our error function and return a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1128.1">
      415
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1129.1">
     HTTP status code with the message
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1130.1">
      Unsupported
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1131.1">
       Media Type
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1132.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1133.1">
     Within the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1134.1">
      post()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1135.1">
     function, we initialized a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1136.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1137.1">
     object with configuration options and assigned it to a constant
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1138.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1139.1">
       form
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1140.1">
      :
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1141.1">
  const form = formidable({
    keepExtensions: true,
    uploadDir: './uploads'
  });</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1142.1">
     The first configuration option,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1143.1">
      keepExtensions:true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1144.1">
     , instructs
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1145.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1146.1">
     to preserve the file extension of the file being uploaded.
    </span>
    <span class="koboSpan" id="kobo.1146.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1147.1">
      uploadDir
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1148.1">
     option is used to instruct
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1149.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1150.1">
     where the uploaded files should be stored, and in the case of our recipe, we set this to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1151.1">
       uploads
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1152.1">
      directory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1153.1">
     Next, we call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1154.1">
      form.parse()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1155.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.1155.2">
     This function parses the request and collects the form data within the request.
    </span>
    <span class="koboSpan" id="kobo.1155.3">
     The parsed form data is passed to our callback function as an array of fields and an array
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1156.1">
      of files.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1157.1">
     Within our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1158.1">
      form.parse()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1159.1">
     callback function, we first check if any errors occurred during the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1160.1">
      form.parse()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1161.1">
     function and return an error if there was one.
    </span>
    <span class="koboSpan" id="kobo.1161.2">
     Assuming the form data was successfully parsed, we return our response to the request, which is an HTTP status code 200,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1162.1">
      OK
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1163.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1163.2">
     We also return the information
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1164.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1165.1">
     provides by default about our uploaded file, in a string representation of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1166.1">
      JSON format.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1167.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1168.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1169.1">
     library in Node.js uses random filenames when uploading files to prevent conflicts.
    </span>
    <span class="koboSpan" id="kobo.1169.2">
     Assigning unique names helps to avoid issues such as file overwriting, where multiple users might upload files with the same name, potentially replacing existing data.
    </span>
    <span class="koboSpan" id="kobo.1169.3">
     This method also helps mitigate security risks associated with user input by preventing deliberate attempts to overwrite sensitive files or predict and access files on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1170.1">
      the server.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1171.1">
     This recipe demonstrates how community modules such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1172.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1173.1">
     can do the heavy lifting and handle complex, but common, problems.
    </span>
    <span class="koboSpan" id="kobo.1173.2">
     In this instance, it saved us from writing a multipart parser from scratch.
    </span>
    <span class="koboSpan" id="kobo.1173.3">
     Refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1174.1">
      Consuming Node.js modules
     </span>
    </em>
    <span class="koboSpan" id="kobo.1175.1">
     recipe of
    </span>
    <a href="B19212_05.xhtml#_idTextAnchor139">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1176.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1177.1">
     for considerations that you should make when selecting which modules to
    </span>
    <a id="_idIndexMarker237">
    </a>
    <span class="koboSpan" id="kobo.1178.1">
     include in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1179.1">
      your applications.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1180.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1181.1">
     Allowing the upload of any file type of any size makes your server vulnerable to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1182.1">
      Denial-of-Service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1183.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1184.1">
      DoS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1185.1">
     ) attacks.
    </span>
    <span class="koboSpan" id="kobo.1185.2">
     Attackers
    </span>
    <a id="_idIndexMarker238">
    </a>
    <span class="koboSpan" id="kobo.1186.1">
     could purposely try to upload excessively large or malicious files to slow down your server.
    </span>
    <span class="koboSpan" id="kobo.1186.2">
     It is recommended that you add both client-side and server-side validation to restrict the file types and sizes that your server
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1187.1">
      will accept.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-126">
    <a id="_idTextAnchor125">
    </a>
    <span class="koboSpan" id="kobo.1188.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1189.1">
     In this recipe, we have seen how to handle a simple form containing just one file input.
    </span>
    <span class="koboSpan" id="kobo.1189.2">
     Now, let’s look at how we can handle the uploading of multiple files at a time and how we handle other types of form data alongside uploading
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1190.1">
      a file.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1191.1">
     Uploading multiple files
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1192.1">
     In some cases, you
    </span>
    <a id="_idIndexMarker239">
    </a>
    <span class="koboSpan" id="kobo.1193.1">
     may want to upload multiple files
    </span>
    <a id="_idIndexMarker240">
    </a>
    <span class="koboSpan" id="kobo.1194.1">
     to a server at the same time.
    </span>
    <span class="koboSpan" id="kobo.1194.2">
     Conveniently, with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1195.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1196.1">
     , this is supported by default.
    </span>
    <span class="koboSpan" id="kobo.1196.2">
     We just need to make one change to our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1197.1">
      form.html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1198.1">
     file, which is to add the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1199.1">
      multiple
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1200.1">
     attribute to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1201.1">
      input element:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1202.1">
&lt;form method="POST" enctype="multipart/form-data"&gt;
    &lt;label for="userfile"&gt;File:&lt;/label&gt;
    &lt;input type="file" id="userfile" name="userfile"
      multiple&gt;&lt;br&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1203.1">
     Start the server with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1204.1">
      node server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1205.1">
     and navigate to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1206.1">
      http://localhost:3000
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1207.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1207.2">
     Now, when you click
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1208.1">
      Upload
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1209.1">
     , you should be able to select multiple files to upload.
    </span>
    <span class="koboSpan" id="kobo.1209.2">
     On macOS, to select multiple files, you can hold the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1210.1">
      Shift
     </span>
    </em>
    <span class="koboSpan" id="kobo.1211.1">
     key and select multiple files.
    </span>
    <span class="koboSpan" id="kobo.1211.2">
     Then, upon submitting multiple files,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1212.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1213.1">
     will return data about each
    </span>
    <a id="_idIndexMarker241">
    </a>
    <span class="koboSpan" id="kobo.1214.1">
     of the files uploaded.
    </span>
    <span class="koboSpan" id="kobo.1214.2">
     Expect to
    </span>
    <a id="_idIndexMarker242">
    </a>
    <span class="koboSpan" id="kobo.1215.1">
     see JSON output returned that is like
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1216.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1217.1">
{
  "fields": {},
  "files": {
    "userfile": [
      {
        "size": 334367,
        "filepath": "/Users/beth/Node.js-Cookbook/Chapter04/file-upload/uploads/8bcdb0be88a49a8e1aec95e00.jpg",
        "newFilename":
          "8bcdb0be88a49a8e1aec95e00.jpg",
        "mimetype": "image/jpeg",
        "mtime": "2024-04-15T02:57:23.589Z",
        "originalFilename": "photo.jpg"
      },
      {
        "size": 21,
        "filepath": "/Users/beth/Node.js-Cookbook/Chapter04/file-upload/uploads/8bcdb0be88a49a8e1aec95e01.txt",
        "newFilename":
          "8bcdb0be88a49a8e1aec95e01.txt",
        "mimetype": "text/plain",
        "mtime": "2024-04-15T02:57:23.589Z",
        "originalFilename": "file.txt"
      }
    ]
  }
}</span></pre>
   <h3>
    <span class="koboSpan" id="kobo.1218.1">
     Processing multiple input types
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1219.1">
     It’s common
    </span>
    <a id="_idIndexMarker243">
    </a>
    <span class="koboSpan" id="kobo.1220.1">
     for a form
    </span>
    <a id="_idIndexMarker244">
    </a>
    <span class="koboSpan" id="kobo.1221.1">
     to contain a mixture of input types.
    </span>
    <span class="koboSpan" id="kobo.1221.2">
     On top of the file input type, it could contain text, a password, a date, or more input types.
    </span>
    <span class="koboSpan" id="kobo.1221.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1222.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1223.1">
     module handles mixed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1224.1">
      data types.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1225.1">
     HTML input element
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1226.1">
     For a full list of input types defined, refer to the MDN web documentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1227.1">
      at
     </span>
    </span>
    <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1228.1">
       https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1229.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1230.1">
     Let’s extend the HTML form created in the recipe to contain some additional text input fields to demonstrate how
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1231.1">
      formidable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1232.1">
     handles multiple
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1233.1">
      input types.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1234.1">
     First, let’s add a text input to our
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1235.1">
       form.html
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1236.1">
      file:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1237.1">
&lt;form method="POST" enctype="multipart/form-data"&gt;
    &lt;label for="user"&gt;User:&lt;/label&gt;
    &lt;input type="text" id="user" name="user"&gt;&lt;br&gt;
    &lt;label for="userfile"&gt;File:&lt;/label&gt;
    &lt;input type="file" id="userfile" name="userfile"&gt;&lt;br&gt;
    &lt;input type="submit"&gt;
&lt;/form&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1238.1">
     Start the server with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1239.1">
      node server.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1240.1">
     and navigate to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1241.1">
      http://localhost:3000
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1242.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1242.2">
     Insert text into the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1243.1">
      user
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1244.1">
     field and select a file to be uploaded.
    </span>
    <span class="koboSpan" id="kobo.1244.2">
     Click
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1245.1">
      on
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.1246.1">
       Submit
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1247.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1248.1">
     You will receive a JSON
    </span>
    <a id="_idIndexMarker245">
    </a>
    <span class="koboSpan" id="kobo.1249.1">
     response containing all your
    </span>
    <a id="_idIndexMarker246">
    </a>
    <span class="koboSpan" id="kobo.1250.1">
     form data, like
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1251.1">
      the following:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1252.1">
{
  "fields": { "user" : ["Beth"] },
  "files": {
    "userfile": [
      {
        "size": 21,
        "filepath": "/Users/beth/Node.js-Cookbook/Chapter04/file-upload/uploads/659d0cc8a8898fce93231aa00.txt",
        "newFilename": "659d0cc8a8898fce93231aa00.txt",
        "mimetype": "text/plain",
        "mtime": "2024-04-15T02:59:22.633Z",
        "originalFilename": "file.txt"
      }
    ]
  }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1253.1">
     The field information
    </span>
    <a id="_idIndexMarker247">
    </a>
    <span class="koboSpan" id="kobo.1254.1">
     is automatically handled by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1255.1">
      form.parse()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1256.1">
     function, making the fields accessible to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1257.1">
      the server.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-127">
    <a id="_idTextAnchor126">
    </a>
    <span class="koboSpan" id="kobo.1258.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <em class="italic">
      <span class="koboSpan" id="kobo.1259.1">
       Chapters 5
      </span>
     </em>
     <span class="koboSpan" id="kobo.1260.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1261.1">
       6
      </span>
     </em>
     <span class="koboSpan" id="kobo.1262.1">
      ,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1263.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1264.1">
        9
       </span>
      </em>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-128">
    <a id="_idTextAnchor127">
    </a>
    <span class="koboSpan" id="kobo.1265.1">
     Creating a WebSocket server
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1266.1">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1267.1">
      WebSocket protocol
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1268.1">
     enables
    </span>
    <a id="_idIndexMarker248">
    </a>
    <span class="koboSpan" id="kobo.1269.1">
     two-way communication between a browser and a server.
    </span>
    <span class="koboSpan" id="kobo.1269.2">
     WebSockets are commonly leveraged for building real-time web applications, such as instant
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1270.1">
      messaging clients.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1271.1">
     In this recipe, we’re going to use the third-party
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1272.1">
      ws
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1273.1">
     module to create a WebSocket server that we can interact with via
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1274.1">
      our browser.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-129">
    <a id="_idTextAnchor128">
    </a>
    <span class="koboSpan" id="kobo.1275.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1276.1">
     First, we need to prepare our project directory with the necessary files for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1277.1">
      the recipe.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1278.1">
      Start by creating a directory named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1279.1">
       websocket-server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1280.1">
      containing two files – one named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1281.1">
       client.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1282.1">
      and another
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1283.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1284.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1285.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1286.1">$ mkdir websocket-server</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1287.1">$ cd websocket-server</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1288.1">$ touch client.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1289.1">$ touch server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1290.1">
      Also, for our client, let’s create a public directory containing a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1291.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1292.1">
        index.html
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1293.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1294.1">$ mkdir public</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1295.1">$ touch public/index.html</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1296.1">
      As we will be using a third-party
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1297.1">
       npm
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1298.1">
      module, we also need to initialize
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1299.1">
       our project:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1300.1">$ npm init --yes</span></strong></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-130">
    <a id="_idTextAnchor129">
    </a>
    <span class="koboSpan" id="kobo.1301.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1302.1">
     In this recipe, we’re going to create a WebSocket server and a client and send messages between
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1303.1">
      the two.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1304.1">
      Start by installing the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1305.1">
        ws
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1306.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1307.1">$ npm install ws</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1308.1">
      Import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1309.1">
       ws
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1310.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1311.1">
       in
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1312.1">
        server.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1313.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1314.1">
const WebSocket = require('ws');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1315.1">
      Now, we can define our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1316.1">
       WebSocketServer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1317.1">
      instance, including which port it should be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1318.1">
       accessible at:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1319.1">
const WebSocketServer = new WebSocket.Server({
  port: 3000
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1320.1">
      We need to listen
     </span>
     <a id="_idIndexMarker249">
     </a>
     <span class="koboSpan" id="kobo.1321.1">
      for connections and messages to our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1322.1">
        WebSocketServer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1323.1">
       instance:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1324.1">
WebSocketServer.on('connection', (socket) =&gt; {
  socket.on('message', (msg) =&gt; {
    console.log('Received:', msg.toString());
    if (msg.toString() === 'Hello')
      socket.send('World!');
  });
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1325.1">
      Now, let’s create our client.
     </span>
     <span class="koboSpan" id="kobo.1325.2">
      Add the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1326.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1327.1">
        client.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1328.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1329.1">
const fs = require('node:fs');
const http = require('node:http');
const index = fs.readFileSync('public/index.html');
const server = http.createServer((req, res) =&gt; {
  res.setHeader('Content-Type', 'text/html');
  res.end(index);
});
server.listen(8080);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1330.1">
      Open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1331.1">
       index.html
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1332.1">
      and add
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1333.1">
       the
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker250">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1334.1">
       following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1335.1">
&lt;h1&gt;Communicating with WebSockets&lt;/h1&gt;
&lt;input id="msg" /&gt;&lt;button id="send"&gt;Send&lt;/button&gt;
&lt;div id="output"&gt;&lt;/div&gt;
&lt;script&gt;
    const ws = new WebSocket('ws://localhost:3000');
    const output =
      document.getElementById('output');
    const send = document.getElementById('send');
    send.addEventListener('click', () =&gt; {
        const msg =
          document.getElementById('msg').value;
        ws.send(msg);
        output.innerHTML += log('Sent', msg);
    });
    function log(event, msg) {
        return '&lt;p&gt;' + event + ': ' + msg + '&lt;/p&gt;';
    }
    ws.onmessage = function (e) {
        output.innerHTML += log('Received', e.data);
    };
    ws.onclose = function (e) {
        output.innerHTML += log('Disconnected',
          e.code);
    };
    ws.onerror = function (e) {
        output.innerHTML += log('Error', e.data);
    };
&lt;/script&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1336.1">
      Now, start your
     </span>
     <a id="_idIndexMarker251">
     </a>
     <span class="koboSpan" id="kobo.1337.1">
      server in one terminal window and your client in a second
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1338.1">
       terminal window:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1339.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1340.1">$ node client.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1341.1">
      Access
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1342.1">
       http://localhost:8080
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1343.1">
      in your browser, and you should see a simple input box with a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1344.1">
       Submit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1345.1">
      button.
     </span>
     <span class="koboSpan" id="kobo.1345.2">
      Type
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1346.1">
       Hello
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1347.1">
      into the input box and click
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1348.1">
       Submit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1349.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1349.2">
      The WebSocket server should respond
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1350.1">
       with
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1351.1">
        World!
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1352.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1353.1">
     If we look at the terminal window where we are running our server, we should see that the server received the message:
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1354.1">
      Received: Hello
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1355.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1355.2">
     This means that we have now got a client and server communicating
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1356.1">
      over WebSockets.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1357.1">
     We’ve created a WebSocket server and client and demonstrated how they can exchange messages.
    </span>
    <span class="koboSpan" id="kobo.1357.2">
     Now, let’s see how
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1358.1">
      it works.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-131">
    <a id="_idTextAnchor130">
    </a>
    <span class="koboSpan" id="kobo.1359.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1360.1">
     In this recipe, we used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1361.1">
      ws
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1362.1">
     module to define a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1363.1">
      WebSocket server:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1364.1">
const WebSocketServer = new WebSocket.Server({
  port: 3000,
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1365.1">
     We then registered a listener for the connection event.
    </span>
    <span class="koboSpan" id="kobo.1365.2">
     The function passed to this is executed each time there is a new connection to the WebSocket.
    </span>
    <span class="koboSpan" id="kobo.1365.3">
     Within the connection event callback function, we have a socket instance in which we registered a listener for the message event, which gets executed each time a message is received on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1366.1">
      that socket.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1367.1">
     For our client, we defined a regular HTTP server to serve our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1368.1">
      index.html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1369.1">
     file.
    </span>
    <span class="koboSpan" id="kobo.1369.2">
     Our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1370.1">
      index.html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1371.1">
     file contains JavaScript that is executed within the browser.
    </span>
    <span class="koboSpan" id="kobo.1371.2">
     Within this JavaScript, we created a connection to our WebSocket server, providing the endpoint that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1372.1">
      ws
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1373.1">
     object is
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1374.1">
      listening to:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1375.1">
    const ws = new WebSocket('ws://localhost:3000');</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1376.1">
     To send a message to our
    </span>
    <a id="_idIndexMarker252">
    </a>
    <span class="koboSpan" id="kobo.1377.1">
     WebSocket server, we just call
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1378.1">
      send
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1379.1">
     on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1380.1">
      ws
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1381.1">
     object
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1382.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1383.1">
       ws.send(msg)
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1384.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1385.1">
     We wrapped the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1386.1">
      ws.send(msg)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1387.1">
     in an event listener.
    </span>
    <span class="koboSpan" id="kobo.1387.2">
     The event listener was listening for the “click” event on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1388.1">
      Submit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1389.1">
     button, meaning that we would send the message to the WebSocket when the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1390.1">
      Submit
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1391.1">
     button
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1392.1">
      was clicked.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1393.1">
     In our script in
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1394.1">
      index.html
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1395.1">
     , we registered event listener functions on our WebSocket, including
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1396.1">
      onmessage
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1397.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1398.1">
      onclose
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1399.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1400.1">
      onerror
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1401.1">
      event listeners:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1402.1">
    ws.onmessage = function (e) {
        output.innerHTML += log('Received', e.data);
    };
    ws.onclose = function (e) {
        output.innerHTML += log('Disconnected', e.code);
    };
    ws.onerror = function (e) {
        output.innerHTML += log('Error', e.data);
    };</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1403.1">
     These functions execute on their respective events.
    </span>
    <span class="koboSpan" id="kobo.1403.2">
     For example, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1404.1">
      onmessage()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1405.1">
     event listener function would execute when our WebSocket receives a message.
    </span>
    <span class="koboSpan" id="kobo.1405.2">
     We use these event listeners to add output to our web page according to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1406.1">
      the event.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-132">
    <a id="_idTextAnchor131">
    </a>
    <span class="koboSpan" id="kobo.1407.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1408.1">
     Now, we’ve learned
    </span>
    <a id="_idIndexMarker253">
    </a>
    <span class="koboSpan" id="kobo.1409.1">
     how we can communicate between a browser and a server using WebSockets.
    </span>
    <span class="koboSpan" id="kobo.1409.2">
     But it is also possible to create a WebSocket client in Node.js, enabling two Node.js programs to communicate over WebSockets using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1410.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1411.1">
      Start by creating a new file within our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1412.1">
       websocket-server
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1413.1">
      directory,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1414.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1415.1">
        node-client.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1416.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1417.1">$ touch node-client.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1418.1">
      Import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1419.1">
       ws
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1420.1">
      module and create a new WebSocket object that is configured to point to the WebSocket server we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1421.1">
       Creating a WebSocket
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1422.1">
        server
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1423.1">
       recipe:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1424.1">
const WebSocket = require('ws');
const ws = new WebSocket('ws://localhost:3000');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1425.1">
      Now, we’ll set up some listeners on our sockets.
     </span>
     <span class="koboSpan" id="kobo.1425.2">
      We will add listeners for the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1426.1">
       open
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1427.1">
      ,
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1428.1">
       close
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1429.1">
      , and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1430.1">
        message
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1431.1">
       events:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1432.1">
ws.on('open', () =&gt; {
  console.log('Connected');
});
ws.on('close', () =&gt; {
  console.log('Disconnected');
});
ws.on('message', (message) =&gt; {
  console.log('Received:', message.toString());
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1433.1">
      Now, let’s send a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1434.1">
       'Hello'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1435.1">
      message to the WebSocket server every 3 seconds.
     </span>
     <span class="koboSpan" id="kobo.1435.2">
      We will use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1436.1">
       setInterval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1437.1">
      function to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1438.1">
       achieve this:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1439.1">
setInterval(() =&gt; {
  ws.send('Hello');
}, 3000);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1440.1">
      Start both the
     </span>
     <a id="_idIndexMarker254">
     </a>
     <span class="koboSpan" id="kobo.1441.1">
      WebSocket server and your Node.js-based client in separate
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1442.1">
       terminal windows:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1443.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1444.1">$ node node-client.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1445.1">
      You should expect to see the server responding every 3 seconds to your
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1446.1">
       'Hello'
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1447.1">
      message with the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1448.1">
        World!
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1449.1">
       message:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1450.1">
Connected
Received: World!
</span><span class="koboSpan" id="kobo.1450.2">Received: World!
</span><span class="koboSpan" id="kobo.1450.3">Received: World!</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1451.1">
     You’ve now created a WebSocket communication between two
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1452.1">
      Node.js programs.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-133">
    <a id="_idTextAnchor132">
    </a>
    <span class="koboSpan" id="kobo.1453.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1454.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1455.1">
       Interfacing with standard I/O
      </span>
     </em>
     <span class="koboSpan" id="kobo.1456.1">
      recipe in
     </span>
     <a href="B19212_02.xhtml#_idTextAnchor041">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1457.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1458.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1459.1">
       Communicating with sockets
      </span>
     </em>
     <span class="koboSpan" id="kobo.1460.1">
      recipe in
     </span>
     <a href="B19212_02.xhtml#_idTextAnchor041">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1461.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <a href="B19212_06.xhtml#_idTextAnchor178">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1462.1">
         Chapter 6
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
   <h1 id="_idParaDest-134">
    <a id="_idTextAnchor133">
    </a>
    <span class="koboSpan" id="kobo.1463.1">
     Creating an SMTP server
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1464.1">
      SMTP
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1465.1">
     is a protocol
    </span>
    <a id="_idIndexMarker255">
    </a>
    <span class="koboSpan" id="kobo.1466.1">
     for sending emails.
    </span>
    <span class="koboSpan" id="kobo.1466.2">
     In this recipe, we will be setting up an SMTP server using a third-party
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1467.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1468.1">
     module
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1469.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1470.1">
       smtp-server
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1471.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1472.1">
     You probably receive several automated emails per day in your inbox.
    </span>
    <span class="koboSpan" id="kobo.1472.2">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1473.1">
      There’s more…
     </span>
    </em>
    <span class="koboSpan" id="kobo.1474.1">
     section, we’re going to learn how we can send an email via Node.js to the SMTP server we created in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1475.1">
      the recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-135">
    <a id="_idTextAnchor134">
    </a>
    <span class="koboSpan" id="kobo.1476.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1477.1">
     First, let’s create a directory named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1478.1">
      server-smtp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1479.1">
     and a file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1480.1">
      named
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1481.1">
       server.js
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1482.1">
      :
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1483.1">
$ mkdir server-smtp
$ cd server-smtp
$ touch server.js</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1484.1">
     As we’ll be using the third-party
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1485.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1486.1">
     module from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1487.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1488.1">
     , we will need to initialize
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1489.1">
      our project:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.1490.1">
$ npm init --yes</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1491.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1492.1">
     Note that we could not name our directory for this recipe
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1493.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1494.1">
     as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1495.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1496.1">
     refuses to allow you to install a module where the project name is the same as the module.
    </span>
    <span class="koboSpan" id="kobo.1496.2">
     If we had named our directory
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1497.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1498.1">
     , our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1499.1">
      package.json
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1500.1">
     name would have also been set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1501.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1502.1">
     , and we would not be able to install the module with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1503.1">
      same name.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-136">
    <a id="_idTextAnchor135">
    </a>
    <span class="koboSpan" id="kobo.1504.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1505.1">
     In this recipe, we will be creating an SMTP server that can receive email messages.
    </span>
    <span class="koboSpan" id="kobo.1505.2">
     We will use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1506.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1507.1">
     module to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1508.1">
      achieve this.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1509.1">
      First, start by installing the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1510.1">
        smtp-server
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1511.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1512.1">$ npm install smtp-server</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1513.1">
      Next, we need to open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1514.1">
       server.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1515.1">
      and import the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1516.1">
        server-smtp
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1517.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1518.1">
const SMTPServer = require('smtp-
  server').SMTPServer;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1519.1">
      Let’s define the port that our SMTP server should be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1520.1">
       accessible at:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1521.1">
const PORT = 4321;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1522.1">
      Now, we’ll create
     </span>
     <a id="_idIndexMarker256">
     </a>
     <span class="koboSpan" id="kobo.1523.1">
      an SMTP
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1524.1">
       server object:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1525.1">
const server = new SMTPServer({
  disabledCommands: ['STARTTLS', 'AUTH'],
  logger: true
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1526.1">
      We should also catch any errors.
     </span>
     <span class="koboSpan" id="kobo.1526.2">
      Register an error event listener function on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1527.1">
       server object:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1528.1">
server.on('error', (err) =&gt; {
  console.error(err);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1529.1">
      Finally, we can call the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1530.1">
       listen()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1531.1">
      function to start our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1532.1">
       SMTP server:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1533.1">
server.listen(PORT);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1534.1">
      Start your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1535.1">
       SMTP server:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1536.1">$ node server.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1537.1">[2020-04-27 21:57:51] INFO  SMTP Server listening on [::]:4321</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1538.1">
      You can test a connection to your server by using either the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1539.1">
       nc
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1540.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1541.1">
       telnet
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1542.1">
      command-line tools in a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1543.1">
       new terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1544.1">$ telnet localhost 4321</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1545.1">$ nc -c localhost 4321</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1546.1">
     We’ve now confirmed that our SMTP server is available and listening on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1547.1">
      port
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1548.1">
       4321
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1549.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-137">
    <a id="_idTextAnchor136">
    </a>
    <span class="koboSpan" id="kobo.1550.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1551.1">
     In the recipe, we
    </span>
    <a id="_idIndexMarker257">
    </a>
    <span class="koboSpan" id="kobo.1552.1">
     leveraged the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1553.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1554.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.1554.2">
     This module takes care of the implementation of the SMTP protocol, meaning we can focus on the logic of our program rather than lower-level
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1555.1">
      implementation details.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1556.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1557.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1558.1">
     module provides high-level APIs.
    </span>
    <span class="koboSpan" id="kobo.1558.2">
     In the recipe, we used the following to create a new SMTP
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1559.1">
      server object:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1560.1">
const server = new SMTPServer({
  disabledCommands: ['STARTTLS', 'AUTH'],
  logger: true
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1561.1">
     The constructor of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1562.1">
      SMTPServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1563.1">
     object accepts many parameters.
    </span>
    <span class="koboSpan" id="kobo.1563.2">
     A full list of options that can be passed to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1564.1">
      SMTPServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1565.1">
     constructor is available in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1566.1">
      nodemailer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1567.1">
     documentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1568.1">
      at
     </span>
    </span>
    <a href="https://nodemailer.com/extras/smtp-server/">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1569.1">
       https://nodemailer.com/extras/smtp-server/
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1570.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1571.1">
     In this recipe, we added the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1572.1">
      disabledCommands: ['STARTTLS', 'AUTH']
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1573.1">
     option.
    </span>
    <span class="koboSpan" id="kobo.1573.2">
     This option disabled
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1574.1">
      Transport Layer Security
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1575.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1576.1">
      TLS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1577.1">
     ) support and authentication for simplicity.
    </span>
    <span class="koboSpan" id="kobo.1577.2">
     However, in production, it would not be recommended to disable TLS support and authentication.
    </span>
    <span class="koboSpan" id="kobo.1577.3">
     Instead, it would be recommended to enforce TLS.
    </span>
    <span class="koboSpan" id="kobo.1577.4">
     You can do this with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1578.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1579.1">
     module by specifying the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1580.1">
       secure:true
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1581.1">
      option.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1582.1">
     Should you wish to enforce TLS for the connection, you would also need to define a private key and a certificate.
    </span>
    <span class="koboSpan" id="kobo.1582.2">
     If no certificate is provided, then the module will generate a self-signed certificate; however, many clients reject
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1583.1">
      these certificates.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1584.1">
     The second option we specify on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1585.1">
      SMTPServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1586.1">
     constructor is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1587.1">
      logger:true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1588.1">
     option, which enables logging from our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1589.1">
      SMTP server.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1590.1">
     To start our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1591.1">
      SMTPServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1592.1">
     constructor, we call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1593.1">
      listen()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1594.1">
     function on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1595.1">
      SMTPServer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1596.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.1596.2">
     It is possible to pass the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1597.1">
      listen()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1598.1">
     function a port, a hostname, and a callback function.
    </span>
    <span class="koboSpan" id="kobo.1598.2">
     In this case, we only provide the port; the hostname will default
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1599.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1600.1">
       localhost
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1601.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-138">
    <a id="_idTextAnchor137">
    </a>
    <span class="koboSpan" id="kobo.1602.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1603.1">
     Now that we’ve set up
    </span>
    <a id="_idIndexMarker258">
    </a>
    <span class="koboSpan" id="kobo.1604.1">
     a simple SMTP server, we should try sending an email to it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1605.1">
      via Node.js.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1606.1">
     To send an email with Node.js, we can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1607.1">
      nodemailer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1608.1">
     module from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1609.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1610.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1610.2">
     This module is provided by the same organization as the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1611.1">
      smtp-server
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1612.1">
     module used in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1613.1">
      Creating an SMTP
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1614.1">
       server
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1615.1">
      recipe.
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1616.1">
      Let’s start by installing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1617.1">
       nodemailer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1618.1">
      module in our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1619.1">
        server-smtp
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1620.1">
       directory:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1621.1">$ npm install nodemailer</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1622.1">
      Next, we’ll create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1623.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1624.1">
        send-email.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1625.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1626.1">$ touch send-email.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1627.1">
      The first line of code we need to add to our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1628.1">
       send-email.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1629.1">
      file to import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1630.1">
       nodemailer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1631.1">
      module is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1632.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1633.1">
const nodemailer = require('nodemailer');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1634.1">
      Next, we need to set up the transport object; we will configure the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1635.1">
       transporter
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1636.1">
      object to connect to the SMTP server we created in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1637.1">
       Creating an SMTP
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1638.1">
        server
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1639.1">
       recipe:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1640.1">
const transporter = nodemailer.createTransport({
  host: 'localhost',
  port: 4321,
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1641.1">
      Next, we can call the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1642.1">
       sendMail()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1643.1">
      function on the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1644.1">
        transporter
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1645.1">
       object:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1646.1">
transporter.sendMail(
  {
    from: 'beth@example.com',
    to: 'laddie@example.com',
    subject: 'Hello',
    text: 'Hello world!',
  },
  (err, info) =&gt; {
    if (err) {
      console.log(err);
    }
    console.log("Message Sent:", info);
  }
);</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1647.1">
       The first parameter of the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1648.1">
        sendMail()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1649.1">
       function is an object representing the email, including the email address of the sender and receiver, the subject line, and the text of the
      </span>
      <a id="_idIndexMarker259">
      </a>
      <span class="koboSpan" id="kobo.1650.1">
       email.
      </span>
      <span class="koboSpan" id="kobo.1650.2">
       The second parameter is a callback function that executes once the mail
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1651.1">
        is sent.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1652.1">
      To test our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1653.1">
       send-email.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1654.1">
      program, first start the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1655.1">
       SMTP server:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1656.1">$ node server.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1657.1">
      In a second terminal window, run your
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1658.1">
        send-email.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1659.1">
       program:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1660.1">$ node send-email.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1661.1">
      You should expect to see the following output from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1662.1">
       the server:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1663.1">[2020-04-27 23:05:44] INFO  [#cifjnbwdwbhcf54a] Connection from [127.0.0.1]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1664.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 220 Beths-MBP.lan ESMTP</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1665.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] C: EHLO Beths-MBP.lan</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1666.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 250-Beths-MBP.lan Nice to meet you, [127.0.0.1]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1667.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] 250-PIPELINING</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1668.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] 250-8BITMIME</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1669.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] 250 SMTPUTF8</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1670.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] C: MAIL FROM:&lt;beth@example.com&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1671.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 250 Accepted</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1672.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] C: RCPT TO:&lt;laddie@example.com&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1673.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 250 Accepted</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1674.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] C: DATA</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1675.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1676.1">[2020-04-27 23:05:44] INFO  &lt;received 261 bytes&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1677.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] C: &lt;261 bytes of DATA&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1678.1">[2020-04-27 23:05:44] DEBUG [#cifjnbwdwbhcf54a] S: 250 OK: message queued</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1679.1">[2020-04-27 23:05:44] INFO  [#cifjnbwdwbhcf54a] Connection closed to [127.0.0.1]</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1680.1">
      You should see the output like the following from the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1681.1">
        send-email.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1682.1">
       program:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1683.1">
Message Sent: { accepted: [ 'laddie@example.com' ],
  rejected: [],
  ehlo: [ 'PIPELINING', '8BITMIME', 'SMTPUTF8' ],
  envelopeTime: 4,
  messageTime: 2,
  messageSize: 279,
  response: '250 OK: message queued',
  envelope: { from: 'beth@example.com', to: [
    'laddie@example.com' ] },
  messageId: '&lt;fde460ce-f83a-95e2-5f8a-
    76dd11f6e61f@example.com&gt;' }</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1684.1">
     This shows that we have
    </span>
    <a id="_idIndexMarker260">
    </a>
    <span class="koboSpan" id="kobo.1685.1">
     successfully created an SMTP server, and we’re able to send emails to the SMTP server from another
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1686.1">
      Node.js program.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-139">
    <a id="_idTextAnchor138">
    </a>
    <span class="koboSpan" id="kobo.1687.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <em class="italic">
      <span class="koboSpan" id="kobo.1688.1">
       Chapters 5
      </span>
     </em>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1689.1">
       and
      </span>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1690.1">
        9
       </span>
      </em>
     </span>
    </li>
   </ul>
  </div>
 </body></html>