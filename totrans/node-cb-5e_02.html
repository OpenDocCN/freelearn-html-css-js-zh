<html><head></head><body>
  <div id="_idContainer014">
   <h1 class="chapter-number" id="_idParaDest-42">
    <a id="_idTextAnchor041">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     2
    </span>
   </h1>
   <h1 id="_idParaDest-43">
    <a id="_idTextAnchor042">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Interacting with the File System
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Before Node.js, JavaScript was predominantly used in the browser.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Node.js brought JavaScript to the server and enabled us to interact with the operating system through JavaScript.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     Today, Node.js is one of the most popular technologies for building
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      server-side applications.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     Node.js interacts with the operating system at a fundamental level:
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.6.1">
      input and output
     </span>
    </strong>
    <span class="koboSpan" id="kobo.7.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.8.1">
      I/O
     </span>
    </strong>
    <span class="koboSpan" id="kobo.9.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.9.2">
     This chapter will explore the core APIs provided by Node.js that allow us to interact with standard I/O, the file system, and the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.10.1">
      network stack.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.11.1">
     This chapter will show you how to read and write files both synchronously and asynchronously.
    </span>
    <span class="koboSpan" id="kobo.11.2">
     Node.js was built to handle asynchronous code and enable a non-blocking model.
    </span>
    <span class="koboSpan" id="kobo.11.3">
     Understanding how to read and write asynchronous code is fundamental learning, and it will show how to leverage the capabilities
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.12.1">
      of Node.js.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.13.1">
     We will also learn about the core modules provided by Node.js.
    </span>
    <span class="koboSpan" id="kobo.13.2">
     We’ll be focusing on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.14.1">
      File System
     </span>
    </strong>
    <span class="koboSpan" id="kobo.15.1">
     module, which
    </span>
    <a id="_idIndexMarker057">
    </a>
    <span class="koboSpan" id="kobo.16.1">
     enables you to interact with the file system and files.
    </span>
    <span class="koboSpan" id="kobo.16.2">
     Newer versions of Node.js have added
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.17.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.18.1">
     variants of many file system APIs, which will also be touched upon in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.19.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.20.1">
     This chapter will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.21.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.22.1">
      Interacting with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.23.1">
       file system
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.24.1">
      Working
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.25.1">
       with files
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.26.1">
       Fetching metadata
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.27.1">
       Watching files
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-44">
    <a id="_idTextAnchor043">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.29.1">
     This chapter assumes that you have a recent version of Node.js 22 installed, a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.30.1">
      Terminal
     </span>
    </strong>
    <span class="koboSpan" id="kobo.31.1">
     or shell, and an editor of your choice.
    </span>
    <span class="koboSpan" id="kobo.31.2">
     The code for this chapter is available on GitHub at
    </span>
    <a href="https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition">
     <span class="koboSpan" id="kobo.32.1">
      https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.33.1">
     in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.34.1">
       Chapter02
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.35.1">
      directory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.36.1">
     This chapter will use the CommonJS syntax; refer to
    </span>
    <a href="B19212_05.xhtml#_idTextAnchor139">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.37.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.38.1">
     for more information on CommonJS and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      ECMAScript modules.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-45">
    <a id="_idTextAnchor044">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     Interacting with the file system
    </span>
   </h1>
   <p>
    <strong class="bold">
     <span class="koboSpan" id="kobo.41.1">
      Standard in
     </span>
    </strong>
    <span class="koboSpan" id="kobo.42.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.43.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     ) refers to an
    </span>
    <a id="_idIndexMarker058">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     input stream that a program can use to read input from a
    </span>
    <a id="_idIndexMarker059">
    </a>
    <span class="koboSpan" id="kobo.46.1">
     command shell or Terminal.
    </span>
    <span class="koboSpan" id="kobo.46.2">
     Similarly,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.47.1">
      standard out
     </span>
    </strong>
    <span class="koboSpan" id="kobo.48.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.49.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.50.1">
     ) refers
    </span>
    <a id="_idIndexMarker060">
    </a>
    <span class="koboSpan" id="kobo.51.1">
     to the stream that is used to write the output.
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.52.1">
      Standard error
     </span>
    </strong>
    <span class="koboSpan" id="kobo.53.1">
     (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.54.1">
      stderr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.55.1">
     ) is a separate stream to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.56.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.57.1">
     that
    </span>
    <a id="_idIndexMarker061">
    </a>
    <span class="koboSpan" id="kobo.58.1">
     is typically reserved for outputting errors and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.59.1">
      diagnostic data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.60.1">
     In this recipe, we’re going to learn how to handle input with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.61.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.62.1">
     , write output to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.63.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.64.1">
     , and log errors
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.66.1">
       stderr
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-46">
    <a id="_idTextAnchor045">
    </a>
    <span class="koboSpan" id="kobo.68.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.69.1">
     For this recipe, let’s first create a single file named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.70.1">
      greeting.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.71.1">
     .
    </span>
    <span class="koboSpan" id="kobo.71.2">
     The program will ask for user input via
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.72.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.73.1">
     , return a greeting via
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.74.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.75.1">
     , and log an error to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.76.1">
      stderr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.77.1">
     when invalid input is provided.
    </span>
    <span class="koboSpan" id="kobo.77.2">
     Let’s create a directory to work
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.78.1">
      in, too:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.79.1">
$ mkdir interfacing-with-io
$ cd interfacing-with-io
$ touch greeting.js</span></pre>
   <p>
    <span class="koboSpan" id="kobo.80.1">
     Now that we’ve set up our directory and file, we’re ready to move on to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.81.1">
      recipe steps.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-47">
    <a id="_idTextAnchor046">
    </a>
    <span class="koboSpan" id="kobo.82.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.83.1">
     In this recipe, we’re going to create a program that can read from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.84.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.85.1">
     and write to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.86.1">
      stdout
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.88.1">
       stderr
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.89.1">
      :
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.90.1">
      First, we need to tell the program to listen for user input.
     </span>
     <span class="koboSpan" id="kobo.90.2">
      This can be done by adding the following lines
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.91.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.92.1">
        greeting.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.93.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.94.1">
console.log('What is your name?');
process.stdin.on('data', (data) =&gt; {
  // processing on each data event
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.95.1">
      We can
     </span>
     <a id="_idIndexMarker062">
     </a>
     <span class="koboSpan" id="kobo.96.1">
      run the file using the following command.
     </span>
     <span class="koboSpan" id="kobo.96.2">
      Observe that the application does not exit because it is continuing to listen for
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.97.1">
       process.stdin
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.98.1">
       data events:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.99.1">$ node greeting.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.100.1">
      Exit the program using
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.101.1">
       Ctrl
      </span>
     </em>
     <span class="koboSpan" id="kobo.102.1">
      +
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.103.1">
        C
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.104.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.105.1">
      We can now tell the program what it should do each time it detects a data event.
     </span>
     <span class="koboSpan" id="kobo.105.2">
      Add the following lines below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.106.1">
       // processing on each data
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.107.1">
        event
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.108.1">
       comment:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.109.1">
  const name = data.toString().trim().toUpperCase();
  process.stdout.write(`Hello ${name}!`);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.110.1">
      You can now type input to your program.
     </span>
     <span class="koboSpan" id="kobo.110.2">
      When you press
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.111.1">
       Enter
      </span>
     </em>
     <span class="koboSpan" id="kobo.112.1">
      , it will return a greeting and your name
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.113.1">
       in uppercase:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.114.1">$ node greeting.js</span></strong><span class="koboSpan" id="kobo.115.1">
What is your name?
</span><strong class="bold"><span class="koboSpan" id="kobo.116.1">Beth</span></strong><span class="koboSpan" id="kobo.117.1">
Hello BETH!</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.118.1">
      We can now add a check for whether the input string is empty and log to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.119.1">
       stderr
      </span>
     </strong>
     <span class="koboSpan" id="kobo.120.1">
      if it is.
     </span>
     <span class="koboSpan" id="kobo.120.2">
      Change your file to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.121.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.122.1">
console.log('What is your name?');
process.stdin.on('data', (data) =&gt; {
  // processing on each data event
  const name = data.toString().trim().toUpperCase();
  if (name !== '') {
    process.stdout.write(`Hello ${name}!`);
  } else {
    process.stderr.write('Input was empty.\n');
  }
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.123.1">
      Run the program again and hit
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.124.1">
       Enter
      </span>
     </em>
     <span class="koboSpan" id="kobo.125.1">
      with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.126.1">
       no input:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.127.1">$ node greeting.js</span></strong><span class="koboSpan" id="kobo.128.1">
What is your name?
</span><span class="koboSpan" id="kobo.128.2">Input was empty.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.129.1">
     We’ve now
    </span>
    <a id="_idIndexMarker063">
    </a>
    <span class="koboSpan" id="kobo.130.1">
     created a program that can read from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.131.1">
      stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.132.1">
     and write to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.133.1">
      stdout
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.134.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.135.1">
       stderr
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.136.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-48">
    <a id="_idTextAnchor047">
    </a>
    <span class="koboSpan" id="kobo.137.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.138.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.139.1">
      process.stdin
     </span>
    </strong>
    <span class="koboSpan" id="kobo.140.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.141.1">
      process.stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.142.1">
     , and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.143.1">
      process.stderr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.144.1">
     properties are all properties on the process object.
    </span>
    <span class="koboSpan" id="kobo.144.2">
     A global process object provides information and control of the Node.js process.
    </span>
    <span class="koboSpan" id="kobo.144.3">
     For each of the I/O channels (standard in, standard out, standard error), they emit data events for every chunk of data received.
    </span>
    <span class="koboSpan" id="kobo.144.4">
     In this recipe, we were running the program in interactive mode where each data chunk was determined by the newline character when you hit
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.145.1">
      Enter
     </span>
    </em>
    <span class="koboSpan" id="kobo.146.1">
     in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.147.1">
      your shell.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.148.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.149.1">
      process.stdin.on('data', (data) =&gt; {...});
     </span>
    </strong>
    <span class="koboSpan" id="kobo.150.1">
     instance is what listens for these data events.
    </span>
    <span class="koboSpan" id="kobo.150.2">
     Each data event returns a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.151.1">
      Buffer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.152.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.152.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.153.1">
      Buffer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.154.1">
     object (typically named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.155.1">
      data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.156.1">
     ) returns a binary representation of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.157.1">
      the input.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.158.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.159.1">
      const name = data.toString()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.160.1">
     instance is what turns the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.161.1">
      Buffer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.162.1">
     object into a string.
    </span>
    <span class="koboSpan" id="kobo.162.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.163.1">
      trim()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.164.1">
     function removes all whitespace characters – including spaces, tabs, and newline characters – from the beginning and end of a string.
    </span>
    <span class="koboSpan" id="kobo.164.2">
     The whitespace characters include spaces, tabs, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.165.1">
      newline characters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.166.1">
     We write to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.167.1">
      stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.168.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.169.1">
      stderr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.170.1">
     using the respective properties on the process object (
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.171.1">
       process.stdout.write
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.172.1">
      ,
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.173.1">
       process.stderr.write
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.174.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.175.1">
     During the recipe, we also used
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.176.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.177.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.178.1">
      C
     </span>
    </em>
    <span class="koboSpan" id="kobo.179.1">
     to exit the program in the shell.
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.180.1">
      Ctrl
     </span>
    </em>
    <span class="koboSpan" id="kobo.181.1">
     +
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.182.1">
      C
     </span>
    </em>
    <span class="koboSpan" id="kobo.183.1">
     sends
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.184.1">
      SIGINT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.185.1">
     , or signal interrupt, to the Node.js process.
    </span>
    <span class="koboSpan" id="kobo.185.2">
     For more information about signal events, refer to the Node.js Process API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.186.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/api/process.html#process_signal_events">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.187.1">
       https://nodejs.org/api/process.html#process_signal_events
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.189.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <strong class="bold">
     <span class="koboSpan" id="kobo.190.1">
      Console APIs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.191.1">
     : Under
    </span>
    <a id="_idIndexMarker064">
    </a>
    <span class="koboSpan" id="kobo.192.1">
     the hood,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      console.log
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      console.err
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     are using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.197.1">
      process.stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.199.1">
      process.stderr
     </span>
    </strong>
    <span class="koboSpan" id="kobo.200.1">
     .
    </span>
    <span class="koboSpan" id="kobo.200.2">
     Console methods are higher-level APIs and include automatic formatting.
    </span>
    <span class="koboSpan" id="kobo.200.3">
     It’s typical to use console methods for convenience and lower-level process methods when you require more control over
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.201.1">
      the stream.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-49">
    <a id="_idTextAnchor048">
    </a>
    <span class="koboSpan" id="kobo.202.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.203.1">
     As of Node.js 17.0.0, Node.js provides an Experimental Readline Promises API, which is used for reading a file line by line.
    </span>
    <span class="koboSpan" id="kobo.203.2">
     The Promises API variant of this allows you to use
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.204.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.205.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.206.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.207.1">
     instead of callbacks, providing a more modern and cleaner approach to handling
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.208.1">
      asynchronous operations.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.209.1">
     Here is an example of how the Promises API variant can be used to create a similar program to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.210.1">
      greeting.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.211.1">
     file created in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.212.1">
      main recipe:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.213.1">
const readline = require('node:readline/promises');
async function greet () {
  const rl = readline.createInterface({
        input: process.stdin,
        output: process.stdout
      });
  const name = await rl.question('What is your name?\n');
  console.log(`Hello ${name}!`);
  rl.close();
}
greet();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.214.1">
     This Node.js script utilizes the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.215.1">
      node:readline/promises
     </span>
    </strong>
    <span class="koboSpan" id="kobo.216.1">
     module, which provides the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.217.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.218.1">
     variant of the Readline API.
    </span>
    <span class="koboSpan" id="kobo.218.2">
     It defines an asynchronous function,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.219.1">
      greet()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.220.1">
     , which prompts the user for their name in the console and then greets them with a personalized message – similar to the main recipe program.
    </span>
    <span class="koboSpan" id="kobo.220.2">
     Using the Readline Promises API allows us to use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.221.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.222.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.223.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.224.1">
     syntax for cleaner asynchronous code flow.
    </span>
    <span class="koboSpan" id="kobo.224.2">
     We’ll cover more about the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.225.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.226.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.227.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.228.1">
     syntax in later recipes
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.229.1">
      and chapters.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-50">
    <a id="_idTextAnchor049">
    </a>
    <span class="koboSpan" id="kobo.230.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.231.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.232.1">
       Decoupling I/O
      </span>
     </em>
     <span class="koboSpan" id="kobo.233.1">
      recipe in
     </span>
     <a href="B19212_03.xhtml#_idTextAnchor068">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.234.1">
         Chapter 3
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
   <h1 id="_idParaDest-51">
    <a id="_idTextAnchor050">
    </a>
    <span class="koboSpan" id="kobo.235.1">
     Working with files
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.236.1">
     Node.js provides
    </span>
    <a id="_idIndexMarker065">
    </a>
    <span class="koboSpan" id="kobo.237.1">
     several core modules, including the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.238.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.239.1">
     module.
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.240.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.241.1">
     stands for File System, and this module provides the APIs to interact with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.242.1">
      file system.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.243.1">
     In this recipe, and throughout the book, we will make use of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.244.1">
      node:
     </span>
    </strong>
    <span class="koboSpan" id="kobo.245.1">
     prefix when importing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.246.1">
      core modules.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.247.1">
     In this recipe, we’ll learn how to read, write, and edit files using the synchronous functions available in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.248.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.249.1">
      module.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-52">
    <a id="_idTextAnchor051">
    </a>
    <span class="koboSpan" id="kobo.250.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.251.1">
     Let’s start by preparing a directory and files for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.252.1">
      this recipe:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.253.1">
      Create another directory for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.254.1">
       this recipe:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.255.1">$ mkdir working-with-files</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.256.1">$ cd working-with-files</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.257.1">
      And now, let’s create a file to read.
     </span>
     <span class="koboSpan" id="kobo.257.2">
      Run the following in your shell to create a file containing some
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.258.1">
       simple text:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.259.1">$ echo Hello World! </span><span class="koboSpan" id="kobo.259.2">&gt; hello.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.260.1">
      We’ll also need a file for our program—create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.261.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.262.1">
        readWriteSync.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.263.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.264.1">$ touch readWriteSync.js</span></strong></pre>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.265.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.266.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.267.1">
      touch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.268.1">
     utility is a command-line utility included in Unix-based operating systems that is used to update the access and modification date of a file or directory to the current time.
    </span>
    <span class="koboSpan" id="kobo.268.2">
     However, when
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.269.1">
      touch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.270.1">
     is run with no additional arguments on a non-existent file, it will create an empty file with that name.
    </span>
    <span class="koboSpan" id="kobo.270.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.271.1">
      touch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.272.1">
     utility is a typical way of creating an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      empty file.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-53">
    <a id="_idTextAnchor052">
    </a>
    <span class="koboSpan" id="kobo.274.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.275.1">
     In this recipe, we’ll
    </span>
    <a id="_idIndexMarker066">
    </a>
    <span class="koboSpan" id="kobo.276.1">
     synchronously read the file named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.277.1">
      hello.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.278.1">
     , manipulate the contents of the file, and then update the file using synchronous functions provided by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.279.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.280.1">
      module:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.281.1">
      We’ll start by requiring the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.282.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.283.1">
      and
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.284.1">
       path
      </span>
     </strong>
     <span class="koboSpan" id="kobo.285.1">
      built-in modules.
     </span>
     <span class="koboSpan" id="kobo.285.2">
      Add the following lines
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.286.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.287.1">
        readWriteSync.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.288.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.289.1">
const fs = require('node:fs');
const path = require('node:path');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.290.1">
      Now, let’s create a variable to store the file path of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.291.1">
       hello.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.292.1">
      file that we
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.293.1">
       created earlier:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.294.1">
const filepath = path.join(process.cwd(), 'hello.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.295.1">
      We can now synchronously read the file contents using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.296.1">
       readFileSync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.297.1">
      function provided by the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.298.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.299.1">
      module.
     </span>
     <span class="koboSpan" id="kobo.299.2">
      We’ll also print the file contents to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.300.1">
       stdout
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.301.1">
       using
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.302.1">
        console.log()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.303.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.304.1">
const contents = fs.readFileSync(filepath, 'utf8');
console.log('File Contents:', contents);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.305.1">
      Now, we can edit the content of the file – we will convert the lowercase text
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.306.1">
       into uppercase:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.307.1">
const upperContents = contents.toUpperCase();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.308.1">
      To update the file, we can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.309.1">
       writeFileSync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.310.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.310.2">
      We’ll also add a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.311.1">
       log
      </span>
     </strong>
     <span class="koboSpan" id="kobo.312.1">
      statement afterward indicating that the file has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.313.1">
       been updated:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.314.1">
fs.writeFileSync(filepath, upperContents);
console.log('File updated.');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.315.1">
      Run
     </span>
     <a id="_idIndexMarker067">
     </a>
     <span class="koboSpan" id="kobo.316.1">
      your program with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.317.1">
       the following:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.318.1">$ node readWriteSync.js</span></strong><span class="koboSpan" id="kobo.319.1">
File Contents: Hello World!
</span><span class="koboSpan" id="kobo.319.2">File updated.</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.320.1">
      To verify the contents were updated, you can open or use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.321.1">
       cat
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      in your Terminal to show the contents
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.323.1">
       of
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.324.1">
        hello.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.325.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.326.1">$ cat hello.txt</span></strong><span class="koboSpan" id="kobo.327.1">
HELLO WORLD!</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.328.1">
     You now have a program that, when run, will read the contents of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.329.1">
      hello.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.330.1">
     , convert the text content into uppercase, and update
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.331.1">
      the file.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-54">
    <a id="_idTextAnchor053">
    </a>
    <span class="koboSpan" id="kobo.332.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.333.1">
     As is commonplace, the first two lines of the file require the necessary core modules for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.334.1">
      the program.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.335.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.336.1">
      const fs = require('node:fs');
     </span>
    </strong>
    <span class="koboSpan" id="kobo.337.1">
     line will import the core Node.js File System module.
    </span>
    <span class="koboSpan" id="kobo.337.2">
     The API documentation for the Node.js File System module is available at
    </span>
    <a href="https://nodejs.org/api/fs.html">
     <span class="koboSpan" id="kobo.338.1">
      https://nodejs.org/api/fs.html
     </span>
    </a>
    <span class="koboSpan" id="kobo.339.1">
     .
    </span>
    <span class="koboSpan" id="kobo.339.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.340.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.341.1">
     module provides APIs to interact with the file system using Node.js.
    </span>
    <span class="koboSpan" id="kobo.341.2">
     Similarly, the core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.342.1">
      path
     </span>
    </strong>
    <span class="koboSpan" id="kobo.343.1">
     module provides APIs for working with file and directory paths.
    </span>
    <span class="koboSpan" id="kobo.343.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.344.1">
      path
     </span>
    </strong>
    <span class="koboSpan" id="kobo.345.1">
     module API documentation is available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.346.1">
      at
     </span>
    </span>
    <a href="https://nodejs.org/api/path.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.347.1">
       https://nodejs.org/api/path.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.349.1">
     Next, we defined a variable to store the file path of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.350.1">
      hello.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.351.1">
     using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.352.1">
      path.join()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      process.cwd()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     functions.
    </span>
    <span class="koboSpan" id="kobo.355.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.356.1">
      path.join()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     function joins the path sections provided as parameters with the separator for the specific platform (for example,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.358.1">
      /
     </span>
    </strong>
    <span class="koboSpan" id="kobo.359.1">
     on Unix and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      \
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.362.1">
      Windows environments).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.363.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.364.1">
      process.cwd()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.365.1">
     function is a function on the global process object that returns the current directory of the Node.js process.
    </span>
    <span class="koboSpan" id="kobo.365.2">
     This program is expecting the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.366.1">
      hello.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.367.1">
     file to be in the same directory as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.368.1">
      the program.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.369.1">
     Next, we read the file using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.370.1">
      fs.readFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.371.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.371.2">
     We pass this function the file path to read and the encoding, UTF-8.
    </span>
    <span class="koboSpan" id="kobo.371.3">
     The encoding parameter is optional—when the parameter is omitted, the function will default to returning a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.372.1">
       Buffer
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.373.1">
      object.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     To perform
    </span>
    <a id="_idIndexMarker068">
    </a>
    <span class="koboSpan" id="kobo.375.1">
     manipulation of the file contents, we used the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.376.1">
      toUpperCase()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     function available on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.378.1">
      string objects.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.379.1">
     Finally, we updated the file using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.380.1">
      fs.writeFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.381.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.381.2">
     We passed the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.382.1">
      fs.writeFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.383.1">
     function two parameters.
    </span>
    <span class="koboSpan" id="kobo.383.2">
     The first parameter was the path to the file we wished to update, and the second parameter was the updated
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.384.1">
      file contents.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.385.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.386.1">
     Both the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.387.1">
      readFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.388.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.389.1">
      writeFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.390.1">
     APIs are synchronous, which means that they will block/delay concurrent operations until the file read or write is completed.
    </span>
    <span class="koboSpan" id="kobo.390.2">
     To avoid blocking, you’ll want to use the asynchronous versions of these functions, covered in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.391.1">
      There’s more…
     </span>
    </em>
    <span class="koboSpan" id="kobo.392.1">
     section of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.393.1">
      current recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-55">
    <a id="_idTextAnchor054">
    </a>
    <span class="koboSpan" id="kobo.394.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.395.1">
     Throughout this recipe, we were operating on our files synchronously.
    </span>
    <span class="koboSpan" id="kobo.395.2">
     However, Node.js was developed with a focus on enabling the non-blocking I/O model; therefore, in many (if not most) cases, you’ll want your operations to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.396.1">
      be asynchronous.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.397.1">
     Today, there are three notable ways to handle asynchronous code in Node.js—callbacks, Promises, and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.398.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.399.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.400.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.401.1">
     syntax.
    </span>
    <span class="koboSpan" id="kobo.401.2">
     The earliest versions of Node.js only supported the callback pattern.
    </span>
    <span class="koboSpan" id="kobo.401.3">
     Promises were added to the JavaScript specification with ECMAScript 2015, known as ES6, and subsequently, support for Promises was added to Node.js.
    </span>
    <span class="koboSpan" id="kobo.401.4">
     Following the addition of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.402.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.403.1">
     support,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.404.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.405.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.406.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.407.1">
     syntax support was also added
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.408.1">
      to Node.js.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.409.1">
     All currently supported versions of Node.js now support callbacks, Promises, and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.410.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.411.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.412.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.413.1">
     syntax – you may find any of these used in modern Node.js development.
    </span>
    <span class="koboSpan" id="kobo.413.2">
     Let’s explore how we can work with files asynchronously using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.414.1">
      these techniques.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.415.1">
     Working with files asynchronously
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.416.1">
     Asynchronous programming can enable some
    </span>
    <a id="_idIndexMarker069">
    </a>
    <span class="koboSpan" id="kobo.417.1">
     tasks or processing to continue while other operations
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.418.1">
      are happening.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.419.1">
     The program from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.420.1">
      Working with files
     </span>
    </em>
    <span class="koboSpan" id="kobo.421.1">
     recipe was written using the synchronous functions available in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.422.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.423.1">
      module:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.424.1">
const fs = require('node:fs');
const path = require('node:path');
const filepath = path.join(process.cwd(), 'hello.txt');
const contents = fs.readFileSync(filepath, 'utf8');
console.log('File Contents:', contents);
const upperContents = contents.toUpperCase();
fs.writeFileSync(filepath, upperContents);
console.log('File updated.');</span></pre>
   <p>
    <span class="koboSpan" id="kobo.425.1">
     This means that the program was blocked waiting for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.426.1">
      readFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.427.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.428.1">
      writeFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.429.1">
     operations to complete.
    </span>
    <span class="koboSpan" id="kobo.429.2">
     This program can be rewritten to make use of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.430.1">
      asynchronous APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.431.1">
     The asynchronous version of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.432.1">
      readFileSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.433.1">
     is
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.434.1">
      readFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.435.1">
     .
    </span>
    <span class="koboSpan" id="kobo.435.2">
     The general convention is that synchronous APIs will have the term “sync” appended to their name.
    </span>
    <span class="koboSpan" id="kobo.435.3">
     The asynchronous function requires a callback function to be passed to it.
    </span>
    <span class="koboSpan" id="kobo.435.4">
     The callback function contains the code that we want to be executed when the asynchronous
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.436.1">
      task completes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.437.1">
     The following
    </span>
    <a id="_idIndexMarker070">
    </a>
    <span class="koboSpan" id="kobo.438.1">
     steps will implement the same behavior as the program from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.439.1">
      Working with files
     </span>
    </em>
    <span class="koboSpan" id="kobo.440.1">
     recipe but using
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.441.1">
      asynchronous methods:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.442.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.443.1">
       readFileSync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.444.1">
      function in this recipe could be changed to use the asynchronous function with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.445.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.446.1">
const fs = require('node:fs');
const path = require('node:path');
const filepath = path.join(process.cwd(),
  'hello.txt');
fs.readFile(filepath, 'utf8', (err, contents) =&gt; {
  if (err) {
    return console.log(err);
  }
  console.log('File Contents:', contents);
  const upperContents = contents.toUpperCase();
  fs.writeFileSync(filepath, upperContents);
  console.log('File updated.');
});</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.447.1">
       Observe that all the processing that is reliant on the file read needs to take place inside the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.448.1">
        callback function.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.449.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.450.1">
       writeFileSync()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.451.1">
      function can also be replaced with the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.452.1">
       writeFile()
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.453.1">
       asynchronous function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.454.1">
const fs = require('node:fs');
const path = require('node:path');
const filepath = path.join(process.cwd(),
  'hello.txt');
fs.readFile(filepath, 'utf8', (err, contents) =&gt; {
  if (err) {
    return console.log(err);
  }
  console.log('File Contents:', contents);
  const upperContents = contents.toUpperCase();
  fs.writeFile(filepath, upperContents, (err) =&gt; {
    if (err) throw err;
    console.log('File updated.');
  });
});</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.455.1">
       Note that
      </span>
      <a id="_idIndexMarker071">
      </a>
      <span class="koboSpan" id="kobo.456.1">
       we now have an asynchronous function that calls another asynchronous function.
      </span>
      <span class="koboSpan" id="kobo.456.2">
       It’s not recommended to have too many nested callbacks as it can negatively impact the readability of the code.
      </span>
      <span class="koboSpan" id="kobo.456.3">
       Consider the following to see how having too many nested callbacks impedes the readability of the code, which is sometimes referred to as “
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.457.1">
        callback hell”:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.458.1">first(args, () =&gt; {
    second(args, () =&gt; {
        third(args, () =&gt; {});
    });
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.459.1">
      Some
     </span>
     <a id="_idIndexMarker072">
     </a>
     <span class="koboSpan" id="kobo.460.1">
      approaches can be taken to avoid too many nested callbacks.
     </span>
     <span class="koboSpan" id="kobo.460.2">
      One approach would be to split callbacks into explicitly named functions.
     </span>
     <span class="koboSpan" id="kobo.460.3">
      For example, our file could be rewritten so that the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.461.1">
       writeFile()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.462.1">
      call is contained within its own named
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.463.1">
       function,
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.464.1">
        updateFile()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.465.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.466.1">
const fs = require('node:fs');
const path = require('node:path');
const filepath = path.join(process.cwd(), 'hello.txt');
fs.readFile(filepath, 'utf8', (err, contents) =&gt; {
  if (err) {
    return console.log(err);
  }
  console.log('File Contents:', contents);
  const upperContents = contents.toUpperCase();
  updateFile(filepath, upperContents);
});
function updateFile (filepath, contents) {
  fs.writeFile(filepath, contents, function (err) {
    if (err) throw err;
    console.log('File updated.');
  });
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.467.1">
       Another approach would be to use Promises, which we’ll cover in the
      </span>
      <em class="italic">
       <span class="koboSpan" id="kobo.468.1">
        Using the fs Promises API
       </span>
      </em>
      <span class="koboSpan" id="kobo.469.1">
       section of this chapter.
      </span>
      <span class="koboSpan" id="kobo.469.2">
       But as the earliest versions of Node.js did not support Promises, the use of callbacks is still prevalent in many
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.470.1">
        npm
       </span>
      </strong>
      <span class="koboSpan" id="kobo.471.1">
       modules and
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.472.1">
        existing applications.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.473.1">
      To demonstrate
     </span>
     <a id="_idIndexMarker073">
     </a>
     <span class="koboSpan" id="kobo.474.1">
      that this code is asynchronous, we can use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.475.1">
       setInterval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.476.1">
      function to print a string to the screen while the program is running.
     </span>
     <span class="koboSpan" id="kobo.476.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.477.1">
       setInterval()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.478.1">
      function enables you to schedule a function to happen after a specified delay in milliseconds.
     </span>
     <span class="koboSpan" id="kobo.478.2">
      Add the following line to the end of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.479.1">
       your program:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.480.1">
setInterval(() =&gt; process.stdout.write('**** \n'), 1).unref();</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.481.1">
       Observe that the string continues to be printed every millisecond, even in between when the file is being read and rewritten.
      </span>
      <span class="koboSpan" id="kobo.481.2">
       This shows that the file reading and writing have been implemented in a non-blocking manner because operations are still completing while the file is
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.482.1">
        being handled.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.483.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.484.1">
     Using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.485.1">
      unref()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.486.1">
     on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.487.1">
      setInterval()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.488.1">
     means this timer will not keep the Node.js event loop active.
    </span>
    <span class="koboSpan" id="kobo.488.2">
     This means that if it is the only active event in the event loop, Node.js may exit.
    </span>
    <span class="koboSpan" id="kobo.488.3">
     This is useful for timers for which you want to execute an action in the future but do not want to keep the Node.js process
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.489.1">
      running solely.
     </span>
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.490.1">
      To demonstrate this further, you could add a delay between the reading and writing of the file.
     </span>
     <span class="koboSpan" id="kobo.490.2">
      To do this, wrap the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.491.1">
       updateFile()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.492.1">
      function in a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.493.1">
       setTimeout()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.494.1">
      function.
     </span>
     <span class="koboSpan" id="kobo.494.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.495.1">
       setTimeout()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.496.1">
      function allows you to pass it a function and a delay
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.497.1">
       in milliseconds:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.498.1">
setTimeout(() =&gt; updateFile(filepath, upperContents), 10);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.499.1">
      Now, the
     </span>
     <a id="_idIndexMarker074">
     </a>
     <span class="koboSpan" id="kobo.500.1">
      output from our program should have more asterisks printed between the file read and write, as this is where we added the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.501.1">
       10-millisecond delay:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.502.1">$ node readFileAsync.js</span></strong><span class="koboSpan" id="kobo.503.1">
****
****
File Contents: HELLO WORLD!
</span><span class="koboSpan" id="kobo.503.2">****
****
****
****
****
****
****
****
****
File updated.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.504.1">
     We can now see that we have converted the program from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.505.1">
      Working with files
     </span>
    </em>
    <span class="koboSpan" id="kobo.506.1">
     recipe to handle the file operations asynchronously using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.507.1">
      callback syntax.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.508.1">
     Using the fs Promises API
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.509.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.510.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.511.1">
     Promises API was released in Node.js v10.0.0.
    </span>
    <span class="koboSpan" id="kobo.511.2">
     The API provides File System functions
    </span>
    <a id="_idIndexMarker075">
    </a>
    <span class="koboSpan" id="kobo.512.1">
     that return
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.513.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.514.1">
     objects rather than callbacks.
    </span>
    <span class="koboSpan" id="kobo.514.2">
     Not all the original
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.515.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.516.1">
     module APIs have equivalent
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.517.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.518.1">
     -based APIs, as only a subset of the original APIs were converted to provide
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.519.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.520.1">
     APIs.
    </span>
    <span class="koboSpan" id="kobo.520.2">
     Refer to the Node.js API documentation for a full list of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.521.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.522.1">
     functions provided via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.523.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.524.1">
     Promises
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.525.1">
      API:
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest/api/fs.html#promises-api">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.526.1">
       https://nodejs.org/docs/latest/api/fs.html#promises-api
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.527.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.528.1">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.529.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.530.1">
     is an object that is used to represent the completion of an asynchronous function.
    </span>
    <span class="koboSpan" id="kobo.530.2">
     The naming is based on the general definition of the term “promise”—an agreement to do something or that something will happen.
    </span>
    <span class="koboSpan" id="kobo.530.3">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.531.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.532.1">
     object is always in one of the three
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.533.1">
      following states:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.534.1">
       Pending
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.535.1">
       Fulfilled
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.536.1">
       Rejected
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.537.1">
     A
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.538.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.539.1">
     will initially be in the pending state and will remain pending until it becomes either fulfilled—when the task has completed successfully—or rejected—when the task
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.540.1">
      has failed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.541.1">
     The following steps will implement the same behavior as the program from the recipe again but using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.542.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.543.1">
     Promises
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.544.1">
      API methods:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.545.1">
      To use the API, you’ll first need to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.546.1">
       import it:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.547.1">
const fs = require('node:fs/promises');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.548.1">
      It is then possible to read the file using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.549.1">
        readFile()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.550.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.551.1">
fs.readFile(filepath, 'utf8').then((contents) =&gt; {
    console.log('File Contents:', contents);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.552.1">
      You can also combine the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.553.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.554.1">
      Promises API with the use of the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.555.1">
        async
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.556.1">
       /
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.557.1">
        await
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.558.1">
       syntax:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.559.1">
const fs = require('node:fs/promises');
const path = require('node:path');
const filepath = path.join(process.cwd(),
  'hello.txt');
async function run () {
  try {
    const contents = await fs.readFile(filepath,
      'utf8');
    console.log('File Contents:', contents);
  } catch (error) {
    console.error(error);
  }
}
run();</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.560.1">
     Two notable
    </span>
    <a id="_idIndexMarker076">
    </a>
    <span class="koboSpan" id="kobo.561.1">
     aspects of this implementation are the use of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.562.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.563.1">
       async function run() {...}
      </span>
     </strong>
     <span class="koboSpan" id="kobo.564.1">
      : Defines an asynchronous function named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.565.1">
       run()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.566.1">
      .
     </span>
     <span class="koboSpan" id="kobo.566.2">
      Asynchronous functions enable the use of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.567.1">
       await
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      keyword for handling promises in a more
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.569.1">
       synchronous-looking manner.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.570.1">
       await fs.readFile(filepath, 'utf8')
      </span>
     </strong>
     <span class="koboSpan" id="kobo.571.1">
      : Uses the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.572.1">
       await
      </span>
     </strong>
     <span class="koboSpan" id="kobo.573.1">
      keyword to asynchronously read the contents of the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.574.1">
       file specified.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.575.1">
     Now, we’ve learned how we can interact with files using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.576.1">
      fs
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.577.1">
      Promises API.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.578.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.579.1">
     Owing to using CommonJS in this chapter, it was necessary to wrap the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.580.1">
      async
     </span>
    </strong>
    <span class="koboSpan" id="kobo.581.1">
     /
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.582.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.583.1">
     example in a function as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.584.1">
      await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.585.1">
     must only be called from within an asynchronous function with CommonJS.
    </span>
    <span class="koboSpan" id="kobo.585.2">
     From
    </span>
    <a href="B19212_05.xhtml#_idTextAnchor139">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.586.1">
        Chapter 5
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.587.1">
     onward, we’ll cover ECMAScript modules, where this wrapper function would be unnecessary due to
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.588.1">
      top-level await
     </span>
    </strong>
    <span class="koboSpan" id="kobo.589.1">
     being supported with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.590.1">
      ECMAScript modules.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-56">
    <a id="_idTextAnchor055">
    </a>
    <span class="koboSpan" id="kobo.591.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.592.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.593.1">
       Fetching metadata
      </span>
     </em>
     <span class="koboSpan" id="kobo.594.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.595.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.596.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.597.1">
       Watching files
      </span>
     </em>
     <span class="koboSpan" id="kobo.598.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.599.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <a href="B19212_05.xhtml#_idTextAnchor139">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.600.1">
         Chapter 5
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
   <h1 id="_idParaDest-57">
    <a id="_idTextAnchor056">
    </a>
    <span class="koboSpan" id="kobo.601.1">
     Fetching metadata
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.602.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.603.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.604.1">
     module
    </span>
    <a id="_idIndexMarker077">
    </a>
    <span class="koboSpan" id="kobo.605.1">
     generally provides APIs that
    </span>
    <a id="_idIndexMarker078">
    </a>
    <span class="koboSpan" id="kobo.606.1">
     are modeled around
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.607.1">
      Portable Operating System Interface
     </span>
    </strong>
    <span class="koboSpan" id="kobo.608.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.609.1">
      POSIX
     </span>
    </strong>
    <span class="koboSpan" id="kobo.610.1">
     ) functions.
    </span>
    <span class="koboSpan" id="kobo.610.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.611.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.612.1">
     module includes APIs that facilitate the reading of directories and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.613.1">
      file metadata.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.614.1">
     In this recipe, we will create a small program that returns information about a file, using functions provided by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.615.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.616.1">
      module.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-58">
    <a id="_idTextAnchor057">
    </a>
    <span class="koboSpan" id="kobo.617.1">
     Getting ready
    </span>
   </h2>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.618.1">
      Get started by creating a directory to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.619.1">
       work in:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.620.1">
$ mkdir fetching-metadata
$ cd fetching-metadata</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.621.1">
      We’ll also need to create a file to read and a file for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.622.1">
       our program:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.623.1">
$ touch metadata.js
$ touch file.txt</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-59">
    <a id="_idTextAnchor058">
    </a>
    <span class="koboSpan" id="kobo.624.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     Using the files created in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.626.1">
      Getting ready
     </span>
    </em>
    <span class="koboSpan" id="kobo.627.1">
     section, we will create a program that gives information
    </span>
    <a id="_idIndexMarker079">
    </a>
    <span class="koboSpan" id="kobo.628.1">
     about the file we pass to it as
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.629.1">
      a parameter:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.630.1">
      As in the previous recipes, we first need to import the necessary core modules.
     </span>
     <span class="koboSpan" id="kobo.630.2">
      For this recipe, we just need to import the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.631.1">
        fs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.632.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.633.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.634.1">
      Next, we need the program to be able to read the filename as a command-line argument.
     </span>
     <span class="koboSpan" id="kobo.634.2">
      To read the file argument, we can use
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.635.1">
       process.argv[2]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.636.1">
      .
     </span>
     <span class="koboSpan" id="kobo.636.2">
      Add the following line to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.637.1">
       your program:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.638.1">
const file = process.argv[2];</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.639.1">
      Now, we will create our
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.640.1">
        printMetadata
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.641.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.642.1">
function printMetadata(file) {
  const fileStats = fs.statSync(file);
  console.log(fileStats);
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.643.1">
      Add a call to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.644.1">
        printMetadata
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.645.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.646.1">
printMetadata(file);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.647.1">
      You can now run the program, passing it the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.648.1">
       ./file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.649.1">
      argument.
     </span>
     <span class="koboSpan" id="kobo.649.2">
      Run your program with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.650.1">
       the following:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.651.1">$ node metadata.js ./file.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.652.1">
      Expect to see output like
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.653.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.654.1">
Stats {
  dev: 16777231,
  mode: 33188,
  nlink: 1,
  uid: 501,
  gid: 20,
  rdev: 0,
  blksize: 4096,
  ino: 16402722,
  size: 0,
  blocks: 0,
  atimeMs: 1697208041116.9521,
  mtimeMs: 1697208041116.9521,
  ctimeMs: 1697208041116.9521,
  birthtimeMs: 1697208041116.9521,
  atime: 2023-10-13T14:40:41.117Z,
  mtime: 2023-10-13T14:40:41.117Z,
  ctime: 2023-10-13T14:40:41.117Z,
  birthtime: 2023-10-13T14:40:41.117Z
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.655.1">
       You can
      </span>
      <a id="_idIndexMarker080">
      </a>
      <span class="koboSpan" id="kobo.656.1">
       try adding some random text to
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.657.1">
        file.txt
       </span>
      </strong>
      <span class="koboSpan" id="kobo.658.1">
       , saving the file, and then rerunning your program; observe that the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.659.1">
        size
       </span>
      </strong>
      <span class="koboSpan" id="kobo.660.1">
       and
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.661.1">
        mtime
       </span>
      </strong>
      <span class="koboSpan" id="kobo.662.1">
       values have
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.663.1">
        been updated.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.664.1">
      Now, let’s see what happens when we pass a non-existent file to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.665.1">
       the program:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.666.1">$ node metadata.js ./not-a-file.txt</span></strong><span class="koboSpan" id="kobo.667.1">
node:fs:1658
  const stats = binding.stat(
                        ^
Error: ENOENT: no such file or directory, stat './not-a-file.txt'</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.668.1">
       The program throws
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.669.1">
        an exception.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.670.1">
      We
     </span>
     <a id="_idIndexMarker081">
     </a>
     <span class="koboSpan" id="kobo.671.1">
      should catch this exception and output a message to the user saying the file path provided does not exist.
     </span>
     <span class="koboSpan" id="kobo.671.2">
      To do this, change the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.672.1">
       printMetadata
      </span>
     </strong>
     <span class="koboSpan" id="kobo.673.1">
      function
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.674.1">
       to this:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.675.1">
function printMetadata(file) {
  try {
    const fileStats = fs.statSync(file);
    console.log(fileStats);
  } catch (err) {
    console.error('Error reading file path:', file);
  }
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.676.1">
      Run the program again with a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.677.1">
       non-existent file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.678.1">
$ node metadata.js ./not-a-file.txt
Error reading file: ./not-a-file.txt</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.679.1">
     This time, you should see that the program handled the error rather than throwing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.680.1">
      an exception.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-60">
    <a id="_idTextAnchor059">
    </a>
    <span class="koboSpan" id="kobo.681.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.682.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.683.1">
      process.argv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.684.1">
     property is a
    </span>
    <a id="_idIndexMarker082">
    </a>
    <span class="koboSpan" id="kobo.685.1">
     property on the global process object that returns an array containing the arguments that were passed to the Node.js process.
    </span>
    <span class="koboSpan" id="kobo.685.2">
     The first element of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.686.1">
      process.argv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.687.1">
     array,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.688.1">
      process.argv[0]
     </span>
    </strong>
    <span class="koboSpan" id="kobo.689.1">
     , is the path of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.690.1">
      node
     </span>
    </strong>
    <span class="koboSpan" id="kobo.691.1">
     binary that is running.
    </span>
    <span class="koboSpan" id="kobo.691.2">
     The second element is the path of the file we’re executing – in this case,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.692.1">
      metadata.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.693.1">
     .
    </span>
    <span class="koboSpan" id="kobo.693.2">
     In the recipe, we passed the filename as the third command-line argument and, therefore, referenced it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.694.1">
      with
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.695.1">
       process.argv[2]
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.696.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.697.1">
     Next, we created a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.698.1">
      printMetadata()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.699.1">
     function that called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.700.1">
      statSync(file)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.701.1">
     .
    </span>
    <span class="koboSpan" id="kobo.701.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.702.1">
      statSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.703.1">
     function
    </span>
    <a id="_idIndexMarker083">
    </a>
    <span class="koboSpan" id="kobo.704.1">
     is a synchronous function that returns information about the file path that is passed to it.
    </span>
    <span class="koboSpan" id="kobo.704.2">
     The file path passed can be either a file or a directory.
    </span>
    <span class="koboSpan" id="kobo.704.3">
     The information returned is in the form of a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.705.1">
      stats
     </span>
    </strong>
    <span class="koboSpan" id="kobo.706.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.706.2">
     The following table lists the information returned on the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.707.1">
       stats
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.708.1">
      object:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer013">
     <span class="koboSpan" id="kobo.709.1">
      <img alt="Table 2.1 – Table listing properties returned on the stats object" src="image/B19212_02_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.710.1">
     Table 2.1 – Table listing properties returned on the stats object
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.711.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.712.1">
     In this recipe, we used only the synchronous File System APIs.
    </span>
    <span class="koboSpan" id="kobo.712.2">
     For most of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.713.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.714.1">
     APIs, there are both synchronous and asynchronous versions of each function.
    </span>
    <span class="koboSpan" id="kobo.714.2">
     Refer to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.715.1">
      Working with files asynchronously
     </span>
    </em>
    <span class="koboSpan" id="kobo.716.1">
     section of the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.717.1">
      Working with files
     </span>
    </em>
    <span class="koboSpan" id="kobo.718.1">
     recipe for more information about using asynchronous File
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      System APIs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.720.1">
     In the final steps
    </span>
    <a id="_idIndexMarker084">
    </a>
    <span class="koboSpan" id="kobo.721.1">
     of this recipe, we edited our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.722.1">
      printMetadata
     </span>
    </strong>
    <span class="koboSpan" id="kobo.723.1">
     function to account for invalid file paths.
    </span>
    <span class="koboSpan" id="kobo.723.2">
     We did this by wrapping the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.724.1">
      statSync
     </span>
    </strong>
    <span class="koboSpan" id="kobo.725.1">
     function in a
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.726.1">
       try
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.727.1">
      /
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.728.1">
       catch
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.729.1">
      statement.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-61">
    <a id="_idTextAnchor060">
    </a>
    <span class="koboSpan" id="kobo.730.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.731.1">
     Next, we’ll look
    </span>
    <a id="_idIndexMarker085">
    </a>
    <span class="koboSpan" id="kobo.732.1">
     at how we can check file access and modify file permissions and how to examine a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.733.1">
      symbolic
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.734.1">
       link
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.735.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.736.1">
       symlink
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.737.1">
      ).
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.738.1">
     Checking file access
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.739.1">
     It is
    </span>
    <a id="_idIndexMarker086">
    </a>
    <span class="koboSpan" id="kobo.740.1">
     recommended that if you’re attempting to read, write, or edit a file, you follow the approach of handling the error if the file is not found, as we did in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.741.1">
      the recipe.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.742.1">
     However, if you simply wanted to check the existence of a file, you could use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.743.1">
      fs.access()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.744.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.745.1">
      fs.accessSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.746.1">
     APIs.
    </span>
    <span class="koboSpan" id="kobo.746.2">
     Specifically, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.747.1">
      fs.access()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.748.1">
     function tests the user’s permissions for accessing the file or directory passed to it.
    </span>
    <span class="koboSpan" id="kobo.748.2">
     The function also allows an optional argument of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.749.1">
      mode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.750.1">
     to be passed to it, where you can request the function to do a specific access check using Node.js file access constants.
    </span>
    <span class="koboSpan" id="kobo.750.2">
     A list of Node.js file access constants is available in the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.751.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.752.1">
     module API documentation:
    </span>
    <a href="https://nodejs.org/api/fs.html#fs_file_access_constants">
     <span class="koboSpan" id="kobo.753.1">
      https://nodejs.org/api/fs.html#fs_file_access_constants
     </span>
    </a>
    <span class="koboSpan" id="kobo.754.1">
     .
    </span>
    <span class="koboSpan" id="kobo.754.2">
     These enable you to check whether the Node.js process can read, write, or execute the file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.755.1">
      path provided.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.756.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.757.1">
     There is a legacy API that is now deprecated, called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.758.1">
      fs.exists()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.759.1">
     .
    </span>
    <span class="koboSpan" id="kobo.759.2">
     It is not recommended you use this function.
    </span>
    <span class="koboSpan" id="kobo.759.3">
     The reason for deprecation was that the method’s interface was found to be error-prone and could lead to accidental race conditions.
    </span>
    <span class="koboSpan" id="kobo.759.4">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.760.1">
      fs.access()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.761.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.762.1">
      fs.stat()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.763.1">
     APIs should be
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.764.1">
      used instead.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.765.1">
     Modifying file permissions
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     The
    </span>
    <a id="_idIndexMarker087">
    </a>
    <span class="koboSpan" id="kobo.767.1">
     Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.768.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.769.1">
     module provides APIs that can be used to alter the permissions on a given file.
    </span>
    <span class="koboSpan" id="kobo.769.2">
     As with many of the other
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.770.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.771.1">
     functions, there is both an asynchronous API,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.772.1">
      chmod()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.773.1">
     , and an equivalent synchronous API,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.774.1">
      chmodSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.775.1">
     .
    </span>
    <span class="koboSpan" id="kobo.775.2">
     Both functions take a file path and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.776.1">
      mode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.777.1">
     as the first and second arguments, respectively.
    </span>
    <span class="koboSpan" id="kobo.777.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.778.1">
      chmod()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.779.1">
     function accepts a third parameter, which is the callback function to be executed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.780.1">
      upon completion.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.781.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.782.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.783.1">
      chmod
     </span>
    </strong>
    <span class="koboSpan" id="kobo.784.1">
     command
    </span>
    <a id="_idIndexMarker088">
    </a>
    <span class="koboSpan" id="kobo.785.1">
     is used to change access permissions of file system objects on Unix and similar operating systems.
    </span>
    <span class="koboSpan" id="kobo.785.2">
     If you’re unfamiliar with Unix file permissions, it is recommended you refer to the Unix manual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.786.1">
      pages (
     </span>
    </span>
    <a href="https://linux.die.net/man/1/chmod">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.787.1">
       https://linux.die.net/man/1/chmod
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.788.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.789.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.790.1">
      mode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.791.1">
     argument can be either in the form of a numeric bitmask using a series of constants provided by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.792.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.793.1">
     module or a sequence of three octal digits.
    </span>
    <span class="koboSpan" id="kobo.793.2">
     The constants that can be used to create a bitmask to define user permissions are defined in the Node.js API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.794.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/api/fs.html#fs_file_modes">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.795.1">
       https://nodejs.org/api/fs.html#fs_file_modes
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.796.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.797.1">
     Imagine that you have a file that currently has the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.798.1">
      following permissions:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.799.1">
      Owner readable
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.800.1">
       and writeable
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.801.1">
       Group readable
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.802.1">
      Readable only by all other users (sometimes referred to as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.803.1">
       world readable)
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.804.1">
     If we wanted to additionally grant write access to those in the same group, we could use the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.805.1">
      Node.js code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.806.1">
const fs = require('node:fs');
const file = './file.txt';
fs.chmodSync(
  file,
  fs.constants.S_IRUSR |
    fs.constants.S_IWUSR |
    fs.constants.S_IRGRP |
    fs.constants.S_IWGRP |
    fs.constants.S_IROTH
);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.807.1">
     As you can
    </span>
    <a id="_idIndexMarker089">
    </a>
    <span class="koboSpan" id="kobo.808.1">
     see, this code is quite verbose.
    </span>
    <span class="koboSpan" id="kobo.808.2">
     Adding a complex series or permissions would require passing many constants to create a numeric bitmask.
    </span>
    <span class="koboSpan" id="kobo.808.3">
     Alternatively, we can pass the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.809.1">
      chmodSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.810.1">
     function an octal representation of file permissions, as is commonplace when using the Unix
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.811.1">
      chmod
     </span>
    </strong>
    <span class="koboSpan" id="kobo.812.1">
     command on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.813.1">
      command line.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.814.1">
     We’re going to change the permissions using the equivalent of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.815.1">
      chmod 664
     </span>
    </strong>
    <span class="koboSpan" id="kobo.816.1">
     from the command line, but
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.817.1">
      via Node.js:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.818.1">
const fs = require('fs');
const file = './file.txt';
fs.chmodSync(file, 0o664);</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.819.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.820.1">
     Refer to
    </span>
    <a href="https://mason.gmu.edu/~montecin/UNIXpermiss.htm">
     <span class="koboSpan" id="kobo.821.1">
      https://mason.gmu.edu/~montecin/UNIXpermiss.htm
     </span>
    </a>
    <span class="koboSpan" id="kobo.822.1">
     for more detailed information on how Unix
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.823.1">
      permissions work.
     </span>
    </span>
   </p>
   <p class="callout">
    <strong class="bold">
     <span class="koboSpan" id="kobo.824.1">
      Windows file permissions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.825.1">
     : The
    </span>
    <a id="_idIndexMarker090">
    </a>
    <span class="koboSpan" id="kobo.826.1">
     Windows operating system does not have as refined file permissions as on Unix—it is only possible to denote a file as writeable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.827.1">
      or non-writeable.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.828.1">
     Inspecting symbolic links
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.829.1">
     A symlink is a
    </span>
    <a id="_idIndexMarker091">
    </a>
    <span class="koboSpan" id="kobo.830.1">
     special file that stores a reference to another file or directory.
    </span>
    <span class="koboSpan" id="kobo.830.2">
     When the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.831.1">
      stat()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.832.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.833.1">
      statSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.834.1">
     function from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.835.1">
      Fetching metadata
     </span>
    </em>
    <span class="koboSpan" id="kobo.836.1">
     recipe is run on a symbolic link, the method will return information about the file the symbolic link is referencing rather than the symbolic
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.837.1">
      link itself.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.838.1">
     The Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.839.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.840.1">
     module does, however, provide methods named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.841.1">
      lstat()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.842.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.843.1">
      lstatSync()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.844.1">
     that inspect the symbolic link itself.
    </span>
    <span class="koboSpan" id="kobo.844.2">
     The following steps will demonstrate how you can use these methods to inspect a symbolic link that we
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.845.1">
      will create:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.846.1">
      To create a symbolic link, you can use the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.847.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.848.1">$ ln -s file.txt link-to-file</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.849.1">
       Now, you can use the
      </span>
      <a id="_idIndexMarker092">
      </a>
      <span class="koboSpan" id="kobo.850.1">
       Node.js
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.851.1">
        Read-Eval-Print Loop
       </span>
      </strong>
      <span class="koboSpan" id="kobo.852.1">
       (
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.853.1">
        REPL
       </span>
      </strong>
      <span class="koboSpan" id="kobo.854.1">
       ) to test the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.855.1">
        lstatSync()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.856.1">
       function.
      </span>
      <span class="koboSpan" id="kobo.856.2">
       The Node.js REPL is an interactive shell we can pass statements to, and it will evaluate them and return the result to
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.857.1">
        the user.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.858.1">
      To enter the Node.js REPL, type
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.859.1">
       node
      </span>
     </strong>
     <span class="koboSpan" id="kobo.860.1">
      in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.861.1">
       your shell:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.862.1">$ node</span></strong><span class="koboSpan" id="kobo.863.1">
Welcome to Node.js v22.9.0.
</span><span class="koboSpan" id="kobo.863.2">Type ".help" for more information.
</span><span class="koboSpan" id="kobo.863.3">&gt;</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.864.1">
      You can then type commands such as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.865.1">
       the following:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.866.1">&gt; console.log(</span></strong><span class="koboSpan" id="kobo.867.1">'</span><strong class="bold"><span class="koboSpan" id="kobo.868.1">Hello World!</span></strong><span class="koboSpan" id="kobo.869.1">'</span><strong class="bold"><span class="koboSpan" id="kobo.870.1">);</span></strong><span class="koboSpan" id="kobo.871.1">
Hello World!
</span><span class="koboSpan" id="kobo.871.2">undefined</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.872.1">
      Now, you can try out the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.873.1">
        lstatSync
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.874.1">
       command:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.875.1">
&gt; </span><strong class="bold"><span class="koboSpan" id="kobo.876.1">fs.lstatSync('link-to-file');</span></strong><span class="koboSpan" id="kobo.877.1">
Stats {
  dev: 16777224,
  mode: 41453,
  nlink: 1,
  ...
</span><span class="koboSpan" id="kobo.877.2">}</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.878.1">
     Note that we did
    </span>
    <a id="_idIndexMarker093">
    </a>
    <span class="koboSpan" id="kobo.879.1">
     not need to explicitly import the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.880.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.881.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.881.2">
     The REPL automatically loads the core (built-in) Node.js modules so that they are available to be used.
    </span>
    <span class="koboSpan" id="kobo.881.3">
     The REPL is a useful tool for testing out commands without having to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.882.1">
      create files.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-62">
    <a id="_idTextAnchor061">
    </a>
    <span class="koboSpan" id="kobo.883.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.884.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.885.1">
       Watching files
      </span>
     </em>
     <span class="koboSpan" id="kobo.886.1">
      recipe in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.887.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-63">
    <a id="_idTextAnchor062">
    </a>
    <span class="koboSpan" id="kobo.888.1">
     Watching files
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.889.1">
     Node.js’s
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.890.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.891.1">
     module
    </span>
    <a id="_idIndexMarker094">
    </a>
    <span class="koboSpan" id="kobo.892.1">
     provides functionality that enables you to watch files and track when files or directories are created, updated,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.893.1">
      or deleted.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.894.1">
     In this recipe, we’ll create a small program named
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.895.1">
      watch.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.896.1">
     that watches for changes in a file using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.897.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.898.1">
     API and then prints a message when a change
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.899.1">
      has occurred.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-64">
    <a id="_idTextAnchor063">
    </a>
    <span class="koboSpan" id="kobo.900.1">
     Getting ready
    </span>
   </h2>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.901.1">
      For this recipe, we’ll want to work inside a new directory.
     </span>
     <span class="koboSpan" id="kobo.901.2">
      Create and change into a directory
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.902.1">
       called
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.903.1">
        file-watching
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.905.1">$ mkdir file-watching</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.906.1">$ cd file-watching</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.907.1">
      We need to also create a file that we
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.908.1">
       can watch:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.909.1">$ echo Hello World! </span><span class="koboSpan" id="kobo.909.2">&gt; file.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.910.1">
      Create a
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.911.1">
        watch.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.912.1">
       file:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.913.1">$ touch watch.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.914.1">
     Now that
    </span>
    <a id="_idIndexMarker095">
    </a>
    <span class="koboSpan" id="kobo.915.1">
     we have created our directory and file, we can move on to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.916.1">
      the recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-65">
    <a id="_idTextAnchor064">
    </a>
    <span class="koboSpan" id="kobo.917.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.918.1">
     We’re going to create a program that watches for changes in a given file – in this case, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.919.1">
      file.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.920.1">
     file we created earlier.
    </span>
    <span class="koboSpan" id="kobo.920.2">
     We will be using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.921.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.922.1">
     module and, specifically, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.923.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.924.1">
     method to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.925.1">
      achieve this:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.926.1">
      To get started, import the required core
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.927.1">
       Node.js modules:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.928.1">
const fs = require('node:fs');
const path = require('node:path');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.929.1">
      We also need the program to access a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.930.1">
       we created:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.931.1">
const file = path.join(process.cwd(), 'file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.932.1">
      Next, we call the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.933.1">
        fs.watchFile()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.934.1">
       function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.935.1">
fs.watchFile(file, (current, previous) =&gt; {
    return console.log(`${file} updated
      ${(current.mtime)}`);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.936.1">
      Now, you can run the program in your shell with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.937.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.938.1">$ node watch.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.939.1">
      In your editor, open
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.940.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.941.1">
      and make some edits, saving between each one.
     </span>
     <span class="koboSpan" id="kobo.941.2">
      You will notice that each time you save, a log entry appears in the Terminal where you’re
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.942.1">
       running
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.943.1">
        watch.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.944.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.945.1">
./file.txt updated Mon Oct 16 2023 00:44:19 GMT+0100 (British Summer Time)</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.946.1">
      While we’re here, we can make the timestamp more readable.
     </span>
     <span class="koboSpan" id="kobo.946.2">
      To do this, we’re going to make use of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.947.1">
       Intl.DateTimeFormat
      </span>
     </strong>
     <span class="koboSpan" id="kobo.948.1">
      object.
     </span>
     <span class="koboSpan" id="kobo.948.2">
      It is a built-in JavaScript utility to manipulate dates
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.949.1">
       and times.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.950.1">
      Add and
     </span>
     <a id="_idIndexMarker096">
     </a>
     <span class="koboSpan" id="kobo.951.1">
      change the following lines to format the date
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.952.1">
       using
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.953.1">
        Intl.DateTimeFormat
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.954.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.955.1">
  const formattedTime = new Intl.DateTimeFormat('en-
    GB', {
    dateStyle: 'full',
    timeStyle: 'long'
  }).format(current.mtime);
  return console.log(`${file} updated
    ${formattedTime}`);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.956.1">
      Rerun the program and make further edits to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.957.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.958.1">
      —observe that the time is now in a more readable format for your
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.959.1">
       time zone:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.960.1">$ node watch.js</span></strong><span class="koboSpan" id="kobo.961.1">
./file.txt updated Monday 16 October 2024 at 00:45:27 BST</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-66">
    <a id="_idTextAnchor065">
    </a>
    <span class="koboSpan" id="kobo.962.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.963.1">
     In the recipe, we used
    </span>
    <a id="_idIndexMarker097">
    </a>
    <span class="koboSpan" id="kobo.964.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.965.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.966.1">
     function to watch for changes on a given file.
    </span>
    <span class="koboSpan" id="kobo.966.2">
     The function accepts three arguments—a filename, an optional list of options, and a listener function.
    </span>
    <span class="koboSpan" id="kobo.966.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.967.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.968.1">
     object can include
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.969.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.970.1">
       BigInt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.971.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.972.1">
       BigInt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.973.1">
      object is a JavaScript object that allows you to represent larger numbers more reliably.
     </span>
     <span class="koboSpan" id="kobo.973.2">
      This defaults to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.974.1">
       false
      </span>
     </strong>
     <span class="koboSpan" id="kobo.975.1">
      ; when set to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.976.1">
       true
      </span>
     </strong>
     <span class="koboSpan" id="kobo.977.1">
      , the numeric values returned from the object of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.978.1">
       Stats
      </span>
     </strong>
     <span class="koboSpan" id="kobo.979.1">
      would be specified
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.980.1">
       as
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.981.1">
        BigInt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.982.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.983.1">
       persistent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.984.1">
      : This value indicates whether the Node.js process should continue to run while files are still being watched.
     </span>
     <span class="koboSpan" id="kobo.984.2">
      It defaults
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.985.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.986.1">
        true
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.987.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.988.1">
       interval
      </span>
     </strong>
     <span class="koboSpan" id="kobo.989.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.990.1">
       interval
      </span>
     </strong>
     <span class="koboSpan" id="kobo.991.1">
      value controls how often the file should be polled for changes, measured in milliseconds.
     </span>
     <span class="koboSpan" id="kobo.991.2">
      The default value is 5,007 milliseconds when no interval
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.992.1">
       is supplied.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.993.1">
     The listener
    </span>
    <a id="_idIndexMarker098">
    </a>
    <span class="koboSpan" id="kobo.994.1">
     function supplied
    </span>
    <a id="_idIndexMarker099">
    </a>
    <span class="koboSpan" id="kobo.995.1">
     to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.996.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.997.1">
     function will execute every time a change is detected.
    </span>
    <span class="koboSpan" id="kobo.997.2">
     The listener function’s arguments, current and previous are both
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.998.1">
      Stats
     </span>
    </strong>
    <span class="koboSpan" id="kobo.999.1">
     objects, representing the current and previous state of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1000.1">
      the file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1001.1">
     Our listener function passed to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1002.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1003.1">
     is executed each time a change has been detected in the file being watched.
    </span>
    <span class="koboSpan" id="kobo.1003.2">
     Every time our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1004.1">
      updated
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1005.1">
     function returns
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1006.1">
      true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1007.1">
     , it logs the updated message
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1008.1">
      to
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1009.1">
       stdout
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1010.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1011.1">
     The Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1012.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1013.1">
     module provides another function,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1014.1">
      watch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1015.1">
     , which watches for changes in files but can also watch for directories.
    </span>
    <span class="koboSpan" id="kobo.1015.2">
     This function differs from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1016.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1017.1">
     as it utilizes the operating system’s underlying file system notification implementation rather than polling
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1018.1">
      for changes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1019.1">
     Although faster and more reliable than the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1020.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1021.1">
     API, the Watch API is not consistent across various platforms.
    </span>
    <span class="koboSpan" id="kobo.1021.2">
     This is because the Watch API is dependent on the underlying operating system’s method of notifying file system changes.
    </span>
    <span class="koboSpan" id="kobo.1021.3">
     The Node.js API documentation goes into more detail about the limitations of the Watch API across different
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1022.1">
      platforms:
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest/api/fs.html#fs_availability">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1023.1">
       https://nodejs.org/docs/latest/api/fs.html#fs_availability
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1024.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1025.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1026.1">
      watch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1027.1">
     function
    </span>
    <a id="_idIndexMarker100">
    </a>
    <span class="koboSpan" id="kobo.1028.1">
     similarly accepts three parameters—the filename, an array of options, and a listener function.
    </span>
    <span class="koboSpan" id="kobo.1028.2">
     The options that can be passed via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1029.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1030.1">
     parameter are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1031.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1032.1">
       persistent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1033.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1034.1">
       persistent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1035.1">
      option is a Boolean that indicates whether the Node.js process should continue to run while files are still being watched.
     </span>
     <span class="koboSpan" id="kobo.1035.2">
      By default, the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1036.1">
       persistent
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1037.1">
      option is set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1038.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1039.1">
        true
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1040.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1041.1">
       recursive
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1042.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1043.1">
       recursive
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1044.1">
      option is another Boolean that allows the user to specify whether changes in subdirectories should be watched – by default, this value is set to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1045.1">
       false
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1046.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1046.2">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1047.1">
       recursive
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1048.1">
      option is only supported on macOS and Windows
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1049.1">
       operating systems.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1050.1">
       encoding
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1051.1">
      : The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1052.1">
       encoding
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1053.1">
      option is used to specify which character encoding should be used for the filename specified—the default
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1054.1">
       is
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1055.1">
        utf8
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1056.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1057.1">
       Signal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1058.1">
      : An
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1059.1">
       AbortSignal
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1060.1">
      object that can be used to cancel
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1061.1">
       file watching.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1062.1">
     The listener function that is passed to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1063.1">
      watch()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1064.1">
     API is slightly different from the listener function passed to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1065.1">
      watchFile()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1066.1">
     API.
    </span>
    <span class="koboSpan" id="kobo.1066.2">
     The arguments to the listener function are
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1067.1">
      eventType
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1068.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1069.1">
      trigger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1070.1">
     , where
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1071.1">
      eventType
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1072.1">
     is either
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1073.1">
      change
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1074.1">
     or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1075.1">
      rename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1076.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1077.1">
      trigger
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1078.1">
     is the file that triggered an event.
    </span>
    <span class="koboSpan" id="kobo.1078.2">
     The following code represents a
    </span>
    <a id="_idIndexMarker101">
    </a>
    <span class="koboSpan" id="kobo.1079.1">
     similar task to what we implemented in our recipe but using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1080.1">
      Watch API:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1081.1">
const fs = require('node:fs');
const file = './file.txt';
fs.watch(file, (eventType, filename) =&gt; {
  const formattedTime = new Intl.DateTimeFormat('en-GB',
  {
    dateStyle: 'full',
    timeStyle: 'long'
  }).format(new Date());
  return console.log(`${filename} updated
    ${formattedTime}`);
});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1082.1">
     The final steps of the recipe cover usage of the comprehensive
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1083.1">
      Intl.DateTimeFormat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1084.1">
     utility for manipulating dates and times.
    </span>
    <span class="koboSpan" id="kobo.1084.2">
     Refer to
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1085.1">
      MDN Web Docs
     </span>
    </em>
    <span class="koboSpan" id="kobo.1086.1">
     for a list of available formats and APIs on
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1087.1">
       Intl.DateTimeFormat
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1088.1">
      :
     </span>
    </span>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1089.1">
       https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1090.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1091.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1092.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1093.1">
      moment.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1094.1">
     library
    </span>
    <a id="_idIndexMarker102">
    </a>
    <span class="koboSpan" id="kobo.1095.1">
     was once a go-to library for date manipulation and formatting in JavaScript.
    </span>
    <span class="koboSpan" id="kobo.1095.2">
     However, with the advancement of modern JavaScript, built-in functionalities such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1096.1">
      Intl.DateTimeFormat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1097.1">
     offers similar capabilities natively.
    </span>
    <span class="koboSpan" id="kobo.1097.2">
     Additionally,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1098.1">
      moment.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1099.1">
     has been put into maintenance mode by its maintainers, meaning no
    </span>
    <a id="_idIndexMarker103">
    </a>
    <span class="koboSpan" id="kobo.1100.1">
     new features will be added.
    </span>
    <span class="koboSpan" id="kobo.1100.2">
     Coupled with concerns about its bundle size, many developers are finding
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1101.1">
      moment.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1102.1">
     no longer necessary for their projects and are instead using built-in functionalities or more modern
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1103.1">
      alternative libraries.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-67">
    <a id="_idTextAnchor066">
    </a>
    <span class="koboSpan" id="kobo.1104.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1105.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1106.1">
      nodemon
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1107.1">
     utility
    </span>
    <a id="_idIndexMarker104">
    </a>
    <span class="koboSpan" id="kobo.1108.1">
     is a popular
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1109.1">
      npm
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1110.1">
     module utility for Node.js that
    </span>
    <a id="_idIndexMarker105">
    </a>
    <span class="koboSpan" id="kobo.1111.1">
     automatically restarts your application when it detects code change.
    </span>
    <span class="koboSpan" id="kobo.1111.2">
     Instead of manually stopping and starting the server after each code change,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1112.1">
      nodemon
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1113.1">
     handles
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1114.1">
      it automatically.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1115.1">
     Typical installation and usage of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1116.1">
      nodemon
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1117.1">
     are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1118.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1119.1">$ npm install --global nodemon</span></strong><span class="koboSpan" id="kobo.1120.1"> // globally install nodemon
</span><strong class="bold"><span class="koboSpan" id="kobo.1121.1">$ nodemon app.js</span></strong><span class="koboSpan" id="kobo.1122.1"> // nodemon will watch for updates and restart</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1123.1">
     More recent versions of Node.js (later than v18.11.0) have a built-in watch-mode capability.
    </span>
    <span class="koboSpan" id="kobo.1123.2">
     To enable watch mode, you supply the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1124.1">
      --watch
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1125.1">
     command-line
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1126.1">
      process flag:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1127.1">$ node --watch app.js</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.1128.1">
     While in watch mode, modifications to the observed files trigger a Node.js process restart.
    </span>
    <span class="koboSpan" id="kobo.1128.2">
     By default, the built-in watch mode will monitor the main entry file and any modules that are required
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1129.1">
      or imported.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1130.1">
     It is also possible to specify the exact files you wish to watch with the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1131.1">
      --watch-path
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1132.1">
     command-line
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1133.1">
      process flag:
     </span>
    </span>
   </p>
   <pre class="console">
<strong class="bold"><span class="koboSpan" id="kobo.1134.1">$ node --watch-path=./src --watch-path=./test app.js</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.1135.1">
     More information can be found in the Node.js API
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1136.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/dist/latest-v22.x/docs/api/cli.html#--watch">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1137.1">
       https://nodejs.org/dist/latest-v22.x/docs/api/cli.html#--watch
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1138.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-68">
    <a id="_idTextAnchor067">
    </a>
    <span class="koboSpan" id="kobo.1139.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1140.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1141.1">
       Adopting new JavaScript syntax in Node.js 22
      </span>
     </em>
     <span class="koboSpan" id="kobo.1142.1">
      recipe in
     </span>
     <a href="B19212_01.xhtml#_idTextAnchor019">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1143.1">
         Chapter 1
        </span>
       </em>
      </span>
     </a>
    </li>
   </ul>
  </div>
 </body></html>