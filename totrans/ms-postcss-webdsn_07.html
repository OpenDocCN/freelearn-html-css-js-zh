<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Animating Elements</h1></div></div></div><p>A question: if you had the choice of three websites: one static, one with badly done animation, and one which has been enhanced with subtle use of animation, which would you choose? Well, my hope is the answer to that question should be number three: animation can really make a site stand out if done well, or fail miserably if done badly!</p><p>So far, our content has been relatively static, save for the use of media queries. It's time, though, to take a look at how PostCSS can help make animating content a little easier. We'll begin with a quick recap on the basics of animation, before exploring the route to moving away from pure animation, through to SASS, and finally, across to PostCSS. We will cover a number of topics throughout this chapter, which will include:</p><p>A recap on the use of jQuery to animate content:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Switching to CSS-based animation</li><li class="listitem" style="list-style-type: disc">Exploring the use of pre-built libraries such as <code class="literal">Animate.css</code></li><li class="listitem" style="list-style-type: disc">Exploring the options available when making the change to using PostCSS</li><li class="listitem" style="list-style-type: disc">Working through creating an animation-based demo, using PostCSS</li><li class="listitem" style="list-style-type: disc">Learning how to optimize animations using PostCSS</li></ul></div><p>Let's make a start…!</p><div><div><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Revisiting basic animations</h1></div></div></div><p>Animation is quickly <a id="id331" class="indexterm"/>becoming king in web development, more and more websites are using animations to help bring life and keep content fresh. If done correctly, they add an extra layer of experience for the end user; done badly, and the website will soon lose more custom than water through a sieve!</p><p>Throughout the course of the chapter, we'll take a look at making the change from writing standard animation, through to using processors such as SASS, and finally, switching to using PostCSS. I can't promise you that we'll be creating complex JavaScript-based demos such as <a id="id332" class="indexterm"/>the <em>Caaaat</em> animation (<a class="ulink" href="http://roxik.com/cat/">http://roxik.com/cat/</a>—try resizing the window!), but we will see that using PostCSS is really easy when creating animations for the browser.</p><p>To kick off our journey, we'll start with a quick look at the traditional animation—how many times have you had to use <code class="literal">.animate()</code> in jQuery, over the years? Thankfully, we have the power of CSS3 to help with simple animations, but there was a time when we had to animate content using jQuery.</p><p>As a quick reminder, try <a id="id333" class="indexterm"/>running <code class="literal">animate.html</code> from the <code class="literal">T34 – Basic animation using jQuery animate()</code> folder. It's not going to set the world on fire, but is a nice reminder of times gone by, when we didn't know any better:</p><div><img src="img/BO5194_07_01.jpg" alt="Revisiting basic animations"/></div><p>If we take a look at a profile of this animation from within a DOM inspector from within a browser such as Firefox, it would look something like this screenshot:</p><div><img src="img/BO5194_07_02.jpg" alt="Revisiting basic animations"/></div><p>Whilst the numbers aren't critical, the key point here is the two dotted green lines, and that the results show a high degree of inconsistent activity. This is a good indicator that activity is erratic, with a low frame count, resulting in animations that are jumpy and less than 100% smooth.</p><p>The great thing, though, is that there are options available to help provide smoother animations; we'll take a brief look at some of the options available, before making the change to using PostCSS. For now though, let's make that first step to moving away from using jQuery, beginning with a look at the options available for reducing dependency on the use of <code class="literal">.animate()</code> or jQuery.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Moving away from jQuery</h1></div></div></div><p>Animating content can be a <a id="id334" class="indexterm"/>contentious subject, particularly if jQuery or JavaScript is used—if we were to take a straw poll of 100 people and ask which they used, it is very likely that we would get mixed answers! A key answer of <em>it depends</em> is likely to feature at or near the top of the list of responses; many will argue that animating content should be done using CSS, while others will affirm that JavaScript-based solutions still have value.</p><p>Leaving aside that…shall we say…lively debate, if we're looking to move away from using jQuery, and in particular <code class="literal">.animate()</code>, then we have some options available to us:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Upgrade your version of jQuery! Yes—this might sound at odds with the theme of this chapter, but the most recent versions of jQuery introduced the use of <code class="literal">requestAnimationFrame</code>, which improved performance, particularly on mobile devices.</li><li class="listitem" style="list-style-type: disc">A quick and dirty <a id="id335" class="indexterm"/>route is to use the jQuery Animate Enhanced plugin, available from <a class="ulink" href="http://playground.benbarnett.net/jquery-animate-enhanced/">http://playground.benbarnett.net/jquery-animate-enhanced/</a>; although a little old, it still serves a useful purpose. It will (where possible) convert <code class="literal">.animate()</code> calls into CSS3 equivalents; it isn't able to convert all, so any that are not converted will remain as <code class="literal">.animate()</code> calls.</li><li class="listitem" style="list-style-type: disc">Using the same principle, we can even take advantage of the JavaScript animation library, GSAP—the Greensock team have made available a plugin (from <a class="ulink" href="https://greensock.com/jquery-gsap-plugin">https://greensock.com/jquery-gsap-plugin</a>), that replaces <code class="literal">jQuery.animate()</code> with their own GSAP library. The latter is reputed to be 20 times faster than standard jQuery! With a little effort, we can look to rework our existing code—in place of using <code class="literal">.animate()</code>, we can add the equivalent CSS3 style(s) into our stylesheet and replace existing calls to <code class="literal">.animate()</code> with either <code class="literal">.removeClass()</code> or <code class="literal">.addClass()</code>, as appropriate.</li><li class="listitem" style="list-style-type: disc">We can switch to using <a id="id336" class="indexterm"/>libraries such as Transit (<a class="ulink" href="http://ricostacruz.com/jquery.transit/">http://ricostacruz.com/jquery.transit/</a>), it still requires the use of jQuery, but gives better performance than using the standard <code class="literal">.animate()</code> command.</li><li class="listitem" style="list-style-type: disc">Another alternative is <a id="id337" class="indexterm"/>Velocity JS by Jonathan Shapiro, available from <a class="ulink" href="http://julian.com/research/velocity/">http://julian.com/research/velocity/</a>; this has the benefit of not having jQuery as a dependency. There is even talk of incorporating all or part of the library into jQuery, as a replacement for <code class="literal">.animate()</code>—for more details, check out the issue log at <a class="ulink" href="https://github.com/jquery/jquery/issues/2053">https://github.com/jquery/jquery/issues/2053</a>.</li></ul></div><p>Many people automatically assume that CSS animations are faster than JavaScript (or even jQuery). After all, we don't need to call an external library (jQuery); we can use styles that are already baked into the browser, right? The truth is not as straightforward as this—in short, the right use of either will depend on your requirements and the limits of each method. For example, CSS animations are great for simple state changes, but if sequencing is required, then you <em>may</em> have to resort to using the JavaScript route.</p><p>The key, however, is less in the method used, and more in how many frames per second are displayed on screen. Most people cannot distinguish above 60FPS—this produces a very smooth experience. Anything less than around 25FPS will produce blur and occasionally appear jerky—it's <a id="id338" class="indexterm"/>up to us to select the best method available, that produces the most effective solution.</p><div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>To see the difference in frame rate, take a look at <a class="ulink" href="https://frames-per-second.appspot.com/">https://frames-per-second.appspot.com/</a>—the animations on this page can be controlled; it's easy to see why 60FPS produces a superior experience!</p></div></div><p>So, which route should we take? Well, over the next few pages, we'll take a brief look at each of these options. At this point, you may well be asking, "How is this relevant to PostCSS though, given that this is the subject of this book?"</p><p>In a nutshell, they are all methods that either improve how animations run, or allow us to remove the dependency on <code class="literal">.animate()</code>, which we know is not very efficient! True, some of these alternatives still use jQuery, but the key here is that your existing code could be using any or a mix of these methods. Later in this chapter, we'll take a look at how we can begin to remove jQuery, and focus more on using CSS3 animations, using the PostCSS plugin system.</p><div><div><h3 class="title"><a id="note33"/>Note</h3><p>A small word of note, all of the demos over the next few pages were run at the same time as a YouTube video was being run; this was to help simulate a little load and get a more realistic comparison. Running animations under load means less graphics processing power is available, which results in a lower FPS count.</p></div></div><p>Let's kick off with a look at our first option, the <code class="literal">Transit.js</code> library.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec62"/>Animating content with Transit.js</h2></div></div></div><p>In an ideal world, any <a id="id339" class="indexterm"/>project we build will have as few <a id="id340" class="indexterm"/>dependencies as possible; this applies equally to JavaScript or jQuery-based content as it does to CSS styling.</p><p>To help with reducing dependencies, we can use libraries such as TransitJS or Velocity to construct our animations. The key here is to make use of the animations that these libraries create, as a basis for applying styles we can then manipulate using <code class="literal">.addClass()</code> or <code class="literal">.removeClass()</code>. To see what I mean, let's explore this concept with a simple demo:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by opening up a copy of <code class="literal">animate.html</code>—to make it easier, we need to change the reference to <code class="literal">square-small</code> from a class to a selector:<div><pre class="programlisting">&lt;div id="square-small"&gt;&lt;/div&gt;</pre></div></li><li class="listitem">Next, go ahead and add in a reference to the Transit library, immediately before the closing <code class="literal">&lt;/head&gt;</code> tag:<div><pre class="programlisting">&lt;script src="img/jquery.transit.min.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">The Transit library uses a slightly different syntax, so go ahead and update the call to <code class="literal">.animate()</code> as indicated:<div><pre class="programlisting">smallsquare.transition({x: 280}, 'slow');</pre></div></li></ol></div><p>Save the file, then try <a id="id341" class="indexterm"/>previewing the results in a browser—if all is <a id="id342" class="indexterm"/>well, we should see no material change in the demo:</p><div><img src="img/BO5194_07_03.jpg" alt="Animating content with Transit.js"/></div><p>However, the animation will be significantly smoother—the frame count is higher, at 44.28FPS, with fewer dips:</p><div><img src="img/BO5194_07_04.jpg" alt="Animating content with Transit.js"/></div><p>Let's compare this with the same profile screenshot taken for the <em>Revisiting basic animations</em> section, earlier in this chapter—notice anything?</p><p>Profiling browser activity can be complex, but there are only two things we need to concern ourselves with here: the FPS value and the state of the green line. The FPS value, or Frames Per Second, is <a id="id343" class="indexterm"/>over three times higher, and for a large part, the green line is more consistent, with fewer, more short-lived dips.</p><p>This means that we have a smoother, more consistent performance; at approximately 44FPS, the average frame rate is significantly better than using standard jQuery—but we're still using jQuery!</p><p>There is a difference, though—libraries such as Transit or Velocity convert animations, where possible, to <a id="id344" class="indexterm"/>CSS3 equivalents—if we take a peek under the covers, we can see this in the flesh:</p><div><img src="img/BO5194_07_05.jpg" alt="Animating content with Transit.js"/></div><p>We can use this to our advantage, by removing the need to use <code class="literal">.animate()</code> and simply use <code class="literal">.addClass()</code> or <code class="literal">.removeClass()</code>—we'll see this in action later in this chapter, in the <em>Switching classes using jQuery</em> section.</p><div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>If you would like to <a id="id345" class="indexterm"/>compare our simple animation when using Transit or Velocity, there are examples available in the code download, as demos <code class="literal">T35A</code> and <code class="literal">T35B</code>, respectively.</p></div></div><p>To take it to the next step, we can use the Velocity library to create a version of our demo using plain JavaScript—we'll see how as part of the next demo. Beware though—this isn't an excuse to still use JavaScript; as we'll see, there is little difference in the frame count!</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec63"/>Animating with plain JavaScript</h2></div></div></div><p>Many developers <a id="id346" class="indexterm"/>are used to working with jQuery—after all, it makes it a cinch to reference just about any element on a page! Sometimes though, it is preferable to work in native JavaScript; this could be for speed. If we only need to support newer browsers (such as IE11 or Edge, and recent versions of Chrome or Firefox), then adding jQuery as a dependency isn't always necessary.</p><p>The beauty about libraries such as Transit (or Velocity) means that we don't always have to use jQuery to still achieve the same effect; as we'll see shortly, removing jQuery can help improve matters! Let's put this to the test, and adapt our earlier demo to work without using jQuery:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by extracting a copy of the <code class="literal">T35B</code> folder from the code download that accompanies this book. Save this to the root of our project area.</li><li class="listitem">Next, we need to edit a copy of <code class="literal">animate.html</code> within this folder—go ahead and remove the <a id="id347" class="indexterm"/>link to jQuery, then remove the link to <code class="literal">velocity.ui.min.js</code>; we should be left with this in the <code class="literal">&lt;head&gt;</code> of our file:<div><pre class="programlisting">  &lt;link rel="stylesheet" type="text/css" href="css/style.css"&gt;
  &lt;script src="img/velocity.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;</pre></div></li><li class="listitem">A little further down, alter the <code class="literal">&lt;script&gt;</code> block as shown:<div><pre class="programlisting">  &lt;script&gt;
    var smallsquare = document.getElementById('square-small');
    var animbutton = document.getElementById('animation-button'); 
    animbutton.addEventListener("click", function() {
      Velocity(document.getElementById('square-small'), {left: 280}, {duration: 'slow'});
    });
&lt;/script&gt;</pre></div></li><li class="listitem">Save the file, then preview the results in a browser—if we monitor the performance of our demo using a DOM Inspector, we can see a similar frame rate being recorded in our demo:<div><img src="img/BO5194_07_06.jpg" alt="Animating with plain JavaScript"/></div></li></ol></div><p>With jQuery as a dependency no longer in the picture, we can clearly see that the frame rate has improved; the downside, though, is that support is reduced for some browsers, such as IE8 or 9. This may not be an issue for your site—both Microsoft and the jQuery Core Team have announced changes to drop support for <code class="literal">IE8</code> - <code class="literal">10</code> and <code class="literal">IE8</code> respectively, which will help encourage users to upgrade to newer browsers.</p><p>It has to be said though, that while using CSS3 is preferable for speed and keeping our pages as lightweight as possible, using Velocity does provide a raft of extra opportunities that may be of use to your projects. The key here, though, is to carefully consider if you really do need <a id="id348" class="indexterm"/>them, or whether CSS3 will suffice, and allow you to use PostCSS.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec64"/>Switching classes using jQuery</h2></div></div></div><p>At this point, there <a id="id349" class="indexterm"/>is one question that comes to mind: what about using class-based animation? By this, I mean dropping any dependency on external animation libraries, and switching to using plain jQuery with either <code class="literal">.addClass()</code> or <code class="literal">.removeClass()</code> methods.</p><p>In theory, it sounds like <a id="id350" class="indexterm"/>a great idea—we can remove the need to use <code class="literal">.animate()</code>, and simply swap classes as needed, right? Well, it's an improvement, but it is still lower than using a combination of pure JavaScript and switching classes. It all boils down to a trade-off between using the ease of jQuery to reference elements, against pure JavaScript for speed:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by opening a copy of <code class="literal">animate.html</code> from the previous exercise—first, go ahead and replace the call to Velocity.JS with this line, within the <code class="literal">&lt;head&gt;</code> of our document:<div><pre class="programlisting">&lt;script src="img/jquery.min.js"&gt;&lt;/script&gt;</pre></div></li><li class="listitem">Next, remove the code between the <code class="literal">&lt;script&gt;</code> tags, and replace it with this:<div><pre class="programlisting">var smallsquare = $('.rectangle').find('.square-small');
$('#animation-button').on("click", function() {
      smallsquare.addClass("move");

      smallsquare.one('transitionend', function(e) {
        $('.rectangle').find('.square-small')
        .removeClass("move");
      });
    });</pre></div></li><li class="listitem">Save the file—if we preview the results in a browser, we should see no apparent change in how the demo appears, but the transition is marginally more performant than using a combination of jQuery and Transit:<div><img src="img/BO5194_07_07.jpg" alt="Switching classes using jQuery"/></div></li></ol></div><p>The real change in our code, though, will be apparent if we take a peek under the covers using a DOM Inspector:</p><div><img src="img/BO5194_07_08.jpg" alt="Switching classes using jQuery"/></div><p>Instead of using <code class="literal">.animate()</code>, we are using CSS3 animation styles to move our square-small <code class="literal">&lt;div&gt;</code>. Most browsers will accept the use of transition and transform, but it is worth running our code through a process such as Autocomplete, to ensure we apply the right vendor prefixes to our code.</p><p>The beauty of using <a id="id351" class="indexterm"/>CSS3 here is that, while it might not suit <a id="id352" class="indexterm"/>large, complex animations, we can at least begin to incorporate the use of external stylesheets such as <code class="literal">Animate.css</code>, or even use a preprocessor such as SASS to create our styles.</p><p>It's an easy change to make, so without further ado, and as the next step on our journey to using PostCSS, let's take a look at this in more detail.</p><div><div><h3 class="title"><a id="tip16"/>Tip</h3><p>If you would like to create custom keyframe-based animations, then take a look at <a class="ulink" href="http://cssanimate.com/">http://cssanimate.com/</a>, which provides a GUI-based interface for designing them, and will pipe out the appropriate code when requested.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Making use of pre-built libraries</h1></div></div></div><p>Up to this point, all <a id="id353" class="indexterm"/>of our animations have had one thing in common—they are individually created, and stored within the same stylesheet as other styles for each project.</p><p>This will work perfectly well, but we can do better—after all, it's possible that we may well create animations that others have already built! Over time, we may also build up a series of animations that can form the basis of a library that can be reused for future projects.</p><p>A number of developers have already done this. One example of note is the <code class="literal">Animate.css</code> library, created by Dan Eden. It's worth getting to know this library, as we will use it later in this book in the guise of the postcss-animation plugin for PostCSS. In the meantime, let's run through a quick demo of how it works, as a precursor to working with it in PostCSS.</p><div><div><h3 class="title"><a id="note34"/>Note</h3><p>The images used in this demo are referenced directly from the LoremPixem site, as placeholder images.</p></div></div><p>Let's make a start:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by extracting a copy of the <code class="literal">T37</code> folder from the code download that accompanies <a id="id354" class="indexterm"/>this book—save the folder to our project area.</li><li class="listitem">Next, open a new file and add the following code:<div><pre class="programlisting">body { background: #eee; }

#gallery {
  width: 745px;
  height: 500px;
  margin-left: auto;
  margin-right: auto;
}

#gallery img {
  border: 0.25rem solid #fff;
  margin: 20px;
  box-shadow: 0.25rem 0.25rem 0.3125rem #999;
  float: left;
}

.animated {
  animation-duration: 1s;
  animation-fill-mode: both;
}

.animated:hover {
  animation-duration: 1s;
  animation-fill-mode: both;
}</pre></div></li><li class="listitem">Save this as <code class="literal">style.css</code> in the <code class="literal">css</code> subfolder within the <code class="literal">T37</code> folder.</li><li class="listitem">Go ahead and preview the results in a browser—if all is well, then we should see something akin to this screenshot:<div><img src="img/BO5194_07_09.jpg" alt="Making use of pre-built libraries"/></div></li></ol></div><p>If we run the demo, we should see images run through different types of animation—there is nothing special or complicated here; the question is, though, how does it all fit in with PostCSS?</p><p>Well, there's a good reason <a id="id355" class="indexterm"/>for this—there will be some developers who have used <code class="literal">Animate.css</code> in the past, and will be familiar with how it works; we will also be using the <code class="literal">postcss-animation</code> plugin later, in <em>Updating code to use PostCSS</em>, which is based on the <code class="literal">Animate.css</code> stylesheet library. For those of you who are not familiar with the stylesheet library though, let's quickly run through how it works, within the context of our demo.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec65"/>Dissecting the code for our demo</h2></div></div></div><p>The effects used in our <a id="id356" class="indexterm"/>demo are quite striking—indeed, one might be forgiven for thinking that they required a lot of complex JavaScript!</p><p>This, however, could not be further from the truth—the <code class="literal">Animate.css</code> file contains a number of <code class="literal">@keyframe</code> based animations, similar to this:</p><div><pre class="programlisting">@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
  40% {transform: translateY(-1.875rem);}
  60% {transform: translateY(-0.9375rem);}
}</pre></div><p>We pull in the animations using the usual call to the library, within the <code class="literal">&lt;head&gt;</code> section of our code. We can then call any animation by name from within our code:</p><div><pre class="programlisting">  &lt;div id="gallery"&gt;
    &lt;a href="#"&gt;&lt;img class="<strong>animated bounce</strong>" src="img/1" alt="" /&gt;&lt;/a&gt;
...
  &lt;/div&gt;
  &lt;/body&gt;</pre></div><p>You will notice the addition of the <code class="literal">.animated</code> class in our code—this controls the duration and timing of the animation, and is set according to which animation name has been added to the code.</p><p>The downside of not using JavaScript (or jQuery for that matter) means that the animation will only run once when the demo is loaded; we can set it to run continuously by adding the <code class="literal">.infinite</code> class to the element being animated (this is part of the Animate library). We can fake a click option in CSS, but it is an experimental hack, which is not supported across all browsers—to effect any form of control, we really need to use JavaScript (or even jQuery)!</p><div><div><h3 class="title"><a id="note35"/>Note</h3><p>If you are interested in the details of the hack, then take a look at this response on Stack <a id="id357" class="indexterm"/>Overflow, at <a class="ulink" href="http://stackoverflow.com/questions/13630229/can-i-have-an-onclick-effect-in-css/32721572#32721572">http://stackoverflow.com/questions/13630229/can-i-have-an-onclick-effect-in-css/32721572#32721572</a>.</p></div></div><p>Okay, onwards we <a id="id358" class="indexterm"/>go: we've covered the basic use of pre-built libraries, such as Animate. It's time to step up a gear, and make the transition to PostCSS. As a start, we will use Gulp as our task runner of choice, with SASS. The latter is a perfect choice, as it fits in with the plugin we will use later in this chapter. Let's take a look at what is involved in laying the groundwork for our conversion to PostCSS.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Switching to using SASS</h1></div></div></div><p>As a developer or <a id="id359" class="indexterm"/>designer, if our development workflow includes the use of SASS, then the temptation is to use mixins such as this to construct our styles:</p><div><pre class="programlisting">@mixin transition ($value...) {
  @if length($value) &gt;= 1 { // If we set value
    @include prefixer($property: transition, $value: $value);
  } @else { // If value is not set, return default value
    @include prefixer($property: transition, $value: all 0.15s ease-in 0.05s);
  }
}</pre></div><p>There's nothing wrong with this, but it will take effort to manage our mixins if we need to use more than just a small handful! The easier option is to explore using a pre-built animation library, as a way of reducing our development effort.</p><p>There are a number of developers who have created mixin libraries to handle animations; a perfect example is the SASS port of Animate, by Geoff Graham, which is available for download at <a class="ulink" href="https://github.com/geoffgraham/animate.scss">https://github.com/geoffgraham/animate.scss</a>.</p><p>There is something, though, that we have to be mindful of when working with mixins—it's all too easy to use them to manage vendor prefixes, such as this:</p><div><pre class="programlisting">@mixin prefixer($property, $value) {
  -webkit-#{$property}: $value; // Attach webkit prefix (Chrome, Safary, Some Android native browsers)
  -moz-#{$property}: $value; // Attach moz prefix (FireFox)
  -o-#{$property}: $value; // Attach o prefix (Opera)
  #{$property}: $value; // no prefix (modern browsers and latest IE versions)
}</pre></div><p>Although it will add the relevant vendor prefixes when the code is compiled, it's <strong>not</strong> considered best practice.</p><p>The onus is on us to ensure that each animation includes all of the relevant vendor prefixes—with the best will in the world, it's a challenge to keep up! There is also the issue of adding rules that won't have any effect—for example, there is no point in adding <code class="literal">–o</code> as a prefix for transition; this prefix is no longer needed.</p><p>Fortunately, there is a better <a id="id360" class="indexterm"/>way to handle prefixes—we can use Autoprefixer (from <a class="ulink" href="https://twitter.com/autoprefixer">https://twitter.com/autoprefixer</a>) to automatically handle vendor prefixes for us. The great thing about Autoprefixer is that it uses the Can I Use (<a class="ulink" href="http://www.caniuse.com">http://www.caniuse.com</a>) database to keep details up to date.</p><p>There are various plugins available that allow us to use task runners such as Grunt or Gulp. We can of course use a standalone GUI-based compiler for this purpose, but why run something like this when we can tie in much more functionality when using a task runner? We can even use any one of several plugins to remove vendor prefixes, prior to running a new compilation—this will ensure any redundant prefixes are removed.</p><p>With this in mind, let's get practical. For our next demo, we're going to construct a simple gallery effect, which showcases the same animations we saw earlier, but this time using the SASS version of <code class="literal">Animate.css</code>. We'll use Gulp as our task runner to compile the SASS code, before adding a source map, checking our code for consistency, adding vendor prefixes, and so on. You get the idea!</p><p>Suffice to say that we can do a lot using a task runner, so without further ado, let's get started with constructing our gallery.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec66"/>Creating an animated gallery</h2></div></div></div><p>Animating content <a id="id361" class="indexterm"/>can be a double-edged sword. Added with care, it <a id="id362" class="indexterm"/>can really lift a site to the next level. If it is done badly, then patronage of the site is likely to drop like a stone!</p><p>In our last demo, we constructed a simple gallery effect—this was more to show off the different types of animated effects we can add, rather than produce something that would win awards. Over the next few pages, we'll continue with our demo, but this time reconfigure it to use the SASS version of <code class="literal">Animate.css</code>. We will also introduce the use of a task runner to compile our code—as this is a requirement for using PostCSS, it seems a perfect point to start using it, as the final part of our transition to working with animation and PostCSS.</p><div><div><h3 class="title"><a id="note36"/>Note</h3><p>The files for this tutorial are available in the <code class="literal">T38</code> folder in the accompanying code download.</p></div></div><p>Without further ado, let's add the changes to our previous demo:</p><div><ol class="orderedlist arabic"><li class="listitem">We need to download the SASS version of Animate—it's available from <a class="ulink" href="https://github.com/geoffgraham/animate.scss/archive/master.zip">https://github.com/geoffgraham/animate.scss/archive/master.zip</a>. Go ahead and extract the contents of <code class="literal">Animate.scss-master</code> into the <code class="literal">src</code> folder at the root of our project area.</li><li class="listitem">In the <code class="literal">src</code> folder, rename the <code class="literal">Animate.scss</code> file to <code class="literal">_animate.scss</code>—this is to indicate that it <a id="id363" class="indexterm"/>is a <strong>partial</strong>, which prevents it being compiled as a separate file by the SASS compiler.</li><li class="listitem">In the <code class="literal">src</code> folder, go ahead and rename it as <code class="literal">style.scss</code>—this changes it to a SASS file, which is required for compilation later in the exercise. We should have something akin to this screenshot in our <code class="literal">src</code> folder:<div><img src="img/BO5194_07_10.jpg" alt="Creating an animated gallery"/></div></li><li class="listitem">Go ahead and open up the <code class="literal">style.scss</code> file. At the bottom, add this line at the top of the stylesheet:<div><pre class="programlisting">@import "_animate.scss";</pre></div></li><li class="listitem">Next, add the <a id="id364" class="indexterm"/>following additional lines at the end of the stylesheet—these pull in the animations from the SASS version of <code class="literal">Animate.css</code>; the timing has also been extended to five seconds, as the original example was too quick:<div><pre class="programlisting"><strong>.bounce { @include bounce(); }</strong>
<strong>.flip { @include flip(); }</strong>
<strong>.hinge { @include hinge(); }</strong>
<strong>.flash { @include flash(); }</strong>
<strong>.shake { @include shake(); }</strong>
<strong>.swing { @include swing(); }</strong>

.animated:hover {
  animation-duration: 5s;
  animation-fill-mode: both;
} </pre></div></li><li class="listitem">Save the file, then copy the contents of the <code class="literal">src</code> folder under <code class="literal">T38</code> to the <code class="literal">src</code> folder at the root of our project area—we will be compiling this file shortly.</li><li class="listitem">In a new file, go <a id="id365" class="indexterm"/>ahead and add the following code, then save it as <code class="literal">gulpfile.js</code> to the root of our project area—this will form our gulp file, which we will use to compile our code:<div><pre class="programlisting">'use strict';
 
var gulp = require('gulp');
var postcss = require('gulp-postcss');
var sass = require('gulp-sass');

gulp.task('sass', function () {
  return gulp.src('src/*.scss')
    .pipe(sass().on('error', sass.logError))
    .pipe(gulp.dest('dest/'));
});

gulp.task('default', ['sass']);

var watcher = gulp.watch('src/*.scss', ['sass']);
watcher.on('change', function(event) {
  console.log('File ' + event.path + ' was ' + event.type + ', running tasks...');
});</pre></div></li><li class="listitem">We also need a <code class="literal">package.json</code> file—this will store details of the plugins we will be using. For <a id="id366" class="indexterm"/>now, we will limit ourselves to using <code class="literal">gulp-sass</code>, but this will soon change! Go ahead and add the following lines to a new file, saving it as <code class="literal">package.json</code> in the root of our project area:<div><pre class="programlisting">{
  "name": "postcss",
  "version": "1.0.0",
  "description": "Configuration file for PostCSS",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "author": "Alex Libby",
  "license": "ISC",
  "dependencies": {
    "postcss": "^5.0.8"
  },
  "devDependencies": {
    "gulp": "^3.9.0",
    "gulp-postcss": "^6.0.0",
    "gulp-sass": "^2.1.1"
  }
}</pre></div></li><li class="listitem">The keen-eyed among you should spot that we've not installed the gulp-sass plugin. Let's fix that now by firing up a Node.js command prompt, then changing the working directory to the project area. Go ahead and run this command from the prompt:<div><pre class="programlisting"><strong>npm install gulp-sass --save-dev</strong>
</pre></div></li><li class="listitem">At the prompt, enter <code class="literal">gulp</code> then press Enter—Gulp will now go away and compile our file; if all is well, we should see a compiled style sheet appear in the <code class="literal">dest</code> folder of our project area.</li><li class="listitem">At this point, try <a id="id367" class="indexterm"/>running <code class="literal">animate.html</code> in a browser—if all is well, we should see no change to our gallery effect, but can be safe in the knowledge that we're now using the SASS version of <code class="literal">Animate.css</code>.</li></ol></div><p>Our demo has now been <a id="id368" class="indexterm"/>converted to using <code class="literal">Animate.scss</code>—we could easily have chosen to use any one of several compilers (such as Koala—<a class="ulink" href="http://www.koala-app.com">http://www.koala-app.com</a>), but instead chose to use Gulp. It acts as a perfect route into making the transition to using PostCSS—as we've seen in earlier demos, we've already used a task runner in the form of Gulp for this purpose. This allows us to make that gradual transition—when all of the SASS elements have been converted, we simply drop the task from within our gulp file to complete the transition.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec67"/>Adding the finishing touches</h2></div></div></div><p>So, what next? We've <a id="id369" class="indexterm"/>created a basic gulp task file, which we used to compile our SASS code to valid styles.</p><p>But this is just a small part of the story; we need to add a lot more to make our compilation process useful and ready for conversion to using PostCSS.</p><p>Let's get started:</p><div><ol class="orderedlist arabic"><li class="listitem">The first change we need to make is in the <code class="literal">package.json</code> file—go ahead and add the lines as highlighted:<div><pre class="programlisting">    "cssnano": "^3.2.0",
    "gulp": "^3.9.0",
    <strong>"gulp-postcss": "^6.0.0"</strong>,
    <strong>"gulp-rename": "^1.2.2"</strong>,
    <strong>"gulp-sass": "^2.1.1"</strong>,
    <strong>"gulp-sourcemaps": "^1.5.2"</strong>,
    <strong>"postcss-reporter": "^1.3.0"</strong>,
    <strong>"stylelint": "^2.3.7"</strong>
  }
}</pre></div></li><li class="listitem">Next, we need to configure our gulp file with some additional tasks—the first task is to add references to some additional plugins that we've already used from earlier in the book. Go ahead and add the following highlighted lines:<div><pre class="programlisting">var sass = require('gulp-sass');
var autoprefixer = require('autoprefixer');
var cssnano = require('cssnano');
var sourcemaps = require('gulp-sourcemaps');
var rename = require('gulp-rename');
var stylelint = require('stylelint');
var reporter = require('postcss-reporter');</pre></div></li><li class="listitem">With the additional plugin references added, we now need to add in our extra tasks—immediately below the SASS task, add in this task; this manages the linting of our code, for consistency:<div><pre class="programlisting">gulp.task("lint-styles", ['sass'], function() {
  return gulp.src("dest/*.css")
    .pipe(postcss([ stylelint({
      "rules": {
        "color-no-invalid-hex": 2,
        "declaration-colon-space-before": [2, "never"],
        "indentation": [2, 2], 
        "number-leading-zero": [2, "always"]
      }
    }),
    reporter({
      clearMessages: true,
    })
  ]))
});</pre></div></li><li class="listitem">Add this next task <a id="id370" class="indexterm"/>immediately below the previous step—this renames the files as part of the minification process:<div><pre class="programlisting">gulp.task('rename', ['lint-styles'], function () {
  return gulp.src('dest/*.css')
    .pipe(postcss([ cssnano() ]))
    .pipe(rename('style.min.css'))
    .pipe(gulp.dest("dest/"));
});</pre></div></li><li class="listitem">Our next gulp task manages the generation of source maps—this can be done within SASS automatically, but using a separate plugin allows flexibility during compilation. Go ahead and add this task immediately below the previous one:<div><pre class="programlisting">gulp.task('sourcemap', ['rename'], function () {
  return gulp.src('dest/*.css')
    .pipe(sourcemaps.init())
    .pipe(sourcemaps.write('maps/'))
    .pipe(gulp.dest("dest/"));
});</pre></div></li><li class="listitem">We're almost at the end—go ahead and alter these lines as indicated:<div><pre class="programlisting">gulp.task('default', ['sass', 'lint-styles', 'rename', 'sourcemap']);

var watcher = gulp.watch('src/*.scss', ['sass', 'lint-styles', 'rename', 'sourcemap']);
watcher.on('change', function(event) {
  console.log('File ' + event.path + ' was ' + event.type + ', running tasks...');
});</pre></div></li><li class="listitem">Save the file. Go ahead and fire up a Node.js command prompt, then change the working folder to our project area.</li><li class="listitem">At the prompt, type in <code class="literal">gulp</code> then press <em>Enter</em>—Gulp will go away and compile our file.</li><li class="listitem">If we take a look in the <code class="literal">dest</code> folder, we should see the same compiled <code class="literal">style.css</code> file, but this time with accompanying minified versions of the source map and style sheet:<div><img src="img/BO5194_07_11.jpg" alt="Adding the finishing touches"/></div></li></ol></div><p>If we preview the results of our work, we should see no change in functionality within the demo, but can be safe in the knowledge that we now have minified versions of our files available for use—after all, it is always better to use minified files in a production environment!</p><p>We've now laid the groundwork <a id="id371" class="indexterm"/>for our conversion to using PostCSS—the keen-eyed among you should spot that the plugin reference for PostCSS has already been added to our gulp file, ready for the next stage in our conversion process. Everything is now in place in our gulp file, save for the SASS task – at the appropriate point we will remove the SASS task and replace it with a PostCSS equivalent; this will take place in our next exercise. Before we do so, it's worth taking a little time to explore what is available within the PostCSS ecosystem—although there isn't a great deal on offer, we can still produce usable code for compilation within PostCSS.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec59"/>Making the switch to PostCSS</h1></div></div></div><p>Okay…it's time to <a id="id372" class="indexterm"/>make that change to PostCSS!</p><p>Before we get stuck into exploring what is available, there is a key question that I am sure you will be asking—how come we've been exploring animation using JavaScript, when this book is clearly about PostCSS?</p><p>There is a very good answer for this—not only are we exploring the different routes we might take to transition to PostCSS, but at a more basic level, whether we can make the change. This might sound contradictory, so let me explain all:</p><p>A key limitation of animation is the FPS count, or Frames Per Second—jQuery's standard <code class="literal">.animate()</code> method is notoriously slow, and has not been optimized for speed. The FPS count on our animation at the start of this chapter was significantly lower than that of Velocity. The same applies for the alternative Transit library that we also covered earlier in this chapter.</p><p>Making the switch to using CSS will improve the frame rate, but CSS-based animation is not yet sufficiently powerful to manage complex animations. It means that we as developers have to assess any requirements for a project, and weigh up whether CSS-based animation will work, or if we have to fall back to using JavaScript-based libraries.</p><p>This translates through to using PostCSS—it may be tempting to use CSS-based animation for a project, but this will only work if our animation requirements are such that it is not going to result in an overly complex, difficult to manage, solution.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec60"/>Exploring plugin options within PostCSS</h1></div></div></div><p>Assuming the use <a id="id373" class="indexterm"/>of CSS3 animations will be suitable for our project, it's at this point that we can begin to make the transition to using PostCSS.</p><p>If you're expecting to see an array of plugins, then I'm sorry to disappoint—at present, there are only four plugins for use with animations:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Animation</strong>: Available at <a class="ulink" href="https://github.com/zhouwenbin/postcss-animation">https://github.com/zhouwenbin/postcss-animation</a>, this <a id="id374" class="indexterm"/>adds <code class="literal">@keyframes</code> from <code class="literal">Animate.css</code>. This plugin uses <a class="ulink" href="https://github.com/zhouwenbin/postcss-animation-data">https://github.com/zhouwenbin/postcss-animation-data</a>, which hosts the converted animations.</li><li class="listitem" style="list-style-type: disc"><strong>PostCSS Easings</strong>: Downloadable <a id="id375" class="indexterm"/>from <a class="ulink" href="https://github.com/postcss/postcss-easings">https://github.com/postcss/postcss-easings</a>, this plugin converts easing names from <a class="ulink" href="http://www.easings.net">http://www.easings.net</a> to <code class="literal">cubic-bezier()</code> equivalent values.</li><li class="listitem" style="list-style-type: disc"><strong>PostCSS Transform Shortcuts</strong>: This plugin allows us to specify individual values when <a id="id376" class="indexterm"/>creating transform statements—the source for this plugin is available from <a class="ulink" href="https://github.com/jonathantneal/postcss-transform-shortcut">https://github.com/jonathantneal/postcss-transform-shortcut</a>.</li><li class="listitem" style="list-style-type: disc"><strong>PostCSS MQ Keyframes</strong>: This plugin will move any keyframes from inside media queries to <a id="id377" class="indexterm"/>the bottom of our CSS file.</li></ul></div><p>One could be forgiven for <a id="id378" class="indexterm"/>wondering what is possible with such a small range of plugins! We will add to the list a little later on though. Toward the end of the chapter, we will create a version of the <code class="literal">postcss-animation-data</code> plugin that allows us to use the Magic animations from <a class="ulink" href="http://www.minimamente.com/example/magic_animations/">http://www.minimamente.com/example/magic_animations/</a>.</p><p>Okay, let's put some of these to use: time for a demo!</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec61"/>Updating code to use PostCSS</h1></div></div></div><p>Although the <a id="id379" class="indexterm"/>PostCSS ecosystem doesn't yet have a plentiful selection of animation-based plugins, this should not stop us from using it to compile our animation styles. To prove this, we're going to modify the jQuery and .add/remove class version of our previous demo—we'll use PostCSS to add an animation easing from the <code class="literal">Animate.css</code> library created by Dan Eden.</p><p>The plugin we require is the <code class="literal">postcss-animation</code> plugin, which is available from <a class="ulink" href="https://github.com/zhouwenbin/postcss-animation">https://github.com/zhouwenbin/postcss-animation</a> and uses the <code class="literal">postcss-animation-data</code> plugin from <a class="ulink" href="https://github.com/zhouwenbin/postcss-animation-data">https://github.com/zhouwenbin/postcss-animation-data</a>. It's a cinch to install the plugin, which uses the same method as all of the other plugins we've installed to date.</p><p>Let's get started on the demo:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by installing the <code class="literal">postcss-animation</code> plugin—for this, go ahead and open a Node.js session, then change the working directory to our project area.</li><li class="listitem">At the prompt, enter this command and press Enter:<div><pre class="programlisting"><strong>npm install postcss-animation --save-dev</strong>
</pre></div><p>If all is well, we should see the plugin install:</p><div><img src="img/BO5194_07_12.jpg" alt="Updating code to use PostCSS"/></div></li><li class="listitem">From the code download that accompanies this book, extract and save a copy of the contents of the <code class="literal">T39</code> folder to our project area—we'll use this as a basis for converting to PostCSS.</li><li class="listitem">Open <code class="literal">style.css</code> <a id="id380" class="indexterm"/>from the <code class="literal">css</code> sub-folder of the tutorial folder, then at the bottom, modify the <code class="literal">.move</code> rule as indicated:<div><pre class="programlisting">.move {
  <strong>animation-name: bounce</strong>;
  transform: translate(17.5rem, 0rem);
  transition-duration: 3.5s;
}</pre></div></li><li class="listitem">Save this file into the <code class="literal">src</code> folder, then fire up a Node.js command prompt and change the working folder to our project area.</li><li class="listitem">At the prompt, enter <code class="literal">gulp</code> then press Enter—if all is well, we should see these files appear in the <code class="literal">dest</code> folder:<div><img src="img/BO5194_07_13.jpg" alt="Updating code to use PostCSS"/></div></li><li class="listitem">The last step is to copy the contents of this folder into the <code class="literal">css</code> folder within the <code class="literal">T39</code> folder.</li></ol></div><p>At this point we're good to test our demo—if we try previewing the results of our work, we should see no change in appearance of our demo, but can be safe in the knowledge that we're now <a id="id381" class="indexterm"/>compiling our code using PostCSS.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec68"/>Testing our altered code</h2></div></div></div><p>Although we may not see <a id="id382" class="indexterm"/>any change in the appearance of our demo, there will clearly be a difference in how it behaves. To view this, we need to take a look under the covers of our demo, at the code.</p><p>For this demo, we added an animation-name property, and assigned it the name <code class="literal">bounce</code>; when compiled, PostCSS adds in the appropriate <code class="literal">@keyframes</code> rules to the code:</p><div><img src="img/BO5194_07_14.jpg" alt="Testing our altered code"/></div><p>So, if we were to take a look at the performance, how does it compare? Even with the extra animation property assigned, it still pulls a respectable frame rate of 48.29FPS, when compared to using <a id="id383" class="indexterm"/>standard <code class="literal">.animate()</code>:</p><div><img src="img/BO5194_07_16.jpg" alt="Testing our altered code"/></div><p>This helps reinforce that where possible, we can improve performance by removing any dependency on using <code class="literal">.animate()</code> in our code. The use of CSS styling to animate content isn't quite ready to replace JavaScript, but it is slowly getting there!</p><p>Okay, onwards we go: we've briefly looked at the various ways to animate content; it's time to make that final transition to using PostCSS. How many times have you seen forms that display the label above, or to the left of, each field? Sure, it gets boring after a while, seeing the same old design! It's easy to change, so there is no excuse for not doing so. To prove this, we're going to use PostCSS to slide each label up when that field has focus. Yes, you heard me right…<em>slide up</em>. Let's take a look at how we can provide a new take on that venerable piece of functionality for any site.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec62"/>Creating a demo in PostCSS</h1></div></div></div><p>As an afterthought to the <a id="id384" class="indexterm"/>previous exercise, I posed the question, "How many times have you seen forms that display labels above, or to the right of, fields?" If I were to collect a dime for each answer, I suspect I would be off on some exotic island, rich, and without a care in the world—I've lost count of the number of times I've seen such forms, let alone anyone else who uses the Internet!</p><p>There is no excuse for plain, boring forms. To prove this, we're going to create a simple demo using the <code class="literal">postcss-transform-shortcut</code> plugin by Jonathan Neal, available from <a class="ulink" href="https://github.com/jonathantneal/postcss-transform-shortcut">https://github.com/jonathantneal/postcss-transform-shortcut</a>. It's a straightforward plugin that allows us to specify single properties, which the plugin combines into a single line of code within our style sheet. Let's quickly install it:</p><div><ol class="orderedlist arabic"><li class="listitem">First, go ahead and fire up a Node.js command prompt session, then change the working folder to our project area.</li><li class="listitem">At the prompt, enter this command, then press Enter:<div><pre class="programlisting"><strong>npm install postcss-transform-shortcut --save-dev</strong>
</pre></div></li><li class="listitem">Node will now install the plugin—it will return back to a flashing prompt when this is complete.</li></ol></div><p>There is no need to configure <a id="id385" class="indexterm"/>it, although there is a small task we have to complete before we can use it.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec69"/>Updating the plugin</h2></div></div></div><p>While researching for this <a id="id386" class="indexterm"/>book, I came across an issue in the current release (1.0.0), whereby style sheets weren't compiling properly if they had multiple rules within; there are occasions when plugins may or may not work for your environment, and this is one of them!</p><p>Thankfully, this is an easy fix—if we take a look within the <code class="literal">postcss-transform-shortcut</code> folder within the <code class="literal">node_modules</code> folder in our project area, we should see this:</p><div><img src="img/BO5194_07_17.jpg" alt="Updating the plugin"/></div><p>Simply copy the contents of the file at <a class="ulink" href="https://raw.githubusercontent.com/pc035860/postcss-transform-shortcut/07af8a78d1fb5e7fdeebc8c7f56c0c9ecdd83efb/index.js">https://raw.githubusercontent.com/pc035860/postcss-transform-shortcut/07af8a78d1fb5e7fdeebc8c7f56c0c9ecdd83efb/index.js</a> and paste straight over the top of <code class="literal">index.js</code>; this should resolve the issue.</p><div><div><h3 class="title"><a id="note37"/>Note</h3><p>This has been logged as an issue in the developer's GitHub site, at <a class="ulink" href="https://github.com/jonathantneal/postcss-transform-shortcut/issues/4">https://github.com/jonathantneal/postcss-transform-shortcut/issues/4</a>, if you would like to see more details about the issue.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec70"/>Building our demo</h2></div></div></div><p>Now that we have our <a id="id387" class="indexterm"/>updated plugin in place, we can get on with building our demo! The next exercise will take the form of a simple credit card form—<em>I don't</em> suggest you use it in a production environment, as it is purely designed to show the animation effects <em>only</em>, and does not have any security attached to the form!</p><p>That aside, here's a screenshot of what we're going to produce, using PostCSS:</p><div><img src="img/BO5194_07_18.jpg" alt="Building our demo"/></div><p>It's a simple demo, based on a codepen created by Michael Arestad, which you can view at <a class="ulink" href="http://codepen.io/MichaelArestad/pen/ohLIa">http://codepen.io/MichaelArestad/pen/ohLIa</a>—I've simplified and reworked the demo to illustrate how we can use PostCSS to compile the code into valid CSS styles.</p><p>Okay, let's make a start with setting up our demo:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll start by extracting a copy of the <code class="literal">T40 – Creating a demo in PostCSS</code> folder from the code download that accompanies this book; save it to our project area.</li><li class="listitem">From within the <a id="id388" class="indexterm"/>folder, move the <code class="literal">package.json</code> and <code class="literal">gulpfile.js</code> files up a level to the root of our project area.</li><li class="listitem">In the <code class="literal">css – completed versions</code> folder, copy <code class="literal">style – pre-compile version.css</code> to the <code class="literal">src</code> folder, and rename as <code class="literal">style.css</code>.</li><li class="listitem">Next, fire up a Node.js command prompt session, then change the working folder to our project area.</li><li class="listitem">At the prompt, enter gulp, then press Enter—PostCSS will go away and compile our code; if all is well, we should see our compiled style sheet files and <code class="literal">source maps</code> appear in the <code class="literal">dest</code> folder.</li><li class="listitem">Copy the contents of the <code class="literal">dest</code> folder to the <code class="literal">css</code> folder within the original <code class="literal">T40 – Creating a demo in PostCSS</code> folder.</li><li class="listitem">Go ahead and preview the results—if all is well, we should see something akin to the screenshot shown at the start of our exercise.</li></ol></div><p>It's a simple demo, but it shows off how we can use animations perfectly—it adds a subtle effect to the label, and doesn't spoil the overall use of our form. The use of the plugin does raise a couple of useful points, so let's take a moment to explore what we've just created in more detail.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec71"/>Dissecting our demo in more detail</h2></div></div></div><p>The key to a successful <a id="id389" class="indexterm"/>plugin in PostCSS is one that follows the <em>1:1</em> principle—one plugin for one task. The <code class="literal">postcss-transform-shortcut</code> plugin is no exception: it takes the various elements that make up a transition rule, and puts them together in the right order. To see what we mean, take a look at these lines from within our style sheet before it is compiled:</p><div><img src="img/BO5194_07_19.jpg" alt="Dissecting our demo in more detail"/></div><p>Where's our <code class="literal">transform:</code> statement? Well, when using this plugin, it's not needed—instead, we can simply specify the <a id="id390" class="indexterm"/>various attributes, thus:</p><div><pre class="programlisting">.transform {
  transform: skewX(25deg);
  rotate: 180deg;
  scale: 2 2;
  translate: 10px 10px;
}</pre></div><p>The plugin is set to recognize these four attributes and compile them into one single rule, as shown in this code excerpt:</p><div><pre class="programlisting">.transform {
  transform: skewX(25deg) rotate3d(180deg,0,1) scale3d(2,2,1) translate3d(10px,10px,0px);
}</pre></div><p>Any gaps in the attributes will be automatically filled in with default values from within the plugin. We can even use this plugin as the basis for an equivalent for transitions—we will do this toward the end of the next chapter.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec63"/>Optimizing our animations</h1></div></div></div><p>When working with <a id="id391" class="indexterm"/>animations, there may be occasions when we need to use custom effects; one way to achieve this is through the use of <code class="literal">@keyframes</code>. Trouble is, some browsers don't support their use within media queries (yes, I'm looking at you, <code class="literal">IE10</code> and <code class="literal">IE11</code>!).</p><p>How does this affect us, I hear you ask? Well, if you're building any responsive sites, then this is absolutely something we need to bear in mind; media queries form the basic structure for any responsive functionality.</p><p>It's an easy fix though—the developer, Andy Walpole, has created a simple PostCSS plugin called <code class="literal">mq-keyframes</code>, which is available at <a class="ulink" href="https://github.com/TCotton/postcss-mq-keyframes">https://github.com/TCotton/postcss-mq-keyframes</a>.</p><p>Imagine we have code <a id="id392" class="indexterm"/>such as this in our style sheet:</p><div><pre class="programlisting">@media only screen and (min-width: 375px) {
  .custom-bounce {
    animation: side-bounce 5s;
  }

  @keyframes side-bounce {
    100% {
      opacity: 0;
    }
  }
}</pre></div><p>All the plugin does is move the code to the bottom of our style sheets, which makes it easier to read, and allows IE to continue working correctly:</p><div><pre class="programlisting">@media only screen and (min-width: 375px) {
  .pace {
    animation: pace-anim 5s;
  }
}

@keyframes pace-anim {
  100% {
    opacity: 0;
  }
}</pre></div><p>This is probably one of the simplest plugins to use in PostCSS, particularly where animating content is concerned; it's worth using if you have to support these versions of Internet Explorer! The plugin can be installed in the same way as most other plugins for PostCSS, and does not require any additional attributes as part of the configuration process.</p><div><div><h3 class="title"><a id="note38"/>Note</h3><p>As a challenge, how about trying out the demo available at <a class="ulink" href="http://urbaninfluence.com/2015/05/make-a-background-image-slider-with-css-keyframes/">http://urbaninfluence.com/2015/05/make-a-background-image-slider-with-css-keyframes/</a>?</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec64"/>Using our own animation plugin</h1></div></div></div><p>Throughout <a id="id393" class="indexterm"/>the course of this chapter, we've used the small number of animation-based plugins that are available for PostCSS, and demonstrated some of the effects possible. This is all well and good, but one can't help but feel that this is a little limiting—and can we do something about it?</p><p>Absolutely, the beauty of PostCSS is that if there is a need for a plugin, then we can create something to fill that gap. A perfect example of this is the lack of CSS-based animation plugins available; at present, all we have is <code class="literal">postcss-animations</code>, which inserts animations from the <code class="literal">Animate.css</code> style sheet created by Dan Eden. I've used this as a basis for a new plugin—we'll use the same framework, but convert it to use the Magic set of animations, available from <a class="ulink" href="http://www.minimamente.com/example/magic_animations/">http://www.minimamente.com/example/magic_animations/</a>.</p><p>We will cover the construction of plugins in more detail in <a class="link" href="ch08.html" title="Chapter 8. Creating PostCSS Plugins">Chapter 8</a>, <em>Creating PostCSS Plugins</em>. Let's make a start:</p><div><ol class="orderedlist arabic"><li class="listitem">From the code download that accompanies this book, go ahead and extract a copy of the <code class="literal">T41</code> folder, and save the contents to the root of our project area.</li><li class="listitem">Copy the <code class="literal">postcss-animation</code> and <code class="literal">postcss-animation-data</code> folders to the <code class="literal">node_modules</code> folder within our project area.</li><li class="listitem">Copy the <code class="literal">gulpfile.js</code> and <code class="literal">package.json</code> files to the root of our project area—if any are already present, replace them (or take copies for safekeeping).</li><li class="listitem">Crack open your text editor and add the following code, saving it as <code class="literal">style.css</code> in the <code class="literal">src</code> folder of our project area:<div><pre class="programlisting">.foo {
  animation-name: openDownLeft;
}</pre></div></li><li class="listitem">Fire up a Node.js folder, then change the working folder to our project area.</li><li class="listitem">At the prompt, enter <code class="literal">gulp</code>, then press Enter—PostCSS will go away and compile the code; if all is well, we should see the <code class="literal">@keyframes</code> code added to our compiled style sheet (in the <code class="literal">dest</code> folder), as shown in this screenshot:<div><img src="img/BO5194_07_20.jpg" alt="Using our own animation plugin"/></div></li></ol></div><p>Although our <a id="id394" class="indexterm"/>example only shows the single style, this doesn't matter—any style sheet that uses animation-name can be used, provided the animation-name value used matches one in the <code class="literal">postcss-animation-data</code> plugin. There are a few key points, though, that we should cover, so let's take a moment to explore these in more detail.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec72"/>Exploring the plugin in more detail</h2></div></div></div><p>Our new plugin is a <a id="id395" class="indexterm"/>perfect example of how we can adapt an existing framework to use different values—there are a few key points we should note when using this plugin:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A key point to consider when constructing any plugin: don't worry about adding vendor prefixes. These should be added as part of the compilation stage when the plugin is used within your projects; this will take care of any vendor prefixes that are required.</li><li class="listitem" style="list-style-type: disc">At present, the plugin only lists two animation types from the Magic Animations library as examples—the full list of original animations is available from the Magic Animations GitHub repository at <a class="ulink" href="https://github.com/miniMAC/magic/blob/master/magic.css">https://github.com/miniMAC/magic/blob/master/magic.css</a>. We can easily add in any that we need, using the format of <code class="literal">"&lt;name of animation&gt;" : "&lt;keyframe to use&gt;"</code>, as shown in this screenshot:<div><img src="img/BO5194_07_21.jpg" alt="Exploring the plugin in more detail"/></div><p>As an experiment, how about trying to convert the animations from the Motion UI library at <a class="ulink" href="http://zurb.com/playground/motion-ui">http://zurb.com/playground/motion-ui</a>, for example? Or we can try the animations for AngularJS at <a class="ulink" href="http://www.justinaguilar.com/animations/#">http://www.justinaguilar.com/animations/#</a> - it's entirely up to you!</p></li><li class="listitem" style="list-style-type: disc">Alternatively, it's <a id="id396" class="indexterm"/>worth applying the same principles to the <code class="literal">postcss-easings</code> plugin available from <a class="ulink" href="https://github.com/postcss/postcss-easings">https://github.com/postcss/postcss-easings</a>; this has some well-known easings built in, but they can easily be replaced. A great tool for this purpose is the site at <a class="ulink" href="http://www.cubic-bezier.com">http://www.cubic-bezier.com</a>. For example, if we take the <code class="literal">easeInExpo</code> easing, we create a Bezier curve that looks something like this:<div><img src="img/BO5194_07_22.jpg" alt="Exploring the plugin in more detail"/></div></li></ul></div><div><div><h3 class="title"><a id="note39"/>Note</h3><p>This translates to a value of <code class="literal">cubic-bezier(.95,.05,.79,.35)</code>, which we can use in our code. It's worth noting that some sites will show this easing as <code class="literal">(0.05, 0.795, 0.035)</code>—<a class="ulink" href="http://cubic-bezier.com/">http://cubic-bezier.com/</a> only shows values to two decimal places.</p></div></div><p>There are plenty of ways we can extend, modify, or create new plugins—the key to any should be that they are kept simple, limited to one task only, and that where possible, you should use the PostCSS plugin boilerplate as the basis for creating the plugins. The plugin we used in this exercise was created manually—this isn't an issue if you are creating it for your own needs, and don't intend to publish the plugin. In the next chapter, we will explore how easy it is to create <a id="id397" class="indexterm"/>something using the boilerplate code—it avoids a lot of issues at a later date!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec65"/>Summary</h1></div></div></div><p>Animating content is an almost de facto part of building modern sites – this can be something as simple as providing subtle effects on form labels, right through to providing a complex background slider. We've covered a lot of useful tips and tricks throughout this chapter, so let's take a moment to review what we've learned.</p><p>The theme for this chapter has been about making the transition (sorry, pun intended!) from using vanilla CSS or SASS to PostCSS; we kicked off with a quick recap of the types of animation available.</p><p>This was swiftly followed by a look at some of the methods available for starting to make the transition away from standard CSS, such as using prebuilt animation libraries, or using CSS3 transitions. We then switched to covering how similar animations would look within SASS, so we can compare use of libraries such as <code class="literal">Animate.css</code>, before starting the switch to using PostCSS.</p><p>We started this part of the journey by exploring the various plugins available, before converting our code to use PostCSS equivalent styles. We then took things up a step, by creating a simple demo using PostCSS, before rounding out the chapter with a look at a simple animation plugin created for PostCSS, which is based on the Magic Animation set of animations.</p><p>Phew - we've certainly covered a lot! But our journey doesn't stop there. In the next chapter, we'll explore some of the tips and tricks we can use to create plugins within PostCSS. No longer are we limited to what is available from others; we can now begin to create our own plugins instead...</p></div></body></html>