<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Using the Contacts and Camera APIs"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Using the Contacts and Camera APIs</h1></div></div></div><p>
<span class="emphasis"><em>In the last chapter, we saw how to get the best out of the Files and Storage plugins. Now that your knowledge of PhoneGap is coming together well, it's time to add some interaction to the device itself. The main goal of this chapter is to help you to understand the usage of the Contacts API of PhoneGap and to interact with the device media using the Camera and Media Capture API.</em></span>
</p><p>In this chapter, you will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Get an overview of the PhoneGap Contacts API and its objects and properties</li><li class="listitem" style="list-style-type: disc">Learn how to use the Contacts API to read and filter the contacts stored on the device</li><li class="listitem" style="list-style-type: disc">Understand the difference between the Camera and Capture API</li><li class="listitem" style="list-style-type: disc">Learn how to capture images from the device camera using the Camera API</li><li class="listitem" style="list-style-type: disc">Learn how to handle various media types such as images, audio, and video using the Media Capture API</li></ul></div><div class="section" title="The Contacts API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec53"/>The Contacts API</h1></div></div></div><p>You can easily access the contact information stored on a device using the PhoneGap API. The <a id="id392" class="indexterm"/>Contacts API is an implementation of the W3C's Pick Contacts Intent API (an intent that enables access to a user's address book service from inside a web application). You can read more about the<a id="id393" class="indexterm"/> W3C specifications at <a class="ulink" href="http://www.w3.org/TR/contacts-api/">http://www.w3.org/TR/contacts-api/</a>.</p><p>The required functionalities of the Contacts API are provided by the Contacts plugin identified by the name <code class="literal">cordova-plugin-contacts</code>. This plugin supports major platforms. </p><p>For a complete list of all the <a id="id394" class="indexterm"/>supported platforms, refer to the documentation at <a class="ulink" href="http://docs.phonegap.com/en/edge/cordova_contacts_contacts.md.html#Contacts">http://docs.phonegap.com/en/edge/cordova_contacts_contacts.md.html#Contacts</a>.</p><p>In order to start the interaction with the device contacts, you can use the <code class="literal">create</code> or <code class="literal">find</code> methods defined in the <code class="literal">contacts</code> object stored in the <code class="literal">navigator</code> object:</p><div class="informalexample"><pre class="programlisting">var contact = navigator.contacts.<span class="strong"><strong>create</strong></span>(properties);
navigator.contacts.<span class="strong"><strong>find</strong></span>(contactFields, contactSuccess, contactError, contactFindOptions);</pre></div><p>In order to understand how these methods work in a better way, let's explore the most relevant objects that are involved with them: <code class="literal">Contact</code>, <code class="literal">ContactName</code>, <code class="literal">ContactField</code>, <code class="literal">ContactFindOptions</code>, and <code class="literal">ContactError</code>.</p><div class="section" title="The ContactName object"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>The ContactName object</h2></div></div></div><p>The <code class="literal">ContactName</code> object is <a id="id395" class="indexterm"/>used in the PhoneGap framework in order to store all the details of a contact name. The object is stored in the <code class="literal">name</code> property of the <code class="literal">Contact</code> object.</p><p>The properties <a id="id396" class="indexterm"/>of the <code class="literal">ContactName</code> object are all strings and are self-explanatory:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">formatted</code>: This<a id="id397" class="indexterm"/> represents the complete name of the contact</li><li class="listitem" style="list-style-type: disc"><code class="literal">familyName</code>: This <a id="id398" class="indexterm"/>represents the contact's last name</li><li class="listitem" style="list-style-type: disc"><code class="literal">givenName</code>: This <a id="id399" class="indexterm"/>represents the contact's first name</li><li class="listitem" style="list-style-type: disc"><code class="literal">middleName</code>: This <a id="id400" class="indexterm"/>represents the contact's middle name</li><li class="listitem" style="list-style-type: disc"><code class="literal">honorificPrefix</code>: This<a id="id401" class="indexterm"/> represents the contact's prefix (for example, Mr. or Dr.)</li><li class="listitem" style="list-style-type: disc"><code class="literal">honorificSuffix</code>: This<a id="id402" class="indexterm"/> represents the contact's suffix (for example, Esq.)</li></ul></div></div><div class="section" title="The ContactField object"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec53"/>The ContactField object</h2></div></div></div><p>The <code class="literal">ContactField</code> object <a id="id403" class="indexterm"/>is a generic object used in the PhoneGap framework in order to represent a field of the <code class="literal">Contact</code> object. The generic nature of this object makes it reusable across several fields.</p><p>The properties <a id="id404" class="indexterm"/>of the <code class="literal">ContactField</code> object are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is a<a id="id405" class="indexterm"/> string that represents the type of field; possible values are home, work, mobile, and so on</li><li class="listitem" style="list-style-type: disc"><code class="literal">value</code>: This is a <a id="id406" class="indexterm"/>string representing the value of the field such as a phone number or an e-mail address</li><li class="listitem" style="list-style-type: disc"><code class="literal">pref</code>: This is<a id="id407" class="indexterm"/> a Boolean value that indicates whether the user preferred value is returned in a specific field.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>When the <code class="literal">ContactField</code> object is used in the <code class="literal">photos</code> property of the <code class="literal">Contact</code> object, the <code class="literal">type</code> property represents the type of a returned image (for example, a URL or Base64-encoded string).</p></div></div></li></ul></div></div><div class="section" title="The ContactAddress object"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec54"/>The ContactAddress object</h2></div></div></div><p>The<a id="id408" class="indexterm"/> <code class="literal">ContactAddress</code> object is the object stored in the <code class="literal">addresses</code> property of the <code class="literal">Contact</code> object. The<a id="id409" class="indexterm"/> <code class="literal">addresses</code> property is an array where multiple addresses can be associated with each contact.</p><p>The properties of the <code class="literal">ContactAddress</code> object are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pref</code>: This is a <a id="id410" class="indexterm"/>Boolean value that indicates whether the returned <code class="literal">ContactAddress</code> object is the preferred value of the user for the <code class="literal">ContactAddress</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is a <a id="id411" class="indexterm"/>string that indicates what type of address is stored in the <code class="literal">ContactAddress</code> object (for example, home and office)</li><li class="listitem" style="list-style-type: disc"><code class="literal">formatted</code>: This<a id="id412" class="indexterm"/> is a string that represents the complete address that is formatted for display</li><li class="listitem" style="list-style-type: disc"><code class="literal">streetAddress</code>: This<a id="id413" class="indexterm"/> is a string that represents the complete street address</li><li class="listitem" style="list-style-type: disc"><code class="literal">locality</code>: This <a id="id414" class="indexterm"/>is a string that represents the city or locality that is part of the <code class="literal">ContactAddress</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">region</code>: This is a <a id="id415" class="indexterm"/>string that represents the state or region that is part of the <code class="literal">ContactAddress</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">postalCode</code>: This is a<a id="id416" class="indexterm"/> string that represents the zip code or postal code associated with the locality stored in the <code class="literal">ContactAddress</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">country</code>: This is<a id="id417" class="indexterm"/> a string that represents the <a id="id418" class="indexterm"/>name of the country stored <a id="id419" class="indexterm"/>in the <code class="literal">ContactAddress</code> object<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>There is a limitation in Android 2.x (that is, the <code class="literal">pref</code> property is not supported) and several limitations on Android 1.x. Also, iOS does not support the <code class="literal">formatted</code> property. Always refer to the online documentation to verify the status of the support for the <code class="literal">ContactAddress</code> object.</p></div></div></li></ul></div></div><div class="section" title="The ContactOrganization object"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec55"/>The ContactOrganization object</h2></div></div></div><p>The <code class="literal">ContactOrganization</code> object <a id="id420" class="indexterm"/>represents all the details of a company, organization, and so on, that the stored contact belongs to. The object is stored in the array contained in the <code class="literal">organizations</code> property of the <code class="literal">Contact</code> object.</p><p>The properties of <a id="id421" class="indexterm"/>the <code class="literal">ContactOrganization</code> object are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pref</code>: This is a <a id="id422" class="indexterm"/>Boolean value that indicates whether the returned <code class="literal">ContactOrganization</code> object is the preferred value of the user for the <code class="literal">ContactOrganization</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is <a id="id423" class="indexterm"/>a string that indicates what type of address is stored in the <code class="literal">ContactOrganization</code> object (for example, work and other)</li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: This is a<a id="id424" class="indexterm"/> string that represents the name of the organization stored in the <code class="literal">ContactOrganization</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">department</code>: This is a <a id="id425" class="indexterm"/>string that represents the department of the organization who the contact works for</li><li class="listitem" style="list-style-type: disc"><code class="literal">title</code>: This is a <a id="id426" class="indexterm"/>string that represents the contact's title in the organization</li></ul></div><p>The <code class="literal">name</code>, <code class="literal">department</code>, <a id="id427" class="indexterm"/>and <code class="literal">title</code> properties are partially supported<a id="id428" class="indexterm"/> on iOS; the <code class="literal">pref</code> and <code class="literal">type</code> properties are badly supported on Android 1.x and Android 2.x.</p></div><div class="section" title="The Contact object"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec56"/>The Contact object</h2></div></div></div><p>The <code class="literal">Contact</code> object represents<a id="id429" class="indexterm"/> all the details of a contact stored in the device database. A <code class="literal">Contact</code> object can be saved, removed, and copied from the device contact database using the <code class="literal">save</code>, <code class="literal">remove</code>, and <code class="literal">clone</code> methods defined on the object itself. The <code class="literal">save</code> and <code class="literal">remove</code> methods accept two arguments in order to handle the success and failure of the save or remove operation:</p><div class="informalexample"><pre class="programlisting">var contact = navigator.contacts.create({‘displayName': ‘Giorgio'});

contact.save(onContactSaved, onContactSavedError);
contact.remove(onContactRemoved, onContactRemovedError);</pre></div><p>The error handlers receive the same <code class="literal">ContactError</code> object as an argument; the success handlers receive the saved contact or a snapshot of the current database when a contact is successfully removed.</p><p>The <code class="literal">ContactError</code> object contains the information about the occurred error in the <code class="literal">code</code> property. The values that can be returned are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.UNKNOWN_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.INVALID_ARGUMENT_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.TIMEOUT_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.PENDING_OPERATION_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.IO_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.NOT_SUPPORTED_ERROR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">ContactError.PERMISSION_DENIED_ERROR</code></li></ul></div><p>When creating a new <code class="literal">Contact</code> object, you can define the contact properties or pass them as an object one by one when calling the <code class="literal">create</code> method. The properties of the <code class="literal">Contact</code> object<a id="id430" class="indexterm"/> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">id</code>: This is <a id="id431" class="indexterm"/>a string used as a globally unique identifier</li><li class="listitem" style="list-style-type: disc"><code class="literal">displayName</code>: This is <a id="id432" class="indexterm"/>a string that represents the name of the <code class="literal">Contact</code> object for display to the end users</li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: This is<a id="id433" class="indexterm"/> an object containing all the information of a contact name; the object used to store this information is <code class="literal">ContactName</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">nickname</code>: This is <a id="id434" class="indexterm"/>a string that represents the casual name of a contact</li><li class="listitem" style="list-style-type: disc"><code class="literal">phoneNumbers</code>: This<a id="id435" class="indexterm"/> is an array of all the contact's phone numbers; the array items are instances of the <code class="literal">ContactField</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">emails</code>: This is an <a id="id436" class="indexterm"/>array of all the contact's e-mail<a id="id437" class="indexterm"/> addresses; the array items are instances of the <code class="literal">ContactField</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">addresses</code>: This is an<a id="id438" class="indexterm"/> array of all the contact's <a id="id439" class="indexterm"/>addresses; the array items are instances of the <code class="literal">ContactAddresses</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">ims</code>: This is <a id="id440" class="indexterm"/>an array of all the contact's instant messages accounts; the array items are instances of the <code class="literal">ContactField</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">organizations</code>: This is <a id="id441" class="indexterm"/>an array of all the organizations the contact belongs to; the array items are instances of the <code class="literal">ContactOrganization</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">birthday</code>: This<a id="id442" class="indexterm"/> is a <code class="literal">Date</code> object that represents the birthday of the contact</li><li class="listitem" style="list-style-type: disc"><code class="literal">note</code>: This is <a id="id443" class="indexterm"/>a string that represents a note about the contact</li><li class="listitem" style="list-style-type: disc"><code class="literal">photos</code>: This is an<a id="id444" class="indexterm"/> array of all the contact's photos; the array items are instances of the <code class="literal">ContactField</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">categories</code>: This is an<a id="id445" class="indexterm"/> array of all the contact's defined categories; the array items are instances of the <code class="literal">ContactField</code> object</li><li class="listitem" style="list-style-type: disc"><code class="literal">urls</code>: This is <a id="id446" class="indexterm"/>an array of all the web pages associated with the contact; the array items<a id="id447" class="indexterm"/> are instances of the <code class="literal">ContactField</code> object</li></ul></div><p>The <code class="literal">Contact</code> object's properties are not fully supported across all platforms. In fact, operating system fragmentation makes it difficult to handle this information consistently.</p><p>For instance, the <code class="literal">name</code>, <code class="literal">nickname</code>, <code class="literal">birthday</code>, <code class="literal">photos</code>, <code class="literal">categories</code>, and <code class="literal">urls</code> properties are not supported on Android 1.x. Likewise, the <code class="literal">categories</code> property is supported neither on Android 2.x. nor iOS.</p><p>On iOS, the items returned in the <code class="literal">photos</code> array contain a URL that points to the app's temporary folder. This means that this content is deleted when the app exits and that you have to handle it if you want the user to find the app in the same status he/she left. The <code class="literal">displayName</code> property is not supported on iOS and will be returned as null, unless there is <code class="literal">ContactName</code> defined. If the <code class="literal">ContactName</code> object is defined, then a composite name or nickname is returned.</p></div><div class="section" title="Filtering contact data"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec57"/>Filtering contact data</h2></div></div></div><p>We have already<a id="id448" class="indexterm"/> mentioned the <code class="literal">find</code> method available in the <code class="literal">navigator.contacts</code> object. Using this method, an app can find one or multiple contacts in the device's contact database. The <code class="literal">find</code> method accepts four arguments. The first one is an array that contains the name of the fields of the <code class="literal">Contact</code> object that have to be returned. The second and third are the success and error handlers. The last one represents the filtering options that you may wish to apply to the current search.</p><p>In order to apply a filter to the current search, you can instantiate a new <code class="literal">ContactFindOptions</code> object and populate the <code class="literal">filter</code> and <code class="literal">multiple</code> properties. The <code class="literal">filter</code> property is a case-insensitive string that will act as a filter on the fields of the <code class="literal">Contact</code> objects returned by the <code class="literal">find</code> method. The <code class="literal">multiple</code> property is <code class="literal">false</code> by default and is the one to use in order to receive multiple <code class="literal">Contact</code> objects in the success handler. Try out the following example to understand how these properties work.</p></div></div></div>
<div class="section" title="Time for action &#x2013; searching device contacts"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec54"/>Time for action – searching device contacts</h1></div></div></div><p>We will now see an example of<a id="id449" class="indexterm"/> getting all the contacts from the device and listing them down:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new project using the PhoneGap CLI:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ phonegap create ContactsApi</strong></span>
</pre></div></li><li class="listitem">Change the current working directory to the directory that is newly created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ContactsApi</strong></span>
</pre></div></li><li class="listitem">Add the required platforms to the project. We will add Android for this example:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ phonegap platform add android</strong></span>
</pre></div></li><li class="listitem">Install the Contacts plugin to the project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ phonegap plugin add cordova-plugin-contacts</strong></span>
</pre></div></li><li class="listitem">In the <code class="literal">www/index.html</code> file, you need to replace the content and add the following code. To start with, let's create an event listener and bind that to a function. In the following code, when the device is ready, the <code class="literal">OnDeviceReady</code> method will be fired:<div class="informalexample"><pre class="programlisting">&lt;script type=”text/javascript” charset=”utf-8”&gt;
    document.addEventListener(“deviceready”, onDeviceReady, false);
&lt;/script&gt;</pre></div></li><li class="listitem">Now, let's add the content for the <code class="literal">OnDeviceReady</code> method:<div class="informalexample"><pre class="programlisting">function onDeviceReady() {
    var options = new ContactFindOptions();
    options.filter = “”;
    options.multiple=true;
    var fields = [“displayName”, “name”, “addresses”];
    navigator.contacts.find(fields, onSuccess, onError, options);
}</pre></div><p>With the <a id="id450" class="indexterm"/>preceding code, you are creating a new <code class="literal">ContactFindOptions</code> object and setting filters/properties to the object. Based on the filter that you set, the function will return all the matching contacts. In this example, we have given an empty filter, which means we get back all the contacts from the device.</p><p>If you want to limit the search only to a particular name, you can provide the filter as shown here:</p><div class="informalexample"><pre class="programlisting">options.filter = “John”;</pre></div><p>You can also restrict the list of fields that the function is going to return. If you feel that it's enough to have only a few fields for output, you can mention them in the list of fields. For example, we have restricted the output to only the display name, <code class="literal">name</code> object, and address of the contacts.</p></li><li class="listitem">When the function is executed successfully, it will return the values to the <code class="literal">OnSuccess</code> event and will trigger the <code class="literal">OnError</code> event when there are some issues. So let's define the <code class="literal">OnSuccess</code> and <code class="literal">OnError</code> events to define what we are going to do with the output:<div class="informalexample"><pre class="programlisting">function onSuccess(contacts) {
    for (var i = 0; i &lt; contacts.length; i++) {
        console.log(“Display Name = “ + contacts[i].displayName);
    }
};

function onError(contactError) {
    alert(‘onError!');
};</pre></div></li><li class="listitem">When we have acquired all of the contacts, we loop through the <code class="literal">contacts</code> object and display the name of the contact in the console.</li></ol></div><p>The following complete code has been given for your reference. When you test the code in an actual device, you can see the contact names in the console:</p><div class="informalexample"><pre class="programlisting">&lt;script type=”text/javascript” charset=”utf-8”&gt;
document.addEventListener(“deviceready”, onDeviceReady, false);

function onDeviceReady() {
    var options = new ContactFindOptions();
    options.filter = “”;
    options.multiple=true;
    var fields = [“displayName”, “name”, “addresses”];
    navigator.contacts.find(fields, onSuccess, onError, options);
}

function onSuccess(contacts) {
    for (var i = 0; i &lt; contacts.length; i++) {
        console.log(“Display Name = “ + contacts[i].displayName);
    }
};

function onError(contactError) {
    alert(‘onError!');
};
&lt;/script&gt;</pre></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec58"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>You filtered the <a id="id451" class="indexterm"/>contact database based on the options defined by the <code class="literal">ContactFindOptions</code> object and you refined the result using the API provided by the PhoneGap framework.</p></div></div>
<div class="section" title="Time for action &#x2013; adding a new contact"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec55"/>Time for action – adding a new contact</h1></div></div></div><p>We will directly go to the<a id="id452" class="indexterm"/> example of creating a new contact entry using the Contacts API. The code for this is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;script type=”text/javascript” charset=”utf-8”&gt;
    // Binding to the events
    document.addEventListener(“deviceready”, onDeviceReady, false);

    // device APIs are ready and available to use
    function onDeviceReady() {
        var myContact = navigator.contacts.create({“displayName”: “Purus Test”});

        var phoneNumbers = [];

        phoneNumbers[0] = new ContactField(‘work', ‘1234567890', false);
        phoneNumbers[1] = new ContactField(‘mobile', ‘2345678901', true); // preferred
        phoneNumbers[2] = new ContactField(‘home', ‘3456789012', false);

        // You can add any other values of Contact object with name and phone numbers
        myContact.phoneNumbers = phoneNumbers;

        myContact.save(onSaveContactSuccess,onSaveContactError);

    }

    function onSaveContactSuccess(contact) {
        alert(‘saved successfully');
    };

    function onSaveContactError(error) {
        alert(error.code);
    };

&lt;/script&gt;</pre></div><p>The last parameter<a id="id453" class="indexterm"/> of <code class="literal">ContactField</code> expects a Boolean value to denote whether the field is a preferred one. In the preceding example, the second phone number with the value of <code class="literal">true</code> is set as the preferred number.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec59"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have seen how we can create a new <code class="literal">Contact</code> object and save this to the device using the Contacts API.</p></div></div>
<div class="section" title="Camera API or Capture API?"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec56"/>Camera API or Capture API?</h1></div></div></div><p>The PhoneGap framework implements two different APIs to access media on a device: the Camera API <a id="id454" class="indexterm"/>and the<a id="id455" class="indexterm"/> Capture API. The main difference between these APIs is that the Camera API can access only the default device camera application, whereas the Capture API can also record audio or video using the default audio and video recording application. Another important difference is that the Capture API allows multiple captures with a single API call.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>The Capture API is an implementation of an abandoned W3C standards draft. As you can see, there are several similarities between the draft and the actual PhoneGap implementation.</p></div></div></div>
<div class="section" title="Accessing the camera using the Camera API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec57"/>Accessing the camera using the Camera API</h1></div></div></div><p>The Camera API<a id="id456" class="indexterm"/> provides access to the device's camera <a id="id457" class="indexterm"/>application using the Camera plugin identified by the <code class="literal">cordova-plugin-camera</code> key. With this plugin installed, an app can take a picture or gain access to a media file stored in the photo library and albums that the user created on the device. The Camera API exposes the following two methods defined in the <code class="literal">navigator.camera</code> object:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">getPicture</code>: This <a id="id458" class="indexterm"/>opens the default camera application or allows the user to browse the media library, depending on the options specified in the <code class="literal">configuration</code> object that the method accepts as an argument</li><li class="listitem" style="list-style-type: disc"><code class="literal">cleanup</code>: This <a id="id459" class="indexterm"/>cleans up any intermediate photo file available in the temporary storage location (supported only on iOS)</li></ul></div><p>As arguments, the <code class="literal">getPicture</code> method accepts a success handler, failure handler, and optionally an object used to specify several camera options through its properties as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">quality</code>: This is a<a id="id460" class="indexterm"/> number between <code class="literal">0</code> and <code class="literal">100</code> used to specify the quality of the saved image.</li><li class="listitem" style="list-style-type: disc"><code class="literal">destinationType</code>: This is a <a id="id461" class="indexterm"/>number used to define the format of the value returned in the success handler. The possible values are stored in the following <code class="literal">Camera.DestinationType</code> pseudo constants:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">DATA_URL(0)</code>: This indicates that the <code class="literal">getPicture</code> method will return the image as a Base64-encoded string</li><li class="listitem" style="list-style-type: disc"><code class="literal">FILE_URI(1)</code>: This indicates that the method will return the file URI</li><li class="listitem" style="list-style-type: disc"><code class="literal">NATIVE_URI(2)</code>: This indicates that the method will return a platform-dependent file URI (for example, <code class="literal">assets-library://</code> on iOS or <code class="literal">content://</code> on Android)</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">sourceType</code>: This is a<a id="id462" class="indexterm"/> number used to specify where the <code class="literal">getPicture</code> method can access an image. The following possible values are stored in the <code class="literal">Camera.PictureSourceType</code> pseudo constants: <code class="literal">PHOTOLIBRARY (0)</code>, <code class="literal">CAMERA (1)</code>, and <code class="literal">SAVEDPHOTOALBUM (2)</code>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PHOTOLIBRARY</code>: This indicates that the method will get an image from the device's library</li><li class="listitem" style="list-style-type: disc"><code class="literal">CAMERA</code>: This indicates that the method will grab a picture from the camera</li><li class="listitem" style="list-style-type: disc"><code class="literal">SAVEDPHOTOALBUM</code>: This indicates that the user will be prompted to select an album before picking an image</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">allowEdit</code>: This <a id="id463" class="indexterm"/>is a Boolean value (the value is <code class="literal">true</code> by default) used to indicate that the user can make small edits to the image before confirming the selection; it works only in iOS.</li><li class="listitem" style="list-style-type: disc"><code class="literal">encodingType</code>: This is<a id="id464" class="indexterm"/> a number used to specify the encoding of the returned file. The possible values are stored in the <code class="literal">Camera.EncodingType</code> pseudo constants: <code class="literal">JPEG (0)</code> and <code class="literal">PNG (1)</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">targetWidth</code> and <code class="literal">targetHeight</code>: These are the width and height in pixels, to which you <a id="id465" class="indexterm"/>want the captured image to be<a id="id466" class="indexterm"/> scaled; it's possible to specify only one of the two options. When both are specified, the image will be scaled to the value that results in the smallest aspect ratio (the aspect ratio of an image describes the proportional relationship between its width and height).</li><li class="listitem" style="list-style-type: disc"><code class="literal">mediaType</code>: This is a<a id="id467" class="indexterm"/> number used to specify what kind of media files have to be returned when the <code class="literal">getPicture</code> method is called using the <code class="literal">Camera.PictureSourceType.PHOTOLIBRARY</code> or <code class="literal">Camera.PictureSourceType.SAVEDPHOTOALBUM</code> pseudo constants as <code class="literal">sourceType</code>; the possible values are stored in the <code class="literal">Camera.MediaType</code> object as pseudo constants and are <code class="literal">PICTURE (0)</code>, <code class="literal">VIDEO (1)</code>, and <code class="literal">ALLMEDIA (2)</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">correctOrientation</code>: This <a id="id468" class="indexterm"/>is a Boolean value that forces the device camera to correct the device orientation during the capture.</li><li class="listitem" style="list-style-type: disc"><code class="literal">cameraDirection</code>: This is <a id="id469" class="indexterm"/>a number used to specify which device camera has to be used during the capture. The values are stored in the <code class="literal">Camera.Direction</code> object as pseudo constants and are <code class="literal">BACK (0)</code> and <code class="literal">FRONT (1)</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">popoverOptions</code>: This is<a id="id470" class="indexterm"/> an object supported on iOS to specify the anchor element location and arrow direction of the popover used on iPad when selecting images from the library or album.</li><li class="listitem" style="list-style-type: disc"><code class="literal">saveToPhotoAlbum</code>: This is <a id="id471" class="indexterm"/>a Boolean value (the value is <code class="literal">false</code> by default) used in order to save the captured image in the device's default photo album.</li></ul></div><p>The<a id="id472" class="indexterm"/> success handler receives an argument that contains the <a id="id473" class="indexterm"/>URI to the file or data stored in the file's Base64-encoded string, depending on the value stored in the <code class="literal">encodingType</code> property of the <code class="literal">options</code> object. The failure handler receives a string containing the device's native code error message as an argument.</p><p>Similarly, the <code class="literal">cleanup</code> method accepts a success handler and a failure handler. The only difference between the two is that the success handler doesn't receive any argument. The <code class="literal">cleanup</code> method is supported only on iOS and can be used when the <code class="literal">sourceType</code> property value is <code class="literal">Camera.PictureSourceType.CAMERA</code> and the <code class="literal">destinationType</code> property value is <code class="literal">Camera.DestinationType.FILE_URI</code>.</p><p>In order to put into practice what you have learned about the Camera API, let's create an app that can take a picture from the device's default camera application.</p></div>
<div class="section" title="Time for action &#x2013; accessing the device camera"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec58"/>Time for action – accessing the device camera</h1></div></div></div><p>Get ready to access the <a id="id474" class="indexterm"/>device's camera and show the user the captured picture. Refer <a id="id475" class="indexterm"/>to the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the command-line tool and create a new PhoneGap project named <code class="literal">camera</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova create camera</strong></span>
</pre></div></li><li class="listitem">Change to the directory that is created:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd camera</strong></span>
</pre></div></li><li class="listitem">Using the command-line tool, add the Android and iOS platforms to the project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova platforms add android</strong></span>
<span class="strong"><strong>$ cordova platforms add ios</strong></span>
</pre></div></li><li class="listitem">Add the Camera API plugin using the following command line:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova plugin add cordova-plugin-camera</strong></span>
</pre></div></li><li class="listitem">Go to the <code class="literal">www</code> folder, open the <code class="literal">index.html</code> file, and replace the contents with the following <a id="id476" class="indexterm"/>code; this code is self-<a id="id477" class="indexterm"/>explanatory:<div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;script type=”text/javascript” charset=”utf-8” src=”cordova.js”&gt;&lt;/script&gt;
    &lt;script type=”text/javascript” charset=”utf-8”&gt;

    // Wait for device API libraries to load
    document.addEventListener(“deviceready”, onDeviceReady,false);

    // device APIs are available
    function onDeviceReady() {
    }

    function getCameraImage() {
      // Take picture using camera and get image source as base64-encoded string
      navigator.camera.getPicture(onCaptureSuccess, onError, { quality: 20, allowEdit: false, destinationType: navigator.camera.DestinationType.DATA_URL });
    }

    // Called when a photo is successfully retrieved
    function onCaptureSuccess(imageData) {
      var smallImage = document.getElementById(‘cameraImage');
      smallImage.src = “data:image/jpeg;base64,” + imageData;
    }

    // Capture any failures
    function onError(message) {
      alert(‘Error: ‘ + message);
    }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button onclick=”getCameraImage();”&gt;Capture Photo&lt;/button&gt; &lt;br&gt;
    &lt;img style=”display:none;width:60px;height:60px;” id=“cameraImage” src=”” /&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>When the user clicks on the <span class="strong"><strong>Capture Photo</strong></span> button, the <code class="literal">getCameraImage()</code> function will be triggered which in turn uses the <code class="literal">navigator.camera.getPicture()</code> method to capture the image from the device camera and passes the image data to the <code class="literal">onCaptureSuccess()</code> method if the capture is successful. Later, the data source in encoded string format is assigned to the <code class="literal">&lt;img&gt;</code> tag's source.</p></li><li class="listitem">If you want<a id="id478" class="indexterm"/> to enable photo editing capabilities, set <a id="id479" class="indexterm"/>the <code class="literal">allowEdit</code> property to <code class="literal">true</code> as shown here:<div class="informalexample"><pre class="programlisting">navigator.camera.getPicture(onCaptureSuccess, onError, { quality: 20, allowEdit: true, destinationType: navigator.camera.DestinationType.DATA_URL });</pre></div></li><li class="listitem">Once you have made the changes, you need to build the project to try the application on your actual device. To do so, open the command-line tool and launch the <code class="literal">prepare</code> command, and then the <code class="literal">compile</code> command from the root of the project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova prepare</strong></span>
<span class="strong"><strong>$ cordova compile</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>The <code class="literal">prepare</code> and <code class="literal">compile</code> commands can be executed from any folder of the project. The <code class="literal">build</code> command is a shorthand for the <code class="literal">prepare</code> and <code class="literal">compile</code> commands.</p></div></div></li><li class="listitem">Run the project on your device for each target platform (unfortunately, emulators don't support the camera). To test the app in the actual device platform, you can use the <code class="literal">run</code> command as shown here:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova run android</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>Before running this, you need to make your device ready to test, and the steps vary for each platform. For example, you need to enable the USB debugging option on your Android device. For more information on the setup of each platform, you can visit <a class="ulink" href="https://cordova.apache.org/docs/en/edge/index.html">https://cordova.apache.org/docs/en/edge/index.html</a>.</p></div></div></li></ol></div><p>As explained in the previous sections, the <code class="literal">cleanup</code> method works only in iOS. This means that your app should look and work differently depending on the target platform.</p><p>When creating a new project with the Cordova command-line tool, a folder named <code class="literal">merges</code> is created in the root of the project. This folder contains a separate folder for each platform you add to the project; the root folder of a PhoneGap project looks as follows:</p><div class="informalexample"><pre class="programlisting">├── config.xml
├── hooks
├── merges
├── platforms
├── plugins
├── www
   └── css
   └── img
   └── js
   └── index.html</pre></div><p>When you have to <a id="id480" class="indexterm"/>handle different user interface elements or business <a id="id481" class="indexterm"/>logic for a specific target platform, you can place the files you want to merge in the <code class="literal">merges/TARGET_PLATFORM</code> folder. You can create the <code class="literal">index.html</code> and <code class="literal">index.js</code> files, specifically targeted for the iOS platform by implementing the <code class="literal">cleanup</code> method.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec60"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>You accessed the device camera and learned how to handle different implementations of the Camera API on Android and iOS using the merge feature of Cordova. Once you have built the app, if you go to the platform-specific folders (<code class="literal">platforms/android/assets/www</code> and <code class="literal">platforms/ios/www</code>) and open the <code class="literal">index.js</code> file, you will see that they differ from each other.</p></div><div class="section" title="Controlling the camera popover"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec61"/>Controlling the camera popover</h2></div></div></div><p>The <code class="literal">getPicture</code> method in <a id="id482" class="indexterm"/>iOS (and specifically on iPad) returns a <code class="literal">CameraPopoverHandle</code> object when the <code class="literal">sourceType</code> property value is one of the following pseudo constants defined in the <code class="literal">Camera.PictureSourceType</code> object: <code class="literal">SAVEDPHOTOALBUM</code> or <code class="literal">PHOTOLIBRARY</code>. Using this object, it's possible to control the position of the popover dialog box created when the <code class="literal">getPicture</code> method is called.</p><p>The <code class="literal">CameraPopoverHandle</code> object exposes only the <code class="literal">setPosition</code> method that requires a <code class="literal">CameraPopoverOptions</code> object as an argument. This object allows you to specify the coordinates, dimensions, and position of the arrow of this dialog box:</p><div class="informalexample"><pre class="programlisting">var popoverOptions = new CameraPopoverOptions();
popoverOptions.x = 220;
popoverOptions.y = 600;
popoverOptions.width = 320;
popoverOptions.height = 480;
popoverOptions.arrowDir = Camera.PopoverArrowDirection.ARROW_DOWN;</pre></div><p>You can reach the same result with a more compact syntax, specifying the properties in the constructor of the <code class="literal">CameraPopoverOptions</code> object:</p><div class="informalexample"><pre class="programlisting">var popoverOptions = new CameraPopoverOptions(220, 600, 320, 480, Camera.PopoverArrowDirection.ARROW_DOWN);</pre></div><p>It's also possible to specify coordinates, position, and arrow direction, using the <code class="literal">popoverOptions</code> property of the <code class="literal">cameraOptions</code> object:</p><div class="informalexample"><pre class="programlisting">cameraOptions.popoverOptions = {
                x : 220,
                y :  600,
                width : 320,
                height : 480,
                arrowDir : Camera.PopoverArrowDirection.ARROW_DOWN

};</pre></div><p>The pseudo constants defined in the <code class="literal">PopoverArrowDirection</code> object match the native iOS constants defined in the <code class="literal">UIPopoverArrowDirection</code> class:</p><div class="informalexample"><pre class="programlisting">Camera.PopoverArrowDirection = {
                                ARROW_UP: 1,
                                ARROW_DOWN: 2,
                                ARROW_LEFT: 4,
                                ARROW_RIGHT: 8,
                                ARROW_ANY: 15
};</pre></div><p>This option is<a id="id483" class="indexterm"/> extremely useful when you want to have control over the position of the dialog box when the orientation of the device changes. In the next example, you will control the position and size of the dialog box in order to override the default behavior.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>If you want to use different iOS devices (for example, an iPhone 5 and 4S to test different screen sizes) for development, you have to create a provisioning file and add it to the device. You can either create one provisioning file for all your projects, or you can use one file for each project. In order to create a new file for your device, you have to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Read the device ID by clicking on the serial number you get on the first screen you get in iTunes when connecting the device.</li><li class="listitem">Go to the Apple developer portal, log in, and add a new development device to your account.</li><li class="listitem">Create and download a new provisioning file (you should already have a certificate available, otherwise read the information available in the Apple developer portal at <a class="ulink" href="https://developer.apple.com/support/technical/certificates/">https://developer.apple.com/support/technical/certificates/</a>).</li><li class="listitem">Add the provisioning file to your device using the Xcode Organizer window (in Xcode, navigate to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Organizer</strong></span>).</li></ol></div><p>It's also now<a id="id484" class="indexterm"/> possible to just plug in your device and let Xcode register and manage the provisioning profiles for you.</p></div></div></div></div>
<div class="section" title="Time for action &#x2013; controlling the position of the camera roll"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec59"/>Time for action – controlling the position of the camera roll</h1></div></div></div><p>Use the following steps to<a id="id485" class="indexterm"/> change the position of the default camera roll dialog box on an iPad:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the <code class="literal">merges/ios/js</code> folder of the PhoneGap project you previously created, open the <code class="literal">index.js</code> file, and add a new function named <code class="literal">initAdditionalOptions</code>:<div class="informalexample"><pre class="programlisting">initAdditionalOptions: function(){

    // Additional options will be defined here

}</pre></div></li><li class="listitem">In the body of the <code class="literal">initAdditionalOptions</code> function, specify the device photo album as the source of the <code class="literal">getCamera</code> method as well as the size and position of the popover dialog box:<div class="informalexample"><pre class="programlisting">app.cameraOptions.sourceType = Camera.PictureSourceType.<span class="strong"><strong>SAVEDPHOTOALBUM</strong></span>;

app.cameraOptions.popoverOptions = new <span class="strong"><strong>CameraPopoverOptions</strong></span>(220, 600, 320, 480, Camera.<span class="strong"><strong>PopoverArrowDirection</strong></span>.ARROW_DOWN);</pre></div></li><li class="listitem">Add a call to the <code class="literal">initAdditionalOptions</code> function at the end of the <code class="literal">deviceready</code> event handler:<div class="informalexample"><pre class="programlisting">deviceready: function() {
    // All the events handling initializations are here
    app.initAdditionalOptions();

}</pre></div></li><li class="listitem">Open the command-line tool and run the <code class="literal">prepare</code> and <code class="literal">compile</code> commands (or the <code class="literal">build</code> command) in order to test the project on a real device.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec62"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>You handled the<a id="id486" class="indexterm"/> size and position of a default dialog box on iOS on an iPad using only JavaScript.</p></div></div>
<div class="section" title="The Media Capture API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec60"/>The Media Capture API</h1></div></div></div><p>Modern devices offer a huge range of media capabilities to the user; at present, people can record a video, record some audio, and take a picture, and use all of these media in their communication flow.</p><p>The <a id="id487" class="indexterm"/>Media Capture API works asynchronously as most of the PhoneGap APIs and provides access to the audio, image, and video capture capabilities of the device. In order to start working with this API, you have to install the plugin to your project as shown here:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ phonegap plugin add cordova-plugin-media-capture</strong></span>
</pre></div><p>Once done, you can access the <code class="literal">capture</code> object stored in the <code class="literal">navigator.device</code> object:</p><div class="informalexample"><pre class="programlisting">var capture = navigator.device.capture;</pre></div><p>Once you get access to the <code class="literal">capture</code> object, it's possible to detect which video, audio, and image formats are supported by the device through the following properties:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">supportedAudioModes</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">supportedImageModes</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">supportedVideoModes</code></li></ul></div><p>Each property returns an array of the <code class="literal">ConfigurationData</code> objects; each item of the array represents a supported media type. There are three properties defined in the <code class="literal">ConfigurationData</code> object that you can use to clearly identify the media types supported by the device:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is a lower case string that represents the supported media type following the RFC2046 standard<a id="id488" class="indexterm"/> explained at <a class="ulink" href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</a> (that is, <code class="literal">video/3gpp</code>, <code class="literal">video/quicktime</code>, <code class="literal">image/jpeg</code>, <code class="literal">audio/amr</code>, and so on)</li><li class="listitem" style="list-style-type: disc"><code class="literal">height</code>: This is a number that represents the height of the supported image or video in pixels (the property returns <code class="literal">0</code> when the object represents a supported audio format)</li><li class="listitem" style="list-style-type: disc"><code class="literal">width</code>: This is a number that represents the width of the supported image or video in pixels (the property returns <code class="literal">0</code> when the object represents a supported audio format)<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>At the time of writing, the <code class="literal">ConfigurationData</code> object is not implemented in any supported platform. In fact, each of the arrays stored into the <code class="literal">supportedAudioModes</code>, <code class="literal">supportedImageModes</code>, and <code class="literal">supportedVideoModes</code> properties are empty.</p></div></div></li></ul></div><p>The <code class="literal">capture</code> object<a id="id489" class="indexterm"/> exposes three methods in order to access the video, audio, and image capture capabilities of the device:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">captureVideo</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">captureAudio</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">captureImage</code></li></ul></div><p>These methods have the same syntax: each one accepts a success handler, a failure handler, and an <code class="literal">option</code> object as arguments. The success handler is invoked upon a successful media capture operation and it receives an array of <code class="literal">MediaFile</code> objects describing each captured file as an argument. The error handler is invoked if an error occurs during a media capture operation or when the user cancels the operation and receives a <code class="literal">CaptureError</code> object as an argument. The following example captures an image using the device camera:</p><div class="informalexample"><pre class="programlisting">var capture = navigator.device.capture;

capture.captureImage(function(files){

                         console.log(files);

                     }, function(error){

                         console.log(error);

                     });</pre></div><p>The <code class="literal">MediaFile</code> object stored in the files array returned by the success handler describes the captured media. The properties of the <code class="literal">MediaFile</code> object<a id="id490" class="indexterm"/> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">fullPath</code>: This is <a id="id491" class="indexterm"/>a string that represents the file path on the device including the filename.</li><li class="listitem" style="list-style-type: disc"><code class="literal">lastModifiedDate</code>: This is the <a id="id492" class="indexterm"/>modification date of the file expressed as the number of milliseconds since January 1, 1970 (refer to <a class="ulink" href="https://developer.mozilla.org/en/docs/JavaScript/Reference/Global_Objects/Date">https://developer.mozilla.org/en/docs/JavaScript/Reference/Global_Objects/Date</a> for more information on the <code class="literal">Date</code> object in JavaScript).</li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: This is a<a id="id493" class="indexterm"/> string that represents the name of the file. The name is composed by the <code class="literal">lastModificationDate</code> value and the file extension.</li><li class="listitem" style="list-style-type: disc"><code class="literal">size</code>: This<a id="id494" class="indexterm"/> is a number that represents the size of the file in bytes.</li><li class="listitem" style="list-style-type: disc"><code class="literal">type</code>: This is a <a id="id495" class="indexterm"/>string that represents the mime type of the captured file (for example, <code class="literal">image/jpeg</code>).</li></ul></div><p>The <code class="literal">CaptureError</code> object returned to the error handler only has one property, <code class="literal">code</code>. This property contains an integer equal to one of the following <a id="id496" class="indexterm"/>pseudo constants defined in the <code class="literal">CaptureError</code> object:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">CaptureError.CAPTURE_INTERNAL_ERR</code> (returned value <code class="literal">0</code>): This means the device failed to capture a <a id="id497" class="indexterm"/>video, an image, or sound</li><li class="listitem" style="list-style-type: disc"><code class="literal">CaptureError.CAPTURE_APPLICATION_BUSY</code><a id="id498" class="indexterm"/> (returned value <code class="literal">1</code>): This means the capture application is currently serving another capture request</li><li class="listitem" style="list-style-type: disc"><code class="literal">CaptureError.CAPTURE_INVALID_ARGUMENT</code> (returned value <code class="literal">2</code>): This means the app is using invalid <a id="id499" class="indexterm"/>arguments when invoking the API (for example, the <code class="literal">limit</code> parameter has a value of less than 1)</li><li class="listitem" style="list-style-type: disc"><code class="literal">CaptureError.CAPTURE_NO_MEDIA_FILES</code> (returned value <code class="literal">3</code>): This means the user exited the <a id="id500" class="indexterm"/>camera application or the audio capture application before capturing anything</li><li class="listitem" style="list-style-type: disc"><code class="literal">CaptureError.CAPTURE_NOT_SUPPORTED</code> (returned value <code class="literal">20</code>): This means the requested capture operation<a id="id501" class="indexterm"/> is not supported</li></ul></div><p>The <code class="literal">option</code> object varies for each method. In fact, the Capture API defines a different object for each kind of capture: <code class="literal">CaptureVideoOptions</code>, <code class="literal">CaptureAudioOptions</code>, and <code class="literal">CaptureImageOptions</code>. All of these objects have the same properties, limits, and modes in common; the <code class="literal">duration</code> property is defined only in the <code class="literal">CaptureVideoOptions</code> and <code class="literal">CaptureAudioOptions</code> objects. The default value of the <code class="literal">limit</code> property is <code class="literal">1</code> and it's used to specify the number of captures the user can do before returning to the app. The <code class="literal">duration</code> property is the maximum length of a capture in seconds. The <code class="literal">mode</code> property represents the selected video or audio mode.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>Support for the configuration options is very fragmented. For instance, the <code class="literal">limit</code> property of the <code class="literal">CaptureImageOptions</code> and <code class="literal">CaptureVideoOptions</code> objects is not supported in iOS. Refer to the documentation at <a class="ulink" href="http://docs.phonegap.com/en/edge/cordova_media_capture_capture.md.html#Capture">http://docs.phonegap.com/en/edge/cordova_media_capture_capture.md.html#Capture</a> to check the actual status of the implementation.</p></div></div><p>The most efficient way to manipulate an image is through native code; however, you can also perform simple image manipulations via JavaScript. In order to avoid overcomplicating the following example, we have used HTML Canvas to render an image with some effects.</p><p>The <code class="literal">&lt;canvas&gt;</code> tag of HTML is a container used to draw graphics on the fly using scripting languages such as JavaScript. It has several inbuilt functions and we are going to use them here.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>For more information on <a id="id502" class="indexterm"/>HTML5 Canvas, refer to <a class="ulink" href="http://www.html5canvastutorials.com/">http://www.html5canvastutorials.com/</a>.</p></div></div></div>
<div class="section" title="Time for action &#x2013; manipulating images with a canvas"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Time for action – manipulating images with a canvas</h1></div></div></div><p>Get ready to apply a<a id="id503" class="indexterm"/> sepia effect to an image acquired using the Media Capture API. Execute the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the command-line tool and create a new PhoneGap project named <code class="literal">ImageEffect</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova create ImageEffect</strong></span>
</pre></div></li><li class="listitem">Change the path to the newly created project:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ImageEffect</strong></span>
</pre></div></li><li class="listitem">Add the Media Capture API plugin using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cordova plugin add cordova-plugin-media-capture</strong></span>
</pre></div></li><li class="listitem">Add a <code class="literal">canvas</code> tag with the <code class="literal">id</code> value as <code class="literal">#manipulatedImage</code> to the existing markup, in order to use it to render the manipulated image:<div class="informalexample"><pre class="programlisting">&lt;canvas id='manipulatedImage' /&gt;</pre></div></li><li class="listitem">Once the <code class="literal">deviceready</code> event has been fired, access the device camera, which allows the user to access only one image:<div class="informalexample"><pre class="programlisting">var capture = navigator.device.capture;
capture.captureImage(onGetImage, onImageError, {limit: 1});</pre></div></li><li class="listitem">Define the success handler and access the file information stored in the array that is returned as an argument:<div class="informalexample"><pre class="programlisting">function onGetImage(files){

    var currentFile = files[0];

    // Canvas access logic will go here
}</pre></div></li><li class="listitem">Get access <a id="id504" class="indexterm"/>to the canvas and store a reference to the <code class="literal">2d</code> context of the canvas, in order to be able to draw content on it:<div class="informalexample"><pre class="programlisting">var canvas = document.querySelector(‘#manipulatedImage');
var context = canvas.getContext(‘2d');

// Image object definition and load will go here</pre></div></li><li class="listitem">Create an <code class="literal">image</code> object, assign a handler to the <code class="literal">onload</code> property, and define the <code class="literal">src</code> property of the object using the <code class="literal">fullPath</code> property of the <code class="literal">MediaFile</code> object:<div class="informalexample"><pre class="programlisting">var image = new Image();

image.onload = function(evt) {
    // The image manipulation logic will go here
};

image.src = currentFile.fullPath;</pre></div></li><li class="listitem">In the function stored in the <code class="literal">onload</code> property, draw the image on the canvas, get the pixels, manipulate them, and reassign the pixels to the canvas:<div class="informalexample"><pre class="programlisting">var width = canvas.width;
var height = canvas.height;

context.drawImage(this, 0, 0, width, height);

var imgPixels = context.getImageData(0, 0, width, height);
context.putImageData(<span class="strong"><strong>grayscale</strong></span>(imgPixels), 0, 0, 0, 0, width, height);</pre></div></li></ol></div><p>The complete code of this example is provided here for your understanding:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;!--Other section removed for sake of simplicity --&gt;
        &lt;title&gt;Media Capture Example&lt;/title&gt;
    &lt;/head&gt;
&lt;body&gt;
&lt;canvas id='manipulatedImage' /&gt;

&lt;script type=”text/javascript” src=”cordova.js”&gt;&lt;/script&gt;

&lt;script type=”text/javascript”&gt;

   document.addEventListener(“deviceready”, onDeviceReady, false);

   function onDeviceReady() {
      var capture = navigator.device.capture;
      capture.captureImage(onGetImage, onError, {limit: 1});
         }

   function onGetImage(files){
      var currentFile = files[0];

      var canvas = document.querySelector(‘#manipulatedImage');
      var context = canvas.getContext(‘2d');
      var image = new Image();

      image.onload = function(evt) {
         var width = canvas.width;
         var height = canvas.height;

         context.drawImage(this, 0, 0, width, height);
         var imgPixels = context.getImageData(0, 0, width, height);
         context.putImageData(grayscale(imgPixels), 0, 0, 0, 0, width, height);
      };
      image.src = currentFile.fullPath;
   }

   function onError(error){
      alert(JSON.stringify(error));
   }
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>You can <a id="id505" class="indexterm"/>find the <code class="literal">grayscale</code> function<a id="id506" class="indexterm"/> and several image effects at <a class="ulink" href="http://www.html5rocks.com/en/tutorials/canvas/imagefilters/">http://www.html5rocks.com/en/tutorials/canvas/imagefilters/</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>When you refer to any plugins or PhoneGap-specific objects such as <code class="literal">CameraPopoverOptions</code>, you have to wait until the <code class="literal">deviceready</code> event is fired so that the required objects are available for use:</p><div class="informalexample"><pre class="programlisting">if (typeof window.plugins.CameraPopoverOptions !== ‘undefined'){
    // plugin object is available to be used
}</pre></div><p>Some plugins define global objects and they can be used to verify that the plugin is loaded and available to use:</p><div class="informalexample"><pre class="programlisting">function onDeviceReady() {
   console.log(navigator.device.capture);
}</pre></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Summary</h1></div></div></div><p>In this chapter, you learned about the Contacts API, how to find contacts from a device, how to filter contacts, and how to save new contacts to a device. You also learned the differences between the Camera and Media Capture APIs and how to use them in your application.</p><p>In the next chapter, you will learn how to access the Device Sensor API in order to determine the device orientation, position, and also how to implement the Locations API.</p></div></body></html>