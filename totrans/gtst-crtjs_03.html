<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Working with Drag-and-drop Interactions</h1></div></div></div><p>In this chapter, we will go through the basic events and callbacks of CreateJS to make a <strong>drag-and-drop</strong> feature. <a id="id57" class="indexterm"/>After reading this chapter, you will be able to understand common events of objects in CreateJS and also how to change properties such as width or height. We will cover the following topics in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Scenarios for drag-and-drop</li><li class="listitem" style="list-style-type: disc">Mouse events</li><li class="listitem" style="list-style-type: disc">Creating an example to drag-and-drop</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec14"/>The scenario</h1></div></div></div><p>All we need<a id="id58" class="indexterm"/> to do to create a drag-and-drop feature is to bind events to <code class="literal">DisplayObject</code> on the <code class="literal">Stage</code> object (such as a circle) and then change the x and y axes of the target object continuously as the mouse is moved. Fortunately, CreateJS provides many events on mouseover, and we can use them to achieve our goals.</p><p>In further sections, we will see how we can bind events to objects and get information from the mouse cursor. We will also see how to change the properties of an object or shape in the <code class="literal">Stage</code> object.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec15"/>Understanding the on function</h1></div></div></div><p>In EaselJS, you <a id="id59" class="indexterm"/>can get access to all mouse events, such as click, mouse up, and so on. A <code class="literal">MouseEvent</code> instance is passed as the only parameter for all mouse event callbacks. It includes the <code class="literal">stageX</code> and <code class="literal">stageY</code> properties, which indicate the cursor's position relative to the stage coordinates.</p><p>In the following example, <code class="literal">pressed</code> will be logged on to the console when the mouse is clicked over the circle; thereafter, mouse moves will be logged whenever the mouse moves until the mouse is released.</p><div><pre class="programlisting">circle.on("mousedown", function(mousedownEvent) {
    console.log("pressed");
    circle.on("pressmove", function(moveEvent) { 
        console.log("mouse moved: "+moveEvent.stageX+","+moveEvent.stageY); 
    });
});</pre></div><p>As you can see, we can simply bind a mouse event to our <code class="literal">DisplayObject</code> object and then read or alter the properties on each event callback. The following screenshot displays the output of the previous example along with the details of mouse events:</p><div><img src="img/0260OS_3_1.jpg" alt="Understanding the on function"/></div><p>In the next section, we will put all these things together and create a simple drag-and-drop interaction.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec16"/>Creating a drag-and-drop interaction</h1></div></div></div><p>We<a id="id60" class="indexterm"/> learned in the previous chapter that the first requirement for working with EaselJS is to create a <code class="literal">Stage</code> object and then append all the <code class="literal">DisplayObject</code> objects to it. Suppose we have a <code class="literal">Canvas</code> element with the ID <code class="literal">demoCanvas</code>. We will need the following code for the same:</p><div><pre class="programlisting">var stage = new createjs.Stage("demoCanvas");</pre></div><p>If you want to track the movement of mouse cursor events when the mouse cursor leaves the <code class="literal">Canvas</code> element, <code class="literal">mouseMoveOutsideproperty</code> should be set to <code class="literal">true</code>:</p><div><pre class="programlisting">stage.mouseMoveOutside = true;</pre></div><p>In the next step, a circle will be created:</p><div><pre class="programlisting">var circle = new createjs.Shape(); 
circle.graphics.beginFill("red").drawCircle(0, 0, 50);</pre></div><p>And, of course, we have to add our shape to the <code class="literal">stage</code> element shown as follows:</p><div><pre class="programlisting">stage.addChild(circle);</pre></div><p>Now, it's time to bind functions to the <code class="literal">mousedown</code> and <code class="literal">pressmove</code> events:</p><div><pre class="programlisting">circle.on("mousedown", function (evt) {
    var offset = {
        x: evt.target.x - evt.stageX,
        y: evt.target.y - evt.stageY
    };

    circle.on("pressmove", function (ev) {
        ev.target.x = ev.stageX + offset.x;
        ev.target.y = ev.stageY + offset.y;
        stage.update();
    });
});</pre></div><p>As you can see, we have set a callback function for the <code class="literal">mousedown</code> event of our display object, <code class="literal">circle</code>. Inside the anonymous function, there is an offset variable that has two properties, <code class="literal">x</code> and <code class="literal">y</code>. These properties collect the offset values of the mouse cursor on every mouse down within the shape (circle in this example), so we can use this offset value to change the position of the circle. In this example, <code class="literal">x</code> or <code class="literal">y</code> could be between +50 and -50.</p><p>After that, an anonymous function is added to the <code class="literal">pressmove</code> event of the shape.</p><p>Inside the next anonymous function for the <code class="literal">pressmove</code> event, we have two lines of code. Both calculate the position of the mouse cursor and then alter the coordinates of the target shape. <code class="literal">ev.stageX</code> and <code class="literal">ev.stageY</code> always give you the coordinates of the mouse cursor within the stage. Therefore, using these properties, we can change the coordinates of the target shape correctly.</p><p>Everything is <a id="id61" class="indexterm"/>ready now, but there's one last step we should perform to complete the challenge. As we learned earlier in EaselJS, we should call the <code class="literal">update</code> function in order to update the stage after making any changes in objects in the <code class="literal">stage</code> event. In the drag-and-drop example, we are changing the coordinates of the target shape continuously. Therefore, we also have to update the <code class="literal">Stage</code> event continuously; the question is how. The answer to this question is that we have to call <code class="literal">stage.update()</code> on the call for each event as follows:</p><div><pre class="programlisting">stage.update();</pre></div><p>EaselJS will update the stage event after each change to the coordinates of the circle.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec12"/>The complete example</h2></div></div></div><p>Here you can<a id="id62" class="indexterm"/> see the whole source code for creating a simple drag-and-drop interaction:</p><div><pre class="programlisting">stage = new createjs.Stage("demoCanvas");
stage.mouseMoveOutside = true;

var circle = new createjs.Shape();
circle.graphics.beginFill("red").drawCircle(100, 100, 50);
stage.addChild(circle);

circle.on("mousedown", function(evt) {
    var offset = {
        x: evt.target.x - evt.stageX,
        y: evt.target.y - evt.stageY
    };

    circle.on("pressmove", function(ev) {
        ev.target.x = ev.stageX + offset.x;
        ev.target.y = ev.stageY + offset.y;
        stage.update();
    });
});

stage.update();</pre></div><p>After running the example, you should see a red circle, as shown in the following screenshot. By <a id="id63" class="indexterm"/>clicking and dragging the circle, the coordinates of the circle will be changed.</p><div><img src="img/0260OS_3_2.jpg" alt="The complete example"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec17"/>Summary</h1></div></div></div><p>In this chapter, we have learned how to work with the <code class="literal">mousedown</code> and <code class="literal">pressmove</code> events, how to change object properties, and also how to update the stage event continuously using EaselJS features. With a combination of all the mentioned features, we can build an animation or say drag-and-drop interactions with CreateJS.</p><p>In the next chapter, we will discuss working with the animation and transformation of objects with CreateJS to develop awesome animations in browsers.</p></div></body></html>