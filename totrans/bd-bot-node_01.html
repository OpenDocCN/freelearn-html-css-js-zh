<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. The Rise of Bots – Getting the Message Across</h1></div></div></div><p>Nowadays customers are demanding to communicate with brands, companies, and organizations as casually as they talk to their friends, and they expect an immediate response. Providing that level of service is quite impractical, if not rather logistically impossible to achieve for most organizations, without using some form of automation.</p><p>Until recently, the limitations of automated technology meant compromising the seamless, robust experience that's been proven to create loyal customers. Running a call center is an expensive undertaking and yet in order to be able to provide that instant communication channel with customers, most brands and companies opted to do this, in order to provide that instant response.</p><p>With the advent of <strong>Artificial Intelligence</strong> (<strong>AI</strong>), <strong>Natural Language Processing</strong> (<strong>NLP</strong>), <strong>Machine Learning</strong> (<strong>ML</strong>), and Sentiment Analysis APIs and frameworks, semi-automated or fully automated agents known as bots are radically changing everything we know about customer communication, initiating a revolution in the way customer interaction is done.</p><p>With fewer people using their phone to make phone calls anymore, but instead using their phones for anything else but talking, messaging has become the de facto way to communicate.</p><p>A great deal of smartphone owners use their devices to make calls, but most use them for text-based communication (texting/SMS, messaging, or chat). The average adult spends a total of 23 hours a week texting. Furthermore over a lifetime, the average Millennial will spend an astonishing 12 years texting.</p><p>The reason for the rise of text messaging as a communication platform is that phone calls are interruptive, inconvenient, and inefficient. They don't allow for multitasking-when you're using your smartphone to make a call, it cannot be used for anything else. While in the past we used to just pick up the phone to solve a problem, now we start with text-based messages, and then escalate to voice.</p><p>Another significantly important reason for messaging adoption is that customers are demanding interaction where they already are.</p><p>Messaging and chat-related apps are rapidly gaining popularity over SMS, especially among younger people. Globally, 6 of the 10 top apps are messaging applications such as Facebook Messenger, WhatsApp, Telegram, and WeChat.</p><p>The main reason for this increased usage of messaging apps is that these don't count against monthly SMS limits, and if you're connected to Wi-Fi, these don't use up any data either. Further to that, there's also an emotional component, which enhances the overall conversation. Messaging has the feel of a real-time conversation. You know when your friends are active in the app and even when they're typing a response, which makes it an addictive and highly engaging medium to communicate with.</p><p>With this scenario in perspective, creating messaging bots that provide meaningful interaction with customers provides a cutting-edge advantage to any business, by using today's most common communication medium and also being where customers already are, on their messaging apps.</p><p>In this book, we'll explore how we can write bots using various platforms, APIs, and SDKs in order to tackle some of today's most interesting business problems, in steps that are easy to follow and at the same time fun to implement. Specifically, this chapter will dig into:</p><div><ul class="itemizedlist"><li class="listitem">Why bots matter and why you should get on the train</li><li class="listitem">Why SMS still matters</li><li class="listitem">Twilio as an SMS platform:<div><ul class="itemizedlist"><li class="listitem">Installing Twilio for Node.js</li><li class="listitem">Setting up a Twilio account</li><li class="listitem">Bare-bones Twilio Node.js template</li></ul></div><p>
</p></li><li class="listitem">Core bot functionality on Azure</li><li class="listitem">Receiving SMS bot logic</li></ul></div><p>Let's not wait any further and get into the details. Have fun!</p><div><div><div><div><h1 class="title"><a id="ch01lvl1sec7"/>Why bots matter and why you should get on the train</h1></div></div></div><p>In the broad sense of its definition, a bot is a piece of software that leverages artificial narrow intelligence to perform specific tasks in place of a human. Bots understand language to a certain extent and not just commands. Ultimately, they could learn from their interactions to get smarter and better.</p><p>In roughly two years time, 3.6 billion people (yes 3.6 billion) are projected to be using messaging apps--that's 90% of total Internet users, which is more people than could ever be served with a continuous thread of communication compared to more traditional platforms such as e-mail. Refer to the following link for more information: <a class="ulink" href="https://hbr.org/2016/09/messaging-apps-are-changing-how-companies-talk-with-customers">
https://hbr.org/2016/09/messaging-apps-are-changing-how-companies-talk-with-customers
</a>.</p><p>Worldwide, consumers are now demanding messaging as a customer service option. It's not sufficient to have a customer service phone number where the customer can call you, but it's becoming almost a must that customers should be able to reach you through some kind of real-time messaging platform as well. Users are demanding fast-paced interaction and quick answers.</p><p>Recent studies found that messaging and chat were the highest rated contact methods for customer satisfaction. Refer to <a class="ulink" href="https://onereach.com/blog/45-texting-statistics-that-prove-businesses-need-to-start-taking-sms-seriously/">
https://onereach.com/blog/45-texting-statistics-that-prove-businesses-need-to-start-taking-sms-seriously/
</a>.</p><p>According to recent polls (<a class="ulink" href="http://customerthink.com/7-data-backed-reasons-why-you-should-let-customers-text-customer-service/">
http://customerthink.com/7-data-backed-reasons-why-you-should-let-customers-text-customer-service/
</a>), almost two-thirds of consumers are likely to have a positive perception of an organization that offers messaging or chat as a service channel. Nevertheless, by the end of 2016, roughly 40% of customer service centers will still be missing that opportunity to impress their customers. This translates not only into failing to impress your customers, but also as a loss of business opportunities. Customers are likely to be more loyal and stay with those organizations that are capable of interacting and engaging with them in faster and smarter ways. Refer to <a class="ulink" href="https://blog.kissmetrics.com/live-chat/">
https://blog.kissmetrics.com/live-chat/
</a>.</p><p>Consider your organization (corporate) has a messaging app that allows your customers to interact with you. Even though your app might be a great communication gateway, there's still no room for that communication channel to be lost. Say, for instance, a user forgets to turn on notifications or accidentally deletes the app. The ability to seamlessly and easily communicate is suddenly gone.</p><p>However, using a personal messaging app (such as Skype, Facebook Messenger, WhatsApp, and so on) eliminates most roadblocks, allowing for companies to become part of the communication framework that users already know and love.</p><p>With messaging apps, there are no forms, no downloads, no new platforms. The customer can use the interface that they are already familiar with to instantly engage with your organization. The user can use natural language to purchase a ticket, download a boarding pass, or ask a question. Moreover, given that the user is highly unlikely to stop using the messaging app, your organization can follow up with updates, surveys, and other notifications through the messaging app that the user already knows and loves.</p><p>In order to understand this better, say when a consumer asks a question, the bot should be able to:</p><div><ul class="itemizedlist"><li class="listitem">Use natural language processing to understand the intent of the question</li><li class="listitem">Gather relevant details from the company's website, FAQs, or knowledge base, or even trusted external sites</li><li class="listitem">Sift through that information to find the most likely answer to the customer's intent of the question</li><li class="listitem">Respond back to the customer more or less in a similar way as a human would</li></ul></div><p>There will surely be cases where bots might encounter situations that require the nuance and analytical thinking of a human. When they do, they can escalate to an agent, passing along the context they've gathered during the interaction to ensure a seamless customer experience. In principle, this should be totally transparent for the end user.</p><p>As technology continues to advance, Gartner predicts that by 2018, bots should be able to recognize customers by face and voice rather seamlessly.</p><p>Bots could also be able to:</p><div><ul class="itemizedlist"><li class="listitem">Allow customers to make purchases without leaving the messaging app</li><li class="listitem">Offer personalized product suggestions</li><li class="listitem">Link users to relevant web pages such as customer product reviews</li><li class="listitem">Initiate new interactions to re-engage users</li><li class="listitem">Follow up with cart reminders and customer cases</li><li class="listitem">Overall, help your organization to create an exceptional customer experience by providing robust data and actionable insights</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec8"/>Why SMS still matters</h1></div></div></div><p>Smart phones are becoming more important in today's world. Arguably, they are almost an extension of yourself. If you lose your phone today, you are in trouble. Everything from e-mails, calendar, messaging, banking, and even your wallet are somehow linked to your phone.</p><p>In today's vibrant, dynamic, and always connected society, having access to vast amounts of information at your fingertips through your phone can be a blessing, but it can also be a curse.</p><p>Busy professionals nowadays have to deal with hundreds of e-mails on a daily or weekly basis, plus also many messages and notifications from social networks such as Twitter and LinkedIn. Keeping up with this sheer volume of messages can be overwhelming.</p><p>But what if phones could actually help us alleviate some of this information overload by notifying us of important things or allowing us to perform custom actions based on SMS or voice commands? Imagine if we were able to automate certain processes through messaging or voice. Wouldn't that be awesome?</p><p>Before social networks took off, <strong>Short Message Service</strong> (<strong>SMS</strong>) was the most common way to exchange short messages between people.</p><p>According to Wikipedia, even though SMS is still strong and growing, social networking messaging services such as Facebook Messenger, WhatsApp, Skype, and Viber, available on smart phones, are increasingly being used to exchange short messages.</p><p>Generally speaking, SMS and voice enabled solutions are platform specific and cannot be customized; however, there's a platform that was designed from the ground up with developers in mind, which allows anyone with development skills to create custom messaging and voice enabled solutions. Welcome to Twilio! refer to <a class="ulink" href="https://www.twilio.com/">
https://www.twilio.com/
</a>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec9"/>Twilio as an SMS platform</h1></div></div></div><p>Twilio is a messaging, voice, video, and authentication API for every application. It has helper libraries or SDKs in many different programming languages that help developers create apps that can leverage the power of voice and messaging.</p><p>Despite that, SMS is still very strong and widely used in enterprise development for things such as marketing, <strong>Customer Relationship Management</strong> (<strong>CRM</strong>) automation, real-time alert notifications, and two-step verification of a user's identify.</p><p>The significance of SMS usage in the business world is incredibly important given that the technology is considered mature, widely spread, proven, and reliable.</p><p>Twilio's services are accessed over HTTP(S) through a RESTful API or helper libraries. Its services are billed based on usage. The platform is based on <strong>Amazon Web Services</strong> (<strong>AWS</strong>) to host its telephony infrastructure and provide connectivity between HTTP and the <strong>Public Switched Telephone Network</strong> (<strong>PSTN</strong>), through its APIs.</p><p>Twilio has recently extended its API support to Facebook Messenger, which coincides with the social networking company's introduction of support for bots on its Messenger platform.</p><p>In this chapter, we'll explore how to interact with Twilio's REST API using the Node.js helper library in order to build an SMS Messaging bot.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec6"/>Installing Twilio for Node.js</h2></div></div></div><p>Twilio provides a REST API, which allows developers to interact with its platform services, such as SMS. Even though the REST API is a great way to interact with Twilio services, there are official helper libraries for the most common programming languages of today, such as: PHP, ASP.NET (C#), Ruby, Python, Java, Salesforce (Apex), and, last but not least, Node.js.</p><p>The Twilio Node.js helper library can be obtained from <a class="ulink" href="https://www.twilio.com/docs/libraries/node">
https://www.twilio.com/docs/libraries/node
</a>. In order to get started, let's get Node.js installed.</p><p>Open your browser and navigate to <a class="ulink" href="https://nodejs.org">
https://nodejs.org
</a> and there on the main page you can download the version of Node.js that corresponds to your platform.</p><p>
</p><div><img src="img/image00152.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The steps that follow will be based on installing Node.js on a Windows 64 Bit operating system.</p><p>Once you have selected a version, just run the installer and follow the installation steps. You'll first be presented with a Welcome screen and then you can click on the <strong>Next</strong> button.</p><p>
</p><div><img src="img/image00153.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>You'll be requested to accept the license terms and then click on the <strong>Next</strong> button again.</p><p>
</p><div><img src="img/image00154.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Following that, the installer displays the default installation path, which you may opt to change or not.</p><p>
</p><div><img src="img/image00155.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once the installation path has been defined, simply click on the <strong>Next</strong> button. The next step is to select what features will be installed.</p><p>
</p><div><img src="img/image00156.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>It is highly recommended to leave all the features selected so everything can be installed. The npm package manager will be later required in order to install the Twilio Node.js helper library.</p><p>Finally, click on the <strong>Next</strong> button and then the <strong>Install</strong> button, in order to finalize the installation process.</p><p>
</p><div><img src="img/image00157.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>If there was a previous version of Node.js installed on your system, the installer will remove previous older files and then update the system with the newest files.</p><p>
</p><div><img src="img/image00158.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Please note that on other platforms (<a class="ulink" href="https://nodejs.org/en/download/package-manager/">
https://nodejs.org/en/download/package-manager/
</a>), the installation process and screens might differ (such as on a Mac); however, it should be pretty straightforward and easy to follow along by going through the installation steps.</p><p>Once Node.js has been installed, the next thing to do is to get the Twilio Node.js helper library installed.</p><p>In order to do this, create a folder anywhere on your PC for this project, browse to this folder, and then open the Command Prompt or shell and type this command:</p><pre class="programlisting">
<strong>npm init</strong>
</pre><p>Just follow the steps requested. This will create the <code class="literal">package.json</code> file (you can refer to <a class="ulink" href="https://docs.npmjs.com/files/package.json">
https://docs.npmjs.com/files/package.json
</a>) required for our project.</p><p>
</p><div><img src="img/image00159.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once the <code class="literal">package.json</code> file has been created, type in the following command:</p><pre class="programlisting">
<strong>npm install twilio --save</strong>
</pre><p>This will install the Twilio Node.js helper library and all its dependencies and save the reference on our <code class="literal">package.json</code> file. The Twilio library will be installed under the <code class="literal">node_modules</code> folder within the folder where your <code class="literal">package.json</code> file resides. We'll be using the awesome Atom editor (<a class="ulink" href="https://atom.io/">
https://atom.io/
</a>) throughout this book. You may use any other editor of your choice, such as Sublime or Visual Studio Code.</p><p>
</p><div><img src="img/image00160.jpeg" alt="Installing Twilio for Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>With this in place, we can technically start writing code. However, we first need to sign up for a Twilio account and get all set up with Twilio before we can send our first SMS. Let's explore how we can get this done.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec7"/>Setting up a Twilio account</h2></div></div></div><p>In order to be able to send SMS using the Twilio API and Node.js helper library, we need to get a Twilio account set up and also purchase a disposable Twilio number.</p><p>Twilio is a pay-as-you-go service, which means that you'll need to set up an account and provide your credit card details in order to have enough credit, which will be used to pay for every SMS you send.</p><p>You'll also need to purchase a Twilio number, which is a regular but disposable phone number that will be used to send your messages.</p><p>Twilio numbers are available for many countries. They look like any other valid phone number you can think of. They are real phone numbers that you can dispose of when you no longer need them.</p><p>In order to set up a Twilio account, from your browser access the following site <a class="ulink" href="https://www.twilio.com/">
https://www.twilio.com/
</a>. Then, click on the <strong>SIGN UP</strong> button.</p><p>The sign-up process is fairly straightforward, and is super easy to follow and complete. Just fill in a few fields that are required and you're done.</p><p>Once your Twilio account has funds, you'll need to purchase a disposable phone number.</p><p>You'll need to go to this location, <a class="ulink" href="https://www.twilio.com/user/billing">
https://www.twilio.com/user/billing
</a>, in order to add funds to your account. In order to do that, click on the <strong>Ad Funds</strong> link in red. Make sure that you have logged into Twilio before accessing this URL.</p><p>
</p><div><img src="img/image00161.jpeg" alt="Setting up a Twilio account"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>With funds in your account, let's set up a Twilio number. This will be a real phone number, which you can delete at any moment. You may choose from which country and city your number will belong to.</p><p>
Then click on the <strong>Buy a Number</strong> button.</p><p>
</p><div><img src="img/image00162.jpeg" alt="Setting up a Twilio account"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once you have clicked on the <strong>Buy a Number</strong> button, the following pop-up screen will be shown:</p><p>
</p><div><img src="img/image00163.jpeg" alt="Setting up a Twilio account"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>On this screen, you have the option to choose which country you would like to get the number from and also from which geographical location.</p><p>The number could be used for <strong>Voice</strong>, <strong>SMS</strong>, and even <strong>MMS</strong>. For now, we are simply interested in making sure that the <strong>SMS</strong> option is ticked.</p><p>Once you have purchased your Twilio number, you will see the following screen:</p><p>
</p><div><img src="img/image00164.jpeg" alt="Setting up a Twilio account"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>With this in place, we are ready to start writing our Node.js code.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec8"/>Bare-bones Twilio Node.js template</h2></div></div></div><p>In order to start writing our code, let's create a new file in the same location as our <code class="literal">package.json</code> file called <code class="literal">app.js</code>. You may create this new file directly from the editor you are using.</p><p>Once the file has been created, we'll need to include a reference to the Twilio Node.js library that we installed through npm:</p><pre class="programlisting">var twilio = require("twilio"); &#13;
</pre><p>In the Node.js world, this is the equivalent of an import in Java or using statements in C#. Now let's move on to see how we can actually send an SMS using the Twilio Node.js helper library:</p><pre class="programlisting">var accountSid = '&lt;&lt; your twilio account sid &gt;&gt;';  &#13;
// Your Account SID from www.twilio.com/console &#13;
 &#13;
var authToken = '&lt;&lt; your twilio auth token &gt;&gt;';    &#13;
// Your Auth Token from www.twilio.com/console &#13;
</pre><p>We'll need two variables to store our Twilio<strong> Account SID</strong> and our <strong>Auth token</strong>. Both values can be obtained when you log in to your Twilio account and browse to the developer console: <a class="ulink" href="https://www.twilio.com/console">
https://www.twilio.com/console
</a>.</p><p>
</p><div><img src="img/image00165.jpeg" alt="Bare-bones Twilio Node.js template"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once we have provided the correct values to the <code class="literal">accountSid</code> and <code class="literal">authToken</code> variables, we'll need to create an instance of the <code class="literal">twilio.RestClient</code> class in order to be able to send an SMS:</p><pre class="programlisting">var client = new twilio.RestClient(accountSid, authToken); &#13;
</pre><p>With our instance created, we can go ahead and send our SMS using Twilio:</p><pre class="programlisting">client.messages.create({ &#13;
    body: 'Greetings earthling, this is the TwilioSmsBot ;)', &#13;
    to: '+12345678901',  // Number that receives the SMS &#13;
    from: '+12345678901' // Purchased Twilio number that send the SMS &#13;
}, &#13;
function(err, message) { &#13;
    console.log(message.sid); &#13;
}); &#13;
</pre><p>Basically, the SMS is sent by invoking the <code class="literal">messages.create</code> method from the Twilio <code class="literal">client</code> instance.</p><p>This method expects an object that describes the properties of the SMS, such as the <code class="literal">body, to</code> (receiver number), <code class="literal">from</code> (sender number), call back function which describes an error <code class="literal">err</code> (if an error actually happens), and the contents of the posted <code class="literal">message</code>.</p><p>This is all that is required in order to send an SMS using Twilio. Let's have a look at all the code now:</p><pre class="programlisting">var twilio = require("node_modules/twilio/lib"); &#13;
 &#13;
var accountSid = '&lt;&lt; your twilio account sid &gt;&gt;';  &#13;
var authToken = '&lt;&lt; your twilio auth token &gt;&gt;';    &#13;
 &#13;
var client = new twilio.RestClient(accountSid, authToken); &#13;
 &#13;
client.messages.create({ &#13;
    body: 'Hello from Node', &#13;
    to: '+12345678901',       &#13;
    from: '+12345678901' &#13;
}, &#13;
function(err, message) { &#13;
    console.log(message.sid); &#13;
}); &#13;
</pre><p>In order to execute this code, execute this command from the Command Prompt:</p><pre class="programlisting">
<strong>node app.js</strong>
</pre><p>This will send the SMS to the number indicated. We can see the <code class="literal">message.sid</code> of the SMS sent (which was sent back as a response from the Twilio service) by looking at the Command Prompt.</p><p>
</p><div><img src="img/image00166.jpeg" alt="Bare-bones Twilio Node.js template"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Please notice that if the destination number you will be messaging is an international (non-US) number, you'll need to enable certain permissions to allow Twilio to perform that action.</p><p>These permissions can be checked and configured at this URL: <a class="ulink" href="https://www.twilio.com/console/voice/settings/geo-permissions">
https://www.twilio.com/console/voice/settings/geo-permissions
</a>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Core bot functionality on Azure</h1></div></div></div><p>Now that we've implemented and have a working Twilio Node.js template, which can send SMS, let's have a look at expanding our code to do more.</p><p>We'll need to be able to somehow hook and listen to incoming SMS and have some very basic <strong>Natural Language Processing (NLP)</strong>, in order to send answers based on the input received.</p><p>Listening to incoming SMS requires setting up in our Node.js app a URL that can be configured within your Twilio account as a Request URL. This Request URL will be used by Twilio to push incoming messages on your purchased Twilio number, to our Node.js bot app.</p><p>To make our bot publicly available, we'll publish it on Azure websites. Let's create a REST endpoint for our Node.js app, which we will use for listening to new messages. We'll be using the Express framework (<a class="ulink" href="http://expressjs.com/">http://expressjs.com/</a>) to do this.</p><p>Express is a minimal and flexible Node.js web application framework that provides a robust set of features for web and mobile applications. It provides a thin layer of fundamental web application features such as routing and middleware.</p><p>Let's first install the Express framework by running this command from the command line prompt:</p><pre class="programlisting">
<strong>npm install express --save</strong>
</pre><p>A handy utility to have installed is Nodemon (<a class="ulink" href="http://nodemon.io/">http://nodemon.io/</a>). This allows you to make changes to your code and it automatically restarts the Node.js app. You can install Nodemon by running this command from the prompt:</p><pre class="programlisting">
<strong>npm install nodemon --save</strong>
</pre><p>Instead of running the app with the node, you can now run it as follows:</p><pre class="programlisting">
<strong>nodemon app.js</strong>
</pre><p>With the Express framework installed, let's expand our current code to create a REST endpoint, which we can then use to hook up Twilio to push incoming messages:</p><pre class="programlisting">var express = require('express'); &#13;
 &#13;
var app = express(); &#13;
 &#13;
app.get('/receive', function (req, res) { &#13;
  res.send('Hi, this is the TwilioBot listening endpoint!'); &#13;
}); &#13;
 &#13;
app.listen(8080, function () { &#13;
  console.log('TwilioBot listening on port 8080.'); &#13;
}); &#13;
</pre><p>Before we can hook up our bot app to Twilio in order to process incoming messages, let's first get all the tooling wired up, so that we can publish our app as it is to Azure websites.</p><p>We'll need to install the Azure <strong>Command Line Interface</strong> (<strong>CLI</strong>) (<a class="ulink" href="https://azure.microsoft.com/en-us/documentation/articles/xplat-cli-install/">https://azure.microsoft.com/en-us/documentation/articles/xplat-cli-install/</a>) in order to push our app to Azure. We'll also need to sign up for Azure if we don't have an account.</p><p>You can do that by visiting: <a class="ulink" href="https://azure.microsoft.com">
https://azure.microsoft.com
</a> .</p><p>
</p><div><img src="img/image00167.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once you have your account set up with Azure, you may install the Azure CLI using the respective installer for your platform or as an npm package following these instructions.</p><p>Using npm, the Azure CLI can be installed as follows:</p><pre class="programlisting">
<strong>npm install azure-cli -g</strong>
</pre><p>Once you have installed the Azure CLI, let's deploy the app as it is to Azure in order to make sure all our tooling is correctly wired up.</p><p>In order to do that, run the Azure CLI and <code class="literal">login</code> to Azure:</p><pre class="programlisting">
<strong>azure login</strong>
</pre><p>Once the command has been executed, you'll see the following welcome message where you'll be asked to enable data collection:</p><p>
</p><div><img src="img/image00168.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>You may opt-in or not, the choice is yours and this doesn't affect your bot app development or usage of Azure at all.</p><p>Once you've chosen your option, you'll be prompted to enter the code displayed on the command line on this URL, <a class="ulink" href="http://aka.ms/devicelogin">
http://aka.ms/devicelogin
</a>, and then authenticate with your Microsoft Account, as follows:</p><p>
</p><div><img src="img/image00169.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the preceding screenshot, I've blanked out the Azure subscription keys and information that corresponds to my Azure account.</p><p>With this in place, your Azure CLI is all set. The next thing to do is to deploy the app to Azure using the CLI. Let's see how this can be done.</p><p>Run this command in order to create the website on Azure. Make sure you're still in the root directory of your app. Create the App Service app resource in Azure with a unique app name with the next command. Your web app's URL will be <code class="literal">http://&lt;appname&gt;.azurewebsites.net</code>.</p><p>In this case, we'll call our App Service app on Azure: <code class="literal">NodeBotSite</code> (you are free to choose any other name if this has been taken). Let's enter the following command:</p><pre class="programlisting">
<strong>azure site create --git nodebotsite</strong>
</pre><p>You'll be prompted to select the Azure region where your site will be hosted on. Feel free to choose the one closest to your location.</p><p>
</p><div><img src="img/image00170.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once you've selected the region, Azure will create your site and you'll see the following details via the command line:</p><p>
</p><div><img src="img/image00171.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Change the port from <code class="literal">8080</code> within the app to <code class="literal">process.env.port</code>, as follows:</p><pre class="programlisting">app.listen(process.env.port, function () { &#13;
  console.log('Hi, this is the TwilioBot listening endpoint!'); &#13;
}); &#13;
</pre><div><h3 class="title"><a id="note3"/>Note</h3><p>Nodemon doesn't seem to play too well with Azure; therefore, if you leave Nodemon as a dependency on your <code class="literal">package.json</code> file, you might run into problems when deploying the app to Azure. In light of this, remove from your package.json file the dependency that references Nodemon, before deploying to Azure.</p></div><p>Save your changes on both your <code class="literal">package.json</code> and <code class="literal">app.js</code> files, and then use the git command to deploy your app to Azure, as follows:</p><pre class="programlisting">
<strong>git add .</strong>
<strong>git commit -m "TwilioNodeBot first commit"</strong>
<strong>git push azure master</strong>
</pre><p>After you type these commands, if you've never set up git/FTP deployment credentials for your Azure subscription, you'll also be prompted to create them. You can also enter these credentials on the Azure Portal.</p><p>Once the git push command has finished, your app will be published on Azure and it is ready to be used.</p><p>
</p><div><img src="img/image00172.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In order to view it, open your browser and navigate to the site, receive this URL: <a class="ulink" href="http://nodebotsite.azurewebsites.net/receive">
http://nodebotsite.azurewebsites.net/receive
</a>. You should then see this:</p><p>
</p><div><img src="img/image00173.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>To make updates to your Node.js web app running on Azure, just run <code class="literal">git add</code>, <code class="literal">git commit</code>, and <code class="literal">git push</code> like you did when you deployed it first.</p><p>With Azure all wired up, the next step is to configure this URL: <a class="ulink" href="https://www.twilio.com/console/phone-numbers/incoming">
https://www.twilio.com/console/phone-numbers/incoming
</a>, on your voice number's dashboard within your Twilio account, and then click on your purchased Twilio number. Edit the <strong>Messaging</strong> | <strong>Request URL</strong> for your Twilio number and click on the <strong>Save</strong> button.</p><p>
</p><div><img src="img/image00174.jpeg" alt="Core bot functionality on Azure"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Now your Twilio is tied to your Azure app, receive URL, which will be used to receive incoming SMS.</p><p>With all these setup steps in place, we can now focus on adding the receive logic for our Twilio bot app.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Receiving SMS bot logic</h1></div></div></div><p>So far we've implemented the basic bare-bones template for our Twilio bot app and also made all the necessary configurations in order to have our solution wired up with Twilio and also easily deployable to Azure.</p><p>Let's now explore how we can make our bot reply to incoming messages. In order to do this, we'll need to have a POST endpoint on our Node/Express app. Let's examine the following code:</p><pre class="programlisting">app.post('/receive', function (req, res) { 
  var twiml = new twilio.TwimlResponse(); 
  twiml.message('Hi, this is TwilioBot'); 
 
  res.writeHead(200, {'Content-Type': 'text/xml'}); 
  res.end(twiml.toString()); 
}); 
</pre><p>We can see here that in order to reply, we create a <strong>TwiML</strong> response and send that as the response of POST / receive the HTTP endpoint.</p><p>TwiML is an XML markup language, which is simply a set of instructions you can use to tell Twilio what to do when you receive an incoming call or SMS.</p><p>Twilio makes HTTP requests to your application just like a regular web browser. By including parameters and values in its requests, Twilio sends data to your application that you can act upon before responding. This is what we are actually doing on this, receive endpoint.</p><p>Twilio sends the following parameters with its request as POST parameters or URL query parameters, depending on which HTTP method you've configured.</p><p>When we receive an SMS or a phone call on our Twilio number, Twilio will fetch the URL associated with that phone number and perform an HTTP request to that URL. This URL will contain an XML response with markup instructions, which indicate what tasks Twilio needs to execute. Some of these tasks can be to record the call, play a message, prompt the caller to enter some digits, and so on.</p><p>In this case, what our bot is doing is simply returning a one-line sentence. In short, the preceding example code is simply returning this XML back to Twilio as a response, so that Twilio can actually generate an SMS response out of it, and send it back to the sender's phone:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;Response&gt; 
&lt;Say&gt; Hi, this is TwilioBot.&lt;/Say&gt; 
&lt;/Response&gt; 
</pre><p>As you can see, it is super simple to tell Twilio to execute a specific action using TwiML. The markup language is made up of verbs highlighted in blue, which represent actions that Twilio will execute.</p><p>Some of the TwiML verbs available at the time of the writing are: Say, Play, Dial, Record, Gather, Sms, Hangup, Queue, Redirect, Pause, Conference, Reject, and Message.</p><p>Complete details on how to use these TwiML verbs can be found here: <a class="ulink" href="https://www.twilio.com/docs/api/twiml">
https://www.twilio.com/docs/api/twiml
</a>.</p><p>What we've done through the code is to use the Twilio Node.js helper library to generate the TwiML as a response, without explicitly creating the XML response itself.</p><p>So our bot starts to finally take shape. It can listen to messages and send a response back. But, how does the bot know how to act to certain inputs? In order to achieve that, the bots need to be able to understand the parameters of the incoming message and be able to act upon it.</p><p>Twilio sends several parameters with its request as POST parameters or URL query parameters, depending on which HTTP method you've configured on the Twilio number's dashboard for incoming SMS. Please take a moment to go through and understand this list thoroughly.</p><p>Here are some of the prominent properties that Twilio uses:</p><div><ul class="itemizedlist"><li class="listitem"><strong>From:</strong> The phone number that sent this message.</li><li class="listitem"><strong>To</strong>: The phone number of the recipient.</li><li class="listitem"><strong>Body</strong>: The text body of the message. It can be up to 1,600 characters long.</li><li class="listitem"><strong>MessageSid</strong>: A 34 character unique identifier for the message. It may be used to later retrieve this message from the REST API.</li><li class="listitem"><strong>SmsSid</strong>: The same value as MessageSid. It is deprecated and included for backward compatibility.</li></ul></div><p>The full list of parameters can be found here: <a class="ulink" href="https://www.twilio.com/docs/api/twiml/sms/twilio_request">
https://www.twilio.com/docs/api/twiml/sms/twilio_request
</a>.</p><p>So in order to write some logic that acts upon the input of the nature of the messages received, it is necessary to inspect the value of the parameters that are received as part of the <code class="literal">request.body</code> object. These parameters will have properties on this object.</p><p>So for instance, if we want to know from which number the message came from, we would have to do something like this:</p><pre class="programlisting">var from = req.body.From; 
</pre><p>The actual received text message itself would be obtained as follows:</p><pre class="programlisting">var body = req.body.Body; 
</pre><p>Knowing from where the message originates and the actual contents, we can then build some logic to internally give the bot some sense of what to do with the input received and act upon it.</p><p>So, let's add some core functionality, which for now we will call <code class="literal">BotBrain</code> and we don't really know what it will do. This will give us an answer based on the input we provide to it, independently of which bot we will be building.</p><p>In the next chapter, we'll be creating the logic of this <code class="literal">BotBrain</code>, and throughout the chapters keep adding subsequent and additional functionality to it, but for now, let's assume this <code class="literal">BotBrain</code> gives the bot the answer required based on the input received:</p><pre class="programlisting">app.post('/receive', function (req, res) { 
  var twiml = new twilio.TwimlResponse(); 
  var feedback = BotBrains(req.body); 
  twiml.message(feedback); 
 
  res.writeHead(200, {'Content-Type': 'text/xml'}); 
  res.end(twiml.toString()); 
}); 
</pre><p>As we can see now, the bot will respond to the incoming request based on the results the <code class="literal">BotBrains</code> will determine, by analyzing the properties of the <code class="literal">request.body</code> object.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Summary</h1></div></div></div><p>In this chapter, we've set the foundations on how our bot will be deployed, configured, and set up. We've also created a bare-bones template that we will use throughout the rest of the chapters in this book, in order to add more exciting functionalities.</p><p>We've also explored some of the key components that will make it work from an infrastructure point of view and how we can host it on Azure, Microsoft's awesome cloud platform.</p><p>Beyond this, we've explained why bots matter and why they are a key component for your business to be aware of and considered in your strategy.</p><p>Further to that, we've explored the basics of Twilio as a messaging platform and started to scratch the surface of what is possible to achieve with it.</p><p>In the chapters to follow, we'll be adding many more layers and interacting with other APIs and services; however, we'll still use Twilio as a backup messaging provider by also using SMS.</p><p>Hopefully you've got an idea of what to expect coming ahead and also this has gotten you excited in our quest to add more layers and logic to our bot.</p><p>Thanks for reading!</p></div></body></html>