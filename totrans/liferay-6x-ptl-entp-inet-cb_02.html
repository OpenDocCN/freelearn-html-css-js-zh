<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Authentication and Registration Process</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Changing the default authentication settings</li><li class="listitem">Setting up e-mail notifications</li><li class="listitem">Customizing the registration form</li><li class="listitem">Overriding the default login page with the administrator-defined page</li><li class="listitem">Setting up a password policy</li><li class="listitem">Integration with CAS SSO</li><li class="listitem">CAS and Liferay users' database</li><li class="listitem">Liferay and the LDAP integration</li><li class="listitem">The magic trio: Liferay, CAS, and LDAP</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Introduction</h1></div></div></div><p>The authentication and registration processes are very important to build intranet systems. In this type of software, it is necessary to protect data against non-authorized users. We decided to describe typical solutions that are commonly used in many projects. It will help you configure the out-of-the box authentication system in Liferay and define the password policy. You will also learn about integration with the most popular single sign-on mechanism (SSO). The purpose of an SSO is to permit a user to access multiple applications<a id="id62" class="indexterm"/> while providing their credentials only once. The <strong>Central Authentication Service</strong> (<strong>CAS</strong>) is a single sign-on protocol for the Web. It is also a software package that implements this protocol.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Changing the default authentication settings</h1></div></div></div><p>Liferay provides a built-in authentication mechanism that, by default, allows users to log in using their e-mail address. Additionally, there are a number of functionalities, such as automatic log in or forgotten password functionality, that assist users and help them go through the <a id="id63" class="indexterm"/>authentication process. However, in some cases, the standard authentication behavior must be modified.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Getting ready</h2></div></div></div><p>Log in to Liferay as a user with administrator credentials. By default, the credentials are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><strong>E-mail</strong>: test@liferay.com</li><li class="listitem"><strong>Password</strong>: test</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How to do it…</h2></div></div></div><p>In order to change the default authentication settings, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>Authentication section</strong>:<div><img src="img/image00299.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Make sure that you are in the <strong>General</strong> tab.</li><li class="listitem">Choose the option that you prefer from the <strong>Authentication type</strong> drop-down list.</li><li class="listitem">Enable/disable the <strong>Allow users to automatically login?</strong> option.</li><li class="listitem">Enable/disable the <strong>Allow users to request forgotten passwords?</strong> option.</li><li class="listitem">Enable/disable the <strong>Allow users to request password reset links?</strong> option.</li><li class="listitem">Enable/disable the <strong>Allow strangers to create accounts?</strong> option.</li><li class="listitem">Enable/disable the <strong>Allow strangers to create accounts with a company email address?</strong> option.</li><li class="listitem">Enable/disable the <strong>Require strangers to verify their email address?</strong> option.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>In order to <a id="id64" class="indexterm"/>set only the authentication type for a particular instance of the <strong>Sign in</strong> portlet, you do not need to perform the additional steps in the <strong>Control Panel</strong> scope. In this case, it is enough to change the configuration in the Sign in portlet. Perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the public page on which the <strong>Sign in</strong> portlet should be placed.</li><li class="listitem">Click on the <strong>Add</strong> button.</li><li class="listitem">Click on the <strong>Applications</strong> button.</li><li class="listitem">Find the <strong>Sign in</strong> portlet using the search option or by browsing the list of available portlets.</li><li class="listitem">Click on the <strong>Add</strong> link next to the portlet name. The <strong>Sign in</strong> portlet with basic configuration will be added to the page.</li><li class="listitem">Go to the <strong>Sign in</strong> portlet configuration.</li><li class="listitem">Choose the option that you prefer from the <strong>Authentication type</strong> list.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec31"/>How it works…</h2></div></div></div><p>In Liferay Portal, a user can be authenticated by their e-mail address, a screen name or a numerical sequence, or an auto-generated user ID. There are two places that allow you to set the preferred authentication method: the portal settings section and the configuration screen of the Sign in portlet. The Control Panel settings enable you to define the default authentication type. This setting can also be modified by the properties in <code class="literal">portal-ext.properties</code>:</p><div><pre class="programlisting">company.security.auth.type=emailAddress
company.security.auth.type=screenName
company.security.auth.type=userId</pre></div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>Remember that more important configuration comes from GUI (Control Panel) than from <code class="literal">portal-ext.properties</code>.</p></div><p>However, the Sign in portlet configuration option allows you to decide which way of authentication will be used for a particular Sign in portlet. Within the portlet, it is possible to choose the <em>default</em> option or one of the three available options, described previously. The default option is the same as the <code class="literal">company.security.auth.type</code> property.</p><p>In addition to selecting the <strong>Authentication</strong> type, Liferay also allows you to set additional parameters that influence the authorization and authentication processes. By default, all options, except the <strong>Require strangers to verify their email address?</strong> option, are enabled.</p><p>The <strong>Allow users to automatically login?</strong> option allows you to decide whether the site should remember the user's login and show the <strong>Remember me</strong> checkbox within the <strong>Sign in</strong> form. This <a id="id65" class="indexterm"/>option can be enabled (true) or disabled (false) by setting the following properties:</p><div><pre class="programlisting">company.security.auto.login=true</pre></div><p>The <strong>Allow users to request forgotten passwords?</strong> option is responsible for enabling or disabling the forgotten password functionality. This functionality makes it possible for users to request for a new password to be sent to their e-mail addresses. By default, this option is enabled in the following properties:</p><div><pre class="programlisting">company.security.send.password=true</pre></div><p>The <strong>Allow users to request password reset links?</strong> option is responsible for enabling or disabling the reset password functionality. This functionality allows users to request for a password reset link to be sent to their e-mail addresses. This option is represented by the following properties:</p><div><pre class="programlisting">company.security.send.password.reset.link=true</pre></div><p>The <strong>Allow strangers to create accounts?</strong> option is responsible for the availability of the link to create an account. This option lets you decide whether users who are guests to the site are allowed to create accounts by themselves. By default, it is enabled as follows:</p><div><pre class="programlisting">company.security.strangers=true</pre></div><p>The <strong>Allow strangers to create accounts with a company email address?</strong> option allows you to decide whether a new account can be created using the e-mail address in the domain provided in the General section of the Portal settings:</p><div><pre class="programlisting">company.security.strangers.with.mx=true</pre></div><p>The <strong>Require strangers to verify their email address?</strong> option enables an e-mail verification functionality. This functionality also can be enabled in <code class="literal">portal-ext.properties</code> by setting the following properties:</p><div><pre class="programlisting">company.security.strangers.verify=false</pre></div><p>Although the <strong>Authentication</strong> section consists of a number of tabs providing a range of additional authentication methods, all the settings gathered on the <strong>General</strong> tab of the <strong>Authentication</strong> tab affect only the Liferay functionality. They have no influence on the integration options grouped on the remaining tabs.</p><p>In some <a id="id66" class="indexterm"/>cases, the preceding configuration is not enough. For instance, many companies have their own privacy policy that requires an <code class="literal">HTTPS</code> connection. Liferay provides several settings in <code class="literal">portal.properties</code>, which can be overridden in <code class="literal">portal-ext.properties</code>, they are as follows:</p><div><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Properties</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>
<code class="literal">company.security.auth.requires.https=false</code>
</p>
</td><td valign="top">
<p>Set this to <code class="literal">true</code> to ensure that users login with HTTPS</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">company.security.auto.login.max.age=31536000</code>
</p>
</td><td valign="top">
<p>Specify max age (in seconds) of the browser cookie that enables the <em>Remember me</em> feature</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">company.security.login.form.autocomple=true</code>
</p>
</td><td valign="top">
<p>Allows users to autocomplete the login form based on their previously entered values</p>
</td></tr></tbody></table></div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>Modification in the <code class="literal">portal-ext.properties</code> file is needed for a server restart.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec32"/>There's more…</h2></div></div></div><p>There are two more options strictly connected to the login and logout mechanisms. The first one, the <strong>Default Landing Page</strong> field, is located in the <strong>Portal Settings</strong> web page. This field allows you to indicate the page a user will be redirected to after completing the authorization and authentication. The second, the <strong>Default Logout Page</strong> field, located in <strong>Portal Settings</strong>, allows you to define the page a user will be redirected to after logging out.</p><p>In order to <a id="id67" class="indexterm"/>set custom<a id="id68" class="indexterm"/> values to these fields, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>General</strong>.</li><li class="listitem">Set <strong>Default Landing Page</strong> to the address of the page you want users to go to after<a id="id69" class="indexterm"/> logging in, for example, <code class="literal">/web/guest/login</code>.</li><li class="listitem">Set <strong>Default Logout Page</strong> to the address of the page you want users to go to after logging<a id="id70" class="indexterm"/> out, for example, <code class="literal">/web/guest/logout</code>.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>These settings <a id="id71" class="indexterm"/>could also be overridden by <code class="literal">portal-ext.properties</code> by the following names:</p><div><pre class="programlisting">default.landing.page.path={PATH}
default.logout.page.path={PATH}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec33"/>See also</h2></div></div></div><p>For information on overriding the default login page, refer to the <em>Overriding the default login page with the administrator defined page</em> recipe.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Setting up e-mail notifications</h1></div></div></div><p>In Liferay, there<a id="id72" class="indexterm"/> are four automatically sent e-mail notifications. They are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Account Created Notification</strong>, which is sent when a user successfully creates a new account</li><li class="listitem"><strong>Email Verification Notification</strong>, which provides the e-mail verification link and code</li><li class="listitem"><strong>Password Changed Notification</strong>, which informs a user that their password has been changed</li><li class="listitem"><strong>Password Reset Notification</strong>, which enables a user to reset their current password by providing the password reset URL</li></ul></div><p>This recipe provides information on how these default notifications can be customized.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Getting ready</h2></div></div></div><p>Make sure that the Java mail session is properly configured. To check whether it works, look at <code class="literal">portal-ext.properties</code> and find and/or configure the following settings:</p><div><pre class="programlisting">mail.session.mail.pop3.host=localhost
mail.session.mail.pop3.password=
mail.session.mail.pop3.port=110
mail.session.mail.pop3.user=
mail.session.mail.smtp.auth=false
mail.session.mail.smtp.host=localhost
mail.session.mail.smtp.password=
mail.session.mail.smtp.port=25
mail.session.mail.smtp.user=
mail.session.mail.store.protocol=pop3
mail.session.mail.transport.protocol=smtp</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec35"/>How to do it…</h2></div></div></div><p>In order to <a id="id73" class="indexterm"/>change the sender's name and e-mail address, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>Email Notifications</strong>.</li><li class="listitem">Make sure you are in the <strong>Sender</strong> tab.</li><li class="listitem">Provide the sender's name and e-mail address.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>In order to set <strong>Account Created Notification</strong>, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>Email Notifications</strong>.</li><li class="listitem">Go to the <strong>Account Created Notification</strong> tab.</li><li class="listitem">Set the <strong>Enabled</strong> option.</li><li class="listitem">Provide <strong>Subject</strong>.</li><li class="listitem">Provide the <strong>Body with Password</strong> message text.</li><li class="listitem">Provide the <strong>Body without Password</strong> message text.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>The following screenshot captures the preceding steps</p><div><img src="img/image00300.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>In addition <a id="id74" class="indexterm"/>to <strong>Account Created Notification</strong>, Liferay provides three tabs to customize. They are as follows:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Email Verification Notification</strong></li><li class="listitem"><strong>Password Changed Notification</strong></li><li class="listitem"><strong>Password Reset Notification</strong></li></ul></div><p>In order to set <strong>Email Verification Notification</strong>, <strong>Password Changed Notification</strong>, or <strong>Password Reset Notification</strong>, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>Email Notifications</strong>.</li><li class="listitem">Go to the <strong>Email Verification Notification</strong>, <strong>Password Changed Notification</strong>, or <strong>Password Reset Notification</strong> tab.</li><li class="listitem">Provide the subject and body of the message.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec36"/>How it works…</h2></div></div></div><p>Every e-mail<a id="id75" class="indexterm"/> notification consists of the subject and the body of the message. Both the subject and the body of the message can be composed using a set of available variables called terms (different for each notification) and custom text. The text of the body of the message can also be provided with simple text styles.</p><p>It is worth noticing that the <strong>Account Created Notification</strong> tab provides an additional <strong>Enabled</strong> option that allows you to decide whether this particular notification should be sent or not.</p><p>By default, <code class="literal">portal.properties</code> contains basic e-mail notification settings (default sender name, default sender e-mail, subject, body, and so on). Of course, all these settings can be customized to specific requirements:</p><div><pre class="programlisting">admin.email.from.name=Joe Bloggs
admin.email.from.address=test@liferay.com
admin.email.user.added.enabled=true
admin.email.user.added.subject=com/liferay/portlet/admin/dependencies/email_user_added_subject.tmpl

admin.email.user.added.body=com/liferay/portlet/admin/dependencies/email_user_added_body.tmpl

admin.email.user.added.no.password.body=com/liferay/portlet/admin/dependencies/email_user_added_no_password_body.tmpl

admin.email.password.reset.subject=com/liferay/portlet/admin/dependencies/email_password_reset_subject.tmpl

admin.email.password.reset.body=com/liferay/portlet/admin/dependencies/email_password_reset_body.tmpl

admin.email.password.sent.subject=com/liferay/portlet/admin/dependencies/email_password_sent_subject.tmpl

admin.email.password.sent.body=com/liferay/portlet/admin/dependencies/email_password_sent_body.tmpl

admin.email.verification.subject=com/liferay/portlet/admin/dependencies/email_verification_subject.tmpl

admin.email.verification.body=com/liferay/portlet/admin/dependencies/email_verification_body.tmpl</pre></div><p>The preceding <a id="id76" class="indexterm"/>configuration defines the default settings for every type of notification. For instance, the <code class="literal">admin.email.password.reset.body</code> property defines the HTML template for the password reset action, which is located in the <code class="literal">com/liferay/portlet/admin/dependencies/email_password_reset_body.tmpl</code> file.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec37"/>See also</h2></div></div></div><p>For information on how to configure SMTP servers, refer to the <em>Configuring Liferay with the SMTP server</em> recipe in <a class="link" title="Chapter 11. Quick Tricks and Advanced Knowledge" href="part0080.xhtml#aid-2C9D01">Chapter 11</a>, <em>Quick Tricks and Advanced Knowledge</em>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Customizing the registration form</h1></div></div></div><p>The content of the registration form and the behavior of the system after completing the registration process can vary, depending on the system's functional and non-functional requirements. The <a id="id77" class="indexterm"/>default configuration of the registration form enables you to gather the data strictly required to create an account. The configuration also provides some additional fields, such as birth date or gender, which may not be always desirable. This recipe describes how to change the default set of registration form fields and modify their basic preferences and system behavior within the registration and authorization processes.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How to do it…</h2></div></div></div><p>In order to customize the registration form, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Login as an administrator and go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal settings</strong> | <strong>Users</strong>:<div><img src="img/image00301.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Make sure that you are in the <strong>Fields</strong> tab.</li><li class="listitem">Enable/disable the <strong>Terms of Use Required</strong> option.</li><li class="listitem">Enable/disable the <strong>Autogenerate User Screen Names</strong> option.</li><li class="listitem">Enable/disable the <strong>Last Name Required</strong> option.</li><li class="listitem">Enable/disable the <strong>Enable Birthday</strong> option.</li><li class="listitem">Enable/disable the <strong>Enable Gender</strong> option.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How it works…</h2></div></div></div><p>There are three<a id="id78" class="indexterm"/> tabs that group the registration form settings: the <strong>Fields</strong> tab, the <strong>Reserved Credentials</strong> tab, and the <strong>Default User Associations</strong> tab.</p><p>The <strong>Fields</strong> tab consists of the list of options that are responsible for the content of the registration form and behavior of the system when a user logs in for the first time. Each of these options has its own representation in <code class="literal">portal.properties</code>, which can be overridden by <code class="literal">portal-ext.properties</code>. Remember that the highest priorities have settings that come from <strong>Control Panel</strong>. There are following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Terms of Use Required</strong> option enables and disables the terms of use screen, which is shown after the user's first authorization. By default, it is enabled:<div><pre class="programlisting">terms.of.use.required=true</pre></div></li><li class="listitem">The <strong>Autogenerate User Screen Names</strong> option disables the screen name field in the registration form and sets Liferay to create the screen name automatically from the e-mail address. If this option is enabled, the screen name is generated from the user's e-mail address (local part of the e-mail address). By default, it is disabled:<div><pre class="programlisting">users.screen.name.always.autogenerate=false</pre></div></li><li class="listitem">The <strong>Last Name Required</strong> option sets the last name as a required field. By default, it is disabled:<div><pre class="programlisting">users.last.name.required=false</pre></div></li><li class="listitem">The <strong>Enable Birthday</strong> option allows you to decide whether the birthday field should be available in the registration form. By default, it is enabled:<div><pre class="programlisting">field.enable.com.liferay.portal.model.Contact.birthday=true</pre></div></li><li class="listitem">The <strong>Enable Gender</strong> option allows you to decide whether the gender field should be available in the registration form. By default, it is enabled:<div><pre class="programlisting">field.enable.com.liferay.portal.model.Contact.male=true</pre></div></li></ul></div><p>The <strong>Reserved Credentials</strong> tab allows you to define screen names and e-mail addresses that are<a id="id79" class="indexterm"/> reserved and cannot be used to create user accounts both by users and administrators. It also can be overwritten in the following properties:</p><div><pre class="programlisting">admin.reserved.screen.names
admin.reserved.email.addresses</pre></div><p>The <strong>Default User Associations</strong> tab provides a set of fields that enable you to assign sites, organization sites, roles, and user groups to each newly created user.</p><p>In addition, it is also possible to extend the functionality on existing users using the <strong>Apply to Existing Users</strong> option. However, changes will take effect when the user signs in.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec40"/>There's more…</h2></div></div></div><p>It is possible to change the default behavior of the create account link in the Sign in form and use a custom page with the custom create account portlet instead of the default (Sign in portlet) one. In order to do so, define the URL where the custom registration portlet is placed and set a property in the <code class="literal">portal-ext.properties</code> file as follows:</p><div><pre class="programlisting">company.security.strangers.url=/create-account</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec41"/>See also</h2></div></div></div><p>For information about adding users, refer to the <em>Adding a new user</em> recipe in <a class="link" title="Chapter 3. Working with a Liferay User / User Group / Organization" href="part0030.xhtml#aid-SJGS1">Chapter 3</a>, <em>Working with a Liferay User / User Group / Organization</em>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Overriding the default login page with the administrator defined page</h1></div></div></div><p>Liferay provides the possibility to use or replace the default dialog login feature with a custom<a id="id80" class="indexterm"/> login page. The <a id="id81" class="indexterm"/>custom page can be used to present some additional information such as instructions, description of benefits, and so on. This recipe provides guidelines on how to set such a page within the intranet.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it…</h2></div></div></div><p>In order to set a custom page in the login process, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Pages</strong>.</li><li class="listitem">Make sure that you are in the <strong>Public Pages</strong> tab.</li><li class="listitem">Click on the <strong>Add page</strong> button.</li><li class="listitem">Provide a name for the page (for instance, login).</li><li class="listitem">Enable the <strong>Hide from Navigation Menu</strong> option.</li><li class="listitem">Click on the <strong>Add page</strong> button. The new page will be created.</li><li class="listitem">Go to the page's details by clicking on the page in the tree that was created and copy the <strong>Friendly URL</strong> value.</li><li class="listitem">Go to the created page by typing (or pasting) its address in the browser's address bar.</li><li class="listitem">Click on the add button (this is a <strong>+</strong> sign on the left-hand side).</li><li class="listitem">Click on the <strong>Applications</strong> tab.</li><li class="listitem">Find the Sign in portlet using the search function or by browsing the list of available portlets,</li><li class="listitem">Click on the <strong>Add</strong> link next to the portlet name. The Sign in portlet with basic configuration will be added to the page.</li><li class="listitem">Set URL to this site in the <code class="literal">portal-ext.properties</code> file by defining the <code class="literal">auth.login.site.url=/login</code> property.</li></ol><div></div><div><h3 class="title"><a id="note05"/>Note</h3><p>If there is a custom login portlet and custom page to login, it is required that you disable the dialog login functionality by setting the <code class="literal">login.dialog.disabled=true</code> property.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works…</h2></div></div></div><p>As described previously, the first step is to create a new standard page containing a Sign in portlet. This page will be used as a new login page. The second step is to override the default<a id="id82" class="indexterm"/> Liferay configuration <a id="id83" class="indexterm"/>and set it to use this newly created login page whenever the user is navigating a site and authentication is needed. In order to do so, you need to set the new link in the <code class="literal">auth.login.site.url</code> property. It is also important to remember that when redirecting the <em>Sign in</em> link to the custom page, it is necessary to disable the standard login popup dialog. It can be achieved by setting the <code class="literal">login.dialog.disabled</code> property to <code class="literal">true</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec44"/>See also</h2></div></div></div><p>If you want to learn about creating pages or defining page templates, refer to the following recipes from <a class="link" title="Chapter 4. Liferay Site Configuration" href="part0037.xhtml#aid-1394Q1">Chapter 4</a>, <em>Liferay Site Configuration</em>:</p><div><ul class="itemizedlist"><li class="listitem"><em>Creating and customizing private and public pages for the site</em></li><li class="listitem"><em>Using page templates and site templates for quick site and page creation</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Setting up a password policy</h1></div></div></div><p>The Liferay password policy creator allows you to set the password life cycle and rules of employing it. You can decide whether the password should be changed. You can also specify the <a id="id84" class="indexterm"/>password syntax, the expiration rules, the lockout options, and the password history.</p><p>The default password policy provided by Liferay is very simple. It enables you to change the password of users and specifies that the reset password link should be valid for one day. This recipe provides a detailed description on how to create a new, more restricted password policy.</p><p>The password policy in this example will require the users to provide eight-character passwords, which cannot be found in a dictionary. Users must include numbers and uppercase letters in the password, and it must be changed every sixty days (it should not be possible to set the password that has been used last ten times). Additionally, the system will count the failure login attempts and block the account for 10 minutes after three unsuccessful tries.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How to do it…</h2></div></div></div><p>In order to set the described password policy, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Users</strong> | <strong>Password policies</strong>.</li><li class="listitem">Click<a id="id85" class="indexterm"/> on the <strong>Add</strong> button.<div><img src="img/image00302.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a name for the new password policy.</li><li class="listitem">Provide a description of the new password policy.</li><li class="listitem">Enable <a id="id86" class="indexterm"/>the <strong>Changeable</strong> option.</li><li class="listitem">Set the <strong>Reset Ticket Max Age</strong> option to <strong>1 Day</strong>.</li><li class="listitem">Enable the <strong>Syntax Checking Enabled</strong> option.</li><li class="listitem">Disable the <strong>Allow Dictionary Words</strong> option.</li><li class="listitem">Set <strong>Minimum Length</strong> to <strong>8</strong>.</li><li class="listitem">Set <strong>Minimum Upper Case</strong> to <strong>1</strong>.</li><li class="listitem">Set <strong>Minimum Numbers</strong> to <strong>1</strong>.</li><li class="listitem">Enable the <strong>History Enabled</strong> option.</li><li class="listitem">Set the <strong>History Count</strong> option to <strong>10</strong>.</li><li class="listitem">Enable the <strong>Expiration Enabled</strong> option.</li><li class="listitem">Set <strong>Maximum Age</strong> to <strong>8 Weeks</strong>.</li><li class="listitem">Set <strong>Warning Time</strong> to <strong>6 Days</strong>.</li><li class="listitem">Set the <strong>Lockout Enabled</strong> option.</li><li class="listitem">Set <strong>Maximum Failure</strong> to <strong>3</strong>.</li><li class="listitem">Set <strong>Lockout Duration</strong> to <strong>10 Minutes</strong>.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec46"/>How it works…</h2></div></div></div><p>There are five groups of options in the new password policy form: <strong>General</strong>, <strong>Password Syntax Checking</strong>, <strong>Password History</strong>, <strong>Password Expiration</strong>, and <strong>Lockout sections</strong>.</p><p>The General section consists of the following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Changeable</strong> option allows you to decide whether users can change their passwords</li><li class="listitem">The <strong>Change Required</strong> option determines whether a user is required to change the password on first login</li><li class="listitem">The <strong>Minimum Age</strong> option specifies the amount of time a user must wait before they will be allowed to change the password</li><li class="listitem">The <strong>Reset Ticket Max Age</strong> option determines for how long a password reset link is valid</li></ul></div><p>The <strong>Password Syntax Checking</strong> section consists of the following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Syntax Checking Enabled</strong> option determines whether the password syntax should be checked</li><li class="listitem">The <strong>Allow Dictionary</strong> option determines whether common words are allowed to be used in passwords</li><li class="listitem">The <strong>Minimum Alpha Numeric</strong> option allows you to set the required minimum number of alphanumeric letters in the password</li><li class="listitem">The <strong>Minimum Length</strong> option determines the required minimum length of the<a id="id87" class="indexterm"/> password</li><li class="listitem">The <strong>Minimum Lower Case</strong> option determines the required minimum number of lowercase letters in the password</li><li class="listitem">The <strong>Minimum Numbers</strong> option determines the required minimum number of numbers in the password</li><li class="listitem">The <strong>Minimum Symbols</strong> option determines the required minimum number of symbols in the password</li><li class="listitem">The <strong>Minimum Upper Case</strong> option determines the minimum number of uppercase letters in the password</li><li class="listitem">The <strong>Regular Expression</strong> option determines the validation pattern for the user's password</li></ul></div><p>The <strong>Password History</strong> section consists of the following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>History Enabled</strong> option allows you to decide whether the portal should keep a history of the user's previous passwords in order to prevent them from reusing an old password</li><li class="listitem">The <strong>History Count</strong> option determines the number of previous passwords, which are kept in the history and cannot be used while setting a new password</li></ul></div><p>The <strong>Password Expiration</strong> section consists of the following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Expiration Enabled</strong> option allows you to decide whether users are forced to periodically change their passwords</li><li class="listitem">The <strong>Maximum Age</strong> option determines for how long a password is valid</li><li class="listitem">The <strong>Warning Time</strong> specifies the amount of time before the password expiration date; a notification will be sent after this date</li><li class="listitem">The <strong>Grace Limit</strong> specifies the number of times a user can log in after their password has expired</li></ul></div><p>The <strong>Lockout</strong> section consists of the following options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Lockout Enabled</strong> option lets you to count the unsuccessful login attempts and enable account-locking mechanisms</li><li class="listitem">The <strong>Maximum Failure</strong> option specifies the maximum number of unsuccessful login attempts</li><li class="listitem">The <strong>Reset Failure Count</strong> option specifies the amount of time that an information<a id="id88" class="indexterm"/> of unsuccessful logins is kept</li><li class="listitem">The <strong>Lockout Duration</strong> option indicates the amount of time that a user's account remains blocked and cannot be used</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Integration with CAS SSO</h1></div></div></div><p>CAS is a <a id="id89" class="indexterm"/>single sign-on protocol. The official specification introduces it as follows:</p><div><blockquote class="blockquote"><p><em>"The Central Authentication Service (CAS) is a single-sign-on / single-sign-off protocol for the web. It permits a user to access multiple applications while providing their credentials (such as userid and password) only once to a central CAS Server application."</em></p></blockquote></div><p>Liferay <a id="id90" class="indexterm"/>provides ready-to-use functionality based on JASIG CAS (CAS became a <strong>Java in Administration Special Interest Group</strong> (<strong>JASIG</strong>) project in <a id="id91" class="indexterm"/>December 2004 and is now also known as JASIG CAS). In many projects, especially internal ones (for instance, intranet) it is necessary to provide single sign-on. CAS integrates with the following authentication mechanisms:</p><div><ul class="itemizedlist"><li class="listitem">Active Directory</li><li class="listitem">Generic</li><li class="listitem">JAAS</li><li class="listitem">JDBC</li><li class="listitem">LDAP</li><li class="listitem">Legacy</li><li class="listitem">RADIUS</li><li class="listitem">SPNEGO</li><li class="listitem">Trusted</li><li class="listitem">X.509 certificates</li></ul></div><p>This recipe covers the basic steps to install a CAS server and to integrate it with Liferay.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec47"/>How to do it…</h2></div></div></div><p>In order to install and run a CAS server that works with Liferay, there are four main steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Install the CAS system on the Tomcat server.</li><li class="listitem">Configure an HTTPS connection.</li><li class="listitem">Set the CAS server.</li><li class="listitem">Configure Liferay Portal.</li></ol><div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec14"/>Installing the CAS system</h3></div></div></div><p>The first step is installing the CAS system on the Apache Tomcat server. The CAS can be deployed in the<a id="id92" class="indexterm"/> same instance as Liferay, but in the real-world example, it is a dedicated application server. We assume the first approach. The second important assumption is that we rely on Tomcat hot-deploy of archives. So, make sure that the <code class="literal">autoDeploy</code> option is set to <code class="literal">true</code>. This is a default setting. To install CAS, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the<a id="id93" class="indexterm"/> newest version of CAS from <a class="ulink" href="http://downloads.jasig.org/cas/">http://downloads.jasig.org/cas/</a> and unzip archive. At this moment, 4.0 is the newest version.</li><li class="listitem">Deploy <code class="literal">cas-server-4.0.0/modules/cas-server-webapp-4.0.0.war</code> into the Tomcat server by copying the <code class="literal">cas-server-webapp-4.0.0.war</code> application into the <code class="literal">${TOMCAT_HOME}/webapps</code> folder or using Tomcat Manager (if it is available). In the <code class="literal">catalina.out</code> logfile, you should see similar information:<div><pre class="programlisting">INFO: Deploying web application archive /home/user/apps/liferay/liferay-portal-6.2-ce-ga2/tomcat-7.0.42/webapps/cas-server-webapp-4.0.0.war</pre></div></li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec15"/>Configuring the HTTPS connection</h3></div></div></div><p>The next important step is to establish an HTTPS connection between Liferay and CAS. By default, CAS sends the single sign-on cookie (CASTGC) only over secure connections. In <a id="id94" class="indexterm"/>our case, we will use a Java <em>keytool </em>to generate the SSL certificate. Java keytool is a key and certificate-management utility. It allows users to manage their own public/private key pairs and certificates. Basically, this tool stores keys and certificates in the <em>keystore</em>. This is a repository implemented as a file and placed on the local hard drive. Our goal is to generate a certificate, export it as a file, and place it in the truststore (<code class="literal">$JAVA_HOME/jre/lib/security/cacerts</code>). These instructions set up Tomcat's keystore file with a self-signed certificate (self-signed certificates should <em>never</em> be used for anything beyond development environment):</p><div><ol class="orderedlist arabic"><li class="listitem">In any directory, type the command that generates a new key and puts it in the local keystore called <code class="literal">keystore.jks</code>:<div><pre class="programlisting">keytool -genkey -alias tomcat -keypass changeit -keyalg RSA -keystore keystore.jks</pre></div><div><h3 class="title"><a id="note06"/>Note</h3><p>Make sure that you provide the <code class="literal">$JAVA_HOME/jre/lib/security/cacerts</code> keystore password. Both passwords must be the same.</p></div><p>The following list shows how the key-generation process looks:</p><div><pre class="programlisting">Enter keystore password: 
Re-enter new password:
What is your first and last name?
  [Unknown]:  $REPLACE_WITH_FULL_MACHINE_NAME
What is the name of your organizational unit?
  [Unknown]:  IT
What is the name of your organization?
  [Unknown]:  Liferay
What is the name of your City or Locality?
  [Unknown]:  Warsaw
What is the name of your State or Province?
  [Unknown]:  
What is the two-letter country code for this unit?
  [Unknown]:  PL
Is CN=$FULL_MACHINE_NAME, OU=IT, O=Liferay, L=Warsaw, ST=, C=PL correct?
  [no]:  yes</pre></div><div><h3 class="title"><a id="note07"/>Note</h3><p>The value of the <code class="literal">first and last name</code> field mentioned previously must be set to a fully qualified domain name. On Windows, the fully qualified machine name appears as a full computer name. On Linux, this is a host name.</p></div></li><li class="listitem">Export <a id="id95" class="indexterm"/>the key to a file called <code class="literal">tomcat.cert</code>:<div><pre class="programlisting">keytool -export -alias tomcat -keypass changeit -file tomcat.cert -keystore keystore.jks</pre></div></li><li class="listitem">Import the key to the <code class="literal">$JAVA_HOME/jre/lib/security/cacerts</code> truststore:<div><pre class="programlisting">keytool -import -alias tomcat -file tomcat.cert -keypass changeit -keystore $JAVA_HOME/jre/lib/security/cacerts</pre></div></li><li class="listitem">Check whether your certificate was successfully imported in the Java truststore:<div><pre class="programlisting">keytool -list -v -alias tomcat -keystore $JAVA_HOME/jre/lib/security/cacerts</pre></div></li><li class="listitem">Edit<a id="id96" class="indexterm"/> the <code class="literal">server.xml</code> file in the<code class="literal"> ${TOMCAT_HOME}/conf</code> folder and uncomment the SSL section to open up port 8443:<div><pre class="programlisting">&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true" maxThreads="150" scheme="https" secure="true" clientAuth="false" sslProtocol="TLS" /&gt;</pre></div></li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec16"/>Setting the CAS server</h3></div></div></div><p>In this step, we <a id="id97" class="indexterm"/>will define a map of users that can be authenticated in our Liferay system. To achieve it, go to the <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF</code> folder, edit <code class="literal">deployerConfigContext.xml</code>, and modify the bean definition.</p><p>Set users list by adding them into <code class="literal">users</code> property. Here is an example:</p><div><pre class="programlisting">&lt;bean id="primaryAuthenticationHandler" class="org.jasig.cas.authentication.AcceptUsersAuthenticationHandler"&gt;
  &lt;property name="users"&gt;
    &lt;map&gt;
      &lt;entry key="casuser" value="Mellon"/&gt;
      &lt;entry key="joebloggs" value="test" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre></div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>Remember that a user must be created in the Liferay Portal.</p></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec17"/>Configuring Liferay Portal</h3></div></div></div><p>The last set <a id="id98" class="indexterm"/>of steps is a Liferay configuration. Our goal is to change the authentication type, which should be based on <code class="literal">screenName</code> (login), and enable the CAS authentication method. To achieve this, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">In Liferay, set the authentication type based on <code class="literal">screenName</code> (login). The portal can authenticate users based on their e-mail addresses, <code class="literal">screenName</code>, or <code class="literal">userId</code>. Change the default option and set a new value of the authentication type in <code class="literal">${liferay.home}/portal-ext.properties</code>:<div><pre class="programlisting">company.security.auth.type=screenName</pre></div></li><li class="listitem">Enable the CAS authentication by setting specific properties in <code class="literal">${liferay.home}/portal-ext.properties</code>:<div><pre class="programlisting">cas.auth.enabled=true
cas.import.from.ldap=false
cas.login.url=https://localhost:8443/cas-server-webapp-4.0.0/login
cas.logout.url=https://localhost:8443/cas-server-webapp-4.0.0/logout
cas.server.name=localhost:8443
cas.server.url=https://localhost:8443/cas-server-webapp-4.0.0
cas.no.such.user.redirect.url=https://localhost:8443
cas.logout.on.session.expiration=false</pre></div></li><li class="listitem">Start the<a id="id99" class="indexterm"/> CAS server and Liferay. When the homepage loads, click on the login link. The system should redirect the user to the CAS login page with the HTTPS protocol.</li><li class="listitem">Try authenticating yourself with the following credentials:<div><pre class="programlisting">Login: joebloggs
Password: test</pre></div></li></ol><div></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How it works…</h2></div></div></div><p>The <strong>Central Authentication Service</strong> (<strong>CAS</strong>) provides a single sign-on for the applications. The<a id="id100" class="indexterm"/> main purpose of SSO is to provide user's credentials only once<a id="id101" class="indexterm"/> and permit them to access all the client's applications that support the SSO protocol. Therefore, CAS is divided into two parts: CAS client and CAS server. For clarity sake, this means that the CAS Client component (jar) is placed in the Liferay libraries, and the CAS server is a standalone application. The CAS server is responsible for authenticating users. The CAS client acquires and protects the identity of the granted users. Communication between clients and server can be implemented by four protocols:</p><div><ul class="itemizedlist"><li class="listitem">CAS 3.0 (enabled by default)</li><li class="listitem">SAML 1.1</li><li class="listitem">OpenID</li><li class="listitem">OAuth (1.0, 2.0)</li></ul></div><p>Let's try <a id="id102" class="indexterm"/>analyzing the login process step by step:</p><div><ol class="orderedlist arabic"><li class="listitem">User clicks on the <strong>login</strong> button in the Liferay site. The system redirects the user to the CAS application at <code class="literal">https://localhost:8443/cas-server-webapp-4.0.0/login?service=https://localhost:8443/c/portal/login</code>.</li><li class="listitem">User types the correct login and password and invokes the submit action. The CAS server authenticates the user and sets the CASTGC cookie (for example, <code class="literal">CASTGC=TGT-4-HASH-cas01.example.org</code>). Then, the authenticated user goes back to Liferay with the Service Ticket (ST) ticket parameter: <code class="literal">https://localhost:8443/c/portal/login?ticket=ST-6-HASH-cas01.example.org</code>.</li><li class="listitem">The next step is calling the validation. It is a background process that sends the GET request via back-channel communication and gets an XML response with username details: <code class="literal">https://localhost:8443/cas-server-webapp-4.0.0/proxyValidate?{PARAMETERS}</code>.</li><li class="listitem">User is <a id="id103" class="indexterm"/>successfully logged in into the Liferay system.</li></ol><div></div><p>In Liferay, there are two classes that implement CAS authentication:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">com.liferay.portal.servlet.filters.sso.cas.CASFilter</code></li><li class="listitem"><code class="literal">com.liferay.portal.security.auth.CASAutoLogin</code></li></ul></div><p>
<code class="literal">CASFilter</code> is responsible <a id="id104" class="indexterm"/>for the CAS authentication process, especially for login action. The most important piece of code calls validation:</p><div><pre class="programlisting">TicketValidator ticketValidator = getTicketValidator(companyId);
Assertion assertion = ticketValidator.validate(ticket, serviceUrl);
if (assertion != null) {
  AttributePrincipal attributePrincipal = assertion.getPrincipal();
  login = attributePrincipal.getName();
  session.setAttribute(WebKeys.CAS_LOGIN, login);
}</pre></div><p>Filter validates ticket and sets login as a session attribute.</p><p>
<code class="literal">CASAutoLogin</code> reads the session <code class="literal">CAS_LOGIN</code> attribute and tries to find the user in the database. If the user exists in the database, the <code class="literal">AutoLogin</code> process returns the user's credentials and successfully logs them in into Liferay Portal.</p><p>The CAS server, without any external authentication handler, is useless. So, the following recipes will show how to integrate the CAS server and Liferay users' database or LDAP server.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec49"/>See also</h2></div></div></div><p>For more information on CAS and LDAP configuration, refer to the following recipes:</p><div><ul class="itemizedlist"><li class="listitem"><em>CAS and the Liferay user's database</em></li><li class="listitem"><em>Liferay and the LDAP integration</em></li><li class="listitem"><em>The magic trio: Liferay, CAS, and LDAP</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>CAS and the Liferay user's database</h1></div></div></div><p>The following<a id="id105" class="indexterm"/> recipe presents an idea on how <a id="id106" class="indexterm"/>to use the Liferay user functionality so it is authenticated by the CAS server. This idea may be used instead of LDAP or Active Directory systems. In small companies, where Liferay will be the main system that contains all user details, it would be a great concept to implement SSO in the following way:</p><div><ul class="itemizedlist"><li class="listitem">Liferay provides user details such as login and password to the CAS server</li><li class="listitem">When a user tries to login to the Liferay Portal, the CAS server <em>asks</em> the Liferay database and checks the user's data correctness</li></ul></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec50"/>Getting ready</h2></div></div></div><p>This recipe is in continuation with the previous one. To be ready, check whether the CAS server is correctly installed and is communicating with Liferay (the CAS client). To check it, try authenticating yourself as a default Liferay user via CAS by invoking <code class="literal">https://localhost:8443/cas-server-webapp-4.0.0/login</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec51"/>How to do it…</h2></div></div></div><p>Since 6.2 version, Liferay uses the PBKDF2WithHmacSHA1/160/128000 algorithm for password encryption. To configure the CAS server without any customization, it is necessary to change the password encryption (for instance, the SHA algorithm).</p><div><h3 class="title"><a id="note08"/>Note</h3><p>Warning! Changing the encryption is dangerous for existing accounts. All passwords stored in the database will be lost. If this happens, it is necessary to set a new password for every user.</p></div><p>In order to configure the CAS server to work with the Liferay database follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the following libraries to <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF/lib</code>:<div><ul class="itemizedlist"><li class="listitem"><code class="literal">c3p0</code> (for<a id="id107" class="indexterm"/> instance, <code class="literal">c3p0-0.9.1.2.jar</code>): Download it from <a class="ulink" href="https://github.com/swaldman/c3p0">https://github.com/swaldman/c3p0</a></li><li class="listitem"><code class="literal">cas-server-support-jdbc-4.0.0.jar</code>: Copy it from <code class="literal">cas-server-4.0.0/modules/</code></li></ul></div></li><li class="listitem">Change the password encryption by setting the new one in <code class="literal">${liferay.home}/portal-ext.properties</code>:<div><pre class="programlisting">passwords.encryption.algorithm=SHA
passwords.digest.encoding=hex</pre></div></li><li class="listitem">Set the <code class="literal">passwordEncoder</code> bean in the CAS server. Open <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF/deployerConfigContext.xml</code> and define the bean:<div><pre class="programlisting">&lt;bean id="passwordEncoder" class="org.jasig.cas.authentication.handler.DefaultPasswordEncoder"
c:encodingAlgorithm="SHA1"
p:characterEncoding="UTF-8" /&gt;</pre></div></li><li class="listitem">The <a id="id108" class="indexterm"/>last thing is to set <code class="literal">dataSource</code> and<a id="id109" class="indexterm"/> change <code class="literal">primaryAuthenticationHandler</code> in <code class="literal">deployerConfigContext.xml</code>.<div><ul class="itemizedlist"><li class="listitem">Set a new bean with <code class="literal">id="dataSource"</code>:<div><pre class="programlisting">&lt;bean id="dataSource"
class="com.mchange.v2.c3p0.ComboPooledDataSource"
p:driverClass="org.mysql.jdbc.driver"
p:jdbcUrl="jdbc:mysql://HOST:3306/lportal?useUnicode=true&amp;amp;characterEncoding=UTF-8"
p:user="USERNAME"
p:password="PASSWORD"
p:initialPoolSize="6"
p:minPoolSize="6"
p:maxPoolSize="18"
p:maxIdleTimeExcessConnections="120"
p:checkoutTimeout="10000"
p:acquireIncrement="6"
p:acquireRetryAttempts="5"
p:acquireRetryDelay="2000"
p:idleConnectionTestPeriod="30"
p:preferredTestQuery="1" /&gt;</pre></div></li><li class="listitem">Find and change the bean with <code class="literal">id="primaryAuthenticationHandler"</code>:<div><pre class="programlisting">&lt;bean id="primaryAuthenticationHandler" class="org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler"
p:dataSource-ref="dataSource"
p:passwordEncoder-ref="<strong>passwordEncoder</strong>"
<strong>p:sql="select password_ from User_ where screenName=? and status=0" /&gt;</strong>
</pre></div></li></ul></div></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How it works…</h2></div></div></div><p>The CAS server supports many common kinds of authentication systems, such as database, LDAP, OpenID, OAuth, Radius, Windows (NTLM), and so on. In this recipe, we have shown an example configuration, where Liferay database provides user detail to the CAS server. This type of handler is called <code class="literal">QueryDatabaseAuthenticationHandler</code>. CAS provides two other database handlers called <code class="literal">SearchModeSearchDatabaseAuthenticationHandler</code> and <code class="literal">BindModeSearchDatabaseAuthenticationHandler</code>. Information about these handlers is <a id="id110" class="indexterm"/>available at <a class="ulink" href="https://github.com/Jasig/cas/wiki/Configuring-Authentication-Components">https://github.com/Jasig/cas/wiki/Configuring-Authentication-Components</a>.</p><p>As mentioned <a id="id111" class="indexterm"/>at the beginning, both Liferay and<a id="id112" class="indexterm"/> CAS have to use the same password encryption algorithm (SHA1). It has to be the same because the CAS server authenticates users by comparing the (hashed) user's password against the password stored in the database. To define database connection, it was necessary to create a new bean called <code class="literal">dataSource</code>.</p><p>The last and most important step was defining the handler with the following query:</p><div><pre class="programlisting">select password_ from User_ where screenName=? and status=0</pre></div><p>This query returns an encrypted password by the SHA1 algorithm from the Liferay users database. It is enough to correctly compare encoded passwords and authenticate the user.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec53"/>There's more…</h2></div></div></div><p>Many systems provide authentication by e-mail address instead of <code class="literal">screenName</code> (login). By default, Liferay implements this kind of authentication. So, let's change the earlier recipe and deploy e-mail authentication. To achieve it, there are two steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Change the authentication type in <code class="literal">${liferay.home}/portal-ext.properties</code>:<div><pre class="programlisting">company.security.auth.type=emailAddress.</pre></div></li><li class="listitem">Modify <code class="literal">primaryAuthenticationHandler</code> in the CAS <code class="literal">deployerConfigContext.xml</code> file:<div><pre class="programlisting">&lt;bean id="primaryAuthenticationHandler" class="org.jasig.cas.adaptors.jdbc.SearchModeSearchDatabaseAuthenticationHandler"&gt;
  &lt;property name="tableUsers"&gt;
    &lt;value&gt;User_&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="fieldUser"&gt;
    &lt;value&gt;emailAddress&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="fieldPassword"&gt;
    &lt;value&gt;password_&lt;/value&gt;
  &lt;/property&gt;
  &lt;property name="passwordEncoder" ref="passwordEncoder" /&gt;
  &lt;property name="dataSource" ref="dataSource"&gt;&lt;/property&gt;
&lt;/bean&gt;</pre></div></li></ol><div></div><p>At this time, we decided to use a different <code class="literal">authenticationHandler</code> called <code class="literal">SearchModeSearchDatabaseAuthenticationHandler</code> to show a variety of possible ways to achieve database communication.</p><p>The second <a id="id113" class="indexterm"/>and very important fact is that it is not a good idea (for security purposes) to use the <a id="id114" class="indexterm"/>SHA1 or MD5 algorithm without SALT. Moreover, Liferay developers decided to use very strong encryption:</p><div><blockquote class="blockquote"><p><em>"PBKDF2 (Password-Based Key Derivation Function 2) is a key derivation function that's part of RSA's PKCS (Public-Key Cryptography Standards) series: PKCS #5, version 2.0. It's also described in the IETF's RFC 2898. The PBKDF2WithHmacSHA1/160/128000 algorithm uses a keyed-hash message authentication code using SHA-1 and generates 160-bit hashes using 128,000 rounds."</em></p></blockquote></div><p>If someone wants to use the same algorithm in the CAS Server, it is necessary to implement new <code class="literal">passwordEncoder</code> and define it in the CAS <code class="literal">deployerConfigContext.xml</code>:</p><div><pre class="programlisting">&lt;bean id="passwordEncoder" class="com.example.LiferayPasswordEncoder"
  c:encodingAlgorithm="PBKDF2WithHmacSHA1/160/128000"
  p:characterEncoding="UTF-8" /&gt;</pre></div><p>
<code class="literal">LiferayPasswordEncoder</code> must implement the <code class="literal">org.jasig.cas.authentication.handler.PasswordEncoder</code> interface.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec54"/>See also</h2></div></div></div><p>For information on CAS and LDAP, refer to the <em>Liferay and the LDAP integration</em> and <em>The magic trio: Liferay, CAS, and LDAP</em> recipes.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Liferay and the LDAP integration</h1></div></div></div><p>In many<a id="id115" class="indexterm"/> companies, LDAP (OpenLDAP, Active Directory, or other LDAP implementations) is <a id="id116" class="indexterm"/>the system that keeps users' details, especially login, password, e-mail address, name, and surname. It is a good idea to integrate Liferay with LDAP. Fortunately, Liferay developers thought about it. Liferay provides out-of-the-box functionality that can read and import users from LDAP.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec55"/>Getting ready</h2></div></div></div><p>To start the configuration, you need to correctly install an LDAP server such as OpenLDAP or Active Directory, or ApacheDS. As an example of integration, it will be used online as a LDAP test server:</p><div><ul class="itemizedlist"><li class="listitem">Server: <code class="literal">ldap.forumsys.com</code></li><li class="listitem">Port: <code class="literal">389</code></li><li class="listitem">Bind DN: <code class="literal">cn=read-only-admin,dc=example,dc=com</code></li><li class="listitem">Bind Password: <code class="literal">password</code></li><li class="listitem">All user passwords are: <code class="literal">password</code>.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec56"/>How to do it…</h2></div></div></div><p>There are<a id="id117" class="indexterm"/> two ways of configuration: by GUI or by portal <a id="id118" class="indexterm"/>properties. In this case, we will show configuration via <strong>Control Panel</strong>.</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to your Liferay instance as a super administrator (by default, it is <code class="literal">joebloggs/test</code>).</li><li class="listitem">Go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Configuration</strong> | <strong>Portal Settings</strong> | <strong>Authentication</strong>.</li><li class="listitem">Select the <strong>LDAP</strong> tab.</li><li class="listitem">Select the <strong>Enabled</strong> option.</li><li class="listitem">Click on the <strong>Add</strong> button in the LDAP servers section.</li><li class="listitem">Fill in the form with the following data:<div><ul class="itemizedlist"><li class="listitem"><strong>Server name</strong>: <code class="literal">&lt;YOUR_SERVER_NAME&gt;</code> (for example, <code class="literal">ldap.forumsys.com</code>).</li><li class="listitem"><strong>Default values</strong>: <code class="literal">&lt;CHOOSE ONE OF THEM&gt;</code> (for example, other directory server).</li><li class="listitem"><strong>Connection section</strong>: These settings contain the basic connection to LDAP.</li><li class="listitem"><strong>Base Provider URL</strong>: <code class="literal">&lt;ldap://host:port&gt;</code> (for example, <code class="literal">ldap://ldap.forumsys.com:389</code>).</li><li class="listitem"><strong>Base DN</strong>: <code class="literal">&lt;Distinguished Name&gt;</code> (for example, <code class="literal">dc=example,dc=com</code>).</li><li class="listitem"><strong>Principal</strong>: <code class="literal">&lt;LDAP administrator ID&gt;</code> (for example, <code class="literal">cn=read-only-admin,dc=example,dc=com</code>).</li><li class="listitem"><strong>Credentials</strong>: <code class="literal">&lt;LDAP administrator's password&gt;</code> (in our case is <code class="literal">password</code>).</li><li class="listitem">Check the configuration and click on the <strong>Test LDAP Connection</strong> button. It should be displaying the following message:<p><strong>Liferay has successfully connected to the LDAP server.</strong></p></li><li class="listitem"><strong>Users section</strong>: These settings cover search filter and user mapping functionality.<div><h3 class="title"><a id="note09"/>Note</h3><p>Values in this form strictly depend on the LDAP directory schema. Administrator should know which fields from LDAP can map as Liferay values.</p></div></li><li class="listitem"><strong>Authentication Search Filter</strong>: <code class="literal">&lt;Search criteria for users login&gt;</code> (for example, (<code class="literal">uid=@screen_name@</code>)).</li><li class="listitem"><strong>Import Search Filter</strong>: <code class="literal">&lt;Way to identify users&gt;</code> (for example, (<code class="literal">objectClass=inetOrgPerson</code>)).</li><li class="listitem"><strong>User Mapping section</strong> (maps the LDAP attribute as a Liferay value):<p>
<strong>Screen Name</strong> = <code class="literal">uid</code>
</p><p>
<strong>Email Address</strong> = <code class="literal">mail</code>
</p><p>
<strong>Password</strong> = <code class="literal">userPassword</code>
</p><p>
<strong>First Name</strong> = <code class="literal">cn</code>
</p><p>
<strong>Last Name</strong> = <code class="literal">sn</code>
</p></li></ul></div><p>After configuration, try to check the correctness by clicking on <strong>Test LDAP Users</strong>. The system should list users from the LDAP directory.</p><div><ul class="itemizedlist"><li class="listitem"><strong>Groups section</strong>: These settings map LDAP user groups to Liferay user groups. It <a id="id119" class="indexterm"/>is not required to fill this form. If <a id="id120" class="indexterm"/>an administrator wants to configure it, the steps are very similar to the example shown previously. There may be a problem with the <strong>Import search filter</strong> field. There is usually the <code class="literal">(objectClass=groupOfNames)</code> or <code class="literal">(objectClass=groupOfUniqueNames)</code> value.</li></ul></div></li><li class="listitem">Save the <strong>LDAP Servers</strong> and <strong>Portal Settings</strong> forms.</li><li class="listitem">Log out and try to log in as an LDAP user, such as <code class="literal">newton</code>/<code class="literal">password</code>.</li></ol><div></div><div><h3 class="title"><a id="note10"/>Note</h3><p>There are several parameters that are unavailable in the GUI. If there are any problems with configuration, check out <code class="literal">portal.properties</code> under the key prefix, <code class="literal">ldap.*</code>. LDAP configuration is a vast subject and could be difficult to understand and properly configure.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec57"/>How it works…</h2></div></div></div><p>Liferay<a id="id121" class="indexterm"/> provides an Authentication Pipeline mechanism that<a id="id122" class="indexterm"/> allows you to define many authentication types. By default, there is an enabled <code class="literal">LdapAuth</code> authenticator, as follows:</p><div><pre class="programlisting"> auth.pipeline.pre=com.liferay.portal.security.auth.LDAPAuth</pre></div><p>In general, every login process, instead of default authentication, tries to invoke a list of authenticators defined in <code class="literal">auth.pipeline.pre</code>. If any authenticator returns a success, it means the user is correctly logged in to the Liferay Portal.</p><p>The <code class="literal">LDAPAuth</code> class implements the <code class="literal">com.liferay.portal.security.auth.Authenticator</code> interface, which provides the following methods:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">authenticateByEmailAddress</code></li><li class="listitem"><code class="literal">authenticateByScreenName</code></li><li class="listitem"><code class="literal">authenticateByUserId</code></li></ul></div><p>To communicate with the LDAP server, Liferay uses classes from the <code class="literal">javax.naming.ldap</code> package. It provides support for LDAPv3 extended operations and controls.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec23"/>The magic trio: Liferay, CAS, and LDAP</h1></div></div></div><p>The next <a id="id123" class="indexterm"/>challenge is to connect Liferay, CAS, and LDAP authentication. In this combination, the CAS system provides single sign-on<a id="id124" class="indexterm"/> mechanism, the LDAP system stores <a id="id125" class="indexterm"/>the user's credentials, and Liferay uses both systems to authenticate users coming from LDAP. This configuration is used in many deployments. Furthermore, we dare to say that it should be considered as a standard solution when people think about intranet in their companies.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec58"/>Getting ready</h2></div></div></div><p>Study the <em>Integration with CAS SSO</em> and <em>Liferay and the LDAP integration </em>recipes explained previously. Set up the system in accordance with these recipes. Check out the connection to the LDAP Server from Liferay and verify that the CAS authentication is enabled.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec59"/>How to do it…</h2></div></div></div><p>To integrate <a id="id126" class="indexterm"/>Liferay with CAS Server where LDAP<a id="id127" class="indexterm"/> is the authentication provider, <a id="id128" class="indexterm"/>follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Find the archive with<a id="id129" class="indexterm"/> the CAS server downloaded from <a class="ulink" href="http://downloads.jasig.org/cas/">http://downloads.jasig.org/cas/</a>. Copy <code class="literal">cas-server-4.0.0/modules/cas-server-support-ldap-4.0.0.jar</code> to the <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF/lib</code> directory.</li><li class="listitem">By default, CAS uses the <code class="literal">ldaptive</code> library for communication with LDAP. Download <code class="literal">ldaptive.jar</code> (<a class="ulink" href="http://central.maven.org/maven2/org/ldaptive/ldaptive/1.0.3/ldaptive-1.0.3.jar">http://central.maven.org/maven2/org/ldaptive/ldaptive/1.0.3/ldaptive-1.0.3.jar</a>) and<a id="id130" class="indexterm"/> place this archive in the <code class="literal">${TOMCAT_HOME} /webapps/cas-server-webapp-4.0.0/WEB-INF/lib</code> directory.</li><li class="listitem">Open the <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF/deployerConfigContext.xml</code> file and specify the following beans:<p>First, define the bean that will be a primary authentication handler and set it as LDAP authentication.</p><div><h3 class="title"><a id="note11"/>Note</h3><p>Make sure that you are not using a previously configured database authentication handler.</p></div><p>The primary authentication handler contains mapping fields between LDAP and CAS. Keys are LDAP attribute names, and values are CAS attribute names. This definition has a reference to the authenticator bean, which will be described in the next section:</p><div><pre class="programlisting">&lt;bean id="primaryAuthenticationHandler"
      class="org.jasig.cas.authentication.LdapAuthenticationHandler"
      p:principalIdAttribute="uid"
      c:authenticator-ref="authenticator"&gt;
    &lt;property name="principalAttributeMap"&gt;
      &lt;map&gt;
        &lt;entry key="uid" value="username" /&gt;
        &lt;entry key="givenname" value="first_name" /&gt;
        &lt;entry key="sn" value="last_name" /&gt;
        &lt;entry key="mail" value="email" /&gt;
      &lt;/map&gt;
    &lt;/property&gt;
&lt;/bean&gt;</pre></div><p>The<a id="id131" class="indexterm"/> authenticator bean <a id="id132" class="indexterm"/>defines the method <a id="id133" class="indexterm"/>of authentication. It contains references to the DN (distinguished name) resolver and authentication handler, which is responsible for establishing connection. It should be included in our <code class="literal">deployerConfigContext.xml</code> file:</p><div><pre class="programlisting">&lt;bean id="authenticator" class="org.ldaptive.auth.Authenticator"
      c:resolver-ref="dnResolver"
      c:handler-ref="authHandler" /&gt;</pre></div><p>Distinguished name resolver defines resolution implementation. In this case, <code class="literal">FormatDnResolver</code> is used:</p><div><pre class="programlisting">&lt;bean id="dnResolver"
      class="org.ldaptive.auth.FormatDnResolver"
      c:format="uid=%s,${ldap.authn.baseDn}" /&gt;</pre></div><p>Next, bean definitions are responsible for establishing connection with LDAP. There are many settings, which are described in the <code class="literal">ldaptive</code> library documentation:</p><div><pre class="programlisting">&lt;bean id="authHandler" class="org.ldaptive.auth.PooledBindAuthenticationHandler"
  p:connectionFactory-ref="pooledLdapConnectionFactory" /&gt;

&lt;bean id="pooledLdapConnectionFactory"
  class="org.ldaptive.pool.PooledConnectionFactory"
  p:connectionPool-ref="connectionPool" /&gt;

&lt;bean id="connectionPool"
  class="org.ldaptive.pool.BlockingConnectionPool"
  init-method="initialize"
  p:poolConfig-ref="ldapPoolConfig"
  p:blockWaitTime="${ldap.pool.blockWaitTime}"
  p:validator-ref="searchValidator"
  p:pruneStrategy-ref="pruneStrategy"
  p:connectionFactory-ref="connectionFactory" /&gt;

&lt;bean id="ldapPoolConfig"   class="org.ldaptive.pool.PoolConfig"
p:minPoolSize="${ldap.pool.minSize}"
p:maxPoolSize="${ldap.pool.maxSize}"
p:validateOnCheckOut="${ldap.pool.validateOnCheckout}"           p:validatePeriodically="${ldap.pool.validatePeriodically}"
p:validatePeriod="${ldap.pool.validatePeriod}" /&gt;

&lt;bean id="connectionFactory" class="org.ldaptive.DefaultConnectionFactory"
  p:connectionConfig-ref="connectionConfig" /&gt;

&lt;bean id="connectionConfig" class="org.ldaptive.ConnectionConfig"
  p:ldapUrl="${ldap.url}"
  p:connectTimeout="${ldap.connectTimeout}"
  /&gt;


&lt;bean id="pruneStrategy" class="org.ldaptive.pool.IdlePruneStrategy"
  p:prunePeriod="${ldap.pool.prunePeriod}"
  p:idleTime="${ldap.pool.idleTime}" /&gt;

&lt;bean id="searchValidator" class="org.ldaptive.pool.SearchValidator" /&gt;</pre></div></li><li class="listitem">Add <a id="id134" class="indexterm"/>the following properties <a id="id135" class="indexterm"/>to the <code class="literal">${TOMCAT_HOME}/webapps/cas-server-webapp-4.0.0/WEB-INF/cas.properties</code> file:<div><pre class="programlisting">#========================================
# General properties
#========================================
ldap.url=ldap://ldap.forumsys.com

# LDAP connection timeout in milliseconds
ldap.connectTimeout=3000

# Whether to use StartTLS (probably needed if not SSL connection)
ldap.useStartTLS=false

#========================================
# LDAP connection pool configuration
#========================================
ldap.pool.minSize=3
ldap.pool.maxSize=10
ldap.pool.validateOnCheckout=false
ldap.pool.validatePeriodically=true

# Amount of time in milliseconds to block on pool  
# exhausted condition before giving up.
ldap.pool.blockWaitTime=3000

# Frequency of connection validation in seconds
# Only applies if validatePeriodically=true
ldap.pool.validatePeriod=300

# Attempt to prune connections every N seconds
ldap.pool.prunePeriod=300

# Maximum amount of time an idle connection is allowed to #be in pool before it is liable to be removed/destroyed
ldap.pool.idleTime=600

#========================================
# Authentication
#========================================

# Base DN of users to be authenticated
<strong>ldap.authn.baseDn=dc=example,dc=com</strong>

# Manager DN for authenticated searches
<strong>ldap.authn.managerDN=cn=read-only-admin,dc=example,dc=com</strong>

# Manager password for authenticated searches
<strong>ldap.authn.managerPassword=password</strong>

# Search filter used for configurations that require searching for DNs
<strong>ldap.authn.searchFilter=(uid={user})</strong>

# Search filter used for configurations that require searching for DNs
<strong>ldap.authn.format=uid=%s,dc=example,dc=com</strong>
</pre></div></li><li class="listitem">Check in the <code class="literal">portal-ext.properties</code> file whether CAS authentication is enabled:<div><pre class="programlisting">cas.auth.enabled=true</pre></div></li><li class="listitem">Restart the Tomcat server.</li></ol><div></div><p>After finishing the configuration described previously, it should be possible to authenticate to Liferay by the CAS server and LDAP user credentials (login and password) such as <code class="literal">newton</code>/<code class="literal">password</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec60"/>How it works…</h2></div></div></div><p>Configuration<a id="id136" class="indexterm"/> for the LDAP schema in many cases<a id="id137" class="indexterm"/> is different. It is not possible to <a id="id138" class="indexterm"/>provide the correct configuration that will be flexible. In the configuration mentioned previously, highlighted phrases are sensitive and should be fitted to a specific LDAP schema.</p><p>The biggest advantage of this solution is that there is only one place that stores users' credentials (LDAP server) and exactly one place that provides authentication mechanism (CAS SSO). Liferay is just a client of these services.</p><div><img src="img/image00303.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>Let's follow this process:</p><div><ol class="orderedlist arabic"><li class="listitem">A new <a id="id139" class="indexterm"/>user wants to log in to the<a id="id140" class="indexterm"/> Liferay system. Liferay doesn't have any information about this user.</li><li class="listitem">Liferay <a id="id141" class="indexterm"/>checks whether CAS SSO is enabled and redirects the user to the CAS authentication provider.</li><li class="listitem">The CAS authentication provider renders the login form.</li><li class="listitem">The user types the LDAP login and LDAP password and sends the request to the CAS server.</li><li class="listitem">The CAS server asks the LDAP server for credentials and checks the answer from LDAP.</li><li class="listitem">If the answer is OK, the CAS server sends a success message to the Liferay authentication ticket.</li><li class="listitem">Liferay checks whether it has that user in its database. If it doesn't, it asks the LDAP server about user details such as login, name, surname, e-mail address, and so on.</li><li class="listitem">Liferay creates account in its database and successfully logs in a new user.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec61"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">For information on how to export Liferay users, refer to the <em>Exporting users</em> recipe in <a class="link" title="Chapter 3. Working with a Liferay User / User Group / Organization" href="part0030.xhtml#aid-SJGS1">Chapter 3</a>, <em>Working with a Liferay User / User Group / Organization</em>.</li><li class="listitem">For information on how to build a scalable infrastructure, refer to the <em>Scalable infrastructure</em> recipe in <a class="link" title="Chapter 12. Basic Performance Tuning" href="part0088.xhtml#aid-2JTHG1">Chapter 12</a>, <em>Basic Performance Tuning</em>.</li></ul></div></div></div></body></html>