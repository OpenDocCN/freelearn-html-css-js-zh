<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 10. Interacting with Your Visualization"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/><span class="koboSpan" id="kobo.1.1">Chapter 10. Interacting with Your Visualization</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Interacting with the mouse</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Interacting with a multi-touch device</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Implementing the zoom and pan behavior</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Implementing the drag behavior</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec70"/><span class="koboSpan" id="kobo.7.1">Introduction</span></h1></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.8.1">The ultimate goal of visualization design is to optimize applications so that they help us perform cognitive work more efficiently.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.9.1">Ware C. </span><span class="koboSpan" id="kobo.9.2">(2012)</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.10.1">The goal of data visualization is to help the audience gain information from a large quantity of raw data quickly and efficiently through metaphor, mental model alignment, and cognitive magnification. </span><span class="koboSpan" id="kobo.10.2">So far, in this book, we have introduced various techniques to leverage D3 library by implementing many types of visualization. </span><span class="koboSpan" id="kobo.10.3">However, we haven't touched a crucial aspect of visualization: human interaction. </span><span class="koboSpan" id="kobo.10.4">Various research have concluded the unique value of human interaction in information visualization.</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.11.1">Visualization combined with computational steering allows faster analyses of more sophisticated scenarios...This case study adequately demonstrate that the interaction of a complex model with steering and interactive visualization can extend the applicability of the modelling beyond research</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.12.1">Barrass I. </span><span class="koboSpan" id="kobo.12.2">&amp; Leng J (2011)</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.13.1">In this chapter, we will focus on D3 human visualization interaction support; or, as mentioned earlier, you will learn how to add computational steering capability to your visualization.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Interacting with mouse events"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec71"/><span class="koboSpan" id="kobo.1.1">Interacting with mouse events</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">The mouse is the most common and popular human-computer interaction control found on most desktop and laptop computers. </span><span class="koboSpan" id="kobo.2.2">Even today, with multi-touch devices rising to dominance, touch events are still commonly emulated with mouse events. </span><span class="koboSpan" id="kobo.2.3">In this recipe, we will learn how to handle standard mouse events in D3.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec206"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/mouse.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/mouse.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec207"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In the following code example, we will explore techniques of registering and handling mouse events in D3. </span><span class="koboSpan" id="kobo.7.2">Although in this particular example we are handling only </span><code class="literal"><span class="koboSpan" id="kobo.8.1">click</span></code><span class="koboSpan" id="kobo.9.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.10.1">mousemove</span></code><span class="koboSpan" id="kobo.11.1">, the techniques utilized here can be applied easily to all other standard mouse events supported by modern browsers:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.12.1">&lt;script type="text/javascript"&gt; 
    var r = 400; 
 
    var svg = d3.select("body") 
            .append("svg"); 
 
    var positionLabel = svg.append("text") 
            .attr("x", 10) 
            .attr("y", 30); 
 
    svg.on("mousemove", function () { //&lt;-A 
        printPosition(); 
    }); 
             
    function printPosition() { //&lt;-B 
        var position = d3.mouse(svg.node()); //&lt;-C 
        positionLabel.text(position); 
    }   
 
    svg.on("click", function () { //&lt;-D 
        for (var i = 1; i &lt; 5; ++i) { 
            var position = d3.mouse(svg.node()); 
 
            var circle = svg.append("circle") 
                    .attr("cx", position[0]) 
                    .attr("cy", position[1]) 
                    .attr("r", 0) 
                    .style("stroke-width", 5 / (i)) 
                    .transition() 
                        .delay(Math.pow(i, 2.5) * 50) 
                        .duration(2000) 
                        .ease(d3.easeQuadIn) 
                    .attr("r", r) 
                    .style("stroke-opacity", 0) 
                    .on("end", function () { 
                        d3.select(this).remove(); 
                    }); 
        } 
    }); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.13.1">This recipe generates the following interactive visualization when you click on the SVG image:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_10_001.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Mouse interaction</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec208"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">In D3, to register an event listener, we need to invoke the </span><code class="literal"><span class="koboSpan" id="kobo.18.1">on</span></code><span class="koboSpan" id="kobo.19.1"> function on a particular selection. </span><span class="koboSpan" id="kobo.19.2">The given event listener will be attached to all the selected elements for the specified event (refer to line A). </span><span class="koboSpan" id="kobo.19.3">The following code in this recipe attaches a </span><code class="literal"><span class="koboSpan" id="kobo.20.1">mousemove</span></code><span class="koboSpan" id="kobo.21.1"> event listener, which displays the current mouse position (refer to line B):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.22.1">svg.on("mousemove", function () { //&lt;-A 
    printPosition(); 
}); 
             
function printPosition() { //&lt;-B 
    var position = d3.mouse(svg.node()); //&lt;-C 
    positionLabel.text(position); 
}   
</span></pre><p><span class="koboSpan" id="kobo.23.1">On line C, we used </span><code class="literal"><span class="koboSpan" id="kobo.24.1">d3.mouse</span></code><span class="koboSpan" id="kobo.25.1"> function to obtain the current mouse position relative to the given container element. </span><span class="koboSpan" id="kobo.25.2">This function returns a two-element array [x, y]. </span><span class="koboSpan" id="kobo.25.3">After this, we also registered an event listener for a mouse </span><code class="literal"><span class="koboSpan" id="kobo.26.1">click</span></code><span class="koboSpan" id="kobo.27.1"> event on line D using the same </span><code class="literal"><span class="koboSpan" id="kobo.28.1">on</span></code><span class="koboSpan" id="kobo.29.1"> function:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.30.1">svg.on("click", function () { //&lt;-D 
        for (var i = 1; i &lt; 5; ++i) { 
            var position = d3.mouse(svg.node()); 
 
        var circle = svg.append("circle") 
                .attr("cx", position[0]) 
                .attr("cy", position[1]) 
                .attr("r", 0) 
                .style("stroke-width", 5 / (i)) // &lt;-E 
                .transition() 
                    .delay(Math.pow(i, 2.5) * 50) // &lt;-F 
                    .duration(2000) 
                    .ease('quad-in') 
                .attr("r", r) 
                .style("stroke-opacity", 0) 
                .each("end", function () { 
                    d3.select(this).remove(); // &lt;-G 
                }); 
        } 
}); 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note80"/><span class="koboSpan" id="kobo.31.1">Note</span></h3><p><span class="koboSpan" id="kobo.32.1">Once again, we retrieved the current mouse position using the </span><code class="literal"><span class="koboSpan" id="kobo.33.1">d3.mouse</span></code><span class="koboSpan" id="kobo.34.1"> function and then generated five concentric expanding circles to simulate the ripple effect. </span><span class="koboSpan" id="kobo.34.2">The ripple effect was simulated using geometrically increasing delay (refer to line F) with decreasing </span><code class="literal"><span class="koboSpan" id="kobo.35.1">stroke-width</span></code><span class="koboSpan" id="kobo.36.1"> (refer to line E). </span><span class="koboSpan" id="kobo.36.2">Finally, when the transition effect is over, the circles were removed using a transition </span><code class="literal"><span class="koboSpan" id="kobo.37.1">end</span></code><span class="koboSpan" id="kobo.38.1"> listener (refer to line G). </span><span class="koboSpan" id="kobo.38.2">If you are not familiar with this type of transition control, refer to </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.39.1">Chapter 6</span></a><span class="koboSpan" id="kobo.40.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.41.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.42.1">, for more details.</span></p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec209"/><span class="koboSpan" id="kobo.43.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.44.1">Although we have only demonstrated how to listen on the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">click</span></code><span class="koboSpan" id="kobo.46.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.47.1">mousemove</span></code><span class="koboSpan" id="kobo.48.1"> events in this recipe, you can listen on any event that your browser supports through the </span><code class="literal"><span class="koboSpan" id="kobo.49.1">on</span></code><span class="koboSpan" id="kobo.50.1"> function. </span><span class="koboSpan" id="kobo.50.2">The following is a list of mouse events that are useful to know when building your interactive visualization:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.51.1">click</span></code><span class="koboSpan" id="kobo.52.1">: Dispatched when a user clicks on a mouse button</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.53.1">dbclick</span></code><span class="koboSpan" id="kobo.54.1">: Dispatched when a mouse button is clicked twice</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.55.1">mousedown</span></code><span class="koboSpan" id="kobo.56.1">: Dispatched when the mouse button is pressed</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.57.1">mouseenter</span></code><span class="koboSpan" id="kobo.58.1">: Dispatched when the mouse button is moved onto the limits of an element or one of its descendent elements</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.59.1">mouseleave</span></code><span class="koboSpan" id="kobo.60.1">: Dispatched when the mouse button is moved off the limits of an element and all of its descendent elements</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.61.1">mousemove</span></code><span class="koboSpan" id="kobo.62.1">: Dispatched when the mouse button is moved over an element</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.63.1">mouseout</span></code><span class="koboSpan" id="kobo.64.1">: Dispatched when the mouse button is moved off of the boundaries of an element</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.65.1">mouseover</span></code><span class="koboSpan" id="kobo.66.1">: Dispatched when the mouse button is moved onto the limits of an element</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.67.1">mouseup</span></code><span class="koboSpan" id="kobo.68.1">: Dispatched when a mouse button is released over an element</span></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec210"/><span class="koboSpan" id="kobo.69.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.70.1">Refer to </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.71.1">Chapter 6</span></a><span class="koboSpan" id="kobo.72.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.73.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.74.1">, for more details on the ripple effect technique used in this recipe.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.75.1">Refer to W3C DOM Level 3 Events specification for a complete list of event types at </span><a class="ulink" href="https://www.w3.org/TR/DOM-Level-3-Events/"><span class="koboSpan" id="kobo.76.1">https://www.w3.org/TR/DOM-Level-3-Events/
</span></a><span class="koboSpan" id="kobo.77.1">.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.78.1">Refer to the </span><code class="literal"><span class="koboSpan" id="kobo.79.1">d3.mouse</span></code><span class="koboSpan" id="kobo.80.1"> API document for more details on mouse detection at </span><a class="ulink" href="https://github.com/d3/d3-selection/blob/master/README.md#mouse"><span class="koboSpan" id="kobo.81.1">https://github.com/d3/d3-selection/blob/master/README.md#mouse
</span></a><span class="koboSpan" id="kobo.82.1">.</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Interacting with a multi-touch device"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec72"/><span class="koboSpan" id="kobo.1.1">Interacting with a multi-touch device</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Today, with the proliferation of multi-touch devices, any visualization that targets mass consumption needs to worry about its interact-ability not only through the traditional pointing device but also through multi-touches and gestures. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will explore touch support offered by D3 to see how it can be leveraged to generate some pretty interesting interaction with multi-touch-capable devices.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec211"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/touch.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/touch.html
</span></a><span class="koboSpan" id="kobo.6.1">.
</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec212"/><span class="koboSpan" id="kobo.7.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">In this recipe, we will generate a progress-circle around the user's touches, and once the progress is completed, a subsequent ripple effect will be triggered around the circle. </span><span class="koboSpan" id="kobo.8.2">However, if the user prematurely ends their touch, we shall stop the progress-circle without generating the ripples:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.9.1">&lt;script type="text/javascript"&gt; 
    var initR = 100,  
        r = 400,  
        thickness = 20; 
 
    var svg = d3.select("body") 
            .append("svg"); 
 
    d3.select("body") // &lt;-A 
            .on("touchstart", touch) 
            .on("touchend", touch); 
 
    function touch() { 
        d3.event.preventDefault(); // &lt;-B 
 
        var arc = d3.arc() 
                .outerRadius(initR) 
                .innerRadius(initR - thickness); 
 
        var g = svg.selectAll("g.touch") // &lt;-C 
                .data(d3.touches(svg.node()), function (d, i) { 
                    return i; 
                }); 
 
        g.enter() 
            .append("g") 
            .attr("class", "touch") 
            .attr("transform", function (d) { 
                return "translate(" + d[0] + "," + d[1] + ")"; 
            }) 
            .append("path") 
                .attr("class", "arc") 
                .transition().duration(2000).ease(d3.easeLinear) 
                .attrTween("d", function (d) { // &lt;-D 
                    var interpolate = d3.interpolate( 
                            {startAngle: 0, endAngle: 0}, 
                            {startAngle: 0, endAngle: 2 * Math.PI} 
                        ); 
                    return function (t) { 
                        return arc(interpolate(t)); 
                    }; 
                }) 
                .on("end", function (d) { 
                    if (complete(d)) // &lt;-E 
                        ripples(d); 
                    g.remove(); 
                }); 
 
        g.exit().remove().each(function (d) { 
            console.log("Animation stopped"); 
            d[2] = "stopped"; // &lt;-F 
        }); 
    } 
 
    function complete(d) { 
        console.log("Animation completed? </span><span class="koboSpan" id="kobo.9.2">" + (d.length &lt; 3)); 
        return d.length &lt; 3; 
    } 
 
    function ripples(position) { 
        console.log("Producing ripple effect..."); 
 
        for (var i = 1; i &lt; 5; ++i) { 
            var circle = svg.append("circle") 
                    .attr("cx", position[0]) 
                    .attr("cy", position[1]) 
                    .attr("r", initR - (thickness / 2)) 
                    .style("stroke-width", thickness / (i)) 
                .transition() 
                    .delay(Math.pow(i, 2.5) * 50) 
                    .duration(2000).ease(d3.easeQuadIn) 
                    .attr("r", r) 
                    .style("stroke-opacity", 0) 
                    .on("end", function () { 
                        d3.select(this).remove(); 
                    }); 
        } 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.10.1">This recipe generates the following interactive visualization on a touch-enabled device:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.11.1"><img src="graphics/image_10_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.12.1">Touch Interaction</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec213"/><span class="koboSpan" id="kobo.13.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.14.1">Event listener for touch events are registered through D3 selection's </span><code class="literal"><span class="koboSpan" id="kobo.15.1">on</span></code><span class="koboSpan" id="kobo.16.1"> function similar to what we have done with mouse events in the previous recipe (refer to line A):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.17.1">d3.select("body") // &lt;-A 
            .on("touchstart", touch) 
            .on("touchend", touch); 
</span></pre><p><span class="koboSpan" id="kobo.18.1">One crucial difference here is that we have registered our touch event listener on the </span><code class="literal"><span class="koboSpan" id="kobo.19.1">body</span></code><span class="koboSpan" id="kobo.20.1"> element instead of the </span><code class="literal"><span class="koboSpan" id="kobo.21.1">svg</span></code><span class="koboSpan" id="kobo.22.1"> element since there are default touch behaviors defined with many OS and browsers and we would like to override it with our custom implementation. </span><span class="koboSpan" id="kobo.22.2">This is done through the following function call (refer to line B):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.23.1">d3.event.preventDefault(); // &lt;-B 
</span></pre><p><span class="koboSpan" id="kobo.24.1">Once the touch event is triggered, we will retrieve multiple touch point data using the </span><code class="literal"><span class="koboSpan" id="kobo.25.1">d3.touches</span></code><span class="koboSpan" id="kobo.26.1"> function, as illustrated by the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.27.1">var g = svg.selectAll("g.touch") // &lt;-C 
                .data(d3.touches(svg.node()), function (d, i) { 
                    return i; 
                });  
</span></pre><p><span class="koboSpan" id="kobo.28.1">Instead of returning a two-element array as the </span><code class="literal"><span class="koboSpan" id="kobo.29.1">d3.mouse</span></code><span class="koboSpan" id="kobo.30.1"> function does, </span><code class="literal"><span class="koboSpan" id="kobo.31.1">d3.touches</span></code><span class="koboSpan" id="kobo.32.1"> returns an array of two-element arrays since there could be multiple touch points for each touch event. </span><span class="koboSpan" id="kobo.32.2">Each touch position array has data structure that looks like the following:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.33.1"><img src="graphics/image_10_003.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.34.1">Touch position array</span></p><p><span class="koboSpan" id="kobo.35.1">Here, we also used array index in this recipe to establish object constancy. </span><span class="koboSpan" id="kobo.35.2">Once the touch data is bound to the selection, the progress circle was generated for each touch around the user's touch point:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.36.1">        g.enter() 
            .append("g") 
            .attr("class", "touch") 
            .attr("transform", function (d) { 
                return "translate(" + d[0] + "," + d[1] + ")"; 
            }) 
            .append("path") 
                .attr("class", "arc") 
                .transition().duration(2000).ease(d3.easeLinear) 
                .attrTween("d", function (d) { // &lt;-D 
                    var interpolate = d3.interpolate( 
                            {startAngle: 0, endAngle: 0}, 
                            {startAngle: 0, endAngle: 2 * Math.PI} 
                        ); 
                    return function (t) { 
                        return arc(interpolate(t)); 
                    }; 
                }) 
                .on("end", function (d) { 
                    if (complete(d))  
                        ripples(d); // &lt;-E 
                    g.remove(); 
                }); 
</span></pre><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note81"/><span class="koboSpan" id="kobo.37.1">Note</span></h3><p><span class="koboSpan" id="kobo.38.1">This is done through a standard arc transition with arc attribute tweening (refer to line D) as explained in </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.39.1">Chapter 7</span></a><span class="koboSpan" id="kobo.40.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.41.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">If the progress-circle has not yet been canceled by the user even though the transition is over, then a ripple effect similar to what we have done in the previous recipe is generated on line E. </span><span class="koboSpan" id="kobo.42.3">Since we have registered the same event listener </span><code class="literal"><span class="koboSpan" id="kobo.43.1">touch</span></code><span class="koboSpan" id="kobo.44.1"> function on both the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">touchstart</span></code><span class="koboSpan" id="kobo.46.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.47.1">touchend</span></code><span class="koboSpan" id="kobo.48.1"> events, we can use the following lines to remove progress-circle and also set a flag to indicate that this progress circle has stopped prematurely:</span></p></div></div><pre class="programlisting"><span class="koboSpan" id="kobo.49.1">        g.exit().remove().each(function (d) { 
            console.log("Animation stopped"); 
            d[2] = "stopped"; // &lt;-F 
        }); 
     ... 
     </span><span class="koboSpan" id="kobo.49.2">function complete(d) { 
        console.log("Animation completed? </span><span class="koboSpan" id="kobo.49.3">" + (d.length &lt; 3)); 
        return d.length &lt; 3; 
    } 
</span></pre><p><span class="koboSpan" id="kobo.50.1">We need to set this stateful flag on </span><code class="literal"><span class="koboSpan" id="kobo.51.1">d</span></code><span class="koboSpan" id="kobo.52.1">, which is the touch data array, since there is no way to cancel a transition once it starts; hence, even after you remove the progress-circle element from the DOM tree, the transition will still complete and trigger line E.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec214"/><span class="koboSpan" id="kobo.53.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.54.1">We have demonstrated touch interaction through the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">touchstart</span></code><span class="koboSpan" id="kobo.56.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.57.1">touchend</span></code><span class="koboSpan" id="kobo.58.1"> events; however, you can use the same pattern to handle any other touch events supported by your browser. </span><span class="koboSpan" id="kobo.58.2">The following list contains the proposed touch event types recommended by W3C:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.59.1">touchstart</span></code><span class="koboSpan" id="kobo.60.1">: It is dispatched when the user places a touch point on the touch surface.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.61.1">touchend</span></code><span class="koboSpan" id="kobo.62.1">: It is dispatched when the user removes a touch point from the touch surface.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.63.1">touchmove</span></code><span class="koboSpan" id="kobo.64.1">: It is dispatched when the user moves a touch point along the touch surface.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.65.1">touchcancel</span></code><span class="koboSpan" id="kobo.66.1">: It is dispatched when a touch point is disrupted in an implementation-specific manner.</span></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec215"/><span class="koboSpan" id="kobo.67.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.68.1">Refer to </span><a class="link" href="ch06.html" title="Chapter 6. Transition with Style"><span class="koboSpan" id="kobo.69.1">Chapter 6</span></a><span class="koboSpan" id="kobo.70.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.71.1">Transition with Style</span></em></span><span class="koboSpan" id="kobo.72.1">, for more details on object constancy and the ripple effect technique used in this recipe.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.73.1">Refer to </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.74.1">Chapter 7</span></a><span class="koboSpan" id="kobo.75.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.76.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.77.1">, for more details on the progress-circle attribute tween transition technique used in this recipe</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.78.1">Refer to the W3C Touch Events proposed recommendation for a complete list of touch event types at </span><a class="ulink" href="https://www.w3.org/TR/touch-events/"><span class="koboSpan" id="kobo.79.1">https://www.w3.org/TR/touch-events
</span></a></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.80.1">Refer to the </span><code class="literal"><span class="koboSpan" id="kobo.81.1">d3.touch</span></code><span class="koboSpan" id="kobo.82.1"> API document for more details on multi-touch detection at </span><a class="ulink" href="https://github.com/d3/d3-selection/blob/master/README.md#touches"><span class="koboSpan" id="kobo.83.1">https://github.com/d3/d3-selection/blob/master/README.md#touches
</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Implementing zoom and pan behavior"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec73"/><span class="koboSpan" id="kobo.1.1">Implementing zoom and pan behavior</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Zooming and panning are common and useful techniques in data visualization, which work particularly well with SVG-based visualization, since vector graphic does not suffer from pixilation as its bitmap counterpart would. </span><span class="koboSpan" id="kobo.2.2">Zooming is especially useful when you are dealing with large dataset when it is impractical or impossible to visualize the entire dataset, thus a zoom and drill-down approach needs to be employed. </span><span class="koboSpan" id="kobo.2.3">In this recipe, we will explore D3's built-in support for both zooming and panning.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec216"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/zoom.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/zoom.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec217"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will implement geometric zooming and panning using D3 zoom support. </span><span class="koboSpan" id="kobo.7.2">Let's see how this is done in the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
    var width = 600, height = 350, r = 50; 
 
    var data = [ 
        [width / 2 - r, height / 2 - r], 
        [width / 2 - r, height / 2 + r], 
        [width / 2 + r, height / 2 - r], 
        [width / 2 + r, height / 2 + r] 
    ]; 
 
    var svg = d3.select("body").append("svg") 
            .attr("style", "1px solid black") 
            .attr("width", width) 
            .attr("height", height) 
            .call( // &lt;-A 
                    d3.zoom() // &lt;-B 
                    .scaleExtent([1, 10]) // &lt;-C 
                    .on("zoom", zoomHandler) // &lt;-D 
            ) 
            .append("g"); 
 
    svg.selectAll("circle") 
            .data(data) 
            .enter().append("circle") 
            .attr("r", r) 
            .attr("transform", function (d) { 
                return "translate(" + d + ")"; 
            }); 
 
    function zoomHandler() { 
        var transform = d3.event.transform; 
 
        svg.attr("transform", "translate(" 
            + transform.x + "," + transform.y 
            + ")scale(" + transform.k + ")"); 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">This recipe generates the following zooming and panning effect:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_10_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Original</span></p><p><span class="koboSpan" id="kobo.12.1">The previous image show the original state of the visualization while the following one shows what happen when user zooms in either through scrolling the mouse wheel on a desktop or using multi-gesture on touch screen devices.</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.13.1"><img src="graphics/image_10_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.14.1">Zoom</span></p><p><span class="koboSpan" id="kobo.15.1">The following screenshot shows what happen when user drags (pan) the image either with their mouse or finger.</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.16.1"><img src="graphics/image_10_006.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.17.1">Pan</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec218"/><span class="koboSpan" id="kobo.18.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.19.1">At this point, you might be surprised to see how little code is necessary to implement this fully functional zoom and pan effect with D3. </span><span class="koboSpan" id="kobo.19.2">If you have this recipe open in your browser, you will also notice zooming and panning reacts perfectly well to both mouse wheel and multi-touch gesture. </span><span class="koboSpan" id="kobo.19.3">Most of the heavy lifting is done by D3 library. </span><span class="koboSpan" id="kobo.19.4">What we have to do here is simply define what a zoom behavior is. </span><span class="koboSpan" id="kobo.19.5">Let's see how this is done in the code; firstly, we need to define zoom behavior on a SVG container:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.20.1">var svg = d3.select("body").append("svg") 
            .attr("style", "1px solid black") 
            .attr("width", width) 
            .attr("height", height) 
            .call( // &lt;-A 
                d3.behavior.zoom() // &lt;-B 
                    .scaleExtent([1, 10]) // &lt;-C 
                    .on("zoom", zoomHandler) // &lt;-D 
            ) 
            .append("g"); 
</span></pre><p><span class="koboSpan" id="kobo.21.1">As we can see on line A, a </span><code class="literal"><span class="koboSpan" id="kobo.22.1">d3.zoom</span></code><span class="koboSpan" id="kobo.23.1"> function was created (refer to line B) and invoked on the </span><code class="literal"><span class="koboSpan" id="kobo.24.1">svg</span></code><span class="koboSpan" id="kobo.25.1"> container. </span><span class="koboSpan" id="kobo.25.2">The </span><code class="literal"><span class="koboSpan" id="kobo.26.1">d3.zoom</span></code><span class="koboSpan" id="kobo.27.1"> will automatically create event listeners to handle the low-level zooming and panning gesture on the associated SVG container (in our case, the </span><code class="literal"><span class="koboSpan" id="kobo.28.1">svg</span></code><span class="koboSpan" id="kobo.29.1"> element itself). </span><span class="koboSpan" id="kobo.29.2">The low-level zoom gesture will then be translated to a high-level D3 zoom event. </span><span class="koboSpan" id="kobo.29.3">The default event listeners support both mouse and touch events. </span><span class="koboSpan" id="kobo.29.4">On line C, we define </span><code class="literal"><span class="koboSpan" id="kobo.30.1">scaleExtent</span></code><span class="koboSpan" id="kobo.31.1"> with a two-element array [1, 10] (a range). </span><span class="koboSpan" id="kobo.31.2">The scale extent defines how much zoom should be allowed (in our case, we allow 10X zoom). </span><span class="koboSpan" id="kobo.31.3">Finally, on line D, we register a custom zoom event handler to handle D3 zoom events. </span><span class="koboSpan" id="kobo.31.4">Now, let's take a look at what task this zoom event handler performs:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1">function zoomHandler() { 
    var transform = d3.event.transform; 
 
    svg.attr("transform", "translate(" 
        + transform.x + "," + transform.y 
        + ")scale(" + transform.k + ")"); 
} 
</span></pre><p><span class="koboSpan" id="kobo.33.1">In the </span><code class="literal"><span class="koboSpan" id="kobo.34.1">zoom</span></code><span class="koboSpan" id="kobo.35.1"> function, we simply delegate the actual zooming and panning to SVG transformation. </span><span class="koboSpan" id="kobo.35.2">To further simplify this task, the D3 zoom event has also calculated the necessary translate and scale. </span><span class="koboSpan" id="kobo.35.3">So, all we need to do is embed them into a SVG transform attribute. </span><span class="koboSpan" id="kobo.35.4">Here are the properties contained in a zoom event:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.36.1">transform.x</span></code><span class="koboSpan" id="kobo.37.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.38.1">transform.y</span></code><span class="koboSpan" id="kobo.39.1">: Current translation vector</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.40.1">transform.k</span></code><span class="koboSpan" id="kobo.41.1">: A number representing the current scale</span></li></ul></div><p><span class="koboSpan" id="kobo.42.1">At this point, you might be asking what the point of having this </span><code class="literal"><span class="koboSpan" id="kobo.43.1">zoomHandler</span></code><span class="koboSpan" id="kobo.44.1"> function is. </span><span class="koboSpan" id="kobo.44.2">Why can't D3 take care of this step for us? </span><span class="koboSpan" id="kobo.44.3">The reason is that D3 zoom behavior is not designed specifically for SVG, but rather designed as a general zoom behavior support mechanism. </span><span class="koboSpan" id="kobo.44.4">Therefore, this zoom function implements the translation of general zoom and pan events into SVG-specific transformation.</span></p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec219"/><span class="koboSpan" id="kobo.45.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.46.1">The zoom function is also capable of performing additional tasks other than the simple coordinate system transformation. </span><span class="koboSpan" id="kobo.46.2">For example, a common technique is to load additional data when the user issues a zoom gesture, hence implementing the drill-down capability in zoom function. </span><span class="koboSpan" id="kobo.46.3">A well-known example is a digital map; as you increase zoom level on a map, more data and details then can be loaded and illustrated.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec220"/><span class="koboSpan" id="kobo.47.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.48.1">Refer to </span><a class="link" href="ch02.html" title="Chapter 2. Be Selective"><span class="koboSpan" id="kobo.49.1">Chapter 2</span></a><span class="koboSpan" id="kobo.50.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.51.1">Be Selective</span></em></span><span class="koboSpan" id="kobo.52.1">, for more details on </span><code class="literal"><span class="koboSpan" id="kobo.53.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.54.1"> function and selection manipulation</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.55.1">Refer to W3C SVG coordinate system transformations specification for more information on how zoom and pan effect was achieved in SVG at </span><a class="ulink" href="https://www.w3.org/TR/SVG/coords.html#EstablishingANewUserSpace"><span class="koboSpan" id="kobo.56.1">https://www.w3.org/TR/SVG/coords.html#EstablishingANewUserSpace
</span></a></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.57.1">Refer to the </span><code class="literal"><span class="koboSpan" id="kobo.58.1">d3.zoom</span></code><span class="koboSpan" id="kobo.59.1"> API document for more details on D3 zoom support at </span><a class="ulink" href="https://github.com/d3/d3-zoom/blob/master/README.md#zoom"><span class="koboSpan" id="kobo.60.1">https://github.com/d3/d3-zoom/blob/master/README.md#zoom</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Implementing drag behavior"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec74"/><span class="koboSpan" id="kobo.1.1">Implementing drag behavior</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Another common behavior in interactive visualization that we will cover in this chapter is </span><span class="strong"><strong><span class="koboSpan" id="kobo.3.1">dragging</span></strong></span><span class="koboSpan" id="kobo.4.1">. </span><span class="koboSpan" id="kobo.4.2">Drag is useful to provide capabilities in visualization that allow graphical rearrangement or even user input through force; we will discuss this in the next chapter. </span><span class="koboSpan" id="kobo.4.3">In this recipe, we will explore how the drag behavior is supported in D3.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec221"/><span class="koboSpan" id="kobo.5.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/drag.html"><span class="koboSpan" id="kobo.7.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter10/drag.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec222"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">Here, we will produce four circles that can be dragged using D3 drag behavior support and additionally with SVG boundary detection while being dragging. </span><span class="koboSpan" id="kobo.9.2">Now, let's see how to implement this in code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;script type="text/javascript"&gt; 
    var width = 960, height = 500, r = 50; 
 
    var data = [ 
        [width / 2 - r, height / 2 - r], 
        [width / 2 - r, height / 2 + r], 
        [width / 2 + r, height / 2 - r], 
        [width / 2 + r, height / 2 + r] 
    ]; 
 
    var svg = d3.select("body").append("svg") 
            .attr("width", width) 
            .attr("height", height) 
            .append("g"); 
 
    var drag = d3.drag() // &lt;-A 
            .on("drag", move); 
 
    svg.selectAll("circle") 
            .data(data) 
            .enter().append("circle") 
            .attr("r", r) 
            .attr("transform", function (d) { 
                return "translate(" + d + ")"; 
            }) 
            .call(drag); // &lt;-A 
 
    function move(d) { 
        var x = d3.event.x, // &lt;-C 
            y = d3.event.y; 
 
        if(inBoundaries(x, y)) 
            d3.select(this)  
                .attr("transform", function (d) { // &lt;-D 
                    return "translate(" + x + ", " + y + ")"; 
                }); 
    } 
     
    function inBoundaries(x, y){ 
        return (x &gt;= (0 + r) &amp;&amp; x &lt;= (width - r))  
            &amp;&amp; (y &gt;= (0 + r) &amp;&amp; y &lt;= (height - r)); 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">This recipe generates the drag behavior on the following four circles:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.12.1"><img src="graphics/image_10_007.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.13.1">Original</span></p><p><span class="koboSpan" id="kobo.14.1">The preceding image shows what this recipe renders in its original state while the following image show what happens when user drags each circle away from the center.</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.15.1"><img src="graphics/image_10_008.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.16.1">Dragged</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec223"/><span class="koboSpan" id="kobo.17.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">As we can see, drag support follows a pattern similar to the D3 zoom support. </span><span class="koboSpan" id="kobo.18.2">The main drag capability is provided by the </span><code class="literal"><span class="koboSpan" id="kobo.19.1">d3.drag</span></code><span class="koboSpan" id="kobo.20.1"> function (refer to line A). </span><span class="koboSpan" id="kobo.20.2">D3 drag behavior automatically creates appropriate low-level event listeners to handle drag gestures on the given element and then translates low-level events to high-level D3 drag events. </span><span class="koboSpan" id="kobo.20.3">Both mouse and touch events are supported, as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.21.1">var drag = d3.behavior.drag() // &lt;-A 
            .on("drag", move); 
</span></pre><p><span class="koboSpan" id="kobo.22.1">In this recipe, we are interested in the </span><code class="literal"><span class="koboSpan" id="kobo.23.1">drag</span></code><span class="koboSpan" id="kobo.24.1"> event, and it is handled by our </span><code class="literal"><span class="koboSpan" id="kobo.25.1">move</span></code><span class="koboSpan" id="kobo.26.1"> function. </span><span class="koboSpan" id="kobo.26.2">Similar to the zoom behavior, the D3 drag behavior support is event driven, therefore, it allows maximum flexibility in implementation, supporting not only SVG but also the HTML canvas. </span><span class="koboSpan" id="kobo.26.3">Once defined, the behavior can be attached to any element by calling it on a given selection:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.27.1">svg.selectAll("circle") 
            .data(data) 
            .enter().append("circle") 
            .attr("r", r) 
            .attr("transform", function (d) { 
                return "translate(" + d + ")"; 
            }) 
            .call(drag); // &lt;-B 
</span></pre><p><span class="koboSpan" id="kobo.28.1">Next, in the </span><code class="literal"><span class="koboSpan" id="kobo.29.1">move</span></code><span class="koboSpan" id="kobo.30.1"> function, we simply use SVG transformation to move the dragged element to a proper location (refer to line D) based on the information conveyed by the drag event (refer to line C):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.31.1">   function move(d) { 
        var x = d3.event.x, // &lt;-C 
            y = d3.event.y; 
 
        if(inBoundaries(x, y)) 
            d3.select(this)  
                .attr("transform", function (d) { // &lt;-D 
                    return "translate(" + x + ", " + y + ")"; 
                }); 
} 
</span></pre><p><span class="koboSpan" id="kobo.32.1">One additional condition we check here is to calculate the SVG boundaries constraint so the user cannot drag an element outside of the SVG. </span><span class="koboSpan" id="kobo.32.2">This is achieved by the following check:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.33.1">    function inBoundaries(x, y){ 
        return (x &gt;= (0 + r) &amp;&amp; x &lt;= (width - r))  
            &amp;&amp; (y &gt;= (0 + r) &amp;&amp; y &lt;= (height - r)); 
    } 
</span></pre></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec224"/><span class="koboSpan" id="kobo.34.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.35.1">Other than the drag event, the D3 drag behavior also supports two other event types. </span><span class="koboSpan" id="kobo.35.2">The following list shows all supported drag event types and their attributes:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.36.1">dragstart</span></code><span class="koboSpan" id="kobo.37.1">: It is triggered when a drag gesture starts.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.38.1">drag</span></code><span class="koboSpan" id="kobo.39.1">: It is fired when the element is dragged. </span><span class="koboSpan" id="kobo.39.2">The </span><code class="literal"><span class="koboSpan" id="kobo.40.1">d3.event</span></code><span class="koboSpan" id="kobo.41.1"> object will contain </span><span class="emphasis"><em><span class="koboSpan" id="kobo.42.1">x</span></em></span><span class="koboSpan" id="kobo.43.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.44.1">y</span></em></span><span class="koboSpan" id="kobo.45.1"> properties that represent the current absolute drag coordinates of the element. </span><span class="koboSpan" id="kobo.45.2">It will also contain the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.46.1">dx</span></em></span><span class="koboSpan" id="kobo.47.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.48.1">dy</span></em></span><span class="koboSpan" id="kobo.49.1"> properties representing the element's coordinates relative to its position at the beginning of the gesture.</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.50.1">dragend</span></code><span class="koboSpan" id="kobo.51.1">: It is triggered when a drag gesture has finished.</span></li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec225"/><span class="koboSpan" id="kobo.52.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.53.1">Refer to </span><a class="link" href="ch02.html" title="Chapter 2. Be Selective"><span class="koboSpan" id="kobo.54.1">Chapter 2</span></a><span class="koboSpan" id="kobo.55.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.56.1">Be Selective</span></em></span><span class="koboSpan" id="kobo.57.1">, for more details on </span><code class="literal"><span class="koboSpan" id="kobo.58.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.59.1"> function and selection manipulation.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.60.1">Refer to the </span><code class="literal"><span class="koboSpan" id="kobo.61.1">d3.behavior.drag</span></code><span class="koboSpan" id="kobo.62.1"> API document for more details on D3 drag support at </span><a class="ulink" href="https://github.com/d3/d3-drag/blob/master/README.md#drag"><span class="koboSpan" id="kobo.63.1">https://github.com/d3/d3-drag/blob/master/README.md#drag
</span></a><span class="koboSpan" id="kobo.64.1">.</span></li></ul></div></div></div></div></div></body></html>