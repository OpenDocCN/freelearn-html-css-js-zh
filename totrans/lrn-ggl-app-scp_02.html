<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Creating Basic Elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Creating Basic Elements</h1></div></div></div><p>In the previous chapter, you learned about <a class="indexterm" id="id61"/>
<span class="strong"><strong>Google Apps Script</strong></span> (<span class="strong"><strong>GAS</strong></span>) and how to create a script project. In this chapter, you will learn how to create a clickable button, a custom menu, a message box, a sidebar and dialogs, as well as how to debug your script. We will use Sheets for the first two tasks and Docs for all the other tasks.</p><div class="section" title="Creating a clickable button"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Creating a clickable button</h1></div></div></div><p>In the previous chapter, you<a class="indexterm" id="id62"/> learned how to open the script editor in Google Sheets. For this task, open the script editor in a newly created or any existing Google Sheet and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select cell <span class="emphasis"><em>B3</em></span> or any other cell. Click on <span class="strong"><strong>Insert</strong></span> and select <span class="strong"><strong>Drawing...</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_01.jpg"/></div></li><li class="listitem">A drawing <a class="indexterm" id="id63"/>editor window will open. Click on the <span class="strong"><strong>Text box</strong></span> icon and then click anywhere within the canvas area. Type <code class="literal">Click Me</code>. Resize the object to enclose the text only, as shown in the following screenshot:<div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_02.jpg"/></div></li><li class="listitem">Click on <span class="strong"><strong>Save &amp; Close</strong></span> to exit the drawing editor. Now, the <span class="strong"><strong>Click Me</strong></span> image will be inserted into the active cell (<span class="emphasis"><em>B3</em></span>), as shown in the following screenshot:<div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_03.jpg"/></div><p>You can drag this image anywhere around the spreadsheet except in the menu bar.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>In Google Sheets, images are not anchored to a particular cell, and they can be dragged or moved around.</p></div></div><p>If you click <a class="indexterm" id="id64"/>on the image, a drop-down arrow on the top-right corner will be visible:</p><div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_04.jpg"/></div></li><li class="listitem">Click on the <span class="strong"><strong>Assign script…</strong></span> menu item. A script assignment window will open. Type <code class="literal">greeting</code> or any other name you like, but remember the name as the same name <a class="indexterm" id="id65"/>will be used to create a function in the next steps. Click on <span class="strong"><strong>OK</strong></span>:<div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_05.jpg"/></div></li><li class="listitem">Now open the script editor in the same spreadsheet. When you open the script editor, a project selector dialog will open. You can close it or select <span class="strong"><strong>Blank Project</strong></span>. A default function, <code class="literal">myFunction</code>, will be there in the editor. Delete everything in the editor and insert the following code:<div class="informalexample"><pre class="programlisting">function greeting() {
  Browser
}</pre></div><p>When<a class="indexterm" id="id66"/> you type <code class="literal">.</code> next to <code class="literal">Browser</code>, the code completion hint will open as shown:</p><div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_06.jpg"/></div><p>If you click on <code class="literal">msgBox(String title, String prompt, ButtonSet buttons):String</code>, then <code class="literal">msgBox(title, prompt, buttons)</code> will be inserted automatically.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>In addition to the code hint feature, you can use the auto-indent feature. Ensure that the <span class="strong"><strong>Indent</strong></span> icon, on the left side of the <span class="strong"><strong>Save</strong></span> icon, is pressed. Select the few lines of code you would like to indent, then press the <span class="emphasis"><em>Tab</em></span> key on your keyboard. Now you can see that these lines of code indented automatically.</p></div></div><p>In this code, <code class="literal">Browser</code> denotes that you are calling the <code class="literal">Browser</code> class from the <code class="literal">Base</code> (or basic) script services. <code class="literal">msgBox</code> is the <code class="literal">Browser</code> class's method with three parameters. The names of the parameters are self-explanatory. The <code class="literal">title</code> parameter denotes the title of the message box, <code class="literal">prompt</code> denotes your message to the user, and <code class="literal">buttons</code> denotes what category or sets of buttons you would like to include in your message box.</p></li><li class="listitem">Now edit or replace the code with the following:<div class="informalexample"><pre class="programlisting">function greeting() {
  Browser.msgBox("Greeting", "Hello World!", Browser.Buttons.OK);
}</pre></div></li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> icon and enter a project name if asked. You have completed the<a class="indexterm" id="id67"/> coding of your <code class="literal">greeting</code> function.</li><li class="listitem">Now, activate the spreadsheet tab/window and click on your <span class="strong"><strong>Click Me</strong></span> button. An authorization window will open and you need to click <span class="strong"><strong>Continue</strong></span>. In the successive <span class="strong"><strong>Request for Permission </strong></span>window, click on <span class="strong"><strong>Allow</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_07.jpg"/></div><p>You only need to do this once for this particular scope. The scopes will be shown in the concerned permission dialog/window. In this script, the scope is <span class="strong"><strong>View and manage your spreadsheets in Google Drive</strong></span>. Above<a class="indexterm" id="id68"/> the scope, you can see the title <span class="strong"><strong>Chapter 2 would like to:</strong></span>, which means your script project (project name <span class="strong"><strong>Chapter 2</strong></span>) or application would like to get your permission for that particular scope.</p><p>As soon as you click <span class="strong"><strong>Allow</strong></span>, the permission dialog will close, and your actual greeting message box will open as shown here:</p><div class="mediaobject"><img alt="Creating a clickable button" src="graphics/B05010_02_08.jpg"/></div><p>Click <span class="strong"><strong>Ok</strong></span> to close the message box. Whenever you click on your button, this message box will open.</p></li></ol></div><p>Congratulations! You<a class="indexterm" id="id69"/> have created a clickable button and associated a GAS function with it.</p></div></div>
<div class="section" title="Showing toast when a button is clicked"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Showing toast when a button is clicked</h1></div></div></div><p>Toast appears as a<a class="indexterm" id="id70"/> popup window in the lower-right corner of the active spreadsheet with a title and message. To create a toast dialog, edit or replace the <code class="literal">greeting</code> function as follows:</p><div class="informalexample"><pre class="programlisting">function greeting() {
  SpreadsheetApp.getActiveSpreadsheet()
   .toast("Hello World!", "Greeting");
}</pre></div><p>Now if you click the <a class="indexterm" id="id71"/>button, then a toast dialog will appear as shown in the following screenshot, and it disappears within 5 seconds (the default):</p><div class="mediaobject"><img alt="Showing toast when a button is clicked" src="graphics/B05010_02_09.jpg"/></div><p>You can include a<a class="indexterm" id="id72"/> third argument, that is, timeout seconds, in the <code class="literal">toast</code> method. This means how long the toast will be visible for. Put a negative number if you want it to show up forever. For<a class="indexterm" id="id73"/> example, <code class="literal">toast("Hello World!", "Greeting", -1)</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Toast only works in Sheets.</p></div></div></div>
<div class="section" title="Creating a custom menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Creating a custom menu</h1></div></div></div><p>You might be wondering<a class="indexterm" id="id74"/> whether you can execute the <code class="literal">greeting</code> function without the help of the button. The answer is yes. In the script editor, there is a <span class="strong"><strong>Run</strong></span> menu. If you click on <span class="strong"><strong>Run</strong></span> | <span class="strong"><strong>greeting</strong></span>, then the <code class="literal">greeting</code> function will be executed and the message box will open.</p><p>Creating a button for every function may not be feasible. Although you cannot alter or add items to the application's standard menu (except the <span class="strong"><strong>Add-ons</strong></span> menu) such as <span class="strong"><strong>File</strong></span>, <span class="strong"><strong>Edit</strong></span>, <span class="strong"><strong>View</strong></span>, and so on, you can add custom menus and menu items.</p><p>For this task, create a new Google Docs document or open an existing document. Open the script editor and type these two functions:</p><div class="informalexample"><pre class="programlisting">function createMenu() {
  DocumentApp.getUi()
   .createMenu("PACKT")
   .addItem("Greeting","greeting")
   .addToUi();
}

function greeting() {
  var ui = DocumentApp.getUi();
  ui.alert("Greeting", "Hello World!", ui.ButtonSet.OK);
}</pre></div><p>In the first function, you are using the <code class="literal">DocumentApp</code> class, invoking the <code class="literal">getUi</code> method, and consecutively invoking the <code class="literal">createMenu</code>, <code class="literal">addItem</code>, and <code class="literal">addToUi</code> methods by method chaining. The second function should be familiar to you, as you created it in the previous task, but this time with the <code class="literal">DocumentApp</code> class and associated methods.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>Do not <a class="indexterm" id="id75"/>copy-paste these functions or codes; create/edit them yourself line by line. This will help you become familiar with the script editor's code hinting and completion features.</p></div></div><p>Now run the <code class="literal">createMenu</code> function and flip to the document window/tab. You will see a new menu item called <span class="strong"><strong>PACKT</strong></span> added next to the <span class="strong"><strong>Help</strong></span> menu. You can see the custom menu <span class="strong"><strong>PACKT</strong></span> with an item <span class="strong"><strong>Greeting</strong></span> as shown in the following screenshot. The item label <span class="strong"><strong>Greeting</strong></span> is associated with the function <code class="literal">greeting</code>.</p><div class="mediaobject"><img alt="Creating a custom menu" src="graphics/B05010_02_10.jpg"/></div><p>The menu item <span class="strong"><strong>Greeting</strong></span> works the same way as the button created in the previous task. The drawback with this method of inserting the custom menu is that to get the custom menu to show up, you need to run <code class="literal">createMenu</code> every time within the script editor. Consider how your user would be able to use this <code class="literal">greeting</code> function if they didn't know about GAS and the script editor. Think about how your user may not be a programmer like you. To enable your users to execute selected GAS functions, you should create a custom menu and make it visible as soon as the document opens. To do so, rename the <code class="literal">createMenu</code> function <code class="literal">onOpen</code>, and that's all.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>The <code class="literal">onOpen</code> function is a special function name. Whenever a user opens a document, the GAS interpreter executes this function first. Other similar function names are <code class="literal">onEdit</code>, <code class="literal">onInstall</code>, <code class="literal">doGet</code>, and <code class="literal">doPost</code>. The first two are spreadsheet event-related functions and the next two are published script service's <code class="literal">get</code> and <code class="literal">post</code> callback functions. You should not use these function names other than for the intended purposes.</p></div></div></div>
<div class="section" title="Creating a sidebar"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Creating a sidebar</h1></div></div></div><p>A sidebar is a static dialog<a class="indexterm" id="id76"/> box and is included on the right-hand side of the document editor window. To create a sidebar, type the following code in the editor:</p><div class="informalexample"><pre class="programlisting">function onOpen() {
  var htmlOutput = HtmlService
  .createHtmlOutput('&lt;button onclick="alert(\'Hello World!\');"&gt;Click Me&lt;/button&gt;')
  .setTitle('My Sidebar');

  DocumentApp.getUi().showSidebar(htmlOutput);
}</pre></div><p>In the preceding code, you are using <code class="literal">HtmlService</code> and invoking its method <code class="literal">createHtmlOutput</code> then consecutively invoking the <code class="literal">setTitle</code> method. To test this code, run the <code class="literal">onOpen</code> function or reload the document. The sidebar will open in the right-hand side of the document window as shown in the following screenshot. The sidebar layout size is a fixed one, which means you cannot change, alter, or resize it.</p><div class="mediaobject"><img alt="Creating a sidebar" src="graphics/B05010_02_11.jpg"/></div><p>The button in the sidebar is an HTML element, not a GAS element, and if clicked, it opens the browser interface's alert box.</p></div>
<div class="section" title="Creating an Add-ons menu"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Creating an Add-ons menu</h1></div></div></div><p>In the previous task, you<a class="indexterm" id="id77"/> included the HTML code inline as a string argument to the <code class="literal">createHtmlOutput</code> method. Alternatively, you can put this HTML snippet in a separate HTML file.</p><p>To create a new HTML file, in the script editor, go to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Html file</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating an Add-ons menu" src="graphics/B05010_02_12.jpg"/></div><p>Then in the <a class="indexterm" id="id78"/>
<span class="strong"><strong>Create File</strong></span> box, enter your preferred name for the new HTML file. For this task, enter <code class="literal">Index</code> and click on the <span class="strong"><strong>OK</strong></span> button. The <code class="literal">.html</code> extension will be added automatically.</p><div class="mediaobject"><img alt="Creating an Add-ons menu" src="graphics/B05010_02_13.jpg"/></div><p>A new <code class="literal">Index.html</code> file will <a class="indexterm" id="id79"/>be created with a few lines of default HTML code, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating an Add-ons menu" src="graphics/B05010_02_14.jpg"/></div><p>Insert your <code class="literal">button</code> tags between the <code class="literal">body</code> tags as shown here:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;base target="_top"&gt;
  &lt;/head&gt;
  &lt;body&gt;
    <span class="strong"><strong>&lt;button onclick="alert('Hello World!');"&gt;Click Me&lt;/button&gt;</strong></span>
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>Insert the code shown here in the <code class="literal">Code.gs</code> file:</p><div class="informalexample"><pre class="programlisting">function onOpen(){
  DocumentApp.getUi()
  .createAddonMenu()
  .addItem("Show Sidebar", "showSidebar")
  .addToUi();
}


function showSidebar() {
  DocumentApp.getUi()
  .showSidebar(
    HtmlService.createHtmlOutputFromFile('Index')
    .setTitle('Greetings')
  );
}</pre></div><p>To test the code, run<a class="indexterm" id="id80"/> the <code class="literal">onOpen</code> function or reload the document. In the <span class="strong"><strong>Add-ons</strong></span> menu, a new item, called <span class="strong"><strong>Chapter 2</strong></span> (the project name), will be added, as shown here:</p><div class="mediaobject"><img alt="Creating an Add-ons menu" src="graphics/B05010_02_15.jpg"/></div><p>
<span class="strong"><strong>Show Sidebar</strong></span> is the label for the <code class="literal">showSidebar</code> function; click on it to show your sidebar.</p></div>
<div class="section" title="Creating a modal dialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Creating a modal dialog</h1></div></div></div><p>To create a modal dialog, which prevents the user from updating anything in the spreadsheet or <a class="indexterm" id="id81"/>document, update the code in the <code class="literal">Code.gs</code> file as shown here:</p><div class="informalexample"><pre class="programlisting">function onOpen(){
  DocumentApp.getUi()
  .createAddonMenu()
  .addItem("Show Dialog", "showDialog")
  .addToUi();
}

function showDialog() {
  var html = HtmlService
   .createHtmlOutputFromFile('Index');
  DocumentApp.getUi()   
   .showModalDialog(html, 'Greeting');
}</pre></div><p>Go to <span class="strong"><strong>Add-ons</strong></span> | <span class="strong"><strong>Chapter 2</strong></span> | <span class="strong"><strong>Show Dialog</strong></span> and a modal dialog will pop up:</p><div class="mediaobject"><img alt="Creating a modal dialog" src="graphics/B05010_02_16.jpg"/></div></div>
<div class="section" title="Creating a modeless dialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Creating a modeless dialog</h1></div></div></div><p>Now we will create a<a class="indexterm" id="id82"/> modeless dialog and see the difference between modal and modeless dialogs. Update the <code class="literal">showDialog</code> function as shown here:</p><div class="informalexample"><pre class="programlisting">function showDialog() {
  var html = HtmlService.createHtmlOutputFromFile('Index');
  DocumentApp.getUi()
  .showModelessDialog(html, 'Greeting');
}</pre></div><p>Note that the <code class="literal">showModalDialog</code> method has been changed to <code class="literal">showModelessDialog</code>.</p><p>Modeless dialogs do not prevent you from doing other things, such as editing the document, and you can drag<a class="indexterm" id="id83"/> the dialog around as shown here:</p><div class="mediaobject"><img alt="Creating a modeless dialog" src="graphics/B05010_02_17.jpg"/></div></div>
<div class="section" title="Debugging your script"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Debugging your script</h1></div></div></div><p>Logging the values <a class="indexterm" id="id84"/>of variables at a few points is essential when testing and debugging your code. The <code class="literal">Logger</code> class is a helpful tool to do this and has a few methods that are essential to debug your code.</p><p>Update the <code class="literal">showDialog</code> function as shown here:</p><div class="informalexample"><pre class="programlisting">function showDialog() {
  var ui = DocumentApp.getUi();

  var response = ui.prompt(
      'Greeting', 'Will you enter your name below?', ui.ButtonSet.YES_NO
  );

  if (response.getSelectedButton() == ui.Button.YES) {
    Logger.log('Your name is %s.', response.getResponseText());
  } else if (response.getSelectedButton() == ui.Button.NO) {
    Logger.log('You clicked \'NO\' button');
  } else {
    Logger.log('You closed the dialog.');
  }
}</pre></div><p>Run the <code class="literal">showDialog</code> function as usual from the <span class="strong"><strong>Add-ons</strong></span> menu. Do anything, for example, enter your name and click on <span class="strong"><strong>Yes</strong></span> or <span class="strong"><strong>No</strong></span> or close the dialog.</p><div class="mediaobject"><img alt="Debugging your script" src="graphics/B05010_02_18.jpg"/></div><p>Now within the<a class="indexterm" id="id85"/> script editor, press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Enter</em></span> (Windows) or Command + <span class="emphasis"><em>Enter</em></span> (Mac) or from the <span class="strong"><strong>View</strong></span> menu, select <span class="strong"><strong>Logs</strong></span>, then you can see the logged text with a timestamp as shown here:</p><div class="mediaobject"><img alt="Debugging your script" src="graphics/B05010_02_19.jpg"/></div><p>For a more detailed study of the <code class="literal">Logger</code> future, create the function <code class="literal">debug</code> as shown here:</p><div class="informalexample"><pre class="programlisting">function debug(){
  var square = 0;
  for(var i = 0; i &lt; 10; i++){
    square = i * i;
    Logger.log(square);
  }
}</pre></div><p>Run the <code class="literal">debug</code> function and see the <code class="literal">Logger</code> result as shown here:</p><div class="mediaobject"><img alt="Debugging your script" src="graphics/B05010_02_20.jpg"/></div><p>In addition to logging, you can use the <code class="literal">debug</code> feature of the editor. In the editor, you set break points at one or more lines. To do so, click once on the line number on which you want to set a break <a class="indexterm" id="id86"/>point. A red dot will be toggled just on the left-hand side of the line number, as shown here:</p><div class="mediaobject"><img alt="Debugging your script" src="graphics/B05010_02_21.jpg"/></div><p>Select the <code class="literal">debug</code> function that you want to debug in the <span class="strong"><strong>Select function</strong></span> selector if it is not already selected. Click on the <span class="strong"><strong>Debug</strong></span> button (shown as an insect) to the left of the function selector. The function is executed up to the break point and then pauses. The edit window is split horizontally and shows the object and its values in the bottom part of the window as shown here:</p><div class="mediaobject"><img alt="Debugging your script" src="graphics/B05010_02_22.jpg"/></div><p>Click on the <span class="strong"><strong>Continue debugging</strong></span> button to see the values on every cycle of the <code class="literal">for</code> loop.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>You can<a class="indexterm" id="id87"/> experiment with the other features such as step into, step over, and step out.</p></div></div><p>To exit the debugging session, click on the <span class="strong"><strong>Stop debugging</strong></span> button and remember to remove (toggle) all the break points.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Summary</h1></div></div></div><p>In this chapter, you learned about many type of dialog and how to create and display them, you found out how to use the <code class="literal">Logger</code> class to log values, and you also saw how to debug your script. In the next chapter, you will learn about Gmail and Contacts.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for this book from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you. </p><p>You can download the code files by following these steps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Log in or register to our website using your e-mail address and password.</li><li class="listitem" style="list-style-type: disc">Hover the mouse pointer on the <span class="strong"><strong>SUPPORT</strong></span> tab at the top.</li><li class="listitem" style="list-style-type: disc">Click on <span class="strong"><strong>Code Downloads &amp; Errata</strong></span>.</li><li class="listitem" style="list-style-type: disc">Enter the name of the book in the <span class="strong"><strong>Search</strong></span> box.</li><li class="listitem" style="list-style-type: disc">Select the book for which you're looking to download the code files.</li><li class="listitem" style="list-style-type: disc">Choose from the drop-down menu where you purchased this book from.</li><li class="listitem" style="list-style-type: disc">Click on <span class="strong"><strong>Code Download</strong></span>.</li></ul></div><p>Once the file is downloaded, please make sure that you unzip or extract the folder using the latest version of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">WinRAR / 7-Zip for Windows</li><li class="listitem" style="list-style-type: disc">Zipeg / iZip / UnRarX for Mac</li><li class="listitem" style="list-style-type: disc">7-Zip / PeaZip for Linux</li></ul></div></div></div></div></body></html>