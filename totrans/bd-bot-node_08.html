<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. A Bug-Tracking Agent for Teams</h1></div></div></div><p>
<strong>InternetRelayChat</strong> (<strong>IRC</strong>) enables us to communicate in real time in the form of text. This chat runs on a TCP protocol in a client-server model. IRC supports group messaging, which is called as channels, and also supports private messaging.</p><p>IRC is organized into many networks with different audiences. IRC being a client server, users need IRC clients to connect to IRC servers. IRC client software comes as packaged software, as well as web-based clients. Some browsers are also providing IRC clients as add-ons. Users can either install them on their systems, and then they can be used to connect to IRC servers or networks. While connecting to these IRC servers, users will have to provide a unique nickname and choose an existing channel for communication, or users can start a new channel while connecting to these servers.</p><p>In this chapter, we are going to develop one such IRC bot for bug-tracking purposes. This bug-tracking bot will provide information about bugs as well as details about a particular bug. All this will be done seamlessly within the IRC channel itself. It's going to be one window operation for a team, when it comes to knowing about their bugs or defects.</p><p>Great!!</p><div><div><div><div><h1 class="title"><a id="ch08lvl1sec36"/>IRC client and server</h1></div></div></div><p>As mentioned in the introduction, to initiate an IRC communication, we need an IRC client, and a server or a network to which our client will be connected. We will be using a freenode network for our client to connect to. Freenode is the largest free, open source, software-focused IRC network.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec32"/>IRC web-based client</h2></div></div></div><p>We will be using the IRC web-based client through a URL (<a class="ulink" href="https://webchat.freenode.net/">https://webchat.freenode.net/</a>). After opening the URL, you will see the following screen:</p><p>
</p><div><img src="img/image00379.jpeg" alt="IRC web-based client"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>As mentioned earlier, while connecting, we need to provide <strong>Nickname:</strong> and <strong>Channels:</strong>.</p><p>I have provided <strong>Nickname:</strong> as <code class="literal">Madan</code> and at <strong>Channels: </strong>as <code class="literal">#BugsChannel</code>. In IRC, channels are always identified by a #, so I used # to begin the name of my bugs channel. This is the new channel that we will be starting for communication. All the developers or team members can similarly provide their nicknames and this channel name to join the communication. Now let's prove <strong>Humanity:</strong> by selecting <strong>I'm not a robot</strong> and clicking the <strong>Connect</strong> button.</p><p>
</p><div><img src="img/image00380.jpeg" alt="IRC web-based client"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Once connected, you will see the following screen:</p><p>
</p><div><img src="img/image00381.jpeg" alt="IRC web-based client"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>With this, our IRC client is connected to the freenode network. You can also see the username on the right-hand side is <code class="literal">@Madan</code>, and within this <strong>#BugsChannel</strong>. Whoever joins this channel, using this channel name and a network, will be shown on the right-hand side.</p><p>In the next section, we will ask our bot to join this channel and the same network, and will see how it appears within the channel.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec37"/>IRC bots</h1></div></div></div><p>IRC bot is a program that connects to IRC as one of the clients and appears as one of the users in the IRC channels. These IRC bots are used to provide IRC services or to host chat-based custom implementations that will help teams to efficiently collaborate.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec33"/>Creating our first IRC bot using IRC and Node.js</h2></div></div></div><p>Let's start by creating a folder on our local drive, in order to store our bot program, from the Command Prompt:</p><pre class="programlisting">
<strong>mkdir ircbot</strong>
<strong>cd ircbot</strong>
</pre><p>Assuming we have Node.js and npm installed, let's create and initialize our <code class="literal">package.json</code>, which will store our bot's dependencies and definitions:</p><pre class="programlisting">
<strong>npm init</strong>
</pre><p>Once you have gone through the <code class="literal">npm init</code> options (which are very easy to follow), you'll see something similar to this:</p><p>
</p><div><img src="img/image00382.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In your project folder, you'll see the result, which is your <code class="literal">package.json</code> file:</p><p>
</p><div><img src="img/image00383.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Let's install the <code class="literal">irc</code> package from npm. This can be located at <a class="ulink" href="https://www.npmjs.com/package/irc">
https://www.npmjs.com/package/irc
</a>.</p><p>In order to install it, run this npm command.</p><pre class="programlisting">
<strong>npm install --save irc</strong>
</pre><p>You should then see something similar to this:</p><p>
</p><div><img src="img/image00384.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Having done this, the next thing to do is to update your <code class="literal">package.json</code> in order to include the <code class="literal">"engines"</code> attribute. Open the <code class="literal">package.json</code> file with a text editor and update it as follows:</p><pre class="programlisting">"engines": { &#13;
    "node": "&gt;=5.6.0" &#13;
} &#13;
</pre><p>Your <code class="literal">package.json</code> should then look like this:</p><p>
</p><div><img src="img/image00385.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Let's create our <code class="literal">app.js</code> file, which will be the entry point to our bot, as mentioned while setting up our node package.</p><p>Our <code class="literal">app.js</code> should look like this:</p><pre class="programlisting">var irc = require('irc'); &#13;
var client = new irc.Client('irc.freenode.net', 'BugTrackerIRCBot', { &#13;
  autoConnect: false &#13;
}); &#13;
client.connect(5, function(serverReply) { &#13;
  console.log("Connected!\n", serverReply); &#13;
  client.join('#BugsChannel', function(input) { &#13;
    console.log("Joined #BugsChannel"); &#13;
    client.say('#BugsChannel', "Hi, there. I am an IRC Bot which track bugs or defects for your team.\n I can help you using following commands.\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
  }); &#13;
}); &#13;
</pre><p>Now let's run our Node.js program and see how our console looks. If everything works well, our console should show our bot as being connected to the required network and also joined to a channel. The console can be seen to be the following:</p><p>
</p><div><img src="img/image00386.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Now, if you look at our channel <strong>#BugsChannel</strong> in our web client, you should see our bot has joined it and also sent a welcome message as well. Refer to the following screen:</p><p>
</p><div><img src="img/image00387.jpeg" alt="Creating our first IRC bot using IRC and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>If you look at the the preceding screen, our bot program has executed successfully. Our bot <code class="literal">BugTrackerIRCBot</code> has joined the channel <strong>#BugsChannel</strong>, and also the bot has sent an introduction message to all who are on the channel. If you look at the right side of the screen under usernames, we see <code class="literal">BugTrackerIRCBot</code> below <code class="literal">@Madan</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec34"/>Code understanding of our basic bot</h2></div></div></div><p>After seeing how our bot looks in IRC client, let's look at the basic code implementation from <code class="literal">app.js</code>.</p><p>We used <code class="literal">irc</code> library with the following line:</p><pre class="programlisting">var irc = require('irc'); &#13;
</pre><p>Using <code class="literal">irc</code> library, we instantiated the client to connect to one of the IRC networks using the following code snippet:</p><pre class="programlisting">var client = new irc.Client('irc.freenode.net', 'BugTrackerIRCBot', { &#13;
  autoConnect: false &#13;
}); &#13;
</pre><p>Here, we connected to network <code class="literal">irc.freenode.net</code> and provided a nickname of <code class="literal">BugTrackerIRCBot</code>. This name has been given because I would like my bot to track and report any bugs found in the future. Now, we ask the client to connect and join a specific channel using the following code snippet:</p><pre class="programlisting">client.connect(5, function(serverReply) { &#13;
  console.log("Connected!\n", serverReply); &#13;
  client.join('#BugsChannel', function(input) { &#13;
    console.log("Joined #BugsChannel"); &#13;
    client.say('#BugsChannel', "Hi, there. I am an IRC Bot which track bugs or defects for your team.\n I can help you using following commands.\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
  }); &#13;
}); &#13;
</pre><p>In the preceding code snippet, once the client is connected, we get a reply from the server. This reply is shown on a console. Once successfully connected, we ask the bot to join a channel using the following code line:</p><pre class="programlisting">client.join('#BugsChannel', function(input) { &#13;
</pre><p>Remember, <code class="literal">#BugsChannel</code> is what we have joined to from the web client at the start. Now, using <code class="literal">client.join()</code>, I am asking my bot to join the same channel. Once the bot has joined, the bot gives a welcome message in the same channel using the function <code class="literal">client.say()</code>.</p><p>Hopefully, this has given you some basic understanding of our bot and it's code implementations.</p><p>In the next section, we will enhance our bot so that our teams can have an effective communication experience while chatting.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec35"/>Enhancing our BugTrackerIRCBot</h2></div></div></div><p>Having built a very basic IRC bot, let's enhance our BugTrackerIRCBot.</p><p>As developers, we would always like to know how our programs or a system is functioning. To do this, typically, our testing teams carry out testing of a system or a program, and log the bugs or defects in a bug-tracking software package or system. We developers can later take a look at those bugs and address them as part of our development life cycle. During this journey, developers will collaborate and communicate over messaging platforms such as IRC. We would like to provide a unique experience during their development by leveraging IRC bots.</p><p>So, this is exactly what we are doing. We are creating a channel for communication; all the team members will be joined to it and our bot will also be there. In this channel, bugs will be reported and communicated based on developers' requests. Also, if developers need some additional information about a bug, the chat bot can help them by providing a URL from the bug-tracking system.</p><p>Awesome!!</p><p>But, before going into detail, let me summarize how we are going to do this using the following steps:</p><div><ul class="itemizedlist"><li class="listitem">Enhance our basic bot program for a more conversational experience</li><li class="listitem">Create a bug-tracking system or bug storage where bugs will be stored and tracked for developers</li></ul></div><p>Here we mention a bug storage system. In this chapter, I would like to explain <strong>DocumentDB</strong>, which is a NoSQL JSON-based cloud storage system. In earlier chapters we looked at MongoDB. Now we will look at DocumentDB for our bug system.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec19"/>What is DocumentDB?</h3></div></div></div><p>In an earlier chapter, I have already explained NoSQLs. DocumentDB is one such NoSQL, in which data is stored in JSON documents, and is offered on the Microsoft Azure platform.</p><p>Details of DocumentDB can be referred to at <a class="ulink" href="https://azure.microsoft.com/en-in/services/documentdb/">
https://azure.microsoft.com/en-in/services/documentdb/
</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec20"/>Setting up a DocumentDB for our BugTrackerIRCBot</h3></div></div></div><p>Assuming you already have a Microsoft Azure subscription, follow these steps to configure DocumentDB for your bot.</p><div><div><div><div><h4 class="title"><a id="ch08lvl4sec18"/>Create account ID for DocumentDB</h4></div></div></div><p>Let's create a new account called <code class="literal">botdb</code> using the following screenshot from the Azure portal. Select NoSQL API as <strong>DocumentDB</strong>. Select an appropriate subscription and resources. I am using the existing resources for this account. You can also create a new dedicated resource for this account. Once you enter all the required information, hit the <strong>Create</strong> button at the bottom to create the new account for DocumentDB.</p><p>
</p><div><img src="img/image00388.jpeg" alt="Create account ID for DocumentDB"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The newly created account, <code class="literal">botdb</code>, can be seen as follows:</p><p>
</p><div><img src="img/image00389.jpeg" alt="Create account ID for DocumentDB"/></div><p style="clear:both; height: 1em;"> </p><p>
</p></div><div><div><div><div><h4 class="title"><a id="ch08lvl4sec19"/>Create a collection and database</h4></div></div></div><p>Select a <code class="literal">botdb</code> account from the account lists shown previously. This will show various menu options such as <strong>Properties</strong>, <strong>Settings</strong>, <strong>Collections</strong>, etc.</p><p>Under this account, we need to create a collection to store the bug data. To create a new collection, click on the <strong>Add Collection</strong> option, as shown in the following screenshot:</p><p>
</p><div><img src="img/image00390.jpeg" alt="Create a collection and database"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>On clicking on the <strong>Add Collection</strong> option, the following screen will be shown on the right side of the screen. Please enter the details as shown in the following screenshot:</p><p>
</p><div><img src="img/image00391.jpeg" alt="Create a collection and database"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the preceding screen, we are creating a new database along with our new collection, <strong>Bugs</strong>. This new database will be named <code class="literal">BugDB</code>. Once this database has been created, we can add other bug-related collections in future to the same database. This can be done using the option <strong>Use </strong>existing from the preceding screen. Once you have entered all the relevant data, click <strong>OK</strong> to create the database as well as the collection. Refer to the following screenshot:</p><p>
</p><div><img src="img/image00392.jpeg" alt="Create a collection and database"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>From the preceding screen, the <strong>COLLECTION ID</strong> and <strong>DATABASE</strong> shown will be used while enhancing our bot.</p></div><div><div><div><div><h4 class="title"><a id="ch08lvl4sec20"/>Create data for our BugTrackerIRCBot</h4></div></div></div><p>Now we have the <code class="literal">BugsDB</code> with the bugs collection, which will hold all the data for bugs. Let's add some data into our collection. To add a data item, let's use the menu option <strong>Document Explorer</strong> shown in the following screenshot:</p><p>
</p><div><img src="img/image00393.jpeg" alt="Create data for our BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>This will open up a screen showing the list of <strong>Databases</strong> and <strong>Collections</strong> created so far. Select our database of <code class="literal">BugDB</code> and the collection of <code class="literal">Bugs</code> from the available list. Refer to the following screenshot:</p><p>
</p><div><img src="img/image00394.jpeg" alt="Create data for our BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>To create a JSON document for our bugs collection, click on the <strong>Create</strong> option. This will open up a <strong>New Document</strong> screen to enter the JSON-based data. Please enter a data item as per the following screenshot:</p><p>
</p><div><img src="img/image00395.jpeg" alt="Create data for our BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>We will be storing <code class="literal">id</code>, <code class="literal">status</code>, <code class="literal">title</code>, <code class="literal">description</code>, <code class="literal">priority</code>,<code class="literal">assignedto</code>, and <code class="literal">url</code> attributes for our single bug document, which will be stored in the bugs collection. To save the JSON document in our collection, click the <strong>Save</strong> button. Refer to the following screenshot:</p><p>
</p><div><img src="img/image00396.jpeg" alt="Create data for our BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>This way we can create sample records in the bugs collection, which will later be wired up in a Node.js program. A sample list of bugs can be seen in the following screenshot:</p><p>
</p><div><img src="img/image00397.jpeg" alt="Create data for our BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>To summarize the section so far, we have determined how to use DocumentDB from Microsoft Azure. Using DocumentDB, we created a new collection along with new database to store bug data. We also added some sample JSON documents in the bugs collection.</p><p>Now let's look at how we can wire up our DocumentDB with Node.js.</p></div></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec21"/>Wiring up DocumentDB and Node.js</h3></div></div></div><p>Let's go back to our <code class="literal">ircbot</code> directory and install the <code class="literal">documentdb</code> package from npm. This is simply Node.js SDK for Microsoft Azure DocumentDB. This is located at URL <a class="ulink" href="https://www.npmjs.com/package/documentdb">
https://www.npmjs.com/package/documentdb
</a>.</p><p>In order to install it, run this npm command:</p><pre class="programlisting">
<strong>npm install documentdb --save</strong>
</pre><p>You should then see something similar to this:</p><p>
</p><div><img src="img/image00398.jpeg" alt="Wiring up DocumentDB and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Let's modify our <code class="literal">app.js</code> file so that we can access DocumentDB-based data using DocumentDB APIs.</p><p>To wire up DocumentDB with Node.js, we will use the following code:</p><pre class="programlisting">var DocumentClient = require('documentdb').DocumentClient; &#13;
var host = "https://botdb.documents.azure.com:443/";                      &#13;
var masterKey = "&lt;YOUR PRIMARY KEY&gt;";  &#13;
var docclient = new DocumentClient(host, {masterKey: masterKey}); &#13;
 &#13;
docclient.readDocuments('dbs/BugDB/colls/Bugs').toArray(function (err, docs) { &#13;
    console.log(docs.length + ' Documents found');     &#13;
}); &#13;
</pre><p>In the the preceding code, we are trying to read documents from our DocumentDB. Now, to instantiate <code class="literal">DocumentClient</code>, we need the <code class="literal">host</code> and <code class="literal">masterkey</code> of our DocumentDB account. Refer to the following screenshot to locate <code class="literal">host</code>, which is only a <strong>URl</strong> and <code class="literal">masterkey </code>is only a <strong>PRIMARY KEY</strong>.</p><p>
</p><div><img src="img/image00399.jpeg" alt="Wiring up DocumentDB and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>To read all the documents from our collection, we use the following code lines:</p><pre class="programlisting">docclient.readDocuments('dbs/BugDB/colls/Bugs').toArray(function (err, docs) { &#13;
    console.log(docs.length + ' Documents found');     &#13;
}); &#13;
</pre><p>
<code class="literal">readDocuments()</code> needs an argument of collection link. This collection link is simply the path to our collection. This is given as the following:</p><p>
<code class="literal">dbs/&lt;Your Database&gt;/colls/&lt;Your Collection ID&gt;</code>
</p><p>Our <code class="literal">app.js</code> now should look like this:</p><pre class="programlisting">var irc = require('irc'); &#13;
var client = new irc.Client('irc.freenode.net', 'BugTrackerIRCBot', { &#13;
  autoConnect: false &#13;
}); &#13;
client.connect(5, function(serverReply) { &#13;
  console.log("Connected!\n", serverReply); &#13;
  client.join('#BugsChannel', function(input) { &#13;
    console.log("Joined #BugsChannel"); &#13;
    client.say('#BugsChannel', "Hi, there. I am an IRC bot which track bugs or defects for your team.\n I can help you using following commands.\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
  }); &#13;
}); &#13;
 &#13;
var DocumentClient = require('documentdb').DocumentClient; &#13;
var host = "https://botdb.documents.azure.com:443/";                      &#13;
var masterKey = "&lt;YOUR PRIMARY KEY&gt;";   &#13;
var docclient = new DocumentClient(host, {masterKey: masterKey}); &#13;
 &#13;
docclient.readDocuments('dbs/BugDB/colls/Bugs').toArray(function (err, docs) { &#13;
    console.log(docs.length + ' Documents found');     &#13;
}); &#13;
</pre><p>Let's go back to our <code class="literal">ircbot</code> directory with a Command Prompt and run our node program. Once you run this, the program will connect to our collection using Microsoft Azure DocumentDB Node.js SDK. After reading the documents, on the Command Prompt we will see the number of documents read. For details, please refer the following screenshot:</p><p>
</p><div><img src="img/image00400.jpeg" alt="Wiring up DocumentDB and Node.js"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Since our IRC client is connecting asynchronously, we will see a reply from IRC Server once received. In this case, we got the response from DocumentDB early, so we see <code class="literal">6 Documents found</code> on the console.</p><p>So far, we are able to connect to DocumentDB and able to retrieve documents from the same. Now, in the next and final section, we will wire up all of this together and we will also enhance the conversational experience of our bot.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec22"/>Wiring up all of this together</h3></div></div></div><p>To wire up all the things together, let's modify our earlier <code class="literal">app.js</code> to be the following:</p><pre class="programlisting">var irc = require('irc'); &#13;
&#13;
var client = new irc.Client('irc.freenode.net', 'BugTrackerIRCBot', { &#13;
    autoConnect: false &#13;
}); &#13;
&#13;
client.connect(5, function(serverReply) { &#13;
    console.log("Connected!\n", serverReply); &#13;
    &#13;
    client.join('#BugsChannel', function(input) { &#13;
        console.log("Joined #BugsChannel"); &#13;
        client.say('#BugsChannel', "Hi, there. I am an IRC Bot which track bugs or defects for your team.\n I can help you using following commands.\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
    }); &#13;
}); &#13;
 &#13;
var DocumentClient = require('documentdb').DocumentClient; &#13;
var host = "https://botdb.documents.azure.com:443/"; &#13;
var masterKey = "&lt;PRIMARY KEY&gt;"; &#13;
var docclient = new DocumentClient(host, {masterKey: masterKey}); &#13;
 &#13;
client.addListener('message', function (from, to, text) { &#13;
    var str = text; &#13;
    &#13;
    if (str.indexOf('BUGREPORT') === -1){ &#13;
        if (str.indexOf('BUG #') === -1){ &#13;
            client.say('#BugsChannel', "I could not get that!\n Send me commands like,\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
        } &#13;
        else { &#13;
            client.say('#BugsChannel', "So you need info about "+text); &#13;
            client.say('#BugsChannel', "Wait for a moment!"); &#13;
            var t= text.substring(6,text.length); &#13;
            var temp = t.trim(); &#13;
            &#13;
            var querySpec = { &#13;
                query: 'SELECT * FROM Bugs b WHERE b.id= @id', &#13;
                parameters: [ &#13;
                { &#13;
                    name: '@id', &#13;
                    value: temp &#13;
                } &#13;
                ] &#13;
            }; &#13;
            docclient.queryDocuments('dbs/BugDB/colls/Bugs', querySpec).toArray(function (err, results) { &#13;
                if (results.length&gt;0){ &#13;
                    client.say('#BugsChannel', "["+ results[0].url+"] [Status]: "+results[0].status+" [Title]:"+results[0].title); &#13;
                }&#13;
                else{ &#13;
                    client.say('#BugsChannel', 'No bugs found.'); &#13;
                } &#13;
            }); &#13;
        } &#13;
    } &#13;
    else{ &#13;
        client.say('#BugsChannel', "So you need a Bug Report!"); &#13;
        client.say('#BugsChannel', "Wait for a moment!"); &#13;
        var querySpec = { &#13;
            query: 'SELECT * FROM Bugs b WHERE b.status= @status', &#13;
            parameters: [ &#13;
            { &#13;
                name: '@status', &#13;
                value: 'Open' &#13;
            } &#13;
            ] &#13;
        }; &#13;
        &#13;
        docclient.queryDocuments('dbs/BugDB/colls/Bugs', querySpec).toArray(function (err, results) { &#13;
            client.say('#BugsChannel','Total Open Bugs:'+results.length); &#13;
        }); &#13;
        var querySpec = { &#13;
            query: 'SELECT * FROM Bugs b WHERE b.status= @status', &#13;
            parameters: [ &#13;
            { &#13;
                name: '@status', &#13;
                value: 'Closed' &#13;
            } &#13;
            ] &#13;
        }; &#13;
&#13;
        docclient.queryDocuments('dbs/BugDB/colls/Bugs', querySpec).toArray(function (err, results) { &#13;
            client.say('#BugsChannel','Total Closed Bugs:'+results.length); &#13;
        }); &#13;
    } &#13;
}); &#13;
</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec23"/>Code understanding</h3></div></div></div><p>I have already explained how we can connect to DocumentDB using <strong>URI</strong> and <strong>PRIMARY KEY</strong>. Now let's focus on how we have implemented the conversational experience and how we are getting bug information based on that within our BugTrackerIRCBot.</p><pre class="programlisting">client.addListener('message', function (from, to, text) { &#13;
    var str = text; &#13;
    if (str.indexOf('BUGREPORT') === -1){ &#13;
     if (str.indexOf('BUG #') === -1){ &#13;
        client.say('#BugsChannel', "I could not get that!\n Send me commands like,\n BUGREPORT \n BUG # &lt;BUG. NO&gt;"); &#13;
     } &#13;
</pre><p>In the the preceding code, our IRC client has been added with a listener that listens to all the messages within the channel. So, as our bot joins channel, the bot mentions which commands can be used. These commands are <code class="literal">BUGREPORT</code> and <code class="literal">BUG # &lt;BUG NO.&gt;</code>.</p><p>Knowing this, when our incoming message contains words like <code class="literal">BUGREPORT</code> and <code class="literal">BUG #</code> then our bot BugTrackerIRCBot gathers information based on those commands. If the message does not match, then the bot replies with a proper message and also provides usable commands.</p><p>Let's assume one of the developers is looking for the total number of defects and so the developer enters the command <code class="literal">BUGREPORT</code>, then our bot will query the DocumentDB database and will get the report for open and closed bugs from our bugs collection. This code is as follows:</p><pre class="programlisting">client.say('#BugsChannel', "So you need a Bug Report!"); &#13;
client.say('#BugsChannel', "Wait for a moment!");            &#13;
var querySpec = { &#13;
    query: 'SELECT * FROM Bugs b WHERE  b.status= @status', &#13;
    parameters: [ &#13;
       { &#13;
           name: '@status', &#13;
           value: 'Open' &#13;
       } &#13;
    ] &#13;
}; &#13;
docclient.queryDocuments('dbs/BugDB/colls/Bugs', querySpec).toArray(function (err, results) {     &#13;
    client.say('#BugsChannel','Total Open Bugs:'+results.length); &#13;
}); &#13;
</pre><p>In the the preceding code, once the developer's intention of getting a report is clear, our bot replies with confirmation using the <code class="literal">client.say()</code> function. The bot interactively asks the developer to wait for a moment and in the mean time queries DocumentDB using the function <code class="literal">docclient.queryDocuments()</code>. Once the data is received, again the bot uses the <code class="literal">client.say() </code>function and returns the information in a chat window. In the preceding code, the bot first returns <code class="literal">Total Open Bugs</code> and then <code class="literal">Total Closed Bugs</code>.</p><p>Now you may ask why two different calls are made for <code class="literal">Open</code> and <code class="literal">Closed</code> bugs; the reason is that, currently, there is no native support for AGGREGATE functions in DocumentDB. We need to know only the <code class="literal">Open</code> and <code class="literal">Closed</code> numbers of bugs, so we use the <code class="literal">docclient.queryDocuments()</code> function twice to get the data.</p><p>BugTrackerIRCBot can also give us information about individual bugs using the command <code class="literal">BUG #</code>. The implementation for the same can be seen in the following code snippet:</p><pre class="programlisting">client.say('#BugsChannel', "So you need info about "+text);               &#13;
client.say('#BugsChannel', "Wait for a moment!");          &#13;
var t= text.substring(6,text.length); &#13;
var temp = t.trim();  &#13;
var querySpec = { &#13;
    query: 'SELECT * FROM Bugs b WHERE  b.id= @id', &#13;
    parameters: [ &#13;
    { &#13;
        name: '@id', &#13;
        value: temp &#13;
    } &#13;
    ] &#13;
};           &#13;
docclient.queryDocuments('dbs/BugDB/colls/Bugs', querySpec).toArray(function (err, results) {     &#13;
    if (results.length&gt;0){ &#13;
        client.say('#BugsChannel', "["+ results[0].url+"] [Status]: "+results[0].status+" [Title]:"+results[0].title);            &#13;
    }&#13;
    else{ &#13;
        client.say('#BugsChannel', 'No bugs found.');       &#13;
    } &#13;
}); &#13;
</pre><p>In the the preceding code, when the developer gives the <code class="literal">BUG # </code>command while chatting, our code will extract only the bug number after the symbol <code class="literal">#</code>.Then our bot will reply with which bug details will be retrieved from the database. If the records are not found, our bot will reply with an appropriate message as well.</p><p>The variable <code class="literal">querySpec</code> will formulate a query with the parameter of the bug number entered by the developer in a chat window and then will be processed using the function <code class="literal">docclient.queryDocuments()</code>. Once the function retrieves the data for a specified bug number, our bot will formulate the following response:</p><pre class="programlisting">client.say('#BugsChannel', '[http://mybugsystem.net/'+ results[0].id +"] [Status]: "+results[0].status+" [Title]:"+results[0].title); &#13;
</pre><p>To the end user or a developer, we show the URL of a bug from the bug-tracking system, as well as status of the bug and a title.</p><p>Lots of code to understand so far!!</p><p>Let's run our bot now, and see how it interacts and provides us with a great conversational experience.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec36"/>Running our enhanced BugTrackerIRCBot</h2></div></div></div><p>Let's go back to our <code class="literal">ircbot</code> directory, on a Command Prompt, and run our modified <code class="literal">app.js</code>. Once the code has run successfully, you should see the following at the Command Prompt:</p><p>
</p><div><img src="img/image00401.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>This is assuming that you have already connected to the IRC client, as stated earlier. Now let's look at our channel #BugsChannel from an IRC client. We should see our bot as the following:</p><p>
</p><div><img src="img/image00402.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the the preceding screenshot, you can see the bot has joined the channel and has also introduced itself to us with usable commands.</p><p>Let's enter the command <code class="literal">BUGREPORT</code> and see what the bot replies to us. Here, the bot is getting the bug report, as explained earlier in the code description. The reply seen is as follows:</p><p>
</p><div><img src="img/image00403.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Now let's ensure our other command also works. So, now we are interested in information about an individual bug, enter the command <code class="literal">BUG # 125</code> and see what our bot replies:</p><p>
</p><div><img src="img/image00404.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The bot replied with the URL of the bug-tracking system for a bug, and also <strong>Status</strong> and <strong>Title</strong> information.</p><p>Let's cross check in DocumentDB whether the bot is providing the correct information or not.</p><p>In DocumentDB, for <code class="literal">Bug # 125</code>, the following data can be seen:</p><p>
</p><div><img src="img/image00405.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>If you enter a bug number that does not exist in DocumentDB, then the bot replies accordingly; refer to the following screenshot:</p><p>
</p><div><img src="img/image00406.jpeg" alt="Running our enhanced BugTrackerIRCBot"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Here I entered <code class="literal">BUG # 12345</code> and the bot searched and could not find the bug, so it responded <code class="literal">No bugs found</code>.</p><p>So, we are able to extend our bot to meet our requirements. BugTrackerIRCBot can be further extended to assign bugs or even to create a new bug using appropriate commands such as <code class="literal">ASSIGNBUG</code>, <code class="literal">NEWBUG</code>, etc. I will leave it up to the users to extend our BugTrackerIRCBot that way.</p><p>Hopefully, you now have enough insight on how we can leverage IRC bots during development, and how we can provide an effective and efficient conversational experience to developers who are collaborating and communicating through IRC clients.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec38"/>Summary</h1></div></div></div><p>Every development team needs bug-tracking and reporting tools. There are typically needs for bug reporting and bug assignment. In the case of critical projects, these needs become very critical for project timelines. This chapter has showed us how we can provide a seamless experience to developers while they are communicating with peers within a channel.</p><p>Firstly, we created a very simple IRC bot in Node.js and verified how it can communicate within a channel using the IRC web-based client. Then, we extended our basic bot such that, based on a user's request, the bot will give us information quickly and easily while chatting itself. We also leveraged Azure-based cloud storage to store the bug database. This time we used DocumentDB - a NoSQL JSON database from the Microsoft Azure platform. We wired up DocumentDB libraries and IRC libraries in Node.js for our bot to function and had a great conversational experience.</p><p>In today's world of collaboration, development teams that use such integrations and automations will be efficient and effective while delivering their quality products.</p><p>In the next chapter, you will learn how to integrate Salesforce APIs and Kik's chat platform for the Salesforce CRM bot.</p></div></body></html>