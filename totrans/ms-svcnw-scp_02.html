<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Exploring the ServiceNow Glide Class</h1>
                </header>
            
            <article>
                
<p class="mce-root">In this chapter, we will explore the the ServiceNow Glide class. We will look at the exposed JavaScript APIs that allow developers to conveniently and rapidly write ServiceNow scripts. We will then look at the different classes on the server and client sides before looking at some examples of some of the most commonly used classes.</p>
<p>This chapter will cover the following topics:</p>
<ul>
<li>How to use ServiceNow exposed JavaScript APIs, including GlideRecord</li>
<li>Client-side Glide classes</li>
<li>Server-side Glide classes</li>
<li>Examples covering some commonly used Glide classes</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using ServiceNow exposed JavaScript APIs</h1>
                </header>
            
            <article>
                
<p class="mce-root">ServiceNow provides developers with some exposed JavaScript APIs to aid them with the scripts they write. This saves a lot of time in accessing records and fields in scripts in ServiceNow. There are a number of different classes and objects available to developers, some of which very helpful and others rarely used.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideRecord</h1>
                </header>
            
            <article>
                
<p>One of the most common JavaScript APIs is the <kbd>GlideRecord</kbd> class, which is extremely handy and will fast become a staple of most scripting. <kbd>GlideRecord</kbd> is a way of finding and counting records in ServiceNow based on many different queries. It is quite similar to a SQL statement if that is something you are familiar with.</p>
<p>Let's have a look at how to use <kbd>GlideRecord</kbd>.</p>
<p>We'll take a look at how to query all the records in a particular table. The format of the <kbd>GlideRecord</kbd> script for this is shown in the following, with <kbd>table_name</kbd> being the only parameter. This needs to be the table name rather than the table label:</p>
<pre>new GlideRecord('&lt;table_name&gt;');</pre>
<p><span>We will set a variable to hold the <kbd>GlideRecord</kbd> object and define the table that will be used to query.</span> In this example, we will use the incident table:</p>
<pre>var glideRecord = new GlideRecord('incident');</pre>
<p>The <kbd>glideRecord</kbd> variable now holds a <kbd>GlideRecord</kbd> object for the incident table. We then query the table and add any filtering. In this case, we will add no filter and simply return all records for the incident table, therefore showing the full script:</p>
<pre>var glideRecord = new GlideRecord('incident');<br/>glideRecord.query();<br/>while (glideRecord.next()) {<br/>    //Code in this loop will be run against all incident records<br/>}</pre>
<p>This is a very important part of ServiceNow scripting as it is the way coders can access the records in ServiceNow by cycling through them and applying some code to each relevant record.  </p>
<p>Now that we've seen how to set up a <kbd>GlideRecord</kbd> query, let's have a look at the script line that can filter a <kbd>GlideRecord</kbd> for us:</p>
<pre>variable.addQuery('&lt;field_name&gt;', '&lt;operator&gt;', '&lt;value_to_compare_against_field&gt;')</pre>
<p>Here, we filter based on a field name and compare the value in that field using the operator to the value we define. The default <kbd>operator</kbd> is that the value equals the value in the field so if this is the operator we need, we can just leave it out.</p>
<p>Let's have a look at another example. This time, we'll look to query all the problem records with a critical priority using our filter line:</p>
<pre>var glideRecord = new GlideRecord('problem');<br/>glideRecord.addQuery('priority', 1);<br/>glideRecord.query();<br/>while (glideRecord.next()) {<br/>    //Code in this loop will be run against all problem records with a priority of critical.<br/>}</pre>
<p>As you can see in the preceding code, we omitted the operator because we want problem records with a priority equal to <kbd>1</kbd> and therefore we did not need to include it.</p>
<p>In the examples so far, we have cycled through all of the records, but we can amend the loop to return just one if it exists by changing the <kbd>while</kbd> to an <kbd>if</kbd>. <span>This is often helpful when checking whether all tasks of a parent record are complete. Let's look at how it would change our script from our last example:</span></p>
<pre>var glideRecord = new GlideRecord('problem');<br/>glideRecord.addQuery('priority', 1);<br/>glideRecord.query();<br/>if (glideRecord.next()) {<br/>    //Code in this loop will be run against one problem record with a priority of 1 if one exists.<br/>}</pre>
<p>This code could be used to check whether any priority critical problems exist and will run some code against it if one does.</p>
<p>You can add more than one query and each record that is returned will need to satisfy each filter being defined. In that respect, it is quite like searching for a house. You could just search for all houses, but you more likely would want to build filters up to find exactly what you are looking for – price range, bedrooms, location, and so on.</p>
<p>With all of these filters adding up and essentially creating a series of logical <kbd>AND</kbd> statements, we also need a way of creating a logical <kbd>OR</kbd> statement. In the same way you can add a query line, you can also add an <kbd>OR</kbd> condition line of script. Let's see how it works:</p>
<pre>var glideRecord = new GlideRecord('change_request');<br/>var orQuery = glideRecord.addQuery('risk', 1);<br/>orQuery.addOrCondition('risk', 2); <br/>glideRecord.query();<br/>while (glideRecord.next()) {<br/>    //Code in this loop will be run against all change request records that are a very high or high risk.<br/>}</pre>
<p class="mce-root">As you can see, the original condition is stored in a variable, <kbd>orQuery</kbd>, and then the <kbd>OR</kbd> condition is added to this variable before the query takes place. This type of query is handy if you want certain code to execute when a record is in a certain set of states.</p>
<p>There are many ways to achieve the same goal in ServiceNow and to show this, we can set up the same filter on change records using a different operator. This uses the fact that many values of choice lists in ServiceNow are numbers so we can just search for all change requests with a risk of greater than or equal to <kbd>2</kbd>:</p>
<pre>var glideRecord = new GlideRecord('change_request');<br/>glideRecord.addQuery('risk', '&gt;=', 2); <br/>glideRecord.query();<br/>while (glideRecord.next()) {<br/>    //Code in this loop will be run against all change request records that are a very high or high risk.<br/>}</pre>
<p class="mce-root">This second example would usually be considered better than the first, as it is using fewer lines of code.</p>
<p>Now we have looked at how to get the records we want, we will look at how to alter the records we have found. First, we'll take a look at a simple update to a record. In this example, we will update all incident records with a high urgency and move it down to medium:</p>
<pre>var glideRecord = new GlideRecord('incident');<br/>glideRecord.addQuery('urgency', 1); <br/>glideRecord.query();<br/>while (glideRecord.next()) {<br/>    //Change all high urgency incidents to medium urgency<br/>    glideRecord.urgency = 2;<br/>    glideRecord.update();<br/>}</pre>
<p class="mce-root">When updating a record, you can amend many of the fields and then use <kbd>update</kbd> to save the changes. This is a very important method and is relatively simple to use.</p>
<p>The final examples we will look at are how to delete records. Obviously, be careful when deleting records and ensure the query you have written is correct before executing.</p>
<p>There are two main methods of deleting records: either individually through looping or all in one go. Let's look at deleting individual records first. In this example, we'll delete all of the <kbd>network</kbd> category incidents:</p>
<pre>var glideRecord = new GlideRecord('incident');<br/>glideRecord.addQuery('category', 'network'); <br/>glideRecord.query();<br/>while (glideRecord.next()) {    <br/>    glideRecord.deleteRecord();<br/>}</pre>
<p>Next, we'll look at how to delete all of the queried records in one go:</p>
<pre>var glideRecord = new GlideRecord('incident');<br/>glideRecord.addQuery('category', 'network'); <br/>glideRecord.deleteMultiple();</pre>
<p>As you can see, the script for both of these <kbd>delete</kbd> methods is quite different, but the end result is the same. The <kbd>deleteMultiple</kbd> method is a quicker, more efficient method; however, it will delete everything in one go. If there is a large amount of data to be deleted, this can cause resources to be tied up for a long time. I have used the <kbd>deleteRecord</kbd> method instead in the case of a large volume of data to stagger the deletion of records in smaller groups of records.</p>
<div class="packt_tip">When creating a <kbd>delete</kbd> script, try executing it first with the <kbd>delete</kbd> method commented out and some logging to show what you have deleted. If the logging brings back the records you want, then go ahead with the deletion. This helps to ensure the wrong records are not removed.</div>
<p>That concludes <kbd>GlideRecord</kbd> for now, but it will feature again throughout the book, further proving how important it is.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Server-side Glide classes</h1>
                </header>
            
            <article>
                
<p>Now we will look at some of the server-side classes that we can use for our scripts. Remember these methods will not work on the client side so make sure you are aware whether the script you are writing is on the server side.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideSystem</h1>
                </header>
            
            <article>
                
<p class="mce-root"><kbd>GlideSystem</kbd> is probably the most commonly used server-side classes. Let's have a look at how we can utilize this class to aid us in our scripting.</p>
<p>ServiceNow shortens <kbd>GlideSystem</kbd> to <kbd>gs</kbd> in scripts so the methods of <kbd>GlideSystem</kbd> will be prefixed with <kbd>gs</kbd>.</p>
<p>Let's start by seeing how to get a user's <kbd>sys_id</kbd> using <kbd>GlideSystem</kbd>:</p>
<pre>var userID = gs.getUserID();</pre>
<p>This puts the logged-in user's <kbd>sys_id</kbd> in the <kbd>userID</kbd> variable. This can be helpful as you can use this in scripts where you may want to execute different lines of script depending on the attributes of the user. Now we have the user's <kbd>sys_id</kbd>, we could use a <kbd>GlideRecord</kbd> query to return the fields we desire. ServiceNow does allow us to obtain some of this information in an easier way.</p>
<p>We can get the <kbd>user</kbd> object and then use some helpful functions to access further information about the user. To get the <kbd>user</kbd> object, we simply write the following:</p>
<pre>var userObject = gs.getUser();</pre>
<p>Next, let us see some of the most helpful functions:</p>
<pre>gs.getUser().getFullName();<br/>gs.getUser().getEmail();<br/>gs.getUser().getLocation();<br/>gs.getUser().getManagerID();<br/>gs.getUser().getCompanyID();</pre>
<p>Most of the preceding code is fairly self-explanatory, but the ID functions will return the <kbd>sys_id</kbd> of the record in the same way as the user <kbd>sys_id</kbd>.</p>
<p>The user's details can be useful for sending notifications and setting up approvals and condition scripts based on locations or companies.</p>
<p>Whilst we are on user data, it is often important to find out which roles a user has to decide what they should have access to. <kbd>GlideSystem</kbd> allows us to see whether a user has a certain role in the script, as shown in the following example:</p>
<pre>if (gs.hasRole('admin')) {<br/>    //Run code for administrators only<br/>}</pre>
<p>The <kbd>hasRole</kbd> method is especially useful when using script to allow or restrict data to a user. It can also be used to hide or show UI actions that would require an elevated privilege to use. One thing to note is that the <kbd>hasRole</kbd> method will always return <kbd>true</kbd> for an administrator.</p>
<p><kbd>GlideSystem</kbd> is also good for letting the user know what has happened during a script through an output message for the user. This is done using an <kbd>Info</kbd> or <kbd>Error</kbd> message. The <kbd>Info</kbd> message is displayed in a nice blue box and the <kbd>Error</kbd> message, unsurprisingly, in a red one at the top of the form once processing has completed and the next screen has loaded.</p>
<p>Let's have a look at how to script these:</p>
<pre>gs.addInfoMessage('Record saved successfully.');<br/>gs.addErrorMessage('Error in script.');</pre>
<p>These are fairly simple lines, but are very handy in keeping a user updated with how scripts performed when processed and whether there were any problems. I tend to use the info message to let a user know an action completed successfully when it is not immediately obvious on the screen they are returned to. An <kbd>Error</kbd> message is good when something in a script goes wrong. Remember that this message will be displayed to a variety of users so it is best to not get too technical in the message.</p>
<p><kbd>GlideSystem</kbd> also allows us to perform logging so that we can debug our server-side scripts. As server-side scripts are running behind the scenes, we need a way of logging what happened in the script so we can look at it later and review and debug if necessary.</p>
<p>The little bit of script that is the most common for this is <kbd>log</kbd>. Simply used, this is just a string of text to send to the logs:</p>
<pre>gs.log('Logging Message');</pre>
<p>This message will now be visible in the <span class="packt_screen">Script Log Statements</span> module in the application navigator. If you are looking through older script in a ServiceNow instance, you will often find these log messages. Sometimes they are commented out in case they are needed again for debugging and sometimes they should have been commented out and the developer forgot.</p>
<p>If many logs are being created, it can be helpful to give your log a unique source so you can more easily search for only logs from your particular source. Let's have a look at what this looks like:</p>
<pre>gs.log('Logging Message', 'My Script Log');</pre>
<p>This message will then appear in the system log with a source of <kbd>My Script Log</kbd>. One thing to note is that it will no longer appear in the <span class="packt_screen">Script Log Statements</span> module as you have changed the source to a custom source.</p>
<p><kbd>GlideSystem</kbd> is probably the most useful server-side Glide class and there are more methods on top of the ones we have discussed.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideDateTime</h1>
                </header>
            
            <article>
                
<p class="mce-root"><kbd>GlideDateTime</kbd> is, unsurprisingly, about scripting with dates and times, specifically the <kbd>GlideDateTime</kbd> object. The <kbd>GlideDateTime</kbd> object is mainly used to populate <span class="packt_screen">Date/Time</span> fields and the methods around them to manipulate dates and times to add or remove time to a field.</p>
<p>First, let's look at defining a new <kbd>GlideDateTime</kbd>:</p>
<pre>var glideDT = new GlideDateTime();</pre>
<p>This will put the current date and time in GMT format in the <kbd>glideDT</kbd> field as part of a <kbd>GlideDateTime</kbd> object. This can be helpful if you want to compare a date in a field with the current date and time.</p>
<p>Now, with any date and time scripting, time zones are always an issue. One of the best ways to get around this is to use the display value to make sure dates and times are displayed to users in the correct format for the user who is viewing it. Let's look at how this is done by logging the display value:</p>
<pre>var glideDT = new GlideDateTime();<br/>gs.log(glideDT.getDisplayValue());</pre>
<p>This is very helpful in scripting to ensure that all users see the correct times.</p>
<p>Sometimes there will also be the requirement to add or remove time from a <span class="packt_screen">Date/Time</span> field using script. There are a few methods to add various amounts of time to or from a <span class="packt_screen">Date/Time</span> field. We'll have a look at one of these; the others work in a very similar way:</p>
<pre>var glideDT = new GlideDateTime();<br/>glideDT.addDaysLocalTime(1);</pre>
<p>In this example, we would be adding 1 day, so 24 hours, to the current day and time:</p>
<pre>var glideDT = new GlideDateTime();<br/>glideDT.addDaysLocalTime(-1);</pre>
<p>By using a negative number, we actually subtract time from the object so the preceding example would actually give you the date and time of this time yesterday.</p>
<p><kbd>GlideDateTime</kbd> is helpful when dealing with dates and times, which can often be a headache in coding. Remember, when using negative figures in <kbd>addtime</kbd> methods, this reduces the time instead of increasing it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideElement</h1>
                </header>
            
            <article>
                
<p><kbd>GlideElement</kbd> provides methods for dealing with the fields in a <kbd>GlideRecord</kbd> object. This class is one of the smaller ones in ServiceNow.</p>
<p>One very handy set of methods in this class is detecting changes to a field. This is very helpful in closing down records. Sometimes we may want to run some script on closure of the record, but not every time the record is updated. This is when the <kbd>changesTo</kbd> method can be used. We'll assume we are using an incident, in this case where the closed state is <kbd>7</kbd>:</p>
<pre>if  (current.state.changesTo('7')) {<br/>    //Run some closure script<br/>}</pre>
<p>This preceding example will allow for some script to run when the record is closed, but only when it moves to being closed. If the closed record is subsequently updated, then this script will not run again. That is why this method is so helpful. You can also use <kbd>changes</kbd> and <kbd>changesFrom</kbd> methods as part of this set.</p>
<p>You may or may not be aware of what <kbd>current</kbd> refers to at this point, but we will take a closer look at this when we look at business rules in <a href="170b38f0-5b60-4c8d-aef3-6833efee13f1.xhtml" target="_blank">Chapter 5</a>, <em>Introduction to Server-Side Scripting</em>.</p>
<p>Another helpful set of methods in <kbd>GlideElement</kbd> is checking whether a user is able to create, read, or write to records. We can use this to see whether a user should be able to perform these actions, which can be very helpful in UI action conditions.</p>
<p>Let's see how it works:</p>
<pre>if (current.canCreate()) {<br/>    //Run some creation script for the current record type<br/>}</pre>
<p>This will check whether the logged-in user is able to create a record of the current type (incident, change request, and so on) and, if so, then run the script inside the <kbd>if</kbd> statement. We can also use the <kbd>canRead</kbd> and <kbd>canWrite</kbd> methods in a similar way.</p>
<p>With <kbd>GlideElement</kbd> being a smaller class, it is not as well used as some of the other server-side classes, but some of its methods are very helpful, particularly in UI actions.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideAggregate</h1>
                </header>
            
            <article>
                
<p class="mce-root">The <kbd>GlideAggregate</kbd> class is an extension of <kbd>GlideRecord</kbd> and works in a similar way. The difference is that <kbd>GlideRecord</kbd> tends to give you database objects whereas <kbd>GlideAggregate</kbd> deals in counts and numbers.</p>
<p>We'll take a quick look at how <kbd>GlideAggregate</kbd> works:</p>
<pre>var counter = new GlideAggregate('incident');<br/>counter.addAggregate('COUNT');<br/>counter.query();<br/>if (counter.next()) {<br/>    var noOfIncidents = counter.getAggregate('COUNT');<br/>}</pre>
<p>This first example will give us the number of incidents in the database and place it in the <kbd>noOfIncidents</kbd> field. We can add <kbd>addQuery</kbd> lines in exactly the same way we would for <kbd>GlideRecord</kbd> if we wanted to reduce the number of incident records we returned.</p>
<p>As well as <kbd>COUNT</kbd>, we can also use <kbd>SUM</kbd>, <kbd>MAX</kbd>, <kbd>MIN</kbd>, and <kbd>AVG</kbd> to get the total sum, maximum number, minimum number, and average, respectively.</p>
<p>I don't find <kbd>GlideAggregate</kbd> used that regularly, but it is an efficient way to count records.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Client-side Glide classes</h1>
                </header>
            
            <article>
                
<p>The client-side Glide classes are for use in scripts that are run directly in front of the user. These include manipulating and working with form fields and user data and being able to call server-side scripts to return values in the database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideForm</h1>
                </header>
            
            <article>
                
<p>I would say that GlideForm or <kbd>g_form</kbd> is the most used client-side class. It is mainly used for getting data from the fields on the form and setting values to those fields as well. We can also change elements of those fields using <kbd>g_form</kbd>.</p>
<p>We'll start by looking at how to get and set values from and into fields:</p>
<pre>var stateValue = g_form.getValue('state');</pre>
<p>The string value inside the speech marks is the database name for the field. Make sure you use the name rather than the label when getting a value using <kbd>g_form</kbd>. The <kbd>getValue</kbd> method essentially puts the value of a field into a variable for you. This then allows you to use that variable to check against other data or pass as a parameter into a function:</p>
<pre>g_form.setValue('state', '6');</pre>
<p>The <kbd>setValue</kbd> method will immediately set the value of the field on the screen to what the script dictates. In this example, presuming we are on the incident table, the state field would change to resolved. Remember, here, we are using the number <kbd>6</kbd> as that is the choice value for the resolved state in ServiceNow.</p>
<p>It is also worth noting that the value at this point will only have changed on the screen in front of the user. The field in the database will not be updated until the record itself is.</p>
<p>Using <kbd>g_form</kbd>, we can also change elements of the field itself and not just the value it holds. Let's have a look at how to make a field mandatory, show and hide a field, and make a field read-only. The best practice for these actions is to use a UI policy; however, the conditions in a UI policy are limited so sometimes we need to use a script to perform these actions.  </p>
<p>We'll start by setting a field to <kbd>mandatory</kbd>:</p>
<pre>g_form.setMandatory('short_description', true);</pre>
<p>This example would set the short description field to <kbd>mandatory</kbd>. If we want to reverse this, we just need to change <kbd>true</kbd> to <kbd>false</kbd> in the line. This can be helpful when using UI actions to move through states of a record and to ensure certain fields are filled in before moving to the next stage. This change to the mandatory state of the field is just temporary; if the form is reloaded, then the field will go back to its original mandatory or non-mandatory state.</p>
<p>To change whether a field is visible, we can use the following code:</p>
<pre>g_form.setDisplay('assigned_to', false);</pre>
<p>This example will hide the assigned to field, but we can show it again by changing <kbd>false</kbd> to <kbd>true</kbd> in the line of script. This method isn't used that often as this action can usually be performed by a UI policy. This method will allow the space the field has left behind to be reclaimed by other fields. The <kbd>setVisible</kbd> method is very similar to the <kbd>setDisplay</kbd> method except a blank space is left where the field used to be, which tends to make <kbd>setDisplay</kbd> the better aesthetic choice.</p>
<p>The method for setting a field to be read-only is as follows:</p>
<pre>g_form.setReadOnly('description', true);</pre>
<p>The preceding example will set the description field to read-only, meaning the field cannot be edited. This will only be while the current form is loaded and will revert back to its original state of read-only or not when the form reloads.</p>
<p>There are also some useful bits of information that <kbd>g_form</kbd> can get for you as well. To begin with, let's see how you can get the unique value or <kbd>sys_id</kbd> of a record using <kbd>g_form</kbd>:</p>
<pre>var sysID = g_form.getUniqueValue();</pre>
<p>The example puts the <kbd>sys_id</kbd> of the record in the <kbd>sysID</kbd> variable. This can be useful if you want the <kbd>sys_id</kbd> value even before the record is saved.</p>
<p>We can also use code to check whether the record has been saved or not yet:</p>
<pre>if (g_form.isNewRecord()) {<br/>    //Run script only for new records<br/>}</pre>
<p>This <kbd>isNewRecord</kbd> method allows us to write script for only new records or for only records that have already been saved. This can help you to decide whether to insert or update a record at the end of the script.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlideUser</h1>
                </header>
            
            <article>
                
<p class="mce-root"><kbd>GlideUser</kbd> or <kbd>g_user</kbd> is a class all about the attributes of the user. It is not the biggest class, but some of the properties and methods can be used quite frequently.</p>
<p>One of the most helpful of these is being able to get the user ID, the <kbd>sys_id</kbd> of the user, through a property. This can be very helpful to send to another script so that the script knows which user is currently logged in or for getting the user record.</p>
<p>Let's have a look at how to get this ID:</p>
<pre class="mce-root">var userSys_ID = g_user.userID;</pre>
<p>In the example, the <kbd>userSys_ID</kbd> variable will be the <kbd>sys_id</kbd> of the logged-in user.</p>
<div class="packt_tip">When getting a user record, it is best practice to use the <kbd>sys_id</kbd> rather than a name to obtain the record. This is because there is a chance users in the database may have the same name, whereas the <kbd>sys_id</kbd> of a user will always be unique.</div>
<p>We can also use <kbd>g_user</kbd> to get the full name of the logged-in user. This can be helpful if we want to display a user's name in messages displayed to them or in fields. </p>
<p>We can get a user's full name by using the following example:</p>
<pre>var name = g_user.getFullName();<br/>alert('The logged in user is ' + name);</pre>
<p>This preceding example sets the name variable to be the user's full name. Let's assume I am the logged-in user here. The <kbd>alert</kbd> method shows a pop-up message to the user, so in this scenario, it would say <kbd>The logged in user is Andrew Kindred</kbd>.</p>
<p>Sometimes when scripting, we want to know whether the user has a specific role so we can decide whether or not a piece of code should run for them or not. To do this on the client side, we can use the <kbd>hasRole</kbd> method. It works in a very similar way to the server-side <kbd>GlideSystem</kbd> method.</p>
<p>Let's look at an example of the <kbd>hasRole</kbd> method:</p>
<pre>if (g_user.hasRole('itil') {<br/>    //Run code for user with the itil role only<br/>}</pre>
<p>As you can see, this code is very similar to the server-side code. We can use an <kbd>if</kbd> statement to ensure that we only run certain code for users with a certain role.</p>
<p>There are a few other methods relating to basic user data and roles, but we have covered the most useful ones here.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Additional client-side Glide classes</h1>
                </header>
            
            <article>
                
<p>The two classes we have looked at so far are the most useful and also the easiest to begin with. However, there are some other helpful client-side Glide classes. We will look at these other Glide classes later in the book, as they tie in nicely with some of the types of client-side script and specific actions you may want to achieve with your code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Script examples</h1>
                </header>
            
            <article>
                
<p class="mce-root">Now we've looked at some server- and client-side Glide classes, we can take a look at some examples of using these methods and properties in some slightly more complex blocks of code to achieve our goals in ServiceNow.</p>
<p>Let's start by having a look at some <kbd>GlideRecord</kbd> examples.</p>
<p>This time, we'll use <kbd>GlideRecord</kbd> multiple times, one inside another. This is a technique you will no doubt use quite often as you progress with your scripting. It has certainly served me well over the years.</p>
<p>In this example, we'll take a look at creating a problem record for every critical priority incident:</p>
<pre>var incRec = new GlideRecord('incident');<br/>incRec.addQuery('priority', 1);<br/>incRec.query();<br/>while (incRec.next()) {<br/><br/>    //Critical incident found, create a new problem record<br/>    var newProblemRec = new GlideRecord('problem');<br/>    newProblemRec.cmdb_ci = incRec.cmdb_ci;<br/>    newProblemRec.short_description = incRec.short_description;<br/>    var newInsertedRecord = newProblemRec.insert();<br/><br/>    //Update the incident with the problem reference<br/>    incRec.problem_id = newInsertedRecord;<br/>    incRec.update();<br/>} </pre>
<p>In the preceding example, we've found all critical incidents using a <kbd>GlideRecord</kbd> query. Once we find a matching incident record, we create a new problem record using <kbd>insert</kbd>, copying the configuration item and short description fields from the incident over to the problem record also. Once the problem record has been inserted, we store its unique value in the <kbd>newInsertedRecord</kbd> variable so that we can add that value into the incident record-related problem field. This ensures the two records are linked and that the incident will appear in the related list on the problem record.</p>
<p>We can see what this script would look like in a scheduled job in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-516 image-border" src="assets/ddd9fd64-a39d-4e95-a550-4a6a601a4d5d.png" style="width:106.25em;height:51.25em;"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 2.1: Scheduled job for creating problems from critical incidents</div>
<p>We will take an in-depth look at scheduled jobs in <a href="a0052657-c9a2-4b4e-93ab-6c78ecac434c.xhtml" target="_blank">Chapter 6</a>, <em>Advanced Server-Side Scripting</em>. This figure gives you an idea of seeing the layout of Glide classes in a ServiceNow script field.</p>
<p>Using a <kbd>GlideRecord</kbd> inside a <kbd>GlideRecord</kbd> is incredibly useful, as we can create, update, or search within a <kbd>GlideRecord</kbd> query <kbd>while</kbd> loop.</p>
<p>If we know the <kbd>sys_id</kbd> of a record, there is a shortcut called <kbd>get</kbd> we can use to obtain the record directly. We can use our user-based methods to show a quick way of getting the user record.</p>
<p>The following script uses this <kbd>get</kbd> method to quickly access the user record we require:</p>
<pre class="mce-root">var userRec = new GlideRecord('sys_user');<br/>userRec.get(gs.getUserID());<br/>userRec.title = 'Manager';<br/>userRec.update();</pre>
<p>Using the <kbd>get</kbd> method, we have quickly retrieved the currently logged-in user's user record, also using our <kbd>GlideSystem</kbd> method to get the user ID. We could also put a <kbd>sys_id</kbd> contained in quotes here for the <kbd>get</kbd> method parameter. The example then sets the title of the user to be a manager and saves the record. Running this code will make any logged-in user have a manager as their title.</p>
<p>This technique saves us having to use a full <kbd>GlideRecord</kbd> query to get the user record that we need. This means not having to search through the user table, which saves resources and also extra lines of code.</p>
<p>We can see what this example code would look like in a business rule in ServiceNow:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/aae22bff-0d7a-4b9a-9696-7405438ae38b.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Figure 2.2: Business rule making logged-in users managers</div>
<p>We will take an in-depth look at business rules in <a href="612c28de-49ab-47a2-8bcd-3cadf9c0179c.xhtml" target="_blank">Chapter 5</a>, <em>Introduction to Server-Side Scripting</em>. They are often used for server-side scripting. We would also need to add a value to the table field so that our business rule knows which table to run this script against.</p>
<p>We can also use some of the techniques we've learned in this chapter to send specific messages to users. Let's assume we want to give users a different message depending on what roles they have:</p>
<pre>if (gs.hasRole('admin')) {<br/>    gs.addErrorMessage('Error with solaris server');<br/>} else if (gs.hasRole('itil')) {<br/>    gs.addErrorMessage('Server error');<br/>} else {<br/>    gs.addErrorMessage('An error has occurred, please contact your administrator');<br/>}</pre>
<p>This server-side example will display an error message to a user based on what roles they have. This can be useful to display additional information to users who will understand it and it will keep the details simple for users who do not have as much technical expertise.</p>
<p>This code adds error messages that are displayed to the user when the form loads at the top of the screen. By using the <kbd>if</kbd> statements, we will only ever display one message to the user and, in our example, the most suitable one for the role of that user.</p>
<p>We can also set some values on a form based on whether it is a new form or not. Perhaps we want to make all new incident forms have an inquiry/help category, but not change any incidents that already exist.</p>
<p>We can see the script we would need for this as follows:</p>
<pre>if (g_form.isNewRecord()) {<br/>    g_form.setValue('category', 'inquiry');<br/>} </pre>
<p>With this client-side script example, we would only set the category field to <kbd>inquiry</kbd>/<kbd>help</kbd> if it was a new record. Remember that this would only set the field on the screen on the client side and would not save the field as this value until the record was saved.</p>
<p>This type of code can be very useful for setting up records in a certain way whilst they are being created. Sometimes it can be that fields are not shown on creation of a new record and are only viewed once the record has been created.</p>
<p>We can see this code in a client script in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-517 image-border" src="assets/83d964aa-c271-41c7-9eee-3054c7979ffc.png" style="width:101.17em;height:57.08em;"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Figure 2.3: Client script setting the incident category</div>
<p><span>We will look at client scripts further in the next chapter and they are usually the main source of client-side scripting in an instance.</span></p>
<p>If we wanted to only run script when the record is not new, we can simply place a exclamation mark in front of the <kbd>if</kbd> condition to negate the expression and give us the option to add code for updating existing records.</p>
<p>The <kbd>if</kbd> statement would instead look like this:</p>
<pre>if (!g_form.isNewRecord()) {<br/>}</pre>
<p>As you can see, we can use many of the methods we saw earlier in the chapter together to achieve the scripting goals we are looking for.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p class="mce-root">In this chapter, we looked at using exposed JavaScript APIs and the well-used <kbd>GlideRecord</kbd> class. We also looked at server-side and client-side Glide classes and the properties and methods of each that can be used to enhance your scripting. Finally, we looked at some more complex examples of scripting, combining these properties and methods to show what can be achieved and how the properties and methods can be used together.</p>
<p>In the next chapter, we will explore the basics of client-side scripting. We will look at client scripts, UI policies, when to use these scripts, and how to test them. Plus we'll add some helpful examples to show some great ways to get the most out of client-side scripting. </p>


            </article>

            
        </section>
    </body></html>