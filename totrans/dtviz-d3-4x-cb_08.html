<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 8. Chart Them Up"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/><span class="koboSpan" id="kobo.1.1">Chapter 8. Chart Them Up</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Creating a line chart</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Creating an area chart</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Creating a scatterplot chart</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Creating a bubble chart</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.7.1">Creating a bar chart</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec58"/><span class="koboSpan" id="kobo.8.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.9.1">In this chapter, we will turn our attention to one of the oldest and well-trusted companions in data visualization-charts. </span><span class="koboSpan" id="kobo.9.2">Charts are well-defined and well-understood graphical representation of data; the following definition expresses it in the simplest terms:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.10.1">(In charts) the data is represented by symbols, such as bars in a bar chart, lines in a line chart, or slices in a pie chart.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.11.1">Jensen C. </span><span class="koboSpan" id="kobo.11.2">&amp; Anderson L. </span><span class="koboSpan" id="kobo.11.3">(1991)</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.12.1">When charts are used in data visualization, their well-understood graphical semantics and syntax relieve the audience of your visualization from the burden of learning the meaning of the graphical metaphor. </span><span class="koboSpan" id="kobo.12.2">Hence, they can focus on the data itself and the information generated through visualization. </span><span class="koboSpan" id="kobo.12.3">The goal of this chapter is not only to introduce some of the commonly used chart types but also to demonstrate how the various topics and techniques you learned so far can be combined and leveraged in producing sleek, interactive charts using D3.</span></p><p><span class="koboSpan" id="kobo.13.1">Recipes in this chapter are much longer than the recipes we encountered so far since they are designed to implement fully functional and reusable charts. </span><span class="koboSpan" id="kobo.13.2">I have tried to break these into different segments and with consistent chart structures to ease your reading experience. </span><span class="koboSpan" id="kobo.13.3">However, it is still highly recommended to open the companion code examples in your browser and your text editor while you go through this chapter to minimize potential confusion and maximize the benefit.</span></p><div class="section" title="D3 chart convention"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec167"/><span class="koboSpan" id="kobo.14.1">D3 chart convention</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">Before you dive into creating your first reusable chart in D3, we need to cover some charting conventions commonly accepted in the D3 community; otherwise, you might risk creating charting libraries that might confuse your user instead of helping them.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note71"/><span class="koboSpan" id="kobo.16.1">Note</span></h3><p><span class="koboSpan" id="kobo.17.1">As you would have imagined, D3 charts are most commonly implemented using SVG instead of HTML; however, the convention we will discuss here would also apply to HTML-based charts albeit the implementation details will be somewhat different.</span></p></div></div><p><span class="koboSpan" id="kobo.18.1">Let's first take a look at the following diagram:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.19.1"><img src="graphics/image_08_001.jpg" alt="D3 chart convention"/></span></div><p>
</p><p><span class="koboSpan" id="kobo.20.1">D3 chart convention</span></p><p><span class="koboSpan" id="kobo.21.1">As shown in this diagram, the point of origin </span><span class="emphasis"><em><span class="koboSpan" id="kobo.22.1">(0, 0)</span></em></span><span class="koboSpan" id="kobo.23.1"> in an SVG image is at its top-leftmost corner as expected; however, the most important aspect of this convention pertains to how chart margins are defined and furthermore where the axes are placed.</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.24.1">Margins</span></strong></span><span class="koboSpan" id="kobo.25.1">: First of all, let's take a look at the most important aspect of this convention-the margins. </span><span class="koboSpan" id="kobo.25.2">As you can see, for each chart, there are four different margin settings: left, right, top, and bottom margins. </span><span class="koboSpan" id="kobo.25.3">A flexible chart implementation should allow its user to set different values for each of these margins, and we will see in the later recipes how this can be achieved.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.26.1">Coordinate translation</span></strong></span><span class="koboSpan" id="kobo.27.1">: Secondly, this convention also suggests that the coordinate reference of the chart body (gray area) should be defined using a SVG translate transformation, </span><span class="strong"><strong><span class="koboSpan" id="kobo.28.1">translate(margin.left, margin.top)</span></strong></span><span class="koboSpan" id="kobo.29.1">. </span><span class="koboSpan" id="kobo.29.2">This translation effectively moves the chart body area to the desired point; and one additional benefit of this approach is that by shifting the frame of reference for chart body coordinates, it simplifies the job of creating subelements inside the chart body since the margin size becomes irrelevant. </span><span class="koboSpan" id="kobo.29.3">For any subelement inside the chart body, its point of origin </span><span class="emphasis"><em><span class="koboSpan" id="kobo.30.1">(0, 0)</span></em></span><span class="koboSpan" id="kobo.31.1"> is now the top-leftmost corner of the chart body area.</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.32.1">Axes</span></strong></span><span class="koboSpan" id="kobo.33.1">: Lastly, the final aspect of this convention is regarding how and where chart axes are placed. </span><span class="koboSpan" id="kobo.33.2">As shown in the preceding diagram, chart axes are placed inside chart margins instead of being a part of the chart body. </span><span class="koboSpan" id="kobo.33.3">This approach has the advantage of treating axes as peripheral elements in a chart, and hence, doesn't convolute the chart body implementation and additionally makes axes rendering logic chart independent and easily reusable.</span></li></ul></div><p><span class="koboSpan" id="kobo.34.1">Now let's create our first reusable D3 chart with all the knowledge and techniques we covered so far.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip72"/><span class="koboSpan" id="kobo.35.1">Tip</span></h3><p><span class="koboSpan" id="kobo.36.1">To see this convention as it was explained by the creator of D3, please visit </span><a class="ulink" href="http://bl.ocks.org/mbostock/3019563"><span class="koboSpan" id="kobo.37.1">http://bl.ocks.org/mbostock/3019563
</span></a><span class="koboSpan" id="kobo.38.1">.</span></p></div></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating a line chart"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec59"/><span class="koboSpan" id="kobo.1.1">Creating a line chart</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Line chart is a common, basic chart type that is widely used in many fields. </span><span class="koboSpan" id="kobo.2.2">This chart consists of a series of data points connected by straight line segments. </span><span class="koboSpan" id="kobo.2.3">A line chart is also typically bordered by two perpendicular axes: the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">x</span></em></span><span class="koboSpan" id="kobo.4.1"> axis and the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">y</span></em></span><span class="koboSpan" id="kobo.6.1"> axis. </span><span class="koboSpan" id="kobo.6.2">In this recipe, we will take a look at how this basic chart can be implemented using D3 as a reusable JavaScript object that can be configured to display multiple data series on a different scale. </span><span class="koboSpan" id="kobo.6.3">Besides that, we will also show the technique of implementing a dynamic multi-data-series update with animation.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec168"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/line-chart.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/line-chart.html
</span></a>
</p><p><span class="koboSpan" id="kobo.10.1">It is highly recommended that you have the companion code example open while reading this recipe.</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec169"/><span class="koboSpan" id="kobo.11.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Let's take a look at the following code that implements this chart type; due the length of the recipe, we will only show the outline of the code here while diving into the details in the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.13.1">How it works...</span></em></span><span class="koboSpan" id="kobo.14.1"> section:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.15.1">&lt;script type="text/javascript"&gt; 
// First we define the chart object using a functional object 
 
function lineChart() { // &lt;-1A 
    ... 
    </span><span class="koboSpan" id="kobo.15.2">// main render function  
    _chart.render = function () { // &lt;-2A 
    ... 
    </span><span class="koboSpan" id="kobo.15.3">}; 
 
    // axes rendering function 
    functionrenderAxes(svg) { 
        ... 
    </span><span class="koboSpan" id="kobo.15.4">} 
    ... 
 
 
    </span><span class="koboSpan" id="kobo.15.5">// function to render chart body 
    function renderBody(svg) { // &lt;-2D         
    ... 
    </span><span class="koboSpan" id="kobo.15.6">} 
 
    // function to render lines 
    function renderLines() { 
    ... 
    </span><span class="koboSpan" id="kobo.15.7">} 
 
    // function to render data points 
    function renderDots() { 
 
    } 
 
    return _chart; // &lt;-1E 
} 
</span></pre><p><span class="koboSpan" id="kobo.16.1">This recipe generates the following chart:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.17.1"><img src="graphics/image_08_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.18.1">Line chart</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec170"/><span class="koboSpan" id="kobo.19.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.20.1">As you can see, this recipe is significantly more involved than anything we encountered so far; so now, I will break it into multiple detailed sections with different focuses.</span></p><div class="section" title="Chart object and attributes"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec13"/><span class="koboSpan" id="kobo.21.1">Chart object and attributes</span></h3></div></div></div><p><span class="koboSpan" id="kobo.22.1">First, we will take a look at how this chart object is created and how its associated attributes can be retrieved and set on it in the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.23.1">function lineChart() { // &lt;-1A 
        var _chart = {}; 
 
        var _width = 600, _height = 300, // &lt;-1B 
            _margins = {top: 30, left: 30, right: 30, bottom: 30}, 
            _x, _y, 
            _data = [], 
            _colors = d3.scaleOrdinal(d3.schemeCategory10), 
            _svg, 
            _bodyG, 
            _line; 
 
      ... 
 
      </span><span class="koboSpan" id="kobo.23.2">_chart.width = function (w) { 
            if (!arguments.length) return _width; 
            _width = w; 
            return _chart; 
        }; 
 
        _chart.height = function (h) { // &lt;-1C 
            if (!arguments.length) return _height; 
            _height = h; 
            return _chart; 
        }; 
 
        _chart.margins = function (m) { 
            if (!arguments.length) return _margins; 
            _margins = m; 
            return _chart; 
        }; 
 
        ... 
 
       </span><span class="koboSpan" id="kobo.23.3">_chart.addSeries = function (series) { // &lt;-1D 
            _data.push(series); 
            return _chart; 
        }; 
 
        return _chart; // &lt;-1E 
} 
 
... 
 
</span><span class="koboSpan" id="kobo.23.4">var chart = lineChart() 
            .x(d3.scaleLinear().domain([0, 10])) 
            .y(d3.scaleLinear().domain([0, 10])); 
 
data.forEach(function (series) { 
    chart.addSeries(series); 
}); 
 
chart.render(); 
</span></pre><p><span class="koboSpan" id="kobo.24.1">As you can see, the chart object is defined using a function called </span><code class="literal"><span class="koboSpan" id="kobo.25.1">lineChart</span></code><span class="koboSpan" id="kobo.26.1"> on line 1A, following the functional object pattern we have discussed in the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.27.1">Understanding D3-Style JavaScript</span></em></span><span class="koboSpan" id="kobo.28.1"> recipe in </span><a class="link" href="ch01.html" title="Chapter 1. Getting Started with D3.js"><span class="koboSpan" id="kobo.29.1">Chapter 1</span></a><span class="koboSpan" id="kobo.30.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.31.1">Getting Started with D3.js</span></em></span><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">Leveraging the greater flexibility with information hiding offered by the functional object pattern, we have defined a series of internal attributes all named starting with an underscore (line </span><code class="literal"><span class="koboSpan" id="kobo.33.1">1B</span></code><span class="koboSpan" id="kobo.34.1">). </span><span class="koboSpan" id="kobo.34.2">Some of these attributes are made public by offering an accessor function (line </span><code class="literal"><span class="koboSpan" id="kobo.35.1">1C</span></code><span class="koboSpan" id="kobo.36.1">). </span><span class="koboSpan" id="kobo.36.2">Publicly accessible attributes are as follows:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.37.1">width</span></code><span class="koboSpan" id="kobo.38.1">: Chart SVG total width in pixels</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.39.1">height</span></code><span class="koboSpan" id="kobo.40.1">: Chart SVG total height in pixels</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.41.1">margins</span></code><span class="koboSpan" id="kobo.42.1">: Chart margins</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.43.1">colors</span></code><span class="koboSpan" id="kobo.44.1">: Chart ordinal color scale used to differentiate different data series</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.45.1">x</span></code><span class="koboSpan" id="kobo.46.1">: </span><span class="emphasis"><em><span class="koboSpan" id="kobo.47.1">x</span></em></span><span class="koboSpan" id="kobo.48.1"> axis scale</span></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.49.1">y</span></code><span class="koboSpan" id="kobo.50.1">: </span><span class="emphasis"><em><span class="koboSpan" id="kobo.51.1">y</span></em></span><span class="koboSpan" id="kobo.52.1"> axis scale</span></li></ul></div><p><span class="koboSpan" id="kobo.53.1">The accessor functions are implemented using the technique we introduced in </span><a class="link" href="ch01.html" title="Chapter 1. Getting Started with D3.js"><span class="koboSpan" id="kobo.54.1">Chapter 1</span></a><span class="koboSpan" id="kobo.55.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.56.1">Getting Started with D3.js</span></em></span><span class="koboSpan" id="kobo.57.1">, effectively combining both getter and setter functions in one function, which behave as a getter when no argument is given and a setter when an argument is present (line </span><code class="literal"><span class="koboSpan" id="kobo.58.1">1C</span></code><span class="koboSpan" id="kobo.59.1">). </span><span class="koboSpan" id="kobo.59.2">Additionally, both </span><code class="literal"><span class="koboSpan" id="kobo.60.1">lineChart</span></code><span class="koboSpan" id="kobo.61.1"> function and its accessors return a chart instance, thus allowing function chaining. </span><span class="koboSpan" id="kobo.61.2">Finally, the chart object also offers an </span><code class="literal"><span class="koboSpan" id="kobo.62.1">addSeries</span></code><span class="koboSpan" id="kobo.63.1"> function, which simply pushes a data array (</span><code class="literal"><span class="koboSpan" id="kobo.64.1">series</span></code><span class="koboSpan" id="kobo.65.1">) into its internal data storage array (</span><code class="literal"><span class="koboSpan" id="kobo.66.1">_data</span></code><span class="koboSpan" id="kobo.67.1">), refer to line </span><code class="literal"><span class="koboSpan" id="kobo.68.1">1D</span></code><span class="koboSpan" id="kobo.69.1">.</span></p></div><div class="section" title="Chart body frame rendering"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec14"/><span class="koboSpan" id="kobo.70.1">Chart body frame rendering</span></h3></div></div></div><p><span class="koboSpan" id="kobo.71.1">After covering the basic chart object and its attributes, the next aspect of this reusable chart implementation is the chart body </span><code class="literal"><span class="koboSpan" id="kobo.72.1">svg:g</span></code><span class="koboSpan" id="kobo.73.1"> element rendering and its clip path generation:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.74.1">_chart.render = function () { // &lt;-2A 
  if (!_svg) { 
    _svg = d3.select("body").append("svg") // &lt;-2B 
      .attr("height", _height) 
      .attr("width", _width); 
 
    renderAxes(_svg); 
 
    defineBodyClip(_svg); 
  } 
 
  renderBody(_svg); 
}; 
... 
</span><span class="koboSpan" id="kobo.74.2">function defineBodyClip(svg) { // &lt;-2C 
  var padding = 5; 
 
  svg.append("defs") 
    .append("clipPath") 
    .attr("id", "body-clip") 
    .append("rect") 
    .attr("x", 0 - padding) 
    .attr("y", 0) 
    .attr("width", quadrantWidth() + 2 * padding) 
    .attr("height", quadrantHeight()); 
  } 
 
function renderBody(svg) { // &lt;-2D 
  if (!_bodyG) 
    _bodyG = svg.append("g") 
      .attr("class", "body") 
      .attr("transform", "translate("  
        + xStart() + ","  
        + yEnd() + ")") // &lt;-2E 
      .attr("clip-path", "url(#body-clip)");         
 
  renderLines(); 
 
  renderDots(); 
} 
... 
</span></pre><p><span class="koboSpan" id="kobo.75.1">The </span><code class="literal"><span class="koboSpan" id="kobo.76.1">render</span></code><span class="koboSpan" id="kobo.77.1"> function defined on line 2A is responsible for creating the </span><code class="literal"><span class="koboSpan" id="kobo.78.1">svg:svg</span></code><span class="koboSpan" id="kobo.79.1"> element and setting its </span><code class="literal"><span class="koboSpan" id="kobo.80.1">width</span></code><span class="koboSpan" id="kobo.81.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.82.1">height</span></code><span class="koboSpan" id="kobo.83.1"> (line 2B). </span><span class="koboSpan" id="kobo.83.2">After that, it creates an </span><code class="literal"><span class="koboSpan" id="kobo.84.1">svg:clipPath</span></code><span class="koboSpan" id="kobo.85.1"> element that covers the entire chart body area. </span><span class="koboSpan" id="kobo.85.2">The </span><code class="literal"><span class="koboSpan" id="kobo.86.1">svg:clipPath</span></code><span class="koboSpan" id="kobo.87.1"> element is used to restrict the region where paint can be applied. </span><span class="koboSpan" id="kobo.87.2">In our case, we used it to restrict the line and dots that can be painted (only within the chart body area). </span><span class="koboSpan" id="kobo.87.3">This code generates the following SVG element structure that defines the chart body:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.88.1"><img src="graphics/image_08_003.jpg" alt="Chart body frame rendering"/></span></div><p>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip73"/><span class="koboSpan" id="kobo.89.1">Tip</span></h3><p><span class="koboSpan" id="kobo.90.1">For more information on clipping and masking, please visit </span><a class="ulink" href="https://www.w3.org/TR/SVG/masking.html"><span class="koboSpan" id="kobo.91.1">https://www.w3.org/TR/SVG/masking.html
</span></a><span class="koboSpan" id="kobo.92.1">.</span></p></div></div><p><span class="koboSpan" id="kobo.93.1">The </span><code class="literal"><span class="koboSpan" id="kobo.94.1">renderBody</span></code><span class="koboSpan" id="kobo.95.1"> function defined on line 2D generates the </span><code class="literal"><span class="koboSpan" id="kobo.96.1">svg:g</span></code><span class="koboSpan" id="kobo.97.1"> element, which wraps all the chart body content with a translation set according to the chart margin convention we have discussed in the previous section (line </span><code class="literal"><span class="koboSpan" id="kobo.98.1">2E</span></code><span class="koboSpan" id="kobo.99.1">).</span></p></div><div class="section" title="Render axes"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec15"/><span class="koboSpan" id="kobo.100.1">Render axes</span></h3></div></div></div><p><span class="koboSpan" id="kobo.101.1">Axes are rendered in the </span><code class="literal"><span class="koboSpan" id="kobo.102.1">renderAxes</span></code><span class="koboSpan" id="kobo.103.1"> function (line </span><code class="literal"><span class="koboSpan" id="kobo.104.1">3A</span></code><span class="koboSpan" id="kobo.105.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.106.1">function renderAxes(svg) { // &lt;-3A 
    varaxesG = svg.append("g") 
                   .attr("class", "axes"); 
 
    renderXAxis(axesG); 
 
    renderYAxis(axesG); 
} 
</span></pre><p><span class="koboSpan" id="kobo.107.1">As discussed in the previous chapter, both the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.108.1">x</span></em></span><span class="koboSpan" id="kobo.109.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.110.1">y</span></em></span><span class="koboSpan" id="kobo.111.1"> axes are rendered inside the chart margin area. </span><span class="koboSpan" id="kobo.111.2">We will not go into details of axes rendering since we have discussed this topic in much detail in </span><a class="link" href="ch05.html" title="Chapter 5. Playing with Axes"><span class="koboSpan" id="kobo.112.1">Chapter 5</span></a><span class="koboSpan" id="kobo.113.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.114.1">Playing with Axes</span></em></span><span class="koboSpan" id="kobo.115.1">.</span></p></div><div class="section" title="Render data series"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec16"/><span class="koboSpan" id="kobo.116.1">Render data series</span></h3></div></div></div><p><span class="koboSpan" id="kobo.117.1">Everything we discussed so far in this recipe is not unique to this chart type alone but rather it is a shared framework among other Cartesian coordinates-based chart types. </span><span class="koboSpan" id="kobo.117.2">Finally, now we can discuss the core of this recipe-how the line segments and dots are created for multiple data series. </span><span class="koboSpan" id="kobo.117.3">Let's take a look at the following code fragments that are responsible for data series rendering:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.118.1">function renderLines() { 
        _line = d3.line() //&lt;-4A 
                        .x(function (d) { return _x(d.x); }) 
                        .y(function (d) { return _y(d.y); }); 
 
         var pathLines = _bodyG.selectAll("path.line") 
                    .data(_data); 
 
        pathLines 
                .enter() //&lt;-4B 
                    .append("path") 
                .merge(pathLines) 
                    .style("stroke", function (d, i) { 
                        return _colors(i); //&lt;-4C 
                    }) 
                    .attr("class", "line") 
                .transition() //&lt;-4D 
                    .attr("d", function (d) {  
                                return _line(d);  
                    }); 
} 
 
function renderDots() { 
    _data.forEach(function (list, i) { 
        var circle = _bodyG.selectAll("circle._" + i) //&lt;-4E 
                .data(list); 
 
        circle.enter() 
                .append("circle") 
            .merge(circle) 
                .attr("class", "dot _" + i) 
                .style("stroke", function (d) { 
                    return _colors(i); //&lt;-4F 
                }) 
            .transition() //&lt;-4G 
                .attr("cx", function (d) { return _x(d.x); }) 
                .attr("cy", function (d) { return _y(d.y); }) 
                .attr("r", 4.5); 
    }); 
} 
</span></pre><p><span class="koboSpan" id="kobo.119.1">The line segments and dots are generated using techniques we introduced in </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.120.1">Chapter 7</span></a><span class="koboSpan" id="kobo.121.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.122.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.123.1">. </span><span class="koboSpan" id="kobo.123.2">The </span><code class="literal"><span class="koboSpan" id="kobo.124.1">d3.line</span></code><span class="koboSpan" id="kobo.125.1"> generator was created on line 4A to create </span><code class="literal"><span class="koboSpan" id="kobo.126.1">svg:path</span></code><span class="koboSpan" id="kobo.127.1"> that maps the data series. </span><span class="koboSpan" id="kobo.127.2">The Enter-and-Update pattern is used to create the data line (line 4B). </span><span class="koboSpan" id="kobo.127.3">Line 4C sets a different color for each data line based on its index. </span><span class="koboSpan" id="kobo.127.4">Lastly, line 4E sets the transition in the update mode to move the data line smoothly on each update. </span><span class="koboSpan" id="kobo.127.5">The </span><code class="literal"><span class="koboSpan" id="kobo.128.1">renderDots</span></code><span class="koboSpan" id="kobo.129.1"> function performs a similar rendering logic that generates a set of </span><code class="literal"><span class="koboSpan" id="kobo.130.1">svg:circle</span></code><span class="koboSpan" id="kobo.131.1"> elements representing each data point (line 4E), coordinating its color based on the data series index (line 4F), and finally also initiates a transition on line 4G, so the dots can move with the line whenever the data is updated.</span></p><p><span class="koboSpan" id="kobo.132.1">As illustrated by this recipe, creating a reusable chart component involves actually quite a bit of work. </span><span class="koboSpan" id="kobo.132.2">However, more than two-thirds of the code is required to create peripheral graphical elements and accessors methods. </span><span class="koboSpan" id="kobo.132.3">Therefore, in a real-world project, you can extract this logic and reuse a large part of this implementation for other charts; though we did not do this in our recipes in order to reduce the complexity, you can quickly grasp all aspects of chart rendering. </span><span class="koboSpan" id="kobo.132.4">Due to limited scope in this book, in later recipes, we will omit all peripheral rendering logic and only focus on the core logic related to each chart type.Feel free to jump back to this recipe if you ever need to double-check the peripheral rendering logic while reading the later recipes in this chapter.</span></p></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating an area chart"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec60"/><span class="koboSpan" id="kobo.1.1">Creating an area chart</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">An area chart or an area graph is very similar to a line chart and largely implemented based on the line chart. </span><span class="koboSpan" id="kobo.2.2">The main difference between an area chart and a line chart is that in the area chart, the area between the axis and the line will be filled with colors or textures. </span><span class="koboSpan" id="kobo.2.3">In this recipe, we will explore techniques of implementing a type of area chart known as </span><span class="strong"><strong><span class="koboSpan" id="kobo.3.1">Layered Area Chart</span></strong></span><span class="koboSpan" id="kobo.4.1">.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec171"/><span class="koboSpan" id="kobo.5.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/area-chart.html"><span class="koboSpan" id="kobo.7.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/area-chart.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec172"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">An area chart implementation is largely based on the line chart implementation and shares a lot of common graphical elements, such as the axes and the clip path; therefore, in this recipe, we will only show the code that concerns the area chart implementation specifics:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">... 
 
</span><span class="koboSpan" id="kobo.10.2">function renderBody(svg) { 
        if (!_bodyG) 
            _bodyG = svg.append("g") 
                    .attr("class", "body") 
                    .attr("transform", "translate("  
                        + xStart() + ","  
                        + yEnd() + ")")  
                    .attr("clip-path", "url(#body-clip)");         
 
        renderLines(); 
 
        renderAreas(); 
 
        renderDots(); 
    } 
 
    function renderLines() { 
        _line = d3.line() 
                        .x(function (d) { return _x(d.x); }) 
                        .y(function (d) { return _y(d.y); }); 
 
        var pathLines = _bodyG.selectAll("path.line") 
                .data(_data); 
 
        pathLines.enter() 
                    .append("path") 
                .merge(pathLines) 
                    .style("stroke", function (d, i) { 
                        return _colors(i); 
                    }) 
                    .attr("class", "line") 
                .transition() 
                    .attr("d", function (d) { return _line(d); }); 
    } 
 
    function renderDots() { 
        _data.forEach(function (list, i) { 
            var circle = _bodyG.selectAll("circle._" + i) 
                    .data(list); 
 
            circle.enter() 
                    .append("circle") 
                .merge(circle) 
                    .attr("class", "dot _" + i) 
                    .style("stroke", function (d) { 
                        return _colors(i); 
                    }) 
                .transition() 
                    .attr("cx", function (d) { return _x(d.x); }) 
                    .attr("cy", function (d) { return _y(d.y); }) 
                    .attr("r", 4.5); 
        }); 
    } 
 
    function renderAreas() { 
        var area = d3.area() // &lt;-A 
                    .x(function(d) { return _x(d.x); }) 
                    .y0(yStart()) 
                    .y1(function(d) { return _y(d.y); }); 
 
        var pathAreas = _bodyG.selectAll("path.area") 
                .data(_data); 
 
        pathAreas.enter() // &lt;-B 
                .append("path") 
            .merge(pathAreas) 
                .style("fill", function (d, i) {  
                    return _colors(i);  
                }) 
                .attr("class", "area") 
            .transition() // &lt;-D 
                .attr("d", function (d) {  
                    return area(d); // &lt;-E 
                }); 
    } 
... 
</span></pre><p><span class="koboSpan" id="kobo.11.1">This recipe generates the following layered area chart:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.12.1"><img src="graphics/image_08_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.13.1">Layered area chart</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec173"/><span class="koboSpan" id="kobo.14.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">As we mentioned before, since the area chart implementation is based on our line chart implementation, a large part of the implementation is identical to the line chart. </span><span class="koboSpan" id="kobo.15.2">In fact, the area chart needs to render the exact line and dots implemented in the line chart. </span><span class="koboSpan" id="kobo.15.3">The crucial difference lies in the </span><code class="literal"><span class="koboSpan" id="kobo.16.1">renderAreas</span></code><span class="koboSpan" id="kobo.17.1"> function. </span><span class="koboSpan" id="kobo.17.2">In this recipe, we rely on the area generation technique discussed in </span><a class="link" href="ch07.html" title="Chapter 7. Getting into Shape"><span class="koboSpan" id="kobo.18.1">Chapter 7</span></a><span class="koboSpan" id="kobo.19.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.20.1">Getting into Shape</span></em></span><span class="koboSpan" id="kobo.21.1">. </span><span class="koboSpan" id="kobo.21.2">The </span><code class="literal"><span class="koboSpan" id="kobo.22.1">d3.area</span></code><span class="koboSpan" id="kobo.23.1"> generator was created on line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1"> with its upper line created to match the line while its lower line (</span><code class="literal"><span class="koboSpan" id="kobo.26.1">y0</span></code><span class="koboSpan" id="kobo.27.1">) fixed on x axis.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.28.1">var area = d3.area() // &lt;-A 
  .x(function(d) { return _x(d.x); }) 
  .y0(yStart()) 
  .y1(function(d) { return _y(d.y); }); 
</span></pre><p><span class="koboSpan" id="kobo.29.1">Once the area generator is defined, a classic Enter-and-Update pattern is employed to create and update the areas. </span><span class="koboSpan" id="kobo.29.2">In the Enter case (line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">B</span></code><span class="koboSpan" id="kobo.31.1">), an </span><code class="literal"><span class="koboSpan" id="kobo.32.1">svg:path</span></code><span class="koboSpan" id="kobo.33.1"> element was created for each data series. </span><span class="koboSpan" id="kobo.33.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.34.1">B2</span></code><span class="koboSpan" id="kobo.35.1">, we merged the </span><code class="literal"><span class="koboSpan" id="kobo.36.1">pathAreas.enter()</span></code><span class="koboSpan" id="kobo.37.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.38.1">pathAreas</span></code><span class="koboSpan" id="kobo.39.1">; therefore, all following code will be applied to both the enter and update modes; all areas are colored using its series index so it will have matching color with our line and dots (line </span><code class="literal"><span class="koboSpan" id="kobo.40.1">C</span></code><span class="koboSpan" id="kobo.41.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.42.1">Var pathAreas = _bodyG.selectAll("path.area") 
                .data(_data); 
 
pathAreas.enter() // &lt;-B 
.append("path") 
.merge(pathAreas) // &lt;-B2 
.style("fill", function (d, i) {  
    return _colors(i); // &lt;-C 
  }) 
  .attr("class", "area") 
.transition() // &lt;-D 
  .attr("d", function (d) {  
       return area(d); // &lt;-E 
  }); 
</span></pre><p><span class="koboSpan" id="kobo.43.1">Whenever the data is updated, as well as for newly created areas, we start a transition (line D) to update the area </span><code class="literal"><span class="koboSpan" id="kobo.44.1">svg:path</span></code><span class="koboSpan" id="kobo.45.1"> elements' </span><code class="literal"><span class="koboSpan" id="kobo.46.1">d</span></code><span class="koboSpan" id="kobo.47.1"> attribute to the desired shape (line E).Since we know that the line chart implementation animates both line and dots when updated, our area update transition here effectively allows the areas to be animated and moved in accordance with both lines and dots in our chart.</span></p><p><span class="koboSpan" id="kobo.48.1">Finally, we also add the CSS style for </span><code class="literal"><span class="koboSpan" id="kobo.49.1">path.area</span></code><span class="koboSpan" id="kobo.50.1"> to decrease its opacity so areas become see-through and</span><code class="literal"><span class="koboSpan" id="kobo.51.1"> hence allow the layered effect</span></code><span class="koboSpan" id="kobo.52.1"> we want:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.53.1">.area { 
  stroke: none; 
  fill-opacity: .2; 
} 
</span></pre></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating a scatterplot chart"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec61"/><span class="koboSpan" id="kobo.1.1">Creating a scatterplot chart</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">A scatterplot or scattergraph is another common type of diagram used to display data points on Cartesian coordinates with two different variables. </span><span class="koboSpan" id="kobo.2.2">Scatterplot is especially useful when you're exploring the problem of spreading, clustering, and classification. </span><span class="koboSpan" id="kobo.2.3">In this recipe, you will learn how to implement a multi-series scatterplot chart in D3.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec174"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/scatterplot-chart.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/scatterplot-chart.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec175"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">A scatterplot is another chart that uses Cartesian coordinates. </span><span class="koboSpan" id="kobo.7.2">Thus, a large part of its implementation is very similar to the charts we introduced so far; and therefore, the code concerning peripheral graphical elements are again omitted to save space in this book. </span><span class="koboSpan" id="kobo.7.3">Please refer to the companion code for the complete implementation. </span><span class="koboSpan" id="kobo.7.4">Now let's take a look the implementation of this recipe:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">... 
 
</span><span class="koboSpan" id="kobo.8.2">_symbolTypes = d3.scaleOrdinal() // &lt;-A 
                  .range([d3.symbolCircle, 
                            d3.symbolCross, 
                            d3.symbolDiamond, 
                            d3.symbolSquare, 
                            d3.symbolStar, 
                            d3.symbolTriangle, 
                            d3.symbolWye 
                ]); 
 
... 
 
</span><span class="koboSpan" id="kobo.8.3">function renderBody(svg) { 
    if (!_bodyG) 
        _bodyG = svg.append("g") 
            .attr("class", "body") 
            .attr("transform", "translate(" 
                            + xStart() + "," 
                            + yEnd() + ")") 
            .attr("clip-path", "url(#body-clip)"); 
 
            renderSymbols(); 
} 
 
function renderSymbols() { // &lt;-B 
    _data.forEach(function (list, i) { 
        var symbols = _bodyG.selectAll("path._" + i) 
                        .data(list); 
 
        symbols.enter() 
                .append("path") 
            .merge(symbols) 
                .attr("class", "symbol _" + i) 
                .classed(_symbolTypes(i), true) 
            .transition() // &lt;-C 
                .attr("transform", function(d){ 
                           return "translate(" // &lt;-D 
                                    + _x(d.x) 
                                    + "," 
                                    + _y(d.y) 
                                    + ")"; 
                }) 
                .attr("d", 
                        d3.symbol() // &lt;-E 
                            .type(_symbolTypes(i)) 
                ); 
        }); 
} 
... 
</span></pre><p><span class="koboSpan" id="kobo.9.1">This recipe generates the following scatterplot chart:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_08_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Scatter plot chart</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec176"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">The content of the scatterplot chart is mainly rendered by the </span><code class="literal"><span class="koboSpan" id="kobo.14.1">renderSymbols</span></code><span class="koboSpan" id="kobo.15.1"> function on line </span><code class="literal"><span class="koboSpan" id="kobo.16.1">B</span></code><span class="koboSpan" id="kobo.17.1">. </span><span class="koboSpan" id="kobo.17.2">You probably may have already noticed that the </span><code class="literal"><span class="koboSpan" id="kobo.18.1">renderSymbols</span></code><span class="koboSpan" id="kobo.19.1"> function implementation is very similar to the </span><code class="literal"><span class="koboSpan" id="kobo.20.1">renderDots</span></code><span class="koboSpan" id="kobo.21.1"> function we discussed in the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.22.1">Creating a line chart</span></em></span><span class="koboSpan" id="kobo.23.1"> recipe. </span><span class="koboSpan" id="kobo.23.2">This is not by accident since both try to plot data points on Cartesian coordinates with two variables (x and y). </span><span class="koboSpan" id="kobo.23.3">In the case of plotting dots, the </span><code class="literal"><span class="koboSpan" id="kobo.24.1">svg:circle</span></code><span class="koboSpan" id="kobo.25.1"> elements were being created, whereas, in scatterplot, you will need to create the </span><code class="literal"><span class="koboSpan" id="kobo.26.1">d3.symbol</span></code><span class="koboSpan" id="kobo.27.1"> elements. </span><span class="koboSpan" id="kobo.27.2">D3 provides a list of predefined symbols that can be generated easily and rendered using an </span><code class="literal"><span class="koboSpan" id="kobo.28.1">svg:path</span></code><span class="koboSpan" id="kobo.29.1"> element. </span><span class="koboSpan" id="kobo.29.2">As shown on line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">A</span></code><span class="koboSpan" id="kobo.31.1">, we defined an ordinal scale to allow mapping of data series index to different symbol types:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1">_symbolTypes = d3.scaleOrdinal() // &lt;-A 
                        .range([d3.symbolCircle, 
                            d3.symbolCross, 
                            d3.symbolDiamond, 
                            d3.symbolSquare, 
                            d3.symbolStar, 
                            d3.symbolTriangle, 
                            d3.symbolWye 
                        ]); 
</span></pre><p><span class="koboSpan" id="kobo.33.1">Plotting the data points with symbols is quite straightforward. </span><span class="koboSpan" id="kobo.33.2">First, we will loop through the data series array, and for each data series, we will create a set of </span><code class="literal"><span class="koboSpan" id="kobo.34.1">svg:path</span></code><span class="koboSpan" id="kobo.35.1"> elements representing each data point in the series as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.36.1"> 
_data.forEach(function (list, i) { 
    var symbols = _bodyG.selectAll("path._" + i) 
                        .data(list); 
 
    symbols.enter() 
            .append("path") 
        .merge(symbols) 
            .attr("class", "symbol _" + i) 
            .classed(_symbolTypes(i), true) 
        .transition() // &lt;-C 
            .attr("transform", function(d){ 
                            return "translate(" // &lt;-D 
                                    + _x(d.x) 
                                    + "," 
                                    + _y(d.y) 
                                    + ")"; 
            }) 
            .attr("d",d3.symbol() // &lt;-E 
                                .type(_symbolTypes(i)) 
            ); 
}); 
</span></pre><p><span class="koboSpan" id="kobo.37.1">By merging the </span><code class="literal"><span class="koboSpan" id="kobo.38.1">symbols.enter()</span></code><span class="koboSpan" id="kobo.39.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.40.1">symbols</span></code><span class="koboSpan" id="kobo.41.1"> selections, we made sure that whenever data series are updated, as well as for newly created symbols, we apply the update with transition (line </span><code class="literal"><span class="koboSpan" id="kobo.42.1">C</span></code><span class="koboSpan" id="kobo.43.1">), placing them on the right coordinates with an SVG translation transformation (line D). </span><span class="koboSpan" id="kobo.43.2">Finally, the </span><code class="literal"><span class="koboSpan" id="kobo.44.1">d</span></code><span class="koboSpan" id="kobo.45.1"> attribute of each </span><code class="literal"><span class="koboSpan" id="kobo.46.1">svg:path</span></code><span class="koboSpan" id="kobo.47.1"> element is generated using the </span><code class="literal"><span class="koboSpan" id="kobo.48.1">d3.svg.symbol</span></code><span class="koboSpan" id="kobo.49.1"> generator function as shown on line </span><code class="literal"><span class="koboSpan" id="kobo.50.1">E</span></code><span class="koboSpan" id="kobo.51.1">.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating a bubble chart"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec62"/><span class="koboSpan" id="kobo.1.1">Creating a bubble chart</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">A bubble chart is a typical visualization capable of displaying three data dimensions. </span><span class="koboSpan" id="kobo.2.2">Every data entity with its three data points is visualized as a bubble (or disk) on Cartesian coordinates, with two different variables represented using </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">x</span></em></span><span class="koboSpan" id="kobo.4.1"> axis and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">y</span></em></span><span class="koboSpan" id="kobo.6.1"> axis, similar to the </span><code class="literal"><span class="koboSpan" id="kobo.7.1">scatterplot</span></code><span class="koboSpan" id="kobo.8.1"> chart, while the third dimension is represented using the radius of the bubble (size of the disk). </span><span class="koboSpan" id="kobo.8.2">The bubble chart is particularly useful when it's used to facilitate </span><code class="literal"><span class="koboSpan" id="kobo.9.1">the understanding of relation</span></code><span class="koboSpan" id="kobo.10.1">ships between data entities.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec177"/><span class="koboSpan" id="kobo.11.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/bubble-chart.html"><span class="koboSpan" id="kobo.13.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/bubble-chart.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec178"/><span class="koboSpan" id="kobo.14.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">In this recipe, we will explore techniques and ways of implementing a typical bubble chart using D3. </span><span class="koboSpan" id="kobo.15.2">The following code example shows the important implementation aspects of a bubble chart, omitting the accessors and peripheral graphic implementation details:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.16.1">... 
 
</span><span class="koboSpan" id="kobo.16.2">var _width = 600, _height = 300, 
                _margins = {top: 30, left: 30, right: 30, bottom: 30}, 
                _x, _y, _r, // &lt;-A 
                _data = [], 
                _colors = d3.scaleOrdinal(d3.schemeCategory10), 
                _svg, 
                _bodyG; 
 
        _chart.render = function () { 
            if (!_svg) { 
                _svg = d3.select("body").append("svg") 
                        .attr("height", _height) 
                        .attr("width", _width); 
 
                renderAxes(_svg); 
 
                defineBodyClip(_svg); 
            } 
 
            renderBody(_svg); 
        }; 
... 
</span><span class="koboSpan" id="kobo.16.3">function renderBody(svg) { 
        if (!_bodyG) 
            _bodyG = svg.append("g") 
                    .attr("class", "body") 
                    .attr("transform", "translate(" 
                            + xStart() 
                            + "," 
                            + yEnd() + ")") 
                    .attr("clip-path", "url(#body-clip)"); 
 
           renderBubbles(); 
} 
 
function renderBubbles() { 
        _r.range([0, 50]); // &lt;-B 
 
        _data.forEach(function (list, i) { 
            var bubbles = _bodyG.selectAll("circle._" + i) 
                   .data(list); 
 
            bubbles.enter() 
                        .append("circle") // &lt;-C 
                    .merge(bubbles) 
                        .attr("class", "bubble _" + i) 
                        .style("stroke", function (d, j) { 
                            return _colors(j); 
                        }) 
                        .style("fill", function (d, j) { 
                            return _colors(j); 
                        }) 
                    .transition() 
                        .attr("cx", function (d) { 
                            return _x(d.x); // &lt;-D 
                        }) 
                        .attr("cy", function (d) { 
                            return _y(d.y); // &lt;-E 
                        }) 
                        .attr("r", function (d) { 
                            return _r(d.r); // &lt;-F 
                        }); 
        }); 
} 
... 
</span></pre><p><span class="koboSpan" id="kobo.17.1">This recipe generates the following visualization:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.18.1"><img src="graphics/image_08_006.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.19.1">Bubble chart</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec179"/><span class="koboSpan" id="kobo.20.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.21.1">Overall, the bubble chart implementation follows the same pattern as other chart implementations introduced in this chapter so far. </span><span class="koboSpan" id="kobo.21.2">However, since we want to visualize three different dimensions (x, y, and radius) instead of two in the bubble chart, a new scale </span><code class="literal"><span class="koboSpan" id="kobo.22.1">_r</span></code><span class="koboSpan" id="kobo.23.1"> was added in this implementation (line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1">) as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">var _width = 600, _height = 300, 
  _margins = {top: 30, left: 30, right: 30, bottom: 30}, 
  _x, _y, _r, // &lt;-A 
  _data = [], 
  _colors = d3.scale.category10(), 
  _svg, 
  _bodyG; 
</span></pre><p><span class="koboSpan" id="kobo.27.1">Most of the bubble chart-related implementation details are handled by the </span><code class="literal"><span class="koboSpan" id="kobo.28.1">renderBubbles</span></code><span class="koboSpan" id="kobo.29.1"> function. </span><span class="koboSpan" id="kobo.29.2">It starts with setting the range on the radius scale (line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">B</span></code><span class="koboSpan" id="kobo.31.1">). </span><span class="koboSpan" id="kobo.31.2">Of course, we can also make the radius range configurable in our chart implementation; however, for simplicity, we chose to set it explicitly in the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1"> 
function renderBubbles() { 
        _r.range([0, 50]); // &lt;-B 
 
        _data.forEach(function (list, i) { 
            var bubbles = _bodyG.selectAll("circle._" + i) 
                   .data(list); 
 
            bubbles.enter() 
                        .append("circle") // &lt;-C 
                    .merge(bubbles) 
                        .attr("class", "bubble _" + i) 
                        .style("stroke", function (d, j) { 
                            return _colors(j); 
                        }) 
                        .style("fill", function (d, j) { 
                            return _colors(j); 
                        }) 
                    .transition() 
                        .attr("cx", function (d) { 
                            return _x(d.x); // &lt;-D 
                        }) 
                        .attr("cy", function (d) { 
                            return _y(d.y); // &lt;-E 
                        }) 
                        .attr("r", function (d) { 
                            return _r(d.r); // &lt;-F 
                        }); 
        }); 
} 
</span></pre><p><span class="koboSpan" id="kobo.33.1">Once the range is set, we iterated through our data series, and for each series, we created a set of </span><code class="literal"><span class="koboSpan" id="kobo.34.1">svg:circle</span></code><span class="koboSpan" id="kobo.35.1"> elements (line </span><code class="literal"><span class="koboSpan" id="kobo.36.1">C</span></code><span class="koboSpan" id="kobo.37.1">). </span><span class="koboSpan" id="kobo.37.2">Finally, we handled the newly created bubble and its update in the last section, where the </span><code class="literal"><span class="koboSpan" id="kobo.38.1">svg:circle</span></code><span class="koboSpan" id="kobo.39.1"> elements are colored and placed </span><code class="literal"><span class="koboSpan" id="kobo.40.1">to</span></code><span class="koboSpan" id="kobo.41.1"> the correct coordinates using its </span><code class="literal"><span class="koboSpan" id="kobo.42.1">cx</span></code><span class="koboSpan" id="kobo.43.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.44.1">cy</span></code><span class="koboSpan" id="kobo.45.1"> attributes (lines </span><code class="literal"><span class="koboSpan" id="kobo.46.1">D</span></code><span class="koboSpan" id="kobo.47.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.48.1">E</span></code><span class="koboSpan" id="kobo.49.1">). </span><span class="koboSpan" id="kobo.49.2">In the end, the bubble size is controlled using its radius attribute </span><code class="literal"><span class="koboSpan" id="kobo.50.1">r </span></code><span class="koboSpan" id="kobo.51.1">mapped using the </span><code class="literal"><span class="koboSpan" id="kobo.52.1">_r</span></code><span class="koboSpan" id="kobo.53.1"> scale we defined earlier (line F).</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip74"/><span class="koboSpan" id="kobo.54.1">Tip</span></h3><p><span class="koboSpan" id="kobo.55.1">In some of the bubble chart implementations, the implementer also leverages the color of each bubble to visualize a fourth data dimension, although some believe this kind of visual representation is hard to grasp and superfluous.</span></p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Creating a bar chart"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec63"/><span class="koboSpan" id="kobo.1.1">Creating a bar chart</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">A bar chart is a visualization that uses either horizontal (row charts) or vertical (column charts) rectangular bars with length proportional to the values that they represent. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will implement a column chart using D3. </span><span class="koboSpan" id="kobo.2.3">A column chart is capable of visually representing two variables at the same time with its </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">y </span></em></span><span class="koboSpan" id="kobo.4.1">axis; in other words, the bar height and its </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">x</span></em></span><span class="koboSpan" id="kobo.6.1"> axis. </span><span class="koboSpan" id="kobo.6.2">The </span><span class="emphasis"><em><span class="koboSpan" id="kobo.7.1">x</span></em></span><span class="koboSpan" id="kobo.8.1"> axis values can be either discrete or continuous (for example, a histogram). </span><span class="koboSpan" id="kobo.8.2">In our example, we choose to visualize continuous values on the x axis. </span><span class="koboSpan" id="kobo.8.3">However, the same technique can be applied when you work with discrete values.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec180"/><span class="koboSpan" id="kobo.9.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.10.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/bar-chart.html"><span class="koboSpan" id="kobo.11.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter8/bar-chart.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec181"/><span class="koboSpan" id="kobo.12.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">The following code example shows the important implementation aspects of a histogram, omitting the accessors and peripheral graphic implementation details:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.14.1">... 
 
</span><span class="koboSpan" id="kobo.14.2">var _chart = {}; 
 
    var _width = 600, _height = 250, 
            _margins = {top: 30, left: 30, right: 30, bottom: 30}, 
            _x, _y, 
            _data = [], 
            _colors = d3.scaleOrdinal(d3.schemeCategory10), 
            _svg, 
            _bodyG; 
 
    _chart.render = function () { 
        if (!_svg) { 
            _svg = d3.select("body").append("svg") 
                    .attr("height", _height) 
                    .attr("width", _width); 
 
            renderAxes(_svg); 
 
            defineBodyClip(_svg); 
        } 
 
        renderBody(_svg); 
    }; 
... 
</span><span class="koboSpan" id="kobo.14.3">function renderBody(svg) { 
        if (!_bodyG) 
            _bodyG = svg.append("g") 
                    .attr("class", "body") 
                    .attr("transform", "translate("  
                            + xStart()  
                            + ","  
                            + yEnd() + ")") 
                    .attr("clip-path", "url(#body-clip)"); 
 
        renderBars(); 
    } 
     
    function renderBars() { 
        var padding = 2; // &lt;-A 
 
        var bars = _bodyG.selectAll("rect.bar") 
                .data(_data); 
        bars.enter() 
                .append("rect") // &lt;-B 
            .merge(bars) 
                .attr("class", "bar") 
            .transition() 
                .attr("x", function (d) {  
                    return _x(d.x); // &lt;-C 
                }) 
                .attr("y", function (d) {  
                    return _y(d.y); // &lt;-D  
                }) 
                .attr("height", function (d) {  
                    return yStart() - _y(d.y);  
                }) 
                .attr("width", function(d){ 
                    return Math.floor(quadrantWidth() /                              
                              _data.length) - padding; 
                }); 
    } 
... 
</span></pre><p><span class="koboSpan" id="kobo.15.1">This recipe generates the following visualization:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.16.1"><img src="graphics/image_08_007.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.17.1">Bar chart (histogram)</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec182"/><span class="koboSpan" id="kobo.18.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.19.1">One major difference here is that the bar chart implementation does not support multiple data series. </span><span class="koboSpan" id="kobo.19.2">Therefore, instead of using a 2D array storing multiple data series as we did with other charts so far, in this implementation, the </span><code class="literal"><span class="koboSpan" id="kobo.20.1">_data</span></code><span class="koboSpan" id="kobo.21.1"> array simply stores a single set of data points directly. </span><span class="koboSpan" id="kobo.21.2">Main bar chart-related visualization logic resides in the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">renderBars</span></code><span class="koboSpan" id="kobo.23.1"> function:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.24.1">functionrenderBars() { 
  var padding = 2; // &lt;-A 
  ... 
</span><span class="koboSpan" id="kobo.24.2">} 
</span></pre><p><span class="koboSpan" id="kobo.25.1">In the first step, we defined the padding between bars (line </span><code class="literal"><span class="koboSpan" id="kobo.26.1">A</span></code><span class="koboSpan" id="kobo.27.1">) so that later on we can automatically calculate the width of each bar. </span><span class="koboSpan" id="kobo.27.2">After that, we generated an </span><code class="literal"><span class="koboSpan" id="kobo.28.1">svg:rect</span></code><span class="koboSpan" id="kobo.29.1"> element (the bars) for each data point (line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">B</span></code><span class="koboSpan" id="kobo.31.1">) as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1">var bars = _bodyG.selectAll("rect.bar") 
                .data(_data); 
 
        bars.enter() 
                .append("rect") // &lt;-B 
            .merge(bars) 
                .attr("class", "bar") 
            .transition() 
                .attr("x", function (d) {  
                    return _x(d.x); // &lt;-C 
                }) 
                .attr("y", function (d) {  
                    return _y(d.y); // &lt;-D  
                }) 
                .attr("height", function (d) {  
                    return yStart() - _y(d.y);  
                }) 
                .attr("width", function(d){ 
                    return Math.floor(quadrantWidth() / 
                           _data.length) - padding; 
                }); 
</span></pre><p><span class="koboSpan" id="kobo.33.1">Then, in the update section, we placed each bar at the correct coordinates using its </span><span class="emphasis"><em><span class="koboSpan" id="kobo.34.1">x</span></em></span><span class="koboSpan" id="kobo.35.1"> and </span><span class="emphasis"><em><span class="koboSpan" id="kobo.36.1">y</span></em></span><span class="koboSpan" id="kobo.37.1"> attributes (lines </span><code class="literal"><span class="koboSpan" id="kobo.38.1">C</span></code><span class="koboSpan" id="kobo.39.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.40.1">D</span></code><span class="koboSpan" id="kobo.41.1">) and extended each bar all the way down to touch the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.42.1">x</span></em></span><span class="koboSpan" id="kobo.43.1"> axis with an adaptive </span><code class="literal"><span class="koboSpan" id="kobo.44.1">height</span></code><span class="koboSpan" id="kobo.45.1"> calculated on line E. </span><span class="koboSpan" id="kobo.45.2">Finally, we calculated the optimal width for each bar using the number of bars and the padding value we defined earlier:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.46.1">.attr("width", function(d){ 
    returnMath.floor(quadrantWidth() / _data.length) - padding; 
}); 
</span></pre><p><span class="koboSpan" id="kobo.47.1">Of course, in a more flexible implementation, we can make the padding configurable instead of being fixed to 2 pixels.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec183"/><span class="koboSpan" id="kobo.48.1">See also</span></h2></div></div></div><p><span class="koboSpan" id="kobo.49.1">Before planning to implement your own reusable chart for your next visualization project, make sure that you also check out the following open source reusable chart projects based on D3:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.50.1">NVD3: </span><a class="ulink" href="http://nvd3.org/"><span class="koboSpan" id="kobo.51.1">http://nvd3.org/</span></a><span class="koboSpan" id="kobo.52.1">.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.53.1">Dimensional Charting: </span><a class="ulink" href="https://dc-js.github.io/dc.js/"><span class="koboSpan" id="kobo.54.1">https://dc-js.github.io/dc.js/
</span></a><span class="koboSpan" id="kobo.55.1">.</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.56.1">Rickshaw: </span><a class="ulink" href="http://code.shutterstock.com/rickshaw/"><span class="koboSpan" id="kobo.57.1">http://code.shutterstock.com/rickshaw/</span></a><span class="koboSpan" id="kobo.58.1">.</span></li></ul></div></div></div></div></div></body></html>