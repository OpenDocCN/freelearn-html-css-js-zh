<html><head></head><body>
  <div id="_idContainer019">
   <h1 class="chapter-number" id="_idParaDest-69">
    <a id="_idTextAnchor068">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     3
    </span>
   </h1>
   <h1 id="_idParaDest-70">
    <a id="_idTextAnchor069">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Working with Streams
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Streams are one of the key features of Node.js.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     Most Node.js applications rely on the underlying Node.js streams implementation, be it for reading/writing files, handling HTTP requests, or other network communications.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     Streams provide a mechanism to read input and write
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      output sequentially.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     By reading chunks of data sequentially, we can work with very large files (or other data input) that would generally be too large to read into memory and process as a whole.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     Streams are fundamental to big data applications or media streaming services, where the data is too large to consume
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      at once.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.7.1">
     There are four main types of streams
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.8.1">
      in Node.js:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.9.1">
       Readable streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.10.1">
      : Used for reading data, such as reading a file, or reading data from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.11.1">
       a request.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.12.1">
       Writable streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.13.1">
      : Used for writing data, such as writing a file, or sending data to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       a response.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.15.1">
       Duplex streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.16.1">
      : Used for both reading and writing data, such as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.17.1">
       TCP socket.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.18.1">
       Transform streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.19.1">
      : A type of duplex stream that transforms the data input, and then outputs the transformed data.
     </span>
     <span class="koboSpan" id="kobo.19.2">
      A common example would be a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.20.1">
       compression stream.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.21.1">
     This chapter will demonstrate how we can create these various types of streams, as well as how we can chain these types of streams together to form
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.22.1">
      stream pipelines.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.23.1">
     This chapter will cover the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.24.1">
      following recipes:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.25.1">
      Creating readable and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.26.1">
       writable streams
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.27.1">
      Interacting with
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.28.1">
       paused streams
      </span>
     </span>
    </li>
    <li>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.29.1">
       Piping streams
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.30.1">
      Creating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.31.1">
       transform streams
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.32.1">
      Building
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.33.1">
       stream pipelines
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.34.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.35.1">
     The recipes in this chapter will focus on the streams implementations provided by the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.36.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.37.1">
     module in Node.js 22.
    </span>
    <span class="koboSpan" id="kobo.37.2">
     Because of this, we will not use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.38.1">
      readable-stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.39.1">
     module (
    </span>
    <a href="https://github.com/nodejs/readable-stream">
     <span class="koboSpan" id="kobo.40.1">
      https://github.com/nodejs/readable-stream
     </span>
    </a>
    <span class="koboSpan" id="kobo.41.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.41.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.42.1">
      readable-stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.43.1">
     module aims to mitigate any inconsistencies in the streams implementations across Node.js versions by providing an external mirror of the streams implementations as an independently installable module.
    </span>
    <span class="koboSpan" id="kobo.43.2">
     At the time of writing, the latest major version of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.44.1">
      readable-stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.45.1">
     is version 4, which aligns with the Node.js 18
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.46.1">
      streams implementations.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-71">
    <a id="_idTextAnchor070">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.48.1">
     For this chapter, you should have Node.js 22 installed, preferably the latest version of Node.js 22.
    </span>
    <span class="koboSpan" id="kobo.48.2">
     You’ll also need access to a terminal, editor, and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.49.1">
      the internet.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.50.1">
     The code samples for this chapter are available in this book’s GitHub repository (
    </span>
    <a href="https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition">
     <span class="koboSpan" id="kobo.51.1">
      https://github.com/PacktPublishing/Node.js-Cookbook-Fifth-Edition
     </span>
    </a>
    <span class="koboSpan" id="kobo.52.1">
     ) in the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.53.1">
       Chapter03
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.54.1">
      directory.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-72">
    <a id="_idTextAnchor071">
    </a>
    <span class="koboSpan" id="kobo.55.1">
     Creating readable and writable streams
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.56.1">
     The Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.57.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.58.1">
     core module provides the Node.js stream API.
    </span>
    <span class="koboSpan" id="kobo.58.2">
     This recipe will introduce using streams in Node.js.
    </span>
    <span class="koboSpan" id="kobo.58.3">
     It will cover how to create both a readable stream and a writable
    </span>
    <a id="_idIndexMarker106">
    </a>
    <span class="koboSpan" id="kobo.59.1">
     stream to interact with
    </span>
    <a id="_idIndexMarker107">
    </a>
    <span class="koboSpan" id="kobo.60.1">
     files using the Node.js core
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.61.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.62.1">
      module.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-73">
    <a id="_idTextAnchor072">
    </a>
    <span class="koboSpan" id="kobo.63.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.64.1">
     Before diving into this recipe, we must set up our workspace by creating a directory
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.65.1">
      and files:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.66.1">
      First, let’s create a directory to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.67.1">
       work in:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.68.1">$ mkdir learning-streams</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.69.1">$ cd learning-streams</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.70.1">
      Create the following
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.71.1">
       two files:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.72.1">$ touch write-stream.js</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.73.1">$ touch read-stream.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.74.1">
     Now, we’re ready to start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.75.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-74">
    <a id="_idTextAnchor073">
    </a>
    <span class="koboSpan" id="kobo.76.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.77.1">
     In this recipe, we’ll learn
    </span>
    <a id="_idIndexMarker108">
    </a>
    <span class="koboSpan" id="kobo.78.1">
     how to create both a readable stream and a writeable
    </span>
    <a id="_idIndexMarker109">
    </a>
    <span class="koboSpan" id="kobo.79.1">
     stream.
    </span>
    <span class="koboSpan" id="kobo.79.2">
     First, we’ll create a writable stream so that we can write a large file.
    </span>
    <span class="koboSpan" id="kobo.79.3">
     After, we’ll read that large file using a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.80.1">
      readable stream:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.81.1">
      Start by importing the Node.js core
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.82.1">
       File system
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.84.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.85.1">
        write-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.86.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.87.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.88.1">
      Next, we will create the writable stream using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.89.1">
       createWriteStream()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.90.1">
      method that’s available on the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.91.1">
        fs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.92.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.93.1">
const file = fs.createWriteStream('./file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.94.1">
      At this point, we can start writing content into our file.
     </span>
     <span class="koboSpan" id="kobo.94.2">
      Let’s write a random string to the file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.95.1">
       multiple times:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.96.1">
const fs = require('node:fs');
const file = fs.createWriteStream('./file.txt');
for (let i = 0; i &lt;= 100000; i++) {
  file.write(
    'Node.js is a JavaScript runtime built on Google
    Chrome\'s V8 JavaScript engine.\n'
  );
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.97.1">
      Now, we can run the script with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.98.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.99.1">$ node write-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.100.1">
      This will create a file
     </span>
     <a id="_idIndexMarker110">
     </a>
     <span class="koboSpan" id="kobo.101.1">
      named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.102.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.103.1">
      in your current directory.
     </span>
     <span class="koboSpan" id="kobo.103.2">
      The file will be
     </span>
     <a id="_idIndexMarker111">
     </a>
     <span class="koboSpan" id="kobo.104.1">
      approximately
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.105.1">
       7.5M
      </span>
     </strong>
     <span class="koboSpan" id="kobo.106.1">
      in size.
     </span>
     <span class="koboSpan" id="kobo.106.2">
      To check that the file exists, enter the following command in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.107.1">
       your terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.108.1">$ ls -lh file.txt</span></strong><span class="koboSpan" id="kobo.109.1">
-rw-r--r--  1 bgriggs  staff   7.5M  8 Nov 16:30 file.txt</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.110.1">
      Next, we’ll create a script that will create a readable stream to read the contents of the file.
     </span>
     <span class="koboSpan" id="kobo.110.2">
      Start the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.111.1">
       read-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.112.1">
      file by importing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.113.1">
       fs
      </span>
     </strong>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.114.1">
       core module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.115.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.116.1">
      Now, we can create our readable stream using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.117.1">
        createReadStream()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.118.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.119.1">
const rs = fs.createReadStream('./file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.120.1">
      Next, we can register a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.121.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.122.1">
      event handler, which will execute each time a chunk of data has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.123.1">
       been read:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.124.1">
rs.on('data', (data) =&gt; {
  console.log('Read chunk:', data);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.125.1">
      We will also add an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.126.1">
       end
      </span>
     </strong>
     <span class="koboSpan" id="kobo.127.1">
      event handler, which will be fired when there is no more data left to be consumed from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.128.1">
       the stream:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.129.1">
rs.on('end', () =&gt; {
  console.log('No more data.');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.130.1">
      Run the program with
     </span>
     <a id="_idIndexMarker112">
     </a>
     <span class="koboSpan" id="kobo.131.1">
      the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.132.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.133.1">$ node read-stream.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.134.1">
       Expect to see the
      </span>
      <a id="_idIndexMarker113">
      </a>
      <span class="koboSpan" id="kobo.135.1">
       data chunks as
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.136.1">
        Buffer
       </span>
      </strong>
      <span class="koboSpan" id="kobo.137.1">
       data that’s logged as
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.138.1">
        they’re read:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer015">
     <span class="koboSpan" id="kobo.139.1">
      <img alt="Figure 3.1 – A snippet of data chunks read by the stream" src="image/B19212_03_01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.140.1">
     Figure 3.1 – A snippet of data chunks read by the stream
    </span>
   </p>
   <ol>
    <li value="11">
     <span class="koboSpan" id="kobo.141.1">
      If we call
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.142.1">
       toString()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.143.1">
      on the individual chunks of data within the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.144.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.145.1">
      event handler function, we’ll see the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.146.1">
       String
      </span>
     </strong>
     <span class="koboSpan" id="kobo.147.1">
      content output as it is processed.
     </span>
     <span class="koboSpan" id="kobo.147.2">
      Change the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.148.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.149.1">
      event handler function to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.150.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.151.1">
rs.on('data', (data) =&gt; {
  console.log('Read chunk:', data.toString());
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.152.1">
      Rerun the script
     </span>
     <a id="_idIndexMarker114">
     </a>
     <span class="koboSpan" id="kobo.153.1">
      using the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.154.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.155.1">$ node read-stream.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.156.1">
       Expect to see the
      </span>
      <a id="_idIndexMarker115">
      </a>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.157.1">
        following output:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer016">
     <span class="koboSpan" id="kobo.158.1">
      <img alt="Figure 3.2 – A snippet of the data chunks read by the stream, in string form" src="image/B19212_03_02.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.159.1">
     Figure 3.2 – A snippet of the data chunks read by the stream, in string form
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.160.1">
     With that, we’ve created a file using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.161.1">
      createWriteStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.162.1">
     , and then read that file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.163.1">
      using
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.164.1">
       createReadStream()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.165.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-75">
    <a id="_idTextAnchor074">
    </a>
    <span class="koboSpan" id="kobo.166.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.167.1">
     In this recipe, we wrote and read a file sequentially using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.168.1">
      createReadStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.169.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.170.1">
      createWriteStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.171.1">
     core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.172.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     methods.
    </span>
    <span class="koboSpan" id="kobo.173.2">
     The Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.174.1">
      fs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.175.1">
     module relies on the underlying Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.176.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.177.1">
     core module.
    </span>
    <span class="koboSpan" id="kobo.177.2">
     Generally, the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.178.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.179.1">
     core module is not interacted with directly.
    </span>
    <span class="koboSpan" id="kobo.179.2">
     You’d typically only interact with the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.180.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.181.1">
     implementation via higher-level APIs, such as those exposed by the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.182.1">
       fs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.183.1">
      module.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.184.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.185.1">
     For more information about the underlying Node.js streams implementations and API, please refer to the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.186.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.187.1">
     module documentation
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.188.1">
      at
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest-v22.x/api/stream.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.189.1">
       https://nodejs.org/docs/latest-v22.x/api/stream.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.190.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.191.1">
     We created a writable
    </span>
    <a id="_idIndexMarker116">
    </a>
    <span class="koboSpan" id="kobo.192.1">
     stream, via the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.193.1">
      fs.createWriteStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.194.1">
     method, to write our file contents sequentially.
    </span>
    <span class="koboSpan" id="kobo.194.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.195.1">
      fs.createWriteStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.196.1">
     method accepts two parameters.
    </span>
    <span class="koboSpan" id="kobo.196.2">
     The first is the path of the file to write to, while
    </span>
    <a id="_idIndexMarker117">
    </a>
    <span class="koboSpan" id="kobo.197.1">
     the second is an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.198.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.199.1">
     object that can be used to supply configuration to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.200.1">
      the stream.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.201.1">
     The following table details the configuration that we can supply to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.202.1">
      fs.createWriteStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.203.1">
     method via an
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.204.1">
       options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.205.1">
      object:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-1">
    <colgroup>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.206.1">
           Option
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.207.1">
           Description
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.208.1">
           Default Value
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.209.1">
           flags
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.210.1">
         Defines
        </span>
        <strong class="bold">
         <span class="koboSpan" id="kobo.211.1">
          File
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.212.1">
           System
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.213.1">
          flags.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.214.1">
          w
         </span>
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.215.1">
           encoding
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.216.1">
         The encoding of
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.217.1">
          the file.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.218.1">
           utf8
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.219.1">
           fd
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.220.1">
         The
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.221.1">
          fd
         </span>
        </strong>
        <span class="koboSpan" id="kobo.222.1">
         value is expected to be a file descriptor.
        </span>
        <span class="koboSpan" id="kobo.222.2">
         When this value is supplied, the
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.223.1">
          path
         </span>
        </strong>
        <span class="koboSpan" id="kobo.224.1">
         argument will
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.225.1">
          be ignored.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.226.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.227.1">
           mode
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.228.1">
         Sets the
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.229.1">
          file permissions.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.230.1">
           0o666
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.231.1">
           autoClose
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.232.1">
         When
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.233.1">
          autoClose
         </span>
        </strong>
        <span class="koboSpan" id="kobo.234.1">
         is set to
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.235.1">
          true
         </span>
        </strong>
        <span class="koboSpan" id="kobo.236.1">
         , the file descriptor will be closed automatically.
        </span>
        <span class="koboSpan" id="kobo.236.2">
         When
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.237.1">
          false
         </span>
        </strong>
        <span class="koboSpan" id="kobo.238.1">
         , the file descriptor will need to be
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.239.1">
          closed manually.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.240.1">
           true
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.241.1">
           emitClose
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.242.1">
         Controls whether the stream emits a
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.243.1">
          close
         </span>
        </strong>
        <span class="koboSpan" id="kobo.244.1">
         event after it has
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.245.1">
          been destroyed.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.246.1">
           false
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.247.1">
           start
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.248.1">
         Can be used to specify, as an integer, the position to start
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.249.1">
          writing data.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.250.1">
          0
         </span>
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.251.1">
           fs
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.252.1">
         Used to override
        </span>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.253.1">
           fs
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.254.1">
          implementations.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.255.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.256.1">
           signal
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.257.1">
         Used to specify an
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.258.1">
          AbortSignal
         </span>
        </strong>
        <span class="koboSpan" id="kobo.259.1">
         object to programmatically cancel the writing of
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.260.1">
          the stream.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.261.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.262.1">
           highWaterMark
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.263.1">
         Used to specify the maximum number of bytes that can be buffered before backpressure
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.264.1">
          is applied.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.265.1">
           16384
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.266.1">
     Table 3.1 – The configurations that can be passed to the createWriteStream() method
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.267.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.268.1">
     For more information on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.269.1">
      File System
     </span>
    </strong>
    <span class="koboSpan" id="kobo.270.1">
     flags, please refer
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.271.1">
      to
     </span>
    </span>
    <a href="https://nodejs.org/api/fs.html#fs_file_system_flags">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.272.1">
       https://nodejs.org/api/fs.html#fs_file_system_flags
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.274.1">
     Then, we created a readable stream to
    </span>
    <a id="_idIndexMarker118">
    </a>
    <span class="koboSpan" id="kobo.275.1">
     read the contents of our file sequentially.
    </span>
    <span class="koboSpan" id="kobo.275.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.276.1">
      createReadStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.277.1">
     method is
    </span>
    <a id="_idIndexMarker119">
    </a>
    <span class="koboSpan" id="kobo.278.1">
     an abstraction of a readable stream.
    </span>
    <span class="koboSpan" id="kobo.278.2">
     Again, this method expects two parameters – the first being the path to the contents to read, and the second being an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.279.1">
      options
     </span>
    </strong>
    <span class="koboSpan" id="kobo.280.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.280.2">
     The following table details the options we can pass to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.281.1">
      createReadStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.282.1">
     method via an
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.283.1">
       options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.284.1">
      object:
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table002">
    <colgroup>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.285.1">
           Option
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.286.1">
           Description
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.287.1">
           Default Value
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.288.1">
           flags
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.289.1">
         Defines
        </span>
        <strong class="bold">
         <span class="koboSpan" id="kobo.290.1">
          File
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.291.1">
           System
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.292.1">
          flags.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.293.1">
          r
         </span>
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.294.1">
           encoding
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.295.1">
         The encoding of
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.296.1">
          the file.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.297.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.298.1">
           fd
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.299.1">
         The
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.300.1">
          fd
         </span>
        </strong>
        <span class="koboSpan" id="kobo.301.1">
         value is expected to be a file descriptor.
        </span>
        <span class="koboSpan" id="kobo.301.2">
         When this value is supplied, the
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.302.1">
          path
         </span>
        </strong>
        <span class="koboSpan" id="kobo.303.1">
         argument will
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.304.1">
          be ignored.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.305.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.306.1">
           mode
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.307.1">
         Sets the file permissions, but only when the file
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.308.1">
          is created.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.309.1">
           0o666
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.310.1">
           autoClose
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.311.1">
         When
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.312.1">
          autoClose
         </span>
        </strong>
        <span class="koboSpan" id="kobo.313.1">
         is set to
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.314.1">
          true
         </span>
        </strong>
        <span class="koboSpan" id="kobo.315.1">
         , the file descriptor will be closed automatically.
        </span>
        <span class="koboSpan" id="kobo.315.2">
         When
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.316.1">
          false
         </span>
        </strong>
        <span class="koboSpan" id="kobo.317.1">
         , the file descriptor will need to be
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.318.1">
          closed manually.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.319.1">
           true
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.320.1">
           emitClose
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.321.1">
         Controls whether the stream emits a
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.322.1">
          close
         </span>
        </strong>
        <span class="koboSpan" id="kobo.323.1">
         event after it has
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.324.1">
          been destroyed.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.325.1">
           false
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.326.1">
           start
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.327.1">
         Can be used to specify, as an integer, which position to start
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.328.1">
          reading data.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.329.1">
          0
         </span>
        </strong>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.330.1">
           end
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.331.1">
         Can be used to specify, as an integer, the position to stop
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.332.1">
          reading data.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.333.1">
           Infinity
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.334.1">
           highWaterMark
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.335.1">
         Dictates the maximum number of bytes that are stored in the internal buffer before the stream stops reading
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.336.1">
          the input.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.337.1">
          64 KiB
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.338.1">
           fs
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.339.1">
         Used to override
        </span>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.340.1">
           fs
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.341.1">
          implementations.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.342.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.343.1">
           signal
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.344.1">
         Used to specify an
        </span>
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.345.1">
          AbortSignal
         </span>
        </strong>
        <span class="koboSpan" id="kobo.346.1">
         object to programmatically cancel the reading of
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.347.1">
          the stream.
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="source-inline">
          <span class="koboSpan" id="kobo.348.1">
           null
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.349.1">
     Table 3.2 – The configurations that can be passed to the createReadStream() method
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.350.1">
     In
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.351.1">
      read-stream.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.352.1">
     , we
    </span>
    <a id="_idIndexMarker120">
    </a>
    <span class="koboSpan" id="kobo.353.1">
     registered a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.354.1">
      data
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     event handler that executed each time our
    </span>
    <a id="_idIndexMarker121">
    </a>
    <span class="koboSpan" id="kobo.356.1">
     readable stream read a chunk of data.
    </span>
    <span class="koboSpan" id="kobo.356.2">
     We could see the individual chunks’ outputs on the screen as they
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.357.1">
      were read:
     </span>
    </span>
   </p>
   <pre class="console"><span class="koboSpan" id="kobo.358.1">
Read chunk: &lt;Buffer 20 62 75 69 6c 74 20 6f 6e 20 47 6f 6f 67 6c 65 20 43 68 72 6f 6d 65 27 73 20 56 38 20 4a 61 76 61 53 63 72 69 70 74 20 65 6e 67 69 6e 65 2e 0a 4e 6f ... </span><span class="koboSpan" id="kobo.358.2">29149 more bytes&gt;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.359.1">
     Once all the file data was read, our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.360.1">
      end
     </span>
    </strong>
    <span class="koboSpan" id="kobo.361.1">
     event handler triggered – resulting in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.362.1">
      No more
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.363.1">
       data
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.364.1">
      message.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.365.1">
     All Node.js streams are instances
    </span>
    <a id="_idIndexMarker122">
    </a>
    <span class="koboSpan" id="kobo.366.1">
     of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.367.1">
      EventEmitter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.368.1">
     class (
    </span>
    <a href="https://nodejs.org/api/events.html#events_class_eventemitter">
     <span class="koboSpan" id="kobo.369.1">
      https://nodejs.org/api/events.html#events_class_eventemitter
     </span>
    </a>
    <span class="koboSpan" id="kobo.370.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.370.2">
     Streams emit a series of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      different events.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.372.1">
     The following events are
    </span>
    <a id="_idIndexMarker123">
    </a>
    <span class="koboSpan" id="kobo.373.1">
     emitted on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.374.1">
      readable streams:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.375.1">
       close
      </span>
     </strong>
     <span class="koboSpan" id="kobo.376.1">
      : Emitted when the stream and any of the stream’s resources have been closed.
     </span>
     <span class="koboSpan" id="kobo.376.2">
      No further events will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.377.1">
       be emitted.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.378.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.379.1">
      : Emitted when new data is read from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.380.1">
       the stream.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.381.1">
       end
      </span>
     </strong>
     <span class="koboSpan" id="kobo.382.1">
      : Emitted when all available data has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.383.1">
       been read.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.384.1">
       error
      </span>
     </strong>
     <span class="koboSpan" id="kobo.385.1">
      : Emitted when the readable stream experiences
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.386.1">
       an error.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.387.1">
       pause
      </span>
     </strong>
     <span class="koboSpan" id="kobo.388.1">
      : Emitted when the readable stream
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.389.1">
       is paused.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.390.1">
       readable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.391.1">
      : Emitted when there is data available to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.392.1">
       be read.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.393.1">
       resume
      </span>
     </strong>
     <span class="koboSpan" id="kobo.394.1">
      : Emitted when a readable stream resumes after being in a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.395.1">
       paused state.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.396.1">
     The following events are emitted on
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.397.1">
      writable streams:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.398.1">
       close
      </span>
     </strong>
     <span class="koboSpan" id="kobo.399.1">
      : Emitted when the stream and any of its resources have been closed.
     </span>
     <span class="koboSpan" id="kobo.399.2">
      No further events will
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.400.1">
       be emitted.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.401.1">
       drain
      </span>
     </strong>
     <span class="koboSpan" id="kobo.402.1">
      : Emitted when the writable stream can resume
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.403.1">
       writing data.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.404.1">
       error
      </span>
     </strong>
     <span class="koboSpan" id="kobo.405.1">
      : Emitted when the writeable stream experiences
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.406.1">
       an error.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.407.1">
       finish
      </span>
     </strong>
     <span class="koboSpan" id="kobo.408.1">
      : Emitted when the writeable stream has ended, and all writes have
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.409.1">
       been completed.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.410.1">
       pipe
      </span>
     </strong>
     <span class="koboSpan" id="kobo.411.1">
      : Emitted when the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.412.1">
       stream.pipe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.413.1">
      method is called on a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.414.1">
       readable stream.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.415.1">
       unpipe
      </span>
     </strong>
     <span class="koboSpan" id="kobo.416.1">
      : Emitted when the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.417.1">
       stream.unpipe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.418.1">
      method is called on a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.419.1">
       readable stream.
      </span>
     </span>
    </li>
   </ul>
   <h2 id="_idParaDest-76">
    <a id="_idTextAnchor075">
    </a>
    <span class="koboSpan" id="kobo.420.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.421.1">
     Let’s dive deeper into readable
    </span>
    <a id="_idIndexMarker124">
    </a>
    <span class="koboSpan" id="kobo.422.1">
     streams, including how to read from infinite data
    </span>
    <a id="_idIndexMarker125">
    </a>
    <span class="koboSpan" id="kobo.423.1">
     sources.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     We’ll also learn how to use the more modern asynchronous iterator syntax with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.424.1">
      readable streams.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.425.1">
     Interacting with infinite data
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.426.1">
     Streams make it possible to interact
    </span>
    <a id="_idIndexMarker126">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     with infinite amounts of data.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     Let’s write a script that will process data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.428.1">
      sequentially, indefinitely:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.429.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.430.1">
       learning-streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.431.1">
      directory, create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.432.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.433.1">
        infinite-read.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.434.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.435.1">$ touch infinite-read.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.436.1">
      We need an infinite data source.
     </span>
     <span class="koboSpan" id="kobo.436.2">
      We will use the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.437.1">
       /dev/urandom
      </span>
     </strong>
     <span class="koboSpan" id="kobo.438.1">
      file, which is available on Unix-like operating systems.
     </span>
     <span class="koboSpan" id="kobo.438.2">
      This file is a pseudo-random number generator.
     </span>
     <span class="koboSpan" id="kobo.438.3">
      Add the following to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.439.1">
       infinite-read.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.440.1">
      to calculate the ongoing size
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.441.1">
       of
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.442.1">
        /dev/urandom
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.443.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.444.1">
const fs = require('node:fs');
const rs = fs.createReadStream('/dev/urandom');
let size = 0;
rs.on('data', (data) =&gt; {
  size += data.length;
  console.log('File size:', size);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.445.1">
      Run the script with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.446.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.447.1">$ node infinite-read.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.448.1">
       Expect to see an output
      </span>
      <a id="_idIndexMarker127">
      </a>
      <span class="koboSpan" id="kobo.449.1">
       similar to the following, showing the ever-growing size of the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.450.1">
        /
       </span>
      </strong>
      <span class="No-Break">
       <strong class="source-inline">
        <span class="koboSpan" id="kobo.451.1">
         dev/urandom
        </span>
       </strong>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.452.1">
        file:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer017">
     <span class="koboSpan" id="kobo.453.1">
      <img alt="Figure 3.3 – Output showing the ever-growing size of /dev/urandom" src="image/B19212_03_03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.454.1">
     Figure 3.3 – Output showing the ever-growing size of /dev/urandom
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.455.1">
     This example demonstrates how we can use streams to process infinite amounts
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.456.1">
      of data.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.457.1">
     Readable streams with async iterators
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.458.1">
     Readable streams are
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.459.1">
      asynchronous iterables
     </span>
    </strong>
    <span class="koboSpan" id="kobo.460.1">
     .
    </span>
    <span class="koboSpan" id="kobo.460.2">
     This means
    </span>
    <a id="_idIndexMarker128">
    </a>
    <span class="koboSpan" id="kobo.461.1">
     we can use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.462.1">
      for await...of
     </span>
    </strong>
    <span class="koboSpan" id="kobo.463.1">
     syntax to
    </span>
    <a id="_idIndexMarker129">
    </a>
    <span class="koboSpan" id="kobo.464.1">
     loop over the stream data.
    </span>
    <span class="koboSpan" id="kobo.464.2">
     In the following steps, we will implement the same functionality as in the main recipe but using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.465.1">
      for
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.466.1">
       await...of
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.467.1">
      syntax:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.468.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.469.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.470.1">
        for-await-read-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.471.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.472.1">$ touch for-await-read-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.473.1">
      To implement the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.474.1">
       read-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.475.1">
      logic from this recipe using asynchronous iterables, use
     </span>
     <a id="_idIndexMarker130">
     </a>
     <span class="koboSpan" id="kobo.476.1">
      the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.477.1">
       following code:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.478.1">
const fs = require('node:fs');
const rs = fs.createReadStream('./file.txt');
async function run () {
  for await (const chunk of rs) {
    console.log('Read chunk:', chunk.toString());
  }
  console.log('No more data.');
}
run();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.479.1">
      Run the file with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.480.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.481.1">$ node for-await-read-stream.js</span></strong></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.482.1">
     For more information on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.483.1">
      for await...of
     </span>
    </strong>
    <span class="koboSpan" id="kobo.484.1">
     syntax, please refer to the MDN web
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.485.1">
      docs (
     </span>
    </span>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.486.1">
       https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.487.1">
      ).
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.488.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.489.1">
     Generally, developers should opt to use one of the Node.js streams API styles as using a combination of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.490.1">
      on('data')
     </span>
    </strong>
    <span class="koboSpan" id="kobo.491.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.492.1">
      on('readable')
     </span>
    </strong>
    <span class="koboSpan" id="kobo.493.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.494.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.495.1">
     , and/or async iterators could lead to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.496.1">
      unclear behavior.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.497.1">
     Generating readable streams with Readable.from()
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.498.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.499.1">
      Readable.from()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.500.1">
     method is exposed by the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.501.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.502.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.502.2">
     This method is used to construct readable
    </span>
    <a id="_idIndexMarker131">
    </a>
    <span class="koboSpan" id="kobo.503.1">
     streams with iterators.
    </span>
    <span class="koboSpan" id="kobo.503.2">
     Let’s
    </span>
    <a id="_idIndexMarker132">
    </a>
    <span class="koboSpan" id="kobo.504.1">
     take a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.505.1">
      closer look:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.506.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.507.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.508.1">
        async-generator.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.509.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.510.1">$ touch async-generator.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.511.1">
      Import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.512.1">
       Readable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.513.1">
      class from the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.514.1">
        stream
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.515.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.516.1">
const { Readable } = require('node:stream');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.517.1">
      Define the asynchronous generator function.
     </span>
     <span class="koboSpan" id="kobo.517.2">
      This will form the content of our
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.518.1">
       readable stream:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.519.1">
async function * generate () {
  yield 'Node.js';
  yield 'is';
  yield 'a';
  yield 'JavaScript';
  yield 'Runtime';
}</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.520.1">
       Note the use of the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.521.1">
        function*
       </span>
      </strong>
      <span class="koboSpan" id="kobo.522.1">
       syntax.
      </span>
      <span class="koboSpan" id="kobo.522.2">
       This syntax defines a generator function.
      </span>
      <span class="koboSpan" id="kobo.522.3">
       For more details on generator syntax, please refer to the MDN web
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.523.1">
        docs (
       </span>
      </span>
      <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*">
       <span class="No-Break">
        <span class="koboSpan" id="kobo.524.1">
         https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*
        </span>
       </span>
      </a>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.525.1">
        ).
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.526.1">
      Create the readable stream using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.527.1">
       Readable.from()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.528.1">
      method, passing the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.529.1">
       generate()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.530.1">
      function as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.531.1">
       the argument:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.532.1">
const readable = Readable.from(generate());</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.533.1">
      To output the content of our readable stream, register a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.534.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      event handler that prints
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.536.1">
       the chunks:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.537.1">
readable.on('data', (chunk) =&gt; {
  console.log(chunk);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.538.1">
      Run the program
     </span>
     <a id="_idIndexMarker133">
     </a>
     <span class="koboSpan" id="kobo.539.1">
      by entering the following command in
     </span>
     <a id="_idIndexMarker134">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.540.1">
       your terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.541.1">$ node async-generator.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.542.1">
       Expect to see the following generated values
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.543.1">
        as output:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.544.1">Node.js
is
a
JavaScript
Runtime</span></pre>
    </li>
   </ol>
   <h2 id="_idParaDest-77">
    <a id="_idTextAnchor076">
    </a>
    <span class="koboSpan" id="kobo.545.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <a href="B19212_02.xhtml#_idTextAnchor041">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.546.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <span class="koboSpan" id="kobo.547.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.548.1">
       Interacting with paused streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.549.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.550.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.551.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.552.1">
       Piping streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.553.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.554.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.555.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.556.1">
       Creating transform streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.557.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.558.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.559.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.560.1">
       Building stream pipelines
      </span>
     </em>
     <span class="koboSpan" id="kobo.561.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.562.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-78">
    <a id="_idTextAnchor077">
    </a>
    <span class="koboSpan" id="kobo.563.1">
     Interacting with paused streams
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.564.1">
     A Node.js stream can be in either flowing or paused mode.
    </span>
    <span class="koboSpan" id="kobo.564.2">
     In flowing mode, data chunks are read automatically, whereas in paused mode, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.565.1">
      stream.read()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.566.1">
     method must be called to read the chunks
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.567.1">
      of data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.568.1">
     In this recipe, we’ll learn how to
    </span>
    <a id="_idIndexMarker135">
    </a>
    <span class="koboSpan" id="kobo.569.1">
     interact with a readable stream that is in paused mode, which is its default
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.570.1">
      upon creation.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-79">
    <a id="_idTextAnchor078">
    </a>
    <span class="koboSpan" id="kobo.571.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.572.1">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.573.1">
      learning-streams
     </span>
    </strong>
    <span class="koboSpan" id="kobo.574.1">
     directory that we created in the previous recipe, create the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.575.1">
      following file:
     </span>
    </span>
   </p>
   <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.576.1">$ touch paused-stream.js</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.577.1">
     We’re now ready to start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.578.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-80">
    <a id="_idTextAnchor079">
    </a>
    <span class="koboSpan" id="kobo.579.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.580.1">
     In this recipe, we’ll learn how to interact with a readable stream that is in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.581.1">
      paused mode:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.582.1">
      First, import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.583.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.584.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.585.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.586.1">
        paused-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.587.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.588.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.589.1">
      Next, create a readable stream to read the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.590.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.591.1">
      file using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.592.1">
        createReadStream()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.593.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.594.1">
const rs = fs.createReadStream('./file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.595.1">
      Next, we need to register a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.596.1">
       readable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.597.1">
      event handler on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.598.1">
       readable stream:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.599.1">
rs.on('readable', () =&gt; {
  // Read data
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.600.1">
      Now, we can add the manual logic to read the data chunks within our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.601.1">
       readable
      </span>
     </strong>
     <span class="koboSpan" id="kobo.602.1">
      handler.
     </span>
     <span class="koboSpan" id="kobo.602.2">
      Add the following logic to read the data, until there is no data left
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.603.1">
       to consume:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.604.1">
  // Read data
  let data = rs.read();
  while (data !== null) {
    console.log('Read chunk:', data.toString());
    data = rs.read();
  }</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.605.1">
      Now, we can register an
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.606.1">
       end
      </span>
     </strong>
     <span class="koboSpan" id="kobo.607.1">
      event handler for our readable stream that will print a message
     </span>
     <a id="_idIndexMarker136">
     </a>
     <span class="koboSpan" id="kobo.608.1">
      stating
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.609.1">
       No more data.
      </span>
     </strong>
     <span class="koboSpan" id="kobo.610.1">
      once all the data has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.611.1">
       been read:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.612.1">
rs.on('end', () =&gt; {
  console.log('No more data.');
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.613.1">
      Run the script with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.614.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.615.1">$ node paused-stream.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.616.1">
       Expect to see the following output, indicating that the chunks of the readable stream are
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.617.1">
        being read:
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer018">
     <span class="koboSpan" id="kobo.618.1">
      <img alt="Figure 3.4 – Overview of the readable stream chunks as they are being read" src="image/B19212_03_04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.619.1">
     Figure 3.4 – Overview of the readable stream chunks as they are being read
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.620.1">
     With that, we’ve learned
    </span>
    <a id="_idIndexMarker137">
    </a>
    <span class="koboSpan" id="kobo.621.1">
     how to interact with a readable stream in paused mode.
    </span>
    <span class="koboSpan" id="kobo.621.2">
     We did this by listening for the readable event and manually calling the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.622.1">
       read()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.623.1">
      method.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-81">
    <a id="_idTextAnchor080">
    </a>
    <span class="koboSpan" id="kobo.624.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     In this recipe, we learned how to interact with a readable stream that was in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.626.1">
      paused mode.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.627.1">
     By default, a readable stream is in paused mode.
    </span>
    <span class="koboSpan" id="kobo.627.2">
     However, a readable stream will switch to flowing mode in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.628.1">
      following instances:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.629.1">
      When a
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.630.1">
       data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.631.1">
      event handler
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.632.1">
       is registered
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.633.1">
      When the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.634.1">
       pipe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.635.1">
      method
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.636.1">
       is called
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.637.1">
      When the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.638.1">
       resume()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.639.1">
      method
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.640.1">
       is called
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.641.1">
     Since our program in this recipe did none of these, our stream remained in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.642.1">
      paused mode.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.643.1">
     If a readable stream was in flowing mode, it would switch back to paused mode in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.644.1">
      following instances:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.645.1">
      When the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.646.1">
       pause()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.647.1">
      method is called and there are no
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.648.1">
       pipe destinations
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.649.1">
      When the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.650.1">
       unpipe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.651.1">
      method is called on all
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.652.1">
       pipe destinations
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.653.1">
     We added a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.654.1">
      readable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.655.1">
     event handler to our readable stream.
    </span>
    <span class="koboSpan" id="kobo.655.2">
     If the readable stream was already in flowing mode, a readable event handler being registered would stop the stream from flowing (it’s switched to
    </span>
    <a id="_idIndexMarker138">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.656.1">
      paused mode).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.657.1">
     When the readable stream is in paused mode, it is necessary to manually call the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.658.1">
      readableStream.read()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.659.1">
     method to consume the stream data.
    </span>
    <span class="koboSpan" id="kobo.659.2">
     In this recipe, we added logic within our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.660.1">
      readable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.661.1">
     event handler that continued to read the stream data until the data value was
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.662.1">
      null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.663.1">
     .
    </span>
    <span class="koboSpan" id="kobo.663.2">
     The data value being
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.664.1">
      null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.665.1">
     indicates that the stream has ended (all currently available data has been read).
    </span>
    <span class="koboSpan" id="kobo.665.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.666.1">
      readable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.667.1">
     event can be emitted multiple times, indicating that more data has
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.668.1">
      become available.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.669.1">
     When a stream is in paused mode, we can have more control over when the data is being read.
    </span>
    <span class="koboSpan" id="kobo.669.2">
     Essentially, we’re pulling the data from the stream, rather than it being
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.670.1">
      pushed automatically.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.671.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.672.1">
     Generally, if possible, it’s worthwhile using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.673.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.674.1">
     method to handle the consumption data of a readable stream as memory management is handled automatically.
    </span>
    <span class="koboSpan" id="kobo.674.2">
     The following recipe,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.675.1">
      Piping streams
     </span>
    </em>
    <span class="koboSpan" id="kobo.676.1">
     , will go into more detail about the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.677.1">
       pipe()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.678.1">
      method.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-82">
    <a id="_idTextAnchor081">
    </a>
    <span class="koboSpan" id="kobo.679.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <a href="B19212_02.xhtml#_idTextAnchor041">
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.680.1">
         Chapter 2
        </span>
       </em>
      </span>
     </a>
    </li>
    <li>
     <span class="koboSpan" id="kobo.681.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.682.1">
       Creating readable and writable streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.683.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.684.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.685.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.686.1">
       Piping streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.687.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.688.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.689.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.690.1">
       Creating transform streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.691.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.692.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.693.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.694.1">
       Building stream pipelines
      </span>
     </em>
     <span class="koboSpan" id="kobo.695.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.696.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-83">
    <a id="_idTextAnchor082">
    </a>
    <span class="koboSpan" id="kobo.697.1">
     Piping streams
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.698.1">
     A pipe is a form of one-way redirection.
    </span>
    <span class="koboSpan" id="kobo.698.2">
     In our terminal (DOS or Unix-like), we often utilize the pipe operator (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.699.1">
      |
     </span>
    </strong>
    <span class="koboSpan" id="kobo.700.1">
     ) to pipe the
    </span>
    <a id="_idIndexMarker139">
    </a>
    <span class="koboSpan" id="kobo.701.1">
     output of one program as the input to another program.
    </span>
    <span class="koboSpan" id="kobo.701.2">
     For example, we can enter
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.702.1">
      $ ls | head -3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.703.1">
     to pipe the output of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.704.1">
      ls
     </span>
    </strong>
    <span class="koboSpan" id="kobo.705.1">
     command to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.706.1">
      head -3
     </span>
    </strong>
    <span class="koboSpan" id="kobo.707.1">
     command, resulting in the first three files in our directory
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.708.1">
      being returned.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.709.1">
     Like how we can use the pipe operator in our shells to pipe output between programs, we can use the Node.js
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.710.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.711.1">
     method to pipe data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.712.1">
      between streams.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.713.1">
     In this recipe, we’ll learn how
    </span>
    <a id="_idIndexMarker140">
    </a>
    <span class="koboSpan" id="kobo.714.1">
     to use the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.715.1">
       pipe()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.716.1">
      method.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-84">
    <a id="_idTextAnchor083">
    </a>
    <span class="koboSpan" id="kobo.717.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.718.1">
     Follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.719.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.720.1">
      Create a directory to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.721.1">
       work in:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.722.1">$ mkdir piping-streams</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.723.1">$ cd piping-streams</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.724.1">
      Start by creating a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.725.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.726.1">
        file.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.727.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.728.1">$ touch file.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.729.1">
      Add some dummy data to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.730.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.731.1">
      , such as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.732.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.733.1">
Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.733.2">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.733.3">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.734.1">
     Now, we’re ready to start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.735.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-85">
    <a id="_idTextAnchor084">
    </a>
    <span class="koboSpan" id="kobo.736.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.737.1">
     In this recipe, we’ll learn how to pipe a readable stream to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.738.1">
      writable stream:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.739.1">
      Create a file
     </span>
     <a id="_idIndexMarker141">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.740.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.741.1">
        pipe-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.742.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.743.1">$ touch pipe-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.744.1">
      Next, start the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.745.1">
       pipe-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.746.1">
      file by
     </span>
     <a id="_idIndexMarker142">
     </a>
     <span class="koboSpan" id="kobo.747.1">
      importing the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.748.1">
        fs
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.749.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.750.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.751.1">
      Create a readable stream to read
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.752.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.753.1">
      using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.754.1">
        createReadStream()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.755.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.756.1">
const rs = fs.createReadStream('file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.757.1">
      Now, we need to pipe our readable stream to
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.758.1">
       process.stdout
      </span>
     </strong>
     <span class="koboSpan" id="kobo.759.1">
      , which returns a writable stream connected
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.760.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.761.1">
        STDOUT
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.762.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.763.1">
rs.pipe(process.stdout);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.764.1">
      Run the program with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.765.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.766.1">$ node pipe-stream.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.767.1">
       Expect to see the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.768.1">
        following output:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.769.1">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.769.2">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.769.3">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.770.1">
     With that, we’ve piped a readable stream to a writeable stream using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.771.1">
       pipe()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.772.1">
      method.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-86">
    <a id="_idTextAnchor085">
    </a>
    <span class="koboSpan" id="kobo.773.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.774.1">
     In this recipe, we created a readable stream to read our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      file.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     file using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.777.1">
      createReadStream()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.778.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.778.2">
     Then, we
    </span>
    <a id="_idIndexMarker143">
    </a>
    <span class="koboSpan" id="kobo.779.1">
     piped the output of this readable stream to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.780.1">
      process.stdout
     </span>
    </strong>
    <span class="koboSpan" id="kobo.781.1">
     (a writable
    </span>
    <a id="_idIndexMarker144">
    </a>
    <span class="koboSpan" id="kobo.782.1">
     stream) using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.783.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.784.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.784.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.785.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.786.1">
     method attaches a data event handler to the source stream, which writes the incoming data to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.787.1">
      destination stream.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.788.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.789.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.790.1">
     method is used to direct data through a flow of streams.
    </span>
    <span class="koboSpan" id="kobo.790.2">
     Under the hood, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.791.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.792.1">
     method manages the flow of data to ensure that the destination writable stream is not overwhelmed by a faster
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.793.1">
      readable stream.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.794.1">
     The in-built management provided by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.795.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.796.1">
     method helps resolve the issue of backpressure.
    </span>
    <span class="koboSpan" id="kobo.796.2">
     Backpressure occurs when an input overwhelms a system’s capacity.
    </span>
    <span class="koboSpan" id="kobo.796.3">
     For streams, this could occur when we’re consuming a stream that is rapidly reading data, and the writable stream can’t keep up.
    </span>
    <span class="koboSpan" id="kobo.796.4">
     This can result in a large amount of memory being kept in a process before being written by the writable stream.
    </span>
    <span class="koboSpan" id="kobo.796.5">
     The mass amount of data being stored in memory can degrade our Node.js process performance, or in the worst cases, cause the process
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.797.1">
      to crash.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.798.1">
     By default, when using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.799.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.800.1">
     method,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.801.1">
      stream.end()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.802.1">
     is called on the destination writable stream when the source readable stream emits an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.803.1">
      end
     </span>
    </strong>
    <span class="koboSpan" id="kobo.804.1">
     event.
    </span>
    <span class="koboSpan" id="kobo.804.2">
     This means that the destination is no
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.805.1">
      longer writable.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.806.1">
     To disable this default behavior, we can supply
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.807.1">
      { end: false }
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.809.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.810.1">
     method via an
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.811.1">
       options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.812.1">
      argument:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.813.1">
sourceStream.pipe(destinationStream, {end: false});</span></pre>
   <p>
    <span class="koboSpan" id="kobo.814.1">
     This configuration instructs the destination stream to remain open even after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.815.1">
      end
     </span>
    </strong>
    <span class="koboSpan" id="kobo.816.1">
     event has been emitted by the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.817.1">
      source stream.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-87">
    <a id="_idTextAnchor086">
    </a>
    <span class="koboSpan" id="kobo.818.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.819.1">
     Stream chaining in Node.js allows for efficient data processing by linking together multiple streams.
    </span>
    <span class="koboSpan" id="kobo.819.2">
     This method enables data transformations with minimal memory overhead, which is ideal for operations such as compression.
    </span>
    <span class="koboSpan" id="kobo.819.3">
     In the following example, we’ll demonstrate the process of reading a file, compressing its contents, and writing the compressed data to a new file to highlight the use of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.820.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.821.1">
     for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.822.1">
      chaining streams:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.823.1">
const fs = require('node:fs');
const zlib = require('node:zlib');
const readStream = fs.createReadStream('input.txt');
const writeStream = fs.createWriteStream('output.txt.gz');
// Chain the streams: read -&gt; compress -&gt; write
readStream.pipe(zlib.createGzip()).pipe(writeStream);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.824.1">
     In this example,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.825.1">
      readStream.pipe(zlib.createGzip()).pipe(writeStream);
     </span>
    </strong>
    <span class="koboSpan" id="kobo.826.1">
     reads data from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.827.1">
      input.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.828.1">
     , compresses
    </span>
    <a id="_idIndexMarker145">
    </a>
    <span class="koboSpan" id="kobo.829.1">
     it on-the-fly, and writes the compressed data to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.830.1">
      output.txt.gz
     </span>
    </strong>
    <span class="koboSpan" id="kobo.831.1">
     .
    </span>
    <span class="koboSpan" id="kobo.831.2">
     This chain
    </span>
    <a id="_idIndexMarker146">
    </a>
    <span class="koboSpan" id="kobo.832.1">
     of operations is executed with efficiency, showcasing the elegance and power of stream chaining in Node.js for data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.833.1">
      processing tasks.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.834.1">
     In the example provided, error handling is not explicitly shown, but it’s crucial in a real-world application.
    </span>
    <span class="koboSpan" id="kobo.834.2">
     In Node.js, when chaining streams, errors can be propagated through the chain.
    </span>
    <span class="koboSpan" id="kobo.834.3">
     When using
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.835.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.836.1">
     , errors should be listened for on each stream by attaching an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.837.1">
      error
     </span>
    </strong>
    <span class="koboSpan" id="kobo.838.1">
     event listener to each stream involved.
    </span>
    <span class="koboSpan" id="kobo.838.2">
     This ensures that errors are caught and managed where
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.839.1">
      they occur.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-88">
    <a id="_idTextAnchor087">
    </a>
    <span class="koboSpan" id="kobo.840.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.841.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.842.1">
       Creating readable and writable streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.843.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.844.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.845.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.846.1">
       Creating transform streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.847.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.848.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.849.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.850.1">
       Building stream pipelines
      </span>
     </em>
     <span class="koboSpan" id="kobo.851.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.852.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-89">
    <a id="_idTextAnchor088">
    </a>
    <span class="koboSpan" id="kobo.853.1">
     Creating transform streams
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.854.1">
     Transform streams allow us to
    </span>
    <a id="_idIndexMarker147">
    </a>
    <span class="koboSpan" id="kobo.855.1">
     consume input data, process that data, and then output the data in its processed form.
    </span>
    <span class="koboSpan" id="kobo.855.2">
     We can use transform streams to handle data manipulation functionally and asynchronously.
    </span>
    <span class="koboSpan" id="kobo.855.3">
     It’s possible to pipe many transform streams together, allowing us to break complex processing down into
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.856.1">
      sequential tasks.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.857.1">
     In this recipe, we’re going to create a transform stream using the Node.js core
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.858.1">
       stream
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.859.1">
      module.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.860.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.861.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.862.1">
      through2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.863.1">
     module (
    </span>
    <a href="https://www.npmjs.com/package/through2">
     <span class="koboSpan" id="kobo.864.1">
      https://www.npmjs.com/package/through2
     </span>
    </a>
    <span class="koboSpan" id="kobo.865.1">
     ) is very popular and provides a wrapper for creating Node.js transform
    </span>
    <a id="_idIndexMarker148">
    </a>
    <span class="koboSpan" id="kobo.866.1">
     streams.
    </span>
    <span class="koboSpan" id="kobo.866.2">
     However, over the past few years, there have been many simplifications and improvements to the Node.js core stream implementation.
    </span>
    <span class="koboSpan" id="kobo.866.3">
     Today, the Node.js stream API provides simplified construction, as demonstrated in this recipe, which means we can achieve equivalent syntax using Node.js core directly, without the need
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.867.1">
      for
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.868.1">
       through2
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.869.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-90">
    <a id="_idTextAnchor089">
    </a>
    <span class="koboSpan" id="kobo.870.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.871.1">
     Follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.872.1">
      these
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker149">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.873.1">
      steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.874.1">
      Create a directory to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.875.1">
       work in:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.876.1">$ mkdir transform-streams</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.877.1">$ cd transform-streams</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.878.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.879.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.880.1">
        transform-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.881.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.882.1">$ touch transform-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.883.1">
      We’ll also need some sample data to transform.
     </span>
     <span class="koboSpan" id="kobo.883.2">
      So, create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.884.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.885.1">
        file.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.886.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.887.1">$ touch file.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.888.1">
      Add some dummy text data to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.889.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.890.1">
      file, such as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.891.1">
       the following:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.892.1">
Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.892.2">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.892.3">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.893.1">
     Now, we’re ready to start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.894.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-91">
    <a id="_idTextAnchor090">
    </a>
    <span class="koboSpan" id="kobo.895.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.896.1">
     In this recipe, we’ll learn how to create a transform stream using the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.897.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.898.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.898.2">
     The transform
    </span>
    <a id="_idIndexMarker150">
    </a>
    <span class="koboSpan" id="kobo.899.1">
     stream we will create will convert all the text from our file
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.900.1">
      into uppercase:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.901.1">
      Start by importing the Node.js core
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.902.1">
       File system
      </span>
     </strong>
     <span class="koboSpan" id="kobo.903.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.904.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.905.1">
        transform-stream.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.906.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.907.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.908.1">
      Next, we need to import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.909.1">
       Transform
      </span>
     </strong>
     <span class="koboSpan" id="kobo.910.1">
      class from the Node.js core
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.911.1">
        stream
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.912.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.913.1">
const { Transform } = require('node:stream');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.914.1">
      Create a readable stream to read the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.915.1">
        file.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.916.1">
       file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.917.1">
const rs = fs.createReadStream('./file.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.918.1">
      Once our file content has been processed by our transform stream, we will write it to a new file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.919.1">
       newFile.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.920.1">
      .
     </span>
     <span class="koboSpan" id="kobo.920.2">
      Create a writable stream to write this file using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.921.1">
        createWriteStream()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.922.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.923.1">
const newFile = fs.createWriteStream('./newFile.txt');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.924.1">
      Next, we need to define our transform stream.
     </span>
     <span class="koboSpan" id="kobo.924.2">
      We’ll name our transform
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.925.1">
       stream
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.926.1">
        uppercase()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.927.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.928.1">
const uppercase = new Transform({
  transform (chunk, encoding, callback) {
    // Data processing
  }
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.929.1">
      Now, within our transform stream, we will add the logic to transform the chunk into an uppercase string.
     </span>
     <span class="koboSpan" id="kobo.929.2">
      Below the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.930.1">
       // Data processing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.931.1">
      comment, add the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.932.1">
       following line:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.933.1">
    callback(null, chunk.toString().toUpperCase());</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.934.1">
       This calls the transform
      </span>
      <a id="_idIndexMarker151">
      </a>
      <span class="koboSpan" id="kobo.935.1">
       stream callback function with the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.936.1">
        transformed chunk.
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.937.1">
      At this point, we need to chain all our streams together.
     </span>
     <span class="koboSpan" id="kobo.937.2">
      We will do this using the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.938.1">
       pipe()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.939.1">
      method.
     </span>
     <span class="koboSpan" id="kobo.939.2">
      Add the following line to the bottom of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.940.1">
       the file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.941.1">
rs.pipe(uppercase).pipe(newFile);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.942.1">
      Enter the following command in your terminal to run
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.943.1">
       the program:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.944.1">$ node transform-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.945.1">
      Expect
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.946.1">
       newFile.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.947.1">
      to have been created by our program.
     </span>
     <span class="koboSpan" id="kobo.947.2">
      You can confirm this by running the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.948.1">
       cat
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      command, followed by the new file’s name, in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.950.1">
       the terminal:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.951.1">$ cat newFile.txt</span></strong><span class="koboSpan" id="kobo.952.1">
NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.
</span><span class="koboSpan" id="kobo.952.2">NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.
</span><span class="koboSpan" id="kobo.952.3">NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.953.1">
       Note that the contents are now in uppercase, indicating that the data has passed through the
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.954.1">
        transform stream.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.955.1">
     With that, we’ve learned how to create a transform stream to manipulate data.
    </span>
    <span class="koboSpan" id="kobo.955.2">
     Our transform stream converted the input data into uppercase strings.
    </span>
    <span class="koboSpan" id="kobo.955.3">
     After, we piped our readable stream to the transform stream and piped the transform stream to our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.956.1">
      writable stream.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-92">
    <a id="_idTextAnchor091">
    </a>
    <span class="koboSpan" id="kobo.957.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.958.1">
     Transform streams are duplex streams, which means they implement both readable and writable stream interfaces.
    </span>
    <span class="koboSpan" id="kobo.958.2">
     Transform streams are used to process (or transform) the input and then pass it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.959.1">
      as output.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.960.1">
     To create a transform stream, we
    </span>
    <a id="_idIndexMarker152">
    </a>
    <span class="koboSpan" id="kobo.961.1">
     must import the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.962.1">
      Transform
     </span>
    </strong>
    <span class="koboSpan" id="kobo.963.1">
     class from the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.964.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.965.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.965.2">
     The transform stream constructor accepts the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.966.1">
      two arguments:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.967.1">
       transform
      </span>
     </strong>
     <span class="koboSpan" id="kobo.968.1">
      : The function that implements the data
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.969.1">
       processing/transformation logic.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.970.1">
       flush
      </span>
     </strong>
     <span class="koboSpan" id="kobo.971.1">
      : If the transform process emits additional data, the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.972.1">
       flush
      </span>
     </strong>
     <span class="koboSpan" id="kobo.973.1">
      method is used to flush the data.
     </span>
     <span class="koboSpan" id="kobo.973.2">
      This argument
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.974.1">
       is optional.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.975.1">
     It is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.976.1">
      transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.977.1">
     function that processes the stream input and produces the output.
    </span>
    <span class="koboSpan" id="kobo.977.2">
     Note that it is not necessary for the number of chunks that are supplied via the input stream to be equal to the number output by the transform stream – some chunks could be omitted during
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.978.1">
      the transformation/processing.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.979.1">
     Under the hood, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.980.1">
      transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.981.1">
     function gets attached to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.982.1">
      _transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.983.1">
     method of the transform stream.
    </span>
    <span class="koboSpan" id="kobo.983.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.984.1">
      _transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.985.1">
     method is an internal method on the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.986.1">
      Transform
     </span>
    </strong>
    <span class="koboSpan" id="kobo.987.1">
     class that is not intended to be called directly (hence the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.988.1">
      underscore prefix).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.989.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.990.1">
      _transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.991.1">
     method accepts the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.992.1">
      three arguments:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.993.1">
       chunk
      </span>
     </strong>
     <span class="koboSpan" id="kobo.994.1">
      : The data to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.995.1">
       be transformed.
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.996.1">
       encoding
      </span>
     </strong>
     <span class="koboSpan" id="kobo.997.1">
      : If the input is of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.998.1">
       String
      </span>
     </strong>
     <span class="koboSpan" id="kobo.999.1">
      type, the encoding will be of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1000.1">
       String
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1001.1">
      type.
     </span>
     <span class="koboSpan" id="kobo.1001.2">
      If it is of the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1002.1">
       Buffer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1003.1">
      type, this value is set
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1004.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1005.1">
        buffer
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1006.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1007.1">
       callback(err, transformedChunk)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1008.1">
      : The callback function to be called once the chunk has been processed.
     </span>
     <span class="koboSpan" id="kobo.1008.2">
      The callback function is expected to have two arguments – the first an error and the second the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1009.1">
       transformed chunk.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1010.1">
     In this recipe, our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1011.1">
      transform()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1012.1">
     function called the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1013.1">
      callback()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1014.1">
     function with our processed data (where our processed data was
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1015.1">
      chunk.toString().toUpperCase()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1016.1">
     to convert the input into an
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1017.1">
      uppercase string).
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1018.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1019.1">
     Node.js comes with some built-in transform streams.
    </span>
    <span class="koboSpan" id="kobo.1019.2">
     Both the Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1020.1">
      crypto
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1021.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1022.1">
      zlib
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1023.1">
     modules expose transform streams.
    </span>
    <span class="koboSpan" id="kobo.1023.2">
     As an example, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1024.1">
      zlib.createGzip()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1025.1">
     method is a transform stream that’s exposed by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1026.1">
      zlib
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1027.1">
     module that compresses the file that’s been piped
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1028.1">
      to it.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-93">
    <a id="_idTextAnchor092">
    </a>
    <span class="koboSpan" id="kobo.1029.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1030.1">
     In this section, we’ll learn how
    </span>
    <a id="_idIndexMarker153">
    </a>
    <span class="koboSpan" id="kobo.1031.1">
     to create transform streams in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1032.1">
      ECMAScript 6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1033.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1034.1">
      ES6
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1035.1">
     ) syntax and
    </span>
    <a id="_idIndexMarker154">
    </a>
    <span class="koboSpan" id="kobo.1036.1">
     how we can create an object mode
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1037.1">
      transform stream.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1038.1">
     Adopting ES6 syntax
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1039.1">
     In this recipe, we implemented a
    </span>
    <a id="_idIndexMarker155">
    </a>
    <span class="koboSpan" id="kobo.1040.1">
     transform stream using the simplified constructor approach.
    </span>
    <span class="koboSpan" id="kobo.1040.2">
     It is also possible to implement these using the
    </span>
    <a id="_idIndexMarker156">
    </a>
    <span class="koboSpan" id="kobo.1041.1">
     ES6 class syntax.
    </span>
    <span class="koboSpan" id="kobo.1041.2">
     The following steps will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1042.1">
      demonstrate this:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1043.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1044.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1045.1">
        transform-stream-es6.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1046.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1047.1">$ touch transform-stream-es6.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1048.1">
      The transform stream from this recipe can be implemented
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1049.1">
       as follows:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1050.1">
const fs = require('node:fs');
const { Transform } = require('node:stream');
const rs = fs.createReadStream('./file.txt');
const newFile = fs.createWriteStream('./newFile.txt');
class Uppercase extends Transform {
  _transform (chunk, encoding, callback) {
    this.push(chunk.toString().toUpperCase());
    callback();
  }
}
rs.pipe(new Uppercase()).pipe(newFile);</span></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1051.1">
       With this code, it is clearer that we’re overriding the
      </span>
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1052.1">
        _transform()
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1053.1">
       method with our
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1054.1">
        transformation logic.
       </span>
      </span>
     </p>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1055.1">
     This example uses ES6
    </span>
    <a id="_idIndexMarker157">
    </a>
    <span class="koboSpan" id="kobo.1056.1">
     syntax to create a custom transform stream that reads from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1057.1">
      file.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1058.1">
     , converts the content into uppercase, and writes it to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1059.1">
      newFile.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1060.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1060.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1061.1">
      Uppercase
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1062.1">
     class, extending the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1063.1">
      Transform
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1064.1">
     class, overrides the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1065.1">
      _transform
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1066.1">
     method to process data chunks, converting them into
    </span>
    <a id="_idIndexMarker158">
    </a>
    <span class="koboSpan" id="kobo.1067.1">
     uppercase with
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1068.1">
      chunk.toString().toUpperCase()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1069.1">
     before pushing them to the write stream.
    </span>
    <span class="koboSpan" id="kobo.1069.2">
     The callback function,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1070.1">
      callback()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1071.1">
     , is invoked to indicate the completion of the current chunk’s processing, allowing the stream to handle the next chunk and maintain a regulated flow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1072.1">
      of data.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1073.1">
     Creating object mode transform streams
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1074.1">
     By default, Node.js streams operate on
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1075.1">
      String
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1076.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1077.1">
      Buffer
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1078.1">
     , or
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1079.1">
      Uint8Array
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1080.1">
     objects.
    </span>
    <span class="koboSpan" id="kobo.1080.2">
     However, it is also possible
    </span>
    <a id="_idIndexMarker159">
    </a>
    <span class="koboSpan" id="kobo.1081.1">
     to work with Node.js streams in
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1082.1">
      object mode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1083.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1083.2">
     This allows us to work with other JavaScript values (except the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1084.1">
      null
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1085.1">
     value).
    </span>
    <span class="koboSpan" id="kobo.1085.2">
     In object mode, the values that are returned
    </span>
    <a id="_idIndexMarker160">
    </a>
    <span class="koboSpan" id="kobo.1086.1">
     from the stream are generic JavaScript objects.
    </span>
    <span class="koboSpan" id="kobo.1086.2">
     An example use case for object mode streaming could be implementing an application that queries a database for a large set of user records and then processes each user
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1087.1">
      record individually.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1088.1">
     The main difference with object mode is that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1089.1">
      highWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1090.1">
     value refers to the number of objects, rather than bytes.
    </span>
    <span class="koboSpan" id="kobo.1090.2">
     In previous recipes, we learned that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1091.1">
      highWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1092.1">
     value dictates the maximum number of bytes that are stored in the internal buffer before the stream stops reading the input.
    </span>
    <span class="koboSpan" id="kobo.1092.2">
     For object mode streams, this value is set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1093.1">
      16
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1094.1">
     – meaning 16 objects are buffered at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1095.1">
      a time.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1096.1">
     To set a stream in object mode, we must pass
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1097.1">
      { objectMode: true }
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1098.1">
     via the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1099.1">
       options
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1100.1">
      object.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1101.1">
     Let’s demonstrate how to create
    </span>
    <a id="_idIndexMarker161">
    </a>
    <span class="koboSpan" id="kobo.1102.1">
     a transform stream in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1103.1">
      object mode:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1104.1">
      Let’s create a folder called
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1105.1">
       object-streams
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1106.1">
      containing a file named
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1107.1">
       object-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1108.1">
      and initialize the project
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1109.1">
       with
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1110.1">
        npm
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1111.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1112.1">$ mkdir object-streams</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1113.1">$ cd object-streams</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1114.1">$ npm init --yes</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1115.1">$ touch object-stream.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1116.1">
      Install the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1117.1">
        ndjson
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1118.1">
       module:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1119.1">$ npm install ndjson</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1120.1">
      In
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1121.1">
       object-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1122.1">
      , import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1123.1">
       Transform
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1124.1">
      class from the Node.js core
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1125.1">
        stream
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1126.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1127.1">
const { Transform } = require('node:stream');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1128.1">
      Next, import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1129.1">
       stringify()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1130.1">
      method
     </span>
     <a id="_idIndexMarker162">
     </a>
     <span class="koboSpan" id="kobo.1131.1">
      from the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1132.1">
        ndjson
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1133.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1134.1">
const { stringify } = require('ndjson');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1135.1">
      Create the transform stream, specifying
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1136.1">
       { objectMode:
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1137.1">
        true }
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1138.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1139.1">
const Name = Transform({
  objectMode: true,
  transform: ({ forename, surname }, encoding,
    callback) =&gt; {
      callback(null, { name: forename + ' ' + surname
    });
  }
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1140.1">
      Now, we can create our chain of streams.
     </span>
     <span class="koboSpan" id="kobo.1140.2">
      We will pipe the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1141.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1142.1">
      transform stream to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1143.1">
       stringify()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1144.1">
      method (from
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1145.1">
       ndjson
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1146.1">
      ), and then pipe the result
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1147.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1148.1">
        process.stdout
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1149.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1150.1">
Name.pipe(stringify()).pipe(process.stdout);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1151.1">
      Finally, still in
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1152.1">
       object-stream.js
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1153.1">
      , we’ll write some data to the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1154.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1155.1">
      transform stream
     </span>
     <a id="_idIndexMarker163">
     </a>
     <span class="koboSpan" id="kobo.1156.1">
      using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1157.1">
        write()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1158.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1159.1">
Name.write({ forename: 'John', surname: 'Doe' });
Name.write({ forename: 'Jane', surname: 'Doe' });</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1160.1">
      Run the program
     </span>
     <a id="_idIndexMarker164">
     </a>
     <span class="koboSpan" id="kobo.1161.1">
      with the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1162.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1163.1">$ node object-stream.js</span></strong></pre>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1164.1">
       This will output
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1165.1">
        the following:
       </span>
      </span>
     </p>
     <pre class="source-code"><span class="koboSpan" id="kobo.1166.1">{"name":"John Doe"}
{"name":"Jane Doe"}</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1167.1">
     In this example, we created a transform stream called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1168.1">
      Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1169.1">
     that aggregates the value of two JSON properties (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1170.1">
      forename
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1171.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1172.1">
      surname
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1173.1">
     ) and returns a new property (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1174.1">
      name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1175.1">
     ) with the aggregated value.
    </span>
    <span class="koboSpan" id="kobo.1175.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1176.1">
      Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1177.1">
     transform stream is in object mode and both reads and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1178.1">
      writes objects.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1179.1">
     We pipe our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1180.1">
      Name
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1181.1">
     transform stream to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1182.1">
      stringify()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1183.1">
     function provided by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1184.1">
      ndjson
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1185.1">
     module.
    </span>
    <span class="koboSpan" id="kobo.1185.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1186.1">
      stringify()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1187.1">
     function converts the streamed JSON objects into newline-delimited JSON.
    </span>
    <span class="koboSpan" id="kobo.1187.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1188.1">
      stringify()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1189.1">
     stream is a transform stream where the writable side is in object mode, but the readable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1190.1">
      side isn’t.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1191.1">
     With transform streams (and
    </span>
    <a id="_idIndexMarker165">
    </a>
    <span class="koboSpan" id="kobo.1192.1">
     duplex streams), you can independently specify whether the readable or writable side of the stream is in object mode by supplying the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1193.1">
      configuration options:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1194.1">
       readableObjectMode
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1195.1">
      : When
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1196.1">
       true
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1197.1">
      , the readable side of the duplex stream is in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1198.1">
       object mode
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1199.1">
       writableObjectMode
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1200.1">
      : When
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1201.1">
       true
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1202.1">
      , the writable side of the duplex stream is in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1203.1">
       object mode
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1204.1">
     Note that it is also possible to set different
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1205.1">
      highWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1206.1">
     values for the readable or writable side of a duplex
    </span>
    <a id="_idIndexMarker166">
    </a>
    <span class="koboSpan" id="kobo.1207.1">
     stream using the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1208.1">
      configuration options:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1209.1">
       readableHighWaterMark
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1210.1">
      : Configures the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1211.1">
       highWaterMark
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1212.1">
      value for the readable side of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1213.1">
       the stream
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1214.1">
       writableHighWaterMark
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1215.1">
      : Configures the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1216.1">
       highWaterMark
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1217.1">
      value for the writable side of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1218.1">
       the stream
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1219.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1220.1">
      readableHighWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1221.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1222.1">
      writableHighWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1223.1">
     configuration values have no effect if a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1224.1">
      highWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1225.1">
     value is supplied because the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1226.1">
      highWaterMark
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1227.1">
     value
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1228.1">
      takes precedence.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1229.1">
     Using map and filter functions
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1230.1">
     More recent versions of Node.js, later than version 16.4.0, provide
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1231.1">
      Experimental
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1232.1">
     array-like methods fo
    </span>
    <a id="_idIndexMarker167">
    </a>
    <span class="koboSpan" id="kobo.1233.1">
     r readable streams.
    </span>
    <span class="koboSpan" id="kobo.1233.2">
     These methods can be used similarly to the array methods – for example, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1234.1">
      Readable.map()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1235.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1236.1">
      Readable.filter()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1237.1">
     methods provide similar functionality to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1238.1">
      Array.prototype.map()
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1239.1">
      and
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1240.1">
       Array.prototype.filter()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1241.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1242.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1243.1">
      map()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1244.1">
     method can be used to
    </span>
    <a id="_idIndexMarker168">
    </a>
    <span class="koboSpan" id="kobo.1245.1">
     map over the stream.
    </span>
    <span class="koboSpan" id="kobo.1245.2">
     For every chunk in the stream, the specified function will be called.
    </span>
    <span class="koboSpan" id="kobo.1245.3">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1246.1">
      transform stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1247.1">
     we created in
    </span>
    <a id="_idIndexMarker169">
    </a>
    <span class="koboSpan" id="kobo.1248.1">
     this recipe could be rewritten using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1249.1">
      map()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1250.1">
     method
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1251.1">
      as follows:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1252.1">
const fs = require('node:fs');
const rs = fs.createReadStream('./file.txt');
const newFile = fs.createWriteStream('./newFile.txt');
</span><strong class="bold"><span class="koboSpan" id="kobo.1253.1">rs.map((chunk) =&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1254.1">  chunk.toString().toUpperCase()).pipe(newFile);</span></strong></pre>
   <p>
    <span class="koboSpan" id="kobo.1255.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1256.1">
      Readable.filter()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1257.1">
     method can be used to filter a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1258.1">
      readable stream:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1259.1">
const { Readable } = require('node:stream');
async function* generate() {
    yield 'Java';
    yield 'JavaScript';
    yield 'Rust';
}
// Filter the stream for words with 5 or more characters
Readable.from(generate()).filter((word) =&gt; word.length &gt;=
  5).pipe(process.stdout);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1260.1">
     These are two recent
    </span>
    <a id="_idIndexMarker170">
    </a>
    <span class="koboSpan" id="kobo.1261.1">
     function additions that provide array-like methods on readable streams.
    </span>
    <span class="koboSpan" id="kobo.1261.2">
     Many more array-like methods are now available
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1262.1">
      on streams:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1263.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1264.1">
        drop()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1265.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1266.1">
        every()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1267.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1268.1">
        filter()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1269.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1270.1">
        find()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1271.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1272.1">
        flatMap()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1273.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1274.1">
        forEach()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1275.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1276.1">
        map()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1277.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1278.1">
        reduce()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1279.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1280.1">
        some()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1281.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1282.1">
        take()
       </span>
      </strong>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1283.1">
       .
      </span>
     </strong>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1284.1">
        toArray()
       </span>
      </strong>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1285.1">
     More information, including the usage and parameters of these methods, can be found in the Node.js Stream API
    </span>
    <a id="_idIndexMarker171">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1286.1">
      documentation:
     </span>
    </span>
    <a href="https://nodejs.org/docs/latest-v22.x/api/stream.html">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1287.1">
       https://nodejs.org/docs/latest-v22.x/api/stream.html
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1288.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1289.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1290.1">
     At the time of writing, the array-like stream methods are designated with an
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.1291.1">
       Experimental
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1292.1">
      status.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-94">
    <a id="_idTextAnchor093">
    </a>
    <span class="koboSpan" id="kobo.1293.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1294.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1295.1">
       Creating readable and writable streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1296.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1297.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1298.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1299.1">
       Piping streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1300.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1301.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1302.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1303.1">
       Building stream pipelines
      </span>
     </em>
     <span class="koboSpan" id="kobo.1304.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1305.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-95">
    <a id="_idTextAnchor094">
    </a>
    <span class="koboSpan" id="kobo.1306.1">
     Building stream pipelines
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1307.1">
     The Node.js core
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1308.1">
      stream
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1309.1">
     module provides a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1310.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1311.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.1311.2">
     Similar to how we can use the Node.js core stream
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1312.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1313.1">
     method to pipe one stream to another, we can also use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1314.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1315.1">
     method to chain multiple
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1316.1">
      streams together.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1317.1">
     Unlike the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1318.1">
      pipe()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1319.1">
     method, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1320.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1321.1">
     method also forwards errors, making it easier to handle errors in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1322.1">
      stream’s flow.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1323.1">
     This recipe builds upon
    </span>
    <a id="_idIndexMarker172">
    </a>
    <span class="koboSpan" id="kobo.1324.1">
     many of the stream concepts that were covered in the other recipes in this chapter.
    </span>
    <span class="koboSpan" id="kobo.1324.2">
     Here, we’ll create a stream pipeline using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1325.1">
       pipeline()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1326.1">
      method.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-96">
    <a id="_idTextAnchor095">
    </a>
    <span class="koboSpan" id="kobo.1327.1">
     Getting ready
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1328.1">
     Before diving into this recipe, let’s set up our workspace by creating a directory
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1329.1">
      and files:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1330.1">
      First, create a directory to work in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1331.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1332.1">
        stream-pipelines
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1333.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1334.1">$ mkdir stream-pipelines</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1335.1">$ cd stream-pipelines</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1336.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1337.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1338.1">
        pipeline.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1339.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1340.1">$ touch pipeline.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1341.1">
      We’ll also need
     </span>
     <a id="_idIndexMarker173">
     </a>
     <span class="koboSpan" id="kobo.1342.1">
      some sample data to transform.
     </span>
     <span class="koboSpan" id="kobo.1342.2">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1343.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1344.1">
        file.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1345.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1346.1">$ touch file.txt</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1347.1">
      Add some dummy text data to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1348.1">
        file.txt
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1349.1">
       file:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1350.1">
Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.1350.2">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.
</span><span class="koboSpan" id="kobo.1350.3">Node.js is a JavaScript runtime built on Google Chrome's V8 JavaScript engine.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1351.1">
     Now, we’re ready to start
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1352.1">
      this recipe.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-97">
    <a id="_idTextAnchor096">
    </a>
    <span class="koboSpan" id="kobo.1353.1">
     How to do it…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1354.1">
     In this recipe, we’ll create a stream pipeline using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1355.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1356.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.1356.2">
     Our pipeline will read the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1357.1">
      file.txt
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1358.1">
     file, convert the file’s contents into uppercase using a transform stream, and then write the new contents to a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1359.1">
      new file:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1360.1">
      Start by importing the Node.js core
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1361.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1362.1">
      module
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1363.1">
       into
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1364.1">
        pipeline.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1365.1">
       :
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1366.1">
const fs = require('node:fs');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1367.1">
      Next, we need to import the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1368.1">
       pipeline()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1369.1">
      method and the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1370.1">
       Transform
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1371.1">
      class from the Node.js core
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1372.1">
        stream
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1373.1">
       module:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1374.1">
const { pipeline, Transform } = require('node:stream');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1375.1">
      Next, we’ll create our transform stream (refer to the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1376.1">
       Creating transform streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1377.1">
      recipe in this chapter for more information on transform streams).
     </span>
     <span class="koboSpan" id="kobo.1377.2">
      This will convert the input into
     </span>
     <a id="_idIndexMarker174">
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1378.1">
       uppercase strings:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1379.1">
const uppercase = new Transform({
  transform (chunk, encoding, callback) {
    // Data processing
    callback(null, chunk.toString().toUpperCase());
  }
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1380.1">
      Now, we can start to create the stream pipeline.
     </span>
     <span class="koboSpan" id="kobo.1380.2">
      First, let’s call the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1381.1">
        pipeline()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1382.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1383.1">
pipeline();</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1384.1">
      The
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1385.1">
       pipeline()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1386.1">
      method expects the first argument to be a readable stream.
     </span>
     <span class="koboSpan" id="kobo.1386.2">
      Our first argument will be a readable stream that will read the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1387.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1388.1">
      file, using the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1389.1">
        createReadStream()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1390.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1391.1">
pipeline(
</span><strong class="bold"><span class="koboSpan" id="kobo.1392.1">  fs.createReadStream('./file.txt')</span></strong><span class="koboSpan" id="kobo.1393.1">
);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1394.1">
      Next, we need to add our transform stream as the second argument to the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1395.1">
        pipeline()
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1396.1">
       method:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1397.1">
pipeline(
  fs.createReadStream('./file.txt'),
</span><strong class="bold"><span class="koboSpan" id="kobo.1398.1">  uppercase,</span></strong><span class="koboSpan" id="kobo.1399.1">
);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1400.1">
      Then, we can add our writable stream to write the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1401.1">
       newFile.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1402.1">
      file to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1403.1">
       the pipeline:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1404.1">
pipeline(
  fs.createReadStream('./file.txt'),
  uppercase,
</span><strong class="bold"><span class="koboSpan" id="kobo.1405.1">  fs.createWriteStream('./newFile.txt'),</span></strong><span class="koboSpan" id="kobo.1406.1">
);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1407.1">
      Finally, the last argument to our pipeline is a callback function that will execute once the pipeline has
     </span>
     <a id="_idIndexMarker175">
     </a>
     <span class="koboSpan" id="kobo.1408.1">
      finished running.
     </span>
     <span class="koboSpan" id="kobo.1408.2">
      This callback function will handle any errors in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1409.1">
       our pipeline:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1410.1">
pipeline(
  fs.createReadStream('./file.txt'),
  uppercase,
  fs.createWriteStream('./newFile.txt'),
  </span><strong class="bold"><span class="koboSpan" id="kobo.1411.1">(err) =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1412.1">    if (err) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1413.1">      console.error('Pipeline failed.', err);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1414.1">    } else {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1415.1">      console.log('Pipeline succeeded.');</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1416.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1417.1">  }</span></strong><span class="koboSpan" id="kobo.1418.1">
);</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1419.1">
      In your terminal, run the program with the following command.
     </span>
     <span class="koboSpan" id="kobo.1419.2">
      You should expect to see a message stating
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1420.1">
        Pipeline succeeded.
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1421.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1422.1">$ node pipeline.js</span></strong><span class="koboSpan" id="kobo.1423.1">
Pipeline succeeded.</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1424.1">
      To confirm that the stream pipeline was successful, verify that the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1425.1">
       newFile.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1426.1">
      file
     </span>
     <a id="_idIndexMarker176">
     </a>
     <span class="koboSpan" id="kobo.1427.1">
      contains the contents of
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1428.1">
       file.txt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1429.1">
      , but
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1430.1">
       in uppercase:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1431.1">$ cat newFile.txt</span></strong><span class="koboSpan" id="kobo.1432.1">
NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.
</span><span class="koboSpan" id="kobo.1432.2">NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.
</span><span class="koboSpan" id="kobo.1432.3">NODE.JS IS A JAVASCRIPT RUNTIME BUILT ON GOOGLE CHROME'S V8 JAVASCRIPT ENGINE.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1433.1">
     With that, we’ve created a stream pipeline using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1434.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1435.1">
     method that’s exposed by the Node.js core
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1436.1">
       stream
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1437.1">
      module.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-98">
    <a id="_idTextAnchor097">
    </a>
    <span class="koboSpan" id="kobo.1438.1">
     How it works…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1439.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1440.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1441.1">
     method allows us to pipe streams to one another – forming a flow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1442.1">
      of streams.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1443.1">
     We can pass the following arguments to the stream’s
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1444.1">
       pipeline()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1445.1">
      method:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1446.1">
       source
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1447.1">
      : A source stream from which to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1448.1">
       read data
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1449.1">
       ...transforms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1450.1">
      : Any number of transform streams to process data (
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1451.1">
       including
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1452.1">
        0
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1453.1">
       )
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1454.1">
       destination
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1455.1">
      : A destination stream to write the processed
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1456.1">
       data to
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1457.1">
       callback
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1458.1">
      : The function to be called when the pipeline
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1459.1">
       is complete
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1460.1">
     We pass the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1461.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1462.1">
     method to our series of streams, in the order they need to run, followed by using a callback function that executes once the pipeline
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1463.1">
      is complete.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1464.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1465.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1466.1">
     method elegantly forwards errors that occur in the streams onto the callback.
    </span>
    <span class="koboSpan" id="kobo.1466.2">
     This is one of the benefits of using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1467.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1468.1">
     method over the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1469.1">
       pipe()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1470.1">
      method.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1471.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1472.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1473.1">
     method also cleans up any unterminated streams by
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1474.1">
      calling
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1475.1">
       stream.destroy()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1476.1">
      .
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-99">
    <a id="_idTextAnchor098">
    </a>
    <span class="koboSpan" id="kobo.1477.1">
     There’s more…
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1478.1">
     In Node.js version 15 and later, there
    </span>
    <a id="_idIndexMarker177">
    </a>
    <span class="koboSpan" id="kobo.1479.1">
     is a suite of asynchronous utility functions for streams that utilize
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1480.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1481.1">
     objects instead of callbacks.
    </span>
    <span class="koboSpan" id="kobo.1481.2">
     These functions can be found in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1482.1">
      stream/promises
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1483.1">
     core module.
    </span>
    <span class="koboSpan" id="kobo.1483.2">
     This module includes versions of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1484.1">
      stream.pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1485.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1486.1">
      stream.finished()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1487.1">
     that are compatible with promises, providing a more modern and promise-friendly approach to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1488.1">
      stream handling.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1489.1">
     Let’s convert the stream pipeline from the main recipe so that it uses the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1490.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1491.1">
     version
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1492.1">
      of
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1493.1">
       stream.pipeline()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1494.1">
      :
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1495.1">
      Create a file
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1496.1">
       named
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1497.1">
        promise-pipeline.js
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1498.1">
       :
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1499.1">$ touch promise-pipeline.js</span></strong></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1500.1">
      Add the following to import the Node.js core
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1501.1">
       fs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1502.1">
      and
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1503.1">
        stream/promises
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1504.1">
       modules:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1505.1">
const fs = require('node:fs');
const { Transform } = require('node:stream');
const { pipeline } = require('node:stream/promises');</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1506.1">
      Add the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1507.1">
       transform stream:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1508.1">
const uppercase = new Transform({
  transform(chunk, encoding, callback) {
    // Data processing
    callback(null, chunk.toString().toUpperCase());
  },
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1509.1">
      Since we’ll be awaiting
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1510.1">
       pipeline()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1511.1">
      , we’ll need to wrap the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1512.1">
       pipeline()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1513.1">
      logic in an
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1514.1">
       asynchronous function:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1515.1">
async function run() {
  await pipeline(
    fs.createReadStream('./file.txt'),
    uppercase,
    fs.createWriteStream('./newFile.txt')
  );
  console.log('Pipeline succeeded.');
}</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1516.1">
      Finally, we can call our
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1517.1">
       run()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1518.1">
      function, catching
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1519.1">
       any errors:
      </span>
     </span>
     <pre class="source-code"><span class="koboSpan" id="kobo.1520.1">
run().catch((err) =&gt; {
  console.error('Pipeline failed.', err);
});</span></pre>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1521.1">
      Run the program by
     </span>
     <a id="_idIndexMarker178">
     </a>
     <span class="koboSpan" id="kobo.1522.1">
      using the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1523.1">
       following command:
      </span>
     </span>
     <pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.1524.1">$ node promise-pipeline.js</span></strong><span class="koboSpan" id="kobo.1525.1">
Pipeline Succeeded.</span></pre>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1526.1">
     With that, we’ve demonstrated how to use the stream
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1527.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1528.1">
     method with Promises by using the Streams
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1529.1">
      Promises API.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.1530.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.1531.1">
     Previously, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1532.1">
      pipeline()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1533.1">
     method may have been converted into
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1534.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1535.1">
     form using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1536.1">
      util.promisify()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1537.1">
     utility method.
    </span>
    <span class="koboSpan" id="kobo.1537.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1538.1">
      util.promisify()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1539.1">
     method is used to convert a callback-style method
    </span>
    <a id="_idIndexMarker179">
    </a>
    <span class="koboSpan" id="kobo.1540.1">
     into
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1541.1">
      Promise
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1542.1">
     form.
    </span>
    <span class="koboSpan" id="kobo.1542.2">
     The Streams Promises API replaces the need to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1543.1">
      use this.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-100">
    <a id="_idTextAnchor099">
    </a>
    <span class="koboSpan" id="kobo.1544.1">
     See also
    </span>
   </h2>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1545.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1546.1">
       Creating readable and writable streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1547.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1548.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1549.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1550.1">
       Piping streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1551.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1552.1">
       this chapter
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1553.1">
      The
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1554.1">
       Creating transform streams
      </span>
     </em>
     <span class="koboSpan" id="kobo.1555.1">
      recipe of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1556.1">
       this chapter
      </span>
     </span>
    </li>
   </ul>
  </div>
 </body></html>