<html><head></head><body>


<h1 class="chap2"><a id="page215" class="calibre6"/><a href="toc.xhtml#c06" class="calibre6">C<small class="calibre8">HAPTER</small> 6</a></h1>
<h1 class="subchap"><a href="toc.xhtml#c06" class="calibre6">REST API for Project and Task Modules</a></h1>

<h1 class="sec" id="s172"><a href="toc.xhtml#s172a" class="calibre6">Introduction</a></h1>
<p class="nonindent">In project management systems (PMS), a “<em class="calibre4">project module</em>” typically refers to a specific component or core module. These modules are designed to streamline various aspects of project planning, execution, and monitoring, making it easier for project managers and teams to manage complex projects efficiently.</p>
<p class="nonindent">Each project module typically focuses on a specific area, such as task management, resource allocation, time tracking, or reporting, providing dedicated tools and features to support those functions. These modules are an essential part of PMS, enabling users to customize their project management approach based on the specific needs of their projects. The task module plays a crucial role in project management by providing a centralized and organized approach for managing and executing tasks within a project. It enhances collaboration, improves visibility into task progress, and helps ensure that projects are completed on time and within scope.</p>
<h1 class="sec" id="s173"><a href="toc.xhtml#s173a" class="calibre6">Structure</a></h1>
<p class="nonindent">In this chapter, we will discuss the following topics:</p>
<ul class="bull">
<li class="calibre9">Project Management with Input Validation
<ul class="bull1">
<li class="calibre9">Project Creation API with Assigned User</li>
<li class="calibre9">Project Update, List, Details of Project, and Delete APIs</li></ul></li>
<li class="calibre9">Task Management with Input Validation
<ul class="bull1">
<li class="calibre9">Task Creation API with Assigned User to Task</li>
<li class="calibre9">Task Update, List, Details of Task, and Delete APIs</li></ul></li>
</ul>
<h1 class="sec" id="s174"><a href="toc.xhtml#s174a" class="calibre6">Project Management</a></h1>
<p class="nonindent">The project module serves as a centralized platform that empowers project managers <a id="page216"/>and teams to efficiently plan, execute, and complete projects while maintaining control, transparency, and collaboration.</p>
<h1 class="sec" id="s175"><a href="toc.xhtml#s175a" class="calibre6">Project Service</a></h1>
<p class="nonindent">We have previously defined the entity for the project in <em class="calibre4"><a href="c04.xhtml">Chapter 4, Planning the App</a></em>, so let’s start by first creating the Project Service as <code class="calibre7"><strong class="calibre3">projects_service.ts</strong></code> in the project directory with the following code:</p>
<p class="code"><code class="calibre7">import { Repository } from 'typeorm';</code></p>
<p class="code1"><code class="calibre7">import { BaseService } from '../../utils/base_service';</code></p>
<p class="code1"><code class="calibre7">import { DatabaseUtil } from '../../utils/db';</code></p>
<p class="code1"><code class="calibre7">import { Projects } from './projects_entity';</code></p>
<p class="code"><code class="calibre7">export class ProjectsService extends BaseService&lt;Projects&gt; {</code></p>
<p class="code2a"><code class="calibre7">constructor() {</code></p>
<p class="code3"><code class="calibre7">let projectRepository: Repository&lt;Projects&gt; | null = null;</code></p>
<p class="code3"><code class="calibre7">projectRepository = new DatabaseUtil().getRepository(Projects);</code></p>
<p class="code3"><code class="calibre7">super(projectRepository);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">The <code class="calibre7"><strong class="calibre3">`ProjectsService`</strong></code> class extends a <code class="calibre7"><strong class="calibre3">BaseService</strong></code> and uses TypeORM to work with the Projects entity in the database. The repository for this entity is obtained from the <code class="calibre7"><strong class="calibre3">DatabaseUtil</strong></code> class. The service is structured to facilitate database operations on the <code class="calibre7"><strong class="calibre3">Projects</strong></code> entity, such as creating, retrieving, updating, and deleting records.</p>
<p class="nonindent">We will develop the REST API for the project as follows:</p>
<ul class="bull">
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Add</strong></code> Project</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">GetAll</strong></code> Project</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">GetOne</strong></code> Project</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Update</strong></code> Project</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Delete</strong></code> Project</li>
</ul>
<h1 class="sec" id="s176"><a href="toc.xhtml#s176a" class="calibre6">Input Validation</a></h1>
<p class="nonindent">Input validation in a project module plays a critical role in ensuring the integrity and reliability of data used within a project management system. It involves examining and verifying user inputs or data received from various sources to ensure that it adheres to predefined criteria and meets the required standards.</p>
<p class="nonindent"><a id="page217"/>Add the following function, <code class="calibre7"><strong class="calibre3">checkValidDate</strong></code>, in the <code class="calibre7"><strong class="calibre3">common.ts</strong></code> file in the utils directory to validate a date:</p>
<p class="code"><code class="calibre7">export const <strong class="calibre3">checkValidDate</strong> = function (value) {</code></p>
<p class="code2"><code class="calibre7">if (!moment(value, 'YYYY-MM-DD HH:mm:ss', true).isValid()) {</code></p>
<p class="code3"><code class="calibre7">return false;</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">return true;</code></p>
<p class="code1"><code class="calibre7">};</code></p>
<p class="nonindent">Now, add <code class="calibre7"><strong class="calibre3">validProjectInput</strong></code> in the <code class="calibre7"><strong class="calibre3">projects_routes.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7">import { Express } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { ProjectController } from './projects_controller';</code></p>
<p class="code1"><code class="calibre7">import { body } from 'express-validator';</code></p>
<p class="code1"><code class="calibre7">import { validate } from '../../utils/validator';</code></p>
<p class="code1"><code class="calibre7">import moment from 'moment';</code></p>
<p class="code1"><code class="calibre7">import { authorize } from '../../utils/auth_util';</code></p>
<p class="code1"><code class="calibre7">import { checkValidDate } from '../../utils/common'</code></p>
<p class="code"><code class="calibre7">const <strong class="calibre3">validProjectInput</strong> = [</code></p>
<p class="code2"><code class="calibre7">body('name').trim().notEmpty().withMessage('It should be required'),</code></p>
<p class="code2"><code class="calibre7">body('user_ids').isArray().withMessage('It should be ids of users array'),</code></p>
<p class="code2"><code class="calibre7">body('start_time').custom((value) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!<strong class="calibre3">checkValidDate</strong>(value)) {</code></p>
<p class="code4"><code class="calibre7"><a id="page218"/>throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(value);</code></p>
<p class="code3"><code class="calibre7">const currentTime = new Date();</code></p>
<p class="code3a"><code class="calibre7">if (startTime &lt;= currentTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Start time must be greater than the current time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">}),</code></p>
<p class="code2"><code class="calibre7">body('end_time').custom((value, { req }) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!<strong class="calibre3">checkValidDate</strong>(value)) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(req.body.start_time);</code></p>
<p class="code3"><code class="calibre7">const endTime = new Date(value);</code></p>
<p class="code3a"><code class="calibre7">if (endTime &lt;= startTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('End time must be greater than the start time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">})</code></p>
<p class="code1"><code class="calibre7">];</code></p>
<p class="nonindent">Here are the details of the key parts of the preceding code:</p>
<ul class="bull">
<li class="calibre9"><code class="calibre7"><strong class="calibre3">validProjectInput</strong></code> <strong class="calibre3">Array</strong>: This array contains a series of validation checks for each input field expected in a project. Each element of this array is a validator function that checks a specific aspect of the data.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('name').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request <code class="calibre7"><strong class="calibre3">body. .trim()</strong></code> removes any leading or trailing whitespace from the input; <code class="calibre7"><strong class="calibre3">.notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the <code class="calibre7"><strong class="calibre3">'name'</strong></code> field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('user_ids').isArray().withMessage('It should be ids of users array')</strong></code>: This validates the <code class="calibre7"><strong class="calibre3">user_ids</strong></code> field in the request <code class="calibre7"><strong class="calibre3">body. .isArray()</strong></code> checks that the field is an array; .<code class="calibre7"><strong class="calibre3">withMessage('It should be ids of users array')</strong></code> provides a custom error message if the validation fails, specifying that the '<code class="calibre7"><strong class="calibre3">user_ids</strong></code>' field should be an array of user IDs.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('start_time').custom((value) =&gt; { /* … */ })</strong></code>: This validates the start_time field in the request body using a custom validation function. The custom validation function checks if the value (the '<code class="calibre7"><strong class="calibre3">start_time</strong></code>' value) is in a valid date format (<code class="calibre7"><strong class="calibre3">YYYY-MM-DD HH:mm:ss</strong></code>). It then compares the '<code class="calibre7"><strong class="calibre3">start_time</strong></code>' with the current time, ensuring that the '<code class="calibre7"><strong class="calibre3">start_time</strong></code>' is greater than the current time. If any of these checks fail, it throws an error with a custom message.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('end_time').custom((value, { req }) =&gt; { /* … */ })</strong></code>: This validates the <code class="calibre7"><strong class="calibre3">end_time</strong></code> field in the request body using another custom validation function. Similar to the previous custom function, it checks if value (the '<code class="calibre7"><strong class="calibre3">end_time</strong></code>' value) is in a valid date format (<code class="calibre7"><strong class="calibre3">YYYY-MM-DD HH:mm:ss</strong></code>). It also accesses <code class="calibre7"><strong class="calibre3">req.body.start_time</strong></code> to compare the '<code class="calibre7"><strong class="calibre3">end_time</strong></code>' with the '<code class="calibre7"><strong class="calibre3">start_time</strong></code>' to ensure that '<code class="calibre7"><strong class="calibre3">end_time</strong></code>' is greater than '<code class="calibre7"><strong class="calibre3">start_time</strong></code>'. If any of these checks fail, it throws an error with a custom message</li>
</ul>
<h1 class="sec" id="s177"><a id="page219" class="calibre6"/><a href="toc.xhtml#s177a" class="calibre6">Add Project</a></h1>
<p class="nonindent">When utilizing the REST API to add a project, you typically furnish the required data within the request body, encompassing details such as the project’s name, description, and any associated attributes. The designated API endpoint for this task is purpose-built to accept and validate this data in accordance with predefined criteria, culminating in the creation of a new project rooted in the supplied information.</p>
<p class="nonindent">We have previously created <code class="calibre7"><strong class="calibre3">projects_controller.ts</strong></code> as a skeleton class. Now, let’s change it with an extended Base Controller and use base service to perform database operations with the following code:</p>
<p class="code"><code class="calibre7">import { Response, Request } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { hasPermission } from '../../utils/auth_util';</code></p>
<p class="code1"><code class="calibre7">import { ProjectsService } from './projects_service';</code></p>
<p class="code1"><code class="calibre7">import { UsersUtil } from '../users/users_controller';</code></p>
<p class="code"><code class="calibre7">export class ProjectController extends BaseController {</code></p>
<p class="code1"><code class="calibre7"> /**</code></p>
<p class="code2"><code class="calibre7"> * Handles the addition of a new user.</code></p>
<p class="code2"><code class="calibre7"> * @param {object} req - The request object.</code></p>
<p class="code2"><code class="calibre7"> * @param {object} res - The response object.</code></p>
<p class="code2"><code class="calibre7"> */</code></p>
<p class="code2"><code class="calibre7">public async addHandler(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3a"><code class="calibre7">if (!hasPermission(req.user.rights, 'add_project')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">// Create an instance of the ProjectService</code></p>
<p class="code4"><code class="calibre7">const service = new ProjectsService();</code></p>
<p class="code4a"><code class="calibre7">// Extract project data from the request body</code></p>
<p class="code4"><code class="calibre7">const project = req.body;</code></p>
<p class="code4a"><code class="calibre7">// Check if the provided user_ids are valid</code></p>
<p class="code4"><code class="calibre7"><a id="page220"/>const isValidUsers = await UsersUtil.checkValidUserIds</code></p>
<p class="code1"><code class="calibre7">(project.user_ids);</code></p>
<p class="code4a"><code class="calibre7">if (!isValidUsers) {</code></p>
<p class="code5"><code class="calibre7">// If user_ids are invalid, send an error response</code></p>
<p class="code5"><code class="calibre7">res.status(400).json({ statusCode: 400, status: 'error', message: 'Invalid user_ids' });</code></p>
<p class="code5"><code class="calibre7">return;</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code4a"><code class="calibre7">// If user_ids are valid, create the user</code></p>
<p class="code4"><code class="calibre7">const createdProject = await service.create(project);</code></p>
<p class="code4"><code class="calibre7">res.status(201).json(createdProject);</code></p>
<p class="code3a"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><code class="calibre7">// Handle errors and send an appropriate response</code></p>
<p class="code4"><code class="calibre7">console.error(`Error while addUser =&gt; ${error.message}`);</code></p>
<p class="code4"><code class="calibre7">res.status(500).json({ statusCode: 500, status: 'error', message: 'Internal server error' });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7"/></p>
<p class="code2"><code class="calibre7">public async getAllHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async getOneHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async updateHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async deleteHandler(req: Request, res: Response) {}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">Add <code class="calibre7"><strong class="calibre3">checkValidUserIds function</strong></code> in <code class="calibre7"><strong class="calibre3">UserUtil</strong></code> Class with following code that checks if given <code class="calibre7"><strong class="calibre3">userIds</strong></code> are valid and exist in the database or not:</p>
<p class="code"><code class="calibre7">public static async checkValidUserIds(user_ids: string[]) {</code></p>
<p class="code3"><code class="calibre7">const userService = new UsersService();</code></p>
<p class="code3a"><code class="calibre7">// Query the database to check if all user_ids are valid</code></p>
<p class="code3"><code class="calibre7">const users = await userService.findByIds(user_ids);</code></p>
<p class="code3a"><code class="calibre7">// Check if all user_ids are found in the database</code></p>
<p class="code3"><code class="calibre7">return users.data.length === user_ids.length;</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page221"/>In this context, the <code class="calibre7"><strong class="calibre3">addHandler</strong></code> method acquires the data supplied in the incoming request body. It then proceeds to transmit this data to the base service by invoking the create method, which is tasked with incorporating this information into the database. Furthermore, we are including the addition of users to the project, associating users with the project during the project creation process.</p>
<p class="nonindent">Now, let’s call <code class="calibre7"><strong class="calibre3">addHandler</strong></code> in project routes with change in the <code class="calibre7"><strong class="calibre3">projects_router.ts</strong></code> file as follows:</p>
<p class="code"><code class="calibre7">export class ProjectRoutes {</code></p>
<p class="code2a"><code class="calibre7">private baseEndPoint = '/api/projects';</code></p>
<p class="code2a"><code class="calibre7">constructor(app: Express) {</code></p>
<p class="code3"><code class="calibre7">const controller = new ProjectController();</code></p>
<p class="code3"><code class="calibre7"><strong class="calibre3">app.route(this.baseEndPoint)</strong></code></p>
<p class="code3"><code class="calibre7"><strong class="calibre3">.all(authorize)</strong></code></p>
<p class="code3"><code class="calibre7"><strong class="calibre3">.post(validate(validProjectInput), controller.addHandler);</strong></code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">We have established routes for adding project and incorporated middleware to validate requests before inserting data into the database.</p>
<p class="nonindent">Once the API is successfully triggered, the following data will be added in PostgreSQL Database:</p>
<figure class="img">
<img alt="" src="img/6.1.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_1"><strong class="calibre3">Figure 6.1:</strong> Postgres Added Project Output</p>
<p class="nonindent"><strong class="calibre3"><a id="page222"/>REST API Add Project</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects</code></p>
<p class="code1"><code class="calibre7">Method: POST</code></p>
<p class="code1"><code class="calibre7">body :</code></p>
<p class="code1"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"name":"Project Management",</code></p>
<p class="code2"><code class="calibre7">"description":"This Project is about for Management",</code></p>
<p class="code2"><code class="calibre7">"User_ids": ["b930d02c-43af-4875-b7e9-546c9f4c23dd",</code></p>
<p class="code2"><code class="calibre7">"611b346e-be39-4a7e-96d1-e7421193bd5a", "d166945a-f85d-485c-bdac-0c8056b3188a"],</code></p>
<p class="code2"><code class="calibre7">"start_time":"2023-09-25 00:00:00",</code></p>
<p class="code2"><code class="calibre7">"end_time":"2023-12-15 00:00:00"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 201,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code3"><code class="calibre7">"name": "Project Management",</code></p>
<p class="code3"><code class="calibre7">"description": "This Project is about for Management",</code></p>
<p class="code3"><code class="calibre7">"user_ids": [</code></p>
<p class="code4"><code class="calibre7">"b930d02c-43af-4875-b7e9-546c9f4c23dd",</code></p>
<p class="code4"><code class="calibre7">"611b346e-be39-4a7e-96d1-e7421193bd5a",</code></p>
<p class="code4"><code class="calibre7">"d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code3"><code class="calibre7">],</code></p>
<p class="code3"><code class="calibre7">"start_time": "2023-09-25 00:00:00",</code></p>
<p class="code3"><code class="calibre7">"end_time": "2023-12-15 00:00:00",</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-09-23T17:23:36.061Z"</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<a id="page223"/>
<figure class="img">
<img alt="" src="img/6.2.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_2"><strong class="calibre3">Figure 6.2:</strong> Postman Response of Add Project Data 201</p>
<p class="nonindent">In the case of a unique project name, trying again with the same request gives an error as a <code class="calibre7"><strong class="calibre3">409</strong></code> conflict code:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 409,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Key (name)=(Project Management) already exists."</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<figure class="img">
<img alt="" src="img/6.3.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_3"><strong class="calibre3">Figure 6.3:</strong> Postman Response of Already Exists Project 409</p>
<p class="nonindent"><a id="page224"/>In another case, if you change in <code class="calibre7"><strong class="calibre3">start_time</strong></code> less than current time, then it gives an error for a Bad Request with a <code class="calibre7"><strong class="calibre3">400</strong></code> status code as follows:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 400,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"errors": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"rights": "Start time must be greater than the current time"</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<figure class="img">
<img alt="" src="img/6.4.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_4"><strong class="calibre3">Figure 6.4:</strong> Postman Response of Invalid Date Given to Project 400</p>
<h1 class="sec" id="s178"><a href="toc.xhtml#s178a" class="calibre6">GetAll Project</a></h1>
<p class="nonindent">After successfully adding a project to the database, the next step involves retrieving the newly inserted project from the database. To achieve this, update the <code class="calibre7"><strong class="calibre3">getAllHandler</strong></code> method in the <code class="calibre7"><strong class="calibre3">projects_controller.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7">public async <strong class="calibre3">getAllHandler</strong>(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><a id="page225"/><code class="calibre7">if (!hasPermission(req.user.rights, 'get_all_projects')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7"/></p>
<p class="code3"><code class="calibre7">const service = new ProjectsService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.findAll(req.query);</code></p>
<p class="code3"><code class="calibre7">for (const project of result.data) {</code></p>
<p class="code4"><code class="calibre7">project['users'] = await UsersUtil.getUsernamesById(project.user_ids);</code></p>
<p class="code4"><code class="calibre7">delete project.user_ids;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3a"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent">In the preceding code, we send the username along with the <code class="calibre7"><strong class="calibre3">user_id</strong></code> of associated users in the project. So, we have created a method in the user utils that gives the username from <code class="calibre7"><strong class="calibre3">user_id</strong></code> with the following code:</p>
<p class="code"><code class="calibre7"> public static async <strong class="calibre3">getUsernamesById</strong>(user_ids: string[]) {</code></p>
<p class="code3"><code class="calibre7">const userService = new UsersService();</code></p>
<p class="code3a"><code class="calibre7">// Query the database to check if all user_ids are valid</code></p>
<p class="code3"><code class="calibre7">const queryResult = await userService.findByIds(user_ids);</code></p>
<p class="code3"><code class="calibre7">if (queryResult.statusCode === 200) {</code></p>
<p class="code4"><code class="calibre7">const users = queryResult.data;</code></p>
<p class="code4"><code class="calibre7">const usernames = users.map((i) =&gt; {</code></p>
<p class="code5"><code class="calibre7">return {</code></p>
<p class="code6"><code class="calibre7">'username': i.username,</code></p>
<p class="code6"><code class="calibre7">'user_id': i.user_id</code></p>
<p class="code5"><code class="calibre7">};</code></p>
<p class="code4"><code class="calibre7">});</code></p>
<p class="code4"><code class="calibre7">return usernames;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return [];</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page226"/>The `<code class="calibre7"><strong class="calibre3">getAllHandler`</strong></code> method uses the <code class="calibre7"><strong class="calibre3">ProjectsService</strong></code> class to retrieve all projects from the database based on the query parameters in the request. The resulting data is then sent back to the client with an appropriate HTTP status code and formatted as JSON.</p>
<p class="nonindent">The routes class in <code class="calibre7"><strong class="calibre3">project_routes.ts</strong></code> can be updated to make a call to the new handler for GET request as:</p>
<p class="code2a"><code class="calibre7">app.route(this.baseEndPoint)</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.post(validate(validProjectInput), controller.addHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.get(controller.getAllHandler);</strong></code></p>
<p class="nonindent">By employing this approach, we establish a <code class="calibre7"><strong class="calibre3">GET</strong></code> route that fetches all projects stored in the database, effectively functioning as a REST API endpoint for retrieving project data.</p>
<p class="nonindent"><strong class="calibre3">REST API</strong> <code class="calibre7"><strong class="calibre3">GetAll</strong></code> <strong class="calibre3">Projects</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="code1"><code class="calibre7">Query Params: {}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code4"><code class="calibre7">"name": "Project Management",</code></p>
<p class="code4"><code class="calibre7">"description": "This Project is about for Management",</code></p>
<p class="code4"><code class="calibre7">"start_time": "2023-09-24T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"end_time": "2023-12-14T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"created_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code4"><code class="calibre7">"updated_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code4"><code class="calibre7">"users": [</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "pms-admin",</code></p>
<p class="code6"><code class="calibre7">"user_id": "b930d02c-43af-4875-b7e9-546c9f4c23dd"</code></p>
<p class="code5"><code class="calibre7">},</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "pms-admin1",</code></p>
<p class="code6"><code class="calibre7">"user_id": "611b346e-be39-4a7e-96d1-e7421193bd5a"</code></p>
<p class="code5"><code class="calibre7">},</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "yamini",</code></p>
<p class="code6"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code5"><code class="calibre7">}</code></p>
<p class="code4"><code class="calibre7">]</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s179"><a id="page227" class="calibre6"/><a href="toc.xhtml#s179a" class="calibre6">Search Project by Name</a></h1>
<p class="nonindent">To search for a project by name, you can utilize the same API endpoint as the one used for retrieving all projects. However, in this case, you will include query parameters to specify the search criteria.</p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects?name=Project Management</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="code1"><code class="calibre7">Query Params: {name: Project Management }</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code4"><code class="calibre7">"name": "Project Management",</code></p>
<p class="code4"><code class="calibre7">"description": "This Project is about for Management",</code></p>
<p class="code4"><code class="calibre7">"start_time": "2023-09-24T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"end_time": "2023-12-14T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"created_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code4"><code class="calibre7">"updated_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code4"><code class="calibre7">"users": [</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "pms-admin",</code></p>
<p class="code6"><code class="calibre7">"user_id": "b930d02c-43af-4875-b7e9-546c9f4c23dd"</code></p>
<p class="code5"><code class="calibre7">},</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "pms-admin1",</code></p>
<p class="code6"><code class="calibre7">"user_id": "611b346e-be39-4a7e-96d1-e7421193bd5a"</code></p>
<p class="code5"><code class="calibre7">},</code></p>
<p class="code5"><code class="calibre7">{</code></p>
<p class="code6"><code class="calibre7">"username": "yamini",</code></p>
<p class="code6"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code5"><code class="calibre7">}</code></p>
<p class="code4"><code class="calibre7">]</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s180"><a id="page228" class="calibre6"/><a href="toc.xhtml#s180a" class="calibre6">GetOne Project</a></h1>
<p class="nonindent">The “<em class="calibre4">GetOne Project</em>” endpoint plays a pivotal role in project management systems, allowing users to access in-depth information about a specific project without the requirement to fetch the complete project list. This functionality is indispensable for providing precise details regarding the attributes and permissions linked to each project.</p>
<p class="nonindent">To implement the “<em class="calibre4">GetOne Project</em>” API, modify the <code class="calibre7"><strong class="calibre3">getOneHandler</strong></code> code in the project controller as follows:</p>
<p class="code"><code class="calibre7"> public async getOneHandler(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'get_details_project')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const service = new ProjectsService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.findOne(<strong class="calibre3">req.params.project_id</strong>);</code></p>
<p class="code3"><code class="calibre7">result.data['users'] = await UsersUtil.getUsernamesById(result.data.user_ids);</code></p>
<p class="code3"><code class="calibre7">delete result.data.user_ids;</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page229"/>The <code class="calibre7"><strong class="calibre3">`getOneHandler</strong></code><strong class="calibre3">`</strong> function serves as the bridge between the incoming client request, the service layer that interacts with the database, and the outgoing HTTP response. It retrieves a single project’s details from the database based on the provided project ID and sends the project information back to the client.</p>
<p class="nonindent">This method is called from the routes file by creating a new route for it as follows:</p>
<p class="code"><code class="calibre7">app.route(this.baseEndPoint + '/<strong class="calibre3">:project_id'</strong>)</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.get(controller.getOneHandler);</code></p>
<p class="nonindent">Here, `<code class="calibre7"><strong class="calibre3">/:project_id</strong></code> ` will be a request parameter meant to capture the ID of the project that the user wants to retrieve.</p>
<p class="nonindent">Parameters passed to APIs can be read using <code class="calibre7"><strong class="calibre3">request.params</strong></code>, as seen in the previous example while reading <code class="calibre7"><strong class="calibre3">project_id</strong></code>:</p>
<p class="code"><code class="calibre7">const project_id = req.params.project_id;</code></p>
<p class="nonindent"><strong class="calibre3">REST API GetOne Project</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects/</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code3"><code class="calibre7">"name": "Project Management",</code></p>
<p class="code3"><code class="calibre7">"description": "This Project is about for Management",</code></p>
<p class="code3"><code class="calibre7">"start_time": "2023-09-24T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"end_time": "2023-12-24T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-09-24T17:18:55.827Z",</code></p>
<p class="code3"><code class="calibre7">"users": [</code></p>
<p class="code4"><code class="calibre7">{</code></p>
<p class="code5"><code class="calibre7">"username": "pms-admin",</code></p>
<p class="code5"><code class="calibre7">"user_id": "b930d02c-43af-4875-b7e9-546c9f4c23dd"</code></p>
<p class="code4"><code class="calibre7">},</code></p>
<p class="code4"><code class="calibre7">{</code></p>
<p class="code5"><code class="calibre7">"username": "pms-admin1",</code></p>
<p class="code5"><code class="calibre7">"user_id": "611b346e-be39-4a7e-96d1-e7421193bd5a"</code></p>
<p class="code4"><code class="calibre7">},</code></p>
<p class="code4"><code class="calibre7">{</code></p>
<p class="code5"><code class="calibre7">"username": "yamini",</code></p>
<p class="code5"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">]</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page230"/>Providing a valid project ID will yield a successful response, while inputting an ID that doesn’t correspond to an existing database entry will result in a <code class="calibre7"><strong class="calibre3">404 error</strong></code>, signifying that the requested entity was not found.</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s181"><a href="toc.xhtml#s181a" class="calibre6">Update Project</a></h1>
<p class="nonindent">The process of updating a project details involves making changes to the existing data of a particular project that is stored in the database. Through this process, you can modify attributes such as the project’s name, description, and associated users. Updating a project is crucial for maintaining the accuracy and currency of project information, especially when there are alterations in project permissions that need to be reflected in the database.</p>
<p class="nonindent">To implement the <code class="calibre7"><strong class="calibre3">"Update Project"</strong></code> API, make the following changes in the <code class="calibre7"><strong class="calibre3">updateHandler</strong></code> code within the project controller:</p>
<p class="code"><code class="calibre7">public async <strong class="calibre3">updateHandler</strong>(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'edit_project')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const project = req.body;</code></p>
<p class="code3"><code class="calibre7">const service = new ProjectsService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.update(req.params.id, project);</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page231"/>The <strong class="calibre3">`</strong><code class="calibre7"><strong class="calibre3">updateHandler</strong></code><strong class="calibre3">`</strong> function handles requests to update a task. It begins by checking if the user has the necessary permission, and if so, it extracts the updated project data, initializes the project service, performs the update operation in the database, and responds to the client with the appropriate status code and result data.</p>
<p class="nonindent">This method is called from the routes file by creating a new route for it as follows:</p>
<p class="code"><code class="calibre7">app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code2"><code class="calibre7"> .all(authorize)</code></p>
<p class="code4"><code class="calibre7">.get(controller.getOneHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.put(validate(validProjectInput), controller.updateHandler);</strong></code></p>
<p class="nonindent">Here, `<code class="calibre7"><strong class="calibre3">/:id</strong></code> ` will be a request parameter meant to capture the ID of the project that the user wants to retrieve, and it also validates data before updating in the database.</p>
<p class="nonindent"><strong class="calibre3">REST API Update Project</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects/</code></p>
<p class="code1"><code class="calibre7">Method: PUT</code></p>
<p class="code1"><code class="calibre7">body :</code></p>
<p class="code1"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"name":"Project Management",</code></p>
<p class="code2"><code class="calibre7">"description":"This Project is about for Management",</code></p>
<p class="code2"><code class="calibre7">"user_ids":["b930d02c-43af-4875-b7e9-546c9f4c23dd","611b346e-be39-4a7e-96d1-e7421193bd5a","d166945a-f85d-485c-bdac-0c8056b3188a"],</code></p>
<p class="code2"><code class="calibre7">"start_time":"2023-09-25 00:00:00",</code></p>
<p class="code2"><code class="calibre7">"end_time":"2023-12-25 00:00:00"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code3"><code class="calibre7">"name": "Project Management",</code></p>
<p class="code3"><code class="calibre7">"description": "This Project is about for Management",</code></p>
<p class="code3"><code class="calibre7">"user_ids": [</code></p>
<p class="code4"><code class="calibre7">"b930d02c-43af-4875-b7e9-546c9f4c23dd",</code></p>
<p class="code4"><code class="calibre7">"611b346e-be39-4a7e-96d1-e7421193bd5a",</code></p>
<p class="code4"><code class="calibre7">"d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code3"><code class="calibre7">],</code></p>
<p class="code3"><code class="calibre7">"start_time": "2023-09-24T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"end_time": "2023-12-24T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-23T17:23:36.061Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-09-24T17:18:55.827Z"</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page232"/>Providing a valid project ID will yield a successful response, while inputting an ID that doesn’t correspond to an existing database entry will result in a <code class="calibre7"><strong class="calibre3">404 error</strong></code>, signifying that the requested entity was not found.</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s182"><a href="toc.xhtml#s182a" class="calibre6">Delete Project</a></h1>
<p class="nonindent">The "<code class="calibre7"><strong class="calibre3">delete</strong></code>” functionality for projects in a REST API involves the removal of a specific project from the database. This process is managed through an endpoint dedicated to project deletion. When a request is made to this endpoint, it triggers a function that handles the deletion process. The incoming request typically contains the unique identifier (<code class="calibre7"><strong class="calibre3">project_id</strong></code>) of the project that needs to be deleted.</p>
<p class="nonindent">To implement the Delete Project API, make the following changes in the <code class="calibre7"><strong class="calibre3">deleteHandler</strong></code> code in the project controller:</p>
<p class="code"><code class="calibre7">public async <strong class="calibre3">deleteHandler</strong>(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'delete_project')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const service = new ProjectsService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.delete(req.params.id);</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page233"/>The <code class="calibre7"><strong class="calibre3">`deleteHandler`</strong></code> processes the request by utilizing a service that interacts with the database. This service is responsible for executing the deletion operation. If the requested project exists in the database and the deletion is successful, the function responds with a success message and an appropriate status code, such as <code class="calibre7"><strong class="calibre3">200 OK</strong></code>. If the role does not exist, the function returns an error response with a status code of <code class="calibre7"><strong class="calibre3">404 Not Found</strong></code>, indicating that the project was not located in the database.</p>
<p class="nonindent">This method is called from the routes file by creating a new route for it as follows:</p>
<p class="code"><code class="calibre7">app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.get(controller.getOneHandler)</code></p>
<p class="code4"><code class="calibre7">.put(validate(validProjectInput), controller.updateHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.delete(controller.deleteHandler);</strong></code></p>
<p class="nonindent">Here, `<code class="calibre7"><strong class="calibre3">/:id</strong></code> ` will be a request parameter meant to capture the ID of the project that the user wants to delete.</p>
<p class="nonindent"><strong class="calibre3">REST API Delete Project</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects/</code></p>
<p class="code1"><code class="calibre7">Method: DELETE</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In the case of an already deleted or not exist in the database:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s183"><a id="page234" class="calibre6"/><a href="toc.xhtml#s183a" class="calibre6">Project Util</a></h1>
<p class="nonindent">Following the development of the foundational base API for Project, several functions have been crafted within the Project Util class. These functions serve as valuable helpers and are intended for utilization in various other modules.</p>
<p class="nonindent">Now, let’s proceed to establish the <code class="calibre7"><strong class="calibre3">ProjectUtil</strong></code> class within the <code class="calibre7"><strong class="calibre3">projects_controller.ts</strong></code> file. The provided code snippet outlines the structure of this class:</p>
<p class="code"><code class="calibre7">export class <strong class="calibre3">ProjectsUtil</strong> {</code></p>
<p class="code2"><code class="calibre7">public static async <strong class="calibre3">checkValidProjectIds</strong>(project_ids: string[]) {</code></p>
<p class="code3"><code class="calibre7">const projectService = new ProjectsService();</code></p>
<p class="code3"><code class="calibre7">// Query the database to check if all project_ids are valid</code></p>
<p class="code3"><code class="calibre7">const projects = await projectService.findByIds(project_ids);</code></p>
<p class="code3"><code class="calibre7">// Check if all project_ids are found in the database</code></p>
<p class="code3"><code class="calibre7">return projects.data.length === project_ids.length;</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In the preceding code, the <code class="calibre7"><strong class="calibre3">`checkValidProjectIds</strong></code><strong class="calibre3">`</strong> function checks whether the given <code class="calibre7"><strong class="calibre3">projects_ids</strong></code> are valid or not in the database.</p>
<p class="nonindent">In summary, a well-designed RESTful API project module enables organizations to efficiently manage their projects, collaborate effectively, and integrate project data into their applications and systems while adhering to best practices in security, validation, and documentation.</p>
<h1 class="sec" id="s184"><a href="toc.xhtml#s184a" class="calibre6">Task Management</a></h1>
<p class="nonindent">To manage tasks effectively, individuals and teams often use task management tools and software. This module provides features for creating, assigning, prioritizing, and tracking tasks. Tasks are the building blocks of project management. They help project managers and teams break down complex projects into manageable parts, allocate resources efficiently, and ensure that work progresses according to the project plan.</p>
<p class="nonindent">Let’s start creating a task service first to manage tasks.</p>
<h1 class="sec" id="s185"><a href="toc.xhtml#s185a" class="calibre6">Task Service</a></h1>
<p class="nonindent">Task Service is to facilitate the creation, updation, deletion, and retrieval of task <a id="page235"/>details as required. Let’s create a <code class="calibre7"><strong class="calibre3">tasks_services.ts</strong></code> file in the tasks directory with the following code:</p>
<p class="code"><code class="calibre7">import { Repository } from 'typeorm';</code></p>
<p class="code1"><code class="calibre7">import { BaseService } from '../../utils/base_service';</code></p>
<p class="code1"><code class="calibre7">import { DatabaseUtil } from '../../utils/db';</code></p>
<p class="code1"><code class="calibre7">import { Tasks } from './tasks_entity';</code></p>
<p class="code"><code class="calibre7">export class TasksService extends BaseService&lt;Tasks&gt; {</code></p>
<p class="code2a"><code class="calibre7">constructor() {</code></p>
<p class="code3"><code class="calibre7">let taskRepository: Repository&lt;Tasks&gt; | null = null;</code></p>
<p class="code3"><code class="calibre7">taskRepository = new DatabaseUtil().getRepository(Tasks);</code></p>
<p class="code3"><code class="calibre7">super(taskRepository);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">The `<code class="calibre7"><strong class="calibre3">TasksService`</strong></code> class inherits from a base service class, allowing it to interact with a database repository for managing tasks. The constructor initializes the database repository for tasks, facilitating database operations for tasks-related functionality in the application.</p>
<p class="nonindent">We will develop the REST API for the project as follows:</p>
<ul class="bull">
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Add</strong></code> Task</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">GetAll</strong></code> Task</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">GetOne</strong></code> Task</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Update</strong></code> Task</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">Delete</strong></code> Task</li>
</ul>
<h1 class="sec" id="s186"><a href="toc.xhtml#s186a" class="calibre6">Input Validation</a></h1>
<p class="nonindent">Task input validation is the process of ensuring that data provided as input for tasks in a software application conforms to predefined criteria and constraints.</p>
<p class="nonindent">Now, let’s add <code class="calibre7"><strong class="calibre3">validTaskInput</strong></code> in the <code class="calibre7"><strong class="calibre3">tasks_routes.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7">import { Express } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { TaskController } from './tasks_controller';</code></p>
<p class="code1"><code class="calibre7">import { body } from 'express-validator';</code></p>
<p class="code1"><code class="calibre7">import { checkValidDate } from '../../utils/common';</code></p>
<p class="code1"><code class="calibre7">import { validate } from '../../utils/validator';</code></p>
<p class="code1"><code class="calibre7">import { authorize } from '../../utils/auth_util';</code></p>
<p class="code1"><code class="calibre7"/></p>
<p class="code1"><code class="calibre7"><a id="page236"/>const <strong class="calibre3">validTaskInput</strong> = [</code></p>
<p class="code2"><code class="calibre7">body('name').trim().notEmpty().withMessage('It should be required'),</code></p>
<p class="code2"><code class="calibre7">body('project_id').trim().notEmpty().withMessage('It should be</code></p>
<p class="code1"><code class="calibre7">required'),</code></p>
<p class="code2"><code class="calibre7">body('user_id').trim().notEmpty().withMessage('It should be</code></p>
<p class="code1"><code class="calibre7">required'),</code></p>
<p class="code2"><code class="calibre7">body('estimated_start_time').trim().notEmpty().withMessage('It should be required'),</code></p>
<p class="code2"><code class="calibre7">body('estimated_end_time').trim().notEmpty().withMessage('It should be required'),</code></p>
<p class="code2"><code class="calibre7">body('estimated_start_time').custom((value) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!checkValidDate(value)) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(value);</code></p>
<p class="code3"><code class="calibre7">const currentTime = new Date();</code></p>
<p class="code3a"><code class="calibre7">if (startTime &lt;= currentTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Start time must be greater than the current time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">}),</code></p>
<p class="code2"><code class="calibre7">body('estimated_end_time').custom((value, { req }) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!checkValidDate(value)) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(req.body.start_time);</code></p>
<p class="code3"><code class="calibre7">const endTime = new Date(value);</code></p>
<p class="code3a"><code class="calibre7">if (endTime &lt;= startTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('End time must be greater than the start time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">})</code></p>
<p class="code1"><code class="calibre7">];</code></p>
<p class="nonindent"><a id="page237"/>Here are the details of the key parts of the preceding code:</p>
<ul class="bull">
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('name').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request body. <code class="calibre7"><strong class="calibre3">.trim()</strong></code> removes any leading or trailing whitespace from the input; <code class="calibre7"><strong class="calibre3">.notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the ‘name’ field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('project_id').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request <code class="calibre7"><strong class="calibre3">body. .trim()</strong></code> removes any leading or trailing whitespace from the input; .<code class="calibre7"><strong class="calibre3">notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the <code class="calibre7"><strong class="calibre3">'project_id</strong></code>' field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('user_id').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request <code class="calibre7"><strong class="calibre3">body. .trim()</strong></code> removes any leading or trailing whitespace from the input; <code class="calibre7"><strong class="calibre3">.notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the '<code class="calibre7"><strong class="calibre3">user_id</strong></code>' field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('estimated_start_time').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request <code class="calibre7"><strong class="calibre3">body. .trim()</strong></code> removes any leading or trailing whitespace from the input; <code class="calibre7"><strong class="calibre3">.notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the '<code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code>' field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('estimated_end_time').trim().notEmpty().withMessage('It should be required')</strong></code>: This validates the name field in the request <code class="calibre7"><strong class="calibre3">body. .trim()</strong></code> removes any leading or trailing whitespace from the input; <code class="calibre7"><strong class="calibre3">.notEmpty()</strong></code> checks that the field is not empty; <code class="calibre7"><strong class="calibre3">.withMessage('It should be required')</strong></code> provides a custom error message if the validation fails, indicating that the ''<code class="calibre7"><strong class="calibre3">estimated_end_time</strong></code>'' field is required.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('estimated_start_time').custom((value) =&gt; { /* … */ })</strong></code>: This validates the <code class="calibre7"><strong class="calibre3">start_time</strong></code> field in the request body using a custom validation function. The custom validation function checks if the value (the '<code class="calibre7"><strong class="calibre3">start_time</strong></code>' value) is in a valid date format (<code class="calibre7"><strong class="calibre3">YYYY-MM-DD HH:mm:ss</strong></code>). It then compares the '<code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code>' with the current time, ensuring that the '<code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code>' is greater than the current time. If any of these checks fail, it throws an error with a custom message.</li>
<li class="calibre9"><code class="calibre7"><strong class="calibre3">body('estimated_end_time').custom((value, { req }) =&gt; { /* … */ })</strong></code>: This validates the <code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code> field in the request body using another custom validation function. Similar to the previous custom function, <a id="page238"/>it checks if the value (the '<code class="calibre7"><strong class="calibre3">estimated_end_time</strong></code>' value) is in a valid date format (<code class="calibre7"><strong class="calibre3">YYYY-MM-DD HH:mm:ss</strong></code>). It also accesses the <code class="calibre7"><strong class="calibre3">req.body</strong></code>. to compare the '<code class="calibre7"><strong class="calibre3">estimated_end_time</strong></code>' with the '<code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code>' to ensure that '<code class="calibre7"><strong class="calibre3">estimated_end_time</strong></code>' is greater than '<code class="calibre7"><strong class="calibre3">estimated_start_time</strong></code>'. If any of these checks fail, it throws an error with a custom message.</li>
</ul>
<p class="nonindent">In this manner, we can implement fundamental validation for tasks.</p>
<h1 class="sec" id="s187"><a href="toc.xhtml#s187a" class="calibre6">Add Task</a></h1>
<p class="nonindent">When employing the REST API to initiate the addition of a task, the customary procedure involves providing essential information within the request body. This information typically encompasses details such as the task’s name, description, and any related attributes. The dedicated API endpoint, tailored for this specific purpose, is designed to receive and meticulously validate this data, ensuring it aligns with predefined criteria. Subsequently, this validation process culminates in the creation of a fresh task, founded upon the information furnished in the request.</p>
<p class="nonindent">Previously, we established the initial structure of the <code class="calibre7"><strong class="calibre3">tasks_controller.ts</strong></code> class as a skeletal outline. Now, let’s proceed to enhance its functionality by extending it from the <code class="calibre7"><strong class="calibre3">BaseController</strong></code> and leveraging the capabilities of the <code class="calibre7"><strong class="calibre3">BaseService</strong></code> to carry out database operations.</p>
<p class="nonindent">Following is the code for this implementation:</p>
<p class="code"><code class="calibre7">import { Response, Request } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { hasPermission } from '../../utils/auth_util';</code></p>
<p class="code1"><code class="calibre7">import { BaseController } from '../../utils/base_controller';</code></p>
<p class="code1"><code class="calibre7">import { TasksService } from './tasks_service';</code></p>
<p class="code1"><code class="calibre7">import { UsersUtil } from '../users/users_controller';</code></p>
<p class="code1"><code class="calibre7">import { ProjectsUtil } from '../projects/projects_controller';</code></p>
<p class="code"><code class="calibre7">export class TaskController extends BaseController {</code></p>
<p class="code2a"><code class="calibre7">/**</code></p>
<p class="code2"><code class="calibre7">* Handles the addition of a new user.</code></p>
<p class="code2"><code class="calibre7">* @param {object} req - The request object.</code></p>
<p class="code2"><code class="calibre7">* @param {object} res - The response object.</code></p>
<p class="code2"><code class="calibre7">*/</code></p>
<p class="code2"><code class="calibre7">public async addHandler(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3a"><code class="calibre7">if (!hasPermission(req.user.rights, 'add_task')) {</code></p>
<p class="code4"><a id="page239"/><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">// Create an instance of the ProjectService</code></p>
<p class="code4"><code class="calibre7">const service = new TasksService();</code></p>
<p class="code4a"><code class="calibre7">// Extract task data from the request body</code></p>
<p class="code4"><code class="calibre7">const task = req.body;</code></p>
<p class="code4a"><code class="calibre7">//check if the provided project_id is valid</code></p>
<p class="code4"><code class="calibre7">const isValidProject = await ProjectsUtil.</code></p>
<p class="code1"><code class="calibre7">checkValidProjectIds([task.project_id]);</code></p>
<p class="code4"><code class="calibre7">if (!isValidProject) {</code></p>
<p class="code5"><code class="calibre7">// If user_ids are invalid, send an error response</code></p>
<p class="code5"><code class="calibre7">res.status(400).json({ statusCode: 400, status: 'error', message: 'Invalid project_id' });</code></p>
<p class="code5"><code class="calibre7">return;</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code4a"><code class="calibre7">// Check if the provided user_id is valid</code></p>
<p class="code4"><code class="calibre7">const isValidUser = await UsersUtil.checkValidUserIds([task.user_id]);</code></p>
<p class="code4a"><code class="calibre7">if (!isValidUser) {</code></p>
<p class="code5"><code class="calibre7">// If user_ids are invalid, send an error response</code></p>
<p class="code5"><code class="calibre7">res.status(400).json({ statusCode: 400, status: 'error', message: 'Invalid user_id' });</code></p>
<p class="code5"><code class="calibre7">return;</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code4a"><code class="calibre7">// If user_ids are valid, create the user</code></p>
<p class="code4"><code class="calibre7">const createdTask = await service.create(task);</code></p>
<p class="code4"><code class="calibre7">res.status(201).json(createdTask);</code></p>
<p class="code3a"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><a id="page240"/><code class="calibre7">// Handle errors and send an appropriate response</code></p>
<p class="code4"><code class="calibre7">console.error(`Error while addUser =&gt; ${error.message}`);</code></p>
<p class="code4"><code class="calibre7">res.status(500).json({ statusCode: 500, status: 'error', message: 'Internal server error' });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7"/></p>
<p class="code2"><code class="calibre7">public async getAllHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async getOneHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async updateHandler(req: Request, res: Response) {}</code></p>
<p class="code2"><code class="calibre7">public async deleteHandler(req: Request, res: Response) {}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">The <code class="calibre7"><strong class="calibre3">addHandler</strong></code> method retrieves the data provided within the incoming request body. Subsequently, it forwards this data to the Base service by calling the create method, responsible for integrating this information into the database. Additionally, we are extending this process to include the assignment of the user and project to the task, effectively associating the user and project with the task during its creation.</p>
<p class="nonindent">Now, let’s call <code class="calibre7"><strong class="calibre3">addHandler</strong></code> in the task routes with change in the <code class="calibre7"><strong class="calibre3">tasks_router.ts</strong></code> file as follows:</p>
<p class="code"><code class="calibre7">export class TaskRoutes {</code></p>
<p class="code2a"><code class="calibre7">private baseEndPoint = '/api/projects';</code></p>
<p class="code2a"><code class="calibre7">constructor(app: Express) {</code></p>
<p class="code3"><code class="calibre7">const controller = new ProjectController();</code></p>
<p class="code3a"><code class="calibre7">app.route(this.baseEndPoint)</code></p>
<p class="code3"><code class="calibre7">.all(authorize)</code></p>
<p class="code3"><code class="calibre7">.post(validate(validTaskInput), controller.addHandler);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">We have established routes for adding tasks and incorporated middleware to validate requests before inserting data into the database.</p>
<p class="nonindent"><strong class="calibre3"><a id="page241"/>REST API Add Project</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/tasks</code></p>
<p class="code1"><code class="calibre7">Method: POST</code></p>
<p class="code1"><code class="calibre7">body :</code></p>
<p class="code1"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"name":"Setup Database",</code></p>
<p class="code2"><code class="calibre7">"description":"create one postgres database and setup database for project</code></p>
<p class="code2"><code class="calibre7"> management project",</code></p>
<p class="code2"><code class="calibre7">"project_id":"c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code2"><code class="calibre7">"user_id":"d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code2"><code class="calibre7">"estimated_start_time":"2023-10-01 00:00:00",</code></p>
<p class="code2"><code class="calibre7">"estimated_end_time":"2023-10-02 00:00:00"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 201,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"task_id": "74f61799-7046-47d9-8f04-897f07b4e178",</code></p>
<p class="code3"><code class="calibre7">"name": "Setup Database",</code></p>
<p class="code3"><code class="calibre7">"description": "create one postgres database and setup database for project management project",</code></p>
<p class="code3"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code3"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code3"><code class="calibre7">"estimated_start_time": "2023-10-01 00:00:00",</code></p>
<p class="code3"><code class="calibre7">"estimated_end_time": "2023-10-02 00:00:00",</code></p>
<p class="code3"><code class="calibre7">"actual_start_time": null,</code></p>
<p class="code3"><code class="calibre7">"actual_end_time": null,</code></p>
<p class="code3"><code class="calibre7">"priority": "Low",</code></p>
<p class="code3"><code class="calibre7">"status": "Not-Started",</code></p>
<p class="code3"><code class="calibre7">"supported_files": [],</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-09-30T12:17:51.138Z"</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page242"/>In the case of a unique task name, trying again with the same request gives an error as <code class="calibre7"><strong class="calibre3">409</strong></code> conflict code:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 409,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Key (name)=(Setup Database) already exists."</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In another case, if you change in rights as “<code class="calibre7"><strong class="calibre3">rights</strong></code>”:”<code class="calibre7"><strong class="calibre3">no_rights</strong></code>”, it gives an error for a Bad Request with a <code class="calibre7"><strong class="calibre3">400</strong></code> status code as follows:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 400,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"errors": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"rights": "Invalid permission"</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In the database for the task entity, we added the default value for priority as “<code class="calibre7"><strong class="calibre3">Low</strong></code>” and status as “<code class="calibre7"><strong class="calibre3">Not-Started</strong></code>”, so that it takes automatically while creating the task.</p>
<h1 class="sec" id="s188"><a href="toc.xhtml#s188a" class="calibre6">GetAll Task</a></h1>
<p class="nonindent">After successfully adding a task to the database, the next step involves retrieving the newly inserted task from the database. To achieve this, update the <code class="calibre7"><strong class="calibre3">getAllHandler</strong></code> method in the <code class="calibre7"><strong class="calibre3">tasks_controller.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7"> public async getAllHandler(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'get_all_tasks')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const service = new TasksService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.findAll(req.query);</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page243"/>A Task is associated with both a project and a user. In this API, we must also display the details of the project and user. Therefore, the standard <code class="calibre7"><strong class="calibre3">findAll</strong></code> method from the base service does not provide the functionality we require. To achieve this, we need to override the <code class="calibre7"><strong class="calibre3">findAll</strong></code> method in the <code class="calibre7"><strong class="calibre3">tasks_service.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7"> export class TasksService extends BaseService&lt;Tasks&gt; {</code></p>
<p class="code2"><code class="calibre7">private taskRepository: Repository&lt;Tasks&gt; | null = null;</code></p>
<p class="code2"><code class="calibre7">constructor() {</code></p>
<p class="code3"><code class="calibre7">let taskRepository: Repository&lt;Tasks&gt; | null = null;</code></p>
<p class="code3"><code class="calibre7">taskRepository = new DatabaseUtil().getRepository(Tasks);</code></p>
<p class="code3"><code class="calibre7">super(taskRepository);</code></p>
<p class="code3"><code class="calibre7">this.taskRepository = taskRepository;</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code2a"><code class="calibre7">// Override the method from the base service class</code></p>
<p class="code2"><code class="calibre7">override async findAll(queryParams: object): Promise&lt;ApiResponse&lt;Tasks[]&gt;&gt; {</code></p>
<p class="code3a"><code class="calibre7">const queryBuilder = await this.taskRepository</code></p>
<p class="code4"><code class="calibre7">.createQueryBuilder('task')</code></p>
<p class="code4"><code class="calibre7">.leftJoin('task.project_id', 'project')</code></p>
<p class="code4"><code class="calibre7">.leftJoin('task.user_id', 'user')</code></p>
<p class="code4"><code class="calibre7">.addSelect([</code></p>
<p class="code5"><code class="calibre7">'task.*',</code></p>
<p class="code5"><code class="calibre7">'task.project_id as project',</code></p>
<p class="code5"><code class="calibre7">'project.project_id',</code></p>
<p class="code5"><code class="calibre7">'project.name',</code></p>
<p class="code5"><code class="calibre7">'user.user_id',</code></p>
<p class="code5"><code class="calibre7">'user.username',</code></p>
<p class="code5"><code class="calibre7">'user.email',</code></p>
<p class="code4"><code class="calibre7">]);</code></p>
<p class="code3a"><a id="page244"/><code class="calibre7">// Build the WHERE clause conditionally based on the search parameters</code></p>
<p class="code3"><code class="calibre7">if (queryParams['username']) {</code></p>
<p class="code4"><code class="calibre7">queryBuilder.andWhere('user.username ILIKE :userName', {</code></p>
<p class="code5"><code class="calibre7">userName:</code></p>
<p class="code6"><code class="calibre7">`%${queryParams['username']}%`</code></p>
<p class="code4"><code class="calibre7">});</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3a"><code class="calibre7">if (queryParams['projectname']) {</code></p>
<p class="code4"><code class="calibre7">queryBuilder.andWhere('project.name ILIKE :projectName', {</code></p>
<p class="code5"><code class="calibre7">projectName:</code></p>
<p class="code6"><code class="calibre7">`%${queryParams['projectname']}%`</code></p>
<p class="code4"><code class="calibre7">});</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">if (queryParams['project_id']) {</code></p>
<p class="code4"><code class="calibre7">queryBuilder.andWhere('task.project_id = :projectId', {</code></p>
<p class="code5"><code class="calibre7">projectId:</code></p>
<p class="code6"><code class="calibre7">queryParams['project_id']</code></p>
<p class="code4"><code class="calibre7">});</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3a"><code class="calibre7">const data = await queryBuilder.getMany();</code></p>
<p class="code3a"><code class="calibre7">data.forEach((item) =&gt; {</code></p>
<p class="code4"><code class="calibre7">item['projectDetails'] = item.project_id;</code></p>
<p class="code4"><code class="calibre7">item['userDetails'] = item.user_id;</code></p>
<p class="code4"><code class="calibre7">delete item.project_id;</code></p>
<p class="code4"><code class="calibre7">delete item.user_id;</code></p>
<p class="code3"><code class="calibre7">});</code></p>
<p class="code3"><code class="calibre7">return { statusCode: 200, status: 'success', data: data };</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page245"/>We created a query builder using TypeORM to build an SQL query for retrieving tasks with specific details. We use joins to fetch related data from the project and user tables. We specify the columns we want to select in the query using the <code class="calibre7"><strong class="calibre3">addSelect</strong></code> method. We conditionally add <code class="calibre7"><strong class="calibre3">WHERE</strong></code> clauses to the query based on the values provided in the <code class="calibre7"><strong class="calibre3">queryParams</strong></code> object. For example, if the username or <code class="calibre7"><strong class="calibre3">projectName</strong></code> is provided in the <code class="calibre7"><strong class="calibre3">queryParams</strong></code>, we add a condition to filter the results accordingly.</p>
<p class="nonindent">Overall, this custom <code class="calibre7"><strong class="calibre3">findAll</strong></code> method enhances the base service’s functionality to retrieve tasks with associated project and user details, while also allowing for conditional filtering based on specific criteria.</p>
<p class="nonindent">For a better understanding of which query is running, we can enable logging in the config of the database connection, in the <code class="calibre7"><strong class="calibre3">connectDatabase</strong></code> function in <code class="calibre7"><strong class="calibre3">db.ts</strong></code> file:</p>
<p class="code"><code class="calibre7">public async connectDatabase() {</code></p>
<p class="code3"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">if (DatabaseUtil.connection) {</code></p>
<p class="code5"><code class="calibre7">return DatabaseUtil.connection;</code></p>
<p class="code4"><code class="calibre7">} else {</code></p>
<p class="code5"><code class="calibre7">const db_config = this.server_config.db_config;</code></p>
<p class="code5"><code class="calibre7">const AppSource = new DataSource({</code></p>
<p class="code6"><code class="calibre7">type: 'postgres',</code></p>
<p class="code6"><code class="calibre7">host: db_config.host,</code></p>
<p class="code6"><code class="calibre7">port: db_config.port,</code></p>
<p class="code6"><code class="calibre7">username: db_config.username,</code></p>
<p class="code6"><code class="calibre7">password: db_config.password,</code></p>
<p class="code6"><code class="calibre7">database: db_config.dbname,</code></p>
<p class="code6"><code class="calibre7">entities: [Roles, Users, Projects, Tasks, Comments],</code></p>
<p class="code6"><code class="calibre7">synchronize: true,</code></p>
<p class="code6"><code class="calibre7">logging: true,</code></p>
<p class="code6"><code class="calibre7">poolSize: 10</code></p>
<p class="code5"><code class="calibre7">});</code></p>
<p class="code5"><code class="calibre7">await AppSource.initialize();</code></p>
<p class="code5"><code class="calibre7">DatabaseUtil.connection = AppSource;</code></p>
<p class="code5"><code class="calibre7">console.log('Connected to the database');</code></p>
<p class="code5"><code class="calibre7">return DatabaseUtil.connection;</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><code class="calibre7"><a id="page246"/>console.error('Error connecting to the database:', error);</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent">The `<code class="calibre7"><strong class="calibre3">getAllHandler`</strong></code> method uses the <code class="calibre7"><strong class="calibre3">TasksService</strong></code> class to retrieve all projects from the database based on the query parameters in the request. The resulting data is then sent back to the client with an appropriate HTTP status code and formatted as JSON.</p>
<p class="nonindent">This controller method call in routes with a change in <code class="calibre7"><strong class="calibre3">tasks_routes.ts</strong></code> as follows:</p>
<p class="code"><code class="calibre7"> app.route(this.baseEndPoint)</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.post(validate(validProjectInput), controller.addHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.get(controller.getAllHandler);</strong></code></p>
<p class="nonindent">By employing this approach, we establish a <code class="calibre7"><strong class="calibre3">GET</strong></code> route that fetches all tasks stored in the database, effectively functioning as a REST API endpoint for retrieving task data.</p>
<p class="nonindent">When above API is triggered in terminal, you can see query as follows :</p>
<figure class="img">
<img alt="" src="img/6.5.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_5"><strong class="calibre3">Figure 6.5:</strong> Enable Query Logging</p>
<p class="nonindent">Now, copy this query and run in <code class="calibre7"><strong class="calibre3">pgAdmin</strong></code> or <code class="calibre7"><strong class="calibre3">DBeaver</strong></code> as follows:</p>
<figure class="img">
<img alt="" src="img/6.6.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_6"><strong class="calibre3">Figure 6.6:</strong> PgAdmin Run Query</p>
<p class="nonindent"><strong class="calibre3"><a id="page247"/>REST API GetAll Tasks</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/tasks</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="code1"><code class="calibre7">Query Params: {}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"task_id": "74f61799-7046-47d9-8f04-897f07b4e178",</code></p>
<p class="code4"><code class="calibre7">"name": "Setup Database",</code></p>
<p class="code4"><code class="calibre7">"description": "create one postgres database and setup database for project management project",</code></p>
<p class="code4"><code class="calibre7">"estimated_start_time": "2023-09-30T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"estimated_end_time": "2023-10-01T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"actual_start_time": null,</code></p>
<p class="code4"><code class="calibre7">"actual_end_time": null,</code></p>
<p class="code4"><code class="calibre7">"priority": "Low",</code></p>
<p class="code4"><code class="calibre7">"status": "Not-Started",</code></p>
<p class="code4"><code class="calibre7">"supported_files": [],</code></p>
<p class="code4"><code class="calibre7">"created_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code4"><code class="calibre7">"updated_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code4"><code class="calibre7">"projectDetails": {</code></p>
<p class="code5"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code5"><code class="calibre7">"name": "Project Management"</code></p>
<p class="code4"><code class="calibre7">},</code></p>
<p class="code4"><code class="calibre7">"userDetails": {</code></p>
<p class="code5"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code5"><code class="calibre7">"username": "yamini",</code></p>
<p class="code5"><code class="calibre7">"email": "yamipanchal1993@gmail.com"</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s189"><a id="page248" class="calibre6"/><a href="toc.xhtml#s189a" class="calibre6">Search Task</a></h1>
<p class="nonindent">To search for a task by <code class="calibre7"><strong class="calibre3">project_id</strong></code>, <code class="calibre7"><strong class="calibre3">projectname</strong></code>, or <code class="calibre7"><strong class="calibre3">username</strong></code>, you can utilize the same API endpoint as the one used for retrieving all tasks. However, in this case, you will include query parameters to specify the search criteria.</p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/projects?projectname=project&amp;</code></p>
<p class="code1"><code class="calibre7">username=yamini</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="code1"><code class="calibre7">Query Params: {</code></p>
<p class="code2"><code class="calibre7">"projectname": "project",</code></p>
<p class="code2"><code class="calibre7">"username":"yamini"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><strong class="calibre3">Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": [</code></p>
<p class="code3"><code class="calibre7">{</code></p>
<p class="code4"><code class="calibre7">"task_id": "74f61799-7046-47d9-8f04-897f07b4e178",</code></p>
<p class="code4"><code class="calibre7">"name": "Setup Database",</code></p>
<p class="code4"><code class="calibre7">"description": "create one postgres database and setup database for project management project",</code></p>
<p class="code4"><code class="calibre7">"estimated_start_time": "2023-09-30T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"estimated_end_time": "2023-10-01T18:30:00.000Z",</code></p>
<p class="code4"><code class="calibre7">"actual_start_time": null,</code></p>
<p class="code4"><code class="calibre7">"actual_end_time": null,</code></p>
<p class="code4"><code class="calibre7">"priority": "Low",</code></p>
<p class="code4"><code class="calibre7">"status": "Not-Started",</code></p>
<p class="code4"><code class="calibre7">"supported_files": [],</code></p>
<p class="code4"><code class="calibre7">"created_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code4"><code class="calibre7">"updated_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code4"><code class="calibre7">"projectDetails": {</code></p>
<p class="code5"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code5"><code class="calibre7">"name": "Project Management"</code></p>
<p class="code4"><code class="calibre7">},</code></p>
<p class="code4"><code class="calibre7">"userDetails": {</code></p>
<p class="code5"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code5"><code class="calibre7">"username": "yamini",</code></p>
<p class="code5"><code class="calibre7">"email": "yamipanchal1993@gmail.com"</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">]</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s190"><a id="page249" class="calibre6"/><a href="toc.xhtml#s190a" class="calibre6">GetOne Task</a></h1>
<p class="nonindent">The “<em class="calibre4">Retrieve Individual Task</em>” endpoint holds a significant role within project management systems. It grants users access to comprehensive task details without necessitating the retrieval of the entire task catalog. This capability is crucial for delivering accurate insights into the specific attributes and permissions associated with each task.</p>
<p class="nonindent">To implement the <code class="calibre7"><strong class="calibre3">"GetOne Task"</strong></code> API, modify the <code class="calibre7"><strong class="calibre3">getOneHandler</strong></code> code in the task controller as follows:</p>
<p class="code"><code class="calibre7"> public async getOneHandler(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'get_details_task')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const service = new TaskService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.findOne(req.params.id);</code></p>
<p class="code5"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent">The <code class="calibre7"><strong class="calibre3">`getOneHandler</strong></code><strong class="calibre3">`</strong> function serves as the bridge between the incoming client request, the service layer that interacts with the database, and the outgoing HTTP response. It retrieves a single task’s details from the database based on the provided task ID and sends the task information back to the client.</p>
<p class="nonindent">Similarly, override <code class="calibre7"><strong class="calibre3">findAll</strong></code> method in service needs to override the <code class="calibre7"><strong class="calibre3">findOne</strong></code> method in the <code class="calibre7"><strong class="calibre3">tasks_service.ts</strong></code> file with the following code:</p>
<p class="code"><code class="calibre7">override async findOne(id: string): Promise&lt;ApiResponse&lt;Tasks&gt; |</code></p>
<p class="code1"><code class="calibre7">undefined&gt; {</code></p>
<p class="code3"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">// Build the WHERE condition based on the primary key</code></p>
<p class="code4"><code class="calibre7">const where = {};</code></p>
<p class="code4"><code class="calibre7">const primaryKey: string =</code></p>
<p class="code"><code class="calibre7">this.taskRepository.metadata.primaryColumns[0].databaseName;</code></p>
<p class="code4"><code class="calibre7">where[primaryKey] = id;</code></p>
<p class="code3a"><a id="page250"/><code class="calibre7">// Use the repository to find the entity based on the provided ID</code></p>
<p class="code4"><code class="calibre7">const data = await this.taskRepository</code></p>
<p class="code5"><code class="calibre7">.createQueryBuilder('task')</code></p>
<p class="code5"><code class="calibre7">.leftJoin('task.project_id', 'project')</code></p>
<p class="code5"><code class="calibre7">.leftJoin('task.user_id', 'user')</code></p>
<p class="code5"><code class="calibre7">.addSelect([</code></p>
<p class="code6"><code class="calibre7">'task.*',</code></p>
<p class="code6"><code class="calibre7">'task.project_id as project',</code></p>
<p class="code6"><code class="calibre7">'project.project_id',</code></p>
<p class="code6"><code class="calibre7">'project.name',</code></p>
<p class="code6"><code class="calibre7">'user.user_id',</code></p>
<p class="code6"><code class="calibre7">'user.username',</code></p>
<p class="code6"><code class="calibre7">'user.email',</code></p>
<p class="code5"><code class="calibre7">])</code></p>
<p class="code5"><code class="calibre7">.where(where)</code></p>
<p class="code5"><code class="calibre7">.getOne();</code></p>
<p class="code4"><code class="calibre7">if (data) {</code></p>
<p class="code5"><code class="calibre7">data['projectDetails'] = data.project_id;</code></p>
<p class="code5"><code class="calibre7">data['userDetails'] = data.user_id;</code></p>
<p class="code5"><code class="calibre7">delete data.project_id;</code></p>
<p class="code5"><code class="calibre7">delete data.user_id;</code></p>
<p class="code5"><code class="calibre7">return { statusCode: 200, status: 'success', data: data };</code></p>
<p class="code4"><code class="calibre7">} else {</code></p>
<p class="code5"><code class="calibre7">return { statusCode: 404, status: 'error', message: 'Not Found' };</code></p>
<p class="code4"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><code class="calibre7">return { statusCode: 500, status: 'error', message: error.message };</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent"><a id="page251"/>In this context, we have introduced a <code class="calibre7"><strong class="calibre3">"where"</strong></code> condition to narrow down the data retrieval to a specific task. This condition is applied within the <code class="calibre7"><strong class="calibre3">getAOne</strong></code> method from the controller, which is invoked from the routes file by creating a new route as follows:</p>
<p class="code"><code class="calibre7"> app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.get(controller.getOneHandler);</strong></code></p>
<p class="nonindent">Here, `/:id ` will be a request parameter meant to capture the ID of the task that the user wants to retrieve.</p>
<p class="nonindent">Once you trigger an API query, it will be logged in the terminal as shown below, and then you can copy it, change $1 to actual parameters, and paste it into <code class="calibre7"><strong class="calibre3">pgAdmin</strong></code> or <code class="calibre7"><strong class="calibre3">DBeaver</strong></code> as follows:</p>
<figure class="img">
<img alt="" src="img/6.7.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_7"><strong class="calibre3">Figure 6.7:</strong> Get One Task Query</p>
<figure class="img">
<img alt="" src="img/6.8.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_8"><strong class="calibre3">Figure 6.8:</strong> PgAdmin GetOne Task Query Output</p>
<p class="nonindent"><strong class="calibre3">REST API GetOne Task</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/tasks/74f61799-7046-47d9-8f04-897f07b4e178</code></p>
<p class="code1"><code class="calibre7">Method: GET</code></p>
<p class="nonindent"><strong class="calibre3"><a id="page252"/>Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"task_id": "74f61799-7046-47d9-8f04-897f07b4e178",</code></p>
<p class="code3"><code class="calibre7">"name": "Setup Database",</code></p>
<p class="code3"><code class="calibre7">"description": "create one postgres database and setup database for project management project",</code></p>
<p class="code3"><code class="calibre7">"estimated_start_time": "2023-09-30T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"estimated_end_time": "2023-10-01T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"actual_start_time": null,</code></p>
<p class="code3"><code class="calibre7">"actual_end_time": null,</code></p>
<p class="code3"><code class="calibre7">"priority": "Low",</code></p>
<p class="code3"><code class="calibre7">"status": "Not-Started",</code></p>
<p class="code3"><code class="calibre7">"supported_files": [],</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code3"><code class="calibre7">"projectDetails": {</code></p>
<p class="code4"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code4"><code class="calibre7">"name": "Project Management"</code></p>
<p class="code3"><code class="calibre7">},</code></p>
<p class="code3"><code class="calibre7">"userDetails": {</code></p>
<p class="code4"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code4"><code class="calibre7">"username": "yamini",</code></p>
<p class="code4"><code class="calibre7">"email": "yamipanchal1993@gmail.com"</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">Providing a valid task ID will yield a successful response, while inputting an ID that doesn’t correspond to an existing database entry will result in a 404 error, signifying that the requested entity was not found.</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s191"><a id="page253" class="calibre6"/><a href="toc.xhtml#s191a" class="calibre6">Update Task</a></h1>
<p class="nonindent">The process of updating a task detail involves making changes to the existing data of a particular task that is stored in the database. Through this process, you can modify attributes such as the task’s name, description, and associated users or projects. Updating a task is crucial for maintaining the accuracy and currency of task information, especially when there are alterations in task permissions that need to be reflected in the database.</p>
<p class="nonindent">To implement the <code class="calibre7"><strong class="calibre3">"Update Task"</strong></code> API, make the following changes in the <code class="calibre7"><strong class="calibre3">updateHandler</strong></code> code within the project controller:</p>
<p class="code"><code class="calibre7"> public async <strong class="calibre3">updateHandler</strong>(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'edit_task')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const task = req.body;</code></p>
<p class="code3"><code class="calibre7">const service = new TasksService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.update(req.params.id, task);</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="nonindent">The <strong class="calibre3">`</strong><code class="calibre7"><strong class="calibre3">updateHandler</strong></code><strong class="calibre3">`</strong> function handles requests to update a task. It begins by checking if the user has the necessary permission, and if so, it extracts the updated task data, initializes the task service, performs the update operation in the database, and responds to the client with the appropriate status code and result data. Here, we have added some validation in <code class="calibre7"><strong class="calibre3">updateTaskInput</strong></code>.</p>
<p class="nonindent">This method is called from the routes file by creating a new route for it as follows:</p>
<p class="code"><code class="calibre7">const <strong class="calibre3">updateTaskInput</strong> = [</code></p>
<p class="code2"><code class="calibre7">body('estimated_start_time').custom((value) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (value &amp;&amp; !checkValidDate(value)) {</code></p>
<p class="code4"><code class="calibre7"><a id="page254"/>throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(value);</code></p>
<p class="code3"><code class="calibre7">const currentTime = new Date();</code></p>
<p class="code3a"><code class="calibre7">if (startTime &lt;= currentTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Start time must be greater than the current time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">}),</code></p>
<p class="code2"><code class="calibre7">body('estimated_end_time').custom((value, { req }) =&gt; {</code></p>
<p class="code3"><code class="calibre7">if (value &amp;&amp; !checkValidDate(value)) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('Invalid date format YYYY-MM-DD HH:mm:ss');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const startTime = new Date(req.body.start_time);</code></p>
<p class="code3"><code class="calibre7">const endTime = new Date(value);</code></p>
<p class="code3a"><code class="calibre7">if (endTime &lt;= startTime) {</code></p>
<p class="code4"><code class="calibre7">throw new Error('End time must be greater than the start time');</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">return true;</code></p>
<p class="code2"><code class="calibre7">})</code></p>
<p class="code1"><code class="calibre7">];</code></p>
<p class="code1"><code class="calibre7"/></p>
<p class="code1"><code class="calibre7">app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code1"><code class="calibre7"> .all(authorize)</code></p>
<p class="code4"><code class="calibre7">.get(controller.getOneHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.put(validate(updateTaskInput), controller.updateHandler);</strong></code></p>
<p class="nonindent">Here, `<code class="calibre7"><strong class="calibre3">/:id</strong></code> ` will be a request parameter meant to capture the ID of the task that the user wants to retrieve, and it also validates data before updating in the database.</p>
<p class="nonindent"><strong class="calibre3">REST API Update Task</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/tasks/74f61799-7046-47d9-8f04-897f07b4e178</code></p>
<p class="code1"><code class="calibre7">Method: PUT</code></p>
<p class="code1"><code class="calibre7">body :</code></p>
<p class="code1"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"name":"Create Microservices",</code></p>
<p class="code2"><code class="calibre7">"description":"Add microservice to store data on cloud",</code></p>
<p class="code2"><code class="calibre7">"project_id":"c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code2"><code class="calibre7">"user_id":"d166945a-f85d-485c-bdac-0c8056b3188a",</code></p>
<p class="code2"><code class="calibre7">"status":"In-Progress"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent"><strong class="calibre3"><a id="page255"/>Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success",</code></p>
<p class="code2"><code class="calibre7">"data": {</code></p>
<p class="code3"><code class="calibre7">"task_id": "74f61799-7046-47d9-8f04-897f07b4e178",</code></p>
<p class="code3"><code class="calibre7">"name": "Create Microservices",</code></p>
<p class="code3"><code class="calibre7">"description": "Add microservice to store data on cloud",</code></p>
<p class="code3"><code class="calibre7">"estimated_start_time": "2023-09-30T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"estimated_end_time": "2023-10-01T18:30:00.000Z",</code></p>
<p class="code3"><code class="calibre7">"actual_start_time": null,</code></p>
<p class="code3"><code class="calibre7">"actual_end_time": null,</code></p>
<p class="code3"><code class="calibre7">"priority": "Low",</code></p>
<p class="code3"><code class="calibre7">"status": "In-Progress",</code></p>
<p class="code3"><code class="calibre7">"supported_files": [],</code></p>
<p class="code3"><code class="calibre7">"created_at": "2023-09-30T12:17:51.138Z",</code></p>
<p class="code3"><code class="calibre7">"updated_at": "2023-10-07T15:57:21.912Z",</code></p>
<p class="code3"><code class="calibre7">"project_id": "c2e9b17b-0af2-453b-b0c9-43ea2d304dca",</code></p>
<p class="code3"><code class="calibre7">"user_id": "d166945a-f85d-485c-bdac-0c8056b3188a"</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">Providing a valid task ID will yield a successful response, while inputting an ID that doesn’t correspond to an existing database entry will result in a <code class="calibre7"><strong class="calibre3">404</strong></code> error, signifying that the requested entity was not found.</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<h1 class="sec" id="s192"><a href="toc.xhtml#s192a" class="calibre6">Delete Task</a></h1>
<p class="nonindent">The "<code class="calibre7"><strong class="calibre3">delete</strong></code>” functionality for tasks in a REST API involves the removal of a specific task from the database. This process is managed through an endpoint dedicated to task deletion. When a request is made to this endpoint, it triggers a function that <a id="page256"/>handles the deletion process. The incoming request typically contains the unique identifier (<code class="calibre7"><strong class="calibre3">task_id</strong></code>) of the task that needs to be deleted.</p>
<p class="nonindent">To implement the <code class="calibre7"><strong class="calibre3">Delete</strong></code> Task API, make the following changes in the <code class="calibre7"><strong class="calibre3">deleteHandler</strong></code> code in the task controller as follows:</p>
<p class="code"><code class="calibre7">public async <strong class="calibre3">deleteHandler</strong>(req: Request, res: Response): Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">if (!hasPermission(req.user.rights, 'delete_task')) {</code></p>
<p class="code4"><code class="calibre7">res.status(403).json({ statusCode: 403, status: 'error', message: 'Unauthorised' });</code></p>
<p class="code4"><code class="calibre7">return;</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code3"><code class="calibre7">const service = new TasksService();</code></p>
<p class="code3"><code class="calibre7">const result = await service.delete(req.params.id);</code></p>
<p class="code3"><code class="calibre7">res.status(result.statusCode).json(result);</code></p>
<p class="code1"><code class="calibre7"> }</code></p>
<p class="nonindent">The <code class="calibre7"><strong class="calibre3">`deleteHandler`</strong></code> processes the request by utilizing a service that interacts with the database. This service is responsible for executing the deletion operation. If the requested project exists in the database and the deletion is successful, the function responds with a success message and an appropriate status code, such as <code class="calibre7"><strong class="calibre3">200 OK</strong></code>. If the role does not exist, the function returns an error response with a status code of <code class="calibre7"><strong class="calibre3">404 Not Found</strong></code>, indicating that the project was not located in the database.</p>
<p class="nonindent">This method is called from the routes file by creating a new route for it as follows:</p>
<p class="code"><code class="calibre7"> app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.get(controller.getOneHandler)</code></p>
<p class="code4"><code class="calibre7">.put(validate(updateTaskInput), controller.updateHandler)</code></p>
<p class="code4"><code class="calibre7"><strong class="calibre3">.delete(controller.deleteHandler);</strong></code></p>
<p class="nonindent">Here, `<code class="calibre7"><strong class="calibre3">/:id</strong></code> ` will be a request parameter meant to capture the ID of the task that the user wants to delete.</p>
<p class="nonindent"><strong class="calibre3">REST API Delete Task</strong></p>
<p class="nonindent"><strong class="calibre3">Request</strong></p>
<p class="code"><code class="calibre7">URL : http://127.0.0.1:3000/api/tasks/74f61799-7046-47d9-8f04-897f07b4e178</code></p>
<p class="code1"><code class="calibre7">Method: DELETE</code></p>
<p class="nonindent"><strong class="calibre3"><a id="page257"/>Response</strong></p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 200,</code></p>
<p class="code2"><code class="calibre7">"status": "success"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In the case of an already deleted or not exist in the database:</p>
<p class="code"><code class="calibre7">{</code></p>
<p class="code2"><code class="calibre7">"statusCode": 404,</code></p>
<p class="code2"><code class="calibre7">"status": "error",</code></p>
<p class="code2"><code class="calibre7">"message": "Not Found"</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">We’ve established various modules such as <code class="calibre7"><strong class="calibre3">Role</strong></code>, <code class="calibre7"><strong class="calibre3">User</strong></code>, <code class="calibre7"><strong class="calibre3">Project</strong></code>, and <code class="calibre7"><strong class="calibre3">Task</strong></code>. Similarly, you can create a Comment module and build APIs for handling comments. Within this module, comments are associated with a <code class="calibre7"><strong class="calibre3">task_id</strong></code>. Users can add comments related to tasks, update their own comments, and delete their own comments. This aspect of the project is meant for your personal learning and experimentation.</p>
<h1 class="sec" id="s193"><a href="toc.xhtml#s193a" class="calibre6">Upload Supported Files</a></h1>
<p class="nonindent">In both tasks and comments, the ability to attach files is provided through the file module. You can create a file module that includes CRUD (Create, Read, Update, Delete) operations, following a structure similar to that of the project and task modules. The file module should define database fields such as <code class="calibre7"><strong class="calibre3">file_id</strong></code>, <code class="calibre7"><strong class="calibre3">file_url</strong></code>, <code class="calibre7"><strong class="calibre3">file_name</strong></code>, <code class="calibre7"><strong class="calibre3">created_by</strong></code>, <code class="calibre7"><strong class="calibre3">created_at</strong></code>, <code class="calibre7"><strong class="calibre3">updated_at</strong></code>, and more. Additionally, within the supported files array, you can add or remove <code class="calibre7"><strong class="calibre3">file_id</strong></code> based on the corresponding action taken.</p>
<p class="nonindent">For reference, the <code class="calibre7"><strong class="calibre3">file_entity.ts</strong></code> is as follows:</p>
<p class="code"><code class="calibre7">import { Entity, PrimaryGeneratedColumn, Column, CreateDateColumn, UpdateDateColumn, JoinColumn, ManyToOne } from 'typeorm';</code></p>
<p class="code1"><code class="calibre7">import { Users } from '../users/users_entity';</code></p>
<p class="code1"><code class="calibre7">import { Tasks } from '../tasks/tasks_entity';</code></p>
<p class="code"><code class="calibre7">@Entity()</code></p>
<p class="code1"><code class="calibre7">export class Files {</code></p>
<p class="code2"><code class="calibre7">@PrimaryGeneratedColumn('uuid')</code></p>
<p class="code2"><code class="calibre7">file_id: string;</code></p>
<p class="code2a"><code class="calibre7">@Column({ length: 30, nullable: false, unique: true })</code></p>
<p class="code2"><code class="calibre7"><a id="page258"/>file_name: string;</code></p>
<p class="code2a"><code class="calibre7">@Column({ length: 30 })</code></p>
<p class="code2"><code class="calibre7">mime_type: string;</code></p>
<p class="code2a"><code class="calibre7">@Column()</code></p>
<p class="code2"><code class="calibre7">@ManyToOne(() =&gt; Users, (userData) =&gt; userData.user_id)</code></p>
<p class="code2"><code class="calibre7">@JoinColumn({ name: 'user_id' })</code></p>
<p class="code2"><code class="calibre7">created_by: string;</code></p>
<p class="code2a"><code class="calibre7">@Column()</code></p>
<p class="code2"><code class="calibre7">@ManyToOne(() =&gt; Tasks, (taskData) =&gt; taskData.task_id)</code></p>
<p class="code2"><code class="calibre7">@JoinColumn({ name: 'task_id' })</code></p>
<p class="code2"><code class="calibre7">task_id: string;</code></p>
<p class="code2a"><code class="calibre7">@Column()</code></p>
<p class="code2"><code class="calibre7">@CreateDateColumn()</code></p>
<p class="code2"><code class="calibre7">created_at: Date;</code></p>
<p class="code2a"><code class="calibre7">@Column()</code></p>
<p class="code2"><code class="calibre7">@UpdateDateColumn()</code></p>
<p class="code2"><code class="calibre7">updated_at: Date;</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">To send files from your website to your Node.js server, we will use <code class="calibre7"><strong class="calibre3">Multer</strong></code>. It’s widely used for its ability to easily handle file uploads. Once a file is uploaded, <code class="calibre7"><strong class="calibre3">Multer</strong></code> lets you save it in a specific folder on your server. Not only does it help with storing files, but it also helps you keep track of their locations, making it easier to access and manage these files later.</p>
<p class="nonindent"><code class="calibre7"><strong class="calibre3">Multer</strong></code> integrates with Node.js smoothly and offers a straightforward way to upload files. The following steps will help to set up <code class="calibre7"><strong class="calibre3">Multer</strong></code> for our project:</p>
<ul class="bull">
<li class="calibre9"><strong class="calibre3">Install Multer</strong>
<p class="nonindent">First, make sure that you have Multer installed in your <code class="calibre7"><strong class="calibre3">Node.js</strong></code> project. If you haven’t already, you can install it using npm:</p>
<p class="code"><code class="calibre7">$ npm install multer uuid --save</code></p>
<p class="code1"><code class="calibre7">$ npm install @types/multer @types/uuid --save-dev</code></p></li>
<li class="calibre9"><a id="page259"/>Create one folder in root directory as <code class="calibre7"><strong class="calibre3">attachedFiles</strong></code> where all files will be uploaded. In<code class="calibre7"> <strong class="calibre3">server_config.json</strong></code>, add one parameter for path of uploaded files absolute path and change in <code class="calibre7"><strong class="calibre3">IServerConfig</strong></code> interface as follows: 
<p class="code"><code class="calibre7">export interface IServerConfig {</code></p>
<p class="code2"><code class="calibre7">port: number;</code></p>
<p class="code2"><code class="calibre7">db_config: {</code></p>
<p class="code3"><code class="calibre7">'db': string;</code></p>
<p class="code3"><code class="calibre7">'username': string;</code></p>
<p class="code3"><code class="calibre7">'password': string;</code></p>
<p class="code3"><code class="calibre7">'host': string;</code></p>
<p class="code3"><code class="calibre7">'port': number;</code></p>
<p class="code3"><code class="calibre7">'dbname': string;</code></p>
<p class="code2"><code class="calibre7">};</code></p>
<p class="code2"><code class="calibre7">email_config: {</code></p>
<p class="code3"><code class="calibre7">'from': string;</code></p>
<p class="code3"><code class="calibre7">'user': string;</code></p>
<p class="code3"><code class="calibre7">'password': string;</code></p>
<p class="code2"><code class="calibre7">};</code></p>
<p class="code2"><code class="calibre7">front_app_url: string;</code></p>
<p class="code2"><code class="calibre7">default_user?: {</code></p>
<p class="code3"><code class="calibre7">email: string;</code></p>
<p class="code3"><code class="calibre7">password: string;</code></p>
<p class="code2"><code class="calibre7">};</code></p>
<p class="code2"><code class="calibre7">attached_files_path?: string;</code></p>
<p class="code1"><code class="calibre7">}</code></p></li>
<li class="calibre9"><strong class="calibre3">Develop Multer Middleware</strong>
<p class="nonindent">In the utils directory, create a file named <code class="calibre7"><strong class="calibre3">multer.ts</strong></code> for a middleware that uploads files to a specific folder with the following code:</p>
<p class="code"><code class="calibre7">import multer from 'multer';</code></p>
<p class="code1"><code class="calibre7">import { Request } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { IServerConfig } from './config';</code></p>
<p class="code1"><code class="calibre7">import * as config from '../../server_config.json';</code></p>
<p class="code"><code class="calibre7">// Define the options for Multer</code></p>
<p class="code1"><code class="calibre7">export const multerConfig = {</code></p>
<p class="code2"><code class="calibre7"><a id="page260"/>storage: multer.diskStorage({</code></p>
<p class="code3"><code class="calibre7">destination: (req, file, cb) =&gt; {</code></p>
<p class="code4"><code class="calibre7">// Set the destination folder where files will be saved</code></p>
<p class="code4"><code class="calibre7">const server_config: IServerConfig = config;</code></p>
<p class="code4"><code class="calibre7">cb(null, server_config.attached_files_path); // Change 'attachedFiles' to your desired folder name</code></p>
<p class="code3"><code class="calibre7">},</code></p>
<p class="code3a"><code class="calibre7">filename: (req, file, cb) =&gt; {</code></p>
<p class="code4"><code class="calibre7">// Generate a unique filename for the uploaded file</code></p>
<p class="code4"><code class="calibre7">const uniqueFileName = `${Date.now()}-${file.</code></p>
<p class="code1"><code class="calibre7">originalname}`;</code></p>
<p class="code4"><code class="calibre7">cb(null, uniqueFileName);</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}),</code></p>
<p class="code2"><code class="calibre7">fileFilter: (req, file, cb) =&gt; {</code></p>
<p class="code3"><code class="calibre7">// Define the allowed file types (MIME types) here.</code></p>
<p class="code3"><code class="calibre7">const allowedMimeTypes = ['image/jpeg', 'image/png', 'application/pdf'];</code></p>
<p class="code3a"><code class="calibre7">// Check if the uploaded file's MIME type is in the allowed list.</code></p>
<p class="code3"><code class="calibre7">if (allowedMimeTypes.includes(file.mimetype)) {</code></p>
<p class="code4"><code class="calibre7">cb(null, true); // Accept the file</code></p>
<p class="code3"><code class="calibre7">} else {</code></p>
<p class="code4"><code class="calibre7">cb(new Error('Invalid file type. Only PDF, JPEG, and PNG files are allowed.'), false); // Reject the file</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">};</code></p>
<p class="code"><code class="calibre7">const upload = multer(multerConfig);</code></p>
<p class="code1"><code class="calibre7">// Export the Multer middleware</code></p>
<p class="code1"><code class="calibre7">export const fileUploadMiddleware = upload.single('file');</code></p>
<p class="code1"><code class="calibre7">export const uploadFile = (req: Request) =&gt; {</code></p>
<p class="code2a"><code class="calibre7"><a id="page261"/>if (!req.file) {</code></p>
<p class="code3"><code class="calibre7">throw new Error('No file provided');</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code2a"><code class="calibre7">// Here you can perform additional processing and file storage logic</code></p>
<p class="code2"><code class="calibre7">// For example, save the file to a storage service or local directory</code></p>
<p class="code2"><code class="calibre7">const fileData = req.file;</code></p>
<p class="code2a"><code class="calibre7">return fileData;</code></p>
<p class="code1"><code class="calibre7">};</code></p></li>
</ul>
<p class="nonindent">Here in the code, <code class="calibre7"><strong class="calibre3">attachedFiles</strong></code> is the directory name where uploaded files are stored. You can change the name as you want. We allow only PDF and image file types, which are also changeable.</p>
<ul class="bull">
<li class="calibre9"><strong class="calibre3">Handle File Uploads in Your Route</strong>
<p class="nonindent">In your file module creation API, use the Multer middleware you created to handle file uploads. Here’s an example of how to use it in an Express route:</p>
<p class="code"><code class="calibre7">import { Express } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { FileController } from './files_controller';</code></p>
<p class="code1"><code class="calibre7">import { fileUploadMiddleware } from '../../utils/multer';</code></p>
<p class="code1"><code class="calibre7">import { authorize } from '../../utils/auth_util';</code></p>
<p class="code1"><code class="calibre7">export class FileRoutes {</code></p>
<p class="code2a"><code class="calibre7">private baseEndPoint = '/api/files';</code></p>
<p class="code2a"><code class="calibre7">constructor(app: Express) {</code></p>
<p class="code3a"><code class="calibre7">const controller = new FileController();</code></p>
<p class="code3"><code class="calibre7">app.route(this.baseEndPoint)</code></p>
<p class="code4"><code class="calibre7">.all(authorize)</code></p>
<p class="code4"><code class="calibre7">.post(fileUploadMiddleware, controller.addHandler);</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code1"><code class="calibre7">}</code></p>
<p class="nonindent">In the controller, the following code is used to store <code class="calibre7"><strong class="calibre3">fileData</strong></code> in the database, which is called from the router:</p>
<p class="code"><code class="calibre7"><a id="page262"/>import { BaseController } from '../../utils/base_controller';</code></p>
<p class="code1"><code class="calibre7"><strong class="calibre3">import { uploadFile } from '../../utils/multer';</strong></code></p>
<p class="code1"><code class="calibre7">import { Request, Response } from 'express';</code></p>
<p class="code1"><code class="calibre7">import { FilesService } from './files_service';</code></p>
<p class="code1"><code class="calibre7">import { Files } from './files_entity';</code></p>
<p class="code"><code class="calibre7">export class FileController extends BaseController {</code></p>
<p class="code2a"><code class="calibre7">/**</code></p>
<p class="code2"><code class="calibre7">* Handles the addition of a new file.</code></p>
<p class="code2"><code class="calibre7">* @param {object} req - The request object.</code></p>
<p class="code2"><code class="calibre7">* @param {object} res - The response object.</code></p>
<p class="code2"><code class="calibre7">*/</code></p>
<p class="code2"><code class="calibre7">public async addHandler(req: Request, res: Response):</code></p>
<p class="code1"><code class="calibre7">Promise&lt;void&gt; {</code></p>
<p class="code3a"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">const fileDataFromMulter = <strong class="calibre3">uploadFile</strong>(req);</code></p>
<p class="code4"><code class="calibre7">// Create an instance of the ProjectService</code></p>
<p class="code4"><code class="calibre7">const service = new FilesService();</code></p>
<p class="code4"><code class="calibre7">const fileData = new Files();</code></p>
<p class="code4"><code class="calibre7">fileData.file_name = fileDataFromMulter.filename;</code></p>
<p class="code4"><code class="calibre7">fileData.mime_type = fileDataFromMulter.mimetype;</code></p>
<p class="code4"><code class="calibre7">fileData.created_by = req?.user?.user_id ? req?.user?.user_id :</code></p>
<p class="code6"><code class="calibre7">null;</code></p>
<p class="code4"><code class="calibre7">const createdTask = await service.create(fileData);</code></p>
<p class="code4"><code class="calibre7">res.status(201).json(createdTask);</code></p>
<p class="code4a"><code class="calibre7">res.status(200).json({ message: 'File uploaded successfully', fileData });</code></p>
<p class="code3"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><code class="calibre7">res.status(400).json({ error: error.message });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">public async getAllHandler(req: Request, res: Response): Promise&lt;void&gt; { }</code></p>
<p class="code2"><code class="calibre7">public async getOneHandler(req: Request, res: Response): Promise&lt;void&gt; { }</code></p>
<p class="code2"><code class="calibre7">public async updateHandler(req: Request, res: Response): Promise&lt;void&gt; { }</code></p>
<p class="code2"><code class="calibre7">public async deleteHandler(req: Request, res: Response): Promise&lt;void&gt; { }</code></p>
<p class="code1"><code class="calibre7">}</code></p></li>
</ul>
<p class="nonindent"><a id="page263"/>From Postman, once you hit API, the following output will be displayed:</p>
<figure class="img">
<img alt="" src="img/6.9.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_9"><strong class="calibre3">Figure 6.9:</strong> Upload File API</p>
<p class="nonindent">As per the code from the Multer middleware, the file is uploaded, and their data is stored in the database. Once the file data is stored, add that <code class="calibre7"><strong class="calibre3">file_id</strong></code> in the task or comment module of the <code class="calibre7"><strong class="calibre3">supported_files</strong></code> array.</p>
<ul class="bull">
<li class="calibre9"><strong class="calibre3">Serve Uploaded Files</strong>
<p class="nonindent">To get uploaded file, we will create an API that will be <code class="calibre7"><strong class="calibre3">getOne</strong></code> file, so update <code class="calibre7"><strong class="calibre3">getOneHandler</strong></code> function in the controller with the following code:</p>
<p class="code"><code class="calibre7">public async getOneHandler(req: Request, res: Response):</code></p>
<p class="code1"><code class="calibre7">Promise&lt;void&gt; {</code></p>
<p class="code3"><code class="calibre7">try {</code></p>
<p class="code4"><code class="calibre7">const service = new FilesService();</code></p>
<p class="code4"><code class="calibre7">const server_config: IServerConfig = config;</code></p>
<p class="code4"><code class="calibre7">const result = await service.findOne(req.params.id);</code></p>
<p class="code4"><code class="calibre7">const file_path = `${server_config.attached_files_path}/${result.data.file_name}`;</code></p>
<p class="code4"><code class="calibre7">res.sendFile(file_path, (err) =&gt; {</code></p>
<p class="code5"><code class="calibre7">if (err) {</code></p>
<p class="code6"><a id="page264"/><code class="calibre7"> // Handle errors, such as file not found or permission issues</code></p>
<p class="code6"><code class="calibre7"> console.error('Error sending file:', err);</code></p>
<p class="code6"><code class="calibre7"> res.status(500).json({ error: err.message });</code></p>
<p class="code5"><code class="calibre7">} else {</code></p>
<p class="code6"><code class="calibre7"> res.status(200).end();</code></p>
<p class="code5"><code class="calibre7">}</code></p>
<p class="code4"><code class="calibre7">});</code></p>
<p class="code3"><code class="calibre7">} catch (error) {</code></p>
<p class="code4"><code class="calibre7">res.status(400).json({ error: error.message });</code></p>
<p class="code3"><code class="calibre7">}</code></p>
<p class="code2"><code class="calibre7">}</code></p>
<p class="code"><code class="calibre7">This method called from the routes file as follows:</code></p>
<p class="code1"><code class="calibre7">app.route(this.baseEndPoint + '/:id')</code></p>
<p class="code4"><code class="calibre7"> .all(authorize)</code></p>
<p class="code4"><code class="calibre7"> .get(controller.getOneHandler);</code></p></li>
</ul>
<p class="nonindent">Once the API is triggered from Postman, the file associated with the directory will be downloaded directly, as follows:</p>
<a id="page265"/>
<figure class="img">
<img alt="" src="img/6.10.jpg" class="calibre1"/>
</figure>
<p class="figcap" id="fig6_10"><strong class="calibre3">Figure 6.10:</strong> Get Uploaded File</p>
<p class="nonindent">By following these steps, you can use Multer to handle file uploads in your Node.js application, store files in a specific folder, and update file paths in your database.</p>
<h1 class="sec" id="s194"><a href="toc.xhtml#s194a" class="calibre6">Conclusion</a></h1>
<p class="nonindent">In this chapter, we crafted REST APIs for both the project and task modules, incorporating robust input validation and facilitating comprehensive CRUD operations. We also delved into the realm of advanced query capabilities with TypeORM, skillfully selecting specific columns to optimize performance.</p>
<p class="nonindent">Moreover, we ventured into the territory of file uploads in Node.js, leveraging the powerful capabilities of the Multer package.</p>
<p class="nonindent">In the next chapter, we will learn about API Caching, which is helpful in improving your application performance.</p>
<h1 class="sec" id="s195"><a href="toc.xhtml#s195a" class="calibre6">Further Reading</a></h1>
<p class="nonindent"><a href="https://github.com/expressjs/multer">https://github.com/expressjs/multer</a></p>

</body></html>