<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;FuncUnit"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. FuncUnit</h1></div></div></div><p><span class="strong"><strong>FuncUnit</strong></span> is a functional testing framework with <a id="id157" class="indexterm"/>jQuery-like syntax. It is built on top of the <span class="strong"><strong>QUnit</strong></span> unit test framework.</p><p>Using FuncUnit, we can run tests in all the modern web browsers under OS X, GNU/Linux, or Windows.</p><p>Writing a test is really easy and fast, especially if the reader is familiar with the jQuery syntax and/or the QUnit framework.</p><p>FuncUnit allow us to run tests in web browsers as well as integrates it with automation tools such as Selenium, or run tests from the command line using wrappers such as PhantomJS.</p><p>FuncUnit can be integrated with build tools, such as Maven, to run as a part of the build process. It can be integrated with continuous integration tools, such as Jenkins. More information on FuncUnit can be found at the following URLs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Documentation</strong></span><a id="id158" class="indexterm"/>: <a class="ulink" href="http://javascriptmvc.com/docs.html#!FuncUnit">http://javascriptmvc.com/docs.html#!FuncUnit</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Source code</strong></span>: <a id="id159" class="indexterm"/><a class="ulink" href="https://github.com/bitovi/funcunit">https://github.com/bitovi/funcunit</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>QUnit</strong></span>: <a class="ulink" href="http://docs.jquery.com/QUnit">http://docs.jquery.com/QUnit</a></li></ul></div><p>According to <a id="id160" class="indexterm"/>
<a id="id161" class="indexterm"/>Wikipedia, functional testing is defined as follows:</p><div class="blockquote"><blockquote class="blockquote"><p><a id="id162" class="indexterm"/><span class="emphasis"><em>Functional testing is a type of black box testing that bases its test cases on the specifications of the software component under test. Functions are tested by feeding them input and examining the output, and internal program structure is rarely considered.</em></span></p></blockquote></div><p>In this chapter, we are going to get an overview of the FuncUnit functional testing framework, create tests, and run them against our <code class="literal">Todo</code> application.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p><span class="strong"><strong>Unit testing versus functional testing</strong></span></p><p>Unit testing tests an individual unit-like method or function, while functional testing tests the entire functionality usually through the product user interface.</p></div></div><div class="section" title="Creating tests"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Creating tests</h1></div></div></div><p>Creating tests is writing a code that runs <a id="id163" class="indexterm"/>against application code to ensure that the code meets its design and behaves as intended. Writing tests can save time by finding bugs at the early development stage.</p><p>Lets add our first test for the <code class="literal">Todo</code> app:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">Todo/todo</code> folder, create a folder named <code class="literal">tests</code>. Inside it, create a file named <code class="literal">todo_test.html</code> with following content:<div class="informalexample"><pre class="programlisting">&lt;!doctype html&gt;

&lt;html&gt;
  &lt;head&gt;
<span class="strong"><strong>    &lt;title&gt;Todo List - tests&lt;/title&gt;</strong></span>
    &lt;meta charset="UTF-8" /&gt;
    &lt;link rel="stylesheet" href="../../funcunit/qunit/qunit.css" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1 id="qunit-header"&gt;AutoSuggest Test Suite&lt;/h1&gt;

    &lt;h2 id="qunit-banner"&gt;&lt;/h2&gt;

    &lt;div id="qunit-testrunner-toolbar"&gt;&lt;/div&gt;
    &lt;h2 id="qunit-userAgent"&gt;&lt;/h2&gt;
    &lt;ol id="qunit-tests"&gt;&lt;/ol&gt;
<span class="strong"><strong> &lt;script src="../../steal/steal.js?todo/tests/todo_test.js"&gt;&lt;/script&gt;</strong></span>	
  &lt;/body&gt;
&lt;/html&gt;</pre></div><p>This file provides a page skeleton that is populated with the FuncUnit output, which remains the same for all future test cases—use it as a template; only the title and path to the test file will change (highlighted code).</p></li><li class="listitem">Next, <a id="id164" class="indexterm"/>create a <code class="literal">todo_test.js</code> file with following content:<div class="informalexample"><pre class="programlisting">steal(
  'funcunit',
  function ($) {

    module('Todo app', {
      setup: function () {
        S.open('//todo/todo.html');
      }
    });

    test('page has #todos placeholder', function () {
      ok(S('body &gt; #todos').size(), 'The #todo is child of the body');
    });
  }
);</pre></div></li></ol></div><div class="section" title="Module"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Module</h2></div></div></div><p>A module signature is given by <code class="literal">module(name, [lifecycle]);</code>.</p><p>The module method comes <a id="id165" class="indexterm"/>
<a id="id166" class="indexterm"/>from the QUnit project and provides the functionality to divide test into modules.</p><p>The first parameter is a string with a module name. The second one is an object with two possible methods, <code class="literal">setup</code> and <code class="literal">teardown</code>. The <code class="literal">setup</code> callback method runs before each test, while the <code class="literal">teardown</code> runs after each test in the module.</p><div class="section" title="Open"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec20"/>Open</h3></div></div></div><p>An open signature is <a id="id167" class="indexterm"/>
<a id="id168" class="indexterm"/>given by <code class="literal">open(path, [success], [timeout])</code>.</p><p>In our example, we used the <code class="literal">open</code> method to open a given URL and run it against the test <code class="literal">'page has #todos placeholder'</code>.</p></div></div><div class="section" title="Test"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>Test</h2></div></div></div><p>A test signature is <a id="id169" class="indexterm"/>
<a id="id170" class="indexterm"/>given by <code class="literal">test(name, [expected], test)</code>.</p><p>This method runs the actual test code.</p><p>The first parameter is the name of the test, while the second is required to actually run the code.</p><div class="section" title="Ok"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec21"/>Ok</h3></div></div></div><p>An ok signature <a id="id171" class="indexterm"/>
<a id="id172" class="indexterm"/>is given by <code class="literal">ok(state, [message])</code>.</p><p>The <code class="literal">ok</code> method is a Boolean assertion. If the first parameter evaluates to true, the test passes. The second parameter is optional and it describes test.</p></div><div class="section" title="S"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec22"/>S</h3></div></div></div><p><code class="literal">S</code> is basically copy of the jQuery <a id="id173" class="indexterm"/>
<a id="id174" class="indexterm"/>shortcut <code class="literal">$</code>, extended by FuncUnit-specific methods.</p></div></div></div></div>
<div class="section" title="Running tests"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Running tests</h1></div></div></div><p>There are quite few ways to run tests. <a id="id175" class="indexterm"/>Using a web browser, a command-line tool will open the web browser and close it after the test execution is completed. We can also run tests using standalone JavaScript environments.</p><div class="section" title="Web browser"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec20"/>Web browser</h2></div></div></div><p>Disable the pop-up blocker and <a id="id176" class="indexterm"/>open <code class="literal">tests/todo_test.html</code> in the <a id="id177" class="indexterm"/>browser. The test will open the <code class="literal">Todo</code> application and run the test case against it. After this, you should be able to see something similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/0205OS_03_01.jpg" alt="Web browser"/></div></div><div class="section" title="Selenium"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>Selenium</h2></div></div></div><p>Run the following command <a id="id178" class="indexterm"/>from the <code class="literal">Todo</code> app directory:</p><div class="informalexample"><pre class="programlisting">$ ./js funcunit/run selenium todo/tests/todo_test.html</pre></div><p>This command will open Firefox, run <a id="id179" class="indexterm"/>exactly the same test as in the web browser example, close the browser, and print the results on a command line.</p></div><div class="section" title="PhantomJS"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>PhantomJS</h2></div></div></div><p>A much faster solution is running test <a id="id180" class="indexterm"/>using PhantomJS, because it doesn't launch <a id="id181" class="indexterm"/>the web browser.</p><p>Execute following command to run the test:</p><div class="informalexample"><pre class="programlisting">$ ./js funcunit/run phantomjs todo/tests/todo_test.html</pre></div><p>The preceding command will run the test in a PhantomJS environment, so it won't open any web browser as it did in the previous <a id="id182" class="indexterm"/>case. But, it will run tests inside the WebKit wrapper.</p><p>The command-line output should be <a id="id183" class="indexterm"/>similar to the following:</p><div class="informalexample"><pre class="programlisting">Opening file:///Users/wbednarski/Sites/DEV/JMVC/Todo/todo/tests/todo_test.html
starting steal.browser.phantomjs
steal.js INFO: Opening //todo/todo.html
steal.js INFO: using a dynamic fixture for GET /todos
steal.js INFO: ajax request to todos.ejs, no fixture found
steal.js INFO: ajax request to todos.ejs, no fixture found
default route

Todo app
 page has #todos placeholder
  [x] The #todo is child of the body

Time: 3 seconds, Memory: 81.06 MB

OK (1 tests, 0 assertions)</pre></div></div><div class="section" title="EnvJS"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>EnvJS</h2></div></div></div><p>Another way to run tests is to use <a id="id184" class="indexterm"/>EnvJS-simulated browser environments written in JavaScript.</p><p>EnvJS can only be used to run unit tests, <a id="id185" class="indexterm"/>because it doesn't accurately implement event simulation.</p><p>Run the test by executing the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ ./js funcunit/run envjs todo/tests/todo_test.html</strong></span>
</pre></div></div></div>
<div class="section" title="Integration"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Integration</h1></div></div></div><p>Integration is possible with popular <a id="id186" class="indexterm"/>build or CI tools, such as Jenkins or <a id="id187" class="indexterm"/>
<a id="id188" class="indexterm"/>Maven:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Jenkins</strong></span>: <a class="ulink" href="http://javascriptmvc.com/docs.html#!funcunit.jenkins">http://javascriptmvc.com/docs.html#!funcunit.jenkins</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Maven</strong></span>: <a class="ulink" href="http://javascriptmvc.com/docs.html#!funcunit.maven">http://javascriptmvc.com/docs.html#!funcunit.maven</a></li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Summary</h1></div></div></div><p>As we can see, FuncUnit is an easy-to-use, powerful testing framework.</p><p>Writing test cases is fast and easy. The possibility to run them in several ways as well as integrate them with automated and build tools makes FuncUnit a solid tool.</p><p>Now, we have no excuses not to write tests.</p></div></body></html>