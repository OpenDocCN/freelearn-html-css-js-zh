<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Understanding Backbone</h1></div></div></div><p>In this chapter, we will cover the following points:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Designing an application with the MVC pattern</li><li class="listitem" style="list-style-type: disc">Defining business logic with models and collections</li><li class="listitem" style="list-style-type: disc">Modeling an application's behavior with views and a router</li><li class="listitem" style="list-style-type: disc">Creating an application structure from scratch</li><li class="listitem" style="list-style-type: disc">Writing your first Backbone application</li><li class="listitem" style="list-style-type: disc">Implementing URL routing in your application</li><li class="listitem" style="list-style-type: disc">Extending an application with plugins</li><li class="listitem" style="list-style-type: disc">Contributing to the Backbone project</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Introduction</h1></div></div></div><p>Backbone.js is a lightweight JavaScript framework that is based on the Model-View-Controller (MVC) pattern<a class="indexterm" id="id0"/> and allows developers to create single-page web applications. With Backbone, it is possible to update a web page quickly using the REST approach with a minimal amount of data transferred between a client and a server.</p><p>Backbone.js<a class="indexterm" id="id1"/> is becoming more popular day by day and is being used on a large scale for <a class="indexterm" id="id2"/>web applications and IT startups; some of them are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Groupon Now!: The<a class="indexterm" id="id3"/> team decided that their first product would be <a class="indexterm" id="id4"/>AJAX-heavy but should still be linkable and shareable. Though they were completely new to Backbone, they found that its learning curve was incredibly quick, so they were able to deliver the working product in just two weeks.</li><li class="listitem" style="list-style-type: disc">Foursquare: This <a class="indexterm" id="id5"/>used the Backbone.js library to create model classes <a class="indexterm" id="id6"/>for the entities in foursquare (for example, venues, check-ins, and users). They found that Backbone's model classes provide a simple and light-weight mechanism to capture an object's data and state, complete with the semantics of a classical inheritance.</li><li class="listitem" style="list-style-type: disc">LinkedIn mobile: This <a class="indexterm" id="id7"/>used <a class="indexterm" id="id8"/>Backbone.js to create its next-generation HTML5 mobile web app. Backbone made it easy to keep the app modular, organized, and extensible, so it was possible to program the complexities of LinkedIn's user experience. Moreover, they are using the same code base in their mobile applications for iOS and Android platforms.</li><li class="listitem" style="list-style-type: disc">WordPress.com: This <a class="indexterm" id="id9"/>is a SaaS version<a class="indexterm" id="id10"/> of Wordpress and uses Backbone.js models, collections, and views in its notification system, and is integrating Backbone.js into the Stats tab and into other features throughout the home page.</li><li class="listitem" style="list-style-type: disc">Airbnb: This<a class="indexterm" id="id11"/> is a community marketplace<a class="indexterm" id="id12"/> for users to list, discover, and book unique spaces around the world. Its development team has used Backbone in many latest products. Recently, they rebuilt a mobile website with Backbone.js and Node.js tied together with a library named <a class="indexterm" id="id13"/>Rendr.</li></ul></div><p>You can visit the <a class="indexterm" id="id14"/>following links to get acquainted with other usage examples of Backbone.js:</p><p><a class="ulink" href="http://backbonejs.org/#examples">http://backbonejs.org/#examples</a></p><p>Backbone.js was started by Jeremy Ashkenas from DocumentCloud in 2010 and is now being used and improved by lots of developers all over the world using Git, the distributed version control system.</p><p>In this chapter, we are going to provide some practical examples of how to use Backbone.js, and we will structure a design for a program named Billing Application by following the MVC and Backbone pattern. We will also refer to this structure in the later chapters of this book. Reading this chapter is especially useful if you are new to developing with Backbone.js. If you feel that you're an experienced developer, you can skip this chapter.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Designing an application with the MVC pattern</h1></div></div></div><p>MVC is a <a class="indexterm" id="id15"/>design pattern that is widely used in user-facing software, such as web applications. It is intended for splitting data and representing it in a way that makes it convenient for user interaction. To understand what it does, understand the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Model: This <a class="indexterm" id="id16"/>contains data and provides business logic used to run the application</li><li class="listitem" style="list-style-type: disc">View: This <a class="indexterm" id="id17"/>presents the model to the user</li><li class="listitem" style="list-style-type: disc">Controller: This<a class="indexterm" id="id18"/> reacts to user input by updating the model and the view</li></ul></div><p>There could be some differences in the MVC implementation, but in general it conforms to the following scheme:</p><div><img alt="Designing an application with the MVC pattern" src="img/2728_01_01.jpg"/></div><p>Worldwide practice shows that the use of the MVC pattern provides various benefits<a class="indexterm" id="id19"/> to the developer:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Following the separation of the concerned paradigm, which splits an application into independent parts, it is easier to modify or replace</li><li class="listitem" style="list-style-type: disc">It achieves code reusability by rendering a model in different views without the need to implement model functionality in each view</li><li class="listitem" style="list-style-type: disc">It requires less training and has a quicker startup time for the new developers within an organization</li></ul></div><p>To have a better<a class="indexterm" id="id20"/> understanding of the MVC pattern, we are going to design a Billing Application. We will refer to this design throughout the book when we are learning specific topics.</p><p>Our Billing Application <a class="indexterm" id="id21"/>will allow users to generate invoices, manage them, and send them to clients. According to the worldwide practice, the invoice should contain a reference number, date, information about the buyer and seller, bank account details, a list of provided products or services, and an invoice sum. Let's have a look at the following screenshot to understand how an invoice appears:</p><div><img alt="Designing an application with the MVC pattern" src="img/2728_01_02.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>How to do it...</h2></div></div></div><p>Let's follow the ensuing steps to design an <a class="indexterm" id="id22"/>MVC structure <a class="indexterm" id="id23"/>for the Billing Application:</p><div><ol class="orderedlist arabic"><li class="listitem">Let's write down a list of functional requirements for this application. We assume that the end user may want to be able to do the following:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generate an invoice</li><li class="listitem" style="list-style-type: disc">E-mail the invoice to the buyer</li><li class="listitem" style="list-style-type: disc">Print the invoice</li><li class="listitem" style="list-style-type: disc">See a list of existing invoices</li><li class="listitem" style="list-style-type: disc">Manage invoices (create, read, update, and delete)</li><li class="listitem" style="list-style-type: disc">Update an invoice status (draft, issued, paid, and canceled)</li><li class="listitem" style="list-style-type: disc">View a yearly income graph and other reports</li></ul></div></li><li class="listitem">To simplify <a class="indexterm" id="id24"/>the process of<a class="indexterm" id="id25"/> creating multiple invoices, the user may want to manage information about buyers and his personal details in the specific part of the application before he/she creates an invoice. So, our application should provide additional functionalities to the end user, such as the following:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The ability to see a list of buyers and use it when generating an invoice</li><li class="listitem" style="list-style-type: disc">The ability to manage buyers (create, read, update, and delete)</li><li class="listitem" style="list-style-type: disc">The ability to see a list of bank accounts and use it when generating an invoice</li><li class="listitem" style="list-style-type: disc">The ability to manage his/her own bank accounts (create, read, update, and delete)</li><li class="listitem" style="list-style-type: disc">The ability to edit personal details and use them when generating an invoice</li></ul></div><p>Of course, we may want to have more functions, but this is enough for demonstrating how to design an application using the MVC pattern.</p></li><li class="listitem">Next, we architect an application using the MVC pattern.<p>After we have defined the features of our application, we need to understand what is more related to the model (business logic) and what is more related to the view (presentation). Let's split the functionality into several parts.</p></li><li class="listitem">Then, we learn how to define models.<p>Models present data and provide data-specific business logic. Models can be related to each other. In our case, they are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">InvoiceModel</li><li class="listitem" style="list-style-type: disc">InvoiceItemModel</li><li class="listitem" style="list-style-type: disc">BuyerModel</li><li class="listitem" style="list-style-type: disc">SellerModel</li><li class="listitem" style="list-style-type: disc">BankAccountModel</li></ul></div></li><li class="listitem">Then,<a class="indexterm" id="id26"/> <a class="indexterm" id="id27"/>will define collections of models.<p>Our application allows users to operate on a number of models, so they need to be organized into a special iterable object named Collection. We need the following collections:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">InvoiceCollection</li><li class="listitem" style="list-style-type: disc">InvoiceItemCollection</li><li class="listitem" style="list-style-type: disc">BuyerCollection</li><li class="listitem" style="list-style-type: disc">BankAccountCollection</li></ul></div></li><li class="listitem">Next, we define views.<p>View present a model or a collection to the application user. A single model or collection can be rendered to be used by multiple views. The views that we need in our application are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">EditInvoiceFormView</li><li class="listitem" style="list-style-type: disc">InvoicePageView</li><li class="listitem" style="list-style-type: disc">InvoiceListView</li><li class="listitem" style="list-style-type: disc">PrintInvoicePageView</li><li class="listitem" style="list-style-type: disc">EmailInvoiceFormView</li><li class="listitem" style="list-style-type: disc">YearlyIncomeGraphView</li><li class="listitem" style="list-style-type: disc">EditBuyerFormView</li><li class="listitem" style="list-style-type: disc">BuyerPageView</li><li class="listitem" style="list-style-type: disc">BuyerListView</li><li class="listitem" style="list-style-type: disc">EditBankAccountFormView</li><li class="listitem" style="list-style-type: disc">BankAccountPageView</li><li class="listitem" style="list-style-type: disc">BankAccountListView</li><li class="listitem" style="list-style-type: disc">EditSellerInfoFormView</li><li class="listitem" style="list-style-type: disc">ViewSellectInfoPageView</li><li class="listitem" style="list-style-type: disc">ConfirmationDialogView</li></ul></div></li><li class="listitem">Finally, <a class="indexterm" id="id28"/>we define a controller.<p>A controller allows users to interact with an application. In MVC, each view can<a class="indexterm" id="id29"/> have a different controller that is used to do following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Map a URL to a specific view</li><li class="listitem" style="list-style-type: disc">Fetch models from a server</li><li class="listitem" style="list-style-type: disc">Show and hide views</li><li class="listitem" style="list-style-type: disc">Handle user input</li></ul></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Defining business logic with models and collections</h1></div></div></div><p>Now, it is time to design<a class="indexterm" id="id30"/> business logic for the <a class="indexterm" id="id31"/>Billing Application using the MVC and OOP approaches.</p><p>In this recipe, we are going to define an internal structure for our application with model and collection objects. Although a model represents a single object, a collection is a set of models that can be iterated, filtered, and sorted.</p><p>Relations between models and collections in the Billing Application conform to the following scheme:</p><div><img alt="Defining business logic with models and collections" src="img/2728_01_05.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How to do it...</h2></div></div></div><p>For each model, <a class="indexterm" id="id32"/>we are going to create two tables: one for properties and another for methods:</p><div><ol class="orderedlist arabic"><li class="listitem">We <a class="indexterm" id="id33"/>define BuyerModel properties.<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Required</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>id</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>name</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>address</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>phoneNumber</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">Then, we define <a class="indexterm" id="id34"/>SellerModel properties.<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Required</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>id</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>name</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>address</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>phoneNumber</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>taxDetails</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">After this, we define<a class="indexterm" id="id35"/> BankAccountModel properties.<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Required</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>id</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>beneficiary</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>beneficiaryAccount</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>bank</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>SWIFT</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>specialInstructions</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">We define<a class="indexterm" id="id36"/> InvoiceItemModel properties.<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Arguments</p>
</th><th style="text-align: left" valign="bottom">
<p>Return Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>calculateAmount</p>
</td><td style="text-align: left" valign="top">
<p>-</p>
</td><td style="text-align: left" valign="top">
<p>Decimal</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">Next, we define<a class="indexterm" id="id37"/> InvoiceItemModel methods.<p>We don't need to store the item amount in the model, because it always depends on the price and the quantity, so it can be calculated.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Required</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>id</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>deliveryDate</p>
</td><td style="text-align: left" valign="top">
<p>Date</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>description</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>price</p>
</td><td style="text-align: left" valign="top">
<p>Decimal</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>quantity</p>
</td><td style="text-align: left" valign="top">
<p>Decimal</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">Now, we define<a class="indexterm" id="id38"/> InvoiceModel properties.<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Required</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>id</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>referenceNumber</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>date</p>
</td><td style="text-align: left" valign="top">
<p>Date</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>bankAccount</p>
</td><td style="text-align: left" valign="top">
<p>Reference</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>items</p>
</td><td style="text-align: left" valign="top">
<p>Collection</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>comments</p>
</td><td style="text-align: left" valign="top">
<p>Text</p>
</td><td style="text-align: left" valign="top">
<p>No</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>status</p>
</td><td style="text-align: left" valign="top">
<p>Integer</p>
</td><td style="text-align: left" valign="top">
<p>Yes</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">We define <a class="indexterm" id="id39"/>InvoiceModel methods.<p>The invoice amount can easily be calculated as the sum of invoice item amounts.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Arguments</p>
</th><th style="text-align: left" valign="bottom">
<p>Return Type</p>
</th><th style="text-align: left" valign="bottom">
<p>Unique</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>calculateAmount</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>Decimal</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div></li><li class="listitem">Finally, we define collections.<p>In our case, they are InvoiceCollection, InvoiceItemCollection, BuyerCollection, and BankAccountCollection. They are used to store models of an appropriate type and provide some methods to add/remove models to/from the collections.</p></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>How it works...</h2></div></div></div><p>Models in Backbone.js <a class="indexterm" id="id40"/>are implemented by extending Backbone.Model, and collections are made by extending Backbone.Collection. To implement relations between models and collections, we can use special Backbone extensions, which are described in the later chapters of this book.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Operating with model attributes recipe in <a class="link" href="ch02.html" title="Chapter 2. Models">Chapter 2</a>, Models</li><li class="listitem" style="list-style-type: disc">The Creating a collection of models recipe in <a class="link" href="ch03.html" title="Chapter 3. Collections">Chapter 3</a>, Collections</li></ul></div><p>To learn more about object properties, methods, and OOP programming in JavaScript, you can refer to the following resource:</p><p><a class="ulink" href="https://developer.mozilla.org/en-US/docs/JavaScript/Introduction_to_Object-Oriented_JavaScript">https://developer.mozilla.org/en-US/docs/JavaScript/Introduction_to_Object-Oriented_JavaScript</a></p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Modeling an application's behavior with views and a router</h1></div></div></div><p>Unlike traditional MVC frameworks, Backbone does not provide any distinct object that implements controller functionality. Instead, the controller is diffused between Backbone.Router and Backbone. View and the following is done:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A router handles URL changes and delegates application flow to a view. Typically, the router fetches a model from the storage asynchronously. When the model is fetched, it triggers a view update.</li><li class="listitem" style="list-style-type: disc">A view listens to DOM events and either updates a model or navigates an application through a router.</li></ul></div><p>The following diagram<a class="indexterm" id="id41"/> shows a typical workflow<a class="indexterm" id="id42"/> in a Backbone application:</p><div><img alt="Modeling an application's behavior with views and a router" src="img/2728_01_10.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>How to do it...</h2></div></div></div><p>Let's follow the ensuing steps to understand <a class="indexterm" id="id43"/>how to define basic views and a <a class="indexterm" id="id44"/>router in our application:</p><div><ol class="orderedlist arabic"><li class="listitem">First, we need to <a class="indexterm" id="id45"/>create wireframes for an application.<p>Let's draw a couple of wireframes in this recipe:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Edit Invoice page allows users to select a buyer, to select the seller's bank account from the lists, to enter the invoice's date and a reference number, and to build a table of shipped products and services.<div><img alt="How to do it..." src="img/2728_01_03.jpg"/></div></li><li class="listitem" style="list-style-type: disc">The Preview Invoice page<a class="indexterm" id="id46"/> shows how the final invoice will be seen by a buyer. This display should render all the information we have entered in the Edit Invoice form. Buyer and seller information can be looked up in the application storage. The user has the option to either go back to the Edit display or save this invoice.<div><img alt="How to do it..." src="img/2728_01_04.jpg"/></div></li></ul></div></li><li class="listitem">Then, we will define view objects.<p>According to the previous wireframes, we need to have two main views: EditInvoiceFormView and PreviewInvoicePageView. These views will operate with InvoiceModel; it refers to other objects, such as BankAccountModel and InvoiceItemCollection.</p></li><li class="listitem">Now, we will split views into subviews.<p>For each<a class="indexterm" id="id47"/> item in the Products or Services table, we may want to recalculate the Amount field depending on what the user enters in the Price and Quantity fields. The first way to do this is to re-render the entire view when the user changes the value in the table; however, it is not an efficient way, and it takes a significant amount of computer power to do this.</p><p>We don't need to re-render the entire view if we want to update a small part of it. It is better to split the big view into different, independent pieces, such as subviews, that are able to render only a specific part of the big view. In our case, we can have the following views:</p><div><img alt="How to do it..." src="img/2728_01_06.jpg"/></div><p>As we can see, EditInvoiceItemTableView and PreviewInvoiceItemTableView render InvoiceItemCollection with the help of the additional views EditInvoiceItemView and PreviewInvoiceItemView that render InvoiceItemModel. Such separation allows us to re-render an item inside a collection when it is changed.</p></li><li class="listitem">Finally, we will <a class="indexterm" id="id48"/>define URL paths that will be associated with a corresponding view. In our case, we can have several URLs to show different views, for example:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">/invoice/add</li><li class="listitem" style="list-style-type: disc">/invoice/:id/edit</li><li class="listitem" style="list-style-type: disc">/invoice/:id/preview</li></ul></div><p>Here, we assume that the Edit Invoice view can be used for either creating a new invoice or editing an existing one. In the router implementation, we can load this view and show it on specific URLs.</p></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How it works...</h2></div></div></div><p>The Backbone.View object <a class="indexterm" id="id49"/>can be extended to create our own view that will render model data. In a view, we can define handlers to user actions, such as data input and keyboard or mouse events.</p><p>In the application, we can have a single<a class="indexterm" id="id50"/> Backbone.Router object that allows users to navigate through an application by changing the URL in the address bar of the browser. The router object contains a list of available URLs and callbacks. In a callback function, we can trigger the rendering of a specific view associated with a URL.</p><p>If we want a user to be able to jump from one view to another, we may want him/her to either click on regular HTML links associated with a view or navigate to an application programmatically.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="link" href="ch02.html" title="Chapter 2. Models">Chapter 2</a>, Views</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Creating an application structure from scratch</h1></div></div></div><p>In this recipe, we<a class="indexterm" id="id51"/> are going to talk about how to create a Backbone project from scratch. There is important information of which we should be aware when dealing with the later chapters of this book.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>How to do it...</h2></div></div></div><p>We are going to speak <a class="indexterm" id="id52"/>about Backbone dependencies and the directory structure for our project. Let's follow the ensuing guidelines:</p><div><ol class="orderedlist arabic"><li class="listitem">Download <a class="indexterm" id="id53"/>Backbone.js.<p>Visit <a class="ulink" href="http://backbone.js">http://backbone.js</a> and download the Backbone.js library. There are several versions available: production, development, and an edge version.</p><p>You can use the production version for the best performance because it has been optimized and minimized. The development version may be good to use when working on the application, so you can use the code completion and debugging features of your IDE. And finally, you can use the edge version of Backbone, but do it at your own risk, because it may not be fully tested.</p></li><li class="listitem">Download Backbone dependencies.<p>Backbone.js depends<a class="indexterm" id="id54"/> on the Underscore.js library, which can be downloaded from <a class="ulink" href="http://underscorejs.org">http://underscorejs.org</a>. Underscore is also shipped in three different versions.</p><p>Also, Backbone.js depends on either the jQuery or Zepto libraries. These libraries have the same syntax and both provide useful functionality to the developer. They simplify work with the document tree, event handling, AJAX, and JavaScript animations.</p><p>For many examples in this book, we are going to use the jQuery library, which can be downloaded from <a class="ulink" href="http://jquery.com">http://jquery.com</a>. It is provided with both the development and production versions.</p></li><li class="listitem">Create a project directory structure.<p>If you follow <a class="indexterm" id="id55"/>a specific directory structure, it would be easier to find any file and work with it, because such an application structure brings more order into your project. Here is an example of a directory structure that can be used by a simple Backbone application:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">lib/: This is a directory for third-party libraries, such as the following:<p>backbone.js: This is the source code of Backbone.js</p><p>underscore.js: This is the source code of Underscore.js</p><p>jquery.js: This has sources of jQuery</p></li><li class="listitem" style="list-style-type: disc">js/: This is the directory of the project's JavaScript files.<p>main.js: This is the main JavaScript file that has been used in the project</p><p>index.html: This is the main file of our application.</p></li></ul></div><p>Create the main file of the application, which is index.html. It should include third-party libraries and your application files, as shown in the following code:</p><div><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Backbone.js Cookbook – Application Template&lt;/title&gt;
  
    &lt;script src="img/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="img/underscore.js"&gt;&lt;/script&gt;
    &lt;script src="img/backbone.js"&gt;&lt;/script&gt;

    &lt;script src="img/main.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;&lt;/body&gt;

&lt;/html&gt;</pre></div></li><li class="listitem">Create the main JavaScript file named main.js that will contain the code of your application.<div><pre class="programlisting">(function($){

  // Your code is here
  
})(jQuery);</pre></div><p>As we include our scripts into the head tag, they are executed before the body content is processed by a browser and before the whole HTML document is loaded.</p><p>In a Backbone application, as in many other JavaScript applications, we want to make sure our program starts to run right after the document is loaded, so main.js should look like the following code snippet:</p><div><pre class="programlisting">(function($){

  // Object declarations goes here

  $(document).ready(function () {

   // Start application code goes here

  });
})(jQuery);</pre></div><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>You can use this application template for creating your own Backbone app. We are also going to use this template for the examples in this book.</p></div></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Writing your first Backbone application</h1></div></div></div><p>In this recipe, we<a class="indexterm" id="id56"/> are going to write our first Backbone application. Let it be a simple part of the billing system.</p><p>For example, we can implement a model and a view for the invoice item. Let's create InvoiceItemModel that contains the Quantity and Price fields and calculates the item's amount. We also need to have PreviewInvoiceItemView that is used to render a model.</p><p>The output of our demo application could be very simple, as shown in the following screenshot:</p><div><img alt="Writing your first Backbone application" src="img/2728_01_07.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How to do it...</h2></div></div></div><p>The new code in <a class="indexterm" id="id57"/>this recipe should go into the main.js file that we created in the previous recipe; we will do this as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Define the model by extending it from the Backbone.Model object.<div><pre class="programlisting">  var InvoiceItemModel = Backbone.Model.extend({

    // Set default values.
    defaults: {
      price: 0,
      quantity: 0
    },

    // Calculate amount.
    calculateAmount: function() {
      return this.get('price') * this.get('quantity');
    }
  });</pre></div><p>In the InvoiceItemModel object, we have initialized the default values and performed the business logic, a function that calculates the total amount.</p></li><li class="listitem">Create a <a class="indexterm" id="id58"/>model instance.<div><pre class="programlisting">    var invoiceItemModel = new InvoiceItemModel({
      price: 2,
      quantity: 3
    });</pre></div></li><li class="listitem">Define the <a class="indexterm" id="id59"/>view that will render the model.<div><pre class="programlisting">  var PreviewInvoiceItemView = Backbone.View.extend({

    // Define template using templating engine from
    // Underscore.js.
    template: _.template('\
      Price: &lt;%= price %&gt;.\
      Quantity: &lt;%= quantity %&gt;.\
      Amount: &lt;%= amount %&gt;.\
    '),

    // Render view.
    render: function () {

      // Generate HTML by rendering the template.
      var html = this.template({

        // Pass model properties to the template.
        price: this.model.get('price'),
        quantity: this.model.get('quantity'),

        // Calculate amount and pass it to the template.
        amount: this.model.calculateAmount()
      });

      // Set html for the view element using jQuery.
      $(this.el).html(html);
    }
  });</pre></div><p>As we can see, our view uses the this.model and this.el properties that are passed to the view when it is created.</p><div><pre class="programlisting">    var previewInvoiceItemView = new PreviewInvoiceItemView({
      model: invoiceItemModel,
      el: 'body'
    });</pre></div><p>Inside a<a class="indexterm" id="id60"/> view, we used the jQuery library to set the content for the element associated with the view $(this.el).html(html). In our case, this.el contains 'body' that is also a jQuery selector.</p><p>Such selectors are similar to CSS selectors and allow jQuery to find an arbitrary HTML element using the $() function.</p></li><li class="listitem">To render a<a class="indexterm" id="id61"/> view, we simply need to execute the render() method.<div><pre class="programlisting">  previewInvoiceItemView.render();</pre></div><p>When rendering a view, we also used a templating engine provided by Underscore.js. This templating engine substitutes templates with data and outputs static HTML. More information about templates is available in the Using templates in a view recipe of <a class="link" href="ch06.html" title="Chapter 6. Templates and UX sugar">Chapter 6</a>, Templates, Forms, and UX Sugar.</p></li><li class="listitem">Start the application.<p>There<a class="indexterm" id="id62"/> are several ways to start an application. If your application has only a single view, you can create a new instance of it and render it manually.</p><p>An application should be started right after the HTML page is loaded. Let's write some code that will start a simple Backbone application:</p><div><pre class="programlisting">  // When document is ready create the Model and show
  // the View.
  $(document).ready(function () {

    // Create InvoiceItemModel instance and set
    // model attributes.
    var invoiceItemModel = new InvoiceItemModel({
      price: 2,
      quantity: 3
    });

    // Create PreviewInvoiceItemView instance.
    var previewInvoiceItemView = new PreviewInvoiceItemView({

      // Pass our model.
      model: invoiceItemModel,

      // Set element where to render HTML.
      el: 'body'
    });

    // Render view manually.
    previewInvoiceItemView.render();
  });</pre></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="link" href="ch02.html" title="Chapter 2. Models">Chapter 2</a>, Models</li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch03.html" title="Chapter 3. Collections">Chapter 3</a>, Collections</li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch04.html" title="Chapter 4. Views">Chapter 4</a>, Views</li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch05.html" title="Chapter 5. Events and Bindings">Chapter 5</a>, Events and Bindings</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Implementing URL routing in your application</h1></div></div></div><p>The Backbone.Router object is used for navigation inside your application. You should use it if you <a class="indexterm" id="id63"/>want to access different view pages by hitting the appropriate URLs. Users can also navigate through an application using the browser's history bar.</p><p>By default, the router <a class="indexterm" id="id64"/>works well with hash paths, such as index.html#path/to/page. Any string that is placed after a hash character is supposed to be a route and is processed by Backbone.Router.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How to do it...</h2></div></div></div><p>Here, we are going to explain how to create our own router in our application:</p><div><ol class="orderedlist arabic"><li class="listitem">Define a router by extending Backbone.Router into the Workspace object and setting pairs of routes and callback functions for them inside the routes property that is passed to the extend() method<a class="indexterm" id="id65"/>. This gives the router information of which callback should be executed in case the appropriate route is accessed.<div><pre class="programlisting">  var Workspace = Backbone.Router.extend({
    routes: {
      // Default path.
      '': 'invoiceList',

      // Usage of static path.
      'invoice': 'invoiceList',
    },
  });</pre></div></li><li class="listitem">Add a callback method to the router object.<div><pre class="programlisting">    invoiceList: function() {
      var invoiceListView = new InvoiceListView({
        el: 'body'
      });
      invoiceListView.render();
    }</pre></div><p>If the user <a class="indexterm" id="id66"/>visits index.html or index.html#invoice, the invoiceList()<a class="indexterm" id="id67"/> callback is executed, which renders InvoiceListView. Here, InvoiceListView is a simple stub.</p><div><img alt="How to do it..." src="img/2728_01_08.jpg"/></div></li><li class="listitem">Tell Backbone<a class="indexterm" id="id68"/> to use this router and start the application.<div><pre class="programlisting">  $(document).ready(function () {
    new Workspace();
    Backbone.history.start();
  });</pre></div><p>Here, we create a new Workspace object and execute the start() method<a class="indexterm" id="id69"/> of the Backbone.history object that is used for global application routing. As always, we should start our application right after the HTML page has loaded completely.</p></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>How it works...</h2></div></div></div><p>Backbone.Router<a class="indexterm" id="id70"/> is used just for defining routes and callbacks. All the important jobs are done by Backbone.history<a class="indexterm" id="id71"/> that serves as a global router (per frame) to handle hashchange or pushState events, <a class="indexterm" id="id72"/>match the appropriate route, and trigger callbacks. You shouldn't ever have to create an instance of the global router—you should use the reference to Backbone.history that will be created for you automatically if you make use of routers with routes.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>There's more...</h2></div></div></div><p>Backbone router allows the defining of routes with parameters, which we are going to explain in this section.</p><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Parsing parameters in a URL</h3></div></div></div><p>If we want the<a class="indexterm" id="id73"/> router <a class="indexterm" id="id74"/>to parse parameters in a URL, we need to use the colon character (:) before the parameter's name. Here is an example that demonstrates how Backbone.Router parses URLs with a parameter.</p><div><pre class="programlisting">  var Workspace = Backbone.Router.extend({
    routes: {
      // Usage of fragment parameter.
      'invoice/:id': 'invoicePage',
    },

    // Shows invoice page.
    invoicePage: function(id) {
      var invoicePageView = new InvoicePageView({
        el: 'body',

        // Pass parameter to the view.
        id: id
      });
      invoicePageView.render();
    },
  });</pre></div><p>Paths such as index.html#invoice/1 and index.html#invoice/2 will be parsed by a router. In both cases, the invoicePage() callback is executed; it passes the ID parameter to InvoiceLPageView and renders it.</p><div><img alt="Parsing parameters in a URL" src="img/2728_01_09.jpg"/></div><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p><strong>Validate parameters in your router</strong></p><p>There is no default way to set a restriction for the data type or format of the parameters inside the routes definition. All parameters that are passed to the router callbacks are strings, and it is up to the developer to validate them.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Handling router events recipe in <a class="link" href="ch05.html" title="Chapter 5. Events and Bindings">Chapter 5</a>, Events and Bindings</li><li class="listitem" style="list-style-type: disc">The Switching views using Backbone.Router recipe in <a class="link" href="ch04.html" title="Chapter 4. Views">Chapter 4</a>, Views</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Extending an application with plugins</h1></div></div></div><p>Backbone's core is<a class="indexterm" id="id75"/> small, well-tested, and nicely maintained. However, developers may need additional functionalities to be used by <a class="indexterm" id="id76"/>a complex web application. The power of the Backbone framework depends on modularity and flexibility. Existing components can easily be either extended or replaced; thus, many developers create their own plugins.</p><p>There are over 100 plugins that can be downloaded and used in your application from <a class="ulink" href="https://github.com/documentcloud/backbone/wiki/Extensions,-Plugins, -Resources">https://github.com/documentcloud/backbone/wiki/Extensions,-Plugins,-Resources</a>. In this book, we are going to use some of them, so we need to know how to extend our application with plugins.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec21"/>How to do it...</h2></div></div></div><p>If the plugin is a single JavaScript file, simply copy it into the lib folder of the project and include it in index.html.</p><div><pre class="programlisting">  &lt;script src="img/backbone.plugin.js"&gt;&lt;/script&gt;</pre></div><p>Alternatively, if <a class="indexterm" id="id77"/>the plugin has been shipped with additional files, such as CSS and images, place<a class="indexterm" id="id78"/> all the plugin files in the plugin-name directory under the lib folder, and then include the JS and CSS files in index.html.</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p><strong>Use Git submodules</strong></p><p>If your project is hosted in the Git repository, you can use the Git submodule command to insert a plugin repository inside your project repository. This is very useful if you want to have an easy way to update your project plugins by writing a single git command.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec22"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Creating a Backbone.js extension with Grunt recipe in <a class="link" href="ch08.html" title="Chapter 8. Special Techniques">Chapter 8</a>, Special Techniques</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Contributing to the Backbone project</h1></div></div></div><p>Backbone.js<a class="indexterm" id="id79"/> is an open source project that has been developed by a strong community. In this recipe, we are going to speak about things that will help you became a part of this community and improve Backbone.js.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How to do it...</h2></div></div></div><p>Let's follow the ensuing <a class="indexterm" id="id80"/>steps to make Backbone.js better:</p><div><ol class="orderedlist arabic"><li class="listitem">Work on<a class="indexterm" id="id81"/> the issue queue.<p>If you found a bug in Backbone.js or want a new feature to be implemented, you can submit your issue to the issue queue at <a class="ulink" href="https://github.com/documentcloud/backbone/issues">https://github.com/documentcloud/backbone/issues</a>. Before doing this, make sure there is no similar issue; otherwise, you can update the existing issue queue.</p></li><li class="listitem">Contribute <a class="indexterm" id="id82"/>code.<p>You can submit your own code to the Backbone project. Such a contribution can be very helpful to the community and the project itself.</p><p>By using <a class="indexterm" id="id83"/>Backbone, you save your own time. By contributing to the project, you save the time of other developers who use it and your own time in the future instead of having to work on the same issue again.</p><p>Detailed guidelines for the code contributing process can be found on the wiki page at <a class="ulink" href="https://github.com/documentcloud/backbone/wiki/Contributing-to-Backbone">https://github.com/documentcloud/backbone/wiki/Contributing-to-Backbone</a>.</p></li><li class="listitem">Work on the documentation of Backbone.js.<p>The official documentation, <a class="indexterm" id="id84"/>which is located<a class="indexterm" id="id85"/> at <a class="ulink" href="http://backbonejs.org">http://backbonejs.org</a>, is based on a recent version of Backbone.js in the GitHub repository. You can improve the documentation by either updating the index.html file or the docs directory. If you want to add a new example, use the examples folder.</p></li></ol></div></div></div></body></html>