<html><head></head><body>
		<div><p><a id="_idTextAnchor098"/></p>
			<h1 id="_idParaDest-48"><em class="italic"><a id="_idTextAnchor099"/>Chapter 4:</em> Building a Test Suite with TestCafe</h1>
			<p>Now, as we've been through the main concepts of TestCafe and reviewed its arsenal, let's draw a weapon and write some tests! The main goal here will be to get familiar with how to write a set of end-to-end tests (a test suite) with TestCafe. This is extremely important because the testing techniques that we will cover are universal and can be reused to write automated tests for any web project.</p>
			<p>To sum up, this chapter will cover the following main topics:</p>
			<ul>
				<li>Creating a test.</li>
				<li>Debugging the tests.</li>
				<li>Writing the test project log in tests.</li>
				<li>Adding verifications to the test project.</li>
				<li>Adding custom code execution to the test project.</li>
				<li>Adding more tests.</li>
			</ul>
			<h1 id="_idParaDest-49"><a id="_idTextAnchor100"/>Technical requirements</h1>
			<p>As we mentioned in <a href="B16280_03_Final_JM_ePub.xhtml#_idTextAnchor043"><em class="italic">Chapter 3</em></a><em class="italic">, Setting Up the Environment</em>, while writing code throughout this book, we will follow some coding conventions: indent with two spaces for <code>.json</code> files, four spaces for <code>.js</code> files, use semicolons, and use single quotes. We will also utilize JavaScript ES6+ syntax, including template strings.</p>
			<p>All code examples for this chapter can be found on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4</a>.</p>
			<h1 id="_idParaDest-50"><a id="_idTextAnchor101"/>Creating a test</h1>
			<p>TestCafe supports <a id="_idIndexMarker126"/>tests written using JavaScript, TypeScript, or CoffeeScript <a id="_idIndexMarker127"/>with all modern features, such as arrow functions and <code>async/await</code>. In addition to that, TestCafe will automatically transpile TypeScript and CoffeeScript code before running tests, so you do not need to tackle it on your own.</p>
			<p>As we agreed initially, throughout this book we will be using JavaScript to write the tests.</p>
			<p>In continuation of our previous efforts from <a href="B16280_03_Final_JM_ePub.xhtml#_idTextAnchor043"><em class="italic">Chapter 3</em></a><em class="italic">, Setting Up the Environment</em>, we already have <code>test-project</code> folder with the <code>.testcaferc.json</code> configuration file in it. So, let's start by opening any shell (for example, we will use Terminal with bash) and following the next steps:</p>
			<ol>
				<li>Go to <code>test-project</code> folder and create a folder for our tests:<pre><strong class="bold">$ cd test-project/</strong>
<strong class="bold">$ mkdir tests</strong></pre></li>
				<li>Now go to that folder and create a <code>basic-tests.js</code> file:<pre><strong class="bold">$ cd tests/</strong>
<strong class="bold">$ touch basic-tests.js</strong></pre></li>
				<li>Open <code>basic-tests.js</code> in a code editor (or IDE) of your choice and let's create a simple test.</li>
				<li>We will start by including the <code>testcafe</code> module:<pre>const { Selector } = require('testcafe');</pre></li>
				<li>Then we declare a fixture using the <code>fixture</code> function:<pre>const { Selector } = require('testcafe'); fixture('My first set of tests');</pre></li>
				<li>Declare the first test using the <code>test</code> function:<pre>const { Selector } = require('testcafe'); fixture('My first set of tests'); test('My first test', async (t) =&gt; {    // Your test code });</pre></li>
				<li>As we selected Redmine (<a href="http://demo.redmine.org/">http://demo.redmine.org/</a>) as our test project, set this URL as a <a id="_idIndexMarker128"/>starting page for all tests in the <code>'My first set of tests'</code> fixture using the <code>page</code> function:<pre>const { Selector } = require('testcafe');fixture('My first set of tests')    .page('http://demo.redmine.org/');test('My first test', async (t) =&gt; {    // Your test code });</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests1.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests1.js</a>.</p></li>
			</ol>
			<p>As we now <a id="_idIndexMarker129"/>have an empty test structure, let's run it and inspect <a id="_idIndexMarker130"/>the output.</p>
			<h2 id="_idParaDest-51"><a id="_idTextAnchor102"/>Running the test</h2>
			<p>We can easily <a id="_idIndexMarker131"/>run the test from a command shell by executing a single command with the target browser and file path:</p>
			<pre>$ npx testcafe chrome tests/basic-tests.js</pre>
			<p>The shell output will look like this:</p>
			<div><div><img src="img/Figure_4.01_B16280.jpg" alt="Figure 4.1: Shell output after the test run&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – Shell output after the test run</p>
			<p>TestCafe will automatically spawn the chosen browser instance and will start running the test. As you can see in the test output: <code>The "src", "browsers" options from the configuration file will be ignored.</code> This means that we already specified our default browser and path to the tests in <code>.testcaferc.json</code> (you can see it here: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/.testcaferc.json#L3">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/.testcaferc.json#L3</a>) and the command shell options that we provided just overrode the defaults.</p>
			<p>So, we can now simplify our test run command even more:</p>
			<pre>$ npx testcafe</pre>
			<p>Now TestCafe will <a id="_idIndexMarker132"/>just take the default options from <code>.testcaferc.json </code>and the <a id="_idIndexMarker133"/>result of the test run will be the same. We will review more <strong class="bold">Command-Line Interface</strong> (<strong class="bold">CLI</strong>) settings later on in the <a href="B16280_05_Final_JM_ePub.xhtml#_idTextAnchor125"><em class="italic">Chapter 5</em></a><em class="italic">, Improving the Tests</em>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Keep the browser that is running tests active and do not minimize the browser window. Minimized browser windows and inactive tabs tend to get shifted to a reduced resource consumption mode where tests are not guaranteed to be executed correctly.</p>
			<h2 id="_idParaDest-52"><a id="_idTextAnchor103"/>Performing actions</h2>
			<p>Now let's <a id="_idIndexMarker134"/>perform some actions on the page:</p>
			<pre>const { Selector } = require('testcafe');fixture('My first set of tests')    .page('http://demo.redmine.org/');test('My first test', async (t) =&gt; {    await t.click('.login<a id="_idTextAnchor104"/>');});</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests2.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests2.js</a>.</p>
			<p>The previous fixture contains a simple test that clicks the <code>t</code>. The test controller object lets us access the API of the test run. The <code>await</code> keyword should be used when calling test actions or action chains to wait for them to complete.</p>
			<p>As we learned <a id="_idIndexMarker135"/>how to run a basic test, let's touch the ground on how to deal with debugging and errors.</p>
			<h1 id="_idParaDest-53"><a id="_idTextAnchor105"/>Debugging the tests</h1>
			<p>Now let's see <a id="_idIndexMarker136"/>how we can debug our tests. We will review it in two blocks:</p>
			<ul>
				<li>Debugging tests in TestCafe.</li>
				<li>Debugging tests in Chrome Developer Tools.</li>
			</ul>
			<p>Let's take a look.</p>
			<h2 id="_idParaDest-54"><a id="_idTextAnchor106"/>Debugging tests in TestCafe</h2>
			<p>Let's use the <a id="_idIndexMarker137"/>code from the previous example to create a <code>basic-test-wrong.js</code> file with <a id="_idIndexMarker138"/>a slightly modified class name in the selector:</p>
			<pre>const { Selector } = require('testcafe');fixture('My first set of tests')    .page('http://demo.redmine.org/');test('My first test', async (t) =&gt; {    await t.click('.login-wrong');});</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-test-wrong.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-test-wrong.js</a>.</p>
			<p>The class <a id="_idIndexMarker139"/>name <code>.login-wrong </code>is used instead of <code>.login</code> to <a id="_idIndexMarker140"/>provoke the <strong class="bold">element not found</strong> error. Let's launch our test to confirm this:</p>
			<pre>$ npx testcafe chrome tests/basic-test-wrong.js</pre>
			<p>The output will look like this:</p>
			<div><div><img src="img/Figure_4.02_B16280.jpg" alt="Figure 4.2: Shell output after the test run with the error&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – Shell output after the test run with the error</p>
			<p>As you can see, TestCafe outputs the error and the line of code where it occurred.</p>
			<p>But how <a id="_idIndexMarker141"/>do you debug the test even before it failed? For that <a id="_idIndexMarker142"/>purpose, TestCafe has the <code>t.debug</code> method. Let's add it to our test:</p>
			<pre>const { Selector } = require('testcafe');fixture('My first set of tests')    .page('http://demo.redmine.org/');test('My first test', async (t) =&gt; {    await t.debug().click('.login-wrong');});</pre>
			<p>This method is used to pause the test execution and debug it with the browser's developer tools. You will see some buttons to navigate the test run flow in the footer of the browser window:</p>
			<ul>
				<li><strong class="bold">Unlock Page</strong>: Allows us to interact with the browser page that is currently open.</li>
				<li><strong class="bold">Resume</strong>: Allows us to continue the test run.</li>
				<li><strong class="bold">Next Action</strong>: Executes the next action or assertion:</li>
			</ul>
			<div><div><img src="img/Figure_4.03_B16280.jpg" alt="Figure 4.3 – TestCafe debug buttons&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – TestCafe debug buttons</p>
			<p>And the <a id="_idIndexMarker143"/>output will look like this:</p>
			<div><div><img src="img/Figure_4.04_B16280.jpg" alt="Figure 4.4: Shell output in debug mode&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – Shell output in debug mode</p>
			<p>As you <a id="_idIndexMarker144"/>can see, TestCafe outputs the line of code where <code>t.debug</code> method is called.</p>
			<p>You can also run the tests with <code>--debug-mode</code> flag. It will enable debugging and pause the test execution right before the first action or assertion:</p>
			<pre>$ npx testcafe chrome tests/basic-test-wrong.js --debug-mode</pre>
			<p>Or you can use the <code>--debug-on-fail</code> flag. It will pause the test when it fails and will allow you to view the tested page and determine the cause of the failure:</p>
			<pre>$ npx testcafe chrome tests/basic-test-wrong.js --debug-on-fail</pre>
			<p>When you <a id="_idIndexMarker145"/>are satisfied with the page debugging, just click the <strong class="bold">Finish</strong> button <a id="_idIndexMarker146"/>in the footer to kill the test execution process.</p>
			<p>Now let's see how to debug a test in Chrome Dev Tools.</p>
			<h2 id="_idParaDest-55"><a id="_idTextAnchor107"/>Debugging tests in Chrome Developer Tools</h2>
			<p>Another <a id="_idIndexMarker147"/>useful way to debug the tests is to do it <a id="_idIndexMarker148"/>through Node.js in Chrome Developer Tools. You will need Google Chrome and Node.js v8 or higher to perform all the actions. To debug using the Chrome Developer Tool, follow these steps:</p>
			<ol>
				<li value="1">Firstly, put the <code>debugger</code> keyword in test code where you want the process to stop:<pre>const { Selector } = require('testcafe');fixture('My first set of tests')    .page('http://demo.redmine.org/');test('My first test', async (t) =&gt; {    debugger;    await t.click('.login-wrong');});</pre></li>
				<li>Then, to activate Node.js debugging mode, add the <code>--inspect-brk</code> flag to the test run command:<pre><strong class="bold">$ npx testcafe --inspect-brk chrome tests/basic-test-wrong.js</strong></pre></li>
				<li>Open Google Chrome and navigate to chrome://inspect. In the <strong class="bold">Remote Target </strong>section, find the Node.js debugger and click <strong class="bold">Inspect</strong>. Chrome will launch Developer Tools and the debugger will stop test execution at the first line. Click the <strong class="bold">Resume script execution</strong> button to continue:</li>
			</ol>
			<div><div><img src="img/Figure_4.05_B16280.jpg" alt="Figure 4.5: Google Chrome Developer Tools debugger&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – Google Chrome Developer Tools debugger</p>
			<p>As you <a id="_idIndexMarker149"/>can see the test execution gets paused at <a id="_idIndexMarker150"/>the line with <code>debugger</code> keyword allowing you to debug the code.</p>
			<p>Now, as have learned how to debug the test code, let's go further and write some login tests for our test project.</p>
			<h1 id="_idParaDest-56"><a id="_idTextAnchor108"/>Writing the test project log in tests</h1>
			<p>As we <a id="_idIndexMarker151"/>discussed in <a href="B16280_01_Final_JM_ePub.xhtml#_idTextAnchor013"><em class="italic">Chapter 1</em></a><em class="italic">, Why TestCafe</em>, we will need a test user to log in to the portal and perform any further tests. So, let's start with creating a new user with an email address – <code>test_user_testcafe_poc{randomDigits}@sharklasers.com</code> – and password – <code>test_user_testcafe_poc</code>.</p>
			<p>Let's declare the following test to register a new user in <code>basic-tests.js</code>:</p>
			<pre>const { Selector } = require('testcafe');fixture('Redmine log in tests')    .page('http://demo.redmine.org/');test('Create a new user', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test clicks on the <strong class="bold">Register</strong> link:<pre>    await t.click('.register')</pre></li>
				<li>The test fills in the <strong class="bold">Login</strong> field:<pre>        .typeText('#user_login','test_user_testcafe_poc1234@sharklasers.com')</pre></li>
				<li>The test fills in the <strong class="bold">Password</strong> field:<pre>        .typeText('#user_password','test_user_testcafe_poc')</pre></li>
				<li>The test fills in the <strong class="bold">Confirmation</strong> field:<pre>        .typeText('#user_password_confirmation', 'test_user_testcafe_poc')</pre></li>
				<li>The test fills in the <strong class="bold">First name</strong> field:<pre>        .typeText('#user_firstname','test_user')</pre></li>
				<li>The test <a id="_idIndexMarker152"/>fills in the <strong class="bold">Last name</strong> field:<pre>        .typeText('#user_lastname','testcafe_poc')</pre></li>
				<li>The test fills in the <strong class="bold">Email</strong> field:<pre>        .typeText('#user_mail', 'test_user_testcafe_poc1234@sharklasers.com')</pre></li>
				<li>The test clicks on the <strong class="bold">Submit</strong> button:<pre>        .click('[value="Submit"]');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests3.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests3.js</a>.</p></li>
			</ol>
			<p>As you can see in the previous code block, we are using <code>1234</code> as a random number for now. It is simple, but we will have to manually update this number each time we want to create a unique user. Let's improve it to be done automatically by adding a simple open source library that will generate a timestamp for us. Open a shell and execute the following:</p>
			<pre>$ npm install js-automation-tools --save-dev</pre>
			<p>This will <a id="_idIndexMarker153"/>install the <code>js-automation-tools</code> library and save it to the list of our project's dependencies in <code>package.json</code>. Now let's update the code to generate random digits with this library:</p>
			<pre>const { Selector } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits = stamp.getTimestamp();fixture('Redmine log in tests')    .page('http://demo.redmine.org/');test('Create a new user', async (t) =&gt; {    await t.click('.register');        .typeText('#user_login', `test_user_testcafe_    poc${randomDigits}@sharklasers.com`)        .typeText('#user_password', 'test_user_testcafe_poc')        .typeText('#user_password_confirmation', 'test_user_testcafe_poc')        .typeText('#user_firstname', 'test_user')        .typeText('#user_lastname', 'testcafe_poc')        .typeText('#user_mail', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .click('[value="Submit"]');});</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests4.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests4.js</a>.</p>
			<p>As you can now see, each time we run the test an email with a unique set of digits such as <code>test_user_testcafe_poc1588556993141@sharklasers.com</code> is generated, so we don't have to worry about new users anymore.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">You can <a id="_idIndexMarker154"/>read more about the <code>js-automation-tools</code> library and how to use all its features here: <a href="https://github.com/Marketionist/js-automation-tools">https://github.com/Marketionist/js-automation-tools</a>.</p>
			<p>And so, as we <a id="_idIndexMarker155"/>now have a test that creates new Redmine user, let's go forward and add a log in test:</p>
			<pre>const { Selector } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits = stamp.getTimestamp();fixture('Redmine log in tests')    .page('http://demo.redmine.org/');test('Create a new user', async (t) =&gt; {    await t.click('.register');        .typeText('#user_login', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .typeText('#user_password', 'test_user_testcafe_poc')        .typeText('#user_password_confirmation', 'test_user_testcafe_poc')        .typeText('#user_firstname', 'test_user')        .typeText('#user_lastname', 'testcafe_poc')        .typeText('#user_mail', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .click('[value="Submit"]');});test('Log in', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test clicks on the <strong class="bold">Sign in</strong> link:<pre>    await t.click('.login')</pre></li>
				<li>The test fills in the <strong class="bold">Login</strong> field:<pre>        .typeText('#username', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)</pre></li>
				<li>The test fills in the <strong class="bold">Password</strong> field:<pre>        .typeText('#password', 'test_user_testcafe_poc')</pre></li>
				<li>The test clicks on the <strong class="bold">Login</strong> button:<pre>        .click('[name="login"]');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests5.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests5.js</a>.</p></li>
			</ol>
			<p>As we <a id="_idIndexMarker156"/>now have all actions we need for creating users and logging in, let's add some verifications to make these two tests complete.</p>
			<h1 id="_idParaDest-57"><a id="_idTextAnchor109"/>Adding verifications to the test project</h1>
			<p>Normally, each <a id="_idIndexMarker157"/>test should perform some actions and then check the result. As we already know from <a href="B16280_02_Final_JM_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a><em class="italic">, Exploring TestCafe Under the hood</em>, TestCafe provides us with <code>t.expect</code><em class="italic"> </em>method to perform the<em class="italic"> </em>assertions and verify the results of each test. So, let's add corresponding assertions to finalize user creation and log in tests.</p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor110"/>Adding assertion for the user creation test</h2>
			<p>So, the <a id="_idIndexMarker158"/>expected result for the user creation test is the <strong class="bold">Your account has been activated. You can now log in.</strong> notification, which should be displayed:</p>
			<pre>const { Selector } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits = stamp.getTimestamp();fixture('Redmine log in tests')    .page('http://demo.redmine.org/');test('Create a new user', async (t) =&gt; {    await t.click('.register');        .typeText('#user_login', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .typeText('#user_password', 'test_user_testcafe_poc')        .typeText('#user_password_confirmation', 'test_user_testcafe_poc')        .typeText('#user_firstname', 'test_user')        .typeText('#user_lastname', 'testcafe_poc')        .typeText('#user_mail', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .click('[value="Submit"]')        .expect(Selector('#flash_notice').innerText).eql('Your account has been activated. You can now log in.');});</pre>
			<p>As you can see in the final assertion for the user creation test, we are getting a notification element by its id and then comparing its inner text value with the expected result.</p>
			<h2 id="_idParaDest-59"><a id="_idTextAnchor111"/>Adding assertion for the log in test</h2>
			<p>The expected <a id="_idIndexMarker159"/>result for the log in test will be a block with the username of the currently active user that should be displayed in the top-right corner of the page:</p>
			<pre>test('Log in', async (t) =&gt; {    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')        .expect(Selector('#loggedas').exists).ok();});</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests6.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests6.js</a>.</p>
			<p>To demonstrate one more approach to assertions, in the login test we are verifying that the block with the username of the currently active user is present on the page.</p>
			<h2 id="_idParaDest-60"><a id="_idTextAnchor112"/>Adding the log out test</h2>
			<p>Let's also <a id="_idIndexMarker160"/>add a log out test to finish up with the <code>Redmine log in tests</code> fixture:</p>
			<pre>const { Selector } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits = stamp.getTimestamp();fixture('Redmine log in tests')    .page('http://demo.redmine.org/');// ...test('Log out', async (t) =&gt; {    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')        .click('.logout')        .expect(Selector('#loggedas').exists).notOk()        .expect(Selector('.login').exists).ok();});</pre>
			<p class="callout-heading">Note</p>
			<p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests7.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests7.js</a>.</p>
			<p>As you <a id="_idIndexMarker161"/>can see, we are performing two assertions in the log out test:</p>
			<ol>
				<li value="1">Verifies that the block with the currently active user is not present on the page.</li>
				<li>Verifies that the <strong class="bold">Sign in</strong> link is present on the page.</li>
			</ol>
			<p>As we already have three tests in our test suite, let's add more and review how a custom code can be executed in TestCafe.</p>
			<h1 id="_idParaDest-61"><a id="_idTextAnchor113"/>Adding custom code execution to the test project</h1>
			<p>As we already learned from the <a href="B16280_02_Final_JM_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a><em class="italic">, Exploring TestCafe Under the Hood</em>, TestCafe lets <a id="_idIndexMarker162"/>you write code to be executed <a id="_idIndexMarker163"/>on the tested page; this way you can get web elements, URLs, and so on. Special kinds of functions are used to execute your code on the client side in the browser:</p>
			<ul>
				<li><code>Selector</code>: To obtain any DOM elements.</li>
				<li><code>ClientFunction</code>: To obtain any data from the client side.</li>
			</ul>
			<p>These functions should be used in the same way as ordinary async functions, and you can use parameters to pass data inside such functions. The selector API provides methods and properties to select elements on the page and get their state.</p>
			<p>To keep a proper structuring of the tests, it is recommended to group them by fixture. So, let's add a <code>Redmine entities creation tests</code> fixture and a <code>Create a new project</code> test to <a id="_idIndexMarker164"/>see how custom code execution <a id="_idIndexMarker165"/>works:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits = stamp.getTimestamp();const getPageUrl = ClientFunction(() =&gt; {    return window.location.href;});fixture('Redmine log in tests')    .page('http://demo.redmine.org/');// ...fixture('Redmine entities creation tests')    .page('http://demo.redmine.org/');test('Create a new project', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the <strong class="bold">New project</strong> link:<pre>        .click('.icon-add')</pre></li>
				<li>The test <a id="_idIndexMarker166"/>fills in the <strong class="bold">Name</strong> field:<pre>        .typeText('#project_name', `test_project${randomDigits}`)</pre></li>
				<li>The <a id="_idIndexMarker167"/>test clicks on the <strong class="bold">Create</strong> button:<pre>        .click('[value="Create"]')</pre></li>
				<li>The test verifies that <strong class="bold">Successful creation.</strong> notification is displayed:<pre>        .expect(Selector('#flash_notice').innerText).eql('Successful creation.')</pre></li>
				<li>The test verifies that the page URL contains the name of the project:<pre>        .expect(getPageUrl()).contains(`/projects/test_project${randomDigits}/settings`);});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests8.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests8.js</a>.</p></li>
			</ol>
			<p>As our first fixture contains all login tests, a new fixture was created to include all tests for new entities creation. In addition to that, we added <code>ClientFunction</code> and introduced <code>getPageUrl</code> function to execute custom code and get the URL of the current page.</p>
			<p>And the output will look like this:</p>
			<div><div><img src="img/Figure_4.06_B16280.jpg" alt="Figure 4.6: Shell output with two fixtures&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.6 – Shell output with two fixtures</p>
			<p>Now, as we <a id="_idIndexMarker168"/>have fixtures for Redmine log in <a id="_idIndexMarker169"/>tests and Redmine entities creation tests, let's continue filling them up.</p>
			<h1 id="_idParaDest-62"><a id="_idTextAnchor114"/>Adding more tests</h1>
			<p>Let's continue <a id="_idIndexMarker170"/>writing more tests and structuring them into sets divided by fixtures.</p>
			<h2 id="_idParaDest-63"><a id="_idTextAnchor115"/>Adding the new issue creation test</h2>
			<p>We will <a id="_idIndexMarker171"/>start from <code>Create a new issue</code> test in the <code>Redmine entities creation tests</code> fixture:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');</pre>
			<p>Note how we are creating a second set of random digits. We need them as now the tests are creating two projects, and each project should have a unique name:</p>
			<pre>const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const getPageUrl = ClientFunction(() =&gt; {    return window.location.href;});fixture('Redmine log in tests')    .page('http://demo.redmine.org/');// ...fixture('Redmine entities creation tests')    .page('http://demo.redmine.org/');test('Create a new project', async (t) =&gt; {    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits1}`)        .click('[value="Create"]')        .expect(Selector('#flash_notice').innerText).eql('Successful creation.')        .expect(getPageUrl()).contains(`/projects/test_project${randomDigits1}/settings`);});test('Create a new issue', async (t) =&gt; {</pre>
			<p>The test <a id="_idIndexMarker172"/>will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_        project${randomDigits2}`).click('[value="Create"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_  project${randomDigits2}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">New issue</strong> link:<pre>        .click('.new-issue')</pre></li>
				<li>The test fills in the <strong class="bold">Subject</strong> field:<pre>        .typeText('#issue_subject', `Test issue ${randomDigits2}`)</pre></li>
				<li>The test fills in the <strong class="bold">Description</strong> field:<pre>        .typeText('#issue_description', `Test issue description ${randomDigits2}`)</pre></li>
				<li>The test sets <strong class="bold">Priority</strong> to <strong class="bold">High</strong>:<pre>        .click('#issue_priority_id')        .click('#issue_priority_id option[value="5"]')</pre></li>
				<li>The test <a id="_idIndexMarker173"/>clicks on the <strong class="bold">Create</strong> button:<pre>        .click('[value="Create"]')</pre></li>
				<li>The test verifies that created notification is displayed:<pre>        .expect(Selector('#flash_notice').innerText).contains('created.');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests9.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests9.js</a>.</p></li>
			</ol>
			<h2 id="_idParaDest-64"><a id="_idTextAnchor116"/>Adding the new issue is displayed on a project page test</h2>
			<p>Let's move <a id="_idIndexMarker174"/>forward and add a test to verify that the issue is displayed on a project page:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();// ...test('Verify that the issue is displayed on a project page', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits3}`)        .click('[value="Create"]')</pre></li>
				<li>The test creates a new issue:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits3}"]`)        .click('.new-issue')        .typeText('#issue_subject', `Test issue ${randomDigits3}`)        .typeText('#issue_description', `Test issue description ${randomDigits3}`)        .click('#issue_priority_id')        .click('#issue_priority_id option[value="5"]')        .click('[value="Create"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits3}"]`)</pre></li>
				<li>The test <a id="_idIndexMarker175"/>clicks on the <strong class="bold">Issues</strong> link:<pre>        .click('#main-menu .issues')</pre></li>
				<li>The test verifies that the issue's <strong class="bold">Subject</strong> is displayed:<pre>        .expect(Selector('.subject a').innerText).contains(`Test issue ${randomDigits3}`);});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests10.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests10.js</a>.</p></li>
			</ol>
			<h2 id="_idParaDest-65"><a id="_idTextAnchor117"/>Adding the issue editing test</h2>
			<p>Now let's <a id="_idIndexMarker176"/>add a new fixture, <code>Redmine entities editing tests</code>, and add a test for issue editing:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();// ...fixture('Redmine entities editing tests')    .page('http://demo.redmine.org/');test('Edit the issue', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_  poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits4}`)        .click('[value="Create"]')</pre></li>
				<li>The test creates a new issue:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits4}"]`)        .click('.new-issue')        .typeText('#issue_subject', `Test issue ${randomDigits4}`)        .typeText('#issue_description', `Test issue description ${randomDigits4}`)        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('High'))        .click('[value="Create"]')</pre></li>
				<li>The test <a id="_idIndexMarker177"/>clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits4}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">Issues</strong> link:<pre>        .click('#main-menu .issues')</pre></li>
				<li>The test clicks on the issue link:<pre>        .click(Selector('.subject a').withText(`Test issue ${randomDigits4}`))</pre></li>
				<li>The test clicks on the <strong class="bold">Edit</strong> link:<pre>        .click('.icon-edit')</pre></li>
				<li>The test <a id="_idIndexMarker178"/>clears the <strong class="bold">Subject</strong> field and fills it in with a new subject:<pre>        .selectText('#issue_subject')        .pressKey('delete')        .typeText('#issue_subject', `Issue ${randomDigits4} updated`)</pre></li>
				<li>The test sets <code>Normal</code>:<pre>        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('Normal'))</pre></li>
				<li>The test clicks on the <strong class="bold">Submit</strong> button:<pre>        .click('[value="Submit"]')</pre></li>
				<li>The test verifies that the <strong class="bold">Successful update.</strong> notification is displayed:<pre>        .expect(Selector('#flash_notice').innerText).eql('Successful update.');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests11.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests11.js</a>.</p></li>
			</ol>
			<p>There are two interesting things to point out in this code example:</p>
			<ul>
				<li>As CSS selectors cannot access the element's text, the <code>.withText</code> method is used to get <a id="_idIndexMarker179"/>the element by its text. Addressing the element by its text is more stable than doing it with <code>option[value="5"]</code> as the value attribute can change if more options will be added to the dropdown. The other possible solution to get the element by its text can be to use XPath selector containing the text.</li>
				<li>The <code>.selectText</code> and <code>.pressKey</code> methods are used to clear the field from its current text. This approach emulates real user behavior. Select all text in the input field and press the <em class="italic">delete</em> keyboard button to remove it.</li>
			</ul>
			<h2 id="_idParaDest-66"><a id="_idTextAnchor118"/>Adding the updated issue is displayed on a project page test</h2>
			<p>Now let's <a id="_idIndexMarker180"/>verify that the updated issue is displayed on a project page:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();const randomDigits5 = stamp.resetTimestamp();// ...test('Verify that the updated issue is displayed on a project page', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits5}`)        .click('[value="Create"]')</pre></li>
				<li>The <a id="_idIndexMarker181"/>test creates a new issue:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits5}"]`)        .click('.new-issue')        .typeText('#issue_subject', `Test issue ${randomDigits5}`)        .typeText('#issue_description', `Test issue 
         description ${randomDigits5}`)        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('High'))        .click('[value="Create"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits5}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">Issues</strong> link:<pre>        .click('#main-menu .issues')</pre></li>
				<li>The test clicks on the issue link:<pre>        .click(Selector('.subject a').withText(`Test issue ${randomDigits5}`))</pre></li>
				<li>The test clicks on the <strong class="bold">Edit</strong> link:<pre>        .click('.icon-edit')</pre></li>
				<li>The test clears the <strong class="bold">Subject</strong> field and fills it in with a new subject:<pre>        .selectText('#issue_subject')        .pressKey('delete')        .typeText('#issue_subject', `Issue ${randomDigits5} updated`)</pre></li>
				<li>The test sets <strong class="bold">Priority</strong> to <strong class="bold">Normal</strong>:<pre>        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('Normal'))</pre></li>
				<li>The <a id="_idIndexMarker182"/>test clicks on the <strong class="bold">Submit</strong> button:<pre>        .click('[value="Submit"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Issues</strong> link:<pre>        .click('#main-menu .issues')</pre></li>
				<li>The test verifies that the updated issue's <strong class="bold">Subject</strong> is displayed:<pre>        .expect(Selector('.subject a').innerText).eql(`Issue ${randomDigits5} updated`);});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests12.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests12.js</a>.</p></li>
			</ol>
			<h2 id="_idParaDest-67"><a id="_idTextAnchor119"/>Adding the issue searching test</h2>
			<p>Let's add <a id="_idIndexMarker183"/>a test for searching the issue:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();const randomDigits5 = stamp.resetTimestamp();const randomDigits6 = stamp.resetTimestamp();// ...test('Search for the issue', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The <a id="_idIndexMarker184"/>test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits6}`)        .click('[value="Create"]')</pre></li>
				<li>The test creates a new issue:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits6}"]`)        .click('.new-issue')        .typeText('#issue_subject', `Test issue ${randomDigits6}`)        .typeText('#issue_description', `Test issue description ${randomDigits6}`)        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('High'))        .click('[value="Create"]')</pre></li>
				<li>The test opens the <strong class="bold">Search</strong> page:<pre>        .navigateTo('http://demo.redmine.org/search')</pre></li>
				<li>The test types the issue's subject into the <strong class="bold">Search</strong> field:<pre>        .typeText('#search-input', `Test issue ${randomDigits6}`)</pre></li>
				<li>The test clicks on the <strong class="bold">Submit</strong> button:<pre>        .click('[value="Submit"]')</pre></li>
				<li>The test <a id="_idIndexMarker185"/>verifies that the issue is displayed:<pre>        .expect(Selector('#search-results').innerText).contains(`Test issue ${randomDigits6}`);});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests13.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests13.js</a>.</p></li>
			</ol>
			<h2 id="_idParaDest-68"><a id="_idTextAnchor120"/>Adding the issue deletion test</h2>
			<p>Now let's <a id="_idIndexMarker186"/>add a <code>Redmine entities deletion tests</code> fixture and <code>Delete the issue</code> test to demonstrate how to handle native browser dialogs:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();const randomDigits5 = stamp.resetTimestamp();const randomDigits6 = stamp.resetTimestamp();const randomDigits7 = stamp.resetTimestamp();// ...test('Delete the issue', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits7}`)        .click('[value="Create"]')</pre></li>
				<li>The test creates a new issue:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits7}"]`)        .click('.new-issue')        .typeText('#issue_subject', `Test issue ${randomDigits7}`)        .typeText('#issue_description', `Test issue description ${randomDigits7}`)        .click('#issue_priority_id')        .click(Selector('#issue_priority_id option').withText('High'))        .click('[value="Create"]')</pre></li>
				<li>The test <a id="_idIndexMarker187"/>clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits7}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">Issues</strong> link:<pre>        .click('#main-menu .issues')</pre></li>
				<li>The test clicks on the issue link:<pre>        .click(Selector('.subject a').withText(`Test issue ${randomDigits7}`))</pre></li>
				<li>The test clicks on the <strong class="bold">Delete</strong> link.</li>
				<li>The test confirms the deletion in the browser modal window:<pre>        .setNativeDialogHandler(() =&gt; true)        .click('.icon-del')</pre></li>
				<li>The test verifies that the issue is not displayed:<pre>        .expect(Selector('.subject a').withText(`Test issue ${randomDigits7}`).exists).notOk()</pre></li>
				<li>The test verifies that the <strong class="bold">No data to display</strong> notification is displayed:<pre>        .expect(Selector('.nodata').innerText).eql('No data to display');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests14.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests14.js</a>.</p></li>
			</ol>
			<p>There's one <a id="_idIndexMarker188"/>interesting thing to note in this test: we are using the <code>.setNativeDialogHandler</code> method before the browser dialog window will be triggered. We are passing a simple arrow function inside this method: <code>() =&gt; true</code>. All it does is just return <code>true</code>. It should be done this way to answer OK (confirm) to the browser dialog window when it will appear (you can read more about this method in <a href="B16280_02_Final_JM_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a><em class="italic">, TestCafe under the Hood</em>, and here: <a href="https://devexpress.github.io/testcafe/documentation/reference/test-api/testcontroller/setnativedialoghandler.html">https://devexpress.github.io/testcafe/documentation/reference/test-api/testcontroller/setnativedialoghandler.html</a>).</p>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor121"/>Adding the file uploading test</h2>
			<p>To demonstrate <a id="_idIndexMarker189"/>how to work with uploading files, let's add an <code>Upload a file</code> test to the <code>Redmine entities creation tests</code> fixture. But before that, we will need to create a sample file that we will use for uploading, so open a shell and execute the following:</p>
			<pre>$ mkdir -p tests/uploads
$ echo 'test' &gt; uploads/test-file.txt</pre>
			<p>In the preceding commands, we are creating the <code>uploads</code> folder inside the <code>tests</code> folder, and then creating <code>test-file.txt</code> inside it.</p>
			<p>Now, as we have a dummy file prepared (you can see it on GitHub too: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/tree/master/ch4/test-project/tests/uploads/test-file.txt">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/tree/master/ch4/test-project/tests/uploads/test-file.txt</a>), let's create a file uploading test:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();const randomDigits5 = stamp.resetTimestamp();const randomDigits6 = stamp.resetTimestamp();const randomDigits7 = stamp.resetTimestamp();const randomDigits8 = stamp.resetTimestamp();// ...test('Upload a file', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits8}`)        .click('[value="Create"]')</pre></li>
				<li>The test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits8}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">Files</strong> link:<pre>        .click('.files')</pre></li>
				<li>The test clicks on the <strong class="bold">New</strong> <strong class="bold">file</strong> link:<pre>        .click('.icon-add')</pre></li>
				<li>The test sets the path to a file:<pre>        .setFilesToUpload('input.file_selector', './uploads/test-file.txt')</pre></li>
				<li>The test clicks on the <strong class="bold">Add</strong> button:<pre>        .click('[value="Add"]')</pre></li>
				<li>The test <a id="_idIndexMarker190"/>verifies that a link to the file is displayed:<pre>        .expect(Selector('.filename').innerText).eql('test-file.txt')</pre></li>
				<li>The test verifies that the MD5 checksum is displayed:<pre>        .expect(Selector('.digest').innerText).eql('d8e8fca2dc0f896fd7cb4cb0031ba249');});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests15.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests15.js</a>.</p></li>
			</ol>
			<p>There's one interesting thing to note in this test: we are using the <code>.setFilesToUpload</code> method to <a id="_idIndexMarker191"/>inject the file path to the file upload input on the page (you can read more about this method in the <a href="B16280_02_Final_JM_ePub.xhtml#_idTextAnchor027"><em class="italic">Chapter 2</em></a><em class="italic">, TestCafe under the Hood</em>, and here: <a href="https://devexpress.github.io/testcafe/documentation/reference/test-api/testcontroller/setfilestoupload.html">https://devexpress.github.io/testcafe/documentation/reference/test-api/testcontroller/setfilestoupload.html</a>).</p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor122"/>Adding the file deletion test</h2>
			<p>Now let's <a id="_idIndexMarker192"/>add one final test, <code>Delete the file</code>, to the <code>Redmine entities deletion tests</code> fixture:</p>
			<pre>const { Selector, ClientFunction } = require('testcafe');const { stamp } = require('js-automation-tools');const randomDigits1 = stamp.getTimestamp();const randomDigits2 = stamp.resetTimestamp();const randomDigits3 = stamp.resetTimestamp();const randomDigits4 = stamp.resetTimestamp();const randomDigits5 = stamp.resetTimestamp();const randomDigits6 = stamp.resetTimestamp();const randomDigits7 = stamp.resetTimestamp();const randomDigits8 = stamp.resetTimestamp();const randomDigits9 = stamp.resetTimestamp();// ...test('Delete the file', async (t) =&gt; {</pre>
			<p>The test will perform the following actions:</p>
			<ol>
				<li value="1">The test logs in:<pre>    await t.click('.login')        .typeText('#username', `test_user_testcafe_poc${randomDigits1}@sharklasers.com`)        .typeText('#password', 'test_user_testcafe_poc')        .click('[name="login"]')</pre></li>
				<li>The <a id="_idIndexMarker193"/>test creates a new project:<pre>        .click('#top-menu .projects')        .click('.icon-add')        .typeText('#project_name', `test_project${randomDigits9}`)        .click('[value="Create"]')</pre></li>
				<li>The test uploads a new file:<pre>        .click('#top-menu .projects')        .click(`[href*="/projects/test_project${randomDigits9}"]`)        .click('.files')        .click('.icon-add')        .setFilesToUpload('input.file_selector', './uploads/test-file.txt')        .click('[value="Add"]')</pre></li>
				<li>The <a id="_idIndexMarker194"/>test clicks on the <strong class="bold">Projects</strong> link in the top panel:<pre>        .click('#top-menu .projects')</pre></li>
				<li>The test clicks on the project link:<pre>        .click(`[href*="/projects/test_project${randomDigits9}"]`)</pre></li>
				<li>The test clicks on the <strong class="bold">Files</strong> link:<pre>        .click('.files')</pre></li>
				<li>The test clicks on the trash bin icon.</li>
				<li>The test confirms the deletion in the browser modal window:<pre>        .setNativeDialogHandler(() =&gt; true)        .click(Selector('.filename a').withText('test-file.txt').parent('.file').find('.buttons a').withAttribute('data-method', 'delete'))</pre></li>
				<li>The test verifies that a link to the file is not displayed:<pre>        .expect(Selector('.filename').withText('test-file.txt').exists).notOk()</pre></li>
				<li>The test <a id="_idIndexMarker195"/>verifies that the MD5 checksum is not displayed:<pre>        .expect(Selector('.digest').withText('d8e8fca2dc0f896fd7cb4cb0031ba249').exists).notOk();});</pre><p class="callout-heading">Note</p><p class="callout">You can also review and download this file on GitHub: <a href="https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests16.js">https://github.com/PacktPublishing/Modern-Web-Testing-with-TestCafe/blob/master/ch4/test-project/tests/basic-tests16.js</a>.</p></li>
			</ol>
			<p>One interesting thing to note in this test is how to get the element with a chain of methods: <code>Selector('.filename a').withText('test-file.txt').parent('.file').find('.buttons a').withAttribute('data-method', 'delete')</code>. Here, we are getting a link that has <code>test-file.txt</code> text, then searching for its parent element with the <code>file</code> class, then searching among its descendants for a link with the <code>data-method="delete"</code> attribute. This will guarantee that we clicked on the delete link for the corresponding file. You can read more about how to select the <a id="_idIndexMarker196"/>elements here: <a href="https://devexpress.github.io/testcafe/documentation/guides/basic-guides/select-page-elements.html">https://devexpress.github.io/testcafe/documentation/guides/basic-guides/select-page-elements.html</a>.</p>
			<h1 id="_idParaDest-71"><a id="_idTextAnchor123"/>Summary</h1>
			<p>In this chapter, we have concentrated on how to write tests for a real-life project. We crafted four sets of tests (fixtures) for the Redmine demo portal: log in tests, entity creation tests, entity editing tests, and entity deletion tests.</p>
			<p>Also, we learned some useful techniques such as how to debug tests, execute custom code, assert elements, clear inputs, press keys, confirm native browser alerts, upload files, and chain element selectors. All of these lessons can be applied to pretty much any other web project.</p>
			<p>As our set of tests in now ready, in the next chapter we will be adding setup and teardown sections to our curr<a id="_idTextAnchor124"/>ent code to improve its structure and enhance its maintainability.</p>
		</div>
	</body></html>