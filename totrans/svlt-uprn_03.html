<html><head></head><body>
<div id="_idContainer012">
<h1 class="chapter-number" id="_idParaDest-51"><a id="_idTextAnchor051"/><span class="koboSpan" id="kobo.1.1">3</span></h1>
<h1 id="_idParaDest-52"><a id="_idTextAnchor052"/><span class="koboSpan" id="kobo.2.1">Compatibility with Existing Standards</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Some frameworks attempt to simplify your work as a developer by providing you with tools and functionality to wrap around common tasks, such as making network requests or managing data submitted by forms. </span><span class="koboSpan" id="kobo.3.2">While the intentions are noble, this strategy can have unintended consequences. </span><span class="koboSpan" id="kobo.3.3">For instance, when learning a new framework, developers have to master all of its intricacies to be effective. </span><span class="koboSpan" id="kobo.3.4">Reading about </span><em class="italic"><span class="koboSpan" id="kobo.4.1">yet another way to make network requests</span></em><span class="koboSpan" id="kobo.5.1"> can slow developers down, as time spent reading documentation is time spent </span><em class="italic"><span class="koboSpan" id="kobo.6.1">not building</span></em><span class="koboSpan" id="kobo.7.1">. </span><span class="koboSpan" id="kobo.7.2">It can also prevent code portability. </span><span class="koboSpan" id="kobo.7.3">When the code written for application </span><em class="italic"><span class="koboSpan" id="kobo.8.1">A</span></em><span class="koboSpan" id="kobo.9.1"> is specific to framework </span><em class="italic"><span class="koboSpan" id="kobo.10.1">X</span></em><span class="koboSpan" id="kobo.11.1">, then the code will need to be modified before being reused in application </span><em class="italic"><span class="koboSpan" id="kobo.12.1">B</span></em><span class="koboSpan" id="kobo.13.1">, which was built with </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">framework </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.15.1">Y</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">SvelteKit has a solution to this, and that solution is to do nothing. </span><span class="koboSpan" id="kobo.17.2">Well, not </span><em class="italic"><span class="koboSpan" id="kobo.18.1">nothing</span></em><span class="koboSpan" id="kobo.19.1">, but rather than providing you with wrappers and functions that will require you to look up the documentation each time you go to use one, SvelteKit encourages the use of existing Web </span><strong class="bold"><span class="koboSpan" id="kobo.20.1">Application Programming Interfaces</span></strong><span class="koboSpan" id="kobo.21.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.22.1">APIs</span></strong><span class="koboSpan" id="kobo.23.1">) and standards. </span><span class="koboSpan" id="kobo.23.2">By not reinventing the wheel, more developers can get started with SvelteKit quickly, since they won’t have to learn abstractions for standards that they’re already familiar with. </span><span class="koboSpan" id="kobo.23.3">Not only does it keep time spent reading documentation to a minimum, but it also requires less code to power </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">a framework.</span></span></p>
<p><span class="koboSpan" id="kobo.25.1">This chapter will cover some basic use cases of </span><strong class="bold"><span class="koboSpan" id="kobo.26.1">Web APIs</span></strong><span class="koboSpan" id="kobo.27.1"> and how they interact with SvelteKit. </span><span class="koboSpan" id="kobo.27.2">Specifically, we’ll look at these examples of current </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">web standards:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Fetch</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.30.1">FormData</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.31.1">URL</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.32.1">An in-depth dive into each of these standards is beyond the scope of this chapter, but if you’re looking for more information about them, resources will be provided at the end. </span><span class="koboSpan" id="kobo.32.2">After these examples, you should feel comfortable using your existing knowledge of various web standards </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">with SvelteKit.</span></span></p>
<h1 id="_idParaDest-53"><a id="_idTextAnchor053"/><span class="koboSpan" id="kobo.34.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.35.1">The complete code for this chapter is available on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">at: </span></span><a href="https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter03"><span class="No-Break"><span class="koboSpan" id="kobo.37.1">https://github.com/PacktPublishing/SvelteKit-Up-and-Running/tree/main/chapters/chapter03</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.38.1">.</span></span></p>
<h1 id="_idParaDest-54"><a id="_idTextAnchor054"/><span class="koboSpan" id="kobo.39.1">Fetch</span></h1>
<p><span class="koboSpan" id="kobo.40.1">To begin, let’s </span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.41.1">take a look at one of the most commonly used Web APIs, </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">fetch</span></strong><span class="koboSpan" id="kobo.43.1">. </span><span class="koboSpan" id="kobo.43.2">Assuming </span><a id="_idIndexMarker044"/><span class="koboSpan" id="kobo.44.1">your development environment is on the latest LTS version of Node.js (v18+), you’ll have access to </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">fetch</span></strong><span class="koboSpan" id="kobo.46.1"> on the server without having to install an extra package such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.47.1">node-fetch</span></strong><span class="koboSpan" id="kobo.48.1">. </span><span class="koboSpan" id="kobo.48.2">That package was the most widely used package to deliver functionality, allowing developers to make network requests before </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">fetch</span></strong><span class="koboSpan" id="kobo.50.1"> was incorporated into Node.js's core features. </span><span class="koboSpan" id="kobo.50.2">Since </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">fetch</span></strong><span class="koboSpan" id="kobo.52.1"> is now also supported in every major browser, we can safely use it in both client- and server-side environments to make external and internal requests. </span><span class="koboSpan" id="kobo.52.2">Because SvelteKit can run in both a browser and server environment, it is safe to say that we have, in fact, “made </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">fetch happen.”</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">To illustrate how fetch can work in both the browser and server, let’s take a look at an example. </span><span class="koboSpan" id="kobo.54.2">We’ll create a new route by adding the </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">src/routes/fetch/+page.svelte</span></strong><span class="koboSpan" id="kobo.56.1"> file to serve as our demo page. </span><span class="koboSpan" id="kobo.56.2">We’ll also create </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">src/routes/fetch/+page.js</span></strong><span class="koboSpan" id="kobo.58.1"> to get data from an actual </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">fetch</span></strong><span class="koboSpan" id="kobo.60.1"> request. </span><span class="koboSpan" id="kobo.60.2">In this example, we’ll utilize NASA’s free </span><em class="italic"><span class="koboSpan" id="kobo.61.1">Astronomy Picture of the Day</span></em><span class="koboSpan" id="kobo.62.1"> API found at </span><a href="https://api.nasa.gov/"><span class="koboSpan" id="kobo.63.1">https://api.nasa.gov/</span></a><span class="koboSpan" id="kobo.64.1">. </span><span class="koboSpan" id="kobo.64.2">It’s recommended to obtain an API key for regular use; however, the demonstration API key provided in the following examples will suffice for our purposes. </span><span class="koboSpan" id="kobo.64.3">This example makes a network request to the NASA API and shows the data received on </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">our page.</span></span></p>
<p><span class="koboSpan" id="kobo.66.1">Please note that the styles are by no means required and are only provided to make our example more digestible when viewed in the browser. </span><span class="koboSpan" id="kobo.66.2">We could add lots of styles and make this look fantastic, but that would take up more of our limited space on these pages. </span><span class="koboSpan" id="kobo.66.3">Plus, you’re here to learn about SvelteKit, </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">not CSS:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.68.1">src/routes/fetch/+page.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.69.1">
&lt;script&gt;
  export let data;
&lt;/script&gt;
&lt;h1&gt;Astronomy Picture of the Day&lt;/h1&gt;
&lt;h2&gt;{data.pic.title}&lt;/h2&gt;
&lt;div class='wrap'&gt;
  &lt;a href={data.pic.hdurl}&gt;&lt;img src={data.pic.url}&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;{data.pic.explanation}&lt;/p&gt;
&lt;style&gt;
  h1, h2 {
    text-align: center;
  }
  .wrap {
    max-width: 75%;
    margin: 0 auto;
    text-align: center;
  }
  img {
    max-width: 100%;
  }
&lt;/style&gt;</span></pre>
<p><span class="koboSpan" id="kobo.70.1">In this file, we’re </span><a id="_idIndexMarker045"/><span class="koboSpan" id="kobo.71.1">simply setting up the markup for our data to populate. </span><span class="koboSpan" id="kobo.71.2">To get access</span><a id="_idIndexMarker046"/><span class="koboSpan" id="kobo.72.1"> to the data provided by the sibling </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">+page.js</span></strong><span class="koboSpan" id="kobo.74.1"> file, we </span><em class="italic"><span class="koboSpan" id="kobo.75.1">must</span></em><span class="koboSpan" id="kobo.76.1"> include </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">export let data;</span></strong><span class="koboSpan" id="kobo.78.1">. </span><span class="koboSpan" id="kobo.78.2">If you're familiar with React or Vue, think of this as SvelteKit's method for passing props between components. </span><span class="koboSpan" id="kobo.78.3">If you're familiar with React of Vue, think of this as SvelteKit's method for passing props between components. </span><span class="koboSpan" id="kobo.78.4">After doing that, we can use the data provided in the object to populate the image title, a link to the high-resolution file, a link to the externally hosted image, and show an image description. </span><span class="koboSpan" id="kobo.78.5">And, of course, we’ve added some minimal styles. </span><span class="koboSpan" id="kobo.78.6">The real magic, and our </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">fetch</span></strong><span class="koboSpan" id="kobo.80.1"> request, happens in the next snippet for </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">+page.js</span></strong><span class="koboSpan" id="kobo.82.1">, where we make the call to the </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">external API:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.84.1">src/routes/fetch/+page.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.85.1">
const key = 'DEMO_KEY'; // your API key here
export function load() {
  const pic = fetch(`https://api.nasa.gov/planetary/apod?api_key=${key}`)
  .then(response =&gt; {
    console.log('got response');
    return response.json();
  });
  return {pic};
}</span></pre>
<p><span class="koboSpan" id="kobo.86.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">+page.js</span></strong><span class="koboSpan" id="kobo.88.1">, we’ve </span><a id="_idIndexMarker047"/><span class="koboSpan" id="kobo.89.1">created </span><a id="_idIndexMarker048"/><span class="koboSpan" id="kobo.90.1">a constant where you can place your own API key. </span><span class="koboSpan" id="kobo.90.2">Then, we exported the </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">load</span></strong><span class="koboSpan" id="kobo.92.1"> function, which is necessary to tell SvelteKit to run before rendering the sibling </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.94.1"> file. </span><span class="koboSpan" id="kobo.94.2">It can be </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">async</span></strong><span class="koboSpan" id="kobo.96.1"> or not; SvelteKit doesn’t care and will handle each case accordingly. </span><span class="koboSpan" id="kobo.96.2">We then create the constant </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">pic</span></strong><span class="koboSpan" id="kobo.98.1">, to which we can assign the promise returned from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">fetch</span></strong><span class="koboSpan" id="kobo.100.1"> call. </span><span class="koboSpan" id="kobo.100.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">fetch</span></strong><span class="koboSpan" id="kobo.102.1"> call, we provided the URL with an API key appended to it, as the first and only argument. </span><span class="koboSpan" id="kobo.102.2">If your API needed to have options specified in the header, a method set, or perhaps an authentication cookie, you could do so by providing that as an object in the second argument. </span><span class="koboSpan" id="kobo.102.3">Remember that SvelteKit aims to be compatible with the existing web standards, so the implementations will have at least the standardized functionality. </span><span class="koboSpan" id="kobo.102.4">See the resources at the end of this chapter for more information on how to utilize </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">fetch</span></strong><span class="koboSpan" id="kobo.104.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">these ways.</span></span></p>
<p><span class="koboSpan" id="kobo.106.1">Continuing with the promise received by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">fetch</span></strong><span class="koboSpan" id="kobo.108.1"> call, we run </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">console.log()</span></strong><span class="koboSpan" id="kobo.110.1"> to demonstrate that code is being run in both the browser and server environments. </span><span class="koboSpan" id="kobo.110.2">If your development environment isn’t yet running, you can start it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">npm run dev</span></strong><span class="koboSpan" id="kobo.112.1"> command. </span><span class="koboSpan" id="kobo.112.2">Remember that it will then be available in your browser at the provided URL. </span><span class="koboSpan" id="kobo.112.3">You can confirm this by checking your browser console output in your developer tools, as well as the output from your Vite development server in your terminal. </span><span class="koboSpan" id="kobo.112.4">In both cases, you should see the “</span><em class="italic"><span class="koboSpan" id="kobo.113.1">got response</span></em><span class="koboSpan" id="kobo.114.1">” output displayed. </span><span class="koboSpan" id="kobo.114.2">Because our request didn’t require any authentication, it was safe for us to run on the </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">client side.</span></span></p>
<p><span class="koboSpan" id="kobo.116.1">Finally, we</span><a id="_idIndexMarker049"/><span class="koboSpan" id="kobo.117.1"> convert the </span><strong class="bold"><span class="koboSpan" id="kobo.118.1">Response</span></strong><span class="koboSpan" id="kobo.119.1"> object body to JSON, and the entire promise is </span><a id="_idIndexMarker050"/><span class="koboSpan" id="kobo.120.1">wrapped in an object so that it may be returned. </span><span class="koboSpan" id="kobo.120.2">As we’ve seen with universal </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">load</span></strong><span class="koboSpan" id="kobo.122.1"> functions, they run on both the server and browser. </span><span class="koboSpan" id="kobo.122.2">In the case of universal load functions, they </span><em class="italic"><span class="koboSpan" id="kobo.123.1">must</span></em><span class="koboSpan" id="kobo.124.1"> return </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">an object.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.126.1">Loading Data</span></p>
<p class="callout"><span class="koboSpan" id="kobo.127.1">We’ve established that code run from </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">+page.js</span></strong><span class="koboSpan" id="kobo.129.1"> is actually run in both the browser and server. </span><span class="koboSpan" id="kobo.129.2">If we wanted the code to only be run on the client, we would place that in </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.131.1">. </span><span class="koboSpan" id="kobo.131.2">Similarly, if we wanted this code to be run only on the server, then we could change the filename to </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">+page.server.js</span></strong><span class="koboSpan" id="kobo.133.1">. </span><span class="koboSpan" id="kobo.133.2">This second use case would be more suitable for making an authenticated database call or accessing environment variables, such as API keys (as we did in this previous example). </span><span class="koboSpan" id="kobo.133.3">SvelteKit will recognize that this file is intended to run only in the server environment and will take the appropriate steps to separate that logic. </span><span class="koboSpan" id="kobo.133.4">Server </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">load</span></strong><span class="koboSpan" id="kobo.135.1"> functions also work slightly differently from universal </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">load</span></strong><span class="koboSpan" id="kobo.137.1"> functions, but we’ll go into that in more depth in a </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">later chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.139.1">After doing all of this, we can now navigate to </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">/fetch</span></strong><span class="koboSpan" id="kobo.141.1"> in our browser and see the image, its title, and a description, and even click on the image to view the full high-resolution file. </span><span class="koboSpan" id="kobo.141.2">It’s very helpful to make calls to various internal or external APIs, but our application will likely need to receive data from users at some point. </span><span class="koboSpan" id="kobo.141.3">In the next section, we’ll cover how we can access and manipulate </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">FormData</span></strong><span class="koboSpan" id="kobo.143.1"> objects provided </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">Requests</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">.</span></span></p>
<h1 id="_idParaDest-55"><a id="_idTextAnchor055"/><span class="koboSpan" id="kobo.147.1">FormData</span></h1>
<p><span class="koboSpan" id="kobo.148.1">When</span><a id="_idIndexMarker051"/><span class="koboSpan" id="kobo.149.1"> building web applications, it’s common to accept data from users through the use of forms. </span><span class="koboSpan" id="kobo.149.2">Accessing this data can be done via the </span><strong class="bold"><span class="koboSpan" id="kobo.150.1">FormData API</span></strong><span class="koboSpan" id="kobo.151.1">. </span><span class="koboSpan" id="kobo.151.2">To</span><a id="_idIndexMarker052"/><span class="koboSpan" id="kobo.152.1"> see this in action, let’s look at a basic form that allows users to post a comment to our application. </span><span class="koboSpan" id="kobo.152.2">In this example, we’ll create two files, </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.154.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.155.1">+page.server.js</span></strong><span class="koboSpan" id="kobo.156.1">, under the new </span><em class="italic"><span class="koboSpan" id="kobo.157.1">comment</span></em><span class="koboSpan" id="kobo.158.1"> route. </span><span class="koboSpan" id="kobo.158.2">As before, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">+page.svelte</span></strong><span class="koboSpan" id="kobo.160.1"> file contains HTML to scaffold our form and minimal styles. </span><span class="koboSpan" id="kobo.160.2">In order to get access to the data sent from our server, we must include the line reading </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">export let form;</span></strong><span class="koboSpan" id="kobo.162.1"> in our client-side </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">&lt;script&gt;</span></strong><span class="koboSpan" id="kobo.164.1"> code. </span><span class="koboSpan" id="kobo.164.2">This lets us view the status of the object returned from </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">+page.server.js</span></strong><span class="koboSpan" id="kobo.166.1"> and report the status back to the user by using</span><a id="_idIndexMarker053"/><span class="koboSpan" id="kobo.167.1"> the templating </span><a id="_idIndexMarker054"/><span class="koboSpan" id="kobo.168.1">system provided </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">by Svelte:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.170.1">src/routes/comment/+page.svelte</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.171.1">
&lt;script&gt;
  export let form;
&lt;/script&gt;
&lt;div class='wrap'&gt;
  {#if form &amp;&amp; form.status === true}
    &lt;p&gt;{form.msg}&lt;/p&gt;
  {/if}
  &lt;form method='POST'&gt;
    &lt;label&gt;
      Comment
      &lt;input name="comment" type="text"&gt;
    &lt;/label&gt;
    &lt;button&gt;Submit&lt;/button&gt;
  &lt;/form&gt;
&lt;/div&gt;
&lt;style&gt;
  .wrap {
    width: 50%;
    margin: 0 auto;
    text-align: center;
  }
  p {
    color: green;
  }
  label {
    display: block;
    margin: 1rem;
  }
&lt;/style&gt;</span></pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.172.1"> src/routes/comment/+page.server.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.173.1">
export const actions = {
  default: async (event) =&gt; {
    const form = await event.request.formData();
    const comment = form.get('comment');
    if(comment) {
      // save comment to database
      return {
        status: true,
        msg: `Your comment has been received!`
      }
    }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.174.1">As</span><a id="_idIndexMarker055"/><span class="koboSpan" id="kobo.175.1"> noted </span><a id="_idIndexMarker056"/><span class="koboSpan" id="kobo.176.1">earlier, </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">+page.server.js</span></strong><span class="koboSpan" id="kobo.178.1"> works in the same way as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">+page.js</span></strong><span class="koboSpan" id="kobo.180.1"> file, except that it will only run on the server. </span><span class="koboSpan" id="kobo.180.2">Just as we can export </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">load()</span></strong><span class="koboSpan" id="kobo.182.1">, like in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">fetch</span></strong><span class="koboSpan" id="kobo.184.1"> example, server-side files can also export </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">actions</span></strong><span class="koboSpan" id="kobo.186.1">. </span><span class="koboSpan" id="kobo.186.2">These exported </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">actions</span></strong><span class="koboSpan" id="kobo.188.1"> can only be accessed via </span><strong class="source-inline"><span class="koboSpan" id="kobo.189.1">POST</span></strong><span class="koboSpan" id="kobo.190.1"> requests. </span><span class="koboSpan" id="kobo.190.2">We’ll look at how we can further utilize </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">actions</span></strong><span class="koboSpan" id="kobo.192.1"> in a later chapter, but for now, note that we’re creating a single action, </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">default</span></strong><span class="koboSpan" id="kobo.194.1">. </span><span class="koboSpan" id="kobo.194.2">This means that when a form is submitted, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">POST</span></strong><span class="koboSpan" id="kobo.196.1"> request is handled by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">comment</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.199.1"> endpoint.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">From the </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">default</span></strong><span class="koboSpan" id="kobo.202.1"> action, this </span><a id="_idIndexMarker057"/><span class="koboSpan" id="kobo.203.1">example accesses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">Request</span></strong><span class="koboSpan" id="kobo.205.1"> object located in </span><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">event</span></strong><span class="koboSpan" id="kobo.207.1">, and then accesses </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">FormData</span></strong><span class="koboSpan" id="kobo.209.1"> within that </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">Request</span></strong><span class="koboSpan" id="kobo.211.1">. </span><span class="koboSpan" id="kobo.211.2">Once the </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">FormData</span></strong><span class="koboSpan" id="kobo.213.1"> object has been assigned to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">form</span></strong><span class="koboSpan" id="kobo.215.1"> variable, we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">get()</span></strong><span class="koboSpan" id="kobo.217.1"> to retrieve</span><a id="_idIndexMarker058"/><span class="koboSpan" id="kobo.218.1"> the value from the form input by its name. </span><span class="koboSpan" id="kobo.218.2">Normally, we would then move on to something akin to a database call that would save the comment alongside a unique user identifier. </span><span class="koboSpan" id="kobo.218.3">For the sake of brevity, we will just return an object with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">status</span></strong><span class="koboSpan" id="kobo.220.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">msg</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.222.1"> properties.</span></span></p>
<p><span class="koboSpan" id="kobo.223.1">When the page reloads, those properties are then checked by the Svelte template syntax and show the user a message that their comment has been successfully submitted. </span><span class="koboSpan" id="kobo.223.2">Even though this example only accessed </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">FormData</span></strong><span class="koboSpan" id="kobo.225.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">get()</span></strong><span class="koboSpan" id="kobo.227.1">, all methods documented in official standards are also available to us. </span><span class="koboSpan" id="kobo.227.2">If we wanted to cycle through all values and keys submitted, we could do so using a </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">for...of</span></strong><span class="koboSpan" id="kobo.229.1"> loop and access the values via </span><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">form.values()</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.231.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">form.keys()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.234.1">Now that we know how to obtain data from submitted forms, we should also look at another way of receiving data from users that may be overlooked – </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">the URL.</span></span></p>
<h1 id="_idParaDest-56"><a id="_idTextAnchor056"/><span class="koboSpan" id="kobo.236.1">URL</span></h1>
<p><span class="koboSpan" id="kobo.237.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.238.1">URL API</span></strong><span class="koboSpan" id="kobo.239.1"> can </span><a id="_idIndexMarker059"/><span class="koboSpan" id="kobo.240.1">be helpful in instances where you need to parse your </span><a id="_idIndexMarker060"/><span class="koboSpan" id="kobo.241.1">application’s URL. </span><span class="koboSpan" id="kobo.241.2">SvelteKit makes accessing the URL API quite simple, as it is also available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">event</span></strong><span class="koboSpan" id="kobo.243.1"> object, just as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">request</span></strong><span class="koboSpan" id="kobo.245.1"> object was. </span><span class="koboSpan" id="kobo.245.2">Let’s continue with our previous example using comments. </span><span class="koboSpan" id="kobo.245.3">If we wanted to build a commenting service for use across a network of other websites, we may want to report to a user which site they just commented on. </span><span class="koboSpan" id="kobo.245.4">Let’s expand on that previous example and do just that. </span><span class="koboSpan" id="kobo.245.5">We don’t need to make any changes to </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">src/routes/comment/+page.svelte</span></strong><span class="koboSpan" id="kobo.247.1">. </span><span class="koboSpan" id="kobo.247.2">Instead, we’ll adjust our server </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">action accordingly.</span></span></p>
<p><span class="koboSpan" id="kobo.249.1">This example is identical to the last except for a couple of changes. </span><span class="koboSpan" id="kobo.249.2">The URL API is accessed via </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">event.url</span></strong><span class="koboSpan" id="kobo.251.1"> and assigned to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">url</span></strong><span class="koboSpan" id="kobo.253.1"> constant. </span><span class="koboSpan" id="kobo.253.2">It is then output to the server with </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">console.log(url)</span></strong><span class="koboSpan" id="kobo.255.1"> to show you the various read-only properties that you can access. </span><span class="koboSpan" id="kobo.255.2">For this demonstration, we get the hostname via </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">url.hostname</span></strong><span class="koboSpan" id="kobo.257.1"> and use it in a</span><a id="_idIndexMarker061"/><span class="koboSpan" id="kobo.258.1"> template literal, which is assigned to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">msg</span></strong><span class="koboSpan" id="kobo.260.1"> property of the </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">returned object:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.262.1">src/routes/comment/+page.server.js</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.263.1">
export const actions = {
  default: async (event) =&gt; {
    const form = await event.request.formData();
    const url = event.url;
    console.log(url);
    const comment = form.get('comment');
    if(comment) {
      // save comment to DB here
      return {
        status: true,
        msg: `Your comment at ${url.hostname} has been 
          received!`
      }
    }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.264.1">If you switch to your </span><a id="_idIndexMarker062"/><span class="koboSpan" id="kobo.265.1">browser window and post a comment, you’ll now see that it reports the </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">hostname</span></strong><span class="koboSpan" id="kobo.267.1"> property. </span><span class="koboSpan" id="kobo.267.2">In a production environment, this would ideally be your domain name, but in our development environment, we see the message </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">Your comment at 127.0.0.1 has been received!</span></strong><span class="koboSpan" id="kobo.269.1">. </span><span class="koboSpan" id="kobo.269.2">If you’ve accessed your development site from </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">http://localhost</span></strong><span class="koboSpan" id="kobo.271.1">, you’ll see </span><strong class="bold"><span class="koboSpan" id="kobo.272.1">localhost</span></strong><span class="koboSpan" id="kobo.273.1"> instead of the IP address. </span><span class="koboSpan" id="kobo.273.2">Switch back to your terminal where the development server is running, and you’ll see the various</span><a id="_idIndexMarker063"/><span class="koboSpan" id="kobo.274.1"> read-only properties that you have access to within the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">URL</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.276.1"> object:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.277.1">Sample event.url object</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.278.1">
URL {
  href: 'http://127.0.0.1:5173/comment',
  origin: 'http://127.0.0.1:5173',
  protocol: 'http:',
  username: '',
  password: '',
  host: '127.0.0.1:5173',
  hostname: '127.0.0.1',
  port: '5173',
  pathname: '/comment',
  search: '',
  searchParams: URLSearchParams {},\
  hash: ''
}</span></pre>
<p><span class="koboSpan" id="kobo.279.1">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">URL</span></strong><span class="koboSpan" id="kobo.281.1"> object </span><a id="_idIndexMarker064"/><span class="koboSpan" id="kobo.282.1">showcases how simple it is to grab information about it. </span><span class="koboSpan" id="kobo.282.2">All of the read-only properties shown are easily accessed using dot notation. </span><span class="koboSpan" id="kobo.282.3">Gone are the days of parsing an entire </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">URL</span></strong><span class="koboSpan" id="kobo.284.1"> with regex in an attempt to extract the portion needed. </span><span class="koboSpan" id="kobo.284.2">Now, if you wanted to get the values set in query strings, you could easily iterate over </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">event.url.searchParams</span></strong><span class="koboSpan" id="kobo.286.1"> with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">for...of</span></strong><span class="koboSpan" id="kobo.288.1"> loop. </span><span class="koboSpan" id="kobo.288.2">Go ahead and add some options to the URL in your browser. </span><span class="koboSpan" id="kobo.288.3">An example might look like </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">http://127.0.0.1:5173/comment?id=5&amp;name=YOUR_NAME_HERE</span></strong><span class="koboSpan" id="kobo.290.1">. </span><span class="koboSpan" id="kobo.290.2">Now, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">console.log(url)</span></strong><span class="koboSpan" id="kobo.292.1"> function call will output the names and values set after the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">?</span></strong><span class="koboSpan" id="kobo.294.1"> and each </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">subsequent </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">&amp;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">.</span></span></p>
<h1 id="_idParaDest-57"><a id="_idTextAnchor057"/><span class="koboSpan" id="kobo.298.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.299.1">In this chapter, we covered an example use case of </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">fetch</span></strong><span class="koboSpan" id="kobo.301.1"> and a two-part demonstration showing how </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">URL</span></strong><span class="koboSpan" id="kobo.303.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">FormData</span></strong><span class="koboSpan" id="kobo.305.1"> can be used. </span><span class="koboSpan" id="kobo.305.2">While the examples presented here do not represent the full scope of the various Web APIs that you’ll have access to, they should illustrate how simple it is to use them with SvelteKit. </span><span class="koboSpan" id="kobo.305.3">If you’re hoping to build applications with SvelteKit, it’s important you become familiar with these modern Web APIs, as they’re used extensively throughout development with SvelteKit. </span><span class="koboSpan" id="kobo.305.4">SvelteKit encourages you to lean on that existing knowledge. </span><span class="koboSpan" id="kobo.305.5">By doing so, SvelteKit can ship less code to you so that you can ship less code to </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">your users.</span></span></p>
<p><span class="koboSpan" id="kobo.307.1">In the next chapter, we’ll move away from the background information that is necessary for using SvelteKit and start building something that resembles an application. </span><span class="koboSpan" id="kobo.307.2">We’ll cover various routing techniques and how you can build out a consistent user interface across </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">the application.</span></span></p>
<h1 id="_idParaDest-58"><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.309.1">Resources</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.310.1">MDN Web Docs – For references to </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">fetch()</span></strong><span class="koboSpan" id="kobo.312.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">formData()</span></strong><span class="koboSpan" id="kobo.314.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">URL</span></strong><span class="koboSpan" id="kobo.316.1">, and more, </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">visit </span></span><a href="https://developer.mozilla.org"><span class="No-Break"><span class="koboSpan" id="kobo.318.1">https://developer.mozilla.org</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.319.1">.</span></span></li>
</ul>
</div>


<div class="Content" id="_idContainer013">
<h1 id="_idParaDest-59"><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.1.1">Part 2 – Core Concepts</span></h1>
<p><span class="koboSpan" id="kobo.2.1">Navigation on the web is such a quintessential experience that the developers of SvelteKit have made routing central to the framework. </span><span class="koboSpan" id="kobo.2.2">In this part, we’ll examine previously introduced routing techniques in more detail. </span><span class="koboSpan" id="kobo.2.3">After that, we’ll see how SvelteKit moves data to components and accepts data from them through HTML form elements. </span><span class="koboSpan" id="kobo.2.4">Finally, we’ll see some more advanced routing techniques that promise to cover even the most obscure edge cases encountered </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">in routing.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19024_04_Final_AM.xhtml#_idTextAnchor060"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Effective Routing Techniques</span></em></li>
<li><a href="B19024_05_Final_AM.xhtml#_idTextAnchor072"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 5</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Deep Dive into Data Loading</span></em></li>
<li><a href="B19024_06_Final_AM.xhtml#_idTextAnchor080"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 6</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Forms and Data Submission</span></em></li>
<li><a href="B19024_07_Final_AM.xhtml#_idTextAnchor093"><em class="italic"><span class="koboSpan" id="kobo.15.1">Chapter 7</span></em></a><span class="koboSpan" id="kobo.16.1">, </span><em class="italic"><span class="koboSpan" id="kobo.17.1">Advanced Routing Techniques</span></em></li>
</ul>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer014">
</div>
</div>
<div>
<div id="_idContainer015">
</div>
</div>
</body></html>