<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Working with Content" id="aid-1KEEU1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Content</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Managing and displaying web contents</li><li class="listitem">Creating a new structure</li><li class="listitem">Creating a new template</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/>Introduction</h1></div></div></div><p>As was described in the previous chapter, Liferay provides a whole set of tools that allows us to manage files that store data exchanged between the employees of the company. However, in many cases, it is not quite convenient for end users to operate on the information stored in files. For example, it is much easier to navigate through the content available directly on the web page than in a file while reading the news or browsing the corporate knowledge base. Information such as news, project descriptions, procedures, and so on can be provided using web content. The web content can be displayed on a page using some specific portlets, such as the Web Content Display portlet or the Asset Publisher portlet.</p></div></div>
<div class="section" title="Managing and displaying web contents"><div class="titlepage" id="aid-1LCVG2"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Managing and displaying web contents</h1></div></div></div><p>Each site in Liferay has its own separate set of web contents, which can be accessed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>. All the web contents stored in the <span class="strong"><strong>Web Content</strong></span> section can be organized in a tree-like folder structure. The web content<a id="id381" class="indexterm"/> can contain text, graphics, tables, lists, and links to other <a id="id382" class="indexterm"/>web contents, documents, or pages. Additionally, every web content can be tagged and categorized or provided with the list of assets related to it. This list will be listed in the related assets section under the main content of the web content. It is also possible to define permissions that specify which actions can be performed on web contents by users assigned to different roles.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec137"/>How to do it…</h2></div></div></div><p>This recipe will <a id="id383" class="indexterm"/>cover all the basic actions that can be performed in<a id="id384" class="indexterm"/> order to manage web contents within a site.</p><div class="section" title="Creating a new folder"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec49"/>Creating a new folder</h3></div></div></div><p>To add a<a id="id385" class="indexterm"/> new folder, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin | Site Administration | Content | Web Content</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Select the <span class="strong"><strong>Folder</strong></span> option (if you add a folder inside one that is already created, the <span class="strong"><strong>Subfolder</strong></span> option will be available instead).<div class="mediaobject"><img src="../Images/image00343.jpeg" alt="Creating a new folder"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the <span class="strong"><strong>Name (Required)</strong></span> of the folder.</li><li class="listitem">Enter the <span class="strong"><strong>Description</strong></span> of the folder.</li><li class="listitem">Determine <span class="strong"><strong>Permissions</strong></span> for the folder by setting all actions that may be performed by specific roles (you can find more permissions after clicking on the <span class="strong"><strong>More Options</strong></span> link).</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.<div class="note" title="Note"><h3 class="title"><a id="tip14"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Editing a folder"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec50"/>Editing a folder</h3></div></div></div><p>To <a id="id386" class="indexterm"/>edit a folder, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">Find the<a id="id387" class="indexterm"/> folder that you want to edit.</li><li class="listitem">Click on its actions icon (the down-arrow icon visible when hovering on the folder miniature).<div class="mediaobject"><img src="../Images/image00344.jpeg" alt="Editing a folder"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Edit</strong></span> button.</li><li class="listitem">Provide a new <span class="strong"><strong>Name (required)</strong></span> for the folder.</li><li class="listitem">Enter a new <span class="strong"><strong>Description</strong></span> of the folder.</li><li class="listitem">Determine new <span class="strong"><strong>Permissions</strong></span> for the folder by setting all actions that may be performed by specific roles.</li><li class="listitem">Leave the <span class="strong"><strong>Merge with Parent Folder</strong></span> option unchecked.</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Creating a new web content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec51"/>Creating a new web content</h3></div></div></div><p>To create a <a id="id388" class="indexterm"/>new basic web content, perform these roles:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Choose the <span class="strong"><strong>Basic web content</strong></span> option.</li><li class="listitem">Provide the <span class="strong"><strong>Title (Required)</strong></span> and <span class="strong"><strong>Content</strong></span>.<div class="mediaobject"><img src="../Images/image00345.jpeg" alt="Creating a new web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to the <span class="strong"><strong>Abstract</strong></span> tab.</li><li class="listitem">Provide a <span class="strong"><strong>Summary</strong></span>.</li><li class="listitem">Set the <a id="id389" class="indexterm"/>small image by providing a URL or by uploading it from your computer drive. Then, select the <span class="strong"><strong>Use Small Image</strong></span> option.</li><li class="listitem">Navigate to the <span class="strong"><strong>Categorization</strong></span> tab.</li><li class="listitem">Choose <span class="strong"><strong>Type</strong></span> from the type drop-down list, for example, <span class="strong"><strong>News</strong></span>.</li><li class="listitem">Choose <span class="strong"><strong>Categories</strong></span> from the available category dictionaries (represented by a name and a related <span class="strong"><strong>Select</strong></span> button) by clicking on the button beside the dictionary and marking the categories.<div class="note" title="Note"><h3 class="title"><a id="tip15"/>Tip</h3><p>If there are no visible categories that can be assigned to the document, it means that either the categories for the specific site have not been created or the account user, who is working on it, does not have access to the existing category's dictionaries.</p></div></li><li class="listitem">Provide <span class="strong"><strong>Tags</strong></span> by adding new tags. You can choose them from the list of existing tags or use the suggestions function.</li><li class="listitem">Navigate to the <span class="strong"><strong>Schedule</strong></span> tab.</li><li class="listitem">Set the <span class="strong"><strong>Display date</strong></span>, <span class="strong"><strong>Review date</strong></span>, and <span class="strong"><strong>Expiration date</strong></span> functions (or enable the <span class="strong"><strong>Never expire</strong></span> and <span class="strong"><strong>Never review</strong></span> functions).</li><li class="listitem">Navigate to the <span class="strong"><strong>Display Page</strong></span> tab.</li><li class="listitem">Choose<a id="id390" class="indexterm"/> the page on which you want the web content to be displayed in full.<div class="note" title="Note"><h3 class="title"><a id="note26"/>Note</h3><p>The display page will be available if there is at least one page containing the Asset Publisher portlet with the <span class="strong"><strong>Set as the Default Asset Publisher for This Page</strong></span> option enabled. Page names without an Asset Publisher portlet are shown in gray instead of black. For more information, refer to the <span class="emphasis"><em>Asset Publisher as a search-based tool for content presentation</em></span> recipe from <a class="link" title="Chapter 8. Search and Content Presentation Tools" href="part0059.xhtml#aid-1O8H61">Chapter 8</a>, <span class="emphasis"><em>Search and Content Presentation Tools</em></span>.</p></div></li><li class="listitem">Navigate to the <span class="strong"><strong>Related Assets</strong></span> tab.</li><li class="listitem">Choose <span class="strong"><strong>Related Assets</strong></span>, which should be listed under the full text of your web content.</li><li class="listitem">Click on the <span class="strong"><strong>Publish</strong></span> button.<div class="note" title="Note"><h3 class="title"><a id="tip16"/>Tip</h3><p>It is possible to preview web content before publishing it using the basic preview option. This option becomes available after saving the first draft of the web content. However, the basic preview function does not allow us to preview web content in a theme context. Instead, it is presented in default view.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Displaying web content in the Web Content Display portlet"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec52"/>Displaying web content in the Web Content Display portlet</h3></div></div></div><p>In order to<a id="id391" class="indexterm"/> display web content in<a id="id392" class="indexterm"/> the Web Content Display portlet, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the page on which you want to display the web content.</li><li class="listitem">Click on the add icon (this is a <span class="strong"><strong>+</strong></span> sign on the left-hand side).</li><li class="listitem">Click on the <span class="strong"><strong>Applications</strong></span> tab.</li><li class="listitem">Find the <span class="strong"><strong>Web Content Display</strong></span> portlet using the search feature or by browsing the list of available portlets.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> link located next to it or drag and drop it on the page you want.<div class="mediaobject"><img src="../Images/image00346.jpeg" alt="Displaying web content in the Web Content Display portlet"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click <a id="id393" class="indexterm"/>on the <a id="id394" class="indexterm"/>added portlet options icon (this will be a gear icon in the top-right corner of the portlet).</li><li class="listitem">Choose the <span class="strong"><strong>Configuration</strong></span> option.</li><li class="listitem">From the list, choose the web content (by clicking on its name) that you want to display in a portlet.<div class="mediaobject"><img src="../Images/image00347.jpeg" alt="Displaying web content in the Web Content Display portlet"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Choose<a id="id395" class="indexterm"/> the list <a id="id396" class="indexterm"/>of additional functionalities that should be available in a portlet (for example, the <span class="strong"><strong>Enable Print</strong></span> or <span class="strong"><strong>Enable Comments</strong></span> option).</li><li class="listitem">Click on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Editing web content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec53"/>Editing web content</h3></div></div></div><p>In order to<a id="id397" class="indexterm"/> modify existing web content, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">From the list of available web contents, choose the one you want to modify.</li><li class="listitem">Click on the name of the chosen web content or choose the <span class="strong"><strong>Edit</strong></span> action from its <span class="strong"><strong>Actions</strong></span> menu.<div class="mediaobject"><img src="../Images/image00348.jpeg" alt="Editing web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">When the<a id="id398" class="indexterm"/> form opens, edit the field you want to change.</li><li class="listitem">Click on the <span class="strong"><strong>Publish</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Adding translation to an existing web content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec54"/>Adding translation to an existing web content</h3></div></div></div><p>To add a <a id="id399" class="indexterm"/>translation to an existing web content, perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">From the list of available web contents, choose the one you want to define a translation for.</li><li class="listitem">Click on the name of the chosen web content or choose the <span class="strong"><strong>Edit</strong></span> action from its actions menu.</li><li class="listitem">Click on the <span class="strong"><strong>Add Translation</strong></span> button.</li><li class="listitem">Choose the language you want to create a translation for (if you want, change the available languages by referring to <span class="emphasis"><em>The language properties hook</em></span> recipe from <a class="link" title="Chapter 11. Quick Tricks and Advanced Knowledge" href="part0080.xhtml#aid-2C9D01">Chapter 11</a>, <span class="emphasis"><em>Quick Tricks and Advanced Knowledge</em></span>).<div class="mediaobject"><img src="../Images/image00349.jpeg" alt="Adding translation to an existing web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a <span class="strong"><strong>Title</strong></span>, <span class="strong"><strong>Content</strong></span>, and <span class="strong"><strong>Summary</strong></span> for this language.</li><li class="listitem">Click<a id="id400" class="indexterm"/> on the <span class="strong"><strong>Save</strong></span> button.<div class="note" title="Note"><h3 class="title"><a id="note27"/>Note</h3><p>All the available translations are listed in the available translations section placed just after the <span class="strong"><strong>Add Translation</strong></span> button in the edit content page. It is possible to manage (including removing) the translation using a form that can be accessed after clicking on the translation name in this section.</p></div></li><li class="listitem">Click on the <span class="strong"><strong>Publish</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Expiring web content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec55"/>Expiring web content</h3></div></div></div><p>There are <a id="id401" class="indexterm"/>two ways of expiring web content. The first way, described previously, is to set the expiration date while adding or editing a web content. The second option is to use the expire action available in the <span class="strong"><strong>Web Content</strong></span> actions menu. Go through the following steps to follow this option of expiring web content:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">From the list of available web contents, choose the one you want to modify.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> menu of the chosen web content.<div class="note" title="Note"><h3 class="title"><a id="tip17"/>Tip</h3><p>Choose the <span class="strong"><strong>Expire</strong></span> action. To make the expired web content available for users, it is required<a id="id402" class="indexterm"/> that you edit and publish it again.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="Removing folders and web content"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec56"/>Removing folders and web content</h3></div></div></div><p>Each folder <a id="id403" class="indexterm"/>and web content can be temporarily or permanently<a id="id404" class="indexterm"/> removed. Both temporary and permanent removal are done through the <span class="strong"><strong>Recycle Bin</strong></span> mechanism.</p><p>To temporarily remove a folder or web content, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the folder or web content that needs to be deleted.</li><li class="listitem">Click on its actions icon.</li><li class="listitem">Click on the <span class="strong"><strong>Move to the Recycle Bin</strong></span> action.<div class="note" title="Note"><h3 class="title"><a id="note28"/>Note</h3><p>You can undo this action by clicking on the <span class="strong"><strong>Undo</strong></span> button that will appear just after moving a web content to the trash.</p></div></li></ol><div style="height:10px; width: 1px"/></div><p>To permanently remove a folder or web content, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Recycle Bin</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Actions</strong></span> button, which is located near the name of the web content or folder you want to delete:<div class="mediaobject"><img src="../Images/image00350.jpeg" alt="Removing folders and web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <span class="strong"><strong>Delete</strong></span> action and confirm your choice by clicking on <span class="strong"><strong>OK</strong></span>.<div class="note" title="Note"><h3 class="title"><a id="note29"/>Note</h3><p>Note that when you remove a folder, its entire content is also removed. By default, the trash is enabled and keeps removed items for 30 days. The trash availability for the particular site and the maximum age of trash entries can be changed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Configurations</strong></span> | <span class="strong"><strong>Site Settings</strong></span> | <span class="strong"><strong>Recycle Bin</strong></span>.</p></div></li></ol><div style="height:10px; width: 1px"/></div><p>It is also <a id="id405" class="indexterm"/>possible to restore the web content or web content <a id="id406" class="indexterm"/>folder using the <span class="strong"><strong>Restore</strong></span> action available in the <span class="strong"><strong>Actions</strong></span> menu.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec138"/>How it works…</h2></div></div></div><p>The <span class="strong"><strong>Web Content</strong></span> section allows us to create a tree-like folder structure to organize web contents stored within a site. It is possible to create or move a web content to a default folder (<code class="literal">Home</code>) or to one of the folders defined by users. It is also possible to merge one folder (and its content) with another. While creating or editing a web content, the user has a choice to save it as a draft or publish it. Draft versions of web content can be accessed by going to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span> for authorized users only. Published versions can be seen by end users. Each time a web content is published, its version increases. All versions are available in the web content history, which can be accessed from the web content editing form.</p><p>If there is a need to hide the previously published web content from end users but keep it within the system, the expire action should be used. As was shown previously, it is possible to schedule a time of publication and expiration of the web content.</p><p>Each web content has a unique ID, title, status, and version number. There are three available statuses:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Approved</strong></span>: This<a id="id407" class="indexterm"/> is dedicated for published web contents, which can be placed in a portlet on a page and is available for end users</li><li class="listitem"><span class="strong"><strong>Drafts</strong></span>: They <a id="id408" class="indexterm"/>are reserved for web content where the newest version has not been published yet</li><li class="listitem"><span class="strong"><strong>Expired</strong></span>: This<a id="id409" class="indexterm"/> marks all the web contents that have been expired and are not available for end users</li></ul></div><div class="section" title="Permissions"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec57"/>Permissions</h3></div></div></div><p>Each folder and <a id="id410" class="indexterm"/>web content has its own permissions set, which <a id="id411" class="indexterm"/>defines the list of actions that can be performed on it by users assigned to different roles. For example, it is possible to set such permissions so that users with a specific role will be able to provide commentaries on one particular web content, but won't be permitted to do the same with some other web content.</p><div class="section" title="Categorization"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec01"/>Categorization</h4></div></div></div><p>The <a id="id412" class="indexterm"/>
<span class="strong"><strong>Categorization</strong></span> tab in the web content adding and editing forms allows us to define the type, categories, and tags of the web content. Categories and tags provide an additional mechanism to mark, list, and search web content and allow their subsequent selection with the help of dedicated portlets such as Category Navigation, Asset Publisher, or Tag Cloud. Categories can create a tree-like structure. Each category is placed in the dictionary and can have subcategories. Tags, on the contrary, are not stored in dictionaries and create a flat structure. It is possible to assign a web content to one or more categories and tags. Types are used to search the web content within the <span class="strong"><strong>Web Content</strong></span> section.</p></div><div class="section" title="Related assets"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec02"/>Related assets</h4></div></div></div><p>In Liferay, an asset is<a id="id413" class="indexterm"/> a piece of content that can be shown on a page, such as a document, web content, blog entry, and so on. Each web content can be connected to another web content, document, or different types of assets, such as commentaries, blog entries, and so on. These web contents will be listed by portlets such as Asset Publisher.</p></div><div class="section" title="Placing web content on a page"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec03"/>Placing web content on a page</h4></div></div></div><p>As was shown <a id="id414" class="indexterm"/>previously, the web content section allows us to organize web contents in a structure of folders that help us manage web contents within the site. However, this structure doesn't have any influence on the information architecture of the site. In order to place a web content on a page, it is required that you <a id="id415" class="indexterm"/>use dedicated portlets, such as the Web Content Display or Asset Publisher portlet. The Web Content Display portlet allows us to show the <a id="id416" class="indexterm"/>full content of exactly one web content at a time. The Asset Publisher portlet (described in the following chapter) is much more complex and enables us to create a different list of contents. It also allows us to display the web content in full-content view.</p></div><div class="section" title="Display page"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl4sec04"/>Display page</h4></div></div></div><p>The Display page<a id="id417" class="indexterm"/> parameter allows us to decide on which page a particular web content will be shown in full-content view within the Asset Publisher portlet.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec139"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">For more information on how to present web content on a page, refer to the <span class="emphasis"><em>Tagging and categorizing content</em></span> and <span class="emphasis"><em>Asset Publisher as a search-based tool for content presentation</em></span> recipes from <a class="link" title="Chapter 8. Search and Content Presentation Tools" href="part0059.xhtml#aid-1O8H61">Chapter 8</a>, <span class="emphasis"><em>Search and Content Presentation Tools</em></span></li><li class="listitem">For more information about permissions, refer to the following recipes:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="emphasis"><em>Creating and configuring roles</em></span> from <a class="link" title="Chapter 5. Roles and Permissions" href="part0045.xhtml#aid-1AT9A1">Chapter 5</a>, <span class="emphasis"><em>Roles and Permissions</em></span></li><li class="listitem"><span class="emphasis"><em>Kaleo Web installation</em></span> and <span class="emphasis"><em>The</em></span> <span class="emphasis"><em>Single Approver workflow for the user creation process</em></span> from <a class="link" title="Chapter 9. Liferay Workflow Capability" href="part0065.xhtml#aid-1TVKI1">Chapter 9</a>, <span class="emphasis"><em>Liferay Workflow Capability</em></span></li></ul></div></li><li class="listitem">For more information on Web Content, refer to the <span class="emphasis"><em>Creating a new structure</em></span> and the <span class="emphasis"><em>Creating a new template</em></span> recipes from this chapter</li></ul></div></div></div>
<div class="section" title="Creating a new structure"><div class="titlepage" id="aid-1MBG22"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Creating a new structure</h1></div></div></div><p>Liferay gives users interesting features: structures and templates. Structures provide <a id="id418" class="indexterm"/>information about possible fields in our content, and templates are responsible for rendering these fields as an article in a frontend (for instance, in the Asset Publisher or Web Content Display portlet).</p><p>Let's assume that <a id="id419" class="indexterm"/>our goal is to define a new structure and template called <span class="emphasis"><em>Internal publication</em></span>. This structure consists of the following fields:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>Type</p>
</th><th valign="bottom">
<p>Required</p>
</th><th valign="bottom">
<p>Repeatable</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Author</p>
</td><td valign="top">
<p>Text</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Department</p>
</td><td valign="top">
<p>Select</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Project</p>
</td><td valign="top">
<p>Text Box</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Client</p>
</td><td valign="top">
<p>Text</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Content</p>
</td><td valign="top">
<p>HTML</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Attachment</p>
</td><td valign="top">
<p>Documents and Media</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>Yes</p>
</td></tr></tbody></table></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec140"/>How to do it…</h2></div></div></div><p>In order to define a new structure, it is required that you log in as a user with the <span class="strong"><strong>Add Structure</strong></span> permission in the <span class="strong"><strong>Web Content</strong></span> section. To achieve this goal, go through the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Manage</strong></span> option and choose <span class="strong"><strong>Structures</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Type the name of the structure, which is <code class="literal">Internal publication</code>.</li><li class="listitem">It is possible to choose the default language and add some description. We will leave it as default.</li><li class="listitem">Go to the section where there is a drag-and-drop functionality to define fields.</li><li class="listitem">Choose<a id="id420" class="indexterm"/> the <span class="strong"><strong>Text</strong></span> field and drag and drop this field into the gray section.</li><li class="listitem">Click on the added element, go to the <span class="strong"><strong>Settings</strong></span> tab, and set the following properties:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Field</strong></span> label as <span class="strong"><strong>Author</strong></span></li><li class="listitem"><span class="strong"><strong>Required</strong></span> as <span class="strong"><strong>Yes</strong></span></li><li class="listitem"><span class="strong"><strong>Indexable</strong></span> as <span class="strong"><strong>Indexable – keywords</strong></span></li><li class="listitem"><span class="strong"><strong>Repeatable</strong></span> as <span class="strong"><strong>No</strong></span></li></ul></div></li><li class="listitem">Click on the <span class="strong"><strong>Close</strong></span> button to save information and go back to the <span class="strong"><strong>Fields</strong></span> tab.</li><li class="listitem">Repeat steps 8 and 9 to define all the necessary fields that were described in our assumptions. The result should look like this:<div class="mediaobject"><img src="../Images/image00351.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click<a id="id421" class="indexterm"/> on the <span class="strong"><strong>Save</strong></span> button.</li><li class="listitem">To check out the newly created structure, go to <span class="strong"><strong>Web Content</strong></span> | <span class="strong"><strong>Add</strong></span> | <span class="strong"><strong>Internal publication</strong></span>.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec141"/>How it works…</h2></div></div></div><p>The structure is an XML definition of the web content form. It gives users the following thirteen predefined types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Boolean</strong></span>: This<a id="id422" class="indexterm"/> adds a checkbox onto our structure with true/false values</li><li class="listitem"><span class="strong"><strong>Date</strong></span>: Adds an input text with a calendar (date picker)</li><li class="listitem"><span class="strong"><strong>Decimal</strong></span>: Adds an input that accepts only numbers and decimal point</li><li class="listitem"><span class="strong"><strong>Documents and Media</strong></span>: Adds an existing uploaded document to attach to the structure</li><li class="listitem"><span class="strong"><strong>HTML</strong></span>: Adds a WYSIWYG editor</li><li class="listitem"><span class="strong"><strong>Image</strong></span>: Adds a browse-image application</li><li class="listitem"><span class="strong"><strong>Integer</strong></span>: Adds an<a id="id423" class="indexterm"/> input that accepts only numbers</li><li class="listitem"><span class="strong"><strong>Link to page</strong></span>: Adds a select list to select links to another page</li><li class="listitem"><span class="strong"><strong>Number</strong></span>: Similar to Integer and allows only numbers</li><li class="listitem"><span class="strong"><strong>Radio</strong></span>: Adds a radio button</li><li class="listitem"><span class="strong"><strong>Select</strong></span>: Add a select list with options</li><li class="listitem"><span class="strong"><strong>Text</strong></span>: Adds an input text</li><li class="listitem"><span class="strong"><strong>Text Box</strong></span>: Adds a text area component</li></ul></div><p>In the background, each definition is stored as an XML node called <code class="literal">&lt;dynamic-element&gt;</code>. It is <a id="id424" class="indexterm"/>possible to look at how the definition is built by clicking on the <span class="strong"><strong>Source</strong></span> tab from the edit mode of the structure. Here is an example of our <code class="literal">Author</code> definition:</p><div class="informalexample"><pre class="programlisting">&lt;dynamic-element dataType="string" indexType="keyword" name="Author" readOnly="false" repeatable="false" required="true" showLabel="true" type="text" width="small"&gt;
  &lt;meta-data locale="en_US"&gt;
    &lt;entry name="label"&gt;
      &lt;![CDATA[Author]]&gt;
    &lt;/entry&gt;
    &lt;entry name="predefinedValue"&gt;
      &lt;![CDATA[]]&gt;
    &lt;/entry&gt;
    &lt;entry name="tip"&gt;
      &lt;![CDATA[]]&gt;
    &lt;/entry&gt;
  &lt;/meta-data&gt;
&lt;/dynamic-element&gt;</pre></div><p>This definition describes all the fields that we set, such as <code class="literal">dataType: string</code>, <code class="literal">indexType: keyword</code>, <code class="literal">name: Author</code>, and so on.</p><p>Each row has many attributes, such as <code class="literal">predefinedValue</code>, <code class="literal">tip</code>, <code class="literal">required</code>, and so on. The following table shows the most important attributes:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Property name</p>
</th><th valign="bottom">
<p>Value</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Type</p>
</td><td valign="top">
<p>Predefined field type</p>
</td><td valign="top">
<p>Type of the field definition</p>
</td></tr><tr><td valign="top">
<p>Field label</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Label of the field</p>
</td></tr><tr><td valign="top">
<p>Show label</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Determines label visibility</p>
</td></tr><tr><td valign="top">
<p>Required</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Sets field as required field</p>
</td></tr><tr><td valign="top">
<p>Name</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Name of the field, usually the same as label</p>
</td></tr><tr><td valign="top">
<p>Predefined value</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Sets the default value</p>
</td></tr><tr><td valign="top">
<p>Tip</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>A tip (description) of the field</p>
</td></tr><tr><td valign="top">
<p>Indexable</p>
</td><td valign="top">
<p>Not indexable / Indexable—Keyword / Indexable—Text</p>
</td><td valign="top">
<p>Defines an indexer type and indicates which type of search indexer will be used</p>
</td></tr><tr><td valign="top">
<p>Repeatable</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Allows us to set the field as repeatable</p>
</td></tr><tr><td valign="top">
<p>Width</p>
</td><td valign="top">
<p>Small/Medium/Large</p>
</td><td valign="top">
<p>Allows us to define the width of the field</p>
</td></tr></tbody></table></div></div><div class="section" title="There is more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec142"/>There is more…</h2></div></div></div><p>The journal structure<a id="id425" class="indexterm"/> provides interesting functionalities to set default<a id="id426" class="indexterm"/> values for articles that will be created from this structure. One of the possibilities is to set a predefined value on the edit structure screen. However, Liferay also gives us an option called <span class="strong"><strong>Edit Default Values</strong></span>. This setting is really interesting when our requirement is that every article that will be generated from this structure should have a predefined specific category, tag, display page, and so on. In the background, this is an article that has a specific setting in the database in order to prevent it from it being chosen or found by Asset Publisher, Web Content Display, or even searches.</p><p>To set the <a id="id427" class="indexterm"/>default values, follows these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Manage</strong></span> option and choose <span class="strong"><strong>Structures</strong></span>.</li><li class="listitem">In the selected structure, such as <span class="strong"><strong>Internal Publication</strong></span>, go to <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>Edit default values</strong></span>.</li><li class="listitem">Fill in the default values and click on the<span class="strong"><strong> Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div></div>
<div class="section" title="Creating a new template" id="aid-1NA0K1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Creating a new template</h1></div></div></div><p>This recipe <a id="id428" class="indexterm"/>requires basic programming skills. In general, a template is a pattern to render values from an article with a specific structure. In accordance with this fact, a template is relative to the structure, so a structure and template are a pair of definitions that can't exist alone. Structures define how the form looks; templates<a id="id429" class="indexterm"/> determine how the journal article will be rendered and arranged.</p><div class="section" title="Getting ready…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec143"/>Getting ready…</h2></div></div></div><p>Prepare a structure called <span class="strong"><strong>Internal publication</strong></span>. To see how to achieve this, refer to the previous recipe.</p><p>Let's assume that our template is divided into four parts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Metadata definition that contains <span class="emphasis"><em>Author</em></span> and <span class="emphasis"><em>Department</em></span></li><li class="listitem">Metric definition with <span class="emphasis"><em>Client</em></span> and <span class="emphasis"><em>Project</em></span> information</li><li class="listitem">Description part with <span class="emphasis"><em>Content</em></span></li><li class="listitem"><span class="emphasis"><em>Attachments</em></span> section</li></ul></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec144"/>How to do it…</h2></div></div></div><p>Liferay gives users three languages to write a template: Velocity (.vm), FreeMarker (.ftl), and Extensible Stylesheet Language (.xsl). Regardless of the language definition, the process of creating a new template consists of the same rules. In order to create a new template, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <span class="strong"><strong>Admin</strong></span> | <span class="strong"><strong>Site Administration</strong></span> | <span class="strong"><strong>Content</strong></span> | <span class="strong"><strong>Web Content</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Manage</strong></span> option and choose <span class="strong"><strong>Templates</strong></span>.</li><li class="listitem">Click on the <span class="strong"><strong>Add</strong></span> button.</li><li class="listitem">Fill in the form with the following values:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Name</strong></span>: Type <code class="literal">Internal Publication</code></li><li class="listitem"><span class="strong"><strong>Structure</strong></span>: Choose <span class="strong"><strong>Internal Publication</strong></span></li><li class="listitem"><span class="strong"><strong>Language</strong></span>: Choose <span class="strong"><strong>Velocity (.vm)</strong></span></li></ul></div></li><li class="listitem">Write a script that renders our assumptions as follows:<div class="informalexample"><pre class="programlisting">  &lt;div class="article-container"&gt;
    &lt;div class="article-metadata"&gt;
      &lt;span&gt;Create Date: $dateTool.format( 'medium_date', $dateTool.toDate( "EEE, dd MMM yyyy hh:mm:ss Z" , $reserved-article-display-date.getData(), $localeUtil.getDefault()) , $locale), Author: $Author.getData(), Department: $Department.getData()&lt;/span&gt;
    &lt;/div&gt;
    &lt;hr /&gt;
    &lt;div class="article-metric"&gt;
      &lt;table&gt;
        &lt;tr&gt;
          &lt;td&gt;Client:&lt;/td&gt;
          &lt;td&gt;$Client.getData()&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;Project:&lt;/td&gt;
          &lt;td&gt;$Project.getData()&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;/div&gt;
    
    
  #if($Content.getData().length() &gt; 0)
    &lt;hr /&gt;
      &lt;div class="article-content"&gt;  
        $Content.getData()
      &lt;/div&gt;
    #end

    #if($Attachment.size() &gt; 0) 
    &lt;hr /&gt;
      &lt;div class="article-attachment"&gt;
        &lt;div&gt;Attachments:&lt;/div&gt;
        #foreach($file in $Attachment.getSiblings())
        &lt;a href="$file.getData()"&gt;Attachment # $velocityCount&lt;/a&gt;&lt;br /&gt;
        #end
        &lt;/div&gt;
      #end
      &lt;/div&gt;</pre></div></li><li class="listitem">Click <a id="id430" class="indexterm"/>on the <span class="strong"><strong>Save</strong></span> button.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec145"/>How it works…</h2></div></div></div><p>As we mentioned at the beginning, Liferay gives users three ways (languages) to write an article's template: Velocity (.vm), FreeMarker (.ftl), and Extensible Stylesheet Language (.xls). In this<a id="id431" class="indexterm"/> recipe, we chose Velocity macro, which allows us to mix logic (macros) with HTML and CSS. If we open an editor, we can see that on the left-hand side, there is a menu with <span class="strong"><strong>General Variables</strong></span>, <span class="strong"><strong>Fields</strong></span>, and <span class="strong"><strong>Util</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00352.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><div class="section" title="Variables"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec58"/>Variables</h3></div></div></div><p>The <span class="strong"><strong>General Variables</strong></span> section contains variables that can be used in the script. As a matter of fact, these <a id="id432" class="indexterm"/>definitions are used rarely and only in sophisticated <a id="id433" class="indexterm"/>VM or FTL scripts. The following variables are available:</p><div class="informaltable"><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>Variable</p>
</th><th valign="bottom">
<p>Liferay Class</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Portal instance</p>
</td><td valign="top">
<p>
<code class="literal">$company</code>
</p>
</td><td valign="top">
<p>Company</p>
</td><td valign="top">
<p>Object <a id="id434" class="indexterm"/>that represents the current portal instance</p>
</td></tr><tr><td valign="top">
<p>Portal instance identifier</p>
</td><td valign="top">
<p>
<code class="literal">$companyId</code>
</p>
</td><td valign="top">
<p>Long</p>
</td><td valign="top">
<p>Identifier<a id="id435" class="indexterm"/> of <a id="id436" class="indexterm"/>the current portal instance</p>
</td></tr><tr><td valign="top">
<p>Device</p>
</td><td valign="top">
<p>
<code class="literal">$device</code>
</p>
</td><td valign="top">
<p>Device</p>
</td><td valign="top">
<p>Object that <a id="id437" class="indexterm"/>represents the <a id="id438" class="indexterm"/>device currently used to access the site</p>
</td></tr><tr><td valign="top">
<p>Site ID</p>
</td><td valign="top">
<p>
<code class="literal">$groupId</code>
</p>
</td><td valign="top">
<p>Long</p>
</td><td valign="top">
<p>The<a id="id439" class="indexterm"/> identifier of the current site</p>
</td></tr><tr><td valign="top">
<p>View mode</p>
</td><td valign="top">
<p>
<code class="literal">$viewMode</code>
</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>The <a id="id440" class="indexterm"/>desired view mode for the content; the value will be <code class="literal">print</code> for print mode</p>
</td></tr></tbody></table></div></div><div class="section" title="Fields"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec59"/>Fields</h3></div></div></div><p>These objects can be used in our scripts. For instance, the <code class="literal">$Content.getData()</code> invocation prints a<a id="id441" class="indexterm"/> value from the <code class="literal">Content</code> field of the structure. As shown in <a id="id442" class="indexterm"/>the preceding code, we used this invocation for the following fields:</p><div class="informalexample"><pre class="programlisting">$Author.getData() 
$Department.getData()
$Client.getData()
$Project.getData()
$Content.getData()
$file.getData()</pre></div><p>The next useful invocation is <code class="literal">$Attachment.getSiblings()</code>. This method is used when our field is repeatable and contains many values. In our example, the <code class="literal">Attachment</code> field has two siblings.</p><p>To iterate over siblings, we used the <code class="literal">foreach</code> macro, which is very similar to the well-known <code class="literal">foreach</code> construction from the Java language.</p><p>Considering the preceding code, fields have other methods, such as the following ones:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">$field.getName()</code>: This<a id="id443" class="indexterm"/> prints the field's name</li><li class="listitem"><code class="literal">$field.getType()</code>: This<a id="id444" class="indexterm"/> returns field's type, which is defined in the structure</li><li class="listitem"><code class="literal">$field.getChildren()</code>: This<a id="id445" class="indexterm"/> is used when a field has nested fields</li></ul></div></div><div class="section" title="Utils"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec60"/>Utils</h3></div></div></div><p>The most powerful tools that are available in the script are utils. In fact, there are real Java-based <a id="id446" class="indexterm"/>classes that offer a huge range of functionalities. In our example, we <a id="id447" class="indexterm"/>used one to print a display date of the article:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$dateTool.format( 'medium_date', $dateTool.toDate( "EEE, dd MMM yyyy hh:mm:ss Z" , $reserved-article-display-date.getData(), $localeUtil.getDefault())</strong></span>
</pre></div><p>The full list of available services is placed in the following Java classes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><code class="literal">com.liferay.portal.template.TemplateContextHelper</code></li><li class="listitem"><code class="literal">com.liferay.portal.velocity.VelocityTemplateContextHelper</code> (for Velocity)</li><li class="listitem"><code class="literal">com.liferay.portal.freemarker.FreeMarkerTemplateContextHelper</code> (for FreeMarker)</li></ul></div></div><div class="section" title="Reserved variables"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec61"/>Reserved variables</h3></div></div></div><p>The preceding<a id="id448" class="indexterm"/> code has a special invocation: <code class="literal">$reserved-article-display-date.getData()</code>. This is a reserved variable that is globally <a id="id449" class="indexterm"/>available in every template. In our example, it displays <code class="literal">display date</code> for the article. Liferay offers many reserved variables, such as <code class="literal">reserved-article-title</code>, <code class="literal">reserved-article-type</code>, <code class="literal">reserved-article-version</code>, and so on.</p><p>The full list of these variables is defined in the <code class="literal">com.liferay.portlet.journal.model.JournalStructureConstants</code> class.</p></div></div></div></body></html>