<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Content</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Managing and displaying web contents</li><li class="listitem">Creating a new structure</li><li class="listitem">Creating a new template</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec49"/>Introduction</h1></div></div></div><p>As was described in the previous chapter, Liferay provides a whole set of tools that allows us to manage files that store data exchanged between the employees of the company. However, in many cases, it is not quite convenient for end users to operate on the information stored in files. For example, it is much easier to navigate through the content available directly on the web page than in a file while reading the news or browsing the corporate knowledge base. Information such as news, project descriptions, procedures, and so on can be provided using web content. The web content can be displayed on a page using some specific portlets, such as the Web Content Display portlet or the Asset Publisher portlet.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Managing and displaying web contents</h1></div></div></div><p>Each site in Liferay has its own separate set of web contents, which can be accessed by going to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>. All the web contents stored in the <strong>Web Content</strong> section can be organized in a tree-like folder structure. The web content<a id="id381" class="indexterm"/> can contain text, graphics, tables, lists, and links to other <a id="id382" class="indexterm"/>web contents, documents, or pages. Additionally, every web content can be tagged and categorized or provided with the list of assets related to it. This list will be listed in the related assets section under the main content of the web content. It is also possible to define permissions that specify which actions can be performed on web contents by users assigned to different roles.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec137"/>How to do it…</h2></div></div></div><p>This recipe will <a id="id383" class="indexterm"/>cover all the basic actions that can be performed in<a id="id384" class="indexterm"/> order to manage web contents within a site.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec49"/>Creating a new folder</h3></div></div></div><p>To add a<a id="id385" class="indexterm"/> new folder, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin | Site Administration | Content | Web Content</strong>.</li><li class="listitem">Click on the <strong>Add</strong> button.</li><li class="listitem">Select the <strong>Folder</strong> option (if you add a folder inside one that is already created, the <strong>Subfolder</strong> option will be available instead).<div><img src="img/image00343.jpeg" alt="Creating a new folder"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Enter the <strong>Name (Required)</strong> of the folder.</li><li class="listitem">Enter the <strong>Description</strong> of the folder.</li><li class="listitem">Determine <strong>Permissions</strong> for the folder by setting all actions that may be performed by specific roles (you can find more permissions after clicking on the <strong>More Options</strong> link).</li><li class="listitem">Click on the <strong>Save</strong> button.<div><h3 class="title"><a id="tip14"/>Tip</h3><p>
<strong>Downloading the example code</strong>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec50"/>Editing a folder</h3></div></div></div><p>To <a id="id386" class="indexterm"/>edit a folder, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Find the<a id="id387" class="indexterm"/> folder that you want to edit.</li><li class="listitem">Click on its actions icon (the down-arrow icon visible when hovering on the folder miniature).<div><img src="img/image00344.jpeg" alt="Editing a folder"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Edit</strong> button.</li><li class="listitem">Provide a new <strong>Name (required)</strong> for the folder.</li><li class="listitem">Enter a new <strong>Description</strong> of the folder.</li><li class="listitem">Determine new <strong>Permissions</strong> for the folder by setting all actions that may be performed by specific roles.</li><li class="listitem">Leave the <strong>Merge with Parent Folder</strong> option unchecked.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec51"/>Creating a new web content</h3></div></div></div><p>To create a <a id="id388" class="indexterm"/>new basic web content, perform these roles:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click on the <strong>Add</strong> button.</li><li class="listitem">Choose the <strong>Basic web content</strong> option.</li><li class="listitem">Provide the <strong>Title (Required)</strong> and <strong>Content</strong>.<div><img src="img/image00345.jpeg" alt="Creating a new web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Navigate to the <strong>Abstract</strong> tab.</li><li class="listitem">Provide a <strong>Summary</strong>.</li><li class="listitem">Set the <a id="id389" class="indexterm"/>small image by providing a URL or by uploading it from your computer drive. Then, select the <strong>Use Small Image</strong> option.</li><li class="listitem">Navigate to the <strong>Categorization</strong> tab.</li><li class="listitem">Choose <strong>Type</strong> from the type drop-down list, for example, <strong>News</strong>.</li><li class="listitem">Choose <strong>Categories</strong> from the available category dictionaries (represented by a name and a related <strong>Select</strong> button) by clicking on the button beside the dictionary and marking the categories.<div><h3 class="title"><a id="tip15"/>Tip</h3><p>If there are no visible categories that can be assigned to the document, it means that either the categories for the specific site have not been created or the account user, who is working on it, does not have access to the existing category's dictionaries.</p></div></li><li class="listitem">Provide <strong>Tags</strong> by adding new tags. You can choose them from the list of existing tags or use the suggestions function.</li><li class="listitem">Navigate to the <strong>Schedule</strong> tab.</li><li class="listitem">Set the <strong>Display date</strong>, <strong>Review date</strong>, and <strong>Expiration date</strong> functions (or enable the <strong>Never expire</strong> and <strong>Never review</strong> functions).</li><li class="listitem">Navigate to the <strong>Display Page</strong> tab.</li><li class="listitem">Choose<a id="id390" class="indexterm"/> the page on which you want the web content to be displayed in full.<div><h3 class="title"><a id="note26"/>Note</h3><p>The display page will be available if there is at least one page containing the Asset Publisher portlet with the <strong>Set as the Default Asset Publisher for This Page</strong> option enabled. Page names without an Asset Publisher portlet are shown in gray instead of black. For more information, refer to the <em>Asset Publisher as a search-based tool for content presentation</em> recipe from <a class="link" title="Chapter 8. Search and Content Presentation Tools" href="part0059.xhtml#aid-1O8H61">Chapter 8</a>, <em>Search and Content Presentation Tools</em>.</p></div></li><li class="listitem">Navigate to the <strong>Related Assets</strong> tab.</li><li class="listitem">Choose <strong>Related Assets</strong>, which should be listed under the full text of your web content.</li><li class="listitem">Click on the <strong>Publish</strong> button.<div><h3 class="title"><a id="tip16"/>Tip</h3><p>It is possible to preview web content before publishing it using the basic preview option. This option becomes available after saving the first draft of the web content. However, the basic preview function does not allow us to preview web content in a theme context. Instead, it is presented in default view.</p></div></li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec52"/>Displaying web content in the Web Content Display portlet</h3></div></div></div><p>In order to<a id="id391" class="indexterm"/> display web content in<a id="id392" class="indexterm"/> the Web Content Display portlet, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the page on which you want to display the web content.</li><li class="listitem">Click on the add icon (this is a <strong>+</strong> sign on the left-hand side).</li><li class="listitem">Click on the <strong>Applications</strong> tab.</li><li class="listitem">Find the <strong>Web Content Display</strong> portlet using the search feature or by browsing the list of available portlets.</li><li class="listitem">Click on the <strong>Add</strong> link located next to it or drag and drop it on the page you want.<div><img src="img/image00346.jpeg" alt="Displaying web content in the Web Content Display portlet"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click <a id="id393" class="indexterm"/>on the <a id="id394" class="indexterm"/>added portlet options icon (this will be a gear icon in the top-right corner of the portlet).</li><li class="listitem">Choose the <strong>Configuration</strong> option.</li><li class="listitem">From the list, choose the web content (by clicking on its name) that you want to display in a portlet.<div><img src="img/image00347.jpeg" alt="Displaying web content in the Web Content Display portlet"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Choose<a id="id395" class="indexterm"/> the list <a id="id396" class="indexterm"/>of additional functionalities that should be available in a portlet (for example, the <strong>Enable Print</strong> or <strong>Enable Comments</strong> option).</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec53"/>Editing web content</h3></div></div></div><p>In order to<a id="id397" class="indexterm"/> modify existing web content, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">From the list of available web contents, choose the one you want to modify.</li><li class="listitem">Click on the name of the chosen web content or choose the <strong>Edit</strong> action from its <strong>Actions</strong> menu.<div><img src="img/image00348.jpeg" alt="Editing web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">When the<a id="id398" class="indexterm"/> form opens, edit the field you want to change.</li><li class="listitem">Click on the <strong>Publish</strong> button.</li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec54"/>Adding translation to an existing web content</h3></div></div></div><p>To add a <a id="id399" class="indexterm"/>translation to an existing web content, perform these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">From the list of available web contents, choose the one you want to define a translation for.</li><li class="listitem">Click on the name of the chosen web content or choose the <strong>Edit</strong> action from its actions menu.</li><li class="listitem">Click on the <strong>Add Translation</strong> button.</li><li class="listitem">Choose the language you want to create a translation for (if you want, change the available languages by referring to <em>The language properties hook</em> recipe from <a class="link" title="Chapter 11. Quick Tricks and Advanced Knowledge" href="part0080.xhtml#aid-2C9D01">Chapter 11</a>, <em>Quick Tricks and Advanced Knowledge</em>).<div><img src="img/image00349.jpeg" alt="Adding translation to an existing web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a <strong>Title</strong>, <strong>Content</strong>, and <strong>Summary</strong> for this language.</li><li class="listitem">Click<a id="id400" class="indexterm"/> on the <strong>Save</strong> button.<div><h3 class="title"><a id="note27"/>Note</h3><p>All the available translations are listed in the available translations section placed just after the <strong>Add Translation</strong> button in the edit content page. It is possible to manage (including removing) the translation using a form that can be accessed after clicking on the translation name in this section.</p></div></li><li class="listitem">Click on the <strong>Publish</strong> button.</li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec55"/>Expiring web content</h3></div></div></div><p>There are <a id="id401" class="indexterm"/>two ways of expiring web content. The first way, described previously, is to set the expiration date while adding or editing a web content. The second option is to use the expire action available in the <strong>Web Content</strong> actions menu. Go through the following steps to follow this option of expiring web content:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">From the list of available web contents, choose the one you want to modify.</li><li class="listitem">Click on the <strong>Actions</strong> menu of the chosen web content.<div><h3 class="title"><a id="tip17"/>Tip</h3><p>Choose the <strong>Expire</strong> action. To make the expired web content available for users, it is required<a id="id402" class="indexterm"/> that you edit and publish it again.</p></div></li></ol><div></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec56"/>Removing folders and web content</h3></div></div></div><p>Each folder <a id="id403" class="indexterm"/>and web content can be temporarily or permanently<a id="id404" class="indexterm"/> removed. Both temporary and permanent removal are done through the <strong>Recycle Bin</strong> mechanism.</p><p>To temporarily remove a folder or web content, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the folder or web content that needs to be deleted.</li><li class="listitem">Click on its actions icon.</li><li class="listitem">Click on the <strong>Move to the Recycle Bin</strong> action.<div><h3 class="title"><a id="note28"/>Note</h3><p>You can undo this action by clicking on the <strong>Undo</strong> button that will appear just after moving a web content to the trash.</p></div></li></ol><div></div><p>To permanently remove a folder or web content, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Recycle Bin</strong>.</li><li class="listitem">Click on the <strong>Actions</strong> button, which is located near the name of the web content or folder you want to delete:<div><img src="img/image00350.jpeg" alt="Removing folders and web content"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Delete</strong> action and confirm your choice by clicking on <strong>OK</strong>.<div><h3 class="title"><a id="note29"/>Note</h3><p>Note that when you remove a folder, its entire content is also removed. By default, the trash is enabled and keeps removed items for 30 days. The trash availability for the particular site and the maximum age of trash entries can be changed by going to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Configurations</strong> | <strong>Site Settings</strong> | <strong>Recycle Bin</strong>.</p></div></li></ol><div></div><p>It is also <a id="id405" class="indexterm"/>possible to restore the web content or web content <a id="id406" class="indexterm"/>folder using the <strong>Restore</strong> action available in the <strong>Actions</strong> menu.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec138"/>How it works…</h2></div></div></div><p>The <strong>Web Content</strong> section allows us to create a tree-like folder structure to organize web contents stored within a site. It is possible to create or move a web content to a default folder (<code class="literal">Home</code>) or to one of the folders defined by users. It is also possible to merge one folder (and its content) with another. While creating or editing a web content, the user has a choice to save it as a draft or publish it. Draft versions of web content can be accessed by going to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong> for authorized users only. Published versions can be seen by end users. Each time a web content is published, its version increases. All versions are available in the web content history, which can be accessed from the web content editing form.</p><p>If there is a need to hide the previously published web content from end users but keep it within the system, the expire action should be used. As was shown previously, it is possible to schedule a time of publication and expiration of the web content.</p><p>Each web content has a unique ID, title, status, and version number. There are three available statuses:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Approved</strong>: This<a id="id407" class="indexterm"/> is dedicated for published web contents, which can be placed in a portlet on a page and is available for end users</li><li class="listitem"><strong>Drafts</strong>: They <a id="id408" class="indexterm"/>are reserved for web content where the newest version has not been published yet</li><li class="listitem"><strong>Expired</strong>: This<a id="id409" class="indexterm"/> marks all the web contents that have been expired and are not available for end users</li></ul></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec57"/>Permissions</h3></div></div></div><p>Each folder and <a id="id410" class="indexterm"/>web content has its own permissions set, which <a id="id411" class="indexterm"/>defines the list of actions that can be performed on it by users assigned to different roles. For example, it is possible to set such permissions so that users with a specific role will be able to provide commentaries on one particular web content, but won't be permitted to do the same with some other web content.</p><div><div><div><div><h4 class="title"><a id="ch07lvl4sec01"/>Categorization</h4></div></div></div><p>The <a id="id412" class="indexterm"/>
<strong>Categorization</strong> tab in the web content adding and editing forms allows us to define the type, categories, and tags of the web content. Categories and tags provide an additional mechanism to mark, list, and search web content and allow their subsequent selection with the help of dedicated portlets such as Category Navigation, Asset Publisher, or Tag Cloud. Categories can create a tree-like structure. Each category is placed in the dictionary and can have subcategories. Tags, on the contrary, are not stored in dictionaries and create a flat structure. It is possible to assign a web content to one or more categories and tags. Types are used to search the web content within the <strong>Web Content</strong> section.</p></div><div><div><div><div><h4 class="title"><a id="ch07lvl4sec02"/>Related assets</h4></div></div></div><p>In Liferay, an asset is<a id="id413" class="indexterm"/> a piece of content that can be shown on a page, such as a document, web content, blog entry, and so on. Each web content can be connected to another web content, document, or different types of assets, such as commentaries, blog entries, and so on. These web contents will be listed by portlets such as Asset Publisher.</p></div><div><div><div><div><h4 class="title"><a id="ch07lvl4sec03"/>Placing web content on a page</h4></div></div></div><p>As was shown <a id="id414" class="indexterm"/>previously, the web content section allows us to organize web contents in a structure of folders that help us manage web contents within the site. However, this structure doesn't have any influence on the information architecture of the site. In order to place a web content on a page, it is required that you <a id="id415" class="indexterm"/>use dedicated portlets, such as the Web Content Display or Asset Publisher portlet. The Web Content Display portlet allows us to show the <a id="id416" class="indexterm"/>full content of exactly one web content at a time. The Asset Publisher portlet (described in the following chapter) is much more complex and enables us to create a different list of contents. It also allows us to display the web content in full-content view.</p></div><div><div><div><div><h4 class="title"><a id="ch07lvl4sec04"/>Display page</h4></div></div></div><p>The Display page<a id="id417" class="indexterm"/> parameter allows us to decide on which page a particular web content will be shown in full-content view within the Asset Publisher portlet.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec139"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem">For more information on how to present web content on a page, refer to the <em>Tagging and categorizing content</em> and <em>Asset Publisher as a search-based tool for content presentation</em> recipes from <a class="link" title="Chapter 8. Search and Content Presentation Tools" href="part0059.xhtml#aid-1O8H61">Chapter 8</a>, <em>Search and Content Presentation Tools</em></li><li class="listitem">For more information about permissions, refer to the following recipes:<div><ul class="itemizedlist"><li class="listitem"><em>Creating and configuring roles</em> from <a class="link" title="Chapter 5. Roles and Permissions" href="part0045.xhtml#aid-1AT9A1">Chapter 5</a>, <em>Roles and Permissions</em></li><li class="listitem"><em>Kaleo Web installation</em> and <em>The</em> <em>Single Approver workflow for the user creation process</em> from <a class="link" title="Chapter 9. Liferay Workflow Capability" href="part0065.xhtml#aid-1TVKI1">Chapter 9</a>, <em>Liferay Workflow Capability</em></li></ul></div></li><li class="listitem">For more information on Web Content, refer to the <em>Creating a new structure</em> and the <em>Creating a new template</em> recipes from this chapter</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Creating a new structure</h1></div></div></div><p>Liferay gives users interesting features: structures and templates. Structures provide <a id="id418" class="indexterm"/>information about possible fields in our content, and templates are responsible for rendering these fields as an article in a frontend (for instance, in the Asset Publisher or Web Content Display portlet).</p><p>Let's assume that <a id="id419" class="indexterm"/>our goal is to define a new structure and template called <em>Internal publication</em>. This structure consists of the following fields:</p><div><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>Type</p>
</th><th valign="bottom">
<p>Required</p>
</th><th valign="bottom">
<p>Repeatable</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Author</p>
</td><td valign="top">
<p>Text</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Department</p>
</td><td valign="top">
<p>Select</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Project</p>
</td><td valign="top">
<p>Text Box</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Client</p>
</td><td valign="top">
<p>Text</p>
</td><td valign="top">
<p>Yes</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Content</p>
</td><td valign="top">
<p>HTML</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>No</p>
</td></tr><tr><td valign="top">
<p>Attachment</p>
</td><td valign="top">
<p>Documents and Media</p>
</td><td valign="top">
<p>No</p>
</td><td valign="top">
<p>Yes</p>
</td></tr></tbody></table></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec140"/>How to do it…</h2></div></div></div><p>In order to define a new structure, it is required that you log in as a user with the <strong>Add Structure</strong> permission in the <strong>Web Content</strong> section. To achieve this goal, go through the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click on the <strong>Manage</strong> option and choose <strong>Structures</strong>.</li><li class="listitem">Click on the <strong>Add</strong> button.</li><li class="listitem">Type the name of the structure, which is <code class="literal">Internal publication</code>.</li><li class="listitem">It is possible to choose the default language and add some description. We will leave it as default.</li><li class="listitem">Go to the section where there is a drag-and-drop functionality to define fields.</li><li class="listitem">Choose<a id="id420" class="indexterm"/> the <strong>Text</strong> field and drag and drop this field into the gray section.</li><li class="listitem">Click on the added element, go to the <strong>Settings</strong> tab, and set the following properties:<div><ul class="itemizedlist"><li class="listitem"><strong>Field</strong> label as <strong>Author</strong></li><li class="listitem"><strong>Required</strong> as <strong>Yes</strong></li><li class="listitem"><strong>Indexable</strong> as <strong>Indexable – keywords</strong></li><li class="listitem"><strong>Repeatable</strong> as <strong>No</strong></li></ul></div></li><li class="listitem">Click on the <strong>Close</strong> button to save information and go back to the <strong>Fields</strong> tab.</li><li class="listitem">Repeat steps 8 and 9 to define all the necessary fields that were described in our assumptions. The result should look like this:<div><img src="img/image00351.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click<a id="id421" class="indexterm"/> on the <strong>Save</strong> button.</li><li class="listitem">To check out the newly created structure, go to <strong>Web Content</strong> | <strong>Add</strong> | <strong>Internal publication</strong>.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec141"/>How it works…</h2></div></div></div><p>The structure is an XML definition of the web content form. It gives users the following thirteen predefined types:</p><div><ul class="itemizedlist"><li class="listitem"><strong>Boolean</strong>: This<a id="id422" class="indexterm"/> adds a checkbox onto our structure with true/false values</li><li class="listitem"><strong>Date</strong>: Adds an input text with a calendar (date picker)</li><li class="listitem"><strong>Decimal</strong>: Adds an input that accepts only numbers and decimal point</li><li class="listitem"><strong>Documents and Media</strong>: Adds an existing uploaded document to attach to the structure</li><li class="listitem"><strong>HTML</strong>: Adds a WYSIWYG editor</li><li class="listitem"><strong>Image</strong>: Adds a browse-image application</li><li class="listitem"><strong>Integer</strong>: Adds an<a id="id423" class="indexterm"/> input that accepts only numbers</li><li class="listitem"><strong>Link to page</strong>: Adds a select list to select links to another page</li><li class="listitem"><strong>Number</strong>: Similar to Integer and allows only numbers</li><li class="listitem"><strong>Radio</strong>: Adds a radio button</li><li class="listitem"><strong>Select</strong>: Add a select list with options</li><li class="listitem"><strong>Text</strong>: Adds an input text</li><li class="listitem"><strong>Text Box</strong>: Adds a text area component</li></ul></div><p>In the background, each definition is stored as an XML node called <code class="literal">&lt;dynamic-element&gt;</code>. It is <a id="id424" class="indexterm"/>possible to look at how the definition is built by clicking on the <strong>Source</strong> tab from the edit mode of the structure. Here is an example of our <code class="literal">Author</code> definition:</p><div><pre class="programlisting">&lt;dynamic-element dataType="string" indexType="keyword" name="Author" readOnly="false" repeatable="false" required="true" showLabel="true" type="text" width="small"&gt;
  &lt;meta-data locale="en_US"&gt;
    &lt;entry name="label"&gt;
      &lt;![CDATA[Author]]&gt;
    &lt;/entry&gt;
    &lt;entry name="predefinedValue"&gt;
      &lt;![CDATA[]]&gt;
    &lt;/entry&gt;
    &lt;entry name="tip"&gt;
      &lt;![CDATA[]]&gt;
    &lt;/entry&gt;
  &lt;/meta-data&gt;
&lt;/dynamic-element&gt;</pre></div><p>This definition describes all the fields that we set, such as <code class="literal">dataType: string</code>, <code class="literal">indexType: keyword</code>, <code class="literal">name: Author</code>, and so on.</p><p>Each row has many attributes, such as <code class="literal">predefinedValue</code>, <code class="literal">tip</code>, <code class="literal">required</code>, and so on. The following table shows the most important attributes:</p><div><table border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Property name</p>
</th><th valign="bottom">
<p>Value</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Type</p>
</td><td valign="top">
<p>Predefined field type</p>
</td><td valign="top">
<p>Type of the field definition</p>
</td></tr><tr><td valign="top">
<p>Field label</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Label of the field</p>
</td></tr><tr><td valign="top">
<p>Show label</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Determines label visibility</p>
</td></tr><tr><td valign="top">
<p>Required</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Sets field as required field</p>
</td></tr><tr><td valign="top">
<p>Name</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Name of the field, usually the same as label</p>
</td></tr><tr><td valign="top">
<p>Predefined value</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>Sets the default value</p>
</td></tr><tr><td valign="top">
<p>Tip</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>A tip (description) of the field</p>
</td></tr><tr><td valign="top">
<p>Indexable</p>
</td><td valign="top">
<p>Not indexable / Indexable—Keyword / Indexable—Text</p>
</td><td valign="top">
<p>Defines an indexer type and indicates which type of search indexer will be used</p>
</td></tr><tr><td valign="top">
<p>Repeatable</p>
</td><td valign="top">
<p>Yes/No</p>
</td><td valign="top">
<p>Allows us to set the field as repeatable</p>
</td></tr><tr><td valign="top">
<p>Width</p>
</td><td valign="top">
<p>Small/Medium/Large</p>
</td><td valign="top">
<p>Allows us to define the width of the field</p>
</td></tr></tbody></table></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec142"/>There is more…</h2></div></div></div><p>The journal structure<a id="id425" class="indexterm"/> provides interesting functionalities to set default<a id="id426" class="indexterm"/> values for articles that will be created from this structure. One of the possibilities is to set a predefined value on the edit structure screen. However, Liferay also gives us an option called <strong>Edit Default Values</strong>. This setting is really interesting when our requirement is that every article that will be generated from this structure should have a predefined specific category, tag, display page, and so on. In the background, this is an article that has a specific setting in the database in order to prevent it from it being chosen or found by Asset Publisher, Web Content Display, or even searches.</p><p>To set the <a id="id427" class="indexterm"/>default values, follows these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong>.</li><li class="listitem">Click on the <strong>Manage</strong> option and choose <strong>Structures</strong>.</li><li class="listitem">In the selected structure, such as <strong>Internal Publication</strong>, go to <strong>Actions</strong> | <strong>Edit default values</strong>.</li><li class="listitem">Fill in the default values and click on the<strong> Save</strong> button.</li></ol><div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Creating a new template</h1></div></div></div><p>This recipe <a id="id428" class="indexterm"/>requires basic programming skills. In general, a template is a pattern to render values from an article with a specific structure. In accordance with this fact, a template is relative to the structure, so a structure and template are a pair of definitions that can't exist alone. Structures define how the form looks; templates<a id="id429" class="indexterm"/> determine how the journal article will be rendered and arranged.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec143"/>Getting ready…</h2></div></div></div><p>Prepare a structure called <strong>Internal publication</strong>. To see how to achieve this, refer to the previous recipe.</p><p>Let's assume that our template is divided into four parts:</p><div><ul class="itemizedlist"><li class="listitem">Metadata definition that contains <em>Author</em> and <em>Department</em></li><li class="listitem">Metric definition with <em>Client</em> and <em>Project</em> information</li><li class="listitem">Description part with <em>Content</em></li><li class="listitem"><em>Attachments</em> section</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec144"/>How to do it…</h2></div></div></div><p>Liferay gives users three languages to write a template: Velocity (.vm), FreeMarker (.ftl), and Extensible Stylesheet Language (.xsl). Regardless of the language definition, the process of creating a new template consists of the same rules. In order to create a new template, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator.</li><li class="listitem">Go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click on the <strong>Manage</strong> option and choose <strong>Templates</strong>.</li><li class="listitem">Click on the <strong>Add</strong> button.</li><li class="listitem">Fill in the form with the following values:<div><ul class="itemizedlist"><li class="listitem"><strong>Name</strong>: Type <code class="literal">Internal Publication</code></li><li class="listitem"><strong>Structure</strong>: Choose <strong>Internal Publication</strong></li><li class="listitem"><strong>Language</strong>: Choose <strong>Velocity (.vm)</strong></li></ul></div></li><li class="listitem">Write a script that renders our assumptions as follows:<div><pre class="programlisting">  &lt;div class="article-container"&gt;
    &lt;div class="article-metadata"&gt;
      &lt;span&gt;Create Date: $dateTool.format( 'medium_date', $dateTool.toDate( "EEE, dd MMM yyyy hh:mm:ss Z" , $reserved-article-display-date.getData(), $localeUtil.getDefault()) , $locale), Author: $Author.getData(), Department: $Department.getData()&lt;/span&gt;
    &lt;/div&gt;
    &lt;hr /&gt;
    &lt;div class="article-metric"&gt;
      &lt;table&gt;
        &lt;tr&gt;
          &lt;td&gt;Client:&lt;/td&gt;
          &lt;td&gt;$Client.getData()&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;Project:&lt;/td&gt;
          &lt;td&gt;$Project.getData()&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/table&gt;
    &lt;/div&gt;
    
    
  #if($Content.getData().length() &gt; 0)
    &lt;hr /&gt;
      &lt;div class="article-content"&gt;  
        $Content.getData()
      &lt;/div&gt;
    #end

    #if($Attachment.size() &gt; 0) 
    &lt;hr /&gt;
      &lt;div class="article-attachment"&gt;
        &lt;div&gt;Attachments:&lt;/div&gt;
        #foreach($file in $Attachment.getSiblings())
        &lt;a href="$file.getData()"&gt;Attachment # $velocityCount&lt;/a&gt;&lt;br /&gt;
        #end
        &lt;/div&gt;
      #end
      &lt;/div&gt;</pre></div></li><li class="listitem">Click <a id="id430" class="indexterm"/>on the <strong>Save</strong> button.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec145"/>How it works…</h2></div></div></div><p>As we mentioned at the beginning, Liferay gives users three ways (languages) to write an article's template: Velocity (.vm), FreeMarker (.ftl), and Extensible Stylesheet Language (.xls). In this<a id="id431" class="indexterm"/> recipe, we chose Velocity macro, which allows us to mix logic (macros) with HTML and CSS. If we open an editor, we can see that on the left-hand side, there is a menu with <strong>General Variables</strong>, <strong>Fields</strong>, and <strong>Util</strong>, as shown in the following screenshot:</p><div><img src="img/image00352.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec58"/>Variables</h3></div></div></div><p>The <strong>General Variables</strong> section contains variables that can be used in the script. As a matter of fact, these <a id="id432" class="indexterm"/>definitions are used rarely and only in sophisticated <a id="id433" class="indexterm"/>VM or FTL scripts. The following variables are available:</p><div><table border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>Variable</p>
</th><th valign="bottom">
<p>Liferay Class</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>Portal instance</p>
</td><td valign="top">
<p>
<code class="literal">$company</code>
</p>
</td><td valign="top">
<p>Company</p>
</td><td valign="top">
<p>Object <a id="id434" class="indexterm"/>that represents the current portal instance</p>
</td></tr><tr><td valign="top">
<p>Portal instance identifier</p>
</td><td valign="top">
<p>
<code class="literal">$companyId</code>
</p>
</td><td valign="top">
<p>Long</p>
</td><td valign="top">
<p>Identifier<a id="id435" class="indexterm"/> of <a id="id436" class="indexterm"/>the current portal instance</p>
</td></tr><tr><td valign="top">
<p>Device</p>
</td><td valign="top">
<p>
<code class="literal">$device</code>
</p>
</td><td valign="top">
<p>Device</p>
</td><td valign="top">
<p>Object that <a id="id437" class="indexterm"/>represents the <a id="id438" class="indexterm"/>device currently used to access the site</p>
</td></tr><tr><td valign="top">
<p>Site ID</p>
</td><td valign="top">
<p>
<code class="literal">$groupId</code>
</p>
</td><td valign="top">
<p>Long</p>
</td><td valign="top">
<p>The<a id="id439" class="indexterm"/> identifier of the current site</p>
</td></tr><tr><td valign="top">
<p>View mode</p>
</td><td valign="top">
<p>
<code class="literal">$viewMode</code>
</p>
</td><td valign="top">
<p>String</p>
</td><td valign="top">
<p>The <a id="id440" class="indexterm"/>desired view mode for the content; the value will be <code class="literal">print</code> for print mode</p>
</td></tr></tbody></table></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec59"/>Fields</h3></div></div></div><p>These objects can be used in our scripts. For instance, the <code class="literal">$Content.getData()</code> invocation prints a<a id="id441" class="indexterm"/> value from the <code class="literal">Content</code> field of the structure. As shown in <a id="id442" class="indexterm"/>the preceding code, we used this invocation for the following fields:</p><div><pre class="programlisting">$Author.getData() 
$Department.getData()
$Client.getData()
$Project.getData()
$Content.getData()
$file.getData()</pre></div><p>The next useful invocation is <code class="literal">$Attachment.getSiblings()</code>. This method is used when our field is repeatable and contains many values. In our example, the <code class="literal">Attachment</code> field has two siblings.</p><p>To iterate over siblings, we used the <code class="literal">foreach</code> macro, which is very similar to the well-known <code class="literal">foreach</code> construction from the Java language.</p><p>Considering the preceding code, fields have other methods, such as the following ones:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">$field.getName()</code>: This<a id="id443" class="indexterm"/> prints the field's name</li><li class="listitem"><code class="literal">$field.getType()</code>: This<a id="id444" class="indexterm"/> returns field's type, which is defined in the structure</li><li class="listitem"><code class="literal">$field.getChildren()</code>: This<a id="id445" class="indexterm"/> is used when a field has nested fields</li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec60"/>Utils</h3></div></div></div><p>The most powerful tools that are available in the script are utils. In fact, there are real Java-based <a id="id446" class="indexterm"/>classes that offer a huge range of functionalities. In our example, we <a id="id447" class="indexterm"/>used one to print a display date of the article:</p><div><pre class="programlisting">
<strong>$dateTool.format( 'medium_date', $dateTool.toDate( "EEE, dd MMM yyyy hh:mm:ss Z" , $reserved-article-display-date.getData(), $localeUtil.getDefault())</strong>
</pre></div><p>The full list of available services is placed in the following Java classes:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">com.liferay.portal.template.TemplateContextHelper</code></li><li class="listitem"><code class="literal">com.liferay.portal.velocity.VelocityTemplateContextHelper</code> (for Velocity)</li><li class="listitem"><code class="literal">com.liferay.portal.freemarker.FreeMarkerTemplateContextHelper</code> (for FreeMarker)</li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec61"/>Reserved variables</h3></div></div></div><p>The preceding<a id="id448" class="indexterm"/> code has a special invocation: <code class="literal">$reserved-article-display-date.getData()</code>. This is a reserved variable that is globally <a id="id449" class="indexterm"/>available in every template. In our example, it displays <code class="literal">display date</code> for the article. Liferay offers many reserved variables, such as <code class="literal">reserved-article-title</code>, <code class="literal">reserved-article-type</code>, <code class="literal">reserved-article-version</code>, and so on.</p><p>The full list of these variables is defined in the <code class="literal">com.liferay.portlet.journal.model.JournalStructureConstants</code> class.</p></div></div></div></body></html>