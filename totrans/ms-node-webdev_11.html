<html><head></head><body>
<div class="calibre1" id="_idContainer138">
<h1 class="chapternumber"><span class="kobospan" id="kobo.1.1">10</span></h1>
<h1 class="chaptertitle" id="_idParaDest-174"><span class="kobospan" id="kobo.2.1">Using HTML Templates</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.3.1">In this chapter, I describe how templates are used to generate HTML content, allowing an application to adapt the content display to the user to reflect the request that is being processed or the application’s state data.</span></p>
<p class="normal"><span class="kobospan" id="kobo.4.1">Like many of the topics described in this book, templates are much easier to understand once you see how they work. </span><span class="kobospan" id="kobo.4.2">Therefore, I will start by creating a simple custom template system using just the features provided by the JavaScript and Node.js APIs, just to explain how the pieces fit together. </span><span class="kobospan" id="kobo.4.3">I will demonstrate </span><em class="italic"><span class="kobospan" id="kobo.5.1">server-side templates</span></em><span class="kobospan" id="kobo.6.1">, where the backend server generates the HTML content, and </span><em class="italic"><span class="kobospan" id="kobo.7.1">client-side templates</span></em><span class="kobospan" id="kobo.8.1">, where the browser generates the content. </span></p>
<p class="normal"><span class="kobospan" id="kobo.9.1">The </span><a id="_idIndexMarker466" class="calibre3"/><span class="kobospan" id="kobo.10.1">custom templates in this chapter are educational but too limited for use in a real project, so I also introduce a popular template package that has many more features and much better performance, and which is suitable for use in a real project. </span><em class="italic"><span class="kobospan" id="kobo.11.1">Table 10.1</span></em><span class="kobospan" id="kobo.12.1"> puts HTML templates in context.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.13.1">Table 10.1: Putting HTML templates in context</span></p>
<table class="table-container" id="table001-7">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.14.1">Question</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.15.1">Answer</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.16.1">What are they?</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.17.1">HTML templates are HTML documents that contain placeholders that are replaced with dynamic content to reflect the state of the application. </span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.18.1">Why are they useful?</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.19.1">Templates allow the content presented to the user to reflect changes in the application state and are a key building block in most web applications.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.20.1">How are they used?</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.21.1">There are many good template packages available and popular frameworks generally include a template system.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.22.1">Are there any pitfalls or limitations?</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.23.1">It is important to find a package with a format that you find easy to read, but otherwise, template engines are a positive addition to a web application project.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.24.1">Are there any alternatives?</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan3" id="kobo.25.1">You could generate content entirely using JavaScript code, but this tends to be difficult to maintain. </span><span class="kobospan4" id="kobo.25.2">You may not be able to avoid using templates if you are using a framework, such as React or Angular.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="normal"><em class="italic"><span class="kobospan" id="kobo.26.1">Table 10.2</span></em><span class="kobospan" id="kobo.27.1"> summarizes the chapter.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.28.1">Table 10.2: Chapter summary</span></p>
<table class="table-container" id="table002-7">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.29.1">Problem</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.30.1">Solution</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.31.1">Listing</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.32.1">Dynamically render HTML elements</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.33.1">Use a template engine that mixes HTML elements and expressions that are evaluated to produce data values. </span></p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1"><span class="kobospan2" id="kobo.34.1">1-4, 11-15, 21-27</span></em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.35.1">Evaluate template expressions</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan3" id="kobo.36.1">Use the </span><code class="inlinecode"><span class="kobospan2" id="kobo.37.1">eval</span></code><span class="kobospan4" id="kobo.38.1"> keyword to evaluate string expressions as JavaScript statements. </span></p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1"><span class="kobospan2" id="kobo.39.1">5, 6</span></em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.40.1">Break up templates into more manageable content</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.41.1">Use partial templates/views.</span></p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1"><span class="kobospan2" id="kobo.42.1">7-10</span></em></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.43.1">Dynamically render HTML elements at the browser</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.44.1">Compile templates into JavaScript code that is included in the bundle loaded by the browser.</span></p>
</td>
<td class="table-cell">
<p class="normal"><em class="italic1"><span class="kobospan2" id="kobo.45.1">16-20, 28-31</span></em></p>
</td>
</tr>
</tbody>
</table>
<h1 class="heading" id="_idParaDest-175"><span class="kobospan" id="kobo.46.1">Preparing for this chapter</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.47.1">This chapter uses the </span><code class="inlinecode"><span class="kobospan" id="kobo.48.1">part2app</span></code><span class="kobospan" id="kobo.49.1"> project created in </span><em class="italic"><span class="kobospan" id="kobo.50.1">Chapter 9</span></em><span class="kobospan" id="kobo.51.1">. </span><span class="kobospan" id="kobo.51.2">No changes are required to prepare for this chapter. </span><span class="kobospan" id="kobo.51.3">Open a command prompt and run the command shown in </span><em class="italic"><span class="kobospan" id="kobo.52.1">Listing 10.1</span></em><span class="kobospan" id="kobo.53.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.54.1">part2app</span></code><span class="kobospan" id="kobo.55.1"> folder to start the development tools.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.56.1">Tip</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.57.1">You can download the example project for this chapter – and for all the other chapters in this book – from </span><a href="https://github.com/PacktPublishing/Mastering-Node.js-Web-Development" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.58.1">https://github.com/PacktPublishing/Mastering-Node.js-Web-Development</span></span></a><span class="kobospan" id="kobo.59.1">. </span><span class="kobospan" id="kobo.59.2">See </span><em class="italic"><span class="kobospan" id="kobo.60.1">Chapter 1</span></em><span class="kobospan" id="kobo.61.1"> for how to get help if you have problems running the examples.</span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.62.1">Listing 10.1: Starting the development tools</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.63.1">npm start
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.64.1">Open a web browser, request </span><code class="inlinecode"><span class="kobospan" id="kobo.65.1">http://localhost:5000</span></code><span class="kobospan" id="kobo.66.1">, and click the </span><strong class="screentext"><span class="kobospan" id="kobo.67.1">Send Request</span></strong><span class="kobospan" id="kobo.68.1"> button. </span><span class="kobospan" id="kobo.68.2">The browser will send a request to the backend server and display details of the results, as shown in </span><em class="italic"><span class="kobospan" id="kobo.69.1">Figure 10.1</span></em><span class="kobospan" id="kobo.70.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.71.1"><img alt="" src="../Images/B21959_10_01.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.72.1">Figure 10.1: Running the example application</span></p>
<h1 class="heading" id="_idParaDest-176"><span class="kobospan" id="kobo.73.1">Using server-side HTML templates</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.74.1">Server-side HTML templates</span><a id="_idIndexMarker467" class="calibre3"/><span class="kobospan" id="kobo.75.1"> allow the backend server to dynamically generate content to send the browser content that is tailored to an individual request. </span><span class="kobospan" id="kobo.75.2">Tailoring can take any form, but a typical example is to include content that is specific to the user, such as including the user’s name.</span></p>
<p class="normal"><span class="kobospan" id="kobo.76.1">Three things are required for an HTML template: a </span><em class="italic"><span class="kobospan" id="kobo.77.1">template</span></em><span class="kobospan" id="kobo.78.1"> file that has placeholder sections into which dynamic content will be inserted, a </span><em class="italic"><span class="kobospan" id="kobo.79.1">data dictionary</span></em><span class="kobospan" id="kobo.80.1"> or </span><em class="italic"><span class="kobospan" id="kobo.81.1">context</span></em><span class="kobospan" id="kobo.82.1"> that provides the values that will determine the specific dynamic content that will be generated, and a </span><em class="italic"><span class="kobospan" id="kobo.83.1">template engine</span></em><span class="kobospan" id="kobo.84.1"> that processes the view and the dictionary to produce an HTML document into which dynamic</span><a id="_idIndexMarker468" class="calibre3"/><span class="kobospan" id="kobo.85.1"> content has been inserted, and which can be used as a response to an HTTP request, as shown in </span><em class="italic"><span class="kobospan" id="kobo.86.1">Figure 10.2</span></em><span class="kobospan" id="kobo.87.1">. </span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.88.1"><img alt="" src="../Images/B21959_10_02.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.89.1">Figure 10.2: The components of an HTML template</span></p>
<p class="normal"><span class="kobospan" id="kobo.90.1">The task of processing a template is known as </span><em class="italic"><span class="kobospan" id="kobo.91.1">rendering</span></em><span class="kobospan" id="kobo.92.1"> and it occurs entirely in the backend server. </span><span class="kobospan" id="kobo.92.2">Rendering produces a regular HTML document that, from the perspective of the browser, appears no different from regular static content. </span><span class="kobospan" id="kobo.92.3">(There is a different kind of template that is sent to the browser as JavaScript, where it is rendered to create HTML content by the client, as described in the </span><em class="italic"><span class="kobospan" id="kobo.93.1">Using client-side HTML templates</span></em><span class="kobospan" id="kobo.94.1"> section). </span></p>
<h2 class="heading1" id="_idParaDest-177"><span class="kobospan" id="kobo.95.1">Creating a simple template engine</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.96.1">It is </span><a id="_idIndexMarker469" class="calibre3"/><span class="kobospan" id="kobo.97.1">easy to create a simple template engine to help understand how they work, although it is</span><a id="_idIndexMarker470" class="calibre3"/><span class="kobospan" id="kobo.98.1"> much harder to create one that is production ready. </span><span class="kobospan" id="kobo.98.2">In this section, I’ll create something simple and then introduce an open-source template engine package that is better, faster, and has many more features.</span></p>
<p class="normal"><span class="kobospan" id="kobo.99.1">I am going to start by creating the template, which will help put everything in context. </span><span class="kobospan" id="kobo.99.2">Create the </span><code class="inlinecode"><span class="kobospan" id="kobo.100.1">part2app/templates/server</span></code><span class="kobospan" id="kobo.101.1"> folder and add to it a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.102.1">basic.custom</span></code><span class="kobospan" id="kobo.103.1"> with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.104.1">Listing 10.2</span></em><span class="kobospan" id="kobo.105.1">.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.106.1">Tip</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.107.1">Most code editors can be configured to understand that files with a non-standard extension, such as </span><code class="inlinecode"><span class="kobospan" id="kobo.108.1">.custom</span></code><span class="kobospan" id="kobo.109.1">, contain a well-known format, such as HTML. </span><span class="kobospan" id="kobo.109.2">If you are using Visual Studio Code, for example, click on </span><strong class="screentext"><span class="kobospan" id="kobo.110.1">Plain Text</span></strong><span class="kobospan" id="kobo.111.1"> in the bottom-right corner of the window and either choose the format for a single file or set up an association so that all </span><code class="inlinecode"><span class="kobospan" id="kobo.112.1">.custom</span></code><span class="kobospan" id="kobo.113.1"> files are treated like HTML, which will make it easier to spot mistakes when following the examples. </span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.114.1">Listing 10.2: The contents of the basic.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.115.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;link href="/css/bootstrap.min.css" rel="stylesheet" /&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h3 class="m-2"&gt;Message: {{ message }}&lt;/h3&gt;
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.116.1">This </span><a id="_idIndexMarker471" class="calibre3"/><span class="kobospan" id="kobo.117.1">template</span><a id="_idIndexMarker472" class="calibre3"/><span class="kobospan" id="kobo.118.1"> is a complete HTML document with one placeholder, which is denoted by the double curly braces (the </span><code class="inlinecode"><span class="kobospan" id="kobo.119.1">{{</span></code><span class="kobospan" id="kobo.120.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.121.1">}}</span></code><span class="kobospan" id="kobo.122.1"> characters). </span><span class="kobospan" id="kobo.122.2">The content inside of the braces is a </span><em class="italic"><span class="kobospan" id="kobo.123.1">template expression</span></em><span class="kobospan" id="kobo.124.1"> that will be evaluated when the template is rendered and used to replace the placeholder. </span></p>
<p class="normal"><span class="kobospan" id="kobo.125.1">Not all template engines use the </span><code class="inlinecode"><span class="kobospan" id="kobo.126.1">{{</span></code><span class="kobospan" id="kobo.127.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.128.1">}}</span></code><span class="kobospan" id="kobo.129.1"> characters, although that is a popular choice, and what is important is that the character sequence that denotes a placeholder is unlikely to occur in the static parts of the template, which is why you will usually see sequences of repeating characters, or unusual characters, used. </span></p>
<h3 class="heading2" id="_idParaDest-178"><span class="kobospan" id="kobo.130.1">Creating the custom template engine</span></h3>
<p class="normal1"><span class="kobospan" id="kobo.131.1">The </span><a id="_idIndexMarker473" class="calibre3"/><span class="kobospan" id="kobo.132.1">Express package has </span><a id="_idIndexMarker474" class="calibre3"/><span class="kobospan" id="kobo.133.1">integrated support for template engines, which makes it easy to experiment and learn how they work. </span><span class="kobospan" id="kobo.133.2">Add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.134.1">custom_engine.ts</span></code><span class="kobospan" id="kobo.135.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.136.1">src/server</span></code><span class="kobospan" id="kobo.137.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.138.1">Listing 10.3</span></em><span class="kobospan" id="kobo.139.1">. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.140.1">Listing 10.3: The contents of the custom_engine.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.141.1">import { readFile } from "fs";
import { Express } from "express";
const renderTemplate = (path: string, context: any,
    callback: (err: any, response: string | undefined) =&gt; void) =&gt; {
    readFile(path, (err, data) =&gt; {
        if (err != undefined) {
            callback("Cannot generate content", undefined);
        } else {
            callback(undefined, parseTemplate(data.toString(), context));           
        }
    });
};
const parseTemplate = (template: string, context: any) =&gt; {
    const expr = /{{(.*)}}/gm;
    return template.toString().replaceAll(expr, (match, group) =&gt; {
        return context[group.trim()] ?? </span><span class="kobospan" id="kobo.141.2">"(no data)"
    });               
}
export const registerCustomTemplateEngine = (expressApp: Express) =&gt;
    expressApp.engine("custom", renderTemplate);
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.142.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.143.1">renderTemplate</span></code><span class="kobospan" id="kobo.144.1"> function will be called by Express to render a template. </span><span class="kobospan" id="kobo.144.2">The</span><a id="_idIndexMarker475" class="calibre3"/><span class="kobospan" id="kobo.145.1"> parameters are a </span><code class="inlinecode"><span class="kobospan" id="kobo.146.1">string</span></code><span class="kobospan" id="kobo.147.1"> that contains the template file path, an </span><code class="inlinecode"><span class="kobospan" id="kobo.148.1">object</span></code><span class="kobospan" id="kobo.149.1"> that provides </span><a id="_idIndexMarker476" class="calibre3"/><span class="kobospan" id="kobo.150.1">context data for rendering the template, and a callback function used to provide Express with the rendered content or an error if something goes wrong.</span></p>
<p class="normal"><span class="kobospan" id="kobo.151.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.152.1">renderTemplate</span></code><span class="kobospan" id="kobo.153.1"> function uses the </span><code class="inlinecode"><span class="kobospan" id="kobo.154.1">readFile</span></code><span class="kobospan" id="kobo.155.1"> function to read the contents of the template file and then invokes the </span><code class="inlinecode"><span class="kobospan" id="kobo.156.1">parseTemplate</span></code><span class="kobospan" id="kobo.157.1"> function, which uses a regular expression to search for the </span><code class="inlinecode"><span class="kobospan" id="kobo.158.1">{{</span></code><span class="kobospan" id="kobo.159.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.160.1">}}</span></code><span class="kobospan" id="kobo.161.1"> characters. </span><span class="kobospan" id="kobo.161.2">For each match, a callback function inserts a data value from the context object in the result, like this:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.162.1">...
</span><span class="kobospan" id="kobo.162.2">const expr = /{{(.*)}}/gm;
return template.toString().replaceAll(expr, (match, group) =&gt; {
   </span><strong class="screentext"><span class="kobospan" id="kobo.163.1"> return context[group.trim()] ?? </span><span class="kobospan" id="kobo.163.2">"(no data)"</span></strong><span class="kobospan" id="kobo.164.1">
});
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.165.1">This is a rudimentary approach, and real engines are more complex and take greater care to </span><a id="_idIndexMarker477" class="calibre3"/><span class="kobospan" id="kobo.166.1">find template expressions, but this is enough to demonstrate the idea. </span><span class="kobospan" id="kobo.166.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.167.1">registerCustomTemplateEngine</span></code><span class="kobospan" id="kobo.168.1"> function registers the template engine </span><a id="_idIndexMarker478" class="calibre3"/><span class="kobospan" id="kobo.169.1">with Express, which is done by calling the </span><code class="inlinecode"><span class="kobospan" id="kobo.170.1">Express.engine</span></code><span class="kobospan" id="kobo.171.1"> method, specifying the file extension and the </span><code class="inlinecode"><span class="kobospan" id="kobo.172.1">renderTemplate</span></code><span class="kobospan" id="kobo.173.1"> function: </span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.174.1">...
</span><span class="kobospan" id="kobo.174.2">export const registerCustomTemplateEngine = (expressApp: Express) =&gt;
    expressApp.</span><strong class="screentext"><span class="kobospan" id="kobo.175.1">engine</span></strong><span class="kobospan" id="kobo.176.1">("custom", renderTemplate);
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.177.1">This statement tells Express to use the </span><code class="inlinecode"><span class="kobospan" id="kobo.178.1">renderTemplate</span></code><span class="kobospan" id="kobo.179.1"> function to render template files that have a </span><code class="inlinecode"><span class="kobospan" id="kobo.180.1">.custom</span></code><span class="kobospan" id="kobo.181.1"> file extension.</span></p>
<h3 class="heading2" id="_idParaDest-179"><span class="kobospan" id="kobo.182.1">Setting up the custom template engine</span></h3>
<p class="normal1"><span class="kobospan" id="kobo.183.1">The</span><a id="_idIndexMarker479" class="calibre3"/><span class="kobospan" id="kobo.184.1"> final part of the</span><a id="_idIndexMarker480" class="calibre3"/><span class="kobospan" id="kobo.185.1"> process is to configure Express and create a route that matches requests that will be handled with a template, as shown in </span><em class="italic"><span class="kobospan" id="kobo.186.1">Listing 10.4</span></em><span class="kobospan" id="kobo.187.1">. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.188.1">Listing 10.4: Setting up the template engine in the server.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.189.1">import { createServer } from "http";
import express, {Express } from "express";
import { testHandler } from "./testHandler";
import httpProxy from "http-proxy";
import helmet from "helmet";
</span><strong class="screentext"><span class="kobospan" id="kobo.190.1">import { registerCustomTemplateEngine } from "./custom_engine";</span></strong><span class="kobospan" id="kobo.191.1">
const port = 5000;
const expressApp: Express = express();
const proxy = httpProxy.createProxyServer({
    target: "http://localhost:5100", ws: true
});
</span><strong class="screentext"><span class="kobospan" id="kobo.192.1">registerCustomTemplateEngine(expressApp);</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.193.1">expressApp.set("views", "templates/server");</span></strong><span class="kobospan" id="kobo.194.1">
expressApp.use(helmet());
expressApp.use(express.json());
</span><strong class="screentext"><span class="kobospan" id="kobo.195.1">expressApp.</span></strong><strong class="screentext"><span class="kobospan" id="kobo.196.1">get("/dynamic/:file", (req, resp) =&gt; {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.197.1">    resp.render(`${req.params.file}.custom`, { message: "Hello template" });</span></strong><span class="kobospan" id="kobo.198.1">
});
expressApp.post("/test", testHandler);
expressApp.use(express.static("static"));
expressApp.use(express.static("node_modules/bootstrap/dist"));
expressApp.use((req, resp) =&gt; proxy.web(req, resp));
const server = createServer(expressApp);
server.on('upgrade', (req, socket, head) =&gt; proxy.ws(req, socket, head));
server.listen(port,
    () =&gt; console.log(`HTTP Server listening on port ${port}`));
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.199.1">Calling</span><a id="_idIndexMarker481" class="calibre3"/><span class="kobospan" id="kobo.200.1"> the </span><code class="inlinecode"><span class="kobospan" id="kobo.201.1">registerCustomTemplateEngine</span></code><span class="kobospan" id="kobo.202.1"> defined in </span><em class="italic"><span class="kobospan" id="kobo.203.1">Listing 10.4</span></em><span class="kobospan" id="kobo.204.1"> sets up the custom template</span><a id="_idIndexMarker482" class="calibre3"/><span class="kobospan" id="kobo.205.1"> engine. </span><span class="kobospan" id="kobo.205.2">By default, Express looks for template files in the </span><code class="inlinecode"><span class="kobospan" id="kobo.206.1">views</span></code><span class="kobospan" id="kobo.207.1"> folder. </span></p>
<p class="normal"><em class="italic"><span class="kobospan" id="kobo.208.1">Views</span></em><span class="kobospan" id="kobo.209.1"> and </span><em class="italic"><span class="kobospan" id="kobo.210.1">view engines </span></em><span class="kobospan" id="kobo.211.1">are alternate names for templates and template engines, but to keep the terminology consistent, I used the </span><code class="inlinecode"><span class="kobospan" id="kobo.212.1">ExpressApp.set</span></code><span class="kobospan" id="kobo.213.1"> method to change the template file location:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.214.1">...
</span><span class="kobospan" id="kobo.214.2">expressApp.</span><strong class="screentext"><span class="kobospan" id="kobo.215.1">set</span></strong><span class="kobospan" id="kobo.216.1">("views", "templates/server");
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.217.1">The complete set of Express configuration properties can be found at </span><a href="https://expressjs.com/en/4x/api.html#app.set" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.218.1">https://expressjs.com/en/4x/api.html#app.set</span></span></a><span class="kobospan" id="kobo.219.1"> and the </span><code class="inlinecode"><span class="kobospan" id="kobo.220.1">views</span></code><span class="kobospan" id="kobo.221.1"> property is used to specify the directory that contains template files.</span></p>
<p class="normal"><span class="kobospan" id="kobo.222.1">The Express router is used to match requests that will be handled by templates, like this:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.223.1">...
</span><span class="kobospan" id="kobo.223.2">expressApp.</span><strong class="screentext"><span class="kobospan" id="kobo.224.1">get</span></strong><span class="kobospan" id="kobo.225.1">("/dynamic/:file", (req, resp) =&gt; {
    resp.</span><strong class="screentext"><span class="kobospan" id="kobo.226.1">render</span></strong><span class="kobospan" id="kobo.227.1">(`${req.params.file}.custom`, { message: "Hello template" });
});
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.228.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.229.1">get</span></code><span class="kobospan" id="kobo.230.1"> method </span><a id="_idIndexMarker483" class="calibre3"/><span class="kobospan" id="kobo.231.1">creates a route that matches paths that start with </span><code class="inlinecode"><span class="kobospan" id="kobo.232.1">/dynamic</span></code><span class="kobospan" id="kobo.233.1"> and captures</span><a id="_idIndexMarker484" class="calibre3"/><span class="kobospan" id="kobo.234.1"> the next path segment to a route parameter named </span><code class="inlinecode"><span class="kobospan" id="kobo.235.1">file</span></code><span class="kobospan" id="kobo.236.1">. </span><span class="kobospan" id="kobo.236.2">The request handler invokes the </span><code class="inlinecode"><span class="kobospan" id="kobo.237.1">Response.render</span></code><span class="kobospan" id="kobo.238.1"> method, which is responsible for rendering a template. </span><span class="kobospan" id="kobo.238.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.239.1">file</span></code><span class="kobospan" id="kobo.240.1"> route parameter is used to create the first argument to the render method, which is the name of the template file. </span><span class="kobospan" id="kobo.240.2">The second argument is an object that provides the template engine with context data to help it generate content. </span><span class="kobospan" id="kobo.240.3">In this example, the context object defines a </span><code class="inlinecode"><span class="kobospan" id="kobo.241.1">message</span></code><span class="kobospan" id="kobo.242.1"> property, whose value will be included in the rendered output. </span></p>
<p class="normal"><span class="kobospan" id="kobo.243.1">To test the custom template engine, use a browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.244.1">http://localhost:5000/dynamic/basic</span></code><span class="kobospan" id="kobo.245.1">. </span><span class="kobospan" id="kobo.245.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.246.1">dynamic</span></code><span class="kobospan" id="kobo.247.1"> part of the URL will be matched by the new Express route, and the </span><code class="inlinecode"><span class="kobospan" id="kobo.248.1">basic</span></code><span class="kobospan" id="kobo.249.1"> part corresponds to the </span><code class="inlinecode"><span class="kobospan" id="kobo.250.1">basic.custom</span></code><span class="kobospan" id="kobo.251.1"> file in the templates folder. </span><span class="kobospan" id="kobo.251.2">The custom view engine will process the template file and the results will be written to the response, as shown in </span><em class="italic"><span class="kobospan" id="kobo.252.1">Figure 10.3</span></em><span class="kobospan" id="kobo.253.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.254.1"><img alt="" src="../Images/B21959_10_03.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.255.1">Figure 10.3: Using a custom template engine</span></p>
<h2 class="heading1" id="_idParaDest-180"><span class="kobospan" id="kobo.256.1">Evaluating expressions in templates</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.257.1">Inserting </span><a id="_idIndexMarker485" class="calibre3"/><span class="kobospan" id="kobo.258.1">data values into templates is a good start, but most template engines have support for evaluating fragments of JavaScript code and inserting the results into the output. </span><em class="italic"><span class="kobospan" id="kobo.259.1">Listing 10.5</span></em><span class="kobospan" id="kobo.260.1"> adds some template expressions to the template. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.261.1">Listing 10.5: Adding expressions to the basic.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.262.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;link href="/css/bootstrap.min.css" rel="stylesheet" /&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h3 class="m-2"&gt;Message: {{ message }}&lt;/h3&gt;
        </span><strong class="screentext"><span class="kobospan" id="kobo.263.1">&lt;h3 class="m-2"&gt;Lower: {{ message.toLowerCase() }}&lt;/h3&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.264.1">        &lt;h3 class="</span></strong><strong class="screentext"><span class="kobospan" id="kobo.265.1">m-2"&gt;Count: {{ 2 * 3 }}&lt;/h3&gt;</span></strong><span class="kobospan" id="kobo.266.1">
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><em class="italic"><span class="kobospan" id="kobo.267.1">Listing 10.6</span></em><span class="kobospan" id="kobo.268.1"> adds support for evaluating expressions to the template engine, using the JavaScript </span><code class="inlinecode"><span class="kobospan" id="kobo.269.1">eval</span></code><span class="kobospan" id="kobo.270.1"> function.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.271.1">Caution</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.272.1">The JavaScript </span><code class="inlinecode"><span class="kobospan" id="kobo.273.1">eval</span></code><span class="kobospan" id="kobo.274.1"> function is dangerous, especially if there is the possibility that it might be used with content or data provided by users because it can be used to execute any JavaScript code. </span><span class="kobospan" id="kobo.274.2">This alone is enough reason to use a well-tested template engine package, such as the one introduced in the Using a template package section. </span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.275.1">Listing 10.6: Evaluating expressions in the custom_engine.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.276.1">import { readFile } from "fs";
import { Express } from "express";
const renderTemplate = (path: string, context: any,
    callback: (err: any, response: string | undefined) =&gt; void) =&gt; {
    readFile(path, (err, data) =&gt; {
        if (err != undefined) {
            callback("Cannot generate content", undefined);
        } else {
            callback(undefined, parseTemplate(data.toString(), context));           
        }
    });
};
const parseTemplate = (template: string, context: any) =&gt; {
   </span><strong class="screentext"><span class="kobospan" id="kobo.277.1"> const ctx = Object</span></strong><strong class="screentext"><span class="kobospan" id="kobo.278.1">.keys(context)</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.279.1">        .map((k) =&gt; `const ${k} = context.${k}`)</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.280.1">        .join(";");</span></strong><span class="kobospan" id="kobo.281.1">
    const expr = /{{(.*)}}/gm;
    return template.toString().replaceAll(expr, (match, group) =&gt; {
      </span><strong class="screentext"><span class="kobospan" id="kobo.282.1">  return eval(`</span></strong><strong class="screentext"><span class="kobospan" id="kobo.283.1">${ctx};${group}`);</span></strong><span class="kobospan" id="kobo.284.1">
    });
}
export const registerCustomTemplateEngine = (expressApp: Express) =&gt;
    expressApp.engine("custom", renderTemplate);
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.285.1">The </span><a id="_idIndexMarker486" class="calibre3"/><span class="kobospan" id="kobo.286.1">difficulty of using </span><code class="inlinecode"><span class="kobospan" id="kobo.287.1">eval</span></code><span class="kobospan" id="kobo.288.1"> is making sure that context data is available as local variables when evaluating an expression. </span><span class="kobospan" id="kobo.288.2">To make sure that the context data is in scope, I create a string for each property of the context object and combine those strings with the expression to be evaluated, like this:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.289.1">...
</span><span class="kobospan" id="kobo.289.2">"const message = context.message; message.toLowerCase()"
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.290.1">This approach ensures that there is a </span><code class="inlinecode"><span class="kobospan" id="kobo.291.1">message</span></code><span class="kobospan" id="kobo.292.1"> value for the expression to use, for example. </span><span class="kobospan" id="kobo.292.2">There are some serious dangers in using </span><code class="inlinecode"><span class="kobospan" id="kobo.293.1">eval</span></code><span class="kobospan" id="kobo.294.1"> but it is fine for the example application, although it bears repeating to say a real template package should be used in real projects, especially when dealing with user-supplied data. </span><span class="kobospan" id="kobo.294.2">Use a browser window to request </span><code class="inlinecode"><span class="kobospan" id="kobo.295.1">http://localhost:5000/dynamic/basic</span></code><span class="kobospan" id="kobo.296.1"> and you will see the results shown in </span><em class="italic"><span class="kobospan" id="kobo.297.1">Figure 10.4</span></em><span class="kobospan" id="kobo.298.1">. </span><span class="kobospan" id="kobo.298.2">(The browser won’t reload automatically, so you will either have to make a new request or reload the browser).</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.299.1"><img alt="" src="../Images/B21959_10_04.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.300.1">Figure 10.4: Evaluating JavaScript expressions in a template</span></p>
<h2 class="heading1" id="_idParaDest-181"><span class="kobospan" id="kobo.301.1">Adding template features</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.302.1">The</span><a id="_idIndexMarker487" class="calibre3"/><span class="kobospan" id="kobo.303.1"> ability to evaluate expressions provides a foundation for creating additional features, which can be easily written as JavaScript functions and added to the context used to parse the template. </span><span class="kobospan" id="kobo.303.2">Add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.304.1">custom_features.ts</span></code><span class="kobospan" id="kobo.305.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.306.1">src/server</span></code><span class="kobospan" id="kobo.307.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.308.1">Listing 10.7</span></em><span class="kobospan" id="kobo.309.1">.</span></p>
<div class="note">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.310.1">Compiling templates</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.311.1">Most real template engines compile their templates, which means that templates are converted into a series of JavaScript functions that can be invoked to generate content. </span><span class="kobospan" id="kobo.311.2">This doesn’t change the content that is generated but it can improve performance because output can be created without needing to read and search the template file. </span><span class="kobospan" id="kobo.311.3">Client-side templates are also compiled so that the JavaScript functions can be presented to the browser. </span><span class="kobospan" id="kobo.311.4">You can see an example of this process in the </span><em class="italic"><span class="kobospan" id="kobo.312.1">Using a template package</span></em><span class="kobospan" id="kobo.313.1"> section, later in the chapter. </span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.314.1">Listing 10.7: The contents of the custom_features.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.315.1">import { readFileSync } from "fs";
export const style = (stylesheet: string) =&gt; {
    return `&lt;link href="/css/${stylesheet}" rel="stylesheet" /&gt;`;
}
export const partial = (file: string, context: any) =&gt; {
    const path = `./${context.settings.views}/${file}.custom`;
    return readFileSync(path, "utf-8");
}
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.316.1">This </span><a id="_idIndexMarker488" class="calibre3"/><span class="kobospan" id="kobo.317.1">file defines a </span><code class="inlinecode"><span class="kobospan" id="kobo.318.1">style</span></code><span class="kobospan" id="kobo.319.1"> function that accepts a stylesheet name and returns a </span><code class="inlinecode"><span class="kobospan" id="kobo.320.1">link</span></code><span class="kobospan" id="kobo.321.1"> element. </span><span class="kobospan" id="kobo.321.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.322.1">partial</span></code><span class="kobospan" id="kobo.323.1"> function reads another template file and returns its content for inclusion in the overall content. </span><span class="kobospan" id="kobo.323.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.324.1">partial</span></code><span class="kobospan" id="kobo.325.1"> function receives a context object, which it uses to locate the requested file:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.326.1">...
</span><span class="kobospan" id="kobo.326.2">const path = `./${</span><strong class="screentext"><span class="kobospan" id="kobo.327.1">context.settings.views</span></strong><span class="kobospan" id="kobo.328.1">}/${file}.custom`;
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.329.1">The context object that Express provides to the template engine has a </span><code class="inlinecode"><span class="kobospan" id="kobo.330.1">settings</span></code><span class="kobospan" id="kobo.331.1"> property, which returns an object that contains the application’s configuration. </span><span class="kobospan" id="kobo.331.2">One of the settings properties is </span><code class="inlinecode"><span class="kobospan" id="kobo.332.1">views</span></code><span class="kobospan" id="kobo.333.1">, which returns the location of the template files (the </span><code class="inlinecode"><span class="kobospan" id="kobo.334.1">templates/server</span></code><span class="kobospan" id="kobo.335.1"> folder). </span><em class="italic"><span class="kobospan" id="kobo.336.1">Listing 10.8</span></em><span class="kobospan" id="kobo.337.1"> revises the template to use these new features. </span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.338.1">Note</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.339.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.340.1">partial</span></code><span class="kobospan" id="kobo.341.1"> function in </span><em class="italic"><span class="kobospan" id="kobo.342.1">Listing 10.7</span></em><span class="kobospan" id="kobo.343.1"> performs a blocking operation to read the contents of the file. </span><span class="kobospan" id="kobo.343.2">As explained in </span><em class="italic"><span class="kobospan" id="kobo.344.1">Chapter 4</span></em><span class="kobospan" id="kobo.345.1">, this is something that should be avoided as much as possible, and I have used the </span><code class="inlinecode"><span class="kobospan" id="kobo.346.1">readFileSync</span></code><span class="kobospan" id="kobo.347.1"> function only for the sake of simplicity.</span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.348.1">Listing 10.8: Using template features in the basic.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.349.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    </span><strong class="screentext"><span class="kobospan" id="kobo.350.1">&lt;head&gt;{{ @style("bootstrap.min.css") }}&lt;/head&gt;</span></strong><span class="kobospan" id="kobo.351.1">
    &lt;body&gt;
        </span><strong class="screentext"><span class="kobospan" id="kobo.352.1">{{ @partial("message") }}</span></strong><span class="kobospan" id="kobo.353.1">
        &lt;h3 class="m-2"&gt;Message: {{ message }}&lt;/h3&gt;
        &lt;h3 class="m-2"&gt;Lower: {{ message.toLowerCase() }}&lt;/h3&gt;
        &lt;h3 class="m-2"&gt;Count: {{ 2 * 3 }}&lt;/h3&gt;
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.354.1">The new features are accessed with a </span><code class="inlinecode"><span class="kobospan" id="kobo.355.1">@</span></code><span class="kobospan" id="kobo.356.1"> prefix, which makes them easy to find when parsing templates. </span><span class="kobospan" id="kobo.356.2">In </span><em class="italic"><span class="kobospan" id="kobo.357.1">Listing 10.8</span></em><span class="kobospan" id="kobo.358.1">, the </span><code class="inlinecode"><span class="kobospan" id="kobo.359.1">@style</span></code><span class="kobospan" id="kobo.360.1"> expression will invoke the </span><code class="inlinecode"><span class="kobospan" id="kobo.361.1">style</span></code><span class="kobospan" id="kobo.362.1"> function to create a </span><code class="inlinecode"><span class="kobospan" id="kobo.363.1">link</span></code><span class="kobospan" id="kobo.364.1"> element for the Bootstrap CSS file, and the </span><code class="inlinecode"><span class="kobospan" id="kobo.365.1">@partial</span></code><span class="kobospan" id="kobo.366.1"> expression</span><a id="_idIndexMarker489" class="calibre3"/><span class="kobospan" id="kobo.367.1"> will invoke the </span><code class="inlinecode"><span class="kobospan" id="kobo.368.1">partial</span></code><span class="kobospan" id="kobo.369.1"> function to load a template named </span><code class="inlinecode"><span class="kobospan" id="kobo.370.1">message</span></code><span class="kobospan" id="kobo.371.1">. </span><span class="kobospan" id="kobo.371.2">To create the template – known as a </span><em class="italic"><span class="kobospan" id="kobo.372.1">partial template</span></em><span class="kobospan" id="kobo.373.1"> – that will be loaded by the </span><code class="inlinecode"><span class="kobospan" id="kobo.374.1">@partial</span></code><span class="kobospan" id="kobo.375.1"> expression, create a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.376.1">message.custom</span></code><span class="kobospan" id="kobo.377.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.378.1">templates/server</span></code><span class="kobospan" id="kobo.379.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.380.1">Listing 10.9</span></em><span class="kobospan" id="kobo.381.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.382.1">Listing 10.9: The contents of the message.custom in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.383.1">&lt;div class="bg-primary text-white m-2 p-2"&gt;
    {{ message }}
&lt;/div&gt;
</span></code></pre>
<h3 class="heading2" id="_idParaDest-182"><span class="kobospan" id="kobo.384.1">Mapping expressions to features</span></h3>
<p class="normal1"><span class="kobospan" id="kobo.385.1">All that </span><a id="_idIndexMarker490" class="calibre3"/><span class="kobospan" id="kobo.386.1">remains is translating the </span><code class="inlinecode"><span class="kobospan" id="kobo.387.1">@</span></code><span class="kobospan" id="kobo.388.1"> expressions in the template to JavaScript statements that invoke the functions from </span><em class="italic"><span class="kobospan" id="kobo.389.1">Listing 10.7</span></em><span class="kobospan" id="kobo.390.1">. </span><span class="kobospan" id="kobo.390.2">Take the following expression:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.391.1">...
</span><span class="kobospan" id="kobo.391.2">{{ @partial("message") }}
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.392.1">The preceding expression will be translated into the following:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.393.1">...
</span><span class="kobospan" id="kobo.393.2">features.partial("message", context);
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.394.1">Once the translation is complete, the result can be evaluated just like any other expression. </span><em class="italic"><span class="kobospan" id="kobo.395.1">Listing 10.10</span></em><span class="kobospan" id="kobo.396.1"> changes the template engine to support the new features.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.397.1">Listing 10.10: Supporting template features in the custom_engine.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.398.1">import { readFile } from "fs";
import { Express } from "express";
</span><strong class="screentext"><span class="kobospan" id="kobo.399.1">import * as features from "./custom_features";</span></strong><span class="kobospan" id="kobo.400.1">
const renderTemplate = (path: string, context: any,
    callback: (err: any, response: string | undefined) =&gt; void) =&gt; {
    readFile(path, (err, data) =&gt; {
        if (err != undefined) {
            callback("Cannot generate content", undefined);
        } else {
            </span><strong class="screentext"><span class="kobospan" id="kobo.401.1">callback(</span></strong><strong class="screentext"><span class="kobospan" id="kobo.402.1">undefined, parseTemplate(data.toString(),</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.403.1">                { ...context, features }));</span></strong><span class="kobospan" id="kobo.404.1">
        }
    });
};
const parseTemplate = (template: string, context: any) =&gt; {
    const ctx = Object.keys(context)
        .map((k) =&gt; `const ${k} = context.${k}`)
        .join(";");
    const expr = /{{(.*)}}/gm;
    return template.toString().replaceAll(expr, (match, group) =&gt; {
        </span><strong class="screentext"><span class="kobospan" id="kobo.405.1">const evalFunc= (expr: string) =&gt; {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.406.1">            return eval(</span></strong><strong class="screentext"><span class="kobospan" id="kobo.407.1">`${ctx};${expr}`)</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.408.1">        }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.409.1">        try {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.410.1">            if (group.trim()[0] === "@") {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.411.1">                group = `features.${group.trim().substring(1)}</span></strong><strong class="screentext"><span class="kobospan" id="kobo.412.1">`;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.413.1">                group = group.replace(/\)$/m, ", context, evalFunc)");</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.414.1">            }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.415.1">            let result = evalFunc(group);</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.416.1">            if (expr.test(result)) {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.417.1">                result = parseTemplate(result, context);</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.418.1">            }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.419.1">            return result;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.420.1">        } catch (</span></strong><strong class="screentext"><span class="kobospan" id="kobo.421.1">err: any) {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.422.1">            return err;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.423.1">        }</span></strong><span class="kobospan" id="kobo.424.1">
    });
}
export const registerCustomTemplateEngine = (expressApp: Express) =&gt;
    expressApp.engine("custom", renderTemplate);
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.425.1">The functions defined in </span><em class="italic"><span class="kobospan" id="kobo.426.1">Listing 10.7</span></em><span class="kobospan" id="kobo.427.1"> are imported and assigned the </span><code class="inlinecode"><span class="kobospan" id="kobo.428.1">features</span></code><span class="kobospan" id="kobo.429.1"> prefix. </span><span class="kobospan" id="kobo.429.2">String manipulation performs the translation from the </span><code class="inlinecode"><span class="kobospan" id="kobo.430.1">@</span></code><span class="kobospan" id="kobo.431.1"> expression to the function name, with the addition of the </span><code class="inlinecode"><span class="kobospan" id="kobo.432.1">context</span></code><span class="kobospan" id="kobo.433.1"> property and an </span><code class="inlinecode"><span class="kobospan" id="kobo.434.1">eval</span></code><span class="kobospan" id="kobo.435.1"> function. </span><span class="kobospan" id="kobo.435.2">This</span><a id="_idIndexMarker491" class="calibre3"/><span class="kobospan" id="kobo.436.1"> allows expressions to access the context object, the settings it includes, and the ability to evaluate expressions with the context. </span><span class="kobospan" id="kobo.436.2">The result from a </span><code class="inlinecode"><span class="kobospan" id="kobo.437.1">@</span></code><span class="kobospan" id="kobo.438.1"> feature may contain other template expressions; therefore, the regular expression is used to recursively parse the result.</span></p>
<p class="normal"><span class="kobospan" id="kobo.439.1">Use a browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.440.1">http://localhost:5000/dynamic/basic</span></code><span class="kobospan" id="kobo.441.1"> and you will see the output produced by the new features, as shown in </span><em class="italic"><span class="kobospan" id="kobo.442.1">Figure 10.5</span></em><span class="kobospan" id="kobo.443.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.444.1"><img alt="" src="../Images/B21959_10_05.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.445.1">Figure 10.5: Adding template features</span></p>
<h2 class="heading1" id="_idParaDest-183"><span class="kobospan" id="kobo.446.1">Using templates to create a simple round-trip application</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.447.1">The</span><a id="_idIndexMarker492" class="calibre3"/><span class="kobospan" id="kobo.448.1"> template engine is simple, but it has just enough functionality to create a basic application that alters the HTML it displays based on user interaction, which is the key function of any web application. </span><span class="kobospan" id="kobo.448.2">To demonstrate, I am going to present the user with a button that increments a counter, where the value of the counter will result in different content being presented to the user. </span><span class="kobospan" id="kobo.448.3">This is an example of a </span><em class="italic"><span class="kobospan" id="kobo.449.1">round-trip application</span></em><span class="kobospan" id="kobo.450.1">, where each interaction requires an HTTP request to the server to get a new HTML document to display to the user.</span></p>
<p class="normal"><span class="kobospan" id="kobo.451.1">The</span><a id="_idIndexMarker493" class="calibre3"/><span class="kobospan" id="kobo.452.1"> first step is to add the object that represents the HTTP request to the context data given to the custom template engine, as shown in </span><em class="italic"><span class="kobospan" id="kobo.453.1">Listing 10.11</span></em><span class="kobospan" id="kobo.454.1">. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.455.1">Listing 10.11: Adding to the context data in the server.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.456.1">...
</span><span class="kobospan" id="kobo.456.2">expressApp.get("/dynamic/:file", (req, resp) =&gt; {
   </span><strong class="screentext"><span class="kobospan" id="kobo.457.1"> resp.render(`${req.params.file}.custom`, {</span></strong>
<strong class="screentext"> </strong><strong class="screentext"><span class="kobospan" id="kobo.458.1">message: "Hello template", req</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.459.1">    });</span></strong><span class="kobospan" id="kobo.460.1">
});
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.461.1">Next, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.462.1">counter.custom</span></code><span class="kobospan" id="kobo.463.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.464.1">templates/server</span></code><span class="kobospan" id="kobo.465.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.466.1">Listing 10.12</span></em><span class="kobospan" id="kobo.467.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.468.1">Listing 10.12: The contents of the counter.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.469.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;{{ @style("bootstrap.min.css") }}&lt;/head&gt;
    &lt;body&gt;
        &lt;a class="btn btn-primary m-2"
            href="/dynamic/counter?c={{ Number(req.query.c ?? </span><span class="kobospan" id="kobo.469.2">0) + 1}}"&gt;
                Increment
        &lt;/a&gt;
        &lt;div&gt;
            {{ @conditional("(req.query.c ?? </span><span class="kobospan" id="kobo.469.3">0) % 2", "odd", "even") }}       
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.470.1">This template contains an anchor element (the </span><code class="inlinecode"><span class="kobospan" id="kobo.471.1">a</span></code><span class="kobospan" id="kobo.472.1"> tag) that, when clicked, requests a new HTML document from the backend server using a URL that contains a query string parameter named </span><code class="inlinecode"><span class="kobospan" id="kobo.473.1">c</span></code><span class="kobospan" id="kobo.474.1">. </span><span class="kobospan" id="kobo.474.2">The value of </span><code class="inlinecode"><span class="kobospan" id="kobo.475.1">c</span></code><span class="kobospan" id="kobo.476.1"> included in the request URL is always one more than the value displayed to the user, such that clicking the button has the effect of incrementing the counter.</span></p>
<p class="normal"><span class="kobospan" id="kobo.477.1">The template contains a </span><code class="inlinecode"><span class="kobospan" id="kobo.478.1">@conditional</span></code><span class="kobospan" id="kobo.479.1"> expression, which will be used to render different partial templates for odd and even values of </span><code class="inlinecode"><span class="kobospan" id="kobo.480.1">c</span></code><span class="kobospan" id="kobo.481.1">. </span><span class="kobospan" id="kobo.481.2">The arguments to </span><code class="inlinecode"><span class="kobospan" id="kobo.482.1">@conditional</span></code><span class="kobospan" id="kobo.483.1"> are an expression to be evaluated and two partial template </span><a id="_idIndexMarker494" class="calibre3"/><span class="kobospan" id="kobo.484.1">names that will be used for </span><code class="inlinecode"><span class="kobospan" id="kobo.485.1">true</span></code><span class="kobospan" id="kobo.486.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.487.1">false</span></code><span class="kobospan" id="kobo.488.1"> results when the expression is evaluated.</span></p>
<p class="normal"><span class="kobospan" id="kobo.489.1">To create the partial template that will be used for odd values, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.490.1">odd.custom</span></code><span class="kobospan" id="kobo.491.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.492.1">templates/server</span></code><span class="kobospan" id="kobo.493.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.494.1">Listing 10.13</span></em><span class="kobospan" id="kobo.495.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.496.1">Listing 10.13: The content of the odd.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.497.1">&lt;h4 class="bg-primary text-white m-2 p-2"&gt;
    Odd value: {{ req.query.c ?? </span><span class="kobospan" id="kobo.497.2">0}}
&lt;/h4&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.498.1">To create the partial template that will be used for even values, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.499.1">even.custom</span></code><span class="kobospan" id="kobo.500.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.501.1">templates/server</span></code><span class="kobospan" id="kobo.502.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.503.1">Listing 10.14</span></em><span class="kobospan" id="kobo.504.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.505.1">Listing 10.14: The contents of the even.custom file in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.506.1">&lt;h4 class="bg-secondary text-white m-2 p-2"&gt;
    Even value: {{ req.query.c ?? </span><span class="kobospan" id="kobo.506.2">0}}
&lt;/h4&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.507.1">The remaining step is to implement the </span><code class="inlinecode"><span class="kobospan" id="kobo.508.1">@conditional</span></code><span class="kobospan" id="kobo.509.1"> expression as a template feature, as shown in </span><em class="italic"><span class="kobospan" id="kobo.510.1">Listing 10.15</span></em><span class="kobospan" id="kobo.511.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.512.1">Listing 10.15: Adding a conditional feature in the custom_features.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.513.1">import { readFileSync } from "fs";
export const style = (stylesheet: string) =&gt; {
    return `&lt;link href="/css/${stylesheet}" rel="stylesheet" /&gt;`;
}
export const partial = (file: string, context: any) =&gt; {
    const path = `./${context.settings.views}/${file}.custom`;
    return readFileSync(path, "utf-8");
}
</span><strong class="screentext"><span class="kobospan" id="kobo.514.1">export const conditional = (expression: string,</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.515.1">        trueFile: string, falseFile: string, context: any,</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.516.1">        evalFunc: (expr: string) =&gt; any) =&gt; {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.517.1">    return partial(evalFunc(expression) ? </span><span class="kobospan" id="kobo.517.2">trueFile : falseFile, context);</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.518.1">}</span></strong>
</code></pre>
<p class="normal"><span class="kobospan" id="kobo.519.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.520.1">conditional</span></code><span class="kobospan" id="kobo.521.1"> function accepts an expression, two file paths, a context object, and a function used to evaluate expressions. </span><span class="kobospan" id="kobo.521.2">The expression is evaluated, and the result is passed to the </span><code class="inlinecode"><span class="kobospan" id="kobo.522.1">partial</span></code><span class="kobospan" id="kobo.523.1"> function, effectively selecting a </span><a id="_idIndexMarker495" class="calibre3"/><span class="kobospan" id="kobo.524.1">partial view based on whether the expression has evaluated to </span><code class="inlinecode"><span class="kobospan" id="kobo.525.1">true</span></code><span class="kobospan" id="kobo.526.1"> or </span><code class="inlinecode"><span class="kobospan" id="kobo.527.1">false</span></code><span class="kobospan" id="kobo.528.1">.</span></p>
<p class="normal"><span class="kobospan" id="kobo.529.1">Use a browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.530.1">http://localhost:5000/dynamic/counter</span></code><span class="kobospan" id="kobo.531.1"> and click the </span><strong class="screentext"><span class="kobospan" id="kobo.532.1">Increment</span></strong><span class="kobospan" id="kobo.533.1"> button. </span><span class="kobospan" id="kobo.533.2">Each click causes the browser to request a URL like </span><code class="inlinecode"><span class="kobospan" id="kobo.534.1">http://localhost:5000/dynamic/counter?c=1</span></code><span class="kobospan" id="kobo.535.1"> and the value of </span><code class="inlinecode"><span class="kobospan" id="kobo.536.1">c</span></code><span class="kobospan" id="kobo.537.1"> is used to select the HTML content in the response, as shown in </span><em class="italic"><span class="kobospan" id="kobo.538.1">Figure 10.6</span></em><span class="kobospan" id="kobo.539.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.540.1"><img alt="" src="../Images/Image10809.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.541.1">Figure 10.6: Using templates to create a simple round-trip application</span></p>
<h1 class="heading" id="_idParaDest-184"><span class="kobospan" id="kobo.542.1">Using client-side HTML templates</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.543.1">One drawback </span><a id="_idIndexMarker496" class="calibre3"/><span class="kobospan" id="kobo.544.1">of the previous example is that a completely new HTML document is generated and sent to the browser every</span><a id="_idIndexMarker497" class="calibre3"/><span class="kobospan" id="kobo.545.1"> time </span><code class="inlinecode"><span class="kobospan" id="kobo.546.1">Increment</span></code><span class="kobospan" id="kobo.547.1"> is clicked, even though only one section of the HTML changes. </span></p>
<p class="normal"><em class="italic"><span class="kobospan" id="kobo.548.1">Client-side HTML templates </span></em><span class="kobospan" id="kobo.549.1">perform the same task as their server-side counterparts, but the template is parsed by JavaScript code running in the browser. </span><span class="kobospan" id="kobo.549.2">This allows a targeted approach, where selected elements are modified, which can be more responsive than waiting for a new HTML document. </span><span class="kobospan" id="kobo.549.3">This is the basis for </span><strong class="screentext"><span class="kobospan" id="kobo.550.1">single-page applications</span></strong><span class="kobospan" id="kobo.551.1"> (</span><strong class="screentext"><span class="kobospan" id="kobo.552.1">SPAs</span></strong><span class="kobospan" id="kobo.553.1">), where a single HTML document is delivered to the client and then modified by JavaScript code. </span></p>
<p class="normal"><span class="kobospan" id="kobo.554.1">The main difficulty with client-side templates is that they have to be written entirely in JavaScript, which can make it awkward to express HTML content in a way that is easy to read and maintain.</span></p>
<p class="normal"><span class="kobospan" id="kobo.555.1">The most </span><a id="_idIndexMarker498" class="calibre3"/><span class="kobospan" id="kobo.556.1">popular client-side frameworks, such as React and Angular, use client-side template formats that are easier to read than pure JavaScript, but they use a compiler to transform the template into a JavaScript function so that it can be added to the JavaScript bundle given to the browser.</span></p>
<p class="normal"><span class="kobospan" id="kobo.557.1">The templates used by the big frameworks have other benefits, such as making it easy to combine templates to create complex content and ensuring that updates to HTML elements are performed as efficiently as possible.</span></p>
<p class="normal"><span class="kobospan" id="kobo.558.1">But, leaving aside these features, the process of generating content at the client is similar to doing so at the server. </span><span class="kobospan" id="kobo.558.2">A good way to understand the issues involved in client-side templating is to recreate the counter example from the previous section using client-side JavaScript. </span><span class="kobospan" id="kobo.558.3">To start, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.559.1">counter_custom.js</span></code><span class="kobospan" id="kobo.560.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.561.1">src/client</span></code><span class="kobospan" id="kobo.562.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.563.1">Listing 10.16</span></em><span class="kobospan" id="kobo.564.1">.</span></p>
<div class="note">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.565.1">Client-side versus server-side templates</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.566.1">Most web application projects tend to mix both server-side and client-side templates because each type of template solves a different problem.</span></p>
<p class="normal"><span class="kobospan" id="kobo.567.1">Server-side templates require an HTTP connection for every HTML document, which can impact performance. </span><span class="kobospan" id="kobo.567.2">However, the performance deficit can be offset by how fast the browser can display the contents of the HTML document once it has been received.</span></p>
<p class="normal"><span class="kobospan" id="kobo.568.1">Client-side templates respond to changes more efficiently and without the need to make additional HTTP requests, but this advantage can be undermined by the need to transfer the JavaScript code and the state data in the first place. </span><span class="kobospan" id="kobo.568.2">When a framework like React or Angular is used, the JavaScript for the framework must also be transferred, and this can be a barrier in regions where less capable devices and unreliable networks are common.</span></p>
<p class="normal"><span class="kobospan" id="kobo.569.1">To bridge the gap and give the best of both worlds, some frameworks offer </span><strong class="screentext"><span class="kobospan" id="kobo.570.1">server-side rendering</span></strong><span class="kobospan" id="kobo.571.1"> (</span><strong class="screentext"><span class="kobospan" id="kobo.572.1">SSR</span></strong><span class="kobospan" id="kobo.573.1">), where templates are rendered at the server to create a round-trip version of the application, which can be displayed quickly by the browser. </span><span class="kobospan" id="kobo.573.2">Once the server-rendered content is displayed, the browser requests JavaScript code and transitions to a single-page application. </span><span class="kobospan" id="kobo.573.3">SSR has improved in recent years, but it is still clunky and doesn’t suit all projects.</span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.574.1">Listing 10.16: The contents of the counter_custom.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.575.1">import { Odd } from "./odd_custom";
import { Even } from "./even_custom";
export const Counter = (context) =&gt; `
    &lt;button class="btn btn-primary m-2" action="incrementCounter"&gt;
        Increment
    &lt;/button&gt;
    &lt;div&gt;
        ${ context.counter % 2 ? </span><span class="kobospan" id="kobo.575.2">Odd(context) : Even(context) }
    &lt;/div&gt;`
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.576.1">The templates</span><a id="_idIndexMarker499" class="calibre3"/><span class="kobospan" id="kobo.577.1"> in this example are JavaScript functions that return HTML strings, which is the simplest way to create a client-side template and it doesn’t require a compiler. </span><span class="kobospan" id="kobo.577.2">The JavaScript template functions will receive a </span><code class="inlinecode"><span class="kobospan" id="kobo.578.1">context</span></code><span class="kobospan" id="kobo.579.1"> parameter that contains the current application state.</span></p>
<p class="normal"><span class="kobospan" id="kobo.580.1">The JavaScript string features make it easy to insert data values into HTML strings. </span><span class="kobospan" id="kobo.580.2">In this case, the value of the </span><code class="inlinecode"><span class="kobospan" id="kobo.581.1">counter</span></code><span class="kobospan" id="kobo.582.1"> property on the </span><code class="inlinecode"><span class="kobospan" id="kobo.583.1">context</span></code><span class="kobospan" id="kobo.584.1"> object received by the function is used to choose between the </span><code class="inlinecode"><span class="kobospan" id="kobo.585.1">Odd</span></code><span class="kobospan" id="kobo.586.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.587.1">Even</span></code><span class="kobospan" id="kobo.588.1"> functions, which is a simpler approach than the equivalent functionality in the server-side template example.</span></p>
<p class="normal"><span class="kobospan" id="kobo.589.1">One problem with this approach is that handling events from elements can be difficult. </span><span class="kobospan" id="kobo.589.2">Not only does the example application’s content security policy prevent inline event handlers, but it can be difficult to define handler functions that use context data in HTML strings.</span></p>
<p class="normal"><span class="kobospan" id="kobo.590.1">To work around this limitation, I have added an </span><code class="inlinecode"><span class="kobospan" id="kobo.591.1">action</span></code><span class="kobospan" id="kobo.592.1"> attribute to the </span><code class="inlinecode"><span class="kobospan" id="kobo.593.1">button</span></code><span class="kobospan" id="kobo.594.1"> element in </span><em class="italic"><span class="kobospan" id="kobo.595.1">Listing 10.16</span></em><span class="kobospan" id="kobo.596.1">, which is assigned the value </span><code class="inlinecode"><span class="kobospan" id="kobo.597.1">incrementCounter</span></code><span class="kobospan" id="kobo.598.1">. </span><span class="kobospan" id="kobo.598.2">Events from the button will be allowed to propagate up the HTML document and I’ll use the </span><a id="_idIndexMarker500" class="calibre3"/><span class="kobospan" id="kobo.599.1">value of the </span><code class="inlinecode"><span class="kobospan" id="kobo.600.1">action</span></code><span class="kobospan" id="kobo.601.1"> attribute to decide how to respond.</span></p>
<p class="normal"><span class="kobospan" id="kobo.602.1">To create the partial view that will display even values, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.603.1">even_custom.js</span></code><span class="kobospan" id="kobo.604.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.605.1">src/client</span></code><span class="kobospan" id="kobo.606.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.607.1">Listing 10.17</span></em><span class="kobospan" id="kobo.608.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.609.1">Listing 10.17: The contents of the even_custom.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.610.1">export const Even = (context) =&gt; `
    &lt;h4 class="bg-secondary text-white m-2 p-2"&gt;
        Even value: ${ context.counter }
    &lt;/h4&gt;`
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.611.1">The HTML string returned by this function includes the value of the </span><code class="inlinecode"><span class="kobospan" id="kobo.612.1">counter.couter</span></code><span class="kobospan" id="kobo.613.1"> property. </span><span class="kobospan" id="kobo.613.2">To create the template for odd values, create a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.614.1">odd_custom.js</span></code><span class="kobospan" id="kobo.615.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.616.1">src/client</span></code><span class="kobospan" id="kobo.617.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.618.1">Listing 10.18</span></em><span class="kobospan" id="kobo.619.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.620.1">Listing 10.18: The contents of the odd_custom.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.621.1">export const Odd = (context) =&gt; `
    &lt;h4 class="bg-primary text-white m-2 p-2"&gt;
        Odd value: ${ context.counter }
    &lt;/h4&gt;`
</span></code></pre>
<p class="normal"><em class="italic"><span class="kobospan" id="kobo.622.1">Listing 10.19</span></em><span class="kobospan" id="kobo.623.1"> replaces the code in the </span><code class="inlinecode"><span class="kobospan" id="kobo.624.1">client.js</span></code><span class="kobospan" id="kobo.625.1"> file to use the new template functions and define the features they require.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.626.1">Listing 10.19: Replacing the contents of the client.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.627.1">import { Counter } from "./counter_custom";
const context = {
    counter: 0
}
const actions = {
    incrementCounter: () =&gt; {
        context.counter++; render();
    }
}
const render = () =&gt; {
    document.getElementById("target").innerHTML = Counter(context);
}
document.addEventListener('DOMContentLoaded', () =&gt; {
    document.onclick = (ev) =&gt; {
        const action = ev.target.getAttribute("action")
        if (action &amp;&amp; actions[action]) {
            actions[action]()
        }
    }
    render();
});
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.628.1">When</span><a id="_idIndexMarker501" class="calibre3"/><span class="kobospan" id="kobo.629.1"> the </span><code class="inlinecode"><span class="kobospan" id="kobo.630.1">DOMContentLoaded</span></code><span class="kobospan" id="kobo.631.1"> event is emitted, which indicates the browser has finished parsing the HTML document, an event listener is created for </span><code class="inlinecode"><span class="kobospan" id="kobo.632.1">click</span></code><span class="kobospan" id="kobo.633.1"> events, and the </span><code class="inlinecode"><span class="kobospan" id="kobo.634.1">render</span></code><span class="kobospan" id="kobo.635.1"> function is invoked. </span></p>
<p class="normal"><span class="kobospan" id="kobo.636.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.637.1">render</span></code><span class="kobospan" id="kobo.638.1"> function invokes the </span><code class="inlinecode"><span class="kobospan" id="kobo.639.1">Counter</span></code><span class="kobospan" id="kobo.640.1"> template function and uses the HTML string it receives to set the content of an HTML element whose </span><code class="inlinecode"><span class="kobospan" id="kobo.641.1">id</span></code><span class="kobospan" id="kobo.642.1"> is </span><code class="inlinecode"><span class="kobospan" id="kobo.643.1">target</span></code><span class="kobospan" id="kobo.644.1">. </span><span class="kobospan" id="kobo.644.2">When a </span><code class="inlinecode"><span class="kobospan" id="kobo.645.1">click</span></code><span class="kobospan" id="kobo.646.1"> event is received, the target for the event is checked for an </span><code class="inlinecode"><span class="kobospan" id="kobo.647.1">action</span></code><span class="kobospan" id="kobo.648.1"> attribute, and its value is used to select a function to execute from the </span><code class="inlinecode"><span class="kobospan" id="kobo.649.1">actions</span></code><span class="kobospan" id="kobo.650.1"> object. </span><span class="kobospan" id="kobo.650.2">There is one action in the example, which increments the </span><code class="inlinecode"><span class="kobospan" id="kobo.651.1">counter</span></code><span class="kobospan" id="kobo.652.1"> property of the </span><code class="inlinecode"><span class="kobospan" id="kobo.653.1">context</span></code><span class="kobospan" id="kobo.654.1"> object and calls the </span><code class="inlinecode"><span class="kobospan" id="kobo.655.1">render</span></code><span class="kobospan" id="kobo.656.1"> function to update the content presented to the user.</span></p>
<p class="normal"><span class="kobospan" id="kobo.657.1">The final step is to remove the existing content from the static HTML document and create the element that will be populated with the client-side template content, as shown in </span><em class="italic"><span class="kobospan" id="kobo.658.1">Listing 10.20</span></em><span class="kobospan" id="kobo.659.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.660.1">Listing 10.20: Preparing the HTML document in the index.html file in the static folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.661.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;script src="/bundle.js"&gt;&lt;/script&gt;
        &lt;link href="css/bootstrap.min.css" rel="stylesheet" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        </span><strong class="screentext"><span class="kobospan" id="kobo.662.1">&lt;div id="target"&gt;&lt;/div&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.663.1">        &lt;!-- &lt;button id="btn" class="btn btn-primary m-2"&gt;Send Request&lt;/button&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.664.1">        &lt;table class="table table-striped"&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.665.1">            &lt;tbody&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.666.1">                &lt;tr&gt;&lt;th&gt;Status&lt;/th&gt;&lt;td id="msg"&gt;&lt;/td&gt;&lt;/tr&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.667.1">                &lt;tr&gt;&lt;th&gt;Response&lt;/th&gt;&lt;td id="body"&gt;&lt;/td&gt;&lt;/tr&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.668.1">            &lt;/tbody&gt;</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.669.1">       &lt;/table&gt; --&gt;</span></strong><span class="kobospan" id="kobo.670.1">
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.671.1">Use a </span><a id="_idIndexMarker502" class="calibre3"/><span class="kobospan" id="kobo.672.1">browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.673.1">http://localhost:5000</span></code><span class="kobospan" id="kobo.674.1"> and you will be presented with the same content produced by the server-side templates. </span><span class="kobospan" id="kobo.674.2">The difference is that when the </span><strong class="screentext"><span class="kobospan" id="kobo.675.1">Increment</span></strong><span class="kobospan" id="kobo.676.1"> button is clicked, the state change is handled by rendering the client-side templates, as shown in </span><em class="italic"><span class="kobospan" id="kobo.677.1">Figure 10.7</span></em><span class="kobospan" id="kobo.678.1">, without the need to request a new HTML document from the backend server.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.679.1"><img alt="" src="../Images/Image10818.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.680.1">Figure 10.7: Using simple client-side templates</span></p>
<h1 class="heading" id="_idParaDest-185"><span class="kobospan" id="kobo.681.1">Using a template package</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.682.1">The</span><a id="_idIndexMarker503" class="calibre3"/><span class="kobospan" id="kobo.683.1"> examples so far in this chapter have demonstrated how templates can be used to render content and show how some basic features can be easily created. </span><span class="kobospan" id="kobo.683.2">For real projects, it makes more sense to adopt one of the excellent template packages available for JavaScript. </span><span class="kobospan" id="kobo.683.3">Run the commands shown in </span><em class="italic"><span class="kobospan" id="kobo.684.1">Listing 10.21</span></em><span class="kobospan" id="kobo.685.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.686.1">part2app</span></code><span class="kobospan" id="kobo.687.1"> folder to install one of the most widely used template packages, which is named Handlebars, and a package that integrates it into Express. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.688.1">Listing 10.21: Installing a template package</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.689.1">npm install handlebars@4.7.8
npm install express-handlebars@7.1.2
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.690.1">There are </span><a id="_idIndexMarker504" class="calibre3"/><span class="kobospan" id="kobo.691.1">many template packages available, and they all offer similar features. </span><span class="kobospan" id="kobo.691.2">The main difference between packages is the way that templates are written and how expressions are denoted. </span><span class="kobospan" id="kobo.691.3">The </span><code class="inlinecode"><span class="kobospan" id="kobo.692.1">{{</span></code><span class="kobospan" id="kobo.693.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.694.1">}}</span></code><span class="kobospan" id="kobo.695.1"> characters are a common way to denote expressions, and they are known as mustache templates because the curly braces are reminiscent of a mustache. </span><span class="kobospan" id="kobo.695.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.696.1">Handlebars</span></code><span class="kobospan" id="kobo.697.1"> package (</span><a href="https://handlebarsjs.com" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.698.1">https://handlebarsjs.com</span></span></a><span class="kobospan" id="kobo.699.1">) uses this style of expression, as</span><a id="_idIndexMarker505" class="calibre3"/><span class="kobospan" id="kobo.700.1"> its name suggests. </span><span class="kobospan" id="kobo.700.2">This is the style of JavaScript template I am used to, and familiarity goes a long way when picking a template package.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.701.1">Note</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.702.1">There are</span><a id="_idIndexMarker506" class="calibre3"/><span class="kobospan" id="kobo.703.1"> other options if you don’t like the mustache-style templates. </span><span class="kobospan" id="kobo.703.2">The Pug package (</span><a href="https://pugjs.org" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.704.1">https://pugjs.org</span></span></a><span class="kobospan" id="kobo.705.1">) relies on</span><a id="_idIndexMarker507" class="calibre3"/><span class="kobospan" id="kobo.706.1"> indentation to structure templates, which is a popular choice, and the </span><strong class="screentext"><span class="kobospan" id="kobo.707.1">Embedded JavaScript </span></strong><span class="kobospan" id="kobo.708.1">(</span><strong class="screentext"><span class="kobospan" id="kobo.709.1">EJS</span></strong><span class="kobospan" id="kobo.710.1">) (</span><a href="https://ejs.co" class="calibre3"><span class="calibre3"><span class="kobospan" id="kobo.711.1">https://ejs.co</span></span></a><span class="kobospan" id="kobo.712.1">) package uses </span><code class="inlinecode"><span class="kobospan" id="kobo.713.1">&lt;%</span></code><span class="kobospan" id="kobo.714.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.715.1">%&gt;</span></code><span class="kobospan" id="kobo.716.1"> sequences. </span><span class="kobospan" id="kobo.716.2">Stylistic preferences aside, all of these packages are well-written and have good levels of support.</span></p>
</div>
<h2 class="heading1" id="_idParaDest-186"><span class="kobospan" id="kobo.717.1">Using a package for server-side templates</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.718.1">Handlebars templates are </span><em class="italic"><span class="kobospan" id="kobo.719.1">logic free</span></em><span class="kobospan" id="kobo.720.1">, which means they cannot contain fragments</span><a id="_idIndexMarker508" class="calibre3"/><span class="kobospan" id="kobo.721.1"> of JavaScript that are evaluated to produce content. </span><span class="kobospan" id="kobo.721.2">Instead, helper functions are defined to implement the logic required to generate content. </span><span class="kobospan" id="kobo.721.3">Add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.722.1">template_helpers.ts</span></code><span class="kobospan" id="kobo.723.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.724.1">src/server</span></code><span class="kobospan" id="kobo.725.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.726.1">Listing 10.22</span></em><span class="kobospan" id="kobo.727.1">. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.728.1">Listing 10.22: The contents of the template_helpers.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.729.1">export const style = (stylesheet: any) =&gt; {
    return `&lt;link href="/css/${stylesheet}" rel="stylesheet" /&gt;`;
}
export const valueOrZero = (value: any) =&gt; {
    return value !== undefined ? </span><span class="kobospan" id="kobo.729.2">value : 0;
}
export const increment = (value: any) =&gt;  {
    return Number(valueOrZero(value)) + 1;
}
export const isOdd = (value: any) =&gt; {
    return Number(valueOrZero(value)) % 2;
}
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.730.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.731.1">style</span></code><span class="kobospan" id="kobo.732.1"> function </span><a id="_idIndexMarker509" class="calibre3"/><span class="kobospan" id="kobo.733.1">accepts the name of a stylesheet and generates a link element for it. </span><span class="kobospan" id="kobo.733.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.734.1">valueOrZero</span></code><span class="kobospan" id="kobo.735.1"> function checks to see whether a value is defined and, if it is not, returns zero. </span><span class="kobospan" id="kobo.735.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.736.1">increment</span></code><span class="kobospan" id="kobo.737.1"> function increments a value. </span><span class="kobospan" id="kobo.737.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.738.1">isOdd</span></code><span class="kobospan" id="kobo.739.1"> function returns </span><code class="inlinecode"><span class="kobospan" id="kobo.740.1">true</span></code><span class="kobospan" id="kobo.741.1"> if a value is odd.</span></p>
<h3 class="heading2" id="_idParaDest-187"><span class="kobospan" id="kobo.742.1">Defining the templates</span></h3>
<p class="normal1"><span class="kobospan" id="kobo.743.1">The </span><a id="_idIndexMarker510" class="calibre3"/><span class="kobospan" id="kobo.744.1">package that integrates Handlebars into Express supports </span><em class="italic"><span class="kobospan" id="kobo.745.1">layouts</span></em><span class="kobospan" id="kobo.746.1">, which are templates that contain the common elements that would otherwise be repeated in every template. </span><span class="kobospan" id="kobo.746.2">Create the </span><code class="inlinecode"><span class="kobospan" id="kobo.747.1">templates/server/layouts</span></code><span class="kobospan" id="kobo.748.1"> folder and add to it a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.749.1">main.handlebars</span></code><span class="kobospan" id="kobo.750.1"> with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.751.1">Listing 10.23</span></em><span class="kobospan" id="kobo.752.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.753.1">Listing 10.23: The contents of the main.handlebars file in the templates/server/layouts folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.754.1">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        {{{ style "bootstrap.min.css" }}}
    &lt;/head&gt;
    &lt;body&gt;
        {{{ body }}}
    &lt;/body&gt;
&lt;/html&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.755.1">There are two expressions in this layout. </span><span class="kobospan" id="kobo.755.2">The first invokes the </span><code class="inlinecode"><span class="kobospan" id="kobo.756.1">style</span></code><span class="kobospan" id="kobo.757.1"> helper function defined in </span><em class="italic"><span class="kobospan" id="kobo.758.1">Listing 10.22</span></em><span class="kobospan" id="kobo.759.1">, using the </span><code class="inlinecode"><span class="kobospan" id="kobo.760.1">bootstrap.min.css</span></code><span class="kobospan" id="kobo.761.1"> string as an argument (arguments for helpers are separated by spaces and not parentheses). </span><span class="kobospan" id="kobo.761.2">The other expression is </span><code class="inlinecode"><span class="kobospan" id="kobo.762.1">body</span></code><span class="kobospan" id="kobo.763.1">, into which the contents template that has been requested is inserted.</span></p>
<p class="normal"><span class="kobospan" id="kobo.764.1">The expressions</span><a id="_idIndexMarker511" class="calibre3"/><span class="kobospan" id="kobo.765.1"> in the layout are denoted with triple curly braces (</span><code class="inlinecode"><span class="kobospan" id="kobo.766.1">{{{</span></code><span class="kobospan" id="kobo.767.1"> and </span><code class="inlinecode"><span class="kobospan" id="kobo.768.1">}}}</span></code><span class="kobospan" id="kobo.769.1">), which tells Handlebars that the results should be inserted into the template without being escaped for HTML safety. </span><span class="kobospan" id="kobo.769.2">Care must be taken when dealing with data that has been received from users, and most template engines automatically format content so that it won’t be interpreted as HTML by the browser. </span><span class="kobospan" id="kobo.769.3">A sequence of three curly braces tells Handlebars that the result should be passed on without formatting, which is required when an expression is producing HTML.</span></p>
<p class="normal"><span class="kobospan" id="kobo.770.1">To create the main server-side template for the example project, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.771.1">counter.handlebars</span></code><span class="kobospan" id="kobo.772.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.773.1">templates/server</span></code><span class="kobospan" id="kobo.774.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.775.1">Listing 10.24</span></em><span class="kobospan" id="kobo.776.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.777.1">Listing 10.24: The contents of the counter.handlebars in the templates/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.778.1">&lt;a class="btn btn-primary m-2"
    href="/dynamic/counter?c={{ increment req.query.c }}"&gt;
        Increment
&lt;/a&gt;
{{#if (isOdd req.query.c) }}
    {{&gt; odd }}
{{else}}
    {{&gt; even }}
{{/if}}
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.779.1">This is the most complex template required by the example. </span><span class="kobospan" id="kobo.779.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.780.1">increment</span></code><span class="kobospan" id="kobo.781.1"> helper is used to create the URL that the browser will request when the anchor element is clicked:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.782.1">...
</span><span class="kobospan" id="kobo.782.2">href="/dynamic/counter?c=</span><strong class="screentext"><span class="kobospan" id="kobo.783.1">{{ increment req.query.c }}</span></strong><span class="kobospan" id="kobo.784.1">"&gt;
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.785.1">The double curly braces denote a template expression that can be formatted for HTML safety. </span><span class="kobospan" id="kobo.785.2">This expression invokes the </span><code class="inlinecode"><span class="kobospan" id="kobo.786.1">increment</span></code><span class="kobospan" id="kobo.787.1"> helper and uses the value of the query parameter as the argument. </span><span class="kobospan" id="kobo.787.2">The helper will increment the value it receives, and the result will be included in the value for the anchor element’s </span><code class="inlinecode"><span class="kobospan" id="kobo.788.1">href</span></code><span class="kobospan" id="kobo.789.1"> attribute.</span></p>
<p class="normal"><span class="kobospan" id="kobo.790.1">The other expressions are more complex. </span><span class="kobospan" id="kobo.790.2">First, there is an </span><code class="inlinecode"><span class="kobospan" id="kobo.791.1">if</span></code><span class="kobospan" id="kobo.792.1">/</span><code class="inlinecode"><span class="kobospan" id="kobo.793.1">else</span></code><span class="kobospan" id="kobo.794.1"> expression, like this:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.795.1">...
</span><strong class="screentext"><span class="kobospan" id="kobo.796.1">{{#if (isOdd req.query.c) }}</span></strong><span class="kobospan" id="kobo.797.1">
    {{&gt; odd }}
</span><strong class="screentext"><span class="kobospan" id="kobo.798.1">{{else}}</span></strong><span class="kobospan" id="kobo.799.1">
    {{&gt; even }}
</span><strong class="screentext"><span class="kobospan" id="kobo.800.1">{{/if}}</span></strong><span class="kobospan" id="kobo.801.1">
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.802.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.803.1">#if</span></code><span class="kobospan" id="kobo.804.1"> expression</span><a id="_idIndexMarker512" class="calibre3"/><span class="kobospan" id="kobo.805.1"> is evaluated, and the result is used to determine whether the content in the first or second block is included in the result. </span><span class="kobospan" id="kobo.805.2">In this example, the outcomes apply further template expressions:</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.806.1">...
</span><span class="kobospan" id="kobo.806.2">{{#if (isOdd req.query.c)}}
    </span><strong class="screentext"><span class="kobospan" id="kobo.807.1">{{&gt; odd }}</span></strong><span class="kobospan" id="kobo.808.1">
{{else}}
    </span><strong class="screentext"><span class="kobospan" id="kobo.809.1">{{&gt; even }}</span></strong><span class="kobospan" id="kobo.810.1">
{{/if}}
...
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.811.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.812.1">&gt;</span></code><span class="kobospan" id="kobo.813.1"> character tells the template engine to load a partial template. </span><span class="kobospan" id="kobo.813.2">If the </span><code class="inlinecode"><span class="kobospan" id="kobo.814.1">#if</span></code><span class="kobospan" id="kobo.815.1"> expression is </span><code class="inlinecode"><span class="kobospan" id="kobo.816.1">true</span></code><span class="kobospan" id="kobo.817.1">, then the </span><code class="inlinecode"><span class="kobospan" id="kobo.818.1">odd</span></code><span class="kobospan" id="kobo.819.1"> partial will be used, otherwise it will be the </span><code class="inlinecode"><span class="kobospan" id="kobo.820.1">even</span></code><span class="kobospan" id="kobo.821.1"> partial. </span><em class="italic"><span class="kobospan" id="kobo.822.1">Table 10.3</span></em><span class="kobospan" id="kobo.823.1"> describes the most useful template features. </span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.824.1">Note</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.825.1">You must not insert a space (or any other character) between the </span><code class="inlinecode"><span class="kobospan" id="kobo.826.1">{{</span></code><span class="kobospan" id="kobo.827.1"> sequence and the rest of the expression, otherwise the template engine will report an error. </span><span class="kobospan" id="kobo.827.2">So, </span><code class="inlinecode"><span class="kobospan" id="kobo.828.1">{{/if }}</span></code><span class="kobospan" id="kobo.829.1"> is OK but </span><code class="inlinecode"><span class="kobospan" id="kobo.830.1">{{ /if }}</span></code><span class="kobospan" id="kobo.831.1"> won’t work.</span></p>
</div>
<p class="packt_figref"><span class="kobospan" id="kobo.832.1">Table 10.3: Useful template features</span></p>
<table class="table-container" id="table003-7">
<tbody class="calibre8">
<tr class="calibre9">
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.833.1">Name</span></p>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.834.1">Description</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.835.1">{{#if val}}</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan3" id="kobo.836.1">Content will be included in the output if the value in the expression is </span><code class="inlinecode"><span class="kobospan2" id="kobo.837.1">true</span></code><span class="kobospan" id="kobo.838.1">. </span><span class="kobospan" id="kobo.838.2">There is also an </span><code class="inlinecode"><span class="kobospan2" id="kobo.839.1">
                {{else }}</span></code><span class="kobospan" id="kobo.840.1"> clause that can be used to create an </span><code class="inlinecode"><span class="kobospan2" id="kobo.841.1">if/then/else</span></code><span class="kobospan4" id="kobo.842.1"> effect.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.843.1">{{#unless val}}</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan3" id="kobo.844.1">Content will be included in the output if the value in the expression is </span><code class="inlinecode"><span class="kobospan2" id="kobo.845.1">false</span></code><span class="kobospan4" id="kobo.846.1">. </span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.847.1">{{&gt; partial }}</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan2" id="kobo.848.1">This expression inserts the specified partial template into the result.</span></p>
</td>
</tr>
<tr class="calibre9">
<td class="table-cell">
<pre class="programlisting2"><code class="hljs"><code class="inlinecode1"><span class="kobospan2" id="kobo.849.1">{{each arr }}</span></code>
</code></pre>
</td>
<td class="table-cell">
<p class="normal"><span class="kobospan3" id="kobo.850.1">This expression repeats a set of elements for each item in an array, as demonstrated in </span><em class="italic"><span class="kobospan2" id="kobo.851.1">Chapter 12</span></em><span class="kobospan4" id="kobo.852.1">.</span></p>
</td>
</tr>
</tbody>
</table>
<p class="normal"><span class="kobospan" id="kobo.853.1">To create the partial template for even values, create the </span><code class="inlinecode"><span class="kobospan" id="kobo.854.1">templates/server/partials</span></code><span class="kobospan" id="kobo.855.1"> folder and add to it a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.856.1">even.handlebars</span></code><span class="kobospan" id="kobo.857.1"> with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.858.1">Listing 10.25</span></em><span class="kobospan" id="kobo.859.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.860.1">Listing 10.25: The contents of the even.handlebars file in the templates/server/partials folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.861.1">&lt;h4 class="bg-secondary text-white m-2 p-2"&gt;
    Handlebars Even value: {{ valueOrZero req.query.c }}
&lt;/h4&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.862.1">The </span><a id="_idIndexMarker513" class="calibre3"/><span class="kobospan" id="kobo.863.1">partial template contains an expression that uses the </span><code class="inlinecode"><span class="kobospan" id="kobo.864.1">valueOrZero</span></code><span class="kobospan" id="kobo.865.1"> helper to display the </span><code class="inlinecode"><span class="kobospan" id="kobo.866.1">c</span></code><span class="kobospan" id="kobo.867.1"> value from the query string or zero if there is no value. </span><span class="kobospan" id="kobo.867.2">Add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.868.1">odd.handlebars</span></code><span class="kobospan" id="kobo.869.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.870.1">templates/server/partials</span></code><span class="kobospan" id="kobo.871.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.872.1">Listing 10.26</span></em><span class="kobospan" id="kobo.873.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.874.1">Listing 10.26: The contents of the odd.handlebars file in the templates/server/partial folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.875.1">&lt;h4 class="bg-primary text-white m-2 p-2"&gt;
    Handlebars Odd value: {{ valueOrZero req.query.c}}
&lt;/h4&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.876.1">There are other ways to recreate the example using Handlebars, which has some excellent features, but this approach most closely matches the custom engine that was created earlier. </span><span class="kobospan" id="kobo.876.2">The final step is to configure the application to use Handlebars, as shown in </span><em class="italic"><span class="kobospan" id="kobo.877.1">Listing 10.27</span></em><span class="kobospan" id="kobo.878.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.879.1">Listing 10.27: Setting up the template engine in the server.ts file in the src/server folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.880.1">import { createServer } from "http";
import express, {Express } from "express";
import { testHandler } from "./testHandler";
import httpProxy from "http-proxy";
import helmet from "helmet";
</span><strong class="screentext"><span class="kobospan" id="kobo.881.1">//import { registerCustomTemplateEngine } from "./custom_engine";</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.882.1">import { engine } from "express-handlebars";</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.883.1">import * as helpers from "./template_helpers"</span></strong><strong class="screentext"><span class="kobospan" id="kobo.884.1">;</span></strong><span class="kobospan" id="kobo.885.1">
const port = 5000;
const expressApp: Express = express();
const proxy = httpProxy.createProxyServer({
    target: "http://localhost:5100", ws: true
});
</span><strong class="screentext"><span class="kobospan" id="kobo.886.1">//registerCustomTemplateEngine(expressApp);</span></strong><span class="kobospan" id="kobo.887.1">
expressApp.set("views", "templates/server");
</span><strong class="screentext"><span class="kobospan" id="kobo.888.1">expressApp.engine("handlebars", engine</span></strong><strong class="screentext"><span class="kobospan" id="kobo.889.1">());</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.890.1">expressApp.set("view engine", "handlebars");</span></strong><span class="kobospan" id="kobo.891.1">
expressApp.use(helmet());
expressApp.use(express.json());
</span><strong class="screentext"><span class="kobospan" id="kobo.892.1">expressApp.get("/dynamic/:file"</span></strong><strong class="screentext"><span class="kobospan" id="kobo.893.1">, (req, resp) =&gt; {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.894.1">    resp.render(`${req.params.file}.handlebars`,</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.895.1">        { message: "Hello template", req,</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.896.1">            helpers: { ...helpers }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.897.1">        });</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.898.1">});</span></strong><span class="kobospan" id="kobo.899.1">
expressApp.post("/test", testHandler);
expressApp.use(express.static("static"));
expressApp.use(express.static("node_modules/bootstrap/dist"));
expressApp.use((req, resp) =&gt; proxy.web(req, resp));
const server = createServer(expressApp);
server.on('upgrade', (req, socket, head) =&gt; proxy.ws(req, socket, head));
server.listen(port,
    () =&gt; console.log(`HTTP Server listening on port ${port}`));
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.900.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.901.1">express-handlebars</span></code><span class="kobospan" id="kobo.902.1"> package is used to integrate the Handlebars template engine into Express. </span><span class="kobospan" id="kobo.902.2">One difference is that the help functions are added to the context</span><a id="_idIndexMarker514" class="calibre3"/><span class="kobospan" id="kobo.903.1"> object that is used to render the template, but otherwise, the configuration is similar to the custom engine.</span></p>
<div class="packt_tip">
<p class="normal"><strong class="screentext"><span class="kobospan" id="kobo.904.1">Note</span></strong></p>
<p class="normal"><span class="kobospan" id="kobo.905.1">The integration of Handlebars with Express provides support for providing extra data values, known as locals, outside of the call to the </span><code class="inlinecode"><span class="kobospan" id="kobo.906.1">render</span></code><span class="kobospan" id="kobo.907.1"> method. </span><em class="italic"><span class="kobospan" id="kobo.908.1">Chapter 15</span></em><span class="kobospan" id="kobo.909.1"> demonstrates the use of this feature to include authentication details in the template.</span></p>
</div>
<p class="normal"><span class="kobospan" id="kobo.910.1">Use a browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.911.1">http://localhost:5000/dynamic/counter</span></code><span class="kobospan" id="kobo.912.1"> and you will see the round-trip application but rendered by a real template package, with the addition of the word “Handlebars” in the partial templates to emphasize the change, as shown in </span><em class="italic"><span class="kobospan" id="kobo.913.1">Figure 10.8</span></em><span class="kobospan" id="kobo.914.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.915.1"><img alt="" src="../Images/Image11047.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.916.1">Figure 10.8: Using a package for server-side templates</span></p>
<h2 class="heading1" id="_idParaDest-188"><span class="kobospan" id="kobo.917.1">Using a package for client-side templates</span></h2>
<p class="normal1"><span class="kobospan" id="kobo.918.1">Many</span><a id="_idIndexMarker515" class="calibre3"/><span class="kobospan" id="kobo.919.1"> template packages can also be used in the browser to create client-side templating, but this requires wrapping templates in </span><code class="inlinecode"><span class="kobospan" id="kobo.920.1">script</span></code><span class="kobospan" id="kobo.921.1"> elements in the HTML documents sent to the browser, which is awkward to do. </span><span class="kobospan" id="kobo.921.2">For this reason, most template packages offer integrations with popular build tools and bundlers, such as webpack, that compile templates into JavaScript code. </span><span class="kobospan" id="kobo.921.3">Run the command shown in </span><em class="italic"><span class="kobospan" id="kobo.922.1">Listing 10.28</span></em><span class="kobospan" id="kobo.923.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.924.1">part2app</span></code><span class="kobospan" id="kobo.925.1"> folder to add a package that integrates Handlebars into webpack. </span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.926.1">Listing 10.28: Installing an integration package</span></p>
<pre class="programlisting1"><code class="hljs-con"><span class="kobospan" id="kobo.927.1">npm install --save-dev handlebars-loader@1.7.3
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.928.1">A change is </span><a id="_idIndexMarker516" class="calibre3"/><span class="kobospan" id="kobo.929.1">required to the webpack configuration file to add support for compiling Handlebars templates, as shown in </span><em class="italic"><span class="kobospan" id="kobo.930.1">Listing 10.29</span></em><span class="kobospan" id="kobo.931.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.932.1">Listing 10.29: Changing the configuration in the webpack.config.mjs file in the part2app folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.933.1">import path from "path";
import { fileURLToPath } from 'url';
const __dirname = path.dirname(fileURLToPath(import.meta.url));
export default  {
    mode: "development",
    entry: "./src/client/client.js",
    devtool: "source-map",   
    output: {
        path: path.resolve(__dirname, "dist/client"),
        filename: "bundle.js"
    },
    devServer: {
        static: ["./static"],        
        port: 5100,
        client: { webSocketURL: "http://localhost:5000/ws" }
    },
  </span><strong class="screentext"><span class="kobospan" id="kobo.934.1">  module: {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.935.1">        rules: [</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.936.1">            { test: /\.handlebars$/, loader: "handlebars-loader" }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.937.1">          ]</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.938.1">    },</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.939.1">    resolve: {</span></strong>
<strong class="screentext"> </strong><strong class="screentext"><span class="kobospan" id="kobo.940.1">alias: {</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.941.1">            "@templates": path.resolve(__dirname, "templates/client")</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.942.1">        }</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.943.1">    }</span></strong><span class="kobospan" id="kobo.944.1">
};
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.945.1">The </span><code class="inlinecode"><span class="kobospan" id="kobo.946.1">module</span></code><span class="kobospan" id="kobo.947.1"> configuration section adds support for processing Handlebars templates. </span><span class="kobospan" id="kobo.947.2">The </span><code class="inlinecode"><span class="kobospan" id="kobo.948.1">resolve</span></code><span class="kobospan" id="kobo.949.1"> section creates an alias so that JavaScript files created from templates can be imported with </span><code class="inlinecode"><span class="kobospan" id="kobo.950.1">@templates</span></code><span class="kobospan" id="kobo.951.1">, rather than using a relative path in an </span><code class="inlinecode"><span class="kobospan" id="kobo.952.1">import</span></code><span class="kobospan" id="kobo.953.1"> statement.</span></p>
<p class="normal"><span class="kobospan" id="kobo.954.1">Webpack </span><a id="_idIndexMarker517" class="calibre3"/><span class="kobospan" id="kobo.955.1">doesn’t detect changes to its configuration file, so stop the build tools and run the </span><code class="inlinecode"><span class="kobospan" id="kobo.956.1">npm start</span></code><span class="kobospan" id="kobo.957.1"> command again so the new configuration takes effect.</span></p>
<p class="normal"><span class="kobospan" id="kobo.958.1">To define the client-side template, add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.959.1">counter_client.handlebars</span></code><span class="kobospan" id="kobo.960.1"> in the </span><code class="inlinecode"><span class="kobospan" id="kobo.961.1">templates/client</span></code><span class="kobospan" id="kobo.962.1"> folder with the content shown in </span><em class="italic"><span class="kobospan" id="kobo.963.1">Listing 10.30</span></em><span class="kobospan" id="kobo.964.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.965.1">Listing 10.30: The contents of the counter_client.handlebars file in the templates/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.966.1">&lt;button class="btn btn-primary m-2" action="incrementCounter"&gt;
    Increment
&lt;/button&gt;
&lt;div&gt;
    {{#if (isOdd counter) }}
        &lt;h4 class="bg-primary text-white m-2 p-2"&gt;
            Client Odd Value: {{ counter }}
        &lt;/h4&gt;               
    {{else}}
        &lt;h4 class="bg-secondary text-white m-2 p-2"&gt;
            Client Even Value: {{ counter }}
        &lt;/h4&gt;      
    {{/if}}
&lt;/div&gt;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.967.1">All the Handlebars features are available in client-side templates, including partial templates, but I have combined everything for simplicity. </span><span class="kobospan" id="kobo.967.2">The content security policy restrictions on inline event handlers still apply and so I have used the </span><code class="inlinecode"><span class="kobospan" id="kobo.968.1">action</span></code><span class="kobospan" id="kobo.969.1"> attribute on the </span><code class="inlinecode"><span class="kobospan" id="kobo.970.1">button</span></code><span class="kobospan" id="kobo.971.1"> element to identify what action should be performed when the button is clicked.</span></p>
<p class="normal"><span class="kobospan" id="kobo.972.1">Only one helper is required on the client side. </span><span class="kobospan" id="kobo.972.2">Add a file named </span><code class="inlinecode"><span class="kobospan" id="kobo.973.1">isOdd.js</span></code><span class="kobospan" id="kobo.974.1"> to the </span><code class="inlinecode"><span class="kobospan" id="kobo.975.1">templates/client</span></code><span class="kobospan" id="kobo.976.1"> folder with the contents shown in </span><em class="italic"><span class="kobospan" id="kobo.977.1">Listing 10.31</span></em><span class="kobospan" id="kobo.978.1">.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.979.1">Listing 10.31: The contents of the isOdd.js file in the templates/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><span class="kobospan" id="kobo.980.1">export default (value) =&gt; value % 2;
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.981.1">The location of files is specified by the </span><code class="inlinecode"><span class="kobospan" id="kobo.982.1">handlebars-loader</span></code><span class="kobospan" id="kobo.983.1"> package and the default </span><a id="_idIndexMarker518" class="calibre3"/><span class="kobospan" id="kobo.984.1">configuration has template helper functions defined in individual files with the helper name used as the filename, alongside the templates that use them. </span><em class="italic"><span class="kobospan" id="kobo.985.1">Listing 10.32</span></em><span class="kobospan" id="kobo.986.1"> updates the </span><code class="inlinecode"><span class="kobospan" id="kobo.987.1">client.js</span></code><span class="kobospan" id="kobo.988.1"> file to use the Handlebars template.</span></p>
<p class="packt_figref"><span class="kobospan" id="kobo.989.1">Listing 10.32: Using a template in the client.js file in the src/client folder</span></p>
<pre class="programlisting"><code class="hljs-code"><strong class="screentext"><span class="kobospan" id="kobo.990.1">//import { Counter } from "./counter_custom";</span></strong>
<strong class="screentext"><span class="kobospan" id="kobo.991.1">import * as</span></strong><strong class="screentext"><span class="kobospan" id="kobo.992.1"> Counter from "@templates/counter_client.handlebars";</span></strong><span class="kobospan" id="kobo.993.1">
const context = {
    counter: 0
}
const actions = {
    incrementCounter: () =&gt; {
        context.counter++; render();
    }
}
const render = () =&gt; {
    document.getElementById("target").innerHTML = Counter(context);
}
document.addEventListener('DOMContentLoaded', () =&gt; {
    document.onclick = (ev) =&gt; {
        const action = ev.target.getAttribute("action")
        if (action &amp;&amp; actions[action]) {
            actions[action]()
        }
    }
    render();
});
</span></code></pre>
<p class="normal"><span class="kobospan" id="kobo.994.1">The compiled template is a drop-in replacement for the custom function I defined earlier in the chapter. </span><span class="kobospan" id="kobo.994.2">When webpack builds the client-side bundle, the Handlebars template files are compiled into JavaScript. </span><span class="kobospan" id="kobo.994.3">(You may receive a build error when you save the changes in </span><em class="italic"><span class="kobospan" id="kobo.995.1">Listing 10.32</span></em><span class="kobospan" id="kobo.996.1">. </span><span class="kobospan" id="kobo.996.2">If that happens, stop the development tools, and start them again using the </span><code class="inlinecode"><span class="kobospan" id="kobo.997.1">npm start</span></code><span class="kobospan" id="kobo.998.1"> command).</span></p>
<p class="normal"><span class="kobospan" id="kobo.999.1">Use a browser to request </span><code class="inlinecode"><span class="kobospan" id="kobo.1000.1">http://localhost:5000</span></code><span class="kobospan" id="kobo.1001.1"> and you will see the client-side </span><a id="_idIndexMarker519" class="calibre3"/><span class="kobospan" id="kobo.1002.1">application, as shown in </span><em class="italic"><span class="kobospan" id="kobo.1003.1">Figure 10.9</span></em><span class="kobospan" id="kobo.1004.1">.</span></p>
<figure class="mediaobject"><span class="kobospan" id="kobo.1005.1"><img alt="" src="../Images/Image11054.png" class="calibre7"/></span></figure>
<p class="packt_figref"><span class="kobospan" id="kobo.1006.1">Figure 10.9: Using a package for client-side templates</span></p>
<h1 class="heading" id="_idParaDest-189"><span class="kobospan" id="kobo.1007.1">Summary</span></h1>
<p class="normal1"><span class="kobospan" id="kobo.1008.1">In this chapter, I demonstrated how server-side and client-side templates work, and how they can be used to generate HTML content. </span><span class="kobospan" id="kobo.1008.2">The following information was also covered:</span></p>
<ul class="calibre4">
<li class="bulletlist"><span class="kobospan" id="kobo.1009.1">Templates are a mix of static content with placeholders for data values.</span></li>
<li class="bulletlist1"><span class="kobospan" id="kobo.1010.1">When a template is rendered, the result is an HTML document or fragment that reflects the current state of the application.</span></li>
<li class="bulletlist1"><span class="kobospan" id="kobo.1011.1">Templates can be rendered by Node.js, as server-side templates, or by JavaScript running in the browser, as client-side templates.</span></li>
<li class="bulletlist1"><span class="kobospan" id="kobo.1012.1">Client-side templates are usually compiled into JavaScript functions so they can be easily rendered by the browser.</span></li>
<li class="bulletlist1"><span class="kobospan" id="kobo.1013.1">There are many good open-source template packages available, all of which offer similar features, but use different template file formats.</span></li>
</ul>
<p class="normal"><span class="kobospan" id="kobo.1014.1">In the next chapter, I will explain how you can use HTML forms to receive data from the user, and how to validate the data when it is received.</span></p>
</div>
</body></html>