<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Creating a Bar Graph Using a Data File</h1>
                </header>
            
            <article>
                
<p><strong>AJAX</strong> stands for <strong>Asynchronous JavaScript And XML</strong>. Basically, what we can do is use JavaScript to load data into the page after it has loaded. This is a great way to generate a graph based on user interaction. In this chapter, we'll use AJAX to build a bar graph. By the end of the chapter, you should be able to do the following:</p>
<ul>
<li>Use AJAX to make an asynchronous call to an external data file</li>
<li>Create a bar graph</li>
</ul>
<p><span>The complete code for this section can be found here: </span><span><a href="https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter05" target="_blank">https://github.com/PacktPublishing/D3.js-Quick-Start-Guide/tree/master/Chapter05</a></span><span>.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up our application</h1>
                </header>
            
            <article>
                
<p>Let's create our standard setup in <kbd>index.html</kbd>:</p>
<div class="highlight highlight-text-html-basic">
<pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span> <span class="pl-e">lang</span>=<span class="pl-s"><span class="pl-pds">"</span>en<span class="pl-pds">"</span></span> <span class="pl-e">dir</span>=<span class="pl-s"><span class="pl-pds">"</span>ltr<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">head</span>&gt;
        &lt;<span class="pl-ent">link</span> <span class="pl-e">rel</span>=<span class="pl-s"><span class="pl-pds">"</span>stylesheet<span class="pl-pds">"</span></span> <span class="pl-e">href</span>=<span class="pl-s"><span class="pl-pds">"</span>app.css<span class="pl-pds">"</span></span>&gt;
    &lt;/<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">body</span>&gt;
        &lt;<span class="pl-ent">svg</span>&gt;&lt;/<span class="pl-ent">svg</span>&gt;
        &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>https://d3js.org/d3.v5.min.js<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
        &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>app.js<span class="pl-pds">"</span></span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
    &lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre>
<p>Now add the following code to <kbd>app.js</kbd><span>:</span></p>
</div>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> <span class="pl-c1">WIDTH</span> <span class="pl-k">=</span> <span class="pl-c1">800</span>;
<span class="pl-k">var</span> <span class="pl-c1">HEIGHT</span> <span class="pl-k">=</span> <span class="pl-c1">600</span>;

<span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">style</span>(<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>, <span class="pl-c1">WIDTH</span>)
    .<span class="pl-c1">style</span>(<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, <span class="pl-c1">HEIGHT</span>);</pre>
<p>Now add the following code to <kbd>app.css</kbd><span>:</span></p>
</div>
<div class="highlight highlight-source-css">
<pre><span class="pl-ent">svg</span> {
    <span class="pl-c1">border</span>:<span class="pl-c1">1<span class="pl-k">px</span></span> <span class="pl-c1">solid</span> <span class="pl-c1">black</span>;
}</pre></div>
<p>This is what we should have:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-413 image-border" src="assets/7dc454cf-35e3-4cc9-bda7-9bc5192a728e.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an external file to hold our data</h1>
                </header>
            
            <article>
                
<p>Let's create a <kbd>data.json</kbd> file, which will hold fake data regarding how often job posts require certain skills. This should be the contents of the file:</p>
<div class="highlight highlight-source-json">
<pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>HTML<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">21</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>CSS<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">17</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Responsive Web Design<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">17</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>JavaScript<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">17</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Git<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">16</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Angular.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">9</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Node.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">9</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>PostgreSQL<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">8</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Agile Project Management<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">8</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>MongoDB<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">7</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Trello<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">7</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Testing / TDD<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">7</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>jQuery<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">7</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>User Testing<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">6</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>MySQL<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">6</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>PHP<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">6</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>React.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">6</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>AJAX<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">6</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Express.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Heroku<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Wireframing<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Sass/SCSS<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Mobile Web<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">4</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Rails<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">4</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>WordPress<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">4</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Drupal<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">3</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Ruby<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">3</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Ember.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">3</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Python<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">3</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Amazon EC2<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">2</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Computer Science degree<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Backbone.js<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Less<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Prototyping<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Redis<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>count<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>
  }
]</pre></div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making an AJAX request</h1>
                </header>
            
            <article>
                
<p>Now we're going to use JavaScript to make a request for some data.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Writing the basic code</h1>
                </header>
            
            <article>
                
<p>D3 has lots of different methods for making AJAX requests to files of different data types:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">json</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the json data here</span>
});
<span class="pl-smi">d3</span>.<span class="pl-en">csv</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the csv data here</span>
});
<span class="pl-smi">d3</span>.<span class="pl-en">tsv</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the tsv data here</span>
});
<span class="pl-smi">d3</span>.<span class="pl-en">xml</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the xml data here</span>
});
<span class="pl-smi">d3</span>.<span class="pl-en">html</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the html data here</span>
});
<span class="pl-smi">d3</span>.<span class="pl-c1">text</span>(<span class="pl-s"><span class="pl-pds">'</span>path<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-c">//do something with the text data here</span>
});</pre></div>
<p>Since our data is in JSON format, we'll use the first kind of call. Add the following to the end of <kbd>app.js</kbd>:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">json</span>(<span class="pl-s"><span class="pl-pds">'</span>data.json<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){ <span class="pl-en">console</span>.<span class="pl-c1">log</span>(data); });</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Handling file access</h1>
                </header>
            
            <article>
                
<p>If you opened the <kbd>index.html</kbd> file in Chrome directly, instead of serving it on a web server, you'll notice we've encountered an error. Check your developer console:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-687 image-border" src="assets/97d9f57d-79f0-4466-a747-686d85c3dbbd.png" style=""/></div>
<p class="CDPAlignLeft CDPAlign">The issue here is that web browsers are not supposed to make AJAX requests to files on your computer. If they could, this would be a huge security flaw because any website could access files on your computer. Let's create a basic file server. To do this, you'll need to <kbd>installNode.js</kbd> (<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>). Once that's done, open your computer's Terminal:</p>
<ul>
<li>For Mac: command + <em>Space</em>, and then type <kbd>terminal</kbd> and hit Ent<em>er</em>.</li>
<li>For Windows: click <span class="packt_screen">Start</span>, type <kbd>cmd</kbd>,and hit <em>Enter</em>.</li>
</ul>
<p>Next, type the following into your Terminal:</p>
<pre><strong>npm install -g http-server</strong></pre>
<p>If you get error messages, try this:</p>
<pre><strong>sudo npm install -g http-server</strong></pre>
<p>This installs a basic <kbd>http-server</kbd> that was built using <kbd>Node.js</kbd>. To run it, use the Terminal to navigate to the directory where you saved your code (type <kbd>cd</kbd> to change folders in the Terminal) and run the following:</p>
<pre><strong>http-server .</strong></pre>
<p>You should see something such as this:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-415 image-border" src="assets/313081e8-4b43-4e47-8f9c-728a3748404d.png" style=""/></div>
<p class="CDPAlignLeft CDPAlign">Now go to <kbd>http://localhost:8080/</kbd> in your browser. You should now see that your AJAX call is succeeding (if you have issues, hold down shift and hit the refresh button to force the browser to reload all files that may have been cached):</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-688 image-border" src="assets/84654d3a-5564-42b0-bf0e-ba156a9be601.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using AJAX data to create SVG elements</h1>
                </header>
            
            <article>
                
<p>Now that our AJAX calls are succeeding, let's start building our app. From here on out, it's all basic JavaScript and D3. Note that everything we'll write for the rest of this lesson is done within the success callback of our AJAX request. In production, we might want to move this code elsewhere, but for now this is easier for learning. Let's create some rectangles for our bar graph. The bottom of <kbd>app.js</kbd> (the callback to the AJAX request) should now look as follows:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">json</span>(<span class="pl-s"><span class="pl-pds">'</span>data.json<span class="pl-pds">'</span></span>).<span class="pl-c1">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>){
    <span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>).<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>)
        .<span class="pl-c1">data</span>(data)
        .<span class="pl-en">enter</span>()
        .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>);
});</pre></div>
<p class="mce-root"/>
<p>Our <strong>Elements</strong> tab in our dev tools should look something like this:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-416 image-border" src="assets/d312da58-cc1a-4bd8-ad7a-562469936047.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adjusting the height and the width of the bars</h1>
                </header>
            
            <article>
                
<p>Let's create a scale that maps the <kbd>count</kbd> property of each element in <kbd>data</kbd> to a visual height for the corresponding bar. We'll use a linear scale. Remember to map <kbd>HEIGHT</kbd> of the graph to a very low data point and the top of the graph (<kbd>0</kbd> in the range) map to a very high data value. Add this code to the bottom of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> yScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleLinear</span>();
<span class="pl-smi">yScale</span>.<span class="pl-en">range</span>([<span class="pl-c1">HEIGHT</span>, <span class="pl-c1">0</span>]);
<span class="pl-k">var</span> yMin <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">min</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-k">var</span> yMax <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">max</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-smi">yScale</span>.<span class="pl-en">domain</span>([yMin, yMax]);</pre></div>
<p>We could use <kbd>d3.extent</kbd>, but we're going to need the individual min values later on. Immediately after the previous code, let's tell D3 to adjust the height of the rectangles using the <kbd>yScale</kbd>. Remember that the <em>y</em> axis is flipped. A low data value produces a high range value. But even though the range is high, the bar itself should be small. We'll need to re-flip the values just for height so that a low data value produces a small bar and a high data value produces a large bar. To do this, let's subtract whatever the range point is from <kbd>HEIGHT</kbd> of the graph. This way, if <kbd>yScale(datum.count)</kbd> produces, say, 500, the height of the bar will be 100. We can use <kbd>yScale(datum.count)</kbd> normally when adjusting the position of the bars later. Add the following to the bottom of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>height<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
        <span class="pl-k">return</span> <span class="pl-c1">HEIGHT</span><span class="pl-k">-</span><span class="pl-en">yScale</span>(<span class="pl-smi">datum</span>.<span class="pl-smi">count</span>);
    });</pre></div>
<p>Now our rectangles have height, but no width:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-417 image-border" src="assets/da5dc03c-ca41-4b9a-8a39-1ce0511855c8.png" style=""/></div>
<p>At the bottom of <kbd>app.css</kbd>, let's give all our bars the same width:</p>
<div class="highlight highlight-source-css">
<pre><span class="pl-ent">rect</span> {
    <span class="pl-c1">width</span>: <span class="pl-c1">15<span class="pl-k">px</span></span>;
}</pre>
<p>Here's what we should see in Chrome now:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-418 image-border" src="assets/481f4a84-0d7f-4699-b9a3-51ade773989b.png" style=""/></div>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adjusting the horizontal and the vertical placement of the bars</h1>
                </header>
            
            <article>
                
<p>Our bars all overlap one another at the moment. Let's space them out by mapping <em>x</em>'s position to index in the data array. Add the following to the bottom of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> xScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleLinear</span>(); <span class="pl-smi">xScale</span>.<span class="pl-en">range</span>([<span class="pl-c1">0</span>, <span class="pl-c1">WIDTH</span>]); <span class="pl-smi">xScale</span>.<span class="pl-en">domain</span>([<span class="pl-c1">0</span>, <span class="pl-smi">data</span>.<span class="pl-c1">length</span>]); <span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>) .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>x<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){ <span class="pl-k">return</span> <span class="pl-en">xScale</span>(index); });</pre></div>
<p>This maps indices in the array to horizontal range points. Chrome should look as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-419 image-border" src="assets/36de3793-9513-4a33-bbdb-630de03aae7e.png" style=""/></div>
<p>Now let's move the bars so they grow from the bottom, as opposed to hanging from the top. Add the following to the end of the AJAX callback:</p>
<pre>d3.selectAll('rect')<br/>    .attr('y', function(datum, index){<br/>        return yScale(datum.count);<br/>    });</pre>
<p>Using our <kbd>yScale</kbd> func<span>tion, a high data value produces a low range value, which doesn't push a large bar down much. A low data point produces a high range value, which pushes a small bar down a lot.</span></p>
<p>Our last few bars don't have any height, because we've mapped the minimum count property of our data to a visual range value of 0 in <kbd>yScale</kbd>. Let's adjust the last line of this code:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> yScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleLinear</span>();
<span class="pl-smi">yScale</span>.<span class="pl-en">range</span>([<span class="pl-c1">HEIGHT</span>, <span class="pl-c1">0</span>]);
<span class="pl-k">var</span> yMin <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">min</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-k">var</span> yMax <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">max</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-smi">yScale</span>.<span class="pl-en">domain</span>([yMin, yMax]);</pre></div>
<p>We will change it to this code:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> yScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleLinear</span>();
<span class="pl-smi">yScale</span>.<span class="pl-en">range</span>([<span class="pl-c1">HEIGHT</span>, <span class="pl-c1">0</span>]);
<span class="pl-k">var</span> yMin <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">min</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-k">var</span> yMax <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">max</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-smi">yScale</span>.<span class="pl-en">domain</span>([yMin<span class="pl-k">-</span><span class="pl-c1">1</span>, yMax]); <span class="pl-c">//adjust this line</span></pre></div>
<p>Now the domain minimum is one less than what's actually in our data set. Domains with the original minimum are treated as higher values than what's expected for the minimum of the graph. We get this:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-420 image-border" src="assets/34cf9294-2787-496e-a9af-354d2f402d41.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Making the width of the bars dynamic</h1>
                </header>
            
            <article>
                
<p>Currently, our bars have a fixed width. No matter how many elements we have, they have a 15 px width. If we had more data elements, the bars could overlap. Let's change this. Since each <kbd>rect</kbd> will be the same width, no matter what the data is, we can just assign <kbd>width</kbd> a computed value. Add the following to the end of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>width<span class="pl-pds">'</span></span>, <span class="pl-c1">WIDTH</span><span class="pl-k">/</span><span class="pl-smi">data</span>.<span class="pl-c1">length</span>);</pre></div>
<p>Now let's adjust our <kbd>rect</kbd> CSS so our bars are more visible:</p>
<div class="highlight highlight-source-css">
<pre><span class="pl-ent">rect</span> {
    <span class="pl-c">/*  remove the width rule that was here */</span>
    <span class="pl-c1">stroke</span>:<span class="pl-c1">white</span>;
    <span class="pl-c1">stroke-width</span>:<span class="pl-c1">1<span class="pl-k">px</span></span>;
}</pre>
<p><span>The output will be shown as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-421 image-border" src="assets/fcf980d3-2e3e-486c-970f-3857c60f4bff.png" style=""/></div>
</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Changing the color of the bar based on data</h1>
                </header>
            
            <article>
                
<p>Right now, the bars are black. A linear scale will interpolate between colors, just like a regular number. Add the following to the end of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> yDomain <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">extent</span>(data, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
    <span class="pl-k">return</span> <span class="pl-smi">datum</span>.<span class="pl-smi">count</span>;
})
<span class="pl-k">var</span> colorScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleLinear</span>();
<span class="pl-smi">colorScale</span>.<span class="pl-en">domain</span>(yDomain)
<span class="pl-smi">colorScale</span>.<span class="pl-en">range</span>([<span class="pl-s"><span class="pl-pds">'</span>#00cc00<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>blue<span class="pl-pds">'</span></span>])
<span class="pl-smi">d3</span>.<span class="pl-en">selectAll</span>(<span class="pl-s"><span class="pl-pds">'</span>rect<span class="pl-pds">'</span></span>)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>fill<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">datum</span>, <span class="pl-smi">index</span>){
        <span class="pl-k">return</span> <span class="pl-en">colorScale</span>(<span class="pl-smi">datum</span>.<span class="pl-smi">count</span>)
    })</pre></div>
<p>Notice that we calculate they Domain using <kbd>d3.extent</kbd> so that the real minimum of the data set is used to map <kbd>#00cc00</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-422 image-border" src="assets/df8c385d-d6d3-4b4e-ac5c-f5967e8fbcf9.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding axes</h1>
                </header>
            
            <article>
                
<p>The left axis is the same as shown in <a href="e503bfe5-4b90-47eb-bae0-d588a9b545d5.xhtml" target="_blank"/><a href="e503bfe5-4b90-47eb-bae0-d588a9b545d5.xhtml" target="_blank">Chapter 4</a>, <em>Making a Basic Scatter Plot Interactive</em>. Add this code to the bottom of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> leftAxis <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">axisLeft</span>(yScale);
<span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>left-axis<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">call</span>(leftAxis);</pre></div>
<p>To create the bottom axis, we need to be able to map strings to points on a domain. We'll use a band scale for this, which just divides up the range into equal parts and maps it to an array of discrete values (values that can't be interpolated, for example, strings). <span>Add this code to the bottom of the AJAX callback:</span></p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> skillScale <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">scaleBand</span>();
<span class="pl-k">var</span> skillDomain <span class="pl-k">=</span> <span class="pl-smi">data</span>.<span class="pl-en">map</span>(<span class="pl-k">function</span>(<span class="pl-smi">skill</span>){
    <span class="pl-k">return</span> <span class="pl-smi">skill</span>.<span class="pl-c1">name</span>
});
<span class="pl-smi">skillScale</span>.<span class="pl-en">range</span>([<span class="pl-c1">0</span>, <span class="pl-c1">WIDTH</span>]);
<span class="pl-smi">skillScale</span>.<span class="pl-en">domain</span>(skillDomain);</pre></div>
<p>Notice we use <kbd>data.map()</kbd>. This is regular JavaScript that simply loops through an array and modifies each element based on the given function. It then returns the resulting array, leaving the original array in tact. In the previous example, <kbd>skillDomain</kbd> will be an array containing the various name properties of each of the data elements.</p>
<p>Once we have an array of each of the skills, we use this as the domain and map each skill to a point within the range. Remember the point in the range is created by dividing up the full range equally based on the number of elements in the domain.</p>
<p>Now that we have a scale that maps each skill text to a point in the <em>x</em> range, we can create the bottom axis as before. Add this code to the bottom of the AJAX callback:</p>
<div class="highlight highlight-source-js">
<pre><span class="pl-k">var</span> bottomAxis <span class="pl-k">=</span> <span class="pl-smi">d3</span>.<span class="pl-en">axisBottom</span>(skillScale);
<span class="pl-smi">d3</span>.<span class="pl-c1">select</span>(<span class="pl-s"><span class="pl-pds">'</span>svg<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">append</span>(<span class="pl-s"><span class="pl-pds">'</span>g<span class="pl-pds">'</span></span>).<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bottom-axis<span class="pl-pds">'</span></span>)
    .<span class="pl-c1">call</span>(bottomAxis)
    .<span class="pl-en">attr</span>(<span class="pl-s"><span class="pl-pds">'</span>transform<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>translate(0,<span class="pl-pds">'</span></span><span class="pl-k">+</span><span class="pl-c1">HEIGHT</span><span class="pl-k">+</span><span class="pl-s"><span class="pl-pds">'</span>)<span class="pl-pds">'</span></span>);</pre></div>
<p>We still need to stop the <kbd>&lt;svg&gt;</kbd> <span>element</span> from clipping the axes. Change the CSS for <kbd>svg</kbd> in <kbd>app.css</kbd>:</p>
<div class="highlight highlight-source-css">
<pre><span class="pl-ent">svg</span> {
    <span class="pl-c1">overflow</span>: <span class="pl-c1">visible</span>;
}</pre></div>
<p>The following is the result:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-423 image-border" src="assets/2108ac7d-1a29-4a59-9aa0-614fbd3f03b9.png" style=""/></div>
<p>The bottom axis text is all cluttered, though. Let's add some CSS to bottom of <kbd>app.css</kbd> to fix this:</p>
<div class="highlight highlight-source-css">
<pre><span class="pl-e">#bottom-axis</span> <span class="pl-ent">text</span> {
    <span class="pl-c1">transform</span>:<span class="pl-c1">rotate</span>(<span class="pl-c1">45<span class="pl-k">deg</span></span>);
}</pre>
<p>The output will be shown as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-424 image-border" src="assets/39695da5-7beb-4dd5-b2bb-9e4abbf9c456.png" style=""/></div>
</div>
<p>It's rotated, but it's rotated around the center of the element. Let's add a line to what we just wrote, so it rotates around the start of the text:</p>
<pre><span class="pl-e">#bottom-axis</span> <span class="pl-ent">text</span> {
    <span class="pl-c1">transform</span>:<span class="pl-c1">rotate</span>(<span class="pl-c1">45<span class="pl-k">deg</span></span>);
    <span class="pl-c1">text-anchor</span>: <span class="pl-c1">start</span>; /* add this line */
}</pre>
<p class="highlight highlight-source-css"><span>The output will be shown as follows:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-425 image-border" src="assets/335c2fa0-84ba-41bc-bce3-25f6f32c5d46.png" style=""/></div>
<p>Let's move the graph to the right, so we can see the values for the left axis. Adjust our <kbd>svg</kbd> css code so it looks as follows:</p>
<div class="highlight highlight-source-css">
<pre><span class="pl-ent">svg</span> {
    <span class="pl-c1">overflow</span>: <span class="pl-c1">visible</span>;
    <span class="pl-c1">margin-left</span>: <span class="pl-c1">20<span class="pl-k">px</span></span>; /* add this line */
}</pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned how to use AJAX to make an asynchronous request that will populate a bar graph. In <a href="aacc693a-f51f-4d50-832c-db2cd3af3b7f.xhtml" target="_blank">Chapter 6</a>, <em>Animating SVG Elements to Create an Interactive Pie Chart</em>, we'll create a pie chart that animates when you remove sections from it.</p>


            </article>

            
        </section>
    </body></html>