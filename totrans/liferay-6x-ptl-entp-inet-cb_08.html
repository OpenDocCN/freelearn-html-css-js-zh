<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Search and Content Presentation Tools</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem">Tagging and categorizing content</li><li class="listitem">Asset Publisher as a search-based tool for content presentation</li><li class="listitem">Defining application display templates for Asset Publisher</li><li class="listitem">Search portlet – basic configuration</li><li class="listitem">Solr installation and configuration</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec53"/>Introduction</h1></div></div></div><p>Liferay provides a powerful built-in tool that allows us to search for content. This is one of the most important functionalities in Liferay. Why? The answer is simple: searching is needed everywhere. It is not possible to find or locate an article, wiki, or document in the tangle of content without a good search engine. Liferay architecture provides a useful tool to index, search, and display such documents as faceted results. Faceted means grouped by a specific thematic category, grouped by a specific entity type, or other such criteria.</p><p>In fact, there is a whole bunch of search functionalities in Liferay. It is possible to find entities using SQL queries<a id="id450" class="indexterm"/> as well as using a dedicated search engine called Apache Lucene (<a class="ulink" href="http://lucene.apache.org">http://lucene.apache.org</a>). In many places (especially in the configuration or in the control panel), Liferay finds entities using SQL queries. On the <a id="id451" class="indexterm"/>other hand, Portal provides a dedicated portlet called Search Portlet, which allows us to search using the Lucene engine.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec54"/>Tagging and categorizing content</h1></div></div></div><p>Categories and tags provide a powerful mechanism to mark, list, and search different assets and allow<a id="id452" class="indexterm"/> their subsequent selection with the help of dedicated portlets such as<a id="id453" class="indexterm"/> Category Navigation, Asset Publisher, or Tag Cloud. The<a id="id454" class="indexterm"/> mechanism is very simple: tags and categories are assigned to<a id="id455" class="indexterm"/> web contents, documents, or other types of assets. Then, it is possible to set portlets to present only those assets with a specific category and/or tags. It is possible to assign one or more categories and/or tags to an asset.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec146"/>How to do it…</h2></div></div></div><p>Categories and tags can be assigned to any asset while adding or editing this asset. For instance, as was shown in the previous chapters (<a class="link" title="Chapter 6. Documents and Media in Liferay" href="part0050.xhtml#aid-1FLS41">Chapter 6</a>, <em>Documents and Media in Liferay</em> and <a class="link" title="Chapter 7. Working with Content" href="part0055.xhtml#aid-1KEEU1">Chapter 7</a>, <em>Working with Content</em>), a new (and edited) web content or a new (and edited) document form provides a categorization section. This section allows us to choose the set of categories and define the list of tags that will be assigned to a document or web content after submitting the form. However, what is important to know is that the process of assigning is different for categories and tags. Tags can be defined directly in the content adding form, while categories must be created in site administration to make it available for assigning.</p><p>Categories are <a id="id456" class="indexterm"/>stored in vocabularies. In order to create a category, you have to first create a vocabulary using the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Categories</strong>.</li><li class="listitem">Click on the <strong>Add Vocabulary</strong> button.<div><img src="img/image00353.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide<a id="id457" class="indexterm"/> a <strong>Name</strong> and <strong>Description</strong> for a new vocabulary.</li><li class="listitem">Enable<a id="id458" class="indexterm"/> the <strong>Allow Multiple Categories</strong> option.</li><li class="listitem">Set <strong>All Asset Types</strong> in the <strong>Choose Asset Type</strong> drop-down list.</li><li class="listitem">Enable <a id="id459" class="indexterm"/>the <strong>Required</strong> option.</li><li class="listitem">Determine <strong>Permissions</strong> for the vocabulary by setting all actions that may be performed by specific roles (you can find more permissions after clicking on the <strong>More Options</strong> link).</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>When <strong>Vocabulary</strong> is ready, it is possible to fill it with <strong>Categories</strong>. To add a category, follow these <a id="id460" class="indexterm"/>steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Categories</strong>.</li><li class="listitem">Click on the <strong>Add Category</strong> button.<div><img src="img/image00354.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a <a id="id461" class="indexterm"/><strong>Name</strong> and <strong>Description</strong> for the new category.</li><li class="listitem">From the <strong>To Vocabulary</strong> drop-down list, choose the vocabulary you want to create <a id="id462" class="indexterm"/>a<a id="id463" class="indexterm"/> category in.</li><li class="listitem">Determine <strong>Permissions</strong> for the category by setting all actions that may be performed by specific roles (you can find more permissions after clicking on the <strong>More Options</strong> link).</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>After creating a category, it is possible to assign it to the asset. Let's assign the previously created category to <a id="id464" class="indexterm"/>an existing web content using the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click on the name of one already existing web content.</li><li class="listitem">Navigate to the <strong>Categorization</strong> tab.</li><li class="listitem">Click on the <strong>Select</strong> button located near the name of the vocabulary you want to assign a category from.</li><li class="listitem">Mark the category or categories you want to choose and close the window.<div><img src="img/image00355.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Publish</strong> button to save the changes of the web content.</li></ol><div></div><p>Unlike <a id="id465" class="indexterm"/>categories, tags do not require to be created before entering the <strong>Categorization</strong> section of the add/edit asset form. You can create a tag and assign it in one task using the following<a id="id466" class="indexterm"/> steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in<a id="id467" class="indexterm"/> as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click on the name of one already existing web content.</li><li class="listitem">Navigate to the <strong>Categorization</strong> tab.</li><li class="listitem">Type a tag in the <strong>Tags</strong> field.</li><li class="listitem">Click on the <strong>+Add</strong> button or press the <em>Enter</em> button.<div><h3 class="title"><a id="note30"/>Note</h3><p>You can add more than one tag by typing the whole list of tags in the <strong>Tags</strong> field and separating them by commas.</p></div><div><img src="img/image00356.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on<a id="id468" class="indexterm"/> the <strong>Publish</strong> button to save the changes of the web<a id="id469" class="indexterm"/> content.</li></ol><div></div><p>It is also possible to<a id="id470" class="indexterm"/> define a list of tags in the <strong>Site Administration</strong> section to make it available for later use to users who create web contents, documents, and other types of assets. To define<a id="id471" class="indexterm"/> a tag, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Tags</strong>.</li><li class="listitem">Click on the <strong>Add Tag</strong> button.<div><img src="img/image00357.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Provide a <strong>Name</strong> for the tag.</li><li class="listitem">Click on the <strong>Save</strong> button.</li></ol><div></div><p>To assign<a id="id472" class="indexterm"/> an already existing tag, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in<a id="id473" class="indexterm"/> as an administrator and go to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Web Content</strong>.</li><li class="listitem">Click <a id="id474" class="indexterm"/>on the name of one already existing web content.</li><li class="listitem">Navigate to the <strong>Categorization</strong> tab.</li><li class="listitem">Click on the <strong>Select</strong> button located under the <strong>Tags</strong> field.<div><img src="img/image00358.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Mark the tag or tags you want to choose.<div><h3 class="title"><a id="note31"/>Note</h3><p>You can also choose an existing tag by typing its name (the autocomplete function will help find existing tags) and pressing the <em>Enter</em> button.</p></div></li><li class="listitem">Click on the <strong>Publish</strong> button to save the changes of the web content.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec147"/>How it works…</h2></div></div></div><p>Both categories and tags are managed using tools available in the <strong>Site Administration</strong> section and assigned to assets using assets add/edit forms (a new web content form, an edit web content form, a new document form, edit document form, and so on). When provided with categories and/or tags, each asset can be chosen by a specific portlet (such as Asset Publisher) and displayed on a page.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec62"/>Categories</h3></div></div></div><p>Categories <a id="id475" class="indexterm"/>are stored in vocabularies, and they form a tree-like structure—each category can have subcategories. All the categories available within the site can be managed by going to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Categories</strong>. This section allows us to create, edit, and delete vocabularies and categories.</p><p>Each vocabulary is identified by its name, and it can be provided with a description. Vocabularies can be set to work with all or just one specific asset (choose the <strong>Asset Type</strong> option). For instance, it is possible to create a vocabulary where categories can be assigned to web content only. Such vocabulary will not be available in other assets adding and editing forms.</p><p>While creating vocabulary, we can decide whether, while assigning categories to an asset, users have to assign at least one of its categories (the <strong>Required</strong> option) or whether they may use more than one category from this particular vocabulary (the <strong>Allow Multiple Categories</strong> option).</p><p>Categories are identified by their names, and they can be provided with descriptions. It is also possible to set permissions for both vocabularies and categories.</p></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec63"/>Tags</h3></div></div></div><p>Tags, on the <a id="id476" class="indexterm"/>contrary, are not stored in vocabularies, but they build a flat structure. All the tags assigned to assets within the site can be accessed by going to <strong>Admin</strong> | <strong>Site Administration</strong> | <strong>Content</strong> | <strong>Tags</strong>. The <strong>Tags</strong> section allows us to add, edit, delete, or merge tags. Unlike categories, tags can be created while assigning them to the asset.</p></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec148"/>See also</h2></div></div></div><p>For information about managing web content and files, refer to the following recipes:</p><div><ul class="itemizedlist"><li class="listitem">The<em> Managing files in Liferay using Documents and Media portlet</em> recipe in <a class="link" title="Chapter 6. Documents and Media in Liferay" href="part0050.xhtml#aid-1FLS41">Chapter 6</a>, <em>Documents and Media in Liferay</em></li><li class="listitem">The<em> Managing and displaying web content </em>recipe in <a class="link" title="Chapter 7. Working with Content" href="part0055.xhtml#aid-1KEEU1">Chapter 7</a>, <em>Working with Content</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec55"/>Asset Publisher as a search-based tool for content presentation</h1></div></div></div><p>Asset Publisher is<a id="id477" class="indexterm"/> a very complex<a id="id478" class="indexterm"/> and highly configurable portlet that allows us to present web content folders, web contents, document folders, documents, message board messages, bookmark folders, bookmark entries, blog entries, calendar events, and wiki pages on the page. Assets that are presented by a specific Asset Publisher may be chosen manually by authorized users or automatically based on the configured rules.</p><p>In this recipe, we will show you how to configure Asset Publisher to present web content using both manual and dynamic asset selection variants.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec149"/>Getting ready</h2></div></div></div><p>To step <a id="id479" class="indexterm"/>through this recipe, you will<a id="id480" class="indexterm"/> have to add a vocabulary containing News category and create a web content.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec150"/>How to do it…</h2></div></div></div><p>Let's assume that each week, on the main page of our intranet, we have to publish up to five of the most important news items chosen by employees responsible for news publishing. Such news can be displayed by the Asset Publisher portlet that is configured to list manually chosen web content articles. To configure such an Asset Publisher portlet, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator and go to the page on which you want to configure a new <strong>Asset Publisher</strong>.</li><li class="listitem">Click on the add icon (this is a <strong>+</strong> sign on the left side).</li><li class="listitem">Click on the <strong>Applications</strong> tab.</li><li class="listitem">Find the <strong>Asset Publisher</strong> portlet using the search feature or by browsing the list of available portlets.</li><li class="listitem">Click on the <strong>Add</strong> link located next to the Asset Publisher (the link appears when you hover over the portlet name).</li><li class="listitem">Click on the options icon of the newly added portlet (this will be a gear icon in the top-right corner of the portlet).</li><li class="listitem">Choose the <strong>Configuration</strong> option.</li><li class="listitem">Choose the <strong>Manual</strong> option from the <strong>Asset Selection</strong> section.</li><li class="listitem">Click on the <strong>Select</strong> button in the <strong>Asset Entries</strong> section.</li><li class="listitem">Choose the <strong>Web Content Article</strong> option.</li><li class="listitem">Click on the <strong>Choose</strong> button next to the web content you want to choose.<div><h3 class="title"><a id="note32"/>Note</h3><p>Repeat steps 9–11 as many times as needed to create the desired list of news.</p></div><div><img src="img/image00359.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Click on the <strong>Save</strong> button.</li><li class="listitem">Close the pop-up window by clicking on the <strong>x</strong> button. The Asset Publisher portlet you have just configured will present only the list of chosen web contents.</li></ol><div></div><p>It is <a id="id481" class="indexterm"/>also possible to set Asset Publisher <a id="id482" class="indexterm"/>to automatically choose news articles based on a specified category (in our example, we will use the <strong>News</strong> category).</p><p>In order to change the Asset Publisher configuration to present only web content articles with the <strong>News</strong> category, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the options icon of the previously added portlet.</li><li class="listitem">Choose the <strong>Configuration</strong> option.</li><li class="listitem">Choose the <strong>Dynamic</strong> option from the <strong>Asset Selection</strong> section.</li><li class="listitem">Choose the <strong>Web Content Article</strong> option from the <strong>Asset Type</strong> list.</li><li class="listitem">Set the <strong>Contain any of the following categories</strong> rule in the <strong>Filters</strong> section.</li><li class="listitem">Click on the <strong>Select</strong> button.</li><li class="listitem">Mark the <strong>News</strong> category and close the window.<div><img src="img/image00360.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Set <strong>Order by fields</strong> to <strong>Publish Date</strong> and <strong>Descending</strong>.</li><li class="listitem">Click on the <strong>Save</strong> button. Close the pop-up window by clicking on the <strong>x</strong> button. The Asset Publisher portlet you have just configured will present only a list of web contents that contain the <strong>News</strong> category.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec151"/>How it works…</h2></div></div></div><p>Assets that<a id="id483" class="indexterm"/> are displayed by the <a id="id484" class="indexterm"/>portlet can be chosen manually by the user (<strong>Manual Asset Selection</strong>) or automatically, based on the set of rules (<strong>Dynamic Asset Selection</strong>). As was shown in the first part of the recipe, <strong>Manual Asset Selection</strong> allows us to select any assets corresponding to the type set in the <strong>Asset Type</strong> field and available within the scope that the Asset Publisher is working in (defined in the <strong>Scope</strong> field).</p><p>The scope is a very important parameter, because it defines the place of origin of the asset that is displayed by Asset Publisher. Asset Publisher can present assets created within <strong>Current Site</strong>, <strong>Global</strong> scope, or any other site chosen from the <strong>Other Site</strong> list.</p><p>The second part of the recipe provides an example of <strong>Dynamic Asset Selection</strong>, where Asset Publisher chooses, from a defined <strong>Scope</strong>, all the assets that comply with the defined <strong>Asset Type</strong> and are assigned to categories or tags specified in the <strong>Filter</strong> section. It is possible to specify that Asset Publisher should list only these assets with an assigned (or without an assigned) category, a set of categories, a tag, or set of tags. Additionally, the <strong>Filter</strong> section allows us to specify whether the asset must be assigned to all the categories from the set (the <strong>All</strong> option) or whether it is enough if at least one category from the set is assigned (the <strong>Any</strong> option). For instance, if we would like the Asset Publisher portlet to present only the assets that have both News and Sport categories, we have to set the <strong>Contains All Categories</strong> rule and choose both News and Sport categories from the list. If we would like to list all the assets, except these with News category assigned, we have to use the <strong>Does not Contain Any Categories</strong> rule and choose the News category from the list.</p><p>The Asset Publisher portlet provides many configuration options that allow us to customize its appearance and available functions. The configuration options can be accessed by going to <strong>Asset Publisher</strong> | <strong>Configuration</strong> | <strong>Setup</strong> | <strong>Display Settings</strong>. Here is a description <a id="id485" class="indexterm"/>of the most important options:</p><div><ul class="itemizedlist"><li class="listitem">The <strong>Display Template</strong> option allows us to choose how the asset should be displayed (as a Title List, Full Content, Abstract, and so on).</li><li class="listitem"><strong>Abstract Length</strong> allows defining the number of characters of text that will be displayed as an abstract.</li><li class="listitem">The <strong>Asset Link Behaviour</strong> defines whether, after clicking the title presented on the list, the full content should be displayed.</li><li class="listitem">The <strong>Number of Items to Display</strong> option defines how many assets will be displayed <a id="id486" class="indexterm"/>by the Asset Publisher portlet.</li><li class="listitem"><strong>Pagination Type</strong> allows us to choose whether, and what type of, pagination<a id="id487" class="indexterm"/> should be displayed to organize a long lists of assets.</li><li class="listitem">The <strong>Set as the Default Asset Publisher for This Page</strong> option allows us to set this particular Asset Publisher as the one that will be used to present content associated to this page. The page with Asset Publisher set as default will be available to choose as a display page while adding a new web content.</li><li class="listitem">The <strong>Enable Print</strong> option enables the print version of the web content.</li><li class="listitem">The <strong>Enable Flags</strong> option enables the flags functionality, which provides a contact form that notifies any irregularities.</li><li class="listitem">The <strong>Enable Related Assets</strong> option enables the related assets functionality, which lists all the assets defined as related in the adding/editing asset form.</li><li class="listitem">The <strong>Enable Ratings</strong> option enables the functionality that allows us to rate the content shown by Asset Publisher.</li><li class="listitem">The <strong>Enable Comments</strong> option allows us to comment on the assets shown by Asset Publisher.</li><li class="listitem">The <strong>Enable Social Bookmarks</strong> option displays the Google+, Facebook, and Twitter sharing buttons.</li><li class="listitem">The <strong>Choose metadata</strong> option allows us to choose the metadata information shown for each asset displayed by the Asset Publisher portlet.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec152"/>See also</h2></div></div></div><p>For information about managing web content and files, refer to the following recipes:</p><div><ul class="itemizedlist"><li class="listitem">The<em> Managing files in Liferay using Documents and Media portlet</em> recipe in <a class="link" title="Chapter 6. Documents and Media in Liferay" href="part0050.xhtml#aid-1FLS41">Chapter 6</a>, <em>Documents and Media in Liferay</em></li><li class="listitem">The<em> Managing and displaying web contents</em> recipe in <a class="link" title="Chapter 7. Working with Content" href="part0055.xhtml#aid-1KEEU1">Chapter 7</a>, <em>Working with Content</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec56"/>Defining application display templates for Asset Publisher</h1></div></div></div><p>Since Liferay Version 6.2 is the available option, it allows us to set a new display template for <a id="id488" class="indexterm"/>Asset Publisher. In<a id="id489" class="indexterm"/> real-world applications, it is quite a useful and powerful tool that helps define custom display templates for assets, such as journal article, blog entry, message board, and so on. For example, you may want to display only an asset's descriptions or add selected categories and tags.</p><p>Let's assume that we have a use case that describes Asset Publisher view requirements as follows:</p><div><ul class="itemizedlist"><li class="listitem">Display title</li><li class="listitem">Display description</li><li class="listitem">Display selected tags and categories</li><li class="listitem">Display asset links</li><li class="listitem">Display Read more link</li></ul></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec153"/>How to do it…</h2></div></div></div><p>In order to define a new display template, log in as an administrator and follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an administrator. Go to <strong>Admin</strong> | <strong>Configuration</strong> and choose <strong>Application Display Templates</strong> from the left menu.</li><li class="listitem">Click on the <strong>Add</strong> button and choose <strong>Asset Publisher Template</strong>.</li><li class="listitem">Fill in the form by typing <strong>Name</strong> with the <strong>Intranet template</strong> value and choose the <strong>Velocity (.vm)</strong> language.</li><li class="listitem">In the script area, write the following code:<div><pre class="programlisting">#if (!$entries.isEmpty())
  #foreach ($curEntry in $entries)
    &lt;div&gt;$curEntry.getTitle($locale)&lt;/div&gt;
    &lt;div&gt;$curEntry.getDescription($locale)&lt;/div&gt;
    &lt;div&gt;
      $taglibLiferay.assetTagsSummary(
        $curEntry.getClassName(), $curEntry.getClassPK(), 
        null, null, $renderResponse.createRenderURL()
        )
    &lt;/div&gt;
    &lt;div&gt;
      $taglibLiferay.assetCategoriesSummary(
        $curEntry.getClassName(), 
        $curEntry.getClassPK(), null, $renderResponse.createRenderURL()
      )
    &lt;/div&gt;
    &lt;div&gt;
      $taglibLiferay.assetLinks(
        $curEntry.getEntryId(), 
        $curEntry.getClassName(), $curEntry.getClassPK()
      )
    &lt;/div&gt;

    &lt;div&gt;
      &lt;a href="$assetPublisherHelper.getAssetViewURL(
        $renderRequest, $renderResponse, $curEntry)"&gt;
      Read more&lt;/a&gt;
    &lt;/div&gt;
    &lt;hr /&gt;
    #end
#end</pre></div></li><li class="listitem">Click <a id="id490" class="indexterm"/>on the <strong>Save</strong> button.</li><li class="listitem">Create <a id="id491" class="indexterm"/>a new page and put the Asset Publisher portlet (see the <em>Asset Publisher as a search-based tool for content presentation</em> recipe from this chapter).</li><li class="listitem">Go to Asset Publisher configuration and choose the <strong>Display Setting</strong> tab.</li><li class="listitem">In the <strong>Display Template</strong> field, choose the <strong>Intranet</strong> template and click on the <strong>Save</strong> button.</li><li class="listitem">Close the configuration popup. In Asset Publisher view, you should see the new template.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec154"/>How it works…</h2></div></div></div><p>In previous Liferay versions, it was not possible to add a new display template for Asset Publisher from Control Panel. The only way was to add a new Java Server Pages file in the hook plugin. In Liferay 6.2 it is possible to define views as a Velocity or Freemarker script under Control Panel. Liferay developers implement a powerful editor that helps in creating new templates. Editor specifies the possible fields, displays hints, and provides an excellent autocomplete option.</p><p>Let's try to understand our script. The first line checks whether there are any elements in the entries collection. The <code class="literal">$entries</code> object is a collection of Asset Entry elements, which <a id="id492" class="indexterm"/>are selected by a <a id="id493" class="indexterm"/>specific criteria from the portlet configuration.</p><p>The next line iterates over the entries collection and assigns elements to the <code class="literal">$curEntry</code> variable.</p><p>The next section displays the title and description. The next three sections display tags, categories, and related assets. The last one renders the <strong>Read more</strong> option.</p><p>The most difficult thing in this process is understanding how each helper and util works, which parameters are required, and which ones are not required. Unfortunately, there is no easy way to understand it. The only way is to search for help in Liferay sources or examples.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec155"/>See also</h2></div></div></div><p>In order to learn more about templates, refer to the <em>Creating a new template</em> recipe in <a class="link" title="Chapter 7. Working with Content" href="part0055.xhtml#aid-1KEEU1">Chapter 7</a>, <em>Working with Content</em>
</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Search portlet – basic configuration</h1></div></div></div><p>Let's assume that our intranet contains only articles and files that are distributed between many folders. Our <a id="id494" class="indexterm"/>goal is to configure the Search portlet in order to find only this content. However, our search should display the following facets:</p><div><ul class="itemizedlist"><li class="listitem">Asset type facet</li><li class="listitem">Asset tag and asset category facet</li><li class="listitem">User facet</li><li class="listitem">Time facet</li></ul></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec156"/>Getting ready…</h2></div></div></div><p>To start our journey with searching, our Liferay instance should have some content, such as journal articles, files and folders, users, and so on.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec157"/>How to do it…</h2></div></div></div><p>In order to properly configure the Search portlet using a basic configuration, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in as an <a id="id495" class="indexterm"/>administrator.</li><li class="listitem">Create the search page with one column template.</li><li class="listitem">Go to the <strong>Search</strong> page.</li><li class="listitem">Click on the <strong>Applications</strong> tab on the left site.</li><li class="listitem">Find the <strong>Search</strong> portlet by scrolling or writing inside the text search field.</li><li class="listitem">Click on the <strong>Add</strong> button or drag and drop the portlet in the correct place on the layout.</li><li class="listitem">Go to the <strong>Configuration</strong> mode of the portlet.</li><li class="listitem">Make sure the following options are selected:<div><ul class="itemizedlist"><li class="listitem"><strong>Basic Display Settings</strong></li><li class="listitem"><strong>Display Asset Type facet</strong></li><li class="listitem"><strong>Display Asset Tags facet</strong></li><li class="listitem"><strong>Display Asset Categories facet</strong></li><li class="listitem"><strong>Display folder facet</strong></li><li class="listitem"><strong>View in context</strong> in the <strong>Other Settings</strong> section</li></ul></div></li><li class="listitem">Leave the <strong>Spell check</strong> settings as the default configuration.</li><li class="listitem">Click on the <strong>Save</strong> button and close the popup.</li><li class="listitem">Try typing your keyword in the search form and press <em>Enter</em>. Liferay should display the following results:<div><img src="img/image00361.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec158"/>How it works…</h2></div></div></div><p>Liferay provides a built-in search system based on Lucene. Every entity in Liferay (for instance, web content, document library file entry, blog, message board, and so on) has its own <code class="literal">Indexer</code> class. This class is responsible for parsing contents and putting them into the<a id="id496" class="indexterm"/> search index. When a user uses the search portlet and types a specific keyword, the search engine looks for results in the index.</p><p>The Lucene engine has its own query syntax to query its indexes. Accordingly, the Lucene index looks like a map with keys and values. If users ask about a specific keyword, a query is generated in the background. To browse the Lucene<a id="id497" class="indexterm"/> index, there<a id="id498" class="indexterm"/> is a tool called Luke (<a class="ulink" href="https://code.google.com/p/luke">https://code.google.com/p/luke</a>).</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec159"/>There's more…</h2></div></div></div><p>When we analyze results that the Search Portlet displays, we notice that there are many unnecessary entries, such as users, message boards, and so on. Our assumption was to present web content and document library entities only. Furthermore, we want to disable unused facets such as folder facets. To achieve this result, it is required that you change the faceting configuration. Follow these steps to modify the faceted search:</p><div><ol class="orderedlist arabic"><li class="listitem">Go to the configuration mode of the search portlet.</li><li class="listitem">Check on the <strong>Advanced</strong> option in the <strong>Display Settings</strong> section.</li><li class="listitem">Modify the JSON search configuration. Change the value node using the following lines:<div><pre class="programlisting">"data": {
  "values": [
  "com.liferay.portlet.documentlibrary.model.DLFileEntry",
    "com.liferay.portlet.journal.model.JournalArticle"
    ],
  "frequencyThreshold": 1
}</pre></div></li><li class="listitem">Remove any unnecessary facets:<div><pre class="programlisting">{
  "displayStyle": "folders",
  "weight": 1.2,
  "static": false,
  "order": "OrderHitsDesc",
  "data": {
    "maxTerms": 10,
    "frequencyThreshold": 1,
    "showAssetCount": true
  },
  "label": "folder",
  "className": "com.liferay.portal.kernel.search.facet.MultiValueFacet",
  "fieldName": "folderId"
}</pre></div></li><li class="listitem">Click on the <strong>Save</strong> button.</li><li class="listitem">Close the<a id="id499" class="indexterm"/> popup, perform the same search you did earlier, and look out for the differences.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec160"/>See also</h2></div></div></div><p>For information about managing web content and files, refer to the following recipes:</p><div><ul class="itemizedlist"><li class="listitem">The <em>Managing files in Liferay using Documents and Media portlet</em> recipe in <a class="link" title="Chapter 6. Documents and Media in Liferay" href="part0050.xhtml#aid-1FLS41">Chapter 6</a>, <em>Documents and Media in Liferay</em></li><li class="listitem">The <em>Managing and displaying web contents</em> recipe in <a class="link" title="Chapter 7. Working with Content" href="part0055.xhtml#aid-1KEEU1">Chapter 7</a>, <em>Working with Content</em></li></ul></div><p>For information about tagging and categorizing, refer to the <em>Tagging and categorizing content</em> recipe in this chapter</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec58"/>Solr installation and configuration</h1></div></div></div><p>Apache Solr (<a class="ulink" href="http://lucene.apache.org/solr">http://lucene.apache.org/solr</a>) is a powerful search engine built on Apache Lucene. In<a id="id500" class="indexterm"/> fact, Apache Solr is a standalone enterprise search server with a REST API. The main advantage of this solution is that it can be easily installed as a cloud. Apache <a id="id501" class="indexterm"/>Solr has many other advantages, such as high traffic <a id="id502" class="indexterm"/>volume optimization, administration interfaces, easy monitoring, high scalability and fault tolerance, and more. Refer to the official site at <a class="ulink" href="http://lucene.apache.org/solr/features.html">http://lucene.apache.org/solr/features.html</a> to read about these features.</p><p>Apache Solr supports both a schema mode as well as a schema-free one. The schema is a place where you build an index and define fields that consist of it. The schema-free mode allows users to rapidly construct an effective schema by simply indexing sample data, without having to manually edit the schema. The Liferay plugin called <code class="literal">solr4-web</code> provides schema and Solr configuration. Thus, we will use this configuration to run Solr in a defined schema mode.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec161"/>How to do it…</h2></div></div></div><p>In this recipe, we will show you the simplest way to install and run the Solr server with Liferay.</p><p>First, we need to install Apache Solr 4. The newest Solr 4 version is 4.10.4. Follow these steps to run Solr with the Liferay schema and configuration:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the Apache Solr 4 version (4.10.4) bundled with Jetty from the official site<a id="id503" class="indexterm"/> at <a class="ulink" href="http://archive.apache.org/dist/lucene/solr/">http://archive.apache.org/dist/lucene/solr/</a>.</li><li class="listitem">Unpack <code class="literal">solr-4.10.4.tgz</code> on your local machine:<div><pre class="programlisting">
<strong>tar -xzvf solr-4.10.4.tgz</strong>
</pre></div></li><li class="listitem">Download <a id="id504" class="indexterm"/><code class="literal">solrconfig.xml</code> and <code class="literal">schema.xml</code> from <a id="id505" class="indexterm"/>the official Liferay repository at <a class="ulink" href="https://github.com/liferay/liferay-plugins/tree/6.2.x/webs/solr4-web/docroot/WEB-INF/conf">https://github.com/liferay/liferay-plugins/tree/6.2.x/webs/solr4-web/docroot/WEB-INF/conf</a>.</li><li class="listitem">Copy <code class="literal">solrconfig.xml</code> and <code class="literal">schema xml</code> to <code class="literal">solr-4.10.3/example/solr/collection1/conf</code>.</li><li class="listitem">Run Apache Solr:<div><pre class="programlisting">
<strong>solr-4.10.3/bin/solr start</strong>
</pre></div><p>Solr should print the following message:</p><p>
<code class="literal">Waiting to see Solr listening on port 8983 [/]  </code>
</p><p>
<code class="literal">Started Solr server on port 8983 (pid=2821). Happy searching!</code>
</p></li><li class="listitem">In the<a id="id506" class="indexterm"/> Liferay instance, install the <code class="literal">solr4-web</code> plugin <a id="id507" class="indexterm"/>from the marketplace.</li><li class="listitem">Edit the <code class="literal">tomcat-7.0.42/webapps/solr4-web/WEB-INF/classes/META-INF/solr-spring.xml</code> file and change the <code class="literal">url</code> property in the <code class="literal">com.liferay.portal.search.solr.server.BasicAuthSolrServer</code> bean:<div><pre class="programlisting">&lt;property name="url" value="http://localhost:8983/solr" /&gt;</pre></div></li><li class="listitem">Restart the Liferay instance.</li><li class="listitem">Log in as administrator to the Liferay Portal.</li><li class="listitem">Go to <strong>Admin</strong> | <strong>Control Panel</strong> | <strong>Server Administration</strong> and click on the <strong>Execute</strong> button in the <strong>Reindex all search indexes</strong> section.</li><li class="listitem">In the frontend, add the <strong>Search</strong> page with the <strong>Search</strong> portlet.</li><li class="listitem">Find your data by typing keywords in the <strong>Search</strong> portlet.</li></ol><div></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec162"/>How it works…</h2></div></div></div><p>Apache Solr is a powerful search engine with many configuration files. In order to run Apache Solr and Liferay, we need to override two files: <code class="literal">schema.xml</code> and <code class="literal">solrconfig.xml</code>.</p><p>The first file defines fields and field types that are available in Liferay. The <code class="literal">schema.xml</code> file has two sections: <code class="literal">types</code> and <code class="literal">fields</code>.</p><p>
<code class="literal">The Types</code> section <a id="id508" class="indexterm"/>defines all the possible field types, for instance, Boolean, integer, float, double, and so on. The most important field is text, which is<a id="id509" class="indexterm"/> defined as follows:</p><div><pre class="programlisting">&lt;fieldType class="solr.TextField" name="text" positionIncrementGap="100"&gt;
  &lt;analyzer type="index"&gt;
    &lt;tokenizer class="solr.WhitespaceTokenizerFactory" /&gt;
    &lt;filter class="solr.LowerCaseFilterFactory" /&gt;
    &lt;filter class="solr.RemoveDuplicatesTokenFilterFactory" /&gt;
    &lt;filter class="solr.StopFilterFactory" enablePositionIncrements="true" ignoreCase="true" words="stopwords.txt" /&gt;
    &lt;filter catenateAll="0" catenateNumbers="1" catenateWords="1" class="solr.WordDelimiterFilterFactory" generateNumberParts="1" generateWordParts="1" /&gt;
  &lt;/analyzer&gt;
  &lt;analyzer type="query"&gt;
    &lt;tokenizer class="solr.WhitespaceTokenizerFactory" /&gt;
    &lt;filter class="solr.LowerCaseFilterFactory" /&gt;
    &lt;filter class="solr.RemoveDuplicatesTokenFilterFactory" /&gt;
    &lt;filter class="solr.StopFilterFactory" enablePositionIncrements="true" ignoreCase="true" words="stopwords.txt" /&gt;
    &lt;filter class="solr.SynonymFilterFactory" expand="true" ignoreCase="true" synonyms="synonyms.txt" /&gt;
    &lt;filter catenateAll="0" catenateNumbers="0" catenateWords="0" class="solr.WordDelimiterFilterFactory" generateNumberParts="1" generateWordParts="1" /&gt;
  &lt;/analyzer&gt;
&lt;/fieldType&gt;</pre></div><p>Let's try analyzing this definition:</p><div><ul class="itemizedlist"><li class="listitem">The first line of this definition contains the name of the field type called <code class="literal">text</code> with the <code class="literal">solr.TextField</code> implementing class. The <code class="literal">solr.</code> prefix is shorthand for <code class="literal">org.apache.solr.schema</code> in this case. The <code class="literal">PositionIncrementGap</code> attribute specifies the distance between multiple values, which prevents spurious phrase matches.</li><li class="listitem">The next couple of lines are <code class="literal">index analyzer</code> and <code class="literal">query analyzer</code> definitions. The <code class="literal">index</code> type means that data is analyzed when it is added to the index. The <code class="literal">query</code> type specifies analyzers in the query time (searching).</li></ul></div><p>Now, let's try<a id="id510" class="indexterm"/> and look at the other terms used in the code:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">solr.WhitespaceTokenizerFactory</code>: This splits the text stream on whitespace. Here<a id="id511" class="indexterm"/> is an example:<p>Input: <code class="literal">This is an example</code>
</p><p>Output: <code class="literal">"This", "is", "an", "example"</code>
</p></li><li class="listitem"><code class="literal">solr.LowerCaseFilterFactory</code>: This converts any uppercase letters in a token to the equivalent lowercase token. Here is an example:<p>Input: <code class="literal">"This", "is", "an", "example"</code>
</p><p>Output: <code class="literal">"this", "is", "an", "example"</code>
</p></li><li class="listitem"><code class="literal">solr.RemoveDuplicatesTokenFilterFactory</code>: This removes duplicate tokens in the stream. Here is an example:<p>Input: <code class="literal">"one", "two", "two", "three"</code>
</p><p>Output: <code class="literal">"one", "two", "three"</code>
</p></li><li class="listitem"><code class="literal">solr.StopFilterFactory</code>: This removes tokens that are on the given stopwords list.<div><ul class="itemizedlist"><li class="listitem"><code class="literal">stopwords.txt</code> has words such as <code class="literal">hate</code>, <code class="literal">love</code>. Here is an example:</li></ul></div><p>Input: <code class="literal">"I", "hate", "my", "job"</code>
</p><p>Output: <code class="literal">"I", "my", "job"</code>
</p></li><li class="listitem"><code class="literal">solr.WordDelimiterFilterFactory</code>: This splits tokens with specific rules. Refer to the official Solr documentation at <a class="ulink" href="https://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters#solr.WordDelimiterFilterFactory">https://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters#solr.WordDelimiterFilterFactory</a> to learn about the possible configuration.</li><li class="listitem">The next part of <code class="literal">schema.xml</code> is the fields section. It contains all field definitions. In general, Apache Solr provides three types of fields:<div><ul class="itemizedlist"><li class="listitem"><code class="literal">defining fields</code>: This is a typical, declarative field definition. Every definition has the following attributes:<div><pre class="programlisting">&lt;field indexed="true" name="content" stored="true" termPositions="true" termVectors="true" type="text" /&gt;</pre></div></li><li class="listitem"><code class="literal">copying fields</code>: This is the mechanism for making copies of fields with different analyzers or filters. It is not used in our <code class="literal">schema.xml</code> file.</li><li class="listitem"><code class="literal">dynamic fields</code>: This allows us to define fields without any explicit definition. In our <code class="literal">schema.xml</code>, it is used for multilanguage fields:<div><pre class="programlisting">&lt;dynamicField indexed="true" multiValued="true" name="*_en" stored="true" termPositions="true" termOffsets="true" termVectors="true" type="text_en" /&gt;</pre></div></li></ul></div></li></ul></div><p>Every<a id="id512" class="indexterm"/> field definition can contain the following attributes:</p><div><ul class="itemizedlist"><li class="listitem"><code class="literal">name</code>: The <a id="id513" class="indexterm"/>name of the field</li><li class="listitem"><code class="literal">type</code>: A reference for the field types that are defined in a <code class="literal">&lt;types&gt;</code> section</li><li class="listitem"><code class="literal">default</code>: A default value that will be added automatically to any document that does not have a value</li></ul></div><p>Other attributes are optional. The full list of optional attributes is available in the official Apache Solr documentation at <a class="ulink" href="https://cwiki.apache.org/confluence/display/solr/Defining+Fields">https://cwiki.apache.org/confluence/display/solr/Defining+Fields</a>.</p><p>The next file called <code class="literal">solrconfig.xml</code> is the most important configuration file in the Solr search engine.</p><p>The more commonly used elements in <code class="literal">solrconfig.xml</code> are:</p><div><ul class="itemizedlist"><li class="listitem">Data directory location specifying a location for index data with the <code class="literal">&lt;datadir&gt;</code> parameter</li><li class="listitem">Query and cache settings configured in child elements of the <code class="literal">&lt;query&gt;</code> tag</li><li class="listitem">Request handler <code class="literal">&lt;requestHandle&gt;</code> sections that process requests coming to Solr</li><li class="listitem">Search component <code class="literal">&lt;searchComponent&gt;</code> sections define the logic that is used by <code class="literal">SearchHandler</code> to perform queries for users</li></ul></div><p>All <a id="id514" class="indexterm"/>documentation is available on the official Apache Solr site: <a class="ulink" href="https://cwiki.apache.org/confluence/display/solr/Configuring+solrconfig.xml">https://cwiki.apache.org/confluence/display/solr/Configuring+solrconfig.xml</a>.</p></div></div></body></html>