- en: Chapter 9. Publishing the App for Different Platforms
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following tasks related to publishing and
    future-proofing an app:'
  prefs: []
  type: TYPE_NORMAL
- en: Adding versioning to future proof the app
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building and publishing an app for iOS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Building and publishing an app for Android
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the past, it was very cumbersome to build and successfully publish an app.
    However, there is much documentation and many unofficial instructions on the internet
    today that can pretty much address any problem that you may run into. In addition,
    Ionic also comes with its own CLI to assist in this process. This chapter will
    guide you through the app building and publishing steps at a high level. You will
    learn how to do the following things:'
  prefs: []
  type: TYPE_NORMAL
- en: Add versioning to future proof the app
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Publish your app to App Store or Google Play
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The purpose of this chapter is to provide ideas on what to look for and some
    *gotchas*. Apple and Google are constantly updating their platforms and processes;
    so, the steps may not look exactly the same over time.
  prefs: []
  type: TYPE_NORMAL
- en: Adding versioning to future proof the app
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It's typical that you don't think about keeping track of the app version for
    a particular user. However, as the app grows in the number of users as well as
    releases, you will soon face the problem of update issues and incompatibilities.
    For example, a user may run an old version of your app but all your backend APIs
    are now expecting new parameters from a newer app version. Therefore, you may
    want to think about a strategy to detect the app version locally in order to notify
    the users for an update requirement. This is also helpful if your backend processes
    differently for a specific app version.
  prefs: []
  type: TYPE_NORMAL
- en: 'The app you are going to build is very simple. It will detect the current version
    and store the information in a service. This is the screenshot of the app:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding versioning to future proof the app](img/image00394.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This app example must run on a physical device or a simulator.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Observe the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a new `MyAppVersion` app using the `blank` template, as follows, and
    go to the `MyAppVersion` folder:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Install the `app-version` plugin:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Edit `./config.xml` by changing the version number, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Note that your `widget id` might be different from the one mentioned here. You
    only need to change the version number. In this case, it is the `0.0.123` version.
  prefs: []
  type: TYPE_NORMAL
- en: 'Create the `services` folder inside the app folder, as shown:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Create `myenv.ts` in the `services` folder with the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: This is your only service for this app. In the real-world project, you will
    need multiple services because some of them will have to communicate directly
    with your backend.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Open and edit your .`/src/app/app.module.ts`,as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The main modification in this file is to inject the `MyEnv` provider for the
    entire app.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Open and replace .`/src/pages/home/home.html` with this code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Open and replace `./src/pages/home/home.ts` with the following code:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Open and edit `home.scss` in the same folder:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Go to your terminal and run the app. If you want to run the app on your physical
    device, type the given command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'For Android, type the following command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In a nutshell, the `AppVersion` plugin does all the *heavy lifting*. It's not
    possible for an Ionic app to find out the current version in its code using Javascript.
    You may think that using local storage or cookie is an alternative, but the users
    could also delete that storage manually. In order to have a permanent solution,
    the `AppVersion` plugin should be used because it can read your `config.xml` file
    and get the version for you.
  prefs: []
  type: TYPE_NORMAL
- en: 'It''s the best practice to create a separate service for all environment variables.
    That''s why you should have a service, called `MyEnv`. Also, you should inject
    `MyEnv` as a provider at the *app level* because you want to instantiate it only
    once, instead of doing it every time a new component is created. Observe the following
    code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Since all the `AppVersion` methods are based on `promise`, you should return
    the entire object as a promise. Let''s take a look at the `getAppVersion()` method
    in your `myenv.ts` file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Then, in your page files, such as `home.ts`, you should call the `getAppVersion`
    method, as shown, and use the .`then()` method to get the result:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'If you open the console to inspect the `promise` object, you will see that
    it has your app version value and the `.then()` method. Observe the following
    screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works…](img/image00395.jpeg)'
  prefs: []
  type: TYPE_IMG
- en: For more information about the `AppVersion` plugin, you may want to refer to
    the official AppVersion documentation at [https://github.com/whiteoctober/cordova-plugin-app-version](https://github.com/whiteoctober/cordova-plugin-app-version).
  prefs: []
  type: TYPE_NORMAL
- en: Building and publishing an app for iOS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Publishing on App Store could be a frustrating process if you are not well prepared
    upfront. In this section, you will walk through the steps to properly configure
    everything in Apple Developer Center, iTunes Connect and local Xcode project.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must register for Apple Developer Program in order to access [https://developer.apple.com/macos/touch-bar/](https://developer.apple.com/macos/touch-bar/)
    and [https://itunesconnect.apple.com](https://itunesconnect.apple.com), because
    those websites will require an approved account.
  prefs: []
  type: TYPE_NORMAL
- en: 'In addition, the following instructions a the specific version of these components:'
  prefs: []
  type: TYPE_NORMAL
- en: Mac OS X El Capitan 10.11.2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Xcode 7.2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ionic CLI 2.0
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cordova 5.4.1
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Here are the instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Ensure that you are in the app folder and build for the iOS platform:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Go to the `/platforms/ios` folder to open the `.xcodeproj` file in Xcode. Observe
    the following screenshot:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/image00396.jpeg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Go through the **General** tab, as illustrated in the following screenshot,
    to make sure that you have the correct information for everything, especially
    **Bundle Identifier** and **Version**. Change and save as needed:![How to do it…](img/image00397.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Visit the Apple Developer website and click on **Certificates, Identifiers &
    Profiles**, as illustrated:![How to do it…](img/image00277.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the correct device platform you are targeting. In this case, it will
    be **iOS, tvOS, watchOS** as shown:![How to do it…](img/image00278.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the iOS app, you need the certificate, app ID, test device, and provisioning
    profile. To start with the certificate, navigate to **Certificates** | **All**,
    as follows:![How to do it…](img/image00289.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the (**+**) plus button, as shown in the following screenshot:![How
    to do it…](img/image00398.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You just have to go through the steps in the website to fill out the necessary
    information, as depicted in the following screenshot:![How to do it…](img/image00399.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you've completed the form, you can save the CSR file and import it to your
    Mac's **Keychain Access**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Identifiers** | **App IDs**, as follows, to create an app ID:![How
    to do it…](img/image00279.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the plus (**+**) button at the top right of the screen, as follows:![How
    to do it…](img/image00400.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Fill in the form to register your **App ID**, as shown:![How to do it…](img/image00401.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The important part here that you need to do correctly is the **Bundle ID**,
    as shown in the following screenshot, because it must match your **Bundle Identifier**
    in Xcode:![How to do it…](img/image00402.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If your app needs **Push Notifications** or other **App Services**, you need
    to check those services on the page:![How to do it…](img/image00403.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you need to push the app to a specific device, you must register the device.
    Navigate to **Devices** | **All**, as illustrated:![How to do it…](img/image00301.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the plus (**+**) button, as shown:![How to do it…](img/image00302.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Provide the device **UDID**, as follows, and save it in order to register the
    device:![How to do it…](img/image00303.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, you need a provisioning profile if one doesn't exist yet. Usually,
    Xcode will create one automatically. However, you could create your own by navigating
    to **Provisioning Profiles** | **All**, as shown:![How to do it…](img/image00404.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the plus (**+**) button, as follows:![How to do it…](img/image00405.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select App Store as your provisioning profile, as illustrated:![How to do it…](img/image00406.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the correct **App ID** in the drop-down menu and save to finalize your
    provisioning profile creation, as follows:![How to do it…](img/image00407.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Visit iTunes Connect at [https://itunesconnect.apple.com](https://itunesconnect.apple.com)
    and click on the **My Apps** button, shown as follows:![How to do it…](img/image00408.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the plus (**+**) icon to select **New App**, as shown:![How to do it…](img/image00409.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Fill out the form and ensure that you select the right **Bundle Identifier**
    of your app:![How to do it…](img/image00410.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There are several additional steps to provide information about the app, such
    as screenshot, icon, and address. If you just want to test the app, you could
    provide some place holder information initially and come back to edit later.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: That's it to prepare your Developer and iTunes Connect account.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now, open **Xcode** and select **iOS Device** as the archive target. Otherwise,
    the **Archive** feature will not turn on. You will need to archive your app before
    you can submit to the App Store:![How to do it…](img/image00411.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to **Product** | **Archive** in the top menu, as illustrated:![How
    to do it…](img/image00412.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: After the archive process is completed, select **Submit to App Store** to finish
    the publishing process.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: To publish, select **Submit for Beta App Review**. You may want to go through
    other tabs, such as **Pricing** and **In-App Purchases**, to configure your own
    requirements.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Obviously, this section does not cover every bit of detail in the publishing
    process. In general, you just need to ensure that your app is tested thoroughly,
    locally, on a physical device (either via USB or *TestFlight*) before submitting
    it to the App Store.
  prefs: []
  type: TYPE_NORMAL
- en: 'If for some reason the **Archive** feature doesn''t build, you could manually
    go to your local Xcode folder to delete that specific temporary archived app to
    clear cache, as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*TestFlight* is a separate subject by itself. The benefit of *TestFlight* is
    that you don''t need your app to be approved by Apple in order to install the
    app on a physical device for testing and development. You can find out more information
    about *TestFlight* at [https://developer.apple.com/library/content/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/Chapters/BetaTestingTheApp.html](http://%20https://developer.apple.com/library/content/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/Chapters/BetaTestingTheApp.html).'
  prefs: []
  type: TYPE_NORMAL
- en: Building and publishing an app for Android
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Building and publishing an Android app is a little more straightforward than
    iOS because you just interface with the command line to build the .apk file and
    upload it to Google Play's Developer Console.
  prefs: []
  type: TYPE_NORMAL
- en: The Ionic Framework documentation also has a great instruction page for this,
    which is [http://ionicframework.com/docs/guide/publishing.html](http://ionicframework.com/docs/guide/publishing.html).
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The requirement is to have your Google Developer account ready and to log in
    to [https://play.google.com/apps/publish](https://play.google.com/apps/publish).
  prefs: []
  type: TYPE_NORMAL
- en: Your local environment should also have the right SDK as well as `keytool`,
    `jarsigner`, and `zipalign` command line for that specific version.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Here are the instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Go to your app folder and build for Android with the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You will see the `android-release-unsigned.apk` in the `/platforms/android/build/outputs/apk`
    folder. Go to that folder in the terminal:![How to do it…](img/image00413.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If this is the first time you created this app, you must have a `keystore`
    file. This file is used to identify your app for publishing. If you lose it, you
    cannot update your app later on. To create a `keystore`, type the following command
    line and ensure that it''s the same `keytool` version of the SDK:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Once you fill out the information in the command line, make a copy of this file
    somewhere safe because you will need it later.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The next step is to use that file to *sign* your app so that it will create
    a new `.apk` that Google Play allows users to install:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'To prepare for the final `.apk` before upload, you must package it using `zipalign`,
    as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'You need to ensure that `zipalign` is in `PATH` or you have to specify the
    absolute path. The app name could be anything you like or you can use the same
    name as created in this chapter:'
  prefs: []
  type: TYPE_NORMAL
- en: Log in to Google Developer Console and click on **Add new application**, as
    shown:![How to do it…](img/image00414.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Fill out content rating and other information as possible for your app using
    the left menu:![How to do it…](img/image00415.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now you are ready to upload your `.apk` file. First is to do a Beta:![How to
    do it…](img/image00416.jpeg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you are done with Beta testing, you can follow Developer Console instructions
    to push the app to production.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you run into any problem while publishing the app, it's helpful to look at
    the "Why can't I publish?" link in the dashboard's top right corner. Google will
    guide you on specific steps that must be completed or fixed.
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This section does not cover other Android marketplaces, such as Amazon app store,
    because each of them has different processes. However, the common idea is that
    you need to completely build the unsigned version of the `.apk`, sign it using
    an existing or new `keystore` file, and, finally, `zipa` `lign` to prepare it
    for upload.
  prefs: []
  type: TYPE_NORMAL
