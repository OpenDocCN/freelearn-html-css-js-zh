<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Working with the Different Light Sources Available in Three.js"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Working with the Different Light Sources Available in Three.js</h1></div></div></div><p>In the first chapter, you learned about the basics of Three.js, and in the previous chapter, we looked a bit deeper at the most important parts of the scene: the geometries, meshes, and cameras. You might have noticed that we skipped lights in that chapter even though they make up an important part of every Three.js scene. Without lights, we won't see anything rendered. Since Three.js contains a large number of lights, each of which has a specific use, we'll use this whole chapter to explain the various details of the lights and prepare you for the next chapter on material usage.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>WebGL itself doesn't have inherent support for lighting. Without Three.js, you would have to write specific WebGL shader programs to simulate these kinds of lights. A good<a id="id186" class="indexterm"/> introduction on simulating lighting in WebGL from scratch can be found at <a class="ulink" href="https://developer.mozilla.org/en-US/docs/Web/WebGL/Lighting_in_WebGL">https://developer.mozilla.org/en-US/docs/Web/WebGL/Lighting_in_WebGL</a>.</p></div></div><p>In this chapter, you'll learn about the following subjects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The light sources that are available in Three.js</li><li class="listitem" style="list-style-type: disc">When a specific light source should be used</li><li class="listitem" style="list-style-type: disc">How you can tune and configure the behavior of all these light sources</li><li class="listitem" style="list-style-type: disc">As a bonus, we'll also quickly look at how you can create lens flares</li></ul></div><p>As with all the chapters, we have a lot of examples that you can use to experiment with the lights' behavior. The examples shown in this chapter can be found in the <code class="literal">chapter-03</code> folder of the supplied sources.</p><div class="section" title="Different kinds of lighting provided by Three.js"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Different kinds of lighting provided by Three.js</h1></div></div></div><p>There are a number of<a id="id187" class="indexterm"/> different lights available in Three.js that all have specific behavior and usages. In this chapter, we'll discuss the following set of lights:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.AmbientLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a basic light, the color of which is added to the current color of the<a id="id188" class="indexterm"/> objects<a id="id189" class="indexterm"/> in the scene.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.PointLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a single point in<a id="id190" class="indexterm"/> space from which light spreads in all directions. This<a id="id191" class="indexterm"/> light can't be used to create shadows.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.SpotLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This light source<a id="id192" class="indexterm"/> has a cone-like effect like that of a desk lamp, a spot in the ceiling, or a torch. This<a id="id193" class="indexterm"/> light can cast shadows.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.DirectionalLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is also called infinite light. The light rays from this light can be seen <a id="id194" class="indexterm"/>as parallel, like, for<a id="id195" class="indexterm"/> instance, the light from the sun. This light can also be used to create shadows.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.HemisphereLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a <a id="id196" class="indexterm"/>special light and can be used to create more natural-looking outdoors lighting by simulating a reflective surface and a<a id="id197" class="indexterm"/> faintly illuminating sky. This light also doesn't provide any shadow-related functionality.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.AreaLight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>With this light source, instead of <a id="id198" class="indexterm"/>a single point in space, you can specify an area from which light emanates. <code class="literal">THREE.AreaLight</code> doesn't <a id="id199" class="indexterm"/>cast any shadows.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">THREE.LensFlare</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is not a light<a id="id200" class="indexterm"/> source, but<a id="id201" class="indexterm"/> with <code class="literal">THREE.LensFlare</code>, you can add a lens flare effect to the lights in your scene.</p>
</td></tr></tbody></table></div><p>This chapter is<a id="id202" class="indexterm"/> divided into two main parts. First, we'll look at the basic lights: <code class="literal">THREE.AmbientLight</code>, <code class="literal">THREE.PointLight</code>, <code class="literal">THREE.SpotLight</code>, and <code class="literal">THREE.DirectionalLight</code>. All these lights extend the base <code class="literal">THREE.Light</code> object, which provides shared functionality. The lights mentioned here are simple lights that require little setting up and can be used to recreate most of the required lighting scenarios. In the second part, we will look at a couple of special-purpose lights and effects: <code class="literal">THREE.HemisphereLight</code>, <code class="literal">THREE.AreaLight</code>, and <code class="literal">THREE.LensFlare</code>. You'll probably only need these lights in very specific cases.</p></div></div>
<div class="section" title="Basic lights"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Basic lights</h1></div></div></div><p>We'll start with<a id="id203" class="indexterm"/> the most basic of the lights: <code class="literal">THREE.AmbientLight</code>.</p><div class="section" title="THREE.AmbientLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>THREE.AmbientLight</h2></div></div></div><p>When you <a id="id204" class="indexterm"/>create <code class="literal">THREE.AmbientLight</code>, the color is applied globally. There isn't a specific direction this light comes from, and <code class="literal">THREE.AmbientLight</code> doesn't contribute to any shadows. You <a id="id205" class="indexterm"/>would normally not use <code class="literal">THREE.AmbientLight</code> as the single source of light in a scene since it colors all the objects in the same color, regardless of shape. You use it together with other lighting sources, such as <code class="literal">THREE.SpotLight</code> or <code class="literal">THREE.DirectionalLight</code> to soften the shadows or add some additional color to the scene. The easiest way to understand this is by looking at the <code class="literal">01-ambient-light.html</code> example in the <code class="literal">chapter-03</code> folder. With this example, you get a simple user interface that can be used to modify <code class="literal">THREE.AmbientLight</code> that is available in this scene. Note that in this scene, we also have <code class="literal">THREE.SpotLight</code>, which adds additional lighting and provides shadows.</p><p>In the following screenshot, you can see that we used the scene from the first chapter and made the color of <code class="literal">THREE.AmbientLight</code> configurable. In this example, you can also turn off the spotlight to see what the effect of <code class="literal">THREE.AmbientLight</code> is on its own:</p><div class="mediaobject"><img src="graphics/2215OS_03_01.jpg" alt="THREE.AmbientLight"/></div><p>The standard color we use in this scene is <code class="literal">#0c0c0c</code>. This is a hexadecimal representation of a color. The first two values specify the red part of the color, the next two values specify the green part, and the last two values specify the blue part.</p><p>In this example, we use a very dimmed light-gray color that we mainly use to smoothen the hard shadows our meshes cast to the ground plane. You can change the color to a more prominent <a id="id206" class="indexterm"/>yellow/orange color (<code class="literal">#523318</code>) with the menu in the top-right corner, and then the objects will have a sun-like glow over them. This is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2215OS_03_02.jpg" alt="THREE.AmbientLight"/></div><p>As the preceding image shows, the yellow/orange color is applied to all the objects and casts a green glow over the complete scene. What you should remember when working with this light is that<a id="id207" class="indexterm"/> you should be very conservative with the color you specify. If the color you specify is too bright, you'll quickly get a completely oversaturated image.</p><p>Now that we've seen what it does, let's look at how you can create and use <code class="literal">THREE.AmbientLight</code>. The next couple of lines of code show you how to create <code class="literal">THREE.AmbientLight</code> and also show how to connect this to the GUI control menu, which we will introduce in <a class="link" href="ch11.html" title="Chapter 11. Custom Shaders and Render Postprocessing">Chapter 11</a>, <span class="emphasis"><em>Custom Shaders and Render Post Processing</em></span>:</p><div class="informalexample"><pre class="programlisting">var ambiColor = "#0c0c0c";
var ambientLight = new THREE.AmbientLight(ambiColor);
scene.add(ambientLight);
...

var controls = new function() {
  this.ambientColor = ambiColor  ;
}

var gui = new dat.GUI();
gui.addColor(controls, 'ambientColor').onChange(function(e) {
  ambientLight.color = new THREE.Color(e);
});</pre></div><p>Creating <code class="literal">THREE.AmbientLight</code> is very simple and only takes a couple of steps. <code class="literal">THREE.AmbientLight</code> doesn't have a position and is applied globally, so we only need to specify the color (in hex), <code class="literal">new THREE.AmbientLight(ambiColor)</code>, and add this light to the scene, <code class="literal">scene.add(ambientLight)</code>. In the example, we bind the color of <code class="literal">THREE.AmbientLight</code> to the control menu. To do this, you can use the same kind of configuration we used in the previous two chapters. The only change is that instead of using the <code class="literal">gui.add(...)</code> function, we use the <code class="literal">gui.addColor(...)</code> function. This creates an option in the<a id="id208" class="indexterm"/> control menu, with which we can directly change the color of the passed-in variable. In the code, you can see that we use the <code class="literal">onChange</code> feature of dat.GUI: <code class="literal">gui.addColor(...).onChange(function(e){...})</code>. With this function, we tell <code class="literal">dat.GUI</code> to call the passed-in function each time the color changes. In this specific case, we set the color of <code class="literal">THREE.AmbientLight</code> to a new value.</p><div class="section" title="Using the THREE.Color object"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec05"/>Using the THREE.Color object</h3></div></div></div><p>Before we move on to the next light, here's a quick note on using the <code class="literal">THREE.Color</code> object. In Three.js, when you construct an<a id="id209" class="indexterm"/> object, you can (usually) specify the color as either a hex string (<code class="literal">"#0c0c0c"</code>) or a hex <a id="id210" class="indexterm"/>value (<code class="literal">0x0c0c0c</code>), which is the preferred way of doing it, or by specifying the individual RGB values (<code class="literal">0.3</code>, <code class="literal">0.5</code>, <code class="literal">0.6</code>) on a scale of 0 to 1. If you want to change the color after construction, you'll have to create a new <code class="literal">THREE.Color</code> object or modify the internal properties of the current <code class="literal">THREE.Color</code> object. The <code class="literal">THREE.Color</code> object comes with the following functions to set and get information about the current object:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">set(value)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the value of this color to the supplied hex value. This hex value may be <a id="id211" class="indexterm"/>a string, a number, or an existing <code class="literal">THREE.Color</code> instance.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">setHex(value)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the <a id="id212" class="indexterm"/>value of this color to the supplied numeric hex value.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">setRGB(r,g,b)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the value<a id="id213" class="indexterm"/> of this color based on the supplied RGB values. The values range from 0 to 1.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">setHSL(h,s,l)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the <a id="id214" class="indexterm"/>value of this color on the supplied HSL values. The values range from 0 to 1. A good explanation of how<a id="id215" class="indexterm"/> HSL works for configuring <a id="id216" class="indexterm"/>colors can be found at <a class="ulink" href="http://en.wikibooks.org/wiki/Color_Models:_RGB,_HSV,_HSL">http://en.wikibooks.org/wiki/Color_Models:_RGB,_HSV,_HSL</a>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">setStyle(style)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Set the value<a id="id217" class="indexterm"/> of this color based on the CSS way of specifying colors. For instance, you could use <code class="literal">"rgb(255,0,0)"</code>, <code class="literal">"#ff0000"</code>, <code class="literal">"#f00"</code>, or even <code class="literal">"red"</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">copy(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Copy the <a id="id218" class="indexterm"/>color values from the <code class="literal">THREE.Color</code> instance provided to this color.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">copyGammaToLinear(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id219" class="indexterm"/> mostly used internally.</p>
<p>Set the color of this object based on the <code class="literal">THREE.Color</code> instance supplied. The color is first converted from the gamma color space to the linear color space. The gamma color space also uses RGB values, but uses an exponential scale instead of a linear one. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">copyLinearToGamma(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id220" class="indexterm"/> mostly used internally.</p>
<p>Set the color of this object based on the <code class="literal">THREE.Color</code> instance supplied. The color is first converted from the linear color space to the gamma color space.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">convertGammaToLinear()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This converts the <a id="id221" class="indexterm"/>current color from the gamma color space to the linear color space.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">convertLinearToGamma()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This converts the <a id="id222" class="indexterm"/>current color from the linear color space to the gamma color space.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getHex()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Return the value<a id="id223" class="indexterm"/> from this color object as a number: <code class="literal">435241</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getHexString()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Return the <a id="id224" class="indexterm"/>value from this color object as a hex string:<code class="literal"> "0c0c0c"</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getStyle()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Return the value<a id="id225" class="indexterm"/> from this color object as a CSS-based value: <code class="literal">"rgb(112,0,0)"</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getHSL(optionalTarget)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Return the <a id="id226" class="indexterm"/>value from this color object as a HSL value. If you provide the <code class="literal">optionalTarget</code> object, Three.js will set the <code class="literal">h</code>, <code class="literal">s</code>, and <code class="literal">l</code> properties on that object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">offsetHSL(h, s, l)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Add the <code class="literal">h</code>, <code class="literal">s</code>, and <code class="literal">l</code> values <a id="id227" class="indexterm"/>provided to the <code class="literal">h</code>, <code class="literal">s</code>, and <code class="literal">l</code> values of the current color.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id228" class="indexterm"/>adds the <code class="literal">r</code>, <code class="literal">g</code>, and <code class="literal">b</code> values of the color supplied to the current color.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">addColors(color1, color2)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is mostly used internally.</p>
<p>Add <code class="literal">color1</code> and <code class="literal">color2</code>, and set the value of the current color to the result.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">addScalar(s)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id229" class="indexterm"/> mostly used internally.</p>
<p>Add a value to the RGB components of the current color. Bear in mind that the internal values use a range from 0 to 1.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">multiply(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is mostly <a id="id230" class="indexterm"/>used internally.</p>
<p>Multiply the current RGB values with the RGB values from <code class="literal">THREE.Color</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">multiplyScalar(s)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is <a id="id231" class="indexterm"/>mostly used internally.</p>
<p>This multiplies<a id="id232" class="indexterm"/> the current RGB values with the value supplied. Bear in mind that the internal values use a range from 0 to 1.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">lerp(color, alpha)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is <a id="id233" class="indexterm"/>mostly used internally.</p>
<p>This finds the color that is between the color of this object and the color supplied. The alpha property defines how far between the current color and the supplied color you want the result to be.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">equals(color)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This returns <code class="literal">true</code> if the RGB values of the <code class="literal">THREE.Color</code> instance <a id="id234" class="indexterm"/>supplied match the values of the current color.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">fromArray(array)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This has<a id="id235" class="indexterm"/> the same functionality as <code class="literal">setRGB</code>, but now the RGB values can be provided as an array of numbers.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">toArray</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This returns <a id="id236" class="indexterm"/>an array with three elements, <code class="literal">[r, g, b]</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">clone()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates <a id="id237" class="indexterm"/>an exact copy of this color.</p>
</td></tr></tbody></table></div><p>In this table, you can see that there are many ways in which you can change the current color. A lot of these functions are used internally by Three.js, but they also provide a good way to easily change the color of lights and materials.</p><p>Before we move on to the discussion on <code class="literal">THREE.PointLight</code>, <code class="literal">THREE.SpotLight</code>, and <code class="literal">THREE.DirectionalLight</code>, let's first highlight their main difference, that is, how they emit light. The following diagram shows how these three light sources emit light:</p><div class="mediaobject"><img src="graphics/2215OS_03_03.jpg" alt="Using the THREE.Color object"/></div><p>You can see the following from this diagram:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">THREE.PointLight</code> emits light from a specific point in all directions</li><li class="listitem" style="list-style-type: disc"><code class="literal">THREE.SpotLight</code> emits light from a specific point in a cone-like shape</li><li class="listitem" style="list-style-type: disc"><code class="literal">THREE.DirectionalLight</code> doesn't emit light <a id="id238" class="indexterm"/>from a single point, but emits light rays from a 2D plane, where the rays are parallel to each other</li></ul></div><p>We'll look at these light sources in more detail in the next couple of paragraphs; let's start with <code class="literal">THREE.Pointlight</code>.</p></div></div><div class="section" title="THREE.PointLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>THREE.PointLight</h2></div></div></div><p>
<code class="literal">THREE.PointLight</code> in Three.js is a<a id="id239" class="indexterm"/> light source that shines light in all directions emanating from a single point. A good example of a point light is a signal flare fired in the night sky. Just as<a id="id240" class="indexterm"/> with all the lights, we have a specific example you can use to play around with <code class="literal">THREE.PointLight</code>. If you look at <code class="literal">02-point-light.html</code> in the <code class="literal">chapter-03</code> folder, you can find an example where a <code class="literal">THREE.PointLight</code> light is moving around a simple Three.js scene. The following screenshot shows an example of this:</p><div class="mediaobject"><img src="graphics/2215OS_03_04.jpg" alt="THREE.PointLight"/></div><p>In this example, <code class="literal">THREE.PointLight</code> moves around the scene we already saw in <a class="link" href="ch01.html" title="Chapter 1. Creating Your First 3D Scene with Three.js">Chapter 1</a>, <span class="emphasis"><em>Create Your First 3D Scene with Three.js</em></span>. To make it more clear where <code class="literal">THREE.PointLight</code> is, we move a small orange sphere along the same path. As this light moves around, you'll see the red cube and blue sphere being illuminated by this light on different sides.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>You might notice that we don't see any shadows in this example. In Three.js, <code class="literal">THREE.PointLight</code> doesn't cast shadows. Since <code class="literal">THREE.PointLight</code> emits light in all directions, calculating shadows is a very heavy process for the GPU.</p></div></div><p>With the <code class="literal">THREE.AmbientLight</code> we saw earlier, all you had to do was provide <code class="literal">THREE.Color</code> and add the light to the scene. With <code class="literal">THREE.PointLight</code>, however, we have a couple of additional configuration options:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">color</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id241" class="indexterm"/>color of the light.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">distance</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id242" class="indexterm"/> distance for which the light shines. The default value is <code class="literal">0</code>, which means that the light's intensity doesn't decrease based on distance.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">intensity</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id243" class="indexterm"/> intensity the light shines with. This defaults to <code class="literal">1</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">position</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id244" class="indexterm"/> the position of the light in <code class="literal">THREE.Scene</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">visible</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If this <a id="id245" class="indexterm"/>property is set to <code class="literal">true</code> (the default), this light is turned on, and if set it to <code class="literal">false</code>, the light is turned off. </p>
</td></tr></tbody></table></div><p>In the next couple of examples and screenshots, we'll explain these properties. First, let's look at how you can create <code class="literal">THREE.PointLight</code>:</p><div class="informalexample"><pre class="programlisting">var pointColor = "#ccffcc";
var pointLight = new THREE.PointLight(pointColor);
pointLight.position.set(10,10,10);
scene.add(pointLight);</pre></div><p>We create a light with a specific <code class="literal">color</code> property (here we use a string value; we could have also used a number or <code class="literal">THREE.Color</code>), set its <code class="literal">position</code> property, and add it to the scene.</p><p>The first property we'll look at is <code class="literal">intensity</code>. With this property, you can set how brightly the light shines. If you set this to <code class="literal">0</code>, you won't see anything; set it to <code class="literal">1</code>, and you've got the default <a id="id246" class="indexterm"/>brightness; set it to <code class="literal">2</code>, and you get a light that shines twice as bright; and so on. In the following screenshot, for instance, we set the intensity of the light to <code class="literal">2.4</code>:</p><div class="mediaobject"><img src="graphics/2215OS_03_05.jpg" alt="THREE.PointLight"/></div><p>All you have to do to change the intensity of the light is use the intensity property of <code class="literal">THREE.PointLight</code>, as follows:</p><div class="informalexample"><pre class="programlisting">pointLight.intensity = 2.4;</pre></div><p>Or you can use the dat.GUI listener, like this:</p><div class="informalexample"><pre class="programlisting">var controls = new function() {
  this.intensity = 1;
}
var gui = new dat.GUI();
  gui.add(controls, 'intensity', 0, 3).onChange(function (e) {
    pointLight.intensity = e;
  });</pre></div><p>The <code class="literal">distance</code> property of <code class="literal">PointLight</code> is a very interesting one and is best explained with an example. In the<a id="id247" class="indexterm"/> following screenshot, you see the same scene again, but this time with a very high <code class="literal">intensity</code> property (we have a very bright light), but with a small <code class="literal">distance</code>:</p><div class="mediaobject"><img src="graphics/2215OS_03_06.jpg" alt="THREE.PointLight"/></div><p>The <code class="literal">distance</code> property of <code class="literal">SpotLight</code> determines how far the light travels from the source before its intensity property is 0. You can set this property like this: <code class="literal">pointLight.distance = 14</code>. In the preceding screenshot, the light's brightness slowly decreases to <code class="literal">0</code> at a distance of <code class="literal">14</code>. That's why, in the example, you can still see a brightly lit cube, but the light <a id="id248" class="indexterm"/>won't reach the blue sphere. The default value for the <code class="literal">distance</code> property is <code class="literal">0</code>, which means that the light won't decay over a distance.</p></div><div class="section" title="THREE.SpotLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>THREE.SpotLight</h2></div></div></div><p>
<code class="literal">THREE.SpotLight</code> is one<a id="id249" class="indexterm"/> of the lights you'll use most often (especially if you want to use shadows). <code class="literal">THREE.SpotLight</code> is a light source that has a cone-like effect. You <a id="id250" class="indexterm"/>can compare this with a flashlight or a lantern. This light has a direction and an angle at which it produces light. The following table lists all the properties that apply to <code class="literal">THREE.SpotLight</code>:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">angle</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This determines<a id="id251" class="indexterm"/> how wide the beam emerging from this light is. This is measured in radians and defaults to <code class="literal">Math.PI/3</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">castShadow</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If set to<a id="id252" class="indexterm"/> <code class="literal">true</code>, this light will cast shadows.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">color</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id253" class="indexterm"/> color of the light.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">distance</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id254" class="indexterm"/> distance up to which the light shines. The default value is <code class="literal">0</code>, which means that the light's intensity doesn't decrease based on distance.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">exponent</code>
</p>
</td><td style="text-align: left" valign="top">
<p>With <code class="literal">THREE.SpotLight</code>, the emitted light's intensity decreases the further away you are from the source. The <code class="literal">exponent</code> property determines<a id="id255" class="indexterm"/> how quickly this intensity decreases. With a low value, the light emitted from this<a id="id256" class="indexterm"/> source will reach faraway objects, while with a high value, it will only reach objects that are very near to <code class="literal">THREE.SpotLight</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">intensity</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id257" class="indexterm"/> intensity the light shines with. This defaults to 1.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">onlyShadow</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If this<a id="id258" class="indexterm"/> property is set to <code class="literal">true</code>, this light will only cast a shadow and won't add any light to the scene.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">position</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is<a id="id259" class="indexterm"/> the position of the light in <code class="literal">THREE.Scene</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowBias</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The shadow<a id="id260" class="indexterm"/> bias moves the cast shadow away or towards the object casting the shadow. You can use this to solve some strange effects when you work with very thin objects (a good example can be found at <a class="ulink" href="http://www.3dbuzz.com/training/view/unity-fundamentals/lights/8-shadows-bias">http://www.3dbuzz.com/training/view/unity-fundamentals/lights/8-shadows-bias</a>). If you see strange shadow effects, small values (for example, <code class="literal">0.01</code>) for this property can often resolve the issue. The default value for this property is <code class="literal">0</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowCameraFar</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id261" class="indexterm"/> determines what distance from the light shadows should be created. The default value is <code class="literal">5,000</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowCameraFov</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id262" class="indexterm"/>determines how large the field of view used to create shadows is (see the <span class="emphasis"><em>Different cameras for different uses</em></span> section in <a class="link" href="ch02.html" title="Chapter 2. Basic Components That Make Up a Three.js Scene">Chapter 2</a>, <span class="emphasis"><em>Basic Components That Make Up a Three.js Scene</em></span>). The default value is <code class="literal">50</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowCameraNear</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id263" class="indexterm"/> determines what distance from the light shadows should be created. The default value is <code class="literal">50</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowCameraVisible</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If this is<a id="id264" class="indexterm"/> set to <code class="literal">true</code>, you can see how and where this light source casts a shadow (see the example in the next section). The default value is <code class="literal">false</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowDarkness</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This defines<a id="id265" class="indexterm"/> how dark the shadow is rendered. This can't be changed after the scene is rendered. The default value is <code class="literal">0.5</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">shadowMapWidth</code> and <code class="literal">shadowMapHeight</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id266" class="indexterm"/>determines how many pixels are used to create the shadow. Increase this when<a id="id267" class="indexterm"/> the shadow has jagged edges or doesn't look smooth. This can't be changed after the scene is rendered. The default value for both is <code class="literal">512</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">target</code>
</p>
</td><td style="text-align: left" valign="top">
<p>With <code class="literal">THREE.SpotLight</code>, the direction<a id="id268" class="indexterm"/> it is pointed in is important. With the <code class="literal">target</code> property, you can point <code class="literal">THREE.SpotLight</code> to look at a specific object or position in the scene. Note that this property requires a <code class="literal">THREE.Object3D</code> object (like <code class="literal">THREE.Mesh</code>). This is in contrast to the cameras we saw in the previous chapter that use <code class="literal">THREE.Vector3</code> in their <code class="literal">lookAt</code> function.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">visible</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If this is<a id="id269" class="indexterm"/> set to <code class="literal">true</code> (the default), this light is turned on, and if this is set to <code class="literal">false</code>, the light is turned off. </p>
</td></tr></tbody></table></div><p>Creating <code class="literal">THREE.SpotLight</code> is <a id="id270" class="indexterm"/>very easy. Just specify the color, set the properties you want, and add it to the scene, as follows:</p><div class="informalexample"><pre class="programlisting">var pointColor = "#ffffff";
var spotLight = new THREE.SpotLight(pointColor);
spotLight.position.set(-40, 60, -10);
spotLight.castShadow = true;
spotLight.target = plane;
scene.add(spotLight);</pre></div><p>
<code class="literal">THREE.SpotLight</code> is not very different from <code class="literal">THREE.PointLight</code>. The only difference is that we set the <code class="literal">castShadow</code> property to <code class="literal">true</code> because we want shadows, and we need to set the <code class="literal">target</code> property for this <code class="literal">SpotLight</code>. The <code class="literal">target</code> property determines where the light is aimed at. In this case, we point it at the object named <code class="literal">plane</code>. When you run the example (<code class="literal">03-spot-light.html</code>), you'll see a scene like the following screenshot:</p><div class="mediaobject"><img src="graphics/2215OS_03_07.jpg" alt="THREE.SpotLight"/></div><p>In this example, you can set a number of properties specific to <code class="literal">THREE.SpotLight</code>. One of them is the <code class="literal">target</code> property. If we set this property to the blue sphere, the light will focus at the center of the sphere even if it moves around the scene. When we created the light, we aimed it at the<a id="id271" class="indexterm"/> ground plane, and in our example, we can also aim it at the other two objects. But what if you don't want to aim the light at a specific object, but rather at an arbitrary point in space? You can do that by creating a <code class="literal">THREE.Object3D()</code> object like this:</p><div class="informalexample"><pre class="programlisting">var target = new THREE.Object3D();
target.position = new THREE.Vector3(5, 0, 0);</pre></div><p>Then, set the target property of <code class="literal">THREE.SpotLight</code>:</p><div class="informalexample"><pre class="programlisting">spotlight.target = target</pre></div><p>In the table at the beginning of this section, we showed a couple of properties that can be used to control how the light emanates from <code class="literal">THREE.SpotLight</code>. The <code class="literal">distance</code> and <code class="literal">angle</code> properties define the shape of the cone of light. The <code class="literal">angle</code> property defines the width of the cone, and with the <code class="literal">distance</code> property, we set the length of the cone. The following figure explains how these two values together define the area that will receive light from <code class="literal">THREE.SpotLight</code>:</p><div class="mediaobject"><img src="graphics/2215OS_03_08.jpg" alt="THREE.SpotLight"/></div><p>Usually, you won't really need to set these values since they come with reasonable defaults, but you can use<a id="id272" class="indexterm"/> these properties, for instance, to create a <code class="literal">THREE.SpotLight</code> that has a very narrow beam or quickly decreases in light intensity. The last property you can use to change the way <code class="literal">THREE.SpotLight</code> produces light is the <code class="literal">exponent</code> property. With this property, you set how fast the light intensity decreases from the center of the light cone towards the edges of the cone. In the following image, you can see the result of the <code class="literal">exponent</code> property in action. We have a very bright light (high <code class="literal">intensity</code>) that rapidly decreases in intensity (high <code class="literal">exponent</code>) as it moves from the center towards the sides of the cone:</p><div class="mediaobject"><img src="graphics/2215OS_03_09.jpg" alt="THREE.SpotLight"/></div><p>You could use this to highlight a specific object or simulate a small flashlight. We could also have created the same focused beam effect using a small <code class="literal">exponent</code> value and <code class="literal">angle</code>. On a cautionary note on this second approach, remember that a very small angle can quickly lead to all kinds of rendering artifacts (an artifact is a term used in graphics for unwanted distortions and strangely rendered parts of the screen).</p><p>Before moving on to the<a id="id273" class="indexterm"/> next light, we'll quickly look at the shadow-related properties available to <code class="literal">THREE.SpotLight</code>. You've already learned that we can get shadows by setting the <code class="literal">castShadow</code> property of <code class="literal">THREE.SpotLight</code> to <code class="literal">true</code> (and, of course, making sure that we set the <code class="literal">castShadow</code> property for objects that should cast shadows, and that we cast the <code class="literal">receiveShadow</code> property, for objects that should show a shadow, on the <code class="literal">THREE.Mesh</code> objects in our scene). Three.js also allows you very fine-grained control on how the shadow is rendered. This is done by a couple of properties we explained in the table at the beginning of the section. With <code class="literal">shadowCameraNear</code>, <code class="literal">shadowCameraFar</code>, and <code class="literal">shadowCameraFov</code>, you can control how and where this light casts a shadow. This works in the same way as the perspective camera's field of view we explained in the preceding chapter. The easiest way to see this in action is by setting <code class="literal">shadowCameraVisible</code> to <code class="literal">true</code>; you can do this by checking the menu's debug checkbox. This shows, as you can see in the following screenshot, the area that is used to determine<a id="id274" class="indexterm"/> the shadows for this light:</p><div class="mediaobject"><img src="graphics/2215OS_03_10.jpg" alt="THREE.SpotLight"/></div><p>I'll end this section with a couple of pointers, just in case you run into issues with shadows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Enable the <code class="literal">shadowCameraVisible</code> property. This shows the area that is affected by this light for shadow purposes.</li><li class="listitem" style="list-style-type: disc">If the shadow looks blocky, you can either increase the <code class="literal">shadowMapWidth</code> and <code class="literal">shadowMapHeight</code> properties or make sure the area that is used to calculate the shadow tightly wraps your object. You can use the <code class="literal">shadowCameraNear</code>, <code class="literal">shadowCameraFar</code>, and <code class="literal">shadowCameraFov</code> properties to configure this area.</li><li class="listitem" style="list-style-type: disc">Remember that you not only have to tell the light to cast shadows, but also have to tell each geometry whether it will receive and/or cast shadows by setting the <code class="literal">castShadow</code> and <code class="literal">receiveShadow</code> properties.</li><li class="listitem" style="list-style-type: disc">If you use thin objects in your scene, you might see strange artifacts when you render shadows. You can use the <code class="literal">shadowBias</code> property to slightly offset the shadows, which will often fix these kinds of issues.</li><li class="listitem" style="list-style-type: disc">You can change<a id="id275" class="indexterm"/> the darkness of the shadow cast by setting the <code class="literal">shadowDarkness</code> property. If your shadows are too dark or not dark enough, changing this property allows you to fine-tune how the shadows are rendered.</li><li class="listitem" style="list-style-type: disc">If you want to have softer shadows, you can set a different <code class="literal">shadowMapType value</code> on <code class="literal">THREE.WebGLRenderer</code>. By default, this property is set to <code class="literal">THREE.PCFShadowMap</code>; if you set this property to <code class="literal">PCFSoftShadowMap</code>, you get softer shadows.</li></ul></div></div><div class="section" title="THREE.DirectionalLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec24"/>THREE.DirectionalLight</h2></div></div></div><p>The last of the basic<a id="id276" class="indexterm"/> lights we will look at is <code class="literal">THREE.DirectionalLight</code>. This type of light can be considered as a light that is very far away. All the light rays it sends out are parallel to each other. A good example of this is the sun. The sun is so far away that the light<a id="id277" class="indexterm"/> rays we receive on earth are (almost) parallel to each other. The main difference between <code class="literal">THREE.DirectionalLight</code> and <code class="literal">THREE.SpotLight</code> (which we saw in the previous section) is that this light won't diminish the farther it gets from the target of <code class="literal">THREE.DirectionalLight</code> as it does with <code class="literal">THREE.SpotLight</code> (you can fine-tune this with the <code class="literal">distance</code> and <code class="literal">exponent</code> parameters). The complete area that is lit by <code class="literal">THREE.DirectionalLight</code> receives the same intensity of light.</p><p>To see this in action, look at the <code class="literal">04-directional-light</code> example, which is shown here:</p><div class="mediaobject"><img src="graphics/2215OS_03_11.jpg" alt="THREE.DirectionalLight"/></div><p>As you can see in the preceding image, there isn't a cone of light that is applied to the scene. Everything receives the same amount of light. Only the direction, the color, and the intensity of the light is used to calculate the colors and shadows.</p><p>Just as with <code class="literal">THREE.SpotLight</code>, there are a couple of properties you can set that control the intensity of the<a id="id278" class="indexterm"/> light and the way it casts shadows. <code class="literal">THREE.DirectionalLight</code> has a lot of properties that are the same as those of <code class="literal">THREE.SpotLight</code>: <code class="literal">position</code>, <code class="literal">target</code>, <code class="literal">intensity</code>, <code class="literal">distance</code>, <code class="literal">castShadow</code>, <code class="literal">onlyShadow</code>, <code class="literal">shadowCameraNear</code>, <code class="literal">shadowCameraFar</code>, <code class="literal">shadowDarkness</code>, <code class="literal">shadowCameraVisible</code>, <code class="literal">shadowMapWidth</code>, <code class="literal">shadowMapHeight</code>, and <code class="literal">shadowBias</code>. For information on those properties, you can look at the preceding section on <code class="literal">THREE.SpotLight</code>. The few additional properties are discussed in the next couple of paragraphs.</p><p>If you look back at the <code class="literal">THREE.SpotLight</code> examples, you can see that we had to define the cone of light where shadows were applied. Since, for <code class="literal">THREE.DirectionalLight</code>, all the rays are parallel to each other, we don't have a cone of light, instead, we have a cuboid area, as you can see in the following screenshot (if you want to see this for yourself, move the camera further away from the scene):</p><div class="mediaobject"><img src="graphics/2215OS_03_12.jpg" alt="THREE.DirectionalLight"/></div><p>Everything that falls within this cube can cast and receive shadows from the light. Just as for <code class="literal">THREE.SpotLight</code>, the tighter <a id="id279" class="indexterm"/>you define this area around the objects, the better your shadows will look. Define this cube using the following properties:</p><div class="informalexample"><pre class="programlisting">directionalLight.shadowCameraNear = 2;
directionalLight.shadowCameraFar = 200;
directionalLight.shadowCameraLeft = -50;
directionalLight.shadowCameraRight = 50;
directionalLight.shadowCameraTop = 50;
directionalLight.shadowCameraBottom = -50;</pre></div><p>You can compare this with the way we configured the orthographic camera in the section on cameras in <a class="link" href="ch02.html" title="Chapter 2. Basic Components That Make Up a Three.js Scene">Chapter 2</a>, <span class="emphasis"><em>Basic Components That Make Up a Three.js Scene</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>There is<a id="id280" class="indexterm"/> one property that is available to <code class="literal">THREE.DirectionalLight</code> that we haven't addressed yet: <code class="literal">shadowCascade</code>. This property can be used to create better shadows when you want to use shadows on a large area with <code class="literal">THREE.DirectionalLight</code>. If you set the property to <code class="literal">true</code>, Three.js will use an alternative approach to generate the shadows. It splits the shadow generation up to the value specified by <code class="literal">shadowCascadeCount</code>. This will result in more detailed shadows close to the viewpoint of the camera and less detailed shadows<a id="id281" class="indexterm"/> far away. To use this, you'll have to experiment with the settings for <code class="literal">shadowCascadeCount</code>, <code class="literal">shadowCascadeBias</code>, <code class="literal">shadowCascadeWidth</code>, <code class="literal">shadowCascadeHeight</code>, <code class="literal">shadowCascadeNearZ</code>, and <code class="literal">shadowCascadeFarZ</code>. You can find an example where this setup is used at <a class="ulink" href="http://alteredqualia.com/three/examples/webgl_road.html">http://alteredqualia.com/three/examples/webgl_road.html</a>.</p></div></div></div></div>
<div class="section" title="Special lights"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Special lights</h1></div></div></div><p>In this section on<a id="id282" class="indexterm"/> special lights, we'll discuss two additional lights provided by Three.js. First, we'll discuss <code class="literal">THREE.HemisphereLight</code>, which helps in creating more natural lighting for outdoor scenes, then we'll look at <code class="literal">THREE.AreaLight</code>, which emits lights from a large area instead of a <a id="id283" class="indexterm"/>single point, and finally, we'll show you how you can add a lens flare effect to your scene.</p><div class="section" title="THREE.HemisphereLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>THREE.HemisphereLight</h2></div></div></div><p>The first special light we're going to look at is <code class="literal">THREE.HemisphereLight</code>. With <code class="literal">THREE.HemisphereLight</code>, we can create more natural-looking outdoor lighting. Without this light, we <a id="id284" class="indexterm"/>could simulate the outdoors by creating <code class="literal">THREE.DirectionalLight</code>, which emulates the sun, and maybe add additional <code class="literal">THREE.AmbientLight</code> to provide some general color to the scene. This, however, won't look<a id="id285" class="indexterm"/> really natural. When you're outdoors, not all the light comes directly from above: much is diffused by the atmosphere and reflected by the ground and other objects. <code class="literal">THREE.HemisphereLight</code> in Three.js is created for this scenario. This is an easy way to get more natural-looking outdoor lighting. To see an example, look at <code class="literal">05-hemisphere-light.html</code>:</p><div class="mediaobject"><img src="graphics/2215OS_03_13.jpg" alt="THREE.HemisphereLight"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Note that this is the first example that loads additional resources and can't run directly from your local filesystem. So if you haven't done so, look at <a class="link" href="ch01.html" title="Chapter 1. Creating Your First 3D Scene with Three.js">Chapter 1</a>, <span class="emphasis"><em>Create Your First 3D Scene with Three.js</em></span>, to find out how to set up a local web server or disable the security settings in your browser to make loading external resources work.</p></div></div><p>In this example, you can turn <code class="literal">THREE.HemisphereLight</code> on and off and set the colors and intensity. Creating<a id="id286" class="indexterm"/> a hemisphere light is just as <a id="id287" class="indexterm"/>easy as creating any of the other lights:</p><div class="informalexample"><pre class="programlisting">var hemiLight = new THREE.HemisphereLight(0x0000ff, 0x00ff00, 0.6);
hemiLight.position.set(0, 500, 0);
scene.add(hemiLight);</pre></div><p>You just specify the color that is received from the sky, the color received from the ground, and the intensity of these lights. If you want to change these values later on, you can access them through the following properties:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">groundColor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the color that is<a id="id288" class="indexterm"/> emitted from the ground</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">color</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the <a id="id289" class="indexterm"/>color that is emitted from the sky</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">intensity</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the<a id="id290" class="indexterm"/> intensity with which the light shines</p>
</td></tr></tbody></table></div></div><div class="section" title="THREE.AreaLight"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>THREE.AreaLight</h2></div></div></div><p>The last real light source we'll look at is <code class="literal">THREE.AreaLight</code>. With <code class="literal">THREE.AreaLight</code>, we can define a<a id="id291" class="indexterm"/> rectangular area that emits light. <code class="literal">THREE.AreaLight</code> isn't included in the standard Three.js library, but in its extensions, so we have to take a couple of additional steps before we can use this light source. Before we look<a id="id292" class="indexterm"/> at the details, let's first look at the result we're aiming for (<code class="literal">06-area-light.html</code> opens this example); the following screenshot encapsulates the result we want to see:</p><div class="mediaobject"><img src="graphics/2215OS_03_14.jpg" alt="THREE.AreaLight"/></div><p>What you see in this screenshot is that we've defined three <code class="literal">THREE.AreaLight</code> objects, each with their own color. You can also see how these lights affect the whole area.</p><p>When we want to use <code class="literal">THREE.AreaLight</code>, we can't use <code class="literal">THREE.WebGLRenderer</code>, which we used in our examples until now. The reason is that <code class="literal">THREE.AreaLight</code> is a very complex light source that would cause a very serious performance penalty in the normal <code class="literal">THREE.WebGLRenderer</code> object. It uses a different approach when rendering a scene (it breaks it up into multiple steps) and can handle complex lights (or a very high number of light sources for that matter) much better than the standard <code class="literal">THREE.WebGLRenderer</code> object.</p><p>To use <code class="literal">THREE.WebGLDeferredRenderer</code>, we have to include a couple of additional JavaScript sources provided by Three.js. In the head of your HTML skeleton, make sure you have the<a id="id293" class="indexterm"/> following set of  <code class="literal">&lt;script&gt;</code> sources defined:</p><div class="informalexample"><pre class="programlisting">&lt;head&gt;
  &lt;script type="text/javascript" src="../libs/three.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/stats.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/dat.gui.js"&gt;&lt;/script&gt;
  
  &lt;script type="text/javascript" src="../libs/WebGLDeferredRenderer.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/ShaderDeferred.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/RenderPass.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/EffectComposer.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/CopyShader.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/ShaderPass.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/FXAAShader.js"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="../libs/MaskPass.js"&gt;&lt;/script&gt;
&lt;/head&gt;</pre></div><p>With these libraries included, we can use <code class="literal">THREE.WebGLDeferredRenderer</code>. We can use this renderer in pretty much the same way as the one we discussed in the other examples. It just takes a couple of extra arguments:</p><div class="informalexample"><pre class="programlisting">var renderer = new THREE.WebGLDeferredRenderer({width: window.innerWidth,height: window.innerHeight,scale: 1, antialias: true,tonemapping: THREE.FilmicOperator, brightness: 2.5 });</pre></div><p>Don't worry too much about what all these properties mean at the moment. In <a class="link" href="ch10.html" title="Chapter 10. Loading and Working with Textures">Chapter 10</a>, <span class="emphasis"><em>Loading and Working with Textures</em></span>, we'll dive deeper into <code class="literal">THREE.WebGLDeferredRenderer</code> and explain them to you. With the correct JavaScript libraries and a different renderer, we can start adding <code class="literal">Three.AreaLight</code>.</p><p>We do this in pretty much the same way as all the other lights:</p><div class="informalexample"><pre class="programlisting">var areaLight1 = new THREE.AreaLight(0xff0000, 3);
areaLight1.position.set(-10, 10, -35);
areaLight1.rotation.set(-Math.PI / 2, 0, 0);
areaLight1.width = 4;
areaLight1.height = 9.9;
scene.add(areaLight1);</pre></div><p>In this example, we create a new <code class="literal">THREE.AreaLight</code>. This light has a color value of <code class="literal">0xff0000</code> and an intensity value of <code class="literal">3</code>. Just like the other lights, we can use the <code class="literal">position</code> attribute to set its location in the scene. When you create <code class="literal">THREE.AreaLight</code>, it will be created as a horizontal plane. In our example, we created three <code class="literal">THREE.AreaLight</code> objects that are <a id="id294" class="indexterm"/>positioned vertically, so we need to rotate our lights <code class="literal">-Math.PI/2</code> around their <span class="emphasis"><em>x</em></span> axis. Finally, we set the size of <code class="literal">THREE.AreaLight</code> using the <code class="literal">width</code> and <code class="literal">height</code> properties and add them to the scene. If you try this yourself for the first time, you might wonder why you don't see anything where you positioned your light. This is because you can't see the light source itself, only the light it emits, which you only see when it touches an object. If you want to recreate what I've shown in the example, you can add <code class="literal">THREE.PlaneGeometry</code> or <code class="literal">THREE.BoxGeometry</code> at the same position (<code class="literal">areaLight1.position</code>) to simulate the area emitting light, as follows:</p><div class="informalexample"><pre class="programlisting">var planeGeometry1 = new THREE.BoxGeometry(4, 10, 0);
var planeGeometry1Mat = new THREE.MeshBasicMaterial({color: 0xff0000})
var plane = new THREE.Mesh(planeGeometry1, planeGeometry1Mat);
plane.position = areaLight1.position;
scene.add(plane);</pre></div><p>You can create really beautiful effects with <code class="literal">THREE.AreaLight</code>, but you'll probably have to experiment a bit to get the desired effect. If you pull down the control panel from the top-right corner, you've got some controls you can play around with to set the color and intensity of the three lights from this scene and immediately see the effect, as follows:</p><div class="mediaobject"><img src="graphics/2215OS_03_15.jpg" alt="THREE.AreaLight"/></div></div><div class="section" title="LensFlare"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>LensFlare</h2></div></div></div><p>The last subject we'll explore in this chapter is <span class="strong"><strong>lens flares</strong></span>. You are probably already familiar with lens flares. For instance, they <a id="id295" class="indexterm"/>appear when you take a photograph directly into the sun or another bright light source. In most cases, you want to avoid this, but for<a id="id296" class="indexterm"/> games and 3D-generated images, it provides a nice effect that makes scenes look a bit more realistic.</p><p>Three.js also has support for lens flares and makes it very easy to add them to your scene. In this last section, we're going to add a lens flare to a scene and create the output as you can see in the following screenshot; you can see this for yourself by opening <code class="literal">07-lensflares.html</code>:</p><div class="mediaobject"><img src="graphics/2215OS_03_16.jpg" alt="LensFlare"/></div><p>We can create a lens flare by instantiating the <code class="literal">THREE.LensFlare</code> object. The first thing we need to<a id="id297" class="indexterm"/> do is create this object. <code class="literal">THREE.LensFlare</code> takes the following arguments:</p><div class="informalexample"><pre class="programlisting">flare = new THREE.LensFlare(texture, size, distance, blending, color, opacity);</pre></div><p>These arguments are explained in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">texture</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A texture is an image that determines the shape of the flare. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td style="text-align: left" valign="top">
<p>We can specify how large the flare should be. This is the size in pixels. If you specify <code class="literal">-1</code>, the size of the texture itself is used.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">distance</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the distance from the light source (<code class="literal">0</code>) to the camera (<code class="literal">1</code>). Use this to position the lens flare in the right position.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">blending</code>
</p>
</td><td style="text-align: left" valign="top">
<p>We can specify multiple textures for the flares. The blending mode determines how these are blended together. The default to use with <code class="literal">LensFlare</code> is <code class="literal">THREE.AdditiveBlending</code>. There's more on blending in the next chapter.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">color</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the color of the flare.</p>
</td></tr></tbody></table></div><p>Let's look at the code used to create this object (see <code class="literal">07-lensflares.html</code>):</p><div class="informalexample"><pre class="programlisting">var textureFlare0 = THREE.ImageUtils.loadTexture
      ("../assets/textures/lensflare/lensflare0.png");

var flareColor = new THREE.Color(0xffaacc);
var lensFlare = new THREE.LensFlare(textureFlare0, 350, 0.0, THREE.AdditiveBlending, flareColor);

lensFlare.position = spotLight.position;
scene.add(lensFlare);</pre></div><p>We first load<a id="id298" class="indexterm"/> a texture. For this example, I've used the lens flare texture provided by the Three.js examples, as follows:</p><div class="mediaobject"><img src="graphics/2215OS_03_17.jpg" alt="LensFlare"/></div><p>If you compare this image with the screenshot at the beginning of this section, you can see that it defines what the lens flare looks like. Next, we define the color of the lens flare using <code class="literal">new THREE.Color( 0xffaacc );</code>, which gives the lens flare a red glow. With these two objects, we can create the <code class="literal">THREE.LensFlare</code> object. For this example, we've set the size of the flare to <code class="literal">350</code> and the distance to <code class="literal">0.0</code> (directly at the light source).</p><p>After we've created the <code class="literal">LensFlare</code> object, we position it at the location of our light and add it to the scene, which can be seen in the following screenshot:</p><div class="mediaobject"><img src="graphics/2215OS_03_18.jpg" alt="LensFlare"/></div><p>It already looks nice, but if you compare this with the image from the beginning of this chapter you'll notice<a id="id299" class="indexterm"/> that we're missing the small round artifacts in the middle of the page. We create these in pretty much the same way as we did the main flare, as follows:</p><div class="informalexample"><pre class="programlisting">var textureFlare3 = THREE.ImageUtils.loadTexture
      ("../assets/textures/lensflare/lensflare3.png");

lensFlare.add(textureFlare3, 60, 0.6, THREE.AdditiveBlending);
lensFlare.add(textureFlare3, 70, 0.7, THREE.AdditiveBlending);
lensFlare.add(textureFlare3, 120, 0.9, THREE.AdditiveBlending);
lensFlare.add(textureFlare3, 70, 1.0, THREE.AdditiveBlending);</pre></div><p>This time, though, we don't create a new <code class="literal">THREE.LensFlare</code>, but use the <code class="literal">add</code> function provided by the <code class="literal">LensFlare</code> we just created. In this method, we need to specify the texture, size, distance, and blending mode, and that's it. Note that the <code class="literal">add</code> function can take two additional parameters. You can also set the <code class="literal">color</code> and the <code class="literal">opacity</code> properties of the new flare to <code class="literal">add</code>. The texture we use for these new flares is a very light circle, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2215OS_03_19.jpg" alt="LensFlare"/></div><p>If you look at the <a id="id300" class="indexterm"/>scene again, you'll see the artifacts appearing at the positions you've specified with the <code class="literal">distance</code> argument.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Summary</h1></div></div></div><p>In this chapter, we covered a lot of information about the different kinds of lights that are available in Three.js. In this chapter, you learned that configuring lights, colors, and shadows is not an exact science. To get to the correct result, you should experiment with the different settings and use a dat.GUI control to fine-tune your configuration. The different lights behave in different manners. A <code class="literal">THREE.AmbientLight</code> color is added to each and every color in the scene and is often used to smooth hard colors and shadows. <code class="literal">THREE.PointLight</code> emits light in all directions but can't be used to create shadows. <code class="literal">THREE.SpotLight</code> is a light that resembles a flashlight. It has a conical shape, can be configured to fade over distance, and is able to cast shadows. We also looked at <code class="literal">THREE.DirectionalLight</code>. This light can be compared with a faraway light, such as the sun, whose light rays travel parallel to each other, the intensity of which doesn't decrease the farther away it gets from the configured target. Besides the standard lights, we also looked at a couple of more specialized lights. For a more natural outdoor effect, you can use <code class="literal">THREE.HemisphereLight</code>, which takes into account ground and sky reflections; <code class="literal">THREE.AreaLight</code> doesn't shine from a single point, but emits light from a large area. We showed you how to add a photographic lens flare with the <code class="literal">THREE.LenseFlare object</code>.</p><p>In the chapters so far, we already introduced a couple of different materials, and in this chapter, you saw that not all materials respond in the same manner to the available lights. In the next chapter, we'll give an overview of the materials that are available in Three.js.</p></div></body></html>