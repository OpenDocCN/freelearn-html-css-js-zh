<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Labeled Spinner</h1></div></div></div><p>In this chapter we are<a id="id174" class="indexterm"/> going to develop an Ext JS extension called <strong>Labeled spinner</strong>. To develop this extension, we will extend the <code class="literal">Ext.form.field.Spinner</code> class, which will add a functionality <a id="id175" class="indexterm"/>that will show a configurable<a id="id176" class="indexterm"/> label besides the value within the spinner field, and some more advanced features.</p><p>In this chapter we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Functional requirements</li><li class="listitem" style="list-style-type: disc">Planning and coding the labeled spinner</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Functional requirements</h1></div></div></div><p>We want to develop a field for numeric values which will provide the facility of having up/down <a id="id177" class="indexterm"/>spinner buttons to increase or decrease the numeric values. Also, a user can edit the value within the field. There will also be a configuration option to show a user-defined label as a unit name just beside the numeric value within the field. There will also be options to get the value from this field, which will be just the numeric value and also the numeric value including the unit name exactly as it shows within the field.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Planning and coding the labeled spinner</h1></div></div></div><p>To meet the functional requirements, we will create an extension class by extending the Ext JS's <code class="literal">Ext.form.field.Spinner</code> class from which we will get most of the facilities that we need to <a id="id178" class="indexterm"/>provide. We need to implement the <code class="literal">onSpinUp</code> and <code class="literal">onSpinDown</code> functions<a id="id179" class="indexterm"/> of the <code class="literal">Ext.form.field.Spinner</code> class to handle the spinner button<a id="id180" class="indexterm"/> click event to provide our logic to increase or decrease the values. By default, pressing the up <a id="id181" class="indexterm"/>and down arrow keys will also trigger the <code class="literal">onSpinUp</code> and <code class="literal">onSpinDown</code> methods. Now, let us start coding:</p><div><pre class="programlisting">Ext.define('Examples.ux.LabeledSpinner', {
  extend : 'Ext.form.field.Spinner',
  alias : 'widget.labeledspinner',

  onSpinUp : function() {
    this.setValue(++this.value);
  },

  onSpinDown : function() {
    this.setValue(--this.value);
  }
});</pre></div><p>And now we have a <a id="id182" class="indexterm"/>working extension that can increase or decrease its <a id="id183" class="indexterm"/>value. Here is the screenshot where we used this <a id="id184" class="indexterm"/>extension:</p><div><img src="img/3725OS_04_01.jpg" alt="Planning and coding the labeled spinner"/></div><p>You can see that we now have a field with up/down spinner buttons with which we can increase or decrease the value by 1.</p><p>Now, we will add a functionality that this field can show the unit label text just beside the numeric value. We will define the <a id="id185" class="indexterm"/>
<code class="literal">setValue</code> function from which we can set the value including the label unit. We will also add some <code class="literal">config</code> properties to this <a id="id186" class="indexterm"/>class so that we can set the values as we needed:</p><div><pre class="programlisting">Ext.define('Examples.ux.LabeledSpinner', {
  extend : 'Ext.form.field.Spinner',
  alias : 'widget.labeledspinner',

  config : {
    labelText : ",
    minValue: 0,
    value: 0
  },

  onSpinUp : function() {
    var value = parseFloat(this.getValue().split(' ')[0]);
    this.setValue(++value);
  },

  onSpinDown : function() {
    var value = parseFloat(this.getValue().split(' ')[0]);
    this.setValue(--value);
  },

  setValue : function(value) {
    value = (value ||this.minValue) + ' ' +this.getLabelText();
    this.callParent(arguments);
  }
}); </pre></div><p>In the following <a id="id187" class="indexterm"/>screenshot, we can see the label just beside the <a id="id188" class="indexterm"/>numeric <a id="id189" class="indexterm"/>value within the field:</p><div><img src="img/3725OS_04_02.jpg" alt="Planning and coding the labeled spinner"/></div><p>Within the <a id="id190" class="indexterm"/>code, you can find that we have provided some <code class="literal">config</code> options, added <a id="id191" class="indexterm"/>the <code class="literal">setValue</code> function, and modified a little <a id="id192" class="indexterm"/>of the <code class="literal">onSpinUp</code> and <code class="literal">onSpinDown</code> functions.</p><p>Now, we will define the <code class="literal">getValue</code> function<a id="id193" class="indexterm"/> so that we can get the numeric value <a id="id194" class="indexterm"/>from this field and define the <code class="literal">getLabeledValue</code> function that will return the numeric value, including the unit label, exactly as it shows on the field. We <a id="id195" class="indexterm"/>will also define the <code class="literal">onBlur</code> handler to check and fix <a id="id196" class="indexterm"/>it with a minimum value, if there is any wrong input and will do some changes<a id="id197" class="indexterm"/> on the existing code. Here is the complete code for our <a id="id198" class="indexterm"/>extension:</p><div><pre class="programlisting">Ext.define('Examples.ux.LabeledSpinner', {
  extend : 'Ext.form.field.Spinner',
  alias : 'widget.labeledspinner',

  config : {
    labelText : '',
    minValue : 0,
    maxValue : Number.MAX_VALUE,
    step : 1,
    value : 0
  },

  onBlur : function() {
    if (isNaN(this.getValue())) {
      this.setValue(this.getLabeledValue(this.getMinValue()));
    }
    else{
      this.setValue(this.getLabeledValue());
    }
  },

  onSpinUp : function() {
    var val = this.getValue() || this.getMinValue();
    this.setChangedValue(val + this.step);
  },

  onSpinDown : function() {
    var val = this.getValue() || this.getMinValue();

    this.setChangedValue(val - this.step);
  },

  getLabeledValue : function(value) {
    value = Ext.isDefined(value) ? value : this.getValue();
    if (value.toString().indexOf(this.getLabelText()) == -1) {
      return value + ' ' + this.getLabelText();
    } else {
      return value;
    }
  },

  setValue : function(value) {
    if(!this.readOnly){
      value = this.getLabeledValue(value);
    }
    this.callParent(arguments);
  },

  getValue : function() {
    var me = this, 
    val = me.rawToValue(me.processRawValue(me.getRawValue()));

    val = parseFloat(val.split(' ')[0]);
    return val;
  },

  setChangedValue : function(value){        
    if(!isNaN(value)){
      this.setValue(Ext.Number.constrain(value, 
        this.getMinValue(), this.getMaxValue()));
    }
  }

}); </pre></div><p>And <a id="id199" class="indexterm"/>following is <a id="id200" class="indexterm"/>the screenshot<a id="id201" class="indexterm"/> of our working <strong>LabeledSpinner</strong> extension:</p><div><img src="img/3725OS_04_03.jpg" alt="Planning and coding the labeled spinner"/></div><p>In the preceding<a id="id202" class="indexterm"/> screenshot, we can find the <strong>Get value</strong> button within the window. When <a id="id203" class="indexterm"/>this button is clicked, we print the <a id="id204" class="indexterm"/>values on the window by calling<a id="id205" class="indexterm"/> both<a id="id206" class="indexterm"/> the <code class="literal">getValue</code> and <code class="literal">getLabeledValue</code> functions.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we've developed a new component by extending Ext JS's existing class and we've learned how we can easily create Ext JS extensions and inject our required functionality. In the next chapter, we will develop an Ext JS plugin called the Chart download, which generates a button on the container's toolbar and can download the container's chart item as an image when this button is clicked.</p></div></body></html>