<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Google Maps JavaScript Libraries</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Drawing shapes on the map</li><li class="listitem" style="list-style-type: disc">Calculating the length/area of polylines and polygons</li><li class="listitem" style="list-style-type: disc">Encoding coordinates</li><li class="listitem" style="list-style-type: disc">Searching for and showing nearby places</li><li class="listitem" style="list-style-type: disc">Finding places with the autocomplete option</li><li class="listitem" style="list-style-type: disc">Adding drag zoom to the map</li><li class="listitem" style="list-style-type: disc">Creating custom popups / infoboxes</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec49"/>Introduction</h1></div></div></div><p>This chapter delves into the additional JavaScript libraries that are part of the<a id="id411" class="indexterm"/> Google Maps JavaScript API. These libraries are not added to your application by default when you reference the Google Maps API; however, these can be added manually.</p><p>These libraries are classified into the following six categories:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">drawing</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">geometry</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">places</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">panoramio</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">visualization</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">weather</code></li></ul></div><p>The last three libraries in the preceding list—<code class="literal">panoramio</code>, <code class="literal">visualization</code>, and <code class="literal">weather</code>—have been discussed thoroughly in <a class="link" href="ch02.html" title="Chapter 2. Adding Raster Layers">Chapter 2</a>, <em>Adding Raster Layers</em>, with respect to their related topics and usages. In this chapter, we will learn in detail about <code class="literal">Drawing</code> and <code class="literal">Geometry</code> libraries. We will also use two external libraries.</p><p>The intention of these libraries, as extensions to the core API, is to ensure that the Google Maps JavaScript API is self-sufficient in order to provide all of the tasks that it offers to accomplish. That means, without these extra libraries, you can develop using the API without any problem.</p><p>In addition, these libraries are somehow autonomous. They have very well-defined and designed objectives and boundaries, so adding them will provide additional functionality, but removing them will not take away any functionality from the core API.</p><p>This optionality of the extra libraries definitely accounts for faster loads of the API. Unless you request these libraries explicitly, they are not loaded. This componential structure lets you have the option of including the cost of loading these libraries or not.</p><p>This chapter will first deal with the <code class="literal">drawing</code> library, which will enable you to draw vector overlays on top of your base maps. Then, it will deal with the <code class="literal">geometry</code> library and get the properties of the vector overlays, such as the length and areas. Finally, the <code class="literal">places</code> library will explain in detail how to search for places and show the details of these places in the Google Maps JavaScript API.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec50"/>Drawing shapes on the map</h1></div></div></div><p>You have probably<a id="id412" class="indexterm"/> explored <a id="id413" class="indexterm"/>vector overlays in <em>Chapter 3, Adding Vector Layers</em>. Without getting into details, you can add markers, lines, and polygons programmatically using the Google Maps JavaScript API. But if you wanted to draw these vector overlays—not programmatically, but with mouse clicks or touch gestures, like in AutoCAD<a id="id414" class="indexterm"/> or ArcGIS<a id="id415" class="indexterm"/> for Desktop—what would you do?</p><p>The <code class="literal">drawing</code> library<a id="id416" class="indexterm"/> handles this job, enables you to draw vector shapes as per your preference, and shows them on top of your base maps.</p><p>In this recipe, we will go over the details of how to draw shapes, deal with their extensive set of options, and how to handle their specific events.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec150"/>Getting ready</h2></div></div></div><p>The first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, will do our work. We will alter the Google Maps API bootstrap URL to have this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec151"/>How to do it...</h2></div></div></div><p>The following steps show how you can have the drawing control and draw some shapes using that control:</p><div><ol class="orderedlist arabic"><li class="listitem">Alter the Google Maps API bootstrap URL adding the <code class="literal">libraries</code> parameter:<div><pre class="programlisting">&lt;script type="text/javascript"
    src="img/js? libraries=drawing&amp;sensor=false"&gt;
&lt;/script&gt;</pre></div></li><li class="listitem">Create the <code class="literal">drawingManager</code> object:<div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager();</pre></div></li><li class="listitem">Enable<a id="id417" class="indexterm"/> the <a id="id418" class="indexterm"/>drawing functionality:<div><pre class="programlisting">drawingManager.setMap(map);</pre></div><div><img src="img/8825OT_06_01.jpg" alt="How to do it..."/></div></li></ol></div><p>In the previous screenshot, you can see the varieties of shapes you can draw by clicking on the buttons in the top-left corner.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec152"/>How it works...</h2></div></div></div><p>Adding the drawing functionality to your application using the Google Maps JavaScript API is easy. First, you have to include the <code class="literal">libraries</code> parameter to your Google Maps JavaScript API URL with the <code class="literal">drawing</code> value inside to include the <code class="literal">drawing</code> library into your application:</p><div><pre class="programlisting">&amp;libraries=drawing</pre></div><p>Next, you can <a id="id419" class="indexterm"/>use the <code class="literal">drawing</code> library's supported functions and objects in addition<a id="id420" class="indexterm"/> to the standard Google Maps JavaScript API.</p><p>To draw your vector shapes, it is necessary to have a <code class="literal">DrawingManager</code> object:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager();</pre></div><p>Having a <code class="literal">DrawingManager</code> object, you have all your drawing functionalities, but you have to attach it to the current map instance in order to make use of it:</p><div><pre class="programlisting">drawingManager.setMap(map);</pre></div><p>After this, you will see a drawing control containing the marker, polyline, rectangle, circle, and polygon drawing buttons. By using these buttons, you can draw any vector overlay you want. In the toolset, you can also see a pan tool to go out of the drawing mode to use the pan and zoom controls. If you want to draw a vector shape again, press the related button (marker, polyline, and so on) and draw on the map.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec153"/>There's more...</h2></div></div></div><p>Until this point, having the drawing functionality is so simple that you can implement it by adding two lines of code. However, there is an extensive set of options you can make use of, which are related to the <code class="literal">DrawingManager</code> object<a id="id421" class="indexterm"/> and vector shapes you draw. It's worth going over them, because they enrich your drawing experience in your application.</p><p>The settings of <code class="literal">DrawingManager</code> can be modified either in its initialization or through its <code class="literal">setOptions</code> method. All the settings that pertain to the <code class="literal">DrawingManager</code> class are properties of the<a id="id422" class="indexterm"/> <code class="literal">DrawingManagerOptions</code> class.</p><p>Let's alter our recipe to include the <code class="literal">DrawingManager</code> options:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
    drawingControl: true,
});</pre></div><p>The <code class="literal">drawingControl</code> property<a id="id423" class="indexterm"/> enables or disables the drawing control seen in the map UI:</p><div><img src="img/8825OT_06_02.jpg" alt="There's more..."/></div><p>Setting the <code class="literal">drawingControl</code> property <a id="id424" class="indexterm"/>to <code class="literal">false</code> will hide the drawing control. Its default is <code class="literal">true</code>; therefore, although it is not included in our original recipe code, it is shown in the map.</p><p>It is important to note that the drawing functionality comes with attaching the <code class="literal">DrawingManager</code> class to the map.</p><div><pre class="programlisting">drawingManager.setMap(map);</pre></div><p>Therefore, hiding<a id="id425" class="indexterm"/> the drawing control is not related to the drawing functionality. In fact, you can create your own user controls to use <code class="literal">DrawingManager</code> instead of the standard drawing controls.</p><p>The drawing control<a id="id426" class="indexterm"/> has its own options embedded in the <code class="literal">drawingControlOptions</code> property. Remember from <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <em>Working with Controls</em>, that you can position your controls at the predefined places in the Google Maps UI whether they be the default controls or the controls you actually develop.</p><p>The <code class="literal">drawingControl</code> property is no exception. You can position <code class="literal">drawingControl</code> by using the following code snippet:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
    drawingControl: true,
    drawingControlOptions: {
        position: google.maps.ControlPosition.BOTTOM_CENTER
    }
});</pre></div><p>The preceding code is reflected in the map UI in the following manner:</p><div><img src="img/8825OT_06_03.jpg" alt="There's more..."/></div><p>Notice that the <code class="literal">drawingControl</code> property is <a id="id427" class="indexterm"/>placed at the <a id="id428" class="indexterm"/>bottom center, as we have <a id="id429" class="indexterm"/>mentioned in the <code class="literal">position</code> property of the <code class="literal">drawingControlOptions</code> property.</p><div><div><h3 class="title"><a id="note12"/>Note</h3><p>
<strong>Complete listing for google.maps.ControlPosition</strong>
</p><p>The complete listing for control positions can be found in the Google Maps JavaScript API reference documentation at the following link:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference">https://developers.google.com/maps/documentation/javascript/reference</a>
</p></div></div><p>Apart from the <code class="literal">position</code> property, you can also select which type of shape you would like to draw, in other words, which buttons you would like to include in <code class="literal">drawingControl</code>:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
    drawingControl: true,
    drawingControlOptions: {
        position: google.maps.ControlPosition.BOTTOM_CENTER,
        drawingModes: [
            google.maps.drawing.OverlayType.MARKER,
            google.maps.drawing.OverlayType.POLYGON,
            google.maps.drawing.OverlayType.POLYLINE
        ]
    }
});</pre></div><p>We have apparently selected<a id="id430" class="indexterm"/> three drawing shape types listed in an<a id="id431" class="indexterm"/> array in the <code class="literal">drawingModes</code> property:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Marker</li><li class="listitem" style="list-style-type: disc">Polygon</li><li class="listitem" style="list-style-type: disc">Polyline</li></ul></div><p>These are reflected in the <code class="literal">drawingControl</code> property:</p><div><img src="img/8825OT_06_04.jpg" alt="There's more..."/></div><p>By default, all vector shape <a id="id432" class="indexterm"/>buttons are available in <code class="literal">drawingControl</code>. This means that, <a id="id433" class="indexterm"/>in addition to the three types listed in our example, the following shapes are also available:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rectangle</li><li class="listitem" style="list-style-type: disc">Circle</li></ul></div><p>If you have followed the recipe up to this point, you may have realized that at the start of your application you can zoom and pan your map as usual. Then, you have to click a vector overlay button in the <code class="literal">drawingControl</code> property to start drawing your shape.</p><p>However, you can change this programmatically through a setting. For instance:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: google.maps.drawing.OverlayType.POLYGON,
    ...
});</pre></div><p>The <code class="literal">drawingMode</code> property<a id="id434" class="indexterm"/> takes the vector shape type <code class="literal">google.maps.drawing.OverlayType</code>, as the API implies, as its data type and sets that vector shape type so that it can be drawn. In our example, when the user clicks on the map, they immediately start drawing the <code class="literal">POLYGON</code> vector overlays.</p><p>But what happens if it becomes necessary to change the <code class="literal">drawingMode</code> programmatically in the program flow? Luckily, there is a solution to this:</p><div><pre class="programlisting">drawingManager.setDrawingMode(null);</pre></div><p>Setting the property to <code class="literal">null</code> makes the <code class="literal">drawingMode</code> property turn to its default value, allowing the end user to use the Google Maps JavaScript UI <a id="id435" class="indexterm"/>as usual. This means that clicking on the map does not <a id="id436" class="indexterm"/>draw any <a id="id437" class="indexterm"/>vector shape overlay.</p><p>You can also use the <code class="literal">setOptions</code> method of <code class="literal">drawingManager</code> for the same purpose:</p><div><pre class="programlisting">drawingManager.setOptions({
   drawingMode: google.maps.drawing.OverlayType.POLYGON,
});</pre></div><p>Until now, we have dealt with the <code class="literal">drawingManager</code> and <code class="literal">drawingControl</code> property options. But what about the shapes and their styles that we will draw? As you may have expected, you can set the properties of the vector shapes you draw in <code class="literal">google.maps.drawing.DrawingManagerOptions</code>:</p><div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
   ...
   polylineOptions: {
       strokeColor: 'red',
       strokeWeight: 3
   },
   polygonOptions: {
        strokeColor: 'blue',
        strokeWeight: 3,
        fillColor: 'yellow',
        fillOpacity: 0.2
   }
...
});</pre></div><p>We can now draw our shapes as shown in the following screenshot:</p><div><img src="img/8825OT_06_05.jpg" alt="There's more..."/></div><p>You may have observed that the <a id="id438" class="indexterm"/>styles of the polyline and polygon shapes have <a id="id439" class="indexterm"/>changed completely. The polylines have become red in color, <a id="id440" class="indexterm"/>because their <code class="literal">strokeColor</code> property is set as <code class="literal">red</code>, whereas the <code class="literal">strokeColor</code> property for polygons is set as <code class="literal">blue</code>, their <code class="literal">fillColor</code> as <code class="literal">yellow</code>, and their <code class="literal">opacity</code> being near transparent—<code class="literal">0.2</code>—so that you can see the base map through them.</p><p>For each vector overlay type, there is an <code class="literal">options</code> property for <code class="literal">drawingManager</code>:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">markerOptions</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">polylineOptions</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">polygonOptions</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">circleOptions</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">rectangleOptions</code></li></ul></div><p>There is a bunch of interesting properties for vector overlays, most of them being common for all overlay types. We have already touched on the stroke and fill properties for customizing the styles according to your taste.</p><p>For instance, you can try the <code class="literal">editable</code> and <code class="literal">draggable</code> properties, which are worth commenting on:</p><div><pre class="programlisting">polygonOptions: {
            strokeColor: 'blue',
            strokeWeight: 3,
            fillColor: 'yellow',
            fillOpacity: 0.2,
            editable: true,
            draggable: true
}</pre></div><p>The preceding code<a id="id441" class="indexterm"/> snippet makes the polygons drawn on Google Maps UI editable, <a id="id442" class="indexterm"/>as shown in the following screenshot (you have to go out of <a id="id443" class="indexterm"/>polyline drawing mode by clicking the pan button in the drawing control):</p><div><img src="img/8825OT_06_06.jpg" alt="There's more..."/></div><p>Observe the white dots that represent the nodes (<code class="literal">LatLng</code> objects) comprising the entire polygon. You can change the location of these dots by clicking and dragging the dots; this will allow you to change the shape of the polygon, as shown in the following screenshot:</p><div><img src="img/8825OT_06_07.jpg" alt="There's more..."/></div><p>You may have spotted that the <a id="id444" class="indexterm"/>white dot located in the middle of the south edge has been <a id="id445" class="indexterm"/>dragged downwards, and thus, the shape of the polygon has <a id="id446" class="indexterm"/>changed.</p><p>In addition to changing the original shape, you can also drag the shape, as shown in the following screenshots:</p><div><img src="img/8825OT_06_08.jpg" alt="There's more..."/></div><p>As you can see, the <a id="id447" class="indexterm"/>shape<a id="id448" class="indexterm"/> has moved to the east in the <a id="id449" class="indexterm"/>second screenshot.</p><div><img src="img/8825OT_06_09.jpg" alt="There's more..."/></div><p>When the <code class="literal">draggable</code> property is set to <code class="literal">true</code> and your mouse is on the shape, you can drag your shape wherever you want on the map.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>
<strong>Complete listing for google.maps.drawing.DrawingManager properties</strong>
</p><p>The complete listing for the <code class="literal">DrawingManager</code> properties and related options can be found in the Google Maps JavaScript API reference documentation at the following link:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#DrawingManager">https://developers.google.com/maps/documentation/javascript/reference#DrawingManager</a>
</p></div></div><p>
<code class="literal">DrawingManager</code> is not limited<a id="id450" class="indexterm"/> to its properties and options; it also has some events <a id="id451" class="indexterm"/>associated with it. These events are fired when you <a id="id452" class="indexterm"/>finish drawing a shape:</p><div><pre class="programlisting">google.maps.event.addListener(drawingManager, '    polygoncomplete', function(polygon) {
    polygon.setEditable(true);
    polygon.setDraggable(true);
});</pre></div><p>You may notice that the type of the event is <code class="literal">polygoncomplete</code>, and there is a callback function taking the polygon, which has been completed, as an argument.</p><p>There is an event for every type of shape:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">markercomplete</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">linestringcomplete</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">polygoncomplete</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">rectanglecomplete</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">circlecomplete</code></li></ul></div><p>There is one additional event type that covers all of these shape types:</p><div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
     if (event.type == google.maps.drawing.OverlayType.POLYGON) {
          event.overlay.setEditable(true);
          event.overlay.setDraggable(true);
     }
});</pre></div><p>The preceding event behaves in the same way as the previous example. Instead of the <code class="literal">shapecomplete</code> pattern there is an <code class="literal">overlaycomplete</code> argument for the event. This event is particularly useful for all the shape events, regardless of their type. However, being a generic event for all shapes, you can also get the shape type from <code class="literal">event.type</code>, and you can get the reference for the shape drawn from <code class="literal">event.overlay</code>. Utilizing these, you can have conditional statements for different shape types in one event handler.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec51"/>Calculating the length/area of polylines and polygons</h1></div></div></div><p>As described in the first recipe of this chapter—<em>Drawing shapes on the map</em>—you can draw your shapes as per your taste. But how about getting some information about these shapes, for instance, information about their length and area?</p><p>The Google Maps JavaScript API places the opportunity to gather this information in <a id="id453" class="indexterm"/>the <code class="literal">geometry</code> library. From this library, you can access the static utility functions that give information on the length/area calculations and so on.</p><p>This <a id="id454" class="indexterm"/>recipe <a id="id455" class="indexterm"/>will show <a id="id456" class="indexterm"/>us <a id="id457" class="indexterm"/>how to get the<a id="id458" class="indexterm"/> length and <a id="id459" class="indexterm"/>area<a id="id460" class="indexterm"/> information of the <a id="id461" class="indexterm"/>arbitrary shapes drawn.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec154"/>Getting ready</h2></div></div></div><p>Having a sneak preview at the <em>Drawing shapes on the map</em> recipe will ease your work, as much detail on drawing shapes and their background is needed.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec155"/>How to do it...</h2></div></div></div><p>You can view the area and length information of your shapes by carrying out the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <code class="literal">drawing</code> and <code class="literal">geometry</code> libraries to the bootstrap URL:<div><pre class="programlisting">&lt;script type="text/javascript"
    src="img/js? libraries=drawing,geometry&amp;sensor=false"&gt;
&lt;/script&gt;</pre></div></li><li class="listitem">Create a <code class="literal">drawingManager</code> object with the following settings:<div><pre class="programlisting">var drawingManager = new google.maps.drawing.DrawingManager({
    drawingMode: null,
    drawingControl: true,
    drawingControlOptions: {
       position:
            google.maps.ControlPosition.BOTTOM_CENTER,drawingModes: [
        google.maps.drawing.OverlayType.POLYGON,
        google.maps.drawing.OverlayType.POLYLINE
        ]
    },
    polylineOptions: {
        strokeColor: 'red',
        strokeWeight: 3
    },
    polygonOptions: {
        strokeColor: 'blue',
        strokeWeight: 3,
        fillColor: 'yellow',
        fillOpacity: 0.2
  }
});</pre></div></li><li class="listitem">Enable<a id="id462" class="indexterm"/> the<a id="id463" class="indexterm"/> drawing <a id="id464" class="indexterm"/>functionality:<div><pre class="programlisting">drawingManager.setMap(map);</pre></div></li><li class="listitem">Add an event listener for the completion of your polygons:<div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
    var path = polygon.getPath();
    var area =     google.maps.geometry.spherical.computeArea(path);
    var length = google.maps.geometry.spherical.computeLength(path);
    console.log('Polygon Area: ' +  area/1000000 + ' km sqs');
    console.log('Polygon Length: ' +  length/1000 + ' kms');
});</pre></div></li><li class="listitem">Add<a id="id465" class="indexterm"/> an<a id="id466" class="indexterm"/> event<a id="id467" class="indexterm"/> listener <a id="id468" class="indexterm"/>for the <a id="id469" class="indexterm"/>completion of your polylines:<div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'polylinecomplete', function(polyline) {
    var path = polyline.getPath();
    var length = google.maps.geometry.spherical.computeLength(path);
    console.log('Polyline Length: ' +  length/1000 + ' kms');
});</pre></div><div><img src="img/8825OT_06_10.jpg" alt="How to do it..."/></div></li></ol></div><p>As <a id="id470" class="indexterm"/>shown<a id="id471" class="indexterm"/> in <a id="id472" class="indexterm"/>the<a id="id473" class="indexterm"/> preceding <a id="id474" class="indexterm"/>screenshot, you <a id="id475" class="indexterm"/>can view the area and length<a id="id476" class="indexterm"/> information in the console<a id="id477" class="indexterm"/> window.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec156"/>How it works...</h2></div></div></div><p>To use the <code class="literal">drawing</code> and <code class="literal">geometry</code> utilities in the Google Maps JavaScript API, we have added two libraries—<code class="literal">drawing</code> and <code class="literal">geometry</code>—to the Google Maps JavaScript API bootstrap URL at the top of the code:</p><div><pre class="programlisting">libraries=drawing,geometry</pre></div><p>It is important to note that you can add multiple libraries with a comma separating each list, as in this case.</p><p>We have added the <code class="literal">drawingManager</code> object, after the usual mapping details, in the <code class="literal">initMap()</code> function itself. In this <code class="literal">drawingManager</code> object, we set the properties so that we can only draw polylines and polygons:</p><div><pre class="programlisting">drawingModes: 
[
    google.maps.drawing.OverlayType.POLYGON,
    google.maps.drawing.OverlayType.POLYLINE
]</pre></div><p>We <a id="id478" class="indexterm"/>do not <a id="id479" class="indexterm"/>need <a id="id480" class="indexterm"/>any<a id="id481" class="indexterm"/> marker drawing <a id="id482" class="indexterm"/>as there will be no length and area information related to markers.</p><p>At the start of the application, we implied that the users can use standard mapping controls (zoom, pan, and so on) instead of drawing shapes:</p><div><pre class="programlisting">drawingMode:null,</pre></div><p>This control on the user input is particularly useful in professional applications, because even if the application is the sole drawing application, users may need to specify their drawing areas by using the pan and zoom controls first hand.</p><p>We have placed the <code class="literal">drawingControl</code> object at the bottom center of the map UI:</p><div><pre class="programlisting">position: google.maps.ControlPosition.BOTTOM_CENTER,</pre></div><p>It is up to you where to place <code class="literal">drawingControl</code>; we just selected <code class="literal">BOTTOM_CENTER</code> as an example.</p><p>We have finally attached the <code class="literal">drawingManager</code> object to the map instance to enable the functionality:</p><div><pre class="programlisting">drawingManager.setMap(map);</pre></div><p>After all this setting up, users can open their application and draw polylines and polygons as per their wish. But, how do we get the length and area info of their shapes?</p><p>We have to add event handlers to be aware that they have finished drawing shapes. The calculation of the length and area must be performed for every polygon and polyline. Therefore, we have used the <code class="literal">polygoncomplete</code> and <code class="literal">polylinecomplete</code> events. First, let's perform the calculations for the polygons:</p><div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
    var path = polygon.getPath();
    var area = google.maps.geometry.spherical.computeArea(path);
    var length = google.maps.geometry.spherical.computeLength(path);
    console.log('Polygon Area: ' +  area/1000000 + ' km sqs');
    console.log('Polygon Length: ' +  length/1000 + ' kms');
});</pre></div><p>In the <code class="literal">polygoncomplete</code> event handler that gets fired when the users finish drawing each of their polygons, we first get the path of the polygon they draw:</p><div><pre class="programlisting">var path = polygon.getPath();</pre></div><p>The <code class="literal">getPath()</code> method returns an <code class="literal">MVCArray</code> of the object of type <code class="literal">LatLng</code> being latitude and longitude pairs comprising the polygon itself. For instance, for an imaginary polygon that we have drawn, calling <code class="literal">polygon.getPath().getArray().toString();</code> gives the following result:</p><div><pre class="programlisting">"(39.92132255884663, 32.7337646484375),(39.75048953595117, 32.754364013671875),(39.78110197709871, 33.061981201171875),(39.98132938627213, 33.0084228515625)"</pre></div><p>It is now<a id="id483" class="indexterm"/> clear <a id="id484" class="indexterm"/>that the <a id="id485" class="indexterm"/>imaginary <a id="id486" class="indexterm"/>polygon<a id="id487" class="indexterm"/> that<a id="id488" class="indexterm"/> is drawn <a id="id489" class="indexterm"/>comprises four latitude and <a id="id490" class="indexterm"/>longitude pairs.</p><p>Why did we need the path of the polygons? We needed it because the <code class="literal">computeArea()</code> function that we use does not take the polygon, but its path as an argument:</p><div><pre class="programlisting">var area = google.maps.geometry.spherical.computeArea(path);</pre></div><p>What does this <code class="literal">spherical</code> namespace stand for?</p><p>As you have observed, maps are 2D surfaces. However, the Earth's surface is not. To reflect the Earth's surface on a 2D canvas, projections are used. However, this reflection is not as smooth as it first seems. It comes with a cost; distortion of the Earth's shapes and properties occurs. To handle these side effects, spherical geometry calculations are needed, and <code class="literal">google.maps.geometry.spherical</code> exists exactly for this purpose.</p><p>When you call the <code class="literal">computeArea()</code> or <code class="literal">computeLength()</code> method, the area calculations are performed as if the shapes are warped to the Earth's surface, taking the earth curvature into account.</p><p>The unit of the return values of the two methods is meters. We have converted them to square kilometers and kilometers respectively in order to have more meaningful values while printing them in the console window:</p><div><pre class="programlisting">console.log('Polygon Area: ' +  area/1000000 + ' km sqs');
console.log('Polygon Length: ' +  length/1000 + ' kms');</pre></div><p>The <a id="id491" class="indexterm"/>event<a id="id492" class="indexterm"/> handlers <a id="id493" class="indexterm"/>for the <code class="literal">polygoncomplete</code> and <code class="literal">polylinecomplete</code> events are identical, except in <code class="literal">polylinecomplete</code>, where <a id="id494" class="indexterm"/>there <a id="id495" class="indexterm"/>is<a id="id496" class="indexterm"/> no<a id="id497" class="indexterm"/> area <a id="id498" class="indexterm"/>calculation.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec157"/>There's more...</h2></div></div></div><p>There's a strong possibility that having the length and area information attached to the shapes would be nice. You can extend the <code class="literal">Polygon</code> and <code class="literal">Polyline</code> JavaScript classes to have them. But bear in mind that extending JavaScript objects may lead to unexpected errors; you may clobber a different library's object extension. Therefore, think twice before extending the JavaScript classes:</p><div><pre class="programlisting">google.maps.Polygon.prototype.getArea = function()
{
    return google.maps.geometry.spherical.computeArea(this.getPath());
};

google.maps.Polygon.prototype.getLength = function(){
    return google.maps.geometry.spherical.computeLength(this.getPath());
};

google.maps.Polyline.prototype.getLength=function(){
    return google.maps.geometry.spherical.computeLength(this.getPath());
};</pre></div><p>Having extended the <code class="literal">Polygon</code> and <code class="literal">Polyline</code> classes, you can call the <code class="literal">getArea()</code> and <code class="literal">getLength()</code> methods directly from their objects:</p><div><pre class="programlisting">polygon.getArea();
polyline.getLength();</pre></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec158"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Drawing shapes on the map</em> recipe in this chapter </li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec52"/>Encoding coordinates</h1></div></div></div><p>The polylines and <a id="id499" class="indexterm"/>polygons that you draw using the Google Maps JavaScript API consist of arrays of <code class="literal">LatLng</code> objects in latitude and longitude pairs.</p><p>The length of these arrays increases substantially, especially when you have shapes with too many nodes, in the case of long polylines or polygons that have too much detail.</p><p>Dealing with these arrays (that can be retrieved by the <code class="literal">getPath()</code> methods of polylines and polygons) is a major problem, especially when you have to save the shape to a DB. Serializing and deserializing lengthy arrays is frequently hulky.</p><p>However, you can compress the paths of the shapes with Google's <a id="id500" class="indexterm"/>
<strong>polyline encoding algorithm</strong>.</p><div><div><h3 class="title"><a id="note14"/>Note</h3><p>
<strong>Detailed information on Google's polyline encoding algorithm</strong>
</p><p>You can find detailed information about the  polyline encoding algorithm at the following link:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/utilities/polylinealgorithm">https://developers.google.com/maps/documentation/utilities/polylinealgorithm</a>
</p></div></div><p>By using the <code class="literal">geometry</code> library, you can encode and decode the paths of polylines and polygons.</p><p>This recipe will show you how to encode and decode the paths of the polylines and polygons.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec159"/>Getting ready</h2></div></div></div><p>It would be handy to have <a id="id501" class="indexterm"/>a quick glance at the first recipe—<em>Drawing shapes on the map</em>—of this chapter, as it covers every detail on how to draw a shape using the Google Maps JavaScript API.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec160"/>How to do it...</h2></div></div></div><p>Here are the steps you can use to view the encoded and decoded versions of your paths:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <code class="literal">geometry</code> and <code class="literal">drawing</code> libraries to the bootstrap URL:<div><pre class="programlisting">&lt;script type="text/javascript"
   src="img/js? libraries=drawing,geometry&amp;sensor=false"&gt;
&lt;/script&gt;</pre></div></li><li class="listitem">Organize your HTML so that you can view the original, encoded, and decoded coordinates of your shapes in a <code class="literal">div</code> element:<div><pre class="programlisting">&lt;div&gt;
    &lt;H3&gt;Original, Encoded and Decoded Coordinate Pairs:&lt;H3&gt;
    &lt;div id="loggingDiv"&gt;&lt;/div&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Keep a reference to the <code class="literal">loggingDiv div</code> element in your <code class="literal">initMap()</code> function:<div><pre class="programlisting">loggingDiv = document.getElementById('loggingDiv');</pre></div></li><li class="listitem">Create a <code class="literal">polylinecomplete</code> event handler in your <code class="literal">initMap()</code> function after creating <code class="literal">drawingManager</code> and attaching it to the map instance:<div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'polylinecomplete', function(polyline){
    var path = polyline.getPath();

    var coords = path.getArray();

    var text = '&lt;b&gt;Original Coordinates:&lt;/b&gt; ' + coords;

    var encodedCoords = google.maps.geometry.encoding.encodePath(path);

    text += '&lt;br/&gt;&lt;b&gt;Encoded Coordinates:&lt;/b&gt; ' + encodedCoords;

    var decodedCoords = google.maps.geometry.encoding.decodePath(encodedCoords);

    text += '&lt;br/&gt;&lt;b&gt;Decoded Coordinates:&lt;/b&gt; ' + decodedCoords;

    loggingDiv.innerHTML = text;
});</pre></div></li></ol></div><div><img src="img/8825OT_06_11.jpg" alt="How to do it..."/></div><p>You can view the <a id="id502" class="indexterm"/>original, encoded, and decoded versions of your paths as shown in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec161"/>How it works...</h2></div></div></div><p>The <code class="literal">polylinecomplete</code> event is fired when you finish drawing your polyline. You can get the <code class="literal">MVCArray</code> of the object of type <code class="literal">LatLng</code> that comprises your polyline in the following manner:</p><div><pre class="programlisting">var path = polyline.getPath();</pre></div><p>Having the path object at hand, you can encode it easily by using the <code class="literal">encodePath()</code> method:</p><div><pre class="programlisting">var encodedCoords = google.maps.geometry.encoding.encodePath(path);</pre></div><p>The <code class="literal">encodePath()</code> method takes either the <code class="literal">MVCArray</code> of the object of type <code class="literal">LatLng</code> objects or an array of <code class="literal">LatLng</code> objects. So, here in our recipe, this will also be possible:</p><div><pre class="programlisting">var encodedCoords = google.maps.geometry.encoding.encodePath(coords);</pre></div><p>The<a id="id503" class="indexterm"/> <code class="literal">encodePath()</code> method returns a string that is perfectly fit for saving to a DB and potentially saves a considerable amount of time that would be spent serializing and deserializing operations:</p><div><pre class="programlisting">op_rFitihE|}Q|pCpyLo`GzmMq|HneEg}Wim@ghNwiIapJidD~zKmiIwXuiC_tHm`Gy{Ds|Ij}AqxE~zKqf@pxUngAfhNxdEvfFfaH_fBwvCg}WbqDc~E~`Nr_N</pre></div><p>Without encoding, the <code class="literal">coords</code> array would look like this:</p><div><pre class="programlisting">(39.81592026602056, 32.9864501953125),(39.71880717209066, 32.963104248046875),(39.64799732373418, 33.004302978515625),(39.573939343591896, 33.05511474609375),(39.54217596171196, 33.182830810546875),(39.54958871848275, 33.2611083984375),(39.6025139495577, 33.320159912109375),(39.62896140981413, 33.254241943359375),(39.681826010893644, 33.25836181640625),(39.70401708565211, 33.30780029296875),(39.74521015328692, 33.3380126953125),(39.80115102364286, 33.322906494140625),(39.83595916247957, 33.256988525390625),(39.842286020743394, 33.1402587890625),(39.83068633533497, 33.061981201171875),(39.79904087286648, 33.02490234375),(39.7526011757416, 33.0413818359375),(39.776880380637024, 33.169097900390625),(39.74837783143156, 33.204803466796875),(39.67125632523973, 33.127899169921875)</pre></div><p>Encoding polylines and polygons is not a one-way operation. You can decode the encoded coordinate pairs as follows:</p><div><pre class="programlisting">var decodedCoords = google.maps.geometry.encoding.decodePath(encodedCoords);</pre></div><p>The <code class="literal">decodePath()</code> method<a id="id504" class="indexterm"/> takes encoded coordinates in the form of a string and <a id="id505" class="indexterm"/>returns an array of <code class="literal">LatLng</code> objects.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec53"/>Searching for and showing nearby places</h1></div></div></div><p>Google Maps is not only about beautiful base maps with an immense cartographic quality or regularly updated satellite images. In your daily life, not as a programmer but as an ordinary user of Google Maps, you will have no doubt used Google Maps to search for places; be it The Metropolitan Museum of Arts in New York, or a commonplace <em>farmacia</em> in Rome.</p><p>This information is in Google Maps, but how can you reach and serve this information through the Google Maps JavaScript API?</p><p>The <code class="literal">places</code> library<a id="id506" class="indexterm"/> is there exactly for this purpose, and it enables you to look for places by using certain search parameters.</p><p>You can perform nearby searches where place results would be near the location that you have provided, most commonly, the user's location. You can search within a radius, or you can just specify a search string. You can even request for additional details, such as related photos, review ratings, phone numbers, and opening hours for particular places.</p><p>This recipe will focus on <a id="id507" class="indexterm"/>nearby <a id="id508" class="indexterm"/>searches by using the <code class="literal">places</code> library of the Google Maps JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec162"/>Getting ready</h2></div></div></div><p>This recipe will make use of the <code class="literal">drawing</code> library, therefore, it is advised to go over the first recipe—<em>Drawing shapes on the map</em>—of this chapter and refresh your understanding on the subject matter.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec163"/>How to do it...</h2></div></div></div><p>You can draw a circle, search for places within this circle with a keyword, and get detailed information on each of the places by following the ensuing steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add the <code class="literal">drawing</code> and <code class="literal">places</code> libraries to the bootstrap URL:<div><pre class="programlisting">&lt;script type="text/javascript"
   src="img/js? libraries=drawing,places&amp;sensor=false"&gt;
&lt;/script&gt;</pre></div></li><li class="listitem">Add the <code class="literal">circles</code> and <code class="literal">markers</code> global variables to push and pop the respective overlays outside the <code class="literal">initMap()</code> function:<div><pre class="programlisting">var circles;
var markers;</pre></div></li><li class="listitem">Add a <code class="literal">popup</code> global variable to hold the value of the <code class="literal">infoWindow</code> object:<div><pre class="programlisting">var popup;</pre></div></li><li class="listitem">Initialize the <code class="literal">circles</code> and <code class="literal">markers</code> arrays and the <code class="literal">infoWindow</code> object in the <code class="literal">initMap()</code> function:<div><pre class="programlisting">circles = new Array();
markers = new Array();
popup = new google.maps.InfoWindow();</pre></div></li><li class="listitem">Create a <code class="literal">circlecomplete</code> event handler in your <code class="literal">initMap()</code> function after creating the <code class="literal">drawingManager</code> object and attaching it to the map instance (items from number 6 to number 12 will be in this event handler):<div><pre class="programlisting">google.maps.event.addListener(drawingManager, 'circlecomplete', function(circle){

});</pre></div></li><li class="listitem">Inside the <code class="literal">circlecomplete</code> event handler, set <code class="literal">drawingMode</code> to <code class="literal">null</code>:<div><pre class="programlisting">drawingManager.setDrawingMode(null);</pre></div></li><li class="listitem">Add the <a id="id509" class="indexterm"/>latest drawn<a id="id510" class="indexterm"/> circle to the <code class="literal">circles</code> array and then reverse the order inside the array:<div><pre class="programlisting">circles.push(circle);
circles.reverse();</pre></div></li><li class="listitem">Pop the previous circle and set its map handle to null so that only the last drawn circle is shown:<div><pre class="programlisting">while(circles[1]){
    circles.pop().setMap(null);
}</pre></div></li><li class="listitem">Clear all previously drawn markers:<div><pre class="programlisting">while(markers[0]){
    markers.pop().setMap(null);
}</pre></div></li><li class="listitem">Create nearby search settings, setting the location as the circle center and the radius as the circle radius. Also, add a <code class="literal">keyword</code> property to return the places containing that keyword:<div><pre class="programlisting">var nearbyPlacesRequest = {
    location: circle.getCenter(),
    radius: circle.radius,
    keyword: 'pizza'
};</pre></div></li><li class="listitem">Get the handle for the <code class="literal">PlacesService</code> service object:<div><pre class="programlisting">var placesService = new google.maps.places.PlacesService(map);</pre></div></li><li class="listitem">Send the request with a callback function:<div><pre class="programlisting">placesService.nearbySearch(nearbyPlacesRequest, resultsCallback);</pre></div></li><li class="listitem">Outside the <code class="literal">initMap()</code> function, create a callback function for the <code class="literal">nearbySearch</code> request, using the following code snippet:<div><pre class="programlisting">function resultsCallback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
        for (var i = 0, l=results.length; i &lt; l; i++) {
            pinpointResult(results[i]);
        }
    }
}</pre></div></li><li class="listitem">Create a<a id="id511" class="indexterm"/> function to<a id="id512" class="indexterm"/> create a marker per the places result (the steps from number 15 to number 17 will be in this function):<div><pre class="programlisting">function pinpointResult(result) {

}</pre></div></li><li class="listitem">Create the marker inside the <code class="literal">pinpointResult()</code> function:<div><pre class="programlisting">var marker = new google.maps.Marker({
    map: map,
    position: result.geometry.location
});</pre></div></li><li class="listitem">Add a click event handler to the marker so that when it is clicked, the <code class="literal">infoWindow</code> object pops up:<div><pre class="programlisting">google.maps.event.addListener(marker, 'click', function() {
    var popupContent = '&lt;b&gt;Name: &lt;/b&gt; ' + result.name + '&lt;br/&gt;' + '&lt;b&gt;Vicinity: &lt;/b&gt;' + result.vicinity + '&lt;br/&gt;&lt;b&gt;Rating: &lt;/b&gt;' + result.rating; 
    popup.setContent(popupContent);
    popup.open(map, this);
});</pre></div></li><li class="listitem">Push the marker to the <code class="literal">markers</code> array:<div><pre class="programlisting">markers.push(marker);</pre></div><div><img src="img/8825OT_06_12.jpg" alt="How to do it..."/></div></li></ol></div><p>As shown <a id="id513" class="indexterm"/>in the preceding<a id="id514" class="indexterm"/> screenshot, you can draw a circle, search for places within this circle with a keyword, and get detailed information on each of the places found.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec164"/>How it works...</h2></div></div></div><p>The steps for this recipe require you to work a bit longer; however, the essence is simple. For a moment, forget about the details on the <code class="literal">circles</code> and <code class="literal">markers</code> arrays and the related logic; just concentrate on the nearby search:</p><div><pre class="programlisting">var nearbyPlacesRequest = {
	location: circle.getCenter(),
   radius: circle.radius,
   keyword: 'pizza'
};</pre></div><p>In the <code class="literal">circlecomplete</code> event handler (this is fired after we finish drawing our circle), we place a <code class="literal">nearbyPlacesRequest</code> object. This object should be of the type <code class="literal">google.maps.places.PlaceSearchRequest</code>.</p><p>The <code class="literal">location</code> property sets the <code class="literal">LatLng</code> object that should be the center of the search for the places. Usually, in nearby searches, this property is set as per the user's location. But for this recipe, we have tied it to the drawn circles' centers, as you can draw and search multiple times as per your needs.</p><p>The <a id="id515" class="indexterm"/>distance from <code class="literal">location</code> is set by the <code class="literal">radius</code> property so <a id="id516" class="indexterm"/>that the places are returned within this distance from the center of the circle. In our recipe, we have set the radius of the circle drawn.</p><p>Lastly, the <code class="literal">keyword</code> property filters the places so that the ones containing the keyword will be returned. Note that all the information not only includes the name or type of the place, but also the address and reviews, which will be matched against the keyword. So, be prepared for a place that is a cafeteria whose reviews include the keyword "pizza" in return of this request.</p><p>After preparing the request parameters, the next step is to send the request. First, we create a <code class="literal">PlacesService</code> object, taking our current map instance as a parameter:</p><div><pre class="programlisting">var placesService = new google.maps.places.PlacesService(map);</pre></div><p>By using the <code class="literal">placesService</code> object, we can send our request:</p><div><pre class="programlisting">placesService.nearbySearch(nearbyPlacesRequest, resultsCallback);</pre></div><p>The <code class="literal">nearbySearch</code> method takes two parameters, the first parameter being our old request parameters embedded in the <code class="literal">nearbyPlacesRequest</code> object and the second parameter being the callback function that returns the results. In our recipe, the second parameter is the <code class="literal">resultsCallback</code> function:</p><div><pre class="programlisting">function resultsCallback(results, status) {
    if (status == google.maps.places.PlacesServiceStatus.OK) {
        for (var i = 0, l=results.length; i &lt; l; i++) {
            pinpointResult(results[i]);
        }
    }
}</pre></div><p>This callback function takes two arguments here (in fact, it has a third parameter, which is related to search pagination): the array of the places found in the search and the service status. In the callback function, we first check if the service status is OK or not. Then we iterate through <code class="literal">results</code>, which is an array of the <code class="literal">PlaceResult</code> class type, to create the markers and fill in the <code class="literal">infoWindow</code> objects for each returned place.</p><p>We can create an associated marker for each place, as seen in the following code snippet:</p><div><pre class="programlisting">var marker = new google.maps.Marker({
    map: map,
    position: result.geometry.location
});</pre></div><p>The <code class="literal">geometry</code> property of the <code class="literal">result</code> object embeds a <code class="literal">location</code> property, which is of the <code class="literal">LatLng</code> class type. This is perfectly fit for the <code class="literal">position</code> property of the <code class="literal">Marker</code> class.</p><p>We can reach the details of the places in our <code class="literal">popup</code> object attached in the <code class="literal">click</code> event handler for the marker:</p><div><pre class="programlisting">google.maps.event.addListener(marker, 'click', function() {
    var popupContent = '&lt;b&gt;Name: &lt;/b&gt; ' + result.name + '&lt;br/&gt;' + '&lt;b&gt;Vicinity: &lt;/b&gt;' + result.vicinity + '&lt;br/&gt;&lt;b&gt;Rating: &lt;/b&gt;' + result.rating; 

    popup.setContent(popupContent);
   popup.open(map, this);
});</pre></div><p>You may have<a id="id517" class="indexterm"/> observed that we are using the <code class="literal">name</code>, <code class="literal">vicinity</code>, and <code class="literal">rating</code> properties <a id="id518" class="indexterm"/>of the place as the content for the popup. <code class="literal">name</code> represents the name of the place, <code class="literal">vicinity</code> returns a portion of the address information, and the <code class="literal">rating</code> value is the review rating of the place, 0.0 being the lowest and 5.0 being the highest.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec165"/>There's more...</h2></div></div></div><p>The details and options for searching nearby places is not limited to the options presented in this recipe. We will just dig a little more here. First comes the <code class="literal">nearbyPlacesRequest</code> object. The properties presented inside this object are: <code class="literal">location</code>, <code class="literal">radius</code>, and <code class="literal">keyword</code>.</p><p>However, the <code class="literal">PlaceSearchRequest</code> class, of which our object is a type, has much more than what we saw in this recipe. For instance, you can supply a <code class="literal">LatLngBounds</code> object instead of the location and radius:</p><div><pre class="programlisting">var requestBounds = new google.maps.LatLngBounds(
    new google.maps.LatLng(39.85, 32.74),
    new google.maps.LatLng(40.05, 32.84)
);

var nearbyPlacesRequest = {
    bounds: requestBounds,
    keyword: 'pizza'
};</pre></div><p>Please bear in mind <a id="id519" class="indexterm"/>that one option is to use <code class="literal">bounds</code>, and another option is to<a id="id520" class="indexterm"/> use the <code class="literal">location</code> and <code class="literal">radius</code> couple. Using one of them is compulsory for the <code class="literal">PlaceSearchRequest</code> class.</p><p>To filter the place results, using <code class="literal">keyword</code> is not the only solution. You can try the <code class="literal">name</code> property to directly match against the names of the places. For instance, the following code gives the places that have <code class="literal">Buckingham</code> in their name:</p><div><pre class="programlisting">var nearbyPlacesRequest = {
    location: circle.getCenter(),
    radius: circle.radius,
    name: 'Buckingham'
};</pre></div><p>If your drawn circle is in London, it will possibly bring up Buckingham Palace as well as a bunch of hotels nearby.</p><p>You can select the type of place to be returned by using the <code class="literal">types</code> property. This property takes an array of types such as:</p><div><pre class="programlisting">var nearbyPlacesRequest = {
    location: circle.getCenter(),
    radius: circle.radius,
    types: ['stadium', 'car_rental', 'library','university','administrative_area_level_3']
};</pre></div><p>There is really an immense range of types that Google Maps has been covering. You can just insert which place type you want, from car rentals to universities, just as we have done.</p><div><div><h3 class="title"><a id="note15"/>Note</h3><p>
<strong>Complete list of place types</strong>
</p><p>You can find the complete list of place types at:</p><p>
<a class="ulink" href="https://developers.google.com/places/documentation/supported_types">https://developers.google.com/places/documentation/supported_types</a>
</p></div></div><p>Other than <code class="literal">types</code>, <code class="literal">name</code>, and <code class="literal">bounds</code>, there are many more properties in the <code class="literal">PlaceSearchRequest</code> class such as <code class="literal">openNow</code>, which is a very handy property to show only the places that are open at the time of the search.</p><div><div><h3 class="title"><a id="note16"/>Note</h3><p>
<strong>Complete list of properties for the PlaceSearchRequest class</strong>
</p><p>You can find the complete list of properties for the <code class="literal">PlaceSearchRequest</code> class at:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#PlaceSearchRequest">https://developers.google.com/maps/documentation/javascript/reference#PlaceSearchRequest</a>
</p></div></div><p>Apart from the <a id="id521" class="indexterm"/>pool of options that appear while giving the request for a nearby<a id="id522" class="indexterm"/> search, there is also another bunch of properties in returning the results; in other words, the places represented by the <code class="literal">PlaceResult</code> class.</p><p>For example, an <code class="literal">icon</code> property of the <code class="literal">PlaceResult</code> class that we can use in the following code block inside our<a id="id523" class="indexterm"/> <code class="literal">pinpointResult()</code> function:</p><div><pre class="programlisting">var placeIcon = {
    url: result.icon,
    scaledSize: new google.maps.Size(30, 30)
};

var marker = new google.maps.Marker({
    map: map,position: result.geometry.location,
    icon: placeIcon
});</pre></div><p>This code block will return the places together with their respective icons:</p><div><img src="img/8825OT_06_13.jpg" alt="There's more..."/></div><p>Notice the<a id="id524" class="indexterm"/> painter's palette icon in the preceding screenshot, <a id="id525" class="indexterm"/>incorporated with the returned place, which is The Metropolitan Museum of Art in New York.</p><p>You can also access the types to which the place belongs. The <code class="literal">types</code> property of the <code class="literal">PlaceResult</code> class returns the types in a string array. Therefore, the <code class="literal">Result.types</code> property returns the following parameters for The Metropolitan Museum of Art in New York:</p><div><pre class="programlisting">["art_gallery", "museum", "establishment"]</pre></div><p>You can also get information on whether a place is open or closed at the time of search if you change the click handler of the marker, as shown in the following code snippet:</p><div><pre class="programlisting">google.maps.event.addListener(marker, 'click', function() {
    var popupContent = '&lt;b&gt;Name: &lt;/b&gt; ' + result.name + '&lt;br/&gt;' + '&lt;b&gt;Vicinity: &lt;/b&gt;' + result.vicinity; 
    if (result.opening_hours){
        if (result.opening_hours.open_now){
            popupContent += '&lt;br/&gt;&lt;b&gt;Is Open Now: &lt;/b&gt; '
            + 'YES'
        }
        else {
            popupContent += '&lt;br/&gt;&lt;b&gt;Is Open Now: &lt;/b&gt; '
            + 'NO'
        }
    }
    popup.setContent(popupContent);
    popup.open(map, this);
});</pre></div><p>Using the<a id="id526" class="indexterm"/> preceding code, you would have come up with information such <a id="id527" class="indexterm"/>as the following:</p><div><img src="img/8825OT_06_14.jpg" alt="There's more..."/></div><div><div><h3 class="title"><a id="note17"/>Note</h3><p>
<strong>Complete list of properties for the PlaceResult class</strong>
</p><p>You can find the complete list of properties of the <code class="literal">PlaceResult</code> class at:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#PlaceResult">https://developers.google.com/maps/documentation/javascript/reference#PlaceResult</a>
</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec54"/>Finding places with the autocomplete option</h1></div></div></div><p>The Google Maps JavaScript API<a id="id528" class="indexterm"/> offers a <a id="id529" class="indexterm"/>variety of ways to search for places and additional information. You can apply nearby searches and have detailed information about places together with their geometry, as you have observed in the recipe named <em>Searching and showing nearby places</em> in this chapter.</p><p>How about having a text field control with an autocomplete feature for searching places? You can hardcode it, but there is no need to do so, as Google already has a feature exactly for this.</p><p>In this recipe, we will go over the autocomplete feature of the <code class="literal">places</code> library for the Google Maps JavaScript API.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec166"/>Getting ready</h2></div></div></div><p>This recipe will make use of the concepts related to the <code class="literal">places</code> library introduced in the <em>Searching and showing nearby places</em> recipe of this chapter. It is advised to go over this recipe to have a general understanding of places and their properties.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec167"/>How to do it...</h2></div></div></div><p>You can add the text field<a id="id530" class="indexterm"/> and search for places with the autocomplete <a id="id531" class="indexterm"/>feature by carrying out the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Insert an input HTML element that will be used as the autocomplete field:<div><pre class="programlisting">&lt;div id="searchDiv"&gt;
&lt;input id="autocomplete_searchField" type="text" size="40"  placeholder="Search for Places"&gt;
&lt;/div&gt;</pre></div></li><li class="listitem">Define the markers and pop-up variables as global outside the <code class="literal">initMap()</code> function:<div><pre class="programlisting">var markers;
var popup;</pre></div></li><li class="listitem">Initialize the global variables in <code class="literal">initMap()</code>:<div><pre class="programlisting">markers = new Array();
popup = new google.maps.InfoWindow();</pre></div></li><li class="listitem">Get the <code class="literal">div</code> tag with its ID as <code class="literal">searchDiv</code> and push it as a custom control after creating the map with its <code class="literal">initMap()</code> options:<div><pre class="programlisting">var searchDiv = document.getElementById('autocomplete_searchField');
map.controls[google.maps.ControlPosition.TOP_CENTER].push(searchDiv);</pre></div></li><li class="listitem">Get the handle for the input element:<div><pre class="programlisting">var searchField = document.getElementById('autocomplete_searchField');</pre></div></li><li class="listitem">Supply the properties for the autocomplete search request:<div><pre class="programlisting">var searchOptions = {
    bounds: new google.maps.LatLngBounds(
       new google.maps.LatLng(8.54, 17.33),
        new google.maps.LatLng(39.67, 43.77)
    ),
   types: new Array()
};</pre></div></li><li class="listitem">Get the <code class="literal">autocomplete</code> object by supplying the input HTML element to be used, namely <code class="literal">searchField</code>, and the <code class="literal">searchOptions</code>:<div><pre class="programlisting">var autocompleteSearch = new google.maps.places.Autocomplete(searchField, searchOptions);</pre></div></li><li class="listitem">Create a <code class="literal">place_changed</code> event handler for the <code class="literal">autocomplete</code> object (steps 9 to 11 will be in this event handler):<div><pre class="programlisting">google.maps.event.addListener(autocompleteSearch, 'place_changed', function() {
});</pre></div></li><li class="listitem">In the event handler, clear the previous markers first:<div><pre class="programlisting">while(markers[0]) {
    markers.pop().setMap(null);
}</pre></div></li><li class="listitem">Get the <code class="literal">PlaceResult</code> object in response to the autocompleted search:<div><pre class="programlisting">var place = autocompleteSearch.getPlace();</pre></div></li><li class="listitem">If the place has a geometry, call a function to create the associated marker:<div><pre class="programlisting">if (place.geometry) {
    pinpointResult(place);
}</pre></div></li><li class="listitem">Create a function for<a id="id532" class="indexterm"/> creating a marker and <a id="id533" class="indexterm"/>adding a click event handler for the marker:<div><pre class="programlisting">function pinpointResult(result) {
    var placeIcon = {
        url: result.icon,
        scaledSize: new google.maps.Size(30, 30)
    };
                    
    var marker = new google.maps.Marker({
        map: map,
        position: result.geometry.location,
        icon: placeIcon
    });
                    
    map.setCenter(result.geometry.location);
    map.setZoom(16);

    google.maps.event.addListener(marker, 'click', function() {
       var popupContent = '&lt;b&gt;Name: &lt;/b&gt; ' + result.name + '&lt;br/&gt;' + '&lt;b&gt;Vicinity: &lt;/b&gt;' + result.vicinity;
    
        popup.setContent(popupContent);
        popup.open(map, this);
    });
    markers.push(marker);
}</pre></div><div><img src="img/8825OT_06_15.jpg" alt="How to do it..."/></div></li></ol></div><p>You can make use of the autocomplete search features as shown in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec168"/>How it works...</h2></div></div></div><p>In this recipe, we first<a id="id534" class="indexterm"/> created an input element with some placeholder<a id="id535" class="indexterm"/> text (beware that this is not supported in older browsers) that will serve as our text field for searching places:</p><div><pre class="programlisting">&lt;input id="autocomplete_searchField" type="text" size="40"  placeholder="Search for Places"&gt;&lt;/input&gt;</pre></div><p>Then, we added the <code class="literal">div</code> container tag as a custom control for the Google Maps JavaScript API to have the text field inside the Google Maps UI:</p><div><pre class="programlisting">var searchDiv = document.getElementById('searchDiv');
map.controls[google.maps.ControlPosition.TOP_CENTER].push(searchDiv);</pre></div><p>We set the properties for the autocomplete search in an <code class="literal">AutocompleteOptions</code> object named <code class="literal">searchOptions</code>:</p><div><pre class="programlisting">var searchOptions = {
   bounds: new google.maps.LatLngBounds(
   new google.maps.LatLng(8.54, 17.33),
        new google.maps.LatLng(39.67, 43.77)
    ),
   types: new Array()
};</pre></div><p>In the preceding code <a id="id536" class="indexterm"/>snippet, <code class="literal">bounds</code> serves to define the<a id="id537" class="indexterm"/> boundaries for the places to be found. Here, we are setting it to a large predefined boundary; you can set it to another <code class="literal">LatLngBounds</code> object of your taste.</p><p>The <code class="literal">types</code> array is empty for this recipe; actually this array is for restricting the types of places to be found, whether it be a business, city, or region. In our example, it is empty, so our searches will return every type of <code class="literal">PlaceResult</code> object.</p><p>We created our autocomplete object with two ingredients: <code class="literal">searchField</code> being the input element and <code class="literal">searchOptions</code> having the <code class="literal">bounds</code> and <code class="literal">types</code> properties:</p><div><pre class="programlisting">var autocompleteSearch = new google.maps.places.Autocomplete(searchField, searchOptions);</pre></div><p>Then, we create our <code class="literal">place_changed</code> event handler for our <code class="literal">Autocomplete</code> object, which gets fired when the user selects the <code class="literal">PlaceResult</code> provided:</p><div><pre class="programlisting">google.maps.event.addListener(autocompleteSearch, 'place_changed', function() {
    while(markers[0]) {
        markers.pop().setMap(null);
    }

    var place = autocompleteSearch.getPlace();
    if (place) {
        if (place.geometry) {
            pinpointResult(place);
        }
    }
});</pre></div><p>In the event handler, we detach the marker previously mapped on the map; then, we call the <code class="literal">getPlace()</code> method to get the <code class="literal">Place</code> object of type <code class="literal">PlaceResult</code> in this context. If the place exists and if it has geometry (meaning that, a proper <code class="literal">PlaceResult</code> instance is found), we call the <code class="literal">pinpoint()</code> function to create a marker from <code class="literal">PlaceResult</code> and attach a click event <a id="id538" class="indexterm"/>handler for the marker to popup the <a id="id539" class="indexterm"/>associated <code class="literal">InfoWindow</code> object:</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec169"/>There's more...</h2></div></div></div><p>In our recipe, we set the <code class="literal">bounds</code> property in the <code class="literal">searchOptions</code> object to a predefined boundary:</p><div><pre class="programlisting">bounds: new google.maps.LatLngBounds(
    new google.maps.LatLng(8.54, 17.33),
    new google.maps.LatLng(39.67, 43.77)
),</pre></div><p>This line sets the autocomplete operation to find the searched places primarily within, but not limited to, the specific <code class="literal">LatLngBounds</code> object. Therefore, do not get surprised if you happen to give a small boundary and find results outside the boundary.</p><p>We're setting the boundary to a <code class="literal">LatLngBounds</code> object, such as boundary of the map, and you can change it afterwards:</p><div><pre class="programlisting">autocompleteSearch.setBounds(map.getBounds());</pre></div><p>But what happens if you need to set the bounds to the current viewport, which gets updated as you pan and zoom in/out the map? There is a way, as follows:</p><div><pre class="programlisting">autocompleteSearch.bindTo('bounds', map)</pre></div><p>By using this <code class="literal">bindTo()</code> function, the <code class="literal">bounds</code> property is bound to the current viewport boundary and gets updated when it changes.</p><p>Apart from the <code class="literal">bounds</code> property, there is a <code class="literal">types</code> property that we have set as an empty array, but it does not need to be empty to filter out the predictions done by our <code class="literal">autocompleteSearch</code> object:</p><div><pre class="programlisting">types: ['(regions)']</pre></div><p>This renders the <code class="literal">autocompleteSearch</code> object, searching only for administrative regions instead of all places. So when you type <code class="literal">colos</code>, the Colosseum in Rome does not come up, as only administrative regions are permitted to be displayed in the <code class="literal">autocompleteSearch</code> object; you can observe this in the following screenshot:</p><div><img src="img/8825OT_06_16.jpg" alt="There's more..."/></div><div><div><h3 class="title"><a id="note18"/>Note</h3><p>
<strong>Complete list of entries for the types property in the google.maps.places.AutocompleteOptions class</strong>
</p><p>You can find the complete list of entries for the <code class="literal">types</code> property in the <code class="literal">AutocompleteOptions</code> class at:</p><p>
<a class="ulink" href="https://developers.google.com/maps/documentation/javascript/reference#AutocompleteOptions">https://developers.google.com/maps/documentation/javascript/reference#AutocompleteOptions</a>
</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec55"/>Adding drag zoom to the map</h1></div></div></div><p>Google Maps<a id="id540" class="indexterm"/> has a zoom control and the JavaScript API makes use of this control to <a id="id541" class="indexterm"/>offer a variety of options for programmers. It is a very <a id="id542" class="indexterm"/>useful and easy-to-use control. But there are other ways for zooming; for instance, by drawing an area of interest by dragging a box, so that the map zooms to that area.</p><p>This functionality does not exist in the standard Google Maps JavaScript API and any of its libraries; you have to code it. Or, you can make use of the utility libraries, developed by the good guys, at the following link:</p><p>
<a class="ulink" href="https://code.google.com/p/google-maps-utility-library-v3/wiki/Libraries">https://code.google.com/p/google-maps-utility-library-v3/wiki/Libraries</a>
</p><p>One of their libraries, <code class="literal">KeyDragZoom</code>, is exactly for this zoom functionality, and we will use this library in this recipe.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec170"/>Getting ready</h2></div></div></div><p>You have to <a id="id543" class="indexterm"/>download<a id="id544" class="indexterm"/> the <code class="literal">keydragzoom.js</code> JavaScript source file from the following link (the latest release is 2.0.9 as of the time of writing this book) and place it in the same directory as our recipe source code:</p><p>
<a class="ulink" href="http://google-maps-utility-library-v3.googlecode.com/svn/tags/keydragzoom/">http://google-maps-utility-library-v3.googlecode.com/svn/tags/keydragzoom/</a>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec171"/>How to do it...</h2></div></div></div><p>Here are the steps to perform zoom by dragging a box and zooming into the area inside the box:</p><div><ol class="orderedlist arabic"><li class="listitem">Use a reference for the <code class="literal">keydragzoom</code>.<code class="literal">js</code> file:<div><pre class="programlisting">&lt;script type="text/javascript" src="img/keydragzoom.js"&gt;
&lt;/script&gt;</pre></div></li><li class="listitem">Enable the functionality after setting all the map-related options in the <code class="literal">initMap()</code> function: <div><pre class="programlisting">map.enableKeyDragZoom({
    visualEnabled: true,
    visualPosition: google.maps.ControlPosition.LEFT,
    visualPositionOffset: new google.maps.Size(35, 0),
    visualPositionIndex: null,
    visualSprite: 'http://maps.gstatic.com/mapfiles/ftr/controls/dragzoom_btn.png',
    visualSize: new google.maps.Size(20, 20),
    visualTips: {
        off: "Turn on",
        on: "Turn off"
    }
});</pre></div><div><img src="img/8825OT_06_17.jpg" alt="How to do it..."/></div></li></ol></div><p>You can make use of <a id="id545" class="indexterm"/>zooming <a id="id546" class="indexterm"/>by dragging a box as shown in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec172"/>How it works...</h2></div></div></div><p>You can perform drag zooms either by pressing the control button and drawing a box, or simpler than that, holding the <em>Shift</em> key and drawing the box to zoom into the area inside the box.</p><p>To do this, we first added the JavaScript source file of the drag zoom library in our recipe. After setting the map options and using the map instance we can enable the drag zoom functionality by using the <code class="literal">enableKeyDragZoom()</code> method<a id="id547" class="indexterm"/> of the map instance.</p><p>This extension method is not a part of the Google Maps JavaScript API and comes with the <code class="literal">keydragzoom</code> library. There are a few associated options that are embedded under the <code class="literal">KeyDragZoomOptions</code> class.</p><p>Keep in mind that, in its simplest form, you can use the key drag zoom functionality by enabling it:</p><div><pre class="programlisting">map.enableKeyDragZoom();</pre></div><p>The only difference <a id="id548" class="indexterm"/>would be that you would have to use the <em>Shift</em> key as your <a id="id549" class="indexterm"/>only way because there would be no drag zoom control button.</p><p>The properties embedded in the <code class="literal">KeyDragZoomOptions</code> class are all about the control button that is placed below the standard zoom control:</p><div><img src="img/8825OT_06_18.jpg" alt="How it works..."/></div><p>The <code class="literal">visualEnabled</code> property<a id="id550" class="indexterm"/> sets the control to be seen or not, so if this property is <code class="literal">false</code>, there is no need for other properties as well. The <code class="literal">visualPosition</code> property sets the control position; we have placed it to the left. A detailed description on control positions can be found in the <em>Changing the position of controls</em> recipe of <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <em>Working with Controls</em>.</p><div><div><h3 class="title"><a id="note19"/>Note</h3><p>
<strong>Complete list of properties in the KeyDragZoomOptions class</strong>
</p><p>You can find the complete list of properties in the <code class="literal">KeyDragZoomOptions</code> class at the following link:</p><p>
<a class="ulink" href="http://google-maps-utility-library-v3.googlecode.com/svn/tags/keydragzoom/2.0.9/docs/reference.html">http://google-maps-utility-library-v3.googlecode.com/svn/tags/keydragzoom/2.0.9/docs/reference.html</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec173"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can review the Google Maps JavaScript API controls and their use in <a class="link" href="ch04.html" title="Chapter 4. Working with Controls">Chapter 4</a>, <em>Working with Controls</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec56"/>Creating custom popups/infoboxes</h1></div></div></div><p>We have already created popups or infoboxes in <a class="link" href="ch03.html" title="Chapter 3. Adding Vector Layers">Chapter 3</a>, <em>Adding Vector Layers</em>. As it is stated there, almost every mapping application has the ability to display information that is related to the features shown on it. This information can be related to a marker or a map. Instead of showing all the information on the map, popups or info boxes are used only when needed.</p><p>The Google Maps JavaScript API has a <code class="literal">google.maps.InfoWindow</code> class<a id="id551" class="indexterm"/> to create a default infobox for developers. In some cases, you need custom infoboxes to show information. There are two ways to do this:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first way is to create a custom class that inherits from the <code class="literal">google.maps.OverlayView</code> class <a id="id552" class="indexterm"/>and fill the methods to show/hide infoboxes with custom CSS styles.</li><li class="listitem" style="list-style-type: disc">The other, easier way is to use a library created for you. There is a project on Google Code named <code class="literal">google-maps-utility-library-v3</code> that holds the number of libraries extending the Google Maps JavaScript API. Here's the link:<p>
<a class="ulink" href="https://code.google.com/p/google-maps-utility-library-v3/wiki/Libraries">https://code.google.com/p/google-maps-utility-library-v3/wiki/Libraries</a>
</p><p>This project has a library named <code class="literal">InfoBox</code> that makes it possible to create custom infoboxes or map labels.</p></li></ul></div><p>In this recipe, we will use the previously mentioned library to create custom infoboxes that can be bound to a marker and a map. The same infobox shows different information according to its binding. We will also add a simple map label at a fixed place, if extra information needs to be added to the map.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec174"/>Getting ready</h2></div></div></div><p>The first recipe of <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1</a>, <em>Google Maps JavaScript API Basics</em>, will do our work. We will add to it in this recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec175"/>How to do it...</h2></div></div></div><p>You can get custom infoboxes<a id="id553" class="indexterm"/> by completing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">First, go to the following address to get the latest <code class="literal">InfoBox</code> source code and save it into a file named <code class="literal">infobox.js</code> under the <code class="literal">lib</code> directory. We used the <code class="literal">/1.1.9/src/infobox_packed.js</code> file under the following URL:<p>
<a class="ulink" href="http://google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/">http://google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/</a>
</p></li><li class="listitem">Then, we get the codes by creating a simple map recipe, and add the following code to add our library to the page:<div><pre class="programlisting">&lt;script type="text/javascript" src='lib/infobox.js'&gt;&lt;/script&gt;</pre></div></li><li class="listitem">The next step is to create the contents of the infobox with the help of a <code class="literal">div</code> element:<div><pre class="programlisting">//Creating the contents for info box
var boxText = document.createElement('div');
boxtext.className = 'infoContent';
boxText.innerHTML = '&lt;b&gt;Marker Info Box&lt;/b&gt; &lt;br&gt; Gives   information about marker';</pre></div></li><li class="listitem">Now we create an object that defines the options of the infobox:<div><pre class="programlisting">//Creating the info box options.
var customInfoBoxOptions = {
    content: boxText,
    pixelOffset: new google.maps.Size(-100, 0),
    boxStyle: {
        background: "url('img/tipbox2.gif') no-repeat",
        opacity: 0.75,
        width: '200px'
    },
    closeBoxMargin: '10px 2px 2px 2px',
    closeBoxURL: 'img/close.gif',
    pane: 'floatPane'
};</pre></div></li><li class="listitem">We can initialize our custom infobox in the following manner:<div><pre class="programlisting">//Initializing the info box
var customInfoBox = new InfoBox(customInfoBoxOptions);</pre></div></li><li class="listitem">Also, we create a JSON object that defines the options of a map label:<div><pre class="programlisting">//Creating the map label options.
var customMapLabelOptions = {
    content: 'Custom Map Label',
    closeBoxURL: "",
    boxStyle: {
        border: '1px solid black',
        width: '110px'
    },
    position: new google.maps.LatLng(40.0678,   33.1252),
    pane: 'mapPane',
    enableEventPropagation: true
};</pre></div></li><li class="listitem">Then, we initialize <a id="id554" class="indexterm"/>the map label and add it to the map in the following manner:<div><pre class="programlisting">//Initializing the map label
var customMapLabel = new InfoBox(customMapLabelOptions);
//Showing the map label
customMapLabel.open(map);</pre></div></li><li class="listitem">Create a simple marker that will be bound to the infobox:<div><pre class="programlisting">//Initializing the marker for showing info box
var marker = new google.maps.Marker({
    map: map,
    draggable: true,
    position: new google.maps.LatLng(39.9078,    32.8252),
    visible: true
});</pre></div></li><li class="listitem">When the map is ready, we will open the infobox attached to the marker:<div><pre class="programlisting">//Opening the info box attached to marker
customInfoBox.open(map, marker);</pre></div></li><li class="listitem">We should create event listeners for the marker and map for their click events to show the infobox. An infobox will appear at the bottom of the marker when the marker is clicked or when the map is clicked on at some point:<div><pre class="programlisting">//Listening marker to open info box again with contents //related to marker
google.maps.event.addListener(marker, 'click', function (e) {
    boxText.innerHTML = '&lt;b&gt;Marker Info Box&lt;/b&gt; &lt;br&gt; Gives information about marker';
    customInfoBox.open(map, this);
});

//Listening map click to open info box again with //contents related to map coordinates
google.maps.event.addListener(map,'click', function (e) {
    boxText.innerHTML = '&lt;b&gt;Map Info Box&lt;/b&gt; &lt;br&gt; Gives information about coordinates &lt;br&gt; Lat: ' + e.latLng.lat().toFixed(6) + " -   Lng: ' + e.latLng.lng().toFixed(6);
    customInfoBox.setPosition(e.latLng);
    customInfoBox.open(map);
});</pre></div></li><li class="listitem">You can also listen to events of infoboxes. We will add a listener to the click event of the close button of the infobox:<div><pre class="programlisting">//Listening info box for clicking close button
google.maps.event.addListener(customInfoBox, 'closeclick', function () {
        console.log('Info Box Closed!!!');
});</pre></div></li><li class="listitem">Go to your <a id="id555" class="indexterm"/>local URL where your HTML file is stored in your favorite browser; you will see a popup with an infobox below. If you click on the map, you will see the coordinates of the mouse click inside the infobox, or if you click on the marker, you will see the infobox with the contents related to the marker. There is also a fixed map label at the top right of the map with some content; it says <strong>Custom Map Label</strong>.<div><img src="img/8825OT_06_19.jpg" alt="How to do it..."/></div></li></ol></div><p>You can get your custom <a id="id556" class="indexterm"/>infobox as shown in the preceding screenshot.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec176"/>How it works...</h2></div></div></div><p>Using libraries in your web applications is common. The use of libraries saves development and debugging time for developers. Compared to your limited cases, libraries are tested in different environments for different cases.</p><p>As stated earlier, you can also write your own custom class to show custom infoboxes or map labels, but this is not a suggested way to discover America from the beginning. We used the library named <code class="literal">InfoBox</code>, which is written for this purpose. The documentation of this library is similar to the Google Maps JavaScript API documentation (found at <a class="ulink" href="http://google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/docs/reference.html">http://google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/docs/reference.html</a>). The latest version of the library is 1.1.9 at the time this book was being written. Please update the library if there is a new version when you are using it.</p><p>The <code class="literal">InfoBox</code> library is built on the Google Maps JavaScript API base class named <code class="literal">google.maps.OverlayView</code>, which is used for adding extra layers or views to the map.</p><p>As expected, there is a need for content, which is defined in the <code class="literal">div</code> elements.</p><div><pre class="programlisting">    //Creating the contents for info box
    var boxText = document.createElement('div');
    boxtext.className = 'infoContent';
    boxText.innerHTML = '&lt;b&gt;Marker Info Box&lt;/b&gt; &lt;br&gt; Gives information about marker';</pre></div><p>The <code class="literal">InfoBox</code> library can be initialized to show an infobox with its constructor, with a parameter created from the <code class="literal">InfoBoxOptions</code> class, as follows:</p><div><pre class="programlisting">    //Creating the info box options.
    var customInfoBoxOptions = {
        content: boxText,
        pixelOffset: new google.maps.Size(-100, 0),
        boxStyle: {
            background: "url('img/tipbox2.gif') no-repeat",
            opacity: 0.75,
            width: '200px'
        },
        closeBoxMargin: '10px 2px 2px 2px',
        closeBoxURL: "img/close.gif",
        pane: 'floatPane'
    };</pre></div><p>The <code class="literal">InfoBox</code> library can be<a id="id557" class="indexterm"/> initialized to create a map label with its constructor with a parameter created from the <code class="literal">InfoBoxOptions</code> class, as follows:</p><div><pre class="programlisting">    //Creating the map label options.
    var customMapLabelOptions = {
        content: 'Custom Map Label',
        closeBoxURL: '',
        boxStyle: {
            border: '1px solid black',
            width: '110px'
        },
        position: new google.maps.LatLng(40.0678, 33.1252),
        pane: 'mapPane',
        enableEventPropagation: true
    };</pre></div><p>The parameters for the <code class="literal">InfoBoxOption</code> class are explained in the following list:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>content</strong>: This can be a<a id="id558" class="indexterm"/> string or an HTML element. In our <a id="id559" class="indexterm"/>example, we used HTML <code class="literal">div</code> elements to create a beautiful decorated infobox. You can use the <code class="literal">CSS</code> style elements to create your custom infobox.</li><li class="listitem" style="list-style-type: disc"><strong>pixelOffset</strong>: This is the offset in<a id="id560" class="indexterm"/> pixels from the top-left corner of the infobox. In this recipe, we want to center the infobox, so we used half the width of the infobox.</li><li class="listitem" style="list-style-type: disc"><strong>boxStyle</strong>: This<a id="id561" class="indexterm"/> defines the CSS styles used for the infobox. The <code class="literal">background</code> style property used in this recipe shows the upper-headed arrow image. This image is a customized image to be placed in the middle of the infobox. The names of the <code class="literal">width</code> and <code class="literal">opacity</code> style properties suggest how they are used.</li><li class="listitem" style="list-style-type: disc"><strong>closeBoxMargin</strong>: This is <a id="id562" class="indexterm"/>used to define where the close box will be placed in the CSS margin style value. In this recipe, we used the upper-headed arrow at the top of the infobox, so we must move the close box below the arrow image.</li><li class="listitem" style="list-style-type: disc"><strong>closeBoxURL</strong>: This is the image <a id="id563" class="indexterm"/>URL of the close box. Google's standard close box image is used here. If you do not want to add a close box, set this property to empty.</li><li class="listitem" style="list-style-type: disc"><strong>pane</strong>: This is the pane<a id="id564" class="indexterm"/> where the infobox will appear. If you are using it as an infobox, then use <code class="literal">floatPane</code>. If you are using it as a map label, use <code class="literal">mapPane</code>.</li><li class="listitem" style="list-style-type: disc"><strong>position</strong>: This is the <a id="id565" class="indexterm"/>geographic location of the infobox or map label defined in the objects created from <code class="literal">google.maps.LatLng class</code>.</li><li class="listitem" style="list-style-type: disc"><strong>enableEventPropagation</strong>: This is used <a id="id566" class="indexterm"/>to propagate the events. If you are using the <code class="literal">InfoBox</code> class for map labels, you don't need to get the events of the label. The map's events are more important in this case.</li></ul></div><p>It doesn't matter whether it is an infobox or map label, you can show <code class="literal">InfoBox</code> objects with the <code class="literal">open()</code> method. If there isn't an anchor point, such as a marker, it only gets one parameter as a map; otherwise you should add the second parameter as an anchor object. Two usage examples are as follows:</p><div><pre class="programlisting">    //Showing the map label    
    customMapLabel.open(map);
    //Opening the info box attached to marker
    customInfoBox.open(map, marker);</pre></div><p>If you need to change the position of the infobox like in the event handlers, you should use the <code class="literal">setPosition()</code> method of the class. This method gets objects created from the <code class="literal">google.maps.LatLng</code> class.</p><div><pre class="programlisting">    //Changing the position of info box    
    customInfoBox.setPosition(e.latLng);</pre></div><p>The events used in this recipe were the topic of <a class="link" href="ch05.html" title="Chapter 5. Understanding Google Maps JavaScript API Events">Chapter 5</a>, <em>Understanding Google Maps JavaScript API Events</em>. We did not go into detail, but for some purposes, there are also events of the <code class="literal">InfoBox</code> class to handle. The following code block will listen to the clicking of the close button that will result in the closing of the infobox. The event handler of the listener will log only a message to the console for demonstration:</p><div><pre class="programlisting">    //Listening info box for clicking close button
    google.maps.event.addListener(customInfoBox, 'closeclick', function () {
        console.log('Info Box Closed!!!');
    });</pre></div><p>As you can see, in the preceding code, the Google Maps JavaScript API has a lot of potential that can be extracted with the help of extra libraries. The Google Maps JavaScript API gives you the base, and you can build whatever you want on it.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec177"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating a simple map in a custom DIV element</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Google Maps JavaScript API Basics">Chapter 1, </a><em>Google Maps JavaScript API Basics</em></li><li class="listitem" style="list-style-type: disc">The <em>Getting the coordinates of a mouse click</em> recipe in <a class="link" href="ch05.html" title="Chapter 5. Understanding Google Maps JavaScript API Events">Chapter 5, </a><em>Understanding Google Maps JavaScript API Events</em></li></ul></div></div></div></body></html>