<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;A Feed Reader"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. A Feed Reader</h1></div></div></div><p>In our first project, Task Manager, we explored some of the basics of Sencha Architect. We also covered some of the ways to store, edit, and display data in Sencha Touch.</p><p>This chapter will explore three new areas:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The NavigationView</li><li class="listitem" style="list-style-type: disc">Loading remote data</li><li class="listitem" style="list-style-type: disc">Creating complex layouts with Sencha XTemplate</li></ul></div><p>In this chapter we will build an RSS reader to grab news feeds from a list of sites and display the contents of those feeds in a complex pattern of columns and rows:</p><div class="mediaobject"><img src="graphics/8901OS_02_1.jpg" alt="A Feed Reader"/></div><p>The newsreader will also build on the Sencha Touch <code class="literal">NavigationView</code> component to automate a number of helpful navigation elements for touch devices.</p><div class="section" title="The basic application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>The basic application</h1></div></div></div><p>Our basic application will start off much the same way as our previous application:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A <code class="literal">NavigationView</code> component to hold all our view components</li><li class="listitem" style="list-style-type: disc">A list to display feeds</li><li class="listitem" style="list-style-type: disc">A store to hold the list data</li><li class="listitem" style="list-style-type: disc">A model to describe the data</li><li class="listitem" style="list-style-type: disc">A form to add items to the list</li></ul></div><p>We will spend most of our time setting up <code class="literal">NavigationView</code> and a much briefer time covering the additional components, since these are very similar to what we did in <a class="link" href="ch01.html" title="Chapter 1. A Simple Task List">Chapter 1</a>, <span class="emphasis"><em>A Simple Task List</em></span>.</p><div class="section" title="An overview of NavigationView"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>An overview of NavigationView</h2></div></div></div><p>In <a class="link" href="ch01.html" title="Chapter 1. A Simple Task List">Chapter 1</a>, <span class="emphasis"><em>A Simple Task List</em></span>, we manually coded a Back button into our Details view. The Back button was hidden by default and only <a id="id163" class="indexterm"/>displayed when an item in the list was clicked on and the Details view appeared. The <a id="id164" class="indexterm"/>Back button returned our user to the main list of tasks and then hid itself until it was needed again.</p><p>In our new Feed Reader application, we will use <code class="literal">NavigationView</code>, which handles all of this functionality automatically. <code class="literal">NavigationView</code> functions similar to a card layout where a number of panels can be hidden or displayed based on the active item for the view.</p><p>However, unlike a card layout, where the items are typically declared when the layout is created, <code class="literal">NavigationView</code> typically adds items dynamically using the <a id="id165" class="indexterm"/>
<code class="literal">push()</code> function to add panels and other items for display. For example, let's assume we have a <code class="literal">NavigationView</code> component called <a id="id166" class="indexterm"/>
<code class="literal">MainView</code> that contains a list view with a list of items. We also have a details panel called <a id="id167" class="indexterm"/>
<code class="literal">Details</code>. When the user clicks on an item in the list, we can call:</p><div class="informalexample"><pre class="programlisting">var main = Ext.getCmp('MainView');
var details = Ext.create('MyApp.view.Details', {
    title: 'Something Cool'
});
main.push(details);</pre></div><p>This code will push a copy of our Details view onto <a id="id168" class="indexterm"/>
<code class="literal">NavigationView</code> (<code class="literal">MainView</code>). <code class="literal">NavigationView</code> will use an animation transition to slide the new Details panel into place, automatically create the Back button for us, and then set the title of our Navigation bar to <code class="literal">Something Cool</code>. It also handles all of the behind-the-scenes code for taking us back to our main list when the Back button is clicked.</p><p>This makes <code class="literal">NavigationView</code> a very handy <a id="id169" class="indexterm"/>component to serve as the foundation for our application.</p><p>Let's begin by creating a new Sencha Touch application in Sencha Architect. For this application we are going to target the iPad tablet sized screen. This will give us more room to create an interesting display. We will also show you how to adjust the screen for iPhone and mobile phone users on the fly.</p><p>Use the <span class="strong"><strong>Size</strong></span> menu at the bottom of the design area to select iPad as our screen size and drag a <span class="strong"><strong>NavigationView</strong></span> object from the toolbox onto the iPad image in our display area. In the <span class="strong"><strong>Config</strong></span> section, set <span class="strong"><strong>userAlias</strong></span> to <span class="strong"><strong>MainView</strong></span> so that we can reference it later.</p><p>Next, we need to add a <a id="id170" class="indexterm"/>
<a id="id171" class="indexterm"/>
<span class="strong"><strong>List</strong></span> view to <span class="strong"><strong>MainView</strong></span> and give it a <span class="strong"><strong>Store</strong></span> (with a <a id="id172" class="indexterm"/>
<span class="strong"><strong>LocalStorage</strong></span> proxy) and <span class="strong"><strong>Model</strong></span>, just as we did in <a class="link" href="ch01.html" title="Chapter 1. A Simple Task List">Chapter 1</a>, <span class="emphasis"><em>A Simple Task List</em></span>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start by adding a model and configure it as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">userClassName</code> to <code class="literal">Feed</code></li><li class="listitem" style="list-style-type: disc">Add three fields:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">id</code> as <code class="literal">int</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code> as <code class="literal">string</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">url</code> as <code class="literal">string</code></li></ul></div></li></ul></div></li><li class="listitem">Next, add the store and configure it as follows:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A <code class="literal">LocalStorage</code> proxy</li><li class="listitem" style="list-style-type: disc">Set <code class="literal">userClassName</code> to <code class="literal">FeedStore</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">storeId</code> to <code class="literal">FeedStore</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">model</code> to <code class="literal">Feed</code></li></ul></div></li><li class="listitem">Finally configure the list:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">title</code> to <code class="literal">Feed Bag</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">itemTpl</code> to <code class="literal">&lt;div&gt;{name}&lt;/div&gt;</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">FeedList</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">store</code> to <code class="literal">FeedStore</code></li></ul></div><div class="mediaobject"><img src="graphics/8901OS_02_2.jpg" alt="An overview of NavigationView"/></div></li></ol></div></div><div class="section" title="Adding the form"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Adding the form</h2></div></div></div><p>Since our form is pretty simple this time (and to add a bit of variety) we are going to use a sheet to display our form. The sheet can be set to slide <a id="id173" class="indexterm"/>in from the top, bottom, or sides of the screen. It can also be set to pop in from the center.</p><p>In this case, we do not want the sheet to be a child of our <a id="id174" class="indexterm"/>
<span class="strong"><strong>MainView</strong></span> container; we only want to create it when we need it, not when the application launches. To do this, we drag the <a id="id175" class="indexterm"/>
<span class="strong"><strong>Sheet</strong></span> object over to <span class="strong"><strong>Project Inspector</strong></span> and drop it on the <span class="strong"><strong>Views</strong></span> icon. This will create <span class="strong"><strong>Sheet</strong></span> as a separate view from our <span class="strong"><strong>MainView</strong></span> container.</p><p>Configure the sheet as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">userClassName</code> to <code class="literal">AddSheet</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">enter</code> to <code class="literal">top</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">exit</code> to <code class="literal">bottom</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">stretch</code> to <code class="literal">true</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">stretchY</code> to <code class="literal">true</code></li></ul></div><p>Next we will add a <span class="strong"><strong>Form Panel</strong></span> object to our sheet with the following items: a <span class="strong"><strong>Container</strong></span>, two <span class="strong"><strong>Text Field,</strong></span> and two <span class="strong"><strong>Button</strong></span> objects.</p><p>The container is simply a place to give the user some instructions. Set the <span class="strong"><strong>html</strong></span> attribute to:</p><div class="informalexample"><pre class="programlisting">'Add an RSS feed URL and a Name. Feed URLs should be in the format: http://feedURL.com'</pre></div><p>Configure the two text fields as <a id="id176" class="indexterm"/>follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Field 1</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">name</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">name</code> to <code class="literal">name</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">label</code> to <code class="literal">Name</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">margin</code> to <code class="literal">3 0 3 0</code></li></ul></div></li><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Field 2</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">url</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">name</code> to <code class="literal">url</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">label</code> to <code class="literal">URL</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">margin</code> to <code class="literal">3 0 3 0</code></li></ul></div></li></ul></div><p>Configure the two <a id="id177" class="indexterm"/>buttons like so:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Button 1</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">SaveButton</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">text</code> to <code class="literal">Save</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">margin</code> to <code class="literal">10</code></li></ul></div></li><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Button 2</strong></span>:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">CancelButton</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">text</code> to <code class="literal">Cancel</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">margin</code> to <code class="literal">10</code></li></ul></div></li></ul></div><p>Next, we need to add tap listeners for our two buttons. In the <span class="strong"><strong>Event</strong></span> section of <span class="strong"><strong>Config</strong></span> for each button, click on the <span class="strong"><strong>+</strong></span> button and select <a id="id178" class="indexterm"/>
<span class="strong"><strong>Basic Event Binding</strong></span>. When the menu appears, choose <span class="strong"><strong>tap</strong></span>:</p><div class="mediaobject"><img src="graphics/8901OS_02_3.jpg" alt="Adding the form"/></div><p>For the Cancel button, our tap function is pretty simple:</p><div class="informalexample"><pre class="programlisting">this.down('formpanel').reset(); 
this.hide();</pre></div><p>Inside the function, <a id="id179" class="indexterm"/>
<code class="literal">this</code> refers to our Sheet view. The code travels down into the sheet to find the form and then clears out all the field values. The sheet then hides itself.</p><p>The <a id="id180" class="indexterm"/>Save button works much the same way as the one from our previous chapter:</p><div class="informalexample"><pre class="programlisting">var formPanel = this.down('formpanel');

var values = formPanel.getValues();

var store = Ext.data.StoreManager.lookup('FeedStore');

var record = Ext.ModelMgr.create(values, 'MyApp.model.Feed');
store.add(record);
store.sync();

this.hide();</pre></div><p>We move down from the Sheet view (<code class="literal">this</code>) to get our form panel. We then get the values from our form and find our store. Next, a new Feed record is created using the model manager and populated with the values from our form. Finally, we add the record to the store, sync the store to save it, and then hide the sheet.</p><p>Next, we need a way to show the sheet for adding Feed items.</p></div><div class="section" title="Back to the navigation view"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Back to the navigation view</h2></div></div></div><p>In our <span class="strong"><strong>MainView</strong></span> component, we need to add a <span class="strong"><strong>Navigation Bar</strong></span> object to the <span class="strong"><strong>Config</strong></span> section using the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Navigation Bar</strong></span>. This <a id="id181" class="indexterm"/>navigation bar will display our Back button and our titles. It will also give us a place to put the Add button that will show our sheet for adding feed items.</p><p>We don't need to change any configuration options for the navigation bar, so just drag a new <a id="id182" class="indexterm"/>
<span class="strong"><strong>Button</strong></span> object onto it for our Add button. Set the button's configuration like so:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">align</code> to <code class="literal">right</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">text</code> to <code class="literal">Add</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">id</code> to <code class="literal">addButton</code></li></ul></div><p>Then we need to add a tap event listener like we did with our other buttons. The code for our tap event needs to create a new instance of <code class="literal">AddSheet</code> and display it. It also has to do a bit of thinking before it creates the sheet to make sure that there is no sheet that is existing already.</p><div class="informalexample"><pre class="programlisting">var sheet = Ext.getCmp('AddSheet');
if(!Ext.isDefined(sheet)) {
    sheet = Ext.create('MyApp.view.AddSheet');
    Ext.Viewport.add(sheet);
}
sheet.show();</pre></div><p>The first thing we do is call <a id="id183" class="indexterm"/>
<code class="literal">Ext.getCmp</code> to see if there is already an existing sheet. This is because we set up our Save and Cancel buttons to hide the sheet, which does not destroy it. It's still a part of the application (still in memory), but it is not being displayed.</p><p>If we have used the Add button previously, then <code class="literal">Ext.getCmp</code> will return a valid component. This is what we are checking on line two with <code class="literal">!Ext.isDefined(sheet)</code>. If the sheet is not defined yet (not created), we use <code class="literal">Ext.create('MyApp.view.AddSheet');</code> to make our sheet and then add it to the viewport.</p><p>At this point, we should have a valid component for our sheet and then we can just call <code class="literal">sheet.show();</code>.</p><p>Our application should now be able to add and display new Feed items to the list. Test the application to make sure everything is in working order by using <a id="id184" class="indexterm"/>Safari to open the <code class="literal">app.html</code> file in the folder where your project is saved:</p><div class="mediaobject"><img src="graphics/8901OS_02_4.jpg" alt="Back to the navigation view"/></div><p>Next we need to add the logic for our MainView navigation view that will allow us to display a nice layout page for each of our feeds.</p></div></div></div>
<div class="section" title="Adding the controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Adding the controller</h1></div></div></div><p>Add a controller to the project by dragging it <a id="id185" class="indexterm"/>onto the <span class="strong"><strong>Controllers</strong></span> section of <span class="strong"><strong>Project Inspector</strong></span>. You can find it in <span class="strong"><strong>Toolbox</strong></span> under <span class="strong"><strong>Behaviors</strong></span>. Set the <span class="strong"><strong>userClassName</strong></span> property of the controller to <code class="literal">FeedController</code>.</p><p>We also want to add a <span class="strong"><strong>Reference</strong></span> <a id="id186" class="indexterm"/>property in the controller <a id="id187" class="indexterm"/>for <span class="strong"><strong>mainView</strong></span>. Click on the <span class="strong"><strong>Add</strong></span> button next to <span class="strong"><strong>Reference</strong></span> and set the <span class="strong"><strong>ref</strong></span> property to <span class="strong"><strong>mainView</strong></span> and <span class="strong"><strong>Selector</strong></span> to <span class="strong"><strong>MainView</strong></span> (the selector needs to match our <span class="strong"><strong>userAlias</strong></span> instance for the main navigation view).</p><p>Adding this reference will allow us to easily grab our MainView navigation by calling <code class="literal">this.getMainView()</code> <a id="id188" class="indexterm"/>
<a id="id189" class="indexterm"/>anywhere inside the controller.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>
<span class="strong"><strong>Wait, shouldn't it be getmainView instead of getMainView?</strong></span>
</p><p>One of the things that should be pointed out in this example is that when the reference is created, Sencha automatically creates a "getter" function for the referenced component. Even though our reference has a lowercase <code class="literal">m</code>, the <code class="literal">getMainView</code> function <a id="id190" class="indexterm"/>changes this to uppercase, <code class="literal">M</code>. Given the case sensitive nature of JavaScript, this automatic case switch can lead to quite a bit of hair pulling and colorful language.</p></div></div><p>Now that we have our reference, we need to add an action to perform when the user taps on the list of feeds. Click on the <a id="id191" class="indexterm"/>
<span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>Actions</strong></span> and set the <a id="id192" class="indexterm"/>following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set <code class="literal">controlQuery</code> to <code class="literal">#FeedList</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">targetType</code> to <code class="literal">Ext.dataview.List</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">fn</code> to <code class="literal">onListItemTap</code></li><li class="listitem" style="list-style-type: disc">Set <code class="literal">name</code> to <code class="literal">itemtap</code></li></ul></div><p>Next, we need to double-click on the <a id="id193" class="indexterm"/>
<span class="strong"><strong>itemtap</strong></span> action to bring up our code editor. This is the code that will be fired when the list is tapped. Notice that the function is already set up to pass us a number of useful items including the dataview itself and the record for the item the user tapped on. We will set this action to call another function like so:</p><div class="informalexample"><pre class="programlisting">onListItemTap: function(dataview, index, target, record, e, options) {
    this.createFeedDetailsView(record.get('name'), record.get('url'));
}</pre></div><p>We will pass along the record <code class="literal">name</code> and <code class="literal">url</code> to our new <a id="id194" class="indexterm"/>
<code class="literal">createFeedDetailsView</code> function using <code class="literal">record.get()</code>.</p><p>If we take a look at our <span class="strong"><strong>Code</strong></span> view for the controller, it should look something like this:</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.controller.FeedController', {
    extend: 'Ext.app.Controller',
    config: {
        refs: {
            mainView: 'MainView'
        },

        control: {
            "#FeedList": {
                itemtap: 'onListItemTap'
            }
        }
    },

    onListItemTap: function(dataview, index, target, record, e, options) {
        this.createFeedDetailsView(record.get('name'), record.get('url'));
    }
});</pre></div><p>Here we see that Sencha has set up our <code class="literal">FeedController</code> function to extend the main <code class="literal">Ext.app.Contoller</code> component. <a id="id195" class="indexterm"/>This means it inherits all of the basic functions for the <code class="literal">Ext.app.Contoller</code> component.</p><p>In the <code class="literal">config</code> section, we see our reference set up in the <code class="literal">refs</code> section. The <code class="literal">controls</code> section tells the controller which component to listen to (<code class="literal">#FeedList</code>), which event to listen for (<code class="literal">itemtap</code>), and which function to call when the event happens (<code class="literal">onListItemTap</code>).</p><p>The last thing we need to do here is create the code for our <code class="literal">createFeedDetailsView</code> function. This code needs to use the URL to grab the RSS feed, <a id="id196" class="indexterm"/>create a new view, and push it onto the main navigation view.</p><p>Before we do that, there are a few things that we need to consider: how do we get the data from the remote source and how can we format it in an easy-to-use structure (JSON)?</p><p>To answer these questions, we need to have a better understanding of how Sencha Touch communicates with external servers, and some of the limitations involved in these types of transactions.</p></div>
<div class="section" title="Getting the data from a remote source"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Getting the data from a remote source</h1></div></div></div><p>For security reasons, JavaScript (and thus Sencha Touch) is not allowed to make AJAX requests to other domains. This means that if your application resides on <code class="literal">myCoolApp.com</code> and you make an AJAX request to the RSS feed at <a id="id197" class="indexterm"/>
<a class="ulink" href="http://boingboing.net">boingboing.net</a>, it will be denied.</p><p>The reason for this is the <a id="id198" class="indexterm"/>
<span class="strong"><strong>Same Origin Policy</strong></span>, which states that certain browser functions like cookies and AJAX requests can't be shared between different servers. The reasoning being that JavaScript executes within the browser on the end user's computer. This gives JavaScript some unique abilities to interact with the user without having to constantly be in contact with a web server. Once the web browser loads the initial JavaScript files, they are stored on the user's machine until the cache is cleared. This means the application can continue to function when offline.</p><p>However, as we all know, with great power comes great responsibility. The ability to run remote code on a user's computer can lead to people doing very bad things. AJAX requests in particular are problematic because they can happen without any direct request from the user.</p><p>For this reason, cross-domain AJAX requests in JavaScript are a very bad idea. While it may be easy enough to determine that your own code has honorable intentions, unchecked code from another domain can be potentially hostile.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>If you would like to learn more about same origin policy, this <a id="id199" class="indexterm"/>Wikipedia article is a good place to start:</p><p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Same_origin_policy">http://en.wikipedia.org/wiki/Same_origin_policy</a>
</p></div></div><div class="section" title="Enter the JSONP proxy"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Enter the JSONP proxy</h2></div></div></div><p>We can get around the same origin policy by using Sencha's JSONP <a id="id200" class="indexterm"/>proxy component to send the request. This component injects <code class="literal">&lt;script&gt;</code> tags containing the proxy URL directly into the DOM to get around the cross-domain limitation. The script <a id="id201" class="indexterm"/>tag looks like a regular JavaScript embed tag, something like this:</p><div class="informalexample"><pre class="programlisting">&lt;script src="http://somedomain.com/articles?callback=someFunction"&gt;&lt;/script&gt;</pre></div><p>The response gets included as if it were any other JavaScript include. The JSONP proxy uses the <code class="literal">callback</code> function (which is generated automatically) to process this data and send it back to the proxy. The one caveat here is that the response has to be in JSON in order for the <a id="id202" class="indexterm"/>
<a id="id203" class="indexterm"/>
<code class="literal">callback</code> function to correctly process it.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>A full explanation of cross-site scripting <a id="id204" class="indexterm"/>issues can be found here: <a class="ulink" href="http://en.wikipedia.org/wiki/Cross-site_scripting">http://en.wikipedia.org/wiki/Cross-site_scripting</a> and an overview of the <a id="id205" class="indexterm"/>JSONP proxy component can be found here: <a class="ulink" href="http://docs.sencha.com/touch/2-0/#!/api/Ext.data.proxy.JsonP">http://docs.sencha.com/touch/2-0/#!/api/Ext.data.proxy.JsonP</a>.</p></div></div><p>This brings us to another issue that we will run into with RSS feeds: they are formatted in XML instead of JSON. Since we need the JSONP store for cross-site requests and a JSON-encoded response for our <a id="id206" class="indexterm"/>
<code class="literal">callback</code> function to process, XML won't work for us without a bit more fiddling.</p><p>This basically gives us two options. The first option would be to use another programming language to write something that would make the proxy request for us. This would include languages such as PHP, Ruby, ASP, and Perl, which run on the local server along with our application and are not under the same security restrictions as JavaScript.</p><p>A local proxy would receive the request from our store along with the variables and make a request to the remote server with our variables. The remote server would then send the request back to our local proxy that would then pass it back to the store in whatever format we need. This is a fine enough way to accomplish the task, but it is also overkill for our simple application. Don't worry, we will get to the overkill later on.</p><p>We also have a second option called <span class="strong"><strong>YQL</strong></span>, the <span class="strong"><strong>Yahoo</strong></span> <span class="strong"><strong>Query</strong></span> <span class="strong"><strong>Language</strong></span>, which we will be using in our application.</p></div><div class="section" title="Yahoo Query Language (YQL)"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Yahoo Query Language (YQL)</h2></div></div></div><p>The <span class="strong"><strong>Yahoo Query Language</strong></span> (<span class="strong"><strong>YQL</strong></span>) was <a id="id207" class="indexterm"/>developed as a way to search open <a id="id208" class="indexterm"/>data sources in a language similar to <span class="strong"><strong>Structured Query Language</strong></span> (<span class="strong"><strong>SQL</strong></span>), <a id="id209" class="indexterm"/>a standard language for dealing with database information.</p><p>A typical SQL request might look something like this:</p><div class="informalexample"><pre class="programlisting">select * from users where lastname = 'Scalzi';</pre></div><p>This would grab all the records in the <code class="literal">users</code> table where the last name was <code class="literal">Scalzi</code>. The <code class="literal">*</code> character tells our query to grab all the data for the record.</p><p>A YQL request is similar in structure and might look something like this:</p><div class="informalexample"><pre class="programlisting">select * from rss where url= "http://feeds.boingboing.net/boingboing/iBag" </pre></div><p>This request would return the <a id="id210" class="indexterm"/>RSS feed data from <a class="ulink" href="http://boingboing.net">boingboing.net</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>YQL has access to a tremendous number of open <a id="id211" class="indexterm"/>data sources. To read up on the sources and get a better idea of what is possible in YQL, go to: <a class="ulink" href="http://developer.yahoo.com/yql/">http://developer.yahoo.com/yql/</a>.</p></div></div><p>Now that we can get information from our data source, we need to figure out how to have it sent in a format our Sencha Touch application can understand.</p><p>One of the bonuses we get with YQL is that our results can be set up to return in a number of different formats, including the JSON format we want for our application. Before we set up the YQL query for our application we should take a look at the actual JSON that gets returned from the query. We can do this using the YQL console.</p><div class="section" title="The YQL console"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec01"/>The YQL console</h3></div></div></div><p>The YQL console (<a id="id212" class="indexterm"/>located at: <a class="ulink" href="http://developer.yahoo.com/yql/console/">http://developer.yahoo.com/yql/console/</a>) offers an easy way to test the various YQL commands and immediately see the results:</p><div class="mediaobject"><img src="graphics/8901OS_02_5.jpg" alt="The YQL console"/></div><p>Enter the the query shown in the previous screenshot into the console, select JSON, and click on the <span class="strong"><strong>TEST</strong></span> button.</p><p>You will get back the results as a large bundle of JSON starting with:</p><div class="informalexample"><pre class="programlisting">cbfunc({
 "query": {
  "count": 30,
  "created": "2012-05-10T15:25:40Z",
  "lang": "en-US"…</pre></div><p>The <code class="literal">cbfunc</code> <a id="id213" class="indexterm"/>header is the callback function our JSONP store is going to use to process the response. We don't need to worry about this since the store deals with it automatically. The first piece of information we need is the <a id="id214" class="indexterm"/>
<code class="literal">count</code> parameter listed inside the <code class="literal">query</code> array. We can reference this in our code as <code class="literal">query.count</code>.</p><p>Further down in the results you will see the actual items we need to use for our dataview:</p><div class="informalexample"><pre class="programlisting">"results": {
   "item": [
    {
     "title": "Minecraft heads to consoles",
     "link": "http://feeds.boingboing.net/~r/boingboing/iBag/~3/iyy5tLpUCpU/minecraft-heads-to-consoles.html",
     "category": [
      "Short",
      "Games",
      "minecraft"
     ],
     "creator": {
      "dc": "http://purl.org/dc/elements/1.1/",
      "content": "Rob Beschizza"
     }…</pre></div><p>Since these results are nested down in the <code class="literal">query</code> array, we will need to tell the store to set our <code class="literal">rootProperty</code> <a id="id215" class="indexterm"/>property as <code class="literal">query.results.item</code>. This <a id="id216" class="indexterm"/>
<code class="literal">item</code> array holds the 30 listings returned by our query.</p><p>When these items are part of the store we will have access to each of the individual pieces by name. For example, <code class="literal">title</code> from the previous code will give us <code class="literal">Minecraft heads to consoles</code> and <code class="literal">creator.content</code> will give us <code class="literal">Rob Beschizza</code>. All of this data will be accessible in the item template of our dataview.</p><p>You will need to set up a data model to grab the pieces of information you are interested in. For our purposes, we will be using the following data model:</p><div class="informalexample"><pre class="programlisting">Ext.define('MyApp.model.FeedItem', {
    extend: 'Ext.data.Model',
    config: {
        fields: [
            {
                name: 'title'
            },
            {
                name: 'link'
            },
            {
                name: 'pubDate',
                type: 'date'
            },
            {
                mapping: 'encoded.content',
                name: 'content'
            },
            {
                mapping: 'creator.content',
                name: 'creator'
            },
            {
                name: 'description'
            },
            {
                name: 'thumbnail'
            },
            {
                name: 'author'
            }
        ]
    }
});</pre></div><p>Notice that we need to map some of the more deeply nested items such as <code class="literal">encoded.content</code> and <code class="literal">creator.content</code>. This model will give us all of the data items we need for our view.</p><p>Let's see how it all fits together.</p></div></div><div class="section" title="Meanwhile, back at the controller"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Meanwhile, back at the controller</h2></div></div></div><p>If you remember, back in our <a id="id217" class="indexterm"/>
<a id="id218" class="indexterm"/>
<code class="literal">FeedController</code> function we had a tap handler that looked like this:</p><div class="informalexample"><pre class="programlisting">onListItemTap: function(dataview, index, target, record, e, options) {
        this.createFeedDetailsView(record.get('name'), record.get('url'));
    }</pre></div><p>We now need to set up the <a id="id219" class="indexterm"/>
<a id="id220" class="indexterm"/>
<code class="literal">createFeedDetailsView</code> function and get it to create our data store for connecting to the YQL server.</p><p>Add the new function by clicking on the <span class="strong"><strong>+</strong></span> button next to <span class="strong"><strong>functions</strong></span> and setting the <span class="strong"><strong>Config</strong></span> value for <span class="strong"><strong>fn</strong></span> to <code class="literal">createFeedDetailsView</code>. Then add two <span class="strong"><strong>params</strong></span>: <code class="literal">name</code> and <code class="literal">url</code>.</p><p>In the code editor, we want our function to grab the name and URL that we passed from our tap function and create a new data store. We will then load the store and use it to feed data into a new dataview. Lastly, we will push this new dataview onto our main navigation view for display.</p><p>The code looks like this:</p><div class="informalexample"><pre class="programlisting">createFeedDetailsView: function(name, url) {
    var newURL = 'http://query.yahooapis.com/v1/public/yql?',
        yql = {
            q: 'select * from rss where url="' + url + '"',
            format: 'json'
        };

    newURL += Ext.Object.toQueryString(yql);
    var details = Ext.create(
    'MyApp.view.FeedDetails', {
        title: name,
        store: Ext.create('MyApp.store.FeedItemStore', {
            proxy: {
                type: 'jsonp',
                url: newURL,
                reader: {
                    type: 'json',
                    rootProperty: 'query.results.item',
                    totalProperty: 'query.count'
                }
            }
        })
    });
    details.getStore().load();
    this.getMainView().push(details);
}</pre></div><p>Our first line sets up our URL to the main connection point for the YQL server:</p><div class="informalexample"><pre class="programlisting">var newURL = 'http://query.yahooapis.com/v1/public/yql?'</pre></div><p>We then set up our variables using the format required by YQL. This includes a query string (<code class="literal">q</code>) and a format type for the return value, which will be JSON:</p><div class="informalexample"><pre class="programlisting">yql = {
q: 'select * from rss where url="' + url + '"',
            format: 'json'
};</pre></div><p>Next, we convert our variables into a Query String and add them to our URL like so:</p><div class="informalexample"><pre class="programlisting">newURL += Ext.Object.toQueryString(yql);</pre></div><p>Next, we need to add a new dataview to our <a id="id221" class="indexterm"/>main navigation view. We will create the actual view in the next section, but for now we can in put the code to display it here like so:</p><div class="informalexample"><pre class="programlisting">var details = Ext.create(
    'MyApp.view.FeedDetails', {
        title: name,
        store: Ext.create('MyApp.store.FeedItemStore', {
            proxy: {
                type: 'jsonp',
                url: newURL,
                reader: {
                    type: 'json',
                    rootProperty: 'query.results.item',
                    totalProperty: 'query.count'
                }
            }
        })
    });</pre></div><p>This creates the <code class="literal">details</code> view using <code class="literal">MyApp.view.FeedDetails</code> (a view we will add a bit later) and set up the store for it with our <code class="literal">newURL</code> string that we created at the beginning of the function.</p><p>Our <a id="id222" class="indexterm"/>
<code class="literal">reader</code> configuration is set for <code class="literal">json</code> and the <code class="literal">rootProperty</code> and <code class="literal">totalProperty</code> configurations are set to the default values that get returned from the YQL server for each of those attributes. <a id="id223" class="indexterm"/>
<code class="literal">rootProperty</code> tells the reader where to start looking for results and <a id="id224" class="indexterm"/>
<code class="literal">totalProperty</code> tells the reader how many results we have gotten.</p><p>Finally, we load our store and add the new dataview to our main navigation panel:</p><div class="informalexample"><pre class="programlisting">details.getStore().load();
this.getMainView().push(details);</pre></div><p>Now that we have the store code in place, it's time to create the dataview for <code class="literal">MyApp.view.FeedDetails</code>, which is needed to display the feed data.</p></div></div>
<div class="section" title="The details dataview"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>The details dataview</h1></div></div></div><p>When using Sencha Touch, it's very easy to think of a dataview as just a fancy list. However, that tends to lock people into the list aspects of the dataview <a id="id225" class="indexterm"/>while ignoring the possibility of more complex layouts.</p><p>For example, a newspaper-style layout is a great use of a dataview. The layout is a collection of articles with titles, dates, authors, and content. However it sidesteps the standard concept of a list and replaces it with a more visually interesting layout:</p><div class="mediaobject"><img src="graphics/8901OS_02_6.jpg" alt="The details dataview"/></div><p>A newspaper-style <a id="id226" class="indexterm"/>layout works well on a larger tablet-sized screen, but it would be difficult to read on a smaller phone screen. We need a way to change the layout of our application based on the user's device.</p><p>Fortunately for us, not only does Sencha Touch understand the difference between devices, it also leverages the power of the HTML5 standard, which also understands different platforms and devices.</p><p>We will cover how Sencha Touch manages the <a id="id227" class="indexterm"/>different devices in a later chapter. For now, we are going to use CSS media queries to load different style sheets based on the device. Before we get too deeply into that, we need to create the dataview and the XTemplate.</p><p>An <a id="id228" class="indexterm"/>
<a id="id229" class="indexterm"/>
<span class="strong"><strong>XTemplate</strong></span> is basically an HTML template with a few extra bells and whistles. The XTemplate takes the data you supply and uses it to fill out the template by substituting any value in curly braces, with the corresponding value from your data.</p><p>For example, suppose that you have an XTemplate that looks like this:</p><div class="informalexample"><pre class="programlisting">&lt;div class="name"&gt;{name}&lt;/div&gt;</pre></div><p>In this example, the XTemplate will search your data for a variable called <code class="literal">name</code> and insert it into the template where we have <code class="literal">{name}</code>. You can use these curly braces to reference any of the fields in a data record.</p><p>The <a id="id230" class="indexterm"/>XTemplate also offers us the opportunity to add logic (the "if...then" statements, simple math, and more) to the HTML template.</p><p>Let's create one for our dataview to see how it all fits together.</p><p>Create a new dataview in <a id="id231" class="indexterm"/>Sencha Architect and set <code class="literal">userAlias</code> to <code class="literal">feeddetails</code> and <code class="literal">userClassName</code> to <code class="literal">FeedDetails</code>. Set the store configuration to use our <code class="literal">FeedItemStore</code> we created earlier.</p><p>Next we need to create an <a id="id232" class="indexterm"/>
<code class="literal">itemTpl</code> XTemplate. <a id="id233" class="indexterm"/>You should see a listing for <span class="strong"><strong>itemTpl</strong></span> underneath the new <span class="strong"><strong>FeedDetails</strong></span> dataview in the <span class="strong"><strong>Project Inspector</strong></span> and if you select it, the <span class="strong"><strong>Code</strong></span> editor will show the default <span class="strong"><strong>itemTpl</strong></span> for editing.</p><p>Our <code class="literal">itemTpl</code> will need to account for any missing data in the RSS feed (RSS feeds are often missing things such as descriptions, icons, and other elements). We also need to translate the dates into something Sencha Touch understands, and we need to loop through some of the nested array elements returned by our YQL request.</p><p>Let's look at the full template first, and then we will go through the different sections to cover what we are doing:</p><div class="informalexample"><pre class="programlisting">itemTpl: [
    '&lt;tpl if="thumbnail"&gt;',
    '  &lt;article class="hasThumbnail"&gt;',
    '    &lt;tpl else&gt;',
    '      &lt;article&gt;',
    '    &lt;/tpl&gt;',
    '    &lt;header&gt;',
    '      &lt;div class="headline"&gt;',
    '        &lt;tpl if="thumbnail"&gt;',
    '          &lt;tpl for="thumbnail"&gt;',
    '            &lt;img class="thumbnail" src="{url}" height="{height}" width="{width}" alt="Thumbnail" /&gt;',
    '          &lt;/tpl&gt;',
    '        &lt;/tpl&gt;',
    '        &lt;h2&gt;{title}&lt;/h2&gt;',
    '      &lt;/div&gt;',
    '      &lt;tpl if="creator"&gt;&lt;p class="creator"&gt;by {creator}&lt;/p&gt;',
    '        &lt;tpl elseif="author"&gt;&lt;p class="creator"&gt;by {author}&lt;/p&gt;&lt;/tpl&gt;',
    '        &lt;tpl if="pubDate"&gt;&lt;time datetime="{pubDate:date("c")}"&gt;{pubDate:date("M j, Y, g:i a")}&lt;/time&gt;&lt;/tpl&gt;',
    '    &lt;/header&gt;',
    '    &lt;div class="description"&gt;{description}&lt;/div&gt;',
    '    &lt;div class="content"&gt;',
    '      &lt;tpl if="content.length &amp;gt; 0"&gt;',
    '        &lt;tpl for="content"&gt;',
    '          &lt;tpl if="xindex == 2"&gt;{.}&lt;/tpl&gt;',
    '        &lt;/tpl&gt;',
    '        &lt;tpl else&gt;',
    '          {description}',
    '        &lt;/tpl&gt;',
    '    &lt;/div&gt;',
    '    &lt;footer&gt;',
    '      &lt;a href="{link}"&gt;Read Original Article&lt;/a&gt;',
    '    &lt;/footer&gt;',
    '    &lt;/article&gt;'
] </pre></div><p>Our first section looks to see if we have a thumbnail for the article using <code class="literal">&lt;tpl if="thumbnail"&gt;</code>. If we do, then we style the article container with a class of <code class="literal">hasThumbnail</code>, if not, we just use the basic <code class="literal">&lt;article&gt;</code> tag. This will let us do different things with CSS depending on if we have the thumbnail or not.</p><p>Next we begin constructing our header section, creating a <code class="literal">&lt;div&gt;</code> tag with a class of <code class="literal">headline</code> that contains our <code class="literal">thumbnail</code> and <code class="literal">title</code> variables for the article. We also check to see if we have a <code class="literal">thumbnail</code> and then loop through the data for thumbnails (using <code class="literal">&lt;tpl for="thumbnail"&gt;</code>) to gain access to the individual elements (<code class="literal">height</code>, <code class="literal">width</code>, <code class="literal">url</code>) in the <code class="literal">thumbnail</code> array.</p><p>Next, we close out the headline <code class="literal">div</code> tag and add our author/creator and the date to our template. RSS feeds can use either author or creator to refer to the person who wrote the article. We use <code class="literal">&lt;tpl if="creator"&gt;</code> and <code class="literal">&lt;tpl elseif="author"&gt;</code> to make sure we get one or the other if they are available.</p><p>We then check to see if we have a date and convert it to a format we like using:</p><div class="informalexample"><pre class="programlisting">&lt;tpl if="pubDate"&gt;&lt;time datetime="{pubDate:date("c")}"&gt;{pubDate:date("M j, Y, g:i a")}&lt;/time&gt;&lt;/tpl&gt;</pre></div><p>Notice that we have also wrapped the date inside an HTML5 <code class="literal">&lt;time&gt;</code> element, which provides contextual data to the browser, allowing features such as localization, visual timelines, and adding events to calendars. We set <code class="literal">datetime</code> to a format the browser understands, and then we set the displayed date and time to something a bit more user friendly.</p><p>Next we format our description and content. The description is pretty straight forward, but the content is a slightly different matter.</p><p>Depending on the size of the device, we may not want to show the full content div, just the shorter description div. We can set our CSS to only show the <code class="literal">&lt;div class="description"&gt;</code> or the <code class="literal">&lt;div class="content"&gt;</code> block, depending on the device. However, the content element is also optional, so if we have no content we need to show the description in the <code class="literal">&lt;div class="content"&gt;</code> block instead.</p><p>To make things more complicated, the content returned by our YQL query is a nested array with two elements: a content definition link, which we can ignore, and the actual content that we want. To do this, we loop through the content and count the loops using the built-in <code class="literal">xindex</code> variable to add the second data element to our XTemplate (<code class="literal">{.}</code> is the current data element in the loop).</p><div class="informalexample"><pre class="programlisting">    '        &lt;tpl for="content"&gt;',
    '          &lt;tpl if="xindex == 2"&gt;{.}&lt;/tpl&gt;',
    '        &lt;/tpl&gt;'</pre></div><p>Finally we close out our <a id="id234" class="indexterm"/>XTemplate with a footer and a link to the original article.</p><p>We will take a look at some other XTemplate options in later chapters, or you can see a full list of the options in the online documentation at:</p><p>
<a class="ulink" href="http://docs.sencha.com/touch/2-0/#!/api/Ext.XTemplate">http://docs.sencha.com/touch/2-0/#!/api/Ext.XTemplate</a>
</p><div class="section" title="And now, the CSS"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>And now, the CSS</h2></div></div></div><p>As our container currently exists, the display would not be very interesting. It's just simple blocks of data one after another. While this is fine for small devices such as phones, it's a bit dull for larger tablet displays.</p><p>We are going to address this by creating these <a id="id235" class="indexterm"/>three separate CSS files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">feedbag.css</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">feedbag-tablet-portrait.css</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">feedback-tablet-landscape.css</code></li></ul></div><p>We will link these files in our <code class="literal">app.html</code> file like this:</p><div class="informalexample"><pre class="programlisting">    &lt;link rel="stylesheet" type="text/css" href="feedbag.css"/&gt;
    &lt;link rel="stylesheet" type="text/css" href="feedbag-tablet-portrait.css" media="only screen and (min-device-width : 700px)"/&gt;
    &lt;link rel="stylesheet" type="text/css" href="feedbag-tablet-landscape.css" media="only screen and (min-device-width : 700px) and (orientation : landscape)"/&gt;</pre></div><p>The first file, <a id="id236" class="indexterm"/>
<a id="id237" class="indexterm"/>
<code class="literal">feedbag.css</code>, contains all of our default styles for colors, font sizes, and so on. It also contains the small phone screen styles, which only show our image and header in the list view.</p><p>This set of styles gets overridden by the next file, which contains our portrait styles for tablet computers (minimum device width: 700 px). This file uses the same styles from the previous file, but organizes our content into two columns of blocks. It also displays the description block in the list view.</p><p>The last file is used for tablet devices in landscape orientation. As before, it will override some of the styles in the previous files to further enhance the layout. In this case, we will float all of the blocks and set them to different widths to give the layout a more organic feel.</p><p>Rather than dig through the entire CSS file, we want to focus on the last file, as it is the most complex of the files—<code class="literal">feedback-tablet-landscape.css</code>.</p><p>In this CSS file, we will take a series of steps to get to this <a id="id238" class="indexterm"/>layout, starting from a grid of 12 items and modifying the widths and heights to give us a more fluid layout. Take a look at the following figure to see what we mean:</p><div class="mediaobject"><img src="graphics/8901OS_02_7.jpg" alt="And now, the CSS"/></div><p>In <code class="literal">feedback-tablet-landscape.css</code> <a id="id239" class="indexterm"/>our first block of CSS looks like this:</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item {
    width: 33%;
    float: left;
}</pre></div><p>We can fit three blocks of content across the screen in landscape mode, so we set each item to a default width of 33 percent.</p><p>The next block of CSS uses the nth-of-type selector to change the sizes of some of our item blocks:</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item:nth-of-type(12n+2), div.x-dataview-item:nth-of-type(12n+8) {
    width: 66%;
}</pre></div><p>This rather complicated looking CSS says the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We are only looking at items tagged with <code class="literal">div.x-dataview-item</code> (which are our item blocks).</li><li class="listitem">We want <code class="literal">nth-of-type(12n+2)</code>, which in this <a id="id240" class="indexterm"/>case means that we are looking at everything in blocks of 12 items (<code class="literal">12n</code>). Of those 12 items, we want to apply this style to the second (<code class="literal">+2</code>) of those items.</li><li class="listitem">We also want to do the same thing for the 8th member of our set of twelve (<code class="literal">nth-of-type(12n+8)</code>).</li><li class="listitem">For our two items, we want to set the width to 66 percent (twice our normal article width).</li></ol></div><p>By dealing with these items in blocks of 12 we end up with a more random and natural feel to our layout, rather than if we had simply set every third item to a wider size.</p><p>The next two styles ensure that we don't end up with one or two items dangling off the end of our layout. First we give our last item in the list a width of 99 percent:</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item:last-child {
    width: 99%;
}</pre></div><p>However, if our last item is the last in a row of three, we don't want it to have a 99 percent width as this would push it down a row and make things look weird. It should just be the regular size (33 percent):</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item:nth-of-type(12n+7), div.x-dataview-item:nth-of-type(12n) {
    width: 33% !important;
}</pre></div><p>The <code class="literal">12n+7</code> (the seventh item and the twelfth) items are the only two items in our set of twelve that may end up as the last item in a row of three.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>We use <code class="literal">!important</code> in our <a id="id241" class="indexterm"/>
<a id="id242" class="indexterm"/>CSS to make sure that our <code class="literal">width</code> definition overrides any other <code class="literal">width</code> values that might be applied by other (parent) classes.</p></div></div><p>We also don't want it to be 99 percent if it's the last item in a row with only two items. In this case, the last item just needs to have a width of 66 percent:</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item:nth-of-type(12n+6):last-child {
    width: 66% !important;
}</pre></div><p>Lastly, just to give us a break in the vertical rhythm of the layout, we make the first item in the set of 12 be twice as tall as the rest:</p><div class="informalexample"><pre class="programlisting">div.x-dataview-item:nth-of-type(12n+1), div.x-dataview-item:nth-of-type(12n+1) article {
    min-height: 400px;
    max-height: 400px;
}</pre></div><p>While these types of CSS selectors can seem a bit daunting at first, they offer a wide range of layout options beyond the standard Sencha Touch options.</p><p>If you look at the other two style sheets, you'll see that the styles get much simpler. The <code class="literal">feedbag-tablet-portrait.css</code> file <a id="id243" class="indexterm"/>
<a id="id244" class="indexterm"/>is a simple two-column layout, while the plain <code class="literal">feedbag.css</code> file is a one-column layout with description content blocks hidden, for small devices such as iPhones. It would be possible to further customize the layouts based on device, or screen pixel density, but we'll leave that as an exercise for you.</p></div></div>
<div class="section" title="Homework"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Homework</h1></div></div></div><p>In the support files for this chapter, we have also added a details view called <code class="literal">FeedItem.js</code>, which is a simple panel that is called from the controller when an item in our dataview is clicked on. The panel is pushed onto the navigation view in the same way as our feed details view. The panel contains a simple XTemplate loaded from the record passed in the tap function. If you explore this code, you will also see that we added a bit of animation to make the transition slicker.</p><p>This type of application can easily be modified to serve as a mobile version for any website with an RSS feed. You can also use the additional data in the RSS feed to add more information to the display, or modify the look and feel through CSS.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Summary</h1></div></div></div><p>In this chapter we discussed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The basic application setup for the Feed Reader application</li><li class="listitem" style="list-style-type: disc">Creating data to use a remote data source</li><li class="listitem" style="list-style-type: disc">Potential issues with making Ajax requests to a remote server</li><li class="listitem" style="list-style-type: disc">Using the YQL system to query data from the web and return it as JSON</li><li class="listitem" style="list-style-type: disc">Setting up a complex XTemplate for our dataview</li><li class="listitem" style="list-style-type: disc">Using CSS styles and selectors to create a visually interesting and adaptable dataview display</li></ul></div><p>In the next chapter we will take a look at using a compiled Sencha Touch application to take advantage of features that are beyond a standard web based application.</p></div></body></html>