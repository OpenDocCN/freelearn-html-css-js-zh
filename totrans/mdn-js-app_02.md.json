["```js\nvar seneca = require(\"seneca\")();\n\nseneca.use(\"mongo-store\", {\n  name: \"gocoupons\",\n  host: \"127.0.0.1\",\n  port: 27017\n});\n```", "```js\nseneca.add({role: \"coupons-store\", cmd: \"add\"}, function(args, respond){\n  var coupons = seneca.make$(\"coupons\");\n  var data = coupons.data$({title: args.title, desc: args.desc, email: args.email, url: args.url, price: args.price, discount: args.discount, thumbnail_id: args.thumbnail_id, verified: false});\n  data.save$(function(err, entity){\n    if(err) return respond(err);\n\n    respond(null, {value: true});\n  });\n});\n```", "```js\nseneca.add({role: \"coupons-store\", cmd: \"list\"}, function(args, respond){\n  var coupons = seneca.make$(\"coupons\");\n  coupons.list$({verified: true, limit$:21, skip$: args.skip}, function (err, entity){\n    if(err) return respond(err);\n\n    respond(null, entity);\n  })\n});\n```", "```js\nseneca.add({role: \"coupons-store\", cmd: \"admin_list\"}, function(args, respond){\n  var coupons = seneca.make$(\"coupons\");\n  coupons.list$({verified: false}, function (err, entity){\n    if(err) return respond(err);\n\n    respond(null, entity);\n  })\n});\n```", "```js\nseneca.add({role: \"coupons-store\", cmd: \"verified\"}, function(args, respond){\n  var coupons = seneca.make$(\"coupons\");\n  var data = coupons.data$({id: args.id, verified: true});\n  data.save$(function(err, entity){\n  if(err) return respond(error);\n\n    respond(null, {value: true});\n  });\n});\n```", "```js\nseneca.add({role: \"coupons-store\", cmd: \"delete\"}, function(args, respond){\n  var coupons = seneca.make$(\"coupons\");\n  coupons.remove$({id: args.id});\n  respond(null, {value: true});\t\n});\n```", "```js\nseneca.listen({port: \"5010\", pin: {role: \"coupons-store\"}});\n```", "```js\nvar seneca = require(\"seneca\")();\n\nseneca.add({role: \"url-config\", cmd: \"upload-service\"}, function(args, respond){\n  respond(null, {value: \"http://localhost:9090\"});\n});\n\nseneca.add({role: \"url-config\", cmd: \"monolithic-core\"}, function(args, respond){\n  respond(null, {value: \"http://localhost:8080\"});\n});\n\nseneca.add({role: \"url-config\", cmd: \"image-storage-service\"}, function(args, respond){\n  respond(null, {value: \"http://localhost:7070\"});\n});\n\nseneca.listen({port: \"5020\", pin: {role: \"url-config\"}});\n```", "```js\nvar seneca = require(\"seneca\")();\nvar app = require(\"express\")();\nvar multipart = require(\"connect-multiparty\")();\nvar path = require(\"path\");\nvar fs = require(\"fs\");\nvar request = require(\"request\");\n```", "```js\nfunction uniqueNumber() {\n  var date = Date.now();\n\n  if (date <= uniqueNumber.previous) {\n    date = ++uniqueNumber.previous;\n  } else {\n    uniqueNumber.previous = date;\n  }\n\n  return date;\n}\n\nuniqueNumber.previous = 0;\n\nfunction ID(){\n  return uniqueNumber();\n};\n```", "```js\nseneca.client({port: \"5020\", pin: {role: \"url-config\"}});\nseneca.client({port: \"5010\", pin: {role: \"coupons-store\"}});\n```", "```js\n//declare route and add callbacks\napp.post('/submit', multipart, function(httpRequest, httpResponse, next){\n\n  var tmp_path = httpRequest.files.thumbnail.path;\n  var thumbnail_extension = path.extname(tmp_path);\n  var thumbnail_directory = path.dirname(tmp_path);\n  var thumbnail_id = ID();\n  var renamed_path = thumbnail_directory + '/' + ID() + thumbnail_extension;\n\n  //rename file\n  fs.rename(tmp_path, renamed_path, function(err) {\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    //upload file to image storage server\n    seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, storage_server_url){\n      var req = request.post(storage_server_url.value + \"/store\", function (err, resp, body){\n        fs.unlink(renamed_path);\n\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(body == \"Done\")\n        {\n          //store the coupon\n          seneca.act({role: \"coupons-store\", cmd: \"add\", title: httpRequest.body.title, email: httpRequest.body.email, url: httpRequest.body.url, desc: httpRequest.body.desc, price: httpRequest.body.price, discount: httpRequest.body.price, thumbnail_id: thumbnail_id + thumbnail_extension}, function(err, response){\n            if(err)\n            {\n              //delete the stored image\n              request.get(storage_server_url + \"/delete/\" + thumbnail_id + thumbnail_extension);\n              httpResponse.status(500).send(\"An error occured\");\n              return;\n            }\n            seneca.act({role: \"url-config\", cmd: \"monolithic-core\"}, function(err, response){\n              if(err) return httpResponse.status(500).send(\"An error occured\");\n\n              //redirect to monolithic core\n              httpResponse.redirect(response.value + \"/?status=submitted\");  \n            });\n          });\n        }\n      });\n\n      var form = req.form();\n      form.append(\"thumbnail\", fs.createReadStream(renamed_path));\n      form.append(\"name\", thumbnail_id + thumbnail_extension);\n    });\n  });\n});\n```", "```js\napp.listen(9090);\n```", "```js\nvar express = require(\"express\");\nvar app = express();\nvar fs = require(\"fs\");\nvar multipart = require(\"connect-multiparty\")();\n```", "```js\napp.post(\"/store\", multipart, function(httpRequest, httpResponse, next){\n  var tmp_path = httpRequest.files.thumbnail.path;\n  var target_path = \"public/images/\" + httpRequest.body.name;\n  fs.rename(tmp_path, target_path, function(err) {\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    httpResponse.send(\"Done\");\n  });\n});\n```", "```js\napp.get(\"/delete/:id\", function(httpRequest, httpResponse, next){\n  fs.unlink(\"public/images/\" + httpRequest.params.id, function(err) {\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    httpResponse.send(\"Done\");\n  });\n});\n```", "```js\napp.use(express.static(__dirname + \"/public/images\"));\n```", "```js\napp.listen(9090);\n```", "```js\nvar seneca = require(\"seneca\")();\nvar express = require(\"express\");\nvar app = express();\nvar basicAuth = require(\"basic-auth\");\nvar request = require(\"request\");\n```", "```js\nseneca.client({port: \"5020\", pin: {role: \"url-config\"}});\nseneca.client({port: \"5010\", pin: {role: \"coupons-store\"}});\n```", "```js\napp.set(\"view engine\", \"ejs\");\n```", "```js\napp.use(express.static(__dirname + \"/public\"));\n```", "```js\napp.get(\"/\", function(httpRequest, httpResponse, next){\n  if(httpRequest.query.status == \"submitted\") {\n    seneca.act({role: \"coupons-store\", cmd: \"list\", skip: 0}, function(err, coupons){\n      if(err) return httpResponse.status(500).send(\"An error occured\");\n\n      seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, image_url){\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(coupons.length > 20)\n        {\n          var next = true;\n        }\n        else\n        {\n          var next = false;\n        }\n\n        var prev = false;\n\n        httpResponse.render(\"index\", {prev: prev, next: next, current: 0, coupons: coupons, image_url: image_url.value, submitted: true});\n      })\n    })\n\n    return;\n  };\n\n  if(parseInt(httpRequest.query.current) !== undefined && httpRequest.query.next == \"true\")\n  {\n    seneca.act({role: \"coupons-store\", cmd: \"list\", skip: parseInt(httpRequest.query.current) + 20}, function(err, coupons){\n      if(err) return httpResponse.status(500).send(\"An error occured\");\n\n      seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, image_url){\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(coupons.length > 20)\n        {\n          var next = true;\n        }\n        else\n        {\n          var next = false;\n        }\n\n        var prev = true;\n\n        httpResponse.render(\"index\", {prev: prev, next: next, current: parseInt(httpRequest.query.current) + 20, coupons: coupons, image_url: image_url.value});\n      })\n    })\n  }\n  else if(parseInt(httpRequest.query.current) != undefined && httpRequest.query.prev == \"true\")\n  {\n    seneca.act({role: \"coupons-store\", cmd: \"list\", skip: parseInt(httpRequest.query.current) - 20}, function(err, coupons){\n      if(err) return httpResponse.status(500).send(\"An error occured\");\n\n      seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, image_url){\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(coupons.length > 20)\n        {\n          var next = true;\n        }\n        else\n        {\n          var next = false;\n        }\n\n        if(parseInt(httpRequest.query.current) <= 20)\n        {\n          var prev = false;\n        }\n        else\n        {\n          prev = true;\n        }\n\n        httpResponse.render(\"index\", {prev: prev, next: next, current: parseInt(httpRequest.query.current) - 20, coupons: coupons, image_url: image_url.value});\n      })\n    })\n  }\n  else\n  {\n    seneca.act({role: \"coupons-store\", cmd: \"list\", skip: 0}, function(err, coupons){\n      if(err) return httpResponse.status(500).send(\"An error occured\");\n\n      seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, image_url){\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(coupons.length > 20)\n        {\n          var next = true;\n        }\n        else\n        {\n          var next = false;\n        }\n\n        var prev = false;\n\n        httpResponse.render(\"index\", {prev: prev, next: next, current: 0, coupons: coupons, image_url: image_url.value});\n      })\n    })\n  }\n});\n```", "```js\n<% if(typeof submitted !== \"undefined\"){ %>\n  <% if(submitted == true){ %>\n    <div class=\"alert alert-success\" role=\"alert\">Coupon has been submitted. Our administrator will review and the coupon shortly.</div>\n  <% } %>\n<% } %> \n```", "```js\n<% if(coupons.length < 21){ %>\n  <% var cut = 0; %>\n<% } %>\n<% if(coupons.length == 21){ %>\n  <% var cut = 1; %>\n<% } %>\n<% for(var i = 0; i < coupons.length - cut; i++) {%>\n  <div class=\"col-sm-3 col-lg-3 col-md-3\">\n    <div class=\"thumbnail\">\n      <img src=\"img/' + coupons[i].thumbnail_id %>\" alt=\"\">\n      <div class=\"caption\">\n        <h4 class=\"pull-right\"><del><%= coupons[i].price %></del> <%= coupons[i].discount %></h4>\n        <h4><a href=\"<%= coupons[i].url %>\"><%= coupons[i].title %></a>\n        </h4>\n        <p><%= coupons[i].desc %></p>\n      </div>\n    </div>\n  </div>\n<% } %>\n</div>\n\n<ul class=\"pager\">\n<% if(prev == true){ %>\n  <li class=\"previous\"><a href=\"/?prev=true&current=<%= current %>\">Previous</a></li>\n<% } %>\n<% if(next == true){ %>\n  <li class=\"next\"><a href=\"/?next=true&current=<%= current %>\">Next</a></li>\n<% } %>\n</ul>\n```", "```js\napp.get(\"/add\", function(httpRequest, httpResponse, next){\n  seneca.act({role: \"url-config\", cmd: \"upload-service\"}, function(err, response){\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    httpResponse.render(\"add\", {upload_service_url: response.value});\n  })\n});\n```", "```js\n<form role=\"form\" method=\"post\" action=\"<%= upload_service_url %>/submit\" enctype=\"multipart/form-data\">\n  <div class=\"form-group\">\n    <label for=\"email\">Your Email address:</label>\n    <input type=\"email\" class=\"form-control\" id=\"email\" name=\"email\">\n  </div>\n  <div class=\"form-group\">\n    <label for=\"title\">Product Title:</label>\n    <input type=\"text\" class=\"form-control\" id=\"title\" name=\"title\">\n  </div>\n  <div class=\"form-group\">\n    <label for=\"desc\">Product Description:</label>\n    <textarea class=\"form-control\" id=\"desc\" name=\"desc\"></textarea>\n  </div>\n  <div class=\"form-group\">\n    <label for=\"url\">Product URL: </label>\n    <input type=\"text\" class=\"form-control\" id=\"url\" name=\"url\">\n  </div>\n  <div class=\"form-group\">\n    <label for=\"price\">Original Price:</label>\n    <input type=\"text\" class=\"form-control\" id=\"price\" name=\"price\">\n  </div>\n  <div class=\"form-group\">\n    <label for=\"discount\">Discount Price:</label>\n    <input type=\"text\" class=\"form-control\" id=\"discount\" name=\"discount\">\n  </div>\n  <div class=\"form-group\">\n    <label for=\"thumbnail\">Product Image: <i>(320 x 150)</i></label>\n    <input type=\"file\" class=\"form-control\" id=\"thumbnail\" name=\"thumbnail\">\n  </div>\n  <button type=\"submit\" class=\"btn btn-default\">Submit</button>\n</form>\n```", "```js\nvar auth = function (req, res, next){\n  var user = basicAuth(req);\n\n  if (!user || !user.name || !user.pass) \n  {\n    res.set(\"WWW-Authenticate\", \"Basic realm=Authorization Required\");\n    res.sendStatus(401);\n  }\n\n  //check username and password\n  if (user.name === \"narayan\" && user.pass === \"mypassword\") \n  {\n    next();\n  } \n  else \n  {\n    res.set(\"WWW-Authenticate\", \"Basic realm=Authorization Required\");\n    res.sendStatus(401);\n  }\n}\n\napp.all(\"/admin/*\", auth);\napp.all(\"/admin\", auth);\n```", "```js\napp.get(\"/admin\", function(httpRequest, httpResponse, next){\n  seneca.act({role: \"coupons-store\", cmd: \"admin_list\", skip: 0}, function(err, coupons){\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, image_url){\n      httpResponse.render(\"admin\", {coupons: coupons, image_url: image_url.value});\n    });\n  });\n});\n\napp.get(\"/admin/accept\", function(httpRequest, httpResponse, next){\n  seneca.act({role: \"coupons-store\", cmd: \"verified\", id: httpRequest.query.id}, function(err, verified){\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    if(verified.value == true)\n    {\n      httpResponse.redirect(\"/admin\");  \n    }\n    else\n    {\n      httpResponse.status(500).send(\"An error occured\");\n    }\n  });\n});\n\napp.get(\"/admin/reject\", function(httpRequest, httpResponse, next){\n  seneca.act({role: \"url-config\", cmd: \"image-storage-service\"}, function(err, storage_server_url){\n    if(err) return httpResponse.status(500).send(\"An error occured\");\n\n    request.get(storage_server_url.value + \"/delete/\" + httpRequest.query.thumbnail_id, function(err, resp, body){\n      if(err) return httpResponse.status(500).send(\"An error occured\");\n\n      seneca.act({role: \"coupons-store\", cmd: \"delete\", id: httpRequest.query.id}, function(err, deleted){\n        if(err) return httpResponse.status(500).send(\"An error occured\");\n\n        if(deleted.value == true)\n        {\n          httpResponse.redirect(\"/admin\");  \n        }\n        else\n        {\n          httpResponse.status(500).send(\"An error occured\");\n        }\n      });\n    });\n  })\n});\n```", "```js\n<% for(var i = 0; i < coupons.length; i++) {%>\n  <tr>\n    <td><%= coupons[i].title %></td>\n    <td><%= coupons[i].desc %></td>\n    <td><%= coupons[i].url %></td>\n    <td><img style=\"width: 300px !important\" src=\"img/' + coupons[i].thumbnail_id %>\" alt=\"\"></td>\n    <td><%= coupons[i].price %></td>\n    <td><%= coupons[i].discount %></td>\n    <td>\n      <form role=\"form\" method=\"get\" action=\"/admin/accept\">\n        <div class=\"form-group\">\n          <input type=\"hidden\" value=\"<%= coupons[i].id %>\" name=\"id\">\n          <input type=\"hidden\" value=\"<%= coupons[i].thumbnail_id %>\" name=\"thumbnail_id\">\n          <input type=\"submit\" value=\"Accept\" class=\"btn btn-default\">\n        </div>\n      </form>\n    </td>\n    <td>\n      <form role=\"form\" method=\"get\" action=\"/admin/reject\">\n        <div class=\"form-group\">\n          <input type=\"hidden\" value=\"<%= coupons[i].id %>\" name=\"id\">\n          <input type=\"hidden\" value=\"<%= coupons[i].thumbnail_id %>\" name=\"thumbnail_id\">\n          <input type=\"submit\" value=\"Reject\" class=\"btn btn-default\">\n        </div>\n      </form>\n    </td>\n  </tr>\n<% } %>\n```", "```js\napp.listen(9090);\n```"]