<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 12. Knowing Your Map"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/><span class="koboSpan" id="kobo.1.1">Chapter 12. Knowing Your Map</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this chapter we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Projecting the US map</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Projecting the world map</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Building a choropleth map</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec82"/><span class="koboSpan" id="kobo.6.1">Introduction</span></h1></div></div></div><p><span class="koboSpan" id="kobo.7.1">The ability to project and correlate data points to geographic regions is crucial in many types of visualizations. </span><span class="koboSpan" id="kobo.7.2">Geographic visualization is a complex topic with many competing standards emerging and maturing for today's web technology. </span><span class="koboSpan" id="kobo.7.3">D3 provides a few different ways to visualize geographic and cartographic data. </span><span class="koboSpan" id="kobo.7.4">In this chapter, we will introduce basic D3 cartographic visualization techniques and how to implement a fully-functional choropleth map (a special purpose colored map) in D3.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Projecting the US map"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec83"/><span class="koboSpan" id="kobo.1.1">Projecting the US map</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this recipe we are going to start with projecting the US map using D3 GEO API, while also getting familiar with a few different JSON data formats for describing geographic data. </span><span class="koboSpan" id="kobo.2.2">Let's first take a look at how geographic data are typically presented and consumed in JavaScript.</span></p><div class="section" title="GeoJSON"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec250"/><span class="koboSpan" id="kobo.3.1">GeoJSON</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">The first standard JavaScript geographic data format we are going to touch upon is called </span><span class="strong"><strong><span class="koboSpan" id="kobo.5.1">GeoJSON</span></strong></span><span class="koboSpan" id="kobo.6.1">. </span><span class="koboSpan" id="kobo.6.2">GeoJSON format was originally written and maintained by an Internet working group of developers. </span><span class="koboSpan" id="kobo.6.3">Later it was standardized by the </span><span class="strong"><strong><span class="koboSpan" id="kobo.7.1">Internet Engineering Task Force</span></strong></span><span class="koboSpan" id="kobo.8.1"> (</span><span class="strong"><strong><span class="koboSpan" id="kobo.9.1">IETF</span></strong></span><span class="koboSpan" id="kobo.10.1">) with RFC 7946 and published in August 2016.</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.11.1">GeoJSON is a format for encoding a variety of geographic data structures. </span><span class="koboSpan" id="kobo.11.2">GeoJSON supports the following geometry types: Point, LineString, Polygon, MultiPoint, MultiLineString, and MultiPolygon. </span><span class="koboSpan" id="kobo.11.3">Geometric objects with additional properties are Feature objects. </span><span class="koboSpan" id="kobo.11.4">Sets of features are contained by FeatureCollection objects.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.12.1">Source: </span><a class="ulink" href="http://www.geojson.org/"><span class="koboSpan" id="kobo.13.1">http://www.geojson.org/</span></a>
</em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.14.1">GeoJSON format is a very popular standard for encoding GIS information and is supported by numerous open source as well as commercial software. </span><span class="koboSpan" id="kobo.14.2">GeoJSON format uses latitude and longitude points as its coordinates; therefore, it requires any software, including D3, to find the proper projection, scale and translation method in order to visualize its data. </span><span class="koboSpan" id="kobo.14.3">The following GeoJSON data describes the state of Alabama in feature coordinates:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.15.1">{ 
  "type":"FeatureCollection", 
  "features":[{ 
    "type":"Feature", 
    "id":"01", 
    "properties":{"name":"AL"}, 
    "geometry":{ 
      "type":"Polygon", 
      "coordinates":[[ 
        [-87.359296,35.00118], 
        [-85.606675,34.984749], 
        [-85.431413,34.124869], 
        [-85.184951,32.859696], 
        ... 
        </span><span class="koboSpan" id="kobo.15.2">[-88.202745,34.995703], 
        [-87.359296,35.00118] 
      ]] 
  }] 
} 
</span></pre><p><span class="koboSpan" id="kobo.16.1">GeoJSON is currently the de facto GIS information standard for JavaScript project and is well supported by D3; however, before we jump right into D3 geographic visualization using this data format, we want to also introduce you to another emerging technology closely related to GeoJSON.</span></p><div class="section" title="TopoJSON"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec29"/><span class="koboSpan" id="kobo.17.1">TopoJSON</span></h3></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.18.1">TopoJSON is an extension of GeoJSON that encodes topology. </span><span class="koboSpan" id="kobo.18.2">Rather than representing geometries discretely, geometries in TopoJSON files are stitched together from shared line segments called arcs. </span><span class="koboSpan" id="kobo.18.3">This technique is similar to Matt Bloch's MapShaper and the Arc/Info Export format, .e00.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.19.1">TopoJSON Wiki </span><a class="ulink" href="https://github.com/topojson/topojson"><span class="koboSpan" id="kobo.20.1">https://github.com/topojson/topojson</span></a>
</em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.21.1">TopoJSON was created by D3's author </span><span class="emphasis"><em><span class="koboSpan" id="kobo.22.1">Mike Bostock</span></em></span><span class="koboSpan" id="kobo.23.1"> originally and designed to overcome some of the drawbacks in GeoJSON while providing a similar feature set when describing geographic information. </span><span class="koboSpan" id="kobo.23.2">In most cases concerning cartographic visualization TopoJSON can be a drop-in replacement for GeoJSON with much smaller footprint and better performance. </span><span class="koboSpan" id="kobo.23.3">Therefore, in this chapter, we will use TopoJSON instead of GeoJSON. </span><span class="koboSpan" id="kobo.23.4">Nevertheless, all techniques discussed in this chapter will work perfectly fine with GeoJSON as well. </span><span class="koboSpan" id="kobo.23.5">We will not list TopoJSON example here since its arcs-based format is not very human readable. </span><span class="koboSpan" id="kobo.23.6">However, you can easily convert your </span><span class="strong"><strong><span class="koboSpan" id="kobo.24.1">shapefiles</span></strong></span><span class="koboSpan" id="kobo.25.1"> (popular open source geographic vector format file) into TopoJSON using ogr2ogr command line tool provided by GDAL (</span><a class="ulink" href="http://www.gdal.org/ogr2ogr.html"><span class="koboSpan" id="kobo.26.1">http://www.gdal.org/ogr2ogr.html
</span></a><span class="koboSpan" id="kobo.27.1">).</span></p><p><span class="koboSpan" id="kobo.28.1">Now equipped with this background information let's see how we can make a map in D3.</span></p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec251"/><span class="koboSpan" id="kobo.29.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.30.1">Open your local copy of the following file in your web browser hosted on your local HTTP server:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/usa.html"><span class="koboSpan" id="kobo.31.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/usa.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec252"/><span class="koboSpan" id="kobo.32.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.33.1">In this recipe we will load US TopoJSON data and render them using D3 Geo API. </span><span class="koboSpan" id="kobo.33.2">Here is the code sample:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.34.1">&lt;script type="text/javascript"&gt; 
    var width = 960, 
            height = 500; 
 
    var projection = d3.geoAlbersUsa(); 
 
    var path = d3.geoPath() 
            .projection(projection); 
 
    var svg = d3.select("body").append("svg") 
            .attr("width", width) 
            .attr("height", height); 
 
    var g = svg.append('g') 
            .call(d3.zoom() 
                    .scaleExtent([1, 10]) 
                    .on("zoom", zoomHandler)); 
 
 
    d3.json("../../data/us.json", function (error, us) { // &lt;- A 
        g.insert("path") 
                .datum(topojson.feature(us, us.objects.land)) 
                .attr("class", "land") 
                .attr("d", path); 
 
        g.selectAll("path.state") 
                    .data(topojson.feature(us,  
                          us.objects.states).features) 
                .enter() 
                    .append("path") 
                    .attr("class", "state") 
                    .attr("d", path); 
    }); 
 
    function zoomHandler() { 
        var transform = d3.event.transform; 
 
        g.attr("transform", "translate(" 
                + transform.x + "," + transform.y 
                + ")scale(" + transform.k + ")"); 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.35.1">This recipe projects US map with Albers USA mode:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.36.1"><img src="graphics/image_12_001.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.37.1">US map projected with Albers USA mode</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec253"/><span class="koboSpan" id="kobo.38.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.39.1">As you can see, the code required to project a US map using TopoJSON and D3 is quite short, especially the part concerning map projection. </span><span class="koboSpan" id="kobo.39.2">This is because both D3 geographic API and TopoJSON library are built explicitly to make this kind of job as easy as possible for developers. </span><span class="koboSpan" id="kobo.39.3">To make a map, first you need to load the TopoJSON data file (line </span><code class="literal"><span class="koboSpan" id="kobo.40.1">A</span></code><span class="koboSpan" id="kobo.41.1">). </span><span class="koboSpan" id="kobo.41.2">The following screenshot shows what the topology data looks like once loaded:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.42.1"><img src="graphics/image_12_002.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.43.1">Topology data from TopoJSON</span></p><p><span class="koboSpan" id="kobo.44.1">Once the topology data is loaded, all we have to do is to use the TopoJSON library </span><code class="literal"><span class="koboSpan" id="kobo.45.1">topojson.feature</span></code><span class="koboSpan" id="kobo.46.1"> function to convert topology arcs into coordinates similar to what GeoJSON format provides as shown in the following screenshot:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.47.1"><img src="graphics/5530_12_03_new.jpg" alt="How it works..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.48.1">Feature collection converted using topojson.feature function</span></p><p><span class="koboSpan" id="kobo.49.1">Then </span><code class="literal"><span class="koboSpan" id="kobo.50.1">d3.geo.path</span></code><span class="koboSpan" id="kobo.51.1"> will automatically recognize and use the coordinates to generate </span><code class="literal"><span class="koboSpan" id="kobo.52.1">svg:path</span></code><span class="koboSpan" id="kobo.53.1"> highlighted in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.54.1">var path = d3.geoPath() // &lt;- A 
            .projection(d3.geoAlbersUsa()); 
... 
</span><span class="koboSpan" id="kobo.54.2">g.insert("path") // &lt;-B 
                .datum(topojson.feature(us, us.objects.land)) 
                .attr("class", "land") 
                .attr("d", path); 
 
        g.selectAll("path.state")                        
                 .data(topojson.feature(us, 
                      us.objects.states).features) // &lt;-C 
                .enter() 
                    .append("path") 
                    .attr("class", "state") 
                    .attr("d", path); 
</span></pre><p><span class="koboSpan" id="kobo.55.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.56.1">A</span></code><span class="koboSpan" id="kobo.57.1">, we first create a D3 GEO path object configured with Albers USA projection mode. </span><span class="koboSpan" id="kobo.57.2">Then we insert a </span><code class="literal"><span class="koboSpan" id="kobo.58.1">svg:path</span></code><span class="koboSpan" id="kobo.59.1"> that describe the outline of US, since this can be achieved by a single </span><code class="literal"><span class="koboSpan" id="kobo.60.1">svg:path</span></code><span class="koboSpan" id="kobo.61.1"> element (on line </span><code class="literal"><span class="koboSpan" id="kobo.62.1">B</span></code><span class="koboSpan" id="kobo.63.1">). </span><span class="koboSpan" id="kobo.63.2">For the outline of each states we use the feature collection generated on line </span><code class="literal"><span class="koboSpan" id="kobo.64.1">C</span></code><span class="koboSpan" id="kobo.65.1"> to create one </span><code class="literal"><span class="koboSpan" id="kobo.66.1">svg:path</span></code><span class="koboSpan" id="kobo.67.1"> for each state that allow us to highlight the state on hover. </span><span class="koboSpan" id="kobo.67.2">With separate SVG element representing the states will also allow you to respond user interaction like click and touch.</span></p><p><span class="koboSpan" id="kobo.68.1">That's it! </span><span class="koboSpan" id="kobo.68.2">This is all you need to do to project a map in D3 using TopoJSON. </span><span class="koboSpan" id="kobo.68.3">Additionally, we have also attached a zoom handler to the parent </span><code class="literal"><span class="koboSpan" id="kobo.69.1">svg:g</span></code><span class="koboSpan" id="kobo.70.1"> element:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.71.1">var g = svg.append('g') 
            .call(d3.zoom() 
                    .scaleExtent([1, 10]) 
                    .on("zoom", zoomHandler)); 
</span></pre><p><span class="koboSpan" id="kobo.72.1">This allows the user to perform simple geometric zoom on our map.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec254"/><span class="koboSpan" id="kobo.73.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.74.1">GeoJSON v1.0 specification: </span><a class="ulink" href="http://geojson.org/geojson-spec.html"><span class="koboSpan" id="kobo.75.1">http://geojson.org/geojson-spec.html</span></a></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.76.1">TopoJSON Wiki: </span><a class="ulink" href="https://github.com/topojson/topojson/wiki"><span class="koboSpan" id="kobo.77.1">https://github.com/topojson/topojson/wiki</span></a></li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch03.html" title="Chapter 3. Dealing with Data"><span class="koboSpan" id="kobo.78.1">Chapter 3</span></a><span class="koboSpan" id="kobo.79.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.80.1">Dealing with Data</span></em></span><span class="koboSpan" id="kobo.81.1">, for more information on asynchronous data loading</span></li><li class="listitem" style="list-style-type: disc"><a class="link" href="ch10.html" title="Chapter 10. Interacting with Your Visualization"><span class="koboSpan" id="kobo.82.1">Chapter 10</span></a><span class="koboSpan" id="kobo.83.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.84.1">Interacting with Your Visualization</span></em></span><span class="koboSpan" id="kobo.85.1">, for more information on how to implement zooming</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.86.1">Mike Bostock's post on Albers USA projection on which this recipe is based </span><a class="ulink" href="http://bl.ocks.org/mbostock/4090848"><span class="koboSpan" id="kobo.87.1">http://bl.ocks.org/mbostock/4090848</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Projecting the world map"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec84"/><span class="koboSpan" id="kobo.1.1">Projecting the world map</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">What if our visualization project is not just about US, but rather concerns the whole world? </span><span class="koboSpan" id="kobo.2.2">No worries, D3 comes with various built-in projection modes that work well with the world map that we will explore in this recipe.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec255"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser hosted on your local HTTP server:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/world.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/world.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec256"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe we will project the world map using various different D3 built-in projection modes. </span><span class="koboSpan" id="kobo.7.2">Here is the code sample:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
    var width = 300, 
        height = 300, 
        translate = [width / 2, height / 2]; 
 
    var projections = [ // &lt;-A 
        {name: 'geoAzimuthalEqualArea', fn: d3.geoAzimuthalEqualArea() 
                .scale(50) 
                .translate(translate)}, 
        {name: 'geoConicEquidistant', fn: d3.geoConicEquidistant() 
                .scale(35) 
                .translate(translate)}, 
        {name: 'geoEquirectangular', fn: d3.geoEquirectangular() 
                .scale(50) 
                .translate(translate)}, 
        {name: 'geoMercator', fn: d3.geoMercator() 
                .scale(50) 
                .translate(translate)}, 
        {name: 'geoOrthographic', fn: d3.geoOrthographic() 
                        .scale(90) 
                        .translate(translate)}, 
        {name: 'geoStereographic', fn: d3.geoStereographic() 
                                .scale(35) 
                                .translate(translate)} 
    ]; 
 
d3.json("../../data/world-50m.json",  
           function (error, world) { // &lt;-B 
        projections.forEach(function (projection) { 
            var path = d3.geoPath() // &lt;-C 
                    .projection(projection.fn); 
 
            var div = d3.select("body") 
                    .append("div") 
                    .attr("class", "map"); 
 
            var svg = div 
                    .append("svg") 
                    .attr("width", width) 
                    .attr("height", height); 
 
            svg.append("path") // &lt;-D 
                    .datum(topojson.feature(world,  
                             world.objects.land)) 
                    .attr("class", "land") 
                    .attr("d", path); 
 
            svg.append("path") // &lt;-E 
                    .datum(topojson.mesh(world,  
                             world.objects.countries)) 
                    .attr("class", "boundary") 
                    .attr("d", path); 
 
            div.append("h3").text(projection.name); 
        }); 
    }); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">This recipe generates world maps with different projection modes as shown in the following screenshot:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_12_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">World map projection</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec257"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">In this recipe, we first define an array containing six different D3 projection modes on line </span><code class="literal"><span class="koboSpan" id="kobo.14.1">A</span></code><span class="koboSpan" id="kobo.15.1">. </span><span class="koboSpan" id="kobo.15.2">A world topology data was loaded on line </span><code class="literal"><span class="koboSpan" id="kobo.16.1">B</span></code><span class="koboSpan" id="kobo.17.1">. </span><span class="koboSpan" id="kobo.17.2">Similar to the previous recipe we have a </span><code class="literal"><span class="koboSpan" id="kobo.18.1">d3.geoPath</span></code><span class="koboSpan" id="kobo.19.1"> generator defined on line </span><code class="literal"><span class="koboSpan" id="kobo.20.1">C</span></code><span class="koboSpan" id="kobo.21.1">. </span><span class="koboSpan" id="kobo.21.2">We also customized the projection mode for geo path generator calling its </span><code class="literal"><span class="koboSpan" id="kobo.22.1">projection</span></code><span class="koboSpan" id="kobo.23.1"> function. </span><span class="koboSpan" id="kobo.23.2">The rest of the recipe is almost identical to what we have done in the previous recipe. </span><span class="koboSpan" id="kobo.23.3">The </span><code class="literal"><span class="koboSpan" id="kobo.24.1">topojson.feature</span></code><span class="koboSpan" id="kobo.25.1"> function was used to convert topology data into geographic coordinates so </span><code class="literal"><span class="koboSpan" id="kobo.26.1">d3.geoPath</span></code><span class="koboSpan" id="kobo.27.1"> can generate </span><code class="literal"><span class="koboSpan" id="kobo.28.1">svg:path</span></code><span class="koboSpan" id="kobo.29.1"> required for map rendering (line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">D</span></code><span class="koboSpan" id="kobo.31.1">). </span><span class="koboSpan" id="kobo.31.2">On line </span><code class="literal"><span class="koboSpan" id="kobo.32.1">E</span></code><span class="koboSpan" id="kobo.33.1">, one new function </span><code class="literal"><span class="koboSpan" id="kobo.34.1">mesh</span></code><span class="koboSpan" id="kobo.35.1"> from TopoJSON was used worth mentioning here. </span><code class="literal"><span class="koboSpan" id="kobo.36.1">topojson.mesh</span></code><span class="koboSpan" id="kobo.37.1"> function returns the GeoJSON </span><code class="literal"><span class="koboSpan" id="kobo.38.1">MultiLineString</span></code><span class="koboSpan" id="kobo.39.1"> geometry object representing complicated topology. </span><span class="koboSpan" id="kobo.39.2">This is a very compact way to render complex geometric shapes since all shared arcs are only included once. </span><span class="koboSpan" id="kobo.39.3">In our case since we don't really need to visualize country outline on each continent separately and they are share their borders therefore this is the most efficient option in rendering.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec258"/><span class="koboSpan" id="kobo.40.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.41.1">D3 wiki Geo Projection page (</span><a class="ulink" href="https://github.com/d3/d3-geo/blob/master/README.md#projections"><span class="koboSpan" id="kobo.42.1">https://github.com/d3/d3-geo/blob/master/README.md#projections
</span></a><span class="koboSpan" id="kobo.43.1">) for more information on different projection modes as well as on how raw custom projection can be implemented</span></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Building a choropleth map"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec85"/><span class="koboSpan" id="kobo.1.1">Building a choropleth map</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Choropleth map is a thematic map, in other words, a specially designed map not a general purpose one, which is designed to show measurement of statistical variable on the map using different color shades or patterns; or sometimes referred as geographic heat-map in simpler terms. </span><span class="koboSpan" id="kobo.2.2">We have already seen in the previous two recipes that geographic projection in D3 consists of a group of </span><code class="literal"><span class="koboSpan" id="kobo.3.1">svg:path</span></code><span class="koboSpan" id="kobo.4.1"> elements, therefore, they can be manipulated as any other </span><code class="literal"><span class="koboSpan" id="kobo.5.1">svg</span></code><span class="koboSpan" id="kobo.6.1"> elements including coloring. </span><span class="koboSpan" id="kobo.6.2">We will explore this feature in geo-projection and implement a Choropleth map in this recipe.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec259"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser hosted on your local HTTP server:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/choropleth.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter12/choropleth.html</span></a><span class="koboSpan" id="kobo.10.1">.
</span></p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec260"/><span class="koboSpan" id="kobo.11.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">In a choropleth map different geographic regions are colored according to their corresponding variables, in this case based on 2008 unemployment rate in US by county. </span><span class="koboSpan" id="kobo.12.2">Now, let's see how to do it in code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.13.1">&lt;script type="text/javascript"&gt; 
    var width = 960, 
            height = 500; 
 
    var color = d3.scaleThreshold() 
            .domain([.02, .04, .06, .08, .10]) // &lt;-A 
            .range(["#f2f0f7", "#dadaeb", "#bcbddc", 
                    "#9e9ac8", "#756bb1", "#54278f"]); 
 
    var projection = d3.geoAlbersUsa(); 
 
    var path = d3.geoPath() 
            .projection(projection); 
 
    var svg = d3.select("body").append("svg") 
            .attr("width", width) 
            .attr("height", height); 
 
    var g = svg.append("g") 
            .call(d3.zoom() 
            .scaleExtent([1, 10]) 
            .on("zoom", zoomHandler)); 
 
    d3.json("../../data/us.json", function (error, us) { // &lt;-B 
        d3.tsv("../../data/unemployment.tsv", 
                function (error, unemployment) { 
            var rateById = {}; 
 
            unemployment.forEach(function (d) { // &lt;-C 
                rateById[d.id] = +d.rate; 
            }); 
 
            g.append("g") 
                    .attr("class", "counties") 
                    .selectAll("path") 
                    .data(topojson.feature(us, 
                            us.objects.counties).features) 
                    .enter().append("path") 
                    .attr("d", path) 
                    .style("fill", function (d) { 
                        return color(rateById[d.id]); // &lt;-D 
                    }); 
 
            g.append("path") 
                    .datum(topojson.mesh(us, // &lt;-E 
                            us.objects.states, 
                             function(a, b) {  
                                 return a !== b;  
                     }))  
                    .attr("class", "states") 
                    .attr("d", path); 
        }); 
    }); 
 
    function zoomHandler() { 
        var transform = d3.event.transform; 
 
        g.attr("transform", "translate(" 
                + transform.x + "," + transform.y 
                + ")scale(" + transform.k + ")"); 
    } 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.14.1">This recipe generates the following choropleth map:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.15.1"><img src="graphics/image_12_005.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.16.1">Choropleth Map of 2008 Unemployment Rate</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec261"/><span class="koboSpan" id="kobo.17.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.18.1">In this recipe we loaded two different data sets: one for the US topology and the other containing unemployment rate by county in 2008 (line </span><code class="literal"><span class="koboSpan" id="kobo.19.1">B</span></code><span class="koboSpan" id="kobo.20.1">). </span><span class="koboSpan" id="kobo.20.2">This technique is generally considered as layering and is not necessarily limited to only two layers. </span><span class="koboSpan" id="kobo.20.3">The unemployment data are stitched to counties by their ID (line </span><code class="literal"><span class="koboSpan" id="kobo.21.1">B</span></code><span class="koboSpan" id="kobo.22.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.23.1">C</span></code><span class="koboSpan" id="kobo.24.1">). </span><span class="koboSpan" id="kobo.24.2">Region coloring is achieved by using a threshold scale defined on line </span><code class="literal"><span class="koboSpan" id="kobo.25.1">A</span></code><span class="koboSpan" id="kobo.26.1">.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec262"/><span class="koboSpan" id="kobo.27.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.28.1">TopoJSON Wiki for more information on mesh function: </span><a class="ulink" href="https://github.com/topojson/topojson-client#mesh"><span class="koboSpan" id="kobo.29.1">https://github.com/topojson/topojson-client#mesh
</span></a></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.30.1">D3 Wiki for more information on threshold scale: </span><a class="ulink" href="https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold"><span class="koboSpan" id="kobo.31.1">https://github.com/d3/d3-scale/blob/master/README.md#scaleThreshold
</span></a></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.32.1">Mike Bostock's post on choropleth map which this recipe is based on: </span><a class="ulink" href="http://bl.ocks.org/mbostock/4090848"><span class="koboSpan" id="kobo.33.1">http://bl.ocks.org/mbostock/4090848
</span></a></li></ul></div></div></div></div></div></body></html>