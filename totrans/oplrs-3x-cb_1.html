<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Web Mapping Basics</h1></div></div></div><p>In this chapter we cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a simple full screen map</li><li class="listitem" style="list-style-type: disc">Different ways to include OpenLayers</li><li class="listitem" style="list-style-type: disc">Understanding base and non-base layers</li><li class="listitem" style="list-style-type: disc">Avoiding the need of a base layer</li><li class="listitem" style="list-style-type: disc">Playing with the map's options</li><li class="listitem" style="list-style-type: disc">Managing map's stack layers</li><li class="listitem" style="list-style-type: disc">Managing map's controls</li><li class="listitem" style="list-style-type: disc">Moving around the map view</li><li class="listitem" style="list-style-type: disc">Restricting the map extent</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec01"/>Introduction</h1></div></div></div><p>Every history has a beginning, in the same way every recipe starts with the initial condiments.</p><p>This chapter shows us the basics and more important things that we need to know when we start creating our first web mapping applications with OpenLayers.</p><p>As we will see in this chapter and the following chapters, OpenLayers is a big and complex framework but, at the same time it is also very powerful and flexible.</p><p>In contrast to other libraries, such as the nice but much more simple Leaflet project (<a class="ulink" href="http://leaflet.cloudmade.com">http://leaflet.cloudmade.com</a>) library, OpenLayers tries to implement all the required things a developer could need to create a web GIS application. That is, not only GIS related concepts such as map, layer, or standard formats but also manipulation of document elements or helper functions to make asynchronous requests.</p><p>Trivializing, we have described a big picture of the framework in the next paragraph.</p><p>The main concept in OpenLayers is the map. It represents the view where information is rendered. The map can contain any number of layers, which can be the raster or vector layer. On its way, each layer has a data source that serves data with its own format: a PNG image, a KML file, and so on. In addition, the map can contain controls, which help to interact with the map and its contents: pan, zoom, feature selection, and so on.</p><p>Let's get started with learning OpenLayers by examples.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec02"/>Creating a simple full screen map</h1></div></div></div><p>When you work in mapping applications, the first and important task is the creation of the map itself. The map is the core of your application and it is where you will add and visualize data.</p><p>This recipe will guide you through the process of creating our first and very simple web map application.</p><div><h3 class="title"><a id="note02"/>Note</h3><p>It is supposed that a web server is configured and ready. Remember our recipes are nothing more than HTML, CSS, and JavaScript code and because of this we need a web server that serves them to be interpreted on the browser's side.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec01"/>Getting ready</h2></div></div></div><p>Programming with OpenLayers is mainly related to writing HTML code and, of course, JavaScript code. So, we simply need a text editor to start coding our recipes.</p><p>There exist plenty of great text editors, many of them with web programming capabilities. Because we are going to start exploring an open source project such as OpenLayers we will refer to a couple of great open projects.</p><p>For Windows users, Notepad++ (<a class="ulink" href="http://notepad-plus-plus.org">http://notepad-plus-plus.org</a>) is a great alternative to the default text editor. It is simple and quick, offers syntax highlighting, and addition of plugins to extend capabilities.</p><p>On the other hand, instead of text editors you can find complete development frameworks with support for web development, not only with syntax highlighting but with autocomplete, code navigation, and many more.</p><p>In this group, two projects are the stars within the open source projects universe: Eclipse (<a class="ulink" href="http://www.eclipse.org">http://www.eclipse.org</a>) and NetBeans (<a class="ulink" href="http://netbeans.org">http://netbeans.org</a>). Both are Java-based projects and run on any platform.</p><p>You can find the source code at<code class="literal"> recipe/ch01/ch01_simple_map_book.html</code> file.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec02"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Let's start by creating a new empty<code class="literal"> index.html</code> file and inserting the following block of code in it. We will explain it step-by-step in the next section:<div><pre class="programlisting">&lt;!DOCTYPE html&gt; 
&lt;html&gt; 
    &lt;head&gt; 
        &lt;title&gt;Creating a simple map&lt;/title&gt; 
        &lt;meta http-equiv="Content-Type" 
            content="text/html; charset=UTF-8"&gt; 
        
        &lt;!-- Include OpenLayers library --&gt; 
        &lt;script type="text/javascript" 
            src="http://openlayers.org/api/2.11/
            OpenLayers.js"&gt;&lt;/script&gt; 
        &lt;style&gt; 
            html, body { 
                width: 100%; 
                height: 100%; 
                margin: 0; 
                padding: 0; 
            } 
        &lt;/style&gt; 

        &lt;!-- The magic comes here --&gt; 
        &lt;script type="text/javascript"&gt; 
            function init() { 
                // Create the map using the specified 
                // DOM element 
                var map = new OpenLayers.Map("rcp1_map"); 
    
                // Create an OpenStreeMap raster layer 
                // and add to the map 
                var osm = new OpenLayers.Layer.OSM(); 
                map.addLayer(osm); 
    
                // Set view to zoom maximum map extent 
                map.zoomToMaxExtent(); 
            } 
        &lt;/script&gt; 
    &lt;/head&gt; 
    &lt;body onload="init()"&gt; 
        &lt;div id="rcp1_map" style="width: 100%; 
            height: 100%;"&gt;&lt;/div&gt; 
    &lt;/body&gt; 
&lt;/html&gt;
</pre></div><div><h3 class="title"><a id="tip01"/>Tip</h3><p>
<strong>Downloading the example code</strong>
</p><p>You can download the example code files for all Packt books you have purchased from your account at<a class="ulink" href="http://www.packtpub.com"> http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit<a class="ulink" href="http://www.packtpub.com/support"> http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></li><li class="listitem">Open the file in your browser and see the result. You will see a whole screen map with some controls on the top-left corner, as shown in the following screenshot:</li></ol></div><div><img alt="How to do it..." src="img/7843_01_01.jpg"/></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec03"/>How it works...</h2></div></div></div><p>Let us explain the mystery step-by-step. First, we created a HTML5 document, see the<code class="literal"> doctype</code> declaration code<code class="literal">&lt;!DOCTYPE html&gt;</code>.</p><p>In the<code class="literal"> head</code> section, we have included a reference to the OpenLayers library using a<code class="literal"> script</code> element, as follows:</p><div><pre class="programlisting">&lt;script type="text/javascript" 
src="img/OpenLayers.js"&gt;&lt;/script&gt;
</pre></div><p>We have added a<code class="literal"> style</code> element to force the document to occupy the whole page, as follows:</p><div><pre class="programlisting">&lt;style&gt; 
    html, body { 
        width: 100%; 
        height: 100%; 
        margin: 0; 
        padding: 0; 
    } 
&lt;/style&gt;
</pre></div><p>After the<code class="literal"> style</code> element comes the<code class="literal"> script</code> element with some JavaScript code, but we will explain it at the end.</p><p>After the<code class="literal"> head</code> section starts the<code class="literal"> body</code> section. Our<code class="literal"> body</code> has an<code class="literal"> onload</code> event associated to it. This means, once the whole content of the<code class="literal"> body</code> section is completely loaded by the browser, the<code class="literal"> init()</code> function will be called:</p><div><pre class="programlisting">&lt;body onload="init()"&gt;
</pre></div><p>Finally, within the body we have put a<code class="literal"> div</code> element with the identifier<code class="literal"> rcp1_map</code>, which will be used by OpenLayers to render the map.</p><p>Again, we force the element to fill the entire parent's space:</p><div><pre class="programlisting">&lt;div id="rcp1_map" style="width: 100%; height: 100%;"&gt;&lt;/div&gt;
</pre></div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>
<strong>A word about styles...</strong>
</p><p>Setting the<code class="literal"> div</code> element<code class="literal"> width/height</code> to<code class="literal"> 100%</code> means it will fill 100 percent of the parent's space. In this case, the parent is the<code class="literal"> body</code> element, which is also set to fill 100 percent of the page space. More and better information about CSS can be found at<a class="ulink" href="http://www.w3schools.com/css"> http://www.w3schools.com/css</a>.</p></div><p>Now, let's take a look at the<code class="literal"> script</code> element in the<code class="literal"> head</code> section.</p><p>As we have mentioned previously, using the<code class="literal"> onload</code> event we ensure the<code class="literal"> init</code> function is executed once the entire<code class="literal"> body</code> elements are loaded by the browser, which means we can access<code class="literal">&lt;div id="rcp1_map" ...&gt;</code> without any problem.</p><p>First we created an<code class="literal"> OpenLayers.Map</code> object that will be rendered in the previously mentioned<code class="literal"> div</code> element. This is achieved by passing the<code class="literal"> DOM</code> element identifier in the constructor:</p><div><pre class="programlisting">// Create the map using the specified DOM element
var map = new OpenLayers.Map("rcp1_map");
</pre></div><p>Next, we created a new raster layer that will show imagery from the<code class="literal"> OpenStreetMaps</code> project:</p><div><pre class="programlisting">// Create an OpenStreetMap raster layer and add to the map
var osm = new OpenLayers.Layer.OSM();
</pre></div><p>Once created we add it to the map:</p><div><pre class="programlisting">map.addLayer(osm);
</pre></div><p>Finally, set the<code class="literal"> map</code> view to the maximum valid extent:</p><div><pre class="programlisting">// Set view to zoom maximum map extent
map.zoomToMaxExtent();
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec04"/>There's more...</h2></div></div></div><p>Remember there is no one way to do things.</p><p>The recipes in this book have not been coded as standalone applications. Instead, to improve the user experience, we have created a rich application that allows you to choose and run the desired recipe, with the possibility to see the source code.</p><div><img alt="There's more..." src="img/7843_01_09.jpg"/></div><p>So the way to code the recipes in the book is slightly different, because they must be integrated with the application's design. For example, they do not require including the OpenLayers libraries because this is included in another place of the main application.</p><p>In addition, the way presented in the<em> How to do it..</em>. section is more oriented toward standalone applications.</p><p>If you are looking at the source code of this recipe, located at<code class="literal"> recipes/ch01/ch01_simple_map.html</code>, we will see a slightly different code:</p><div><pre class="programlisting">&lt;!-- Map DOM element --&gt;
&lt;div id="ch1_simple_map" style="width: 100%; height: 95%;"&gt;&lt;/div&gt;

&lt;!-- The magic comes here --&gt;
&lt;script type="text/javascript"&gt;

    // Create the map using the specified DOM element
    var map = new OpenLayers.Map("ch1_simple_map");
    
    // Create an OpenStreeMap raster layer and add to the map
    var osm = new OpenLayers.Layer.OSM();
    map.addLayer(osm);
    
    // Set view to zoom maximum map extent
    map.zoomToMaxExtent();
&lt;/script&gt;
</pre></div><p>As we can see, it contains the main parts described in the previous sections. We have a<code class="literal"> div</code> element to hold the map instance and a<code class="literal"> script</code> element with all the required JavaScript code.</p><p>To create the rich application, we have to use the Dojo Toolkit framework (<a class="ulink" href="http://dojotoolkit.org">http://dojotoolkit.org</a>), which offers almost any kind of required feature: access and modification of the document object structure, event handling, internationalization, and so on. But the main reason we have chosen it is because, in addition it offers a great set of homogeneous widgets (tabs, buttons, lists, and so on) to create applications with a great look and feel.</p><p>It is beyond the scope of this book to teach Dojo but its use is so easy and specific that it will not disturb the objective of this recipe, which is to teach OpenLayers.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec05"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Different ways to include OpenLayers</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Understanding base and non-base layers</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec03"/>Different ways to include OpenLayers</h1></div></div></div><p>There are different ways we can include OpenLayers in our projects depending on the environment we are working in, that is development or production.</p><p>The environment refers to the server tier required for a stage in our process. In this way, the development environment is related to the development process, where programmers are working day to day, testing and checking.</p><p>Production environment refers to the final stage of the projects. It must run on stable servers and without dependency problems.</p><p>As we will see shortly, we can summarize the solutions to include OpenLayers JavaScript code in two groups, those with code hosted on a remote server or those with code hosted on our own server.</p><p>Let's start and see the pros and cons of each solution.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec06"/>Getting ready</h2></div></div></div><p>Create a folder called<code class="literal"> myProject</code> that will contain all our project files and library dependencies. Then create an<code class="literal"> index.html</code> file and continue with the code given in the<em> Creating a simple full screen map</em> recipe.</p><div><h3 class="title"><a id="note03"/>Note</h3><p>It is supposed that the project folder resides within a folder accessible by the web server folder, so it can serve its content.</p></div><p>Now download OpenLayers code from the project's web page at<a class="ulink" href="http://www.openlayers.org"> http://www.openlayers.org</a>.</p><div><h3 class="title">Note</h3><p>At the time of writing this book, OpenLayers version 2.11 is the stable release, which can be found at<a class="ulink" href="http://openlayers.org/download/OpenLayers-2.11.tar.gz"> http://openlayers.org/download/OpenLayers-2.11.tar.gz</a>.</p></div><p>Save the bundle in the<code class="literal"> myProject</code> folder and uncompress it. We need to have a folder structure similar to the following screenshot:</p><div><img alt="Getting ready" src="img/7843_01_02.jpg"/></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec07"/>How to do it...</h2></div></div></div><p>We have three ways to include the OpenLayers library in our code:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;script type="text/javascript" src="img/OpenLayers.js"&gt; &lt;/script&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;script type="text/javascript" src="img/OpenLayers.js"&gt;&lt;/script&gt;</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt;script type="text/javascript" src="img/OpenLayers.js"&gt;&lt;/script&gt;</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>How it works...</h2></div></div></div><p>The first option includes an all-in-one compressed file hosted at the OpenLayers project server. It is simple to use but you cannot work locally in offline mode:</p><div><pre class="programlisting">&lt;script type="text/javascript" 
src="img/OpenLayers.js"&gt;&lt;/script&gt;
</pre></div><div><h3 class="title"><a id="note04"/>Note</h3><p>The size of the compressed all-in-one file<code class="literal"> OpenLayers.js</code> is nearly 1 MB, so in a production environment with lots of requests it is probably better to host this file in a Content Delivery Network or CDN (<a class="ulink" href="http://en.wikipedia.org/wiki/Content_delivery_network">http://en.wikipedia.org/wiki/Content_delivery_network</a>).</p></div><p>The second option is very similar to the first one, but the all-in-one compressed file is attached to the project. This option is suitable for cases in which you need OpenLayers to be in your own server with the code of your application.</p><div><pre class="programlisting">&lt;script type="text/javascript" src="../js/
OpenLayers-2.11/OpenLayers.js"&gt;&lt;/script&gt;
</pre></div><p>Finally, the third option includes the uncompressed code of the OpenLayers library, which in fact includes many other files required by layers, controls, and so on.</p><div><pre class="programlisting">&lt;script type="text/javascript" src="../js/
OpenLayers-2.11/lib/OpenLayers.js"&gt;&lt;/script&gt; 
</pre></div><p>This option is mainly used by programmers who want to extend OpenLayers and need to debug the code.</p><div><h3 class="title"><a id="tip03"/>Tip</h3><p>I encourage you to work in this mode. Use some tool such as Firebug for Firefox web browser or the Chrome browser console and put breakpoints on OpenLayers classes to better understand what is happening.</p></div><p>It is worth saying when using this method lots of files are loaded from the server, one per class, which means many more server requests are made.</p><p>The most notable impact of this is that the page load time is much longer than with the previous options.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>There's more...</h2></div></div></div><p>If you choose to download OpenLayers and include it within your project, you don't need to put the whole uncompressed bundle. As you can see, it contains lots of files and folders: source code, building scripts, test code, and other tools, but only a few are really required.</p><p>In this case, the only things you need to attach are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The all-in-one<code class="literal"> OpenLayers.js</code> file</li><li class="listitem" style="list-style-type: disc">The<code class="literal"> theme</code> and<code class="literal"> img</code> folders</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding base and non-base layers</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Creating a simple full screen map</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec04"/>Understanding base and non-base layers</h1></div></div></div><p>One of the first things you need to have clear when working with OpenLayers is the base layer concept.</p><p>A<strong> base layer</strong> is a special kind of layer, which is always visible and determines some map properties such as projection and zoom levels.</p><p>A map can have more than one base layer but only one of them can be active at a time.</p><p>In addition, if you add more than one flagged base layer to the map, the first base layer added will be used as the map's active base layer.</p><p>This recipe will show you how to add layers to the map flagging them to be base layers. We are going to create a page with two maps side-by-side and every map will have a layer switcher control that allows you to control the map layers.</p><div><img alt="Understanding base and non-base layers" src="img/7843_01_03.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Getting ready</h2></div></div></div><p>We assume you have created an<code class="literal"> index.html</code> file and included the OpenLayers library as we have seen in the<em> Different ways to include OpenLayers</em> recipe.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Start by creating the necessary HTML code to have both our maps side-by-side:<div><pre class="programlisting">&lt;table style="width: 100%; height: 100%;"&gt; 
    &lt;tr&gt; 
        &lt;td&gt; 
            &lt;p&gt;Map with one non base layer:&lt;/p&gt; 
            &lt;div id="ch01_base_nonbase_map_a" 
                style="width: 100%; height: 500px;"&gt;
            &lt;/div&gt; 
        &lt;/td&gt; 
        &lt;td&gt; 
            &lt;p&gt;Map with two base layers&lt;/p&gt; 
            &lt;div id="ch01_base_nonbase_map_b" 
                style="width: 100%; height: 500px;"&gt;
            &lt;/div&gt; 
        &lt;/td&gt; 
    &lt;/tr&gt; 
&lt;/table&gt;
</pre></div></li><li class="listitem">After this, add a<code class="literal"> script</code> element<code class="literal"> (&lt;script type="text/javascript"&gt;&lt;/script&gt;)</code> with the necessary code to initialize every map. The map on the left will contain two layers, one base layer and one non-base layer:<a class="indexterm" id="id0"/><div><pre class="programlisting">// 
// Initialize left map 
// 
    
// Create the map using the specified DOM element 
var map_a = new OpenLayers.Map("ch01_base_nonbase_map_a"); 
// Add a WMS layer 
var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
map_a.addLayer(wms); 
// Add a WMS layer 
var topo = new OpenLayers.Layer.WMS("USA Topo Maps", "http://terraservice.net/ogcmap.ashx", 
{ 
    layers: "DRG" 
}, 
{ 
    opacity: 0.5, 
    isBaseLayer: false 
}); 
map_a.addLayer(topo); 
// Add LayerSwitcher control 
map_a.addControl(new OpenLayers.Control.LayerSwitcher()); 
           
// Set view to zoom maximum map extent 
// NOTE: This will fail if there is no base layer defined 
map_a.setCenter(new OpenLayers.LonLat(-100, 40), 5);
<a class="indexterm" id="id1"/>
</pre></div></li><li class="listitem">The map on the right will contain two base layers:<a class="indexterm" id="id2"/><div><pre class="programlisting">// 
// Initialize right map 
// 
    
// Create the map using the specified DOM element 
var map_b = new OpenLayers.Map("ch01_base_nonbase_map_b"); 
// Add a WMS layer 
var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
map_b.addLayer(wms); 
// Add a WMS layer 
var topo = new OpenLayers.Layer.WMS("USA Topo Maps", "http://terraservice.net/ogcmap.ashx", 
{ 
    layers: "DRG" 
}); 
map_b.addLayer(topo); 
// Add LayerSwitcher control 
map_b.addControl(new OpenLayers.Control.LayerSwitcher()); 
           
// Set view to zoom maximum map extent 
// NOTE: This will fail if there is no base layer defined 
map_b.setCenter(new OpenLayers.LonLat(-100, 40), 5);
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec13"/>How it works...</h3></div></div></div><p>Let's take a look at the explanation for the map on the left. The first thing we have done is the creation of an<code class="literal"> OpenLayers.Map</code> instance that will be rendered in the<code class="literal"> div</code> element prepared for it, on the left side:<a class="indexterm" id="id3"/>
</p><div><pre class="programlisting">var map_a = new OpenLayers.Map("ch01_base_nonbase_map_a");
</pre></div><p>Next, we have created two layers and added them to the map. The magic to make the second layer a non-base layer comes with the properties specified in the constructor:</p><div><pre class="programlisting">var topo = new OpenLayers.Layer.WMS("USA Topo Maps", "http://terraservice.net/ogcmap.ashx", 
{ 
    layers: "DRG" 
}, 
{ 
    opacity: 0.5, 
    isBaseLayer: false 
});
</pre></div><p>In OpenLayers, all layer classes are inherited from the base class<code class="literal"> OpenLayers.Layer</code>. This class defines some properties common for all layers, such as<code class="literal"> opacity</code> or<code class="literal"> isBaseLayer</code>.</p><p>The Boolean<code class="literal"> isBaseLayer</code> property is used by the map to know if a layer must act as a base or non-base layer.</p><div><h3 class="title"><a id="note05"/>Note</h3><p>Non-base layers are also called<strong> overlays</strong>.</p></div><p>As you can imagine, the<code class="literal"> opacity</code> property is a float value ranging from 0.0 to 1.0 and specifies the opacity of the layer. We have set it to<code class="literal"> 50%</code> of the opacity to allow view through the overlay layer, that is, to be able to see the base layer.</p><p>For the right-hand map, we have added two layers without any specific property. This, by default, makes the WMS layer a base layer.</p><p>If you expand the layer switcher control, you will see that on the left map you can show/hide the overlay layer but you can't hide the base layer. In contrast, in the right map, both are base layers and they are mutually exclusive, which means only one can be active at a time.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec14"/>There's more...</h3></div></div></div><p>When you play with the layer switcher control, an internal call is made to the map's<code class="literal"> setBaseLayer(newBaseLayer)</code> method. This method is responsible for changing the active base layer used by the map.<a class="indexterm" id="id4"/>
</p><p>In addition to the specify properties at construction time, you can also use the setter methods<code class="literal"> setOpacity(opacity)</code> and<code class="literal"> setIsBaseLayer(isBaseLayer)</code> to change the values at runtime.<a class="indexterm" id="id5"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec15"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Avoiding the need of a base layer</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Managing map's stack layers</em> recipe</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec05"/>Avoiding the need of a base layer</h1></div></div></div><p>There can be situations where you don't want a base layer and only want a bunch of layers to work on.</p><p>Imagine an online GIS editor where users can add and remove layers but they are not obligated to have an always visible one.<a class="indexterm" id="id6"/>
</p><p>This recipe shows how we can easily avoid the requirement of setting a base layer within the map.</p><div><img alt="Avoiding the need of a base layer" src="img/7843_01_04.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">As always, create a DOM element to render the map:<div><pre class="programlisting">&lt;div id="ch1_avoid_baselayer" style="width: 100%; 
height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Now create a new<code class="literal"> OpenLayers.Map</code> instance and set the<code class="literal"> allOverlays</code> property to<code class="literal"> true:</code><div><pre class="programlisting">// Create the map using the specified DOM element 
var map = new OpenLayers.Map("ch1_avoid_baselayer", { 
    allOverlays: true 
});
</pre></div></li><li class="listitem">Add two layers to see a result. Also add the layer switcher control:<a class="indexterm" id="id7"/><div><pre class="programlisting">// Add a WMS layer 
var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
map.addLayer(wms); 
// Add a WMS layer 
var topo = new OpenLayers.Layer.WMS("USA Topo Maps", "http://terraservice.net/ogcmap.ashx", 
{ 
    layers: "DRG" 
},
{ 
    opacity: 0.5 
}); 
map.addLayer(topo); 
// Add LayerSwitcher control 
map.addControl(new OpenLayers.Control.LayerSwitcher()); 
</pre></div></li><li class="listitem">Center the map view to some nice place:<div><pre class="programlisting">// Set view to zoom maximum map extent 
// NOTE: This will fail if there is no base layer defined 
map.setCenter(new OpenLayers.LonLat(-100, 40), 5);
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec17"/>How it works...</h3></div></div></div><p>When the map's property<code class="literal"> allOverlays</code> is set to<code class="literal"> true</code>, the map ignores the<code class="literal"> isBaseLayer</code> property of the layers.<a class="indexterm" id="id8"/>
</p><p>If you expand the layer switcher control, you will see that it contains two overlay layers, no base layer, which you can show or hide and, if desired, leave a blank map without layers.</p><p>In addition, in this recipe we have used the<code class="literal"> map.setCenter()</code> method, which needs a position, an<code class="literal"> OpenLayers.LonLat</code> instance, and a zoom level to work.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec18"/>There's more...</h3></div></div></div><p>When working in the<code class="literal"> allOverlays</code> mode, the lowest layer will act as base layer, although all the layers will be flagged as<code class="literal"> isBaseLayer</code> is set to<code class="literal"> false.</code>
<a class="indexterm" id="id9"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec19"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding base and non-base layers</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Moving around the map view</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Restricting the map extent</em> recipe</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec06"/>Playing with the map's options</h1></div></div></div><p>When you create a map to visualize data, there are some important things you need to take into account: projection to use, available zoom levels, the default tile size to be used by the layer requests, and so on.</p><p>Most of these important things are enclosed in the so-called map properties and, if you work in the<code class="literal"> allOverlays</code> mode, you need to take them specially into account.</p><p>This recipe shows you how to set some of the most common map properties.<a class="indexterm" id="id10"/>
</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec20"/>Getting ready</h2></div></div></div><p>Before you continue, it is important to note that instances of the<code class="literal"> OpenLayers.Map</code> class can be created in three ways:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Indicating the identifier of the DOM element where the map will be rendered:<div><pre class="programlisting">var map = new OpenLayers.Map("map_id");
</pre></div></li><li class="listitem" style="list-style-type: disc">Indicating the identifier of the DOM element and also indicating a set of options:<div><pre class="programlisting">var map = new OpenLayers.Map("map_id", {some_options_here});
</pre></div></li><li class="listitem" style="list-style-type: disc">Only indicating a set of options. This way we can later set the DOM element where the map will be rendered:<div><pre class="programlisting">var map = new OpenLayers.Map({some_options_here});
</pre></div></li></ul></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec21"/>How to do it...</h3></div></div></div><p>Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a DOM element to render the map:<div><pre class="programlisting">&lt;div id="ch1_map_options" style="width: 100%; 
height: 100%;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Define some map options:<div><pre class="programlisting">var options = { 
    div: "ch1_map_options", 
    projection: "EPSG:4326", 
    units: "dd", 
    displayProjection: new OpenLayers.Projection("EPSG:900913"),
    numZoomLevels: 7
};
</pre></div></li><li class="listitem">Create the map by passing<code class="literal"> options:</code><div><pre class="programlisting">var map = new OpenLayers.Map(options);
</pre></div></li><li class="listitem">Add the<code class="literal"> MousePosition</code> control to see the mouse position over the map:<div><pre class="programlisting">map.addControl(new OpenLayers.Control.MousePosition());
</pre></div></li><li class="listitem">Add a WMS layer and set the map view on some desired place:<a class="indexterm" id="id11"/><div><pre class="programlisting">var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{ 
    layers: 'basic' 
}); 
map.addLayer(wms); 
map.setCenter(new OpenLayers.LonLat(-100, 40), 5);
</pre></div></li></ol></div><div><div><div><div><h4 class="title"><a id="ch01lvl2sec22"/>How it works...</h4></div></div></div><p>In this case we have used five map options to initialize our<code class="literal"> OpenLayers.Map</code> instance.<a class="indexterm" id="id12"/>
</p><p>We have used the<code class="literal"> div</code> option to pass the identifier of the DOM element where the map will be rendered:<code class="literal"> div: "ch1_map_options"</code>.</p><div><h3 class="title"><a id="note06"/>Note</h3><p>The<code class="literal"> OpenLayers.Map</code> class uses some default values for most of its options:<code class="literal"> projection="EPSG:4326", units="degrees"</code>, and so on.</p></div><p>The<code class="literal"> projection</code> option is used to set the projection used by the map to render data from layers:<code class="literal"> projection: "EPSG:4326"</code>. Take into account it must be a string with the projection code. On other classes or options it can also be an<code class="literal"> OpenLayers.Projection</code> instance.</p><p>There are some implications with the map's projection. Firstly, the tiles to fill WMS layers will be requested using the map's projection, if no other projection is explicitly used by the layer. So you need to be sure the WMS server accepts the projection. Secondly, data from vector layers will be translated from the specific projection of every vector layer to the map's projection, so you will need to set the vector layer's projection options while creating them.<a class="indexterm" id="id13"/>
</p><div><h3 class="title"><a id="note07"/>Note</h3><p>For translations other than<code class="literal"> EPSG:4326</code> and<code class="literal"> EPSG:900913</code>, you need to include the<code class="literal"> Proj4js</code> project (<a class="ulink" href="http://proj4js.org">http://proj4js.org</a>) in your web application.</p><p>Teaching map projections is beyond the scope of this book. A great description can be found on Wikipedia (<a class="ulink" href="http://en.wikipedia.org/wiki/Map_projection">http://en.wikipedia.org/wiki/Map_projection</a>).</p><p>EPSG codes are a way to name and classify the set of available projections. The site Spatial Reference (<a class="ulink" href="http://spatialreference.org">http://spatialreference.org</a>) is a great place to find more information about them.</p></div><p>The<code class="literal"> units</code> option specifies that the units used by the map are decimal degrees:<code class="literal"> units: "dd"</code>. This option is related to some resolution options.</p><p>The<code class="literal"> displayProjection</code> option allows us to specify the projection that must be used to show the mouse position:<code class="literal"> displayProjection: new OpenLayers.Projection("EPSG:900913")</code>. In this case, our map is in the<code class="literal"> EPSG:4326</code> projection, also known as<code class="literal"> WGS84</code>, with degree units but we show mouse position in<code class="literal"> EPSG:900913</code>, also known as<strong> Spherical Mercator</strong>, which is in meter unit coordinates.</p><p>Finally, the<code class="literal"> numZoomLevels</code> sets the number of available zoom levels the user can change. A value of<code class="literal"> 7</code> means the user can go from<em> zoom level 0</em> to<em> zoom level 6</em>.</p></div><div><div><div><div><h4 class="title"><a id="ch01lvl2sec23"/>There's more...</h4></div></div></div><p>Imagery from sources such as Google Maps or OpenStreetMap are special cases where the pyramid of images is previously created with the Spherical Mercator projection - EPSG:900913. This means you can't set the projection when requesting tiles because it is implicit.</p><p>If you put a layer in a different projection other than the one used by the map, it will be automatically disabled.</p></div><div><div><div><div><h4 class="title"><a id="ch01lvl2sec24"/>See also</h4></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Understanding base and non-base layers</em>, recipe</li><li class="listitem" style="list-style-type: disc">The<em> Managing map's stack layers</em>, recipe</li><li class="listitem" style="list-style-type: disc">The<em> Managing map's controls</em>, recipe</li><li class="listitem" style="list-style-type: disc">The<em> Working with projections</em>, recipe in<a class="link" href="ch08.html" title="Chapter 8. Beyond the Basics"> Chapter 8</a>, <em>Beyond the Basics.</em></li></ul></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec07"/>Managing map's stack layers</h1></div></div></div><p>Map is the core concept in OpenLayers. It allows us to visualize information from different kinds of layers and brings us methods to manage layers attached to it.</p><p>In this recipe, we will learn how to control layers. This is important because add, remove, or reorder layers are very common operations we need to do on almost every web mapping application.<a class="indexterm" id="id14"/>
</p><div><img alt="Managing map's stack layers" src="img/7843_01_05.jpg"/></div><p>The application will show a map on the left and a control panel on the right, with some buttons to control the layers.</p><div><h3 class="title"><a id="note08"/>Note</h3><p>Remember we have used the Dojo toolkit framework (<a class="ulink" href="http://dojotoolkit.org">http://dojotoolkit.org</a>) to code a nicer and richer application to show the recipes of this book.</p><p>Because of this, you can see strange attributes in the HTML elements such as<code class="literal"> dojoType="dijit.form.Button"</code> or<code class="literal"> onClick="topLayer"</code>. Do not worry about it, there is no impact in the OpenLayers code we are covering in this book.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec25"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Start by creating an<code class="literal"> index.html</code> file to put the code needed to create the application layout. We place it within a table. On the left we put the map:<a class="indexterm" id="id15"/><div><pre class="programlisting">&lt;table class="tm"&gt; 
    &lt;tr&gt; 
        &lt;td class="left"&gt; 
            &lt;div id="ch1_managing_layers" 
                style="width: 100%; height: 500px;"&gt;
            &lt;/div&gt; 
        &lt;/td&gt; 
</pre></div></li><li class="listitem">And, on the right we put the controls:<div><pre class="programlisting">        &lt;td class="right"&gt; 
            &lt;p&gt;Maximize the layer switcher control to see 
                the map layers and move it clicking the 
                buttons:&lt;/p&gt; 

            &lt;table class="tb"&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Select layer:&lt;/td&gt; 
                    &lt;td&gt; 
                        &lt;select id="layerSelection" 
                            data-dojo-type=
                            "dijit.form.Select"&gt; 
                            &lt;option value="JPL"&gt;
                                JPL&lt;/option&gt; 
                            &lt;option value="WorldMap"&gt;
                                WorldMap&lt;/option&gt; 
                            &lt;option value="Canada"&gt;
                                Canada&lt;/option&gt; 
                        &lt;/select&gt; 
                    &lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Move to top:&lt;/td&gt; 
                    &lt;td&gt;&lt;button dojoType=
                        "dijit.form.Button" onClick=
                        "topLayer"&gt;Top&lt;/button&gt;&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Move up:&lt;/td&gt; 
                    &lt;td&gt;&lt;button dojoType=
                         "dijit.form.Button" onClick=
                         "raiseLayer"&gt;Up&lt;/button&gt;&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Move down:&lt;/td&gt; 
                    &lt;td&gt;&lt;button dojoType=
                        "dijit.form.Button" onClick=
                        "lowerLayer"&gt;Down&lt;/button&gt;&lt;/td&gt; 
                &lt;/tr&gt; 
                &lt;tr&gt; 
                    &lt;td&gt;Move to bottom:&lt;/td&gt; 
                    &lt;td&gt;&lt;button dojoType=
                        "dijit.form.Button" onClick=
                        "bottomLayer"&gt;Bottom&lt;/button&gt;
                    &lt;/td&gt; 
                &lt;/tr&gt; 
            &lt;/table&gt; 

        &lt;/td&gt; 
    &lt;/tr&gt; 
&lt;/table&gt;
</pre></div></li><li class="listitem">Create an<code class="literal"> OpenLayers.Map</code> instance working in the<code class="literal"> allOverlays</code> mode:<div><pre class="programlisting">var map = new OpenLayers.Map("ch1_managing_layers", {
    allOverlays: true
});
</pre></div></li><li class="listitem">Add some layers to the map:<div><pre class="programlisting">var jpl = new OpenLayers.Layer.WMS("JPL", 
    [
    "http://t1.hypercube.telascience.org/tiles?",
    "http://t2.hypercube.telascience.org/tiles?",
    "http://t3.hypercube.telascience.org/tiles?",
    "http://t4.hypercube.telascience.org/tiles?"
    ], 
    {
        layers: 'landsat7'
    });
var worldmap = new OpenLayers.Layer.WMS("WorldMap", 
    "http://vmap0.tiles.osgeo.org/wms/vmap0", 
{
    layers: 'basic', 
    format: 'image/png' 
},
{
    opacity: 0.5
});
var canada = new OpenLayers.Layer.WMS("Canada", 
    "http://www2.dmsolutions.ca/cgi-bin/mswms_gmap",
{
    layers: "bathymetry,land_fn,park",
    transparent: "true", 
    format: "image/png" 
},
{
    opacity: 0.5
});
map.addLayers([jpl, worldmap, canada]);
</pre></div></li><li class="listitem">Add a layers switcher control (to show the layers) and center the map view:<div><pre class="programlisting">map.addControl(new OpenLayers.Control.LayerSwitcher({
    ascending: false
}));
map.setCenter(new OpenLayers.LonLat(-100, 40), 4);
</pre></div></li><li class="listitem">Finally, add the JavaScript code that will react when the previous four buttons were clicked:<div><pre class="programlisting">function raiseLayer() {
    var layerName = 
        dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    map.raiseLayer(layer, 1);
}
function lowerLayer() {
    var layerName = 
        dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    map.raiseLayer(layer, -1);
}
function topLayer() {
    var layerName = 
        dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    var lastIndex = map.getNumLayers()-1;
    map.setLayerIndex(layer, lastIndex);
}
function bottomLayer() {
    var layerName = 
        dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    map.setLayerIndex(layer, 0);
}
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec26"/>How it works...</h3></div></div></div><p>There is not much to say about the HTML code for the layout. We have used a table to put the map on the left and the set of buttons on the right. In addition, we have associated actions to the buttons that will be executed when they are clicked.<a class="indexterm" id="id18"/>
</p><p>With respect to the OpenLayers code, we have created the map instance working in the<code class="literal"> allOverlays</code> mode. This will let us move any layer without being worried about a base layer:</p><div><pre class="programlisting">var map = new OpenLayers.Map("ch1_managing_layers", {
    allOverlays: true
});
</pre></div><p>Later, we created three WMS layers and added them to the map. For some of them we have set the<code class="literal"> opacity</code> property to<code class="literal"> 50%</code> to see through them:</p><div><pre class="programlisting">map.addLayers([jpl, worldmap, canada]);
</pre></div><p>It is very important to note that we have used the same name for the option's value attribute in the HTML select element as we have used for the layer. Later, this will let us select a map's layer by its name.</p><p>Next, we have added an<code class="literal"> OpenLayers.Control.LayerSwitcher</code> control by setting its<code class="literal"> ascending</code> property to<code class="literal"> false:</code>
</p><div><pre class="programlisting">map.addControl(new OpenLayers.Control.LayerSwitcher({
    ascending: false
}));
</pre></div><p>You can think of the map as storing layers in a stack and they are rendered from bottom to top, so the above layers can hide beneath the below layers depending on its opacity and extent.</p><div><h3 class="title"><a id="tip04"/>Tip</h3><p>By default the<code class="literal"> ascending</code> property is<code class="literal"> true</code>, and the layer switcher control shows the layers of the map in the reverse order, that is, the bottom layer is drawn first in the control and the top layer is drawn last. You can avoid this by setting<code class="literal"> ascending</code> to<code class="literal"> false</code>.</p></div><p>Finally, the only thing we need to take a look at is the code responsible for button actions, which is the most interesting code in this recipe.</p><p>Let's take a look to the<code class="literal"> raiseLayer()</code> action (which is very similar to<code class="literal"> lowerLayer()</code> action):</p><div><pre class="programlisting">function raiseLayer() {
    var layerName = dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    map.raiseLayer(layer, 1);
}
</pre></div><p>First, we get the name of the currently selected layer in the select element (don't worry if you don't understand that line completely, it is more related to the Dojo framework than to OpenLayers).</p><p>Then, we use the<code class="literal"> map.getLayersByName()</code> method, which returns an array with all the layers that have the specified name. Because of this, we get the first element of the array.</p><p>Now we have a reference to the layer instance. We can raise it in the map using the<code class="literal"> map.raiseLayer()</code> method. You can raise it by one or more positions indicating a<code class="literal"> delta</code> number or, like in the<code class="literal"> lowerLayer()</code> function, you can lower it by one or more positions indicating a negative value.</p><p>Internally<code class="literal"> OpenLayers.Map</code> stores layers in an array (the<code class="literal"> layers</code> attribute) and they are rendered in the order they are stored in the array (so the first element is the bottom layer).<a class="indexterm" id="id19"/>
</p><p>The<code class="literal"> topLayer()</code> and<code class="literal"> bottomLayer()</code> actions are similar too, they move the specified layer to the top or bottom of the stack. They both work using the<code class="literal"> map.setLayerIndex()</code> method, which is responsible to move a layer to a specified position.</p><div><h3 class="title"><a id="note09"/>Note</h3><p>The method<code class="literal"> map.setLayerIndex()</code> is used internally by<code class="literal"> map.raiseLayer()</code> to move layers.</p></div><p>Because the bottom layer corresponds to the first layer in the array of layers, the<code class="literal"> bottomLayer()</code> action is the easiest to implement because we simply need to move the layer to the first position:</p><div><pre class="programlisting">function bottomLayer() {
    var layerName = dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    map.setLayerIndex(layer, 0);
}
</pre></div><p>For the<code class="literal"> topLayer()</code> actions, we need to move the layer to the last position. To do this, we can get help from the<code class="literal"> map.getNumLayers()</code> method, which returns the total number of layers in the map. In this way, if we have four layers in the map, the last corresponds to the index<code class="literal"> 3</code> (because the index value changes from<code class="literal"> 0</code> to<code class="literal"> 3)</code>.</p><div><pre class="programlisting">function topLayer() {
    var layerName = dijit.byId('layerSelection').get('value');
    var layer = map.getLayersByName(layerName)[0];
    var lastIndex = map.getNumLayers()-1;
    map.setLayerIndex(layer, lastIndex);
}
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec27"/>There's more...</h3></div></div></div><p>The<code class="literal"> OpenLayers.Map</code> class has plenty of methods to manipulate the contained layers. We have seen a few in these recipes, to add, get layers by name, move up or down in the stack, and so on. But you can find more methods to remove layers, get layers by their position, and so on.<a class="indexterm" id="id20"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec28"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Managing map's controls</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Moving around the map view</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Restricting the map extent</em> recipe</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Managing map's controls</h1></div></div></div><p>OpenLayers comes with lots of controls to interact with the map: pan, zoom, show overview map, edit features, and so on.</p><p>In the same way as layers, the<code class="literal"> OpenLayers.Map</code> class has methods to manage the controls attached to the map.</p><div><img alt="Managing map's controls" src="img/7843_01_06.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec29"/>How to do it...</h2></div></div></div><p>Follow the given steps:<a class="indexterm" id="id21"/>
</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new HTML file and add the OpenLayers dependencies.</li><li class="listitem">Now, add the required code to create the buttons and<code class="literal"> div</code> element to hold the map instance:<div><pre class="programlisting">&lt;div class="sample_menu" dojoType="dijit.MenuBar"&gt;
    &lt;span class="title"&gt;Controls: &lt;/span&gt;
    &lt;div dojoType="dijit.form.ToggleButton" 
        iconClass="dijitCheckBoxIcon" 
        onChange="updateMousePosition"&gt;MousePosition
    &lt;/div&gt;
    &lt;div dojoType="dijit.form.ToggleButton" 
        iconClass="dijitCheckBoxIcon" 
        onChange="updatePanPanel"&gt;PanPanel&lt;/div&gt;
    &lt;div dojoType="dijit.form.ToggleButton" 
        iconClass="dijitCheckBoxIcon" 
        onChange="updateZoomPanel"&gt;ZoomPanel&lt;/div&gt;
&lt;/div&gt;
&lt;!-- Map DOM element --&gt;
&lt;div id="ch1_managing_controls" style="width: 100%; height: 500px;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Within the<code class="literal"> script</code> element section, create the map instance:<div><pre class="programlisting">var map = new OpenLayers.Map("ch1_managing_controls", {
    controls: [
    new OpenLayers.Control.Navigation()
    ]
});
</pre></div></li><li class="listitem">Add some layers to the map and center the view:<a class="indexterm" id="id22"/><div><pre class="programlisting">var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
{
    layers: 'basic'
},
{
    wrapDateLine: false
});
map.addLayer(wms);
// Center the view
map.setCenter(OpenLayers.LonLat.fromString("0,0"),3);
</pre></div></li><li class="listitem">Finally, add the actions code associated to the buttons:<div><pre class="programlisting">function updateMousePosition(checked) {
    if(checked) {
        map.addControl(new 
            OpenLayers.Control.MousePosition());
    } else {
        var controls = 
            map.getControlsByClass
            ("OpenLayers.Control.MousePosition");
        console.log(controls);
        map.removeControl(controls[0]);
    }
}
function updatePanPanel(checked) {
    if(checked) {
        map.addControl(new 
            OpenLayers.Control.PanPanel());
    } else {
        var controls = map.getControlsByClass
            ("OpenLayers.Control.PanPanel");
        map.removeControl(controls[0]);
    }
}
function updateZoomPanel(checked) {
    if(checked) {
        // Place Zoom control at specified pixel
        map.addControl(new OpenLayers.Control.ZoomPanel()
            , new OpenLayers.Pixel(50,10));
    } else {
        var controls = map.getControlsByClass
            ("OpenLayers.Control.ZoomPanel");
        map.removeControl(controls[0]);
    }
}
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec30"/>How it works...</h3></div></div></div><p>Every button action function checks if the toggle button is checked or unchecked and depending on the value we add or remove the control to the map:<a class="indexterm" id="id24"/>
</p><div><pre class="programlisting">if(checked) {
    // Place Zoom control at specified pixel
    map.addControl(new OpenLayers.Control.ZoomPanel(), new OpenLayers.Pixel(50,10));
} else {
    var controls = map.getControlsByClass("OpenLayers.Control.ZoomPanel");
    map.removeControl(controls[0]);
}
</pre></div><p>Adding a control is fairly simple through the<code class="literal"> map.addControl()</code> method, which, given a control instance—and, optionally a<code class="literal"> OpenLayers.Pixel</code> instance—adds the control to the map at the specified position.</p><div><h3 class="title"><a id="note10"/>Note</h3><p>Usually, a control position is controlled by modifying the<code class="literal"> top</code> and<code class="literal"> left</code> values in the CSS class used by the control. If you use a<code class="literal"> OpenLayers.Pixel</code> value to position the control, then that value will overwrite the CSS ones.</p></div><p>To remove a control we need to have a reference to the instance that has to be removed. The method<code class="literal"> map.getControlsByClass()</code> returns an array of controls of the specified class and helps us to get a reference to the desired control. Next, we can remove it with<code class="literal"> map.removeControl().</code>
<a class="indexterm" id="id25"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec31"/>There's more...</h3></div></div></div><p>Note, in this recipe we have centered the map's view passing a<code class="literal"> OpenLayers.LonLat</code> instance created in a different way. Instead of using the<code class="literal"> new</code> operator, we have used the method<code class="literal"> OpenLayers.LonLat.fromString</code>, which created a new instance from a string:</p><div><pre class="programlisting">map.setCenter(OpenLayers.LonLat.fromString("0,0"),3);
</pre></div><p>In addition, the map instance created in this recipe has initialized with only one control,<code class="literal"> OpenLayers.Control.Navigation()</code>, which allows us to navigate the map using the mouse:</p><div><pre class="programlisting">var map = new OpenLayers.Map("ch1_managing_controls", {
    controls: [
    new OpenLayers.Control.Navigation()
    ]
});
</pre></div><div><h3 class="title"><a id="note11"/>Note</h3><p>Passing an empty array to the<code class="literal"> controls</code> property creates a map instance without any control associated with it. In addition, without specifying the<code class="literal"> controls</code> property, OpenLayers creates a set of default controls for the map, which includes the<code class="literal"> OpenLayers.Control.Navigation</code> and<code class="literal"> OpenLayers.Control.PanZoom</code> controls.</p></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec32"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Managing map's stack layers</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Moving around the map view</em> recipe</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Moving around the map view</h1></div></div></div><p>Unless you want to create a completely static map, without the controls required for the user to pan or zoom, you would like the user to be able to navigate and explore the map.<a class="indexterm" id="id26"/>
</p><p>There can be situations when the controls are not enough. Imagine a web application where the user can make a search, such as Everest, and the application must find its location and fly to it. In this case, you need to navigate by code and not by using a control.</p><p>This recipe shows you some of the<code class="literal"> OpenLayers.Map</code> class methods that will allow you to improve the user's experience.<a class="indexterm" id="id27"/>
</p><div><img alt="Moving around the map view" src="img/7843_01_07.jpg"/></div><p>The application layout contains three main sections. At the top there is a label to show the current map center position and zoom level. It is automatically updated when the map is moved or the zoom is changed.</p><p>The map is in the center and there are a bunch of controls on the right to set and test the main map methods to interact with the view.</p><p>As you will see, the map has no control attached to it, so the only way to interact with it is through the right controls.</p><div><h3 class="title"><a id="note12"/>Note</h3><p>We omit the HTML code necessary to create the application layout, so if you are interested in the HTML code you can take a look at the source code available on the Packt Publishing website.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec33"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create an HTML file with OpenLayers dependencies.<a class="indexterm" id="id28"/><div><h3 class="title"><a id="note13"/>Note</h3><p>The HTML code to create the buttons and layout of the previous screenshot is extensive and not related to the goal of the book, so here we avoid writing it.</p></div></li><li class="listitem">Add a<code class="literal"> div</code> element to hold the map instance:<div><pre class="programlisting">&lt;div id="ch1_moving_around" style="width: 100%; 
    height: 500px;"&gt;&lt;/div&gt;
</pre></div></li><li class="listitem">Create a map instance. This time we specify a listener for some events that will update the center and zoom values of the label on top of the map:<div><pre class="programlisting">var map = new OpenLayers.Map("ch1_moving_around", {
    controls: [],
    eventListeners: {
        "move": changeListener,
        "moveend": changeListener,
        "zoomend": changeListener
    }
});
function changeListener() {
    var center = map.getCenter();
    document.getElementById("center").innerHTML = 
        "("+center.lon + " lon , " + center.lat + 
        " lat)";
    var zoom = map.getZoom();
    document.getElementById("zoom").innerHTML = zoom + 
    " level";
}
</pre></div></li><li class="listitem">Add one layer and center the view:<div><pre class="programlisting">var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
{
    layers: 'basic'
});
map.addLayer(wms);
map.setCenter(new OpenLayers.LonLat(0, 0), 2);
</pre></div></li><li class="listitem">Insert the code that will be executed by the button actions:<div><pre class="programlisting">function moveByPx() {
    var x = dijit.byId('movebyxpix').get('value');
    var y = dijit.byId('movebyypix').get('value');
        
    map.moveByPx(x,y);
}
function moveTo() {
    var lon = dijit.byId('movetolon').get('value');
    var lat = dijit.byId('movetolat').get('value');
    var zoom = dijit.byId('movetozoom').get('value');
    var force = dijit.byId
        ('movetoforceZoomChange').get('checked');
    var drag = dijit.byId
        ('movetodragging').get('checked');
        
    map.moveTo(new OpenLayers.LonLat(lon, lat), zoom, {
        forceZoomChange: force,
        dragging: drag
    });
}
function setCenter() {
    var lon = dijit.byId('setCenterlon').get('value');
    var lat = dijit.byId('setCenterlat').get('value');
    var zoom = dijit.byId('setCenterzoom').get('value');
    var force = dijit.byId
        ('setCenterforceZoomChange').get('checked');
    var drag = dijit.byId
        ('setCenterdragging').get('checked');
        
    map.setCenter(new OpenLayers.LonLat(lon, lat), 
    zoom, {
        forceZoomChange: force,
        dragging: drag
    });
}
function pan() {
    var x = dijit.byId('panxpix').get('value');
    var y = dijit.byId('panypix').get('value');
    var anim = dijit.byId('pananimate').get('checked');
    var drag = dijit.byId('pandragging').get('checked');
        
    map.pan(x,y, {
        animate: anim,
        dragging: drag
    });
}
function panTo() {
    var lon = dijit.byId('panTolon').get('value');
    var lat = dijit.byId('panTolat').get('value');
        
    map.panTo(new OpenLayers.LonLat(lon, lat));
}
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec34"/>How it works...</h3></div></div></div><p>To update the center and zoom level values at the top, we have instantiated the<code class="literal"> Map</code> object with some event listeners attached to it. Actually, the same listener function is attached to all three events:<a class="indexterm" id="id30"/>
</p><div><pre class="programlisting">var map = new OpenLayers.Map("ch1_moving_around", {
    controls: [],
    eventListeners: {
        "move": changeListener,
        "moveend": changeListener,
        "zoomend": changeListener
    }
});
</pre></div><p>Within the<code class="literal"> changeListener()</code> function we use<code class="literal"> map.getCenter()</code>, which returns an<code class="literal"> OpenLayers.LonLat</code> object, and<code class="literal"> map.getZoom()</code> to get the current values and update the top-left label.</p><div><pre class="programlisting">function changeListener() {
    var center = map.getCenter();
    document.getElementById("center").innerHTML = 
        "("+center.lon + " lon , " + center.lat + " lat)";
    var zoom = map.getZoom();
    document.getElementById("zoom").innerHTML = zoom + " level";
}
</pre></div><p>For every button, an action is executed. They are responsible to get the required values and invoke a<code class="literal"> map</code> method.</p><p>The<code class="literal"> map.moveByPx()</code> method moves the map by a delta value specified in pixels. Note, it moves the map; it doesn't pan, so don't expect any effect.</p><div><pre class="programlisting">function moveByPx() {
    var x = dijit.byId('movebyxpix').get('value');
    var y = dijit.byId('movebyypix').get('value');
        
    map.moveByPx(x,y);
}
</pre></div><p>The<code class="literal"> map.moveTo()</code> method is similar to the previous one but moves the view to a specified position (instead of an increment) and is specified with an<code class="literal"> OpenLayers.LonLat</code> instance.</p><p>The<code class="literal"> map.setCenter()</code> method is similar to<code class="literal"> map.moveTo()</code> but it centers the view on the specified location.</p><p>Finally, there are two pan-related actions, which make nice smooth movements. The<code class="literal"> map.pan()</code> method moves the view with a pan effect specified by a pixel delta. The<code class="literal"> map.panTo()</code> method does something similar, it moves the view to a specified location.<a class="indexterm" id="id31"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec35"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Managing map's stack layers</em> recipe</li><li class="listitem" style="list-style-type: disc">The<em> Restricting the map extent</em> recipe</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Restricting the map extent</h1></div></div></div><p>Often, there are situations where you are interested to show data to the user but only for a specific area, which your available data corresponds to (a country, a region, a city, and so on).<a class="indexterm" id="id32"/>
</p><p>In this case, there is no point in allowing the user to explore the whole world, so you need to limit the extent the user can navigate.</p><p>In this recipe, we present some ways to limit the area a user can explore.</p><div><img alt="Restricting the map extent" src="img/7843_01_08.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec36"/>How to do it...</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create a map instance. Take a look at the couple of properties used in the constructor:<div><pre class="programlisting">var map = new OpenLayers.Map("ch1_restricting_view", {
    maxExtent: OpenLayers.Bounds.fromString
        ("-180,-90,180,90"),
    restrictedExtent: OpenLayers.Bounds.fromString
        ("-180,-90,180,90")
});
<a class="indexterm" id="id33"/>
</pre></div></li><li class="listitem">As always, add some layer to see content and center the view:<div><pre class="programlisting">var wms = new OpenLayers.Layer.WMS("OpenLayers WMS Basic", "http://vmap0.tiles.osgeo.org/wms/vmap0",
{
    layers: 'basic'
});
map.addLayer(wms);
map.setCenter(new OpenLayers.LonLat(0, 0), 2);
</pre></div></li><li class="listitem">Add the functions that will be executed when buttons are clicked:<div><pre class="programlisting">function updateMaxExtent() {
    var left = dijit.byId('left_me').get('value');
    var bottom = dijit.byId('bottom_me').get('value');
    var right = dijit.byId('rigth_me').get('value');
    var top = dijit.byId('top_me').get('value');      
    map.setOptions({
        maxExtent: new OpenLayers.Bounds(left, bottom, 
        right, top)
    });
}
function updateRestrictedExtent() {
    var left = dijit.byId('left_re').get('value');
    var bottom = dijit.byId('bottom_re').get('value');
    var right = dijit.byId('rigth_re').get('value');
    var top = dijit.byId('top_re').get('value');
    map.setOptions({
        restrictedExtent: new OpenLayers.Bounds(left, 
        bottom, right, top)
    });
}
</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec37"/>How it works...</h3></div></div></div><p>As you have seen, the map has been instantiated using the two properties<code class="literal"> maxExtent</code> and<code class="literal"> restrictedExtent</code>, which are responsible for limiting the area of the map we can explore.<a class="indexterm" id="id34"/>
</p><p>Although similar, these two properties have different meanings. Setting the<code class="literal"> maxExtent</code> property limits the viewport so its center cannot go outside the specified bounds. By setting the<code class="literal"> restrictedExtent</code> property the map itself cannot be panned beyond the given bounds.<a class="indexterm" id="id35"/>
</p><p>The functions that react when buttons are clicked get the values from the input fields and apply the new values through the<code class="literal"> map.setOptions()</code> method:</p><div><pre class="programlisting">map.setOptions({
    maxExtent: new OpenLayers.Bounds(left, bottom, right, top)
});
</pre></div><p>We can pass the same properties we use when creating a new<code class="literal"> OpenLayers.Map</code> instance to the<code class="literal"> map.setOptions()</code> method and it will take care to update them.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec38"/>There's more...</h3></div></div></div><p>Limiting the map extent is not the only way to limit the information we show to the user. The layers have also similar properties to filter or limit the information they must render.</p></div><div><div><div><div><h3 class="title"><a id="ch01lvl2sec39"/>See also</h3></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The<em> Moving around the map view</em> recipe</li></ul></div></div></div></div></body></html>