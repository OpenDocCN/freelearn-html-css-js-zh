<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Mixing Content</h1></div></div></div><div><blockquote class="blockquote"><p>Load Times For 69% Of Responsive Design Mobile Sites Deemed "Unacceptable"…</p></blockquote></div><p>A staggering fact, but absolutely true: a survey carried out by the mobile developer company Tribilis in April 2014 found that for 155 sites surveyed, only 21 percent loaded in four seconds or less on smartphones. Moreover, those that took longer had an average page weight of 1.7 MB.</p><p>Sobering thoughts, but ones that perfectly illustrate the pitfalls of mixing videos and images on pages in responsive design! We need to strike a balance between displaying the right media content that is not too large or too small while keeping our page load times small. This chapter works through some examples and details some of the pitfalls associated with mixing content, which can lead to heavy pages and long download times.</p><p>We'll cover a number of topics in this chapter, which will include:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Mixing video and image content on the same page</li><li class="listitem" style="list-style-type: disc">Considering limitations of mixing content</li><li class="listitem" style="list-style-type: disc">Using preloaders to reduce delays</li><li class="listitem" style="list-style-type: disc">Adding lazy loading support to our pages</li><li class="listitem" style="list-style-type: disc">Making allowances for mobile devices</li></ul></div><p>Intrigued? Let's make a start!</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Mixing video and image content on the same page</h1></div></div></div><p>Throughout <a id="id164" class="indexterm"/>this book, we've seen <a id="id165" class="indexterm"/>some of the tips and tricks we need to use to make our media content responsive and worked through some examples of the styles we need to implement to make this happen.</p><p>However, it is unlikely that every responsive site will have either images or videos; it is more likely that there will be a mix of both on at least some sites! This can present its own issues, so to see what can happen, let's run through a simple demo.</p><p>From the code download, extract the <code class="literal">code</code> folder for this chapter and save it to your project folder; this contains a simple demo that shows the issues we face with mixing videos and images together in a responsive design. If we run the <code class="literal">mix-responsive.html</code> demo as it stands, it would appear to look okay from the start until we scroll down and view the video. The layout is not ideal, but there are a few changes we can make:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The banner image at the top of the browser window is too large. While this may be okay on a desktop, it will choke smartphones; it needs to be resized.</li><li class="listitem" style="list-style-type: disc">The embedded video isn't respecting the boundaries of its container, with the result that it is spilling out over the whole page, making the text difficult to view.</li><li class="listitem" style="list-style-type: disc">We can improve on the use of the banner. Once we've changed it to a thinner design, we can then add a media query to switch in a smaller version of this thinner design.</li></ul></div><p>Fortunately, these <a id="id166" class="indexterm"/>are easy fixes to <a id="id167" class="indexterm"/>make. Let's see what is involved:</p><div><ol class="orderedlist arabic"><li class="listitem">Save a copy of <code class="literal">mix-responsive.html</code> and <code class="literal">mix-responsive.css</code> as <code class="literal">mix-responsiveV2.html</code> and <code class="literal">mix-responsiveV2.css</code> respectively (in the same folder). Don't forget to change the link to the CSS file from within our HTML markup to point to the new file!</li><li class="listitem">Look for the <code class="literal">banner</code> div on or around line 28 and remove the <code class="literal">&lt;img&gt;</code> tags, so the HTML markup is as shown in the following line of code:<div><pre class="programlisting">&lt;div id="banner"&gt;&lt;/div&gt;</pre></div></li><li class="listitem">Further down, look for <code class="literal">&lt;video controls&gt;</code> on or around line 34; we need to encompass it within a wrapper <code class="literal">&lt;div&gt;</code>:<div><pre class="programlisting">
<strong>&lt;div id="video-wrapper"&gt;</strong>
  &lt;video controls&gt;
    &lt;source src="img/bigbuckbunny-480px.mp4" type="video/mp4"&gt;
    &lt;source src="img/bigbuckbunny-480px.webm" type="video/webm"&gt;
  &lt;/video&gt;
<strong>&lt;/div&gt;</strong>
</pre></div></li><li class="listitem">Open up <code class="literal">mix-responsiveV2.css</code> and add the following styles:<div><pre class="programlisting">#video-wrapper video { max-width: 100%; }
#banner { background-image: url('../img/abstract-banner-large.jpg'); height: 15.31rem; width: 45.5rem; max-width: 100%; } 

@media screen and (max-width: 30rem) {
  #banner { margin-top: 150px; background-image: url('../img/abstract-banner-medium.jpg'); height: 4.85rem; width: 45.5rem; max-width: 100%; }
}</pre></div></li><li class="listitem">Save the files. If <a id="id168" class="indexterm"/>we preview the results of our work in a browser, we can see a significant <a id="id169" class="indexterm"/>improvement in the appearance of our page.<div><img src="img/6968OT_03_01.jpg" alt="Mixing video and image content on the same page"/></div></li></ol></div><p>Try resizing the page now; you should see that the video and image elements will resize perfectly, without any spillage. In a nutshell, our changes have been very simple. We've added a container to the video to which we've added the <code class="literal">max-width</code> style attribute and set this to <code class="literal">100%</code>. We then switched out the bulky banner to a thinner version, setting this to retain the full width of its container when resized. It is switched to a smaller version once we go below a screen width of <code class="literal">30rem</code>.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>There is a completed version of our demo with the fixes in place. In the code download, look for and extract <code class="literal">mix-responsiveV2-finished.html</code> and <code class="literal">mix-responsiveV2-finished.css</code>. Save both to the same places as the original files to view the results.</p></div></div><p>Before we move on and take a look at how we can make allowances for mobile devices when mixing content, I want to cover off a couple of tips that might help give you a little inspiration:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We've embedded the <a id="id170" class="indexterm"/>video directly in the page. It works perfectly well, but if we wanted to give it a little extra sparkle, we <a id="id171" class="indexterm"/>could consider using an overlay. There are plenty available, but one good (responsive) example is FrescoJS, available at <a class="ulink" href="http://www.frescojs.com/">http://www.frescojs.com/</a>.</li><li class="listitem" style="list-style-type: disc">There may be a need to resort to jQuery to provide the responsive functionality <a id="id172" class="indexterm"/>for an element if CSS3 is not supported. Older browsers such as IE8 or below might fall into this category. We <a id="id173" class="indexterm"/>can do this using something such as Embedly jQuery, available at <a class="ulink" href="http://embedly.github.io/embedly-jquery/">http://embedly.github.io/embedly-jquery/</a>.<div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>There is a tutorial available on how to configure Embedly jQuery at <a class="ulink" href="http://embed.ly/docs/tutorials/responsive">http://embed.ly/docs/tutorials/responsive</a>.</p></div></div></li><li class="listitem" style="list-style-type: disc">If you need to <a id="id174" class="indexterm"/>add responsive code for third-party embedded videos (such as YouTube), you can use the service at <a class="ulink" href="http://embedresponsively.com/">http://embedresponsively.com/</a>; simply enter the URL of any video or image to embed and click on <strong>Embed</strong> to get the code.</li></ul></div><p>Okay! On we go! We've talked a lot about mixing content, but as we've seen from the demo, there are some aspects <a id="id175" class="indexterm"/>where there is room for improvement. The alterations we've made in our demo are just some of the <a id="id176" class="indexterm"/>pointers we can use to remove some of the pitfalls of mixing content, so let's take a look at a few in more detail.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Considering the pitfalls of mixing content</h1></div></div></div><p>Responsive <a id="id177" class="indexterm"/>design has become hugely popular over the last few years, with visitors browsing content on the Internet using a variety of devices. This increases the pressure on developers to ensure that their sites work well on a range of different devices and platforms. A recent study by eMarketeer illustrates that four out of every five people will access content via a mobile device and that this figure is projected to increase over the next three years.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Region</p>
</th><th style="text-align: left" valign="bottom">
<p>2014</p>
</th><th style="text-align: left" valign="bottom">
<p>2015</p>
</th><th style="text-align: left" valign="bottom">
<p>2016</p>
</th><th style="text-align: left" valign="bottom">
<p>2017</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Middle East and Africa</p>
</td><td style="text-align: left" valign="top">
<p>94.0</p>
</td><td style="text-align: left" valign="top">
<p>94.0</p>
</td><td style="text-align: left" valign="top">
<p>95.0</p>
</td><td style="text-align: left" valign="top">
<p>96.0</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Asia Pacific</p>
</td><td style="text-align: left" valign="top">
<p>87.4</p>
</td><td style="text-align: left" valign="top">
<p>90.0</p>
</td><td style="text-align: left" valign="top">
<p>92.6</p>
</td><td style="text-align: left" valign="top">
<p>93.9</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Central and Eastern Europe</p>
</td><td style="text-align: left" valign="top">
<p>72.4</p>
</td><td style="text-align: left" valign="top">
<p>80.6</p>
</td><td style="text-align: left" valign="top">
<p>86.6</p>
</td><td style="text-align: left" valign="top">
<p>91.7</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>North America</p>
</td><td style="text-align: left" valign="top">
<p>64.3</p>
</td><td style="text-align: left" valign="top">
<p>69.8</p>
</td><td style="text-align: left" valign="top">
<p>74.4</p>
</td><td style="text-align: left" valign="top">
<p>79.2</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Western Europe</p>
</td><td style="text-align: left" valign="top">
<p>67.8</p>
</td><td style="text-align: left" valign="top">
<p>78.2</p>
</td><td style="text-align: left" valign="top">
<p>85.0</p>
</td><td style="text-align: left" valign="top">
<p>90.6</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Latin America</p>
</td><td style="text-align: left" valign="top">
<p>58.5</p>
</td><td style="text-align: left" valign="top">
<p>65.0</p>
</td><td style="text-align: left" valign="top">
<p>70.1</p>
</td><td style="text-align: left" valign="top">
<p>75.2</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Worldwide</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>
<strong>79.1</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>
<strong>83.6</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>
<strong>87.3</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>
<strong>90.1</strong>
</p>
</td></tr></tbody></table></div><p>The figures in the preceding table are percentage values taken from eMarketeer in December 2013.</p><p>So that we don't fall into the trap of producing a responsive site that offers a poor experience, let's take a look at some of the pitfalls we need to consider when mixing media sources in responsive design:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The size and number of images on a page will directly affect how quickly your visitors can view the page. To reduce the impact, we can use several techniques:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Image compression is the first simple technique widely used. For a perfect example of the need to compress images, an article by Tribilis makes <a id="id178" class="indexterm"/>for interesting reading, available at <a class="ulink" href="http://blog.trilibis.com/trilibis-web-performance-survey-finds-69-percent-of-responsive-design-websites-fail-to-deliver-acceptable-load-times-on-mobile-devices-02759">http://blog.trilibis.com/trilibis-web-performance-survey-finds-69-percent-of-responsive-design-websites-fail-to-deliver-acceptable-load-times-on-mobile-devices-02759</a>. It shows some significant gains when images are compressed!</li><li class="listitem" style="list-style-type: disc">The next important technique is the conversion of small images into data URIs or as part of an image sprite.</li><li class="listitem" style="list-style-type: disc">Another technique is the use of lazy loading to only show those images that are visible within the viewport.</li></ul></div></li><li class="listitem" style="list-style-type: disc">We need to be aware of the breakpoints in our design and alter our media queries to suit. What may have worked well for images may not work equally as well for videos, particularly if they are of different sizes.</li><li class="listitem" style="list-style-type: disc">Scaling smaller images to a larger size will result in the loss of quality; it is recommended to start with large size images and dynamically resize them for smaller devices. Once we get to a particular breakpoint, then we can switch to using a smaller image by default to avoid images becoming illegible if they have not been sized for a particular breakpoint / viewport width.</li><li class="listitem" style="list-style-type: disc">Scaling images <a id="id179" class="indexterm"/>can cause issues when they are reduced to a very small size. The dimensions are likely to mean that we can't view the image properly, its meaning will be lost, the file size won't be any smaller, and it may be better to simply not display it instead.</li><li class="listitem" style="list-style-type: disc">Consider converting vector images to the SVG format. Conversion to standard image formats such as JPG, GIF, or PNG will likely lead to the same loss of quality as scaling small images to a larger size. SVG images scale well without any loss of quality.</li><li class="listitem" style="list-style-type: disc">If your site uses video, then one pitfall that can trip you up is the format used. Although we only need to encode for MP4 or WebM support, not every device will use both. A careful analysis of web metrics should help us understand which operating systems are used to access the site and therefore help determine which format of video to use.<div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>For an up-to-date <a id="id180" class="indexterm"/>check on format support, take a look at the articles available at <a class="ulink" href="http://www.jwplayer.com/html5">http://www.jwplayer.com/html5</a>.</p></div></div></li><li class="listitem" style="list-style-type: disc">Do you use images for small elements such as buttons? If so, consider converting them to CSS3 equivalents, at least for the browsers that can support them. It will mean a reduction in requests to the server (we're not calling the images) and the CSS style sheet would have been cached by the browser, so <a id="id181" class="indexterm"/>the response will be quicker. There are plenty of examples available online; you can try Chris Coyier's Button creator at <a class="ulink" href="http://css-tricks.com/examples/ButtonMaker/">http://css-tricks.com/examples/ButtonMaker/</a> or CSS Shape Generator at <a class="ulink" href="http://html-generator.weebly.com/css-shape-generator.html">http://html-generator.weebly.com/css-shape-generator.html</a>.</li><li class="listitem" style="list-style-type: disc">Specifying only the width of images may cause a doubling or tripling of the cycles that many browsers must process to layout the new resized page. While each of these cycles typically take less than a millisecond, they stack up, especially if there are multiple scalable elements on the page. Addressing the height in the same declaration can reduce this issue:<div><pre class="programlisting">img, video { max-width: 100%; height: auto; }</pre></div></li><li class="listitem" style="list-style-type: disc">If your site needs to display videos in 4:3 or 16:9 ratio format, then these may not resize properly. We can get around this using a wrapper in HTML that is styled to the <a id="id182" class="indexterm"/>proper dimensions, then stretch the video to fit the following container:<div><pre class="programlisting">&lt;div class="wrapper-with-intrinsic-ratio"&gt;
   &lt;div class="element-to-stretch"&gt;&lt;/div&gt;
&lt;/div&gt;</pre></div><p>The CSS styling would look something like this:</p><div><pre class="programlisting">.wrapper-with-intrinsic-ration {
  position: relative; height: 0;
  padding-top: 25px; /* to allow for the player chrome */
  padding-bottom: 56.25%  /* 9:16 = 0.5625 */
}

.element-to-stretch { position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; background: teal; }</pre></div></li></ul></div><p>Phew! There are certainly plenty of places where we can be tripped up if we're not careful! Let's move on and take a look at a couple of tricks we can use to help manage media content in our pages, beginning with a look at preloading images.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Using preloaders to reduce delays</h1></div></div></div><p>Preloading <a id="id183" class="indexterm"/>content is not a new concept in the world of web design. The idea is to reduce the amount of time it takes to view the page in a browser, as some (or all) of the content has been fetched ahead of viewing the page and cached in the browser.</p><p>There are plenty of <a id="id184" class="indexterm"/>examples available using JavaScript (such as PreloadJS at <a class="ulink" href="http://www.createjs.com/#!/PreloadJS">http://www.createjs.com/#!/PreloadJS</a>). But this adds an extra overhead to our pages that we can avoid, particularly in a responsive design.</p><p>Instead, we can use CSS to achieve the same effect, provided the styles and images are called at the right time. This way, they will be ready for us when we render the images on screen.</p><div><div><h3 class="title"><a id="note20"/>Note</h3><p>For the purposes of this demo, I've simplified the code to concentrate on the preloading process only.</p></div></div><p>Let's take a look at preloading in action with a simple demo:</p><div><ol class="orderedlist arabic"><li class="listitem">From the <a id="id185" class="indexterm"/>code download that accompanies this book, extract a copy of <code class="literal">preloading.html</code> and then save it in our project folder.</li><li class="listitem">Next, extract <code class="literal">img01.png</code> to <code class="literal">img04.png</code> from the code download. The images should go into a subfolder marked <code class="literal">img</code> in our project folder.</li><li class="listitem">In a new file, add the following styles to a new CSS style sheet. Save this as <code class="literal">preloading.css</code>, in a <code class="literal">css</code> subfolder within our project folder:<div><pre class="programlisting">html { font-family: Verdana, Arial, Helvetica, sans-serif; }
body { margin: 60px auto 0; padding: 0; background-color: #606061; color: #ffffff; }
img { border: none; padding: 10px; max-width: 100%;}
p { font-size: 1em; margin: 0 0 1em 0; }
#container { position: absolute; top: 0; left: 0; background-color: #18191d; width: 100%; height: 40px; }
#container p { color: #ffffff; margin: 10px auto 0; text-align: center; width: 310px; }
#preload { margin-left: auto; margin-right: auto; width: 900px; }

body:before {
  content: url(../img/img01.png) no-repeat -9999px -9999px,
           url(../img/img02.png) no-repeat -9999px -9999px,
    url(../img/img03.png) no-repeat -9999px -9999px,
    url(../img/img04.png) no-repeat -9999px -9999px;
  display: none;
}</pre></div></li></ol></div><p>Before we preview our work, it's useful to take a quick look to see how this process works. The key to it is the class added to the body to retrieve the images before we use them later in our code:</p><div><pre class="programlisting">
<strong>&lt;body class="preload-images"&gt;</strong>
  &lt;div id="container"&gt;
...
  &lt;div id="preload"&gt;
    &lt;img src="img/img01.png" alt="Image 01" /&gt;
...</pre></div><p>If we preview the <a id="id186" class="indexterm"/>results of our work, we'll see the following four images appear:</p><div><img src="img/6968OT_03_02.jpg" alt="Using preloaders to reduce delays"/></div><p>The beauty about using this method is that we've removed the need to have to use yet another library, such as PreloadJS. Instead, we can now choose to call it if we decide to provide support for older browsers that don't support the <code class="literal">body:before</code> trick we used in our demo.</p><p>Let's change tack and look at the reverse side of this coin—lazy loading. No, this is not some form of getting up on a Sunday morning after a particularly good night out (terrible joke!), but a means to <a id="id187" class="indexterm"/>only load and display images at the point of viewing them. Intrigued? I will reveal all as part of our next exercise.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Adding lazy loading support to our pages</h1></div></div></div><p>One of the <a id="id188" class="indexterm"/>primary aims of responsive design should be the consideration of any tactic we can use to reduce the overall loading time of our pages; this is <a id="id189" class="indexterm"/>particularly true for mobile devices.</p><p>So far, you've seen how we can preload content. In some instances, this may not be ideal; instead, we can do the opposite and not load content until we are about to view it:</p><div><img src="img/6968OT_03_03.jpg" alt="Adding lazy loading support to our pages"/></div><p>This process is known <a id="id190" class="indexterm"/>as lazy loading; it effectively removes the focus of loading the images from the front (that is, on loading of the page) to the point of when we need to see the images. To <a id="id191" class="indexterm"/>illustrate the process, we're going to use the bLazy plugin by Bjørn Klinggard, available at <a class="ulink" href="http://dinbror.dk/blog/blazy/">http://dinbror.dk/blog/blazy/</a>. The great thing about this library is that it is lightweight and written in pure JavaScript, so has a zero dependency count! Oh and did I forget— it's responsive too.</p><p>Let's take a quick look at a demo (based on the original by the author), which we could easily use as a basis for something more involved within any responsive design:</p><div><ol class="orderedlist arabic"><li class="listitem">For the purposes of this demo, extract a copy of the <code class="literal">lazy loading</code> folder within the code download that accompanies this book. It contains the markup files, images, styling, and JavaScript needed for our demo.</li><li class="listitem">Run the <code class="literal">lazyloading.html</code> file. Notice how only the first few images show? If we scroll down, we can see the green loading image appear with the next image appearing after a short delay.<p>The magic in this demo centers on this code excerpt from the demo: </p><div><pre class="programlisting">  &lt;div class="wrapper ratio_big-img loading"&gt;
    &lt;img class="b-lazy" src=img/placeholder.png data-src="img/big-bear7.jpg" data-src-small="img/small-bear7.jpg" alt="Lazy load images image7" /&gt;
  &lt;/div&gt;</pre></div></li></ol></div><p>We kick off with a <a id="id192" class="indexterm"/>placeholder image. In this instance, we're using a 1 px square PNG file that could be easily converted to its data-URI equivalent with little <a id="id193" class="indexterm"/>overhead. We then use two <code class="literal">data-src</code> tags to flip between either the small or large versions of the image when the window is resized.</p><p>We can test to ensure that the pictures are indeed only being loaded when visible. In this instance, using Firefox's <strong>Developer</strong> toolbar, we can see each URL loaded when viewed in the <strong>Console</strong> tab, as indicated in the following screenshot:</p><div><img src="img/6968OT_03_04.jpg" alt="Adding lazy loading support to our pages"/></div><div><div><h3 class="title"><a id="note21"/>Note</h3><p>A small point to remember—in this instance, the preceding screenshot shows the use of a local webserver; the principle works the same whether the images are loaded from the filesystem or through a web server.</p></div></div><p>This demo is perfect as a basis to display a gallery effect on a site, particularly when viewed on a mobile device. With a bit of reconfiguration, we could even set it to display retina-based images; although that is something I will leave for you as a challenge! Let's move <a id="id194" class="indexterm"/>on and cover a key topic when designing <a id="id195" class="indexterm"/>responsively: the need to make allowances for mobile devices.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Making allowances for mobile devices</h1></div></div></div><p>Adding visual <a id="id196" class="indexterm"/>content to our pages will begin to bring the site alive, but we should bear in mind the increase in latency times. Latency is a <a id="id197" class="indexterm"/>major killer on mobile devices; if we take a 1 MB page with 80 plus requests, for example, loading the page can take over 4 seconds!</p><p>Using JavaScript is expensive in terms of resources. It takes time and can block the rendering of pages. A much better alternative is to only load the resource when it is needed. On desktops, this is less of an issue, but becomes crucial for mobile devices. Take, for example, Google's Gmail service—using this principle reduces the latency for loading JavaScript from 2600 ms to just 240 ms. With this in mind, let's take a look at some useful tips we can consider to help reduce the impact of mixing responsive images and videos on a mobile device:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If we are designing for mobile devices, it is essential to work out which platform our users are using. This will dictate what content can be displayed. One way is that we can use lazy loading (in the form of media queries) to only show images when required:<div><pre class="programlisting">// equivalent to 720px
@media all and (min-width: 45rem) {
  body:after { content: 'desktop'; display: none; }
}</pre></div><p>Another method encourages conditional loading to only load those elements and styling that are necessary:</p><div><pre class="programlisting">var size = window.getComputedStyle(document.body, ':after').getPropertyValue('content');
if (size == 'desktop') {
// load content here...
}</pre></div><div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>These methods do not require any additional libraries to be imported. This is ideal if our site is already code-heavy and we want to avoid adding more to our site. In reality though, we may look to use something like RequireJS to manage the importing of files when needed; this does come with the overhead of the RequireJS library though!</p></div></div></li><li class="listitem" style="list-style-type: disc">A good <a id="id198" class="indexterm"/>practice is to carefully consider whether all of the elements on the page are really needed for a useable <a id="id199" class="indexterm"/>mobile experience. Check those social media buttons. For example, some may be larger than you think and while they could be replaced with smaller/lighter versions, it may make better sense to not include them at all for mobile devices. Alternatively, consider loading the larger ones using conditional loading, while smaller ones can be loaded automatically. A great example of an easy replacement is to consider using the FontAwesome icons instead of images. This will help reduce the number of files that need to be loaded by the server (see the next point).</li><li class="listitem" style="list-style-type: disc">Consider <a id="id200" class="indexterm"/>using data URIs (via a generator service, such as <a class="ulink" href="http://datauri.net/">http://datauri.net/</a>) or sprites / web fonts (such as Entype or FontAwesome) in place of images. Although data URIs or sprites may not make the code smaller, they will reduce the number of requests to the server. Using web fonts can have the same effect too; we can take it even further with building a <a id="id201" class="indexterm"/>custom font using the Fontello service at <a class="ulink" href="http://www.fontello.com">http://www.fontello.com</a>).</li><li class="listitem" style="list-style-type: disc">If you are using videos on your site, consider hosting them on YouTube. This will save space and bandwidth costs to your site. In addition, there will be a consistent format, which reduces the risk of any issues where videos can't play on mobile devices.</li><li class="listitem" style="list-style-type: disc">Be careful about where you use large, high quality images—on mobile devices, your visitors will not thank you when their data usage goes through the roof! There are plenty of options available to reduce the image size. We will look at two such examples later in this chapter that use Node JS to resize and compress images automatically.<div><div><h3 class="title"><a id="note22"/>Note</h3><p>Alternatively, if you need to display images on high pixel density displays, doubling the size but increasing the compression will help reduce the file size. To see the effect in action, take a look at the tutorial available at <a class="ulink" href="http://greatfridays.com/blog/images-in-responsive-web-development/">http://greatfridays.com/blog/images-in-responsive-web-development/</a>. Can you see any difference in quality between the two images used in the PayPal demo?</p></div></div></li><li class="listitem" style="list-style-type: disc">Always set videos to show a poster image and not to automatically play for mobile devices. There are many options to produce images (including those that can be <a id="id202" class="indexterm"/>automated), so there is no excuse. We'll see one example later in this chapter, which can be easily adapted to produce an extra image to serve as the poster.</li><li class="listitem" style="list-style-type: disc">A useful tool to <a id="id203" class="indexterm"/>get to grips with is the Page Visibility or Network APIs. This appears very simple to implement, but opens up a variety of possible uses. One such use is to shut off any videos that are playing temporarily if a browser window is not being displayed; this will help reduce bandwidth costs.</li><li class="listitem" style="list-style-type: disc">If your site requires a lot of vector images, you will get better results using SVG-formatted files. These are effectively XML files that can resize with no loss of quality.</li></ul></div><p>Enough theory—let's actually try out two of these tips; we could complete them manually, but instead we can take advantage of a task runner to complete them automatically. Intrigued? I <a id="id204" class="indexterm"/>will explain all, beginning <a id="id205" class="indexterm"/>with a look at creating responsive versions of our chosen images.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec11"/>Creating responsive images automatically</h2></div></div></div><p>A key part of <a id="id206" class="indexterm"/>providing content for any website is of course images. This becomes all the more important on responsive sites where <a id="id207" class="indexterm"/>we've seen that multiple versions of the same image are needed to provide a fluid solution to our responsive needs.</p><p>We could of course create each version of the image manually, but this is the 21st century: who wants (or even has the time) to create different sizes manually? Surely there has to be a better way. You'd be right: we can automate the whole process. Let's take a look how using the Node JS task runner as the basis to automate the process.</p><div><div><h3 class="title"><a id="note23"/>Note</h3><p>This exercise is designed to run as standalone; the principles can easily be applied to a larger, more complex grunt process as you get more accustomed to using Grunt.</p></div></div><p>Let's make a start by installing Node JS:</p><div><ol class="orderedlist arabic"><li class="listitem">We'll begin <a id="id208" class="indexterm"/>by browsing to <a class="ulink" href="http://nodejs.org/download/">http://nodejs.org/download/</a> to download the latest version for your platform. It's available for Windows, Mac, and Linux platforms. Double-click on the <strong>MSI installer</strong> and run through the wizard, accepting all defaults.</li><li class="listitem">From the code download, extract the <code class="literal">responseimg</code> folder and save it on your PC.</li><li class="listitem">Bring up a Node JS command prompt, then change to the <code class="literal">responseimg</code> folder and run this command to install <code class="literal">grunt-responsive-images</code>:<div><pre class="programlisting">
<strong>npm install</strong>
</pre></div></li><li class="listitem">This will install <code class="literal">grunt-responsive-images</code>, along with the dependencies and Grunt; in this instance, we're using the <code class="literal">grunt-simple-watch</code> applet to automatically monitor our folder for any changes.</li><li class="listitem">At the <a id="id209" class="indexterm"/>command prompt, change to the <code class="literal">src</code> folder and then run the following command:<div><pre class="programlisting">
<strong>grunt autoresize</strong>
</pre></div></li><li class="listitem">This kicks off the <code class="literal">grunt-simple-watch</code> plugin to begin automatically monitoring for changes in the <code class="literal">src</code> folder. In this example, I've already dropped a single JPEG image into the <code class="literal">src</code> folder, which is also shown in the following screenshot:<div><img src="img/6968OT_03_05.jpg" alt="Creating responsive images automatically"/></div></li><li class="listitem">Any image <a id="id210" class="indexterm"/>dropped into the <code class="literal">src</code> <a id="id211" class="indexterm"/>folder will be used to create three new images, such as the example shown in the following screenshot:<div><img src="img/6968OT_03_06.jpg" alt="Creating responsive images automatically"/></div></li></ol></div><p>The automated process is now ready for use. We can drop any number of JPEG images into the <a id="id212" class="indexterm"/>folder; three new images will be produced for each new image dropped into the folder.</p><div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>We're using the default sizes for each image as specified in the plugin; these can be easily <a id="id213" class="indexterm"/>customized in the options for the plugin within our <code class="literal">gruntfile.js</code> file.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec12"/>Automating the shrinking process</h2></div></div></div><p>We can of <a id="id214" class="indexterm"/>course develop this automation further. It's definitely worth reading up on the capabilities of Node and checking out some of the wide range of plugins that have been created to help automate otherwise time-consuming processes that do not add any value when done manually.</p><p>Let's take a look at one way of extending our automated process. We've set up a process to create the images, but there is a likelihood that some of the images are not compressed as much as they could be. We can fix that by adding in support for compression, using the <code class="literal">grunt-contrib-imagemin</code> plugin:</p><div><ol class="orderedlist arabic"><li class="listitem">Open up a copy of the <code class="literal">gruntfile.js</code> file. We first need to add in support for the <code class="literal">grunt-contrib-imagemin</code> plugin, so go ahead and modify the line as shown in the following code snippet:<div><pre class="programlisting">files: ['src/*.jpg'],
<strong>tasks: ['responsive_images', 'imagemin'],</strong>
options: {</pre></div></li><li class="listitem">Next, alter the code to add in the block for <code class="literal">imagemin</code> task as shown in the following code snippet:<div><pre class="programlisting">  dest: '../responseimg/assets'
    }
<strong>    },</strong>
<strong>    imagemin: {</strong>
<strong>      jpg: { options: { progressive: false }, files: [{ expand: true, cwd: 'assets/', src: '*.jpg', dest: 'assets/', ext: '.jpg' }]</strong>
<strong>  }</strong>
</pre></div></li><li class="listitem">When running the task in Grunt, we need to tell it to load in the <code class="literal">grunt-contrib-imagemin</code> plugin, so go ahead and add this line into the <code class="literal">gruntfile.js</code> file as indicated in the following lines of code:<div><pre class="programlisting">grunt.loadNpmTasks('grunt-responsive-images');
<strong>grunt.loadNpmTasks('grunt-contrib-imagemin');</strong>
</pre></div></li><li class="listitem">We need to make one final change, so go ahead and alter the following line as shown:<div><pre class="programlisting">
<strong>grunt.registerTask('default', ['simple-watch']);</strong>
</pre></div></li><li class="listitem">Bring up a NodeJS command prompt and run the following command to add the plugin and its dependencies to the <code class="literal">package.json</code> file:<div><pre class="programlisting">
<strong>npm install grunt-contrib-imagemin --save-dev</strong>
</pre></div></li><li class="listitem">We're now ready to test our Grunt package. In the command prompt, change the directory to the project folder, then run this command:<div><pre class="programlisting">
<strong>grunt</strong>
</pre></div></li><li class="listitem">If all is <a id="id215" class="indexterm"/>well, we'll see the Grunt task run and successfully produce three new images, which are then compressed.<div><img src="img/6968OT_03_07.jpg" alt="Automating the shrinking process"/></div></li></ol></div><p>The automation process is now ready for use. Although we've only put one image through the process, we could at this point put many images through. I would recommend running some tests to gauge how many you can safely process at the same time, as this will be dependent on resources in your PC or Mac.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec40"/>Summary</h1></div></div></div><p>Phew! We've certainly packed a lot into a small space! Let's recap on what you've learned throughout this chapter. We kicked off with a demo of mixing video and image content, initially to see firsthand some of the issues we face when mixing content, but then to use some of the tips and tricks you've learned to get the pages to behave responsively.</p><p>Having looked at a demo, we then moved onto considering some of the pitfalls of mixing content; we saw how the large increase in responsive use has increased over the last few years making it crucial that our designs work on a variety of platforms. We covered a number of tips we can use to make allowances for mobile platforms in our designs.</p><p>We ended the chapter looking at two demos using NodeJS to automate the creation of different versions of our images and automatically shrinking them; this illustrates how we can automate the process and save us a lot of manual effort.</p><p>Now that we have our content, we need to test it thoroughly to ensure it works across a wide range of devices. We'll take a look at the testing process in the next chapter, examining some of the considerations and pitfalls we need to be aware of when working with responsive media.</p></div></body></html>