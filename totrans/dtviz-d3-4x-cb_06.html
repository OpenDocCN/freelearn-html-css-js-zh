<html><head></head><body><div id="book-columns"><div id="book-inner"><div class="chapter" title="Chapter 6. Transition with Style"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/><span class="koboSpan" id="kobo.1.1">Chapter 6. Transition with Style</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">The preceding code produces the following visual output where a box appears with In this chapter, we will cover:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.3.1">Animating a single element</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.4.1">Animating multiple elements</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.5.1">Using ease</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.6.1">Using tweening</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.7.1">Using transition chaining</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.8.1">Using transition filter</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.9.1">Listening to transitional events</span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.10.1">Working with timer</span></li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec40"/><span class="koboSpan" id="kobo.11.1">Introduction</span></h1></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.12.1">"A picture is worth a thousand words."</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.13.1">This age-old wisdom is arguably one of the most important cornerstones of data visualization. </span><span class="koboSpan" id="kobo.13.2">Animation, on the other hand, is generated using a series of still images in quick succession. </span><span class="koboSpan" id="kobo.13.3">Human eye-and-brain complex, through positive afterimage, phi phenomenon, and beta movement, is able to create an illusion of continuous imagery. </span><span class="koboSpan" id="kobo.13.4">As Rick Parent put it perfectly in his brilliant work </span><span class="emphasis"><em><span class="koboSpan" id="kobo.14.1">Computer Animation Algorithms and Techniques</span></em></span><span class="koboSpan" id="kobo.15.1">:</span></p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.16.1">Images can quickly convey a large amount of information because the human visual system is a sophisticated information processor. </span><span class="koboSpan" id="kobo.16.2">It follows, then, that moving images have the potential to convey even more information in a short time. </span><span class="koboSpan" id="kobo.16.3">Indeed, the human visual system has evolved to provide for survival in an ever-changing world; it is designed to notice and interpret movement.</span></em></span>
</p></blockquote></div><div class="blockquote"><blockquote class="blockquote"><p>
<span class="emphasis"><em><span class="koboSpan" id="kobo.17.1">-Parent R. </span><span class="koboSpan" id="kobo.17.2">2012</span></em></span>
</p></blockquote></div><p><span class="koboSpan" id="kobo.18.1">This is in fact the main goal of animation used in data visualization projects. </span><span class="koboSpan" id="kobo.18.2">In this chapter, we will focus on the mechanics of </span><span class="emphasis"><em><span class="koboSpan" id="kobo.19.1">D3 transition</span></em></span><span class="koboSpan" id="kobo.20.1">, covering topics from the basics to more advanced ones, such as custom interpolation and timer-based transition. </span><span class="koboSpan" id="kobo.20.2">Mastering transition is not only going to add many bells and whistles to your visualization but will also provide a powerful toolset to your visualization and otherwise hard-to-visualize attributes, such as trending and differences.</span></p><div class="section" title="What is Transition?"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec105"/><span class="koboSpan" id="kobo.21.1">What is Transition?</span></h2></div></div></div><p><span class="koboSpan" id="kobo.22.1">D3 transition offers the ability to create computer animation with HTML and SVG elements on a web page. </span><span class="koboSpan" id="kobo.22.2">D3 transition implements an animation called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.23.1">Interpolation-based Animation</span></em></span><span class="koboSpan" id="kobo.24.1">. </span><span class="koboSpan" id="kobo.24.2">Computers are especially well equipped for value interpolation, and therefore, most of the computer animations are interpolation based. </span><span class="koboSpan" id="kobo.24.3">As its name suggests, the foundation for such animation capability is value interpolation.</span></p><p><span class="koboSpan" id="kobo.25.1">If you recall, we have already covered D3 interpolators and interpolation functions in detail in </span><a class="link" href="ch04.html" title="Chapter 4. Tipping the Scales"><span class="koboSpan" id="kobo.26.1">Chapter 4</span></a><span class="koboSpan" id="kobo.27.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.28.1">Tipping the Scales</span></em></span><span class="koboSpan" id="kobo.29.1">. </span><span class="koboSpan" id="kobo.29.2">Transition is built on top of interpolation and scales to provide the ability to change values over time, which powers animation. </span><span class="koboSpan" id="kobo.29.3">Each transition can be defined using a start and end value (also called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.30.1">key frames</span></em></span><span class="koboSpan" id="kobo.31.1"> in animation), while different algorithms and interpolators will fill in the intermediate values frame by frame (also called "in-betweening" or simply "tweening"). </span><span class="koboSpan" id="kobo.31.2">At the first glance, if you are not already familiar with animation algorithms and techniques, this seems to be a somewhat less controlled way of creating an animation. </span><span class="koboSpan" id="kobo.31.3">However, it is quite the opposite in reality; interpolation-based transitions can provide direct and specific expectations about the motion produced down to each and every frame, thus offering tremendous control to the animator with simplicity. </span><span class="koboSpan" id="kobo.31.4">In fact, D3 transition API is so well designed that, in most cases, only a couple of lines of code are enough to implement the animations you need in a data visualization project. </span><span class="koboSpan" id="kobo.31.5">Now, let's get our hands dirty and try out some transitions to further improve our understanding on this topic.</span></p></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Animating a single element"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec41"/><span class="koboSpan" id="kobo.1.1">Animating a single element</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">In this recipe, we will first take a look at the simplest case of transition-interpolating attributes on a single element over time to produce a simple animation.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec106"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/single-element-transition.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/single-element-transition.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec107"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">The code necessary to perform this simple transition is extremely short; good news for any animator:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
var body = d3.select("body"),  
duration = 5000; 
 
body.append("div") // &lt;-A 
            .classed("box", true) 
            .style("background-color", "#e9967a") // &lt;-B 
        .transition() // &lt;-C 
        .duration(duration) // &lt;-D 
            .style("background-color", "#add8e6") // &lt;-E 
            .style("margin-left", "600px") // &lt;-F 
            .style("width", "100px") 
            .style("height", "100px"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code produces a moving, shrinking, and color-changing square, as shown in the following screenshot:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_06_001.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Single element transition</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec108"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">You might be surprised to see that the extra code we added to enable this animation is only on lines </span><code class="literal"><span class="koboSpan" id="kobo.14.1">C</span></code><span class="koboSpan" id="kobo.15.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.16.1">D</span></code><span class="koboSpan" id="kobo.17.1">, as shown in the following code snippet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.18.1">body.append("div") // &lt;-A 
            .classed("box", true) 
            .style("background-color", "#e9967a") // &lt;-B 
            .transition() // &lt;-C 
            .duration(duration) // &lt;-D 
</span></pre><p><span class="koboSpan" id="kobo.19.1">First, on line </span><code class="literal"><span class="koboSpan" id="kobo.20.1">C</span></code><span class="koboSpan" id="kobo.21.1">, we call the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">d3.selection.transition</span></code><span class="koboSpan" id="kobo.23.1"> function to define a transition. </span><span class="koboSpan" id="kobo.23.2">Then, the </span><code class="literal"><span class="koboSpan" id="kobo.24.1">transition</span></code><span class="koboSpan" id="kobo.25.1"> function returns a transition-bound selection that still represents the same element(s) in the current selection. </span><span class="koboSpan" id="kobo.25.2">However, now, it is equipped with additional functions and allows further customization of the transitional behavior.</span></p><p><span class="koboSpan" id="kobo.26.1">On line </span><code class="literal"><span class="koboSpan" id="kobo.27.1">D</span></code><span class="koboSpan" id="kobo.28.1">, we set the duration of the transition to </span><code class="literal"><span class="koboSpan" id="kobo.29.1">5000</span></code><span class="koboSpan" id="kobo.30.1"> milliseconds using the </span><code class="literal"><span class="koboSpan" id="kobo.31.1">duration()</span></code><span class="koboSpan" id="kobo.32.1"> function. </span><span class="koboSpan" id="kobo.32.2">This function also returns the current transition-bound selection, thus allowing function chaining. </span><span class="koboSpan" id="kobo.32.3">As we mentioned at the start of this chapter, interpolation-based animations usually only require you to specify the start and end values while it lets interpolators and algorithms fill the intermediate values over time. </span><span class="koboSpan" id="kobo.32.4">D3 transition treats all values that are set before calling the </span><code class="literal"><span class="koboSpan" id="kobo.33.1">transition</span></code><span class="koboSpan" id="kobo.34.1"> function as start values, with values set after the </span><code class="literal"><span class="koboSpan" id="kobo.35.1">transition</span></code><span class="koboSpan" id="kobo.36.1"> function call as end values. </span><span class="koboSpan" id="kobo.36.2">Hence, in our example, we have the following:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.37.1">.style("background-color", "#e9967a") // &lt;-B 
</span></pre><p><span class="koboSpan" id="kobo.38.1">The </span><code class="literal"><span class="koboSpan" id="kobo.39.1">background-color</span></code><span class="koboSpan" id="kobo.40.1"> style defined on line </span><code class="literal"><span class="koboSpan" id="kobo.41.1">B</span></code><span class="koboSpan" id="kobo.42.1"> is treated as the start value for transition. </span><span class="koboSpan" id="kobo.42.2">All styles set in the following lines are treated as end values:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.43.1">.style("background-color", "#add8e6") // &lt;-E 
.style("margin-left", "600px") // &lt;-F 
.style("width", "100px") 
.style("height", "100px"); 
</span></pre><p><span class="koboSpan" id="kobo.44.1">At this point, you might be asking, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.45.1">why these start and end values are not symmetric?</span></em></span><span class="koboSpan" id="kobo.46.1"> D3 transition does not require every interpolated value to have explicit start and end values. </span><span class="koboSpan" id="kobo.46.2">If the start value is missing, then it will try to use the computed style, and if the end value is missing, then the value will be treated as a constant. </span><span class="koboSpan" id="kobo.46.3">Once the transition starts, D3 will automatically pick the most suitable built-in interpolator for each value. </span><span class="koboSpan" id="kobo.46.4">In our example, an RGB color interpolator will be used in line </span><code class="literal"><span class="koboSpan" id="kobo.47.1">E</span></code><span class="koboSpan" id="kobo.48.1">, while a string interpolator-which internally uses number interpolators to interpolate embedded numbers-will be used for the rest of the style values. </span><span class="koboSpan" id="kobo.48.2">Here, we will list the interpolated style values with their start and end values:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.49.1">background-color</span></code><span class="koboSpan" id="kobo.50.1">: The start value-</span><code class="literal"><span class="koboSpan" id="kobo.51.1">#e9967a</span></code><span class="koboSpan" id="kobo.52.1">-is greater than the end value-</span><code class="literal"><span class="koboSpan" id="kobo.53.1">#add8e6</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.54.1">margin-left</span></code><span class="koboSpan" id="kobo.55.1">: The start value is a computed style and greater than the end value </span><code class="literal"><span class="koboSpan" id="kobo.56.1">600px</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.57.1">width</span></code><span class="koboSpan" id="kobo.58.1">: The start value is a computed style and greater than the end value </span><code class="literal"><span class="koboSpan" id="kobo.59.1">100px</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.60.1">height</span></code><span class="koboSpan" id="kobo.61.1">: The start value is a computed style and greater than the end value </span><code class="literal"><span class="koboSpan" id="kobo.62.1">100px</span></code></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Animating multiple elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec42"/><span class="koboSpan" id="kobo.1.1">Animating multiple elements</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">More elaborate data visualization requires animating multiple elements instead of a single element, as demonstrated in the previous recipe. </span><span class="koboSpan" id="kobo.2.2">More importantly, these transitions often need to be driven by data and coordinated with other elements within the same visualization. </span><span class="koboSpan" id="kobo.2.3">In this recipe, we will see how a data-driven multi-element transition can be created to generate a moving bar chart. </span><span class="koboSpan" id="kobo.2.4">New bars are added over time, while the chart shifts from right to left with a smooth transition.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec109"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/multi-element-transition.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/multi-element-transition.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec110"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">As expected, this recipe is slightly larger than the previous one, however, not by that much. </span><span class="koboSpan" id="kobo.7.2">Let's take a look at the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.8.1">&lt;script type="text/javascript"&gt; 
var id= 0, 
data = [], 
duration = 500, 
chartHeight = 100, 
chartWidth = 680; 
 
for(vari = 0; i&lt; 20; i++) push(data); 
 
function render(data) { 
        var selection = d3.select("body") 
                .selectAll("div.v-bar") 
                 .data(data, function(d){return d.id;}); // &lt;-A 
 
        // enter 
        selection.enter() 
                .append("div") 
                .attr("class", "v-bar") 
                .style("z-index", "0") 
                .style("position", "fixed") 
                .style("top", chartHeight + "px") 
                 .style("left", function(d, i){ 
                    return barLeft(i+1) + "px"; // &lt;-B 
                }) 
                .style("height", "0px") // &lt;-C 
                .append("span"); 
 
        // update 
        selection 
             .transition().duration(duration) // &lt;-D 
                .style("top", function (d) { 
                       return chartHeight - barHeight(d) + "px"; 
                }) 
                .style("left", function(d, i){ 
                    return barLeft(i) + "px"; 
                }) 
                .style("height", function (d) { 
                    return barHeight(d) + "px"; 
                }) 
                .select("span") 
                .text(function (d) {return d.value;}); 
 
        // exit 
        selection.exit() 
                .transition().duration(duration) // &lt;-E 
                .style("left", function(d, i){ 
                    return barLeft(-1) + "px"; //&lt;-F 
                }) 
                .remove(); // &lt;-G 
    } 
 
function push(data) { 
    data.push({ 
        id: ++id, 
        value: Math.round(Math.random() * chartHeight) 
    }); 
} 
 
functionbarLeft(i) { 
    return i * (30 + 2); 
} 
 
functionbarHeight(d) { 
    returnd.value; 
} 
 
setInterval(function () { 
               data.shift(); 
               push(data); 
               render(data); 
    }, 2000); 
 
render(data); 
 
d3.select("body") 
       .append("div") 
           .attr("class", "baseline") 
           .style("position", "fixed") 
           .style("z-index", "1") 
           .style("top", chartHeight + "px") 
           .style("left", "0px") 
           .style("width", chartWidth + "px"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.9.1">The preceding code generates a sliding bar chart in your web browser, as shown in the following screenshot:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.10.1"><img src="graphics/image_06_002.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.11.1">Sliding bar chart</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec111"/><span class="koboSpan" id="kobo.12.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.13.1">On the surface, this example seems to be quite complex with complicated effects. </span><span class="koboSpan" id="kobo.13.2">Every second a new bar needs to be created and animated while the rest of the bars need to slide over precisely. </span><span class="koboSpan" id="kobo.13.3">The beauty of D3 set-oriented functional API is that it works exactly the same way no matter how many elements you manipulate; therefore, once you understand the mechanics, you will realize this recipe is not so much different than the previous one.</span></p><p><span class="koboSpan" id="kobo.14.1">As the first step, we created a data-bound selection for a number of vertical bars (on line </span><code class="literal"><span class="koboSpan" id="kobo.15.1">A</span></code><span class="koboSpan" id="kobo.16.1">), which can then be used in a classic enter-update-exit D3 pattern:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.17.1">var selection = d3.select("body") 
                .selectAll("div.v-bar") 
                .data(data, function(d){return d.id;}); // &lt;-A 
</span></pre><p><span class="koboSpan" id="kobo.18.1">One thing we have not touched so far is the second parameter in the </span><code class="literal"><span class="koboSpan" id="kobo.19.1">d3.selection.data</span></code><span class="koboSpan" id="kobo.20.1"> function. </span><span class="koboSpan" id="kobo.20.2">This function is called an </span><span class="emphasis"><em><span class="koboSpan" id="kobo.21.1">object-identity function</span></em></span><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">The purpose of using this function is to provide object constancy. </span><span class="koboSpan" id="kobo.22.3">What it means in simple terms is that we want the binding between data and visual element to be stable. </span><span class="koboSpan" id="kobo.22.4">In order to achieve object constancy, each data needs to have a unique identifier. </span><span class="koboSpan" id="kobo.22.5">Once the ID is provided, D3 will ensure that a </span><code class="literal"><span class="koboSpan" id="kobo.23.1">div</span></code><span class="koboSpan" id="kobo.24.1"> element is bound to </span><code class="literal"><span class="koboSpan" id="kobo.25.1">{id: 3, value: 45}</span></code><span class="koboSpan" id="kobo.26.1">; the next time the update selection is computed, the same </span><code class="literal"><span class="koboSpan" id="kobo.27.1">div</span></code><span class="koboSpan" id="kobo.28.1"> element will be used for the data with the same index </span><code class="literal"><span class="koboSpan" id="kobo.29.1">id</span></code><span class="koboSpan" id="kobo.30.1">, although this time, the value may be changed, for example, to </span><code class="literal"><span class="koboSpan" id="kobo.31.1">{id: 3, value: 12}</span></code><span class="koboSpan" id="kobo.32.1">. </span><span class="koboSpan" id="kobo.32.2">Object constancy is crucial in this recipe; without object constancy, the sliding effect will not work.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note60"/><span class="koboSpan" id="kobo.33.1">Note</span></h3><p><span class="koboSpan" id="kobo.34.1">If you are interested to know more about object constancy, please check out this excellent writing by Mike Bostock, the creator of D3, at the following link: </span><a class="ulink" href="https://bost.ocks.org/mike/constancy/"><span class="koboSpan" id="kobo.35.1">https://bost.ocks.org/mike/constancy/
</span></a>
</p></div></div><p><span class="koboSpan" id="kobo.36.1">The second step is to create these vertical bars with the </span><code class="literal"><span class="koboSpan" id="kobo.37.1">d3.selection.enter</span></code><span class="koboSpan" id="kobo.38.1"> function and compute the </span><code class="literal"><span class="koboSpan" id="kobo.39.1">left</span></code><span class="koboSpan" id="kobo.40.1"> position for each bar based on the index number (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.41.1">B</span></code><span class="koboSpan" id="kobo.42.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.43.1">// enter 
selection.enter() 
                .append("div") 
                .attr("class", "v-bar") 
                .style("z-index", "0") 
                .style("position", "fixed") 
                .style("top", chartHeight + "px") 
                .style("left", function(d, i){ 
returnbarLeft(i+1) + "px"; // &lt;-B 
                }) 
                .style("height", "0px") // &lt;-C 
                .append("span"); 
</span></pre><p><span class="koboSpan" id="kobo.44.1">Another point worth mentioning here is that in the </span><code class="literal"><span class="koboSpan" id="kobo.45.1">enter</span></code><span class="koboSpan" id="kobo.46.1"> section, we have not called the transition yet, which means any value we specify here will be used as the start value in a transition. </span><span class="koboSpan" id="kobo.46.2">If you notice on line </span><code class="literal"><span class="koboSpan" id="kobo.47.1">C</span></code><span class="koboSpan" id="kobo.48.1">, bar </span><code class="literal"><span class="koboSpan" id="kobo.49.1">height</span></code><span class="koboSpan" id="kobo.50.1"> is set to </span><code class="literal"><span class="koboSpan" id="kobo.51.1">0px</span></code><span class="koboSpan" id="kobo.52.1">. </span><span class="koboSpan" id="kobo.52.2">This enables the animation of bars to increase from zero height to the target </span><code class="literal"><span class="koboSpan" id="kobo.53.1">height</span></code><span class="koboSpan" id="kobo.54.1">. </span><span class="koboSpan" id="kobo.54.2">At the same time, the same logic is applied to the </span><code class="literal"><span class="koboSpan" id="kobo.55.1">left</span></code><span class="koboSpan" id="kobo.56.1"> position of the bar (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.57.1">B</span></code><span class="koboSpan" id="kobo.58.1">) and was set to </span><code class="literal"><span class="koboSpan" id="kobo.59.1">barLeft(i+1)</span></code><span class="koboSpan" id="kobo.60.1">, thus enabling the sliding transition we desired:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.61.1">// update 
selection 
            .transition().duration(duration) // &lt;-D 
                .style("top", function (d) {  
returnchartHeight - barHeight(d) + "px";  
                }) 
                .style("left", function(d, i){ 
returnbarLeft(i) + "px"; 
                }) 
                .style("height", function (d) {  
returnbarHeight(d) + "px";  
                }) 
                .select("span") 
                    .text(function (d) {return d.value;}); 
</span></pre><p><span class="koboSpan" id="kobo.62.1">After completing the </span><code class="literal"><span class="koboSpan" id="kobo.63.1">enter</span></code><span class="koboSpan" id="kobo.64.1"> section, we can now take care of the </span><code class="literal"><span class="koboSpan" id="kobo.65.1">update</span></code><span class="koboSpan" id="kobo.66.1"> section, where the transition is defined. </span><span class="koboSpan" id="kobo.66.2">First of all, we want to introduce transition for all updates, and therefore, we invoke the </span><code class="literal"><span class="koboSpan" id="kobo.67.1">transition</span></code><span class="koboSpan" id="kobo.68.1"> function before any style change is applied (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.69.1">D</span></code><span class="koboSpan" id="kobo.70.1">). </span><span class="koboSpan" id="kobo.70.2">Once the transition-bound selection is created, we applied the following style transitions:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.71.1">top</span></code><span class="koboSpan" id="kobo.72.1">: </span><code class="literal"><span class="koboSpan" id="kobo.73.1">chartHeight + "px" &gt;chartHeight - barHeight(d)+"px"</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.74.1">left</span></code><span class="koboSpan" id="kobo.75.1">: </span><code class="literal"><span class="koboSpan" id="kobo.76.1">barLeft(i+1) + "px" &gt;barLeft(i) + "px"</span></code></li><li class="listitem" style="list-style-type: disc"><code class="literal"><span class="koboSpan" id="kobo.77.1">height</span></code><span class="koboSpan" id="kobo.78.1">: </span><code class="literal"><span class="koboSpan" id="kobo.79.1">"0px" &gt;barHeight(d) + "px"</span></code></li></ul></div><p><span class="koboSpan" id="kobo.80.1">The aforementioned three style transitions are all you need to do to handle new bars and every existing bars and their sliding effect. </span><span class="koboSpan" id="kobo.80.2">Finally, the last case we will need to handle here is the </span><code class="literal"><span class="koboSpan" id="kobo.81.1">exit</span></code><span class="koboSpan" id="kobo.82.1"> case, when a bar is no longer needed. </span><span class="koboSpan" id="kobo.82.2">So, we want to keep the number of bars constant on the page. </span><span class="koboSpan" id="kobo.82.3">This is handled in the </span><code class="literal"><span class="koboSpan" id="kobo.83.1">exit</span></code><span class="koboSpan" id="kobo.84.1"> section:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.85.1">// exit 
selection.exit() 
                .transition().duration(duration) // &lt;-E 
                .style("left", function(d, i){ 
returnbarLeft(-1) + "px"; // &lt;-F 
                }) 
                .remove(); // &lt;-G 
</span></pre><p><span class="koboSpan" id="kobo.86.1">So far in this book, prior to this chapter, we have always called the </span><code class="literal"><span class="koboSpan" id="kobo.87.1">remove()</span></code><span class="koboSpan" id="kobo.88.1"> function immediately after the </span><code class="literal"><span class="koboSpan" id="kobo.89.1">d3.selection.exit</span></code><span class="koboSpan" id="kobo.90.1"> function. </span><span class="koboSpan" id="kobo.90.2">This immediately removes the elements that are no longer needed. </span><span class="koboSpan" id="kobo.90.3">In fact, the </span><code class="literal"><span class="koboSpan" id="kobo.91.1">exit()</span></code><span class="koboSpan" id="kobo.92.1"> function also returns a selection, and therefore, can be animated before calling the </span><code class="literal"><span class="koboSpan" id="kobo.93.1">remove()</span></code><span class="koboSpan" id="kobo.94.1"> function. </span><span class="koboSpan" id="kobo.94.2">This is exactly what we did here: we started a transition on line </span><code class="literal"><span class="koboSpan" id="kobo.95.1">E</span></code><span class="koboSpan" id="kobo.96.1"> using the </span><code class="literal"><span class="koboSpan" id="kobo.97.1">exit</span></code><span class="koboSpan" id="kobo.98.1"> selection, and then, we animated the left value with the following transition change:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.99.1">left: barLeft(i) + "px" &gt;barLeft(i-1) + "px" 
</span></pre><p><span class="koboSpan" id="kobo.100.1">Since we always remove the left-most bar, this transition moves the bar left and out of the SVG canvas, and then removes it.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note61"/><span class="koboSpan" id="kobo.101.1">Note</span></h3><p><span class="koboSpan" id="kobo.102.1">The </span><code class="literal"><span class="koboSpan" id="kobo.103.1">exit</span></code><span class="koboSpan" id="kobo.104.1"> transition is not necessarily limited to simple transitions, such as the one we have shown in this recipe. </span><span class="koboSpan" id="kobo.104.2">In some visualization, it could be as elaborate as the </span><code class="literal"><span class="koboSpan" id="kobo.105.1">update</span></code><span class="koboSpan" id="kobo.106.1"> transition.</span></p></div></div><p><span class="koboSpan" id="kobo.107.1">Once the </span><code class="literal"><span class="koboSpan" id="kobo.108.1">render</span></code><span class="koboSpan" id="kobo.109.1"> function is in place with the defined transition, all that is left is to simply update the data and rerender our bar chart every second using the </span><code class="literal"><span class="koboSpan" id="kobo.110.1">setInterval</span></code><span class="koboSpan" id="kobo.111.1"> function. </span><span class="koboSpan" id="kobo.111.2">Now this completes our example.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using ease"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec43"/><span class="koboSpan" id="kobo.1.1">Using ease</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Transition can be thought of as a function of time. </span><span class="koboSpan" id="kobo.2.2">It is a function that maps time progression into numeric value progression, which then results in object motion (if the numeric value is used for positioning) or morphing (if the value is used to describe other visual attributes). </span><span class="koboSpan" id="kobo.2.3">Time always travels at a constant pace; in other words, time progression is uniform (unless you are doing visualization near a black hole, of course); however, the resulting value progression does not need to be uniform. </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">Easing</span></em></span><span class="koboSpan" id="kobo.4.1"> is a standard technique to provide flexibility and control to this kind of mapping. </span><span class="koboSpan" id="kobo.4.2">When a transition generates a uniform value progression, it is called </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">linear easing</span></em></span><span class="koboSpan" id="kobo.6.1">. </span><span class="koboSpan" id="kobo.6.2">D3 provides support for different types of easing capabilities, and in this recipe, we will explore different built-in D3 easing functions, as well as how to implement custom easing functions with D3 transition.</span></p><div class="section" title="Getting Ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec112"/><span class="koboSpan" id="kobo.7.1">Getting Ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/easing.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/easing.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec113"/><span class="koboSpan" id="kobo.10.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.11.1">In the following code example, we will demonstrate how transition easing can be customized on an element-by-element basis:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.12.1">&lt;script type="text/javascript"&gt; 
var data = [ // &lt;-A 
            {name: 'Linear', fn: d3.easeLinear}, 
            {name: 'Cubic', fn: d3.easeCubic}, 
            {name: 'CubicIn', fn: d3.easeCubicIn}, 
            {name: 'Sin', fn: d3.easeSin}, 
            {name: 'SinIn', fn: d3.easeSinIn}, 
            {name: 'Exp', fn: d3.easeExp}, 
            {name: 'Circle', fn: d3.easeCircle}, 
            {name: 'Back', fn: d3.easeBack}, 
            {name: 'Bounce', fn: d3.easeBounce}, 
            {name: 'Elastic', fn: d3.easeElastic}, 
            {name: 'Custom', fn: function(t){ return t * t; }}// &lt;-B 
    ], 
colors = d3.scaleOrdinal(d3.schemeCategory20); 
 
d3.select("body").selectAll("div") 
            .data(data) // &lt;-C 
        .enter() 
        .append("div") 
            .attr("class", "fixed-cell") 
            .style("top", function (d, i) { 
            returni * 40 + "px"; 
            }) 
            .style("background-color", function (d, i) { 
            return colors(i); 
            }) 
            .style("color", "white") 
            .style("left", "500px") 
            .text(function (d) { 
            return d.name; 
            }); 
 
d3.selectAll("div").each(function(d){ 
d3.select(this) 
      .transition().ease(d.fn) // &lt;-D 
      .duration(1500) 
      .style("left", "10px"); 
    }); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.13.1">The preceding code produces a set of moving boxes with different easing effects. </span><span class="koboSpan" id="kobo.13.2">The following screenshot is captured at the time the easing effect takes place:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_06_003.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Different easing effects</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec114"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">In this recipe, we have shown a number of different built-in D3 ease functions and their effects on transition. </span><span class="koboSpan" id="kobo.17.2">Let's take a look at how it is done; first, we created an array to store different ease modes we want to demonstrate:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.18.1">var data = [ // &lt;-A 
            {name: 'Linear', fn: d3.easeLinear}, 
            {name: 'Cubic', fn: d3.easeCubic}, 
            {name: 'CubicIn', fn: d3.easeCubicIn}, 
            {name: 'Sin', fn: d3.easeSin}, 
            {name: 'SinIn', fn: d3.easeSinIn}, 
            {name: 'Exp', fn: d3.easeExp}, 
            {name: 'Circle', fn: d3.easeCircle}, 
            {name: 'Back', fn: d3.easeBack}, 
            {name: 'Bounce', fn: d3.easeBounce}, 
            {name: 'Elastic', fn: d3.easeElastic}, 
            {name: 'Custom', fn: function(t){ return t * t; }}// &lt;-B 
    ], 
colors = d3.scaleOrdinal(d3.schemeCategory20); 
</span></pre><p><span class="koboSpan" id="kobo.19.1">While all the built-in ease functions are defined simply using their name, the last element of this array is a custom easing function (</span><span class="emphasis"><em><span class="koboSpan" id="kobo.20.1">quadric easing</span></em></span><span class="koboSpan" id="kobo.21.1">). </span><span class="koboSpan" id="kobo.21.2">Then, afterward, a set of </span><code class="literal"><span class="koboSpan" id="kobo.22.1">div</span></code><span class="koboSpan" id="kobo.23.1"> elements created using this data array and a transition with different easing functions were created for each of the </span><code class="literal"><span class="koboSpan" id="kobo.24.1">div</span></code><span class="koboSpan" id="kobo.25.1"> element, respectively, moving them from </span><code class="literal"><span class="koboSpan" id="kobo.26.1">("left", "500px")</span></code><span class="koboSpan" id="kobo.27.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.28.1">("left", "10px")</span></code><span class="koboSpan" id="kobo.29.1">, as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.30.1">d3.selectAll("div").each(function(d){ 
d3.select(this) 
      .transition().ease(d.fn) // &lt;-D 
      .duration(1500) 
      .style("left", "10px"); 
    }); 
</span></pre><p><span class="koboSpan" id="kobo.31.1">At this point, you might be asking, Why did we not just specify easing using a function as we normally would have done for any other D3 attributes?</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1">d3.selectAll("div").transition().ease(d.fn) // does not work 
        .duration(1500) 
        .style("left", "10px"); 
</span></pre><p><span class="koboSpan" id="kobo.33.1">The reason is that it does not work on the </span><code class="literal"><span class="koboSpan" id="kobo.34.1">ease()</span></code><span class="koboSpan" id="kobo.35.1"> function. </span><span class="koboSpan" id="kobo.35.2">What we showed on line </span><code class="literal"><span class="koboSpan" id="kobo.36.1">D</span></code><span class="koboSpan" id="kobo.37.1"> is a workaround of this limitation; though in real-world projects, it is fairly rare that you will need to customize easing behavior on a per-element basis.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note62"/><span class="koboSpan" id="kobo.38.1">Note</span></h3><p><span class="koboSpan" id="kobo.39.1">Another way to get around this limitation is using custom tweening, which we will cover in the next recipe.</span></p></div></div><p><span class="koboSpan" id="kobo.40.1">As seen on line </span><code class="literal"><span class="koboSpan" id="kobo.41.1">D</span></code><span class="koboSpan" id="kobo.42.1">, specifying different ease function for D3 transition is very straightforward; all you need to do is call the </span><code class="literal"><span class="koboSpan" id="kobo.43.1">ease()</span></code><span class="koboSpan" id="kobo.44.1"> function on a transition-bound selection. </span><span class="koboSpan" id="kobo.44.2">D3 also provides ease mode modifiers that you can combine with any ease function to achieve additional effects, for example, sin-out or quad-out-in. </span><span class="koboSpan" id="kobo.44.3">The following are the available ease mode modifiers:</span></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.45.1">In</span></strong></span><span class="koboSpan" id="kobo.46.1">: default</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.47.1">Out</span></strong></span><span class="koboSpan" id="kobo.48.1">: reversed</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.49.1">InOut</span></strong></span><span class="koboSpan" id="kobo.50.1">: reflected</span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong><span class="koboSpan" id="kobo.51.1">OutIn</span></strong></span><span class="koboSpan" id="kobo.52.1">: reversed and reflected</span></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note63"/><span class="koboSpan" id="kobo.53.1">Note</span></h3><p><span class="koboSpan" id="kobo.54.1">The default ease effect used by D3 is </span><code class="literal"><span class="koboSpan" id="kobo.55.1">easeCubic()</span></code><span class="koboSpan" id="kobo.56.1">.
</span><span class="koboSpan" id="kobo.56.2">For the list of supported D3 ease functions, please refer to the following link:
</span><a class="ulink" href="https://github.com/d3/d3-ease"><span class="koboSpan" id="kobo.57.1">https://github.com/d3/d3-ease</span></a><span class="koboSpan" id="kobo.58.1">
For anyone who wants to explore different kind of built-in ease modes visually, you can check out this visual ease explorer built by D3's creator:
</span><a class="ulink" href="http://bl.ocks.org/mbostock/248bac3b8e354a9103c4"><span class="koboSpan" id="kobo.59.1">http://bl.ocks.org/mbostock/248bac3b8e354a9103c4
</span></a>
</p></div></div><p><span class="koboSpan" id="kobo.60.1">When a custom ease function is used, the function is expected to take the current parametric time value as its parameter in the range of [0, 1] as shown in the following function.</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.61.1">function(t){ // &lt;-B 
    return t * t; 
} 
</span></pre><p><span class="koboSpan" id="kobo.62.1">In our example, we implemented a simple quadric easing function, which is actually available as a built-in D3 ease function and is named quad.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note64"/><span class="koboSpan" id="kobo.63.1">Note</span></h3><p><span class="koboSpan" id="kobo.64.1">For more information on easing and Penner's equations (most of the modern JavaScript framework implementations including D3 and jQuery), check out the following link:
</span><a class="ulink" href="http://www.robertpenner.com/easing/"><span class="koboSpan" id="kobo.65.1">http://www.robertpenner.com/easing/
</span></a>
</p></div></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using tweening"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec44"/><span class="koboSpan" id="kobo.1.1">Using tweening</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Tween comes from the word </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">inbetween</span></em></span><span class="koboSpan" id="kobo.4.1">, which is a common practice performed in the traditional animation where after key frames were created by the master animator, less experienced animators were used to generate frames in between the key frames. </span><span class="koboSpan" id="kobo.4.2">This phrase is borrowed in modern computer-generated animation and refers to the technique or algorithm that controls how the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.5.1">inbetween</span></em></span><span class="koboSpan" id="kobo.6.1"> frames are generated. </span><span class="koboSpan" id="kobo.6.2">In this recipe, we will examine how the D3 transition supports tweening.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec115"/><span class="koboSpan" id="kobo.7.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.8.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/tweening.html"><span class="koboSpan" id="kobo.9.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/tweening.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec116"/><span class="koboSpan" id="kobo.10.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.11.1">In the following code example, we will create a custom tweening function to animate a button label through nine discrete integral numbers:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.12.1">&lt;script type="text/javascript"&gt; 
var body = d3.select("body"), duration = 5000; 
 
body.append("div").append("input") 
        .attr("type", "button") 
        .attr("class", "countdown") 
        .attr("value", "0") 
        .style("width", "150px") 
        .transition().duration(duration).ease(d3.easeLinear) 
            .style("width", "400px") 
            .attr("value", "9"); 
 
body.append("div").append("input") 
        .attr("type", "button") 
        .attr("class", "countdown") 
        .attr("value", "0") 
        .transition().duration(duration).ease(d3.easeLinear) 
.styleTween("width", widthTween) // &lt;- A 
            .attrTween("value", valueTween); // &lt;- B 
 
 
functionwidthTween(a){ 
var interpolate = d3.scaleQuantize() 
            .domain([0, 1]) 
            .range([150, 200, 250, 350, 400]); 
 
              return function(t){ 
              return interpolate(t) + "px"; 
        }; 
    } 
 
functionvalueTween(){ 
var interpolate = d3.scaleQuantize() // &lt;-C 
            .domain([0, 1]) 
            .range([1, 2, 3, 4, 5, 6, 7, 8, 9]); 
 
             return function(t){ // &lt;-D 
             return interpolate(t); 
        }; 
    }         
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.13.1">The preceding code generates two buttons morphing at a very different rate, and the following screenshot was taken while this process was going on:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_06_004.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Tweening</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec117"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">In this recipe, the first button was created using simple transition with linear easing:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.18.1">body.append("div").append("input") 
        .attr("type", "button") 
        .attr("class", "countdown") 
        .attr("value", "0") 
        .style("width", "150px") 
        .transition().duration(duration).ease(d3.easeLinear) 
            .style("width", "400px") 
            .attr("value", "9"); 
</span></pre><p><span class="koboSpan" id="kobo.19.1">The transition changes the button's width from </span><code class="literal"><span class="koboSpan" id="kobo.20.1">150px</span></code><span class="koboSpan" id="kobo.21.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.22.1">400px</span></code><span class="koboSpan" id="kobo.23.1">, while changing its value from </span><code class="literal"><span class="koboSpan" id="kobo.24.1">0</span></code><span class="koboSpan" id="kobo.25.1"> to </span><code class="literal"><span class="koboSpan" id="kobo.26.1">9</span></code><span class="koboSpan" id="kobo.27.1">. </span><span class="koboSpan" id="kobo.27.2">As expected, this transition simply relies on continuous linear interpolation of these values using the D3 string interpolator. </span><span class="koboSpan" id="kobo.27.3">In comparison, the second button has the effect of changing these values in chunks, moving from 1 to 2, then to 3, and so on up to 9. </span><span class="koboSpan" id="kobo.27.4">This is achieved using D3 tweening support with the </span><code class="literal"><span class="koboSpan" id="kobo.28.1">attrTween</span></code><span class="koboSpan" id="kobo.29.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.30.1">styleTween</span></code><span class="koboSpan" id="kobo.31.1"> functions. </span><span class="koboSpan" id="kobo.31.2">Let's first take a look at how the button value tweening works:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.32.1">  .transition().duration(duration).ease(d3.easeLinear) 
            .styleTween("width", widthTween) // &lt;- A 
            .attrTween("value", valueTween); // &lt;- B 
</span></pre><p><span class="koboSpan" id="kobo.33.1">In the preceding code snippet, we can see that instead of setting the end value for the value attribute as we did in the case of the first button, we used the </span><code class="literal"><span class="koboSpan" id="kobo.34.1">attrTween</span></code><span class="koboSpan" id="kobo.35.1"> function and offered a pair of tweening functions </span><code class="literal"><span class="koboSpan" id="kobo.36.1">widthTween</span></code><span class="koboSpan" id="kobo.37.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.38.1">valueTween</span></code><span class="koboSpan" id="kobo.39.1">, which are implemented as follows:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.40.1">functionwidthTween(a){ 
var interpolate = d3.scaleQuantize() 
            .domain([0, 1]) 
            .range([150, 200, 250, 350, 400]); 
 
return function(t){ 
return interpolate(t) + "px"; 
        }; 
    } 
 
functionvalueTween(){ 
var interpolate = d3.scaleQuantize() // &lt;-C 
            .domain([0, 1]) 
            .range([1, 2, 3, 4, 5, 6, 7, 8, 9]); 
 
return function(t){ // &lt;-D 
return interpolate(t); 
        }; 
    } 
</span></pre><p><span class="koboSpan" id="kobo.41.1">In D3, a tween function is expected to be a factory function, which constructs the actual function that will be used to perform the tweening. </span><span class="koboSpan" id="kobo.41.2">In this case, we defined a </span><code class="literal"><span class="koboSpan" id="kobo.42.1">quantize</span></code><span class="koboSpan" id="kobo.43.1"> scale that maps the domain </span><code class="literal"><span class="koboSpan" id="kobo.44.1">[0, 1]</span></code><span class="koboSpan" id="kobo.45.1"> to a discrete integral range of </span><code class="literal"><span class="koboSpan" id="kobo.46.1">[1, 9]</span></code><span class="koboSpan" id="kobo.47.1">, on line </span><code class="literal"><span class="koboSpan" id="kobo.48.1">C</span></code><span class="koboSpan" id="kobo.49.1">. </span><span class="koboSpan" id="kobo.49.2">The actual tweening function defined on line </span><code class="literal"><span class="koboSpan" id="kobo.50.1">D</span></code><span class="koboSpan" id="kobo.51.1"> simply interpolates the parametric time value using the quantize scale, which generates the jumping integer effect.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note65"/><span class="koboSpan" id="kobo.52.1">Note</span></h3><p><span class="koboSpan" id="kobo.53.1">Quantize scales are a variant of linear scale with a discrete range rather than a continuous one. </span><span class="koboSpan" id="kobo.53.2">For more information on quantize scales, please visit the following link:
</span><a class="ulink" href="https://github.com/d3/d3/blob/master/API.md#quantize-scales"><span class="koboSpan" id="kobo.54.1">https://github.com/d3/d3/blob/master/API.md#quantize-scales
</span></a>
</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec118"/><span class="koboSpan" id="kobo.55.1">There's more...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.56.1">At this point, we have touched upon all three concepts related to transition: ease, tween, and interpolation. </span><span class="koboSpan" id="kobo.56.2">Typically, D3 transition is defined and driven through all the three levels shown in the following sequence diagram:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.57.1"><img src="graphics/5530_06_05.jpg" alt="There's more..."/></span></div><p><span class="koboSpan" id="kobo.58.1">`</span></p><p><span class="koboSpan" id="kobo.59.1">Drivers of transition</span></p><p><span class="koboSpan" id="kobo.60.1">As we have shown through multiple recipes, D3 transition supports customization in all three levels. </span><span class="koboSpan" id="kobo.60.2">This gives us tremendous flexibility to customize the transition behavior exactly the way we want.</span></p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note66"/><span class="koboSpan" id="kobo.61.1">Note</span></h3><p><span class="koboSpan" id="kobo.62.1">Though custom tween is usually implemented using interpolation, there is no limit to what you can do in your own tween function. </span><span class="koboSpan" id="kobo.62.2">It is entirely possible to generate custom tween without using D3 interpolator at all.</span></p></div></div><p><span class="koboSpan" id="kobo.63.1">We used linear easing in this recipe to highlight the effect of tweening; however, D3 fully supports </span><span class="emphasis"><em><span class="koboSpan" id="kobo.64.1">eased tweening</span></em></span><span class="koboSpan" id="kobo.65.1">, which means that you can combine any of the ease functions that are demonstrated in the previous recipe with your custom tween to generate even more complex transition effects.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using transition chaining"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec45"/><span class="koboSpan" id="kobo.1.1">Using transition chaining</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">The first four recipes in this chapter are focused on single transition controls in D3, including custom easing and tweening functions. </span><span class="koboSpan" id="kobo.2.2">However, sometimes, regardless of how much easing or tweening you do, a single transition is just not enough; for instance, you would want to simulate teleporting a </span><code class="literal"><span class="koboSpan" id="kobo.3.1">div</span></code><span class="koboSpan" id="kobo.4.1"> element by first squeezing the </span><code class="literal"><span class="koboSpan" id="kobo.5.1">div</span></code><span class="koboSpan" id="kobo.6.1"> element into a beam, then passing the beam to a different position on the web page, and finally restoring the </span><code class="literal"><span class="koboSpan" id="kobo.7.1">div</span></code><span class="koboSpan" id="kobo.8.1"> to its original size. </span><span class="koboSpan" id="kobo.8.2">In this recipe, we will see exactly how this type of transition can be achieved using </span><span class="emphasis"><em><span class="koboSpan" id="kobo.9.1">transition chaining</span></em></span><span class="koboSpan" id="kobo.10.1">.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec119"/><span class="koboSpan" id="kobo.11.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.12.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://raw.githubusercontent.com/NickQiZhu/d3-cookbook-v2/master/src/chapter6/chaining.html"><span class="koboSpan" id="kobo.13.1">https://raw.githubusercontent.com/NickQiZhu/d3-cookbook-v2/master/src/chapter6/chaining.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec120"/><span class="koboSpan" id="kobo.14.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.15.1">Our simple teleportation transition code is surprisingly short:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.16.1">&lt;script type="text/javascript"&gt; 
var body = d3.select("body"); 
 
function teleport(s){ 
s.transition().duration(1000) // &lt;-A 
            .style("width", "200px") 
            .style("height", "1px") 
        .transition().duration(500) // &lt;-B 
            .style("left", "600px") 
        .transition().duration(1000) // &lt;-C 
            .style("left", "800px") 
            .style("height", "80px") 
            .style("width", "80px"); 
    } 
 
body.append("div")     
            .style("position", "fixed") 
            .style("background-color", "steelblue") 
            .style("left", "10px") 
            .style("width", "80px") 
            .style("height", "80px") 
            .call(teleport); // &lt;-D       
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.17.1">The preceding code performs a </span><code class="literal"><span class="koboSpan" id="kobo.18.1">div</span></code><span class="koboSpan" id="kobo.19.1"> teleportation:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.20.1"><img src="graphics/image_06_006.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.21.1">DIV teleportation using transition chaining</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec121"/><span class="koboSpan" id="kobo.22.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.23.1">This simple teleportation effect was achieved by chaining a few transitions together. </span><span class="koboSpan" id="kobo.23.2">In D3, when transitions are chained, they are guaranteed to be executed only after the previous transition reaches its completion state. </span><span class="koboSpan" id="kobo.23.3">Now, let's take a look at how this is done in the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.24.1">function teleport(s){ 
s.transition().duration(1000) // &lt;-A 
        .style("width", "200px") 
        .style("height", "1px") 
    .transition().duration(500) // &lt;-B 
        .style("left", "600px") 
    .transition().duration(1000) // &lt;-C 
        .style("left", "800px") 
        .style("height", "80px") 
        .style("width", "80px"); 
}; 
</span></pre><p><span class="koboSpan" id="kobo.25.1">The first transition was defined and initiated on line </span><code class="literal"><span class="koboSpan" id="kobo.26.1">A</span></code><span class="koboSpan" id="kobo.27.1"> (compression); then, on line </span><code class="literal"><span class="koboSpan" id="kobo.28.1">B</span></code><span class="koboSpan" id="kobo.29.1">, a second transition (beaming) was created; and finally, the third transition is chained on line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">C</span></code><span class="koboSpan" id="kobo.31.1"> (restoration). </span><span class="koboSpan" id="kobo.31.2">Transition chaining is a powerful yet simple technique to orchestrate a complex transition effect by stitching simple transitions together. </span><span class="koboSpan" id="kobo.31.3">Finally, in this recipe, we have also shown a basic example on reusable composite transition effect by wrapping the teleportation transition in a function and then applying it on a selection using the </span><code class="literal"><span class="koboSpan" id="kobo.32.1">d3.selection.call</span></code><span class="koboSpan" id="kobo.33.1"> function (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.34.1">D</span></code><span class="koboSpan" id="kobo.35.1">). </span><span class="koboSpan" id="kobo.35.2">Reusable transition effect is essential to following the DRY principle, especially when the animation in your visualization becomes more elaborate.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Using transition filter"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec46"/><span class="koboSpan" id="kobo.1.1">Using transition filter</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Under some circumstances, you might find it necessary to selectively apply transition to a subset of a certain selection. </span><span class="koboSpan" id="kobo.2.2">In this recipe, we will explore this effect using data-driven transition filtering techniques.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec122"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://raw.githubusercontent.com/NickQiZhu/d3-cookbook-v2/master/src/chapter6/chaining.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/filtering.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec123"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will move a set of </span><code class="literal"><span class="koboSpan" id="kobo.8.1">div</span></code><span class="koboSpan" id="kobo.9.1"> elements (or boxes) across the web page from right to left. </span><span class="koboSpan" id="kobo.9.2">After moving all the boxes to the left, we will selectively move only the boxes that are marked as </span><span class="strong"><strong><span class="koboSpan" id="kobo.10.1">Cat</span></strong></span><span class="koboSpan" id="kobo.11.1"> back, so they won't fight each other. </span><span class="koboSpan" id="kobo.11.2">Let's take a look at the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.12.1">&lt;script type="text/javascript"&gt; 
var data = ["Cat", "Dog", "Cat", "Dog", "Cat", "Dog", "Cat", "Dog"], 
duration = 1500; 
 
d3.select("body").selectAll("div") 
            .data(data) 
        .enter() 
        .append("div") 
            .attr("class", "fixed-cell") 
            .style("top", function (d, i) { 
            return i * 40 + "px"; 
            }) 
            .style("background-color", "steelblue") 
            .style("color", "white") 
            .style("left", "500px") 
            .text(function (d) { 
return d; 
            }) 
            .transition() // &lt;- A 
                .duration(duration) 
                    .style("left", "10px") 
            .filter(function(d){return d == "Cat";}) // &lt;- B 
                .transition() // &lt;- C 
                .duration(duration) 
                    .style("left", "500px"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.13.1">Here is what the page looks like after the transition:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.14.1"><img src="graphics/image_06_007.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.15.1">Transition filtering</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec124"/><span class="koboSpan" id="kobo.16.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.17.1">The initial setup of this recipe is quite simple since we want to keep the plumbing as minimal as possible in order to help you focus on the core of the technique. </span><span class="koboSpan" id="kobo.17.2">We have a data array containing interlaced strings of </span><code class="literal"><span class="koboSpan" id="kobo.18.1">Cat</span></code><span class="koboSpan" id="kobo.19.1"> and </span><code class="literal"><span class="koboSpan" id="kobo.20.1">Dog</span></code><span class="koboSpan" id="kobo.21.1">. </span><span class="koboSpan" id="kobo.21.2">Then, a set of </span><code class="literal"><span class="koboSpan" id="kobo.22.1">div</span></code><span class="koboSpan" id="kobo.23.1"> boxes was created for the data and a transition was created (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1">) to move all the boxes across the web page to the left-hand side. </span><span class="koboSpan" id="kobo.25.2">So far, it is a simple example of a multi-element transition with no surprises yet:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">.transition() // &lt;- A 
.duration(duration) 
    .style("left", "10px") 
.filter(function(d){return d == "Cat";}) // &lt;- B 
.transition() // &lt;- C 
.duration(duration) 
    .style("left", "500px"); 
</span></pre><p><span class="koboSpan" id="kobo.27.1">Then, on line </span><code class="literal"><span class="koboSpan" id="kobo.28.1">B</span></code><span class="koboSpan" id="kobo.29.1">, the </span><code class="literal"><span class="koboSpan" id="kobo.30.1">d3.selection.filter</span></code><span class="koboSpan" id="kobo.31.1"> function was used to generate a subselection that contains only the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.32.1">cat</span></em></span><span class="koboSpan" id="kobo.33.1"> boxes. </span><span class="koboSpan" id="kobo.33.2">Remember, D3 transition is still a selection (transition-bound selection); therefore, the </span><code class="literal"><span class="koboSpan" id="kobo.34.1">d3.selection.filter</span></code><span class="koboSpan" id="kobo.35.1"> function works exactly the same way as on a regular selection. </span><span class="koboSpan" id="kobo.35.2">Once the subselection is generated by the </span><code class="literal"><span class="koboSpan" id="kobo.36.1">filter</span></code><span class="koboSpan" id="kobo.37.1"> function, we can apply a secondary transition (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.38.1">C</span></code><span class="koboSpan" id="kobo.39.1">) to this subselection alone. </span><span class="koboSpan" id="kobo.39.2">The </span><code class="literal"><span class="koboSpan" id="kobo.40.1">filter</span></code><span class="koboSpan" id="kobo.41.1"> function returns a transition-bound selection; therefore, the second transition created on line </span><code class="literal"><span class="koboSpan" id="kobo.42.1">C</span></code><span class="koboSpan" id="kobo.43.1"> is actually generating a transition chain. </span><span class="koboSpan" id="kobo.43.2">It will only be triggered after the first transition reaches its completion. </span><span class="koboSpan" id="kobo.43.3">Using combinations of transition chaining and filtering, we can generate some really interesting data-driven animations; it is a useful tool to have in any data visualizer's toolset.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec125"/><span class="koboSpan" id="kobo.44.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.45.1">For recipes on D3 data-driven selection filtering, please see the </span><span class="emphasis"><em><span class="koboSpan" id="kobo.46.1">Filtering with data</span></em></span><span class="koboSpan" id="kobo.47.1"> recipe </span><a class="link" href="ch03.html" title="Chapter 3. Dealing with Data"><span class="koboSpan" id="kobo.48.1">Chapter 3</span></a><span class="koboSpan" id="kobo.49.1">, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.50.1">Dealing with Data</span></em></span></li><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.51.1">Read about API doc for the </span><code class="literal"><span class="koboSpan" id="kobo.52.1">selection.filter</span></code><span class="koboSpan" id="kobo.53.1"> function at </span><a class="ulink" href="https://github.com/d3/d3-selection/blob/master/README.md#selection_filter"><span class="koboSpan" id="kobo.54.1">https://github.com/d3/d3-selection/blob/master/README.md#selection_filter
</span></a></li></ul></div></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Listening to transitional events"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec47"/><span class="koboSpan" id="kobo.1.1">Listening to transitional events</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">Transition chaining gives you the ability to trigger secondary transitions after the initial transition reach its completion state; however, sometimes you might need to trigger certain action other than a transition, or maybe do something else during the transition. </span><span class="koboSpan" id="kobo.2.2">This is what transition event listeners are designed for, they are the topic of this recipe.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec126"/><span class="koboSpan" id="kobo.3.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.4.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/events.html"><span class="koboSpan" id="kobo.5.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/events.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec127"/><span class="koboSpan" id="kobo.6.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.7.1">In this recipe, we will demonstrate how to display different captions on an animated </span><code class="literal"><span class="koboSpan" id="kobo.8.1">div</span></code><span class="koboSpan" id="kobo.9.1"> element based on its transition state. </span><span class="koboSpan" id="kobo.9.2">Obviously, this example can easily be extended to perform more meaningful tasks using the same technique:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;script type="text/javascript"&gt; 
var body = d3.select("body"), duration = 3000; 
 
var div = body.append("div") 
            .classed("box", true) 
            .style("background-color", "steelblue") 
            .style("color", "white") 
.text("waiting") // &lt;-A 
        .transition().duration(duration) // &lt;-B 
                .delay(1000) // &lt;-C 
                .on("start", function(){ // &lt;-D 
                d3.select(this).text(function (d, i) { 
                return "transitioning"; 
                    }); 
                }) 
                .on("end", function(){ // &lt;-E 
                d3.select(this).text(function (d, i) { 
                return "done"; 
                    }); 
                }) 
            .style("margin-left", "600px"); 
&lt;/script&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">The preceding code produces the following visual output where a box appears with </span><span class="strong"><strong><span class="koboSpan" id="kobo.12.1">waiting</span></strong></span><span class="koboSpan" id="kobo.13.1"> label; it moves to the right with the label changed to </span><span class="strong"><strong><span class="koboSpan" id="kobo.14.1">transitioning</span></strong></span><span class="koboSpan" id="kobo.15.1"> and when it's done, it stops moving and changes its label to </span><span class="strong"><strong><span class="koboSpan" id="kobo.16.1">done</span></strong></span><span class="koboSpan" id="kobo.17.1">:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.18.1"><img src="graphics/image_06_008.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.19.1">Transition event handling</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec128"/><span class="koboSpan" id="kobo.20.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.21.1">In this recipe, we constructed a single </span><code class="literal"><span class="koboSpan" id="kobo.22.1">div</span></code><span class="koboSpan" id="kobo.23.1"> element with a simple horizontal-movement transition, which, when initiated, also changes the label based on what transition state it is in. </span><span class="koboSpan" id="kobo.23.2">Let's first take a look at how we manage to display the </span><span class="strong"><strong><span class="koboSpan" id="kobo.24.1">waiting</span></strong></span><span class="koboSpan" id="kobo.25.1"> label:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">var div = body.append("div") 
            .classed("box", true) 
            .style("background-color", "steelblue") 
            .style("color", "white") 
            .text("waiting") // &lt;-A 
        .transition().duration(duration) // &lt;-B 
                .delay(1000) // &lt;-C 
</span></pre><p><span class="koboSpan" id="kobo.27.1">The </span><span class="strong"><strong><span class="koboSpan" id="kobo.28.1">waiting</span></strong></span><span class="koboSpan" id="kobo.29.1"> label is set on line </span><code class="literal"><span class="koboSpan" id="kobo.30.1">A</span></code><span class="koboSpan" id="kobo.31.1"> before the transition is defined on line </span><code class="literal"><span class="koboSpan" id="kobo.32.1">B</span></code><span class="koboSpan" id="kobo.33.1">, however, we also specified a delay for the transition thus showing the </span><span class="strong"><strong><span class="koboSpan" id="kobo.34.1">waiting</span></strong></span><span class="koboSpan" id="kobo.35.1"> label before the transition is initiated. </span><span class="koboSpan" id="kobo.35.2">Next, let's find out how we were able to display the </span><span class="strong"><strong><span class="koboSpan" id="kobo.36.1">transitioning</span></strong></span><span class="koboSpan" id="kobo.37.1"> label during the transition:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.38.1">.on("start", function(){ // &lt;-D 
d3.select(this).text(function (d, i) { 
  return "transitioning"; 
    }); 
}) 
</span></pre><p><span class="koboSpan" id="kobo.39.1">This is achieved by calling the </span><code class="literal"><span class="koboSpan" id="kobo.40.1">on()</span></code><span class="koboSpan" id="kobo.41.1"> function and selecting its first parameter set as </span><code class="literal"><span class="koboSpan" id="kobo.42.1">"start"</span></code><span class="koboSpan" id="kobo.43.1"> event name with an event listener function passed in as the second parameter. </span><span class="koboSpan" id="kobo.43.2">The </span><code class="literal"><span class="koboSpan" id="kobo.44.1">this</span></code><span class="koboSpan" id="kobo.45.1"> reference of the event listener function points to the current selected element, hence, can be wrapped by D3 and further manipulated. </span><span class="koboSpan" id="kobo.45.2">The transition </span><code class="literal"><span class="koboSpan" id="kobo.46.1">"end"</span></code><span class="koboSpan" id="kobo.47.1"> event is handled in an identical manner:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.48.1">.on("end", function(){ // &lt;-E 
d3.select(this).text(function (d, i) { 
  return "done"; 
    }); 
}) 
</span></pre><p><span class="koboSpan" id="kobo.49.1">The only difference here is that the event name is passed into the </span><code class="literal"><span class="koboSpan" id="kobo.50.1">on()</span></code><span class="koboSpan" id="kobo.51.1"> function.</span></p></div></div></div></div>
<div id="book-columns"><div id="book-inner"><div class="section" title="Working with timer"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec48"/><span class="koboSpan" id="kobo.1.1">Working with timer</span></h1></div></div></div><p><span class="koboSpan" id="kobo.2.1">So far in this chapter we have discussed various topics on D3 transition. </span><span class="koboSpan" id="kobo.2.2">At this point you might be asking the question, </span><span class="emphasis"><em><span class="koboSpan" id="kobo.3.1">What is powering D3 transition that is generating the animated frames?</span></em></span>
</p><p><span class="koboSpan" id="kobo.4.1">In this recipe, we will explore a low-level D3 timer function that you can leverage to create your own custom animation from scratch.</span></p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec129"/><span class="koboSpan" id="kobo.5.1">Getting ready</span></h2></div></div></div><p><span class="koboSpan" id="kobo.6.1">Open your local copy of the following file in your web browser:</span></p><p>
<a class="ulink" href="https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/timer.html"><span class="koboSpan" id="kobo.7.1">https://github.com/NickQiZhu/d3-cookbook-v2/blob/master/src/chapter6/timer.html
</span></a>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec130"/><span class="koboSpan" id="kobo.8.1">How to do it...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.9.1">In this recipe, we will create a custom animation that does not rely on D3 transition or interpolation at all; essentially a custom animation created from scratch. </span><span class="koboSpan" id="kobo.9.2">Let's look at the following code:</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.10.1">&lt;script type="text/javascript"&gt; 
var body = d3.select("body"); 
 
var countdown = body.append("div").append("input"); 
 
countdown.attr("type", "button") 
        .attr("class", "countdown") 
        .attr("value", "0"); 
 
functioncountUp(target){ // &lt;-A 
  var t = d3.timer(function(){ // &lt;-B 
  var value = countdown.attr("value"); 
    if( value == target ) { 
       t.stop(); 
          return true; 
}  // &lt;-C 
countdown.attr("value", ++value); // &lt;-D             
        }); 
    } 
 
function reset(){ 
  countdown.attr("value", 0); 
} 
&lt;/script&gt; 
 
&lt;div class="control-group"&gt; 
&lt;button onclick="countUp(100)"&gt; 
        Start 
&lt;/button&gt; 
&lt;button onclick="reset()"&gt; 
        Clear 
&lt;/button&gt; 
&lt;/div&gt; 
</span></pre><p><span class="koboSpan" id="kobo.11.1">The preceding code generates a box where a timer is set to </span><span class="strong"><strong><span class="koboSpan" id="kobo.12.1">0</span></strong></span><span class="koboSpan" id="kobo.13.1">, and when you click on </span><span class="strong"><strong><span class="koboSpan" id="kobo.14.1">Start</span></strong></span><span class="koboSpan" id="kobo.15.1">, the time increases until it reaches </span><span class="strong"><strong><span class="koboSpan" id="kobo.16.1">100</span></strong></span><span class="koboSpan" id="kobo.17.1"> and stops, as shown in the following:</span></p><p>
</p><div class="mediaobject"><span class="koboSpan" id="kobo.18.1"><img src="graphics/image_06_009.jpg" alt="How to do it..."/></span></div><p>
</p><p><span class="koboSpan" id="kobo.19.1">Custom timer-based animation</span></p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec131"/><span class="koboSpan" id="kobo.20.1">How it works...</span></h2></div></div></div><p><span class="koboSpan" id="kobo.21.1">In this example, we constructed a custom animation that moves integer from 0 to 100. </span><span class="koboSpan" id="kobo.21.2">For such a simple animation, of course, we could have accomplished it using D3 transition and tweening. </span><span class="koboSpan" id="kobo.21.3">However, a simple example like this avoids any distraction from the technique itself. </span><span class="koboSpan" id="kobo.21.4">Additionally, even in this simple example, the timer-based solution is arguably simpler and more flexible than a typical transition-based solution. </span><span class="koboSpan" id="kobo.21.5">The power of this animation lies in the </span><code class="literal"><span class="koboSpan" id="kobo.22.1">countUp</span></code><span class="koboSpan" id="kobo.23.1"> function (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.24.1">A</span></code><span class="koboSpan" id="kobo.25.1">):</span></p><pre class="programlisting"><span class="koboSpan" id="kobo.26.1">functioncountUp(target){ // &lt;-A 
    var t = d3.timer(function(){ // &lt;-B 
        var value = countdown.attr("value"); 
        if( value == target ) { 
            t.stop(); 
            return true; 
        }  // &lt;-C 
        countdown.attr("value", ++value); // &lt;-D             
    }); 
} 
</span></pre><p><span class="koboSpan" id="kobo.27.1">As we have shown in this example, the key to understanding this recipe lies in the </span><code class="literal"><span class="koboSpan" id="kobo.28.1">d3.timer</span></code><span class="koboSpan" id="kobo.29.1"> function. </span><span class="koboSpan" id="kobo.29.2">This </span><code class="literal"><span class="koboSpan" id="kobo.30.1">d3.timer(function, [delay], [mark])</span></code><span class="koboSpan" id="kobo.31.1"> starts a custom timer function and invokes the given function repeatedly, until the function returns </span><code class="literal"><span class="koboSpan" id="kobo.32.1">true</span></code><span class="koboSpan" id="kobo.33.1"> or when the timer is stopped. </span><span class="koboSpan" id="kobo.33.2">Before D3 v4, there was no way to stop the timer once it is started, so the programmer must make sure that the function eventually returns </span><code class="literal"><span class="koboSpan" id="kobo.34.1">true</span></code><span class="koboSpan" id="kobo.35.1">; with the latest D3 release, timer object now offers an explicit </span><code class="literal"><span class="koboSpan" id="kobo.36.1">stop()</span></code><span class="koboSpan" id="kobo.37.1"> function. </span><span class="koboSpan" id="kobo.37.2">However, it is still recommended that the function returns </span><code class="literal"><span class="koboSpan" id="kobo.38.1">true</span></code><span class="koboSpan" id="kobo.39.1"> from a timer function once it has completed its task, as seen on line </span><code class="literal"><span class="koboSpan" id="kobo.40.1">C</span></code><span class="koboSpan" id="kobo.41.1">. </span><span class="koboSpan" id="kobo.41.2">Optionally, you can also specify a </span><span class="emphasis"><em><span class="koboSpan" id="kobo.42.1">delay</span></em></span><span class="koboSpan" id="kobo.43.1"> or a </span><span class="emphasis"><em><span class="koboSpan" id="kobo.44.1">mark</span></em></span><span class="koboSpan" id="kobo.45.1">. </span><span class="koboSpan" id="kobo.45.2">The delay starts from the mark and when the mark is not specified, </span><code class="literal"><span class="koboSpan" id="kobo.46.1">Date.now</span></code><span class="koboSpan" id="kobo.47.1"> will be used as the mark. </span><span class="koboSpan" id="kobo.47.2">The following illustration shows the temporal relationship we discussed here:</span></p><p><span class="koboSpan" id="kobo.48.1">In our implementation, the custom </span><code class="literal"><span class="koboSpan" id="kobo.49.1">timer</span></code><span class="koboSpan" id="kobo.50.1"> function increases button caption by one every time it is called (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.51.1">D</span></code><span class="koboSpan" id="kobo.52.1">) and stops when the value reaches </span><code class="literal"><span class="koboSpan" id="kobo.53.1">100</span></code><span class="koboSpan" id="kobo.54.1"> (refer to line </span><code class="literal"><span class="koboSpan" id="kobo.55.1">C</span></code><span class="koboSpan" id="kobo.56.1">).</span></p><p><span class="koboSpan" id="kobo.57.1">Internally, D3 transition uses the same timer function to generate its animation. </span><span class="koboSpan" id="kobo.57.2">At this point, you might be asking what is the difference between using </span><code class="literal"><span class="koboSpan" id="kobo.58.1">d3.timer</span></code><span class="koboSpan" id="kobo.59.1"> versus Using the animation frame directly. </span><span class="koboSpan" id="kobo.59.2">The answer is that the </span><code class="literal"><span class="koboSpan" id="kobo.60.1">d3.timer</span></code><span class="koboSpan" id="kobo.61.1"> function actually uses animation frame if the browser supports it; otherwise, it is smart enough to fallback to use the </span><code class="literal"><span class="koboSpan" id="kobo.62.1">setTimeout</span></code><span class="koboSpan" id="kobo.63.1"> function, thus freeing you from worrying about your browser's support.</span></p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec132"/><span class="koboSpan" id="kobo.64.1">See also</span></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="koboSpan" id="kobo.65.1">For more information on d3.timer, please visit its API at the following link: </span><a class="ulink" href="https://github.com/d3/d3-timer/blob/master/README.md#timer"><span class="koboSpan" id="kobo.66.1">https://github.com/d3/d3-timer/blob/master/README.md#timer
</span></a></li></ul></div></div></div></div></div></body></html>